<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Isomorphic Application with React and Redux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="So, I know that you like Todo lists, that is, that you really like to write Todo lists, so I want you to create one of them, using a new, delicious an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Isomorphic Application with React and Redux</h1><div class="post__text post__text-html js-mediator-article">  So, I know that you like Todo lists, that is, that you really like to write Todo lists, so I want you to create one of them, using a new, delicious and nutritious <i>(‚Äúnutritious‚Äù note.)</i> Flux framework, <a href="https://github.com/gaearon/redux">Redux</a> !  I wish you only the best. <br><br>  In this article you will learn how to design your own Redux application, not limited to, but also including. <br><br><ul><li>  Whole grain server rendering </li><li>  Advanced routing rich in Omega-3 </li><li>  Oily asynchronous data loading </li><li>  Smooth functional aftertaste </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If this is similar to what you want in this life, forward under the cat, if not, then do not bother. <br><a name="habracut"></a><br>  I want to tell you ... It will not be a super small tutorial, so fasten yourself and get ready for the thorny path, do not put out your hands and feet and all that ... <br><br><h4>  <b>Wait, wait, what is Redux?</b> </h4><br>  Oh, I'm glad you asked! <br><br>  <a href="https://github.com/gaearon/redux"><b>Redux</b></a> is a new Flux framework from <a href="https://github.com/gaearon">Danil Abramov</a> , which removes many unnecessary difficulties.  You can read why this framework was created <a href="https://medium.com/%40dan_abramov/the-evolution-of-flux-frameworks-6c16ad26bb31">here</a> or <a href="http://www.youtube.com/watch%3Fv%3DxsSnOQynTHs">see</a> , in general, TL: DR <b>Redux</b> keeps the state of your application in one place, and defines the minimal, but powerful enough way to interact with this state <i>(state orig.)</i> . <br><br>  If you are familiar with <a href="https://facebook.github.io/flux/docs/overview.html">traditional</a> <a href="http://acdlite.github.io/flummox">Flux</a> <a href="http://martyjs.org/">frameworks</a> , then the biggest difference you'll notice is the lack of Storage <i>(Stores orig.)</i> , And the presence of "Reducers" <i>(Reducers orig.)</i> . <br>  In <b>Redux</b> , the entire state of the application lives in one place (an instance of Redux), instead of being divided into separate repositories (which may slightly oppose isomorphism). <br>  ‚ÄúReducer‚Äù is a description of how the state will change, it doesn‚Äôt change anything in essence, and it looks like this: <br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exampleReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.changedBasedOn(action) }</code> </pre> <br>  How?  You will see later. <br><br>  You probably think that <b>Redux</b> looks more like a solution than a framework.  This is the minimum base that contains all the best Flux ideas.  I hope this article will teach you how to use it successfully, thrive and go with minimal mutations. <br><br><h4>  <b>Make yourself comfortable</b> </h4><br>  We will use <a href="http://webpack.github.io/">Webpack</a> and <a href="http://babeljs.io/">Babel</a> to tie our application together, because we are cool, smart and joyful, and because they give us the ability to <a href="https://gaearon.github.io/react-hot-loader/">reload the code on the fly</a> and the latest ES6 / 7 chips. <br><br>  First we need to create a directory and put some files there. <br><br>  Here is the <i><b>package.json</b></i> that I prepared in advance: <br><div class="spoiler">  <b class="spoiler_title">package.json</b> <div class="spoiler_text"><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"isomorphic-redux"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"Basic isomorphic redux application"</span></span>, <span class="hljs-string"><span class="hljs-string">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"index.js"</span></span>, <span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"NODE_PATH=$NODE_PATH:./shared node ."</span></span>, <span class="hljs-string"><span class="hljs-string">"dev"</span></span>: <span class="hljs-string"><span class="hljs-string">"npm run start &amp; webpack-dev-server --progress --color"</span></span> }, <span class="hljs-string"><span class="hljs-string">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">"&lt;your-name&gt; &lt;&lt;your-email&gt;&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIT"</span></span>, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"axios"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.5.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"express"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.13.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"immutable"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.7.4"</span></span>, <span class="hljs-string"><span class="hljs-string">"object-assign"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"react"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.13.3"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-redux"</span></span>: <span class="hljs-string"><span class="hljs-string">"^0.2.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-router"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.0.0-beta3"</span></span>, <span class="hljs-string"><span class="hljs-string">"redux"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.0.0-rc"</span></span> }, <span class="hljs-string"><span class="hljs-string">"devDependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"babel"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.8.20"</span></span>, <span class="hljs-string"><span class="hljs-string">"babel-eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"^4.0.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"babel-loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"^5.3.2"</span></span>, <span class="hljs-string"><span class="hljs-string">"eslint"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.0.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"eslint-plugin-react"</span></span>: <span class="hljs-string"><span class="hljs-string">"^3.1.0"</span></span>, <span class="hljs-string"><span class="hljs-string">"react-hot-loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.2.8"</span></span>, <span class="hljs-string"><span class="hljs-string">"webpack"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.10.5"</span></span>, <span class="hljs-string"><span class="hljs-string">"webpack-dev-server"</span></span>: <span class="hljs-string"><span class="hljs-string">"^1.10.1"</span></span> } }</code> </pre><br></div></div><br>  and <br><div class="spoiler">  <b class="spoiler_title">webpack.config.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> path = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'path'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> webpack = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'webpack'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">entry</span></span>: [ <span class="hljs-string"><span class="hljs-string">'webpack-dev-server/client?http://localhost:8080/'</span></span>, <span class="hljs-string"><span class="hljs-string">'webpack/hot/only-dev-server'</span></span>, <span class="hljs-string"><span class="hljs-string">'./client'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">output</span></span>: { <span class="hljs-attr"><span class="hljs-attr">path</span></span>: path.join(__dirname, <span class="hljs-string"><span class="hljs-string">'dist'</span></span>), <span class="hljs-attr"><span class="hljs-attr">filename</span></span>: <span class="hljs-string"><span class="hljs-string">'bundle.js'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">resolve</span></span>: { <span class="hljs-attr"><span class="hljs-attr">modulesDirectories</span></span>: [<span class="hljs-string"><span class="hljs-string">'node_modules'</span></span>, <span class="hljs-string"><span class="hljs-string">'shared'</span></span>], <span class="hljs-attr"><span class="hljs-attr">extensions</span></span>: [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'.jsx'</span></span>] }, <span class="hljs-attr"><span class="hljs-attr">module</span></span>: { <span class="hljs-attr"><span class="hljs-attr">loaders</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">test</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/\.jsx?$/</span></span>, <span class="hljs-attr"><span class="hljs-attr">exclude</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/node_modules/</span></span>, <span class="hljs-attr"><span class="hljs-attr">loaders</span></span>: [<span class="hljs-string"><span class="hljs-string">'react-hot'</span></span>, <span class="hljs-string"><span class="hljs-string">'babel'</span></span>] } ] }, <span class="hljs-attr"><span class="hljs-attr">plugins</span></span>: [ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.HotModuleReplacementPlugin(), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> webpack.NoErrorsPlugin() ], <span class="hljs-attr"><span class="hljs-attr">devtool</span></span>: <span class="hljs-string"><span class="hljs-string">'inline-source-map'</span></span>, <span class="hljs-attr"><span class="hljs-attr">devServer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">hot</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">proxy</span></span>: { <span class="hljs-string"><span class="hljs-string">'*'</span></span>: <span class="hljs-string"><span class="hljs-string">'http://localhost:'</span></span> + (process.env.PORT || <span class="hljs-number"><span class="hljs-number">3000</span></span>) } } };</code> </pre><br></div></div><br>  and <i><b>.babelrc</b></i> (for 'ES7' sugar) <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"optional"</span></span>: [<span class="hljs-string"><span class="hljs-string">"es7.decorators"</span></span>, <span class="hljs-string"><span class="hljs-string">"es7.classProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"es7.objectRestSpread"</span></span>] }</code> </pre><br>  Frankly, these files are not so remarkable, just created a reasonable dev environment for themselves. <br>  Well, now you need to run <code>npm i</code> to download all the dependent modules, and you can start. <br><br><h4>  <b>Give me Seymour</b> </h4><br>  The basic structure of the application will look like this: <br><pre> <code class="bash hljs">client/ shared/ index.js server.jsx</code> </pre><br>  All the main parts of the code will be in the <code>shared</code> directory, but you need some gluing code to separate the client and server parts. <br><br><div class="spoiler">  <b class="spoiler_title">index.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'babel/register'</span></span>)({}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> server = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./server'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> PORT = process.env.PORT || <span class="hljs-number"><span class="hljs-number">3000</span></span>; server.listen(PORT, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Server listening on'</span></span>, PORT); });</code> </pre><br></div></div><br>  just a file to run <i><b>server.jsx</b></i> , so now we can use ES6 / JSX. <br><br>  Server functions will perform <a href="http://expressjs.com/">Express</a> , because it is easier, and there is a chance that you already know it. <br><div class="spoiler">  <b class="spoiler_title">server.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> express <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'express'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> app = express(); app.use(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> HTML = <span class="hljs-string"><span class="hljs-string">` &lt;DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Isomorphic Redux Demo&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;div id="react-view"&gt;&lt;/div&gt; &lt;script type="application/javascript" src="/bundle.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt; `</span></span>; res.end(HTML); }); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> app;</code> </pre><br></div></div><br>  Pretty standard bullshit.  We set up an Express server with global middleware, but do not process anything, just an empty web page that will help us look into the void of existence.  Let's fix it. <br><br><h4>  <b>Rotate how about</b> </h4><br>  You probably think that with Express routing and templating it will be easy.  Unfortunately, you're wrong, because we want to share as much logic as possible between the server and the client.  We will use <a href="https://github.com/rackt/react-router">React Router</a> , as it can route on the client and on the server. <br><br>  So, we have the root component <code>shared/components/index.jsx</code> , which integrates our React Router.  In this way, we can add aesthetics to the entire application (cap and basement, for example), good architecture for a brilliant SPA. <br><div class="spoiler">  <b class="spoiler_title">shared / components / index.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app-view"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Todos</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">hr</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> {this.props.children} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } }</code> </pre><br></div></div><br>  here <i><b>children will</b></i> then turn into a tree of components, which will give us a router after its dependency magic.  There is nothing special here, just display everything as it is. <br><br>  Next we need to determine the route to <br><div class="spoiler">  <b class="spoiler_title">shared / routes.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Route } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{App}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> );</code> </pre><br></div></div><br>  Here we just say React Router will display our <code>components/index</code> along the path '/'.  Sounds good! <br>  Now we will do the same on the server. <br><div class="spoiler">  <b class="spoiler_title">server.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Router } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Location <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router/lib/Location'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'routes'</span></span>; app.use(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> location = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Location(req.path, req.query); Router.run(routes, location, (err, routeState) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InitialComponent = ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...routeState</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml"> ); const componentHTML = React.renderToString(InitialComponent); const HTML = `...`; res.end(HTML); }); });</span></span></code> </pre><br></div></div><br>  Here we import a couple of new toys and tell the router to send the request into the hands of express.  Hopefully we‚Äôll go back to the <code>routeState</code> variable and be able to display the route we‚Äôre asking for.  Then we can use the deft method <code>renderToString</code> from <b>React</b> , which will output our component to an HTML string, which we will give to the client in the <b>react-view</b> div we wrote earlier. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"react-view"</span></span></span><span class="hljs-tag">&gt;</span></span>${componentHTML}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  If we run <code>npm start</code> we will see here <a href="http://localhost:3000/">http: // localhost: 3000 /</a> that the route is inserted into HTML. <br><img src="https://habrastorage.org/getpro/habr/post_images/8a1/04d/877/8a104d87706e3f05124546b96b536696.jpg" alt="Todos route"><br>  You will notice that there are a couple of errors in the console, that the router needs several values.  This is because the client is trying to load <code>bundle.js</code> , but we have not yet set the entry point for webpack, which is why such a garbage. <br><br>  It looks awesome, and I am sure that your brain has already broken, but now we just have a static page.  In order to get all the juicy flesh from React, we need to implement routing on the client. <br><br>  So go ahead, open <code>client/index.jsx</code> and write something: <br><div class="spoiler">  <b class="spoiler_title">client / index.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Router } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { history } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-router/lib/BrowserHistory'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> routes <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'routes'</span></span>; React.render( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Router</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">children</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{routes}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">history</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{history}</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml">, document.getElementById('react-view') );</span></span></code> </pre><br></div></div><br><br>  We told React to insert the Router component into the <b>react-view</b> div, and passed the corresponding parameters to it.  <b>A history</b> object that we have not seen in the server part, a necessary part of the React Router configuration (when displayed directly), and describes how the URL looks.  And we want a good and clean object!  Therefore, we will use the <b>HTML5 History API</b> with <b>BrowserHistory</b> , although for older browsers we could use <b>HashHistory</b> and get the <code>/#</code> URL from the address. <br><br>  Now we can run our application <code>npm run dev</code> and the Webpack will handle our <b>bundle.js</b> .  It looks not so interesting, but going to <a href="http://localhost:8080/">http: // localhost: 8080 /</a> should all work without errors.  Routing is done, and we are ready for the Redux action. <br><br><h4>  <b>Reduce, Reuse, Redux</b> </h4><br>  Redux looks very similar to Flux, except, as I said earlier, that we use gearboxes instead of repositories.  First, we will write a few simple steps to change the Todo sheet. <br><div class="spoiler">  <b class="spoiler_title">shared / actions / TodoActions.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'CREATE_TODO'</span></span>, text, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">editTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id, text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'EDIT_TODO'</span></span>, id, text, <span class="hljs-attr"><span class="hljs-attr">date</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.now() }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'DELETE_TODO'</span></span>, id }; }</code> </pre><br></div></div><br>  As you can see, in Redux, <i>action creators of orig.</i> Are just functions that return successively formatted objects.  No magic, then we need redushers to process them. <br><div class="spoiler">  <b class="spoiler_title">shared / reducers / TodoReducer.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { List } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> defaultState = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List(); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">todoReducer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = defaultState, action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'CREATE_TODO'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.concat(action.text); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'EDIT_TODO'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.set(action.id, action.text); <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'DELETE_TODO'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.delete(action.id); <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } }</code> </pre><br></div></div><br>  It's simple again.  Here we can use the <a href="https://facebook.github.io/immutable-js/docs/">Immutable List object</a> to store an immutable state in the repository (although it may be more difficult in larger applications) and return a new version of the state depending on the action. <br><br>  Redux is not so stubborn, he has only two expectations from his reducer. <br><ol><li>  It must have a signature <code>(state, action) =&gt; newState</code> . </li><li>  The reducer does not change the status transferred to it, but returns its new version. </li></ol><br><br>  As you can see, the last one fits well with <a href="https://facebook.github.io/immutable-js/">Immuatable.js</a> <br><br>  Here we use a simple switch construction, but if you don‚Äôt like it, feel free to write a blank, which will introduce a bit of abstraction. <br><br>  Redux is not limited to the use of a single reducer, for ease of retrieval, you can create <code>reducers/index.js</code> <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> todos } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./TodoReducer'</span></span>;</code> </pre><br>  Since we all have one, we do not really need it, but we will need it in the future. <br><br><h4>  <b>Iiiiii ... Action!</b> </h4><br>  Talking about redusers and actions is good, but our application knows nothing about it!  It's time to change that. <br><br>  We need to forward a Redux instance through the component tree to start all this processing and link all these things together! <br>  NPM of the <code>react-redux</code> has several <code>react-redux</code> that will help us with this. <br><br><div class="spoiler">  <b class="spoiler_title">server.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createStore, combineReducers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'reducers'</span></span>; app.use(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res, next</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> location = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Location(req.path, req.query); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer = combineReducers(reducers); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer); Router.run(routes, location, (err, routeState) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> InitialView = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;Provider store={store}&gt; {(</span></span></span><span class="hljs-function">) =&gt;</span></span> &lt;Router {...routeState} /&gt; } &lt;<span class="hljs-regexp"><span class="hljs-regexp">/Provider&gt; );</span></span></code> </pre><br></div></div><br><br>  We create an instance of the Redux storage component for each request and forward it through the entire component tree (available as <b>&lt;component&gt; .context.redux</b> , if you ever need access to it) by wrapping the root component in <code>Provider</code> . <br>  We also need to give the client the initial state so that he can hydrogenate his storage facilities. <br><br>  Just ask the state of Redux: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialState = store.getState();</code> </pre><br><br>  And add a couple of lines to our HTML template: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Redux Demo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.__INITIAL_STATE__ = ${</span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">JSON</span></span></span><span class="javascript">.stringify(initialState)}; </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  After that, we will have access to the status on the client through the <code>window.__INITIAL_STATE__</code> , not bad, huh? <br>  What we are left to do now is transform everything into the <i>Immutable.js</i> collection.  And give them Redux when we instantiate a new repository. <br><br><div class="spoiler">  <b class="spoiler_title">client / index.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createStore, combineReducers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Provider } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> reducers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'reducers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { fromJS } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'immutable'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> initialState = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.__INITIAL_STATE__; <span class="hljs-comment"><span class="hljs-comment">// Transform into Immutable.js collections, // but leave top level keys untouched for Redux Object .keys(initialState) .forEach(key =&gt; { initialState[key] = fromJS(initialState[key]); }); const reducer = combineReducers(reducers); const store = createStore(reducer, initialState); React.render( &lt;Provider store={store}&gt; {() =&gt; &lt;Router children={routes} history={history} /&gt; } &lt;/Provider&gt;, document.getElementById('react-view'); );</span></span></code> </pre><br></div></div><br>  This is identical to the initialization of the state on the server, except that we hydrogenate the repository with the state passed to us from the server. <br><br>  We are truly approaching the end of our application, there are a couple of components left to connect all the dots. <br><br><h4>  <b>Connect all points</b> </h4><br>  We will use three components to display information that may seem a bit superfluous (most likely it is), but this will show the differences in Redux between the ‚Äúsmart‚Äù and ‚Äústupid‚Äù components, which is very important in large applications. <br><br>  Smart components subscribe to storage Redux events (for example, using the <i><b>decorator</b></i> syntax), and forward it down the tree to other components through properties.  Which can be at any point in the tree, but when developing more complex applications, it usually reaches the lowest layers. <br><br>  Here we will use only one <br><div class="spoiler">  <b class="spoiler_title">shared / components / Home.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TodosView <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/TodosView'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TodosForm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/TodosForm'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { bindActionCreators } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TodoActions <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'actions/TodoActions'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; @connect(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> ({ <span class="hljs-attr"><span class="hljs-attr">todos</span></span>: state.todos })) <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Home</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ render() { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { todos, dispatch } = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div id="todo-list"&gt; &lt;TodosView todos={todos} {...bindActionCreators(TodoActions, dispatch)} /&gt; &lt;TodosForm {...bindActionCreators(TodoActions, dispatch)} /&gt; &lt;/div&gt; ); } }</code> </pre><br></div></div><br><br>  Next, we write two "stupid" components, but first, let's see what happens here. <br><br>  If you are not familiar with <a href="https://github.com/wycats/javascript-decorators">decorators</a> ( <b>@connector</b> section), then the best way to understand this is to think that this is the same as the mixins in the components.  You probably met similar constructions in other languages, for example in Python. <br><br>  If not, in javascript these are just functions that in some way modify other functions (here ‚Äúclass‚Äù). <br><br>  The <b>@connect</b> decorator wraps our class with another component ( <code>&lt;Connector&gt;</code> ) that gives access to the requested parts of the state as component properties, therefore we can use <code>todos</code> , which we do.  It also gives access to the <code>dispatch</code> function from Redux, with which we can process our actions, like this: <br><pre> <code class="javascript hljs">dispatch(actionCreator());</code> </pre><br>  Finally, we use the <code>bindActionCreators</code> function from Redux to forward the associated action creators. <br>  This means that in child components, we can call action creators directly, without wrapping them in the <code>dispatch()</code> function. <br><br>  We look <br><div class="spoiler">  <b class="spoiler_title">components / TodosView.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodosView</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ handleDelete = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> id = <span class="hljs-built_in"><span class="hljs-built_in">Number</span></span>(e.target.dataset.id); <span class="hljs-comment"><span class="hljs-comment">// Equivalent to `dispatch(deleteTodo())` this.props.deleteTodo(id); } handleEdit = (e) =&gt; { const id = Number(e.target.dataset.id); const val = this.props.todos.get(id).text // For cutting edge UX let newVal = window.prompt('', val); this.props.editTodo(id, newVal); } render() { return ( &lt;div id="todo-list"&gt; { this.props.todos.map( (todo, index) =&gt; { return ( &lt;div key={index}&gt; &lt;span&gt;{todo}&lt;/span&gt; &lt;button data-id={index} onClick={this.handleDelete}&gt; X &lt;/button&gt; &lt;button data-id={index} onClick={this.handleEdit}&gt; Edit &lt;/button&gt; &lt;/div&gt; ); }) } &lt;/div&gt; ); } }</span></span></code> </pre><br></div></div><br>  Here we display each todo element in the repository, next to the delete and change buttons that are associated with our action creators. <br><br>  Also, please note that we use the ‚Äúarrow‚Äù functions in the definition of a class whose context is associated with the class constructor (since these functions inherit the context from the executor).  If we use the usual functions of the ES6 class (as render), then we have to link them to the context ourselves, which is sometimes tedious. <br><br><blockquote>  Note that you can also use <i><b>React.createClass</b></i> to avoid problems, and use mixins, although I prefer to use the ES6 classes for cleanliness and consistency. <br></blockquote><br><br>  Finally, we define <br><div class="spoiler">  <b class="spoiler_title">components / TodosForm.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TodosForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ handleSubmit = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> node = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.refs[<span class="hljs-string"><span class="hljs-string">'todo-input'</span></span>].getDOMNode(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.createTodo(node.value); node.value = <span class="hljs-string"><span class="hljs-string">''</span></span>; } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div id="todo-form"&gt; &lt;input type="text" placeholder="type todo" ref="todo-input" /&gt; &lt;input type="submit" value="OK!" onClick={this.handleSubmit} /&gt; &lt;/div&gt; ); } }</code> </pre><br></div></div><br>  It is also a ‚Äúdumb‚Äù component that allows you to simply add todo to the repository. <br><br>  It now remains for us to determine the route to <br><br><div class="spoiler">  <b class="spoiler_title">shared / routes.jsx</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Home <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'components/Home'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{App}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">{Home}</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"home"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Route</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> );</span></span></code> </pre><br></div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c7/6b1/dca/8c76b1dcac85786ada77e82e4e3fcf05.jpg" alt="Todo app"><br><br>  And voil√†, go to <a href="http://localhost:8080/home">http: // localhost: 8080 / home</a> and look at the running application <br><br><h4>  <b>Last Frontier: Asynchronous Actions</b> </h4><br>  I know what you're thinking. <br><br>  It's impossible. <br><br>  And I say possible! <br><br>  Another good feature of Redux is to define your middleware with the dispatcher, which will allow you to change your actions (asynchronously).  I'm sure you noticed from the Redux theme that it works with functions with certain signatures. <br><br>  We are going to use our Redux middleware to make our actions in the application more simple, and to make our action creators synchronous, which will give us the opportunity to use delicious and brilliant ES6 promises. <br><div class="spoiler">  <b class="spoiler_title">shared / lib / promiseMiddleware.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">promiseMiddleware</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">next</span></span></span><span class="hljs-function"> =&gt;</span></span> action =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { promise, type, ...rest } = action; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!promise) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SUCCESS = type; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> REQUEST = type + <span class="hljs-string"><span class="hljs-string">'_REQUEST'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FAILURE = type + <span class="hljs-string"><span class="hljs-string">'_FAILURE'</span></span>; next({ ...rest, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: REQUEST }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> promise .then(res = &gt; { next({ ...rest, res, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: SUCCESS }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }) .catch(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> { next({ ...rest, error, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: FAILURE }); <span class="hljs-comment"><span class="hljs-comment">// Another benefit is being able to log all failures here console.log(error); return false; }); }; }</span></span></code> </pre><br></div></div><br>  This means that we can simply determine the promise key of our action so that it automatically comes to the resolved or rejected state. <br>  We can also optionally track redushers for auto-generated <b>&lt;TYPE&gt; _REQUEST</b> and <b>&lt;TYPE&gt; _FAILURE</b> if we need to trace the state mutation. <br><br>  And to use them, we need to change a couple of lines in <i><b>client / index.jsx</b></i> and <b><i>server.jsx</i></b> <br><br><pre> <code class="javascript hljs">... import { applyMiddleware } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> promiseMiddleware <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lib/promiseMiddleware'</span></span>; ... const store = applyMiddleware(promiseMiddleware)(createStore)(reducer);</code> </pre><br><br>  Just do not forget to forward <b>initialState</b> along with the <b>reducer</b> <br><br>  And now we can write the <b><i>createTodo</i></b> magic action for our action creator, for example <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> BACKEND_URL = <span class="hljs-string"><span class="hljs-string">'https://webtask.it.auth0.com/api/run/wt-milomord-gmail_com-0/redux-tutorial-backend?webtask_no_cache=1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createTodo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'CREATE_TODO'</span></span>, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: request.post(BACKEND_URL, { text }) } }</code> </pre><br><br>  After a small change in the reducer. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.concat(action.res.data.text);</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cb/737/d74/6cb737d745a03217d2973a502b39fd0a.gif" alt="Todo App with async actions"><br><br>  Todo is now saved to my external database.  If we want them to load at the start of our application, simply add the <b>getTodos</b> creator to the action. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTodos</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'GET_TODOS'</span></span>, <span class="hljs-attr"><span class="hljs-attr">promise</span></span>: request.get(BACKEND_URL) } }</code> </pre><br><br>  We catch it in the reduser <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'GET_TODOS'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state.concat(action.res.data);</code> </pre><br><br>  And we can call it when <i><b>TodosView is</b></i> initialized. <br><pre> <code class="javascript hljs">componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.getTodos(); }</code> </pre><br><br>  When the middleware triggers an action for the initial request or possible failure, you can take a look at how we could catch all this in the reducers and update the state of the application accordingly, at boot time or error, respectively. <br><br><h4>  <b>Wait ... Did we break the rehydration of the condition?</b> </h4><br>  Yes.  Let's fix it! <br><br>  The problem is that we added asynchronous actions, but do not wait for them to complete before sending the status to the client.  You may think that it doesn‚Äôt matter, as we can display a loading screen on the client.  Better than hanging on the server, right? <br><br>  Well, it depends on many factors.  The main benefit of server rendering is that we can guarantee a good connection to our backend (which can be in the same datacenter!).  If a user tries to download our site through a missing mobile connection, for example, it is much better that he waits for our server to get the initial state, rather than that he receives it from various resources on his own. <br><br>  The solution to this problem in the current situation is not so difficult.  You can do this in several ways, the way I do, is far from being: <br><br>  We determine what data the component needs as an array of action creators.  We can use a static property in the class definition: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> needs = [ TodoActions.getTodos ]</code> </pre><br><br>  You also need a function that will catch all promise calls, collect data and send them. <br><div class="spoiler">  <b class="spoiler_title">shared / lib / fetchComponentData.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fetchComponentData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch, components, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> needs = components.reduce( <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">prev, current</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (current.needs || []) .concat((current.WrappedComponent ? current.WrappedComponent.needs : []) || []) .concat(prev); }, []); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promises = needs.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">need</span></span></span><span class="hljs-function"> =&gt;</span></span> dispatch(need(params))); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.all(promises); }</code> </pre><br></div></div><br>  Note that we also need to check the <b>WrappedComponent</b> key, since the aforementioned smart components will be wrapped in the <b><i>Connector</i></b> component. <br><br>  Now we set up the server so that it responds only when it has all the data. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> fetchComponentData <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'lib/fetchComponentData'</span></span>; Router.run(routes, location, (err, routeState) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">renderView</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... Rest of the old code goes here return HTML; } // Check this is rendering *something*, for safety if(routeState) fetchComponentData(store.dispatch, routeState.components, routeState.params) .then(renderView) .then(html =&gt; res.end(html)) .catch(err =&gt; res.end(err.message)); });</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f25/5c3/148/f255c3148f2cef5191fde8714d1509f9.gif" alt="Wait for server async data complete"><br><br>  Be sure to delete the action creator from <b><i>onComponentMount</i></b> to avoid repeated calls, and restart <code>npm run dev</code> to update the changes on the server. <br><br><h4>  <b>What have we learned?</b> </h4><br>  That the world is beautiful! <br><br>  Much more can be done and much has been done.  In an application with a large number of routs, you probably want to use the React Router <b><i>onLeave</i></b> handler to load all the data needed by the component (like <a href="">here</a> ), and catch other actions with asynchronous API. <br><br>  Despite all this, I hope you allowed yourself to enjoy the epic quest to a great functional future. <br><br>  You can also see the final result on <a href="https://github.com/bananaoomarang/isomorphic-redux">Github</a> and read more about Redux <a href="https://github.com/gaearon/redux">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/264423/">https://habr.com/ru/post/264423/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264411/index.html">The rhythm of the gameplay - why do we need a base</a></li>
<li><a href="../264415/index.html">Implementing web consoles in the jvm process using the SonarQube example</a></li>
<li><a href="../264417/index.html">Proper use of Exception in PHP</a></li>
<li><a href="../264419/index.html">Method of Lyapunov functions in the problem of the Janibekov effect</a></li>
<li><a href="../264421/index.html">Grinding CSS Animation</a></li>
<li><a href="../264425/index.html">CometQL - api of work from comets server using MySQL protocol</a></li>
<li><a href="../264427/index.html">Limited offer: a cloud server in the Netherlands and the United States at the price of hosting, cheaper ip-address</a></li>
<li><a href="../264429/index.html">Destroy everything</a></li>
<li><a href="../264431/index.html">Embarcadero Announces Purchase of Raize Components</a></li>
<li><a href="../264433/index.html">Natural genetic algorithm or evidence of the evolution of living organisms in C ++</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>