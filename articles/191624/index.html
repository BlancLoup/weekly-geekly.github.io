<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>STM32 + EmBlocks - we blink LEDs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As requested in the comments to the previous article on EmBlocks, today I will show from start to finish how to create a simple project in EmBlocks fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>STM32 + EmBlocks - we blink LEDs</h1><div class="post__text post__text-html js-mediator-article">  As requested in the comments to the <a href="http://habrahabr.ru/post/191468/">previous article</a> on EmBlocks, today I will show from start to finish how to create a simple project in EmBlocks for flashing a pair of LEDs. <br>  As a debug board, we will use the crumbs on the <a title="STM32F103C8" href="http://ravenium.ru/stm32-vs-arduino/">STM32F103C8</a> . <br>  Here is our stand: <br><img src="https://habrastorage.org/storage3/66e/ccf/e34/66eccfe3421a8bb75b47c518bfb5542d.jpg"><br>  We connect LED anodes to PB5 and PB6 pins, cathodes through resistors of 390 Ohms to ground. <br><a name="habracut"></a><br>  So, if you haven‚Äôt downloaded <a title="download EmBlocks" href="http://ravenium.ru/emblocks-ide/">EmBlocks yet</a> , do it.  Unpack to any convenient directory and run. <br>  Create a project by selecting in the menu "File-&gt; New-&gt; Project ..." <br>  In the Projects category, select "STmicro-Arm". <br><img src="https://habrastorage.org/storage3/e79/ea2/0fa/e79ea20fab3e7219b3dcc3719ee649d2.png"><br>  We name the project and select the folder in which it will be created.  In the future, new projects will be automatically saved there, if you do not choose another. <br><img src="https://habrastorage.org/storage3/7ee/b38/0ea/7eeb380eabdaf8d6e702fa2e8f523d56.png"><br>  In the compiler selection window, do not touch anything and move on. <br>  In the processor selection window from the first list, select ‚ÄúSTM32F10x_md‚Äù because  STM32F103C8 belongs to the F1 family and contains 64k FLASH, which relates it to medium density devices. <br>  If you use ColinkEx, then select the specific processor name in the next window, this is necessary for the CoFlash utility firmware. <br>  If you use ST-Link, then you can not touch. <br>  The ‚ÄúCreate hex file‚Äù checkbox is responsible for creating the .hex output instead of the .elf file.  ColinkEx accepts both, but ST-Link Utility only .hex <br><img src="https://habrastorage.org/storage3/9c6/752/c72/9c6752c72aad2270797a09484f2495be.png"><br>  Click Finish.  The wizard prompts you to select a debugger and configure it.  And twice - for the purpose of Debug, and then for Release ... If you use another, click cancel and select another debugger.  I will tell you about other debuggers some other time. <br>  ST-Link is offered by default, it suits us, so just click <b>Ok</b> twice for each target (Debug, Release) <br>  Everything, the project pig is ready.  If you now press F7, the project will be compiled and ready for the firmware with a reminder, which is already taken into account in the Release settings of the target. <br><br><h2>  Let's analyze the project structure: </h2><br> <a href=""><img src="https://habrastorage.org/storage3/0a4/e7b/919/0a4e7b91912dae99da361e83bf7b85aa.png"></a> <br>  All project files are automatically decomposed into <strong>Sources</strong> , <strong>Headers,</strong> and <strong>ASM Sources</strong> folders for <strong>.c</strong> , <strong>.h,</strong> and <strong>.S</strong> files, respectively. <br><br>  In the <strong>Sources</strong> folder, we have a cmsis_boot subfolder with the CMSIS library file. <br>  In the <strong>stm_lib \ src subfolder</strong> , we already have a couple of files that are needed in almost any project: <br> <code>stm32f10x_gpio.c <br> stm32f10x_rcc.c</code> <br>  These are parts of the <em>StdPeriph Library</em> for working with the GPIO and clocking system. <br>  In the <strong>Src</strong> subfolder is the main.c file - the template for our program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the <strong>Headers</strong> folder, headers are laid out in exactly the same folders. <br>  In the future, we will add the necessary parts of the StdPeriph Library to the <strong>stm_lib \ inc</strong> and <strong>stm_lib \ src</strong> subfolders and include them in the project by right-clicking on the name and selecting ‚ÄúAdd files ...‚Äù or ‚ÄúAdd files recursively ...‚Äù.  But today we will not need it. <br><br>  The startup_stm32f10x_md.S file in the <strong>ASM Sources \ cmsis_boot \ startup</strong> folder is responsible for launching the microcontroller. <br>  The linker script is in the <strong>Others</strong> folder and is called gcc_arm.ld <br><br>  With the structure of the project, we briefly met each other, it's time to write the code for which we were starting a business. <br>  Open the file <strong>Sources \ Src \ main.c</strong> and replace the text in it with this: <br><pre> <code class="hljs smalltalk"><span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;stm32f10x.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;stm32f10x_conf.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;stm32f10x_rcc.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#include</span></span> &lt;stm32f10x_gpio.h&gt; <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">RCC_GPIO</span></span> <span class="hljs-type"><span class="hljs-type">RCC_APB2Periph_GPIOB</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LED_PORT</span></span> <span class="hljs-type"><span class="hljs-type">GPIOB</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LED1_PIN</span></span> <span class="hljs-type"><span class="hljs-type">GPIO_Pin_5</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#define</span></span> <span class="hljs-type"><span class="hljs-type">LED2_PIN</span></span> <span class="hljs-type"><span class="hljs-type">GPIO_Pin_6</span></span> void <span class="hljs-type"><span class="hljs-type">Delay</span></span>(volatile uint32_t nCount) { for (; nCount != <span class="hljs-number"><span class="hljs-number">0</span></span>; nCount--); } int main(void) { /* <span class="hljs-type"><span class="hljs-type">SystemInit</span></span>()    startup_stm32f10x_md_vl.<span class="hljs-type"><span class="hljs-type">S</span></span> */ <span class="hljs-type"><span class="hljs-type">GPIO_InitTypeDef</span></span> <span class="hljs-type"><span class="hljs-type">GPIO_InitStructure</span></span>; <span class="hljs-type"><span class="hljs-type">RCC_APB2PeriphClockCmd</span></span>(<span class="hljs-type"><span class="hljs-type">RCC_GPIO</span></span>, <span class="hljs-type"><span class="hljs-type">ENABLE</span></span>); <span class="hljs-type"><span class="hljs-type">GPIO_InitStructure</span></span>.<span class="hljs-type"><span class="hljs-type">GPIO_Pin</span></span> = <span class="hljs-type"><span class="hljs-type">LED1_PIN</span></span> | <span class="hljs-type"><span class="hljs-type">LED2_PIN</span></span>; <span class="hljs-type"><span class="hljs-type">GPIO_InitStructure</span></span>.<span class="hljs-type"><span class="hljs-type">GPIO_Mode</span></span> = <span class="hljs-type"><span class="hljs-type">GPIO_Mode_Out_PP</span></span>; <span class="hljs-type"><span class="hljs-type">GPIO_InitStructure</span></span>.<span class="hljs-type"><span class="hljs-type">GPIO_Speed</span></span> = <span class="hljs-type"><span class="hljs-type">GPIO_Speed_50MHz</span></span>; <span class="hljs-type"><span class="hljs-type">GPIO_Init</span></span>( <span class="hljs-type"><span class="hljs-type">LED_PORT</span></span> , &amp;<span class="hljs-type"><span class="hljs-type">GPIO_InitStructure</span></span>); <span class="hljs-type"><span class="hljs-type">LED_PORT</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">ODR</span></span> ^= <span class="hljs-type"><span class="hljs-type">LED2_PIN</span></span>; while (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-type"><span class="hljs-type">LED_PORT</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">ODR</span></span> ^= <span class="hljs-type"><span class="hljs-type">LED2_PIN</span></span>; <span class="hljs-type"><span class="hljs-type">LED_PORT</span></span>-&gt;<span class="hljs-type"><span class="hljs-type">ODR</span></span> ^= <span class="hljs-type"><span class="hljs-type">LED1_PIN</span></span>; <span class="hljs-type"><span class="hljs-type">Delay</span></span>(<span class="hljs-number"><span class="hljs-number">0x7FFFF</span></span>); } return <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  We defined the macros RCC_GPIO, LED_PORT, LED_PIN1 and LED_PIN2, by changing which we can connect the LEDs to the pins of another port. <br><br>  In the main () function, we fill in the GPIO_InitStructure structure, tuning the pins PB5 and PB6 to operate in PushPull mode with a maximum frequency of 50MHz. <br>  Then we invert the LED_PIN2 state so that the LEDs blink and in a cycle we switch them with a small delay. <br><br>  We press <b>F7</b> , we are convinced that the project is assembled without errors <br> <a href=""><img alt="Build" src="https://habrastorage.org/getpro/habr/post_images/188/6c1/e08/1886c1e087511aeeaa1a009032efef38.png" width="726" height="167"></a> <br>  We connect the ST-Link / v2 debugger to the board and supply power to it, for example via USB, removing the P2 jumper so that the PC does not try to identify the board as a USB device, but simply supplies power.  Press <b>F6</b> to flash using ST-Link / V2 or select ‚ÄúTools-&gt; Flash w ST-Link / V2‚Äù and wait a few seconds and if everything is done correctly, the LEDs will start blinking alternately, which is what we wanted: <br><img src="https://habrastorage.org/storage3/fc9/5d0/93c/fc95d093c03e5949e16e0050f7666525.jpg"><br><br>  Pretty simple, isn't it? <br><br>  The whole process takes about a minute.  If you still failed, <a title="tstBlink Project" href="">download the project</a> and compare it with what you did. <br>  For another board, only the choice of processor from the list will change if it is different and the LED definitions, if it is connected to a different port. <br>  For example, for STM32VLDiscovery: <br><pre> <code class="hljs cs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> RCC_GPIO RCC_APB2Periph_GPIOC #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_PORT GPIOC #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED1_PIN GPIO_Pin_8 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED2_PIN GPIO_Pin_9</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/191624/">https://habr.com/ru/post/191624/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191606/index.html">A short comparison of VHDL and Verilog to help beginners with FPGAs</a></li>
<li><a href="../191608/index.html">And let's really block the government access to the sites?</a></li>
<li><a href="../191610/index.html">Icelandic Innovation Center</a></li>
<li><a href="../191612/index.html">About the Deus Ex dialog system and real mechanics in board games</a></li>
<li><a href="../191614/index.html">HTC One dual sim - the embodiment of versatility</a></li>
<li><a href="../191632/index.html">Microsoft re-releases MS13-057 and MS13-061</a></li>
<li><a href="../191634/index.html">We flash custom firmware with Russian letters on Pebble Watch without a computer</a></li>
<li><a href="../191640/index.html">Old advertisements for cell phones and smartphones (from the 1980s to the end of the 2000s)</a></li>
<li><a href="../191642/index.html">Kevin Mitnik will come to Moscow to perform</a></li>
<li><a href="../191644/index.html">Mailpile collected $ 120K to develop open source cryptomail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>