<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of hacking all the games in Telegram</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Now computer games are everywhere. They are present in the Telegram. I'll tell you about how almost all the games of this messenger were hacked, beati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of hacking all the games in Telegram</h1><div class="post__text post__text-html js-mediator-article">  Now computer games are everywhere.  They are present in the Telegram.  I'll tell you about how almost all the games of this messenger were hacked, beating the most first-class players in the tops of the skorbord.  I want to share the results of research.  On the various methods of hacking, cheating and ways to bypass the logic of games under the cut. <br><br><img src="https://habrastorage.org/webt/59/dc/1f/59dc1f0b788e2958642502.jpeg"><br><a name="habracut"></a><br><h3>  <a href="https://telegram.me/gamebot">@gamebot</a> </h3><br>  The first game, which was considered a few months ago - <a href="https://tbot.xyz/lumber/">LumberJack</a> , playing lumberjack, you need to cut branches so that they would not crush the player.  The goal of the game is to cut as many branches as possible in a certain amount of time. <br><br><img src="https://habrastorage.org/webt/59/da/07/59da07beb21be146616586.png" width="400">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, I wanted to practice the graphic reading of games, that is, on the basis of the graphic data on the monitor, to make a decision.  The program should emulate the reaction of a person by sending the necessary key combinations based on the situation on the screen.  The principle of constructing the logic of the program for the current game is as follows.  A screenshot of the 600x1 pixel screen is made on the right side of the tree.  Not the whole screen, because the process of taking a screenshot of such a large space takes more time.  Then the program at 6 points checks the color of the pixels and, based on this, calculates the player‚Äôs trajectory for 6 branches at once.  If there is a branch on the right, go left, if not - stay on the right.  In one move, 2 hits are made with an ax.  Moves are performed, then a screenshot is taken again and the cycle repeats.  This will continue until time runs out. <br><br><img src="https://habrastorage.org/webt/59/da/09/59da096921ebe279500581.png" width="400"><br><br>  Program code for python 2.7 on Ubuntu 16.04 <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os, time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pyscreenshot <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ImageGrab <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Xlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> display <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_left</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"xte 'key Left'"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move_right</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> os.system(<span class="hljs-string"><span class="hljs-string">"xte 'key Right'"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exist_branch</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x, y)</span></span></span><span class="hljs-function">:</span></span> box = (x, y - <span class="hljs-number"><span class="hljs-number">6</span></span> * <span class="hljs-number"><span class="hljs-number">100</span></span>, x+<span class="hljs-number"><span class="hljs-number">1</span></span>, y) im = ImageGrab.grab(box) rgb_im = im.convert(<span class="hljs-string"><span class="hljs-string">'RGB'</span></span>) x, y = im.size result = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>): r, g, b = rgb_im.getpixel((<span class="hljs-number"><span class="hljs-number">0</span></span>, y - <span class="hljs-number"><span class="hljs-number">1</span></span> - i * <span class="hljs-number"><span class="hljs-number">100</span></span>)) summa = r + g + b <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> summa &lt; <span class="hljs-number"><span class="hljs-number">700</span></span>: result.append(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: result.append(<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_mouse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: data = display.Display().screen().root.query_pointer()._data x = data[<span class="hljs-string"><span class="hljs-string">"root_x"</span></span>] y = data[<span class="hljs-string"><span class="hljs-string">"root_y"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">'%s,%s - %s'</span></span> % (str(x), str(y), exist_branch(x, y)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> start_x = <span class="hljs-number"><span class="hljs-number">1543</span></span> start_y = <span class="hljs-number"><span class="hljs-number">641</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: branches = exist_branch(start_x, start_y) cons_str = <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> elem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> branches: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> elem: cons_str += <span class="hljs-string"><span class="hljs-string">'Left '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: cons_str += <span class="hljs-string"><span class="hljs-string">'Right '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> cons_str <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> elem <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> branches: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> elem: move_left() time.sleep(<span class="hljs-number"><span class="hljs-number">0.03</span></span>) move_left() <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: move_right() time.sleep(<span class="hljs-number"><span class="hljs-number">0.03</span></span>) move_right() time.sleep(<span class="hljs-number"><span class="hljs-number">0.2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-comment"><span class="hljs-comment">#get_mouse() time.sleep(5) main() except: print 'Exit..'</span></span></code> </pre> <br>  To run, you need to install the following dependencies <br><br><pre> <code class="bash hljs">sudo apt-get install xautomation pip install pyscreenshot</code> </pre> <br>  The xte utility is responsible for key emulation in the Linux environment; you can read more <a href="https://anton.logvinenko.name/ru/blog/emulyatsiya-dvijeniya-myishi-i-najatiya-klaviaturyi.html">here</a> .  The pyscreenshot library is responsible for taking a screenshot of the selected screen area, read more <a href="http://pyscreenshot.readthedocs.io/en/latest/">here</a> .  For the program to work, you need to set the first point (the lowest branch on the right, or the place where it could be located), for this you can use the get_mouse () function.  The height between the branches is 100 pixels.  The delay between keystrokes and the delay between taking screenshots is set by trial and error.  It did not work out less than these values, the program did not have time to process the image or press the keys.  An example of the work presented in the video. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/V1fmFUeLRag" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  800 points no one can score, so that the result of the program can be considered a victory. <br><br>  The process of writing and debugging took quite a long time, so you need to consider other solutions. <br><br>  Analyzing HTTP requests, at the end of the game, two types of requests are sent.  If the user has not reached a new record. <br><br><pre> <code class="hljs haskell"><span class="hljs-type"><span class="hljs-type">POST</span></span> /api/getHighScores <span class="hljs-type"><span class="hljs-type">HTTP</span></span>/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-type"><span class="hljs-type">Host</span></span>: tbot.xyz <span class="hljs-type"><span class="hljs-type">Accept</span></span>: */* <span class="hljs-type"><span class="hljs-type">Accept</span></span>-<span class="hljs-type"><span class="hljs-type">Language</span></span>: ru-<span class="hljs-type"><span class="hljs-type">RU</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en-<span class="hljs-type"><span class="hljs-type">US</span></span>;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-type"><span class="hljs-type">Accept</span></span>-<span class="hljs-type"><span class="hljs-type">Encoding</span></span>: gzip, deflate, br <span class="hljs-type"><span class="hljs-type">Content</span></span>-<span class="hljs-type"><span class="hljs-type">Length</span></span>: <span class="hljs-number"><span class="hljs-number">197</span></span> <span class="hljs-type"><span class="hljs-type">Content</span></span>-<span class="hljs-type"><span class="hljs-type">Type</span></span>: text/plain;charset=<span class="hljs-type"><span class="hljs-type">UTF</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-type"><span class="hljs-type">Connection</span></span>: close <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">=[..some_base_64_code..]</span></span></code> </pre> <br>  New record <br><br><pre> <code class="hljs ruby">POST /api/setScore HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Host:</span></span> tbot.xyz User-<span class="hljs-symbol"><span class="hljs-symbol">Agent:</span></span> Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6.1</span></span>; WOW64; <span class="hljs-symbol"><span class="hljs-symbol">rv:</span></span><span class="hljs-number"><span class="hljs-number">55.0</span></span>) Gecko/<span class="hljs-number"><span class="hljs-number">20100101</span></span> Firefox/<span class="hljs-number"><span class="hljs-number">55.0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Accept:</span></span> *<span class="hljs-regexp"><span class="hljs-regexp">/* Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate, br Referer: https:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/tbot.xyz/lumber</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ Content-Length: 206 Content-Type: text/plain</span></span>;charset=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Connection:</span></span> close data=[..some_base_64_code..]&amp;score=some_score</code> </pre><br>  It is enough to replace some_score with some value, and the new number is added to the table. <br><br>  In base64, the account information is sent, that is, the id, the name of the player who clicked on the game, the name of the game, as well as the chat id. <br><br>  It is worth noting that this game belongs to the <a href="https://telegram.me/gamebot">@gamebot</a> bot, on which there are two more games, <a href="https://tbot.xyz/math">Math Battle</a> and <a href="https://tbot.xyz/corsairs">Corsairs</a> .  The game Math Battle was reviewed in more detail. <br><br><img src="https://habrastorage.org/webt/59/e0/12/59e012750615c136156915.png"><br><br>  HTTP request with the number of points sent similar.  It is worth trying to send a request through the inspector in the browser. <br><br>  Open the debugger mode, open the source code main.min.js.  Put a few breakpoints (breakpoints), start the game and find the variable r, which stores the number of points.  This value can be changed via the console. <br><br><img src="https://habrastorage.org/webt/59/e0/14/59e014cd4294e327102624.png"><br><br>  Turning off the debug mode, the function of sending points will be executed and thus you can send an already specified number of points.  In order not to click many times, including \ disabling the inspector, it is worth a little to understand the source code of main.min.js, edited by the <a href="http://jsbeautifier.org/">JS Beautifier</a> service.  Here are three interesting features. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ba</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, d</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest, e = [], f; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> b) e.push(<span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(f) + <span class="hljs-string"><span class="hljs-string">"="</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">encodeURIComponent</span></span>(b[f])); c.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-number"><span class="hljs-number">4</span></span> == c.readyState &amp;&amp; <span class="hljs-number"><span class="hljs-number">200</span></span> == c.status &amp;&amp; d(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(c.responseText)) }; c.open(<span class="hljs-string"><span class="hljs-string">"POST"</span></span>, a, !<span class="hljs-number"><span class="hljs-number">0</span></span>); c.send(e.join(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>)) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">na</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ n &amp;&amp; ba(<span class="hljs-string"><span class="hljs-string">"/api/setScore"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: n, <span class="hljs-attr"><span class="hljs-attr">score</span></span>: r || <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">) </span></span>{ e = a.scores; Y(); I(); a[<span class="hljs-string"><span class="hljs-string">"new"</span></span>] &amp;&amp; l &amp;&amp; (z = !<span class="hljs-number"><span class="hljs-number">0</span></span>, x(M, <span class="hljs-string"><span class="hljs-string">"shown"</span></span>, z)) }) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ca</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ n &amp;&amp; ba(<span class="hljs-string"><span class="hljs-string">"/api/getHighScores"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">data</span></span>: n }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a</span></span></span><span class="hljs-function">) </span></span>{ e = a.scores; Y(); I() }) }</code> </pre><br>  The na () function is called when a new record is reached, ca () is needed just to get the scoreboard of the game.  By the way, the decision what function to call occurs in the function U () in this line. <br><br><pre> <code class="javascript hljs">r &gt; Z ? na() : ca();</code> </pre> <br>  When the r parameter is changed and the na () function is called, the debug mode must be enabled.  It should be something like this. <br><br><img src="https://habrastorage.org/webt/59/db/49/59db496d23f9d829404164.png"><br><br>  The source code is a bit obfuscated, which complicates its analysis, but the basic things are clear. <br><br>  The game Corsairs, also related to the @gamebot bot, is solved by all the methods described above.  For various requests to the server, I was banned, and I can not be added to the scoreboard, the account is in the ban list.  You need to be careful when testing the games of this bot. <br><br><h3>  <a href="https://telegram.me/gamee">@gamee</a> </h3><br>  The <a href="https://telegram.me/gamee">@gamee</a> bot was quite popular.  Qubo game selected. <br><br><img src="https://habrastorage.org/webt/59/e0/18/59e0180f8021b641310287.png"><br><br>  Request sent at the end of the game next <br><br><pre> <code class="hljs smalltalk"><span class="hljs-type"><span class="hljs-type">POST</span></span> /set-web-score-qkfnsog26w7173c9pk7whg0iau7zwhdkfd7ft3tn <span class="hljs-type"><span class="hljs-type">HTTP</span></span>/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-type"><span class="hljs-type">Host</span></span>: bots.gameeapp.com <span class="hljs-type"><span class="hljs-type">Accept</span></span>: application/json, text/javascript, */*; q=<span class="hljs-number"><span class="hljs-number">0.01</span></span> <span class="hljs-type"><span class="hljs-type">Accept</span></span>-<span class="hljs-type"><span class="hljs-type">Language</span></span>: ru-<span class="hljs-type"><span class="hljs-type">RU</span></span>,ru;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en-<span class="hljs-type"><span class="hljs-type">US</span></span>;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> <span class="hljs-type"><span class="hljs-type">Accept</span></span>-<span class="hljs-type"><span class="hljs-type">Encoding</span></span>: gzip, deflate, br <span class="hljs-type"><span class="hljs-type">Content</span></span>-<span class="hljs-type"><span class="hljs-type">Type</span></span>: application/x-www-form-urlencoded; charset=<span class="hljs-type"><span class="hljs-type">UTF</span></span><span class="hljs-number"><span class="hljs-number">-8</span></span> <span class="hljs-type"><span class="hljs-type">Content</span></span>-<span class="hljs-type"><span class="hljs-type">Length</span></span>: <span class="hljs-number"><span class="hljs-number">247</span></span> <span class="hljs-type"><span class="hljs-type">Origin</span></span>: https://www.gameeapp.com <span class="hljs-type"><span class="hljs-type">Connection</span></span>: close {<span class="hljs-comment"><span class="hljs-comment">"score"</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-comment"><span class="hljs-comment">"url"</span></span>:<span class="hljs-comment"><span class="hljs-comment">"/game/u0yXP5o-7c87f893be9fbc72d9dae3826b7037a53d331dd1"</span></span>,<span class="hljs-comment"><span class="hljs-comment">"play_time"</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span>,<span class="hljs-comment"><span class="hljs-comment">"hash"</span></span>:<span class="hljs-comment"><span class="hljs-comment">"{\"</span></span>ct\<span class="hljs-comment"><span class="hljs-comment">":\"</span></span>q3Qv2QtaFAlihlaAvZSp+ahHSq7y4Uut5bLd80nYX1pp9rz0jh03si8Nx2HIe91x\<span class="hljs-comment"><span class="hljs-comment">",\"</span></span>iv\<span class="hljs-comment"><span class="hljs-comment">":\"</span></span><span class="hljs-number"><span class="hljs-number">93</span></span>b55f8f4105a269e74a58bec5e0e0a0\<span class="hljs-comment"><span class="hljs-comment">",\"</span></span>s\<span class="hljs-comment"><span class="hljs-comment">":\"</span></span>da96bc85b70f149d\<span class="hljs-comment"><span class="hljs-comment">"}"</span></span>}</code> </pre> <br>  Change the score, as in the previous bot, will not work.  Hashes that sign scores, play_time, etc., are generated so that you can‚Äôt score points in such a simple way.  The debugger did not help much, as there were so many variables in it. <br><br><img src="https://habrastorage.org/webt/59/db/5a/59db5ad9e52ea656744313.png"><br><br>  I had to analyze the code manually.  In the source code of the game page you can find such a piece of code. <br><br><img src="https://habrastorage.org/webt/59/db/5a/59db5a54aab76278571547.png"><br><br>  It is noteworthy that the scripts are not connected in the usual way, but through a query in js, and therefore they are not visible in the inspector.  Curious two files are <a href="">gameUI.min.js</a> and <a href="">gameUIdesktop.min.js</a> .  In the first file was found such a function, which is a method of the gameeUI object. <br><br><pre> <code class="javascript hljs">saveScore: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname, t = gameeUI.user, n = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>).getTime(), o = $(<span class="hljs-string"><span class="hljs-string">"#dataId"</span></span>).data(), i = CryptoJS.AES.encrypt(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify({ <span class="hljs-attr"><span class="hljs-attr">score</span></span>: e, <span class="hljs-attr"><span class="hljs-attr">timestamp</span></span>: n }), o.id, { <span class="hljs-attr"><span class="hljs-attr">format</span></span>: CryptoJSAesJson }).toString(), s = { <span class="hljs-attr"><span class="hljs-attr">score</span></span>: e, <span class="hljs-attr"><span class="hljs-attr">url</span></span>: a, <span class="hljs-attr"><span class="hljs-attr">play_time</span></span>: gameeUI.playTime, <span class="hljs-attr"><span class="hljs-attr">hash</span></span>: i, <span class="hljs-attr"><span class="hljs-attr">username</span></span>: t, <span class="hljs-attr"><span class="hljs-attr">anonymous_id</span></span>: gameeUI.anonymous_id }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isFacebook()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = FacebookUserData.getUserData(); s.app_scoped_user_id = r.app_scoped_user_id, s.user_id = r.user_id } gameeUI.sendScoreData(s) }</code> </pre> <br>  Obviously, the input parameter e - points sent to the server.  By sending the string gameeUI.saveScore (some_score) to the console, you can get the coveted number of points. <br><br>  This bot includes the games "3 + 3", "Karate Kido", "Space Traveler", "Hexonix" and so on.  All are solved as described above.  It can be concluded that when one of the games of the next bot is solved in a certain way, then the rest of the games of this bot are solved. <br><br><h3>  <a href="https://telegram.me/GamesHDBot">@GamesHDBot</a> </h3><br>  Quite complicated by logic, you can call the game "Galaxy Space Shooter".  Beautiful graphics, a lot of splashes in the game, you can earn points and coins. <br><br><img src="https://habrastorage.org/webt/59/e0/1a/59e01a17941cb673059425.png"><br><br>  But it was enough to look into the inspector, to find the TlgAdapter object and its putScore method. <br><br><img src="https://habrastorage.org/webt/59/db/93/59db934c4751b369979170.png"><br><br><h3>  <a href="https://telegram.me/ludeiBot">@ludeiBot</a> </h3><br>  Curious was this bot.  Game for testing - "Jumping Submarine". <br><br><img src="https://habrastorage.org/webt/59/e0/1a/59e01ac616f57215788751.png"><br><br>  Request at the end of the game next. <br><br><pre> <code class="hljs coffeescript">POST <span class="hljs-regexp"><span class="hljs-regexp">/v1/setscore HTTP/1.1 Host: telegram-games.ludei.com Accept: */</span></span>* Accept-Language: ru-RU,ru;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en-US;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> Accept-Encoding: gzip, deflate, br Content-Type: application<span class="hljs-regexp"><span class="hljs-regexp">/json;charset=UTF-8 Content-Length: 73 Origin: https:/</span></span>/angrypianohtml5.ludei.com Connection: close {<span class="hljs-string"><span class="hljs-string">"inlineId"</span></span>:<span class="hljs-string"><span class="hljs-string">"token"</span></span>,<span class="hljs-string"><span class="hljs-string">"userId"</span></span>:<span class="hljs-string"><span class="hljs-string">"user_id"</span></span>,<span class="hljs-string"><span class="hljs-string">"score"</span></span>:some_score}</code> </pre> <br>  Points to change just.  It is noteworthy that the user_id is sent in open form.  If you find out the id of all users in the chat, you can make the following spam type attack.  This can be done through the Telegram API. <br><br><img src="https://habrastorage.org/webt/59/db/8a/59db8a117e0c4180927941.png"><br><br>  The idea is that you can not only change the points of another player in the table, but also spam in the general chat by sending notifications about the new winner of the current game.  This is a pretty serious attack if done correctly.  It is impossible to determine who is actually winding up his glasses, and even after removing a person from the chat (the attacker or the one who is ‚Äúspamming‚Äù), one can still continue to behave indistinctly.  You can "spam" on behalf of any member of the chat, including the admin, forcing the admin to exclude certain people from the chat.  The only way to stop such obscurantism - chat admin to delete the message with the proposed game. <br><br>  This bot also includes the games "iBasket", "Sumon", "Angry Piano". <br><br><h3>  <a href="https://telegram.me/MeduzaGameBot">@MeduzaGameBot</a> </h3><br>  This bot includes 5 games and can be used for the type of attack described above. <br>  For example, the game, all familiar sapper. <br><br><img src="https://habrastorage.org/webt/59/e0/99/59e099c9781c3929042354.png"><br><br>  Request the following. <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">GET</span></span> /embed/telegram-game-bot/?user_id=user_id&amp;inline_message_id=chat_id&amp;score=score HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: meduza.io Accept: application/<span class="hljs-type"><span class="hljs-type">json</span></span>, <span class="hljs-type"><span class="hljs-type">text</span></span>/plain, *<span class="hljs-comment"><span class="hljs-comment">/* Accept-Language: en-US,en;q=0.5 Connection: close</span></span></code> </pre> <br>  Here is even easier.  The usual GET request, knowing the chat id and user id, you can arrange spam. <br><br><h3>  <a href="https://telegram.me/foragamesbot">@foragamesbot</a> </h3><br>  There is only one game - "DevRunner" <br><br><img src="https://habrastorage.org/webt/59/e0/1b/59e01bc6bbdc5337182622.png"><br><br>  After the game ends, two requests are sent. <br><br><pre> <code class="hljs coffeescript">POST <span class="hljs-regexp"><span class="hljs-regexp">/game/scored HTTP/1.1 Host: devrunner.fora-soft.com User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:56.0) Gecko/20100101 Firefox/56.0 Accept: */</span></span>* Accept-Language: ru-RU,ru;q=<span class="hljs-number"><span class="hljs-number">0.8</span></span>,en-US;q=<span class="hljs-number"><span class="hljs-number">0.5</span></span>,en;q=<span class="hljs-number"><span class="hljs-number">0.3</span></span> Accept-Encoding: gzip, deflate, br Content-Type: application<span class="hljs-regexp"><span class="hljs-regexp">/x-www-form-urlencoded Referer: https:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/devrunner.fora-soft.com/</span></span>?uid=<span class="hljs-number"><span class="hljs-number">453743655</span></span>&amp;imi=AgAAAKwAAAAnlAsbCh1sirM6oOQ Content-Length: <span class="hljs-number"><span class="hljs-number">97</span></span> Cookie: _ga=GA1<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.2104866484</span></span><span class="hljs-number"><span class="hljs-number">.1507563316</span></span>; _gid=GA1<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.1543721993</span></span><span class="hljs-number"><span class="hljs-number">.1507563316</span></span> Connection: close user_id=<span class="hljs-number"><span class="hljs-number">453743655</span></span>&amp;score=<span class="hljs-number"><span class="hljs-number">111111</span></span>&amp;chat_id=&amp;message_id=&amp;inline_message_id=AgAAAKwAAAAnlAsbCh1sirM6oOQ</code> </pre><br><pre> <code class="hljs markdown">POST /game/scores_image HTTP/1.1 Host: devrunner.fora-soft.com Accept: <span class="hljs-emphasis"><span class="hljs-emphasis">*/*</span></span> Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate, br Content-Type: application/x-www-form-urlencoded Content-Length: 47 Connection: close crutches=1&amp;bugs=2&amp;scores=31&amp;level=0&amp;rank=Intern</code> </pre> <br>  The second query allows you to see where the player with the current score is.  Before testing was started, the player was in the first place with 2000-3000 points, and the funny thing is that about 13k people played the game.  It turns out none of these people thought of outwitting this game :) By replacing requests with the number of points 111113 was in the first place. <br><br><img src="https://habrastorage.org/webt/59/db/9f/59db9f759bb19685505136.png"><br><br><h3>  <a href="https://telegram.me/brugamebot">@brugamebot</a> </h3><br>  Bot with this game can definitely be called the most boring among all. <br><br>  An example is chess.  No rating, notification of victory, and so on.  The game is only client-side. <br><br><img src="https://habrastorage.org/webt/59/e0/9f/59e09f3bef94c669566908.png"><br><br><h3>  <a href="https://telegram.me/microgamesbot">@microgamesbot</a> </h3><br>  This game is also alone in this bot, ‚ÄúJumper Frog‚Äù. <br><br><img src="https://habrastorage.org/webt/59/e0/1c/59e01c71363b0110713819.png"><br><br>  Request at the end of the game <br><br><pre> <code class="hljs ruby">POST /score HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Host:</span></span> microgames-ijwqbqxfic.now.sh User-<span class="hljs-symbol"><span class="hljs-symbol">Agent:</span></span> Mozilla/<span class="hljs-number"><span class="hljs-number">5.0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6.1</span></span>; Win64; x64; <span class="hljs-symbol"><span class="hljs-symbol">rv:</span></span><span class="hljs-number"><span class="hljs-number">56.0</span></span>) Gecko/<span class="hljs-number"><span class="hljs-number">20100101</span></span> Firefox/<span class="hljs-number"><span class="hljs-number">56.0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Accept:</span></span> *<span class="hljs-regexp"><span class="hljs-regexp">/* Accept-Language: ru-RU,ru;q=0.8,en-US;q=0.5,en;q=0.3 Accept-Encoding: gzip, deflate, br Content-Type: application/json</span></span>; charset=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Referer:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/microgames-ijwqbqxfic.now.sh/games</span></span><span class="hljs-regexp"><span class="hljs-regexp">/jumper_frog/</span></span>?token=eyJhbGciOiJIUzUxMiJ9.eyJnYW1lIjoia... Content-<span class="hljs-symbol"><span class="hljs-symbol">Length:</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Connection:</span></span> close {<span class="hljs-string"><span class="hljs-string">"score"</span></span>: <span class="hljs-number"><span class="hljs-number">700</span></span>}</code> </pre> <br>  Part of the token is cut, but the meaning should be clear.  Only score is sent to the server as data.  It is easy to replace it.  The question is different, how did the server recognize that a certain person was playing and write it in the scoreboard in the chat telegram?  And everything is simple - the server takes the data from the Referer header token mentioned above.  A strange crutch, mocked.  The logical question is, what happens if you go to a direct link to this <a href="https://microgames-ijwqbqxfic.now.sh/games/jumper_frog/">game</a> ?  Nothing special, only when you score points, in response to the request above (without Referer) the answer of this kind will come. <br><br><img src="https://habrastorage.org/webt/59/db/a9/59dba9a5b96f4675924546.png"><br><br>  An error is caught that reveals the absolute paths to the files.  In compatibility with LFI, for example, it is already possible to get a lot of useful data.  But since the task was to detect shortcomings of games, and not to conduct a full-fledged pentest of a specific game, it was decided to stop at that. <br><br><h3>  <a href="https://telegram.me/foxgamebot">@foxgamebot</a> </h3><br>  Now the game ‚ÄúTricky Fox‚Äù will be described, which is the most complex in its structure among all, has a high level of security relative to all other games, and it took a lot of time to bypass it.  The author is well done, he created a very suitable game, it was interesting to disassemble it.  The process of solving this game I want to describe in detail.  The player's task is to eat the hens, jumping from island to island.  By clamping the left mouse button or finger on the phone screen, you can force the fox to fly the desired distance. <br><br><img src="https://habrastorage.org/webt/59/e0/f5/59e0f542576ce126794982.png"><br><br>  When the game ends, such a request is sent. <br><br><pre> <code class="hljs perl">POST /game-api/expandScore HTTP/<span class="hljs-number"><span class="hljs-number">1.1</span></span> Host: play.alexbelov.xyz Accept: application/json, text/plain, *<span class="hljs-regexp"><span class="hljs-regexp">/* Accept-Language: en-US,en;q=0.5 Content-Type: application/json</span></span>;charset=utf-<span class="hljs-number"><span class="hljs-number">8</span></span> Content-Length: <span class="hljs-number"><span class="hljs-number">432</span></span> Connection: <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> {<span class="hljs-string"><span class="hljs-string">"hash"</span></span>:<span class="hljs-string"><span class="hljs-string">"d5139c23e94113af55baa5a5b48c42f03c0438d768588aa28057f3da72c938aa4e9db142b6ba0dacbde4aa0fd6ebedf1447d4493f53608a4ff321fee1549c115fc5e3eca98c23c45539982ae08a8ce2627db050eeb73fb13339727b03294739d98b88e9b372be8df37689393794d894108e6c5afe024bfbe451a955100d02649eb5e8fb0091a2186f2303be5a2d4af374cbb1ad0cfd3914b8dbe406ebcd4fe0443f0d05224067088043ac51962ada7207d480d249a10ab595ae0da3627942637"</span></span>,<span class="hljs-string"><span class="hljs-string">"session"</span></span>:<span class="hljs-string"><span class="hljs-string">"bf102fd528a0..."</span></span>}</code> </pre> <br>  What kind of hash is not yet clear.  This is clearly not hex or base64.  In the original 30 thousand lines, if you reformat the code in a readable form.  <a href="http://jsbeautifier.org/">JS Beautifier</a> service was used.  It is logical to search for any substring by such a filter - post ". Such a function is found. <br><br><pre> <code class="javascript hljs">key: <span class="hljs-string"><span class="hljs-string">"setScore"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(e); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-string"><span class="hljs-string">"expandScore"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.apiRequest(t, { <span class="hljs-attr"><span class="hljs-attr">hash</span></span>: e }, { <span class="hljs-attr"><span class="hljs-attr">method</span></span>: <span class="hljs-string"><span class="hljs-string">"post"</span></span> }) }</code> </pre> <br>  Looking for this function through the search, you can find several places where it is called.  For example from these objects - this.ApiService, or this.scoreView.  But none of them was available through the inspector.  Then it was decided to figure out what the hash is sent and how to decode it. <br><br>  Then the search was carried out in the text setScore.  There was such a great feature that explained roughly how encryption is performed. <br><br><pre> <code class="javascript hljs">key: <span class="hljs-string"><span class="hljs-string">"saveResults"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, t = <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> !== <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] ? <span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] : {}, n = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, r = n.gameMe, i = f.default.extend({ <span class="hljs-attr"><span class="hljs-attr">key</span></span>: r._shard }, p), o = d.encrypt(i, <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(t).split(<span class="hljs-string"><span class="hljs-string">""</span></span>).reverse().join(<span class="hljs-string"><span class="hljs-string">""</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ApiService.setScore(o).then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">t</span></span></span><span class="hljs-function">) </span></span>{ e.updateMe() }) }</code> </pre> <br>  First, the JSON format of still unknown data is translated into a string, then this string is broken up into characters in the array, changes back to the order of these characters and the string is glued together again.  Mostly anti-reverse feature from developer?  Putting brekpoint as in the screenshot was obtained access to all current functions and objects that are available specifically in line 14016. <br><br><img src="https://habrastorage.org/webt/59/e1/3c/59e13c24c175e632375215.png"><br><br>  Now you can access some interesting options. <br><br><img src="https://habrastorage.org/webt/59/e1/3d/59e13dc049aef213077056.png"><br><br>  It turns out that all data is encrypted using the AES 256 algorithm in ECB mode.  But what is not clear, using the good <a href="http://aes.online-domain-tools.com/">service</a> for symmetric encryption received. <br><br><img src="https://habrastorage.org/webt/59/e1/3f/59e13fe8f2b82330195525.png"><br><br>  While the program produced a different result. <br><br><img src="https://habrastorage.org/webt/59/e1/40/59e1403933536005283326.png"><br><br>  It turns out the encryption algorithm is also changed, the next chip for the anti-reverse and the process of operation.  But this is not the biggest problem.  Not the number of points is sent to the server, but arrays of data in the JSON format (formatted for readability, the request has no hyphenation and not a single space). <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"_s"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_f"</span></span>:[<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">440.412834676673</span></span>], <span class="hljs-attr"><span class="hljs-attr">"_p"</span></span>:<span class="hljs-number"><span class="hljs-number">0.61</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_r"</span></span>:<span class="hljs-number"><span class="hljs-number">0.44048586944056</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_t"</span></span>:<span class="hljs-number"><span class="hljs-number">1507933273148</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_n"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"_s"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_f"</span></span>:[<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">531.1135607680883</span></span>], <span class="hljs-attr"><span class="hljs-attr">"_p"</span></span>:<span class="hljs-number"><span class="hljs-number">0.64</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_r"</span></span>:<span class="hljs-number"><span class="hljs-number">0.5711409299481298</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_t"</span></span>:<span class="hljs-number"><span class="hljs-number">1507933274848</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_n"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"_s"</span></span>:<span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_f"</span></span>:[<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">583</span></span>], <span class="hljs-attr"><span class="hljs-attr">"_p"</span></span>:<span class="hljs-number"><span class="hljs-number">0.73</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_r"</span></span>:<span class="hljs-number"><span class="hljs-number">0.06360827768619635</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_t"</span></span>:<span class="hljs-number"><span class="hljs-number">1507933277447</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_n"</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">"_s"</span></span>:<span class="hljs-string"><span class="hljs-string">"4"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_f"</span></span>:[<span class="hljs-number"><span class="hljs-number">200</span></span>,<span class="hljs-number"><span class="hljs-number">374.96787925000024</span></span>], <span class="hljs-attr"><span class="hljs-attr">"_p"</span></span>:<span class="hljs-number"><span class="hljs-number">0.54</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_r"</span></span>:<span class="hljs-number"><span class="hljs-number">0.4264300320950012</span></span>, <span class="hljs-attr"><span class="hljs-attr">"_t"</span></span>:<span class="hljs-number"><span class="hljs-number">1507933278662</span></span> } } } }</code> </pre> <br>  Based on the logic of _t, this is the time when the next chicken was eaten in milliseconds, _f is the coordinates of the island or hen, _s is the number, _n is the next island with the chicken eaten.  It turns out that the server does not process how many points were scored, but what data were recorded when the hens were eaten.  A very good idea in terms of game security. <br><br>  Having spent several games, it did not turn out to determine what _p and _r are, most likely they are to divert attention and complicate the understanding of the code, another developer trick.  But all the variables varied within certain limits and a script was written that, based on the necessary amount of time and the required number of points, would generate JSON arrays. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random score = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-comment"><span class="hljs-comment">#time = time.time() * 1000 time = 1507761372191 def generate(counter, time, score): if counter &lt; 10: _s = counter else: _s = chr(counter + 87) _f = [200, random.randrange(360, 600) + random.randrange(2*10^14, 9*10**14)/(10.0*10**14)] _p = random.randrange(15, 80) / 100.0 _r = random.randrange(2*10^19, 9*10**19)/(10.0*10**19) _t = time result = {'_s' : _s, '_f' : _f, '_p' : _p, '_r' : _r, '_t' : _t} if counter &lt; score: time += random.randrange(1000, 6000) result['_n'] = generate(counter + 1, time, score) return result def start_generate(time, score): result = generate(1, time, score) result = json.dumps(result) result = result.split(' ') result = ''.join(result) return result def console_str(time, score): return "d.encrypt(i, '" + start_generate(time, score) + "'.split('').reverse().join(''));" print console_str(time, score)</span></span></code> </pre> <br><img src="https://habrastorage.org/webt/59/e1/60/59e1606362f73221114810.png"><br><br>  The result had to be inserted into the console and then the HTTP request was substituted.  Alas, it worked for a few points, then the account was banned.  Apparently not everything was taken into account in the script. <br><br>  I had to take another test account, continue to study the source code and conduct testing.  In the source, many different strange things are present, for example, all types of AES encryption are implemented, or there is such a strange piece of code with hash tables. <br><br><img src="https://habrastorage.org/webt/59/e1/4c/59e14ce591d3a953508787.png"><br><br>  Or, for example, it is not clear why the required key is in base64 (the md5 key was transmitted during encryption). <br><br><img src="https://habrastorage.org/webt/59/e1/52/59e152854cf92774722997.png"><br><br>  And here is his transcript. <br><br><img src="https://habrastorage.org/webt/59/e1/61/59e161226cf47968754432.png"><br><br>  These are not all oddities found in the code.  However, after a few more hours of debugging, something interesting was found, the catchAnimals function. <br><br><pre> <code class="javascript hljs">key: <span class="hljs-string"><span class="hljs-string">"catchAnimals"</span></span>, <span class="hljs-attr"><span class="hljs-attr">value</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, t = [<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foxOffsetX, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foxy.position.y], n = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getHitAreaAnimal(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foxy, t, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.foxOffsetX); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (n) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.score = ++<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.score; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> r = v.Utils.getRandomInt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>) / <span class="hljs-number"><span class="hljs-number">100</span></span>; r &lt; <span class="hljs-number"><span class="hljs-number">.9</span></span> ? gameSounds &amp;&amp; ion.sound.play(<span class="hljs-string"><span class="hljs-string">"chicken_3"</span></span>) : gameSounds &amp;&amp; ion.sound.play(<span class="hljs-string"><span class="hljs-string">"chicken_1"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scoreView.setScore(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.score), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._passIslands || (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._passIslands = {}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = { <span class="hljs-attr"><span class="hljs-attr">_s</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.score.toString(<span class="hljs-number"><span class="hljs-number">20</span></span>), <span class="hljs-attr"><span class="hljs-attr">_f</span></span>: t, <span class="hljs-attr"><span class="hljs-attr">_p</span></span>: r, <span class="hljs-attr"><span class="hljs-attr">_r</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.random() * r, <span class="hljs-attr"><span class="hljs-attr">_t</span></span>: (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>).getTime() }, o = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getListHead(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._passIslands); o._t ? o._n = i : y.default.extend(o, i), isWebGLRenderer &amp;&amp; game.getFPS() &gt; <span class="hljs-number"><span class="hljs-number">45</span></span> &amp;&amp; f.Main.CanvasWidth &gt; <span class="hljs-number"><span class="hljs-number">2500</span></span> &amp;&amp; ! <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> l.ScoreIncrementer; t.addScore(<span class="hljs-number"><span class="hljs-number">1</span></span>, n.animalType, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ e.removeChild(t), t.destroy(), t = <span class="hljs-literal"><span class="hljs-literal">null</span></span> }), e.addChild(t) }(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.animationAttractor.append(n.getRebornNumber(), n, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> e.explode() }) }</code> </pre> <br>  From it it becomes clear how the array is generated.  Each time a fox eats another hen, this function is called and a new data block is added to the existing array, which is placed in the _n variable.  And also, the score recorded the value that was transferred to another system of calculation, instead of decimal, the score recorded the number in the decadecimal system, the next anti-reverse technique from the developer.  Instead of improving the script, it was decided to set brekpoint and replace the score on the fly. <br><br><img src="https://habrastorage.org/webt/59/e1/4f/59e14f4b2e166082856988.png"><br><br>  Right before setting the score in the code.  Now in the console, change the value and continue the execution of the script. <br><br><img src="https://habrastorage.org/webt/59/e1/4f/59e14fe8a006e633840440.png"><br><br>  And so I was rewarded for my work. <br><br><img src="https://habrastorage.org/webt/59/e1/50/59e1506caf576208348898.png"><br><br>  Into the general skorbord was added a little later. <br><br><img src="https://habrastorage.org/webt/59/e1/54/59e1548c51958805064087.png"><br><br>  It is noteworthy that you can change points with just one array.  In the _s parameter, write the required number of points in the 20th calculus system, all this is encrypted with the custom algorithm aes, with the generated key (md5 format).  It is worth noting that the key is issued based on the chat id, and does not change during the game.  Based on the account id in this game, we can conclude that at least 100 thousand people played it. <br><br>  It should be noted that this attack was possible due to the vulnerability on the server.  The code is accepted by JSON, it is deciphered, most likely, the array with the maximum _s is taken from the data array, and it does not matter that it is only one.  To fix this is simple - you need to parse the entire array for incremental increment _s, checking that the value of this parameter matches the entry number in the JSON tree. <br><br>  What can be concluded?  Everything that is processed on the client side can be modified, changed, and it does not matter how difficult the data is sent to be sent and how difficult the code is obfuscated.  Very pleased with the game "Tricky Fox", the developer is well done.  Let it be just a game, on which you need to spend an hour or two maximum, yet it is worth taking measures to prevent cheating and bypassing logic.  Compared to other more popular games with a negligent attitude to modifying points, the game is very well done.  If you, dear reader, want to develop your own game, then by sorting out the cases from this article you can create not only a beautiful, interesting, but also a fairly secure game. <br><br>  If you have an interesting game that is worth considering, and it is not solved by the methods listed above, send me <a href="https://vk.com/jarvis_777">VK</a> or <a href="http://telegram.me/jarvisAI">Telegram</a> or comments, I will try to consider.  For interception of requests used BurpSuite. <br><br>  <b>PS</b> For replacing the points of many games, you can use the <a href="https://daniil.it/TelegramCheats/">Telegram Cheats</a> service, for the very lazy.  But there is not all games can be screwed. </div><p>Source: <a href="https://habr.com/ru/post/339596/">https://habr.com/ru/post/339596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339584/index.html">We make life easier with the conclusion of SLA</a></li>
<li><a href="../339586/index.html">Red arrows of extra reality</a></li>
<li><a href="../339590/index.html">Webpack and addictions</a></li>
<li><a href="../339592/index.html">Functional F #, which slowly appears in C #</a></li>
<li><a href="../339594/index.html">Expansion of analytical capabilities of the linear programming method with Python tools</a></li>
<li><a href="../339602/index.html">Service control panel. Part 1: Introduction</a></li>
<li><a href="../339606/index.html">Railway-oriented programming. Functional style error handling</a></li>
<li><a href="../339608/index.html">The digest of interesting materials for the mobile developer # 224 (October 2 - October 8)</a></li>
<li><a href="../339610/index.html">Translation of two articles: ‚ÄúHow to commit changes to a Docker image‚Äù and ‚ÄúGuide for Moving Docker Containers‚Äù</a></li>
<li><a href="../339612/index.html">PGP offline key storage strategies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>