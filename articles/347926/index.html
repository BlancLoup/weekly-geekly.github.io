<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flask Mega-Tutorial, Part IX: Pagination (Edition 2018)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Miguel grinberg 



 <<< previous next >>> 


 This is the ninth edition of the Mega-Tutorial Flask series, in which I will tell you how to split list...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flask Mega-Tutorial, Part IX: Pagination (Edition 2018)</h1><div class="post__text post__text-html js-mediator-article"><h3 id="miguel-grinberg">  <em>Miguel grinberg</em> </h3><br><hr><br><p>  <a href="https://habrahabr.ru/post/347450/">&lt;&lt;&lt; previous</a> <a href="https://habrahabr.ru/post/348566/">next &gt;&gt;&gt;</a> </p><br><p>  This is the ninth edition of the Mega-Tutorial Flask series, in which I will tell you how to split lists in a database. </p><a name="habracut"></a><br><p>  For reference, below is a list of articles in this series. </p><br><div class="spoiler">  <b class="spoiler_title">Table of contents</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/346306/"><strong>Chapter 1: Hello world!</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346340/"><strong>Chapter 2: Templates</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346342/"><strong>Chapter 3: Web Forms</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346344/"><strong>Chapter 4: Database</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346346/"><strong>Chapter 5: User Logins</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346348/"><strong>Chapter 6: Profile Page and Avatars</strong></a> </li><li>  <a href="https://habrahabr.ru/post/346880/"><strong>Chapter 7: Error Handling</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347450/"><strong>Chapter 8: Subscribers, Contacts, and Friends</strong></a> </li><li>  <a href="https://habrahabr.ru/post/347926/"><strong>Chapter 9: Pagination</strong></a> (This article) </li><li>  <a href="https://habrahabr.ru/post/348566/"><strong>Chapter 10: Email Support</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349060/"><strong>Chapter 11: Reconstruction</strong></a> </li><li>  <a href="https://habrahabr.ru/post/349604/"><strong>Chapter 12: Date and Time</strong></a> </li><li>  <a href="https://habrahabr.ru/post/350626/"><strong>Chapter 14: Ajax</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351218/"><strong>Chapter 15: Improving Application Structure</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351218/"><strong>Chapter 15: Improving Application Structure</strong></a> </li><li>  <a href="https://habrahabr.ru/post/351900/"><strong>Chapter 16: Full Text Search</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352266/"><strong>Chapter 17: Deploying to Linux</strong></a> </li><li>  <a href="https://habrahabr.ru/post/352830/"><strong>Chapter 18: Deploying to Heroku</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353234/"><strong>Chapter 19: Deploying to Docker Containers</strong></a> </li><li>  <a href="https://habrahabr.ru/post/353804/"><strong>Chapter 20: JavaScript Magic</strong></a> </li><li>  <a href="https://habrahabr.ru/post/354322/"><strong>Chapter 21: User Notifications</strong></a> </li><li>  <a href="https://habrahabr.ru/post/354752/"><strong>Chapter 22: Background Tasks</strong></a> </li><li>  <a href="https://habrahabr.ru/post/358152/"><strong>Chapter 23: Application Programming Interfaces (APIs)</strong></a> </li></ul></div></div><br><p>  <em>Note 1: If you are looking for old versions of this course, this is <a href="https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world-legacy" title="here">here</a> .</em> </p><br><p>  <em>Note 2: If suddenly you would like to speak in support of my (Miguel) work on this blog, or simply do not have the patience to wait for a week of the article, I (Miguel Greenberg) offer a full version of this guide a packed e-book or video.</em>  <em>For more information, visit <a href="http://learn.miguelgrinberg.com/" title="learn.miguelgrinberg.com">learn.miguelgrinberg.com</a> .</em> </p><br><p>  In <a href="https://habrahabr.ru/post/347450/">Chapter 8,</a> I made a few changes to the database needed to support the follower paradigm (subscriber), which is so popular on social networks.  With this functionality, I‚Äôm ready to delete the last entries I created for the demonstration.  This is a fake message. </p><br><p>  In this chapter, the application will start accepting blog posts from users, and also delivers them to the index page and profile pages. </p><br><p>  <em>GitHub links for this chapter:</em> <a href="">Browse</a> , <a href="">Zip</a> , <a href="">Diff</a> . </p><br><h2 id="predstavlenie-soobscheniy-v-blogah">  Blog posts </h2><br><p>  Let's start with something simple.  The homepage should have a form in which users can enter new messages.  First I create a form class: </p><br><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PostForm</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FlaskForm</span></span></span><span class="hljs-class">): post = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TextAreaField</span></span></span><span class="hljs-class">('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Say</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">something'</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">validators</span></span></span><span class="hljs-class">=[ </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DataRequired</span></span></span><span class="hljs-class">(), </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Length</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">min</span></span></span><span class="hljs-class">=1, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">max</span></span></span><span class="hljs-class">=140)]) submit = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SubmitField</span></span></span><span class="hljs-class">('</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Submit</span></span></span><span class="hljs-class">')</span></span></code> </pre> <br><p>  Now you can add this form to the template for the main page of the application: </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hi, </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ current_user.username }}</span></span><span class="xml"><span class="xml">!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.hidden_tag() }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.post.label }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.post(cols=32, rows=4) }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> error </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> form.post.errors %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"color: red;"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">[</span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ error }}</span></span><span class="xml"><span class="xml">]</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ form.submit() }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> post </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> posts %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.author.username }}</span></span><span class="xml"><span class="xml"> says: </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.body }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">b</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">p</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>  Changes in this template are similar to those made in other forms.  In conclusion, add the form creation and processing in the view function: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app.forms <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostForm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Post @app.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @app.route(<span class="hljs-string"><span class="hljs-string">'/index'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) @login_required def <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(): form = PostForm() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> form.validate_on_submit(): post = Post(body=form.post.data, author=<span class="hljs-built_in"><span class="hljs-built_in">current_user</span></span>) db.<span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">add</span></span>(post) db.<span class="hljs-keyword"><span class="hljs-keyword">session</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>() flash(<span class="hljs-string"><span class="hljs-string">'Your post is now live!'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> redirect(url_for(<span class="hljs-string"><span class="hljs-string">'index'</span></span>)) posts = [ { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: {<span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-string"><span class="hljs-string">'John'</span></span>}, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'Beautiful day in Portland!'</span></span> }, { <span class="hljs-string"><span class="hljs-string">'author'</span></span>: {<span class="hljs-string"><span class="hljs-string">'username'</span></span>: <span class="hljs-string"><span class="hljs-string">'Susan'</span></span>}, <span class="hljs-string"><span class="hljs-string">'body'</span></span>: <span class="hljs-string"><span class="hljs-string">'The Avengers movie was so cool!'</span></span> } ] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template("index.html", title=<span class="hljs-string"><span class="hljs-string">'Home Page'</span></span>, form=form, posts=posts)</code> </pre> <br><p>  Let's take a look at the changes in this view function in order: </p><br><ul><li>  Added new import: <code>Post</code> and <code>PostForm</code> </li><li>  <code>POST</code> requests for both routes associated with the <code>index</code> page browsing function, in addition to <code>GET</code> requests, since this viewing function now receives form data. </li><li>  The form processing logic adds a new <code>Post</code> entry to the database. </li><li>  The template receives a <code>form</code> object as an optional argument, so that it can display a text field. </li></ul><br><p>  Before proceeding, I would like to draw attention to a number of important points related to the processing of web forms.  Please note that after processing the form data, I complete the request by sending <em>redirect</em> to the main <em>index</em> page.  I could easily skip the redirection and allow the function to continue working in the <em>template rendering</em> part, since this is already a function of viewing the <em>index</em> . </p><br><p>  So why redirect? </p><br><p><img src="https://habrastorage.org/webt/cb/ud/7x/cbud7xj8sm4rpctv9qprulhyqjg.png"></p><br><p>  The standard practice is to respond <a href="https://youtu.be/DjVB2P15iUo">to the ( <em>request</em> )</a> <code>POST</code> request created when the web form is sent with redirection.  This will help somehow to avoid bouts of irritation when using the update command in web browsers.  After all, when you click the refresh button, the web browser will display the last request.  If a <code>POST</code> request with a form submission returns a regular response, the update will re-send the form.  Since this is always unexpected, the browser will ask the user to confirm the resubmission, but most users will not understand what the browser needs. </p><br><p>  But if a redirect responds to a <code>POST</code> request, the browser will be instructed to send a <code>GET</code> request to capture the page specified in the redirect, so now the last request is no longer a POST request, and the update command works in a more predictable way. </p><br><p>  This simple trick is nothing but the <a href="https://en.wikipedia.org/wiki/Post/Redirect/Get">Post / Redirect / Get</a> pattern <a href="https://en.wikipedia.org/wiki/Post/Redirect/Get">.</a>  .  It avoids the insertion of duplicate messages when the user inadvertently refreshes the page after sending the web form. </p><br><h2 id="prosmotr-soobscheniy-v-blogah">  View blog posts </h2><br><p>  If you remember, I created a couple of blog posts that I had been showing on the home page for a long time.  These fake objects are explicitly created in the <em>index</em> function in the form of a simple Python list: </p><br><pre> <code class="hljs rust">posts = [ { <span class="hljs-symbol"><span class="hljs-symbol">'author</span></span>': {<span class="hljs-symbol"><span class="hljs-symbol">'username</span></span>': <span class="hljs-symbol"><span class="hljs-symbol">'John</span></span>'}, <span class="hljs-symbol"><span class="hljs-symbol">'body</span></span>': <span class="hljs-symbol"><span class="hljs-symbol">'Beautiful</span></span> day <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Portland!' }, { <span class="hljs-symbol"><span class="hljs-symbol">'author</span></span>': {<span class="hljs-symbol"><span class="hljs-symbol">'username</span></span>': <span class="hljs-symbol"><span class="hljs-symbol">'Susan</span></span>'}, <span class="hljs-symbol"><span class="hljs-symbol">'body</span></span>': <span class="hljs-symbol"><span class="hljs-symbol">'The</span></span> Avengers movie was so cool!' } ]</code> </pre> <br><p>  But now I have the <code>followed_posts()</code> method in the <code>User</code> model, which returns messages that this user would like to see.  So, now I can replace temporary messages with real ones: </p><br><pre> <code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route(<span class="hljs-string"><span class="hljs-string">'/index'</span></span>, methods=[<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'POST'</span></span>]) <span class="hljs-meta"><span class="hljs-meta">@login</span></span><span class="hljs-function"><span class="hljs-function">_required def </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: # ... posts </span></span>= current_user.followed_posts().all() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>, title=<span class="hljs-string"><span class="hljs-string">'Home Page'</span></span>, form=form, posts=posts)</code> </pre> <br><p>  The <code>followed_posts</code> method of the <code>User</code> class returns an <em>SQLAlchemy</em> query object that is configured to capture messages that the user has subscribed to from the database.  Calling <code>all()</code> on this query starts its execution, and the return value is a list with all the results. </p><br><p>  Thus, I get a structure that is very similar to the one that formed the temporary messages that I have used so far.  It is so much like that the template doesn't even need to be changed. </p><br><h2 id="oblegchit-poisk-polzovateley">  Facilitate the search for users </h2><br><p>  I hope that you noticed, how the application is working at the moment is not very convenient to use, allowing users to find other users.  In fact, there is actually no way to see what other users are there at all.  I'm going to fix this with a few simple changes. </p><br><p>  It would be necessary to create a new page, which I am going to call the ‚ÄúExplore‚Äù page.  This page will work as a home page, but instead of showing only messages from the following users, it will show a global flow of messages from all users.  Here is a new browsing feature: </p><br><pre> <code class="hljs ruby">@app.route(<span class="hljs-string"><span class="hljs-string">'/explore'</span></span>) @login_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">explore</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>: posts = Post.query.order_by(Post.timestamp.desc()).all() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'index.html'</span></span>, title=<span class="hljs-string"><span class="hljs-string">'Explore'</span></span>, posts=posts)</code> </pre> <br><p>  Have you noticed something weird in this feature?  The call to <code>render_template()</code> refers to the <em>index.html</em> template that I use on the main page of the application.  Since this page will be very similar to the main page, I decided to reuse the template. </p><br><p>  But one difference from the main page is that on the Explore page I don‚Äôt want to have a form to write blog posts, so in this view function I <strong>did not</strong> include the <code>form</code> argument in the template call. </p><br><p>  To prevent the <em>index.html</em> template from failing, when I try to display a web form that does not exist, I will add a condition that displays the form only if it is defined: </p><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> "base.html" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> content %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Hi, </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ current_user.username }}</span></span><span class="xml"><span class="xml">!</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> form %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> ... </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">form</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> ... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>  I will also add a link to this new page in the navigation bar: </p><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('explore') }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Explore</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  Remember the <em><code>_post.html</code></em> , in <a href="https://habrahabr.ru/post/346348/">chapter 6</a> , to display blog posts on a user profile page?  This is a small template that was extracted from the user profile page template and became separate so that it can be used from other templates.  I will now make a small improvement that will allow to show the username of the blog post as a link: </p><br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">valign</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">img</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.author.avatar(36) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ url_for('user', username=post.author.username) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.author.username }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> says:</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ post.body }}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">td</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">table</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><p>  Now I can use this sub-template to visualize and study the blog on the home page: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> post </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> posts %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">include</span></span></span></span></span><span class="hljs-template-tag"> '_post.html' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> ...</span></span></code> </pre> <br><p>  The nested template expects a variable named <code>post</code> to exist, and that is the name of the loop variable in the index template, so this works fine. </p><br><p>  Thanks to these small changes, the usability of the application has improved significantly.  Now the user can visit the page to read blog posts from unknown users and find new ones on the basis of these messages, to add a subscription, which is very easy to do by clicking on the username to access the profile page.  Amazing, right? </p><br><p>  At this stage, I suggest you try the application again, so that you yourself would experience these latest UI improvements. </p><br><p><img src="https://habrastorage.org/webt/bp/rw/qd/bprwqdj3eh5me3baxsrgtsruqis.png"></p><br><h2 id="delenie-zapisey-v-blogah">  Divide blog entries </h2><br><p>  The app looks better than it was, but displaying all the entries on the home page will become a problem much earlier than you can imagine.  What happens if a user has a thousand entries?  Or a million?  Managing such a large list of messages will be extremely slow and inefficient. </p><br><p>  To solve this problem, I'm going to break the list of messages.  This means that initially I will only show a limited number of messages at a time and include links to navigate the rest of the list of messages.  Flask-SQLAlchemy supports <code>paginate()</code> query paging <code>paginate()</code> .  If, for example, I need to get the first twenty user records, I can replace the <code>all()</code> call at the end of the query: </p><br><pre> <code class="hljs css">&gt;&gt;&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">user</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.followed_posts</span></span>()<span class="hljs-selector-class"><span class="hljs-selector-class">.paginate</span></span>(1, 20, <span class="hljs-selector-tag"><span class="hljs-selector-tag">False</span></span>)<span class="hljs-selector-class"><span class="hljs-selector-class">.items</span></span></code> </pre> <br><p>  The <code>paginate</code> method can be called for any query object from Flask-SQLAlchemy.  This requires three arguments: </p><br><ul><li>  page number starting from 1 </li><li>  number of elements per page </li><li>  error flag.  If <code>True</code> , when a page is requested out of range, a 404 error will automatically be returned to the client.  If <code>False</code> , an empty list will be returned for pages out of range. </li></ul><br><p>  The return value from <code>paginate</code> is a <code>Pagination</code> object.  The <code>items</code> attribute of this object contains a list of items on the requested page.  There are more useful things in the Pagination object, which I will discuss later. </p><br><p>  Now let's think about how pagination could be implemented in the <code>index()</code> view function.  You can start by adding a configuration item to your application that determines how many items will be displayed on the page. </p><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... POSTS_PER_PAGE = 3</span></span></code> </pre> <br><p>  It is a good idea that these ‚Äúknobs‚Äù for the entire application can influence its behavior from the configuration file, because then I can make all the adjustments in one place.  As a result, I, of course, will use more than three elements on the page, but for testing it is useful to work with small numbers. </p><br><p>  Next, I need to decide how the page number will be included in the application URLs.  A fairly common way is to use the <em>query string</em> argument to specify an optional page number, the default on page 1 if it is not specified.  Here are some examples of URLs that show how I will implement this: </p><br><ul><li>  Page 1, implicit: <em><a href="http://localhost:5000/index">http: // localhost: 5000 / index</a></em> </li><li>  Page 1, explicit: <em><a href="http://localhost:5000/index%3Fpage%3D1">http: // localhost: 5000 / index? Page = 1</a></em> </li><li>  Page 3: <em><a href="http://localhost:5000/index%3Fpage%3D3">http: // localhost: 5000 / index? Page = 3</a></em> </li></ul><br><p>  To access the arguments specified in the query string, I can use the object Flask's <code>request.args</code> object.  You already saw this in <a href="https://habrahabr.ru/post/346346/">Chapter 5</a> , where I injected the URLs for the user to log in from Flask-Login, which may include the query string argument. </p><br><p>  The following example demonstrates how I added a breakdown of the home page into several and explored browsing features: </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/', methods=[<span class="hljs-symbol"><span class="hljs-symbol">'GE</span></span>T', <span class="hljs-symbol"><span class="hljs-symbol">'POS</span></span>T']) <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/index', methods=[<span class="hljs-symbol"><span class="hljs-symbol">'GE</span></span>T', <span class="hljs-symbol"><span class="hljs-symbol">'POS</span></span>T']) <span class="hljs-meta"><span class="hljs-meta">@login</span></span>_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span></span>(): # ... page = request.args.get(<span class="hljs-symbol"><span class="hljs-symbol">'pag</span></span>e', <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> </span></span>= current_user.followed_posts().paginate( page, app.config[<span class="hljs-symbol"><span class="hljs-symbol">'POSTS_PER_PAG</span></span>E'], <span class="hljs-type"><span class="hljs-type">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-symbol"><span class="hljs-symbol">'index</span></span>.html', title=<span class="hljs-symbol"><span class="hljs-symbol">'Hom</span></span>e', form=form, posts=posts.items) <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/explore') <span class="hljs-meta"><span class="hljs-meta">@login</span></span>_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">explore</span></span></span></span>(): page = request.args.get(<span class="hljs-symbol"><span class="hljs-symbol">'pag</span></span>e', <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Post</span></span>.query.order_by(<span class="hljs-type"><span class="hljs-type">Post</span></span>.timestamp.desc()).paginate( page, app.config[<span class="hljs-symbol"><span class="hljs-symbol">'POSTS_PER_PAG</span></span>E'], <span class="hljs-type"><span class="hljs-type">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>, title=<span class="hljs-symbol"><span class="hljs-symbol">'Explor</span></span>e', posts=posts.items)</code> </pre> <br><p>  In these changes, both of the two routes determine the page number to display, either from the <code>page</code> argument of the <code>page</code> request, or the default is 1. Then the <code>paginate()</code> method is used to retrieve only the desired page with the results.  The <code>POSTS_PER_PAGE</code> configuration <code>POSTS_PER_PAGE</code> , which defines the page size, is accessible via the <code>app.config</code> object. </p><br><p>  Notice how easy these changes are, and how little they affect every piece of code.  I try to write each part, abstracting from the work of other parts, and this allows me to write modular and reliable applications that are easier to expand and test.  In this case, the probability of getting a fatal or minor error is substantially small. </p><br><p>  Moving on!  And you should experience paging functionality.  First make sure that you have more than three blog posts.  This is easier to see on the search page (explore page), where messages from all users are displayed.  Now you only see the last three messages.  If you want to see the following three, enter <code>http://localhost:5000/explore?page=2</code> in the address bar of the browser. </p><br><h2 id="navigaciya-po-stranicam">  Page navigation </h2><br><p>  The next change is to add links at the bottom of the list of blog posts that allow users to go to the next and / or previous pages.  Remember that I mentioned that the return value from the <code>paginate()</code> call is an object of the Pagination class from Flask-SQLAlchemy?  So far I have used the <em>items</em> attribute of this object, <br>  which contains a list of items received for the selected page.  But this object has several other attributes that are useful when creating links to pages: </p><br><ul><li>  has_next: True if there is at least one page after the current one </li><li>  has_prev: True if there is another page before the current one </li><li>  next_num: page number for the next page </li><li>  prev_num: page number for previous page </li></ul><br><p>  Using these four elements, I can create links to pages (the following and previous ones) and pass them on to templates for display: </p><br><pre> <code class="hljs scala"><span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/', methods=[<span class="hljs-symbol"><span class="hljs-symbol">'GE</span></span>T', <span class="hljs-symbol"><span class="hljs-symbol">'POS</span></span>T']) <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/index', methods=[<span class="hljs-symbol"><span class="hljs-symbol">'GE</span></span>T', <span class="hljs-symbol"><span class="hljs-symbol">'POS</span></span>T']) <span class="hljs-meta"><span class="hljs-meta">@login</span></span>_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span></span>(): # ... page = request.args.get(<span class="hljs-symbol"><span class="hljs-symbol">'pag</span></span>e', <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> </span></span>= current_user.followed_posts().paginate( page, app.config[<span class="hljs-symbol"><span class="hljs-symbol">'POSTS_PER_PAG</span></span>E'], <span class="hljs-type"><span class="hljs-type">False</span></span>) next_url = url_for(<span class="hljs-symbol"><span class="hljs-symbol">'inde</span></span>x', page=posts.next_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_next <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> prev_url = url_for(<span class="hljs-symbol"><span class="hljs-symbol">'inde</span></span>x', page=posts.prev_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_prev <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-symbol"><span class="hljs-symbol">'index</span></span>.html', title=<span class="hljs-symbol"><span class="hljs-symbol">'Hom</span></span>e', form=form, posts=posts.items, next_url=next_url, prev_url=prev_url) <span class="hljs-meta"><span class="hljs-meta">@app</span></span>.route('/explore') <span class="hljs-meta"><span class="hljs-meta">@login</span></span>_required <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">explore</span></span></span></span>(): page = request.args.get(<span class="hljs-symbol"><span class="hljs-symbol">'pag</span></span>e', <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">posts</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-type"><span class="hljs-type">Post</span></span>.query.order_by(<span class="hljs-type"><span class="hljs-type">Post</span></span>.timestamp.desc()).paginate( page, app.config[<span class="hljs-symbol"><span class="hljs-symbol">'POSTS_PER_PAG</span></span>E'], <span class="hljs-type"><span class="hljs-type">False</span></span>) next_url = url_for(<span class="hljs-symbol"><span class="hljs-symbol">'explor</span></span>e', page=posts.next_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_next <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> prev_url = url_for(<span class="hljs-symbol"><span class="hljs-symbol">'explor</span></span>e', page=posts.prev_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_prev <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-type"><span class="hljs-type">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">"index.html"</span></span>, title=<span class="hljs-symbol"><span class="hljs-symbol">'Explor</span></span>e', posts=posts.items, next_url=next_url, prev_url=prev_url)</code> </pre> <br><p>  In <code>next_url</code> and <code>prev_url</code> in these two functions, the URL returned by <code>url_for()</code> will be used only if there is a page in this direction.  If the current page is on one of the ends of the message collection, the <code>has_prev</code> object <code>has_next</code> or <code>has_prev</code> <code>Pagination</code> will be <code>False</code> , in which case the link in this direction will be set to <code>None</code> . </p><br><p>  One interesting aspect of the <code>url_for()</code> function, which I have mentioned before, is that you can add any keyword arguments to it, and if the names of these arguments are not directly indicated in the URL, then Flask will include them in the URL- address as request arguments. </p><br><p>  Links to pages are set in the <em>index.html</em> template, so now let's display them on the page, right below the list of messages: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> post </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> posts %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">include</span></span></span></span></span><span class="hljs-template-tag"> '_post.html' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> prev_url %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ prev_url }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Newer posts</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> next_url %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ next_url }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Older posts</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> ...</span></span></code> </pre> <br><p>  This addition adds a link below the list of messages for both the main index page and the pages that are being examined.  The first link is marked as ‚ÄúNewer posts‚Äù, and it points to the previous page (keep in mind that I show posts sorted by the latest data, so the first page is with the latest content). </p><br><p>  The second link is marked as "Older posts" ("Older posts") and points to the next page of posts. </p><br><p>  If either of these two links is <code>None</code> , then the link will not be shown on the page through a conditional expression. </p><br><p><img src="https://habrastorage.org/webt/3b/w3/zq/3bw3zqyb7q-jvr0p5reitn2oxjo.png"></p><br><h2 id="razbienie-stranicy-profilya-polzovatelya">  Split user profile page </h2><br><p>  At the moment, the changes for the index page are enough.  However, there should also be a list of messages on the user profile page, in which only messages from the profile owner are displayed.  To be consistent, the user profile page should be modified in the same way as the index page. </p><br><p>  I start by updating the user profile viewer function, which still has a list of temporary messages. </p><br><pre> <code class="hljs pgsql">@app.route(<span class="hljs-string"><span class="hljs-string">'/user/&lt;username&gt;'</span></span>) @login_required def <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>(username): <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>.query.filter_by(username=username).first_or_404() page = request.args.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'page'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>=<span class="hljs-type"><span class="hljs-type">int</span></span>) posts = <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.posts.order_by(Post.timestamp.<span class="hljs-keyword"><span class="hljs-keyword">desc</span></span>()).paginate( page, app.config[<span class="hljs-string"><span class="hljs-string">'POSTS_PER_PAGE'</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) next_url = url_for(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, username=<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.username, page=posts.next_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_next <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> prev_url = url_for(<span class="hljs-string"><span class="hljs-string">'user'</span></span>, username=<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.username, page=posts.prev_num) \ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> posts.has_prev <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">'user.html'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>, posts=posts.items, next_url=next_url, prev_url=prev_url)</code> </pre> <br><p>  To get a list of messages from a user, I‚Äôll use the fact that the <code>user.posts</code> relation is a query that SQLAlchemy has already configured as a result of defining <code>db.relationship()</code> in the User model.  I'll take this query and add <code>order_by()</code> to get the most recent posts first, and then do the pagination just like I did for the posts in index and explore.  Note that links to pages that are generated by the <code>url_for()</code> function need an additional <code>username</code> argument, because they point to a user profile page that has this username as a dynamic component of the URL. </p><br><p>  <em>Finally</em> , the changes in the <em>user.html</em> template <em>are</em> identical to those I made on the index page: </p><br><pre> <code class="hljs django"><span class="xml"><span class="xml">... </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> post </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> posts %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">include</span></span></span></span></span><span class="hljs-template-tag"> '_post.html' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> prev_url %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ prev_url }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Newer posts</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> next_url %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ next_url }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Older posts</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br><p>  After you finish experimenting with the pagination function, you can set a more reasonable value for the <code>POSTS_PER_PAGE</code> configuration <code>POSTS_PER_PAGE</code> : </p><br><pre> <code class="hljs python"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># ... POSTS_PER_PAGE = 25</span></span></code> </pre> <br><p>  <a href="https://habrahabr.ru/post/347450/">&lt;&lt;&lt; previous</a> <a href="https://habrahabr.ru/post/348566/">next &gt;&gt;&gt;</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/347926/">https://habr.com/ru/post/347926/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347916/index.html">Examine pattern matching in C # 7</a></li>
<li><a href="../347918/index.html">Animations in Android on the shelves (Part 1. Basic animations)</a></li>
<li><a href="../347920/index.html">Mobile devices from the inside. Changing the tablet memory layout</a></li>
<li><a href="../347922/index.html">What really happened to Vista: an insider retrospective</a></li>
<li><a href="../347924/index.html">Experience of two attempts at putting JNCIE-SP</a></li>
<li><a href="../347928/index.html">FPGA for programmer, state machines (verilog)</a></li>
<li><a href="../347930/index.html">Writing a blockchain in less than 200 lines of Go code</a></li>
<li><a href="../347932/index.html">Useful to the designer and developer. Needed at hand news from the community, designed to improve your workflow. Issue number 7</a></li>
<li><a href="../347934/index.html">Security of third-party dependencies - check with snyk</a></li>
<li><a href="../347936/index.html">Olympiad "ITMO VKontakte": weekend in St. Petersburg and +10 points to the exam</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>