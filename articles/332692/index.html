<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Binary image segmentation using the level set method</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image segmentation is the task of splitting a digital image into one or more areas of interest. This is a fundamental problem in the field of computer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">ğŸ”</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">ğŸ“œ</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">â¬†ï¸</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">â¬‡ï¸</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Binary image segmentation using the level set method</h1><div class="post__text post__text-html js-mediator-article">  Image segmentation is the task of splitting a digital image into one or more areas of interest.  This is a fundamental problem in the field of computer vision, which is solved in many different ways, each of which has its own advantages and disadvantages. <br><br>  In this article I will briefly review the concept of a method of fixing a level and implicitly defined dynamic surfaces (level set method).  I will also consider the role of this method in binary segmentation with the introduction and definition of mathematical constructions, such as SDT (Signed Distance Transforms), a marked distance map. <br><br><img src="https://habrastorage.org/web/e97/366/93a/e9736693a7a84c24b425c8d76d6d98c7.jpg">  <i>On the left - the original image, on the right - segmented</i> <br><a name="habracut"></a><br><h3>  Why all this? </h3><br>  In various industries, there is often a need for segmented images.  For example, in medicine, where there is an interest in obtaining digital 3D models of organs for further analysis.  Segmentation is also used in <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D0%25BF%25D0%25BE%25D0%25B7%25D0%25BD%25D0%25B0%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BB%25D0%25B8%25D1%2586">face recognition</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2588%25D0%25B8%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25B7%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">machine vision</a> , etc. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Image segmentation is a particularly difficult task for several reasons.  First, at present there are no universal segmentation algorithms, therefore it is necessary to create special algorithms, the parameters of which are selected by the user, based on specific conditions.  Secondly, image distortions such as noise, inhomogeneity, etc., are very difficult to take into account in segmentation algorithms without user intervention. <br><br>  The second problem is usually fought using different types of filters.  This technology is perfectly described <a href="https://habrahabr.ru/post/331618/">here</a> . <br><br>  I was faced with the task of image segmentation in the oil and gas industry.  Initially, we had flat core images (as in the figure above).  Having obtained a segmented image, we can interpolate the borders.  Having performed this operation for all images, we can get a mathematical model of our rock sample, with which we can work and on which, for example, we can set the flow of fluids (if we consider our model as a model of continuum mechanics). <br><br><h3>  Level fixation method </h3><br>  This method was introduced by American mathematicians Stanley Osher and James Setian in the 1980s.  It has become popular in many disciplines, such as computer graphics, image processing, computational geometry, optimization, computational fluid dynamics, and computational biophysics. <br><br>  The level fixation method implicitly transforms the contour (in two dimensions) or surface (in three dimensions) using a higher dimension function, called the level fix function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mrow" id="MJXp-Span-2"><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mo" id="MJXp-Span-4" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">x</span><span class="MJXp-mo" id="MJXp-Span-6" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">t</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.533ex" height="2.66ex" viewBox="0 -832 2812.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMATHI-3C6" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMAIN-28" x="654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMATHI-78" x="1044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMAIN-2C" x="1616" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMATHI-74" x="2061" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/332692/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgj_NvgjiTHqu6dHJQwJFRC9zAt_w#MJMAIN-29" x="2423" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-1"> Ï† (x, t) </script>  .  Converted contour or surface can be obtained as a curve <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-9"><span class="noError" id="MJXp-Span-10" style="display: inline-block;">\&nbsp;Gamma&nbsp;(x,&nbsp;t)&nbsp;=&nbsp;\&nbsp;{Ï†&nbsp;(x,&nbsp;t)&nbsp;=&nbsp;0&nbsp;\}</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-2"> \ Gamma (x, t) = \ {Ï† (x, t) = 0 \} </script>  . <br>  The advantage of using this method is that topological changes, such as merging and separating a contour or surface, are implicitly solved, as shown in the figure below. <br><div style="text-align:center;"><img src="https://habrastorage.org/web/924/4b7/e95/9244b7e9521742dba6b801a95333ba07.jpg" width="500" height="250"></div><br>  <font color="#999999"><i>You can see the relationship between the level fixation function (bottom) and the contour (top).</i></font>  <font color="#999999"><i>It is seen that the change in the surface breaks the contour.</i></font> <br><br><h4>  Level modification equation </h4><br>  The definition of a contour or surface is determined by the equation of level modification.  We obtain a numerical solution of this partial differential equation by updating <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-11"><span class="MJXp-mrow" id="MJXp-Span-12"><span class="MJXp-mo" id="MJXp-Span-13" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-3"> Ï† </script>  for each temporary layer.  The general view of the level modification equation is: <p><math> </math> $$ display $$ \ frac {âˆ‚Ï†} {âˆ‚t} = -F | âˆ‡Ï† |  \ qquad (1) $$ display $$ </p><br>  Where: <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-14"><span class="MJXp-mrow" id="MJXp-Span-15"><span class="MJXp-mo" id="MJXp-Span-16" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mo" id="MJXp-Span-17" style="margin-left: 0.267em; margin-right: 0.267em;">Â·</span><span class="MJXp-mrow" id="MJXp-Span-18"><span class="MJXp-mo" id="MJXp-Span-19" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-4"> | Â· | </script>  - Euclidean norm, <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-mrow" id="MJXp-Span-21"><span class="MJXp-mo" id="MJXp-Span-22" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-5"> Ï† </script>  - function of fixing the level <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-23"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-6"> t </script>  - time <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-25"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">F</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-7"> F </script>  - speed ratio. <br><br>  This partial differential equation is very similar to hyperbolic.  But due to the fact that on the right side of the equation, in addition to the derivative in space, there is also a derivative in time, strictly speaking, it is not. <br><br>  With a specific task type of vector <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-27"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28">F</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-8"> F </script>  up to parameters, we can direct the level line to different areas or shapes. <br><br>  For applications in segmentation we will ask <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-29"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">F</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> F </script>  So: <p><math> </math> $$ display $$ F = Î±D (I) + (1-Î±) âˆ‡ \ cdot \ frac {âˆ‡Ï†} {| âˆ‡Ï† |} \ qquad (2) $$ display $$ </p><br>  Where: <br><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">D</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">i</span><span class="MJXp-mo" id="MJXp-Span-71" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> D (i) </script>  - data function, which leads decisions to the desired segmentation, <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-72"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">I</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> I </script>  - pixel intensity value, <br><math> </math> $ inline $ âˆ‡ \ cdot \ frac {âˆ‡Ï†} {| âˆ‡Ï† |} $ inline $   - the middle term of the curvature of the function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-91"><span class="MJXp-mrow" id="MJXp-Span-92"><span class="MJXp-mo" id="MJXp-Span-93" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> Ï† </script>  that will keep this function smooth, <br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-94"><span class="MJXp-mtext" id="MJXp-Span-95">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-100">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> \ alpha </script>  - weight parameter. <br><br>  Data function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102">D</span><span class="MJXp-mo" id="MJXp-Span-103" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-104">i</span><span class="MJXp-mo" id="MJXp-Span-105" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> D (i) </script>  acts as the main â€œforceâ€ that controls segmentation.  By doing <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-106"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-107">D</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> D </script>  positive in the desired areas or negative in the undesired, the model will tend to the desired segmentation.  Here is a simple data function: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">D</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">I</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-114"><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0em; margin-right: 0em;">Îµ</span></span><span class="MJXp-mo" id="MJXp-Span-116" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-mrow" id="MJXp-Span-117"><span class="MJXp-mo" id="MJXp-Span-118" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-119">I</span><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">T</span><span class="MJXp-mrow" id="MJXp-Span-122"><span class="MJXp-mo" id="MJXp-Span-123" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129">d</span><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-131">3</span><span class="MJXp-mo" id="MJXp-Span-132" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-18"> D (I) = Îµ- | I-T | \ qquad (3) </script></p><br>  Her work is shown below in the figure: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/d3e/49a/fba/d3e49afbaf0f4876b4158142bca95ba7.jpg" width="500"></div><br>  That is, if the pixel value falls within the interval <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-133"><span class="MJXp-mo" id="MJXp-Span-134" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">T</span><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-mrow" id="MJXp-Span-137"><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0em; margin-right: 0em;">Îµ</span></span><span class="MJXp-mo" id="MJXp-Span-139" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">T</span><span class="MJXp-mo" id="MJXp-Span-141" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mrow" id="MJXp-Span-142"><span class="MJXp-mo" id="MJXp-Span-143" style="margin-left: 0em; margin-right: 0em;">Îµ</span></span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> (T - Îµ, T + Îµ) </script>  , then the range of the model will expand, otherwise - to narrow. <br><br>  Therefore, the three user parameters that must be specified for segmentation are <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">T</span><span class="MJXp-mo" id="MJXp-Span-147" style="margin-left: 0em; margin-right: 0.222em;">,</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> T, </script>  Îµ and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-148"><span class="MJXp-mtext" id="MJXp-Span-149">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-151">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-152">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> \ alpha </script>  . <br>  For example, if we need to select objects with a low level of brightness (black areas) in the image, then <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-155"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> T </script>  is chosen equal to zero. <br><br><img src="https://habrastorage.org/web/9c6/7a8/870/9c67a88702e34a319f65cac0ec81dfb0.jpg"><br>  <font color="#999999"><i>On the left, select the black areas, on the right, the desired area has a higher brightness, so select</i></font> <math> </math><font color="#999999"><i><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-157"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">T</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mrow" id="MJXp-Span-160"><span class="MJXp-mo" id="MJXp-Span-161" style="margin-left: 0em; margin-right: 0em;">$</span></span><span class="MJXp-mn" id="MJXp-Span-162">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> T = $ 4</script></i></font> <br><br>  Initial mask is also required. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-163"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">m</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> m </script>  .  From what we choose it, will depend on the initial approximation <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-165"><span class="MJXp-mrow" id="MJXp-Span-166"><span class="MJXp-mo" id="MJXp-Span-167" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-25"> Ï† </script>  .  To do this, we introduce the concept of a <i>marked distance map.</i> <br><br><h4>  Signed Distance Transforms </h4><br>  The distance map is a matrix that has the same dimension as our image.  It is constructed in the following way: for each pixel of our image, a value equal to the minimum distance from this pixel to the nearest pixel on the border of the object (s) is calculated.  Mathematical definition of the distance function <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169">d</span><span class="MJXp-mo" id="MJXp-Span-170" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-msubsup" id="MJXp-Span-171"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-173" style="vertical-align: 0.5em;">3</span></span><span class="MJXp-mtext" id="MJXp-Span-174">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">R</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> d: R ^ 3 \ to R </script>  for set S: <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-178"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">d</span><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">r</span><span class="MJXp-mo" id="MJXp-Span-182" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">s</span><span class="MJXp-mo" id="MJXp-Span-184" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-185" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">n</span><span class="MJXp-mrow" id="MJXp-Span-189"><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-191">r</span><span class="MJXp-mo" id="MJXp-Span-192" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-193">s</span><span class="MJXp-mrow" id="MJXp-Span-194"><span class="MJXp-mo" id="MJXp-Span-195" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mtext" id="MJXp-Span-196">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-198">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-199">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">l</span><span class="MJXp-mtext" id="MJXp-Span-208">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">d</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">r</span><span class="MJXp-mo" id="MJXp-Span-215" style="margin-left: 0.333em; margin-right: 0.333em;">âˆˆ</span><span class="MJXp-msubsup" id="MJXp-Span-216"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217" style="margin-right: 0.05em;">R</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-218" style="vertical-align: 0.5em;">3</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-27"> d (r, s) = min | r-s | \ qquad for all \ qquad râˆˆR ^ 3 </script></p><br>  <i>Marked distance map</i> is a matrix that has a positive sign in front of the pixel values â€‹â€‹that are outside the object, and negative for those inside it.  This agreement is a sign that will be implemented during the implementation, but the opposite convention of the sign could also be used.  It should be noted that the cell values â€‹â€‹depend on the selected metric: some common distance metrics are Euclidean distance, <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25A7%25D0%25B5%25D0%25B1%25D1%258B%25D1%2588%25D1%2591%25D0%25B2%25D0%25B0">Chebyshev distance (Chebyshev distance, chessboard distance)</a> and <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D1%2581%25D1%2581%25D1%2582%25D0%25BE%25D1%258F%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B3%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B4%25D1%2581%25D0%25BA%25D0%25B8%25D1%2585_%25D0%25BA%25D0%25B2%25D0%25B0%25D1%2580%25D1%2582%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B2">city â€‹â€‹blocks distance (Taxicab geometry, city block distance, Manhattan distance)</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e6c/d52/d54/e6cd52d544424669bd581779fe3f7d9f.jpg"></div><br>  <font color="#999999"><i>On the left we choose the initial mask.</i></font>  <font color="#999999"><i>This is an object of any form, located inside the object of interest to us.</i></font>  <font color="#999999"><i>Most often it is a rectangle, because it is pretty easy to set.</i></font>  <font color="#999999"><i>After a certain number of iterations, the function on the right (the level modification function) changes in such a way that its intersection with the zero plane gives the curve of interest</i></font> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/069/9fa/1e5/0699fa1e57cc441199c22e28b4fcf2a0.jpg"></div><br><h3>  Sampling </h3><br>  Equation (1), the level equation, must be discretized for sequential or parallel computation.  This is done using a difference circuit with upwind differences. <br><br>  The method of the first order of accuracy for the time discretization of equation (1) is given by the direct Euler method: <p><math> </math> $$ display $$ \ frac {(Ï† ^ {t + âˆ†t} -Ï† ^ t)} {âˆ†t} + F ^ t \ cdotâˆ‡Ï† ^ t = 0 \ qquad (4) $$ display $$ </p><br>  Where: <br><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-255"><span class="MJXp-msubsup" id="MJXp-Span-256"><span class="MJXp-mrow" id="MJXp-Span-257" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-258" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-259" style="vertical-align: 0.5em;">t</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> Ï† ^ t </script>  - current values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-260"><span class="MJXp-mrow" id="MJXp-Span-261"><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> Ï† </script>  at the moment of time <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-263"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-264">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31"> t </script><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-265"><span class="MJXp-msubsup" id="MJXp-Span-266"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267" style="margin-right: 0.05em;">F</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-268" style="vertical-align: 0.5em;">t</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32"> F ^ t </script>  - velocity vector at time <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-269"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-270">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33"> t </script><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-271"><span class="MJXp-mrow" id="MJXp-Span-272"><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-msubsup" id="MJXp-Span-274"><span class="MJXp-mrow" id="MJXp-Span-275" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-276" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-277" style="vertical-align: 0.5em;">t</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34"> âˆ‡Ï† ^ t </script>  - gradient values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-278"><span class="MJXp-mrow" id="MJXp-Span-279"><span class="MJXp-mo" id="MJXp-Span-280" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35"> Ï† </script>  at the moment of time <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-281"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-282">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36"> t </script><br><br>  In calculating the gradient, great care must be taken with respect to spatial derivatives. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-283"><span class="MJXp-mrow" id="MJXp-Span-284"><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37"> Ï† </script>  .  This is best seen if we consider the extended form of equation (4): <br><br><p><math> </math> $$ display $$ \ frac {(Ï† ^ {t + âˆ†t} -Ï† ^ t)} {âˆ†t} + u ^ t Ï†_x ^ t + v ^ t Ï†_y ^ t + w ^ t Ï†_z ^ t = 0 \ qquad (5) $$ display $$ </p><br>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-338"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-339">u</span><span class="MJXp-mo" id="MJXp-Span-340" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341">v</span><span class="MJXp-mo" id="MJXp-Span-342" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343">w</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39"> u, v, w </script>  - Components <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-344"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-345">x</span><span class="MJXp-mo" id="MJXp-Span-346" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-347">y</span><span class="MJXp-mo" id="MJXp-Span-348" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-349">z</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40"> x, y, z </script>  of <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-350"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-351">F</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41"> F </script>  .  For simplicity, consider the one-dimensional form of equation (5) at a particular grid point. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-352"><span class="MJXp-msubsup" id="MJXp-Span-353"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-354" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-355" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-42"> x_i </script>  : <br><p><math> </math> $$ display $$ \ frac {(Ï† ^ {t + âˆ†t} -Ï† ^ t)} {âˆ†t} + u_i ^ t \ cdot (Ï†_x) _i ^ t = 0 \ qquad (6) $$ display $$ </p><br>  Where <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-396"><span class="MJXp-mo" id="MJXp-Span-397" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-398"><span class="MJXp-mrow" id="MJXp-Span-399" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-401" style="vertical-align: -0.4em;">x</span></span><span class="MJXp-msubsup" id="MJXp-Span-402"><span class="MJXp-mo" id="MJXp-Span-403" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-405">t</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-404">i</span></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-44"> (Ï†_x) _i ^ t </script>  - derivative <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-406"><span class="MJXp-mrow" id="MJXp-Span-407"><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-45"> Ï† </script>  space at point <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-409"><span class="MJXp-msubsup" id="MJXp-Span-410"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-411" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-412" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-46"> x_i </script>  .  In order to understand what difference scheme to use, direct or inverse, we will be based on the sign <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-413"><span class="MJXp-msubsup" id="MJXp-Span-414"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-415" style="margin-right: 0.05em;">u</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-416" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-47"> u_i </script>  at the point <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-417"><span class="MJXp-msubsup" id="MJXp-Span-418"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419" style="margin-right: 0.05em;">x</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-420" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-48"> x_i </script>  .  If a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-421"><span class="MJXp-msubsup" id="MJXp-Span-422"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-423" style="margin-right: 0.05em;">u</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-424" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-425" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-426">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-49"> u_i> 0 </script>  values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-427"><span class="MJXp-mrow" id="MJXp-Span-428"><span class="MJXp-mo" id="MJXp-Span-429" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-50-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-50"> Ï† </script>  move from left to right, and therefore you should use inverse difference schemes ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-430"><span class="MJXp-msubsup" id="MJXp-Span-431"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-434">âˆ’</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">x</span></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-51"> D_x ^ - </script>  in equations 7).  On the contrary, if <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-435"><span class="MJXp-msubsup" id="MJXp-Span-436"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-437" style="margin-right: 0.05em;">u</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-438" style="vertical-align: -0.4em;">i</span></span><span class="MJXp-mo" id="MJXp-Span-439" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-440">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-52"> u_i <0 </script>  then for approximation <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-441"><span class="MJXp-msubsup" id="MJXp-Span-442"><span class="MJXp-mrow" id="MJXp-Span-443" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-444" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-445" style="vertical-align: -0.4em;">x</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-53"> Ï†_x </script>  should use direct difference schemes ( <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-446"><span class="MJXp-msubsup" id="MJXp-Span-447"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-448" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-450">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-449">x</span></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-54-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-54"> D_x ^ + </script>  in equations 7).  It is this selection process of the approximation for the derivative <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-451"><span class="MJXp-mrow" id="MJXp-Span-452"><span class="MJXp-mo" id="MJXp-Span-453" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-55"> Ï† </script>  in space based on the sign <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-454"><span class="MJXp-msubsup" id="MJXp-Span-455"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-456" style="margin-right: 0.05em;">u</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-457" style="vertical-align: -0.4em;">i</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-56"> u_i </script>  , is known as <i><a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2585%25D0%25B5%25D0%25BC%25D0%25B0_%25D1%2581_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258F%25D0%25BC%25D0%25B8_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2582%25D0%25B8%25D0%25B2_%25D0%25BF%25D0%25BE%25D1%2582%25D0%25BE%25D0%25BA%25D0%25B0">flow calculation</a></i> . <br><br>  In the two-dimensional case to calculate <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-458"><span class="MJXp-mrow" id="MJXp-Span-459"><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-57"> Ï† </script>  we need the derivatives listed below.  It is worth mentioning that we make the assumption that the image is isotropic. <br><p><math> </math> $$ display $$ \ begin {matrix} D_x = \ frac {Ï†_ {i + 1, j} -Ï†_ {i-1, j}} 2 \ qquad D_x ^ + = \ frac {Ï†_ {i + 1, j } -Ï†_ {i, j}} 2 \ qquad D_x ^ - = \ frac {Ï†_ {i, j} -Ï†_ {i-1, j}} 2 \\ D_y = \ frac {Ï†_ {i, j + 1 } -Ï†_ {i, j-1}} 2 \ qquad D_y ^ + = \ frac {Ï†_ {i, j + 1} -Ï†_ {i, j}} 2 \ qquad D_y ^ - = \ frac {Ï†_ {i , j} -Ï†_ {i, j-1}} 2 \ end {matrix} \ qquad (7) $$ display $$ </p><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-621"><span class="MJXp-mrow" id="MJXp-Span-622"><span class="MJXp-mo" id="MJXp-Span-623" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-mrow" id="MJXp-Span-624"><span class="MJXp-mo" id="MJXp-Span-625" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-59-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-59"> âˆ‡Ï† </script>  approximated using the upwind scheme: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-626"><span class="MJXp-mrow" id="MJXp-Span-627"><span class="MJXp-mo" id="MJXp-Span-628" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-msubsup" id="MJXp-Span-629"><span class="MJXp-mrow" id="MJXp-Span-630" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-631" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-632" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-634">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-635">x</span></span></span><span class="MJXp-mo" id="MJXp-Span-636" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-637">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-638">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-639">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-641">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-642">n</span><span class="MJXp-mrow" id="MJXp-Span-643"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-644">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-646">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-647">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-649">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-650">x</span></span><span class="MJXp-mtext" id="MJXp-Span-651">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-655">t</span><span class="MJXp-mrow" id="MJXp-Span-656"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-657">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-659">x</span><span class="MJXp-mo" id="MJXp-Span-660" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-661"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-664">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-665" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-666">0</span><span class="MJXp-msubsup" id="MJXp-Span-667"><span class="MJXp-mo" id="MJXp-Span-668" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-669" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-670" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-671">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-672">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-673">x</span><span class="MJXp-mo" id="MJXp-Span-674" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-msubsup" id="MJXp-Span-676"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-677" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-679">âˆ’</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-678">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-680" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-681">0</span><span class="MJXp-msubsup" id="MJXp-Span-682"><span class="MJXp-mo" id="MJXp-Span-683" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-684" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-mspace" id="MJXp-Span-685" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-686">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-687">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-688">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-689">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-690">t</span><span class="MJXp-mrow" id="MJXp-Span-691"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-693">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-694">x</span><span class="MJXp-mo" id="MJXp-Span-695" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-696"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-697" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-699">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-698">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-700" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-701">0</span><span class="MJXp-msubsup" id="MJXp-Span-702"><span class="MJXp-mo" id="MJXp-Span-703" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-704" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-705" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-707">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-708">x</span><span class="MJXp-mo" id="MJXp-Span-709" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-710" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-msubsup" id="MJXp-Span-711"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-712" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-714">âˆ’</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-713">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-715" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-716">0</span><span class="MJXp-msubsup" id="MJXp-Span-717"><span class="MJXp-mo" id="MJXp-Span-718" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-719" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-mtext" id="MJXp-Span-720">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-721">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-723">d</span><span class="MJXp-mrow" id="MJXp-Span-724"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-725">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-726">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-727">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-729">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-731">x</span></span><span class="MJXp-mtext" id="MJXp-Span-732">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-733">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-735">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-736">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-737">d</span><span class="MJXp-mo" id="MJXp-Span-738" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-739">8</span><span class="MJXp-mo" id="MJXp-Span-740" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-60-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-60"> âˆ‡Ï†_ {max} = \ begin {bmatrix} \ sqrt {max (D_x ^ +, 0) ^ 2 + max (-D_x ^ -, 0) ^ 2} \\ \ sqrt {max (D_y ^ +, 0 ) ^ 2 + max (-D_y ^ -, 0) ^ 2} \ end {bmatrix} \ qquad (8) </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-741"><span class="MJXp-mrow" id="MJXp-Span-742"><span class="MJXp-mo" id="MJXp-Span-743" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-msubsup" id="MJXp-Span-744"><span class="MJXp-mrow" id="MJXp-Span-745" style="margin-right: 0.05em;"><span class="MJXp-mo" id="MJXp-Span-746" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-747" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-748">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-750">n</span></span></span><span class="MJXp-mo" id="MJXp-Span-751" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-752">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-753">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-754">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-755">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-757">n</span><span class="MJXp-mrow" id="MJXp-Span-758"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-759">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-761">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-762">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-763">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-764">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-765">x</span></span><span class="MJXp-mtext" id="MJXp-Span-766">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-767">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-769">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-770">t</span><span class="MJXp-mrow" id="MJXp-Span-771"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-772">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-773">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-774">n</span><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-776"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-777" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-779">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-778">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-780" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-781">0</span><span class="MJXp-msubsup" id="MJXp-Span-782"><span class="MJXp-mo" id="MJXp-Span-783" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-784" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-785" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-786">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-787">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-788">n</span><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-790" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-msubsup" id="MJXp-Span-791"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-792" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-794">âˆ’</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-793">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-795" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-796">0</span><span class="MJXp-msubsup" id="MJXp-Span-797"><span class="MJXp-mo" id="MJXp-Span-798" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-799" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-mspace" id="MJXp-Span-800" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-801">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-802">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-803">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-804">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-805">t</span><span class="MJXp-mrow" id="MJXp-Span-806"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-807">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-808">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-809">n</span><span class="MJXp-mo" id="MJXp-Span-810" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-811"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-812" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-814">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-813">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-815" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-816">0</span><span class="MJXp-msubsup" id="MJXp-Span-817"><span class="MJXp-mo" id="MJXp-Span-818" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-819" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-820" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-821">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-822">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-823">n</span><span class="MJXp-mo" id="MJXp-Span-824" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-825" style="margin-left: 0.267em; margin-right: 0.267em;">âˆ’</span><span class="MJXp-msubsup" id="MJXp-Span-826"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-827" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-829">âˆ’</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-828">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-830" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mn" id="MJXp-Span-831">0</span><span class="MJXp-msubsup" id="MJXp-Span-832"><span class="MJXp-mo" id="MJXp-Span-833" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-834" style="vertical-align: 0.5em;">2</span></span></span><span class="MJXp-mtext" id="MJXp-Span-835">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-836">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-837">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-838">d</span><span class="MJXp-mrow" id="MJXp-Span-839"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-840">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-841">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-842">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-843">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-844">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-845">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-846">x</span></span><span class="MJXp-mtext" id="MJXp-Span-847">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-848">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-849">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-850">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-851">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-852">d</span><span class="MJXp-mo" id="MJXp-Span-853" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-854">9</span><span class="MJXp-mo" id="MJXp-Span-855" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-61-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-61"> âˆ‡Ï†_ {min} = \ begin {bmatrix} \ sqrt {min (D_x ^ +, 0) ^ 2 + min (-D_x ^ -, 0) ^ 2} \\ \ sqrt {min (D_y ^ +, 0 ) ^ 2 + min (-D_y ^ -, 0) ^ 2} \ end {bmatrix} \ qquad (9) </script></p><br>  Finally, depending on whether <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-856"><span class="MJXp-msubsup" id="MJXp-Span-857"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-858" style="margin-right: 0.05em;">F</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-859" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-860">i</span><span class="MJXp-mo" id="MJXp-Span-861">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-862">j</span><span class="MJXp-mo" id="MJXp-Span-863">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-864">k</span></span></span><span class="MJXp-mo" id="MJXp-Span-865" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mn" id="MJXp-Span-866">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-62-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-62"> F_ {i, j, k}> 0 </script>  or <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-867"><span class="MJXp-msubsup" id="MJXp-Span-868"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-869" style="margin-right: 0.05em;">F</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-870" style="vertical-align: -0.4em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-871">i</span><span class="MJXp-mo" id="MJXp-Span-872">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-873">j</span><span class="MJXp-mo" id="MJXp-Span-874">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-875">k</span></span></span><span class="MJXp-mo" id="MJXp-Span-876" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mn" id="MJXp-Span-877">0</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-63-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-63"> F_ {i, j, k} <0 </script>  , <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-878"><span class="MJXp-mrow" id="MJXp-Span-879"><span class="MJXp-mo" id="MJXp-Span-880" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-mrow" id="MJXp-Span-881"><span class="MJXp-mo" id="MJXp-Span-882" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-64-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-64"> âˆ‡Ï† </script>  It seems like: <br><p><math> </math> $$ display $$ âˆ‡Ï† = \ begin {cases} â€–âˆ‡Ï†_ {max} â€–_2 &amp; \ quad \ text {if} F_ {i, j, k}&gt; 0 \\ Ï†_ {min} _2 &amp; \ quad \ text {if} F_ {i, j, k} &lt;0 \\ \ end {cases} \ qquad (10) $$ display $$ </p><br><p><math> </math> $$ display $$ Ï† (t + Î”t) = Ï† (t) + Î”tF | âˆ‡Ï† | \ qquad (11) $$ display $$ </p><br>  The velocity factor F, as previously discussed, is based on pixel intensity values â€‹â€‹and curvature values. <br><br><h4>  Curvature </h4><br>  We will calculate it on the basis of the values â€‹â€‹of the current level, established using the following derivatives.  In two dimensions only <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-988"><span class="MJXp-msubsup" id="MJXp-Span-989"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-990" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-992"><span class="MJXp-mo" id="MJXp-Span-993">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-994">y</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-991">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-995" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-996"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-997" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-999"><span class="MJXp-mo" id="MJXp-Span-1000">âˆ’</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1001">y</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-998">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1002" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1003"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1004" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1006"><span class="MJXp-mo" id="MJXp-Span-1007">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1008">x</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1005">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1009" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-msubsup" id="MJXp-Span-1010"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1011" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1013"><span class="MJXp-mo" id="MJXp-Span-1014">âˆ’</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1015">x</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1012">y</span></span></span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-67-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-67"> D_x ^ {+ y}, D_x ^ {- y}, D_y ^ {+ x}, D_y ^ {- x} </script>  , along with previously defined derivatives: <br><br><p><math> </math> $$ display $$ \ begin {matrix} D_x ^ {+ y} = \ frac {(Ï†_ {i + 1, j + 1} -Ï†_ {i-1, j + 1})} 2 \ qquad D_x ^ { -y} = \ frac {(Ï†_ {i + 1, j-1} -Ï†_ {i-1, j-1})} 2 \\ D_y ^ {+ x} = \ frac {(Ï†_ {i + 1 , j + 1} -Ï†_ {i + 1, j-1})} 2 \ qquad D_y ^ {- x} = \ frac {(Ï†_ {i-1, j + 1} -Ï†_ {i-1, j -1})} 2 \ end {matrix} \ qquad (12) $$ display $$ </p><br><br>  Using the normal difference, the curvature is calculated using the above derivatives with two normals. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1164"><span class="MJXp-msubsup" id="MJXp-Span-1165"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1166" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1167" style="vertical-align: 0.5em;">+</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-69-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-69"> n ^ + </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1168"><span class="MJXp-msubsup" id="MJXp-Span-1169"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1170" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1171" style="vertical-align: 0.5em;">âˆ’</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-70-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-70"> n ^ - </script>  . <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1172"><span class="MJXp-msubsup" id="MJXp-Span-1173"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1174" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1175" style="vertical-align: 0.5em;">+</span></span><span class="MJXp-mo" id="MJXp-Span-1176" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-1177">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1178">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1179">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1180">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1181">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1182">n</span><span class="MJXp-mrow" id="MJXp-Span-1183"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1184">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1185">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1186">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1187">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1188">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1189">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1190">x</span></span><span class="MJXp-mtext" id="MJXp-Span-1191">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1192">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1193">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1194">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1195">c</span><span class="MJXp-mrow" id="MJXp-Span-1196"><span class="MJXp-msubsup" id="MJXp-Span-1197"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1198" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1200">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1199">x</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1201"><span class="MJXp-mtext" id="MJXp-Span-1202">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1203">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1204">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1205">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1206">t</span><span class="MJXp-mrow" id="MJXp-Span-1207"><span class="MJXp-mo" id="MJXp-Span-1208" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1209"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1210" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1212">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1211">x</span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1213"><span class="MJXp-mo" id="MJXp-Span-1214" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1215" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1216" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1217" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-1218">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1219">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1220">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1221">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1222">c</span><span class="MJXp-mrow" id="MJXp-Span-1223"><span class="MJXp-msubsup" id="MJXp-Span-1224"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1225" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1227"><span class="MJXp-mo" id="MJXp-Span-1228">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1229">x</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1226">y</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1230" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1231"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1232" style="margin-right: 0.05em;">D</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1233" style="vertical-align: -0.4em;">y</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1234"><span class="MJXp-mn" id="MJXp-Span-1235">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-1236"><span class="MJXp-mo" id="MJXp-Span-1237" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1238" style="vertical-align: 0.5em;">2</span></span></span></span><span class="MJXp-mspace" id="MJXp-Span-1239" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-1240">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1241">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1242">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1243">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1244">c</span><span class="MJXp-mrow" id="MJXp-Span-1245"><span class="MJXp-msubsup" id="MJXp-Span-1246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1247" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1249">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1248">y</span></span></span></span></span></span></span><span class="MJXp-mrow" id="MJXp-Span-1250"><span class="MJXp-mtext" id="MJXp-Span-1251">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1252">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1253">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1254">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1255">t</span><span class="MJXp-mrow" id="MJXp-Span-1256"><span class="MJXp-mo" id="MJXp-Span-1257" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-1258"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1259" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mo" id="MJXp-Span-1261">+</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1260">y</span></span></span></span></span></span><span class="MJXp-msubsup" id="MJXp-Span-1262"><span class="MJXp-mo" id="MJXp-Span-1263" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1264" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-1265" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mo" id="MJXp-Span-1266" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-1267">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1268">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1269">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1270">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1271">c</span><span class="MJXp-mrow" id="MJXp-Span-1272"><span class="MJXp-msubsup" id="MJXp-Span-1273"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1274" style="margin-right: 0.05em;">D</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mrow" id="MJXp-Span-1276"><span class="MJXp-mo" id="MJXp-Span-1277">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1278">y</span></span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1275">x</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-1279" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-1280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1281" style="margin-right: 0.05em;">D</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-1282" style="vertical-align: -0.4em;">x</span></span></span><span class="MJXp-mrow" id="MJXp-Span-1283"><span class="MJXp-mn" id="MJXp-Span-1284">2</span></span><span class="MJXp-msubsup" id="MJXp-Span-1285"><span class="MJXp-mo" id="MJXp-Span-1286" style="margin-left: 0em; margin-right: 0.05em;">)</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-1287" style="vertical-align: 0.5em;">2</span></span></span></span><span class="MJXp-mspace" id="MJXp-Span-1288" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-1289">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1290">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1291">n</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1292">d</span><span class="MJXp-mrow" id="MJXp-Span-1293"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1294">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1295">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1296">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1297">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1298">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1299">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1300">x</span></span><span class="MJXp-mtext" id="MJXp-Span-1301">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1302">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1303">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1304">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1305">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1306">d</span><span class="MJXp-mo" id="MJXp-Span-1307" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1308">13</span><span class="MJXp-mo" id="MJXp-Span-1309" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-71-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-71"> n ^ + = \ begin {bmatrix} \ frac {D_x ^ +} {\ sqrt {(D_x ^ +) ^ 2 + (\ frac {D_y ^ {+ x} + D_y} {2}) ^ 2}} \\ \ frac {D_y ^ +} {\ sqrt {(D_y ^ +) ^ 2 + (\ frac {D_x ^ {+ y} + D_x} {2}) ^ 2}} \\ \ end {bmatrix} \ qquad (13) </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1310"><span class="noError" id="MJXp-Span-1311" style="display: inline-block;">n&nbsp;^&nbsp;-&nbsp;=&nbsp;\&nbsp;begin&nbsp;{bmatrix}&nbsp;\&nbsp;frac&nbsp;{D_x&nbsp;^&nbsp;-}&nbsp;{\&nbsp;sqrt&nbsp;{(D_x&nbsp;^&nbsp;-)&nbsp;^&nbsp;2&nbsp;+&nbsp;(\&nbsp;frac&nbsp;{D_y&nbsp;^&nbsp;{-&nbsp;x}&nbsp;+&nbsp;D_y}&nbsp;{2})&nbsp;^&nbsp;2}}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{D_y&nbsp;^&nbsp;-}&nbsp;{\&nbsp;sqrt&nbsp;{(D_y&nbsp;^&nbsp;-)&nbsp;^&nbsp;2&nbsp;+&nbsp;(\&nbsp;frac&nbsp;{D_x&nbsp;^&nbsp;{-&nbsp;y}&nbsp;+&nbsp;D_x}&nbsp;{2})&nbsp;^&nbsp;2}&nbsp;\&nbsp;\&nbsp;end&nbsp;{bmatrix}&nbsp;\&nbsp;qquad&nbsp;(14)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-72-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-72"> n ^ - = \ begin {bmatrix} \ frac {D_x ^ -} {\ sqrt {(D_x ^ -) ^ 2 + (\ frac {D_y ^ {- x} + D_y} {2}) ^ 2}} \\ \ frac {D_y ^ -} {\ sqrt {(D_y ^ -) ^ 2 + (\ frac {D_x ^ {- y} + D_x} {2}) ^ 2} \ \ end {bmatrix} \ qquad (14) </script></p><br>  Two normals are used to calculate the divergence, with which we calculate the mean curvature, as shown below: <p><math> </math> $$ display $$ H = \ frac {1} {2} âˆ‡ \ cdot \ frac {âˆ‡Ï†} {| âˆ‡Ï† |} = \ frac {1} {2} ((n_x ^ + - n_x ^ -) + (n_y ^ + - n_y ^ -)) \ qquad (15) $$ display $$ </p><br><h4>  Resilience </h4><br>  Stability arises from the Courant-Friedrichs-Levy (CFL) condition, which states that the speed of information in a computational scheme must be such that during <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1367"><span class="MJXp-mo" id="MJXp-Span-1368" style="margin-left: 0.222em; margin-right: 0.222em;">âˆ†</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1369">t</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-74-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-74"> âˆ†t </script>  you do not go beyond a single cell, that is <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1370"><span class="MJXp-mtext" id="MJXp-Span-1371">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1372">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1373">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1374">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1375">c</span><span class="MJXp-mrow" id="MJXp-Span-1376"><span class="MJXp-mo" id="MJXp-Span-1377" style="margin-left: 0.222em; margin-right: 0.222em;">âˆ†</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1378">x</span></span><span class="MJXp-mrow" id="MJXp-Span-1379"><span class="MJXp-mo" id="MJXp-Span-1380" style="margin-left: 0.222em; margin-right: 0.222em;">âˆ†</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1381">t</span></span><span class="MJXp-mo" id="MJXp-Span-1382" style="margin-left: 0.333em; margin-right: 0.333em;">&gt;</span><span class="MJXp-mrow" id="MJXp-Span-1383"><span class="MJXp-mo" id="MJXp-Span-1384" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1385">u</span><span class="MJXp-mrow" id="MJXp-Span-1386"><span class="MJXp-mo" id="MJXp-Span-1387" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-75-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-75"> \ frac {âˆ†x} {âˆ†t}> | u | </script>  .  We have: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1388"><span class="MJXp-mo" id="MJXp-Span-1389" style="margin-left: 0.222em; margin-right: 0.222em;">âˆ†</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1390">t</span><span class="MJXp-mo" id="MJXp-Span-1391" style="margin-left: 0.333em; margin-right: 0.333em;">&lt;</span><span class="MJXp-mtext" id="MJXp-Span-1392">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1393">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1394">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1395">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1396">c</span><span class="MJXp-mrow" id="MJXp-Span-1397"><span class="MJXp-mo" id="MJXp-Span-1398" style="margin-left: 0.222em; margin-right: 0.222em;">âˆ†</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1399">x</span></span><span class="MJXp-mrow" id="MJXp-Span-1400"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1401">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1402">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1403">x</span><span class="MJXp-mrow" id="MJXp-Span-1404"><span class="MJXp-mrow" id="MJXp-Span-1405"><span class="MJXp-mo" id="MJXp-Span-1406" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1407">u</span><span class="MJXp-mrow" id="MJXp-Span-1408"><span class="MJXp-mo" id="MJXp-Span-1409" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-1410">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1411">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1412">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1413">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1414">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1415">d</span><span class="MJXp-mo" id="MJXp-Span-1416" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-1417">16</span><span class="MJXp-mo" id="MJXp-Span-1418" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-76-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-76"> âˆ†t <\ frac {âˆ†x} {max {| u |}} \ qquad (16) </script></p><br><h3>  Sequential implementation </h3><br>  We implement this binary segmentation algorithm in the Matlab system.  Let's do this, first of all, for clarity, since Matlab does an excellent job with working with tables.  Also there are very simple functions that allow you to read images and display the work of the algorithm on the screen.  Thanks to this, the code will be compressed and understandable.  <i>Naturally, implementation, for example on C will be much more profitable in terms of speed.</i>  <i>But in this article we do not pursue speed, but try to understand the method.</i> <br><br>  The pseudocode of the algorithm can be seen below: <br><br><ul><li>  Input: Original image I;  initial mask m;  threshold t;  error Îµ;  number of iterations N;  a number indicating how many iterations we recalculate the distance map, ITS. </li><li>  Output: The result of the segmentation is the seg image. <br>  Initialize the Ï†_0 with the Signed Euclidean Distance Transform (SEDT) and the m mask. <br>  Calculate D (I) = Îµ- | IT |. </li><li>  Cycle i from 1 to N <br><ul><li>  Calculate first order derivatives </li><li>  Calculate second order derivatives </li><li>  Calculate normal values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1419"><span class="MJXp-msubsup" id="MJXp-Span-1420"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1421" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1422" style="vertical-align: 0.5em;">+</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-77-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-77"> n ^ + </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1423"><span class="MJXp-msubsup" id="MJXp-Span-1424"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1425" style="margin-right: 0.05em;">n</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-1426" style="vertical-align: 0.5em;">âˆ’</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-78-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-78"> n ^ - </script></li><li>  Calculate the value of the gradient <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1427"><span class="MJXp-mrow" id="MJXp-Span-1428"><span class="MJXp-mo" id="MJXp-Span-1429" style="margin-left: 0.167em; margin-right: 0.111em;">âˆ‡</span></span><span class="MJXp-mrow" id="MJXp-Span-1430"><span class="MJXp-mo" id="MJXp-Span-1431" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-79-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-79"> âˆ‡Ï† </script></li><li>  Calculate the value of the function <math> </math> $ inline $ F = Î±D (I) + (1-Î±) âˆ‡ \ cdot \ frac {âˆ‡Ï†} {| âˆ‡Ï† |} $ inline $ </li><li>  Update level feature <math> </math> $ inline $ Ï† (t + Î”t) = Ï† (t) + Î”t \ cdot F \ cdot | âˆ‡Ï† | $ inline $ </li><li> If <code>i % ITS == 0</code> then <br>  Reinitialize <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1493"><span class="MJXp-mrow" id="MJXp-Span-1494"><span class="MJXp-mo" id="MJXp-Span-1495" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-82-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-82"> Ï† </script>  using sedt <br>  End if </li></ul><br>  End of cycle </li></ul><br>  Let's start with the fact that we choose the format of images with which we will work.  The PGM format was very convenient.  This is an open format for storing bitmap bitmap images without compression in grayscale.  It has a simple ASCII header, and the image itself is a sequence of single-byte (for shades of gray from 0 to 255) unsigned integers.  More information about the format you can read directly in the standard itself, the link is given in the sources section. <br><br>  We divide our code into two parts: the â€œlauncherâ€ and the â€œcoreâ€ in order to separate the initialization and update code of the level set.  The first file handles the download and reduces the image resolution using the imread and imresize functions.  User sets parameters for threshold values. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1496"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1497">T</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-83-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-83"> T </script>  range <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1498"><span class="MJXp-mrow" id="MJXp-Span-1499"><span class="MJXp-mo" id="MJXp-Span-1500" style="margin-left: 0em; margin-right: 0em;">Îµ</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-84-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-84"> Îµ </script>  and curvature weighting <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1501"><span class="MJXp-mtext" id="MJXp-Span-1502">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1503">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1504">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1505">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1506">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1507">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-85-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-85"> \ alpha </script>  , launches the launcher and then proceeds to draw a closed polygon that will form the initial mask (providing some basic interactivity). <br><br>  So, we read the image and immediately create a zero matrix. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1508"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1509">m</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-86-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-86"> m </script>  which will be our mask: <br><br><pre> <code class="matlab hljs">I = imread(<span class="hljs-string"><span class="hljs-string">'test_output.pgm'</span></span>); I = imresize(I, <span class="hljs-number"><span class="hljs-number">1</span></span>); init_mask = <span class="hljs-built_in"><span class="hljs-built_in">zeros</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(I,<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-built_in"><span class="hljs-built_in">size</span></span>(I,<span class="hljs-number"><span class="hljs-number">2</span></span>));</code> </pre><br>  To create a mask, it is convenient to choose the coordinates of the center and deviations from it.  Get a rectangle filled with units.  We will transfer it to the core. <br><br><pre> <code class="matlab hljs">x = <span class="hljs-number"><span class="hljs-number">400</span></span>; y = <span class="hljs-number"><span class="hljs-number">800</span></span>; <span class="hljs-comment"><span class="hljs-comment">%   dx = 10; dy = 10; init_mask(y - dy : y + dy, x - dx : x + dx) = 1; %  seg = simpleseg(I, init_mask, max_its, E, T); %  </span></span></code> </pre><br>  Now consider the function <code>simpleseg</code> , which is the core of the code.  First you need to get the SDF from the <code>init_mask</code> mask: <br><br><pre> <code class="matlab hljs">phi = mask2phi(init_mask); <span class="hljs-comment"><span class="hljs-comment">% SDF function phi = mask2phi(init_a) %  SDF phi=bwdist(init_a)-bwdist(1-init_a);</span></span></code> </pre><br>  Let's write a function that will calculate the curvature: <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%  function curvature = get_curvature(phi) dx = (shiftR(phi)-shiftL(phi))/2; dy = (shiftU(phi)-shiftD(phi))/2; dxplus = shiftR(phi)-phi; dyplus = shiftU(phi)-phi; dxminus = phi-shiftL(phi); dyminus = phi-shiftD(phi); dxplusy = (shiftU(shiftR(phi))-shiftU(shiftL(phi)))/2; dxminusy = (shiftD(shiftR(phi))-shiftD(shiftL(phi)))/2; dyplusx = (shiftR(shiftU(phi))-shiftR(shiftD(phi)))/2; dyminusx = (shiftL(shiftU(phi))-shiftL(shiftD(phi)))/2; nplusx = dxplus./sqrt(eps+(dxplus.^2 )+((dyplusx+dy )/2).^2); nplusy = dyplus./sqrt(eps+(dyplus.^2 )+((dxplusy+dx )/2).^2); nminusx= dxminus./sqrt(eps+(dxminus.^2)+((dyminusx+dy)/2).^2); nminusy= dyminus./sqrt(eps+(dyminus.^2)+((dxminusy+dx)/2).^2); curvature = ((nplusx-nminusx)+(nplusy-nminusy))/2;</span></span></code> </pre><br>  Derivatives are calculated by subtracting the shifted matrices of the function. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1510"><span class="MJXp-mrow" id="MJXp-Span-1511"><span class="MJXp-mo" id="MJXp-Span-1512" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-87-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-87"> Ï† </script>  .  Note that derivatives are not calculated elementwise, as this would be less efficient. <br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%--       function shift = shiftD(M) shift = shiftR(M')'; function shift = shiftL(M) shift = [ M(:,2:size(M,2)) M(:,size(M,2))]; function shift = shiftR(M) shift = [M(:,1) M(:,1:size(M,2)-1)]; function shift = shiftU(M) shift = shiftL(M')';</span></span></code> </pre><br>  Now consider the rate factor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1513"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-1514">F</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-88-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-88"> F </script><br><br><pre> <code class="matlab hljs"> alpha=<span class="hljs-number"><span class="hljs-number">0.5</span></span>; D = E - <span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(I - T); K = get_curvature(phi); F = alpha*single(D) + (<span class="hljs-number"><span class="hljs-number">1</span></span>-alpha)*K;</code> </pre><br>  Then go to the upgrade levels.  To do this, we first calculate the gradient to maintain stability: <br><br><pre> <code class="matlab hljs">dxplus = shiftR(phi)-phi; dyplus = shiftU(phi)-phi; dxminus = phi-shiftL(phi); dyminus = phi-shiftD(phi); gradphimax_x = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(dxplus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(-dxminus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>); gradphimin_x = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(dxplus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(-dxminus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>); gradphimax_y = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(dyplus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(-dyminus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>); gradphimin_y = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(dyplus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>+<span class="hljs-built_in"><span class="hljs-built_in">min</span></span>(-dyminus,<span class="hljs-number"><span class="hljs-number">0</span></span>).^<span class="hljs-number"><span class="hljs-number">2</span></span>); gradphimax = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>((gradphimax_x.^<span class="hljs-number"><span class="hljs-number">2</span></span>)+(gradphimax_y.^<span class="hljs-number"><span class="hljs-number">2</span></span>)); gradphimin = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>((gradphimin_x.^<span class="hljs-number"><span class="hljs-number">2</span></span>)+(gradphimin_y.^<span class="hljs-number"><span class="hljs-number">2</span></span>)); gradphi = (F&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>).*(gradphimax) + (F&lt;<span class="hljs-number"><span class="hljs-number">0</span></span>).*(gradphimin); dt = <span class="hljs-number"><span class="hljs-number">.5</span></span>/<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(F.*gradphi))));</code> </pre><br>  And change the function set of levels <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1515"><span class="MJXp-mrow" id="MJXp-Span-1516"><span class="MJXp-mo" id="MJXp-Span-1517" style="margin-left: 0em; margin-right: 0em;">Ï†</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-89-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-89"> Ï† </script>  : <br><br><pre> <code class="matlab hljs">phi = phi + dt.*(F).*gradphi;</code> </pre><br>  We will display the intermediate result on the screen every 20 iterations: <br><br><pre> <code class="matlab hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">mod</span></span>(its,<span class="hljs-number"><span class="hljs-number">20</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) showcontour(I,phi,its); subplot(<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>); surf(phi); shading flat; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Using the <code>showcontour</code> function: <br><br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showcontour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I, phi, i)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subplot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2, 2, 3)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">('Evolution')</span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imshow</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hold</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contour</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(phi, [0 0],'g','LineWidth', 2)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hold</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">off</span></span></span><span class="hljs-function"> ; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">title</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">([num2str(i)</span></span></span><span class="hljs-function"> '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Iterations</span></span></span><span class="hljs-function">'] ); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawnow</span></span></span><span class="hljs-function">;</span></span></code> </pre><br><h3>  results </h3><br>  I carried out algorithm tests on two types of images: <i>medical</i> and <i>images of rocks</i> (since I solved this problem on a diploma). <br><br>  For medical images, it works like this: <br><br><img src="https://habrastorage.org/web/504/5a3/b85/5045a3b85bc34a3184f237034b32d152.jpg"><br><br>  We see that the algorithm copes very well with this task. <br><br>  <font color="#999999"><i>It is worth saying that this algorithm can be implemented for the three-dimensional case.</i></font>  <font color="#999999"><i>In this article I will not describe the features, but I will show how it works:</i></font> <br><br><img src="https://habrastorage.org/web/c26/fcc/b54/c26fccb54b714c9ca36f0495ba2b33dc.jpg"><br>  <font color="#999999"><i>In this case, the initial mask is a cube (in general, of course, it is any three-dimensional body)</i></font> <br><br>  In the segmentation of images of rocks in the first place you encounter the problem of noise.  This is due to many reasons: starting from the inaccuracy of tomographs, ending with errors in the inverse Radon transform (this is how such images are obtained).  That is why you first need to filter the image.  The Peron and Malik anisotropic diffusion filter copes with this very well.  The link to the article about this filter was already at the beginning of the article.  Leave it at the end of the post. <br><br>  This is what happens if you segment a noisy image: <br><br><img src="https://habrastorage.org/web/909/2ab/724/9092ab72425644d1a668241a7631b497.jpg" width="700" height="350"><br><br>  But what with the filtered image: <br><br><img src="https://habrastorage.org/web/eba/319/8a9/eba3198a901344b29e7917c844fc8194.png" width="700" height="350"><br><br><h3>  Conclusions and further work </h3><br>  The level fixation method is an excellent method for performing binary segmentation.  Its main disadvantage is a large computational complexity.  The time it took for Matlab to process an image of 512x512 on my machine (5000 iterations were performed) is 2737.84 seconds (45 minutes).  This, of course, is incredibly much. <br><br>  But do not close the article after reading this fact.  The most important reason for me choosing this algorithm was that it is very well parallel.  I did this with the help of CUDA, you can use something else and write about it, for example, in the comments.  If someone is interested, in the future I will write the following article on the parallelization of this algorithm. <br><br>  PS Here are links to source codes: the <a href="https://gist.github.com/22dla/95dfa5f1248f960c1b67b893e5200786">start file</a> and the <a href="https://gist.github.com/22dla/34aff5341d2d7a238d272975ae1d2845">function that is directly responsible for the segmentation</a> . <br><br><h3>  Sources </h3><br><ol><li>  <a href="https://en.wikipedia.org/wiki/Level_set_method">Wikipedia article on method</a> </li><li>  <a href="https://habrahabr.ru/post/331618/%255Biz-pesochnitsy%255D-sglazhivanie-izobrazheniy-f/">Filter article</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/332692/">https://habr.com/ru/post/332692/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../332682/index.html">Oracle Data Integrator. SubstitutionAPI: The order of the substitutions. Part 1</a></li>
<li><a href="../332684/index.html">Vulnerability VKontakte: send a message with the page recovery code to someone else's number</a></li>
<li><a href="../332686/index.html">Meet Apache BookKeeper - a replicable log service</a></li>
<li><a href="../332688/index.html">Lecture about two libraries of Yandex for working with big data</a></li>
<li><a href="../332690/index.html">Automation IP-network. Part 2 - Monitoring the speed of opening Web pages</a></li>
<li><a href="../332694/index.html">Configuring BGP Looking glass based on OpenBSD 6.1</a></li>
<li><a href="../332698/index.html">The digest of interesting materials for the mobile developer # 211 (July 03 - July 09)</a></li>
<li><a href="../332700/index.html">Quotes program data collection</a></li>
<li><a href="../332704/index.html">Announcement Heisenbag 2017 Moscow: Double the Benefit</a></li>
<li><a href="../332706/index.html">Translation of the Appium Essentials book. Chapter 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>