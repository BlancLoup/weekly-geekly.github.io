<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization optimization</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing the theme of client optimization merge resources . 

 As was shown earlier, it is advantageous to divide resources into two groups: ‚Äúcore‚Äù ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization optimization</h1><div class="post__text post__text-html js-mediator-article">  Continuing the theme of client optimization <a href="http://habrahabr.ru/blogs/webdev/29937/">merge resources</a> . <br><br>  As was shown earlier, it is advantageous to divide resources into two groups: ‚Äúcore‚Äù (loaded on all pages) and ‚Äúpage resources‚Äù (loaded only on pages that use them).  The problem is the choice of resources that should be included in the kernel - too large kernel can significantly increase the time of initial loading of the site. <br><br>  There are three main types of page access: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. bootstrap (both the kernel and the resources of the selected page are loaded) <br>  2. loading a new page (the kernel is in the cache, the resources of the selected page are loaded) <br>  3. loading the old page (both the kernel and page resources are in the cache). <br><br>  In the third case, we cannot influence the download speed.  In addition, to speed up the initial load, it is advantageous to reduce the volume of the core, so optimizing the case (1) worsens the boot time in case (2) and vice versa.  What to do? <br><br><a name="habracut"></a><br><br>  <a href="http://bkon.ru/apache2-default/optimization.pdf">PDF formulas</a> <br><br>  We use the following notation: <br><br><ul><li>  n_p - the number of pages; </li><li>  n_r - the number of resources; </li><li>  l is the value of the network delay; </li><li>  1_r is a column vector of length n_r, containing only one; </li><li>  1_p is a vector line of length n_p containing only one; </li><li>  d - data transfer time; </li><li>  a is a column vector of length n_r.  The i-th element of this column corresponds to the i-th resource.  In the event that an element is zero, the resource is included in the kernel, and otherwise in the page resources; </li><li>  B - a matrix of resource ownership pages.  The columns correspond to the resources, the lines to the pages: b_ {ij} = 1, if page i uses resource j; </li><li>  S is the diagonal matrix of resource weights (s_ {ii} - resource weight i); </li><li>  p_1, p_2 is a line vector of page selection probability in the first and second cases. </li></ul><br><br>  Denote the ratio of the number of cases (1) to the total number of cases (1) and (2) as p_r (this value can be calculated from the web server logs or use the estimate 1 / n_p. <br><br>  Denote the probability of choosing page i and its loading time as p_ {1i} and t_ {1i} in the first case and p_ {2i} and t_ {2i} in the second. <br>  (p_ {1i} and p_ {2i} can be calculated by the web server logs).  We get that the expectation of the resource load time of an arbitrary page. <br><br>  M = \ sum_i (p_r t_ {1i} p_ {1i} + (1 - p_r) t_ {2i} p_ {2i}). <br><br>  In our case, t consists of two parts: network delay l (in which we include [almost] fixed time costs, such as the time to establish a connection, send an HTTP request and receive response headers) and data transfer time d.  When splitting resources into the core (index c) and page resources (index p), we get that <br><br>  t_1i = l_ {ci} + l_ {pi} + d_ {ci} + d_ {pi}, <br>  t_2i = l_ {pi} + d_ {pi}. <br><br>  Since kernel resources are shared across all pages. <br><br>  l_ {ci} = l_ {c} = const <br>  d_ {ci} = d_ {c} - does not depend on the page <br><br>  In addition, l_ {pi} = l_ {p} = const, since all page resources are combined together.  We get that <br><br>  M = \ sum_i (p_r p_ {1i} (l_ {c} + l_ {p} + d_ {c} + d_ {pi}) + (1 - p_r) p_ {2i} (l_ {p} + d_ {pi })) = <br>  = p_r (l_ {c} + l_ {p}) + (1 - p_r) l_ {p} + <br>  + p_r dd_ {c} + <br>  + \ sum_i (p_r p_ {1i} d_ {pi}) + (1 - p_r) p_ {2i} d_ {pi}) <br><br>  We cannot change l, so we have to minimize the expression <br><br>  p_r d_ {c} + \ sum_i (p_r p_ {1i} d_ {pi}) + (1 - p_r) p_ {2i} d_ {pi} <br><br>  The value of d is obviously proportional to the size of the resource s (fortunately, the resources do not affect the download speed of each other): <br><br>  M ~ p_r s_ {c} + \ sum_i (p_r p_ {1i} s_ {pi}) + (1 - p_r) p_ {2i} (s_ {pi}) <br><br>  Writing the expression in the matrix form, we get: <br><br>  p_r 1_r ^ t S (1_r - a) + p_r p_1 BS a + (1 - p_r) p_2 BS a = <br>  = p_r 1_r ^ t S 1_r + (p_r p_1 B + (1 - p_r) p_2 B - p_r 1_r ^ t) S a <br><br>  Obviously, the term p_r 1_r ^ t S 1_r is constant.  Thus, the final expression, which we must minimize: <br><br>  (p_r p_1 B + (1 - p_r) p_2 B - p_r 1_r ^ t) S a = ca <br><br>  The value (p_r p_1 B + (1 - p_r) p_2 B - p_r 1_r ^ t) S can be calculated, since it does not contain unknowns.  The result will be a row vector c.  Since a by definition can contain only zeros and ones, the task becomes trivial: a_i = 1 if c_i &lt;= 0. </div><p>Source: <a href="https://habr.com/ru/post/42767/">https://habr.com/ru/post/42767/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../42766/index.html">Smile Coffee Cups</a></li>
<li><a href="../427661/index.html">Sportiduino - the system of electronic mark for sports, part 3</a></li>
<li><a href="../427663/index.html">Frog bears and crab</a></li>
<li><a href="../427665/index.html">The best smart scales (according to Wareable)</a></li>
<li><a href="../427669/index.html">KNX home control: lighting</a></li>
<li><a href="../427671/index.html">Sberbank and Yandex officially launched the Beru marketplace, the Russian version of Amazon</a></li>
<li><a href="../427673/index.html">Machine learning @ booking.com</a></li>
<li><a href="../427675/index.html">Papers, please. How a neuronet helps us check clients and catch scammers</a></li>
<li><a href="../427679/index.html">Resetting the limit of duty-free purchases will take a year and a half, if the decision is taken</a></li>
<li><a href="../42768/index.html">Second psp concept</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>