<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Working with ssh in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day everyone. 

 I want to tell you about paramiko - a module for working with ssh in python. 
 With it, you can write a script that will access ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Working with ssh in Python</h1><div class="post__text post__text-html js-mediator-article">  Good day everyone. <br><br>  I want to tell you about paramiko - a module for working with ssh in python. <br>  With it, you can write a script that will access the remote server (or many) and do something on it. <br><br>  Who cares - I ask under the cat. <br><a name="habracut"></a><br>  Quite often, at work, it was necessary to perform very similar actions on client servers.  The actions are trivial, like ‚Äúcorrect line 12 in the configuration file‚Äù or ‚Äúreplace the file‚Äû version_017 ‚Äúwith‚Äû version_018 ‚Äú.  It was easy until the servers had accumulated * eleven pieces.  Also, such tasks were bored very quickly, so they tried to entrust similar work to beginners with the wording ‚Äúto acquire skills in working with ssh‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At first, the simplest tasks could be solved using standard ssh tools ‚Äî file copying and remote code execution.  Also tried using the empty utility. <br><br>  At that time I was beginning to learn python, I decided to see what it has for these purposes.  Google helpfully prompted about paramiko. <br><br>  Paramiko (a combination of Eperanto words ‚Äúparanoid‚Äù and ‚Äúfriend‚Äù - ‚Äúparanoja" + "amiko") is a module for python version 2.3 and higher that implements the ssh2 protocol for a secure (encrypted and authenticated) connection to a remote computer. connection provides a high-level API for working with ssh - an SSHClient object is created.For greater control, you can transfer a socket (or similar object) to the Transport class and work with a remote host as a server or client. For authentication, you can use a password or a private key and verify  at the server key. <br><br>  A small example of the use of this module.  Comments will be lower. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> paramiko host = <span class="hljs-string"><span class="hljs-string">'192.168.0.8'</span></span> user = <span class="hljs-string"><span class="hljs-string">'login'</span></span> secret = <span class="hljs-string"><span class="hljs-string">'password'</span></span> port = <span class="hljs-number"><span class="hljs-number">22</span></span> client = paramiko.SSHClient() client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) client.connect(hostname=host, username=user, password=secret, port=port) stdin, stdout, stderr = client.exec_command(<span class="hljs-string"><span class="hljs-string">'ls -l'</span></span>) data = stdout.read() + stderr.read() client.close()</code> </pre> <br><br>  You can get data for access to a remote server in any convenient way - write it directly in the code, put it into the config, database, etc.  Obviously, if there are several hosts, you need to do a loop to bypass them. <br><br>  The main class for connectivity and remote work is SSHClient.  He provides us with a ‚Äúsession‚Äù with which we can work further. <br><br>  In the client.set_missing_host_key_policy line (paramiko.AutoAddPolicy ()) we add the server key to the list of known hosts - the .ssh / known_hosts file.  If the key is not found in it when connecting to the server, then by default the key ‚Äúfights back‚Äù and causes an SSHException. <br><br>  To connect to the server, use client.connect ().  You can log in as a combination of login-password and the keys.  When connecting, you can specify a host, username, password, port, key, and other parameters. <br><br>  The string client.exec_command ('ls -l') - executes the command on the remote server.  Program I / O streams are returned in file-like objects - stdin, stdout, stderr. <br><br>  Perhaps, I didn‚Äôt understand, but I didn‚Äôt manage to get root rights on a dedicated server.  I would be grateful if I was told how to do it.  To perform actions with superuser rights, do the following: <br><br><pre> <code class="python hljs">stdin, stdout, stderr = ssh.exec_command(<span class="hljs-string"><span class="hljs-string">'sudo -S rm *'</span></span>) stdin.write(<span class="hljs-string"><span class="hljs-string">'password'</span></span> + <span class="hljs-string"><span class="hljs-string">'\n'</span></span>) stdin.flush()</code> </pre><br><br>  UPD: <a href="http://habrahabr.ru/users/meph1st0/" class="user_link">meph1st0</a> in the comments <a href="http://habrahabr.ru/post/150047/">suggested</a> for this purpose to use the class Channel <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> paramiko client = paramiko.SSHClient() client.set_missing_host_key_policy(paramiko.AutoAddPolicy()) client.connect(...) channel = lient.get_transport().open_session() channel.get_pty() channel.settimeout(<span class="hljs-number"><span class="hljs-number">5</span></span>) channel.exec_command(<span class="hljs-string"><span class="hljs-string">'sudo ls'</span></span>) channel.send(password+<span class="hljs-string"><span class="hljs-string">'\n'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> channel.recv(<span class="hljs-number"><span class="hljs-number">1024</span></span>) channel.close() client.close()</code> </pre><br><br>  To transfer files via sftp, you can use the Transport class.  To transfer files directly, use the put and get commands. <br><br><pre> <code class="python hljs">host = <span class="hljs-string"><span class="hljs-string">"example.com"</span></span> port = <span class="hljs-number"><span class="hljs-number">22</span></span> transport = paramiko.Transport((host, port)) transport.connect(username=<span class="hljs-string"><span class="hljs-string">'login'</span></span>, password=<span class="hljs-string"><span class="hljs-string">'password'</span></span>) sftp = paramiko.SFTPClient.from_transport(transport) remotepath = <span class="hljs-string"><span class="hljs-string">'/path/to/remote/file.py'</span></span> localpath = <span class="hljs-string"><span class="hljs-string">'/path/to/local/file.py'</span></span> sftp.get(remotepath, localpath) sftp.put(localpath, remotepath) sftp.close() transport.close()</code> </pre><br><br>  In short everything.  Project site and documentation - <a href="http://www.lag.net/paramiko/">http://www.lag.net/paramiko/</a> <br><br>  UPD.  The comments suggested that there are a number of other tool <s>libraries</s> that can also be used to <s>work on ssh</s> solutions for similar tasks.  Of the above: fabric, chef, puppet, libbsh2 (pylibbsh2), exscript and net-ssh-telnet on Ruby.  Thanks to all the commentators. </div><p>Source: <a href="https://habr.com/ru/post/150047/">https://habr.com/ru/post/150047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../150041/index.html">Class Relationships - From UML To Code</a></li>
<li><a href="../150042/index.html">Andengine: arbitrary landscape with texture</a></li>
<li><a href="../150043/index.html">Mathematical expressions in .NET (parsing, differentiation, simplification, fractions, compilation)</a></li>
<li><a href="../150044/index.html">Organization and optimization of user information space</a></li>
<li><a href="../150045/index.html">10G aggregators for providers and data centers</a></li>
<li><a href="../150050/index.html">Sending SMS from under Shell</a></li>
<li><a href="../150051/index.html">Configuring cisco ASA 5510 + security module ASA-SSM-CSC-10 + NAT</a></li>
<li><a href="../150053/index.html">Car safety systems and thinking about unrealized</a></li>
<li><a href="../150054/index.html">jQuery UI Datepicker: add custom navigation elements by year</a></li>
<li><a href="../150055/index.html">Nikon released the camera running Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>