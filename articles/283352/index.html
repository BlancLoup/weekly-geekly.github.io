<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C ++ without new and delete</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content=", ! 
 
 , Align Technology. ++.
 
 , . , ++ . , ‚Äî .
 
 . new delete. , . , ++ new delete. 
 
 , , . , . , .
 
 , , - .
 
 
  behappy.me
 
 : new delet...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C ++ without new and delete</h1><div class="post__text post__text-html js-mediator-article">, ! <br>
<br>
   ,      Align Technology.           ++.<br>
<br>
   ,           .  ,       ++        . ,      ‚Äî  .<br>
<br>
             .     <code>new</code>  <code>delete</code>.  ,   .  ,        ++    <code>new</code>  <code>delete</code>. <br>
<br>
 ,    ,          .         ,    .         ,       .<br>
<br>
         ,   ,        - .<br>
<br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/d26/8b0/7f7/d268b07f788f490fa4d5b20ecfd6da92.png" width="400"></div><br>
<i>    behappy.me</i><br>
<a name="habracut"></a><br>
 :    <code>new</code>  <code>delete</code>   .      ,      . ,       .<br>
<br>
   :<br>
<ul>
<li>   .</li>
<li>    , <br>
<ul>
<li>c   <code>delete</code>;</li>
<li>   <code>new</code>   <code>make</code>-;</li>
<li>   <code>new</code>   .</li>
</ul></li>
<li> .</li>
</ul><br>
      ,      <code>new</code>  <code>delete</code>         STL  boost.<br>
<br>
<h2>   <code>new</code>  <code>delete</code>?</h2><br>
 <code>new</code>  <code>delete</code>  ++       .<br>
<br>
     ,       .         ,     .     thread-local ,         . . <a href="http://en.cppreference.com/w/cpp/language/storage_duration">storage duration</a>.<br>
<br>
        ,    .    ,      ,    .        .<br>
<br>
       .      (          ).      :<br>
<pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">
{</span></span>
  <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> str;  <span class="hljs-comment"><span class="hljs-comment">//  ,     A (  </span></span>
                    <span class="hljs-comment"><span class="hljs-comment">// ).    -   (*),   </span></span>
                    <span class="hljs-comment"><span class="hljs-comment">//    std::string,       A. </span></span>
  <span class="hljs-comment"><span class="hljs-comment">// (*)      ,   Small String Optimization  </span></span>
  <span class="hljs-comment"><span class="hljs-comment">//     .</span></span>
};

<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span>{
  <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v;  <span class="hljs-comment"><span class="hljs-comment">//  ,      .</span></span>
  v.push_back(<span class="hljs-number"><span class="hljs-number">10</span></span>);  <span class="hljs-comment"><span class="hljs-comment">//   -   (),     </span></span>
                    <span class="hljs-comment"><span class="hljs-comment">// ,        .</span></span>

  A a;  <span class="hljs-comment"><span class="hljs-comment">//    ,      .</span></span>

  A* pa = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> A;  <span class="hljs-comment"><span class="hljs-comment">//  pa -  ,      ,</span></span>
                  <span class="hljs-comment"><span class="hljs-comment">//        ,      .</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> pa;  <span class="hljs-comment"><span class="hljs-comment">//    .</span></span>

  <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> upa =  <span class="hljs-comment"><span class="hljs-comment">//   upa -  ,      , </span></span>
    <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;A&gt;();  <span class="hljs-comment"><span class="hljs-comment">//        ,    </span></span>
                            <span class="hljs-comment"><span class="hljs-comment">//    .</span></span>
}
</code></pre><br>
     ,       .       ,    .      <code>upa-&gt;str</code>   , ..  ‚Äî    <code>*upa</code>. ..  /   ,     . <br>
<br>
 /   ,   , ..          ,   <sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">*</a></sup>).     <code>a</code>  <code>*pa</code>    ,    ,   ‚Äî .<br>
<br>
   ++    <code>new</code>,     <code>delete</code>.     :   ,      !   ,     .        .<br>
<br>
 ,      ,    .<br>
<br>
<hr><a name="Example1"></a><sup>*</sup>  ,    /   . ,  .<br>
<br>
<h2>    <code>new</code>  <code>delete</code>?</h2><br>
      <code>new</code>  <code>delete</code>   .       <code>delete</code>:<br>
<ul>
<li>    <code>delete</code> ( , memory leak).</li>
<li>   <code>delete</code>         (  ).</li>
<li>  <code>delete</code>  ( , double delete).</li>
<li>     : <code>delete</code>  <code>delete[]</code>   ( , undefined behavior).</li>
<li>     <code>delete</code> (dangling pointer).</li>
</ul><br>
         ,        <a href="http://catb.org/jargon/html/N/nasal-demons.html"> </a>.<br>
<br>
      <code>delete</code>      ,       .    <code>new</code>   ,       , ,  ,         .     ,    <code>make</code>-.<br>
<br>
     <code>new</code>  <code>delete</code>. ,        ,        ,     <code>new</code>  <code>delete</code>. <br>
<br>
   ‚Äî   .<br>
<br>
<h2> </h2><br>
  ‚Äî    ,    .    ,      ,     ,        ,     .<br>
<br>
    ++        <code>new</code>  <code>delete</code>: <code>new[]</code>  <code>delete[]</code>.      ,     :<br>
<pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoWork</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bufSize)</span></span></span></span>;
</code></pre><br>
       API   <sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">*</a></sup>.   ,      .   , ..      <code>delete</code>,         .<br>
<pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function">
</span></span>{
  <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* p = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[n];
  DoWork(p, n);
  <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span>[] p;  <span class="hljs-comment"><span class="hljs-comment">// !</span></span>
}
</code></pre><br>
     ,      ++     <code>std::vector</code><sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">**</a></sup>.           .   ,         ,        .       :<br>
<pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n)</span></span></span><span class="hljs-function">
</span></span>{
  <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v(n);  <span class="hljs-comment"><span class="hljs-comment">// .</span></span>
  DoWork(v.data(), v.size());
}
</code></pre><br>
     ,    <code>delete</code>,        +,      .<br>
<br>
<b>   <code>new</code>  <code>delete</code>.</b>        .        ,        .<br>
<br>
<hr><a name="Example2"></a><sup>*</sup>  ++         <a href="http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines"><code>span&lt;int&gt;</code></a>.    STL-       ,          ( ).<br>
<br>
<a name="Example3"></a><sup>**</sup>       ++,   ,  - : ¬´! <code>std::vector</code>      (!) ,    <code>int*</code> ‚Äî      .          !  !¬ª.        ++    <a href="https://www.youtube.com/watch%3Fv%3DltCgzYcpFUI%26feature%3Dyoutu.be%26t%3D2220">Why C++ Sails When the Vasa Sank</a>.     <i></i> ,    <code>std::unique_ptr&lt;int[]&gt;</code>,        <a href="http://en.cppreference.com/w/cpp/container/dynarray"><code>dynarray</code></a>.<br>
<br>
<h2>  </h2><br>
   ,        -   .    ,     <sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">*</a></sup>, (. <a href="http://stackoverflow.com/q/6500313/261217">     </a>).     .<br>
<br>
   , -   ,         : ,        ,  ,  - .  ,       ,   ‚Äî . <br>
<br>
          <sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">**</a></sup>,  .   ,   ,    .      ,        .<br>
<br>
        , ,  Qt.      ,     .     , ..     <code>QObject</code>.       , ,     <code>boost::intrusive_ptr</code>.<br>
<br>
 ,                .        .         . , <code>QObject</code>   <code>setParent()</code>  <code>children()</code>      ,   <code>boost::intrusive_ptr</code>    <code>intrusive_ptr_add_ref</code>  <code>intrusive_ptr_release</code>      .<br>
<br>
       ,     ,       . ,        ,   ,       . <br>
<br>
    .  ,  ,            <code>new</code>  <code>delete</code>   ,      ‚Äî    .<br>
<br>
<hr><a name="Example4"></a><sup>*</sup>  :  <code>pimpl;</code>    (,  ).<br>
<br>
<a name="Example5"></a><sup>**</sup>   <code>std::locale::facet</code> (. ).<br>
<br>
<h3>     </h3><br>
     .         ++,       ,      .<br>
<br>
,  , ,  .         .   ++  : <code>std::shared_ptr</code>  <code>std::unique_ptr</code>.     <code>std::weak_ptr</code>, ..     <code>std::shared_ptr</code>    .<br>
<br>
  <code>std::auto_ptr</code>,      ++   ++17.   !<br>
<br>
         , ..     .  ,         <code>std::make_shared</code>  <code>std::make_unique</code>,         .<br>
<br>
..   :<br>
<pre><code class="hljs cpp"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Cookie&gt; cookie(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cookie(dough, sugar, cinnamon));
</code></pre><br>
   :<br>
<pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> cookie = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::make_unique&lt;Cookie&gt;(dough, sugar, cinnamon);
</code></pre><br>
 <code>make</code>-            <a href="http://herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/">GotW #89</a>      <a href="http://shop.oreilly.com/product/0636920033707.do">Effective Modern C++</a>, Item 21.   ,      :<br>
<ul>
<li>  <code>make</code>-:<br>
<ul>
<li>    .</li>
<li>   .</li>
</ul></li>
<li> <code>std::make_shared</code>:<br>
<ul>
<li>  , ..       ,           .  <a href="https://www.reddit.com/r/cpp/comments/3eia29/stdshared_ptrs_secret_constructor/ctfbmvj">We Know Where You Live</a>.</li>
</ul></li>
</ul><br>
 make-    ,      :<br>
<ul>
<li>  <code>make</code>-:<br>
<ul>
<li>   <code>deleter</code>.   , ..   <code>make</code>-     <code>new</code>.</li>
<li>  <code>braced initializer</code>,     ,   perfect forwarding (. Effective Modern C++, Item 30). </li>
</ul></li>
<li> <code>std::make_shared</code>:<br>
<ul>
<li>          (<code>std::weak_pointer</code>).</li>
<li>   <code>new</code>  <code>delete</code>    .</li>
<li>   (false sharing)      (. <a href="http://stackoverflow.com/q/14342159/261217">  StackOverflow</a>).</li>
</ul></li>
</ul><br>
         . ,        <code>delete</code>,  <code>make</code>-     <code>new</code>. <b>      ,     <code>new</code>,  <code>delete</code>.</b><br>
<br>
,  <code>make</code>-        (a.k.a. STL).        <a href="https://channel9.msdn.com/Events/GoingNative/2013/Don-t-Help-the-Compiler">Don‚Äôt Help the Compiler:</a><br>
<div style="text-align:center;"><img src="https://habrastorage.org/files/ed2/49c/706/ed249c7066034df8bf214220bfd685cf.png" width="600"></div><br>
<h3>     </h3><br>
           . ,    (reference counting)   - (parent to child relationship).<br>
<br>
                  <code>new</code>  <code>delete</code>. -    ,  - .<br>
<br>
<h4>    </h4><br>
<img src="https://habrastorage.org/files/b28/a0a/85e/b28a0a85e2da4ecc865e227deeef7662.png"><br>
   ,    .      OpenSceneGraph.    3D-,   ++  OpenGL. <br>
<br>
        <code>osg::Referenced</code>,      . <code> ref()</code>  ,  <code>unref()</code>     ,     .<br>
<br>
      <code>osg::ref_ptr&lt;T&gt;</code>,    <code>T::ref()</code>         <code>T::unref()</code>  .      <code>boost::intrusive_ptr</code>,     <code>ref()</code>  <code>unref()</code>   .<br>
<br>
  ,      <a href="https://www.packtpub.com/game-development/openscenegraph-30-beginners-guide">OpenSceneGraph 3.0: Beginner's guide</a>:<br>
<pre><code class="hljs php">osg::ref_ptr&lt;osg::Vec3Array&gt; vertices = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array;
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
osg::ref_ptr&lt;osg::Vec3Array&gt; normals = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Vec3Array;
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
osg::ref_ptr&lt;osg::Geometry&gt; geom = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> osg::Geometry;
geom-&gt;setVertexArray(vertices.get());
geom-&gt;setNormalArray(normals.get());
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
</code></pre><br>
    <code>osg::ref_ptr&lt;T&gt; p = new T</code>.   ,   <code>std::make_unique</code>  <code>std::make_shared</code>     <code>std::unique_ptr</code>  <code>std::shared_ptr</code>,     <code>osg::make_ref</code>    <code>osg::ref_ptr</code>.    ,     <code>std::make_unique</code>:<br>
<pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> osg
{
  <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Args&gt;
  osg::ref_ptr&lt;T&gt; make_ref(Args&amp;&amp;... args)
  {
    <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Args&gt;(args)...);
  }
}
</code></pre><br>
       :<br>
<pre><code class="hljs php">auto vertices = osg::make_ref&lt;osg::Vec3Array&gt;();  
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
auto normals = osg::make_ref&lt;osg::Vec3Array&gt;();  
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
auto geom = osg::make_ref&lt;osg::Geometry&gt;();
geom-&gt;setVertexArray(vertices.get());
geom-&gt;setNormalArray(normals.get());
<span class="hljs-comment"><span class="hljs-comment">// ... </span></span>
</code></pre><br>
       .          <sup><a href="https://habr.com/ru/company/aligntechnology/blog/283352/">*</a></sup>,         .<br>
<br>
 <code>delete</code>      <code>osg::Referenced::unref()</code>,       <code>new</code>   <code>osg::make_ref</code>. <b>   <code>new</code>  <code>delete</code>.</b><br>
<br>
<hr><a name="Example6"></a><sup>*</sup> ,          ,         .<br>
<br>
<h4>      MFC</h4><br>
<img src="https://habrastorage.org/files/829/035/b76/829035b767af432fbe5161b3a9ef148c.png" width="120"><br>
 ,    MFC.     ++  Windows API.      GUI  Windows.<br>
<br>
 ,  Microsoft <a href="https://support.microsoft.com/en-us/kb/103788"> </a>     . ..  ,   ,     .         <code>CDialog::PostNcDestroy()</code>.       <code>WM_NCDESTROY</code> ‚Äî  ,      .<br>
<br>
           <code>CMainFrame::OnBnClickedCreate()</code>      <code>CMyDialog::PostNcDestroy()</code>.<br>
<pre><code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CMainFrame::OnBnClickedCreate()
{
  <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>* pDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CMyDialog(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);
  pDialog-&gt;ShowWindow(SW_SHOW);
}

<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CMyDialog</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CDialog
{
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
  CMyDialog(CWnd* pParent)
  {
    Create(IDD_MY_DIALOG, pParent);
  }

<span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>:
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostNcDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override
  </span></span>{
    CDialog::PostNcDestroy();
    <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;
  }
};
</code></pre><br>
       <code>new</code>,   <code>delete</code>.      ‚Äî .     ,        <code>PostNcDestroy()</code>,   .    <code>new</code>,         <code>delete</code>,   .        ,    .<br>
<br>
    <code>new</code>  <code>delete</code>    <code>CModelessDialog</code>   <code>CreateModelessDialog</code>,         :<br>
<pre><code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CModelessDialog</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CDialog
{
<span class="hljs-keyword"><span class="hljs-keyword">public</span></span>:
  CModelessDialog(UINT nIDTemplate, CWnd* pParent)
  {
    Create(nIDTemplate, pParent);
  }

<span class="hljs-keyword"><span class="hljs-keyword">protected</span></span>:
  <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PostNcDestroy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> override
  </span></span>{
    CDialog::PostNcDestroy();
    <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;
  }
};

<span class="hljs-comment"><span class="hljs-comment">//     </span></span>
<span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Derived</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class">... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&gt;
</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Derived</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateModelessDialog</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Args</span></span></span><span class="hljs-class">&amp;&amp;... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">args</span></span></span><span class="hljs-class">)
{</span></span>
  <span class="hljs-comment"><span class="hljs-comment">//  static_assert   ,   std::enable_if   ,     SFINAE. </span></span>
  <span class="hljs-comment"><span class="hljs-comment">//  ..       ,        .</span></span>
  <span class="hljs-keyword"><span class="hljs-keyword">static_assert</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::is_base_of&lt;CModelessDialog, Derived&gt;::value, 
                <span class="hljs-string"><span class="hljs-string">"CreateModelessDialog should be called for descendants of CModelessDialog"</span></span>);
  <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>* pDialog = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Derived(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::forward&lt;Args&gt;(args)...);
  pDialog-&gt;ShowWindow(SW_SHOW);
  <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> pDialog;
}
</code></pre><br>
    <code>PostNcDestroy()</code>,     <code>delete</code>,       ,     <code>new</code>.        :<br>
<pre><code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CMainFrame</span></span>::OnBnClickedCreate()
{
  CreateModelessDialog&lt;<span class="hljs-built_in"><span class="hljs-built_in">CMyDialog</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);
}

<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CMyDialog</span></span> : public <span class="hljs-built_in"><span class="hljs-built_in">CModelessDialog</span></span>
{
public:
  <span class="hljs-built_in"><span class="hljs-built_in">CMyDialog</span></span>(CWnd* pParent) : <span class="hljs-built_in"><span class="hljs-built_in">CModelessDialog</span></span>(IDD_MY_DIALOG, pParent) {}
};
</code></pre><br>
,       . ,           .            ,    .           <code>CModelessDialog</code>. , ,    <code>CMyDialog</code>     ,   ,    .        .<br>
<br>
  ,            . <b>         <code>new</code>  <code>delete</code>.</b><br>
<br>
<h4>    -</h4><br>
<img src="https://habrastorage.org/files/93c/0ab/70b/93c0ab70b37c4d5c800c050db488a493.jpg" width="120"><br>
  ,      GUI.     Qt ‚Äî        UI.<br>
<br>
     <code>QObject</code>.         ,   .     (  )       .<br>
<br>
  ,    <code>new</code>  <code>delete</code>    .    ,          .         ,     (. <a href="http://lists.qt-project.org/pipermail/interest/2014-October/013828.html">  Qt mailing list</a>).<br>
<br>
<b> ,       new  delete  Qt.</b><br>
<br>
<h4>  <code>std::locale::facet</code></h4><br>
<img src="https://habrastorage.org/files/785/95b/3ee/78595b3ee6af4ef0b56d823058f4c585.jpg" width="120"><br>
       ++   <code>std::locale</code>.     (facet),        .             ,       .<br>
<br>
     ,      ,      ,   new (.  Notes   <a href="http://en.cppreference.com/w/cpp/locale/locale/locale"> <code>std::locale)</code></a>:<br>
<pre><code class="hljs cpp"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::locale <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>;
<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-function">locale </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myLocale</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">default</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">new</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">std</span></span></span></span><span class="hljs-function"><span class="hljs-params">::codecvt_utf8&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">wchar_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt;)</span></span></span></span>;
</code></pre><br>
                  . <br>
<br>
<b>   ,  ,   <code>new</code>   .        ,   ,      .</b><br>
<br>
<h2></h2><br>
,     ,           .  <code>new</code>  <code>delete</code>      <code>make</code>-       .<br>
<br>
         ,     ,  <code>new</code>  <code>delete</code>   .    ,     .<br>
<br>
  ,        ,         .    , ,    <code>new</code>  <code>delete</code>,   ,    .        , ,    .<br>
<br>
 :<br>
<ul>
<li>  <code>new</code>  <code>delete</code>  .         .</li>
<li>      .</li>
<li> <code>make</code>-    ,   .</li>
<li>       .</li>
</ul><br>
<h2> </h2><br>
           -   <code>new</code>  <code>delete</code>. ,         ,          ,      . <br>
<br>
 ,       ,      ,       .<br>
<br>
             C++ Russia.        : ,     ,  ,      . ,         ,  ,       ,       ,  ,       .<br>
<br>
<b>PS</b>    ,       ,  : ¬´¬ª  ¬´¬ª.   ,       ¬´¬ª,         .   ,  <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D0%25B9%25D0%25B5%25D1%2580%25D1%2581,_%25D0%25A1%25D0%25BA%25D0%25BE%25D1%2582%25D1%2582"></a>   ¬´¬ª.   <a href="http://www.ozon.ru/%3Fcontext%3Dsearch%26text%3D%25D1%25EA%25EE%25F2%25F2%2B%25CC%25E0%25E9%25E5%25F0%25F1%26store%3D1,0"> </a>,       :        ¬´¬ª.   <a href="https://www.youtube.com/watch%3Fv%3DWDIkqP4JbkE"></a> <a href="https://www.youtube.com/watch%3Fv%3D48kP_Ssg2eY"></a> <a href="https://www.youtube.com/watch%3Fv%3DIqVZG6jWXvs"></a>  -.     <a href="https://www.youtube.com/watch%3Fv%3DltCgzYcpFUI%26feature%3Dyoutu.be%26t%3D26"> </a>,       ¬´¬ª,    .<br>
<br>
<h2></h2><br>
<ol>
<li>Herb Sutter, <i><a href="http://herbsutter.com/2013/05/29/gotw-89-solution-smart-pointers/">GotW #89 Solution: Smart Pointers</a>.</i></li>
<li>Scott Meyers, <i><a href="http://shop.oreilly.com/product/0636920033707.do">Effective Modern C++</a></i>, Item 21, p. 139.</li>
<li>Stephan T. Lavavej, <i><a href="https://channel9.msdn.com/Events/GoingNative/2013/Don-t-Help-the-Compiler">Don‚Äôt Help the Compiler</a>.</i></li>
<li>Bjarne Stroustrup, <i><a href="http://www.stroustrup.com/4th.html">The C++ Programming Language</a></i>, 11.2.1, p. 281.</li>
<li><i><a href="https://isocpp.org/blog/2014/12/myths-2">Five Popular Myths about C++</a>.</i>, Part 2</li>
<li>Mikhail Matrosov, <i><a href="http://meetingcpp.ru/%3Fpage_id%3D608">C++ without new and delete</a>.</i></li>
</ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/283352/">https://habr.com/ru/post/283352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../283342/index.html">ONLYOFFICE Documents 1.3 for iOS: how the mobile spreadsheet editor is organized</a></li>
<li><a href="../283344/index.html">Theory and practice of escape from the 5 GHz band</a></li>
<li><a href="../283346/index.html">CUBA Platform Enters Free Software Market</a></li>
<li><a href="../283348/index.html">Firebird 3.0 Verification</a></li>
<li><a href="../283350/index.html">Basics of game design: 20 board games. Part one</a></li>
<li><a href="../283354/index.html">Leaflet as a shell for Yandex.Maps - we display 100 thousand markers on the map</a></li>
<li><a href="../283356/index.html">REG.RU: Step-by-Step Guide to Creating a Company Website</a></li>
<li><a href="../283358/index.html">CDN - New Video Broadcast Standard</a></li>
<li><a href="../283360/index.html">Update fixes security issues for all tools based on IntelliJ platform</a></li>
<li><a href="../283362/index.html">Film lover's best friend: rework CBS application for Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>