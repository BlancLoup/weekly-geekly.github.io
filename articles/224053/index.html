<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Autodocumentation of mobile web services on the example of Yii</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think that many, especially small companies, when working with the same framework, constantly write some things / extensions, etc. that solve exactl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Autodocumentation of mobile web services on the example of Yii</h1><div class="post__text post__text-html js-mediator-article">  I think that many, especially small companies, when working with the same framework, constantly write some things / extensions, etc. that solve exactly the tasks that they encounter most often. <br><br>  In our case, this framework is Yii, and one of the most popular problems was the simultaneous development of a web service for iOS / Android applications. <br><br>  At first, as always, the developers simply agreed among themselves what and how, but if the developer suddenly changed, the problems started.  Next is a description of the input / output data in the wiki.  With a large number of minor changes, there was a problem of synchronization of the code and formats described in the wiki. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How we solved the problem - below. <br><a name="habracut"></a><br><h5>  Development of a web service controller </h5><br>  As a rule, a mobile service is a separate project module.  We made a basic module and a basic controller for working with a web service. <br><br>  Key things below. <br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VMJsonServiceController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $documentationMode = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $request = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;documentationMode) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Yii::app()-&gt;request-&gt;isPostRequest) { $json = CJSON::decode(file_get_contents(<span class="hljs-string"><span class="hljs-string">"php://input"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($json-&gt;request)) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request = $json-&gt;request; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;respondWithError(VMServiceResponseCode::SERVICE_ERROR, <span class="hljs-string"><span class="hljs-string">'There is no request node'</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { ... } } ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkInputParameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($params = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;documentationMode) { $exception = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VMDocumentationException(); $exception-&gt;parameters = VMObjectUtils::fromArray($params); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> $exception; } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;checkObjectParameter($params, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request); } ... }</code> </pre> <br><br>  The most "salt" is precisely in the <code>$documentationMode</code> parameter, but more on that later. <br>  Now we will consider an example of the controller from a real project, and not from a common library. <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VMJsonServiceController</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionSignUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;checkInputParameters(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'email'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'test@test.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'12345'</span></span>, <span class="hljs-string"><span class="hljs-string">'phone'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'optional'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'+7 999 998 76 54'</span></span>), <span class="hljs-string"><span class="hljs-string">'photos'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'array'</span></span>, <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'file'</span></span> =&gt; base64_encode(<span class="hljs-string"><span class="hljs-string">'Image'</span></span>), ) ) )); $email = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;request-&gt;user-&gt;email; ... } ... }</code> </pre><br>  The checkInputParameters method checks that the data came in the correct format for this method (email and password are required, phone is optional, and photos is an array of data. Next, we are sure that we have all the necessary data and can work with them. <br><br>  Now, actually, what was discussed at the beginning of the article is about documentation.  In principle, the array in the checkInputParameters method is the input data format, and, in fact, we generate documentation on the basis of it, but constantly generating it with pens is uninteresting and time consuming.  Therefore, we will force the module to generate documentation about itself. <br><br>  1. Making another controller <br>  With the <code>Metadata</code> extension, it bypasses all controllers and Actions, and then renders a visual representation of the method parameters and service responses.  This is done using the <code>checkInputParameters</code> method mentioned <code>checkInputParameters</code> <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VMDocumentationController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CController</span></span></span><span class="hljs-class"> </span></span>{ ... <span class="hljs-comment"><span class="hljs-comment">//     ,      //     ""    private function getDefinition($class, $method) { try { $class-&gt;{$method}(); } catch (VMDocumentationException $e) { return (object) array( 'parameters' =&gt; $e-&gt;parameters ); } } ... }</span></span></code> </pre><br><br>  2. The code of the base module is correct <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VMJsonServiceModule</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CWebModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;controllerMap = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'documentation'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'VMDocumentationController'</span></span> ) ); } }</code> </pre><br><br>  What does this give us?  And the fact that the iOS / Android programmer for the same url has documentation for any project, only the baseUrl changes. <br>  What does the documentation look like? <br>  A couple of screenshots below. <br><br>  In the top navbar there is a list of all the controllers of the modules, in the left one there is a list of all actions of the controller.  Optional parameters can be removed from the request, the Call button will send the request and show the server response.  That is, you can not write a single line of code, but test the work of the web service on any input data. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1f/e03/09d/f1fe0309dc4d1126632ad53bcd98d8d8.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/f85/3df/859/f853df8598ff186bbc96adf51d2a66e7.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/8a7/376/449/8a73764497be99027bd1cc03653d8f8c.png"><br><br>  And finally - all source codes can be found <a href="https://bitbucket.org/voodoo-mobile/yiivm/">here</a> .  In some places, the code is terrible, in some places it is very terrible, a lot of what is in our library besides the mobile service - nobody needs it, but if there is something to offer, pull-request to help you. <br><br>  Thanks for attention </div><p>Source: <a href="https://habr.com/ru/post/224053/">https://habr.com/ru/post/224053/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224033/index.html">Useful materials for mobile developer # 54 (May 19-25)</a></li>
<li><a href="../224039/index.html">New perspective gesture interface</a></li>
<li><a href="../224043/index.html">Tylt Energi 2K: AC adapter + spare battery</a></li>
<li><a href="../224045/index.html">NASA hands over control of the ISEE-3 satellite to the hands of space enthusiasts</a></li>
<li><a href="../224047/index.html">Ansible under Windows with crutches, props and integration with Vagrant</a></li>
<li><a href="../224055/index.html">Active noise reduction of the shutter sound in the camera of the mobile device</a></li>
<li><a href="../224057/index.html">Open Terminal Client OTC-110 - works with Citrix</a></li>
<li><a href="../224063/index.html">Hacking the D-Link DSP-W215 Smart Plug: Again, Again, Again</a></li>
<li><a href="../224065/index.html">Python-digest # 28. News, interesting projects, articles and interviews [May 19, 2014 - May 25, 2014]</a></li>
<li><a href="../224067/index.html">Profishop - solution for receiving orders from wholesale customers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>