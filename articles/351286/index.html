<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Environment for 1C-Bitrix based on Docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do you need it? 
 For a long time, all the projects of our company worked on PHP5, and now there was a desire to speed them up by switching to PHP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Environment for 1C-Bitrix based on Docker</h1><div class="post__text post__text-html js-mediator-article"><h2>  Why do you need it? </h2><br>  For a long time, all the projects of our company worked on PHP5, and now there was a desire to speed them up by switching to PHP7, at the same time update the whole environment necessary for work.  The question immediately arose: <i>‚ÄúHow to make different projects work on different versions of PHP?‚Äù</i> <br><br>  What came to mind: <br><br><ol><li>  Contain 2 different servers </li><li>  Use virtual machine </li><li>  Apply Docker </li></ol><br>  Option 1, obviously not economically viable.  Option 2 we considered difficult to set up and too resource-intensive.  Many people probably will not agree with this, however, we decided to use the Docker technology, due to its lightness and ease of application transfer.  The main selection criterion was that Docker solves the problem of <i>‚Äúworks on my machine‚Äù</i> . <br><a name="habracut"></a><br><h2>  Selection environment </h2><br>  Maria DB was chosen from the DBMS, since fast reading of data is important in all our projects, there is no need to simultaneously write data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Decided to use a bunch of Apache2 + Nginx, where Nginx serves static files and Apache2 takes responsibility for the dynamics. <br><br>  In the future, it is easy to add to the system, if necessary, such things as Redis, Memcached, etc. <br><br><h2>  Environment structure </h2><br>  All our projects have copies on the battle server, used to test changes before release.  Therefore, we conditionally divided the environment into 2 parts: <b>demo</b> and <b>prod</b> <br><br>  Each of the parts have their own container with b / d.  Those.  demo and prod databases are separated.  Also demo and prod and include a PHP5 coteiner and a PHP7 container. <br><br>  At the head of everything is Nginx proxy, directing requests specifically to the container that is specified in the configuration file.  This makes it possible to easily switch versions of PHP by simply redirecting the request to the required container, since the project files are available in each of them.  The only difference is in what environment they are executed. <br><br>  Example of site configuration for Nginx proxy: <br><br><pre><code class="nginx hljs"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> example.ru www.example.ru; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://demo_php7_web; } }</code> </pre> <br>  Visually consider the structure of the system can be on the scheme: <br><br><img src="https://habrastorage.org/webt/zv/-m/aq/zv-maqoo_suyketkg6jihwoak-g.jpeg" alt="image"><br><br><h2>  System optimization </h2><br>  Most of our projects work on the 1C-Bitrix platform, so we configured Apache2 and Nginx with the requirements of the skipt <b>bitrix_server_test</b> provided by 1C-Bitrix. <br><br>  All necessary PHP extensions are installed in web server containers, as well as <i>curl, rsyslog, htop, xvfb, libfontconfig, wkhtmltopdf, jpegoptim, optipng</i> .  In addition, server compression is configured. <br><br><h2>  Special features </h2><br><ul><li>  On the crown it is worth checking the Apache2 and Nginx configuration files for changes, with a frequency of 1 minute.  There is no need to enter the container to reload after changing the settings. </li><li>  The containers in the web server have a <i>developer</i> user, on behalf of which Apache2, Cron and Nginx are running </li><li>  SSL is supported, configuration is described in examples of configuration files. </li></ul><br><h2>  Using </h2><br>  Currently, this system, which runs more than 30 projects, works properly on our server. <br><br>  The project is available on <a href="https://github.com/serkyron/dms">GitHub</a> .  It also contains a more detailed description of the project file structure and how to get started. </div><p>Source: <a href="https://habr.com/ru/post/351286/">https://habr.com/ru/post/351286/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351276/index.html">PHDays technical program: how to break IoT, bypass Windows Hello and are protected from a quantum computer</a></li>
<li><a href="../351278/index.html">Pause and restart an Adwords campaign if something is wrong with the site.</a></li>
<li><a href="../351280/index.html">The scientific approach to the choice of illustrations for the post on Habr√©</a></li>
<li><a href="../351282/index.html">The cornerstone of pseudo-randomness: how does the search for numbers begin</a></li>
<li><a href="../351284/index.html">We are looking for speakers at the Front-End MeetUp March 28</a></li>
<li><a href="../351288/index.html">Bottom-Up Strategy for Implementing Changes in an Organization</a></li>
<li><a href="../351290/index.html">Negative selection of personnel in the hierarchical structure of the enterprise</a></li>
<li><a href="../351292/index.html">From Excel to EDS: how to organize convenient processing of materials for a scientific conference</a></li>
<li><a href="../351294/index.html">FastTrack Training. "Network Basics". "The Basics of Telephony." Part 2. Eddie Martin. December 2012</a></li>
<li><a href="../351296/index.html">Blockchain on Go. Part 3: Permanent Memory and Command Line Interface</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>