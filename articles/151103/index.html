<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yandex maps without using Yandex Map Kit or maps from various sources in an Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 In this message we will consider the use of maps from various sources (including Yandex maps) in an Android application. 

 To solve the prob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yandex maps without using Yandex Map Kit or maps from various sources in an Android application</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  In this message we will consider the use of maps from various sources (including Yandex maps) in an Android application. <br><img src="http://imglink.ru/pictures/08-09-12/33be9c6704e8fec3969780601bf14cee.jpg" alt="image"><a name="habracut"></a><br>  To solve the problem, we will use the <a href="http://code.google.com/p/osmdroid/">osmdroid</a> library.  We will need the <a href="">library</a> itself (link not to the latest version, this version, it seems to me, is more stable and faster than the newer ones) and <a href="">one</a> more additional <a href="">one</a> .  Add them to the project (used Eclipse under Windows) (Build Path-&gt; Configure Buil Path-&gt; Libraries-&gt; Add External JARs). <br>  Let's write the necessary permissions in the project manifest <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_COARSE_LOCATION"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_FINE_LOCATION"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_WIFI_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.WRITE_EXTERNAL_STORAGE"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  To add new map sources, for example, Yandex and Google (Mapnik is already built into the library), you need to extend the XYTileSource class <br><div class="spoiler">  <b class="spoiler_title">MyTileSource</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyTileSource</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XYTileSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyTileSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String aName, string aResourceId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aZoomMinLevel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aZoomMaxLevel, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aTileSizePixels, String aImageFilenameEnding, String... aBaseUrl)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(aName, aResourceId, aZoomMinLevel, aZoomMaxLevel, aTileSizePixels, aImageFilenameEnding, aBaseUrl); } <span class="hljs-comment"><span class="hljs-comment">//  getTileURLString,        @Override public String getTileURLString(MapTile aTile) { return String.format(getBaseUrl(), aTile.getX(), aTile.getY(), aTile.getZoomLevel()); } }</span></span></code> </pre><br></div></div><br>  The problem is that osmdroid does not support the projection of Yandex maps.  Therefore, for the correct display of Yandex maps, we will expand the TilesOverlay class.  A <a href="http://www.geofaq.ru/forum/index.php%3Faction%3Dvthread%26forum%3D2%26topic%3D7%26page%3D5">class</a> was found to convert coordinates to tiles and back online.  Here is this slightly modified class. <br><div class="spoiler">  <b class="spoiler_title">YandexUtils</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YandexUtils</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] geoToMercator(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[] g) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> d = g[<span class="hljs-number"><span class="hljs-number">0</span></span>] * Math.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>, m = g[<span class="hljs-number"><span class="hljs-number">1</span></span>] * Math.PI / <span class="hljs-number"><span class="hljs-number">180</span></span>, l = <span class="hljs-number"><span class="hljs-number">6378137</span></span>, k = <span class="hljs-number"><span class="hljs-number">0.0818191908426</span></span>, f = k * Math.sin(m); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> h = Math.tan(Math.PI / <span class="hljs-number"><span class="hljs-number">4</span></span> + m / <span class="hljs-number"><span class="hljs-number">2</span></span>), j = Math.pow( Math.tan(Math.PI / <span class="hljs-number"><span class="hljs-number">4</span></span> + Math.asin(f) / <span class="hljs-number"><span class="hljs-number">2</span></span>), k), i = h / j; <span class="hljs-comment"><span class="hljs-comment">// return new DoublePoint(Math.round(l * d), Math.round(l * // Math.log(i))); return new double[] { l * d, l * Math.log(i) }; } public static double[] mercatorToGeo(double[] e) { double j = Math.PI, f = j / 2, i = 6378137, n = 0.003356551468879694, k = 0.00000657187271079536, h = 1.764564338702e-8, m = 5.328478445e-11; double g = f - 2 * Math.atan(1 / Math.exp(e[1] / i)); double l = g + n * Math.sin(2 * g) + k * Math.sin(4 * g) + h * Math.sin(6 * g) + m * Math.sin(8 * g); double d = e[0] / i; return new double[] { d * 180 / Math.PI, l * 180 / Math.PI }; } public static double[] mercatorToTiles(double[] e) { double d = Math.round((20037508.342789 + e[0]) * 53.5865938), f = Math .round((20037508.342789 - e[1]) * 53.5865938); d = boundaryRestrict(d, 0, 2147483647); f = boundaryRestrict(f, 0, 2147483647); return new double[] { d, f }; } public static double[] tileToMercator(long[] d) { return new double[] { Math.round(d[0] / 53.5865938 - 20037508.342789), Math.round(20037508.342789 - d[1] / 53.5865938) }; } public static double[] tileCoordinatesToPixels(double[] i, int h) { double g = Math.pow(2, toScale(h)); return new double[] { (int) i[0] / g, (int) i[1] / g }; } public static double boundaryRestrict(double f, double e, double d) { return Math.max(Math.min(f, d), e); } public static int toScale(int i) { return 23 - i; } public static long[] getTile(double[] h, int i) { long e = 8; long j = toScale(i), g = (long) h[0] &gt;&gt; j, f = (long) h[1] &gt;&gt; j; return new long[] { g &gt;&gt; e, f &gt;&gt; e }; } public static long[] getPxCoordFromTileCoord(double[] h, int i) { long j = toScale(i), g = (long) h[0] &gt;&gt; j, f = (long) h[1] &gt;&gt; j; return new long[] { g, f }; } public static long[] getTileCoordFromPixCoord(long[] h, int i) { long j = toScale(i), g = h[0] &lt;&lt; j, f = h[1] &lt;&lt; j; return new long[] { g, f }; } public static double[] ReGetTile(double[] h, int i) { long e = 8; long j = toScale(i); long g = (long) h[0] &lt;&lt; (int) j; long f = (long) h[1] &lt;&lt; (int) j; double ge = g &lt;&lt; (int) e; double fe = f &lt;&lt; (int) e; long g2 = (long) (h[0] + 1) &lt;&lt; (int) j; long f2 = (long) (h[1] + 1) &lt;&lt; (int) j; double ge2 = g2 &lt;&lt; (int) e; double fe2 = f2 &lt;&lt; (int) e; double ad_g = (ge2 - ge) * (h[0] - Math.floor(h[0])); double ad_f = (fe2 - fe) * (h[1] - Math.floor(h[1])); return new double[] { ge + ad_g, fe + ad_f }; } public static double[] ReGetTile(long[] h, int i) { long e = 8; long j = toScale(i); long g = (long) h[0] &lt;&lt; (int) j; long f = (long) h[1] &lt;&lt; (int) j; return new double[] { g &lt;&lt; (int) e, f &lt;&lt; (int) e }; } public static double[] getGeoFromTile(int x, int y, int zoom) { double a, c1, c2, c3, c4, g, z, mercX, mercY; a = 6378137; c1 = 0.00335655146887969; c2 = 0.00000657187271079536; c3 = 0.00000001764564338702; c4 = 0.00000000005328478445; mercX = (x * 256 * 2 ^ (23 - zoom)) / 53.5865938 - 20037508.342789; mercY = 20037508.342789 - (y * 256 * 2 ^ (23 - zoom)) / 53.5865938; g = Math.PI / 2 - 2 * Math.atan(1 / Math.exp(mercY / a)); z = g + c1 * Math.sin(2 * g) + c2 * Math.sin(4 * g) + c3 * Math.sin(6 * g) + c4 * Math.sin(8 * g); return new double[] { mercX / a * 180 / Math.PI, z * 180 / Math.PI }; } public static long[] getTileFromGeo(double lat, double lon, int zoom) { double rLon, rLat, a, k, z; rLon = lon * Math.PI / 180; rLat = lat * Math.PI / 180; a = 6378137; k = 0.0818191908426; z = Math.pow( Math.tan(Math.PI / 4 + rLat / 2) / (Math.tan(Math.PI / 4 + Math.asin(k * Math.sin(rLat)) / 2)), k); return new long[] { (int) (((20037508.342789 + a * rLon) * 53.5865938 / Math.pow(2, (23 - zoom))) / 256), (int) (((20037508.342789 - a * Math.log(z)) * 53.5865938 / Math .pow(2, (23 - zoom)))) / 256 }; } public static double tile2lon(int x, int aZoom) { return (x / Math.pow(2.0, aZoom) * 360.0) - 180; } public static double tile2lat(int y, int aZoom) { final double MerkElipsK = 0.0000001; final long sradiusa = 6378137; final long sradiusb = 6356752; final double FExct = (double) Math.sqrt(sradiusa * sradiusa - sradiusb * sradiusb) / sradiusa; final int TilesAtZoom = 1 &lt;&lt; aZoom; double result = (y - TilesAtZoom / 2) / -(TilesAtZoom / (2 * Math.PI)); result = (2 * Math.atan(Math.exp(result)) - Math.PI / 2) * 180 / Math.PI; double Zu = result / (180 / Math.PI); double yy = ((y) - TilesAtZoom / 2); double Zum1 = Zu; Zu = Math.asin(1 - ((1 + Math.sin(Zum1)) * Math.pow(1 - FExct * Math.sin(Zum1), FExct)) / (Math.exp((2 * yy) / -(TilesAtZoom / (2 * Math.PI))) * Math .pow(1 + FExct * Math.sin(Zum1), FExct))); while (Math.abs(Zum1 - Zu) &gt;= MerkElipsK) { Zum1 = Zu; Zu = Math .asin(1 - ((1 + Math.sin(Zum1)) * Math.pow( 1 - FExct * Math.sin(Zum1), FExct)) / (Math.exp((2 * yy) / -(TilesAtZoom / (2 * Math.PI))) * Math .pow(1 + FExct * Math.sin(Zum1), FExct))); } result = Zu * 180 / Math.PI; return result; } public static int[] getMapTileFromCoordinates(final double aLat, final double aLon, final int zoom) { final int[] out = new int[2]; final double E2 = (double) aLat * Math.PI / 180; final long sradiusa = 6378137; final long sradiusb = 6356752; final double J2 = (double) Math.sqrt(sradiusa * sradiusa - sradiusb * sradiusb) / sradiusa; final double M2 = (double) Math.log((1 + Math.sin(E2)) / (1 - Math.sin(E2))) / 2 - J2 * Math.log((1 + J2 * Math.sin(E2)) / (1 - J2 * Math.sin(E2))) / 2; final double B2 = (double) (1 &lt;&lt; zoom); out[0] = (int) Math.floor(B2 / 2 - M2 * B2 / 2 / Math.PI); out[1] = (int) Math.floor((aLon + 180) / 360 * (1 &lt;&lt; zoom)); return out; } }</span></span></code> </pre><br></div></div><br>  Now that there are formulas for converting coordinates, we can expand TilesOverlay <br><div class="spoiler">  <b class="spoiler_title">YandexTilesOverlay</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">YandexTilesOverlay</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TilesOverlay</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Rect mTileRect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rect(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Point mTilePos = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">YandexTilesOverlay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MapTileProviderBase aTileProvider, Context aContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(aTileProvider, aContext); } <span class="hljs-comment"><span class="hljs-comment">//  draw   Yandex  @Override protected void draw(Canvas c, MapView osmv, boolean shadow) { //  int zoom = osmv.getZoomLevel(); final Projection pj = osmv.getProjection(); //     BoundingBoxE6 bb = osmv.getBoundingBox(); //        double[] MercatorTL = YandexUtils.geoToMercator(new double[] { bb.getLonWestE6() / 1E6, bb.getLatNorthE6() / 1E6 }); double[] TilesTL = YandexUtils.mercatorToTiles(MercatorTL); long[] TileTL = YandexUtils.getTile(TilesTL, zoom); double[] MercatorRB = YandexUtils.geoToMercator(new double[] { bb.getLonEastE6() / 1E6, bb.getLatSouthE6() / 1E6 }); double[] TilesRB = YandexUtils.mercatorToTiles(MercatorRB); long[] TileRB = YandexUtils.getTile(TilesRB, zoom); mTileProvider .ensureCapacity((int) ((TileRB[1] - TileTL[1] + 1) * (TileRB[0] - TileTL[0] + 1))); //    Yandex double[] reTiles = YandexUtils.ReGetTile(new long[] { TileTL[0], TileTL[1] }, zoom); long xx = (long) reTiles[0]; long yy = (long) reTiles[1]; double[] reMercator = YandexUtils.tileToMercator(new long[] { xx, yy }); double[] tmp = YandexUtils.mercatorToGeo(reMercator); //    Yandex     osmdroid GeoPoint gp = new GeoPoint(tmp[1], tmp[0]); pj.toPixels(gp, mTilePos); //      Yandex for (int y = (int) TileTL[1]; y &lt;= TileRB[1]; y++) { int xcount = 0; for (int x = (int) TileTL[0]; x &lt;= TileRB[0]; x++) { final MapTile tile = new MapTile(zoom, x, y); final Drawable currentMapTile = mTileProvider.getMapTile(tile); if (currentMapTile != null) { mTileRect.set(mTilePos.x, mTilePos.y, mTilePos.x + 256, mTilePos.y + 256); currentMapTile.setBounds(mTileRect); currentMapTile.draw(c); } xcount++; mTilePos.x += 256; } mTilePos.x -= xcount * 256; mTilePos.y += 256; } } }</span></span></code> </pre><br></div></div><br>  It remains to withdraw the cards on the form <br><div class="spoiler">  <b class="spoiler_title">BlogOsmYandexActivity</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlogOsmYandexActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ MapView mMap; MapController mMapController; YandexTilesOverlay tilesOverlayYandex; TilesOverlay tilesOverlayGoogle; TilesOverlay tilesOverlayMapnik; MapTileProviderBasic tileProviderYandex; MapTileProviderBasic tileProviderGoogle; MapTileProviderBasic tileProviderMapnik; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); <span class="hljs-comment"><span class="hljs-comment">// RelativeLayout rl = new RelativeLayout(this); // mMap = new MapView(this, 256); //     mMap.setBuiltInZoomControls(true); //    rl.addView(mMap, new RelativeLayout.LayoutParams( LayoutParams.FILL_PARENT, LayoutParams.FILL_PARENT)); setContentView(rl); //       mMapController = mMap.getController(); mMapController.setZoom(15); mMapController.setCenter(new GeoPoint(55.751893, 37.617166)); //   Yandex //    firebug //getTileURLString   %s     ITileSource tileSourceYandex = new MyTileSource( "YandexMap", null, 0, 23, 256, ".png", "http://vec04.maps.yandex.net/tiles?l=map&amp;v=2.28.0&amp;x=%s&amp;y=%s&amp;z=%s&amp;lang=ru-RU", "http://vec03.maps.yandex.net/tiles?l=map&amp;v=2.28.0&amp;x=%s&amp;y=%s&amp;z=%s&amp;lang=ru-RU", "http://vec02.maps.yandex.net/tiles?l=map&amp;v=2.28.0&amp;x=%s&amp;y=%s&amp;z=%s&amp;lang=ru-RU", "http://vec01.maps.yandex.net/tiles?l=map&amp;v=2.28.0&amp;x=%s&amp;y=%s&amp;z=%s&amp;lang=ru-RU"); //   Google ITileSource tileSourceGoogle = new MyTileSource( "Google-Map", null, 0, 23, 256, ".png", "http://mt0.google.com/vt/lyrs=m&amp;hl=ru&amp;x=%s&amp;y=%s&amp;z=%s&amp;s=Galileo", "http://mt1.google.com/vt/lyrs=m&amp;hl=ru&amp;x=%s&amp;y=%s&amp;z=%s&amp;s=Galileo", "http://mt2.google.com/vt/lyrs=m&amp;hl=ru&amp;x=%s&amp;y=%s&amp;z=%s&amp;s=Galileo", "http://mt3.google.com/vt/lyrs=m&amp;hl=ru&amp;x=%s&amp;y=%s&amp;z=%s&amp;s=Galileo"); //         Yandex tileProviderYandex = new MapTileProviderBasic(getApplicationContext()); tileProviderYandex.setTileSource(tileSourceYandex); tileProviderYandex.setTileRequestCompleteHandler(mMap .getTileRequestCompleteHandler()); //  Yandex  tilesOverlayYandex = new YandexTilesOverlay(tileProviderYandex, this.getBaseContext()); //         Google tileProviderGoogle = new MapTileProviderBasic(getApplicationContext()); tileProviderGoogle.setTileRequestCompleteHandler(mMap .getTileRequestCompleteHandler()); tileProviderGoogle.setTileSource(tileSourceGoogle); //  Google  tilesOverlayGoogle = new TilesOverlay(tileProviderGoogle, this.getBaseContext()); //         Mapnik tileProviderMapnik = new MapTileProviderBasic(getApplicationContext()); tileProviderMapnik.setTileRequestCompleteHandler(mMap .getTileRequestCompleteHandler()); tileProviderMapnik.setTileSource(TileSourceFactory.MAPNIK); //  Mapnik  tilesOverlayMapnik = new TilesOverlay(tileProviderMapnik, this.getBaseContext()); // Yandex    mMap.getOverlayManager().setTilesOverlay(tilesOverlayYandex); } //   / @Override public boolean onCreateOptionsMenu(Menu menu) { SubMenu sm = menu.addSubMenu(" "); sm.add(0, 111, Menu.NONE, ""); sm.add(0, 222, Menu.NONE, "Google"); sm.add(0, 333, Menu.NONE, "Mapnik"); return true; } //      / @Override public boolean onOptionsItemSelected(MenuItem item) { switch (item.getItemId()) { case (111): mMap.getOverlayManager().setTilesOverlay(tilesOverlayYandex); mMap.invalidate(); return true; case (222): mMap.getOverlayManager().setTilesOverlay(tilesOverlayGoogle); mMap.invalidate(); return true; case (333): mMap.getOverlayManager().setTilesOverlay(tilesOverlayMapnik); mMap.invalidate(); return true; default: return super.onOptionsItemSelected(item); } } }</span></span></code> </pre><br></div></div><br>  Result <br><img src="http://imglink.ru/pictures/08-09-12/33be9c6704e8fec3969780601bf14cee.jpg" alt="image"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/151103/">https://habr.com/ru/post/151103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151094/index.html">Molecular computer 3000000 years old</a></li>
<li><a href="../151095/index.html">Future of the universe</a></li>
<li><a href="../151096/index.html">More push-ups, fewer hospital days: HeiaHeia social network starts in the UK</a></li>
<li><a href="../151101/index.html">ASUS Padfone in Russia</a></li>
<li><a href="../151102/index.html">Artificial intelligence as a set of questions</a></li>
<li><a href="../151104/index.html">jQuery plugin for forms with dynamic structure</a></li>
<li><a href="../151105/index.html">Nokia is preparing a budget model on Windows Phone 8</a></li>
<li><a href="../151106/index.html">Haier Eye-Control TV - view controlled television</a></li>
<li><a href="../151108/index.html">Competition for radio amateurs - 7400 contest 2012</a></li>
<li><a href="../151110/index.html">Tie your shoelaces and pull up your pants!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>