<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RDP (non) thin client with Linux based on Nettopes (Nvidia ION, Intel Atom)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In today's age of pervasive virtualization, there is a need to save on everything. The most significant entities for any system administrator are: 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RDP (non) thin client with Linux based on Nettopes (Nvidia ION, Intel Atom)</h1><div class="post__text post__text-html js-mediator-article">  In today's age of pervasive virtualization, there is a need to save on everything.  The most significant entities for any system administrator are: <br><ul><li>  Time (system maintenance costs) </li><li>  Iron (various failures, loss of performance, obsolescence) </li><li>  Software (licensed component, virus protection, centralization of application management) </li></ul><br>  In my article, I consider the implementation of a (non) thin client based on Linux OS as a layer between the hardware component and the familiar Windows interface. <br>  (Not) thin client, in my understanding, is a Linux distribution kit with the following properties: <br><ul><li>  a large enough set of components for download;  not suitable for network boot </li><li>  quite a small set of components;  it is not reasonable to install a hard disk </li></ul><br><a name="habracut"></a><br>  As a platform for implementation, I chose Nvidia ION because: <br><ul><li>  Performance processor </li><li>  Productive graphics (within nettops) </li><li>  Low noise (there are options with active and passive cooling) </li><li>  Takes up little space (there is the possibility of mounting on the monitor) </li><li>  Reliable enough (nothing special to break) </li></ul><br>  Also, I will need one 4GB USB flash drive, which will be the replacement for the hard drive. <br><br>  The Linux distribution was chosen for installation by openSUSE.  Currently it is version 12.2 <br><br><h5>  Well, let's get started ... </h5><br>  About the wonderful project <a href="http://susestudio.com/">Suse Studio</a> wrote a <a href="http://habrahabr.ru/search/%3Fq%3Dsuse%2Bstudio">lot</a> .  With it, we will create the final solution of the terminal (non) thin client: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create a new solution: <br><br><img src="https://habrastorage.org/storage2/a93/da4/f07/a93da4f07d6b0e5541bcba4b90864b09.jpg"><br><br>  As you can see, the choice is rich: <br><br><img src="https://habrastorage.org/storage2/0af/fc6/16f/0affc616fd93558994fb38b86b56756f.jpg"><br><br>  We need the easiest solution, so we use the template: ‚Äúminimal graphic system with IceWM shell‚Äù. <br><br><img src="https://habrastorage.org/storage2/b5f/20d/6a3/b5f20d6a30580f845052e857b713777c.jpg"><br><br><h5>  Now you can equip our distribution! </h5><br><h6>  Software </h6><br>  This out-of-the-box solution already contains the necessary components for running the graphics system and the lightweight window manager. <br>  If everything is left by default, it may take a lot of effort to configure this system (video driver, network settings, etc.).  I also need a solution: put the address hammered and forgot. <br><br>  Add the following components (dependent packages will be added automatically): <br><ul><li>  freerdp (for rdesktop fans, you can install it) </li><li>  acpi, acpid (for correct operation of the power button) </li><li>  mc (optional) </li></ul><br>  Add drivers for Nvidia ION video cards from the Nvidia repository: <br><ul><li>  x11-video-nvidiaG02 </li><li>  nvidia-gfxG02-kmp-default </li></ul><br><br>  Add drivers for Intel video cards from the repository: <br><ul><li>  xorg-x11-driver-video-intel-legacy </li></ul><br><br>  (Great <a href="http://www.suse.de/~sndirsch/nvidia-installer-HOWTO.html">article on</a> which Nvidia video driver to choose) <br><br>  Delete: <br><ul><li>  nouveau (Nvidia open source graphics driver) </li></ul><br><br><h6>  Configuration </h6><br>  <b>General</b> : Be sure to change the root password and specify our default user. <br><br>  <b>Startup</b> : Graphic Login <br><br>  <b>Desktop</b> : with our user‚Äôs automatic login <br><br>  Here you can set the parameters when loading, which we will do: <br><br><blockquote>  In the light of version 12.2 out of date: <br><br>  setkxbmap -model pc104 -layout us, ru -variant, <br>  Our keyboard has 104 buttons with 2 layouts <br><br>  setkxbmap -option grp: alt_shift_toggle <br>  and it will switch by alt + shift </blockquote><br><br><pre><code class="bash hljs">(sleep 3; xfreerdp -u domain\\user -f server_ip &amp;)</code> </pre> <br>  so that the user does not have the desire to start learning Linux <br>  the delay is necessary if ip-address is received via DHCP, icewm sometimes gets faster. <br>  (or rdesktop -k en-us -u domain \\ user -f server_ip) <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'ShowTaskBar=0'</span></span> &gt;&gt; ~/.icewm/preferences</code> </pre> <br>  hide the taskbar (more fully <a href="http://www.icewm.org/manual/icewm-10.html">here</a> ) <br><br>  For special custom settings, you can register additional commands in any number of. <br><br>  For the first run settings, go to the next section: <br><br><h6>  Scripts </h6><br>  In the section First Boot add a couple of lines: <br>  OpenSuse 12.1 <br><pre> <code class="bash hljs">grep -rl <span class="hljs-string"><span class="hljs-string">'timeout 10'</span></span> /boot/grub/ | xargs perl -i -pe <span class="hljs-string"><span class="hljs-string">"s/timeout 10/timeout 0/g;"</span></span></code> </pre> <br>  OpenSuse 12.2 (Grub2) <br><pre> <code class="bash hljs">grep -rl <span class="hljs-string"><span class="hljs-string">'GRUB_TIMEOUT=10'</span></span> /etc/default/grub | xargs perl -i -pe <span class="hljs-string"><span class="hljs-string">"s/GRUB_TIMEOUT=10/GRUB_TIMEOUT=0/g;"</span></span></code> </pre> <br>  set the timeout for selecting OS boot options 0 seconds <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'* * * * * if ! ps -U tux | grep xfreerdp &amp;&amp; ps -U tux | grep icewm; then perl /home/rdp_conn_cnt; fi'</span></span> &gt;&gt; /var/spool/cron/tabs/tux</code> </pre> <br>  Add to our user (who may accidentally end the RDP session, autostart RDP client).  Optionally, you can make a smaller period of time. <br><br><pre> <code class="bash hljs">chmod u+s /sbin/shutdown</code> </pre> <br>  We use our user to turn off the computer <br><br><pre> <code class="bash hljs">chmod u+s /sbin/ipconfig</code> </pre> <br>  and watch ip <br><br><h6>  Files </h6><br>  Actually, here I have uploaded my simple script that counts the number of attempts to launch RDP when the user has not entered anything.  When the number of attempts expires, the system will shut down. <br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl $counter = 0; if (-e "/tmp/rdp_cnt.tmp"){ open (FN, "/tmp/rdp_cnt.tmp") or die "$_"; $cnttext=&lt;FN&gt;; close FN; $counter = $1 if ($cnttext =~ /(\d+)/); } if ($counter++ &lt; 10){ system("export DISPLAY=:0 &amp;&amp; xfreerdp -u domain\\\\user -f server_ip"); open (FN, "&gt;/tmp/rdp_cnt.tmp") or die "$_"; print FN $counter."\n"; close FN; } else { unlink("/tmp/rdp_cnt.tmp") if (-e "/tmp/rdp_cnt.tmp"); system ("systemctl poweroff"); }</span></span></code> </pre><br><br><h6>  Build </h6><br>  To build an image ready! <br>  Make Preload ISO (.iso) and can be set. </div><p>Source: <a href="https://habr.com/ru/post/144822/">https://habr.com/ru/post/144822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144816/index.html">Facebook buys Opera?</a></li>
<li><a href="../144817/index.html">Easy way or 0 Step Checkout in Magento</a></li>
<li><a href="../144819/index.html">Viruses with a radical. Again!</a></li>
<li><a href="../144820/index.html">Taxes in the USA. Part 1. Introduction, income tax, federal tax, state tax, Social Security taxes</a></li>
<li><a href="../144821/index.html">OASIS standardizes the open OData protocol</a></li>
<li><a href="../144823/index.html">How WarCraft 3 helped me in programming</a></li>
<li><a href="../144824/index.html">Release Notepad ++ 6.1.3</a></li>
<li><a href="../144825/index.html">Another example that rumors are worth serious money</a></li>
<li><a href="../144826/index.html">Java IQ test</a></li>
<li><a href="../144827/index.html">"Nahlobuchka" - all</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>