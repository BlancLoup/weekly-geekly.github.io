<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to write logs (?)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The theme may be trivial, but when the program starts to work as something wrong, and generally behave very strange, you often have to read the logs. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to write logs (?)</h1><div class="post__text post__text-html js-mediator-article">  The theme may be trivial, but when the program starts to work as something wrong, and generally behave very strange, you often have to read the logs.  And a lot of logs, especially if there is no possibility to debug the program and fail to reproduce the error.  Probably everyone has developed some rules for himself, what, how and when to log.  Below I want to consider several rules for writing messages to the log, and there will also be a small comparison of logging libraries for php, ruby ‚Äã‚Äãand go.  Log collectors and delivery systems will not be deliberately considered (they have been discussed many times already). <br><a name="habracut"></a><br>  There is such a linux utility, as well as a network protocol called syslog.  And there is a whole set of RFC dedicated to syslog, one of them describes the logging levels <a href="https://en.wikipedia.org/wiki/Syslog">https://en.wikipedia.org/wiki/Syslog#Severity_level</a> ( <a href="https://tools.ietf.org/html/rfc5424">https://tools.ietf.org/html/rfc5424</a> ).  According to rfc 5424, 8 levels of logging are defined for syslog, for which a brief description is also given.  These logging levels were adopted by many popular loggers for various programming languages.  For example, <a href="http://www.php-fig.org/psr/psr-3/">http://www.php-fig.org/psr/psr-3/</a> defines the same 8 levels of logging, and the standard Ruby logger uses a slightly reduced set of 5 levels.  Despite the formal indication of when this or that level of logs should be used, a combination like debug / info / fatal is often used - the first one is used for logging during development and testing, the second and the third are taken into account for production.  Then, at some point in the production, something incomprehensible starts to happen and suddenly it turns out that info logs are not enough - we are running to enable debug.  And if they do not heavily load the system, they often remain included in the production environment.  In fact, there are two scenarios when you need to have logs: <br><br><ul><li>  something happens and you need to know what </li><li>  something broke and you need to additionally activate the trigger </li></ul><br>  The trigger can occur: error notification by email, crash or restart of the program or other typical scenarios. <br><br>  In the Go language in which everything is simplified to the limit, the standard logger is also decently cut off and left the following options: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Fatal - output to the log and immediate output to the OS. </li><li>  Panic - output to the log and the excitement of "panic" (analogue exceptions) </li><li>  Print - just displays a message in the log </li></ul><br>  It is almost impossible to get confused about what to use in a specific situation.  But messages in such a strongly truncated form are difficult to analyze, as well as to set up warning systems that typically respond to some kind of Alert \ Fatal \ Error in the text of the log. <br><br>  When I write a program from scratch, I often use the debug level for logging with the expectation that the level of info logging will be set on the production and thus the noisiness of messages will be reduced.  But in this approach, there is often a situation that logs suddenly become missed.  It is difficult to guess what information is needed to catch a rare bug.  It is possible to always use the default info level by default, and error handlers in error handlers and above.  But if you have hundreds and more log messages per second, then you probably have a sense of fine-tuning between info / debug.  In such situations, it already makes sense to use specialized solutions so as not to squander performance. <br><br>  There is also a subtle moment when you write something like <code>logger.debug(entity.values)</code> - then, if the logging level is set higher, the debug content of entity.values ‚Äã‚Äãwill not be included in the log, but it will be calculated every time after eating the resources.  In Ruby, you can pass a block of code instead of a message line to a <code>Logger.debug { entity.values }</code> : <code>Logger.debug { entity.values }</code> .  In this case, the calculations will occur only when the appropriate log level is set.  In the Go language, to implement lazy evaluation, an object supporting the Stringer interface can be passed to the logger. <br><br>  After you have figured out using log levels, you need to be able to bind disparate messages, this is especially true for multi-threaded applications or related services, when all messages are mixed up in logs. <br><br>  The typical format of a message line in a log can be divided into the following components: <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[system info]</span></span> + <span class="hljs-selector-attr"><span class="hljs-selector-attr">[message]</span></span> + <span class="hljs-selector-attr"><span class="hljs-selector-attr">[context]</span></span></code> </pre> <br>  Where: <br><br><ul><li>  <code>system info</code> : time stamp, process id, thread id and other service information </li><li>  <code>message</code> : <code>message</code> text </li><li>  <code>context</code> : any additional information, the context may be common to the messages within an operation. </li></ul><br>  In order to associate request / response pairs, the http header <code>X-Request-ID</code> often used.  Such a header can be generated by the client, or it can be generated on the server side.  Adding it to the context of each line of the log will allow you to easily find all messages arising from the execution of a specific query with a slight movement of your hand.  And in the case of distributed systems, the header can be passed on through the network call chain. <br><br>  But with a single context within the request, there is a problem with various ORM, http clients or other services / libraries that live their own lives.  And it‚Äôs still good if they provide an opportunity to redefine your standard logger at least globally, but setting the context for the logger within the query is often not realistic.  This problem is mainly relevant for multi-threaded processing, when one process serves multiple requests.  But for example, in the Rails framework, there is a very tight integration between all components and ActiveRecord requests can be written to the log along with the global context for the current network request.  And in the Go language, some logging libraries allow you to dynamically create a new logger object with the desired context, it looks like this: <br><br><pre> <code class="hljs pgsql">reqLog := <span class="hljs-keyword"><span class="hljs-keyword">log</span></span>.WithField("requestID", requestID)</code> </pre> <br>  After that, such an instance of the logger can be transferred as a dependency to other objects.  But the absence of a standardized logging interface (for example, as psr-3 in php) provokes the creators of hardcod libraries of low-compatible implementations of loggers.  Therefore, if you write your library on Go and it has a logging component, do not forget to provide an interface for replacing the logger with a custom one. <br><br>  Summarizing: <br><br><ul><li>  Log in abundance.  You never know in advance how much and what information in the logs will be needed at a critical moment. </li><li>  Eight levels of logging - do you really need so much?  By experience, a maximum of 3-4 should suffice, and then provided that event handlers are configured for them. </li><li>  If possible, use lazy calculations to display messages in the log </li><li>  Always add the current context to each log message, at least the requestID. </li><li>  If possible, customize third-party libraries so that they use the logger with the current request context. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/327834/">https://habr.com/ru/post/327834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327806/index.html">Repair without screwdrivers, COM ports and 7 years of spare parts availability: how iron reliability is provided for stores</a></li>
<li><a href="../327810/index.html">No ruby ‚Äã‚Äãone</a></li>
<li><a href="../327820/index.html">The past and the future of cellular communication in areas where there is no GSM</a></li>
<li><a href="../327822/index.html">4 cool game development stuff</a></li>
<li><a href="../327824/index.html">Linux / Shishiga malware uses Lua scripts</a></li>
<li><a href="../327836/index.html">Part 1. Where to store data for decentralized applications on the blockchain?</a></li>
<li><a href="../327838/index.html">We live and work not in capitals: software development market in Nizhny Novgorod</a></li>
<li><a href="../327842/index.html">MP3 finally goes public domain</a></li>
<li><a href="../327844/index.html">Dell EMC Announces ESG 2017 IT Transformation Maturity Curve Survey Results</a></li>
<li><a href="../327858/index.html">What voice does your company say?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>