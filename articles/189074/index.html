<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn xrdp to connect to past sessions.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="XRDP is a good thing, but there is one drawback - if you have already opened for the session, and then disconnected (without leaving the session), the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn xrdp to connect to past sessions.</h1><div class="post__text post__text-html js-mediator-article">  XRDP is a good thing, but there is one drawback - if you have already opened for the session, and then disconnected (without leaving the session), then later it‚Äôs not a fact that you can connect to it.  I had a decent time with this until the inconvenience reached a critical point and I decided to take it and look at the source code to find out how to fix it. <br><br>  The method does not claim to be ideal, of course it would be good of course to even put a commit to the developer, but for this you need not just stupidly comment out the lines below, but add at least an option that allows you to turn on a less intelligible mode when defining - open a new session or use the old one.  In addition, it is necessary to check the correctness of the algorithm with the legible mode turned off, which I have not done yet, because I tested it - it works, and I am glad, because for me now, first of all, practical value is important. <br><br>  Well, let's start.  The essence of the method is to comment on the following five lines in the sessman / session.c file: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (g_strncmp(name, tmp-&gt;item-&gt;name, <span class="hljs-number"><span class="hljs-number">255</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//&amp;&amp; //tmp-&gt;item-&gt;width == width &amp;&amp; //tmp-&gt;item-&gt;height == height &amp;&amp; //tmp-&gt;item-&gt;bpp == bpp &amp;&amp; //tmp-&gt;item-&gt;type == type )</span></span></code> </pre> <br>  I will explain.  Here existing sessions are scanned and a check is made from which user and which resolution, color depth, type (VNC, XRDP) is planned to open the session.  If there is a session with the same parameters, then connect to the same session.  If not, open a new one.  Conditions: resolution, color depth, session type, I decided to disable. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Now I will describe how I implement it using the example of, say, the Scientific Linux distribution (it will also work for Fedora, Red Hat, CentOS).  <b>We also take into account that xrdp is not in the standard Scientific Linux repositories, we will have to connect additional ones</b> (I‚Äôm not going to write about this here, the topic is being googled at a time). <br>  Install the necessary tools: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum groupinstall "Development tools" # yum install yum-utils rpmdevtools tar</span></span></code> </pre><br>  Download the project's raws, and install them in the working directory of the rpm collector: <br><pre> <code class="bash hljs">$ yumdownloader --<span class="hljs-built_in"><span class="hljs-built_in">source</span></span> xrdp $ rpm -ivh xrdp-0.5.0-0.13.el6.src.rpm</code> </pre><br>  The file name will not necessarily be xrdp-0.5.0-0.13.el6.src.rpm, depending on what you downloaded the first command.  Here is the file downloaded for Scientific Linux. <br><br>  Files will appear in the working folder of the rpm collector, incl.  ~ / rpmbuild / SOURCES / xrdp-HEAD - *. tar.gz.  This file will not need to be unpacked, ie: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/SOURCES $ tar -xzf xrdp-HEAD-a9cfc23.tar.gz</code> </pre><br><br>  Install everything you need to build: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># yum-builddep ~/rpmbuild/SPECS/xrdp.spec</span></span></code> </pre><br><br>  Now we look for the file we specified at the beginning and open it with some kind of text editor, for example, nano: <br><pre> <code class="bash hljs">$ nano ~/rpmbuild/SOURCES/xrdp-HEAD-a9cfc23/sesman/session.c</code> </pre><br>  We find the necessary lines, modify them exactly as I indicated above, <b>be sure not to forget to move the bracket in the last line to a new one and comment out the ampersands at the end of the first line</b> (I moved them to a new line for clarity). <br><br>  We pack this case back: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~/rpmbuild/SOURCES $ tar -czf xrdp-HEAD-a9cfc23.tar.gz xrdp-HEAD-a9cfc23</code> </pre><br><br>  It remains the case for small - to collect the modified rpm: <br><pre> <code class="bash hljs">$ rpmbuild -ba ~/rpmbuild/SPECS/xrdp.spec</code> </pre><br>  If everything went fine, then in ~ / rpmbuild / RPMS / x86_64 / we get two rpm files: <br><pre> <code class="bash hljs">$ ls -l  664 -rw-rw-r--. 1 rafaelrs rafaelrs 243152  5 07:41 xrdp-0.5.0-0.13.el6.x86_64.rpm -rw-rw-r--. 1 rafaelrs rafaelrs 430620  5 07:41 xrdp-debuginfo-0.5.0-0.13.el6.x86_64.rpm</code> </pre><br>  Install the first package, start the service and enjoy life :) <br><pre> <code class="bash hljs">yum install ~/rpmbuild/RPMS/x86_64/xrdp-0.5.0-0.13.el6.x86_64.rpm service xrdp start</code> </pre><br><br>  By the way, yes, do not forget that if suddenly the package is updated, the changes we have made will be lost.  You can repeat the operation, you can include xrdp in the list of exceptions, you can rename the application altogether.  There is a matter of taste, I stopped at the first, the benefit of xrdp is not so often updated. </div><p>Source: <a href="https://habr.com/ru/post/189074/">https://habr.com/ru/post/189074/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189062/index.html">Summer School on Bioinformatics</a></li>
<li><a href="../189064/index.html">Excel Turing Machine</a></li>
<li><a href="../189066/index.html">Physics of radiation effects on electronics in space</a></li>
<li><a href="../189068/index.html">An example of image segmentation using PHP</a></li>
<li><a href="../189070/index.html">Channel consolidation, or solution of one telecommunication problem</a></li>
<li><a href="../189078/index.html">Huawei Enterprise and Landata Webinar "Review of new products for video conferencing" August 14, 2013</a></li>
<li><a href="../189080/index.html">The history of the creation of X-COM: Enemy Unknown (1993)</a></li>
<li><a href="../189082/index.html">Battery review for 5500mAh for Galaxy S4</a></li>
<li><a href="../189084/index.html">Promises in AngularJS</a></li>
<li><a href="../189086/index.html">Basics of IIS architecture, or query pipeline for ASP.NET</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>