<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data mining in online games</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In all online services and games, the largest share of the audience goes right at the start - in the first minutes and hours of familiarity with the p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data mining in online games</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/8522bf5d/cae5dca6/4377bf92/a18f7fd3.jpg" alt="Aion" align="left">  In all online services and games, the largest share of the audience goes right at the start - in the first minutes and hours of familiarity with the product.  Hundreds of books and articles are already devoted to this topic with a variety of hypotheses of success and reasons for audience loyalty - uniqueness, simplicity, usability, gratuity, training or instruction, emotionality, and many more factors are considered extremely important. <br><br>  We wanted to know <b>why the players are leaving</b> and whether <b>their withdrawal</b> can be <b>predicted</b> .  The subject of the research is MMORPG Aion, however, our results were applicable to a wide range of games and online services. <br><a name="habracut"></a><br>  Almost <i>British scientists</i> found that the user has a very short memory.  Today he left the game, but tomorrow he will not remember that he installed it at all.  If the player is gone, then you must act <b>immediately</b> .  But how can we determine whether a person has really left, or is he just drinking beer with friends tonight and will not appear in the game?  The ideal case would be a prediction of potential withdrawal even before the user left us.  And even before the thought arose in his mind that Aion did not look like a cake.  Probably, such a task is also solved, but we set a more realistic goal - to <b>promptly predict the departure of the game on the day of the last login</b> .  As a departure, we‚Äôll call a person‚Äôs inactivity during the week - and we don‚Äôt want to wait for these 7 days, but we want to know as soon as possible that the player will not return.  We want to know the future! <br><br><h2>  Technical side </h2><br>  For analysis, we had a sea of ‚Äã‚Äãinformation - Aion has the best logging system that I saw among the Korean games, we literally know about the player his every move, every sneeze and every trace he left on the server.  The period for analysis - the first nine levels in the game, about 10 starting hours of gameplay - for this period about half of all beginners fell off. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A part of the resources of our analytics system was allocated for the project - two Dual Xeon E5630 32Gb RAM server blades, 10 Tb cold storage for source and intermediate data, 3 Tb hot storage in a RAID10 SAS array for business data.  Both servers for MS SQL 2008R2 are one for the database and one for Analysis Services.  The software part of the solution is Microsoft's standard Business Intelligence package included in SQL Server. <br><br><h2>  Phase 1 - I know everything! </h2><br>  Since I was a game designer for many years and spent under a hundred playtests, I was sure that even now <i>expert opinion</i> will give 90% of the answers why the players are leaving.  I did not learn how to use teleportation, I got tired of running around with my legs - I left.  He died from the first monster in the game - left.  I did not fulfill the second mission, I was stuck and I don‚Äôt know what to do - I left.  Aion, with all its quality and manufacturability, is not the most beginner-friendly game.  This is a feature of all Korean games designed for the hardcore and hypersocial environment of Korean players, and not the lonely bored Russian casual users. <br><br>  I put on the hat of the ‚Äúordinary user‚Äù and went through the free start of the game for both races and several classes, writing out all the clumsiness, illogicalities and problems, having formed the first <b>list of hypotheses</b> to test: <br><ul><li>  Race and class of characters.  It was assumed that the class will be the strongest factor, since the gameplay for the Healer is very different from the mage squinting all right and left. </li><li>  If a person has played other games - we have a single account for all projects, so it is easy to follow the cross-conversion. </li><li>  Did the player try more than 1 character - did the other classes and race know it? </li><li>  How many times he died at levels 1-4, 5-7 and how many times he died during the trial. </li><li>  Did you join groups with other players, including high-level ones (i.e., obviously familiar with other games or in real life) </li><li>  How much computer memory, because Aion is resource intensive </li><li>  Whether the character received mail and entered the guild is a clear sign of "twinks", secondary characters created by already active and experienced players. </li><li>  How many tasks did the character perform to this level, how many tasks did he cancel and how many did not he simply take </li><li>  Does the player pass in-game polls for which give good buns </li><li>  What skills does a character use in combat and kill monsters </li></ul><br>  The list turned out to be impressive, detailed to the point, and a number of ways were found to upset the novice before losing the desire to play.  We get into the model the first couple of hypotheses, we predict the boolean variable <b>is_leaver</b> - will the player leave right now, at the 7th level: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/6d835694/e289d83c/37cebb5c/86990154.jpg"></div><br>  <i>How to read a lift chart: the lower oblique straight line is the result of a random number generator that predicts our boolean variable using the scientific method of throwing a coin.</i>  <i>The top line, quickly reaching 100%, is the oracle, the ideal predictor of the future.</i>  <i>Between them there is an uneven, trembling thread - this is our model.</i>  <i>The closer the graph is to the ideal line, the higher the predictive accuracy of the model.</i>  <i>The graph is for level 7, but the picture is similar from first to ninth.</i> <br><br>  <b>Fatality!</b>  Our first model predicts players leaving a little bit better than heads and tails.  We send the remaining hypotheses to the models, clean the data, process it: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/7903f273/9b39600f/c3f1b988/eec8be92.jpg"></div><br>  Already better, but still the accuracy is slightly above 50%.  And if you look at recall (errors of the second kind), then the picture is sad: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/0636ffd1/22dce65e/6a586853/927dc7ec.png"></div><br>  <i>The same table is in Russian - out of every 100 predicted by the model of departures, 49 will be false (the player will not go anywhere), the accuracy of the model will be 1008 / (1008 + 982) = 51%.</i>  <i>At the same time, the model will completely miss some of the actual departures - approximately 28% of the truly departed [391 / (391 + 1008) = 28%].</i>  <i>Attention, this is not a canonical definition of recall, but this formula is clearer.</i> <br><br>  <b>The result of phase 1</b> : all the original ideas failed, the prediction does not work.  Chef, it's all gone! <br><br><h2>  Phase 2 - we know nothing </h2><br>  Full defeat and flight from the battlefield, and the eternal question "What to do?".  The <b>naive Bayes algorithm</b> comes to the rescue - the most human-readable and understandable of all data mining classifiers.  The Bayes analysis showed that the selected hypotheses rather poorly characterize the players who left and remain, that is, I was mistaken with the choice of the initial premises.  But, having played with the depth and sensitivity of another algorithm, <b>a decision tree</b> , it became clear that there are correct hypotheses, the tree branches along them, but there are definitely not enough factors - the growth of the tree is interrupted by a 2-3 branch. <br><br>  <i>Without getting into the wilds of mathematics, which I myself don‚Äôt understand, it‚Äôs simplistic - <b>the decision tree algorithm</b> divides the source data into segments with the lowest possible total entropy, that is, the most dissimilar data sets.</i>  <i>If the tree stopped branching, it means that we need new hypotheses and new metrics in the original data in order for the tree to deeper divide the input data stream and better predict the future.</i> <br><br>  I gathered a brainstorm with the project team, where we gushing ideas - who our beginners are, how they play, how they differ from each other.  They remembered the stories of how our friends and wives got to know Aion, and what came of it.  The result of the brainstorm was a supplemented list of individual hypotheses (did the player use teleportation, expanded his inventory, attached a resurrection point, etc.) and a new idea - it would be nice to see how much the <b>activity</b> is different from those who remain in the game. <br><br>  To study the average activity, we calculated several metrics: <br><ul><li>  the number of monsters killed at this level </li><li>  number of tasks completed at the level </li><li>  time in minutes spent at each level </li></ul><br>  At this stage, at the same time, the ETL part of the project (loading, transforming and clearing data) was redone.  Our SQL guru Ilya made an analyzer-designer on SSIS, which easily connects new events from the game logs.  Logs gigabytes, so there was no lack of information, and new hypotheses were invented every day. <br><br>  Downloaded, trained, verified, analyzed.  I will not load you by sea lift charts for each level and each model, I will cite immediately processed and analyzed data: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/fa3e629c/42be1a2b/6584dc03/ad21077b.jpg"></div><br>  <i>The peak of accuracy at level 9 was associated with the internal feature of the game at the time of the study.</i> <br><br>  In general, the picture has improved in the area of ‚Äã‚Äã2-4 levels, but 6-8 below the baseboard, with such accuracy, the data we simply useless. <br><br>  The decision tree cheerfully shows that activity factors are most important for predicting care.  In fact, three quantities ‚Äî time at the level, dead monsters, and quests done ‚Äî determine the lion's share of the departures.  The remaining factors add no more than 5% accuracy.  Also, the tree is still bare, the crown is cut off on the third branch - that is, the model craves for more relevant metrics.  What is still not clear - the accuracy of the three algorithms varies greatly from level to level. <br><br>  <b>The outcome of phase 2</b> : the success of the idea of ‚Äã‚Äãmeasuring average activity, rather than individual factors.  But the prediction accuracy is still unsatisfactory.  The path along the rake brought to the correct sequence of analysis of the results - first the factors and correlations (Bayes), then their influence on the result (the decision tree). <br><br><h2>  Phase 3 - we know where to dig </h2><br>  Inspired by the progress, I outlined three vectors for the development of the project ‚Äî more metrics of total activity, more specific metrics of individual effectiveness, and a deeper study of Microsoft BI tools. <br><br>  Experimenting with activity, we stopped at the following set: <br><ul><li>  Spent time at the current level, at the previous level and the total time in the game to the current moment </li><li>  The rate of killing monsters - pieces per minute at the current level, the previous and all. </li><li>  The speed of completing tasks per minute is similar to mobs. </li><li>  The average time in the game on the game day, days spent in the game and unformed days (for example, a person entered on Monday and Wednesday - 1 day is missing). </li></ul><br>  These metrics gave a good reduction in missed cases, almost one and a half times.  The decision tree began to branch up to 9 nodes, which shows the relevance of the metrics.  Plus, the unification of trees for different levels was a good sign - if in the last phase, as I wrote, the accuracy of algorithms strongly jumped from level to level, now it was clearly visible - the tree beats on the first, second, and third nodes according to exactly the same indicators regardless of character level.  And naive Bayes is already 5-10 percent behind the tree and neural network. <br><br>  I had to tinker with new individual metrics related to the depth of the gameplay and the effectiveness of the game, for example, the percentage of auto-attacks.  We segmented the characters into classes (warriors to the right, healers to the left) and for each class calculated the 25th, 50th and 75th percentiles of the %% auto-attack distributions, and divided them into 4 categories.  Now the <b>data is normalized</b> , and game classes can be compared with each other - the number of the category goes to the input of data mining models. <br><br>  <i>In online games, characters kill enemies with different spells and abilities.</i>  <i>An auto-attack is a free, very basic (and weak) blow given from birth.</i>  <i>If a player is effective, then he applies the abilities of his character - and %% autoattacks among all his strokes will not be very high.</i>  <i>However, it depends strongly on the game mechanics what kind of percentage for different classes.</i>  <i>In Aion there was a spread from the median of 5% for a mage, up to 70% for a warrior, and even within the class the dispersion is high.</i> <br><br>  Individual metrics were fixed at the depth of the seventh-ninth node of the tree, i.e.  they added a couple of percent to the accuracy of the prediction, but did not improve the situation drastically.  The next step was to study the <a href="http://www.amazon.com/Data-Mining-Microsoft-Server-2008/dp/0470277742">Data Mining with Microsoft SQL Server 2008</a> book on the subtleties of working with Analysis Services.  By itself, the book helped only with setting the sensitivity of the tree (on the strength plus one or two percent increase in accuracy), but suggested the idea of ‚Äã‚Äãcorrect discretization. <br><br>  In the example above with auto-attack, we did <b>manual data sampling</b> - categorization according to some features.  SQL Server automatically performs sampling in several ways.  Experimentally, I quickly realized that the partitioning algorithm and the number of segments greatly influence the predictive power of the model.  Manual change of the number of segments strongly influences the shape and accuracy of the tree.  <b>I spent a week</b> on manual adjustment, scrupulously for each structure of each level (and these are 9 levels with 30+ metrics) experimenting with the number of segments.  For some metrics, 7 segments were optimal (for example, <i>time at the current level</i> ), for some 12 ( <i>total time in the game</i> ), for some more than 20 ( <i>number of dead monsters</i> ). <br><br>  Manual tuning gave a strong increase in the predicted values ‚Äã‚Äã- the accuracy did not increase much, but the models began to make noticeably fewer gaps, and the results of the tree became equal to the neural network: <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/79e14a1b/79369a43/8d108d0e/db501fe6.jpg"></div><br>  <b>The result of phase 3</b> : we reached acceptable levels of accuracy and accuracy and learned a lot of interesting things about our game and our players. <br><br><h2>  Phase 4 - Win Only </h2><br>  I honestly thought that the ceiling had been reached - the tree branches to a depth of 9-12 knots, the accuracy was greatly improved.  New hypotheses do not increase accuracy; new factors do not provide any information.  In principle, the overall accuracy of 78% and recall of 16% is satisfactory to start working with players.  I probably would not, with such figures, give a free subscription to keep in the game, but you can already inform the player of relevant information without any special errors. <br><br>  Help came unexpectedly - as the data mining project lasted for the third month, our logs were somewhat outdated - the game changed during that time.  After loading a little fresh data, and at the same time once again finalizing the ETL procedure, we noticed changes in the models.  On the new data, they behaved differently - with, in general, the same accuracy and accuracy, the partitioning of the tree was different.  At this stage, all three algorithms were trained very quickly - a minute for each level of 9, and it is easy to feed them with an additional set of data. <br><br>  It is said - done, we unload <b>in general all the</b> data accumulated over 3 months and in one fell swoop we send models to study (the process began to take not a minute, but as many as five for each level is not critical).  Another round of manual fit, and here's the result: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/9ae8bd23/7d32ecb1/870acc7f/b5594d46.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/891df2f2/837d2ab1/e98f6fbb/57d3c68e.jpg"></div><br>  Increasing the amount of training data, we made the process longer, but what an excellent result! <br><br>  With the first level, unfortunately, a little can be done - about half of the departures, as Avinash Koshik would say, ‚Äú <b>I came, I puked, I left</b> ‚Äù.  We have data about literally a couple of player actions - and then he closes the game client and never returns. <br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/01f1af28/ffb92b39/2c77194a/3d38c59a.png"></div><br>  I remind you that all the studies above are training on accumulated historical data.  Now I want a battle check!  We check on live data - we take fresh, today's users, we run through the model and save the result of the prediction.  A week later, we compare the predictions of the model with the objective reality - who of the newcomers a week ago did indeed go away, and who remained in the game: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage1/edbdcd4f/d53c08ef/f1a84277/b6698d0c.jpg"></div><br><br><h2>  The most interesting </h2><br>  The first goal of the project - <b>predicting the departure of a novice from the game</b> - has certainly been achieved.  With such accuracy, it is already possible to make decisions on the return of the player, to communicate with him, to motivate him, to give buns.  And this prediction is almost on the day of leaving: a person left the game tonight - tomorrow at 5 am the data were processed and the probability of leaving is already known with high confidence. <br><br>  Has the second goal been reached, do we now know <b>why the players are leaving</b> ?  Not.  And this is the most strange result for me - with an excellent probability of a prediction of leaving, the question ‚ÄúWhy?‚Äù Remains unanswered.  Remember, I started the project with writing out hypotheses about individual factors, like: <ul><li>  Race and character class </li><li>  Did the person play other Innov games? </li><li>  Has the player tried more than 1 character </li><li>  How many times has he died at levels 1-4, 5-7 and how many times has he died </li><li>  Have you joined groups with other players? </li><li>  How much computer memory </li><li>  Did the character receive mail and joined the guild </li><li>  How many tasks did the character perform to this level, how many tasks did he cancel and how many did not he simply take </li><li>  Does the player pass in-game polls </li><li>  What skills does a character use in combat and kill monsters </li></ul>  Such factors have been tested a lot - more than 60. None of them is any significant and decisive player care.  <b>No one!</b>  We did not find in the game some kind of magic barrier that causes the outflow of players. <br><br>  The most important factor?  Has the player gone through the first 7 levels on the very first day of his acquaintance with the game (7 levels are approximately 3 hours of play).  This is a key predictor of care - if in the first session the player did not get carried away and did not spend 3 hours, then it is very likely that he will quit the game.  The next group of factors is the <b>total</b> player <b>activity</b> : <br><ul><li>  Spent minutes in the game at the current level, past and total </li><li>  Minutes of being in the game on average per game day </li><li>  Dead monsters per hour at the current level, past and total </li><li>  The speed of assignments - pieces per hour </li></ul><br>  <b>Summary</b> : we got two completely different results - predicting a player‚Äôs departure based on total activity metrics, and a detailed analysis of the individual playing style.  We accurately predict the departure of each newcomer, and we are able to tell each newcomer a dozen ways how <b>personally he</b> can improve his style of play, how he could play more effectively, use all the features of the game, and have more fun. <br><br><h2>  Victory! </h2><br>  For two months, from scratch - none of us have ever even come close to data mining, - with the help of two books and a desire to try something new, based on the powerful, but passive analytics system in Innova, we made the tool, <b>actively looking to the future</b> .  Unlike conventional reporting and analyzing trends in historical data, at 6 am we already almost certainly know about our yesterday's newcomers in Aion - whether we will see them in the game today or not.  And we can act before it is too late. <br><br>  The analysis was performed for an online game, but as you can see, the main contribution to the prediction accuracy was from generalized activity metrics - and I am sure that the approach will work for any of your product or service that users are actively working with, unless of course you have desire to reach a new level. <br><br>  <i>Ps.</i>  <i>If the topic is interesting to habravchanam, then we can continue - about the prediction of old people leaving, segmentation and clustering, migration between clusters and other data mining projects that we did in the outgoing year.</i> <br><br>  <i>PS2.</i>  <i>The second book, I recommend to absolutely everyone - we <a href="http://www.amazon.com/Programming-Collective-Intelligence-Building-Applications/dp/0596529325">program the collective mind</a></i> </div><p>Source: <a href="https://habr.com/ru/post/134163/">https://habr.com/ru/post/134163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134154/index.html">The difficulty of administering guest hotspots. Practice (part 2)</a></li>
<li><a href="../134157/index.html">Vulnerability in Facebook has opened access to private photo users (including Zuckerberg)</a></li>
<li><a href="../134158/index.html">Registering global hotkeys using WPF</a></li>
<li><a href="../134160/index.html">Training course. Creating a complex data model for an ASP.NET MVC application, part 2</a></li>
<li><a href="../134161/index.html">Lenovo has released a secure laptop for students and schoolchildren.</a></li>
<li><a href="../134165/index.html">Distributive for assessing the decentralized file system Tahoe-LAFS</a></li>
<li><a href="../134167/index.html">Automatic parsing of letters coming to tech support</a></li>
<li><a href="../134168/index.html">Public election control using cloud IT</a></li>
<li><a href="../134169/index.html">Changing the type of data output in LogCat</a></li>
<li><a href="../134170/index.html">ABBYY FineFoto: a fan from the camera</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>