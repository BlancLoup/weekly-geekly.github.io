<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As Asterisk opened barriers for me</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, residents of Habra. 

 I want to share an interesting, in my opinion, use of Asterisk. 

 Preface : the client has two parking lots, t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As Asterisk opened barriers for me</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/93e/a2e/536/93ea2e53618f4927b7a9914413359423.jpg" alt="image"><br><br>  Good afternoon, residents of Habra. <br><br>  I want to share an interesting, in my opinion, use of Asterisk. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Preface</b> : the client has two parking lots, the entrance to which is regulated by barriers with gsm-modules.  That is, the owner of the parking space dials the number of the SIM card installed in the module and enters the territory.  But, as you know, if the number knows one - everyone knows it, so paid parking is randomly turning into free.  The feature of the gsm-module is that the call passes without lifting the handset, respectively, the telecom operator cannot provide call detailing by number. <br><br>  Here I had to work with such initial data, what came out of it - under the cut. <br><br><a name="habracut"></a><br><br>  After thinking about the implementation options, I once again realized that here Asterisk will help solve this problem.  What is ultimately required by the client: <br><ul><li>  The ability to "hide" the number of the SIM card installed in the barrier </li><li>  Forming a "white list" of numbers that can open the barrier </li><li>  The ability to add / delete / view the base of numbers of the "white" list as simply as possible </li><li>  Reporting on the opening of the barrier and calls from numbers that are not in the list </li></ul><br><br>  The project implementation scheme is the following: <br><br><ol><li>  In the barrier changing SIM cards </li><li>  The SIP-provider buys numbers that the owners of parking spaces will call, thus we add a new level of abstraction: no one knows the SIM-card numbers (and since the SIM in the barrier doesn‚Äôt answer (), then charge money for calls from the provider with we will not) </li><li>  We implement the white list function, that is, we get the second step of protection: first, you need to know the sip number to call, and secondly, your number should be allowed to call on the SIM card </li><li>  We realize the ability to manipulate the "white" list through a simple web interface </li><li>  Every morning we send the employee responsible for controlling access to reports by e-mail </li></ol><br><br>  So, let's proceed directly to the description of the configuration process: <br><br><h5>  LAMP installation </h5><br>  Described many times, you can see for example <a href="http://help.ubuntu.ru/wiki/apachemysqlphp">here</a> <br><br><h5>  Assembling and configuring Asterisk with ODBC support </h5><br>  There are a lot of Asterisk installation manuals, we will not repeat, I‚Äôll just note that Asterisk must be built with odbc support (the installation is described for Ubuntu Server 14.04), for this we need to install the necessary libraries: <br><br><pre><code class="bash hljs">sudo aptitude install unixodbc unixodbc-dev libmyodbc</code> </pre> <br><br>  And collect Asterisk, not forgetting to put a checkmark in the menuselect opposite res_odbc, func_odbc.  Next, you need to register the loading of the odbc module: <br><br><pre> <code class="bash hljs">vim /etc/asterisk/modules.conf load =&gt; res_odbc.so ;;     [modules]</code> </pre><br><br>  In the file /etc/odbcinst.ini we write the paths for the drivers: <br><pre> <code class="bash hljs">[MySQL] Description = MySQL driver Driver = /usr/lib/x86_64-linux-gnu/odbc/libmyodbc.so Setup = /usr/lib/x86_64-linux-gnu/odbc/libodbcmyS.so CPTimeout = CPReuse =</code> </pre><br><br>  In the /etc/odbc.ini file we describe the odbc connection parameters: <br><br><pre> <code class="bash hljs">[asterisk-barrier] Driver = MySQL Description = Connector/ODBC 3.51 Driver DSN Server = localhost Port = 3306 User = root Password = VeryStrongPassword Database = barrier Socket = /var/run/mysqld/mysqld.sock Charset = utf8</code> </pre><br><br>  In the /etc/asterisk/res_odbc.conf file, describe the odbc connection parameters: <br><pre> <code class="bash hljs">[asterisk-barrier] enabled =&gt; yes dsn =&gt; asterisk-barrier username =&gt; root password =&gt; VeryStrongPassword pooling =&gt; no <span class="hljs-built_in"><span class="hljs-built_in">limit</span></span> =&gt; 1 pre-connect =&gt; yes</code> </pre><br><br>  To display Russian characters correctly, uncomment the line in /etc/php5/apache2/php.ini: <br><pre> <code class="bash hljs"> default_charset = <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span></code> </pre><br><br><h5>  Next, in MySQL, we create the base and table we need: </h5><br><br><pre> <code class="bash hljs">mysql -uroot -pVeryStrongPassword</code> </pre><br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> barrier; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> barrier; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`phone`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">30</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">ENGINE</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">InnoDB</span></span> AUTO_INCREMENT=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CHARSET</span></span>=utf8 ;</code> </pre><br><br>  Add to the created plate our ‚Äúwhite‚Äù list of numbers: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-string"><span class="hljs-string">`numbers`</span></span> (<span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">'79260000000'</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>), (<span class="hljs-string"><span class="hljs-string">'79261111111'</span></span>,<span class="hljs-string"><span class="hljs-string">' '</span></span>);   </code> </pre><br><br>  After that, restart Asterisk: <br><br><pre> <code class="bash hljs">/etc/init.d/asterisk restart</code> </pre><br><br>  And we check the correctness of the odbc settings, for this we write in the asterisk console: <br><br><pre> <code class="bash hljs">odbc show all</code> </pre><br><br>  If everything is correct, then we should see something like this: <br><img src="https://habrastorage.org/files/958/8f6/c4b/9588f6c4b1e5458b8886a76734d3dbad.png"><br><br><div class="spoiler">  <b class="spoiler_title">Next, set up providers in sip.conf:</b> <div class="spoiler_text"><pre> <code class="bash hljs">;;      ,        register =&gt; login:password@sip.provider.com/74990000000 register =&gt; login:password@sip.provider.com/74991111111 [prov1] accept_outofcall_messages=no host=sip.provider.com <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=peer secret=YourPass defaultuser=YourLogin fromdomain=sip.provider.com fromuser=YourLogin canreinvite=no jbenable=no faxdetect=yes t38pt_udptl=yes,fec,maxdatagram=400 context=from-trunk dtmfmode=auto port=5060 disallow=all allow=g722 allow=ulaw allow=alaw insecure=port,invite qualify=yes sendrpid=yes [prov2] accept_outofcall_messages=no host=sip.provider.com <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=peer secret=YourPass defaultuser=YourLogin fromdomain=sip.provider.com fromuser=YourLogin canreinvite=no jbenable=no faxdetect=yes t38pt_udptl=yes,fec,maxdatagram=400 context=from-trunk dtmfmode=auto port=5060 disallow=all allow=g722 allow=ulaw allow=alaw insecure=port,invite qualify=yes sendrpid=yes</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">In func_odbc.conf, we write a function that will look up the caller's number in MySQL and return its name to us</b> <div class="spoiler_text"><pre> <code class="bash hljs">[MOBILE] dsn=asterisk-barrier readsql=SELECT name FROM numbers WHERE phone = <span class="hljs-string"><span class="hljs-string">'${CALLER}'</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">In extensions.conf we write a dialplan, according to which, if the number is in the database, we will redirect the call to the number of the SIM card of the barrier, otherwise - hang up</b> <div class="spoiler_text"><pre> <code class="bash hljs">[from-trunk] ;;    exten =&gt; 74990000000,1,NoOp(Incoming call from <span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span> to prov1) same =&gt; n,Set(CALLER=<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>) ;;      CALLER,       func_odbc same =&gt; n,Set(result=<span class="hljs-variable"><span class="hljs-variable">${ODBC_MOBILE()}</span></span>) ;; sql-,         same =&gt; n,Set(foo=<span class="hljs-variable"><span class="hljs-variable">${ISNULL(${result}</span></span>)}) ;;       ,   ISNULL  0,   - 1 same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${foo}</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"0"</span></span>]?6:7) ;;   ,  0 -    6, 1 -  7 same =&gt; n,GoTo(barrier1,s,1) ;;     - same =&gt;n,Hangup() ;; ,       ;;    exten =&gt; 74991111111,1,NoOp(Incoming call from <span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span> to prov2) same =&gt; n,Set(CALLER=<span class="hljs-variable"><span class="hljs-variable">${CALLERID(num)}</span></span>) same =&gt; n,Set(result=<span class="hljs-variable"><span class="hljs-variable">${ODBC_MOBILE()}</span></span>) same =&gt; n,Set(foo=<span class="hljs-variable"><span class="hljs-variable">${ISNULL(${result}</span></span>)}) same =&gt; n,GotoIf($[<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${foo}</span></span></span><span class="hljs-string">"</span></span> = <span class="hljs-string"><span class="hljs-string">"0"</span></span>]?6:7) same =&gt; n,GoTo(barrier2,s,1) same =&gt; n,Hangup() exten =&gt; h,1,System(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"   </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CALLERID(NUM)}</span></span></span><span class="hljs-string">     </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STRFTIME(${EPOCH}</span></span></span><span class="hljs-string">,,%d.%m.%Y  %H:%M)}"</span></span> &gt;&gt; /tmp/FAIL.txt) ;;     ,    ,       ,     [barrier1] exten =&gt; s,1,Dial(SIP/prov1/79150000000) ;;     ,           -  same =&gt; n,Hangup() exten =&gt; h,1,System(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"    </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CALLERID(NUM)}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${result}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STRFTIME(${EPOCH}</span></span></span><span class="hljs-string">,,%d.%m.%Y  %H:%M)}"</span></span> &gt;&gt; /tmp/SUCCESS.txt) ;;       ,       [barrier2] ;;      - exten =&gt; s,1,Dial(SIP/prov2/7915111111) same =&gt; n,Hangup() exten =&gt; h,1,System(<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"    </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${CALLERID(NUM)}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${result}</span></span></span><span class="hljs-string"> </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${STRFTIME(${EPOCH}</span></span></span><span class="hljs-string">,,%d.%m.%Y  %H:%M)}"</span></span> &gt;&gt; /tmp/SUCCESS.txt)</code> </pre><br></div></div><br><br><h5>  Sending reports to e-mail </h5><br><br>  To implement the sending of reports, we will use the mutt mail client due to the fact that it can attach files to the mail.  Install mutt: <br><br><pre> <code class="bash hljs">sudo aptitude install mutt</code> </pre><br><br>  And in cron, we add actions to send the reporting files (I do this at 9 am and at 9.01 am deleting them so that only fresh data is recorded in the reporting day) <br><br><pre> <code class="bash hljs">sudo crontab -e 0 9 * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"C.    "</span></span> | mutt -a <span class="hljs-string"><span class="hljs-string">"/tmp/FAIL.txt"</span></span> -s <span class="hljs-string"><span class="hljs-string">"  "</span></span> -e <span class="hljs-string"><span class="hljs-string">"set from="</span></span>asterisk@domen.ru<span class="hljs-string"><span class="hljs-string">""</span></span> -e <span class="hljs-string"><span class="hljs-string">"set realname='Asterisk'"</span></span> -- recipient@client.ru 1 9 * * * rm -rf /tmp/FAIL.txt 0 9 * * * <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">".    "</span></span> | mutt -a <span class="hljs-string"><span class="hljs-string">"/tmp/SUCCESS.txt"</span></span> -s <span class="hljs-string"><span class="hljs-string">" "</span></span> -e <span class="hljs-string"><span class="hljs-string">"set from="</span></span>asterisk@domen.ru<span class="hljs-string"><span class="hljs-string">""</span></span> -e <span class="hljs-string"><span class="hljs-string">"set realname='Asterisk'"</span></span> -- recipient@client.ru 1 9 * * * rm -rf /tmp/SUCCESS.txt</code> </pre><br><br>  As a result, the client receives mail reports of the following type: <br><br><img src="https://habrastorage.org/files/6e8/b19/f1f/6e8b19f1ffb5490da9223f80419891f0.png"><br><br>  Now let's implement the ability to manipulate the white list.  Yes, there certainly is phpmyadmin, but the task was to implement the simplest interface, not overloaded with extra fields that could ‚Äúscare‚Äù the operator.  To do this, several simple forms were written in php that allow you to view the numbers in the database, delete and add them (I don‚Äôt pretend to the correct code, I don‚Äôt know how to code php a bit more than completely).  What came of it is in the screenshots below: <br><br><div class="spoiler">  <b class="spoiler_title">Home page</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ce3/8c6/ee1/ce38c6ee14da4883bcdd55567b6ea606.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Add a number to the database</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c4f/e73/9bf/c4fe739bfaf1412db2ee1ae1cd2e0930.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Delete a number from the database</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/dc8/a55/89c/dc8a5589ca7d438f88ff157f17d665b4.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">View a list of numbers in the database</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0e2/d75/799/0e2d75799e9e47c7b408544796a64d7b.png"><br></div></div><br><br>  And the code itself: <br><br><div class="spoiler">  <b class="spoiler_title">index.php</b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"add_form.php"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remove_form.php"</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"show.php"</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">add_form.php</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;p&gt; &lt;table width=<span class="hljs-string"><span class="hljs-string">"300"</span></span> border=<span class="hljs-string"><span class="hljs-string">"1"</span></span> bordercolor=<span class="hljs-string"><span class="hljs-string">"#630000"</span></span> cellpadding=<span class="hljs-string"><span class="hljs-string">"3"</span></span> cellspacing=<span class="hljs-string"><span class="hljs-string">"0"</span></span>&gt; &lt;tr&gt;&lt;td&gt; &lt;font size=<span class="hljs-string"><span class="hljs-string">"2"</span></span> face=<span class="hljs-string"><span class="hljs-string">"verdana,arial,georgia"</span></span> color=<span class="hljs-string"><span class="hljs-string">"#630000"</span></span>&gt;   .&lt;/font&gt; &lt;form action=<span class="hljs-string"><span class="hljs-string">"insert.php"</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> placeholder=<span class="hljs-string"><span class="hljs-string">".  "</span></span> name=<span class="hljs-string"><span class="hljs-string">"phonee"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> placeholder=<span class="hljs-string"><span class="hljs-string">". 79261234567"</span></span> name=<span class="hljs-string"><span class="hljs-string">"namee"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"send"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;/form&gt; &lt;/td&gt;&lt;/tr&gt; &lt;/table&gt; &lt;/p&gt; &lt;p&gt;&lt;a href=<span class="hljs-string"><span class="hljs-string">"index.php"</span></span>&gt; &lt;/a&gt;&lt;/p&gt;</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">insert.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?PHP</span></span> $host = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>; $user = <span class="hljs-string"><span class="hljs-string">"root"</span></span>; $database = <span class="hljs-string"><span class="hljs-string">"barrier"</span></span>; $pass = <span class="hljs-string"><span class="hljs-string">"mahapharata"</span></span>; $name = $_POST[<span class="hljs-string"><span class="hljs-string">"namee"</span></span>]; $phone = $_POST[<span class="hljs-string"><span class="hljs-string">"phonee"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">//    $connect = mysql_connect($host, $user, $pass); mysql_select_db($database); mysql_set_charset( 'utf8' ); mysql_query("INSERT INTO `numbers` (`phone`, `name`) VALUES ('".$name."','".$phone."')"); mysql_close($connect); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;input type="button" value="" onclick="history.back()"&gt;</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">remove_form.php</b> <div class="spoiler_text"><pre> <code class="php hljs">&lt;p&gt; &lt;table width=<span class="hljs-string"><span class="hljs-string">"300"</span></span> border=<span class="hljs-string"><span class="hljs-string">"1"</span></span> bordercolor=<span class="hljs-string"><span class="hljs-string">"#630000"</span></span> cellpadding=<span class="hljs-string"><span class="hljs-string">"3"</span></span> cellspacing=<span class="hljs-string"><span class="hljs-string">"0"</span></span>&gt; &lt;tr&gt;&lt;td&gt; &lt;font size=<span class="hljs-string"><span class="hljs-string">"2"</span></span> face=<span class="hljs-string"><span class="hljs-string">"verdana,arial,georgia"</span></span> color=<span class="hljs-string"><span class="hljs-string">"#630000"</span></span>&gt; ,   .&lt;/font&gt; &lt;form action=<span class="hljs-string"><span class="hljs-string">"delete.php"</span></span> method=<span class="hljs-string"><span class="hljs-string">"post"</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> placeholder=<span class="hljs-string"><span class="hljs-string">". 79261234567"</span></span> name=<span class="hljs-string"><span class="hljs-string">"phonedel"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> name=<span class="hljs-string"><span class="hljs-string">"send"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span> /&gt; &lt;/form&gt; &lt;/td&gt;&lt;/tr&gt; &lt;/table&gt; &lt;/p&gt; &lt;p&gt;&lt;a href=<span class="hljs-string"><span class="hljs-string">"index.php"</span></span>&gt; &lt;/a&gt;&lt;/p&gt;</code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">delete.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $servername = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>; $username = <span class="hljs-string"><span class="hljs-string">"root"</span></span>; $password = <span class="hljs-string"><span class="hljs-string">"mahapharata"</span></span>; $dbname = <span class="hljs-string"><span class="hljs-string">"barrier"</span></span>; $phone = $_POST[<span class="hljs-string"><span class="hljs-string">"phonedel"</span></span>]; <span class="hljs-comment"><span class="hljs-comment">// Create connection $conn = new mysqli($servername, $username, $password, $dbname); // Check connection if ($conn-&gt;connect_error) { die("Connection failed: " . $conn-&gt;connect_error); } // sql to delete a record $sql = "DELETE FROM numbers WHERE phone='".$phone."'"; if ($conn-&gt;query($sql) === TRUE) { echo "  \r\n"; } else { echo "    : " . $conn-&gt;error; } $conn-&gt;close(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;input type="button" value="" onclick="history.back()"&gt;</span></span></code> </pre><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">show.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $servername = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span>; $username = <span class="hljs-string"><span class="hljs-string">"root"</span></span>; $password = <span class="hljs-string"><span class="hljs-string">"mahapharata"</span></span>; $dbname = <span class="hljs-string"><span class="hljs-string">"barrier"</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Create connection $conn = new mysqli($servername, $username, $password, $dbname); $conn-&gt;set_charset("utf8"); // Check connection if ($conn-&gt;connect_error) { die("Connection failed: " . $conn-&gt;connect_error); }. $sql = "SELECT id, phone, name FROM numbers"; $result = $conn-&gt;query($sql); if ($result-&gt;num_rows &gt; 0) { // output data of each row while($row = $result-&gt;fetch_assoc()) { echo " " . $row["name"]. " " . $row["phone"]. "&lt;br&gt;"; } } else { echo "   "; } $conn-&gt;close(); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span><span class="hljs-comment"> &lt;p&gt;&lt;a href="index.php"&gt; &lt;/a&gt;&lt;/p&gt;</span></span></code> </pre><br></div></div><br><br>  Do not forget to fasten authorization using htaccess: <br><pre> <code class="bash hljs">htpasswd -c passwordfile username</code> </pre><br><br>  Enter the password in the dialog that htpasswd offers and get the file ‚Äúpasswordfile‚Äù with the username ‚Äúusername‚Äù and the generated encrypted password. <br><br>  In my opinion, it turned out to be a good implementation, in which Asterisk is used not as a standard IP PBX, but as a kind of access control system.  It was interesting to work on the project, and considering the popularity of such barriers, it may be useful to someone :) </div><p>Source: <a href="https://habr.com/ru/post/261391/">https://habr.com/ru/post/261391/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261381/index.html">Combinatorial testing: generation of test data and not only</a></li>
<li><a href="../261383/index.html">Do I need to participate in conferences?</a></li>
<li><a href="../261385/index.html">Environment for Dell VDI Virtual Machines</a></li>
<li><a href="../261387/index.html">Budget SMS</a></li>
<li><a href="../261389/index.html">ES6 Browser Development</a></li>
<li><a href="../261395/index.html">Free webinar "Choosing a Transportation Management Systems class information system"</a></li>
<li><a href="../261397/index.html">10 fatal mistakes of the usability of online stores and something else</a></li>
<li><a href="../261403/index.html">How to treat a malfunctioning cloud provider</a></li>
<li><a href="../261405/index.html">Consolidation of offices in 3CX (Part 1. We use trunks)</a></li>
<li><a href="../261409/index.html">Import substitution, as was said</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>