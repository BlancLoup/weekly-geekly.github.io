<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moving to the server side with bem-express</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúFirst, you deny him, then you hate him, and then you cannot live without him.‚Äù 
 from the report of Artem Kurbatov "BEM: master class" 


 The BEM me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moving to the server side with bem-express</h1><div class="post__text post__text-html js-mediator-article"><p>  <sup><i>‚ÄúFirst, you deny him, then you hate him, and then you cannot live without him.‚Äù</i></sup> <sup><br></sup>  <sup>from the report of Artem Kurbatov "BEM: master class"</sup> </p><br><p>  The BEM methodology exists for quite a long time and has been adopted by Google, EPAM Systems, BBC, Alfa-Bank.  However, it is still of concern to the typical developer and mid-level project manager. </p><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/chart.svg"><br></p><br><p>  For some brave souls, studying BEM did not go beyond limiting the possibilities of CSS to produce more predictable results.  And although BEM has long gone beyond the layout, still the question ‚ÄúDo you know BEM?‚Äù Can be heard: ‚ÄúOf course, this is about underscores in classes.‚Äù </p><br><p>  If your understanding of BEM is close to this, I will answer you with the words of the employer when hiring a new graduate: ‚ÄúForget about what you heard about BEM before.‚Äù  The BEM methodology is as interesting as the majority knows nothing about it.  To understand the beauty of BEM, you need to be aware of all the technologies, libraries, frameworks and tools that BEM provides.  Examine them, remain an alien, a child who is surprised at what adults have come to terms with. </p><br><p><a name="habracut"></a></p><h1>  Table of contents </h1><br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Used notation</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Used technologies</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Hello, World application</a> <br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Template repository</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Fast start</a> </li></ul></li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Social Services Search Robot application</a> <br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Scheme of the application</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Node modules used</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Preparation of the project structure</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Getting OAuth Tokens</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Application configuration</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Work with Twitter Search API</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Work with YouTube Data API</a> </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Layout</a> </li></ul></li></ul><br><p>  <strong>What is BEM for me?</strong> </p><br><p>  Surely you have heard the stories, as daring geeks, having closed in the garage, invented another startup.  The first successes allowed them to attract investment and enter the market with a stunning product.  How did they manage to do this, how did they manage to withstand the peak loads and not get bogged down in eternal refactoring?  How to not to as usual? </p><br><p>  BEM is a life hack for startups.  Compared to many other frameworks and technologies, starting to work with BEM requires some effort, but it pays off with architecture that provides sustainable extensibility.  All technologies, frameworks and libraries of BEM initially laid down the principles of a declarative approach.  And this is what makes them so incomprehensible at first glance and loved in the end. </p><br><p>  After reading this article, you will not comprehend Zen BEM, but you will definitely be able to respond to adults that they learned how to create full-fledged dynamic BEM projects using not only CSS.  And if tomorrow your application will suffer the fate of +10 K users per day, be calm - you will have time to celebrate this event. </p><br><p>  Today we will talk about the new template repository for dynamic projects <a href="https://github.com/bem/bem-express">bem-express</a> , which not only allows you to deploy a BEM project in one click, but also does automatic reassembly of the project and restarting the browser.  On its basis, we will develop a dynamic application and describe the interaction process of various BEM technologies.  We will deliberately not consider the issues of typesetting and client-side JavaScript, in order to avoid the fate of ‚Äúunderscore in classes‚Äù. </p><br><p>  <strong>What will we develop?</strong> </p><br><p>  Search application Social Services Search Robot (abbr. SSSR), which on demand will show the latest tweets and videos from YouTube. </p><br><p>  We will use: </p><br><ul><li>  <a href="https://ru.bem.info/platform/i-bem/">i-bem.js framework</a> ; </li><li>  template engine <a href="https://ru.bem.info/platform/bem-xjst/">bem-xjst</a> ; </li><li>  technology for describing dependencies <a href="https://ru.bem.info/platform/deps/">DEPS</a> ; </li><li>  <a href="http://expressjs.com/">Express.js</a> ; </li><li>  <a href="https://developers.google.com/youtube/v3/docs/search/list">YouTube Data API</a> ; </li><li>  <a href="https://dev.twitter.com/rest/public/search">Twitter Search API</a> . </li></ul><br><p>  First you need to install: </p><br><ul><li>  <a href="https://nodejs.org/">Node.js 4+</a> </li><li>  <a href="https://git-scm.com/">Git</a> </li></ul><br><blockquote>  <strong>Important!</strong>  Users of the Windows operating system must additionally install <a href="https://git-for-windows.github.io/">Git Bash</a> . </blockquote><br><h1 id="used-names">  Used notation </h1><br><p>  To make the article brighter, we will paint a little: </p><br><ul><li><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/icons/folder.svg" alt="folder">  - directory; </li><li><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/icons/file.svg" alt="file">  - file; </li><li><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/icons/add-folder.svg" alt="add folder">  - create a directory; </li><li><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/icons/add-file.svg" alt="add file">  - create a file; </li><li><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/icons/edit-file.svg" alt="edit file">  - edit the file. </li></ul><br><h1 id="used-technologies">  Used technologies </h1><br><p>  In BEM, there is no separation of technology into major and minor.  There is a set, and the choice of application is determined individually: </p><br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMDECL</a> is a technology for describing declarations in BEM. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">DEPS</a> is a technology for describing dependencies in BEM. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMTREE</a> is a template engine that converts data into BEMJSON. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMHTML</a> - a template engine that converts BEMJSON to HTML. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">i-bem.js</a> - JavaScript framework for BEM. </li></ul><br><blockquote>  Learn more about the <a href="https://ru.bem.info/platform/bemjson/">BEMJSON</a> input <a href="https://ru.bem.info/platform/bemjson/">format</a> . </blockquote><p>  Let's look at them in more detail. </p><br><h3 id="bemdecl">  BEMDECL </h3><br><p>  Defines a list of <a href="https://ru.bem.info/methodology/key-concepts/">BEM entities</a> for the page. </p><br><p>  Such a list in BEM is called a <a href="https://ru.bem.info/methodology/declarations/">declaration</a> .  The task of the declaration is to determine what and in what order to connect to the assembly. </p><br><p> Declarations are described in files with the <code>.bemdecl.js</code> extension. </p><br><p>  <strong>Example</strong> </p><br><pre> <code class="hljs pgsql">exports.blocks = [ { <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span> }, { <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'header'</span></span> }, { <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'body'</span></span> }, { <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'footer'</span></span> } ];</code> </pre> <br><p>  When the number of blocks goes over the line ‚Äúeasy to remember‚Äù, the problem arises of enumerating them in the necessary order.  Therefore, they usually declare a particular block, which should be considered as the central "entry point". </p><br><p>  All other BEM entities fall into an assembly according to <a href="https://habr.com/ru/company/yandex/blog/337166/">dependencies</a> . </p><br><h3 id="deps">  Deps </h3><br><p>  Defines <a href="https://ru.bem.info/platform/deps/">dependencies</a> between BEM entities that are spaced apart in the file structure of the project and not reflected in the declaration. </p><br><p>  Dependencies are described as a JavaScript object in files with the <code>.deps.js</code> extension. </p><br><p>  <strong>Example</strong> </p><br><pre> <code class="hljs css"><span class="hljs-comment"><span class="hljs-comment">/* page   header */</span></span> ({ <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, shouldDeps: [ { block: <span class="hljs-string"><span class="hljs-string">'header'</span></span> } ] })</code> </pre> <br><p>  The name of the technology comes from the English word dependence and indicates the desire to connect to the assembly some kind of BEM entity.  Students of BEM sometimes forget about the declarativeness of technologies and wonder: why for the block described in the template, its styles and scripts are not collected. </p><br><p>  <strong>Remember:</strong> when you describe a template ( <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMHTML</a> or <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMTREE</a> ) with some kind of block inside (a child node), you simply add a new HTML element.  In order for the styles and scripts of this block to fall into an assembly, it is necessary to describe the dependency on it. </p><br><p>  For example, in order to add blocks <code>header</code> , <code>body</code> and <code>footer</code> to an assembly, it is necessary to describe dependence on them: </p><br><pre> <code class="hljs css"><span class="hljs-comment"><span class="hljs-comment">/* page   header, body, footer */</span></span> ({ <span class="hljs-attribute"><span class="hljs-attribute">block</span></span>: <span class="hljs-string"><span class="hljs-string">'page'</span></span>, shouldDeps: [ <span class="hljs-string"><span class="hljs-string">'header'</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>, <span class="hljs-string"><span class="hljs-string">'footer'</span></span> ] })</code> </pre> <br><p>  The following diagram shows the dependency build logic: </p><br><pre> <code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">index</span></span>(DECL) <span class="hljs-meta"><span class="hljs-meta">#   page | ‚îî‚îÄ‚îÄ&gt; page(DEPS) #   page  header, body, footer | ‚îú‚îÄ‚îÄ&gt; header(DEPS) | | | ‚îî‚îÄ‚îÄ&gt; ... | ‚îú‚îÄ‚îÄ&gt; body(DEPS) | | | ‚îî‚îÄ‚îÄ&gt; ... | ‚îî‚îÄ‚îÄ&gt; footer(DEPS) | ‚îî‚îÄ‚îÄ&gt; ...</span></span></code> </pre> <br><h3 id="bemtree">  BEMTREE </h3><br><p>  It is part of <a href="https://ru.bem.info/platform/bem-xjst/">the bem-xjst</a> template engine and converts data to BEMJSON. </p><br><p>  Templates are described in BEMJSON format in files with the <code>.bemtree.js</code> extension. </p><br><p>  Template input and output: </p><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/bemtree.svg" alt="BEMTREE"></p><br><h3 id="bemhtml">  BEMHTML </h3><br><p>  It is part of <a href="https://ru.bem.info/platform/bem-xjst/">the bem-xjst</a> template engine and converts the BEMJSON description of the page into HTML. </p><br><p>  Templates are described in files with the <code>.bemhtml.js</code> extension. </p><br><p>  Template input and output: </p><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/bemhtml.svg" alt="BEMHTML"></p><br><h3 id="i-bemjs">  i-bem.js </h3><br><p>  Client <a href="https://ru.bem.info/platform/i-bem/">-</a> side <a href="https://ru.bem.info/platform/i-bem/">JavaScript framework</a> for web development within the framework of the BEM methodology. </p><br><p>  JavaScript code is described in files with a <code>.js</code> extension. </p><br><p>  Allows: </p><br><ul><li>  develop a web interface in terms of blocks, elements, modifiers; </li><li>  describe the logic of the block in a declarative style - as a set of states; </li><li>  Easily integrate JavaScript code with BEMHTML templates and CSS; </li><li>  flexibly override the behavior of library blocks. </li></ul><br><h1 id="app-hello-world">  Hello, World application </h1><br><p>  Programmers have a tradition: start programming in a new language or framework with the Hello, World application.  The application typically displays the words ‚ÄúHello, World‚Äù in the output stream, thereby demonstrating that it starts and performs I / O operations. </p><br><p>  Let's create it and then expand it to the desired SSSR. </p><br><p>  We need a local copy of <a href="https://habr.com/ru/company/yandex/blog/337166/">the bem-express template repository</a> .  It can be done with git. </p><br><blockquote>  <strong>Note.</strong>  For OS X or Linux users, all commands are executed in the terminal.  Windows users will need Git Bash.  Make sure Git Bash is running as administrator. </blockquote><br><h1 id="template">  Template repository </h1><br><p>  When solving problems of developing dynamic applications within BEM, a template repository <a href="https://github.com/bem/bem-express">bem-express was created</a> .  It contains the necessary minimum of configuration files and solves a whole class of tasks, such as building a project, setting up linters, connecting libraries, etc. </p><br><p>  By default, the main BEM libraries are connected to it: </p><br><ul><li>  <a href="https://ru.bem.info/platform/libs/bem-core/">bem-core</a> ; </li><li>  <a href="https://ru.bem.info/platform/libs/bem-components/">bem-components</a> . </li></ul><br><h2 id="faststart">  Fast start </h2><br><p>  To create the Hello, World application: </p><br><ol><li><p>  Clone bem-express: </p><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/bem/bem-express.git sssr-project</code> </pre> <br><blockquote>  <strong>Note.</strong>  This example uses <code>bem-express</code> version 2.00. </blockquote><br></li><li><p>  Go to the project directory: </p><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> sssr-project</code> </pre> <br></li><li><p>  Delete the versioning history of the source repository: </p><br><pre> <code class="bash hljs">rm -rf .git</code> </pre> <br></li><li><p>  Initialize your own Git repository: </p><br><pre> <code class="bash hljs">git init</code> </pre> <br></li><li><p>  Install dependencies: </p><br><pre> <code class="bash hljs">npm install</code> </pre> <br><blockquote>  <strong>Note.</strong>  Do not use root <code>root</code> when installing npm dependencies. </blockquote><br></li><li><p>  Build the project and start the server: </p><br><pre> <code class="bash hljs">npm run dev</code> </pre> <br><blockquote>  <strong>Note.</strong>  For the assembly is responsible <a href="https://ru.bem.info/toolbox/enb/">ENB</a> . </blockquote><p>  When you start the application in the terminal, a message appears stating that the server is running on port 3000: </p><br><p>  <code>Server is listening on 3000</code> . </p><br><blockquote>  <strong>Note.</strong>  If port <code>3000</code> used by another program, it can be reassigned.  For example, at <code>8000</code> : <br><br>  Method 1. Change the value when you start the application. <br><pre> <code class="bash hljs">PORT=8000 npm run dev</code> </pre> <br><br>  Method 2: Change the default value in the <code>server/config.js</code> . <br><pre> <code class="hljs">defaultPort: 8000,</code> </pre> <br></blockquote><p>  On the computer started: </p><br><ul><li>  server - is responsible for processing dynamic data; </li><li>  <a href="https://github.com/remy/nodemon/">nodemon</a> - monitors changes in the <a href="https://ru.bem.info/methodology/filestructure/">file structure</a> and restarts the server; </li><li>  <a href="https://github.com/paulmillr/chokidar">chokidar</a> - monitors changes in the files directories <code>*.blocks/</code> and rebuilds the structure of the project; </li><li>  <a href="https://github.com/napcs/node-livereload">livereload</a> - refreshes the page in the browser. </li></ul><br></li><li><p>  Open a browser and enter the address <a href="http://localhost:3000/">localhost: 3000</a> . </p><br><p>  A page should open with the following content: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> page content footer content</code> </pre> <br><blockquote>  <strong>Note.</strong>  If, when the application is launched in Windows, a notification from the Firewall is displayed: <br><ol><li>  Disable the <em>Public Network</em> option. </li><li>  Install the <em>Private Network</em> option. </li><li>  Allow access. </li></ol><br></blockquote><br></li><li><p>  Open the <code>server/index.js</code> and make the following changes (see comments) to the code beginning with the line <code>app.get('/', function(req, res)</code> : </p><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/** *    GET-     * @function * @param {object} req - . * @param {object} res - . */</span></span> app.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(req, res) { var hello = <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>; //   `hello` var world = <span class="hljs-string"><span class="hljs-string">'World'</span></span>; //   `world` render(req, res, { <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>: <span class="hljs-string"><span class="hljs-string">'page-index'</span></span>, title: <span class="hljs-string"><span class="hljs-string">'Main page'</span></span>, meta: { description: <span class="hljs-string"><span class="hljs-string">'Page description'</span></span>, og: { url: <span class="hljs-string"><span class="hljs-string">'https://site.com'</span></span>, siteName: <span class="hljs-string"><span class="hljs-string">'Site name'</span></span> } }, hello: hello, //   `hello`  `this.data.hello` world: world //   `world`  `this.data.world` }) });</code> </pre> <br></li><li><p>  Open the <code>common.blocks/page-index/page-index.bemtree.js</code> and replace its contents with the following: </p><br><pre> <code class="hljs lua">block(<span class="hljs-string"><span class="hljs-string">'page-index'</span></span>).content()(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //      `this` var data = this.data; //   : `data.hello: <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>`, `data.world: <span class="hljs-string"><span class="hljs-string">'World'</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.hello + <span class="hljs-string"><span class="hljs-string">', '</span></span> + data.world; });</code> </pre> <br><p>  After saving, the server will automatically restart and the page content will change to: </p><br><pre> <code class="hljs">Hello, World footer content</code> </pre> <br></li></ol><br><p>  Hello, World app is ready. </p><br><p>  <strong>Did not work out?</strong> </p><br><p>  If you are having difficulty creating an application, look for a solution on the <a href="https://ru.bem.info/forum/">forum</a> .  If there is no ready answer, ask a question. </p><br><h1 id="app-sssr">  Social Services Search Robot application </h1><br><p>  Actually, we have reached the development stage of the SSSR application.  Let me remind you that on request the application will display the latest tweets and videos from YouTube. </p><br><p>  Immediately we will run into the near future - the application will look like this: </p><br><img src="https://habrastorage.org/getpro/habr/post_images/8da/0d3/65c/8da0d365c13257d86c713bf9b1d6b59b.png"><br><h2 id="scheme">  Scheme of the application </h2><br><div class="spoiler">  <b class="spoiler_title">You saw her in the introductory part of the article.</b> <div class="spoiler_text"><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/chart.svg" alt="Chart of Social Services Search Robot"></p></div></div><br><h4 id="shag-1-zapros">  Step 1. Request </h4><br><p>  The user sends a request to the server. </p><br><h4 id="shag-2-poluchenie-dannyh">  Step 2. Receive data </h4><br><p>  The application applies for data to the <a href="https://dev.twitter.com/rest/public/search">Twitter Search API</a> and the <a href="https://developers.google.com/youtube/v3/docs/search/list">YouTube Data API</a> in accordance with the received request. </p><br><h4 id="shag-3-bemtree-shablonizaciya">  Step 3. BEMTREE-template </h4><br><p>  The application passes the received data to a <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMTREE template</a> that converts the data to BEMJSON. </p><br><h4 id="shag-4-bemhtml-shablonizaciya">  Step 4. BEMHTML-template </h4><br><p>  The application sends a BEMJSON <a href="https://habr.com/ru/company/yandex/blog/337166/">BEMHTML template engine</a> that converts BEMJSON to HTML. </p><br><h4 id="shag-5-otpravka-rezultata-polzovatelyu">  Step 5. Sending the result to the user </h4><br><p>  The application returns the result (HTML page) to the user. </p><br><h2 id="node-modules">  Node modules used </h2><br><p>  The basic implementation of Node remains as simple as possible.  Instead of embedding all the possible components directly in Node, the developers provide additional functionality in the form of separate modules (packages). </p><br><p>  The Node module system is modeled on the <a href="https://en.wikipedia.org/wiki/CommonJS">CommonJS</a> system, the mechanism for creating interacting modules.  A central place in the system is occupied by a contract that must be carried out by developers in order for their modules to interact normally with others. </p><br><p>  All packages installed using the npm package manager are located in the <code>node_modules</code> directory. </p><br><p>  The modules are connected using the <code>require</code> command.  If the package is installed using npm, you do not need to specify the path.  It is enough to specify the name: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>);</code> </pre> <br><p>  When you connect your own local module, you must specify the path to it: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someModule = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./somefolder/somemodule'</span></span>);</code> </pre> <br><p>  An important feature of any module is that it must be designed to interact with Node.  To do this, the module must be exported using <code>module.exports</code> : </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> = { <span class="hljs-comment"><span class="hljs-comment">// some module };</span></span></code> </pre> <br><p>  The application will require the following modules: </p><br><ul><li>  <a href="http://expressjs.com/ru/">express</a> - provides most of the functionality needed to build a web application; </li><li>  <a href="http://passportjs.org/">passport</a> - provides various authentication strategies for Node.js applications; </li><li>  <a href="https://github.com/yanatan16/passport-youtube-v3">passport-youtube-v3</a> - provides a mechanism for authentication on Youtube through a Youtube account and <a href="https://oauth.net/2/">OAuth 2.0</a> tokens; </li><li>  <a href="https://www.npmjs.com/package/twitter">twitter</a> - client library for working with Twitter REST API; </li><li>  <a href="http://google.github.io/google-api-nodejs-client/">googleapis</a> - client library for working with Google REST API; </li><li>  <a href="http://momentjs.com/">moment</a> - JavaScript library for parsing, validating and formatting dates. </li></ul><br><p>  You can install them with one command: </p><br><pre> <code class="bash hljs">npm install express passport passport-youtube-v3 twitter googleapis moment --save</code> </pre> <br><h2 id="preparing">  Preparation of the project structure </h2><br><p>  Before starting to write code, we will slightly change the structure of the Hello, World application taken as the basis. </p><br><p>  Changes for: </p><br><ul><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">static files</a> ; </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">server code</a> . </li></ul><br><h3 id="static-changes">  Changes for static files </h3><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/static-changes.svg" alt="static"></p><br><p>  <strong><code>static</code> directory</strong> </p><br><ul><li><p>  Create an <code>images</code> subdirectory. </p><br></li><li>  Transfer the favicon to the <code>images</code> subdirectory. </li></ul><br><p>  <strong><code>common.blocks</code> directory</strong> </p><br><ul><li><p>  Edit the <code>root/root.bemtree.js</code> . </p><br><p>  Change: </p><br><pre> <code class="hljs cs">favicon: <span class="hljs-string"><span class="hljs-string">'/favicon.ico'</span></span>,</code> </pre> <br><p>  On: </p><br><pre> <code class="hljs cs">favicon: <span class="hljs-string"><span class="hljs-string">'/images/favicon.ico'</span></span>,</code> </pre> <br><p>  <a href="https://gist.github.com/godfreyd/fba71361207a95134982579c13b0050d">Full root.bemtree.js code</a> . </p><br></li></ul><br><p>  <strong><code>server</code> directory</strong> </p><br><ul><li><p>  Edit the <code>index.js</code> file. </p><br><p>  Change: </p><br><pre> <code class="hljs pgsql">.use(favicon(<span class="hljs-type"><span class="hljs-type">path</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(staticFolder, <span class="hljs-string"><span class="hljs-string">'favicon.ico'</span></span>)))</code> </pre> <br><p>  On: </p><br><pre> <code class="hljs pgsql">.use(favicon(<span class="hljs-type"><span class="hljs-type">path</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">join</span></span>(staticFolder, <span class="hljs-string"><span class="hljs-string">'/images/favicon.ico'</span></span>)))</code> </pre> <br><p>  <a href="https://gist.github.com/godfreyd/fdc6e2d7f1f42deac4dcfc0dde36bd11">The full code is index.js</a> . </p><br></li></ul><br><h3 id="server-changes">  Changes for server code </h3><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/server-changes.svg" alt="server changes"></p><br><p>  <strong><code>server</code> directory</strong> </p><br><ul><li><p>  Create subdirectories: </p><br><ul><li>  <code>controllers</code> - controllers; </li><li>  <code>helpers</code> - helpers; </li><li>  <code>middleware</code> - intermediate modules. </li></ul><br></li><li><p>  Create empty <code>JS</code> files for future modules: </p><br><ul><li>  <code>app.js</code> - the module for mounting intermediate modules (makes them available in the application); </li><li>  <code>auth.js</code> - authentication module on YouTube; </li><li>  <code>routes.js</code> is a web request routing module. </li></ul><br></li><li><p>  Add the <a href="https://gist.github.com/godfreyd/a584cee1191833afae70fc059ba1f200">following code</a> to the <code>app.js</code> file. </p><br></li><li><p>  Add the <a href="https://gist.github.com/godfreyd/f6de1c33a83dda708a0e3ba9312f0c78">following code</a> to the <code>routes.js</code> file. </p><br></li><li><p>  Change the <code>config</code> file extension: </p><br><p>  <code>config.js</code> -&gt; <code>config.json</code> </p><br></li><li><p>  Edit the <code>config.json</code> file. </p><br><p>  Change: </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> = { staticFolder: <span class="hljs-string"><span class="hljs-string">'static'</span></span>, defaultPort: <span class="hljs-number"><span class="hljs-number">3000</span></span>, cacheTTL: <span class="hljs-number"><span class="hljs-number">30000</span></span>, sessionSecret: <span class="hljs-string"><span class="hljs-string">'REPLACE_ME_WITH_RANDOM_STRING'</span></span> };</code> </pre> <br><p>  On: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"staticFolder"</span></span>: <span class="hljs-string"><span class="hljs-string">"static"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"defaultPort"</span></span>: <span class="hljs-number"><span class="hljs-number">3000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cacheTTL"</span></span>: <span class="hljs-number"><span class="hljs-number">30000</span></span>, <span class="hljs-attr"><span class="hljs-attr">"sessionSecret"</span></span>: <span class="hljs-string"><span class="hljs-string">"REPLACE_ME_WITH_RANDOM_STRING"</span></span> }</code> </pre> <br></li><li><p>  Change the entire current content of the <code>index.js</code> file to the <a href="https://gist.github.com/godfreyd/37d903c73f863619e2e1be1cd946d4c3">next</a> . </p><br><blockquote>  <strong>Note.</strong>  In <code>index.js</code> , only the functionality responsible for launching the application and listening to requests on the port remains. </blockquote><br></li></ul><br><p>  <strong>Directory <code>controllers</code></strong> </p><br><ul><li><p>  Create an empty <code>JS</code> file: </p><br><ul><li>  <code>index.js</code> is a request processing and HTML rendering controller. </li></ul><br></li><li>  Add the <a href="https://gist.github.com/godfreyd/4bda7da3db029890378e15bcc38f32de">following code</a> to the <code>index.js</code> file. </li></ul><br><p>  <strong><code>helpers</code> directory</strong> </p><br><ul><li><p>  Create empty <code>JS</code> files: </p><br><ul><li>  <code>index.js</code> - entry point for helpers; </li><li>  <code>twitter.js</code> - helper module for working with Twitter Search API; </li><li>  <code>youtube.js</code> is a helper module for working with the YouTube Data API. </li></ul><br></li></ul><br><p>  <strong>Directory <code>middleware</code></strong> </p><br><ul><li><p>  Create an empty <code>JS</code> file: </p><br><ul><li>  <code>auth.js</code> is a YouTube authentication verification module. </li></ul><br></li></ul><br><h2 id="oauth-tokens">  Getting OAuth Tokens </h2><br><p>  Twitter and Google services store a variety of user data ‚Äî tweets, Youtube videos, Mail messages, photos, and so on.  To provide convenient access to this data from other applications or third-party services, they use the open authorization protocol <a href="https://oauth.net/">OAuth 2.0</a> . </p><br><p>  According to the protocol, the developer registers the application on the OAuth server and requests access to certain data.  An authorized user permits or denies it. </p><br><h4 id="poluchenie-oauth-tokena-dlya-twitter">  Getting OAuth Token for Twitter </h4><br><p>  Twitter offers applications the ability to issue authenticated requests on behalf of the application itself. </p><br><p>  Where to begin? </p><br><ol><li>  Check out the <a href="https://dev.twitter.com/oauth">documentation</a> . </li><li>  Register the <a href="https://apps.twitter.com/">app</a> and get the keys (Consumer Key, Consumer Secret). </li><li>  Install <a href="https://www.getpostman.com/">Postman</a> any way you like. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Encode the</a> <code>Consumer Key:Consumer Secret</code> using the <a href="https://en.wikipedia.org/wiki/Base64">Base64</a> method. </li><li>  <a href="https://habr.com/ru/company/yandex/blog/337166/">Get an OAuth token in exchange for a code</a> . </li><li><p>  Use received tokens and keys in the Twitter Search API requests. </p><br><blockquote>  <strong>Note.</strong>  Postman will help you get an OAuth token using a POST request in exchange for code derived from the Base64 method. </blockquote><br></li></ol><br><h3 id="codestring">  How to encode a string? </h3><br><p>  To encode a string using the Base64 method: </p><br><ol><li><p>  Create a string like: <code>Consumer Key:Consumer Secret</code> . </p><br><p>  <strong>Example</strong> </p><br><p> <code>xvz1evFS4wEEPTGEFPHBog:L8qq9PZyRg6ieKGEKhZolGC0vJWLw8iEJ88DRdyOg</code> </p> <br><blockquote>  <strong>Note.</strong>  You can get the Consumer Key and Consumer Secret keys by going to the Keys and Access Tokens tab of <a href="https://apps.twitter.com/">your application</a> . </blockquote><br></li><li>  Run a terminal or git bash. </li><li>  Run the <code>echo -n "xvz1evFS4wEEPTGEFPHBog:L8qq9PZyRg6ieKGEKhZolGC0vJWLw8iEJ88DRdyOg" | base64</code>  <code>echo -n "xvz1evFS4wEEPTGEFPHBog:L8qq9PZyRg6ieKGEKhZolGC0vJWLw8iEJ88DRdyOg" | base64</code> . </li><li><p>  Copy the resulting code. </p><br><p>  <strong>Example</strong> </p><br><p> <code>eHZ6MWV2RlM0d0VFUFRHRUZQSEdFS2hab2xHQzB2SldMdzhpRUo4OERSZHlPZw==</code> </p> <br></li></ol><br><blockquote>  <strong>Note.</strong>  If you are having difficulty, use the online resource <a href="https://www.base64encode.org/">base64encode.org</a> . </blockquote><br><h3 id="oauth-how">  How to get an OAuth token in exchange for a code? </h3><br><p>  To get a token in exchange for a code: </p><br><ol><li><p>  Run Postman. </p><br><blockquote>  <strong>Note.</strong>  By default, a tab opens in which you need to form a POST request to the Twitter OAuth server. </blockquote><br></li><li>  Select the type of POST request. </li><li>  Enter the server address <code>https://api.twitter.com/oauth2/token</code> . </li><li>  Click the Headers tab. </li><li><p>  Enter the <code>Authorization</code> header with a value (Value field) <code>Basic &lt;  Consumer Key:Consumer Secret&gt;</code> in the Key field. </p><br><p>  <strong>Example</strong> </p><br><p> <code>Authorization: Basic eHZ6MWV2RlM0d0VFUFRHRUZQSEdFS2hab2xHQzB2SldMdzhpRUo4OERSZHlPZw==</code> </p> <br><blockquote>  <strong>Note.</strong>  Basic indicates the basic authentication method. </blockquote><br></li><li><p>  Enter a second <code>Content-Type</code> header with the value <code>application/x-www-form-urlencoded;charset=UTF-8</code> . </p><br><p>  <strong>Example</strong> </p><br><p> <code>Content-Type: application/x-www-form-urlencoded;charset=UTF-8</code> </p> <br></li><li>  Click the Body tab. </li><li>  Select the <code>x-www-form-urlencoded</code> option. </li><li>  Enter in the Key field the request body <code>grant_type</code> with the value <code>client_credentials</code> . </li><li><p>  Click the Send button. </p><br><p>  The OAuth server will return the token in JSON format: </p><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"token_type"</span></span>: <span class="hljs-string"><span class="hljs-string">"bearer"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"access_token"</span></span>: <span class="hljs-string"><span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAA%2FAAAAAAAAAA%3DAAAAAAAAAAAAAAAAAA"</span></span> }</code> </pre> <br><blockquote>  <strong>Important!</strong>  Save received tokens and keys (Consumer Key and Consumer Secret).  They are required for <a href="https://habr.com/ru/company/yandex/blog/337166/">the</a> application <a href="https://habr.com/ru/company/yandex/blog/337166/">configuration file</a> . </blockquote><br></li></ol><br><h4 id="poluchenie-oauth-tokena-dlya-google">  Getting OAuth Token for Google </h4><br><p>  Google offers applications the ability to issue authenticated requests on behalf of the application itself. </p><br><blockquote>  <strong>Note.</strong>  The module <a href="https://github.com/yanatan16/passport-youtube-v3">passport-youtube-v3</a> is responsible for receiving and updating the OAuth token using a POST request in exchange for an authorization code. </blockquote><p>  <strong>Where to begin?</strong> </p><br><ol><li>  Check out the <a href="https://developers.google.com/youtube/v3/docs/search/list">documentation</a> . </li><li>  Register the <a href="https://console.developers.google.com/">application</a> and get Client ID and Client Secret. </li><li>  Enter the callback URL (in our case it is <code>http://localhost:3000</code> ) in your application account. </li><li>  Use the received Client ID and Client Secret in requests to the YouTube Data API. </li></ol><br><blockquote>  <strong>Important!</strong>  Save the received keys (Client ID and Client Secret).  They are required for <a href="https://habr.com/ru/company/yandex/blog/337166/">the</a> application <a href="https://habr.com/ru/company/yandex/blog/337166/">configuration file</a> . </blockquote><br><h2 id="config-file">  Application configuration </h2><br><p>  After all the keys and tokens are received, they must be added to the application configuration file: </p><br><ul><li><p>  Add the <code>services</code> field to the <code>server/config.json</code> file. </p><br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"services"</span></span>: { <span class="hljs-string"><span class="hljs-string">"twitter"</span></span>: { <span class="hljs-string"><span class="hljs-string">"consumer_key"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"consumer_secret"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"bearer_token"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }, <span class="hljs-string"><span class="hljs-string">"youtube"</span></span>: { <span class="hljs-string"><span class="hljs-string">"client_id"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"client_secret"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"redirect_url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://localhost:3000"</span></span> } }</code> </pre> <br><p>  <a href="https://gist.github.com/godfreyd/3697d1ba5fe5ac298a9b471fe943340f">Full code config.json</a> . </p><br></li><li>  Fill in the fields of the same name with the <a href="https://habr.com/ru/company/yandex/blog/337166/">received data</a> . </li><li><p>  Hide the <code>server/config.json</code> from the Git version control system in order not to accidentally add private keys to the file repository. </p><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  .gitignore server/config.json</span></span></code> </pre> <br><p>  <a href="https://gist.github.com/godfreyd/71a35fde50f54205fa395230bc97358f">Full .gitignore code</a> . </p><br></li></ul><br><h2 id="twitter-api-work">  Work with Twitter Search API </h2><br><p>  <a href="https://dev.twitter.com/rest/public/search">The Twitter Search API</a> allows you to find the latest or most popular tweets posted on Twitter.com in the last 7 days. </p><br><p>  For a successful API call, you need to make the following changes: </p><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/twitter-changes.svg" alt="twitter changes"></p><br><p>  <strong>Directory <code>controllers</code></strong> </p><br><ul><li>  Change the entire current content of the <code>index.js</code> file to the <a href="https://gist.github.com/godfreyd/3420597de46509b02c69707d596c8dc4">next</a> . </li></ul><br><p>  <strong><code>helpers</code> directory</strong> </p><br><ul><li><p>  Add the following content to the <code>index.js</code> file: </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">module</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">exports</span></span> = { twitter: require(<span class="hljs-string"><span class="hljs-string">'./twitter'</span></span>) };</code> </pre> <br></li><li>  Add the <a href="https://gist.github.com/godfreyd/e48b6831d785e51ee6ce0892151e3395">following code</a> to the <code>twitter.js</code> file. </li></ul><br><h2 id="youtube-api-work">  Work with YouTube Data API </h2><br><p>  <a href="https://developers.google.com/youtube/v3/">YouTube Data API</a> allows you to find videos published on Youtube.com.  By default, the following resources are included in the search result set: video, channels, playlists. </p><br><p>  For a successful API call, you need to make the following changes: </p><br><p><img src="https://rawgit.com/godfreyd/bem-in-dynamic/master/static/images/youtube-changes.svg" alt="youtube-changes"></p><br><p>  <strong><code>server</code> directory</strong> </p><br><ul><li><p>  Add the <a href="https://gist.github.com/godfreyd/68af82df0bc171da54971990f442dddb">following code</a> to the <code>auth.js</code> file. </p><br></li><li><p>  Edit the <code>routes.js</code> file. </p><br><p>  Change: </p><br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>).Router(), controllers = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./controllers'</span></span>); router .get(<span class="hljs-string"><span class="hljs-string">'/ping/'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ res.send(<span class="hljs-string"><span class="hljs-string">'ok'</span></span>); }) .get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, controllers.getContent); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br><p>  On: </p><br><pre> <code class="hljs coffeescript">var router = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>).Router(), controllers = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./controllers'</span></span>), passportYouTube = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./auth'</span></span>), middleware = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./middleware/auth'</span></span>), isAuthenticated = middleware.isAuthenticated; router .get(<span class="hljs-string"><span class="hljs-string">'/auth/youtube'</span></span>, passportYouTube.authenticate(<span class="hljs-string"><span class="hljs-string">'youtube'</span></span>)) .get(<span class="hljs-string"><span class="hljs-string">'/auth/youtube/callback'</span></span>, passportYouTube.authenticate(<span class="hljs-string"><span class="hljs-string">'youtube'</span></span>, { failureRedirect: <span class="hljs-string"><span class="hljs-string">'/error'</span></span>, failureFlash: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }), <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req, res)</span></span></span><span class="hljs-function"> =&gt;</span></span> { res.redirect(<span class="hljs-string"><span class="hljs-string">'/'</span></span>); }) .get(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, isAuthenticated, controllers.getContent); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router;</code> </pre> <br></li></ul><br><p>  <strong>Directory <code>controllers</code></strong> </p><br><ul><li>  Change the entire current content of the <code>index.js</code> file to the <a href="https://gist.github.com/godfreyd/60d5d123c45c067b3fb675688dc74835">next</a> . </li></ul><br><p>  <strong><code>helpers</code> directory</strong> </p><br><ul><li><p>  Add the following content to the <code>index.js</code> file (see comment): </p><br><pre> <code class="hljs javascript"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">twitter</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./twitter'</span></span>), <span class="hljs-attr"><span class="hljs-attr">youtube</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./youtube'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   `youtube.js` };</span></span></code> </pre> <br></li><li>  Add the <a href="https://gist.github.com/godfreyd/e103013e1fe480965cd84b3e7040d04b">following code</a> to the <code>youtube.js</code> file. </li></ul><br><p>  <strong>Directory <code>middleware</code></strong> </p><br><ul><li><p>  Add the following content to the <code>auth.js</code> file: </p><br><pre> <code class="hljs lua">module.exports = { isAuthenticated: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(req, res, next)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (req.isAuthenticated()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">next</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.redirect(<span class="hljs-string"><span class="hljs-string">'/auth/youtube'</span></span>); } };</code> </pre> <br></li></ul><br><h2 id="verstka">  Layout </h2><br><p>  We deliberately did not consider the issues of layout and client-side JavaScript.  This would lead to a larger volume, and, therefore, to a lesser practical value of this article. </p><br><p>  The layout process is reduced to the following steps: </p><br><ol><li>  Delete all blocks from the <code>common.blocks</code> directory. </li><li>  Clone the <a href="https://github.com/godfreyd/bem-in-dynamic/tree/master/common.blocks">following blocks</a> into the <code>common.blocks</code> directory. </li><li>  Add <a href="">logo.svg</a> to the <code>static/images</code> directory. </li><li>  Restart the server: <code>npm run dev</code> . </li></ol><br><p>  The Social Services Search Robot application is ready. </p><br><p>  <strong>Did not work out?</strong> </p><br><p>  If you are having difficulty creating an application, look for a solution on the <a href="https://ru.bem.info/forum/">forum</a> .  If there is no ready answer, ask a question. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/337166/">https://habr.com/ru/post/337166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337154/index.html">Vulnerable Docker VM - Virtual Docker and Pentesting Puzzle</a></li>
<li><a href="../337156/index.html">Integration of Lokalise service into the largest photo bank in the world: experience.</a></li>
<li><a href="../337158/index.html">We are preparing to build Go-applications in production</a></li>
<li><a href="../337162/index.html">Huawei Agile Distributed Wi-Fi Solution: what is it? Part two</a></li>
<li><a href="../337164/index.html">Excursion to the Museum of Computer History in California, with the benefit of the development. Part 1. ENIAC, Stretch, CDC6600, IBM / 360</a></li>
<li><a href="../337168/index.html">We write and parsim assembly language MCS-51, as in BASIC</a></li>
<li><a href="../337170/index.html">The book "Continuous delivery. The practice of continuous updates "</a></li>
<li><a href="../337172/index.html">IT events digest for September</a></li>
<li><a href="../337174/index.html">How to protect yourself from encryptors on the perimeter of the network</a></li>
<li><a href="../337176/index.html">According to Rambler.iOS # 9</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>