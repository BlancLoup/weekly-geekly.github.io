<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we broke the scoring model. Machine learning in microfinance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I work in a Devim team that develops a decision-making system for borrowers of loans. There was a sufficient amount of practical knowledge i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we broke the scoring model. Machine learning in microfinance</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I work in a Devim team that develops a decision-making system for borrowers of loans.  There was a sufficient amount of practical knowledge in this area, so I decided to share a part with you. <br><br>  I'll tell you about the problems and how to solve them when developing scoring models.  These examples may be of interest to professionals working in the field of lending and simply to readers of Habr who are interested in the features of development in machine learning / credit scoring projects. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wa/tt/gh/wattghfdpijbwk3aiz8aqfyers4.gif"></div><a name="habracut"></a><br>  Consider two scenarios: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  You already have a scoring model and you want to break it. </li><li>  You know that soon the company will want to develop its scoring model and in no case can this be allowed. <br></li></ol><br>  So, here are some ways to break the scoring model. <br><br><h1>  Scenario 1 </h1><br><h2>  Method number 1 - make changes to the site </h2><br><ul><li>  Change the design of the loan amount and maturity page <br></li><li>  Change the default value of the loan amount / term when entering the site <br></li></ul><br><h2>  Method number 2 - create a marketing department </h2><br>  It is necessary that a marketing department be created in the MFI.  With the very frequent appearance of new credit products, changes in interest rates, marketing campaigns ‚Äúfirst loan for free‚Äù, scoring models will not be able to adequately work for a long period. <br><br><img src="https://habrastorage.org/webt/qz/wi/a_/qzwia_wv3otu9yvoqf50dwfjmy0.png"><br><h1>  Scenario 2 </h1><br><h2>  Method number 3 - destroy data (preferably paid) </h2><br><ul><li>  Retrace customer‚Äôs credit history data from previous downloads <br></li><li>  Retrace client data from previous downloads <br></li></ul><br><h2>  Method # 4 - make a different data entry interface in different application channels and devices (online, offline, Android, Iphone) </h2><br><h2>  Method # 5 - add a script to populate the database field and do not document it. </h2><br>  In the database, you must create a field FIRSTLOAN with the comment "requested loan amount".  When approving a loan, rewrite the value of this field with an amount that was ultimately approved. <br><br><h2>  Method # 6 - Hire a Data Science Specialist </h2><br>  He will convince everyone that the scoring bureau ball sucks.  Prod stacking is good.  Selection of hyperparameters and cool models - this is what you need to spend most of the time.  And if you find gold seed, you can get a small increase in quality. <br><br>  Let us examine in more detail each method. <br><br><h2>  Design page selection amount and term of the loan </h2><br>  Here is the main page of the site, where the client selects the amount and term of the loan.  Pay attention to the number of tabs and the range of amounts on each tab. <br><br><div class="scrollable-table"><table><tbody><tr><td>  Before the changes <br></td><td>  After change <br></td></tr><tr><td><img src="https://habrastorage.org/webt/-l/de/do/-ldedomoqqq-jktb7kcxrwnnjcg.jpeg"><br></td><td><img src="https://habrastorage.org/webt/rd/ll/ck/rdllcki1qccmpm3wgdtp3d_8gwy.png"><br></td></tr></tbody></table></div><br>  After the first and second tabs were combined into one, part of the applications from the 2-10k range moved to the 11-20k range.  For business it is good from the point of view of the average check. <br><br><img src="https://habrastorage.org/webt/7e/jp/hm/7ejphmqscsp78xzdvssde6_p1re.png"><br>  <i>Distribution of requested amounts before and after changes</i> <i><br></i>  <i>Right - large scale</i> <br><br>  According to historical data collected during the operation of the old version of the site, there is a linearly negative relationship between the requested loan amount and the probability of default.  For customers who have requested a sum of 11-20k, the probability of no return is less.  Even with manual underwriting, there is a higher level of approval.  This confirms the hypothesis that borrowers who applied for from the second tab, on average, are better.  For a trained model, this means that a request for a sum of 11-20k characterizes the borrower as good.  However, after the tabs were merged, the level of approval for manual review of such applications decreased, and the probability of non-return increased.  The model continued to consider such borrowers as good, which led to a decrease in the quality of scoring in this range.  The solution to the problem was to rebuild the model on the same data, but without the sign "sum". <br><br>  For loans, which managed to be issued by the old model on the new version of the site, analysis of model errors was carried out.  Most of them were related to the fact that a borrower with a very bad credit history should have been refused, but having indicated the amount of 20,000, he received a ‚Äúcheat‚Äù soon and received approval of a minimum amount of 2-3k. <br><br>  The connection between the large amount requested and the low probability of no return is odd.  There is an assumption that large sums are requested by people with higher income levels.  And on a separate tab 11-20k (perhaps) people went who really needed just such a sum and they knew that they could repay it. <br><br><h2>  The default value of the amount / term of the loan when entering the site </h2><br>  Let's look at how the value of the ‚Äúamount‚Äù slider affects the distribution of the requested amounts.  When entering the site, the value of the amount slider is set to 7000 p.  - The picture on the left, 8000 p.  - the picture on the right. <br><br><img src="https://habrastorage.org/webt/_t/ep/fj/_tepfjbknwds5awzgydtgkfkqzm.png"><br><br>  It can be seen that the number of requests for a loan of a certain amount (7k or 8k) greatly increases, if you set the default slider to this value. <br><br>  If there is a relationship between the slider shift (the deliberate choice of the amount needed by the borrower) and the risk of non-return, a tree-based model will find this relationship in the data in the characteristic loan amount.  Even without creating a special feature, ‚ÄúDoes the selected amount match the slider's default value?‚Äù  The algorithm creates the rule "if the amount is more than 6k, but less than 8k - the borrower is bad."  In case of changing the default value of the slider on the site, this rule will not work correctly.  The solution to the problem is to refuse to use this feature, or to create an additional feature - ‚Äúdoes the selected amount match the slider's default value‚Äù. <br><br>  When analyzing a new model that does not use the ‚Äúloan amount‚Äù feature, we constructed the dependence of the average rate on the loan amount. <br><br><img src="https://habrastorage.org/webt/1p/5w/qu/1p5wqu-q3xiynai2tg3rcy9gwzc.png"><br><br>  The model, not knowing what the default value of the slider is set on the site, and not using the sign of the requested loan amount, still assigns to borrowers who do not move the slider, less quickly, relying on other signs.  This interesting finding allows us to argue that the choice of the amount and term of the loan by default is a sign of a bad borrower. <br><br><h2>  Retrace customer credit history data </h2><br>  When applying for a loan, a paid inquiry is sent to the credit bureau.  The response contains detailed information on how the customer paid other loans, whether there were delays, size, type of loans, etc.  Quite often, clients take a loan to an MFI more than once.  When you contact the bureau again, a request is also sent, since  The borrower's financial position may have changed.  The database architect, underwriters, and other individuals who work with credit history in any way decide that it‚Äôs not worthwhile to keep a credit history of previous applications.  it takes up space on the hard drive, and no one will watch it.  Create two tables ORDERS and CLIENTS.  The order data is written to ORDERS, and the client is written to CLIENTS.  KI is placed in the table CLIENTS.  With each new circulation, the CI is overwritten.  For a datasaentist, this means that he receives an offset sample for learning.  In the database are KI about customers who either took a loan once and did not return.  Or they took it once and did not become regular customers.  Information about the first application of the most valuable customers who have become permanent is not available. <br><br>  The situation with the questionnaire data is similar.  The CLIENTS table stores information about income, marital status, place of work, etc. These data are also overwritten.  However, a person‚Äôs income and marital status, as is known, may change over time. <br><br><h2>  Data entry interface in different application channels </h2><br>  When applying for a loan, the client fills out a questionnaire in which he indicates his monthly income.  Let's look at how the distribution of income values ‚Äã‚Äãdepends on the application channel.  On x - application id, on y - income. <br><br><img src="https://habrastorage.org/webt/7c/-q/ms/7c-qmssyhqjai2mks3tv6ql3g64.png"><br><br>  The site has a drop-down list.  And when the application comes from the affiliate network, the field can be filled with an arbitrary value.  A similar situation occurs when filling out the application in the offline - office.  If you do not notice this fact when developing a scoring model, the model will estimate the probability of no return using the ‚Äúrevenue‚Äù attribute depending on the ratio of the given partners / site / offline channels in the training set.  The solution to the problem is not to use the sign ‚Äúincome‚Äù.  Either do a discretization of the characteristic value for the channel ‚Äúpartners‚Äù and ‚Äúoffline‚Äù at the same intervals as indicated on the site (which is not very good, since the input method is different).  Or do the input field on the site and wait for the accumulated data. <br><br><h2>  Marketing department </h2><br>  There are several products in the company: <br>  PDL loans - loans in the amount of 2 to 20k, which need to be closed in one payment. <br>  Installment loans - loans in the amount of 21 to 100k.  At the moment when the client makes an application, depending on whether the client is new or repeated, on the region and other factors, marketing determines which product he can and should be given.  Product parameters include minimum / maximum loan amounts and terms.  Initially, the product definition was carried out after scoring.  Those.  In the scoring model the amounts and the period specified by the client were submitted.  At some point, the definition of the product began to occur before scoring.  And the data specified by the client were automatically replaced by the "necessary" ones and were scored.  This has led to a deterioration in the quality of scoring.  The solution to the problem is a return to the previous logic of product definition. <br><br><h2>  Data science specialist errors </h2><br>  The data analyst wants to use the ‚Äúloan target‚Äù text box as a sign.  Uploads data, groups loan goals into categories.  Analyzes the percentage of bad in each category.  The percentage of bad, or WOE - the logarithm of the ratio of good to bad. <br><br><img src="https://habrastorage.org/webt/hx/lm/wk/hxlmwkcsybyuqdcjtmsspewa-0o.png" align="left"><br><br>  Analysis of the level of overdue (the number of unpaid loans divided by the number of loans issued) for each category.  However, the data for which the analysis was carried out include online and offline applications. <br>  The procedure for filling the questionnaire offline is significantly different, because  The questionnaire is filled in by the office manager according to the client, or the client with the prompts of the manager <br><br>  Let's see what the frequency distribution of the loan target looks like in online / offline sections. <br><img src="https://habrastorage.org/webt/9i/am/0f/9iam0fsigixv8yr6sg3f3-zq1re.png"><br><br>  Online customers do not fill out the purpose of the loan.  Taking into account the fact that the ratio of applications towards online is constantly growing, it is possible to use a sign only after setting the field ‚Äúloan target‚Äù for the mandatory and additional data collection cycle. <br><br>  Let's return to the sign "loan amount".  The data analyst decides to use the loan amount from the loan application.  An algorithm based on decision trees (random forest / gradient boosting) was chosen as the method.  After the first experiments with models on the schedule feature importances, it turned out that the ‚Äúloan amount‚Äù sign is the strongest.  Intuitively stronger signs did not reach the top.  After analyzing the possible causes, it was found that the ‚Äúloan amount‚Äù field is overwritten after the loan is approved.  This happens in cases where a loan officer approves a smaller and ‚Äúuneven‚Äù loan amount.  Thus, data leak in the data crept in, which is so common in data analysis competitions.  The solution to the problem is an additional field in the database in which the initially specified amount is written. <br><br>  But that's not all.  Let's look at the frequency of ‚Äúuneven‚Äù loan amounts depending on the application channel. <br><br><div class="scrollable-table"><table><tbody><tr><td>  application source <br></td><td>  share of bids with an uneven amount <br></td></tr><tr><td>  Android app <br></td><td>  0 <br></td></tr><tr><td>  Iphone app <br></td><td>  0 <br></td></tr><tr><td>  Offline <br></td><td>  0 <br></td></tr><tr><td>  Partners <br></td><td>  0.13 <br></td></tr><tr><td>  Site <br></td><td>  0 <br></td></tr></tbody></table></div><br>  Applications coming from partners have uneven amounts.  What in our case creates illogical connections in the tree and makes the model less resistant to the emergence of new channels of applications.  The problem is aggravated by the fact that in the flow of applications the percentage of partnership in some periods can reach 80-90%.  In this case, the problem is solved by abandoning the use of the feature or by discretization up to 1000 r or more. <br><br>  <b>Leaking data from the future</b> <b><br></b>  When filling out the questionnaire, the client may not fill in the optional fields.  If the underwriter sees that the credit history is good and you can approve the loan, he can insure and further clarify by phone the data that the client has not filled out.  As a result, datasainist works with a training kit, in which good clients usually have the most complete and complete questionnaire.  In this case, the signs of the type ‚Äúfilled in the optional field X‚Äù will be strong and will characterize the borrower as good.  However, in the mode of automatic scoring for good clients, these fields will be blank.  In the best case, it will result in an overestimation of the quality of the model during offline validation.  At worst, the quality of the model is lower compared to the option not to use these features.  The solution to the problem is to work more closely with the underwriting department.  Monitoring, analysis and improvement of the data collection process. <br><br>  All of these problems formed the basis of a system for monitoring data quality and sustainability of scoring models. <br><br><h1>  Conclusion </h1><br>  In conclusion, I would like to give a few recommendations to specialists who dare to build scoring models. <br><br><ol><li>  Take data under complete control, try to build an end-to-end system.  The shorter the path from the source data source to your service with the scoring model, the better.  Any layer in the form of additional services of preprocessing / data storage only hurts. <br></li><li>  Perform feature analysis over time.  This can be done using the scatter plot, the x axis of the record id.  And also by analyzing the average value of the characteristic in time.  Train and test are better divided both in time and in objects (clients). <br></li><li>  Pay attention to illogically strong signs.  Perhaps they leak. <br></li><li>  Analyze the linear relationship between the feature and the target variable (even when building non-linear models).  The direction of the trend should be logical. <br></li><li>  If you want to get a logical relationship and a stable model, discretize monetary variables to integer values.  It happens that the correlation with other signs creeps in ‚Äúuneven sums‚Äù or in pennies. <br></li><li>  Analyze the data and quality of models in different sections.  Amount range, customer segment, application source - online / offline.  Try to achieve approximately the same quality model in each slice.  In the case of significant changes in the ratios of slices in traffic, there will be a deterioration in performance, since  The quality of the model was initially optimized for larger segments. <br></li><li>  Avoid auto-update models when new data is available.  In this case, it will be easier to carry out a retro analysis of the causes of model errors (it is not disclosed in the article, possibly in the future). <br></li><li>  The use of questionnaire data does not give a strong increase in quality to the option of using only bureau data.  Therefore, it is better to use this source in the latter stages, when the internal infrastructure for data collection and storage is built. <br></li><li>  Establish communication with other departments.  Each department (not only programmers-developers) should have a change log in which all changes with a brief description and date are reflected.  Even those that at first glance seem to be absolutely unimportant for scoring.  A change log will help identify cause-effect relationships. <br></li></ol><br>  I hope the examples described in the article will be useful.  They are based on combat experience and real disbursement of loans in large volumes over a long period. <br><br>  Dmitry Gorelov, Devim </div><p>Source: <a href="https://habr.com/ru/post/455551/">https://habr.com/ru/post/455551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455537/index.html">Search optimization in width: how to handle a graph with 10 billion states</a></li>
<li><a href="../455543/index.html">Is preparing a Kubernetes cluster easy and convenient? Announcing addon-operator</a></li>
<li><a href="../455545/index.html">Building processes from scratch: from chaos to order</a></li>
<li><a href="../455549/index.html">How to use groups in Facebook to promote: create a web</a></li>
<li><a href="../45555/index.html">HP introduced the first working hybrid transistor memristor</a></li>
<li><a href="../455553/index.html">Fighting Msg Too Big in Elm Applications</a></li>
<li><a href="../455555/index.html">Piece for the mechanical leader</a></li>
<li><a href="../455557/index.html">Experiment: Is it possible to reduce the negative effects of DoS-attacks using a proxy</a></li>
<li><a href="../455559/index.html">How can a quantum computer hack modern encryption systems and reduce the cost of ammonia production?</a></li>
<li><a href="../455563/index.html">Small business: automate or not?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>