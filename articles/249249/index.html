<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic configuration: the practice of using CFEngine in the real world</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CFEngine 
 Let's continue the story about CFEngine begun by the user alex_www in two previous articles. This discussion will focus on the practice of ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic configuration: the practice of using CFEngine in the real world</h1><div class="post__text post__text-html js-mediator-article"><h1>  CFEngine </h1><br>  <a href="https://habrahabr.ru/users/alex_www/" class="user_link">Let's</a> continue the story about CFEngine begun by the user <a href="https://habrahabr.ru/users/alex_www/" class="user_link">alex_www</a> in <a href="http://habrahabr.ru/post/164445/">two</a> <a href="http://habrahabr.ru/post/164923/">previous</a> articles.  This discussion will focus on the practice of using CFEngine and some of the nuances of setting it up in the real world.  To reduce the amount of text, I assume that you own the basic concepts from the world of CFEngine, maybe even tried to use it somewhere.  As a primer, I can advise Diego Zamboni‚Äôs book " <a href="http://www.amazon.ca/Learning-CFEngine-Automated-system-administration-ebook/dp/B007NLRUJS">Learning CFEngine 3</a> ", which is small, very understandable and read in one breath. <br><a name="habracut"></a><br>  The article provides examples for setting up from scratch on <a href="https://www.debian.org/distrib/">Debian GNU / Linux</a> using <a href="http://git-scm.com/">Git</a> .  If you want to supplement the article with examples for your favorite distros and VCS, then send private messages or comment in the comments.  If possible, I will add them to the main text indicating the authorship. <br><br><h2>  Installation </h2><br>  The easiest way to install CFEngine3 is through the official repository.  To do this, you first need to add a key with which the packages are signed: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">cd</span></span> /tmp wget http://cfengine.com/pub/gpg.key cat gpg.key <span class="hljs-comment"><span class="hljs-comment">#      apt-key add gpg.key rm gpg.key #  ,   </span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ... and then add the repository and put the CFE: <br><br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"deb http://cfengine.com/pub/apt community main"</span></span> &gt; /etc/apt/sources.<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.d/cfengine-community.<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> chmod <span class="hljs-number"><span class="hljs-number">644</span></span> /etc/apt/sources.<span class="hljs-keyword"><span class="hljs-keyword">list</span></span>.d/cfengine-community.<span class="hljs-keyword"><span class="hljs-keyword">list</span></span> <span class="hljs-comment"><span class="hljs-comment">#   umask 0700 apt-get update apt-get install cfengine-community</span></span></code> </pre><br><br><h2>  Initialization </h2><br>  To initialize CFE, you need to perform (for example, manually) the first run of the cf-agent.  If you have to frequently launch new servers, the installation of CFE and bootstrap is best done from <a href="https://wiki.debian.org/DebianInstaller/Preseed">preseed</a> or from a script that starts once when the system is first started;  A good example of such a script is the script that creates server keys for OpenSSH. <br><br><pre> <code class="hljs swift">/<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/cfengine/bin/cf-agent -<span class="hljs-type"><span class="hljs-type">IC</span></span> --bootstrap &lt;policy_hub_address&gt;</code> </pre> <br><br>  Instead of <code>&lt;policy_hub_address&gt;</code> you need to substitute the appropriate IP address or domain name of your policy hub, and if you initialize the policy hub itself, then you need to specify the IP on which it will serve clients later.  In the case of a domain name, it will be resolved to an IP address, which will be used in the future, so that problems with the possible unavailability of DNS servers will not interfere. <br><br>  The <code>-I</code> enables the creation of a short report on the execution, and <code>-C</code> - coloring the output in the console.  Both are optional, but I use them in interactive sessions for my own convenience.  Another useful startup option is <code>-v</code> , verbose mode.  It takes precedence over <code>-I</code> and gives you very detailed information on the progress of the promises.  Nice helps when debugging. <br><br><h2>  Primary setup </h2><br>  After completing the initial policy hub, before connecting to the first client, you need to configure some little things.  The fact is that the default settings in the <code>def.cf</code> file (hereinafter, for all relative paths, the root is <code>/var/cfengine/masterfiles</code> , unless otherwise specified) are well suited for ‚Äúon the knee‚Äù experiments or for demonstration of capabilities, but for Sell ‚Äã‚Äãthese options are not enough.  Below, I will write about the organization of the process of developing promises and rolling them out in the product, but for now it is best to make a local copy of <code>/var/cfengine/masterfiles</code> and work with it. <br><br>  First of all, let's specify our full domain name.  Despite the efforts of the development team to make a good system for auto-detecting the current system parameters, it is not ideal, so wherever possible and appropriately it is best not to rely on automation and specify the data manually.  Let's start with the <code>bundle common def</code> , and specify the <code>domain</code> , <code>mailto</code> , <code>mailfrom</code> and <code>smtpserver</code> : <br><br><pre> <code class="hljs scala"><span class="hljs-symbol"><span class="hljs-symbol">'domai</span></span>n' string =&gt; <span class="hljs-symbol"><span class="hljs-symbol">'example</span></span>.org'; <span class="hljs-symbol"><span class="hljs-symbol">'mailt</span></span>o' string =&gt; <span class="hljs-symbol"><span class="hljs-symbol">'sysadmin</span></span>-queue@${<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain</span></span></span><span class="hljs-function">}'</span></span>; #    <span class="hljs-type"><span class="hljs-type">CFE</span></span>        <span class="hljs-symbol"><span class="hljs-symbol">'mailfro</span></span>m' string =&gt; <span class="hljs-symbol"><span class="hljs-symbol">'root</span></span><span class="hljs-meta"><span class="hljs-meta">@cfe</span></span>-policy-server.${<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain</span></span></span><span class="hljs-function">}'</span></span>; <span class="hljs-symbol"><span class="hljs-symbol">'smtpserve</span></span>r' string =&gt; <span class="hljs-symbol"><span class="hljs-symbol">'internal</span></span>-mail-collector.${<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain</span></span></span><span class="hljs-function">}'</span></span>;</code> </pre><br><br><h2>  Security </h2><br>  CFE can ensure the security of connections and client authentication, however it does not have any exceptionally developed means for this, as there are enough available eyes to complete the task.  Anyway, in communications with clients, a system with trusted keys is used, similar to OpenSSH, and lists of trusted IP networks and domains.  By default, connections are allowed for all hosts in the policy hub domain and for / 16 of its primary IP.  All keys received from successfully established connections are considered trusted.  Such an approach in working conditions in a trusted network can greatly facilitate the deployment from scratch and is very convenient at the R &amp; D stage, but it is extremely unsafe in real life.  Given the ephemeral nature of IP addresses and the geographical distribution of monitored machines, I prefer to use the following approach: CFEngine ( <code>cf-serverd</code> , to be more precise) accepts connections from any IP address and only trusts those keys that it knows in advance (that is, are located in <code>/var/cfengine/ppkeys</code> ): <br><br><pre> <code class="hljs pgsql"> <span class="hljs-string"><span class="hljs-string">'acl'</span></span> slist =&gt; { <span class="hljs-string"><span class="hljs-string">'0.0.0.0/0'</span></span>, }; <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Connections are allowed from any IP'</span></span>, handle =&gt; <span class="hljs-string"><span class="hljs-string">'common_def_vars_acl'</span></span>; <span class="hljs-string"><span class="hljs-string">'trustkeysfrom'</span></span> slist =&gt; { # NEVER <span class="hljs-keyword"><span class="hljs-keyword">ADD</span></span> ANYTHING HERE. DON<span class="hljs-string"><span class="hljs-string">'T TRUST STRANGERS! }, comment =&gt; '</span></span><span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> keys <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> /var/cfengine/ppkeys are <span class="hljs-keyword"><span class="hljs-keyword">trusted</span></span><span class="hljs-string"><span class="hljs-string">', handle =&gt; '</span></span>common_def_vars_truskeysfrom<span class="hljs-string"><span class="hljs-string">';</span></span></code> </pre><br><br>  In the case when it is necessary to restrict access to IP addresses, I prefer to use a firewall as a tool more suitable for solving the problem. <br><br>  To add a client key to trusted files, copy the contents of the <code>/var/cfengine/ppkeys/localhost.pub</code> file (the usual RSA key in Base64) to the policy hub and run <code>cf-key -t /path/to/client_key.pub</code> .  The <code>cf-key</code> program will add it to <code>/var/cfengine/ppkeys</code> with the correct name and permissions. <br><br><h1>  Standard library </h1><br>  Automation of configuration control, which makes it easy to make large-scale changes, also leads to large-scale errors with the same ease.  Therefore, a reasonable number of "seat belts" and "big red buttons."  One of these ‚Äúbelts‚Äù is the insertion of the standard library into the VCS along with your code.  When installing a package with a new version, the contents of the <code>/var/cfengine/masterfiles</code> and <code>/var/cfengine/inputs</code> not updated, as a result, it will be impossible to guarantee the consistency of the configuration.  Therefore, one of the important stages of updating is merging the changes of the standard library with your copy and it is here that all the help your VCS can offer you is useful, as well as the ability to use the <code>diff</code> and <code>patch</code> utilities. <br><br><h2>  package_latests </h2><br>  One of the mechanisms that I often use to guarantee updates of some packages is the <code>package_latest</code> bundle from the standard library.  Unfortunately, there is a <a href="https://dev.cfengine.com/issues/6741">bug</a> because of which the bundle in Debian does not work.  Fix is ‚Äã‚Äãquite trivial.  In the file <code>lib/3.6/packages.cf</code> you need to find the bundle code <code>packages_latest</code> and bring it to this form (you can use a <a href="https://dev.cfengine.com/attachments/download/2255/p1.patch">patch</a> from the bug report): <br><br><pre> <code class="hljs php">debian:: <span class="hljs-string"><span class="hljs-string">"$(package)"</span></span> package_policy =&gt; <span class="hljs-string"><span class="hljs-string">"addupdate"</span></span>, package_version =&gt; <span class="hljs-string"><span class="hljs-string">"999999999:9999999999"</span></span>, package_method =&gt; apt_get_permissive;</code> </pre><br><br><h2>  Bug 6870 </h2><br>  Another annoying bug that I discovered in the sale is <a href="https://dev.cfengine.com/issues/6870">bug 6870</a> .  The essence of the problem is that CFEngine establishes some classes based on PTR records of IP addresses on interfaces.  As you can guess, this behavior of the system is very, very unsafe, and it contradicts the CFEngine postulate about the unacceptability of external knowledge.  However, in his book, Diego Zamboni teaches how to determine the execution host by the class of the <code>host1_example_org</code> type, and fixing this bug can break too many systems currently working.  Therefore, until the developers have provided a more reliable method, we will create it ourselves.  Here is the code that you can add to your version of the standard library in the file <code>lib/3.6/bug_6870.cf</code> : <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">bundle</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">common</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bug_6870_workaround</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">classes</span></span>: <span class="hljs-string"><span class="hljs-string">'bug6870_workaround_${sys.host}'</span></span> expression =&gt; <span class="hljs-string"><span class="hljs-string">'any'</span></span>; }</code> </pre><br><br>  Then you need to add the file name to <code>${stdlib_common.inputs}</code> by analogy with the files already listed there, and after that use the <code>bug6870_workaround_host1_example_org</code> class without fear of unexpected intersections with the PTR records of other IPs. <br><br><h1>  Life cycle </h1><br>  Now, when everything is ready for creativity, I will tell you a little about the organization of the process of developing promisses and a bit about more mundane, everyday things. <br><br><h2>  Instruments </h2><br>  First of all, promises should be written in something.  For this, your favorite <a href="http://cfengine.com/cfengine-code-editors/">text editor</a> will most likely fit.  I prefer Vim and use plugins <a href="https://github.com/neilhwatson/vim_cf3">written by</a> Neil Watson (Niel Watson), and my colleague Valera Ostroverhov (Val Astraverkhau) <a href="https://github.com/lastops/sublime-cfengine">created a</a> very good plug-in to support CFEngine in Sublime Text 2 and 3. Emacs users will be interested in Ted Zlatanov's <a href="https://www.youtube.com/watch%3Fv%3D-PPVhwSKNdE">lecture</a> (Ted Zlatanov) using Emacs as a CFEngine IDE. <br><br>  You will also need a good version control system.  Git suits me all, but I'm sure any modern VCS will do.  The requirements here are the same as for the development of ordinary software, so take what you are comfortable with. <br><br><h2>  File Organization and Entry Point </h2><br>  I will say right away that the method proposed by me is not the only correct one.  The principle of <a href="http://en.wikipedia.org/wiki/There%2527s_more_than_one_way_to_do_it">TIMTOWTDI,</a> familiar to Perl <a href="http://en.wikipedia.org/wiki/There%2527s_more_than_one_way_to_do_it">programmers, is</a> applicable here;  and nowhere else, controversy is appropriate.  Here is an example directory structure, relative to the project root: <br><br><pre> <code class="hljs sql">/bin /masterfiles /masterfiles/cfe_internal /masterfiles/cfe_internal/ha /masterfiles/controls /masterfiles/controls/3.4 /masterfiles/inventory /masterfiles/example_org /masterfiles/lib /masterfiles/lib/3.5 /masterfiles/lib/3.6 /masterfiles/services /masterfiles/services/autorun /masterfiles/sketches /masterfiles/sketches/meta /masterfiles/templates /masterfiles/<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">static</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>/bird-lg /<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>/firewall-configs /<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>/ssh-<span class="hljs-keyword"><span class="hljs-keyword">keys</span></span> /templates</code> </pre><br><br>  In the directory <code>/masterfiles/example_org</code> is the code that we write.  The rest of the subdirectories in <code>/masterfiles</code> are parts of the standard delivery that I try not to change unless absolutely necessary.  All non-standard templates are in <code>/templates</code> , and in <code>/static</code> , as the name implies, ‚Äústatic‚Äù information is stored - public SSH-keys, firewall settings, user settings, configuration files, etc., which does not change from host to host.  There are a couple of service scripts in the <code>/bin</code> directory, including the ‚Äúbig red button‚Äù - a script that puts all the necessary files to where CFEngine can distribute them to customers. <br><br>  The entry point is located in <code>/masterfiles/example_org/main.cf</code> , which contains two promises: <code>bundle common example_org</code> , which lists the files used and the servers are classified, and the <code>bundle agent example_org_main</code> , where, depending on the class, control is transferred to the necessary bundle, which describes exactly how Servers of this class must be configured. <br><br>  To specify the entry point in the <code>promises.cf</code> file, you need to make the following changes: <br><br><pre> <code class="hljs axapta">body <span class="hljs-keyword"><span class="hljs-keyword">common</span></span> control { bundlesequence =&gt; { <span class="hljs-meta"><span class="hljs-meta"># [...] @{example_org.bundles}, }; inputs =&gt; { # [...] 'example_org/main.cf', @{example_org.inputs}, }; }</span></span></code> </pre><br><br>  <code>example_org/main.cf</code> looks like this: <br><br><pre> <code class="hljs php">bundle common example_org { vars: <span class="hljs-string"><span class="hljs-string">'inputs'</span></span> slist =&gt; { <span class="hljs-string"><span class="hljs-string">'example_org/add_default_users.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/basic_packages.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/configure_dns.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/configure_firewall.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/configure_ftp.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/configure_ssh.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/cve_2015_0235.cf'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org/lib.cf'</span></span>, }; <span class="hljs-string"><span class="hljs-string">'bundles'</span></span> slist =&gt; { <span class="hljs-string"><span class="hljs-string">'example_org'</span></span>, <span class="hljs-string"><span class="hljs-string">'example_org_main'</span></span>, }; classes: <span class="hljs-string"><span class="hljs-string">'ftp_server'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> =&gt; {classmatch(<span class="hljs-string"><span class="hljs-string">'BUG6870_ftp.*'</span></span>)}; <span class="hljs-string"><span class="hljs-string">'dns_server'</span></span> expression =&gt; classmatch(<span class="hljs-string"><span class="hljs-string">'BUG6870_dns.*'</span></span>); reports: verbose_mode:: <span class="hljs-string"><span class="hljs-string">'${this.bundle}: defining inputs="${inputs}"'</span></span>; <span class="hljs-string"><span class="hljs-string">'${this.bundle}: defining bundles="${bundles}"'</span></span>; ftp_server:: <span class="hljs-string"><span class="hljs-string">'This host assumes FTP server role'</span></span>; dns_server:: <span class="hljs-string"><span class="hljs-string">'This host assumes DNS server role'</span></span>; } bundle agent example_org_main { methods: any:: <span class="hljs-string"><span class="hljs-string">'example_org_update_motd'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'update_motd'</span></span>; <span class="hljs-string"><span class="hljs-string">'example_org_basic_packages'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'basic_packages'</span></span>; <span class="hljs-string"><span class="hljs-string">'example_org_add_default_users'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'add_default_users'</span></span>; <span class="hljs-string"><span class="hljs-string">'example_org_configure_firewall'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'configure_firewall'</span></span>; <span class="hljs-string"><span class="hljs-string">'example_org_configure_ssh'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'configure_ssh'</span></span>; <span class="hljs-string"><span class="hljs-string">'example_org_cve_2015_0235'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'cve_2015_0235'</span></span>; any.Min30_35:: <span class="hljs-string"><span class="hljs-string">'heartbeat'</span></span> usebundle =&gt; <span class="hljs-string"><span class="hljs-string">'heartbeat'</span></span>; <span class="hljs-comment"><span class="hljs-comment"># FTP servers configuration ftp_server:: 'example_org_configure_ftp' usebundle =&gt; 'configure_ftp'; # DNS servers configuration dns_server:: 'example_org_configure_dns' usebundle =&gt; 'configure_dns'; }</span></span></code> </pre><br><br>  This example was made up of several real projects for demonstration, in reality, of course, everything is a little more complicated and more.  The purpose of this approach is to minimize the number of changes in the standard library, so that later it would be easier to maintain changes in it. <br><br><h2>  Debugging and Testing </h2><br>  Since the price of a mistake is high, before clicking on the ‚Äúbig red button‚Äù, it‚Äôs worth testing your promises.  For tests, I have a small polygon: several <a href="http://www.linux-kvm.org/">virtual machines</a> that I run on my work computer.  On them, I check the correctness of the <em>promises</em> and do experiments. <br><br>  In the development of promises, I adhere to the style of school debugging through printf, that is, I use <code>report</code> promises very widely.  Another indispensable tool is the complete <code>cf-promises</code> utility.  In addition to the formal validation of the syntax, it can show all classes available at runtime (the <code>--show-classes</code> parameter) and variables with their contents (the <code>--show-vars</code> ).  And of course, running <code>cf-agent</code> in verbose mode ( <code>--verbose</code> option). <br><br><h2>  Updates </h2><br>  You can update the CFEngine version on all controlled machines in two ways: either through the package manager, or using the mechanisms of CFEngine itself.  I prefer the package manager, for which I have a special promise, which I connect only for the duration of updates, its essence comes down to calling <code>package_latest</code> .  In my opinion, this approach best suits the concepts of CFE. <br><br><h2>  Big Red Button </h2><br>  Rolling out the food is always a little exciting moment, even if it happens many times a day, and I do not blame people who have some kind of ritual for that.  In the case of massive configuration changes, it can determine the meaning of life for the next few days if something goes wrong.  Therefore, no automation, no hooks for Git.  Only manual mode, as a pledge of confidence that everything is done correctly, tested and ready for sale.  I have a <code>deploy.sh</code> script with <code>0600</code> permissions as a button, so that it can‚Äôt be run at random.  Using my hands in the <code>bash bin/deploy.sh</code> console <code>bash bin/deploy.sh</code> is my ritual and the last opportunity to cancel the launch.  The script itself is quite trivial: using <code>rsync</code> it synchronizes <code>masterfiles</code> , <code>static</code> and <code>templates</code> with the contents of <code>/var/cfengine/{masterfiles,static,templates}</code> and runs two commands: <code>cf-agent -KIC -f update.cf</code> and <code>cf-agent -KIC -f promises.cf</code> .  So I can be sure that at a minimum a policy hub can perform promises and distribute them to all customers. <br><br><h1>  Conclusion </h1><br>  This is not all the subtleties and wisdom, but this is quite enough to start the introduction of CFEngine in themselves.  Such interesting topics as " <a href="https://github.com/cfengine/design-center">Design Center</a> ", reports, internal structure, various usage scenarios and much more remained outside the scope of the article.  If CFEngine is of some interest to the habrasoobshchestva, I will gladly tell you more about it, but for now, if you have any pressing questions right now, feel free to ask them in the comments.  My colleague on <a href="http://lastops.com/">lastops</a> <a href="https://habrahabr.ru/users/cagliostro/" class="user_link">cagliostro</a> and I will try to answer them. </div><p>Source: <a href="https://habr.com/ru/post/249249/">https://habr.com/ru/post/249249/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249231/index.html">Another way to build TypeScript projects</a></li>
<li><a href="../249237/index.html">Submarine usability or why interfaces pull projects to the bottom</a></li>
<li><a href="../249241/index.html">A little bit about currying in Haskell</a></li>
<li><a href="../249243/index.html">Apriori: new or well forgotten old</a></li>
<li><a href="../249247/index.html">Monolithic system VS many independent modules on the example of the parable of the elephant and the wise men</a></li>
<li><a href="../249251/index.html">Sunset era icons from FatCow (sample by color, top 30 and other arithmetic)</a></li>
<li><a href="../249255/index.html">Welcome to Moscow.pm February 5</a></li>
<li><a href="../249257/index.html">GoDaddy stops servicing domain names registered by residents of Crimea and frees them for registration.</a></li>
<li><a href="../249259/index.html">Migrating from SQL Server to MariaDB / MySQL. What to do with XML</a></li>
<li><a href="../249263/index.html">Model View Controller (MVC) usage experience, conclusions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>