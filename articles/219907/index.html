<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP extension dom_varimport: fast conversion of nested arrays to DOMDocument</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some projects use XSLT as the main ‚Äúengine‚Äù of templates. In addition to the well-known flaws of XSLT (for example, its verbosity, relative slowness, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP extension dom_varimport: fast conversion of nested arrays to DOMDocument</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/e41/a33/ca1/e41a33ca1a164ee6c2d0cc2bc8b4a758.jpg" width="200" align="left">  Some projects use XSLT as the main ‚Äúengine‚Äù of templates.  In addition to the well-known flaws of XSLT (for example, its verbosity, relative slowness, etc.) it also has advantages: the ‚Äústandard‚Äù of the language, its ideology of the absence of ‚Äúside effects‚Äù and pattern matching, the ability to call methods of helper classes from templates (via exslt extension).  Some time ago I laid out the <a href="http://dklab.ru/lib/Dklab_ShortXSLT/">ShortXSLT</a> library, allowing instead of cumbersome &lt;xsl: value-of-select = "/ root / abc" /&gt; and &lt;xsl: choose&gt; ... &lt;/ xsl: choose&gt; to write simply {/ root / abc} and {if ...} ... {elseif} ... {/ if} without losing performance, so the verbosity problem is partly solved. <br><br>  But now it‚Äôs not about the advantages and disadvantages of XSLT (I‚Äôm sure both opponents and supporters of this technology will be abundant).  I would like to describe one trick that is convenient to use in <b>existing</b> projects with XSLT templates, and provide a link to the library that implements this trick with good performance. <br><br><h5>  Passing data to XSLT, bypassing the generation of XML text representation </h5><br>  Imagine that we have a controller that generates some nested PHP list of objects to display on the page.  It should convert this array to XML, which then goes to the input XSLT-template.  It would be good if this conversion from PHP to XML structures was not performed manually in each controller, but there was some intermediate layer of abstraction that can apply the XSLT template directly to PHP data, bypassing the XML text representation.  So we will reduce the likelihood of errors, and the letter will be reduced.  We can work with XSLT templates directly, bypassing the XML representation of the data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Some time ago I wrote the PHP <a href="http://dklab.ru/lib/dom_varimport/">dom_varimport</a> extension in <a href="http://dklab.ru/lib/dom_varimport/">C</a> (also <a href="https://github.com/DmitryKoterov/dom_varimport">posted on GitHub</a> ).  It contains the function of the same name, the input of which is the DOMDocument object and the PHP array of any nesting.  The function fills the DOMDocument passed to it with the XML representation of the input array, and it does it very quickly ‚Äî about <b>20 times faster</b> than the code written in pure PHP would do.  A large document about 1 MB in size with thousands of nested properties and objects is formed in about 1-2 milliseconds. <br><br>  For example, call: <a name="habracut"></a><br><br><pre> $ doc = new DOMDocument ();
 dom_varimport (
     $ doc,
     array (
         "some_key" =&gt; 111,
         123,
         0.5,
         "arr" =&gt; array ("1a" =&gt; "1a"),
         "obj" =&gt; (object) array ("prop" =&gt; "val"),
         true
         false,
         "b" =&gt; null,
         "empty" =&gt; array (),
     ),
     "root" // optional, defaults to "root"
 );
 $ doc-&gt; formatOutput = true;
 echo $ doc-&gt; saveXML ();  // this is for debugging only: in practice, you will not need to call saveXML ()
</pre><br>  will print this XML document: <br><br><pre> &lt;? xml version = "1.0"?&gt;
 &lt;root&gt;
     &lt;some_key key = "some_key"&gt; 111 &lt;/ some_key&gt; &lt;! - plain key = value -&gt;
     &lt;item key = "0"&gt; 123 &lt;/ item&gt; &lt;! - numeric keys are "item" tags -&gt;
     &lt;item key = "1"&gt; 0.5 &lt;/ item&gt; &lt;! - double -&gt;
     &lt;arr key = "arr"&gt; &lt;! - nested array -&gt;
         &lt;item key = "1a"&gt; 1a &lt;/ item&gt; &lt;! - invalid tag names are converted to "item" -&gt;
     &lt;/ arr&gt;
     &lt;obj key = "obj"&gt; &lt;! - nested object -&gt;
         &lt;prop key = "prop"&gt; val &lt;/ prop&gt;
     &lt;/ obj&gt;
     &lt;item key = "2"&gt; 1 &lt;/ item&gt; &lt;! - true converts to 1 -&gt;
     &lt;item key = "3" /&gt; &lt;! - false converts to an empty string -&gt;
     &lt;b key = "b" /&gt; &lt;! - null also converts to an empty string -&gt;
     &lt;empty key = "empty" /&gt; &lt;! - empty array is an empty element -&gt;
 &lt;/ root&gt;
</pre><br>  Everything is quite transparent: the array keys and properties of the objects become XML elements, possibly with the same names (but if the name is invalid for the XML element, then ‚Äúitem‚Äù is used instead).  Such an XML document is very easy to read when debugging, it is very compact.  So, we get the output of a DOMDocument object, which we can already pass to the XSLTProcessor.  The textual representation of XML does not appear anywhere, does not parse anywhere. <br><br><h5>  How to install the extension </h5><br>  The extension is written in C, so you need to compile it on a machine that has GCC installed and packages like php5-src (or php5-devel).  This is not at all scary: <br><br><pre> git clone https://github.com/DmitryKoterov/dom_varimport.git
 cd dom_varimport
 phpize
 ./configure
 make
 make test
 make install # or copy modules / dom_varimport.so manually
 phpize - clean
</pre><br>  The ‚Äúmake install‚Äù stage can be avoided: just take the modules / dom_varimport.so binary file and copy it to a directory with PHP extensions (for example, / usr / lib / php5), including on other machines.  Finally, you need to enable the extension in /etc/php5/conf.d/dom_varimport.ini and restart php5-fpm or apache: <br><br><pre> extension = /usr/lib/php5/dom_varimport.so
</pre></div><p>Source: <a href="https://habr.com/ru/post/219907/">https://habr.com/ru/post/219907/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../219895/index.html">WCF + Cross Domain Ajax Calls (CORS) + Authorization</a></li>
<li><a href="../219899/index.html">Site on c ++ (CppCMS). Part 1</a></li>
<li><a href="../219901/index.html">The beauty of the universe in NASA tweets</a></li>
<li><a href="../219903/index.html">Habrahabru - 8 years</a></li>
<li><a href="../219905/index.html">Data encryption in a public cloud - control and quiet sleep of the customer</a></li>
<li><a href="../219909/index.html">The basic rules of indie gamedev. Part 3</a></li>
<li><a href="../219911/index.html">Cryptography - FSTECU!</a></li>
<li><a href="../219913/index.html">MongoDB: $ or VS $ in - what is faster?</a></li>
<li><a href="../219919/index.html">"Orbit" - a simulator of space programs for the development of nearby planets</a></li>
<li><a href="../219925/index.html">Why did Windows Azure become just Azure? Introduction to the platform for users of Linux, Open Source, Oracle DB, Android, iOS and other tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>