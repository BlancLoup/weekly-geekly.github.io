<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix alerts via sms using GSM modem. Easy setup</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Zabbix server is good. Properly configured, it monitors the servers and nodes I need. In case of problems on them, he will gladly notify me by e-mail....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix alerts via sms using GSM modem. Easy setup</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c75/23b/6b5/c7523b6b523f4c3fb6ba6a514a446c27.jpg"><br><br>  Zabbix server is good.  Properly configured, it monitors the servers and nodes I need.  In case of problems on them, he will gladly notify me by e-mail.  Not so long ago, it turned out that both of our favorite providers (the main and backup Internet channels) decided not to provide the UPS with their network equipment in the building.  Therefore, when electricity is cut down (and sometimes it happens!) Zabbix would be happy to wake up with a cheerful letter, but not at all!  In general, I decided to be confused by sms notification.  It is through a GSM modem so that there is no dependence on the Internet. <br><br>  Searching on the internet for sending sms to Zabbix, I found <a href="http://habrahabr.ru/post/155321/">solutions</a> , but they seemed to be long.  Therefore, I did it in my own way.  I will try to describe in detail not a complicated working solution and ‚Äúrakes‚Äù. <br><a name="habracut"></a><br>  <b>So, what I had was:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  Zabbix 2.4 on OC Debian 7 - monitors several servers, one of them is connected via USB cable APC smart ups 3000. Monitoring the status of the UPS is configured for <a href="http://habrahabr.ru/sandbox/21007/">this article</a> . </li><li>  GSM modem Huawei e1550 (Megaphone) which was lying at home since the absence of wired Internet.  As practice has shown, inserting another Huawei modem into an already configured system still works, without requiring reconfiguration! </li></ol><br>  To send sms from the terminal, I used gnokii. <br><br>  <b>Go:</b> <br><br><pre><code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># apt-get install gnokii</span></span></code> </pre> <br>  Insert the GSM modem into the server and check: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># lsusb</span></span></code> </pre> <br>  Among other things, we see something like: <br><br><pre>  Bus 001 Device 009: ID 12d1: 14ac Huawei Technologies Co., Ltd. </pre><br><br>  Check whether it was defined as a modem: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ls /dev/ttyUSB*</span></span></code> </pre> <br>  If empty (and I was empty): <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># apt-get install usb-modeswitch</span></span></code> </pre> <br>  We take out and re-insert the modem. <br><br>  Check whether it was determined: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># ls /dev/ttyUSB*</span></span></code> </pre> <br>  We see something like: <br><br><pre>  / dev / ttyUSB0 / dev / ttyUSB1 / dev / ttyUSB2 </pre><br><br>  <b>It remains a little before the first sending sms!</b> <br><br>  We create gnokii config.  I put it in / home <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># nano /home/user/sms.conf</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Config text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">global</span></span>] port = /dev/ttyUSB0 model = AT initlength = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> = <span class="hljs-type"><span class="hljs-type">serial</span></span> use_locking = <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> serial_baudrate = <span class="hljs-number"><span class="hljs-number">115200</span></span></code> </pre><br></div></div><br>  Save and test: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># echo </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"text"</span></span></span><span class="hljs-meta"> | gnokii --config /home/user/sms.conf --sendsms +7</span></span></code> </pre> <br>  (+ 7 - here, of course, the number to which you need to send) <br><br>  <b>Sms should come without problems.</b>  All of this has a lot of instructions on the Internet, and until that moment I had no problems. <br><br>  <b>Further important!</b> <br><br>  Zabbix in the system works from the user zabbix.  We allow him to use a modem. <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># nano /etc/group</span></span></code> </pre> <br><pre>  dialout: x: 20: zabbix </pre><br><br>  Otherwise, when sending from this user, we get something like: <br><br>  <i>GNOKII Version 0.6.30</i> <i><br></i>  <i>Gnokii serial_open: open: Permission denied</i> <i><br></i>  <i>Couldn't open ATBUS device: Permission denied</i> <i><br></i>  <i>Telephone interface init failed: Command failed.</i> <i><br></i>  <i>Quitting.</i> <i><br></i>  <i>Command failed.</i> <br><br>  Even when sending, I met an error: <br><br>  <i>Cannot open logfile ./gnokii-errors</i> <i><br></i>  <i>WARNING: cannot be logged open, logs will be directed to stderr</i> <br><br>  This means there was no file in the path: <br><br><pre>  ~ / .cache / gnokii / gnokii-errors </pre><br><br>  Change permissions for user to use sudo without password: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># nano /etc/sudoers</span></span></code> </pre> <br><pre>  zabbix ALL = (ALL) NOPASSWD: / usr / bin / gnokii </pre><br><br>  Further we log in under the user of zabbix and we write very simple script. <br><br><pre> <code class="hljs pgsql"> nano /home/<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>/smsscript</code> </pre> <br><br><div class="spoiler">  <b class="spoiler_title">Script text</b> <div class="spoiler_text">  #! / bin / sh <br>  zabbixesmsto = $ 1 <br>  zabbixsubject = $ 2 <br>  echo "$ zabbixsubject" |  / usr / bin / sudo / usr / bin / gnokii --config /home/user/sms.conf --sendsms "$ zabbixesmsto" <br><br></div></div><br><br>  We save.  It is / usr / bin / sudo and / usr / bin / gnokii - this turned out to be important for me! <br><br>  Do not forget to do from the root: <br><br><pre> <code class="hljs vala"><span class="hljs-meta"><span class="hljs-meta"># chmod +x /home/user/smsscript</span></span></code> </pre> <br>  Check the script work: <br><br><pre> <code class="hljs pgsql">/home/<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>/smsscript +<span class="hljs-number"><span class="hljs-number">7</span></span>XXXXXXXXXX test</code> </pre> <br>  <b>If the sms came - everything is almost ready!</b>  <b>It remains to fasten to Zabbix.</b>  If it didn‚Äôt come, then we check if everything was done as described above. <br><br>  I created a script for zabbiks in / home / user / because in the zabbix_server.conf config it is written: AlertScriptsPath = / home / user / <br><br>  If you are wrong, then either change the location of the script, or change the path to / home / user / in the config file - do not forget to restart the zabbix server! <br><br>  In the interface of the zabbiks we go to Administration - Alert methods. <br><br>  Create an alert method. <br><br><img src="https://habrastorage.org/files/ef9/085/0f1/ef90850f1ddb446c9ad434aba776800b.jpg" alt="image"><br><br>  Then we set up an alert for your user in zabbiks.  Administration - Users. <br><br><img src="https://habrastorage.org/files/6ba/827/83f/6ba82783f32d494ca5345fa1a3d295f7.jpg" alt="image"><br><br>  And Setup - Actions. <br><br><img src="https://habrastorage.org/files/997/f7c/6e8/997f7c6e8009421c83e3ae4da8962f60.jpg" alt="image"><br><br>  I made a separate action so that sms did not come for every occasion, but only when certain triggers were triggered.  Since, when sending messages, only a topic is written in sms, there is no point in writing something in the message itself.  And in the condition added: <br><br><img src="https://habrastorage.org/files/0a8/a60/eea/0a8a60eea37441a0840df53c7d83a237.jpg" alt="image"><br><br>  That's all!  I pulled from the IPT razdelka and in a few minutes received angry sms from zabbiksa!  Now he will get me everywhere, an infection! <br><br>  PS: Since electricity is not often disconnected, then the cost of sms is very small. </div><p>Source: <a href="https://habr.com/ru/post/270497/">https://habr.com/ru/post/270497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270485/index.html">Unit testing your Ionic application</a></li>
<li><a href="../270487/index.html">Manipulating stock prices with the help of fake news: How not to fall for it</a></li>
<li><a href="../270489/index.html">The tambourine exists. Proven Alloy Software</a></li>
<li><a href="../270491/index.html">Global Day of Code Retreat: free developer training</a></li>
<li><a href="../270493/index.html">5 principles of working with knowledge for the engineer</a></li>
<li><a href="../270499/index.html">Condition Tool</a></li>
<li><a href="../270501/index.html">Very short intro</a></li>
<li><a href="../270503/index.html">Analysis of shopping carts in retail</a></li>
<li><a href="../270505/index.html">Time to materialize: 5 days left until the end of the competition</a></li>
<li><a href="../270507/index.html">Regular expression searches can be quick and easy.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>