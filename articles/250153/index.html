<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Continuous integration with unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the transition to a new project on Unity with a relatively large development team, the need for automatic assembly and delivery of the applicatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Continuous integration with unity</h1><div class="post__text post__text-html js-mediator-article">  With the transition to a new project on Unity with a relatively large development team, the need for automatic assembly and delivery of the application to devices for testing has sharply arisen.  Here's how the situation was with this when I came to the project (on iOS): <br><ol><li>  On a separate mac-machine, the project was manually pumped out of the repository (Asset Sever). </li><li>  Manually ( <i>File-&gt; Build Settings-&gt; Build &amp; Run</i> ) started the build into the xCode project. </li><li>  Further in xCode the archive ( <i>Archive</i> ) became. </li><li>  The archive was exported to an ipa-file, which was manually uploaded to TestFlight. </li><li>  Further, already in TestFlight access was provided to the necessary testers. </li></ol><br>  Everything described above is automated with the help of so-called continuous integration (eng. <i>Continuous Integration</i> , <i>CI</i> ).  For my previous projects, TeamCity from JetBrains (the creators of the convenient Resharper code refactoring tool) was used for these purposes.  <a href="https://www.jetbrains.com/teamcity/">TeamCity</a> (TC) is a very powerful software product that fulfills the goals set for the continuous integration system, at 100%.  He can even more.  But this article is not about him (there are already <a href="http://habrahabr.ru/company/skbkontur/blog/205402/">articles on him</a> ), but about the new <a href="https://unity3d.com/ru/unity/cloud-build">Unity Cloud Build service</a> , especially for developers on the Unity engine. <br><br>  <b>UPD</b> .  Unity released Unity Cloud Build to the light, and I updated the article :) Read about changes and innovations below. <br><a name="habracut"></a><br>  First I want to warn you that some of the links below require access to the Unity Cloud Build, its forum and documentation. <br><br><h1>  Problem </h1><br>  We have a large project, and the whole procedure described above took <b>half an hour or more</b> .  The Mac on which the builds were made was slow.  Programmers rarely installed the application on the device (everything was checked mainly in the editor).  And therefore, one approach was usually not enough, because  after downloading to the device in the application, suddenly (according to the law of meanness) errors were detected.  In addition, there was no normal QA.  In addition, all this was done on Friday night - i.e.  we get all unfavorable conditions for such an important thing :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is clear that this could no longer continue.  The solution had to be, of course, complex, and as one of its parts I set the task: to introduce CI into the development.  The task was set as follows: <br><ul><li>  the CI system should be as free as possible; </li><li>  Must support the assembly of Unity-projects; </li><li>  its setup should be very simple; </li><li>  for everything about everything - no more than one working day. </li></ul><br>  Last time, in TeamCity, I killed just about a day to set up the first build, but then I set up and maintained these builds for a long time.  In addition, it requires hosting on its server, its configuration and support.  And this time I decided to try the Unity Cloud Build.  Recently, I heard a lot about him and first of all I bought what I don‚Äôt need to have my server and mac as a machine for building, everything is done on their side. <br>  Unity acquired the Tsugi platform and built the Unity Cloud Build on its base.  Now the service is already publicly available, any Unity developer, even the owner of the free version, can register and use the system on the free plan by default.  I registered with UCB on their page and started setting up the first build. <br><br><h1>  Customization </h1><br>  It took me about 15 minutes to set up. It is interactive and goes through several stages. <br><ul><li>  <i><b>Enter the project link in the repository</b></i> .  Supported <i>svn</i> , <i>perforce</i> and <i>git</i> .  The type of repository is automatically determined by reference.  It turned out that UCB does not support <i>Asset Server</i> , which is strange - not to support its own version control system.  When I came to work on the project, he was just at AS.  When meeting with AS, I was killed first of all by the fact that there is no support for branches (and for a large project this is important), and their merger is based on the time of change ( <i>time-based</i> ), and not on the changes.  The lack of AS support from UCB was another reason for the project being transferred to the git repository. <img src="https://habrastorage.org/files/1c2/b27/16a/1c2b2716a8e04f47b3ef8f775ded9231.png"></li><li>  <b><i>Configure access to the repository</i></b> .  In the case of <i>git,</i> UCB generates an SSH key that you need to register, for example, in the admin area of ‚Äã‚Äãa project on a <i>bitbucket</i> or <i>github</i> .  After gaining access, UCB allows you to select the branch from which the project will be built. </li><li>  <b><i>Setting up the project</i></b> .  At this stage it is possible to choose the version of Unity, with which the project will be built.  UCB now has all versions up to Unity 5 <s>beta</s> inclusive.  At the moment, UCB supports <i>Web</i> , <i>iOS</i> and <i>Android platforms</i> , and you don‚Äôt need to have Pro-licenses for iOS and Android platforms to access them, at least for now;) In the future, they plan to add <i>Standalone</i> <i>platforms</i> and <i>Windows Phone</i> .  You can also specify a specific folder in the repository, as a folder of the Unity-project. <img src="https://habrastorage.org/files/776/385/574/7763855746094eb2aa943c94c29c9894.png"></li><li>  <b><i>Customize the build and subscription applications</i></b> .  At this stage, the certificate is specified for the application subscription in the <i>p12</i> format.  In the case of iOS, the profile is also indicated ( <i>provision profile</i> ) and you can select the xCode version - 5 or 6 (6.0.1 is currently used). <img src="https://habrastorage.org/files/be2/9a4/ad1/be29a4ad102a4ce9ae6fa7730f542a41.png"></li></ul><br>  After that, the system will automatically start building the project.  At the end of the process, a compact and detailed log of the assembly, the application itself + packed <i>dSYM</i> (for iOS) will be available. <br>  <b>UPD</b> .  As it turned out, in the case of Android, UCB is not able to split apk into expansion files.  So in this case, you can use UCB for testing only, and release the build to build manually. <img src="https://habrastorage.org/files/ca6/90c/708/ca690c708c02441586c2a6cd9e20703b.png"><br><br><h1>  Distribute the collected application </h1><br>  UCB has several options for ‚Äúsharing‚Äù an assembly: <br><img src="https://habrastorage.org/files/d50/cbf/86a/d50cbf86af8f49d1a5952c3623b93b83.png"><br><br><ul><li>  <i><b>Collaborators</b></i> .  This is a list of all who have access to the project.  At the end of the assembly, each of this list will receive a message in the mail with a link to install.  You can navigate through it on the device and install the application in one touch.  And you can go to the admin area from a browser on your computer and download the <i>ipa-</i> file and continue to do whatever you want with it.  This method has one drawback - all of this list have access to the build settings and all assembled applications. <img src="https://habrastorage.org/files/9f0/ae9/b19/9f0ae9b198934b7c983417f3b6a8a553.png"></li><li>  <i><b>Share via Link</b></i> .  A link is generated, according to which it will be possible to download a specific assembly.  Anyone can download / install the application using this link.  It is permanent, i.e.  over time does not change for a specific assembly. <img src="https://habrastorage.org/files/5b9/9d6/cd0/5b99d6cd0a3b45b5be5dd91200b14ffe.png"></li><li>  <b>UPD</b> .  Options <i>Push to TestFlight</i> is no more.  Apple closed Testflight in its old form (having previously banned the download of Android applications for testing) and proposed, based on it, <a href="https://developer.apple.com/testflight/">its version of the</a> distribution of test applications through iTunes Connect.  The perversity of Apple's new method is that in order to give an application to an external test ( <i>External Testers</i> , up to 1000 testers), it must pass an internal test - <i>Beta App Review</i> .  How long it lasts - I do not know, have not tried it yet, but the application must meet all the same criteria as before sending it to the AppStore.  For internal tests ( <i>Internal Testers</i> , not more than 25) testers should have access to iTunes Connect in the role of Technical or Admin, and this is not always possible. </li></ul><br><h1>  Other features </h1><br><ul><li>  <b><i>The number of assemblies is unlimited</i></b> .  For example, in a free TC there are restrictions on the number of agents (as they call machines for assembly) and the number of assemblies.  For more you need to buy additional licenses. </li><li>  <b><i>Unity Cloud Build manifest</i></b> .  I learned about the <a href="https://build.cloud.unity3d.com/support/guides/manifest">assembly manifest</a> when I tried to embed in a debug assembly the ability to display in the application information about the commit from which the application was assembled.  This is very convenient when testing.  It turned out that the guys from UCB are building into a project a ‚Äúmanifest‚Äù in JSON format, from which you can get a lot of useful information for tests: commit, branch name, build number, etc. But if you need to build an application for the store, this manifest will go together with him on sale :( </li></ul><br><h1>  Additional settings </h1><br>  In the settings there is an <a href="https://build.cloud.unity3d.com/support/guides/advancedfeatures">Advanced Settings</a> section.  Most recently, it was available only on request, in test mode.  Now available for paid subscription holders. <br><ul><li> <b><i>Development Builds</i></b> .  Corresponds to the build options <a href="http://docs.unity3d.com/ScriptReference/BuildOptions.Development.html">BuildOptions.Development</a> + <a href="http://docs.unity3d.com/ScriptReference/BuildOptions.AllowDebugging.html">BuildOptions.AllowDebugging</a> , and the corresponding settings in <i>File-&gt; Build Settings</i> , so that you can debug the assembled application.  By default, release is set. </li><li>  <b><i>Pre / Post-Export Method Name</i></b> .  These methods are invoked before building the project and after creating the xCode project, respectively.  Here they just allow you to work wonders!  It should be noted that the class file for these methods must be in the <i>Editor</i> folder (not necessarily in the root of the project).  This is not indicated in the certificate and took my time until I achieved a working assembly. </li><li>  <b><i>Scripting Define Symbols</i></b> is a very handy thing.  You can not set them in the project settings, but set separately for each assembly.  For example, to use preprocessor symbols like <i>DEBUG</i> , <i>RELEASE</i> , <i>STORE</i> , and so on in the code. </li><li>  <b><i>Scene List</i></b> - you can separately specify a list of scenes for assembly.  It can be useful, for example, if there are special test scenes for tests. </li></ul><img src="https://habrastorage.org/files/bbe/b81/436/bbeb8143695c48f58eef7631b70ba18f.png"><br><br><h1>  Subscriptions and price </h1><br>  With the release of the Unity Cloud Build system, <a href="https://build.cloud.unity3d.com/plans/">subscriptions</a> have been introduced.  There are 4 types of subscriptions, each new one includes the previous one: <br>  1. <b><i>Free</i></b> . <br><ul><li>  As the name implies - this is a free plan. </li><li>  1Gb is allocated for a project, and the entire space occupied by the project folder during assembly is considered. </li><li>  At least 60 minutes between assemblies, i.e.  Before the next assembly (automatic or manual start), you will have to wait at least an hour.  But <i>Library Caching is</i> enabled by default. </li><li>  Ability to simultaneously collect only 1 project. </li><li>  You cannot add other people to the project ( <i>Collaborators</i> ).  But you can share assemblies using the links generated by them ( <i>Share via Link</i> ). </li><li>  Advanced settings are not available. </li></ul><br>  2. <b><i>Pro</i></b> . <br><ul><li>  $ 25 per month. </li><li>  2Gb to the project. </li><li>  At least 30 minutes between assemblies. </li><li>  Up to 3 projects can be collected simultaneously. </li><li>  Up to 5 people can be added to the project. </li><li>  Additional options available are <i>Development Builds</i> and <i>Custom Scripting Defines</i> . </li></ul><br>  3. <b><i>Studio</i></b> . <br><ul><li>  $ 100 per month. </li><li>  5Gb per project. </li><li>  At least 5 minutes between assemblies. </li><li>  Up to 6 projects can be collected simultaneously. </li><li>  Up to 20 people can be added to the project. </li><li>  Optional options are <i>Pre- / Post-Export methods</i> and <i>Custom Scene Lists</i> . </li><li>  Perforce support. </li></ul><br>  4. <b><i>Enterprise</i></b> . <br><ul><li>  Separate plan.  On the price you need to negotiate. </li><li>  There are separate machines for assembling your projects. </li><li>  Theoretically - the fastest time to build projects. </li><li>  All restrictions above are removed. </li></ul><br><br><img src="https://habrastorage.org/files/bd6/aa5/e0e/bd6aa5e0e0054ddbbd784650a1baf55c.png"><br><br><h1>  Disadvantages or anything else you want </h1><br><ul><li>  <b><i>The project is going relatively long</i></b> .  This means a free subscription.  It also has a limit of 1 hour between assemblies.  Now the project, which is locally collected in 5-10 minutes, is collected on UCB in 15-50 minutes.  The reason is that UCBs do not allow it to be stored at home, and each time it is reloaded from the repository.  The only optimization that is available is the option <i>Cache Library Directory</i> - it allows you to cache the <i>Library</i> folder for the project, so with the new build you do not have to export everything again.  In general, this time is not so critical for development, if programmers have the opportunity to build a project locally for their tests.  <b>In paid plans, the time between assemblies is reduced</b> , and the most expensive is the so-called ‚Äúdedicated build machines‚Äù ( <i>Dedicated Build Machines</i> ), in which they promise a very fast build by allocating individual machines for the company and caching the entire project on these machines.  <i>Please unsubscribe in the comments, is this true if someone had time to try.</i> </li><li>  <b><i>It is not possible to customize an assembly from a family of branches</i></b> , such as <i>feature / *</i> .  This is a possibility in TC, and UCB always collects from a strictly specified branch.  If someone is familiar with the <a href="http://habrahabr.ru/post/106912/">git-flow</a> paradigm, it can be very useful for development, when programmers get different branches for tasks and can (they or testers) test it right away on an assembled application.  As a result, we have managed several projects in UCB that are configured for different branches, for example, <i>master</i> (Release-build separately for tests and downloads to the store), <i>develop</i> , <i>release</i> branch for continuous testing of the current release and specific branches of current features ( <i>feature</i> ).  Naturally, these projects have different settings, such as <i>Development Build</i> , <i>Scripting Define Symbols</i> .  Respectively, the Release-assembly for tests and AppStore automatically gathers as soon as the <i>release-the</i> flow joins <i>master</i> (according to <i>git-flow</i> ). </li><li>  <b><i>There is no possibility to include automatic testing into the process</i></b> , although Dmytro Mindra at the last DevGamm in Minsk swore that such an opportunity exists) Naturally, this can be done manually, using the <a href="https://unity3d.com/ru/learn/tutorials/modules/beginner/live-training-archive/test-tools">Unity Test Tools</a> and the <i>Pre-Export Method</i> option, but I want more serious native support, with a table of test results and graphs) </li><li>  <b><i>Not always the project assembled on the local machine corresponds to what is collected on UCB</i></b> , and such an application will not always work on the device.  For example, we used a plug-in for in-game purchases from Soomla.  The application compiled locally worked fine, and the compiled at UCB was ‚Äúhung up‚Äù on the plug-in function <i>Initialize</i> .  As a result, Soomla turned out to add the <i>`-ObjC`</i> flag to <i>Build Settings&gt; Other Linker Flags</i> and it is <a href="http://forum.unity3d.com/threads/builds-doesnt-work-due-to-soomla-inapp-plugin.293635/">misused by UCB</a> .  The problem has already been fixed, but because of it we couldn‚Äôt test assemblies from UCB for some time, we had to build the project locally, in the old-fashioned way). </li><li>  <b>UPD</b> .  <b><i>No support for split application binary.</i></b>  If <i>Split Application Binary is</i> enabled in the project settings to get an add-on file for Google Play, in case the application takes more than 50Mb, you will have to disable it, otherwise in UCB the output will be a non-working apk without an add-on file.  While support for add-ons is not implemented. </li></ul><br><h1>  Summary </h1><br>  So, I liked the Unity Cloud Build.  The project is developing, the forum is asked about current requests from developers and they are gradually implemented, technical support responds fairly quickly.  If you are developing projects on Unity and are thinking about CI, I recommend trying Unity Cloud Build.  Save time and money. <br><br>  Pros: <br><ul><li>  Quick setup.  With ready certificates, profiles and a link to the repository, it will take only <b>2 minutes</b> . </li><li>  The ability to ‚Äúfree‚Äù collect under Android and iOS, their licenses do not require, and even mac will not be required. </li><li>  For those who do not care about assembly time, this is a great opportunity for automatic assembly and storage of all application assemblies. </li><li>  Additional features to customize the assembly. </li><li>  The number of projects and assemblies is unlimited. </li></ul><br>  Minuses: <br><ul><li>  Relatively long build time on the free plan.  With the most expensive plan they promise a quick build, but I have not tried it myself, I can not guarantee it. </li><li>  There is no support for Hg, TFS, Asset Server (although I would not recommend using the last two). </li><li>  There is no built-in support for automatic tests. </li></ul><br><br>  Waiting for questions, suggestions, clarifications in the comments! <br><br>  Perhaps someone will be interested to read my previous articles: <br><ul><li>  <a href="http://habrahabr.ru/post/117564/">Game in two days</a> </li><li>  <a href="http://habrahabr.ru/post/122197/">2d on unity3d</a> </li><li>  <a href="http://habrahabr.ru/post/169451/">Optimization of 2D applications for mobile devices in Unity3d</a> </li></ul><br>  Good luck in your development! </div><p>Source: <a href="https://habr.com/ru/post/250153/">https://habr.com/ru/post/250153/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250135/index.html">Thoughts</a></li>
<li><a href="../250137/index.html">Creating a view with an animated property change</a></li>
<li><a href="../250141/index.html">Installing Redmine on Windows 7 as a service, with sqlite3 database</a></li>
<li><a href="../250145/index.html">Stages of birth of new functionality in the software product</a></li>
<li><a href="../250149/index.html">Patterns in AngularJS</a></li>
<li><a href="../250155/index.html">Documenting programs</a></li>
<li><a href="../250157/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ34 (February 2 - 8, 2015)</a></li>
<li><a href="../250159/index.html">Deploying Windows Server 2012 R2 to Dell servers in BARE-METAL mode. Part 1</a></li>
<li><a href="../250161/index.html">2 FortiGate Multi-Threat Security Systems curriculum</a></li>
<li><a href="../250163/index.html">Develop a mobile application and win - an interview with the head of the mobile development department Alexander Bogdanovich</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>