<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tree list on ASP.NET MVC 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! On Habr√© there is an article that tells how to make a tree list. However, in this version the Razor engine, Entity Framework, etc. will be u...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tree list on ASP.NET MVC 4</h1><div class="post__text post__text-html js-mediator-article">  Good day!  On Habr√© there is <a href="http://habrahabr.ru/post/64344/">an article</a> that tells how to make a tree list.  However, in this version the Razor engine, Entity Framework, etc. will be used, as well as list operations are implemented.  This option is simple and fast implementation.  This article is intended for those who are already familiar with ASP .NET MVC. <br><br>  Opportunities: <br><ul><li>  List display </li><li>  Adding items </li><li>  Moving items </li><li>  Deleting items </li></ul><br>  Used technologies: <br><ul><li>  Microsoft ASP.  NET MVC 4 </li><li>  Entity Framework </li><li>  Linq to Entity </li><li>  Microsoft SQL Server (Local DB) </li></ul><br><a name="habracut"></a><br><h4>  Database </h4><br>  Since all records will be stored in the database, it is necessary to create the following table: <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">News</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-comment"><span class="hljs-comment">//  public int? ParentId {get;set;} //   public string Title {get;set;} //  public bool IsDeleted {get;set;} //  }</span></span></code> </pre> <br><h4>  Models </h4><br>  Next, create models for work: <br>  1. Usually, models do not directly use records from the database, so we will create a model similar to a table. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NewsModel</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-comment"><span class="hljs-comment">//  public int? ParentId {get;set;} //   public string Title {get;set;} //  }</span></span></code> </pre><br>  2. List of news. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> NewsListModel { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>? Seed {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-comment"><span class="hljs-comment">//  public IEnumerable&lt;NewsModel&gt; News {get;set;} //  }</span></span></code> </pre><br><h5>  Controller </h5><br>  Below is a controller that can select, delete, add and move news. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NewsController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (NewsContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsContext()) { NewsListModel model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsListModel() { News = context.News.Where(x =&gt; !x.IsDeleted).ToArray().Select(x =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsModel(x)) }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(model); } } [HttpPost] [ValidateAntiForgeryToken] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">? parentId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> title</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (NewsContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsContext()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> newNews = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> News() { ParentId = parentId, Title = title }; context.News.Add(newNews); context.SaveChanges(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } [ValidateAntiForgeryToken] [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nodeId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">? newParentId</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nodeId == newParentId) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (NewsContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsContext()) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newParentId.HasValue &amp;&amp; ContainsChilds(context, nodeId, newParentId.Value)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node = context.News.Where(x =&gt; x.Id == nodeId).Single(); node.ParentId = newParentId; context.SaveChanges(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ContainsChilds</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NewsContext context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> parentId, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> result = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inner = context.News.Where(x =&gt; x.ParentId == parentId &amp;&amp; !x.IsDeleted).ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inner) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.Id == id &amp;&amp; node.ParentId == parentId) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } result = ContainsChilds(context, node.Id, id); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } [HttpPost] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (NewsContext context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NewsContext()) { DeleteNodes(context, id); context.SaveChanges(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DeleteNodes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">NewsContext context, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> id</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> inner = context.News.Where(x =&gt; x.ParentId == id &amp;&amp; !x.IsDeleted).ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inner) { node.IsDeleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; DeleteNodes(context, node.Id); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> deleted = context.News.Where(x =&gt; x.Id == id &amp;&amp; !x.IsDeleted).Single(); deleted.IsDeleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } }</code> </pre><br><h4>  Representation </h4><br>  As can be seen from the code, most of the methods are executed recursively.  Recursion allows you to quite concisely implement the operation.  Recursion is also used when displayed on a page.  Consider displaying a tree view. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      _TreeList.cshtml <br><pre> <code class="cs hljs">@model MySLOTree.Models.NewsListModel @<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Model.News.Where(x =&gt; x.ParentId == Model.Seed).Any()) { &lt;ul&gt; @<span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> node <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Model.News) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node.ParentId == Model.Seed) { &lt;a&gt;@node.Title&lt;/a&gt; MySLOTree.Models.NewsListModel inner = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySLOTree.Models.NewsListModel { Seed = node.Id, News = Model.News }; @Html.Partial(<span class="hljs-string"><span class="hljs-string">"_TreeList"</span></span>, inner) } } &lt;/ul&gt; }</code> </pre><br><h4>  Result </h4><br><h5>  Blank list </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/ce1/5b0/c10/ce15b0c10c1fc8857d34a6110288c383.jpg"><br><br><h5>  Adding items </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/a54/f80/006/a54f80006b418910b14440a1acf73df9.jpg"><br><br><h5>  List display </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/524/2af/40e/5242af40e9b71381d78d4e5cdbdf1709.jpg"><br><br><h5>  Collapse \ Expand List </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/5e0/aaa/4e3/5e0aaa4e35ba2e71c7ad03c5e8504d45.jpg"><br><br><h5>  Moving items </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/70c/865/4fb/70c8654fb5e86590c68dc0921d4b7fde.jpg"><br><br><h4>  Conclusion </h4><br>  To move elements in the tree, use drag and drop.  Adding and deleting elements is done by clicking on the corresponding icons.  The article omitted some points.  All details can be seen in the source code. <br>  Full source code is available on <a href="https://github.com/revkov/MySLOTree">github</a> . <br><br>  PS I will be happy to answer questions and share experiences. </div><p>Source: <a href="https://habr.com/ru/post/206894/">https://habr.com/ru/post/206894/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../206880/index.html">TV on the Internet</a></li>
<li><a href="../206884/index.html">Alpha Mio - wrist heart rate monitor without chest strap</a></li>
<li><a href="../206886/index.html">Dozen design jambs</a></li>
<li><a href="../206888/index.html">Integration of Symfony2 authentication and Jira tracker</a></li>
<li><a href="../206892/index.html">Introduction to parallel computing in R</a></li>
<li><a href="../206896/index.html">All that merge: ribosomal software architecture</a></li>
<li><a href="../206898/index.html">Backing up web projects on Yandex.Disk without OOP and models</a></li>
<li><a href="../206900/index.html">Is Telegram Safe? Or as I was looking for a bookmark in MTProto</a></li>
<li><a href="../206904/index.html">FTCA Data Clustering Algorithm</a></li>
<li><a href="../206908/index.html">Elegant login form to admin panel on Laravel and Sentry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>