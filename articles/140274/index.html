<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kalman Filter - Introduction</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Kalman filter is probably the most popular filtering algorithm used in many areas of science and technology. Due to its simplicity and efficiency, it ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kalman Filter - Introduction</h1><div class="post__text post__text-html js-mediator-article">  Kalman filter is probably the most popular filtering algorithm used in many areas of science and technology.  Due to its simplicity and efficiency, it can be found in GPS receivers, handlers of sensor readings, in the implementation of control systems, etc. <br><br>  There are a lot of articles and books about the Kalman filter on the Internet (mostly in English), but these articles have a rather large threshold of entry, there are a lot of vague places, although in fact it is a very clear and transparent algorithm.  I will try to talk about it in simple language, with a gradual increase in complexity. <br><a name="habracut"></a><br><h4>  What is it for? </h4><br>  Any measuring device has a certain error, it can be influenced by a large number of external and internal influences, which leads to the fact that the information from it is noisy.  The more noisy the data, the more difficult it is to process such information. <br><br>  A filter is a data processing algorithm that removes noise and unnecessary information.  In the Kalman filter, it is possible to set a priori information about the nature of the system, the relationship of variables, and on the basis of this to build a more accurate estimate, but even in the simplest case (without entering a priori information), it gives excellent results. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider the simplest example - suppose we need to control the level of fuel in the tank.  To do this, a capacitive sensor is installed in the tank, it is very easy to maintain, but it has some drawbacks - for example, dependence on fuel to be filled (the dielectric constant of the fuel depends on many factors, for example, on temperature), a large influence of the ‚Äúbump‚Äù in the tank.  As a result, the information from it represents a typical ‚Äúsaw‚Äù with a decent amplitude.  These types of sensors are often installed on heavy mining equipment (do not be embarrassed by the volume of the tank): <br><br><img src="https://habrastorage.org/storage2/a9d/fc0/794/a9dfc0794d617fbcc9640e04f7cf2fc4.png"><br><br><h4>  Kalman filter </h4><br>  Let's digress a bit and get acquainted with the algorithm itself.  The Kalman filter uses a dynamic model of the system (for example, the physical law of motion), known control actions, and a number of consecutive measurements to form an optimal state estimate.  The algorithm consists of two repeating phases: prediction and adjustment.  The first one calculates the prediction of the state at the next time point (taking into account the inaccuracy of their measurement).  On the second, the new information from the sensor corrects the predicted value (also taking into account the inaccuracy and noise of this information): <br><br><img src="https://habrastorage.org/storage2/ca3/838/e4a/ca3838e4a6c4b0ebbbb77ec9300994ca.png"><br><br>  The equations are presented in the matrix form, if you do not know linear algebra - no problem, then there will be a simplified version without matrices for the case with one variable.  In the case of a single variable, the matrices degenerate into scalar values. <br><br>  We first understand the notation: the subscript denotes the moment in time: k is the current, (k-1) is the previous one, the minus sign in the superscript indicates that it is a <i>predicted</i> intermediate value. <br><br>  Variable descriptions are presented in the following images: <br><br><img src="https://habrastorage.org/storage2/e0b/d1a/843/e0bd1a8433178a77d604e57701c98886.png"><br><br><img src="https://habrastorage.org/storage2/e2b/227/286/e2b227286f7fe654529d0511a13d7597.png"><br><br>  It can be long and tedious to describe what all these mysterious transition matrices mean, but in my opinion, it‚Äôs better to try using an algorithm using a real example - so that the abstract values ‚Äã‚Äãhave a real meaning. <br><br><h4>  Let's test in </h4><br>  Let us return to the example with the fuel level sensor, since the state of the system is represented by one variable (the volume of fuel in the tank), then the matrices degenerate into ordinary equations: <br><br><img src="https://habrastorage.org/storage2/406/c33/9f6/406c339f6715a15c9da6a92b7a68959e.png"><br><br><h5>  Process Model Definition </h5><br>  In order to apply a filter, it is necessary to determine the matrices / values ‚Äã‚Äãof variables defining the dynamics of the system and the measurements of F, B and H: <br><br>  <strong>F</strong> is a variable describing the dynamics of the system; in the case of fuel, this can be a factor determining the fuel consumption at idle speed during the sampling time (the time between the steps of the algorithm).  However, in addition to fuel consumption, there are also refueling ... so for simplicity we take this variable equal to 1 (that is, we indicate that the predicted value will be equal to the previous state). <br><br>  <strong>B</strong> - variable defining the use of control action.  If we had additional information about the engine speed or the degree of accelerator pedal depression, this parameter would determine how the fuel consumption changes during the sampling time.  Since there are no control actions in our model (there is no information about them), we take B = 0. <br><br>  <strong>H</strong> is the matrix defining the relationship between measurements and the state of the system, while without explanation we take this variable also equal to 1. <br><br><h5>  Determination of smoothing properties </h5><br>  <strong>R</strong> - measurement error can be determined by testing measuring instruments and determining the error of their measurement. <br><br>  <strong>Q</strong> - determining the noise of a process is a more difficult task, since it is necessary to determine the variance of the process, which is not always possible.  In any case, you can choose this parameter to ensure the required level of filtering. <br><br><h5>  Implement in code </h5><br>  To dispel the remaining obscurities, we implement a simplified algorithm in C # (without matrices and control actions): <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">KalmanFilterSimple1D</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> X0 {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} <span class="hljs-comment"><span class="hljs-comment">// predicted state public double P0 { get; private set; } // predicted covariance public double F { get; private set; } // factor of real value to previous real value public double Q { get; private set; } // measurement noise public double H { get; private set; } // factor of measured value to real value public double R { get; private set; } // environment noise public double State { get; private set; } public double Covariance { get; private set; } public KalmanFilterSimple1D(double q, double r, double f = 1, double h = 1) { Q = q; R = r; F = f; H = h; } public void SetState(double state, double covariance) { State = state; Covariance = covariance; } public void Correct(double data) { //time update - prediction X0 = F*State; P0 = F*Covariance*F + Q; //measurement update - correction var K = H*P0/(H*P0*H + R); State = X0 + K*(data - H*X0); Covariance = (1 - K*H)*P0; } } // ... var fuelData = GetData(); var filtered = new List&lt;double&gt;(); var kalman = new KalmanFilterSimple1D(f: 1, h: 1, q: 2, r: 15); //  F, H, Q  R kalman.SetState(fuelData[0], 0.1); //    State  Covariance foreach(var d in fuelData) { kalman.Correct(d); //   filtered.Add(kalman.State); //    }</span></span></code> </pre> <br><br>  The result of filtering with these parameters is shown in the figure (to adjust the degree of smoothing, you can change the parameters Q and R): <br><br><img src="https://habrastorage.org/storage2/052/550/e5d/052550e5d856612db6d1ba8410e92648.png"><br><br>  The most interesting thing left behind the article is to apply the Kalman filter for several variables, specify the relationship between them, and automatically display values ‚Äã‚Äãfor unobservable variables.  I will try to continue the topic as soon as time appears. <br><br>  I hope the description turned out not very tedious and difficult, if you still have questions and clarifications - welcome to the comments) <br><br>  <b>UPD:</b> List of sources: <br>  <a href="http://www.udacity.com/overview/Course/cs373/CourseRev/feb2012">CS373 - PROGRAMMING A ROBOTIC CAR</a> - highly recommended <br>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D0%259A%25D0%25B0%25D0%25BB%25D0%25BC%25D0%25B0%25D0%25BD%25D0%25B0">Wikipedia (Russian)</a> <br>  <a href="https://www.google.ru/search%3Fsourceid%3Dchrome%26ie%3DUTF-8%26q%3Dwiki%2Bkalman%2Bfilter">Wikipedia (English)</a> <br>  On Habr√©: <a href="http://habrahabr.ru/post/120133/">1</a> and <a href="http://habrahabr.ru/post/121904/">2</a> <br><br>  More serious sources are: <br>  Greg Welch, Gary Bishop, An Introduction to the Kalman Filter, 2001 <br>  MSGrewal, AP Andrews, Kalman Filtering - Theory and Practice Using MATLAB, Wiley, 2001 <br><br>  <b>UPD2: the</b> example given in the article is purely demonstrative.  The main application of the filter is more complex systems.  For example, in the case of determining the coordinates of the car, you can associate gps-coordinates, steering angle, engine speed ... and all this will give an increase in the accuracy of coordinates. </div><p>Source: <a href="https://habr.com/ru/post/140274/">https://habr.com/ru/post/140274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140264/index.html">Remote registration of SPD (FOP) in Ukraine</a></li>
<li><a href="../140267/index.html">Sony KDL-24EX320 TV Review</a></li>
<li><a href="../140269/index.html">Linux kernel 3.3 supports Android</a></li>
<li><a href="../140270/index.html">Problems transfer utf-8 from a form in JAX-RS (REST)</a></li>
<li><a href="../140273/index.html">New resource for help in setting up social networks, BlissControl.com</a></li>
<li><a href="../140275/index.html">Validation in Yii</a></li>
<li><a href="../140276/index.html">AVRDudeR - embed avrdude in IDE</a></li>
<li><a href="../140277/index.html">OpenStreetMap News ‚Ññ15: + 90% on osm.org, the best routing service, Wikipedia objects on the map, Vladivostok transport</a></li>
<li><a href="../140278/index.html">Battle Testing Wifi Protector: Protecting ARP Table</a></li>
<li><a href="../140279/index.html">PHP developers migrated to git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>