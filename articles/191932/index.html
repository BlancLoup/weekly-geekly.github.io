<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.NET 4.5 - on-site update .NET 4.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Along with the beta versions of VS 2011 and Windows 8, many people will install and deal with .NET 4.5. In .NET 4.5, many new enhancements have been a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.NET 4.5 - on-site update .NET 4.0</h1><div class="post__text post__text-html js-mediator-article">  Along with the beta versions of VS 2011 and Windows 8, many people will install and deal with .NET 4.5.  In .NET 4.5, many new enhancements have been added that are fairly transparent, but it is important to understand how, from a CLR point of view, it works on your machine. <br><br>  When .NET 4.5 is installed, it actually replaces .NET 4.0 on your machine.  .NET 4.0 is overwritten by the new version of .NET 4.5, which, in accordance with the words of Microsoft, guarantees 100% compatibility.  100% compatibility sounds attractive, but we all know that to achieve this result is quite difficult.  But there is a much more interesting thing than backward compatibility, which makes the situation with the deployment of .NET 4.5 uncomfortable at best and confusing at worst. <br><a name="habracut"></a><br><h4>  What does an update in place mean? </h4><br>  When you install .NET 4.5, your assemblies from .NET 4.0 in the \ Windows \ .NET Framework \ V4.0.30319 folder are overwritten by a new set.  As a result, you are left with overwritten assemblies, as well as with a bunch of new ones (for example, the System.Net.Http assembly).  The following image shows the System.dll build for .NET 4.5 (left) and for .NET 4.0 (right): <br><br><img src="https://habrastorage.org/storage3/cdd/27a/e7b/cdd27ae7bb377f1004254716598fa474.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Obviously, these are different files with different sizes (interestingly, the .NET 4.5 version is smaller than the size). <br><br>  That's not all.  If during the execution of an application with .NET 4.5 installed, you refer to the Environment.Version property, then you still get 4.0.30319. <br><br>  If you open the properties window of the System.dll assembly in .NET 4.5, you will also see <br><br><img src="https://habrastorage.org/storage3/ccb/16c/f0a/ccb16cf0a4b0f29c8f36343ade2f0646.png"><br><br>  Please note that the file version is still 4.0.xxx. <br><br>  The difference is in the build number: in .NET 4.0 it is equal to 261, while in the current beta version of .NET 4.5 it is equal to 17379. I think you can use the layout number to determine the version of .NET: if it is more than 17000, then This is .NET 4.5, however, this is not a very beautiful solution. <br><br>  There is no simple or obvious way to determine which version of .NET 4.5 or .NET 4.0 is used, since they are the same for the application. <br><br><h4>  Compile for .NET 4.5 and run on .NET 4.0 is not a good idea. </h4><br>  You can compile an application under .NET 4.5 and run it under .NET 4.0 until you go beyond the functionality available only in .NET 4.0.  At this point, the application will simply crash.  Say, your code basically uses the features of .NET 4.0, but there are several places deeply hidden in the application that use the new features of .NET 4.5, for example, async / await.  .NET will happily launch your application and execute successfully all the code until it encounters code that uses the capabilities of .NET 4.5, and then safely crashes.  What joy! <br><br>  Of course, you can run applications written for .NET 4.0 on .NET 4.5 and this should work without <b>any freaks</b> . <br><br><h4>  Version detection </h4><br>  If you are writing an application for .NET 4.5, you have some control over its execution using the configuration file.  You can specify that the application needs .NET 4.5, for example, like this: <br><br><pre><code class="cs hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span> ?&gt; &lt;configuration&gt; &lt;startup&gt; &lt;supportedRuntime version=<span class="hljs-string"><span class="hljs-string">"v4.0"</span></span> sku=<span class="hljs-string"><span class="hljs-string">".NETFramework, Version=v4.5"</span></span> /&gt; &lt;/startup&gt; &lt;/configuration&gt;</code> </pre> <br>  This is done to ensure that the application does not launch an error on .NET 4.5, instead of crashing at runtime. <br><br>  Also, web applications on .NET 4.5 can use the targetFramework property to achieve similar results. <br><br><pre> <code class="cs hljs">&lt;configuration&gt; &lt;system.web&gt; &lt;compilation debug=<span class="hljs-string"><span class="hljs-string">"true"</span></span> strict=<span class="hljs-string"><span class="hljs-string">"false"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">explicit</span></span>=<span class="hljs-string"><span class="hljs-string">"true"</span></span> targetFramework=<span class="hljs-string"><span class="hljs-string">"4.5"</span></span> /&gt; &lt;/system.web&gt; &lt;/configuration&gt;</code> </pre><br>  This works well for individual desktop and web applications, but there is no way for assemblies to be added to a project.  For a project on .NET 4.0, the .NET 4.5 build looks like any other .NET 4.0 build. <br><br>  For developers, especially developers of components, this is especially problematic, since there is no way to determine the version of .NET, because the Environment.Version property returns 4. <br><br>  The following code displays <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Environment.Version.ToString().Dump(); Environment.Version.Build.Dump(); Environment.Version.Revision.Dump(); Environment.Version.Major.Dump(); }</code> </pre><br>  on .NET 4.0 <br>  4.0.30319.269 <br>  30319 <br>  <b>269</b> <br>  four <br><br>  on .NET 4.5 <br>  4.0.30319.17379 <br>  30319 <br>  <b>17379</b> <br>  four <br><br>  Enough seems not?  Note, however, that the revision number is more in .NET 4.5 - 17379, while in .NET 4.0 - 261. If you really want to know that you are using .NET 4.5 or .NET 4.0, you can use the following code: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsDotNet45</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Environment.Version.Major == <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; Environment.Version.Revision &gt; <span class="hljs-number"><span class="hljs-number">17000</span></span>; }</code> </pre><br>  The second way is to try to detect some type added in .NET 4.5 using reflection. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsNet45OrNewer</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  "ReflectionContext"    .NET 4.5. return Type.GetType("System.Reflection.ReflectionContext", false) != null; }</span></span></code> </pre><br>  One of the advantages of this approach is that it can be used in later versions of .NET. <br><br>  Nevertheless, it is rather indicative that we have to resort to such tricks to simply find out the compatibility of the versions. <br><br><h4>  Difference with .NET 3.0 / 3.5 </h4><br>  Note that this in-place update is very different from the .NET 2.0 update to .NET 3.0 / 3.5 (it was also in place), which worked on the second version of the CLR.  Both 3.x versions were just library enhancements over the .NET 2.0 kernel.  Both versions were running .NET 2.0, which was not changed throughout the 3.x cycle.  In turn, the update number 4.5 completely replaces .NET 4.0 leaving the actual version number of v4.0.30319. <br><br>  When you create a new project in VS 2011, you can still choose a version of .NET 4.0 or .NET 4.5.  But in fact, you refer to the same set of assemblies, regardless of the version you choose.  The difference is that when compiling under .NET 4.0, the compiler provides only a subset of the features available in NET 4.0, but when compiling under .NET 4.5 you can use all the functionality.  This does not mean that you can use VS 2010 to develop applications for .NET 4.5. <br><br><h4>  Good news is bad news. </h4><br>  Microsoft is trying to experiment in all possible ways to deploy new versions of .NET.  There are no two updates that are the same.  Of course, a full update (such as .NET 2.0, 4.0) has its drawbacks, but it is not entirely correct to make an update on the spot and even provide a way to determine the current version of .NET, even according to Microsoft standards.  Especially considering that .NET 4.5 is a fairly large update with all async-s.  Most APIs that use IO have been updated to support async-s, which significantly affected the existing API.  Worse, .NET 4.5 will ship with Windows 8, so it will be with us for a long time, unless of course Microsoft finally decides to upgrade the .NET version as part of the system upgrade.  It was the same with Vista, which came with an intermediate version of .NET 3.0, which was quickly replaced with a more practical and long-lived .NET 3.5.  People had enough problems with the confusing situation with 3.x versions, which actually worked on .NET 2.0.  I can't even count the number of questions asked that people can't find .NET 3.5 in the IIS dialog box.  The same can happen with .NET 4.5.  Well, when we know the way to upgrade to version 4.5, but administrators who are not completely familiar with .NET are unlikely to understand these nuances, and ultimately what version of .NET will be confused. <br><br>  It is difficult for me to see an advantage in this way of updating, I did not even see a clear explanation of why this approach was chosen.  Of course, with this approach, existing bindings to assemblies do not break, so the application can remain working after the update.  I think this may be useful for some component suppliers.  But seriously, are you really going to mix .NET 4.0 and .NET 4.5 (without recompiling the application), and then test everything thoroughly to make sure everything works?  Recompilation does not seem to be serious in the light of a transparent version update. </div><p>Source: <a href="https://habr.com/ru/post/191932/">https://habr.com/ru/post/191932/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../191918/index.html">The world's smallest autopilot</a></li>
<li><a href="../191920/index.html">The history of personal computers in advertising. Part 1: 1970s</a></li>
<li><a href="../191922/index.html">Experience in building a b2b product: 3 continents in 6 years and half a mile of stuffed cones</a></li>
<li><a href="../191926/index.html">C # async for iOS and Android</a></li>
<li><a href="../191928/index.html">Dog's life in the Jimdo office in Hamburg</a></li>
<li><a href="../191934/index.html">.NET and design patterns</a></li>
<li><a href="../191936/index.html">Dendy console in amateur constructions</a></li>
<li><a href="../191938/index.html">The prosecutor's office of St. Petersburg has blocked the site for bribing a moderator with virtual currency!</a></li>
<li><a href="../191940/index.html">How I use computer technology. Nestollman</a></li>
<li><a href="../191942/index.html">China will launch its "moonwalker" by the end of the year</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>