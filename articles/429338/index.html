<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Storage: Internal, External, Removable. Part 1/3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Anyone who, despite everything, has managed to make the right choice. 

 This is a translation of a series of articles by Mark Murphy from CommonsWare...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Storage: Internal, External, Removable. Part 1/3</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  Anyone who, despite everything, has managed to make the right choice. </blockquote><p>  This is a translation of a series of articles by Mark Murphy from CommonsWare, widely known on stackoverflow, as well as the author of the books ‚ÄúThe Busy Coder‚Äôs Guide to Android Development‚Äù, ‚ÄúAndroid‚Äôs Architecture Components‚Äù.  Some terms are left untranslated. </p><br><h1 id="internal-storage">  Internal Storage </h1><br><p>  There is a lot of confusion regarding the Android storage model.  The confusion has become much more with the changes of Android 4.4 in the Storage Model, and since then the situation has not improved.  There are countless questions on Stack Overflow and other similar resources, where people clearly do not quite understand the various models of Android storage. </p><a name="habracut"></a><br><h1 id="to-chto-polzovateli-schitayut-internal-storage">  What Users Consider Internal Storage </h1><br><p>  Depending on the model of your device, users will eventually come to Settings -&gt; Storage on their device (Settings -&gt; Storage on their device) or an equivalent place, and can see a screen that describes ‚ÄúInternal storage‚Äù . </p><br><p>  The user thinks that the entire built-in flash drive is ‚ÄúInternal Storage‚Äù (Internal Storage).  Fortunately, Google began to change this term from Android 8.0, going to ‚Äúgeneral storage‚Äù instead of ‚Äúinternal storage‚Äù. </p><br><p>  However, users can still see ‚Äúinternal storage‚Äù in places such as the Windows Explorer window when their device is connected via USB. </p><br><h1 id="chto-google-schitaet-internal-storage">  What Google Considers Internal Storage </h1><br><p>  Alas, what users see is not the same as the Android SDK considers ‚Äúinternal storage‚Äù, which leads to some confusion.  If you <a href="https://developer.android.com/guide/topics/data/data-storage.html">read the Android documentation on the internal storage</a> , then this description ... at least vague (note the text has changed since the writing of the article): </p><br><blockquote>  You can save files directly to the device‚Äôs internal memory.  By default, files stored in the internal storage are private to your application, and other applications cannot access them (as well as the user).  When the user deletes the application, these files are deleted. </blockquote><p>  Truth be told, the Android SDK defines ‚Äúinternal storage‚Äù as a special directory unique to your application, where your application can host files.  As suggested in the documentation, these default files are designed to be read and written for your application and are prohibited for any other application (exception: users working with file managers with root privileges on rooted devices can access everything). </p><br><p>  In Context, there are several basic methods that give you access to internal storage, including: </p><br><ul><li><code>getCacheDir()</code> </li> <li> <code>getDir()</code> </li> <li> <code>getDatabasePath()</code> </li> <li> <code>getFilesDir()</code> </li> <li> <code>openFileInput()</code> </li> <li> <code>openFileOutput()</code> </li> </ul><br><p>  Other methods will rely on them, such as <code>openOrCreateDatabase()</code> .  Other classes will also rely on them, such as <code>SQLiteOpenHelper</code> and <code>SharedPreferences</code> . </p><br><h1 id="gde-hranitsya-internal-storage--inogda">  Where Internal Storage is Stored ... Sometimes </h1><br><p>  If you are viewing various blog posts, responses to StackOverflow, and books released in 2012 or earlier, you are informed that the ‚Äúinternal storage‚Äù of your application is located at: <code>/data/data/your.application.package.name</code> . </p><br><p>  Inside there will be some directories automatically created by Android, since you are using some of the Context methods.  For example, <code>getFilesDir()</code> returns a <code>File</code> object pointing to the <code>files/</code> directory in your application‚Äôs internal storage. </p><br><h1 id="gde-hranitsya-internal-storage--ostalnoe-vremya">  Where is the internal storage stored ... the rest of the time </h1><br><p>  However, the internal storage of your application is not always located in the specified location.  For developers, there is one rule that you should learn from this series of blog posts: </p><br><p>  <strong>NEVER HARDCODE PATHS</strong> . </p><br><p>  From time to time, I see developers doing something like this: </p><br><p> <code>File f=new File("/data/data/their.app.package.name/files/foo.txt");</code> </p> <br><p>  This is not a crime, it is worse, it is a mistake. </p><br><p>  The right move, and write less: </p><br><p> <code>File f=new File(getFilesDir(), "foo.txt");</code> </p> <br><p>  More importantly, the <em>internal storage is not always in one place</em> .  It is noteworthy that we have the concept of separate user profiles (separate user profiles), <a href="https://developer.android.com/about/versions/android-4.2.html">starting with Android 4.2</a> for tablets and Android 5.0 for phones.  Each user gets their own "internal storage".  Although the above directory is still used for the primary user, it is not guaranteed that it will also be used for secondary accounts. </p><br><h1 id="issleduem-internal-storage">  We investigate Internal Storage </h1><br><p>  The Device File Explorer tool in Android Studio 3.0+ can view all internal storage on the emulator, as well as internal storage of debugged applications on production devices. </p><br><p>  On the command line, you can use <code>adb</code> with the <code>run-as</code> option. </p><br><p>  For example, to load a database from the main user's internal storage to your development machine, you can use: </p><br><p> <code>adb shell 'run-as your.application.package.name cp /data/data/your.application.package.name/databases/dbname.db /sdcard'</code> </p> <br><p>  Note that: </p><br><ul><li>  You will need to change your destination to where external storage is mounted on your device (shown here as <code>/sdcard/</code> , which will not be the same on all devices) </li><li>  You may have to use <code>cat</code> instead of <code>cp</code> on older devices. </li><li>  Once the file is located on external storage, you can use <code>adb pull</code> to download it to your computer, or access it in other usual ways (for example, by mounting the device as a disk). </li></ul><br><h1 id="ogranicheniya-vnutrennego-hranilischa">  Internal Storage Restrictions </h1><br><p>  On older Android 1.x and 2.x devices, internal storage was usually located in a dedicated partition of the file system, and this partition was usually quite tiny.  HTC Dream (aka, T-Mobile G1), the original Android device, had a huge 70 MB of internal memory for use by all applications (this is not a typo, at that time we measured the memory in megabytes). </p><br><p>  By the time 2.3 devices came out, the internal storage could be 1 GB in size. </p><br><p>  Android 3.0 has changed the storage model, as the internal storage has become more volume.  Devices that advertise as having 4 GB, 8 GB, 16 GB, etc.  storage space, there was usually all this (minus existing content) available for internal storage.  We will look at what has changed in Android 3.0 and its effect on the storage model in the following posts about external storage. </p><br><p>  For Android 1.x and 2.x, internal storage was really only for small files, and you needed to use external storage for everything else.  Android 3.0+ means that for most devices and most users, internal storage is great for files that are not intended for normal use by other applications or are accessible to the user regardless of your application.  However, some experienced users find that even on-board flash is not enough for what they want to store, so they switch to removable storage ... which is a <em>can of worms (note ·ºïŒªŒºŒπŒΩœÇ)</em> - the source of many unpredictable and complex problems. </p><br><h1 id="faq-po-internal-storage">  Internal Storage FAQ </h1><br><h2 id="dolzhen-li-ya-delat-fayly-vo-vnutrennem-hranilische-world-readable-ili-world-writeable">  Should I make files in the World-Readable or World-Writeable internal storage? </h2><br><p>  Oh, $ gods, no.  Use <code>FileProvider</code> and serve this content using the <code>ContentProvider</code> implementation.  After that, you at least have the ability to use the Android permission system to control access to these files, unlike your version, when any application on the system can corrupt these files. </p><br><h2 id="nu-a-kak-naschet-androidshareduserid-">  Well, what about <code>android:sharedUserId</code> ? </h2><br><p>  I do not advise. </p><br><p>  <code>android: sharedUserId</code> is an attribute that you can put in a manifest that specifies the logical user ID that will be used for your application.  Any other application that is installed, which is signed by the same signature key and requests the same <code>android:sharedUserId</code> will use the same Linux user from a security point of view.  The effect is that these two applications will be able to work with each other's files with impunity, since these files belong to the same Linux user. </p><br><p>  This attribute is really intended for pre-installed applications such as the software suite pre-loaded by the device manufacturer, mobile operator or developer of a modified ROM firmware.  In particular, as soon as you install your application once, you cannot then change your value painlessly <code>android:sharedUserId</code> without blocking the user‚Äôs access to any existing files ... since Android does not change the owner‚Äôs rights to existing files when changing the Linux user account under which starts the application. </p><br><p>  There are various risks with simultaneous access of several processes to files.  Some subsystems, such as SQLite, have built-in logic to solve this problem.  But if you yourself organize your own access to the file (for example, through <code>File</code> and Java I / O), you need to do something with simultaneous access, and this is difficult. </p><br><p>  You also need to handle the situation when one application is uninstalled, deleting files that another application used.  In a hub-and-spoke model, for example, with an application and a set of plug-ins, this may not be so risky.  In other models where applications are more equal, you cannot afford to lose the data of your application just because the user decided to delete some particular application. </p><br><p>  Finally, you do not know what the future can bring.  Right now you can view your suite of applications as a set with a close connection.  Someone who acquires these applications or acquires your company may want to go the other way.  Using data sharing features that are more loosely coupled, like <code>ContentProvider</code> , gives you more flexibility.  In an ideal world, your application should treat other applications as a fairly reliable, but not always accessible resource, just like your own web service. </p><br><h2 id="kak-zapretit-polzovatelyam-rooted-ustroystv-dostup-k-moim-faylam-vo-vnutrennem-hranilische">  How to prevent users of rooted devices from accessing my files in the internal storage? </h2><br><p>  Just do not place files in the internal storage.  Users of rooted devices can gain access to what they need on the device, so the only way to prevent them from accessing your data is to not have them on the device. </p><br><p>  Some developers will try to encrypt their files with a hard-coded password so that users of rooted devices cannot use these files.  This will create a ‚Äúspeed bump‚Äù effect for a short time.  All that is required is one person who is interested in reverse engineering your application, who determined how to decrypt these files and then wrote a blog or forum message on how to do this. </p><br><p>  In general, there are relatively few people with rooted devices - I rate them at less than 1%.  IMHO, you will succeed more by focusing your engineering work on writing the best application, instead of wasting time on protection from rooted devices. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/429338/">https://habr.com/ru/post/429338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429326/index.html">App Store will not call. Or how I made my application, but it will not get to users</a></li>
<li><a href="../429328/index.html">Software module for digitizing damaged documents</a></li>
<li><a href="../429330/index.html">Myths and legends of Agile - from the Pharaohs to the present day</a></li>
<li><a href="../429332/index.html">Self-made laser installation "Lightsaber" - as it were, part 1</a></li>
<li><a href="../429336/index.html">Driver and device communication using the _HID method of ACPI using the example of a GPIO Lynxpoint controller</a></li>
<li><a href="../429340/index.html">Think twice before using Helm</a></li>
<li><a href="../429342/index.html">Angular 6+ complete dependency deployment guide. providedIn vs providers: []</a></li>
<li><a href="../429344/index.html">Weekend Reading: Audio Tuning and Speaker Design Materials</a></li>
<li><a href="../429346/index.html">To the magistracy without exams: a new direction "Big data" at the Olympiad "I am a professional"</a></li>
<li><a href="../429348/index.html">Why in the future Agile will not be needed</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>