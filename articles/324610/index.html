<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring of engineering infrastructure in the data center. Part 2. Power supply system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Monitoring of engineering infrastructure in the data center. Highlights. 
 Part 2. How is the monitoring of power supply in the data center. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring of engineering infrastructure in the data center. Part 2. Power supply system</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/company/dataline/blog/319446/">Part 1. Monitoring of engineering infrastructure in the data center.</a>  <a href="https://habrahabr.ru/company/dataline/blog/319446/">Highlights.</a> <br>  Part 2. How is the monitoring of power supply in the data center. <br>  <a href="https://habrahabr.ru/company/dataline/blog/338966/">Part 3. Monitoring of cold supply by the example of the NORD-4 data center.</a> <br>  <a href="https://habrahabr.ru/company/dataline/blog/344188/">Part 4. Network infrastructure: physical equipment.</a> <br><br>  We continue a series of articles about the work of engineering infrastructure monitoring systems in our data centers.  In the <a href="https://habrahabr.ru/company/dataline/blog/319446/">first part we have</a> analyzed theoretical points, today we turn to practice.  Let's start with the most critical system - power supply.  Before reading we recommend <a href="https://habrahabr.ru/company/dataline/blog/310356/">refreshing</a> knowledge about the power supply device in the data center. <br><br><img src="https://habrastorage.org/files/08e/16a/785/08e16a785bb54498baeffba5f6fab563.jpg"><br>  <i>One of the schemes for monitoring the power supply system in the OST-2 data center.</i> <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Features of power system monitoring </h2><br>  The monitoring of power supply has its own nuances.  Here are some general tips for those who are just going to design and customize the system. <br><br>  <b>Monitor everything you can.</b>  There are no unimportant areas in the power supply system.  Track the basic parameters of each element of the system: from transformer to PDU in the rack. <br><br>  <b>Monitor the system as a whole.</b>  It is not enough just to put all the equipment on monitoring.  It is important to display the existing relationships between all elements of the system.  This will help to quickly identify problems and not get confused in dozens of error alerts. <br><br>  Circuit diagrams, maps and other visualization is best suited for these purposes.  The picture at the beginning of the post is just an example of such a scheme.  When power is lost in the rack, it will be easier to understand what caused the accident using such schemes. <br><br>  <b>Survey equipment as often as possible.</b>  Frequent polling will help not to miss important events in the life of the energy supply system: disconnection of the city power supply, errors that the diesel-gas plant did not cause.  Such critical nodes as the main switchboard, diesel generator set, UPS, we recommend polling every second. <br><br>  <b>Monitor phase balancing and paired loads</b> .  These are derived indicators of the power supply system.  They are calculated directly in the monitoring system on the basis of information received from the equipment. <br><br>  <b>Collect statistics.</b>  Only online data and alerts are not enough, you need to collect long-term statistics.  It is useful for many things - from capacity management (capacity management) to the calculation of the budget for the purchase of spare parts. <br><br><h2>  A few words about our monitoring </h2><br>  The system works on the open-source <a href="https://www.nagios.org/">Nagios</a> solution.  It collects equipment parameter values ‚Äã‚Äãand sends notifications when threshold values ‚Äã‚Äãare reached.  Total 8 stands deployed with Nagios. <br><br>  Information on 7 data centers and all monitoring systems is collected in a single interface based on <a href="http://www.thruk.org/">Thruk</a> . <br><br><img src="https://habrastorage.org/files/553/9dc/043/5539dc0439f94aceaa0df623ec11cf3b.PNG"><br>  <i>Web interface Thruk</i> . <br><br>  We build statistics and graphs based on it using the built-in Nagios and <a href="http://www.cacti.net/">Cacti</a> services. <br><br>  Another way of presenting information is schematic diagrams.  Such a tuning process structures and simplifies the perception of a large amount of data.  A complete picture can be obtained at a glance at the monitor. <br><br><img src="https://habrastorage.org/files/9fc/4b5/b5a/9fc4b5b5a1ee414f9a9f81fa10129c1c.PNG"><br>  <i>Scheme for monitoring the power center and machine rooms of the NORD-4 data center.</i> <br><br>  Let's see what, how and on what equipment you can track. <br><br><h2>  Transformers </h2><br>  Under high load, the transformers heat up.  If overheating occurs, protection will operate and the transformer will turn off.  Thanks to monitoring, we can track overheating in time and take the necessary measures. <br><br>  If the transformer has not yet been commissioned, then thermoelectric pyrometers can be installed on the case.  In already working transformers we use remote infrared pyrometers. <br><br><img src="https://habrastorage.org/files/0d6/510/9e3/0d65109e37c04d5da95596c8266349b9.png"><br>  <i>This is how infrared pyrometers look.</i> <br><br><h2>  Inputs at the main switchboard </h2><br>  Monitoring at this site of the system gives us information about the availability of power from the city and its characteristics for current and voltage. <br><br>  From each transformer, three copper buses come to the main switchboard (MSB).  To obtain data on currents and voltages, <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%2580%25D0%25B0%25D0%25BD%25D1%2581%25D1%2584%25D0%25BE%25D1%2580%25D0%25BC%25D0%25B0%25D1%2582%25D0%25BE%25D1%2580_%25D1%2582%25D0%25BE%25D0%25BA%25D0%25B0">a current transformer is</a> installed on each bus.  Its primary winding is connected to the bus, and the secondary winding is closed to the measuring device - <b>network analyzer</b> . <br><br>  Similarly, the current transformer is mounted on the bus in the DGU board. <br><br><img src="https://habrastorage.org/files/6ff/c9f/517/6ffc9f51706140899c24e5ae1dbd68e7.JPG"><br>  <i>Black rings on copper tires - these are current transformers.</i> <br><br><img src="https://habrastorage.org/files/f28/88f/f4e/f2888ff4e9fb418a98a16e625e3bdb23.JPG"><br>  <i>The network analyzer is attached to the switchboard door.</i> <br><br>  The monitoring system polls network analyzers using the ModBus protocol.  The data goes to the monitoring server and is displayed in a single Thruk web interface. <br><br><img src="https://habrastorage.org/files/b46/c17/95a/b46c1795a09447a4a1053efa1adcd161.png"><br>  <i>Connection diagram of network analyzers to the monitoring system.</i> <br><br>  In a similar way, monitoring is arranged in the remaining switchboards (W).  For each section of the ShchR, a separate analyzer is installed, and the total - for the entire ShchR. <br><br><img src="https://habrastorage.org/files/ff5/847/243/ff5847243f8e49e79d6753b5dbde0632.JPG"><br>  <i>Current transformers in the distribution room of the machine room.</i> <br><br><img src="https://habrastorage.org/files/bba/3a5/c96/bba3a5c965014639a760b5a8c9d16f36.png"><br>  <i>Network analyzers in the distribution room of the machine room.</i> <br><br>  From network analyzers we get about 20 parameters.  Here are the main ones: <br><br><ul><li>  phase current; </li><li>  linear and phase voltage; </li><li>  frequency; </li><li>  power active, reactive and full. </li></ul><br><img src="https://habrastorage.org/files/f4d/149/d18/f4d149d18395485d9f757c737b50c53b.png"><br>  <i>Some parameters for MSB in the monitoring system.</i> <br><br>  All the main parameters for MSB are displayed on schematic diagrams. <br><br><img src="https://habrastorage.org/files/9c0/193/640/9c0193640ffd454a9b909a73a0b4d96a.PNG"><br><br><h2>  Guaranteed power supply </h2><br>  According to this system, we monitor the state of the DGU boards, fuel tanks and, of course, the DGU themselves.  The monitoring system receives data from diesel power stations from the DGU control panel. <br><br><img src="https://habrastorage.org/files/a1b/95b/f12/a1b95bf12ed94df6a42857b8a0bd1a22.JPG"><br>  <i>DGU control panel.</i> <br><br><img src="https://habrastorage.org/files/11e/f23/9d8/11ef239d88b14a44968c250bd2ffc1ac.png"><br>  <i>Connection diagram of the DGS to the monitoring system.</i> <br><br>  The main parameters of the DSU: <br><br><ul><li>  state: in auto mode, in work; </li><li>  the number of revolutions of the engine per minute; </li><li>  the presence of errors in the work. </li></ul><br>  Be sure to monitor the level of fuel in the DGU tanks so as not to be left without fuel at the X hour. The equipment of many tanks already includes mechanical fuel level sensors that are only suitable for visual monitoring: you need to go to the tank to see how much is left there.  This is also an option, but to get rid of the human factor and automate the process, use digital sensors. <br><br><img src="https://habrastorage.org/files/d7b/510/09d/d7b51009d8614be1a7f74a11306de5a8.png"><br>  <i>List of the main parameters of the DGS in the monitoring system.</i> <br><br><h2>  Uninterrupted power supply </h2><br>  If the UPS has a module for remote monitoring, then data collection is not difficult: just set up a survey of bespereboynik via SNMP protocol. <br><br><img src="https://habrastorage.org/files/b88/5ab/888/b885ab88877341658869a0fb11afbe8f.JPG"><br>  <i>UPS from the inside.</i>  <i>Red is the monitoring module that connects to the monitoring server.</i> <br><br>  The main parameters monitored are: <br><br><ul><li>  operating mode: powered by city / DGU, powered by batteries, bypass operation; </li><li>  voltage and currents at the input and output of the UPS; </li><li>  UPS internal temperature. </li></ul><br>  Usually, the UPS can monitor the battery parameters (batteries): <br><br><ul><li>  battery voltage; </li><li>  battery charge level; </li><li>  battery life assessment; </li><li>  battery temperature. </li></ul><br><img src="https://habrastorage.org/files/c69/9eb/e07/c699ebe0788c4ddb8cd80e539d533d4d.png"><br>  <i>The parameters of the UPS in the monitoring system.</i> <br><br><h2>  PDU and AVR Rack Monitoring </h2><br>  PDU monitoring allows you to record the loss of power on one or more beams in the rack with the equipment.  It is enough to use a PDU with the ability to poll via the SNMP protocol.  PDU with management and specialized software is also possible, but in this case a separate interface will be added. <br><br>  The same applies to the monitoring of rack-mount ABP. <br><br><img src="https://habrastorage.org/files/f28/b5f/aeb/f28b5faebfb3418eb53960020d1cf71b.jpg"><br>  <i>Connect the PDU to the monitoring system.</i> <br><br><h2>  Derivative parameters: phase and beam load balancing </h2><br>  Based on the data received from network analyzers in distribution boards, UPS monitoring modules, PDUs, several derived parameters are calculated in the monitoring system. <br><br>  <b>Phase load.</b>  If the load is distributed evenly across the phases, then the power of the cable and the machines will be used efficiently.  When one or two phases are overloaded, and one or two are underloaded, the so-called phase distortion occurs.  This will, at a minimum, mean that the available power is not optimally used.  In the worst case, this will lead to the disconnection of the machine and overheating of the cable. <br><br><img src="https://habrastorage.org/files/8a0/500/d73/8a0500d7364746eb8d4acf38a4037ef7.PNG"><br>  <i>Phase load in the monitoring system</i> <br><br>  <b>Paired loads on two rays.</b>  In our data centers, the reserve power supply system 2N. <br><br>  Each rack fits two independent power supply beam.  And if something happens to one of the power rays, the other takes on the load of the failed.  It turns out that each beam should be loaded only half of the rated power.  Only in this case, the remaining beam in the system will withstand double the load. <br><br>  To do this, we monitor that the load on one beam does not exceed more than 50% of the nominal, and the total load on two beams - 100% of the nominal. <br><br>  If you do not monitor this parameter, then you can ‚Äúmiss‚Äù the situation when we do not have a reserve for the second beam, since the pair load exceeds the nominal power of the machine. <br><br>  Both principles must be respected at the same time.  Consider this in practice.  Suppose we have a rack with a three-phase power supply of 32 A per phase.  The equipment connects to two PDUs.  Each PDU has three sections (B1, B2, B3), each section corresponds to a phase, i.e.  we are dealing with a three-phase PDU.  If we follow the above rules, it turns out that the total load on the two beams should be below 32 A (see the figure below). <br><br><img src="https://habrastorage.org/files/288/079/237/288079237bb34648ad2d8ebf11887998.png"><br><br>  It seems everything is clear, but let's consider this case.  In the same rack, we connect the equipment (see figure below).  It would seem that out of 19.5 kW (three sections of 6.5 kW each), we have only 11 kW occupied, and we can sleep in peace.  But at some point we have one beam off, and the entire stand is left without power.  The following has happened.  We overloaded the first section (phase) on one of the beams.  The total load was greater than nominal.  When one of the beams took over this excessive load, the machine dismounted. <br><br><img src="https://habrastorage.org/files/54e/066/91a/54e06691a7934323b73814343ae13d2e.png"><br><br><img src="https://habrastorage.org/files/02f/44b/f5a/02f44bf5a9a242d588f3b3f9434f8689.PNG"><br>  <i>Paired loads on the first PDU section (B1) in the monitoring system.</i> <br><br>  So pair load is measured at the level of the rack.  By the same principle, we track: <br><br><ul><li>  paired loads in the sections of the switchboards of machine rooms; </li><li>  paired loads on the schR in general; </li><li>  paired load on the UPS. </li></ul><br><img src="https://habrastorage.org/files/d52/f28/c91/d52f28c91242406f8c207380c278c8ea.jpg"><br>  <i>Paired loads on the UPS in the monitoring system.</i> <br><br>  On this stop.  Ask questions in the comments.  If you have questions about load balancing in racks or switchboards, write in the comments, in a personal or on <b>consulting@dtln.ru</b> . <br><br>  In the next article we will talk about the <a href="https://habrahabr.ru/company/dataline/blog/338966/">monitoring of cold supply</a> . <br><br>  <b>More articles about monitoring and power supply in the data center:</b> <br><br>  <a href="https://habrahabr.ru/company/dataline/blog/319446/">Part 1. Monitoring of engineering infrastructure in the data center.</a>  <a href="https://habrahabr.ru/company/dataline/blog/319446/">Highlights</a> <br>  <a href="https://habrahabr.ru/company/dataline/blog/310356/">The path of electricity in the data center</a> <br>  <a href="https://habrahabr.ru/company/dataline/blog/319926/">How to test the DSU in the data center</a> </div><p>Source: <a href="https://habr.com/ru/post/324610/">https://habr.com/ru/post/324610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324598/index.html">Quadstor - performance and reliability</a></li>
<li><a href="../324600/index.html">GitHub introduces SHA-1 collision detection system</a></li>
<li><a href="../324604/index.html">Detection and elimination of hacker attacks: how the system GOSPKA works</a></li>
<li><a href="../324606/index.html">Definition of development vector in the project</a></li>
<li><a href="../324608/index.html">Intel strengthens its position in HPC</a></li>
<li><a href="../324612/index.html">How we started to develop our own project management system and what came out of it</a></li>
<li><a href="../324616/index.html">Position-independent code (PIC) in x64 shared libraries</a></li>
<li><a href="../324618/index.html">Encrypted mail services: what to choose?</a></li>
<li><a href="../324620/index.html">We make a more or less universal calculator of services for the site.</a></li>
<li><a href="../324622/index.html">Data Science Weekend Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>