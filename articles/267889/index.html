<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GitFlow and Semantic Versioning for every day</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How much time I use GitFlow and Semantic Versioning , everything does not leave me feeling that something is missing in them. Both concepts are good, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GitFlow and Semantic Versioning for every day</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/71c/98d/0a7/71c98d0a759e5f8f7037032e3e2c4edc.png" alt="image"><br><br>  How much time I use <a href="http://habrahabr.ru/post/106912/">GitFlow</a> and <a href="http://habrahabr.ru/post/134033/">Semantic Versioning</a> , everything does not leave me feeling that something is missing in them.  Both concepts are good, but since they offer solutions for problems from different areas, their sharing looks more complicated than they should be. <br><br>  Perhaps the reason is that I chose not the most optimal way, and this could be a good topic for a future post.  In this same I want to describe a simple approach to managing releases of applications and libraries. <br><a name="habracut"></a><br><h2>  Problem </h2><br>  How to make sure that the release build does not get into production without proper integration testing?  How to make sure that the NuGet package will not be published until it passes the test with a static analyzer? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Most of the tools that could solve these problems already exist, and we often use them ‚Äúin manual mode‚Äù.  In fact, you only need to automate all this slightly, but this requires entering appropriate agreements and patterns. <br><br><h2>  Instruments </h2><br>  We describe the current state of affairs. <br><br><h3>  Environments </h3><br>  As long as we do not have the capacity or infrastructure to test production, the classic approach would be to use <a href="https://en.wikipedia.org/wiki/Development,_testing,_acceptance_and_production">different environments</a> for different phases of the release life, such as integration or acceptance tests.  It would be good to always be sure that a specific assembly of the application will be able to get only to the environment corresponding to it.  To do this, we need the ability to uniquely identify each version. <br><br><h3>  Semantic versioning </h3><br>  Before we go into the details of what exactly we should assign versions, we need to think about how to generally version the software.  This topic is not new, and fortunately there is a Semantic Versioning, although in versions of which you <a href="http://semver.org/lang/ru/">still have to figure it out</a> . <br><br>  A nice bonus for .NET developers is the <a href="https://docs.nuget.org/create/versioning">almost complete support of</a> this approach by NuGet and <a href="https://www.nuget.org/packages/log4net/">most public packages</a> . <br><br><h3>  Gitflow </h3><br>  For most of the projects I've worked with, GitFlow seems like a fairly natural choice to me.  If it turns out to be too complicated due to the frequency or number of changes, then you can always ‚Äúroll back‚Äù to <a href="http://habrahabr.ru/post/189046/">GitHub Flow</a> , where each change is the so-called ‚Äúhot fix‚Äù. <br><br>  I want to note that for this model Git is not required at all.  What actually <a href="https://vsarbranchingguide.codeplex.com/">write</a> ALM Rangers.  Although, with Git, this model works easier than with Subversion. <br><br>  I will not consider in detail the various strategies for working with branches that are already well <a href="https://guides.github.com/introduction/flow/">documented</a> . <br><br><h2>  What is worth forgetting </h2><br>  In the good old days, when most of the tools mentioned above were missing or not so widely used, it was common practice to gradually deploy one version through all environments.  One such approach was to commit binary files to a special repository, and to further advance through branches corresponding to different environments.  Sometimes this led to meaningless merdzham and even conflicts in the configuration files.  Often it was ‚Äúflavored‚Äù with custom deployment scripts for Robocopy. <br><br>  A large number of manual operations are error prone.  As a rule, if there is a possibility to make a mistake, then most likely it will be made.  Therefore, please forget this approach, like everything you read in the previous paragraph. <br><br><h2>  Next approach </h2><br>  Let's take a look at how we can apply the above concepts together with the appropriate tools. <br><br><h3>  Artifacts </h3><br>  For convenient identification, we version the artifacts produced by the build server: builds and libraries.  The basic requirement is the ability to associate an artifact with the source of the change (the commit hash in Git) and the process that generated the artifact (build ID).  Most <acronym>CI</acronym> tools have internal assembly counters, which makes this information available. <br><br>  To work with reusable components (libraries), the standard in the .NET world is the package manager (NuGet).  Using the deployment manager, such as <a href="https://octopus.com/">Octopus Deploy</a> , allows you to apply the same concept to all the artifacts supplied.  But how exactly to collect and link this meta-information and artifact? <br><br><h3>  Branches and releases </h3><br>  Instead of using branches corresponding to environments, let's create artifacts that already contain information about the environment they should be assigned to.  In other words, we will associate a specific artifact with a specific environment.  Knowing what each of the environments is used for, and having this meta-information, we can automatically make decisions about the next stage of deployment. <br><br>  First we need to determine how stable the artifact is, built from a specific branch: <br><table><tbody><tr><th>  Branch </th><th>  Release type </th><th>  Version format </th></tr><tr><td>  feature </td><td>  alpha </td><td>  # major. # minor. # revision-a # build # feature </td></tr><tr><td>  develop </td><td>  beta </td><td>  # major. # minor. # revision-b # build </td></tr><tr><td>  release </td><td>  release candidate </td><td>  # major. # minor. # revision-r # build </td></tr><tr><td>  hotfix </td><td>  release candidate </td><td>  # major. # minor. # revision-r # build </td></tr><tr><td>  master </td><td>  stable </td><td>  # major. # minor. # revision </td></tr></tbody></table><br>  Using the above format, we can describe <a href="http://stackoverflow.com/questions/64602/what-are-differences-between-assemblyversion-assemblyfileversion-and-assemblyin">assembly metadata</a> , for example in general for all assemblies (assebmly) file in a project. <br><pre><code class="hljs json">[assembly: AssemblyVersion(<span class="hljs-string"><span class="hljs-string">"#major.#minor"</span></span>)] [assembly: AssemblyFileVersion(<span class="hljs-string"><span class="hljs-string">"#major.#minor.#revision.#build"</span></span>)] [assembly: AssemblyInformationalVersion(<span class="hljs-string"><span class="hljs-string">"#major.#minor.#revision[-prerelease]"</span></span>)]</code> </pre> <br>  For <code>AssmeblyInformationalVersion</code> we use the format defined in the previous table. <br>  Thus, the versions are numbered according to Semanic Versioning for runtime as well as for identifying the CI build and for the version of the result package. <br><br>  Using the example of GitFlow-based steps, the versions of the NuGet packages produced by the CI system after a commit to the appropriate branch will look like this: <br><table><tbody><tr><th>  Task </th><th>  Branch </th><th>  CI build number </th><th>  NuGet Package Version </th></tr><tr><td>  Implement feature # 1 </td><td>  feature-1 </td><td>  one </td><td>  1.2.0-a1feature1 </td></tr><tr><td>  Implement feature # 2 </td><td>  feature-2 </td><td>  2 </td><td>  1.2.0-a2feature2 </td></tr><tr><td>  Implement feature # 1 </td><td>  feature-1 </td><td>  3 </td><td>  1.2.0-a3feature1 </td></tr><tr><td>  Complete feature # 1 </td><td>  develop </td><td>  four </td><td>  1.2.0-b4 </td></tr><tr><td>  Complete feature # 2 </td><td>  develop </td><td>  five </td><td>  1.2.0-b5 </td></tr><tr><td>  Stabilize release </td><td>  release-1.2.0 </td><td>  6 </td><td>  1.2.0-r6 </td></tr><tr><td>  Release to production </td><td>  master </td><td>  7 </td><td>  1.2.0 </td></tr><tr><td>  Fix production issue </td><td>  hotfix-1.2.1 </td><td>  eight </td><td>  1.2.1-r8 </td></tr><tr><td>  Release to production </td><td>  master </td><td>  9 </td><td>  1.2.1 </td></tr></tbody></table><br>  This pattern well reflects the natural order of increasing release readiness when sorting packages by version. <br>  When creating a release or hotfix, I prefer to increase the version number manually in the general file with metadata and commit it to the repository.  Thus, the version number will be relevant for local copies of the project. <br><br><h3>  Deployments </h3><br>  The important point is to protect against accidental deployment of the wrong environment.  As a first line of defense can be a CI server, a crashing build that fails unit tests.  In addition, when using GitHub, you can pay attention to the so-called <a href="http://habrahabr.ru/post/266381/">protected branches</a> . <br><br>  In Octopus Deploy, there is the concept of <a href="http://docs.octopusdeploy.com/display/OD/Lifecycles">lifecycles</a> , which allows us to gradually release through various environments.  However, with the approach considered in this article, we get different artifacts for each of the deployment stages.  This means that we need to monitor that each artifact is deposited only on the environment allowed to it. <br><table><tbody><tr><th>  Release type </th><th>  Allowed environments </th></tr><tr><td>  alpha </td><td>  D </td></tr><tr><td>  beta </td><td>  T, d </td></tr><tr><td>  release candidate </td><td>  A, T, D </td></tr><tr><td>  stable </td><td>  P, A, T, D </td></tr></tbody></table><br>  If our Deployment manager does not support this setup of different life cycles depending on the version of the build <a href="http://docs.octopusdeploy.com/display/OD/Automatic%2BRelease%2BCreation">at the native</a> level, then as a rule you can implement it yourself in the form of a simple script.  By coding information about the build type into the build version, we get a simple and reliable tool for ‚Äúsafe‚Äù and automated creation of releases and their deployment.  Such automation is possible, as with the use of Automatic Release Creation in Octopus Deploy, as well as with the so-called Release Train, which is launched according to a schedule. <br><br><h2>  Alternatives </h2><br>  The same numbers in the release and in the version of the package looks suspicious.  In fact, there is no separation of the concepts of release and artifact.  This is especially noticeable in the case of NuGet packages for libraries, where it would be nice to have a separate version numbering scheme.  Such a scheme can be based on tags in <acronym>VCS</acronym> (do you mark releases with tags?). <br><br>  Relatively recently, I came across <a href="https://github.com/GitTools/GitVersion">GitVersion</a> , which supports these concepts natively, and at the same time provides the possibility of flexible configuration.  Obviously, it makes sense to pay attention to him. <br><br><h2>  Conclusion </h2><br>  In this article, we looked at a simple approach to managing release builds of applications and individual components (libraries).  I hope these ideas will be useful to you in one form or another. <br><br>  <i>[Translator's note] This is the ambiguous approach to managing releases.</i>  <i>Colleagues, I suggest you tell us how the releases and versioning are arranged for you?</i> <br><br><h2>  Links </h2><br><ul><li>  <a href="http://habrahabr.ru/post/106912/">Gitflow</a> </li><li>  <a href="http://habrahabr.ru/post/189046/">Github flow</a> </li><li>  <a href="https://guides.github.com/introduction/flow/">GitHub Flow ENG</a> </li><li>  <a href="https://vsarbranchingguide.codeplex.com/">ALM Rangers Branching Guidance</a> </li><li>  <a href="http://habrahabr.ru/post/134033/">Semantic versioning</a> </li><li>  <a href="https://en.wikipedia.org/wiki/Development,_testing,_acceptance_and_production">DTAP environments</a> </li><li>  <a href="https://docs.nuget.org/create/versioning">NuGet versioning</a> </li><li>  <a href="https://www.nuget.org/packages/log4net/">Log4net versioning</a> </li><li>  <a href="http://stackoverflow.com/questions/64602/what-are-differences-between-assemblyversion-assemblyfileversion-and-assemblyin">Assembly versioning</a> </li><li>  <a href="http://semver.org/lang/ru/">Semantic Versioning 2.0.0</a> </li><li>  <a href="https://octopus.com/">Octopus Deploy</a> </li><li>  <a href="http://docs.octopusdeploy.com/display/OD/Lifecycles">Octopus Deploy Lifecycles</a> </li><li>  <a href="http://docs.octopusdeploy.com/display/OD/Automatic%2BRelease%2BCreation">Automatic Release Creation</a> </li><li>  <a href="http://habrahabr.ru/post/266381/">Protected branches</a> </li><li>  <a href="https://github.com/GitTools/GitVersion">Gitversion</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/267889/">https://habr.com/ru/post/267889/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267877/index.html">Partner Seminar "1C" - for the first time not only for partners</a></li>
<li><a href="../267879/index.html">Financial Computing Challenge</a></li>
<li><a href="../267881/index.html">12 typical database backup errors</a></li>
<li><a href="../267883/index.html">Optimization of communication channels for mining in the north of Russia</a></li>
<li><a href="../267887/index.html">.sorting in Perl 6</a></li>
<li><a href="../267893/index.html">Checking Appleseed source code</a></li>
<li><a href="../267895/index.html">Creating a JavaScript Synthesizer</a></li>
<li><a href="../267899/index.html">Online Trading: How to become a developer of systems for trading on the exchange</a></li>
<li><a href="../267901/index.html">The digest of news from the world of development on Unity</a></li>
<li><a href="../267903/index.html">Common Python problems and solutions (translation)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>