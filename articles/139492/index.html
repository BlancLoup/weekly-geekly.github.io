<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Drag'n'drop files in Flex using the HTML5 File API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day! Recently, for a single web application on Flex, it was necessary to drag and drop photos. Flash does not allow this to be implemented direct...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Drag'n'drop files in Flex using the HTML5 File API</h1><div class="post__text post__text-html js-mediator-article"> Good day!  Recently, for a single web application on Flex, it was necessary to drag and drop photos.  Flash does not allow this to be implemented directly, although such functionality is present in AIR applications.  To solve the problem, it was necessary to apply the HTML5 File API. <br><a name="habracut"></a><br>  Thus, the solution of the problem is divided into several stages.  The first step is handling drag'n'drop files using the File API.  All uploaded files are added to the list from which they will later be transferred to Flash. <br><br><pre> <code class="hljs bash"><code class="javascript">$(document).ready(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() { var dropZone = $(<span class="hljs-string"><span class="hljs-string">'div#dropZone'</span></span>); //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof(window.FileReader) == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { dropZone.text(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>); dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'error'</span></span>); } //   Drop dropZone[0].ondrop = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) { event.preventDefault(); dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>); dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'drop'</span></span>); displayFiles(event.dataTransfer.files); }; }); //-------------------------------------------------------------------------------------------------- var fileList = new Array(); <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> displayFiles(files) { $.each(files, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(i, file) { var imgList = $(<span class="hljs-string"><span class="hljs-string">'ul#img-list'</span></span>); var maxFileSize = 20*1000000; //    - 1 . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.type.match(/image.*/)) { //    <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } //   li     ,  //      file,    File (  ) var li = $(<span class="hljs-string"><span class="hljs-string">'&lt;li/&gt;'</span></span>).appendTo(imgList); $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>).text(file.name).appendTo(li); //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.size &gt; maxFileSize) { $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>).appendTo(li); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var img = $(<span class="hljs-string"><span class="hljs-string">'&lt;img/&gt;'</span></span>).appendTo(li); li.file = file; //   FileReader     ,     //     var reader = new FileReader(); reader.onload = (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(aImg, file) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(e) { aImg.attr(<span class="hljs-string"><span class="hljs-string">'src'</span></span>, e.target.result); aImg.attr(<span class="hljs-string"><span class="hljs-string">'width'</span></span>, 75); file.f_data = e.target.result; //       fileList.push(file); }; })(img, file); reader.readAsDataURL(file); } }); } //--------------------------------------------------------------------------------------------------</code> <br> HTML    flex ,    div,       . <br> <code class="html">&lt;div style=<span class="hljs-string"><span class="hljs-string">"float:left"</span></span>&gt; &lt;/div&gt; &lt;object classid=<span class="hljs-string"><span class="hljs-string">"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"</span></span> codebase=<span class="hljs-string"><span class="hljs-string">"https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0"</span></span> id=<span class="hljs-string"><span class="hljs-string">"web-client"</span></span> width=<span class="hljs-string"><span class="hljs-string">"800px"</span></span> align=<span class="hljs-string"><span class="hljs-string">"middle"</span></span> height=<span class="hljs-string"><span class="hljs-string">"600px"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"allowScriptAccess"</span></span> value=<span class="hljs-string"><span class="hljs-string">"sameDomain"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"allowFullScreen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"movie"</span></span> value=<span class="hljs-string"><span class="hljs-string">"dd_test.swf"</span></span>&gt;&lt;param name=<span class="hljs-string"><span class="hljs-string">"quality"</span></span> value=<span class="hljs-string"><span class="hljs-string">"high"</span></span>&gt;&lt;param name=<span class="hljs-string"><span class="hljs-string">"bgcolor"</span></span> value=<span class="hljs-string"><span class="hljs-string">"#cccccc"</span></span>&gt;&lt;embed src=<span class="hljs-string"><span class="hljs-string">"test.swf"</span></span> quality=<span class="hljs-string"><span class="hljs-string">"high"</span></span> bgcolor=<span class="hljs-string"><span class="hljs-string">"#cccccc"</span></span> name=<span class="hljs-string"><span class="hljs-string">"web-client"</span></span> allowscriptaccess=<span class="hljs-string"><span class="hljs-string">"sameDomain"</span></span> allowfullscreen=<span class="hljs-string"><span class="hljs-string">"false"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"application/x-shockwave-flash"</span></span> pluginspage=<span class="hljs-string"><span class="hljs-string">"https://www.adobe.com/go/getflashplayer"</span></span> width=<span class="hljs-string"><span class="hljs-string">"800"</span></span> align=<span class="hljs-string"><span class="hljs-string">"middle"</span></span> height=<span class="hljs-string"><span class="hljs-string">"600"</span></span>&gt; &lt;/object&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"dropzone"</span></span> style=<span class="hljs-string"><span class="hljs-string">"float:left"</span></span>&gt; &lt;p&gt; ,   .&lt;/p&gt; &lt;ul id=<span class="hljs-string"><span class="hljs-string">"img-list"</span></span>&gt;&lt;/ul&gt; &lt;/div&gt;</code> <br></code> </pre> <code><code class="javascript">$(document).ready(function() { var dropZone = $('div#dropZone'); //    if (typeof(window.FileReader) == 'undefined') { dropZone.text('  !'); dropZone.addClass('error'); } //   Drop dropZone[0].ondrop = function(event) { event.preventDefault(); dropZone.removeClass('hover'); dropZone.addClass('drop'); displayFiles(event.dataTransfer.files); }; }); //-------------------------------------------------------------------------------------------------- var fileList = new Array(); function displayFiles(files) { $.each(files, function(i, file) { var imgList = $('ul#img-list'); var maxFileSize = 20*1000000; //    - 1 . if (!file.type.match(/image.*/)) { //    return true; } //   li     ,  //      file,    File (  ) var li = $('&lt;li/&gt;').appendTo(imgList); $('&lt;div/&gt;').text(file.name).appendTo(li); //    if (file.size &gt; maxFileSize) { $('&lt;div/&gt;').text('  !').appendTo(li); } else { var img = $('&lt;img/&gt;').appendTo(li); li.file = file; //   FileReader     ,     //     var reader = new FileReader(); reader.onload = (function(aImg, file) { return function(e) { aImg.attr('src', e.target.result); aImg.attr('width', 75); file.f_data = e.target.result; //       fileList.push(file); }; })(img, file); reader.readAsDataURL(file); } }); } //--------------------------------------------------------------------------------------------------</code> <br> HTML    flex ,    div,       . <br> <code class="html">&lt;div style="float:left"&gt; &lt;/div&gt; &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" id="web-client" width="800px" align="middle" height="600px"&gt; &lt;param name="allowScriptAccess" value="sameDomain"&gt; &lt;param name="allowFullScreen" value="false"&gt; &lt;param name="movie" value="dd_test.swf"&gt;&lt;param name="quality" value="high"&gt;&lt;param name="bgcolor" value="#cccccc"&gt;&lt;embed src="test.swf" quality="high" bgcolor="#cccccc" name="web-client" allowscriptaccess="sameDomain" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="https://www.adobe.com/go/getflashplayer" width="800" align="middle" height="600"&gt; &lt;/object&gt; &lt;div id="dropzone" style="float:left"&gt; &lt;p&gt; ,   .&lt;/p&gt; &lt;ul id="img-list"&gt;&lt;/ul&gt; &lt;/div&gt;</code> <br></code> <pre> <code class="hljs bash"><code class="javascript">$(document).ready(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>() { var dropZone = $(<span class="hljs-string"><span class="hljs-string">'div#dropZone'</span></span>); //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof(window.FileReader) == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { dropZone.text(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>); dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'error'</span></span>); } //   Drop dropZone[0].ondrop = <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(event) { event.preventDefault(); dropZone.removeClass(<span class="hljs-string"><span class="hljs-string">'hover'</span></span>); dropZone.addClass(<span class="hljs-string"><span class="hljs-string">'drop'</span></span>); displayFiles(event.dataTransfer.files); }; }); //-------------------------------------------------------------------------------------------------- var fileList = new Array(); <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> displayFiles(files) { $.each(files, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(i, file) { var imgList = $(<span class="hljs-string"><span class="hljs-string">'ul#img-list'</span></span>); var maxFileSize = 20*1000000; //    - 1 . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!file.type.match(/image.*/)) { //    <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } //   li     ,  //      file,    File (  ) var li = $(<span class="hljs-string"><span class="hljs-string">'&lt;li/&gt;'</span></span>).appendTo(imgList); $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>).text(file.name).appendTo(li); //    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.size &gt; maxFileSize) { $(<span class="hljs-string"><span class="hljs-string">'&lt;div/&gt;'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'  !'</span></span>).appendTo(li); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { var img = $(<span class="hljs-string"><span class="hljs-string">'&lt;img/&gt;'</span></span>).appendTo(li); li.file = file; //   FileReader     ,     //     var reader = new FileReader(); reader.onload = (<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(aImg, file) { <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(e) { aImg.attr(<span class="hljs-string"><span class="hljs-string">'src'</span></span>, e.target.result); aImg.attr(<span class="hljs-string"><span class="hljs-string">'width'</span></span>, 75); file.f_data = e.target.result; //       fileList.push(file); }; })(img, file); reader.readAsDataURL(file); } }); } //--------------------------------------------------------------------------------------------------</code> <br> HTML    flex ,    div,       . <br> <code class="html">&lt;div style=<span class="hljs-string"><span class="hljs-string">"float:left"</span></span>&gt; &lt;/div&gt; &lt;object classid=<span class="hljs-string"><span class="hljs-string">"clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"</span></span> codebase=<span class="hljs-string"><span class="hljs-string">"https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0"</span></span> id=<span class="hljs-string"><span class="hljs-string">"web-client"</span></span> width=<span class="hljs-string"><span class="hljs-string">"800px"</span></span> align=<span class="hljs-string"><span class="hljs-string">"middle"</span></span> height=<span class="hljs-string"><span class="hljs-string">"600px"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"allowScriptAccess"</span></span> value=<span class="hljs-string"><span class="hljs-string">"sameDomain"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"allowFullScreen"</span></span> value=<span class="hljs-string"><span class="hljs-string">"false"</span></span>&gt; &lt;param name=<span class="hljs-string"><span class="hljs-string">"movie"</span></span> value=<span class="hljs-string"><span class="hljs-string">"dd_test.swf"</span></span>&gt;&lt;param name=<span class="hljs-string"><span class="hljs-string">"quality"</span></span> value=<span class="hljs-string"><span class="hljs-string">"high"</span></span>&gt;&lt;param name=<span class="hljs-string"><span class="hljs-string">"bgcolor"</span></span> value=<span class="hljs-string"><span class="hljs-string">"#cccccc"</span></span>&gt;&lt;embed src=<span class="hljs-string"><span class="hljs-string">"test.swf"</span></span> quality=<span class="hljs-string"><span class="hljs-string">"high"</span></span> bgcolor=<span class="hljs-string"><span class="hljs-string">"#cccccc"</span></span> name=<span class="hljs-string"><span class="hljs-string">"web-client"</span></span> allowscriptaccess=<span class="hljs-string"><span class="hljs-string">"sameDomain"</span></span> allowfullscreen=<span class="hljs-string"><span class="hljs-string">"false"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=<span class="hljs-string"><span class="hljs-string">"application/x-shockwave-flash"</span></span> pluginspage=<span class="hljs-string"><span class="hljs-string">"https://www.adobe.com/go/getflashplayer"</span></span> width=<span class="hljs-string"><span class="hljs-string">"800"</span></span> align=<span class="hljs-string"><span class="hljs-string">"middle"</span></span> height=<span class="hljs-string"><span class="hljs-string">"600"</span></span>&gt; &lt;/object&gt; &lt;div id=<span class="hljs-string"><span class="hljs-string">"dropzone"</span></span> style=<span class="hljs-string"><span class="hljs-string">"float:left"</span></span>&gt; &lt;p&gt; ,   .&lt;/p&gt; &lt;ul id=<span class="hljs-string"><span class="hljs-string">"img-list"</span></span>&gt;&lt;/ul&gt; &lt;/div&gt;</code> <br></code> </pre> <code><code class="javascript">$(document).ready(function() { var dropZone = $('div#dropZone'); //    if (typeof(window.FileReader) == 'undefined') { dropZone.text('  !'); dropZone.addClass('error'); } //   Drop dropZone[0].ondrop = function(event) { event.preventDefault(); dropZone.removeClass('hover'); dropZone.addClass('drop'); displayFiles(event.dataTransfer.files); }; }); //-------------------------------------------------------------------------------------------------- var fileList = new Array(); function displayFiles(files) { $.each(files, function(i, file) { var imgList = $('ul#img-list'); var maxFileSize = 20*1000000; //    - 1 . if (!file.type.match(/image.*/)) { //    return true; } //   li     ,  //      file,    File (  ) var li = $('&lt;li/&gt;').appendTo(imgList); $('&lt;div/&gt;').text(file.name).appendTo(li); //    if (file.size &gt; maxFileSize) { $('&lt;div/&gt;').text('  !').appendTo(li); } else { var img = $('&lt;img/&gt;').appendTo(li); li.file = file; //   FileReader     ,     //     var reader = new FileReader(); reader.onload = (function(aImg, file) { return function(e) { aImg.attr('src', e.target.result); aImg.attr('width', 75); file.f_data = e.target.result; //       fileList.push(file); }; })(img, file); reader.readAsDataURL(file); } }); } //--------------------------------------------------------------------------------------------------</code> <br> HTML    flex ,    div,       . <br> <code class="html">&lt;div style="float:left"&gt; &lt;/div&gt; &lt;object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=10,0,0,0" id="web-client" width="800px" align="middle" height="600px"&gt; &lt;param name="allowScriptAccess" value="sameDomain"&gt; &lt;param name="allowFullScreen" value="false"&gt; &lt;param name="movie" value="dd_test.swf"&gt;&lt;param name="quality" value="high"&gt;&lt;param name="bgcolor" value="#cccccc"&gt;&lt;embed src="test.swf" quality="high" bgcolor="#cccccc" name="web-client" allowscriptaccess="sameDomain" allowfullscreen="false" type="application/x-shockwave-flash" pluginspage="https://www.adobe.com/go/getflashplayer" width="800" align="middle" height="600"&gt; &lt;/object&gt; &lt;div id="dropzone" style="float:left"&gt; &lt;p&gt; ,   .&lt;/p&gt; &lt;ul id="img-list"&gt;&lt;/ul&gt; &lt;/div&gt;</code> <br></code> <br>  The second step is to transfer the downloaded file to Flash.  To communicate with the external world, Flash has the <a href="http://help.adobe.com/ru_RU/FlashPlatform/reference/actionscript/3/flash/external/ExternalInterface.html">ExternalInterface</a> class, it allows you to call JS functions, as well as to make functions available to call Flash.  Unfortunately, the function call from Flash did not work for me steadily, so I had to start the timer inside and call the JS function to transfer the already loaded files. <br>  The main problem was the form of transfer photos.  Inside Flash, it was convenient for me to work with a photo as with an object of the class <a href="http://help.adobe.com/ru_RU/FlashPlatform/reference/actionscript/3/flash/utils/ByteArray.html">ByteArray</a> .  Since there is no analogue of the class ByteArray in JS, we had to use the additional data conversion to base64 during the transfer.  The File API has a corresponding function - readAsDataURL (), which returns the file as a string in base64 encoding.  We pass the resulting string to flash and use <a href="http://help.adobe.com/ru_RU/FlashPlatform/reference/actionscript/3/mx/utils/Base64Decoder.html">Base64Decoder to</a> get an object of the ByteArray class containing our original photo. <br><pre> <code class="hljs perl"><code class="actionscript">// Flex ,     var dragTimer:Timer; var file_count_already_have:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   -  JS  ,   JS -   public function init_draginteface():void { dragTimer = new Timer(<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">1000</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">3</span></span>  dragTimer.addEventListener(TimerEvent.TIMER, dragTimerEvent); dragTimer.start(); file_count_already_have = <span class="hljs-number"><span class="hljs-number">0</span></span>; } //--------------------------------------------------------------------------- public function dragTimerEvent(e:TimerEvent):void { dragTimer.stop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(ExternalInterface.available) { var file_count:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = ExternalInterface.call(<span class="hljs-string"><span class="hljs-string">"dropFileCount"</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> JS -,      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file_count&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(var i:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = file_count_already_have ; i&lt;file_count; i++) { dragImageFromJS(i); } file_count_already_have = file_count; } dragTimer.start(); } } //--------------------------------------------------------------------------- public function dragImageFromJS(i:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>):void { var file_size:<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> = ExternalInterface.call(<span class="hljs-string"><span class="hljs-string">"getFileSize"</span></span>, i); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    var file_name:String = ExternalInterface.call(<span class="hljs-string"><span class="hljs-string">"getFileName"</span></span>, i); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   var file_ba:ByteArray = new ByteArray; var base64dec:Base64Decoder = new Base64Decoder(); var start_load:uint = getTimer(); base64dec.decode(ExternalInterface.call(<span class="hljs-string"><span class="hljs-string">"getFile"</span></span>, i)); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       base64 var load_time:uint = getTimer() - start_load; file_ba = base64dec.toByteArray(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(file_ba != null) { trace(<span class="hljs-string"><span class="hljs-string">""</span></span>); trace(<span class="hljs-string"><span class="hljs-string">"add new item [file_name: "</span></span>+file_name+<span class="hljs-string"><span class="hljs-string">"] [file_size:"</span></span>+file_size.toString()+<span class="hljs-string"><span class="hljs-string">"] [fr_ba_size: "</span></span>+file_ba.length + <span class="hljs-string"><span class="hljs-string">"] [load_time: "</span></span>+load_time.toString()+<span class="hljs-string"><span class="hljs-string">"]"</span></span>); loadFromByteArray(file_ba); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Flex  } }</code> <br></code> </pre> <code><code class="actionscript">// Flex ,     var dragTimer:Timer; var file_count_already_have:int; //   -  JS  ,   JS -   public function init_draginteface():void { dragTimer = new Timer(3*1000,0); //  3  dragTimer.addEventListener(TimerEvent.TIMER, dragTimerEvent); dragTimer.start(); file_count_already_have = 0; } //--------------------------------------------------------------------------- public function dragTimerEvent(e:TimerEvent):void { dragTimer.stop(); if(ExternalInterface.available) { var file_count:int = ExternalInterface.call("dropFileCount"); // JS -,      if (file_count&gt;0) { for(var i:int = file_count_already_have ; i&lt;file_count; i++) { dragImageFromJS(i); } file_count_already_have = file_count; } dragTimer.start(); } } //--------------------------------------------------------------------------- public function dragImageFromJS(i:int):void { var file_size:int = ExternalInterface.call("getFileSize", i); //    var file_name:String = ExternalInterface.call("getFileName", i); //   var file_ba:ByteArray = new ByteArray; var base64dec:Base64Decoder = new Base64Decoder(); var start_load:uint = getTimer(); base64dec.decode(ExternalInterface.call("getFile", i)); //       base64 var load_time:uint = getTimer() - start_load; file_ba = base64dec.toByteArray(); if(file_ba != null) { trace(""); trace("add new item [file_name: "+file_name+"] [file_size:"+file_size.toString()+"] [fr_ba_size: "+file_ba.length + "] [load_time: "+load_time.toString()+"]"); loadFromByteArray(file_ba); //   Flex  } }</code> <br></code> <br><pre> <code class="hljs ruby"><code class="javascript">/<span class="hljs-regexp"><span class="hljs-regexp">/JS -,    Flex  function dropFileCount() /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   { return fileList.length; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/-------------------------------------------------------------------------------------------------- function getFile(i) /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/     { var data = fileList[i].f_data; var data_cat = data.substr(23); return data_cat; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    ,   ,    /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/data:image/jpeg</span></span>;base64,<span class="hljs-regexp"><span class="hljs-regexp">/9j/</span></span><span class="hljs-number"><span class="hljs-number">4</span></span>U3ARXhpZgAASUkq /<span class="hljs-regexp"><span class="hljs-regexp">/-------------------------------------------------------------------------------------------------- function getFileSize(i) { return fileList[i].size; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/-------------------------------------------------------------------------------------------------- function getFileName(i) { return fileList[i].name; } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/--------------------------------------------------------------------------------------------------</span></span></code><span class="hljs-regexp"><span class="hljs-regexp"> </span></span><br></code> </pre> <code><code class="javascript">//JS -,    Flex  function dropFileCount() //   { return fileList.length; } //-------------------------------------------------------------------------------------------------- function getFile(i) //     { var data = fileList[i].f_data; var data_cat = data.substr(23); return data_cat; } //    ,   ,    //data:image/jpeg;base64,/9j/4U3ARXhpZgAASUkq //-------------------------------------------------------------------------------------------------- function getFileSize(i) { return fileList[i].size; } //-------------------------------------------------------------------------------------------------- function getFileName(i) { return fileList[i].name; } //--------------------------------------------------------------------------------------------------</code> <br></code> <br>  As a result, we get drag'n'drop loading photos in the Flex application.  A small piece of code for displaying photos from ByteArray. <br><pre> <code class="hljs xml"><code class="actionscript"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Script</span></span></span><span class="hljs-tag">&gt;</span></span> &lt;![CDATA[ // Flex       ByteArray public function loadFromByteArray(data:ByteArray):void { _loader = new Loader(); _loader.contentLoaderInfo.addEventListener(Event.COMPLETE,_load_loader_complete); _loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, errorOnLoad); _loader.loadBytes(data); } public function _load_loader_complete(e:Event):void { _loader.removeEventListener(Event.COMPLETE,_load_loader_complete); var bitmapIm:Bitmap = Bitmap(e.target.content); this.itemIm.addChild(bitmapIm); } ]]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mx:Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"itemIm"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxWidth</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">maxHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">horizontalAlign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"left"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">verticalAlign</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"top"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> <br></code> </pre> <code><code class="actionscript">&lt;mx:Script&gt; &lt;![CDATA[ // Flex       ByteArray public function loadFromByteArray(data:ByteArray):void { _loader = new Loader(); _loader.contentLoaderInfo.addEventListener(Event.COMPLETE,_load_loader_complete); _loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR, errorOnLoad); _loader.loadBytes(data); } public function _load_loader_complete(e:Event):void { _loader.removeEventListener(Event.COMPLETE,_load_loader_complete); var bitmapIm:Bitmap = Bitmap(e.target.content); this.itemIm.addChild(bitmapIm); } ]]&gt; &lt;/mx:Script&gt; &lt;mx:Image source="" id="itemIm" maxWidth="100" maxHeight="100" horizontalAlign="left" verticalAlign="top"/&gt;</code> <br></code> <br>  This solution has one significant drawback: when downloading large-sized photos, the browser significantly loads the processor.  Perhaps there is a more optimal way, but I did not find it. <br><br>  ps Link to a working example, do not consider an advertisement, a local project and designed for a different audience.  <a href="https://cifromig.ru/programma_2.html%3FphotoPrint%3Dtrue">Example</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/139492/">https://habr.com/ru/post/139492/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139479/index.html">Nette PHP Framework: first acquaintance</a></li>
<li><a href="../139480/index.html">Non-standard use of the browser, or thanks, Mozilla, for the 3d-future</a></li>
<li><a href="../139484/index.html">Understanding and creation through research and intuition</a></li>
<li><a href="../139486/index.html">Ways to personalize direct mail</a></li>
<li><a href="../139491/index.html">Live Broadcast "IT Camps or Clouds Without Bla-Bla-Bla!"</a></li>
<li><a href="../139493/index.html">Flash Number Mathematics with Twinning DisplayObject</a></li>
<li><a href="../139495/index.html">Windows 8 Camp - as it were</a></li>
<li><a href="../139496/index.html">lancelist.0fees.net - a site for finding freelance work on Twitter</a></li>
<li><a href="../139497/index.html">We color the Windows console under Khokhloma</a></li>
<li><a href="../139498/index.html">Remart: how I created my business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>