<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RubyConf 2010: the present and the future of Ruby (I)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I suggest you read the translation of the second part of Ruby‚Äôs author‚Äôs report, Yukihiro Matsumoto, on RubyConf 2010, published in his blog in Japane...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RubyConf 2010: the present and the future of Ruby (I)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/bf392c1b/c276887e/6acecc3e/e6ec804f.png" align="left">  <i>I suggest you read the translation of the second part of Ruby‚Äôs author‚Äôs report, Yukihiro Matsumoto, on RubyConf 2010, published in his <a href="http://www.rubyist.net/~matz/">blog</a> in Japanese.</i>  <i>The first part is a brief historical overview of previous RubyConf conferences and is of no interest to the publication.</i> <i><br><br></i>  <i>For assistance in translating from Japanese, many thanks to <a href="http://sadko.xskernel.org/">Vladimir Sadovnikov</a> .</i> <br><a name="habracut"></a><br><h4>  Future Ruby: Ruby 2.0 </h4><br>  This time I will introduce several new features that will be in Ruby: <br><ul><li>  Types ( <a href="http://en.wikipedia.org/wiki/Trait_(computer_science)">traits</a> ) <sup>1</sup> </li><li>  Combinations of methods </li><li>  Named Arguments </li><li>  Namespaces </li></ul><br>  I am quite sure that so far this has not been the case.  The difference is that: <br><ul><li>  These functions are not just ideas that can one day be realized.  So it was necessary to do from the very beginning. </li><li>  The corresponding code is already committed to the trunk. </li></ul><br>  <sup>1</sup> Comment  Lane: for non-trivial technical terms, I will give an English name in brackets and a link to Wikipedia. <br><br><h5>  Types </h5><br>  Definition of types: <br><blockquote>  Description is a collection of methods used as ‚Äúa simple conceptual model for structuring object-oriented programs.‚Äù <br>  from wikipedia (eng.) <br></blockquote><br>  It looks almost the same as the module.  In essence, the new language element - type - is a subspecies of the module. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, in order to present the functionality of a module in a different way, types implement impurities (mixins) using a method other than including (other modules ‚Äî here and hereinafter in square brackets).  trans.].  Since this method is more flexible, the possibility of including modules has been removed completely. <br><br>  Problems with the inclusion are: <br><ul><li>  Name conflicts are not detected. </li><li>  Modules start to function incorrectly if their order changes. </li><li>  After wrapping a method with another module, you cannot access the original method. </li></ul><br>  When inclusion is used to simulate multiple inheritance, some difficult to predict situations arise. <br><br>  One of them is that the inclusion of a module containing a method that is already defined in the current context may have completely different goals and consequences: [intentional] overlapping an already defined method, random coincidence (name conflict), or both are actually required method, and their names must be unique. <br><br>  Another problem is that the order of inheritance of modules and, accordingly, the sequence of finding methods when matching names can often be counterintuitive. <br><br><pre><code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">American</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Japanese</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JapaneseAmerican</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">American</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">include</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Japanese</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JapaneseAmerican</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># which address? p JapaneseAmerican.ancestors # =&gt; [JapaneseAmerican, Japanese, American, Object, Kernel]</span></span></span></span></code> </pre> <br>  In this example, the address attribute method is contained in both the American and Japanese modules, overlapping at the request of the developer or accidentally due to their lack of knowledge of the language.  As a result, the methods will be called simply in the sequence corresponding to the order of inheritance. <br><br>  A ‚Äúwell-trained‚Äù Ruby programmer [Rubyist], looking at this code, will of course understand that the address method from the Japanese module will be called. <br><br>  Currently, Ruby [MRI 1.9] uses the paradigm ‚Äúthe module should not be inherited twice, even if the parent class already includes this module‚Äù (author's note: it looks like MacRuby did the same. In 1.9 there was an attempt to change this, but for YARV work requires that the module does not appear among the ancestors twice.).  So if you include a module in a class whose parent class already includes this module, it will not appear among ancestors where you expect it. <br><br>  In addition, since the inclusion of modules adds to the ancestors of the current class all the modules included in this module, and after that they can no longer be included in a place specific to this class.  In the end, the inclusion of modules makes the order of inheritance much more confusing. <br><br>  These problems (in part) are solved by the method of mixing (mix). <br><br>  Why mixing?  Because: <br><ul><li>  Class methods are defined in the current module / include module. </li><li>  When enabled, the module does not become an ancestor. </li><li>  The matching of method names throws an exception. </li><li>  If the inclusion of a module with matching method names is still necessary, they can be renamed. </li><li>  Constants can be included or not included (by default they are not included). </li></ul><br>  Thus, mixing is implemented as follows: <br><ul><li>  Attempting to add a duplicate method will cause an error, because the conflict cannot be automatically resolved. </li><li>  Method names can be changed by specifying this explicitly. </li><li>  Modules are still included in the inheritance chain in a strange way.  (This problem has not been solved, good luck. * Grin *) </li></ul><br>  For example, in this code there are methods with the same name, and therefore mixing will not work: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">American</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Japanese</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attr_accessor</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JapaneseAmerican</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mix</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">American</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mix</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Japanese</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; address conflict! end</span></span></span></span></code> </pre><br>  In order for the mix to work, you need to explicitly resolve name conflicts: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JapaneseAmerican</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mix</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">American</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> =&gt; :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">us_address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mix</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Japanese</span></span></span><span class="hljs-class">, :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> =&gt; :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jp_address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Now the methods that were called the same got different names. <br><br>  You may ask why, instead of complicating the language, not to add the ability to pass the parameters of the inclusion to the include method?  Because the shorter name of the method means that it is preferable to use.  (comment re: that is why all introspective methods that can potentially make code difficult to understand have detailed names like ‚Äúinstance_variable_defined?‚Äù). <br><br>  Nakada [probably, Nobuyoshi Nakada, one of the Ruby core developers] has already started developing the types needed to implement the mix method at the time of announcing this feature on RubyKaigi [Japanese Ruby Conference], so the patch is ready. <br><br>  However, various presentations do not address the following problems, which still need to be resolved: <br><ul><li>  [In this place there were two points that I could not translate.  Excuse me.] </li><li>  There are no ways to resolve conflicts among class member variables.  Since the member variables of the child classes are added imperceptibly to the parent, when implementing a class that mixes with the module, you will have to take into account undesirable names for the member variables and avoid them.  There is a patch for 1.9, which makes member variables like @_foo or @__foo closed, but in the current situation it is difficult to understand exactly how this should be implemented, or it may be necessary to abandon this function altogether.  This problem will have to be given more attention after the introduction of mixing. </li></ul><br><h5>  Combinations of methods </h5><br>  On RubyKaigi, mixing was part of a story about method combinations, but later it turned out that one of the parts of the story, related to the ability to ‚Äúwrap‚Äù the method with calls to other methods, turned out to be the most non-trivial, and I singled out it separately. <br><br>  The proposal is to introduce the prepend method.  I already hear the question "Do we already have include and mix, what, is another method now needed?", And I believe that it is really necessary. <br><br>  This method allows you to add another method "before" the current class to add any functions. <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">before</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">super</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">after</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bar</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> :</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prepend</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Bar</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># :before, :foo, :after</span></span></span></span></code> </pre><br>  If the foo method is defined in the Foo module, and it is also defined in the current class (or module), then prepend wraps the foo method call of the current class using the module's foo method. <br><br>  The idea of ‚Äã‚Äãthe prepend method comes from Yehuda Katz, who is also a Rails developer;  he thinks it would be great to replace them with alias_method_chain in Rails, and I agree with him. <br><br>  There is no concrete implementation of this possibility yet, but the easiest way to add the T_ICLASS object to the inheritance chain.  From this it is possible to begin. <br><br><h5>  Named Arguments </h5><br>  People tend to forget the purpose of the arguments, and especially the optional ones.  For example, the public_instance_methods method takes an optional argument, which means ‚Äúif false is returned, then return the methods and parent class too,‚Äù or vice versa, I always forget it.  (Actually, true.) <br><br>  For example, <br><pre> <code class="ruby hljs">aClass.public_instance_methods (<span class="hljs-symbol"><span class="hljs-symbol">include_super:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>)</code> </pre><br>  So much easier to remember. <br><br>  In Ruby 1.9, named arguments are simply the last argument with the hash as the default value, and the grammar extension with which this hash is initialized.  (comment perev .: few people know that in 1.9 you can make a method like <code>def a(opts={}); end</code> and call it as <code>a(go: true, what: "string")</code> . <br><br>  New feature 2.0 is a simple way to specify such an entry when defining a method.  For example: <br><br>  Call: <br><pre> <code class="ruby hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>.step (<span class="hljs-symbol"><span class="hljs-symbol">by:</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">to:</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|i|</span></span> pi <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  Called method: <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">step</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">by:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> step, </span></span><span class="hljs-symbol"><span class="hljs-function"><span class="hljs-params"><span class="hljs-symbol">to:</span></span></span></span><span class="hljs-function"><span class="hljs-params"> limit)</span></span></span></span> ... <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  After the [community] has accepted the call with the hash, the addition of the named arguments will, in effect, be a slight change. <br><br><h5>  Namespaces </h5><br>  If you are interested in technical details, you should take a look at <a href="http://www.slideshare.net/ShugoMaeda/rc2010-refinements">the</a> Shugo Maeda <a href="http://www.slideshare.net/ShugoMaeda/rc2010-refinements">presentation</a> , which was also on RubyConf. <br><br>  Ruby classes are public.  This means that at any time you can add a method to an existing class.  This class change technique is called ‚Äúmonkey patching‚Äù. <br><br>  It seems to me that this term was generated by the chain ‚Äúguerilla patching‚Äù [guerilla - partisan] -&gt; ‚Äúpatching gorilla‚Äù -&gt; ‚Äúmonkey patching‚Äù.  Of course, if in a language like Ruby, changing classes is easy, then I‚Äôm sure that this feature should be provided.  That is why the DHH report [David Heinemeier Hanson, author of Rails] "The future without monkey patching" I call the "Future without freedom of change."  [here was a quote from Mel Gibson, but my brain parser did not master it]. <br><br>  On the one hand, freedom is good, but on the other, it can have too much influence.  Of course, you can override the addition for integers so that 1 + 2 is equal to 42, but most of the programs will stop working due to side effects. <br><br>  The problem is that all such changes act globally, on the entire program.  By placing changes in a closed scope, you can get a convenient and secure method of ‚Äúfree changes‚Äù [freedom of patching]. <br><br>  Such a ‚Äúscope‚Äù could be the previously proposed Selector Namespace Classbox;  This time, the Selector Namespace, implemented by Maeda‚Äôs colleague, can be called a ‚ÄúRefinement‚Äù. <br><br>  For example, here is the program: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> / (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> 1 / 2 </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; (1 / 2)</span></span></span></span></code> </pre><br>  Such a redefinition of the division operator (/) in order to return the result in the form of a rational fraction (note: in this case, an object of the Rational class is returned) is part of the standard mathn library.  However, code that expects integer division to also result in an integer may fail due to such a change. <br><br>  In this study, it is proposed to introduce clarifications (the name may change).  A grammar might look like this: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathN</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">refine</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Integer</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">do</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> / (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">quo</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">other</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> 1 / 2 </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; (1 / 2) end p 1 / 2 # =&gt; 0</span></span></span></span></code> </pre><br>  Refinement is used as part of the module.  Module.  This is a great achievement. <br><br>  Within the module, existing classes can be refined, and such changes will be visible only within the namespace.  Thus, inside the module MathN 1/2 returns Rational (1/2), and outside the module the usual quotient. <br><br>  The difference between the clarifications and the classbox is that, despite the fact that the lexical scope has already ended, the clarification is still in action;  for the same reason, many programming languages ‚Äã‚Äãuse dynamic scope.  Of course, the clarifications should work imperatively, not lexically. <br><br>  The namespace is a module using the using method: <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Rationalize</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">using</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MathN</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">p</span></span></span><span class="hljs-class"> 1 / 2 </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># =&gt; (1 / 2) end p 1 / 2 # =&gt; 0</span></span></span></span></code> </pre><br>  In the Rationalize module, the update defined in MathN is also available. <br><br>  In addition, if a method is meaningless to define as a class method, then it can be defined inside another method.  Within the method, this will work in the same way as the clarification: this way the method can be made completely closed.  (Note: In Ruby 1.9, the method defined in this way becomes a member method of the class, that is, nesting has no meaning.) <br><pre> <code class="ruby hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">foo</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">def</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bar</span></span></span><span class="hljs-class"> ... </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bar</span></span></span><span class="hljs-class"> </span><span class="hljs-comment"><span class="hljs-class"><span class="hljs-comment"># works end def quux bar # does not work end end</span></span></span></span></code> </pre><br>  This change that Maeda is working on is quite large and complex;  however, the changes are quickly integrated into the main trunk [trunk], but for now, you can applaud your Maeda colleague for this great patch. <br><br>  <i>PS This translation was far from simple, and I know that many phrases will drive any cryptolinguist crazy, but my conscience did not allow me to pull out from the text only those arbitrary parts that were the easiest to translate.</i>  <i>I hope that most of the interesting things will be clear from the few surviving comments and the source code.</i>  <i>And I promise that the translation of the next part will be much clearer.</i> </div><p>Source: <a href="https://habr.com/ru/post/113635/">https://habr.com/ru/post/113635/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113628/index.html">Analyze it, or why I am late every day and get a bonus</a></li>
<li><a href="../113630/index.html">Unusual keyboard Vodafone Webbox</a></li>
<li><a href="../113631/index.html">Hosting.UA and another problem</a></li>
<li><a href="../113632/index.html">Biglion cheats ?!</a></li>
<li><a href="../113634/index.html">Live prototyping of applications on Titanium using Livetanium</a></li>
<li><a href="../113636/index.html">We automate the layout of django-projects on the server</a></li>
<li><a href="../113638/index.html">Test the environment for testing: MS Visual Studio Test Professional 2010</a></li>
<li><a href="../113640/index.html">How to start developing business processes</a></li>
<li><a href="../113642/index.html">Fast multiplication of polynomials using Fourier transform is just</a></li>
<li><a href="../113646/index.html">Sony has received permission to examine information on the hard disk from a PC hacker GeoHot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>