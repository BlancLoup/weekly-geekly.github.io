<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we developed the integration of an online store with 1C: Enterprise and why it became popular. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will continue the story on the integration of online stores with back office and the approach to their solution in our implementation of the integra...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we developed the integration of an online store with 1C: Enterprise and why it became popular. Part 2</h1><div class="post__text post__text-html js-mediator-article">  I will continue the story on the integration of online stores with back office and the approach to their solution in our implementation of the integration of 1C: Bitrix online store with 1C: Trade management. <br><br>  In the <a href="http://habrahabr.ru/company/bitrix/blog/129156/">first post</a> on this topic, we talked about how the tasks faced by the owners of online stores were analyzed, the concept of data exchange was selected and the exchange protocol between 1C and the online store was developed. <br><br>  In the continuation of the topic, I would like to tell in more detail how the exchange and its configuration look like as a result, both from the back office 1C and from the Internet site.  And also show how problems were solved to optimize work with large amounts of data. <br><a name="habracut"></a><br>  I recall that in general, the following integration scheme was chosen: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) Site and 1C work independently and exchange data in CommerceML format <br>  2) The site does not have direct access to 1C <br>  3) 1C regularly accesses the public script on the site, giving or accepting data <br>  3) The initiator of the exchange and connection is always 1C. <br><br>  Consider the implementation of this concept in practice. <br><br>  So, as I said earlier, the ‚Äú1C: Trade Management‚Äù configuration includes a specialized module for exchanging data with sites.  This is a universal module, working according to the protocol described in the previous post and using the CommerceML format. <br><br>  The module is in the standard 1C: Trade management for both version 10.3 and version 11 (platform 8.2).  In addition to 1C: Trade management, exchange functionality with sites also exists in other configurations, including localized ones.  We have brought information about the support of the exchange functionality with sites in 1C configurations into a special table - <a href="http://1c.1c-bitrix.ru/ecommerce/require_1C.php">1c.1c-bitrix.ru/ecommerce/require_1C.php</a> . <br><br>  Consider the functionality of the module, part of the 1C: Trade Management 11. <br><br><img src="https://habrastorage.org/storage1/a8e7cb5d/3e57f215/472c1a9c/b3c464af.png"><br><br>  The first tab of the interface module contains the basic interaction settings. <br><br>  The <b>Data exchange mode</b> section allows you to specify which exchange mode will be used in this profile.  Or, more simply, what business problem will be solved in an exchange session: unloading goods, exchanging orders, or both. <br><br>  In the section <b>Assignment</b> , the parameters of the site with which the exchange will be made are indicated: the URL of the exchange script, the account that is allowed to be exchanged.  You can immediately check the success of the connection. <br><br>  <b>Change control</b> allows you to use internal 1C journals, which record changes in objects related to the exchange with the site and include only those data that have been modified in 1C since the previous exchange session.  Of course, this reduces the amount of data, reduces the load on 1C and on the server of the online store. <br><br>  In the <b>Automatic exchange</b> section, you can very flexibly set a schedule according to which the exchange functionality will be launched automatically, without user intervention. <br><br>  Let us consider in more detail the solution of the first integration problem - <h4>  Unloading goods (nomenclature directory) from 1C to the website of an online store </h4><br>  For this, it is necessary to put the option ‚ÄúUnload goods‚Äù in the exchange mode, as a result of which the tab with the same name will be available: <br><br><img src="https://habrastorage.org/storage1/5d2ebdd4/7f28ec13/28f8ce3a/8f39c243.png"><br><br><h5>  The choice of products for unloading and setting unloading in 1C </h5><br>  The main and most important section here is the <b>directory table</b> , which allows you to create what will be uploaded to the site. <br><br>  In the ‚Äúdefault‚Äù variant, the entire directory of the nomenclature is unloaded as it is: all groups and all products, without any restrictions.  Of course, this option will not please everyone, and a flexible choice is available - what exactly and under what conditions should be uploaded to the site. <br><br><img src="https://habrastorage.org/storage1/15dffa61/54697fe1/be2b62b5/14486425.png"><br><br>  For example, you can select groups and subgroups of the catalog, unload goods with non-zero residues, with certain types of prices (retail, wholesale, dealer), from specific warehouses and the like. <br><br>  Further, by default, all products are uploaded to the XML file in a single directory (&lt;Directory&gt; tag).  Each catalog has its own classifier, including the structure of groups and subgroups for products, as well as properties for all products in this catalog. <br><br>  If different types of products with their own group tree and their own set of properties (characteristics) are uploaded to the site, then each such type is recommended to be downloaded to a separate directory.  So, in the system 1C-Bitrix: Site Management, this will lead to the fact that each directory will be uploaded to a separate information block, which has its own groups, properties, rights, settings, etc.  As a result, you can make a different presentation in the online store for different types of products: hierarchy, filter by properties, product comparison, etc. <br><br>  Directory settings in this case will be something like this: <br><br><img src="https://habrastorage.org/storage1/34513b1b/fd986024/15795acd/2505fa0e.png"><br><br>  There is another possibility of forming a catalog structure that is uploaded to the site - the use of types of nomenclature.  Types of nomenclature is essentially an alternative category heading for the types of goods.  If the structure of the nomenclature directory groups is not suitable for setting up uploads to the site, then you can create item types, attach products to them and upload them to the site using a new rubricator. <br><br>  Putting the checkboxes ‚ÄúUpload image files‚Äù and ‚ÄúUpload other files‚Äù makes sense, if 1C has high-quality product descriptions, images, related files (instructions, etc.).  Many owners of online stores do not store in 1C descriptions of goods, properties, quality descriptions.  In 1C, they are not so necessary for them, and the site usually has an HTML editor for descriptions, and various utilities for image processing, watermarking.  In addition, it is more convenient to organize remote work of content editors when working with a website than to let them inside 1C.  And, nevertheless, there are those who prefer to keep the entire narrative in one place - in 1C, and use the site as a visualization tool.  There is another task - when the same goods are uploaded to several online stores at the same time.  Then it is better to make descriptions in 1C once, and then automatically unload them into several sites. <br><br>  Which directory management model to choose is the end user decides.  The main thing is that the integration functionality allows it. <br><br><h5>  Unloading process </h5><br>  If you now start the upload (click the "Execute data exchange" button), then 1C begins to prepare the unloaded data. <br><br>  2 files are generated: import.xml and offers.xml (for each catalog being uploaded).  The first file contains information about the product catalog (structure, products, properties), and the second - trade offers for this product.  If one product has options depending on characteristics (color, size, etc.), then all of them will be offers in the offers file.  Details are in CommerceML 2.04 standard. <br><br>  If images or files are associated with products, they are located in the import_files subfolder, and data from XML refers to them. <br><br>  For example, 2 product catalogs from 1C were unloaded: <br><br><img src="https://habrastorage.org/storage1/8c8ebb86/88edc660/ed42dba6/eea467dd.png"><br><br>  Now you need to transfer these files to the server.  In the exchange protocol (see Part 1) there is a special mode for this: http: // &lt;website&gt; /bitrix/admin/1c_exchange.php?type=catalog&amp;mode=file&amp;filename= &lt;file name&gt;. <br><br>  If the amount of data is large (initial unloading of a large reference book of the nomenclature occurs), then of course I would like to optimize the transfer of files. <br><br>  Firstly, <b>ZIP compression is used</b> .  As we remember, before starting the file transfer, 1C requests the exchange parameters from the site, among which there is a flag supporting ZIP compression.  All files are packaged and one zip-archive is obtained, which is sent to the site.  If compression is not supported, all files from the folder (including images) are sent sequentially. <br><br>  Secondly, many hosting providers limit the amount of data transmitted by a POST request.  And even a zip-archive can easily fail if it is tens of megabytes.  In this case, <b>1C can break up the downloaded files into chunks</b> , if their size exceeds the maximum allowed.  On the side of the site, numbered portions are received and then assembled back into a single file.  The maximum size of a portion of the data 1C also receives from the site in exchange initialization mode. <br><br>  Now the received files need to be processed on the site side and loaded into the site database. <br><br>  There is also a moment of hosting restrictions.  Processing (parsing XML and loading into the database) is done by a PHP script, the time of which is usually limited.  Of course, at the beginning of the script is set_time_limit (0), but it does not work everywhere.  Therefore, in the settings 1C-Bitrix, you can specify the maximum time that the script can work out - by default 30 seconds.  Then, when this limit is reached, the script will reload and continue importing from the previous position in the file. <br><br>  In addition, the import script can compare the checksums of the XML description of the goods in the file being processed with the checksum of this product in the database since the previous download.  If the checksums match, then the product is skipped and not updated.  This is necessary for those cases when the catalog is already uploaded to the site, and full upload is still done from 1C.  Then the data import will be performed significantly faster. <br>  Of course, it is always recommended to set up only the changed positions in 1C, then full unloading will be done only 1 time, and then small portions of data will go, which will be uploaded to the site very quickly. <br><br><h5>  Data import settings on the site side </h5><br>  The import parameters of the catalog from 1C are configured in 1C-Bitrix in the administrative part on the special page "Integration with 1C" <br><br><img src="https://habrastorage.org/storage1/d92c28e9/fecc1258/91f15eea/9d8bfd73.png"><br><br>  I will not go further into the details of import settings, of which there are many: image processing, CNC generation for products, data processing that are not in the import file, but are available on the site, and the like.  In general, catalogs from 1C are most fully reflected in the catalogs on the site. <br><br>  Unloaded: <br><ul><li>  Directory group structure </li><li>  List of products group </li><li>  Properties of goods (numeric, string, type ‚Äúlist‚Äù, date-time, boolean) </li><li>  Product Description (including HTML description) </li><li>  Related Images and Files </li><li>  Price set (retail, wholesale, dealer, etc.) </li><li>  Remains in warehouses </li><li>  A set of proposals for the goods, differing characteristics </li></ul><br>  Due to optimization mechanisms, the issue of initial unloading and processing of large amounts of data is solved.  The mode of unloading only the changed positions in 1C, allows almost not to think about the load for subsequent exchange sessions. <br><br>  I would also like to say that in 1C profiles of settings for uploading goods to the site can be many.  They form the so-called exchange nodes: <br><br><img src="https://habrastorage.org/storage1/99bd5d62/8cf4295e/c20828a1/3a8ec45f.png"><br><br>  This gives even greater flexibility, because, for example, you can update different categories of goods at different times, upload products to different sites and different CMS systems, etc.  In addition, at different times, not related to the unloading of goods, you can also exchange orders: for example, take orders from the site every 5 minutes. <br><br>  But I will tell you about the exchange of orders in the third and final part. </div><p>Source: <a href="https://habr.com/ru/post/131344/">https://habr.com/ru/post/131344/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131337/index.html">Home Digital Television</a></li>
<li><a href="../131338/index.html">The attack on the free Internet in Ukraine: the Law of Ukraine "On the protection of public morality"</a></li>
<li><a href="../131341/index.html">Google Maps API: Now For Money</a></li>
<li><a href="../131342/index.html">The method of html-layout of buttons using pseudo-elements</a></li>
<li><a href="../131343/index.html">REST vs SOAP. Part 1. Feel the difference</a></li>
<li><a href="../131345/index.html">I seek advice and possibly help</a></li>
<li><a href="../131348/index.html">Steam and Russian support</a></li>
<li><a href="../131351/index.html">Google Street View shows interiors</a></li>
<li><a href="../131352/index.html">The truth is somewhere near</a></li>
<li><a href="../131353/index.html">Alert in QA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>