<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TvOS application development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, Russian users who ordered the Apple TV console on the official website, finally began to receive long-awaited devices. 

 As you know, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TvOS application development</h1><div class="post__text post__text-html js-mediator-article">  The other day, Russian users who ordered the Apple TV console on the official website, finally began to receive long-awaited devices. <br><br>  As you know, in the new generation of consoles debuts the App Store with third-party applications.  The first Russian reviews with sadness noted that there <b>are</b> not so many applications in the domestic market <b>yet</b> <i>(and this must somehow be corrected!)</i> .  However, among them is the Rutube app.  In this article we will share a little experience that <a href="http://habrahabr.ru/users/igor-petrov/" class="user_link">igor-petrov</a> and <a href="http://habrahabr.ru/users/juraldinio/" class="user_link">Juraldinio</a> managed to acquire during its development. <br><a name="habracut"></a><br><h2>  About tvOS platform </h2><br>  The new Apple TV (tvOS) platform is a derivative of iOS and has some unique features.  In particular, it is possible for tvOS to port an existing iOS application written in Objective-C / Swift (according to the <a href="https://developer.apple.com/tvos/human-interface-guidelines/">recommendations for interface implementation</a> ), and to create an application on a new technology stack - TVML and TVJS, connected using the TVMLKit framework.  This new stack is positioned as a good choice for simple and fast development of client-server applications <i>(ideally for video!)</i> , Which is confirmed in practice.  It is about TVML and TVJS that will be discussed below. <br><br><h2>  TVMLKit </h2><br>  TVMLKit is a framework for Objective-C / Swift.  Using it, control of the application is transferred to the JavaScript file and the TVML + TVJS environment.  Details are available on the <a href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLKit/Reference/TVMLKit_Collection/">TVMLKit documentation page</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  TVML </h2><br>  TVML (Television Markup Language) is a subset of XML that implements tvOS markup and standard interface elements.  This interface is used not only for applications - it implements all tvOS pages: home screen, settings screen, and the App Store itself. <br><br>  For example, the TVML button looks like this: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span>Hello world!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">text</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And so the button looks on the screen: <br><br><img src="https://habrastorage.org/files/4ee/111/196/4ee111196e0945f1b638169f2953484a.jpg"><br><br>  And this is the device‚Äôs home screen, which consists of TVML elements: <br><br><img src="https://habrastorage.org/files/66e/382/7ab/66e3827ab0a748f59ea87d243956e318.jpg"><br>  tvOS provides a set of ready-made elements, a full list of which is available in <a href="https://developer.apple.com/library/prerelease/tvos/documentation/LanguagesUtilities/Conceptual/ATV_Template_Guide/index.html">the TVML documentation</a> . <br><br>  These elements are divided into: <br><br><ul><li>  <i>Simple elements</i> are simple elements consisting of a single tag, for example, text or title; </li><li>  <i>Compound elements</i> are composite elements that may include simple elements.  For example, the banner element may contain a simple title element; </li><li>  <i>Templates</i> - page display templates.  Set the overall structure of the display elements and may include composite elements. </li></ul><br>  In addition, elements can be given attributes and styles, such as <i>width</i> and <i>src</i> . <br><br>  At the same time there are limitations - certain types of constituent elements can contain only certain types of simple elements, the same applies to templates.  In general, the structure of the elements seemed rather confusing - each time I had to look in the directory to understand where which element could be used. <br><br>  From the general list of templates, <i>divTemplate is</i> worth highlighting, which allows you to construct your own layout, if you are not satisfied with any other proposed one. <br><br>  There is no opportunity to create your own elements, you can only combine existing ones. <br><br>  Moreover, you need to make sure that when parsing the lines in the XML, an invalid TVML does not come across.  <i>For example, the response of our API could contain HTML tags, which caused an error.</i> <br><br>  TVML markup can be dynamically added to a page using JavaScript and TVJS. <br><br><h2>  Tvjs </h2><br>  TVJS is a JavaScript framework that provides an API for working with TVML.  Conventionally, it can be divided into two parts: <br><br><ul><li>  Standard <a href="https://developer.mozilla.org/fr/docs/DOM_Levels">DOM Level 3</a> API for working with DOM elements, for example, the DOMParser constructor for parsing a string into an XML document (TVML); </li><li>  Native tvOS methods and constructors, for example, a NavigationDocument object that manages a stack of rendered pages and is used as a navigation through history. </li></ul><br>  Each of its own methods is described in <a href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLJS/Reference/TVJSFrameworkReference/index.html">the TVJS documentation</a> .  The rest is the usual JavaScript.  ECMAScript 2015 is partially supported, for example, classes and template strings. <br><br>  Arrow functions, constants are not supported.  In this case, some third-party libraries may be inoperable.  For example, I had to search several npm packages to find a working library for AJAX requests <i>(due to calls to window.XMLHttpRequest, which in tvOS is <em>not</em> implemented as a window property)</i> .  Of course, it would be easier to write a few lines of code on your own, but at some point it became a matter of principle - to find a plug-in working from the box, and it exists! <br><br><h2>  Debugging </h2><br>  You can use Safari to debug JavaScript code.  Activate the menu "Develop" ( <em>Preferences -&gt; Advanced -&gt; Show Develop menu</em> ), connect the Apple TV via USB.  Go to the browser and, running the application on the console, select the ‚ÄúApple TV‚Äù device in the drop-down menu ‚ÄúDevelop‚Äù, and then select our application. <br><br><h2>  Hello world and the launch of the video </h2><br>  Further a small example of how the application for tvOS can look. <br><br>  First you need to implement the loading of a JavaScript file.  The task is to create an object of the TVApplicationController class, providing an interface for using TVML: <br><br><div class="spoiler">  <b class="spoiler_title">Show code</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">func application(application: UIApplication, didFinishLaunchingWithOptions launchOptions: [NSObject: AnyObject]?) -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { //  <span class="hljs-keyword"><span class="hljs-keyword">window</span></span> <span class="hljs-keyword"><span class="hljs-keyword">window</span></span> = UIWindow(frame: UIScreen.mainScreen().bounds) // ,      TVApplicationController let appContollerContext = TVApplicationControllerContext() #<span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEBUG</span></span> //       let tvBaseUrl = "http://192.168.xx.xx/" let tvBootUrl = "\(tvBaseUrl)js/main.js" guard let javaScriptUrl = NSURL(string: tvBootUrl) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { fatalError("Unable create js application url") } //   js-,     appContollerContext.javaScriptApplicationURL = javaScriptUrl //  ,   BASE    appContollerContext.launchOptions["BASEURL"] = tvBaseUrl; #<span class="hljs-keyword"><span class="hljs-keyword">else</span></span> //    js-   bundle  appContollerContext.javaScriptApplicationURL = NSBundle.mainBundle().URLForResource("application", withExtension:"js")! #endif //      js- appController = TVApplicationController(context:appContollerContext, <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">window</span></span>, delegate: self) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }</code> </pre><br></div></div><br>  After management passed to a JavaScript file, it is possible to start implementation of logic.  Content main.js: <br><br><pre> <code class="javascript hljs">App.onLaunch = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span>); }</code> </pre><br>  This demonstrates the TVJS App method.  onLauch is the entry point of the application. <br><br>  Let's try to do something more complicated: <br><br><pre> <code class="javascript hljs">App.onLaunch = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alertString, alertXML, parser; <span class="hljs-comment"><span class="hljs-comment">//   TVML- alertString = [ '&lt;document&gt;', '&lt;alertTemplate&gt;', '&lt;title&gt;Hello World!&lt;/title&gt;', '&lt;button&gt;', '&lt;text&gt;OK&lt;/text&gt;', '&lt;/button&gt;', '&lt;/alertTemplate&gt;', '&lt;/document&gt;' ].join(''); //   DOMParser parser = new DOMParser(); //  XML-   alertXML = parser.parseFromString(alertString, 'application/xml'); //  XML-   navigationDocument.pushDocument(alertXML); }</span></span></code> </pre><br>  This example demonstrates the DOMParser constructor, with which the string is converted to an XML document. <br><br>  Using the TVJS method of <i>navigationDocument.pushDocument ()</i> , you can display the resulting document on the page.  At the same time, the new page will be written into the <i>navigationDocument.documents</i> array, which can be used to navigate the history.  In this case, when you start the application, the page will contain the inscription ‚ÄúHello world‚Äù and the ‚ÄúOK‚Äù button. <br><br>  Before inserting an XML document, you can add a custom event handler to the page: <br><br><pre> <code class="javascript hljs">... <span class="hljs-comment"><span class="hljs-comment">//     (  ) alertXML.addEventListener('select', function () { var player, mediaItem; //   MediaItem mediaItem = new MediaItem('video', 'http://example.org/path/to.m3u8'); //    player = new Player(); //   Playlist player.playlist = new Playlist(); //  mediaItem  playlist player.playlist.push(mediaItem); //    player.present(); //   player.play(); }); ...</span></span></code> </pre><br>  In the resulting example, the user-select event is hung on the element of the XML document ‚Äî a button ‚Äî and a video player is created and launched in the callback using the TVJS methods.  Now when you click on the "OK" button, the video playback will start. <br><br><div class="spoiler">  <b class="spoiler_title">Sample code entirely</b> <div class="spoiler_text"><pre> <code class="javascript hljs">App.onLaunch = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> alertString, alertXML, parser; <span class="hljs-comment"><span class="hljs-comment">//   TVML- alertString = [ '&lt;document&gt;', '&lt;alertTemplate&gt;', '&lt;title&gt;Hello World!&lt;/title&gt;', '&lt;button&gt;', '&lt;text&gt;OK&lt;/text&gt;', '&lt;/button&gt;', '&lt;/alertTemplate&gt;', '&lt;/document&gt;' ].join(''); //   DOMParser parser = new DOMParser(); //  XML-   alertXML = parser.parseFromString(alertString, 'application/xml'); //     (  ) alertXML.addEventListener('select', function () { var player, mediaItem; //   MediaItem mediaItem = new MediaItem('video', 'http://example.org/path/to.m3u8'); //    player = new Player(); //   Playlist player.playlist = new Playlist(); //  mediaItem   playlist  player.playlist.push(mediaItem); //    player.present(); //   player.play(); }); //  XML-   navigationDocument.pushDocument(alertXML); };</span></span></code> </pre><br></div></div><br>  Of course, this is a very simple example, but it fully reflects the general principle of working with TVML and TVJS and shows that this solution is not some <i>Wonderful Beast</i> , but a technology close to the classic frontend. <br><br><h2>  Finally </h2><br>  In conclusion, a few words about how the Rutube application is currently implemented. <br><br>  The code is written in CoffeeScript, Browserify is used as a modular loader.  XMLHttpRequest and the open-source Rutube API are used to retrieve data.  For video delivery, the HLS protocol is used. <br><br><div class="spoiler">  <b class="spoiler_title">Admire the main screen of the application</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1be/ab9/198/1beab919870544e29cbb4f353b1a22fd.jpg"><br></div></div><br>  In general, development on TVML and TVJS was pleasant - quickly and efficiently.  Although the application is created in a standardized interface, this interface looks very impressive.  At the same time, time is saved on layout and creation of visual effects, and there is no need to think about their performance. <br><br>  Of the minuses I would like to note the limitations in design.  Well, the implementation of the search (text input) seemed ambiguous.  <i>We do not even know whether to add it to the app without Siri?</i> <br><br>  The application has been written in a few days, but if you are inspired and start developing your own, put some time into the evaluation of unfamiliar APIs. <br><br>  In the future, a <a href="https://github.com/ramitos/react-tvml">plug-in for React</a> is expected to be released, which so far (November 2015) is in the status ‚Äúvery alpha‚Äù <br><br>  In the meantime, it should be noted that over the past week since the release, without straining, ‚Äúover a cup of tea‚Äù, we added to our application a certain amount of nice-looking gadgets and are preparing an update. <br><br><h2>  useful links </h2><br>  <a href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLKit/Reference/TVMLKit_Collection/">TVMLKit Documentation</a> <br>  <a href="https://developer.apple.com/library/prerelease/tvos/documentation/TVMLJS/Reference/TVJSFrameworkReference/index.html">TVJS Documentation</a> <br>  <a href="https://developer.apple.com/library/prerelease/tvos/documentation/LanguagesUtilities/Conceptual/ATV_Template_Guide/index.html">TVML documentation</a> <br>  <a href="http://www.raywenderlich.com/114886/beginning-tvos-development-with-tvml-tutorial">Beginning tvOS Development with TVML Tutorial</a> </div><p>Source: <a href="https://habr.com/ru/post/270381/">https://habr.com/ru/post/270381/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270369/index.html">Using websocket in Extjs applications</a></li>
<li><a href="../270371/index.html">Error Handling in Rust</a></li>
<li><a href="../270373/index.html">Impact analysis on the example of corporate data warehouse infrastructure</a></li>
<li><a href="../270377/index.html">Magento 2.0 Release Candidate Released</a></li>
<li><a href="../270379/index.html">Half a Century to "Universal Machine Languages" (1966‚Äì2016): Past, Present, Future</a></li>
<li><a href="../270383/index.html">Java Programmer Cheat Sheet 4. Java Stream API</a></li>
<li><a href="../270387/index.html">NSA recognized the possibility of using zero-day exploits for cyber attacks</a></li>
<li><a href="../270389/index.html">Font Lato: Sketch vs Android Studio</a></li>
<li><a href="../270391/index.html">Increase system fault tolerance by nodejs</a></li>
<li><a href="../270393/index.html">ZeroNights HackQuest 2015</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>