<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OpenOCD, ThreadX and your processor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This note may be useful for people who write bare-metal code and use ThreadX in their tasks (by choice or by imposing the SDK). The problem is that in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OpenOCD, ThreadX and your processor</h1><div class="post__text post__text-html js-mediator-article">  This note may be useful for people who write bare-metal code and use ThreadX in their tasks (by choice or by imposing the SDK).  The problem is that in order to effectively debug the code under ThreadX or another multi-threaded operating system, you need to be able to see these threads, to be able to see the stack-trace, the state of registers for each thread. <br><br>  OpenOCD ( <a href="http://openocd.sourceforge.net/">Open On Chip Debugger</a> ) <a href="http://openocd.sourceforge.net/doc/html/GDB-and-OpenOCD.html">declares support for ThreadX</a> , but does not explicitly <a href="http://openocd.sourceforge.net/doc/html/GDB-and-OpenOCD.html">state</a> its breadth.  And normally, at the time of this writing, in version 0.8.0, these are just two cores: Cortex M3 and Cortex R4.  I, by fate, had to work with a Cypress FX3 chip which is built on the basis of the ARM926E-JS core. <br><br>  Under the cat, consider what needs to be done to add support for your version of ThreadX for your CPU.  The emphasis is on ARM, but, theoretically, it may well be suitable for other processors.  In addition, the case is considered when access to the source code of ThreadX is not and is not expected. <br><a name="habracut"></a><br>  From the first lines immediately upset: no assembler anywhere.  No, we will not have to write on it, but to read the code - yes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with an introduction to the implementation of ThreadX support in OpenOCD.  This is just one file: <a href="">src / rtos / ThreadX.c</a> . <br><br>  The supported system is described by the structure <i>ThreadX_params</i> , which contains information about the name of the target, the ‚Äúwidth‚Äù of the pointer in bytes, a set of offsets in the <i>TX_THREAD</i> structure to the required service fields, as well as information about how the context of the thread is maintained when switching (so-called stacking info ).  The supported systems themselves are registered using the <i>ThreadX_params_list</i> array. <br><br>  With all the parameters except the last one, there are no problems: the width of the pointer is usually equal to the processor's width, the offsets are considered to be handles (and almost always they are unchanged). <br><br>  An interesting question: where to get information on stacking?  But there is a lot of information: <br><ul><li>  stack growth direction (well, it's easy) </li><li>  the number of registers in the system (this is also easy, we run on the existing version of OpenOCD info registers and count the number of lines). </li><li>  frame alignment on the stack, I got this value randomly, for Cortex M3 / R4 it is indicated 8 bytes, for ARM926E-JS - 0 (that is, without alignment).  In fact, alignment is at 4, but the memory allocated with <i>tx_byte_alloc () is</i> already aligned, and stack usage is always a multiple of 4. In general, try the values ‚Äã‚Äã0, 4, and so on. </li><li>  an array of offsets in the stack (relative to the current vertex) on which the values ‚Äã‚Äãof specific registers lie (the size of the array is equal to the number of registers in the output ‚Äúinfo registers‚Äù). </li></ul><br>  Here is the last and the most difficult and incomprehensible.  I can immediately convince - there is no standard approach here.  At random, it is extremely difficult, if not impossible, to pick up these values. <br><br>  Moreover, looking ahead, as it turned out, one stacking scheme is used for the Cortex M3 / R4 cores, and two for the ARM926E-JS!  All for the sake of economy. <br><br>  Briefly (as well as very rude and inaccurate) how the sheduler works in ThreadX: it also provides a cooperative and repressive approach to multitasking. <br><br>  The cooperative approach works for threads of the same priority which are not given a time slice (0).  Those.  if flow A and B have the same priority, flow A has started, then flow B will not receive control until A: <br><ul><li>  not complete </li><li>  will not cause a function that leads to a rescheduling (sleep, waiting on the queue, mutex, semaphore, etc.) </li></ul><br>  If the time slice is set, then at its completion the flow will be interrupted and control will be transferred to another next one in the Ready state (for the case when the thread falls asleep but has not developed its slice, the cooperative approach will also work).  The preemptive approach is already working here.  For his work need a timer and interrupt from it with a certain frequency.  Also, the flow A from the example above can be superseded by the flow B if its priority is higher. <br><br>  It is clear that the flow context is saved when it transfers control to someone and is restored when it receives control.  Let's understand how this happens - understand what needs to be described in the array of register offsets. <br><br>  I will not go into details, as I found out where and how the main parts of the scheduler were hidden, a lot was done here: savvy, luck, and Google, and disassembler.  But I will give the main components thereof: <br><ol><li>  <i>_tx_timer_interrupt ()</i> - the function is called from the context of the timer interruption, in fact, is responsible for the displacing part of the scheduler. </li><li>  <i>_tx_thread_context_save ()</i> (or <i>_tx_thread_vectored_context_save ()</i> ) and <i>_tx_thread_context_restore ()</i> are a pair of functions designed to be called from interrupts to save and restore the context.  When restoring the context, an attempt will be made to resolve. </li><li>  <i>_tx_thread_system_return ()</i> is part of the cooperative approach.  It is called at the end of any call chain that causes resolving. </li><li>  and, finally, <i>_tx_thread_schedule ()</i> is the most important function for analysis and, perhaps, the simplest of the above. </li></ol><br>  I studied the listings of all these functions, but if you need to tighten support for an unsupported processor again, I will focus on the last three.  But I will start with the latter, and only after that (if there is not enough information) I will study others. <br><br>  Let's look at its listing (I replaced some indirect addressing with real symbols, the symbols themselves <br>  look in the elf file using arm-none-eabi-nm): <br><pre><code class="hljs delphi"><span class="hljs-number"><span class="hljs-number">40004</span></span>c7c &lt;_tx_thread_schedule&gt;: <span class="hljs-number"><span class="hljs-number">40004</span></span>c7c: e10f2000 mrs r2, CPSR <span class="hljs-number"><span class="hljs-number">40004</span></span>c80: e3c20080 bic r0, r2, <span class="hljs-string"><span class="hljs-string">#128</span></span> ; <span class="hljs-number"><span class="hljs-number">0</span></span>x80 <span class="hljs-number"><span class="hljs-number">40004</span></span>c84: e12ff000 msr CPSR_fsxc, r0 <span class="hljs-number"><span class="hljs-number">40004</span></span>c88: e59f104c ldr r1, [pc, <span class="hljs-string"><span class="hljs-string">#76</span></span>] ; <span class="hljs-number"><span class="hljs-number">40004</span></span>cdc &lt;_tx_thread_schedule+<span class="hljs-number"><span class="hljs-number">0</span></span>x60&gt; <span class="hljs-number"><span class="hljs-number">40004</span></span>c8c: e5910000 ldr r0, [r1] <span class="hljs-number"><span class="hljs-number">40004</span></span>c90: e3500000 cmp r0, <span class="hljs-string"><span class="hljs-string">#0</span></span> <span class="hljs-number"><span class="hljs-number">40004</span></span>c94: <span class="hljs-number"><span class="hljs-number">0</span></span>afffffc beq <span class="hljs-number"><span class="hljs-number">40004</span></span>c8c &lt;_tx_thread_schedule+<span class="hljs-number"><span class="hljs-number">0</span></span>x10&gt; <span class="hljs-number"><span class="hljs-number">40004</span></span>c98: e12ff002 msr CPSR_fsxc, r2 <span class="hljs-number"><span class="hljs-number">40004</span></span>c9c: e59f103c ldr r1, [pc, <span class="hljs-string"><span class="hljs-string">#60</span></span>] ; <span class="hljs-number"><span class="hljs-number">40004</span></span>ce0 &lt;_tx_thread_schedule+<span class="hljs-number"><span class="hljs-number">0</span></span>x64&gt; <span class="hljs-number"><span class="hljs-number">40004</span></span>ca0: e5810000 str r0, [r1] <span class="hljs-number"><span class="hljs-number">40004</span></span>ca4: e5902004 ldr r2, [r0, <span class="hljs-string"><span class="hljs-string">#4</span></span>] <span class="hljs-number"><span class="hljs-number">40004</span></span>ca8: e5903018 ldr r3, [r0, <span class="hljs-string"><span class="hljs-string">#24</span></span>] <span class="hljs-number"><span class="hljs-number">40004</span></span>cac: e2822001 add r2, r2, <span class="hljs-string"><span class="hljs-string">#1</span></span> <span class="hljs-number"><span class="hljs-number">40004</span></span>cb0: e5802004 str r2, [r0, <span class="hljs-string"><span class="hljs-string">#4</span></span>] <span class="hljs-number"><span class="hljs-number">40004</span></span>cb4: e59f2028 ldr r2, [pc, <span class="hljs-string"><span class="hljs-string">#40</span></span>] ; <span class="hljs-number"><span class="hljs-number">40004</span></span>ce4 &lt;_tx_thread_schedule+<span class="hljs-number"><span class="hljs-number">0</span></span>x68&gt; <span class="hljs-number"><span class="hljs-number">40004</span></span>cb8: e590d008 ldr sp, [r0, <span class="hljs-string"><span class="hljs-string">#8</span></span>] <span class="hljs-number"><span class="hljs-number">40004</span></span>cbc: e5823000 str r3, [r2] <span class="hljs-number"><span class="hljs-number">40004</span></span>cc0: e8bd0003 pop <span class="hljs-comment"><span class="hljs-comment">{r0, r1}</span></span> <span class="hljs-number"><span class="hljs-number">40004</span></span>cc4: e3500000 cmp r0, <span class="hljs-string"><span class="hljs-string">#0</span></span> <span class="hljs-number"><span class="hljs-number">40004</span></span>cc8: <span class="hljs-number"><span class="hljs-number">116</span></span>ff001 msrne SPSR_fsxc, r1 <span class="hljs-number"><span class="hljs-number">40004</span></span>ccc: <span class="hljs-number"><span class="hljs-number">18</span></span>fddfff ldmne sp!, <span class="hljs-comment"><span class="hljs-comment">{r0, r1, r2, r3, r4, r5, r6, r7, r8, r9, sl, fp, ip, lr, pc}</span></span>^ <span class="hljs-number"><span class="hljs-number">40004</span></span>cd0: e8bd4ff0 pop <span class="hljs-comment"><span class="hljs-comment">{r4, r5, r6, r7, r8, r9, sl, fp, lr}</span></span> <span class="hljs-number"><span class="hljs-number">40004</span></span>cd4: e12ff001 msr CPSR_fsxc, r1 <span class="hljs-number"><span class="hljs-number">40004</span></span>cd8: e12fff1e bx lr <span class="hljs-number"><span class="hljs-number">40004</span></span>cdc: <span class="hljs-number"><span class="hljs-number">4004</span></span>b754 .word <span class="hljs-number"><span class="hljs-number">0</span></span>x4004b754 ; _tx_thread_execute_ptr <span class="hljs-number"><span class="hljs-number">40004</span></span>ce0: <span class="hljs-number"><span class="hljs-number">4004</span></span>b750 .word <span class="hljs-number"><span class="hljs-number">0</span></span>x4004b750 ; _tx_thread_current_ptr <span class="hljs-number"><span class="hljs-number">40004</span></span>ce4: <span class="hljs-number"><span class="hljs-number">4004</span></span>b778 .word <span class="hljs-number"><span class="hljs-number">0</span></span>x4004b778 ; _tx_timer_time_slice</code> </pre> <br>  The function is crazy: <br><ol><li>  allow interrupts (lines 40004c7c-40004c84) </li><li>  wait for someone to call <i>_tx_thread_execute_ptr</i> (40004c88-40004c94) - the next thread to execute </li><li>  disable interrupts, or rather, restore status register (40004c98) </li><li>  save the <i>_tx_thread_current_ptr</i> pointer to r0 (40004c9c-40004ca0) </li><li>  increase the value of <i>tx_thread_run_count of the</i> current thread by 1 (40004ca4, 40004cac-40004cb0) </li><li>  get the <i>tx_thread_time_slic</i> e value of the current thread and assign it to <i>_tx_timer_time_slice</i> (40004ca8, 40004cb4, 40004cbc) </li><li>  set a new pointer to the stack stored in the thread structure (read <i>tx_thread_stack_ptr</i> ) (40004cb8) </li></ol><br>  But starting from 40004cb8, there is a code that actually restores the context of the new thread. <br><br>  First, two values ‚Äã‚Äãare read into registers <i>r0</i> , <i>r1</i> : <br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">40004</span></span>cc<span class="hljs-number"><span class="hljs-number">0</span></span>: e8bd0003 <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> {r<span class="hljs-number"><span class="hljs-number">0</span></span>, r1}</code> </pre><br>  Next comes the comparison of <i>r0</i> with zero: <br><pre> <code class="hljs objectivec"><span class="hljs-number"><span class="hljs-number">40004</span></span>cc4: e3500000 cmp r0, <span class="hljs-meta"><span class="hljs-meta">#0</span></span></code> </pre><br>  Obviously, these values, at least <i>r0</i> , are part of the context (after all, the stack register is already tuned to the stack of the thread being restored), but it does not quite look like these are registers.  A comparison with zero implies some kind of branching.  Continuing the analysis, we see that if <i>r0! = 0</i> , then the code is executed: <br><pre> <code class="hljs go"><span class="hljs-number"><span class="hljs-number">40004</span></span>cc8: <span class="hljs-number"><span class="hljs-number">116f</span></span>f001 msrne SPSR_fsxc, r1 <span class="hljs-number"><span class="hljs-number">40004</span></span>ccc: <span class="hljs-number"><span class="hljs-number">18f</span></span>ddfff ldmne sp!, {r0, r1, r2, r3, r4, r5, r6, r7, r8, r9, sl, fp, ip, lr, pc}^</code> </pre><br>  In fact, this is similar to the restoration of the context.  Moreover, the value of the register <i>r1</i> is the saved value of the status register CPSR.  If the 40004ccc line is executed, then the control will not go further: the <i>pc</i> ( <i>r15</i> ) register will be restored and the program after this point will return to the place from which it was interrupted. <br><br>  Great, now we can write this label: <br><pre>   Offset Register
   -------- -------
   0 flag
   4 CPSR
   8 r0
   12 r1
   16 r2
   20 r3
   24 r4
   28 r5
   32 r6
   36 r7
   40 r8
   44 r9
   48 sl (r10)
   52 fp (r11)
   56 ip (r12)
   60 lr (r14)
   64 pc (r15)
</pre><br>  Each register and each flag is 32 bits or 4 bytes, respectively, this context requires 17 * 4 = 68 bytes.  It is logical that the stack goes further, as it was at the time of the interruption. <br><br>  But, as we see, this is part of the job.  We have this very flag.  And if its value is 0, then the code is executed: <br><pre> <code class="hljs perl"><span class="hljs-number"><span class="hljs-number">40004</span></span>cd<span class="hljs-number"><span class="hljs-number">0</span></span>: e8bd4ff<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pop</span></span> {r4, r5, r6, r7, r8, r9, sl, fp, lr} <span class="hljs-number"><span class="hljs-number">40004</span></span>cd4: e12ff001 msr CPSR_fsxc, r1 <span class="hljs-number"><span class="hljs-number">40004</span></span>cd8: e12fff1e bx lr</code> </pre><br>  Apparently, this is also a context, only somewhat abbreviated.  Moreover, the return from it occurs as from a normal function, and not by restoring the <i>pc</i> register.  By rewriting the label above, we get: <br><pre>   Offset Register
   -------- -------
   0 flag
   4 CPSR
   8 r4
   12 r5
   16 r6
   20 r7
   24 r8
   28 r9
   32 sl (r10)
   36 fp (r11)
   40 lr (r14)
</pre><br>  This context requires only 11 * 4 = 44 bytes. <br><br>  Using Google, viewing the disassembler listings, as well as studying the conventions for calling procedures, we come to understand that this type of context is used when cooperative multitasking works: i.e.  when we called <i>tx_thread_sleep ()</i> or others like them.  And since  Such a switch is, in essence, just a function call, then the context can be saved according to the calling conventions, according to which, we have the right between calls not to save the values ‚Äã‚Äãof the registers <i>r0-r3, r12</i> .  Moreover, we do not need to save pc - all the necessary information is already contained in the <i>rl</i> - return address from <i>tx_thread_sleep ()</i> .  Benefit on the face.  Cortexes are usually used on systems with a large amount of memory than ARM9E, they do not resort to such tricks and use one type of stacking. <br><br>  According to information from the Internet, I‚Äôve dug up that the first type of context is called interrupt, and is used when the thread is interrupted by interruption, that is, it can be interrupted anywhere, so you need to save all possible registers.  The second type of context is called solicited and is used when a thread is interrupted by a system call, which leads to resetting. <br><br>  That's actually all ready, to understand what modifications are needed in OpenOCD: <br><ul><li>  it is necessary to refine the registration mechanism of the target, so that there would be an opportunity to use several stacking options for one target; </li><li>  actually make a description of the target. </li></ul><br>  The code for the first item, I will not, see the patch.  For point two, I‚Äôll explain a little how to make a label of the OpenOCD clear offsets. <br><br>  First of all, we look at the output of the 'info registers' command, we look at how many registers and in what order it is output, we make up such a fish: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stack_register_offset</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rtos_threadx_arm926ejs_stack_offsets_solicited</span></span></span><span class="hljs-class">[] = {</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r0 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r1 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r2 */</span></span>q { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r3 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r4 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r5 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r6 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r7 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r8 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r9 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r10 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r11 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r12 */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* sp (r13) */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* lr (r14) */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* pc (r15) */</span></span> { , <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* xPSR */</span></span> };</code> </pre><br>  Here is the 32 bits of the register.  For ARM, it is always 32. The first column is filled with the help of the plates that we recorded above when analyzing the context recovery.  We take into account the special values: -1 - this register is not saved, -2 is a stack register, it is restored from the stream structure. <br><br>  The filled fish for the solicited context is: <br><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stack_register_offset</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rtos_threadx_arm926ejs_stack_offsets_solicited</span></span></span><span class="hljs-class">[] = {</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r0 */</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r1 */</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r2 */</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r3 */</span></span> { <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r4 */</span></span> { <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r5 */</span></span> { <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r6 */</span></span> { <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r7 */</span></span> { <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r8 */</span></span> { <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r9 */</span></span> { <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r10 */</span></span> { <span class="hljs-number"><span class="hljs-number">36</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r11 */</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* r12 */</span></span> { <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* sp (r13) */</span></span> { <span class="hljs-number"><span class="hljs-number">40</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* lr (r14) */</span></span> { <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* pc (r15) */</span></span> { <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span> }, <span class="hljs-comment"><span class="hljs-comment">/* xPSR */</span></span> };</code> </pre><br>  To interrupt the context, try to write it yourself or look at the source. <br><br>  What will it give: <br><ul><li>  displaying threads list by ‚Äúinfo threads‚Äù </li><li>  for a thread individually: ‚Äúthread apply all bt‚Äù </li><li>  switching between threads: "thread 3" </li><li>  switching between frames: "frame 5" </li><li>  individual viewing of the status of registers of each stream </li></ul><br>  commands are given for gdb. <br><br>  In general, happy debugging! <br><br>  Resources: <br><ul><li>  Patch: <a href="https://gist.github.com/h4tr3d/1b973f79d21313365847">ThreadX-arm926ejs.diff</a> </li><li>  Building under Win32 / 64, patched source codes, patch, auxiliary scripts: <a href="https://mega.co.nz/">openocd-0.8.0-20150206-win.tar.xz</a> </li><li>  Discussion on the Cypress forum: <a href="http://www.cypress.com/%3Fapp%3Dforum%26id%3D167%26rID%3D106353">www.cypress.com/?app=forum&amp;id=167&amp;rID=106353</a> </li><li>  OpenOCD mailing list: <a href="http://sourceforge.net/p/openocd/mailman/message/33287429/">sourceforge.net/p/openocd/mailman/message/33287429</a> </li></ul><br><br>  PS there is not enough hub "reverse engineering" and lighting for different assemblers ;-) <br><br>  UPD / 2015-08-15 /: Changes hit the main OpenOCD branch: <a href="http://openocd.zylin.com/">openocd.zylin.com/#/c/2848</a> </div><p>Source: <a href="https://habr.com/ru/post/249991/">https://habr.com/ru/post/249991/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249975/index.html">STM32 and FreeRTOS. 5. Benefit and welcome!</a></li>
<li><a href="../249977/index.html">Way of Tanks. Path from idea to game</a></li>
<li><a href="../249983/index.html">Classification of knowledge in the field of programming</a></li>
<li><a href="../249985/index.html">The official release of the first phone with Ubuntu Phone inside</a></li>
<li><a href="../249987/index.html">SEO URL support in Joomla 3 MVC component</a></li>
<li><a href="../249993/index.html">How to advertise an online game</a></li>
<li><a href="../249999/index.html">I used dictation and voice control for a week and this is what happened</a></li>
<li><a href="../250001/index.html">The effect of drip transform in CSS</a></li>
<li><a href="../250005/index.html">Sticky effect</a></li>
<li><a href="../250007/index.html">10 bugs in Ruby / Ruby on Rails that are easy to fix</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>