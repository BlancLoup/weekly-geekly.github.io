<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Convenient conversion of enumerations (enum) to string in C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Enumerations have many uses in development. For example, when creating games, they are used for programming character states or possible directions of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Convenient conversion of enumerations (enum) to string in C ++</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/78b/169/bb1/78b169bb1e7048bbbf902bbaad599a9b.png" align="left">  Enumerations have many uses in development.  For example, when creating games, they are used for programming character states or possible directions of movement: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> State {Idle, Fidget, Walk, Scan, Attack}; <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Direction {North, South, East, West};</code> </pre> <br>  It is much more convenient when, during debugging, a message like ‚Äú <code>State: Fidget</code> ‚Äù is displayed in the console instead of ‚Äú <code>State: 1</code> ‚Äù.  Also, it is often necessary to serialize enums into JSON, YAML or another format, moreover in the form of string values.  Besides the fact that strings are easier to perceive than numbers, their use in the serialization format increases the resistance to changes in the numerical values ‚Äã‚Äãof enumeration constants.  Ideally, <code>"Fidget"</code> should reference the <code>Fidget</code> , even if a new constant is declared, and <code>Fidget</code> has a value other than 1. <br><br>  Unfortunately, in C ++ there is no possibility to easily convert enumeration values ‚Äã‚Äãto string and back.  Therefore, developers are forced to resort to various tricks that require some support: hard-coded transformations or the use of unsightly restrictive syntax, like X-macros.  Someone additionally uses the build tools for automatic conversion.  Naturally, this only complicates the development process.  After all, enumerations have their own syntax and are stored in their own input files, which does not facilitate the work of the build tools in the Makefile or project files. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      However, using C ++ means it is much easier to solve the problem of converting enumerations to string. <br><a name="habracut"></a><br>  It is possible to avoid all the mentioned difficulties and generate enums with complete reflection on pure C ++.  The ad looks like this: <br><br><pre> <code class="cpp hljs">BETTER_ENUM(State, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, Idle, Fidget, Walk, Scan, Attack) BETTER_ENUM(Direction, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, North, South, East, West)</code> </pre><br>  Mode of application: <br><br><pre> <code class="cpp hljs">State state = State::Fidget; state._to_string(); <span class="hljs-comment"><span class="hljs-comment">// "Fidget" std::cout &lt;&lt; "state: " &lt;&lt; state; //  "state: Fidget" state = State::_from_string("Scan"); // State::Scan (3) //   switch,    . switch (state) { case State::Idle: // ... break; // ... }</span></span></code> </pre><br>  This is done with a few tweaks related to the preprocessor and the template.  We will talk a little about them at the end of the article. <br><br>  In addition to converting to string and back, as well as stream I / O, we can also iterate through the generated enums: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Direction direction : Direction._values()) character.try_moving_in_direction(direction);</code> </pre><br>  You can generate enums with sparse ranges, and then calculate: <br><br><pre> <code class="cpp hljs">BETTER_ENUM(Flags, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>, Allocated = <span class="hljs-number"><span class="hljs-number">1</span></span>, InUse = <span class="hljs-number"><span class="hljs-number">2</span></span>, Visited = <span class="hljs-number"><span class="hljs-number">4</span></span>, Unreachable = <span class="hljs-number"><span class="hljs-number">8</span></span>) Flags::_size(); <span class="hljs-comment"><span class="hljs-comment">// 4</span></span></code> </pre><br>  If you work in C ++ 11, you can even generate code based on enumerations, because all conversions and loops can be performed during compilation using <code>constexpr</code> functions.  You can, for example, write a <code>constexpr</code> function that will calculate the maximum value of an enumeration and make it available at compile time.  Even if the values ‚Äã‚Äãof the constants are chosen arbitrarily and are not declared in ascending order. <br><br>  You can <a href="https://github.com/aantron/better-enums">download from Github</a> an example of a macro implementation packaged in a library called Better Enums (Improved Enumerations).  It is distributed under the BSD license, so you can do anything with it.  In this implementation, there is one header file, so using it is very simple, just add <code>enum.h</code> to the project folder.  Try it, maybe it will help you in solving your problems. <br><br><h3>  How it works </h3><br>  To implement conversions between string and enum values, it is necessary to generate the corresponding mapping.  Better Enums does this by creating two arrays during compilation.  For example, if you have this declaration: <br><br><pre> <code class="cpp hljs">BETTER_ENUM(Direction, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>, North = <span class="hljs-number"><span class="hljs-number">1</span></span>, South = <span class="hljs-number"><span class="hljs-number">2</span></span>, East = <span class="hljs-number"><span class="hljs-number">4</span></span>, West = <span class="hljs-number"><span class="hljs-number">8</span></span>)</code> </pre><br>  then the macro will redo it into something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Direction</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> _Enum : <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> {North = <span class="hljs-number"><span class="hljs-number">1</span></span>, South = <span class="hljs-number"><span class="hljs-number">2</span></span>, East = <span class="hljs-number"><span class="hljs-number">4</span></span>, West = <span class="hljs-number"><span class="hljs-number">8</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _values[] = {<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _names[] = {<span class="hljs-string"><span class="hljs-string">"North"</span></span>, <span class="hljs-string"><span class="hljs-string">"South"</span></span>, <span class="hljs-string"><span class="hljs-string">"East"</span></span>, <span class="hljs-string"><span class="hljs-string">"West"</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _value; <span class="hljs-comment"><span class="hljs-comment">// ...,   ... };</span></span></code> </pre><br>  And then go to the conversion: find the index of the value or string in <code>_values</code> or <code>_names</code> and return its corresponding value or string to another array. <br><br><h3>  Array of values </h3><br>  <code>_values</code> generated by referring to the constants of the internal enumeration <code>_Enum</code> .  This part of the macro looks like this: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _values[] = {__VA_ARGS__};</code> </pre><br>  It transforms into: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _values[] = {North = <span class="hljs-number"><span class="hljs-number">1</span></span>, South = <span class="hljs-number"><span class="hljs-number">2</span></span>, East = <span class="hljs-number"><span class="hljs-number">4</span></span>, West = <span class="hljs-number"><span class="hljs-number">8</span></span>};</code> </pre><br>  This is <b>almost the</b> correct array declaration.  The problem is additional initializers like "= 1".  To work with them, Better Enums defines an auxiliary type intended for an assignment operator, but ignores the value itself: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">eat</span></span></span><span class="hljs-class"> {</span></span> T _value; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Any&gt; _eat&amp; <span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> =(Any value) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">//  . explicit _eat(T value) : _value(value) { } //   T. operator T() const { return _value; } //   T. }</span></span></code> </pre><br>  Now you can include the initializer "= 1" in the assignment expression, which has no value: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _values[] = {(_eat&lt;_Enum&gt;)North = <span class="hljs-number"><span class="hljs-number">1</span></span>, (_eat&lt;_Enum&gt;)South = <span class="hljs-number"><span class="hljs-number">2</span></span>, (_eat&lt;_Enum&gt;)East = <span class="hljs-number"><span class="hljs-number">4</span></span>, (_eat&lt;_Enum&gt;)West = <span class="hljs-number"><span class="hljs-number">8</span></span>};</code> </pre><br><h3>  String array </h3><br>  To create this array, Better Enums uses ( <code>#</code> ) - the preprocessor operator for string translation.  It converts <code>__VA_ARGS__</code> into something like this: <br><br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _names[] = {<span class="hljs-string"><span class="hljs-string">"North = 1"</span></span>, <span class="hljs-string"><span class="hljs-string">"South = 2"</span></span>, <span class="hljs-string"><span class="hljs-string">"East = 4"</span></span>, <span class="hljs-string"><span class="hljs-string">"West = 8"</span></span>};</code> </pre><br>  Now we <b>almost</b> convert constant names to string.  It remains to get rid of initializers.  However, Better Enums does not.  Just when comparing <code>_names</code> in the <code>_names</code> array <code>_names</code> it perceives the characters of spaces and equality as additional line boundaries.  So when searching for ‚Äú <code>North = 1</code> ‚Äù, Better Enums will only find ‚Äú <code>North</code> ‚Äù. <br><br><h3>  Is it possible to do without a macro? </h3><br>  Hardly.  The fact is that in C ++ the operator (#) is the only way to convert a source code to a string token.  So in any library that automatically converts enums with reflection, you have to use at least one high-level macro. <br><br><h3>  Other considerations </h3><br>  Of course, it would be much more boring and more difficult to fully consider the implementation of a macro than it is done in this article.  Basically, difficulties arise because of the support of <code>constexpr</code> functions working with <code>static</code> <code>constexpr</code> , due to the <code>constexpr</code> of different compilers.  Also, certain difficulties may be associated with the decomposition of as much of the macro as possible into templates in order to speed up compilation (templates do not need to be reparsed during creation, but macro extensions are needed). </div><p>Source: <a href="https://habr.com/ru/post/277757/">https://habr.com/ru/post/277757/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277741/index.html">Backup and transfer of data in the browser Vivaldi</a></li>
<li><a href="../277743/index.html">IP PBX Askozia and Push Notifications in Telegram</a></li>
<li><a href="../277747/index.html">Anatomy of ransomware for Android, part 1</a></li>
<li><a href="../277751/index.html">How our techies in the army served</a></li>
<li><a href="../277753/index.html">How to color the Chrome tab</a></li>
<li><a href="../277759/index.html">Segmentation Fault (computer memory allocation)</a></li>
<li><a href="../277761/index.html">The digest of interesting materials for the mobile # 141 developer (February 15-23)</a></li>
<li><a href="../277763/index.html">Manage enterprise iOS devices using OS X Server, as well as distributing applications within the company</a></li>
<li><a href="../277765/index.html">Distributing iOS apps by reference in a corporate environment using the Microsoft technology stack</a></li>
<li><a href="../277771/index.html">Open Android courses StudyJams throughout Russia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>