<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We program a microwave or controller 40 years ago</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, I recently accidentally fell into the hands of such a piece of iron: 


 Well, a piece of iron and a piece of iron, I thought ... There is a PBE03...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We program a microwave or controller 40 years ago</h1><div class="post__text post__text-html js-mediator-article">  Hi, I recently accidentally fell into the hands of such a piece of iron: <br><img src="https://habrastorage.org/getpro/habr/post_images/bb9/ba6/295/bb9ba6295271fce2fede487a4a3d4d9a.jpg" alt="image"><br><br>  Well, a piece of iron and a piece of iron, I thought ... There is a PBE035 microcontroller on the board, an IO m5l8243p extender, an IR12 between RF5 and the controller, and there is somewhere else LN1 on the side dangles.  I immediately liked the good rare ROM on 2KB RF5 in the socket in gold.  I think I'll take it off, and the rest boldly in the scrap, more, the whole board is covered with varnish for the most unbeatable .. And then all the same it became interesting, but what is it all about? <br><a name="habracut"></a><br>  It turned out that this is a control board from the Soviet microwave type Electronics 23 (aka BUVI-2 aka Fairy aka Dnepryanka).  On the Internet, even the device scheme was quickly found: <a href="http://www.elremont.ru/small_rbt/bt_rem32.php">http://www.elremont.ru/small_rbt/bt_rem32.php</a> Now that it became clear what it is, one hand confidently reached for the trash, and the other inadvertently hammered in Google ‚Äú035‚Äù and ... And I became interested and carefully looked at the fee.  Once there is a controller, it means you can write programs for it.  There is also a kind of screen directly on the board (4 digits) where you can display all sorts of swear words (BABA, SISI, well, you understand).  There is also a piezo element here, which means you can squeak.  Everything else you can connect 4x4 keyboard.  This is just some kind of devboard, I was delighted! <br><br>  As already mentioned, the PBE035 controller is installed on the board.  In Russia, it is better known by the name of KR1816BE35, but in general, this is the great and terrible Intel 8035 <a href="http://en.wikipedia.org/wiki/Intel_MCS-48">MSC-48</a> series.  The first copies began to be produced in 1976, that is, about 40 years ago.  The controller does not have its own memory for programs, so it communicates on the external bus with the ROM, from which it reads the instructions for execution.  But there are 64 bytes of RAM, of which about 32 bytes can be used as you like, and the rest are for registers and the stack.  There is a timer, there is an interrupt from the timer, there is an external interrupt, there is a system of priorities.  In short, the normal old-school controller, not like bold PICs.  What the Bolsheviks had been waiting for so long.  Immediately I wanted to code something under it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But first they had to solve one difficulty, namely, to connect the board.  As can be seen from the diagram, the power supply for the digital part requires just + 5V, while for the indicator powering it is necessary 2.5V and 30V of alternating voltage. <br><img src="https://habrastorage.org/getpro/habr/post_images/144/096/935/144096935a8b8ef29523c4dd1f2911c0.png"><br>  By the way about the indicator - it's a lamp!  Yes, a warm lamp radio tube, and not some kind of pop-up LEDs.  And like a lamp, it has a cathode anode and a grid.  This type of indicator is called fluorescent vacuum indicator.  After thinking a bit about the circuit, I saw that 30V breaks go to the diode bridge, which means they straighten up.  And even 2.5V also go to the diodes and then to the grid, which means they, too, straighten.  So you can try to connect the board to a constant voltage.  Instead of 30V, I filed 12V, instead of 2.5V, I filed 3.3V from a standard ATX format power supply.  To do this, solder the wiring to the board.  It turned out like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f5e/840/c64/f5e840c646fe5dc119eb55e47e443c58.png"><br><br>  But having turned on the board, I was at first disappointed.  Some segments on the display did not glow.  At first, I thought that 12 volts was not enough, but then after carefully examining the board, I found it was not in two places near the indicator.  Rang, disappeared.  The board started up, numbers appeared on the screen to set the time and select the program mode.  So, I wanted to throw it out, but in the end I fixed it.  It's time to fry. <br><br>  I used the free cross-platform assembler <a href="http://sourceforge.net/projects/asm48/">Asm48</a> .  Cool, that there is a version for MacOS, apparently the authors are not deprived of a sense of humor, at least I appreciated.  Well, it means downloading the assembler, everything is simple there: ASM48 &lt;filename.asm&gt; The first thing I did was ‚Äúblink the LED‚Äù, but instead of the LED I was jerking the leg of the speaker (piezoelectric element) in an endless loop with a delay.  Speaker is connected to port 1, high bit: <br><pre><code class="dos hljs">jmp main nop nop nop nop nop nop main: mov r6,#<span class="hljs-number"><span class="hljs-number">0</span></span> ;   r6 - <span class="hljs-number"><span class="hljs-number">0</span></span>  <span class="hljs-number"><span class="hljs-number">80</span></span>h forever: mov a,r6 ;     ALU xrl a,#<span class="hljs-number"><span class="hljs-number">080</span></span>h ; a = a xor <span class="hljs-number"><span class="hljs-number">80</span></span>h outl p1,a ;    <span class="hljs-number"><span class="hljs-number">1</span></span> mov r6,a ;    r6 <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> onesec ;   jmp forever ;   ;---PROCEDURES ;;;;;;;; delay100: mov r1,#<span class="hljs-number"><span class="hljs-number">84</span></span> loopex: mov r2,#<span class="hljs-number"><span class="hljs-number">236</span></span> loopin: djnz r2,loopin djnz r1,loopex mov r3,#<span class="hljs-number"><span class="hljs-number">4</span></span> loopad: djnz r3,loopad ret ;;;;;;;; onesec: mov r4,#<span class="hljs-number"><span class="hljs-number">10</span></span> loop_d: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> delay100 djnz r4,loop_d ret</code> </pre> <br><br>  Having compiled the program and stitched it on the programmer in ROM 2716, I launch the board and hear periodic clicks at intervals of about a second.  Works!  Now I had to deal with the screen.  The scheme shows that the ‚Äúmask‚Äù of the ABCDEFG symbol is connected to port 1. Moreover, the signal is inverted, that is, when 1 - the wand does not light, when 0 - it is lit.  In order to set the mask of the letter ‚ÄúH‚Äù, see the picture: <br><img src="https://habrastorage.org/getpro/habr/post_images/a2a/e3f/6c3/a2ae3f6c386940ea43cb597b7382a734.png"><br>  We begin to bypass the letter from G to A, since here the order of the bits is reversed: G is shaded, it means 1;  F is shaded, it means 1;  E is shaded, it means 1;  D is not painted over, it means 0 and so on.  The result is: 1110110b.  We remember that the signals are inverted, so you need to invert the mask itself: not 1110110b = 0001001b.  Or 9h.  Sending this number to port 1 we will set a mask for the letter.  Harder to choose a character.  Here is applied dynamic display.  In short, the essence comes down to the fact that we constantly have to set a mask, light the first character, set a mask, light the second character, and so on.  For the resolution of the luminescence of the symbol, the second port is responsible, which is extended to 4-four four-bit ports with the help of the m5l8243p microcircuit.  To access these ports, use the <b>MOVD</b> command, while the ports themselves are numbered P4, P5, P6, P7.  P4 according to the authors is responsible for scanning the keyboard, but P5 just sets one of four characters to display. <br><img src="https://habrastorage.org/getpro/habr/post_images/a84/8a7/fa5/a848a7fa55dc14c3ee627fac500305d9.jpg" alt="image"><br>  At first I tried to make a dynamic indication in the main program loop, but then I used a timer for this.  And in the main cycle of the program, the indicator buffer changes, displaying at intervals of 1 second the inscriptions ‚ÄúHELO‚Äù and ‚Äú2014‚Äù <br><div class="spoiler">  <b class="spoiler_title">Source Code</b> <div class="spoiler_text"><pre> <code class="dos hljs">;DATA .<span class="hljs-keyword"><span class="hljs-keyword">equ</span></span> disp_buf, <span class="hljs-number"><span class="hljs-number">030</span></span>h ; <span class="hljs-number"><span class="hljs-number">4</span></span> bytes buffer ;;; reset vector .org <span class="hljs-number"><span class="hljs-number">0</span></span> dis i ; disable interrupts jmp main ;;; external interrupt vector--trap .org <span class="hljs-number"><span class="hljs-number">3</span></span> jmp $ ; nop ;;; timer interrupt vector .org <span class="hljs-number"><span class="hljs-number">7</span></span> sel rb1 mov a,#<span class="hljs-number"><span class="hljs-number">0</span></span>d5h mov t,a mov a,#<span class="hljs-number"><span class="hljs-number">00</span></span>FH orld p5,a mov a,disp_buf-<span class="hljs-number"><span class="hljs-number">1</span></span> add a,r5 mov r0,a mov a,@r0 outl p1,a mov a,r4 movd p5,a rl a mov r4,a djnz r5,exit_tmr mov r4,#<span class="hljs-number"><span class="hljs-number">0</span></span>feh mov r5,<span class="hljs-number"><span class="hljs-number">4</span></span> exit_tmr: sel rb0 mov a,#<span class="hljs-number"><span class="hljs-number">0</span></span>d8h mov t,a ; strt t retr ;MAIN main: ;initialize dis tcnti ; turn off counter mov r1,#<span class="hljs-number"><span class="hljs-number">0</span></span> mov r5,#<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> copy_buf sel rb1 ; timer variables mov r4,#<span class="hljs-number"><span class="hljs-number">0</span></span>feh ; <span class="hljs-number"><span class="hljs-number">1110</span></span>h - CT position mov r5,<span class="hljs-number"><span class="hljs-number">4</span></span> ; R5 = buf offset sel rb0 mov a,#<span class="hljs-number"><span class="hljs-number">0</span></span>e5h mov t,a strt t en tcnti mov a,#<span class="hljs-number"><span class="hljs-number">0</span></span>ffh movd p6,a main_loop: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> onesec mov a,r5 xrl a,#<span class="hljs-number"><span class="hljs-number">4</span></span> mov r5,a mov r1,a <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> copy_buf jmp main_loop msg_table: .db #<span class="hljs-number"><span class="hljs-number">0</span></span>c0h ;O .db #<span class="hljs-number"><span class="hljs-number">0</span></span>c7h ;L .db #<span class="hljs-number"><span class="hljs-number">086</span></span>h ;E .db #<span class="hljs-number"><span class="hljs-number">089</span></span>h ;H .db #<span class="hljs-number"><span class="hljs-number">099</span></span>h ;<span class="hljs-number"><span class="hljs-number">4</span></span> .db #<span class="hljs-number"><span class="hljs-number">0</span></span>f9h ;<span class="hljs-number"><span class="hljs-number">1</span></span> .db #<span class="hljs-number"><span class="hljs-number">0</span></span>c0h ;<span class="hljs-number"><span class="hljs-number">0</span></span> .db #<span class="hljs-number"><span class="hljs-number">0</span></span>a4h ;<span class="hljs-number"><span class="hljs-number">2</span></span> ;;;;;;;; delay100: mov r6,#<span class="hljs-number"><span class="hljs-number">84</span></span> loopex: mov r2,#<span class="hljs-number"><span class="hljs-number">236</span></span> loopin: djnz r2,loopin djnz r6,loopex mov r6,#<span class="hljs-number"><span class="hljs-number">4</span></span> loopad: djnz r6,loopad ret ;;;;;;;; onesec: mov r3,#<span class="hljs-number"><span class="hljs-number">10</span></span> loop_d: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> delay100 djnz r3,loop_d ret ;;;;;;;; ;<span class="hljs-built_in"><span class="hljs-built_in">copy</span></span> from msg_table to display buffer <span class="hljs-number"><span class="hljs-number">4</span></span> bytes ; R1 = msg_table offset ;;;;;;;; copy_buf: mov r0,disp_buf mov r2,<span class="hljs-number"><span class="hljs-number">4</span></span> copy_lp: mov a,r1 add a,#msg_table movp a,@a mov @r0,a inc r0 inc r1 djnz r2,copy_lp ret</code> </pre></div></div><br><br>  A short video demonstration of the device: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Gk3PvqKpMgQ%3Ffeature%3Doembed&amp;xid=25657,15700019,15700186,15700191,15700253&amp;usg=ALkJrhhsn3W0mfhnRfaeHyqlEAdCKo_FZQ" frameborder="0" allowfullscreen=""></iframe><br>  An inquisitive habrauser probably noticed a bug at the end of the video when, instead of HELO, not exactly what was needed was highlighted.  I noticed him too, yes.  And all because when the main program is sending the display buffer, I forgot to stop the timer.  Before call copy_buf you need to do DIS TCNTI and after EN TCNTI.  So that! <br><br>  Now it only remains to play on the device "a Christmas tree was born in the forest" and I will consider the mission successfully completed.  All good! <br><br><h5>  Literary: </h5><br>  1) MCS-48 AND UPI-41 ASSEMBLER LANGUAGE MANUAL 1976 <br>  2) Volume 2 of the Shakhnov Reference Book (Microprocessors and integrated circuit microprocessor sets) <br>  3) Stashin V.V.  and others. - Designing digital devices on single-chip microcontrollers <br>  4) Signs Synthesizing Indicators: A Handbook / Ed.  V.P. Balashov <br>  5) Bystrov Yu.A.  One hundred charts with indicators </div><p>Source: <a href="https://habr.com/ru/post/214355/">https://habr.com/ru/post/214355/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214345/index.html">Useful materials for mobile developer # 42 (February 24 - March 2)</a></li>
<li><a href="../214347/index.html">Script Automator, loading images on Habrastorage: the second coming</a></li>
<li><a href="../214349/index.html">Arduino in the hands of designers</a></li>
<li><a href="../214351/index.html">Attacks on banking systems</a></li>
<li><a href="../214353/index.html">Mediatek announced a 64-bit LTE chip</a></li>
<li><a href="../214359/index.html">Video banned on YouTube due to the 5-second presence of the actress</a></li>
<li><a href="../214361/index.html">Lenovo's first mobile trade show: MWC 2014</a></li>
<li><a href="../214363/index.html">Introducing Nokia Imaging SDK 1.1 with support for Windows 8.1 and Windows RT 8.1</a></li>
<li><a href="../214367/index.html">Dykstra from Tim from Stanford</a></li>
<li><a href="../214371/index.html">Contract programming in PHP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>