<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Twitter: intercepting the management of views and thoughts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What would you do if you could post to Twitter on behalf of any user of the social network? Submitted? Then I ask you under the cat for details. 

 Fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Twitter: intercepting the management of views and thoughts</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e65/47a/872/e6547a872b2e4ac8a792c49c2f6db77e.png" alt="image"><br><br>  What would you do if you could post to Twitter on behalf of any user of the social network?  Submitted?  Then I ask you under the cat for details. <br><a name="habracut"></a><br><h2>  Foreword </h2><br>  During the study of the safety of the social network Twitter as part of a BugBounty program, I discovered a vulnerability that allowed an attacker to post tweets on behalf of any user of the service without access to the victim‚Äôs account.  This bug is particularly dangerous due to the fact that a huge number of both media representatives and other well-known personalities have Twitter accounts and use them to publish various news.  And the detected security problem allows placing false information not in one, but in several large accounts at once (for example, news publications), and the public is more likely to believe in it.  There are real examples when with the help of misinformation malefactors seriously influenced the stock prices of certain companies for their own benefit.  More information about such precedents can be read ( <a href="https://habrahabr.ru/company/itinvest/blog/270487/">here</a> ).  This vulnerability was discovered on February 26, 2017 and fixed on February 28, 2017. <br><br>  We turn to the technical details of the vulnerability. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Introduction </h2><br>  Twitter has a service such as <a href="https://ads.twitter.com/">ads.twitter.com</a> , it has a media library with the ability to upload media files (videos, pictures, gifs), as well as view previously downloaded media files that were used to post tweets .  The library is available at the following link: <a href="https://ads.twitter.com/accounts/%25D0%25B8%25D0%25B4_%25D0%25B2%25D0%25B0%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25B0%25D1%2583%25D0%25BD%25D1%2582%25D0%25B0/media">ads.twitter.com/accounts/id_ your_account</a> / <a href="https://ads.twitter.com/accounts/%25D0%25B8%25D0%25B4_%25D0%25B2%25D0%25B0%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE_%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25B0%25D1%2583%25D0%25BD%25D1%2582%25D0%25B0/media">media</a> .  Now to the point. <br><br><h2>  Looking around </h2><br>  Going to the library, we see the function of downloading media files: <br><br><img src="https://habrastorage.org/files/52c/9bc/a32/52c9bca32d2947d3a50329b3f914740b.jpg" alt="image"><br><br>  After we click on the button ‚ÄúUpload media file‚Äù and select it, we will see the following picture: <br><br><img src="https://habrastorage.org/files/9d4/e69/aa4/9d4e69aa4afd4df8bcb31eecd098cc76.jpg" alt="image"><br><br>  By clicking on the downloaded image we see the following: <br><br><img src="https://habrastorage.org/files/302/fa5/3bb/302fa53bb60f4061b23c4e6db8e79584.jpg" alt="image"><br><br><ol><li>  Ability to tweet our media file. </li><li>  The ability to share a media file with any user. </li></ol><br>  So, well, let's take a closer look at the tweet function: <br><br><img src="https://habrastorage.org/files/29f/d20/b32/29fd20b321c7442d901eb7555146671a.jpg" alt="image"><br><br>  What do we see?  Presumably the following: <br><br><ul><li>  account_id - account id specifically in the library </li><li>  owner_id - image owner id </li><li>  user_id - id of the user who, in fact, will post a tweet </li><li>  media_key - id of our media file (in screenshot 3, in the address bar, it is displayed) </li></ul><br>  We introduce some notation: <br><br><ul><li>  account number 1 - my first account </li><li>  account number 2 - my second account </li></ul><br>  Since I don‚Äôt remember the exact wording of the errors that are issued, we‚Äôll call them <br>  "Error number 1" and "Error number 2". <br><br><h2>  We try </h2><br>  What I did to detect the vulnerability: <br><br>  First, I intercepted the request to publish a tweet and changed the owner_id and user_id parameters in GET and in json-e, which was sent using the POST method, from account id 1 to the corresponding account id 2, but I did not get the expected result, only error No. 1. <br><br>  After that, I decided to replace owner_id and user_id only in POST, to which I received error No. 2, as far as I remember, the text was like this: ‚ÄúThe user with owner_id * the id that I replaced * does not own the media * here media_key *‚Äù. <br><br>  ‚ÄúGood,‚Äù I thought, and did the following: <br><br>  I used account # 2, went to the ads.twitter.com service, to the library, and uploaded the image in order to know media_key in advance. <br><br><h2>  Go-go </h2><br>  Returning to account number 1: <br><br>  We intercept the request by tweet and substitute owner_id, user_id in GET and POST with the corresponding data of account No. 2 and media_key with the one we learned by uploading the image on account No. 2.  Iiiii ... see the error number 1.  Sadness, sadness, longing, though wait.  When we previously replaced owner_id and user_id in GET and POST, there was one error (error # 1), and if owner_id and user_id were replaced only in POST, the error was different (error # 2).  Let's try? <br><br>  Replace the owner_id, user_id and media_key in the POST, iiii ... see a response indicating that the tweet was successful!  Turning to account number 2, we see that a tweet was posted with a previously loaded picture of account number 2, although the account number 2 did not publish anything. <br><br><h2>  Try harder </h2><br>  So, at the moment we have the opportunity to publish tweets on behalf of any user, but we have a hard limit that seriously reduces the impact (criticality of vulnerability), namely, we need a user on whose behalf we are going to publish. loaded media file.  Moreover, you need to know the media_key of this file, which cannot be picked up, since it consists of 18 digits.  Well, we will look for an opportunity to learn media_key.  In the process of searching, I did not find a 100% way to find out this media_key, there were always some limitations in the form of certain circumstances, under which, perhaps, we could get that same media_key.  Its end?  No exit?  Report how to eat?  Well, I do not!  The inner feeling told me that this vulnerability can be brought to the climax of criticality!  Remember the opportunity to share a downloaded media file?  It occurred to me that maybe when we share our media file with the user on whose behalf we want to publish, he will also be considered the owner of the media file, error No. 2 will not occur and the tweet will be successfully published.  And that is exactly what happened :) <br><br>  To successfully exploit the vulnerability, we lacked media_key, but in the case when we are the owner of the file, we can see its media_key (screenshot No. 3). <br><br>  Now the script looks like this: <br><br><ol><li>  We load our media file. </li><li>  We share this file with the user, on behalf of whom we want to publish the record. </li><li>  We intercept the tweet posting request and simply replace the owner_id and user_id in POST with the victim‚Äôs twitter account id (it‚Äôs easy to learn, there are many online services). </li><li>  We receive a message about the successful publication of tweet. </li></ol><br>  Now you can report on vulnerability with peace of mind. <br><br><h2>  Findings: </h2><br>  RCE, SQLi, XSS - all this is of course very healthy and dangerous, but sometimes logical vulnerabilities are no less a threat to security and are often much simpler to operate than the ones listed above.  It is worth paying close attention and attention of living specialists to this, as automated scanners are not capable of such.  As for Twitter, it is not yet known how many such vulnerabilities it currently exists and may appear as it develops and adds functionality.  Good luck to all bughunting! </div><p>Source: <a href="https://habr.com/ru/post/327904/">https://habr.com/ru/post/327904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327892/index.html">Email is personal data?</a></li>
<li><a href="../327894/index.html">Implementing a NetFlow sensor on an FPGA + CPU - flexibly and quickly</a></li>
<li><a href="../327896/index.html">Bash scripts, part 9: regular expressions</a></li>
<li><a href="../327898/index.html">Six programming paradigms that change your view of code</a></li>
<li><a href="../327900/index.html">Automate non-automated, or about Xamarin in real projects</a></li>
<li><a href="../327908/index.html">Acronis Backup 12.5 (now and) Advanced: long-awaited release</a></li>
<li><a href="../327910/index.html">Functional security, part 7 of 7. Methods of ensuring information and functional security</a></li>
<li><a href="../327912/index.html">RMarkdown, R and ggplot</a></li>
<li><a href="../327913/index.html">Typing a technical interview</a></li>
<li><a href="../327931/index.html">The recipe for the perfect Habropost</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>