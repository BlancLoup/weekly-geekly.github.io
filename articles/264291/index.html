<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating The Blacksmith: animation, camera effects, audio / video</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of our official collaboration with Unity, we continue to publish translations of articles on creating projects on Unity 5. This time we will l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating The Blacksmith: animation, camera effects, audio / video</h1><div class="post__text post__text-html js-mediator-article">  As part of our official collaboration with Unity, we continue to publish translations of articles on creating projects on Unity 5. This time we will look at the stages of working on animation, as well as the approach to creating post effects, audio and video for <a href="https://www.youtube.com/watch%3Fv%3DpXWAsayTFTo">The Blacksmith</a> short film. <br><br><img src="https://habrastorage.org/files/8c4/c98/970/8c4c989706a643b6b3980e503239a02a.jpg"><br><a name="habracut"></a><br>  You can also check out the previous article in the Making Of series <a href="http://habrahabr.ru/company/plarium/blog/263219/">on concept and decoration</a> .  All articles about the creation of The Blacksmith can be found <a href="http://unity3d.com/pages/the-blacksmith">on a special page of the project</a> . <br><br>  <b>Phased animation work</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Step One: Pre-Visualization</b> <br><br>  As soon as we decided on the direction of development of The Blacksmith‚Äôs concept and decoration, we wanted to see the video on the screen as soon as possible, so we immediately started creating an initial version that could be repelled. <br>  We created the initial versions of the proxy meshes of the characters, made temporary rigs for them with a rough skinning and divided the 3D objects into blocks so that, without losing time, we started to work on the revision. <br><br>  Thanks to this approach, we were able to calculate the time frame, iterate scenes and angles, and also make some edits.  Thus, we got an idea about the dynamics of the film at an early stage.  In addition, we were able to assign tasks to third-party contractors and manage the production process much more effectively. <br><br>  Cameras and rough animation previsa served as a good starting point for further work. <br><br>  <b>Motion capture</b> <br><br>  To play the roles of the characters of the video, we hired a Swedish studio stuntmen and mocap-specialists <a href="http://www.stuntgruppen.se/wp/english_home/">Stuntgruppen</a> , who not only perfectly coped with their task, but also gave us a lot of useful advice on certain scenes.  Before going directly to motion capture, we had several joint rehearsals. <br>  Shooting at the site of <a href="http://www.imaginationstudios.com/">Imagination Studios</a> in Uppsala went smoothly.  Previz proved its worth by serving as a good guide for all participants.  And the ability to see the result on the screen in real time even more simplified our task. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/s7x0C3MzCH0%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhf0Dw6xroOZtIvpGNTad74tel0Qg" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Stages of work on the animation</b> <br><br>  The work on the animation consisted of the following stages: <br><br>  ‚Ä¢ Preparation of rigs and joints for additional control in the Maya HIK system; <br>  ‚Ä¢ Export rigs in fbx format to Motionbuilder; <br>  ‚Ä¢ Motion capture and transfer of footage to the rigs in Maya; <br>  ‚Ä¢ Creation of facial animation; <br>  ‚Ä¢ Simulation of hair and clothing on additional chains of joints; <br>  ‚Ä¢ Animation of additional objects, their adjustment and export in fbx format to Unity; <br>  ‚Ä¢ All rigs were imported with Generic installed;  on the name map of joints, we added an animation to them in the Unity timeline / sequencer tool; <br>  ‚Ä¢ Animation of cameras was performed primarily in Motionbuilder;  imported duplicates were added to the render camera in Unity by transferring the sequencer to the timeline. <br><br>  <b>Setup in Unity</b> <br><br>  Having begun work in Unity, we had to configure rigi first of all.  For the two main rigs, we used the Generic Rig setting and performed an automatic matching of the joints attached to them for organizing and optimizing the scenes. <br><br>  Then we started processing shots in the Scene Manager, but each shot always referred to one of the two main rigs.  For this reason, the names of the joints should have correlated 1/1 for more efficient redirection.  So, we collected shots from a large number of fbx-files and put them on a timeline so that they point to the main characters in the scene.  As a result, the timeline consisted of the following playable elements: Character Track, Camera Track, Prop Track, Event Track, Switcher / Shot Manager Track. <br><br>  <b>Simulation of clothes, hair and extra joints</b> <br><br>  We also wanted to focus on the realistic behavior of the hair and clothes of the characters.  To do this, we added more joints to the blacksmith's hair and the floors of the clothes of both heroes.  The additional setting allowed baking the simulation in joints, and we got a realistic behavior of clothes with a large number of baked bones.  We set a high enough bar - we had 256 bones and 4 bones per vertex for each character - and this approach was justified. <br><br><img src="https://habrastorage.org/files/e32/f54/8c1/e32f548c161e4e84a7de94c1e1e67efe.jpg"><img src="https://habrastorage.org/files/57f/602/1c2/57f6021c2fa1495b97b10900371e82a0.jpg"><img src="https://habrastorage.org/files/5bf/1f9/d4e/5bf1f9d4e99a417b91197a47966287fb.jpg"><br><br>  Face joints connect the eyes with the look at control;  the rest of the joints around the jaw were used to connect the beard to the facial vertices using this <a href="https://www.youtube.com/watch%3Fv%3DgLak2NIwKqM">method of rivetting</a> in Maya. <br><br>  For the correct operation of our hair shader, the beard and hair had to remain separate elements.  Animation of the face was done using blendshape.  They formed the basis of a unique technology of wrinkle texture management.  Thus, when exporting, we again used rivetting to bake joints after the blend shakes. <br><br>  <b>Assembling footage mocap in the studio</b> <br><br>  After filming, we recreated the footage in Story mode in Motionbuilder. <br><br>  At this stage, the animator continued working with content, setting up cameras in the pre-final version of the video.  As the person best acquainted with the concept of each scene, the animator was also tasked with consistent editing in the main files.  In addition, at this stage it was possible to introduce any ideas that might arise during the filming. <br><br>  The whole film was divided into several main scenes (separate fbx-files), namely: ‚ÄúForge Horizon‚Äù, ‚ÄúHorizon ‚Äì Opponent‚Äù, ‚ÄúBattle of Heroes‚Äù and ‚ÄúWell‚Äù.  Such an organization of scenes greatly simplified the work with files.  At this stage, all fbx files already contained all the necessary content for the final configuration and subsequent export to Unity.  Then we divided the duplicate / frame ranges in the Unity import tool. <br><br>  The next step was to replace all the content from the pre-footage with the mocap material, which made it possible to import pre-final animation into Unity.  This had to be done as quickly as possible in order to proceed to the final adjustment of art, lighting and special effects. <br><br>  Finally, we made several technical edits, but this did not particularly affect the scenes and camera angles.  Having finished the work on the figures, the animator transferred all the content back to Maya to finalize the animation of the faces, simulate clothes and hair, as well as add objects and controls. <br><br><img src="https://habrastorage.org/files/4bd/7a9/eee/4bd7a9eee9714c1c8fac3bbd761c86e1.jpg"><br><br>  <b>Final export to Unity</b> <br><br>  At this stage of development, it is time to replace all temporary files with the final versions of the animation resources.  The sequential structure and scenes in Unity remained almost unchanged, since we only overwritten the fbx files and made minor edits to the sequencer. <br><br>  You can watch the video below to compare different stages of development, from the storyboard to the final version of the film. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/0mA5croUc4Q%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjPiFqRT4kFcX9Lcv0QJpXjiU7PRA" frameborder="0" allowfullscreen=""></iframe><br><br>  <b>Camera effects</b> <br><br>  As part of this project, we wanted to give the movie a cinematic image, so in each shot we used typical post effects for the movie, in particular some of the standard Unity effects: Depth of Field, Noise and Grain, Vignette and Bloom. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ce1/070/8ae/ce10708aeb03a53b4f33f146c68847d0.gif" alt="image"><br><br>  We developed our own motion blur to experiment with how camera settings, such as frame rate and shutter speed, will affect the final image.  We also wanted to make sure that we could accurately fix the speed of the animated meshes - for this we needed to track the change in the movement of each bone of the skeleton, surrounding objects and cameras. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/RJ2QYdjMlMk%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgG74BMOK8BrrKqBYuYVnL7lLNibw" frameborder="0" allowfullscreen=""></iframe><br><br>  In order to convey the depth and scale of large stage shots, we were looking for a solution that would provide a realistic aerial perspective.  Therefore, we specifically developed a component for atmospheric dispersion to replace the fog modes built into Unity.  Having a little experimented on the basis of various theoretical works, we decided to sacrifice exact modeling of atmospheric dispersion in favor of complex control over artistic effects. <br><br>  Here are the camera settings in one of the shots: <br><br><img src="https://habrastorage.org/files/eeb/858/3c6/eeb8583c6e6740128d5054800da02e1b.png"><br><img src="https://habrastorage.org/files/e62/a93/9b7/e62a939b73ac4acf9cc5592271eba791.jpg"><br><br>  To enhance the cinematic effect, we decided to simulate the classic process of transferring a film to a film copy.  To do this, we imported screenshots from Unity to DaVinci Resolve - an external professional video production application - and performed color correction and tonal compression in it.  In the same place, we created a lookup table, which we then imported into Unity and converted it into a custom image effect.  At run time, this effect converted the linear data into a logarithmic distribution, which was then run through the lookup table.  Thus, we combined color correction and tonal compression in one process. <br><br><img src="https://habrastorage.org/files/a3b/393/4d2/a3b3934d2c7a433ea64cff7a3637b4d5.jpg"><br><br>  <b>Audio</b> <br><br>  The soundtrack is an audio track imported into Unity and synchronized across the timeline of the sequencer.  When writing and synchronizing the track, the composer was guided by an offline render - a special preview for the video.  To create the right atmosphere, he focused on the song <a href="https://www.youtube.com/watch%3Fv%3D90v6lPuH0c4">Ilmarinen's Lament</a> , which we licensed from the US-Swedish indie musician Theo Hakola, and also added elements of his own composition to it. <br><br>  <b>Video</b> <br><br>  We wanted this short film to be entirely created in Unity - without any post-processing or editing.  To do this, we have developed a separate tool for frame-by-frame rendering at a set time interval.  Then each frame was loaded into the memory of the H.264 encoder, mapped to an audio stream and recorded in mp4 format to disk.  Finally, the final version of the video was uploaded directly to YouTube. <br><br>  That's all.  Stay tuned for updates on our blog, and in the meantime, be sure to check out the special <a href="http://unity3d.com/pages/the-blacksmith">The Blacksmith</a> page. </div><p>Source: <a href="https://habr.com/ru/post/264291/">https://habr.com/ru/post/264291/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264281/index.html">PostgreSQL 9.5: what's new? Part 1. INSERT ... ON CONFLICT DO NOTHING / UPDATE and ROW LEVEL SECURITY</a></li>
<li><a href="../264283/index.html">Welcome to Windows Camp - September 10, Moscow</a></li>
<li><a href="../264285/index.html">Data Science: the path to professionalism</a></li>
<li><a href="../264287/index.html">Two-factor authentication. New challenges</a></li>
<li><a href="../264289/index.html">Making the code cleaner: Refactoring the PCI driver for a NAND Denali controller</a></li>
<li><a href="../264293/index.html">How we overcame USB data transfer</a></li>
<li><a href="../264295/index.html">Secrets of testing Ethernet channels</a></li>
<li><a href="../264297/index.html">Vim in full: Testing with xUnit</a></li>
<li><a href="../264299/index.html">We assemble our OpenWRT on a Tp-Link TL-WR741ND v.4.25 router with vlan, openvpn, provider rotation and blackjack</a></li>
<li><a href="../264301/index.html">Authorization / User Registration via Telegram</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>