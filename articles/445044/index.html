<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Go application in production systems. Validators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, Habr! 

 I often start the morning with viewing Habr and finally decided to contribute to this interesting learning process. If everyt...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Go application in production systems. Validators</h1><div class="post__text post__text-html js-mediator-article">  <i>Good afternoon, Habr!</i> <br><br>  I often start the morning with viewing Habr and finally decided to contribute to this interesting learning process.  If everything works out, then this is my first article from the cycle of using the <b>GO</b> language on production systems.  I want to tell you some of the subtleties of creating applications and servers, the convenience of the language and the speed of development on it.  Perhaps, for professionals, this article will seem boring and not interesting, but reading the literature I did not find the general picture of the solution of production problems.  Although most problems are solved the same way.  In this article I will explain the general principles of building a server and, as an example, I will use the server to validate and view the postal codes of Post Russia.  This article will highlight more general, methodological problems and subtleties that I encountered while creating this system.  I will not describe the general settings, there are many of these in the network, I just want to focus on the little things that prevented the launch of the project. <br><br><img src="https://habrastorage.org/webt/mb/5n/pv/mb5npvjcxey7an1ybccpsgu9odw.jpeg"><br><a name="habracut"></a><br><h3>  Instead of intro </h3><br>  Reading Habr, I often faced the task of validation - checking the correctness of user input.  Each author solved this problem in his own way.  I used external service or wrote my server.  I propose another solution to this problem - the creation of a directory service.  Directories are servers that contain information of a certain direction and which can be separated into a separate, independent subsystem.  Typically, reference books are used to assist the user in completing and validating the information entered.  As an example of such reference books, one can cite the services of requests for regions, requests for cities, KLADR, postal codes, directories of GAIS (state automated information systems).  Almost all existing systems exchange REST data using either json or soap.  I will try to tell a template for the development of such directories that will allow you to quickly create such systems.  And put on github the sources of my internal project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  The choice of systems.  Immediately the question arises why GO?  Why Linux?  And which Linux? </h3><br>  And so let's start in order.  Our current system is built on products from the company 1C, namely the BEADS and the corporate portal.  To unify the OS, we have chosen from the recommended installation for 1C - namely, OS Linux CentOS.  Launch scripts of 1C web environment are run on this OS.  Windows OS was not considered.  I can not say that I like the choice, I would choose debian, but it happened.  Unification was necessary for us, because historically we have a large zoo OS, various builds of OS Linux, OS FreeBSD, OS VxWorks.  And, in my opinion, the fastest Linux OS CRUX. <br><br>  How many projects created by the system on 1C has grown into a large portal and it became necessary to allocate from the system and / or supplement the system with various services - directories.  Analyzing the offers and possibilities of the already created services, as well as our needs in these reference books, we came to the conclusion that the reference book: <br><br><ul><li>  Standalone server service; </li><li>  Data exchange occurs via REST; </li><li>  Has the ability to scale horizontally; </li><li>  Must quickly give data, albeit redundant, processing on 1C products; </li><li>  Quickly rebuild logic depending on new business tasks; </li></ul><br>  According to the above criteria and its ease of entry, Go was chosen to write reference books.  Additionally: <br><br><ul><li>  Go language with the compiler and allows you to include code snippets in C; </li><li>  The program is a single file with all libraries (there are no problems with the compatibility of libraries after assembly); </li><li>  a large community (many examples and ready-made solutions); </li></ul><br>  That is, Go is well suited for creating directories.  From myself I add, php and Go are a bit similar, which allows you to maintain systems written in these languages.  Also, Go already has a large number of solutions, which allows you to quickly build these solutions for your tasks, that is, as in the designer of the cubes to assemble a model of the house.  And so we proceed to practice. <br><br><h3>  GO.  Installing and searching for libraries or solutions </h3><br><cut></cut>  To install, you need to download the archive from the <a href="https://golang.org/dl/">download page</a> and unpack it into the installation folder, I will use <b>/ usr / local</b> . <br><br><pre><code class="plaintext hljs">wget https://dl.google.com/go/go1.12.1.linux-amd64.tar.gz tar -C /usr/local -xvzf go1.12.1.linux-amd64.tar.gz</code> </pre> <br>  I want to draw your attention, Go is divided into two categories: the first one is the compilation language itself and the libraries included in the build ( <b>GOROOT</b> ), the second is the additional libraries that you put and where you will create your project ( <b>GOPATH</b> ).  Setting up the environment and preparing the development folder, I will use <b>/ home / gouser /</b> .  Add <b>/ etc / profile</b> or to custom <b>.profile</b> . <br><br><pre> <code class="plaintext hljs">export GOPATH=/home/gouser export GOROOT= /user/local/go/ export PATH=$PATH:/usr/local/go/bin</code> </pre> <br>  Prepare a folder for your project: <br><br><pre> <code class="plaintext hljs">mkdir -p /home/gouser/{bin,pkg,src}</code> </pre> <br>  Then everything is simple for your project, create a folder in src, create files with the go extension and compile the project: <br><br><pre> <code class="plaintext hljs">go build</code> </pre> <br><h3>  Recommendations for creating a project.  General recommendations </h3><br><ul><li>  For a project on github, it is more understandable to create a folder for the project src / github.com / &lt;project name&gt;; </li><li>  to draft a project in the form of a package, to comment on each procedure ‚Äî a way for very conveniently getting ready program documentation in godoc; </li><li>  Global variables to put in a separate module and connect it if necessary (like a template alone); </li></ul><br>  Both ready examples and libraries can be found at <a href="https://libs.garden/">libs.garden</a> .  Installing Found Examples <br><br><pre> <code class="plaintext hljs">go get &lt;  &gt; ,  github.com/labstack/echo</code> </pre> <br><h3>  PostCode.  <a href="https://github.com/Theo730/postcode">Link to the project</a> </h3><br>  After installing <b>Go,</b> we will proceed to the analysis of the example.  Download and install to compile it can be commands: <br><br><pre> <code class="plaintext hljs">go get github.com/julienschmidt/httprouter go get github.com/LindsayBradford/go-dbf/godbf go get github.com/go-sql-driver/mysql go get github.com/julienschmidt/httprouter cd /home/gouser/go/src/github.com/ git clone https://github.com/Theo730/postcode.git postcode</code> </pre> <br><h3>  Formulation of the problem </h3><br>  It is necessary to create a reference book for working with postal codes by Russian post, which will solve the following tasks: <br><br><ul><li>  Validation of postal codes; </li><li>  The possibility of obtaining a list of all accounting objects (regions, hotels, etc.); </li><li>  Getting all the indices in the object of registration of cities, districts, regions ... </li><li>  From the above, exchange REST data in the form of json. </li></ul><br><h3>  Research task </h3><br>  First you need to initialize the database, and then create a query server for this database.  Need a database of postal codes.  The search is <a href="https://vinfo.russianpost.ru/database/ops.html">vinfo.russianpost.ru/database/ops.html</a> .  Base in FoxPro and in zip archive.  The database contains the following accounting objects: <br><br><ul><li>  region; </li><li>  autonomous obla; </li><li>  area; </li><li>  locality; </li><li>  postcode. </li></ul><br>  For initialization on <b>libs.garden</b> we find components and examples of working with database and zip.  We take <b>httprouter</b> as a request <b>router</b> .  We connect to the project. <br>  When examining the database file, it was found that <u>not all accounting objects are specified</u> , that is, there are zero values ‚Äã‚Äãin the sample. <br><br><h3>  Solution and implementation </h3><br>  Accounting objects stand in the hierarchy when the database is initialized, if the accounting object is zero, then the name is taken from the parent.  Server ideology - requests come to <b>main</b> (here a request router) and are redirected to <b>handlers</b> (here all data checks, conversions, etc.).  All requests to the <b>database</b> and calculations are made from handlers and the handlers carry out the output of the information received.  This <u>decomposition</u> allows you to separate queries in the database, calculations, verification of the entered information and the output of the found.  In principle, everything. <br><br><h3>  Instead of the total </h3><br>  The functional guide turned out to be more complicated than <b>KLADR</b> .  It not only allows you to create a validator or directory on the site, but also to create an algorithm for regional business. <br><br>  If there is a distributed regional business selling services or goods.  Dealers in the regions are registered on the portal, indicate the area where they will provide the service or sell the goods and they are assigned an array of postal codes.  When requesting a service or product, the client indicates the postal code, and his application is sent to his regional dealer (here you can build a complex algorithm).  The list of <b>REST</b> requests is on <b>github</b> in the project documentation. <br><br><h3>  And a little bitrix </h3><br>  This handbook can be connected to any project or framework, but since we have bitrix, I put a module to add a validator to web forms of standard components. <br><br>  <b>PS</b> Server installation is specially divided into 3 stages.  This is done due to the obsolescence of the site‚Äôs vinfo.russianpost.ru site and due to licensing restrictions.  The base itself is not my property; using it you accept the licensing policy above the voiced site. <br><br>  <b>PSS</b> Servers created in my projects for the corporate segment and under the conditions should not go online.  The code can be modified for your specific tasks.  We do not use external access for our projects.  The following projects that I would like to describe are a full-fledged KLADR and a streaming radio protocol analyzer.  Next Bitrix24 + asterisk.  Please comment on who is more interesting. </div><p>Source: <a href="https://habr.com/ru/post/445044/">https://habr.com/ru/post/445044/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445034/index.html">LockerGoga: what exactly happened with Norsk Hydro</a></li>
<li><a href="../445036/index.html">What was the first iPhone?</a></li>
<li><a href="../445038/index.html">Leaks of secret information found in 100,000 repositories on GitHub</a></li>
<li><a href="../445040/index.html">We build models, ‚Äúsell‚Äù management knowledge management and correct the survivor‚Äôs mistake.</a></li>
<li><a href="../445042/index.html">Delphic programmer success story from Ulan-Ude</a></li>
<li><a href="../445048/index.html">Delaunay triangulation algorithm using the sweeping line method</a></li>
<li><a href="../445052/index.html">Why it is impossible to set the font size of the visited link</a></li>
<li><a href="../445054/index.html">Now AI classifies lung cancer as well as laboratory diagnostics specialists.</a></li>
<li><a href="../445056/index.html">Review of web development courses</a></li>
<li><a href="../445058/index.html">Tesla autopilot learned to determine the change of the strip of neighboring cars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>