<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DOM is enough for everyone, or how to reconcile ReactJS with the fact that third-party libraries change its DOM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Modern JavaScript frameworks, and ReactJS are not an exception, usually require exclusive access to the DOM and they really don‚Äôt like it to be change...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DOM is enough for everyone, or how to reconcile ReactJS with the fact that third-party libraries change its DOM</h1><div class="post__text post__text-html js-mediator-article">  Modern JavaScript frameworks, and ReactJS are not an exception, usually require exclusive access to the DOM and they really don‚Äôt like it to be changed by someone without their knowledge.  The problem is that there are a huge number of third-party libraries (for example, jQuery plug-ins) that need something in their subtree-controlled something to drop, unprotect, move to another place, etc.  Usually in such cases we see something similar in the console: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d99/c1b/698/d99c1b69818d5cedc0fe9f0129612fac.jpg" alt="image"><br><br>  Fortunately, this problem is quite easily and quickly solved.  In this post I will try to present the solution step by step, but if you are not interested or are in a hurry, just go down to the link to the gist with the ready solution.  So, let's begin. <br><a name="habracut"></a><br><h2>  Who is guilty? </h2><br>  Suppose we want to use in our ReactJS project some kind of mega-cool text editor, like AceEditor or TinyMCE.  This plugin takes the &lt;textarea /&gt; element and turns it into a &lt;div contenteditable /&gt; element with a toolbar and a highlat, and it might look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">textarea2editor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">parent</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $parent= jQuery(parent); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> $editor = jQuery(<span class="hljs-string"><span class="hljs-string">'&lt;div contenteditable/&gt;'</span></span>); $editor.css(<span class="hljs-string"><span class="hljs-string">'background'</span></span>, <span class="hljs-string"><span class="hljs-string">"#333"</span></span>); $editor.css(<span class="hljs-string"><span class="hljs-string">"color"</span></span>, <span class="hljs-string"><span class="hljs-string">"#efefef"</span></span>); $parent.find(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>).replaceWith($editor); <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">setText</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text</span></span></span><span class="hljs-function">)</span></span>{ $editor.html(text); }, <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> } }</code> </pre> <br><br>  Suppose we have a ReactJS application that displays Unix commands at a specified interval: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> App = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( &lt;div&gt; &lt;textarea value={this.props.contents}/&gt; &lt;/div&gt; ) } }); var Component = React.render(&lt;App contents="#./configure" /&gt;, document.body); setTimeout(function(){ Component.setProps({ contents: "#/.configure\n#make" }); }, 1000); setTimeout(function(){ Component.setProps({ contents: "#/.configure\n#make\n#make install" }); }, 2000);</code> </pre><br><br>  We would like, of course, to use the above-described plugin for the command's highlight, for this, as usual, we first add the componentDidUpdate method to our component, which will initialize the editor: <br><br><pre> <code class="javascript hljs">componentDidMount: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.editor = textarea2editor(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getDOMNode()); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.editor.setText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.contents); }</code> </pre><br><br>  As well as the componendDidUpdate method, which will update the contents of the &lt;div contenteditable /&gt; with each update of the component: <br><br><pre> <code class="javascript hljs"> componentDidUpdate: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.editor.setText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.contents); }</code> </pre><br><br>  And here we have the next <a href="http://jsfiddle.net/kb3gN/8761/">fiddle</a> . <br>  When we launch it, we will see that only the first command appears in the ‚Äúterminal‚Äù, but not the rest.  And if we open the console, we will see why this happens: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/112/ccf/f54/112ccff5456f12a3a79bfbc587a1c3b4.jpg"><br><br>  The point, of course, is that our ‚Äúeditor‚Äù replaced &lt;textarea /&gt; with &lt;div contenteditable /&gt; without React's knowledge, and now React is confused, he has &lt;textarea /&gt; in his virtual house, but he doesn‚Äôt , and it is not clear how in such conditions to do diff and update the page. <br><br><h2>  And what to do? </h2><br>  Fortunately, the solution is very simple, but it did not come to me at once.  I was inspired to this decision by the experience of communicating with AngularJS, where there is the ngNonBindable directive, which says to Angoulard: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/078/870/281/0788702818ec640e483b339cdd044bd3.jpg"><br><br>  I wondered if there was anything like that in React.  The documentation does not (directly) say about this, but it says about the method shouldComponentUpdate, which returns a boolean value, and if it is false, then React will not update not only the component, but its entire subtree.  That is, he simply will not call the methods componentWillUpdate, componentWillReceiveProps, render, etc.  This method is proposed as an optimization tool, but wait, and if it does not cause render, the subtree of the components in the virtual DOM does not change, it means that for this virtual subtree, the diff and the corresponding real DOM are not needed in principle, does this mean that With this ‚Äúoptimization‚Äù method, can the React be made to ignore certain parts of the DOM-a subject to it?  It turns out you can, but if we add to our component: <br><br><pre> <code class="javascript hljs">shouldComponentUpdate: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  then the errors will disappear, but our ‚Äúterminal‚Äù will not be updated anyway.  Actually, we need to force React to ignore only the &lt;textarea /&gt;, not the entire component, do we really have to write RenderOnceTextarea and so whenever we want to use the component from React.DOM? <br><br>  In fact, there is a better solution - to write to the ReactIgnore component, which always returns its children, and always returns the false to shouldComponentUpdate: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ReactIgnore = React.createClass({ <span class="hljs-attr"><span class="hljs-attr">displayName</span></span>: <span class="hljs-string"><span class="hljs-string">'ReactIgnore'</span></span>, <span class="hljs-attr"><span class="hljs-attr">shouldComponentUpdate</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> React.Children.only(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.children); } });</code> </pre><br><br>  Here is a working <a href="http://jsfiddle.net/sgbtm3au/3/">fiddle</a> . <br><br><h2>  tl; dr aka gist link </h2><br>  I copied ReactIgnore from my project and laid it out as a <a href="https://gist.github.com/alexeisavca/d4ff175fd16c93c8785d">gist</a> (Achtung, ES6 Harmony), use it on health. </div><p>Source: <a href="https://habr.com/ru/post/246999/">https://habr.com/ru/post/246999/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246985/index.html">Efficiency gon</a></li>
<li><a href="../246989/index.html">Print a check document with Python and Parse</a></li>
<li><a href="../246991/index.html">What is an event, or why 4-D geometry for business analytics?</a></li>
<li><a href="../246993/index.html">How to clone an object?</a></li>
<li><a href="../246997/index.html">New new thing (The new new thing)</a></li>
<li><a href="../247003/index.html">Payler. Summing up 2014!</a></li>
<li><a href="../247005/index.html">Live code conference DevCon 2015</a></li>
<li><a href="../247013/index.html">Creation of the Ice Guard unit: from concept to 3D model</a></li>
<li><a href="../247015/index.html">Write comparators correctly</a></li>
<li><a href="../247017/index.html">Arduino programming in CLion</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>