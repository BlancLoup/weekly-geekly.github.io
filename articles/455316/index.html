<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We modify the Bluetooth stack to improve the sound on headphones without AAC, aptX and LDAC codecs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Before reading this article, it is recommended to familiarize yourself with the previous article: Audio via Bluetooth: as detailed as possible about p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We modify the Bluetooth stack to improve the sound on headphones without AAC, aptX and LDAC codecs</h1><div class="post__text post__text-html js-mediator-article">  <i>Before reading this article, it is recommended to familiarize yourself with the previous article: <a href="https://habr.com/ru/post/427997/">Audio via Bluetooth: as detailed as possible about profiles, codecs and devices</a></i> <br><br>  Some users of wireless headphones note poor sound quality and lack of high frequencies when using the standard Bluetooth SBC codec, which is supported by all audio devices.  A frequent recommendation to improve the sound is to purchase devices and headphones with support for aptX and LDAC codecs.  These codecs require license fees, so devices with their support are more expensive. <br><br>  It turns out that the low quality of the SBC is due to the artificial limitations of the Bluetooth stacks and the settings of the headphones, and this restriction can be circumvented on any existing devices by programmatic changes of the smartphone or computer. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  SBC Codec </h2>  The SBC codec has many different parameters that are consistent during the connection setup phase.  Among them: <br><br><ul><li>  Number and type of channels: Joint Stereo, Stereo, Dual Channel, Mono; </li><li>  Number of frequency bands: 4 or 8; </li><li>  The number of blocks in the package: 4, 8, 12, 16; </li><li>  Algorithm for the distribution of bits in quantization: Loudness, SNR; </li><li>  The maximum and minimum value of the pool of bits used in quantization (bitpool): usually, from 2 to 53. </li></ul><br><br>  The decoder is required to support any combination of these parameters.  The encoder may not implement everything. <br>  Existing Bluetooth stacks usually agree on the following profile: Joint Stereo, 8 lanes, 16 blocks, Loudness, bitpool 2..53.  This profile encodes 44.1 kHz audio at 328 kbps. <br>  The bitpool parameter directly affects the bitrate within one profile: the higher it is, the higher the bitrate, and hence the quality. <br>  However, the bitpool parameter is not tied to a specific profile;  Other parameters also have a significant effect on the bitrate: type of channels, number of frequency bands, number of blocks.  You can increase the bitrate indirectly, by agreeing on non-standard profiles, without changing the bitpool. <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>8</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><msub><mtext>&amp;#xA0;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><msub><mtext>&amp;#xA0;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>u</mi><mi>b</mi><mi>b</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>s</mi><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>b</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="76.802ex" height="2.419ex" viewBox="0 -780.1 33067.4 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-62" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-69" x="429" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="775" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-72" x="1136" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="1588" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="2117" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="2479" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMAIN-3D" x="3223" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-66" x="4529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-72" x="5080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="5531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-63" x="6061" y="0"></use><g transform="translate(6494,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMAIN-38" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-66" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-72" x="3822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="4274" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6D" x="4803" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="5682" y="0"></use><g transform="translate(6148,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6C" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="6709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6E" x="7176" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-67" x="7776" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="8257" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-68" x="8618" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="9445" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-69" x="9806" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6D" x="10152" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="11030" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="11497" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="11966" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="12436" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6D" x="12965" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-70" x="13844" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6C" x="14347" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="14646" y="0"></use><g transform="translate(15112,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-72" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="15781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="16311" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="16672" y="0"></use></g><g transform="translate(23633,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-75" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-62" x="1042" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-62" x="1471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-61" x="1901" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6E" x="2430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-64" x="3031" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="3554" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-74" x="4274" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-69" x="4635" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6D" x="4981" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-65" x="5859" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="6326" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-62" x="6795" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6C" x="7225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6F" x="7523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-63" x="8009" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-6B" x="8442" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/455316/&amp;xid=17259,15700023,15700186,15700190,15700256,15700259&amp;usg=ALkJrhgKwTnoKIE6HNPDW4PKG_Meg8a3Rg#MJMATHI-73" x="8964" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>b</mi><mi>i</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>8</mn><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>f</mi><mi>r</mi><mi>a</mi><mi>m</mi><mi>e</mi><msub><mtext>&nbsp;</mtext><mi>l</mi></msub><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>s</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><msub><mtext>&nbsp;</mtext><mi>r</mi></msub><mi>a</mi><mi>t</mi><mi>e</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mi>u</mi><mi>b</mi><mi>b</mi><mi>a</mi><mi>n</mi><mi>d</mi><mi>s</mi><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>b</mi><mi>l</mi><mi>o</mi><mi>c</mi><mi>k</mi><mi>s</mi></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> bitrate = \ frac {8 \ times frame \ _length \ times sample \ _rate} {subbands \ times blocks} </script></p><br>  <i><font color="#666666">SBC bit rate formula</font></i> <br><br><br>  For example, Dual Channel mode encodes channels separately, using the entire bitpool for each channel.  By causing the device to use the Dual Channel instead of the Joint Stereo, we get an almost doubled bitrate at the same maximum bitpool value: 617 kbps. <br>  In my opinion, the use of non-profile bitpool values ‚Äã‚Äãat the negotiation stage is a flaw in the A2DP standard, which led to an artificial limitation of the quality of the SBC.  It would be wiser to negotiate bitrate, not bitpool. <br><br>  These fixed Bitpool and Bitrate values ‚Äã‚Äãoriginate from a table with recommended values ‚Äã‚Äãfor high-quality audio.  But the recommendation is not a reason to be limited to these values. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cc5/5bf/c7d/cc55bfc7d4e0a7e9ca4aee331f6c9992.png" alt="Bluetooth SBC Profile Table"><br><br>  The A2DP v1.2 specification, which was active from 2007 to 2015, requires all decoders to work correctly with bitrates up to 512 kbps: <br><br><blockquote>  It is not necessary to ensure that it is possible to achieve the maximum bit rate.  The maximum bit rate is up to 320kb / s for mono, and 512kb / s for two-channel modes. </blockquote><br><br>  In the new version of the specification there is no limit on bitrate.  It is assumed that modern headphones, released after 2015 and supporting EDR, can support bit rates up to ‚âà 730 kbit / s. <br><br>  For some reason, the Linux stack of Linux (PulseAudio), Android, Blackberry, and macOS I tested have artificial limitations on the maximum value of the bitpool parameter, which directly affects the maximum bitrate.  But this is not the biggest problem, almost all headphones also limit the maximum bitpool number to 53. <br>  As I have already managed to make sure, most devices work fine on a modified Bluetooth stack with a bit rate of 551 kbps, without interruptions and cod.  But such a bitrate will never be matched under normal conditions, on conventional Bluetooth stacks. <br><br><h2>  Modifying Bluetooth Stack </h2>  In any Bluetooth-stack that is compatible with the A2DP standard, there is support for Dual Channel mode, but it is not possible to activate it from the interface. <br><br>  Let's add a switch to the interface!  I made patches for Android 8.1 and Android 9, which add full support for Dual Channel to the stack, add mode to the mode switch menu in the developer tools, and process SBC with Dual Channel support as if it were an additional codec, like aptX, AAC or LDAC ( Android calls this HD Audio) by adding a checkmark to the settings of a Bluetooth device.  Here's what it looks like: <br><br><img src="https://habrastorage.org/webt/xd/k_/nn/xdk_nnwukcz446jxexaes4pdscw.png" alt="image"><br><br>  <a href="https://review.lineageos.org/q/topic:bt-sbc-hd-dualchannel-pie%2B(status:open%2520OR%2520status:merged)">Patch for Android 9</a> <br>  <a href="https://review.lineageos.org/q/topic:bt-sbc-hd-dualchannel%2B(status:open%2520OR%2520status:merged)">Patch for Android 8.1</a> <br><br>  When you activate the checkbox, Bluetooth audio starts to be transmitted with a bit rate of <b>551 kbps</b> , if the headphones support the connection at a speed of 3 Mbps, or <b>452 kbps</b> , if the headphones support only 2 Mbps. <br><br>  This patch is included in the following alternative firmware: <br><ul><li>  <b>LineageOS</b> </li><li>  <b>Resurrection Remix</b> </li><li>  <b>crDroid</b> </li></ul><br><br><h2>  Where did 551 and 452 kbps come from? </h2>  Bluetooth dividing technology is designed to efficiently transmit large fixed-size packets.  Data transfer occurs by slots, the largest number of slots sent in one transmission is 5. There are also transfer modes using 1 or 3 slots, but not 2 or 4. In 5 slots, you can transfer up to 679 bytes at a connection speed of 2 Mbps and up to 1021 bytes at a speed of 3 Mbps, and in 3 - 367 and 552 bytes, respectively. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b86/6c9/653/b866c9653eeb255db44e7fd94a409a90.png" alt="image"><br><br>  If we want to transfer less data than 679 or 1021 bytes, but more than 367 or 552 bytes, the transfer will still take 5 slots, and the data will be transmitted in the same time, which reduces the transmission efficiency. <br><br><img src="https://habrastorage.org/webt/u_/9e/at/u_9eati7dqlaegfvhdkpmwxsnxq.png" alt="image"><br><br>  SBC in Dual Channel mode, on 44100 Hz audio with Bitpool parameters 38, 16 blocks in a frame, 8 frequency bands, encodes audio into frames of 164 bytes, with a bitrate of 452 kbit / s. <br>  Audio must be encapsulated in L2CAP and AVDTP transmission protocols, which take 16 bytes from the audio payload. <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><merror><mtext>\&amp;#xA0;begin&amp;#xA0;{align&amp;#xA0;*}&amp;#xA0;framelength&amp;#xA0;&amp;amp;&amp;#xA0;=&amp;#xA0;4&amp;#xA0;+&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{subbands&amp;#xA0;\&amp;#xA0;times&amp;#xA0;channels}&amp;#xA0;{2}&amp;#xA0;+&amp;#xA0;\\&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;begin&amp;#xA0;{cases}&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{blocks&amp;#xA0;\&amp;#xA0;times&amp;#xA0;channels&amp;#xA0;\&amp;#xA0;times&amp;#xA0;bitpool}&amp;#xA0;{8}&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;text&amp;#xA0;{&amp;#xA0;if&amp;#xA0;mono&amp;#xA0;or&amp;#xA0;dual&amp;#xA0;channel&amp;#xA0;mode}&amp;#xA0;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{subbands&amp;#xA0;+&amp;#xA0;blocks&amp;#xA0;\&amp;#xA0;times&amp;#xA0;bitpool}&amp;#xA0;{8}&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;text&amp;#xA0;{if&amp;#xA0;joint&amp;#xA0;stereo&amp;#xA0;mode}&amp;#xA0;\\&amp;#xA0;\&amp;#xA0;frac&amp;#xA0;{blocks&amp;#xA0;\&amp;#xA0;times&amp;#xA0;bitpool}&amp;#xA0;{8}&amp;#xA0;&amp;amp;&amp;#xA0;\&amp;#xA0;text&amp;#xA0;{if&amp;#xA0;stereo&amp;#xA0;mode}&amp;#xA0;\\&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{cases}&amp;#xA0;\&amp;#xA0;end&amp;#xA0;{align&amp;#xA0;*}</mtext></merror></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><span class="noError" aria-hidden="true" style="display: inline-block;">\&nbsp;begin&nbsp;{align&nbsp;*}&nbsp;framelength&nbsp;&amp;&nbsp;=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{subbands&nbsp;\&nbsp;times&nbsp;channels}&nbsp;{2}&nbsp;+&nbsp;\\&nbsp;&amp;&nbsp;\&nbsp;begin&nbsp;{cases}&nbsp;\&nbsp;frac&nbsp;{blocks&nbsp;\&nbsp;times&nbsp;channels&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{&nbsp;if&nbsp;mono&nbsp;or&nbsp;dual&nbsp;channel&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{subbands&nbsp;+&nbsp;blocks&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{if&nbsp;joint&nbsp;stereo&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{blocks&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{if&nbsp;stereo&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;end&nbsp;{cases}&nbsp;\&nbsp;end&nbsp;{align&nbsp;*}</span><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><merror><mtext>\&nbsp;begin&nbsp;{align&nbsp;*}&nbsp;framelength&nbsp;&amp;&nbsp;=&nbsp;4&nbsp;+&nbsp;\&nbsp;frac&nbsp;{subbands&nbsp;\&nbsp;times&nbsp;channels}&nbsp;{2}&nbsp;+&nbsp;\\&nbsp;&amp;&nbsp;\&nbsp;begin&nbsp;{cases}&nbsp;\&nbsp;frac&nbsp;{blocks&nbsp;\&nbsp;times&nbsp;channels&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{&nbsp;if&nbsp;mono&nbsp;or&nbsp;dual&nbsp;channel&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{subbands&nbsp;+&nbsp;blocks&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{if&nbsp;joint&nbsp;stereo&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;frac&nbsp;{blocks&nbsp;\&nbsp;times&nbsp;bitpool}&nbsp;{8}&nbsp;&amp;&nbsp;\&nbsp;text&nbsp;{if&nbsp;stereo&nbsp;mode}&nbsp;\\&nbsp;\&nbsp;end&nbsp;{cases}&nbsp;\&nbsp;end&nbsp;{align&nbsp;*}</mtext></merror></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> \ begin {align *} framelength & = 4 + \ frac {subbands \ times channels} {2} + \\ & \ begin {cases} \ frac {blocks \ times channels \ times bitpool} {8} & \ text { if mono or dual channel mode} \\ \ frac {subbands + blocks \ times bitpool} {8} & \ text {if joint stereo mode} \\ \ frac {blocks \ times bitpool} {8} & \ text {if stereo mode} \\ \ end {cases} \ end {align *} </script></p><br><br><br><br>  Thus, one audio transmission with 5 slots can accommodate 4 audio frames: <br><pre><code class="plaintext hljs">679 (EDR 2 mbit/s DH5) - 4 (L2CAP) - 12 (AVDTP/RTP) - 1 ( SBC) - (164*4) = 6</code> </pre> <br>  We contained 11.7 ms of audio data in the sent packet, which will be transmitted in 3.75 ms, and we have 6 unused bytes left in the package. <br>  If you slightly raise the bitpool, 4 audio frames can no longer be packaged in one package.  You'll have to send 3 frames at a time, which reduces transmission efficiency, reduces the amount of audio transmitted in one package, and will quickly lead to stuttering audio under poor radio conditions. <br><br>  In the same way, the 551 kbps bitrate for EDR 3 Mbps was selected: with Bitpool 47, 16 blocks per frame, 8 frequency bands, the frame size is 200 bytes, with a bit rate of 551 kbps.  In one package can hold 5 frames or 14.6 ms of music. <br><br>  The algorithm for calculating all the SBC parameters is quite complicated, you can easily get confused if you count it manually, so I made an interactive calculator to help those interested in: <a href="https://btcodecs.valdikss.org.ru/sbc-bitrate-calculator/">btcodecs.valdikss.org.ru/sbc-bitrate-calculator</a> <br><br><h2>  Why is all this necessary? </h2>  Contrary to popular opinion about the sound quality of the aptX codec, on some files it may produce worse results than SBC with a standard bit rate of 328 kbps. <br><br>  The SBC dynamically allocates quantization bits for frequency bands, acting on the ‚Äúfrom bottom to top‚Äù principle.  If the entire bit rate was used on the lower and middle frequencies, the upper frequencies will be cut off (instead of them there will be silence). <br>  aptX quantizes frequency bands with the same number of bits all the time, which is why it has a constant bitrate: 352 kbit / s for 44.1 kHz, 384 kbit / s for 48 kHz, and it cannot "transfer bits" to those frequencies that most need them.  Unlike SBC, aptX will not ‚Äúcut off‚Äù frequencies, but will add quantization noise to them, reducing the dynamic range of the audio, and sometimes introduce characteristic crackles.  SBC "eats the details" - discards the quietest areas. <br>  On average, compared to the SBC 328k, aptX introduces less distortion in music with a wide frequency range, but on music with a narrow frequency range and wide dynamic range, the SBC 328k sometimes wins. <br><br>  Consider a special case.  Spectrogram recording of the piano: <br> <a href=""><img src="https://habrastorage.org/webt/i9/uh/z1/i9uhz1ewchvoprxywldrtfknlom.jpeg" alt="image"></a> <br><br>  The main energy lies in frequencies from 0 to 4 kHz, and lasts up to 10 kHz. <br>  The spectrogram of a file compressed with aptX looks like this: <br> <a href=""><img src="https://habrastorage.org/webt/sx/3i/lw/sx3ilwm6riwrjelw-ofmljdd54m.jpeg" alt="image"></a> <br><br>  And this is what SBC 328k looks like. <br> <a href=""><img src="https://habrastorage.org/webt/ah/ob/br/ahobbramaxjmsr0htxagkiflomk.jpeg" alt="image"></a> <br><br>  It can be seen that the SBC 328k periodically completely turned off the range above 16 kHz, and consumed all the available bitrate for the bands below this value.  However, aptX introduced more distortions into the frequency spectrum heard by the human ear, as can be seen on the aptX spectrogram subtracted from the original spectrogram (the brighter, the more distortions): <br> <a href=""><img src="https://habrastorage.org/webt/_e/vj/gv/_evjgvlrkbymm5ptv5ymkn2orya.jpeg" alt="image"></a> <br><br>  While the SBC 328k less spoiled the signal in the range from 0 to 10 kHz, and the rest - cut: <br> <a href=""><img src="https://habrastorage.org/webt/-a/m6/23/-am623wsmq09jfcr80kmkjubp0u.jpeg" alt="image"></a> <br><br>  The 485k SBC bit rate was enough to save the entire frequency range, without turning off the bands. <br> <a href=""><img src="https://habrastorage.org/webt/xx/a0/pa/xxa0patcvltugsfjwxzmh_na_rm.jpeg" alt="image"></a> <br><br>  SBC 485k on this composition is significantly ahead of aptX in the range of 0-15 kHz, and with a smaller, but still noticeable difference - in 15-22 kHz (the darker, the less distortion): <br> <a href=""><img src="https://habrastorage.org/webt/yv/mi/7v/yvmi7vfj5-ot3ztrfv-gvx43yxy.jpeg" alt="image"></a> <br><br>  <a href="">Archive of original audio, SBC and aptX</a> . <br><br>  Switching to high-bit SBC, you get a sound, often superior to aptX, on any headphones.  On headphones that support an EDR connection of 3 Mbps, a 551 kbit / s bitrate gives a sound comparable to aptX HD. <br><br><h2>  And you can even more? </h2>  The patch for Android also has an option to further increase the bit rate for EDR devices 2 Mbps.  You can increase the bitrate from 452 kbps to 595 kbps, at the cost of reducing the stability of the transmission in difficult radio conditions. <br>  It is enough to set the variable persist.bluetooth.sbc_hd_higher_bitrate to 1: <br><pre> <code class="plaintext hljs"># setprop persist.bluetooth.sbc_hd_higher_bitrate 1</code> </pre> <br>  Extreme bit rate patch is currently accepted only in LineageOS 15.1, but not in 16.0. <br><br><h2>  Device Compatibility </h2>  SBC Dual Channel is supported by almost all headphones, speakers and car head units.  This is no wonder - the standard prescribes its support in any decoding devices.  There are a small number of devices on which this mode causes problems, but these are single instances. <br>  More details on compatible devices can be found at <a href="http://4pda.ru/forum/index.php%3Fshowtopic%3D914135">w3bsit3-dns.com</a> or <a href="https://forum.xda-developers.com/android/software-hacking/improve-bluetooth-audio-quality-t3832615">xda-developers</a> . <br><br><h2>  Comparing Sound Differences </h2>  I made a web service that encodes audio in SBC (as well as aptX and aptX HD) in real time, right in the browser.  With it, you can compare the sound of different SBC profiles and other codecs, without actually transmitting audio via Bluetooth, on any wired headphones, speakers, and your favorite music, and also change the encoding parameters directly during audio playback. <br>  <a href="https://btcodecs.valdikss.org.ru/sbc-encoder/">btcodecs.valdikss.org.ru/sbc-encoder</a> <br><br><h2>  Communication with Android developers </h2>  I wrote to many Bluetooth stack developers from Google, asking them to consider including patches in the main Android branch - AOSP, but did not receive a single answer.  My patches in <a href="https://android-review.googlesource.com/q/topic:bt-sbc-hd-dualchannel%2B(status:open%2520OR%2520status:merged)">the Gerrit patches for Android system were</a> also left without comments from anyone involved. <br>  I would be glad if they could help me in connection with the developers from Google and the implementation of SBC HD in Android.  The gerrit patch is already out of date (this is one of the earliest revisions), and I will update it if developers are interested in my changes (it's not easy for me to update it, I don't have Android Q compatible devices). <br><br><h2>  Conclusion </h2>  Users of smartphones with LineageOS, Resurrection Remix and crDroid firmware can be content with improved sound quality right now, just activate the option in the Bluetooth device settings.  Linux users can also get a higher SBC bitrate by installing a <a href="https://lists.freedesktop.org/archives/pulseaudio-discuss/2019-June/031168.html">patch from Pali Roh√°r</a> , which, among other things, adds support for aptX, aptX HD and FastStream codecs. </div><p>Source: <a href="https://habr.com/ru/post/455316/">https://habr.com/ru/post/455316/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455308/index.html">Perspective place</a></li>
<li><a href="../45531/index.html">Amarok 2.0 rc1 output</a></li>
<li><a href="../455310/index.html">Attacks on bypass channels: now not only PCs, but also smartphones are under attack (analytical review)</a></li>
<li><a href="../455312/index.html">One-bit full adder on unusual microcircuits</a></li>
<li><a href="../455314/index.html">What is a service network</a></li>
<li><a href="../455319/index.html">Workflow 3D artist. How not to drown in a ton of information. Part 1</a></li>
<li><a href="../455321/index.html">Home automation do-it-yourself</a></li>
<li><a href="../455331/index.html">How computers learned to recognize images incredibly well</a></li>
<li><a href="../455335/index.html">Little Python Fun # 3: Poetry</a></li>
<li><a href="../455337/index.html">Who added Python to the latest Windows update?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>