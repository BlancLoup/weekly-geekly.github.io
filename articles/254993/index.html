<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we "married" cloud PBX, GSM and realtors (part 4)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The fourth chapter of the post-industrial telecom saga about the chemical wedding of clouds, virtual PBX, cellular communication, real estate agency a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we "married" cloud PBX, GSM and realtors (part 4)</h1><div class="post__text post__text-html js-mediator-article">  The fourth chapter of the <a href="http://habrahabr.ru/company/altegro/">post-industrial telecom saga</a> about the chemical wedding of clouds, virtual PBX, cellular communication, real estate agency and now also geolocation services, which are now being actively tested, is somewhat delayed, contrary to promises. <br><br>  The task that we solve throughout the 3 previous series is rather simple ideologically, but technically confused: with the help of a <a href="http://altegrocloud.ru/">cloud-based virtual office</a> and special FMC SIM cards, we want to manage the work of a large real estate agency, automate sales and, in addition, control Conversations from mobile traveling agents-realtors, who constantly strive to grab their piece of cake and behave incorrectly, especially when it comes to the fact that it would be nice to report on transactions completed over the past month.  It is understandable: when making a transaction, the payment for renting an apartment often occurs in the kitchen and practically without witnesses, the realtor seeks to keep the interest for work. <br><br>  <b>Briefly present the main characters of the previous series:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/69f/d89/402/69fd8940287f8bd2127336db66a5c6c9.png" alt="image"><br><br><a name="habracut"></a><br><br>  <b>- The head of a real estate agency</b> , an all-seeing eye, who wants to control everything and everyone, record conversations, pry and eavesdrop, truthfully on completely legal grounds and completely official.  He invests in advertising, websites, office rent and salary, so he wants to make a profit.  To increase profits, you need constant control over employees.  Suffering from chronic insomnia. <br><br>  <b>- A cunning realtor</b> , a man on a mobile phone who actively moves around the city, meets with clients and homeowners and, in fact, tries to make money to both the manager and himself.  Often about the head forgets.  Prone to amnesia. <br><br>  <b>- The owner of the apartment</b> , the grandmother from the 2nd floor, who, after reading the announcement ‚Äúa young family will rent an apartment in your house‚Äù, starts calling the cellular number indicated in the text, sincerely believing that this is a mobile young one, necessarily married and decent , Slav, I.I.  Ivanova, and not just another real estate agency.  He loves his grandchildren, who are ready to give all the money received from Ivanov. <br><br>  <b>- A young family</b> , a group of persons consisting of 2-3 people interested in living in a foreign territory, paying for the entire banquet, in which the three previous characters are involved.  Suspicious and picky, the only and main source of profit in the complicated business model of realtors. <br><br>  Heroes must be able to control, and so that everyone is satisfied with the result of the transaction and, above all, the head of the agency. <br><br>  The main requirements of the customer (director of real estate agency) at the time of writing this part of the story we have already implemented: we launched a virtual PBX, integrated it with the SIM cards of one of the mobile operators, began to record conversations from mobile and record them in statistics, learn how to Calls to cellular numbers did not come to the cellular phones themselves, but in the scenario of the telephone platform, the participants in the process did not know the real cell phones when they called each other, but communicated using short internal numbers and all that was digital  ste recorded in the CRM-system for the complete and total accounting. <br><br>  The platform is ready for implementation and use, it remains to solve one of the most difficult issues: what to do with existing SIM cards of realtors, whose numbers are known to both apartment owners and young families.  It‚Äôs just that you don‚Äôt refuse them, but it‚Äôs wrong to leave them to work - these are additional expenses (SIM cards are corporate and you have to pay for them) and, most importantly, a huge hole in the total accounting system - we cannot control calls to these SIM cards, calls they are not controlled by them.  In addition, we have a certain number of SIM cards, which were inherited from already escaped realtors, but we keep them safe, because they continue to call. <br><br>  <b>The task is not simple, but we will solve it.</b>  <b>We will solve with the help of such a script:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2b6/99a/d4c/2b699ad4c39acf9b8db602511d7a27ea.png" alt="image"><br><br>  To run all this, we had to tinker.  The bottom line: <br><br>  - select a separate, service, city phone number and direct it to our platform via SIP <br><br>  - from SIM-cards of already dismissed agents-realtors, we set up unconditional forwarding of all calls to this service number <br><br>  - we also set up forwarding to the same number from SIM cards of working realtors, we pick up SIM cards ourselves, and in return we issue new FMC SIM cards <br><br>  - the service number is routed to special virtual PBX scenarios that route calls depending on the number from which the redirection came <br><br>  Then a certain mysterious entity appears in the scheme - SIP Diversion Header, which is nothing more than information about the source of the redirection (the phone number from which the call to our service number was redirected) in the SIP INVITE.  This is what you need! <br><br>  What do we get?  We get a very beautiful scheme: <br><br>  we took the old sims from the agents, gave them new ones, but at the same time we know that one number is the number of the realtor Natasha, which no longer works, the other number is the number of the realtor Boris, who settled down quite recently, etc.  Very valuable information, on the basis of which it will be possible to preserve the communication scheme already established in the agency.  With the help of Diversion Header, we understand from which mobile number the call was diverted.  Next is a matter of technology: we enter a list of old numbers in the database of our PBX and create scripts that take into account this value and display the Diversion Header in the incoming call card. <br><br>  If this is a call to the number of an already dismissed employee, then we will route it to the call center operator, who says carelessly and cheerfully that Natasha‚Äôs realtor has been promoted and is now working in another department, and if the respected client needs something, execute any other employee. <br><br>  If this is a call to the number of active and honest realtor, who continues to bring profit to the agency, then such a call is routed to a new, integrated into the PBX, SIM card without any additional conditions (it is clear that all this is now recorded and included in the statistics) - we get calls to old numbers, and we accept them on new sims. <br><br>  A separate script serves incoming calls to SIM cards of dismissed employees during off-hours: since we do not want to scare grandmothers and young mothers and when calling to the mobile to issue an IVR ‚ÄúHello, you called ...‚Äù, in the evenings and on weekends we issue a standard IVR cellular network "The subscriber is not responding ...", which was downloaded as an mp3.  When the call center operator comes to work, he will see such a missing statistic in the section and work it out. <br><br>  So here, in a rather utilitarian way, we solved the problem of replacing old SIM cards with new ones.  The project is ready to launch.  But that's not all: while all the above-described tricks were introduced, there was a clear understanding that the project can be made even more beautiful - we want not only to listen to the recordings of mobile conversations, to see them in statistics and to hide the interested parties in every possible way from each other, we also want observe what is happening on Yandex Maps.  Realtor, you are now under a hood at all!  What is needed for this?  For this we need geolocation.  Fine!  Almost any mobile operator provides this service, but we want to integrate geolocation into our platform, add our own features and place all this in our personal account, and not send customers to watch SIM cards on the site of the cellular operator.  This is very inconvenient, and not always beautiful. <br><br>  Good and close relations with mobile workers worked here in our favor: after intensive negotiations, we got access to the operator's geolocation API, whose SIM cards we use in <a href="http://altegrocloud.ru/">AltegroCloud</a> . <br><br>  Right now it's all actively being tested and verified.  The most remarkable thing is that all this works and works practically as it should: <br><br>  - we see our mobile employees on the map <br><br>  - we can generate reports on the movements of our employees for a selected period of time <br><br>  - and finally, which is quite cool, we can open the map in your account, see the geo-tags if you need to find a realtor on the map and call him with a simple mouse click <br><br>  This is what our geo-MVP looks like with which the new ‚Äúgeofich‚Äù is being tested and which we quickly sketched <br><br>  <b>Engineer Anatoly drove home from work, and we followed him:</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/423/183/fcd/423183fcdb6c43f16ab6ad647d24d0e6.png" alt="image"><br>  <b>But we found Anatoly on the map and is about to call him (green handset):</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c6/e4f/4ad/0c6e4f4addb7950effa53722f7aa71ab.png" alt="image"><br><br>  The service becomes quite convenient, but it‚Äôs still rather early in production - the tests continue and there will be a lot of them.  We very much hope that everything will turn out and the next chapter of the saga will be about how the director of the agency not only listens to his employees, but also observes them on the map in the personal office of our telephone service. <br><br>  To be continued‚Ä¶ <br><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/254993/">https://habr.com/ru/post/254993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254981/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ154 (March 30 - April 5, 2015)</a></li>
<li><a href="../254983/index.html">Product Design Digest March 2015</a></li>
<li><a href="../254985/index.html">User videos: Windows 3.11 inside ReactOS</a></li>
<li><a href="../254989/index.html">Android Volley Loader. Moving toward the library</a></li>
<li><a href="../254991/index.html">Digital archeology: how long-lost data is saved</a></li>
<li><a href="../254995/index.html">Resuscitation of TP-LINK 3020 router</a></li>
<li><a href="../255001/index.html">Difficult times for free-to-play, a little more about Apple Watch, console revenue - and other news of the week for a mobile developer</a></li>
<li><a href="../255003/index.html">MMAS ant algorithm</a></li>
<li><a href="../255005/index.html">Quaternion rotation notes</a></li>
<li><a href="../255007/index.html">In the wake of WinHEC (Hardware Engineering Conference) 2015 - Windows 10, IoT, AllJoyn, clouds, and more</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>