<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>1C + offline maps on Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 
 We continue our acquaintance with the FBA Toolkit framework and consider another example of developing an android client for 1C. Our applicat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>1C + offline maps on Android</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br>  We continue our acquaintance with the FBA Toolkit framework and consider another example of developing an android client for 1C.  Our application "Audit point of sale" will load the visit route from 1C and display it on the map.  Offline maps are used based on the OpenStreetMap map service. <br><a name="habracut"></a><br>  It is assumed that you have already installed and configured all the necessary developer tools.  If this is not the case, see the <a href="http://habrahabr.ru/post/176371/">previous section</a> .  The “FBA Toolkit” framework should be no lower than version 1.03, update <a href="http://profi1c.ru/products/fba_toolkit/fba-toolkit-byistryiy-start.html">the 1C configuration</a> and the Android project <a href="https://xp-dev.com/svn/fba_toolkit_public/ru_profi1c_fba/">ru_profi1c_fba</a> from the SVN repository. <br><br><h4>  Server part (in 1C database) </h4><br>  1. In the 1C information base we create 2 reference books that will act as a data source for an example. <br><br><img src="https://habrastorage.org/storage2/0c7/724/79a/0c772479a14cce06fb9c71f9a26dfc54.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Details of the reference "point of sale": <br><ul><li>  "Latitude" and "Longitude" contain the coordinates of this point, the number 10.6 </li><li>  "Photo" link to the directory "Storage of additional information" - a link to the main image; </li><li>  all other details of the string type. </li></ul><br>  Details of the directory "Additional Information Store": <br><ul><li>  The “object” of a composite type including contains the type “Directory Reference. Trading Point”, which determines the object to which the additional information belongs.  In the mobile application is not used. </li><li>  “Storage”, “Value Storage” type, contains the image itself. </li></ul><br>  2. The exchange plan “Mobile Application Auditing Points” has also been added. It includes only these two directories, auto-registration of changes is enabled. <br><br>  3. We fill out reference books with some test information, in this example they are pizzerias in the center of Moscow (data are taken from open sources). <br><br><img src="https://habrastorage.org/storage2/e1e/db0/2bb/e1edb02bbe2dd21d837f4b861252d288.png"><br><br>  For some points images are loaded.  The code to save the value in the storage is standard for 1C: <br><pre><code class="1c hljs"><span class="hljs-type"><span class="hljs-type"></span></span> = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>();  = <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(<span class="hljs-type"><span class="hljs-type"></span></span>, <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>(<span class="hljs-number"><span class="hljs-number">9</span></span>));</code> </pre> <br>  The form of the element of the directory “Additional Information Store”, “FileName” contains the path to the downloaded image. <br><br>  4. Create a mobile app “Audit of an outlet”.  We add our reference books to the metadata tree. <br><br><img src="https://habrastorage.org/storage2/890/bac/dcf/890bacdcf61480b510848776bf634684.png"><br>  Just for the sake of convenience, the names of details and objects from the Latin alphabet are translated into English. <br><br><img src="https://habrastorage.org/storage2/253/333/c51/253333c513d524f5947b0a6d79b9864a.png"><br><br>  The exchange scheme is configured in such a way as to unload only the objects changed in 1C: <br><ul><li>  The flag for using the MobileApplement Points exchange plan is set. </li><li>  when changing any “Point of Sale” in 1C, it will be transferred to the mobile application; </li><li>  Additional filtering has been imposed on the “Storage of additional information” directory: transfer changed information only to outlets.  This is done by a query: </li></ul><br><pre> <code class="1c hljs"> .   <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ..    . = <span class="hljs-meta"><span class="hljs-meta">&amp;  ..  .</span></span></code> </pre><br>  where “Exchange Node” is a predefined parameter, at the time of the exchange it will contain the value of the installed node for the mobile employee (below we will show where it is installed). <br><br>  5. We generate the Android mobile application template.  The cost and procedure for purchasing a license are described <a href="http://profi1c.ru/fba-toolkit-price">here</a> .  How to enter the obtained license data in 1C is written <a href="http://profi1c.ru/products/fba_toolkit/switch_to_commercial_version.html">here</a> . <br><br><img src="https://habrastorage.org/storage2/cd2/2c4/7d2/cd22c47d2ef684e716471a3a22b0f9bc.png"><br><br>  You can also use the test license: <br>  client_id: TEST-CLIENT-000 <br>  client_name: test-client-name <br>  client_pwd: 31qX9OqZ_V <br>  lisence_id: f7a42162-e27f-4246-a89b-b69c02387740 <br>  Only in this case, it is not recommended to change the name of the mobile application package: <b>ru.profi1c.samples.audit.salespoint</b> . <br><br>  6. In the directory “Mobile employees” add our application for the employee, which is used to test the exchange.  Check out the “Exchange Hub” column, this is a new element of our exchange plan. <br><br><img src="https://habrastorage.org/storage2/696/2f5/457/6962f5457ddd4593b46dde4c778ab2a1.png"><br><br>  As a rule, for each employee creates its own exchange node.  In this case, it turns out that changes in data in 1C will be automatically registered for all nodes (all mobile employees), and during the exchange each mobile client will “take away its portion of data”. <br>  This parameter can be used in queries for data sampling, as in our case with the directory “Storage of additional information”. <br><br>  It is also recommended for each mobile application to create a separate exchange plan, so as not to cause confusion. <br><br>  The preparatory work in 1C has been completed, to test the exchange rules, you can use the “Test exchange with a mobile application” processing, more details <a href="http://profi1c.ru/products/fba_toolkit/primer-3-zakazyi-pokupatelya-chast-1.html/2">here</a> .  In 1C, nothing more needs to be done, the FBA takes over all the routine work of organizing the exchange.  The programmer can concentrate on developing a mobile application. <br><br><h4>  Android mobile application </h4><br>  1. Create a new project based on the generated template.  To do this in Eclipse, you must perform an import, as described in detail <a href="http://profi1c.ru/products/fba_toolkit/primer-1-zadachi-dlya-mobilnogo-sotrudnika-chast-1.html/2">here</a> . <br><br>  2. Make a card.  The FBA includes helper classes that make it easier for a beginner to work with <a href="http://code.google.com/p/mapsforge/">Mapsforge</a> offline maps.  One of these classes is BaseRouteMapActivity, which is designed to display and navigate route points.  We will use it. <br><br>  2.1 Create your own class, the successor from BaseRouteMapActivity: <br><div class="spoiler">  <b class="spoiler_title">Show</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MapsforgeRouteMap</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseRouteMapActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* *       ( )    *     */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> DEF_LOCATION_MIN_DISTANCE = <span class="hljs-number"><span class="hljs-number">500</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* *  ,   ,    *   . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> DEF_LOCATION_MIN_TIME = <span class="hljs-number"><span class="hljs-number">5000</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-comment"><span class="hljs-comment">//,   private static final double DEFAULT_GEOPOINT_LAT = 55.755831; private static final double DEFAULT_GEOPOINT_LNG = 37.617673; //  private static final String MAP_FILE = "ru_moscow.map"; private MapView mMapView; @Override protected void onCreate(Bundle savedInstanceState) { super.onCreate(savedInstanceState); setContentView(R.layout.activity_route_map); init(); } private void init() { mMapView = (MapView) findViewById(R.id.mapView); //  onCreateMapView(mMapView); } @Override public File getMapFile() { return new File(getAppSettings().getBuckupDir(),MAP_FILE); } @Override public GeoPoint getMapCenterPoint() { return MapHelper.toGeoPoint(DEFAULT_GEOPOINT_LAT, DEFAULT_GEOPOINT_LNG); } @Override public int getLocationMinDistance() { return DEF_LOCATION_MIN_DISTANCE; } @Override public long getLocationMinTime() { return DEF_LOCATION_MIN_TIME; } @Override public boolean showCurrentPosition() { return true; } @Override public boolean requestLocationUpdates() { return true; } @Override protected void onRouteItemSelect(RouteOverlayItem&lt;?&gt; item) { } @Override public void onLocationChanged(Location location) { } }</span></span></code> </pre></div></div><br>  We will display the map of Moscow, which must be placed on the emulator in the <i>mnt / sdcard / backup / &lt;package name&gt;</i> directory.  This directory will be created automatically when you first start the program.  Where to get the map file or how to create it yourself, see the end of the article. <br><br>  At launch, our map will be centered on the coordinates passed in the getMapCenterPoint () method.  The showCurrentPosition () function should return true if you go to display a marker with your current position. <br>  If the requestLocationUpdates () method turns on coordinate tracking, then the onLocationChanged handler will be called upon changing.  Settings for the update frequency of coordinates are set by getLocationMinDistance () and getLocationMinTime ().  By default, both providers are used (GPS and NETWORK) to get coordinates, you can change it in BaseMapActivity because the source code is open. <br><br>  In the activity_route_map.xml layout we place the map element: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">org.mapsforge.android.maps.MapView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/mapView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">org.mapsforge.android.maps.MapView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In principle, this is enough to display the map.  The map also displays a marker with the current position and it is possible to handle the event when the coordinates change. <br><br>  2.2 Adding a layer with route points is performed using the addRouteOverlay method, to which the list of List &lt;RouteOverlayItem&gt; elements is passed.  T is an extra type.  the data stored with the item, in your case, CatalogSalesPoint.  Prepare a list of our outlets: <br><div class="spoiler">  <b class="spoiler_title">Show</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initDummyRoute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//DAO        mStorageDao = new CatalogAddInfoStorageDao(getConnectionSource()); mSalesPointDao = new CatalogSalesPointDao(getConnectionSource()); //     CatalogSalesPointDao salePointDao = new CatalogSalesPointDao(getConnectionSource()); List&lt;CatalogSalesPoint&gt; lst = salePointDao.select(); //       routeItems = new ArrayList&lt;RouteOverlayItem&lt;CatalogSalesPoint&gt;&gt;(); //  ,      final double lng = DEFAULT_GEOPOINT_LNG; double lat = DEFAULT_GEOPOINT_LAT; int count = lst.size(); for (int i = 0; i &lt; count; i++) { CatalogSalesPoint salesPoint = lst.get(i); boolean movable = (salesPoint.lat == 0 || salesPoint.lng == 0); int resIdDrawable = R.drawable.fba_map_maker_green; GeoPoint geoPoint = new GeoPoint(salesPoint.lat, salesPoint.lng); if (movable) { resIdDrawable = R.drawable.fba_map_marker_red; lat -= 0.003f; geoPoint = new GeoPoint(lat, lng); } //     Drawable marker = MapHelper.makeNumberedMarker(this, resIdDrawable,i + 1); RouteOverlayItem&lt;CatalogSalesPoint&gt; routePoint = new RouteOverlayItem&lt;CatalogSalesPoint&gt;( geoPoint, marker, salesPoint); routePoint.setMovable(movable); routePoint.setOrdinal(i + 1); routeItems.add(routePoint); } Drawable defaultMarker = getResources().getDrawable(R.drawable.fba_map_marker_orange); addRouteOverlay(mMapView, routeItems, defaultMarker); }</span></span></code> </pre></div></div><br>  and add a call to this method in init (). <br><br>  Here, all the elements of the Point of Sale directory are selected from the local database and added to the collection of displayed items.  And for points that have coordinates set at 1C, the marker will be green.  Points without coordinates are placed in the center of the map with a red marker.  The user can move them around the map in order to clarify the coordinates. <br><br>  2.3 Let's add a response to a click on a marker to the onRouteItemSelect handler: <br><pre> <code class="java hljs">CatalogSalesPoint salesPoint = (CatalogSalesPoint) item.getData(); inflatePopup(salesPoint);</code> </pre><br>  Fields of the class and the method that displays additional information about the outlet: <br><div class="spoiler">  <b class="spoiler_title">Show</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ObjectView mSalesPointView, mFotoStorageView; <span class="hljs-comment"><span class="hljs-comment">/* *       (  ) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> String[] fields = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[] { CatalogSalesPoint.FIELD_NAME_DESCRIPTION, CatalogSalesPoint.FIELD_NAME_ADRESS, CatalogSalesPoint.FIELD_NAME_PHONE, CatalogSalesPoint.FIELD_NAME_SITE }; <span class="hljs-comment"><span class="hljs-comment">/* *  view-    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] ids = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[] { R.id.tvDescription, R.id.tvAdress, R.id.tvPhone, R.id.tvSite}; <span class="hljs-comment"><span class="hljs-comment">/* *            */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inflatePopup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(CatalogSalesPoint salesPoint)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> SQLException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (CatalogSalesPoint.isEmpty(salesPoint.foto)) { mFotoStorageView.setVisibility(View.GONE); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    mStorageDao.refresh(salesPoint.foto); mFotoStorageView.build(salesPoint.foto, getHelper(), new String[] { CatalogAddInfoStorage.FIELD_NAME_STORAGE }, new int[] { R.id.ivFoto }); mFotoStorageView.setVisibility(View.VISIBLE); } mSalesPointView.build(salesPoint, getHelper(), fields, ids); }</span></span></code> </pre></div></div><br>  To display the pop-up window, the map_popup.xml layout is used (the markup is partially given): <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ru.profi1c.engine.widget.ObjectView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/ovSalesPoint"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ru.profi1c.engine.widget.ObjectView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/ovFotoStorage"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/ivFoto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ru.profi1c.engine.widget.ObjectView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvDescription"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvAdress"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvSite"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:autoLink</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"web"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvPhone"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:autoLink</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"phone"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ru.profi1c.engine.widget.ObjectView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  The layout displays information on a single outlet, the details of “Name”, “Address”, “Site” and “Phone” are automatically projected onto TextView-elements in <i>mSalesPointView.build (...)</i> . <br>  To display the photo, use the subordinate object ovFotoStorage with a child ImageView.  The photo is read from the base and projected onto the ImViewView in the <i>mFotoStorageView.build</i> method <i>(...)</i> . <br>  And since the “Photo” requisite stores only a link to the “Additional information storage” reference book, it must first be considered the <i>refresh</i> method. <br><br>  Initialization is added to the method in init () <br><pre> <code class="java hljs">mSalesPointView = (ObjectView) findViewById(R.id.ovSalesPoint); mFotoStorageView = (ObjectView) findViewById(R.id.ovFotoStorage);</code> </pre><br>  The layout of map_popup.xml can be set as custom for Toast, but in this example it is embedded in the main layout of activity_route_map.xml: <br><div class="spoiler">  <b class="spoiler_title">Show</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">org.mapsforge.android.maps.MapView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/mapView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fill_parent"</span></span></span><span class="hljs-tag"> &gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">org.mapsforge.android.maps.MapView</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">include</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginRight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_marginTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">layout</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@layout/map_popup"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:visibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"gone"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br>  For visibility control methods are used: <br><div class="spoiler">  <b class="spoiler_title">Show</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closePopup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mSalesPointView.getVisibility() == View.VISIBLE){ mSalesPointView.setVisibility(View.GONE); } } <span class="hljs-comment"><span class="hljs-comment">/* *    */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showPopup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(mSalesPointView.getVisibility() != View.VISIBLE){ mSalesPointView.setVisibility(View.VISIBLE); } }</code> </pre></div></div><br>  The pop-up message is hidden by clicking on it, and is displayed when you click on the point marker. <br><br>  The application is ready, run it on the emulator, configure the authorization parameters (as in 1C) and exchange with the database.  Example of the application: <br><br><img src="https://habrastorage.org/storage2/418/883/728/4188837281e50be293fe49a8ce8a56dc.png"><br><br>  Clicking on the phone number will open the standard "dialer", and a click on the link will launch the browser.  This behavior is achieved by simply setting the <i>android: autoLink property</i> for TextView. <br><br>  The full sample code is available in the SVN <a href="https://xp-dev.com/svn/fba_toolkit_public/samples/fbaSampleAuditPoint/">repository</a> .  Additionally, it shows how to save the coordinates of the moved points and update the marker. <br><br><h5>  Where to get cards </h5><br>  We plan to place some maps <a href="http://profi1c.ru/fba-toolkit-maps-mapsforge">on our website</a> , priority for cities (regions) uncovered with sufficient detail on Google Maps and maps prepared for FBA clients.  Brief instructions for creating a map file are given there. <br><br>  That's all, with other examples you can find on the site <a href="http://profi1c.ru/">http://profi1c.ru</a> . <br>  I hope I managed to at least a little dispel the myth that the development of mobile business applications is "difficult, expensive and time consuming." </div><p>Source: <a href="https://habr.com/ru/post/184978/">https://habr.com/ru/post/184978/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../184966/index.html">Home mini climate control do-it-yourself</a></li>
<li><a href="../184968/index.html">Rovnix bootkit update. Article translation</a></li>
<li><a href="../184970/index.html">Driver for PostgreSQL on Node.js</a></li>
<li><a href="../184972/index.html">Instead of passwords tattoo and ... pills</a></li>
<li><a href="../184974/index.html">Please support the symbol of domestic currency</a></li>
<li><a href="../184982/index.html">SamMobile presented Android 4.3 for the smartphone Galaxy S4 Google Play edition</a></li>
<li><a href="../184986/index.html">Analysis of the resources of the old quest Harvester '96</a></li>
<li><a href="../184988/index.html">Cyber ​​Security. Weekly Review June 17 - June 23, 2013</a></li>
<li><a href="../184990/index.html">[ANNOUNCEMENT] High-capacity battery [HLI-Z10XL] 3800mAh for BlackBerry Z10 (4G and 3G) + battery case (3000mAh)</a></li>
<li><a href="../184992/index.html">Appeared the first renders of the London headquarters of Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>