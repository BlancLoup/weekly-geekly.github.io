<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Passing anonymous objects to the View</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The idea is to use the model with a new, more convenient dynamic syntax. The main limitation here is that you cannot simply pass an anonymous object a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Passing anonymous objects to the View</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i2.asp.net/common/www-css/i/mvc-logo-landing-page.png?cdn_id=11242009_1" align="left"><br>  The idea is to use the model with a new, more convenient dynamic syntax.  The main limitation here is that you cannot simply pass an anonymous object as a model, because anonymous types have an access modifier internal. <br><br><a name="habracut"></a><br>  Suppose we are trying to write this code in the controller: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> HomeController : Controller <br> { <br> <font color="#0000ff">public</font> ActionResult Index() <br> { <br> <font color="#0000ff">return</font> View( <br> <font color="#0000ff">new</font> <br> { <br> Message = <font color="#A31515">"Welcome to ASP.NET MVC!"</font> , <br> Date = <font color="#2B91AF">DateTime</font> .Now <br> }); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Notice that we pass an anonymous object to the model.  The main reason for this is to avoid creating the required external ViewModel type.  Obviously, this is a somewhat controversial point, but it should look simpler than such an alternative: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">ViewData[ <font color="#A31515">"Message"</font> ] = <font color="#A31515">"Welcome to ASP.NET MVC!"</font> ; <br> ViewData[ <font color="#A31515">"Date"</font> ] = <font color="#2B91AF">DateTime</font> .Now; <br> <font color="#0000ff">return</font> View(); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Then we modify the view so that it has <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">Inherits= <font color="#A31515">"System.Web.Mvc.ViewPage&lt;dynamic&gt;"</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Ideally, this should allow us to write something like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">asp:Content</font> <font color="#ff0000">ID</font> <font color="#0000ff">="indexContent"</font> <font color="#ff0000">ContentPlaceHolderID</font> <font color="#0000ff">="MainContent"</font> <font color="#ff0000">runat</font> <font color="#0000ff">="server"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">h2</font> <font color="#0000ff">&gt;</font> <font>&lt;%</font> = Model.Message <font>%&gt;</font> <font color="#0000ff">&lt;/</font> <font color="#800000">h2</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> The date is <font>&lt;%</font> = Model.Date <font>%&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">p</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">asp:Content</font> <font color="#0000ff">&gt;</font> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  But by default dynamic binder will not let us do it! <br><br>  Unfortunately, if you try to run this code, it will be: <br>  <b>error: Microsoft.CSharp.RuntimeBinder.RuntimeBinderException: '&lt;&gt; f__AnonymousType1 &lt;system.DateTime&gt; .Message' is inaccessible due to its protection level</b> <br>  The reason for this anonymous type in the controller is internal, so that it can only be accessed from the assembly in which it is defined.  Since the view is compiled separately, dynamic binder complains that it cannot go beyond this assembly.  But you can simply write your own DynamicObject, which binds through private reflection. <br><br>  Here we are going to write not only our DynamicObject, but also our DynamicViewPage, which uses it.  Here is the full implementation: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> DynamicViewPage : ViewPage { <br> <font color="#008000">//         dynamic</font> <br> <font color="#0000ff">public</font> <font color="#0000ff">new</font> dynamic Model { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">protected</font> <font color="#0000ff">override</font> <font color="#0000ff">void</font> SetViewData(ViewDataDictionary viewData) { <br> <font color="#0000ff">base</font> .SetViewData(viewData); <br> <br> <font color="#008000">//   ,   private    </font> <br> Model = <font color="#0000ff">new</font> ReflectionDynamicObject() { RealObject = ViewData.Model }; <br> } <br> <br> <font color="#0000ff">class</font> ReflectionDynamicObject : DynamicObject { <br> <font color="#0000ff">internal</font> <font color="#0000ff">object</font> RealObject { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">bool</font> TryGetMember(GetMemberBinder binder, <font color="#0000ff">out</font> <font color="#0000ff">object</font> result) { <br> <font color="#008000">//   </font> <br> result = RealObject.GetType().InvokeMember( <br> binder.Name, <br> BindingFlags.GetProperty | BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic, <br> <font color="#0000ff">null</font> , <br> RealObject, <br> <font color="#0000ff">null</font> ); <br> <br> <font color="#008000">//   true,   InvokeMember  ,  -   </font> <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  As you can see, everything is simple.  All we need to do is find out the value of the property using private reflection.  That's all, it remains only to use it as our base class for View. <br>  <b>&lt;% @ Page Language = "C #" MasterPageFile = "~ / Views / Shared / Site.Master" Inherits = "MvcHelpers.DynamicViewPage"%&gt;</b> <br><br></div><p>Source: <a href="https://habr.com/ru/post/79363/">https://habr.com/ru/post/79363/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../79357/index.html">My Hi-Fi PC</a></li>
<li><a href="../79358/index.html">Google Chrome got its own clipper</a></li>
<li><a href="../79359/index.html">Exclusive - price on Maki 1985</a></li>
<li><a href="../79360/index.html">Wireless Mesh Network or IEEE 802.11s standard (version 1.0)</a></li>
<li><a href="../79362/index.html">Nokia 6700 Classic user test: beauty requires sacrifice</a></li>
<li><a href="../79365/index.html">Android Soft. Part 1: IM, book reader, system utilities</a></li>
<li><a href="../79368/index.html">Educational trends</a></li>
<li><a href="../79371/index.html">Semantic web - what can we do now</a></li>
<li><a href="../79373/index.html">Higher education. State of affairs - critical</a></li>
<li><a href="../79374/index.html">Letter to Santa Claus</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>