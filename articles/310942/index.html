<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ultralight BDD: Little Mechanization of Stand-Alone Tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The topic of offline testing is a long-standing, venerable, disassembled to the bone. It seems that after the excellent book of Roy Osherow there is n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ultralight BDD: Little Mechanization of Stand-Alone Tests</h1><div class="post__text post__text-html js-mediator-article"><p>  The topic of offline testing is a long-standing, venerable, disassembled to the bone.  It seems that after the excellent <a href="http://www.ozon.ru/context/detail/id/26230428/">book of Roy Osherow</a> there is nothing special to say.  But in my opinion there is some imbalance in the available tools.  On the one hand, monsters like <a href="http://www.specflow.org/">SpecFlow</a> , with a huge overhead for the ability to write test-specifications in quasi-natural language, on the other - the Chelyabinsk severity of old-school frameworks like <a href="http://www.nunit.org/">NUnit</a> .  What is missing?  A tool for a concise, expressive, easy-to-read test record, for convenience and orthogonality similar to libraries for creating fakes, such as <a href="https://fakeiteasy.github.io/">FakeItEasy</a> , or for checking statements like <a href="http://www.fluentassertions.com/">FluentAssertion</a> . </p><br><a name="habracut"></a><br><p>  At the moment I am trying to create such a tool. </p><br><h1>  Bdd ax </h1><br><p>  Here is a typical test using my microbibliography: </p><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenSelfUsableWhenDisposeThenValueShouldBeDisposed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Given(A.Fake&lt;IDisposable&gt;().ToUsable()). When(_ =&gt; _.Dispose()). Then(_ =&gt; _.Value.ShouldBeDisposed()); }</code> </pre> <br><p>  The FakeItEasy and FluentAssertions libraries are also involved, not as dependencies, but each for solving their own problems (fake and claims validation). <br>  The equivalent code in the old school style is: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenSelfUsableWhenDisposeThenValueShouldBeDisposed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Arrange var usable = A.Fake&lt;IDisposable&gt;().ToUsable(); // Act usable.Dispose(); // Assert usable.Value.ShouldBeDisposed(); }</span></span></code> </pre> <br><h1>  Support mocks </h1><br><p>  But that is not all.  Suppose we have a mock - a fake, for which, after executing the test script, we make verification of statements.  According to Osher√≥w there should be no more than one per test. </p><br><p>  Code in new style: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenNeutralUsableWhenDisposeThenValueShouldBeNotDisposed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Given(A.Fake&lt;IDisposable&gt;()). And(mock =&gt; mock.ToNeutralUsable()). When(_ =&gt; _.Dispose()). ThenMock(_ =&gt; _.ShouldBeNotDisposed()); }</code> </pre> <br><p>  Using the And method, the result of the previous Given is fixed as mock, and the result of the delegate‚Äôs work becomes the test object.  This is logical, since the mock is used in the test object and it is natural to create it earlier. </p><br><p>  Often statements include both mock and test object.  This option is also supported: </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenObjectWhenToUsableThenValueShouldBeSameAsObject</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Given(A.Fake&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;()). And(mock =&gt; mock.ToUsable(A.Dummy&lt;IDisposable&gt;())). When(_ =&gt; _). Then((_, mock) =&gt; _.Value.Should().Be.SameAs(mock)); }</code> </pre> <br><h1>  Exception support </h1><br><p>  Very often, a test in which a checked statement includes throwing an exception looks very cumbersome and unreadable against the background of "clean" options.  The new approach allows checking exceptions both succinctly and stylistically consistently with ‚Äúsmooth‚Äù tests. </p><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenUsableWhenDisposeTwiceThenShouldBeException</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Given(A.Fake&lt;IDisposable&gt;()). And(mock =&gt; A.Dummy&lt;<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;().ToUsable(mock)). When(_ =&gt; _.Dispose()). And(_ =&gt; _.Dispose()). ThenCatch(e =&gt; e.Should().Be.OfType&lt;ObjectDisposedException&gt;()); }</code> </pre> <br><p>  In addition, this code is visible ... </p><br><h1>  Support for additional actions and approvals. </h1><br><p>  Using the And extension method, you can add additional actions and assertion checks (performed in the order of recording method calls).  This allows you to conveniently structure the test code. </p><br><h1>  Secret ingredient </h1><br><p>  An ax in the microbial library is such a class: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GivenWhenThenBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenWhenThenBase</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result, TMock mock</span></span></span><span class="hljs-function">)</span></span> { Result = result; Mock = mock; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> T Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> TMock Mock { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } }</code> </pre> <br><p>  Separate stages of testing correspond to his heirs. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GivenResult</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">GivenWhenThenBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GivenResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result, TMock mock</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result, mock</span></span></span><span class="hljs-function">)</span></span> {} } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WhenResult</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">GivenWhenThenBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WhenResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result, TMock mock, Exception e = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result, mock</span></span></span><span class="hljs-function">)</span></span> { Exception = e; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> Exception Exception { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ThenResult</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">GivenWhenThenBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>, <span class="hljs-title"><span class="hljs-title">TMock</span></span>&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ThenResult</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T result, TMock mock, Exception e = </span></span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-params"><span class="hljs-literal">null</span></span></span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result, mock</span></span></span><span class="hljs-function">)</span></span> { Exception = e; } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> Exception Exception { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><p>  Implementation inheritance is designed in accordance with the recommendations from <a href="https://habrahabr.ru/post/310314/">my previous article</a> . </p><br><h1>  Seasonings </h1><br><p>  All visible magic is implemented in LINQ-style using generalized extension methods. </p><br><ol><li>  Creating a test object (and mock) <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GivenResult&lt;T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; Given&lt;T&gt;(T result) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GivenResult&lt;T, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt;(result, <span class="hljs-literal"><span class="hljs-literal">null</span></span>);</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> GivenResult&lt;T, TMock&gt; And&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> GivenResult&lt;TMock, <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>&gt; givenResult, Func&lt;TMock, T&gt; and) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GivenResult&lt;T, TMock&gt;(and(givenResult.Result), givenResult.Result);</code> </pre> </li><li>  Test case run <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WhenResult&lt;TResult, TMock&gt; When&lt;T, TMock, TResult&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> GivenResult&lt;T, TMock&gt; givenResult, Func&lt;T, TResult&gt; when) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhenResult&lt;TResult, TMock&gt;(when(givenResult.Result), givenResult.Mock); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhenResult&lt;TResult, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TResult), givenResult.Mock, e); } }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WhenResult&lt;TResult, TMock&gt; And&lt;T, TMock, TResult&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Func&lt;T, TMock, TResult&gt; and) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (whenResult.Exception != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhenResult&lt;TResult, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TResult), whenResult.Mock, whenResult.Exception); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhenResult&lt;TResult, TMock&gt;(and(whenResult.Result, whenResult.Mock), whenResult.Mock); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WhenResult&lt;TResult, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(TResult), whenResult.Mock, e); } }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WhenResult&lt;T, TMock&gt; When&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> GivenResult&lt;T, TMock&gt; givenResult, Action&lt;T&gt; when) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> givenResult.When(o =&gt; { when(o); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; }); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> WhenResult&lt;T, TMock&gt; And&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;T, TMock&gt; and) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whenResult.And((o, m) =&gt; { and(o, m); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> o; }); }</code> </pre> </li><li>  Claims Verification: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ThenResult&lt;T, TMock&gt; Then&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;T, TMock, Exception&gt; then) { then(whenResult.Result, whenResult.Mock, whenResult.Exception); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ThenResult&lt;T, TMock&gt;(whenResult.Result, whenResult.Mock, whenResult.Exception); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ThenResult&lt;T, TMock&gt; Then&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;T, TMock&gt; then) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whenResult.Then((r, m, e) =&gt; { e.Should().Be.Null(); then(r, m); }); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ThenResult&lt;T, TMock&gt; ThenMock&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;TMock&gt; then) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whenResult.Then((r, m, e) =&gt; { e.Should().Be.Null(); then(m); }); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ThenResult&lt;T, TMock&gt; Then&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;T, TMock&gt; then) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whenResult.Then((r, m, e) =&gt; { e.Should().Be.Null(); then(r, m); }); }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> ThenResult&lt;T, TMock&gt; ThenCatch&lt;T, TMock&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> WhenResult&lt;T, TMock&gt; whenResult, Action&lt;Exception&gt; then) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> whenResult.Then((r, m, e) =&gt; { e.Should().Not.Be.Null(); then(e); }); }</code> </pre> </li></ol><br><h1>  Guinea pig </h1><br><p>  In the code examples, a class from my <a href="https://habrahabr.ru/post/272497/">Disposable</a> article <a href="https://habrahabr.ru/post/272497/">without limits</a> and several extension methods were tested for durability.  At the moment, the class has been renamed from Disposable to Usable to avoid name collisions with a commonly used pattern. </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Usable</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IDisposable</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Usable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">T resource, IDisposable usageTime</span></span></span><span class="hljs-function">)</span></span> { _usageTime = usageTime; Value = resource; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> =&gt; _usageTime.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Value { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IDisposable _usageTime; }</code> </pre> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">UsableExtensions</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Usable&lt;T&gt; ToUsable&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> T resource, IDisposable usageTime) =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Usable&lt;T&gt;(resource, usageTime); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Usable&lt;T&gt; ToUsable&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> T resource) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T : IDisposable =&gt; resource.ToUsable(resource); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Usable&lt;T&gt; ToNeutralUsable&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> T resource) =&gt; resource.ToUsable(Disposable.Empty); }</code> </pre> <br><h1>  Results </h1><br><p>  Buns new approach compared with the old school: </p><br><ol><li>  Code instead of comments </li><li>  What the compiler understands and controls is close to what the person understands and controls. </li><li>  Better and conciseness, and expressiveness, and readability. </li><li>  Repetitive actions stand out in separate methods easily and pleasantly. </li><li>  In the same style as usual tests, the use of mocks and statements for thrown exceptions is supported. </li></ol><br><p>  Buns compared to high-level BDD frameworks: </p><br><ol><li>  At times less ceremonies and verbiage. </li><li>  Orthogonality with respect to other libraries that facilitate testing. </li><li>  The test language is plain C #, supported by all the power of the studio and an army of developers. </li></ol><br><p>  Additions and criticism are traditionally welcome. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310942/">https://habr.com/ru/post/310942/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310924/index.html">Forcing Asynchrony in Java Services for Baratine</a></li>
<li><a href="../310926/index.html">Android security. Lecture in Yandex</a></li>
<li><a href="../310928/index.html">Monitor client PCs in Microsoft AD with Zabbix. Part 1 - Auto Install</a></li>
<li><a href="../310930/index.html">Placement of the table of values ‚Äã‚Äãwith the help of additional requisite and expansion of the 1C configuration</a></li>
<li><a href="../310938/index.html">Laziness, impatience and self-conceit are the three main virtues of a programmer. Happy birthday, Larry Wall</a></li>
<li><a href="../310944/index.html">After the biggest data theft in history on Yahoo! still ‚Äú33 misfortunes‚Äù</a></li>
<li><a href="../310946/index.html">Canvas Gauges 2.0</a></li>
<li><a href="../310950/index.html">The driver of the computer game Street Fighter V disables the built-in protection mechanism of Windows</a></li>
<li><a href="../310952/index.html">React.js: build an isomorphic / universal application from scratch. Part 3: we add authorization and data exchange with API</a></li>
<li><a href="../310954/index.html">A few notes about MySQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>