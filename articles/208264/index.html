<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>10 potential SQL errors that programmers make</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The original article is called ‚Äú10 SQL errors that Java developers make‚Äù, but, by and large, the principles contained in it can be attributed to any l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>10 potential SQL errors that programmers make</h1><div class="post__text post__text-html js-mediator-article">  <i>The original article is called ‚Äú10 SQL errors that Java developers make‚Äù, but, by and large, the principles contained in it can be attributed to any language.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e63/296/cad/e63296cad829ec1990902341ae559a43.jpg"><br><br>  Java programmers interfere with object-oriented and imperative thinking depending on their level: <br>  - mastery (everyone can program imperatively) <br>  - dogmas (template for applying templates anywhere and naming them) <br>  - moods (applying a true object approach is a bit more complicated than an imperative) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But everything changes when Java developers write SQL code. <br><a name="habracut"></a>  SQL is a declarative language that has nothing to do with object-oriented or imperative thinking.  It is very easy to express a request in SQ, but it is rather difficult to express it correctly and optimally.  Developers not only need to rethink their programming paradigm, they also need to think within the framework of set theory. <br><br>  The following are common errors that Java developers make using SQL in JDBC or jOOQ (without a specific order).  For the <a href="http://blog.jooq.org/2013/08/12/10-more-common-mistakes-java-developers-make-when-writing-sql/">other 10 errors, see this article</a> . <br><br><h4>  1. Forgot about NULL </h4><br>  NULL misunderstanding is most likely the biggest mistake a Java developer can make when writing SQL.  This may be because NULL is also called UNKNOWN.  If he were called simply UNKNOWN, it would be easier to understand.  Another reason is that when retrieving data and binding variables, JDBC reflects SQL NULL in Java null.  This can lead to NULL = NULL (SQL) behaving in the same way as null == null (JAVA). <br><br>  One of the most striking examples of the error about NULL is when <a href="http://blog.jooq.org/2012/12/24/row-value-expressions-and-the-null-predicate/">NULL predicates are used with a row value expression</a> . <br><br>  Another, more specific problem appears when there is no understanding of <a href="http://blog.jooq.org/2012/07/27/not-in-vs-not-exists-vs-left-join-is-null-mysql/">the NULL value in NOT IN anti-joins</a> . <br><br>  <i>Medicine:</i> <br>  Train yourself.  Nothing complicated - while writing SQL, always think about NULL: <br>  - Is this predicate correct with respect to null? <br>  - Does null affect the result of this function? <br><br><h4>  2. Processing Java Memory </h4><br>  Not many Java programmers know SQL very well.  Random JOIN, weird UNION and alright.  And window functions?  Grouping sets?  Many Java developers load SQL data into memory, transform it into some suitable collection and perform the necessary calculations on these collections with verbose cyclic structures (at least until the <a href="http://blog.informatech.cr/2013/03/24/java-streams-preview-vs-net-linq/">collections are improved in JAVA 8</a> ). <br><br>  But some SQL databases support additional (SQL standard!) OLAP functions that are better suited for this and are easier to write.  One example (not standard) is an excellent <a href="http://stackoverflow.com/a/12245888/521799">MODEL statement from Oracle</a> .  Just let the database do the processing and pull the results into Java memory.  Because in the end, some clever guy has already optimized these expensive products.  So, using OLAP in the database, you get two things: <br>  - Simplicity.  Most likely, it is easier to write correctly in SQL than in Java. <br>  - Performance.  The database is likely to be faster than your algorithm.  And more importantly, you won't have to pull millions of records over the wire. <br><br>  <i>Medicine:</i> <br>  Every time you write a data-oriented algorithm using Java, ask yourself: ‚ÄúIs it possible to shift this work to the database?‚Äù <br><br><h4>  3. Using UNION instead of UNION ALL </h4><br>  Shame that UNION ALL requires an extra word about UNION.  It would be much better if the SQL standard was defined to support: <br>  - UNION (allows duplication) <br>  - UNION DISTINCT (removes duplication) <br><br>  Removing duplicates is not only less frequently used, it is also rather slow on large sample results, since  two sub-requests must be ordered, and each tuple must be compared with its subsequent tuple. <br><br>  Remember that even if the SQL standard defines INTERSECT ALL and EXCEPT ALL, not every database can implement these little-used sets of operations. <br><br>  <i>Medicine:</i> <br>  Think about whether you wanted to write UNION ALL every time you write UNION. <br><br><h4>  4. Using JDBC for large sample pagination </h4><br>  Most databases support some sort of page breakdown tools with LIMIT ... OFFSET, TOP ... START AT, OFFSET ... FETCH operators.  In the absence of support for these operators, there is still the possibility of having <a href="http://stackoverflow.com/q/6033080/521799">ROWNUM (Oracle)</a> or <a href="http://stackoverflow.com/q/7073263/521799">ROW_NUMBER () OVER () filtering (DB2, SQL Server 2008, and others)</a> , which are much faster than the breakdown in memory.  This applies mainly to large offsets! <br><br>  <i>Medicine:</i> <br>  Simply use these operators, or a tool (such as jOOQ) that can imitate these operators for you. <br><br><h4>  5. Connecting data in java memory </h4><br>  From the early days of SQL and still some Java programmers with a heavy heart write JOINs.  They have an outdated fear that JOINs are slow.  This may be the case if the overhead optimizer chooses to do a nested loop by loading entire tables into memory before creating cells of the joined table.  But this rarely happens.  With normal predicates, constraints, indexes, MERGE JOIN or HASH JOIN operations are performed very quickly - it all depends on the correct metadata ( <a href="http://blog.jooq.org/2011/11/25/how-schema-meta-data-impacts-oracle-query-transformations/">Tom Kyte has written well about this</a> ).  However, there are probably still a few Java developers who load two tables with two separate queries and join them in Java memory in one way or another. <br><br>  <i>Medicine:</i> <br>  If you choose from different tables at different stages, think again, all of a sudden you can express your requests in one. <br><br><h4>  6. Use DISTINCT or UNION to remove duplicates from a random Cartesian product. </h4><br>  Due to complex joins (JOIN), any developer can lose track of significant SQL query links.  More specifically, when using a connection with composite foreign keys, you can forget to add meaningful predicates to the JOIN ... ON statements.  This can lead to duplication of lines always or only in exceptional situations.  Then some developers can add a DISTINCT operator to stop data duplication.  This is not correct for three reasons: <br>  - It can cure the consequences, but not the cause.  And yet it may not solve the consequences under boundary conditions. <br>  - It is slow for large samples.  DISTINCT performs an ORDER BY operation to remove duplication. <br>  - This is slow for large Cartesian works that will still be loaded into memory. <br><br>  <i>Medicine:</i> <br>  As a rule, if you get unwanted duplicates, review your JOIN predicates.  There probably was a small Cartesian product somewhere. <br><br><h4>  7. Avoiding the MERGE operator </h4><br>  In fact, this is not a mistake, but perhaps it is the lack of knowledge or the fears of the <a href="http://blog.jooq.org/2011/11/29/arcane-magic-with-the-sql2003-merge-statement/">powerful operator MERGE</a> .  Some databases know other forms of the UPSERT operator, for example, MySQL ON DUPLICATE KEY UPDATE.  In fact, MERGE is very powerful, especially in databases that greatly extend the SQL standard, such as <a href="http://msdn.microsoft.com/de-de/library/bb510625.aspx">SQL Server</a> . <br><br>  <i>Medicine:</i> <br>  If you are doing a UPSERT, building a chain of INSERT and UPDATE or SELECT ... FOR UPDATE and INSERT / UPDATE, think again.  Instead of the risk of a race for resources, you can write a simpler MERGE query. <br><br><h4>  8. Using aggregate functions instead of window functions </h4><br>  Before the emergence of window functions, the only way to aggregate data in SQL was to use GROUP BY along with aggregate functions in a projection.  This works well in most cases, and if the aggregated data needs to be filled with regular data, then the grouped query can be written in the attached query. <br>  But SQL: 2003 defines window functions that are implemented by many database providers.  Window functions can aggregate data on ungrouped samples.  In fact, each window function supports its own, independent PARTITION BY operation, which is an excellent tool for generating reports. <br><br>  Using window functions will allow: <br>  - Build more readable SQL (fewer selected GROUP BY expressions in on queries) <br>  - Improve performance because  RDBMS can more easily optimize window functions. <br><br>  <i>Medicine:</i> <br>  When you write a GROUP BY clause in a query, consider whether it can be expressed by a window function? <br><br><h4>  9. Using sorting in memory with different parameters. </h4><br>  The ORDER BY operator supports many types of expressions, including CASE, which can be very useful when defining a sort parameter.  You should never sort the data in Java memory just because: <br>  - SQL sorting is too slow. <br>  - SQL sorting cannot do this. <br><br>  <i>Medicine:</i> <br>  If you are sorting any SQL data in Java memory, consider whether it is possible to transfer this sorting to a database?  It goes well with page breakdown in the database. <br><br><h4>  10. Alternately inserting multiple records </h4><br>  JDBC knows what a batch is, and you should use it.  Do not INSERT thousands of records one by one, creating a new PreparedStatement each time.  If all your records go into one table, create a batch of INSERT queries with one SQL query and several linked datasets.  Depending on your database and its configuration, to keep the UNDO log clean, you may need to commit after some number of inserted records. <br><br>  <i>Medicine:</i> <br>  Always use batch insert large data sets. <br><br><h5>  Several interesting books on the topic </h5><br>  - <a href="http://pragprog.com/book/bksqla/sql-antipatterns">SQL Antipatterns by Bill Karwin</a> <br>  - <a href="http://winand.at/book/sql-performance-explained">SQL Performance Explained by Markus Winand</a> </div><p>Source: <a href="https://habr.com/ru/post/208264/">https://habr.com/ru/post/208264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208250/index.html">Wi-Fi trap from the NSA can work up to 8 miles</a></li>
<li><a href="../208252/index.html">Voltage relay overview with control of current DigiTop VA-protector 63A</a></li>
<li><a href="../208256/index.html">The evolution of garbage collection in Ruby. Rgenc</a></li>
<li><a href="../208258/index.html">How do we know what marketing is?</a></li>
<li><a href="../208262/index.html">Google has organized a car alliance</a></li>
<li><a href="../208266/index.html">Making homemade accessories for the Nintendo Wii</a></li>
<li><a href="../208268/index.html">As Robert Morris on 8 bits to 10,000 counted</a></li>
<li><a href="../208270/index.html">CubieBoard2 based mini server. Aesthetic, cheap and practical</a></li>
<li><a href="../208274/index.html">jquery-animateNumber - plugin for animating numbers</a></li>
<li><a href="../208278/index.html">Pebble introduced metal watch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>