<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Accord.Net: we are looking for an error in the code, due to which the machines will enslave humanity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Articles about validating open source projects are a good thing. Someone, including developers, will learn about errors contained in the project, some...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Accord.Net: we are looking for an error in the code, due to which the machines will enslave humanity</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/889/1dd/e52/8891dde52ec641b6bb0e99c232169b9f.png"></div><br>  Articles about validating open source projects are a good thing.  Someone, including developers, will learn about errors contained in the project, someone will learn about the methodology of static analysis and will begin to apply it to improve the quality of their code.  For us, this is a great way to popularize the PVS-Studio analyzer, and at the same time the possibility of additional testing.  This time I checked the Accord.Net platform and found many interesting fragments in the code. <br><a name="habracut"></a><br><br><h2>  About project and analyzer </h2><br>  <a href="http://accord-framework.net/">Accord.Net</a> is a .Net based machine learning platform written in C #.  The platform consists of several libraries covering a wide range of tasks, such as static data processing, machine learning, pattern recognition, etc. The project source code is available in the <a href="https://github.com/accord-net/framework">repository on GitHub</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/880/9e3/6c9/8809e36c92c448f380af8c7ea2debc98.png"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To check the project, we used the PVS-Studio static code analyzer, available for download by <a href="http://www.viva64.com/ru/pvs-studio-download/">reference</a> .  In addition, you can read other <a href="http://www.viva64.com/ru/b/">articles</a> about checking open projects or the " <a href="http://www.viva64.com/ru/examples/">base of errors</a> ", in which we collect the bugs we found. <br><br><h2>  Little warning </h2><br>  The analyzer issued 91 first-level warnings and 141 second-level warnings.  109 of these warnings have been described or mentioned in the article.  Skimming through the rest of the warnings, I would consider 23 more errors, but they are not listed in the article, as they seemed not interesting enough or were similar to those already described.  It is already more difficult to judge the remaining warnings of the analyzer - you need to more thoroughly understand and analyze the code.  As a result, at least 132 of 232 warnings I would attribute to errors.  This suggests that the number of false positives of the analyzer is approximately 46%.  And, no, wait ... This tells us that every second analyzer warning is an error in the code!  In my opinion, this is quite a weighty argument for the need to use static analysis tools.  How correctly and incorrectly to use static analyzers is written at the end of the article.  In the meantime, I propose to look at what interesting was found in the source code. <br><br><h2>  Bugs found </h2><br>  <b>Same subexpressions</b> <br><br>  <a href="http://www.viva64.com/ru/d/0381/">It is</a> quite easy to make an error caught by the <a href="http://www.viva64.com/ru/d/0381/">V3001</a> diagnostic message, especially if you use copy-paste, or if the names of the variables used in the expression are similar.  These errors are one of the most common, and this project was not without them.  Try to find an error in the fragment below, without looking into the analyzer warning. <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Blob[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetObjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UnmanagedImage image, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> extractInOriginalSize</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((image.PixelFormat != PixelFormat.Format24bppRgb) &amp;&amp; (image.PixelFormat != PixelFormat.Format8bppIndexed) &amp;&amp; (image.PixelFormat != PixelFormat.Format32bppRgb) &amp;&amp; (image.PixelFormat != PixelFormat.Format32bppArgb) &amp;&amp; (image.PixelFormat != PixelFormat.Format32bppRgb) &amp;&amp; (image.PixelFormat != PixelFormat.Format32bppPArgb) ) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0381/">warning</a> : <a href="http://www.viva64.com/ru/d/0381/">V3001</a> There are identical sub-expressions 'image.PixelFormat! = PixelFormat.Format32bppRgb' operator.  Accord.Imaging BlobCounterBase.cs 670 <br><br>  Here, the subexpression <i>image.PixelFormat! = PixelFormat.Format32bppRgb is repeated twice</i> .  It was rather simple to make a mistake with such names of the enumeration elements, which happened.  It is worth noting that, looking through such code, it is very easy to miss the extra subexpression.  But whether one of the comparisons is superfluous, or a different meaning of the listing was implied, the question is interesting.  In one case, there will simply be a redundant code, and in the other, a logical error. <br><br>  This code was met again in the same file in line 833. Copy-paste ... Copy-paste never changes. <br><br>  <b>Wrong Cycle Exit Condition</b> <br><br>  We all used to call cycle counters by names like <i>i</i> , <i>j</i> , <i>k</i> , etc.  As a rule, it is convenient and is common practice, but sometimes it can stand sideways.  As in the example below. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Convert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">short</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] to</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>.Length; i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>].Length; j++) to[i][j] = (<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">from</span></span>[i][j] * (<span class="hljs-number"><span class="hljs-number">32767f</span></span>)); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0080/">V3015</a> It is likely that a variable is being compared inside the 'for' operator.  Consider reviewing 'i' Accord.Audio SampleConverter.cs 611 <br><br>  In the condition of exiting the second cycle, the variable <i>i is used</i> , although <i>j</i> is the counter of this cycle.  In this case, the variable <i>i</i> inside the body of the nested loop does not change.  As a result, <i>j</i> will be incremented until it goes beyond the bounds of the array, and an exception is generated. <br><br>  <b>Different logic for the same conditions.</b> <br><br>  The code met when for two identical <i>if statements</i> different logic was provided. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] observations, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] weights, MultivariateEmpiricalOptions options</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weights != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentException(<span class="hljs-string"><span class="hljs-string">"This distribution does not support weighted samples."</span></span>, <span class="hljs-string"><span class="hljs-string">"weights"</span></span>); .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weights != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) weights = inPlace ? weights : (<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[])weights.Clone(); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0390/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0390/">V3021</a> There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains method return.  If it‚Äôs a statement of senseless Accord.Statistics MultivariateEmpiricalDistribution.cs 653 <br><br>  Strange code, right?  Especially considering the fact that the <i>weights</i> variable is a parameter of the method and is not used between these conditions.  Thus, the second <i>if statement</i> will never be executed, since if the expression <i>weights! = Null is</i> true, an exception of type <i>ArgumentException</i> will be thrown. <br><br>  This code is met again in the same file in line 687. <br><br>  <b>Conditions whose values ‚Äã‚Äãare always false</b> <br><br>  Diagnostic rule <a href="http://www.viva64.com/ru/d/0081/">V3022 is</a> very prettier from the first release and never ceases to amaze me.  Let's see if it can surprise you.  First of all, I suggest finding an error in the code without resorting to the diagnostic message of the analyzer.  At the same time, I draw attention to the fact that this is already a simplified version, with fragments of code cut out. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dscal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> da, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] dx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _dx_offset, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> incx</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((n &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) || (incx &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>))) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> _i_inc = incx; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">1</span></span>; (_i_inc &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) ? i &gt;= nincx : i &lt;= nincx; i += _i_inc) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0081/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0081/">V3022</a> Expression '(_i_inc &lt;0)' is always false.  Accord.Math BoundedBroydenFletcherGoldfarbShanno.FORTRAN.cs 5222 <br><br>  Of course, now it is easier to find the error, because of the method were specially cut out fragments that are not interesting to us.  Yet it is hard to tell right away where the problem is in this code.  And the fact is (as you might have guessed by reading the message from the analyzer) that the expression <i>(_i_inc &lt;0) is</i> always false.  Here you should pay attention to the fact that the <i>_i_inc</i> variable <i>is</i> initialized by the value of the <i>incx</i> variable.  At the same time, the value of the <i>incx</i> variable at the time of initialization <i>_i_inc is</i> positive, since otherwise it would be <i>possible</i> to exit the method body above the code.  Therefore, <i>_i_inc</i> can only have a positive value, the result of the comparison <i>_i_inc &lt;0 is</i> always <i>false</i> , and the condition for exiting the loop is always the expression <i>i &lt;= nincx.</i> <br><br>  Such an in-depth analysis became available due to the mechanism of <a href="http://www.viva64.com/ru/b/0394/">virtual values</a> , which greatly improved some diagnostic rules of the analyzer. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hqr2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> low = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nn; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &lt; low | i &gt; high) .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0461/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0461/">V3063</a> A part of conditional expression is always false: i &lt;low.  Accord.Math JaggedEigenvalueDecompositionF.cs 571 <br><br>  The subexpression <i>i &lt;low</i> will always be <i>false</i> , since the minimum value accepted by the variable <i>i is</i> 0, and the <i>low</i> value at the time of comparison will also always be 0. Therefore, the subexpression <i>i &lt;low</i> will be calculated as ‚Äúidle‚Äù. <br><br>  There are many such places.  I will not give all warnings, but I will list a few: <ul><li>  V3063 A part of the conditional expression is always false: i &lt;low.  Accord.Math JaggedEigenvalueDecompositionF.cs 972 </li><li>  V3063 A part of the conditional expression is always false: i &lt;low.  Accord.Math JaggedEigenvalueDecomposition.cs 571 </li><li>  V3063 A part of the conditional expression is always false: i &lt;low.  Accord.Math JaggedEigenvalueDecomposition.cs 972 </li><li>  V3063 A part of the conditional expression is always false: i &lt;low.  Accord.Math EigenvalueDecomposition.cs 567 </li></ul><br>  <b>Integer division with reduction to real type</b> <br><br>  The analyzer found suspicious mathematical calculations in the code.  It is enough just to forget that when dividing integers, integer division is performed.  If real division was meant, an unpleasant and subtle mistake can occur.  In some cases, it is difficult for a third-party developer to say whether such an expression contains an error, but it is worth checking out such operations.  I propose to consider several such cases. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSpectralResolution</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> samplingRate, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> samples</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> samplingRate / samples; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0425/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was implicitly cast from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Accord.Audio Tools.cs 158 <br><br>  This method performs the division of two integer variables, but the result of this division is implicitly cast to <i>double</i> type.  It looks suspicious. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/84d/ea6/64e/84dea664e0b94225baca81371a5645b8.png"></div><br><br>  But the following code looks even more strange: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GreatestCommonDivisor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> a, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> b</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = a - b * (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Math.Floor((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)(a / b)); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (x != <span class="hljs-number"><span class="hljs-number">0</span></span>) { a = b; b = x; x = a - b * (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)Math.Floor((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)(a / b)); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> b; }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <ul><li>  <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was implicitly cast from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Accord.Math Tools.cs 137 </li><li>  <a href="http://www.viva64.com/ru/d/0425/">V3041</a> The expression was implicitly cast from 'int' type to 'double' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  Accord.Math Tools.cs 142 </li></ul><br>  The analyzer found the expression suspicious <i>(double) (a / b)</i> .  The <i>Floor</i> method returns the largest integer less than or equal to the specified double-precision floating-point number ( <a href="https://msdn.microsoft.com/ru-ru/library/e0b5f0xb(v%3Dvs.110).aspx">MSDN. Math. Flora</a> ).  But the variables <i>a</i> and <i>b</i> are of type <i>int</i> , therefore - integer division will be performed, the result of which will be an integer value.  It turns out that there is no point in explicitly casting this value to a <i>double</i> type and calling the <i>Floor</i> method. <br><br>  To perform the operation correctly, it was necessary to cast one of the operands to type <i>double</i> .  Then the real division would be performed, and the call to the <i>Floor</i> method would be justified: <br><pre> <code class="cs hljs">Math.Floor((<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)a / b)</code> </pre> <br>  <b>The parameter of the method, the value of which is always overwritten</b> <br><br>  We continue.  Errors of the following type are not common, but still come across. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WeightedMode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] observations, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] weights, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mode, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> imax, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> imin</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bestValue = currentValue; .... mode = bestValue; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mode; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0468/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0468/">V3061</a> Parameter 'mode' is always rewritten in method body before being used.  Accord.Statistics TriangularDistribution.cs 646 <br><br>  One of the method parameters - <i>mode</i> - is overwritten and returned.  In this case, the <i>mode</i> method body is not used in any way (not counting overwriting).  I will not undertake to assert that this is a mistake (among the suspicious places found by this diagnostic rule in other projects, it was clearly erroneous), but this code looks strange. <br><br>  In general, there is an interesting feature: as a rule, errors in this project are not encountered one by one.  The exact same code can be found in several places.  Indeed, copy-paste does not change ... <ul><li>  V3061 Parameter 'mode' is always rewritten in method body before being used.  Accord.Statistics TriangularDistribution.cs 678 </li><li>  V3061 Parameter 'mode' is always rewritten in method body before being used.  Accord.Statistics TriangularDistribution.cs 706 </li><li>  V3061 Parameter 'mode' is always rewritten in method body before being used.  Accord.Statistics TriangularDistribution.cs 735 </li></ul><br>  <b>Null reference dereference</b> <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ToString</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> format, IFormatProvider formatProvider</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fmt = components[i] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IFormattable; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fmt != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) sb.AppendFormat(fmt.ToString(format, formatProvider)); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> sb.AppendFormat(fmt.ToString()); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0480/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0480/">V3080</a> Possible null dereference.  Consider inspecting 'fmt'.  Accord.Statistics MultivariateMixture'1.cs 697 <br><br>  Usually, errors that lead to exceptions are trapped during the development process, if the code is tested thoroughly enough.  But not always, and the example above is proof of that.  If the <i>fmt! = Null</i> expression is false, the instance method <i>ToString</i> is called on the <i>fmt</i> object <i>.</i>  Result?  <i>NullReferenceException Exception</i> . <br><br>  And, as you might have guessed, the same mistake occurred again: MultivariateMixture'1.cs 697 <br><br>  <b>Mutual assignment of links</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MetropolisHasting</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; : <span class="hljs-title"><span class="hljs-title">IRandomNumberGenerator</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>[]&gt; { .... T[] current; T[] next; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TryGenerate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> aux = current; current = next; next = current; .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0420/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0420/">V3037</a> An odd sequence of assignments of this kind: A = B;  B = A ;.  Check lines: 290, 289. Accord.Statistics MetropolisHasting.cs 290 <br><br>  Obviously, in the above fragment of the <i>TryGenerate</i> method, <i>they</i> wanted to swap references to the arrays <i>next</i> and <i>current</i> (the <i>aux</i> variable is not used anywhere else).  But because of the error, it turned out that both <i>current</i> and <i>next</i> now store references to the same array ‚Äî the one to which was contained in the variable <i>next</i> . <br><br>  The correct code should look like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> aux = current; current = next; next = aux;</code> </pre> <br>  <b>Potential division by 0</b> <br><br>  The analysis revealed several errors of potential division by 0. Glance take a look at them: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BlackmanWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> alpha, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">length</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a0 = (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - alpha) / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a1 = <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> a2 = alpha / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; length; i++) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[i] = (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(a0 - a1 * Math.Cos((<span class="hljs-number"><span class="hljs-number">2.0</span></span> * System.Math.PI * i) / (length - <span class="hljs-number"><span class="hljs-number">1</span></span>)) + a2 * Math.Cos((<span class="hljs-number"><span class="hljs-number">4.0</span></span> * System.Math.PI * i) / (length - <span class="hljs-number"><span class="hljs-number">1</span></span>))); }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <ul><li>  <a href="http://www.viva64.com/ru/d/0462/">V3064</a> Potential division by zero.  Consider inspecting denominator '(length - 1)'.  Accord.Audio BlackmanWindow.cs 64 </li><li>  <a href="http://www.viva64.com/ru/d/0462/">V3064</a> Potential division by zero.  Consider inspecting denominator '(length - 1)'.  Accord.Audio BlackmanWindow.cs 65 </li></ul><br>  The analyzer found the following code suspicious: <br><pre> <code class="cs hljs">(<span class="hljs-number"><span class="hljs-number">2.0</span></span> * System.Math.PI * i) / (length - <span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  It is possible that in reality there will be no error here ( <i>length</i> is the length of some window, and for the occurrence of an error it should have the value 1), but who knows?  It is better to be safe, otherwise there is a great chance to get a very unpleasant mistake, which, moreover, will be hard to detect. <br><br>  Another interesting code snippet met with potential division by 0. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[,] Centering(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> size) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (size &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException(<span class="hljs-string"><span class="hljs-string">"size"</span></span>, size, <span class="hljs-string"><span class="hljs-string">"The size of the centering matrix must be a positive integer."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">double</span></span>[,] C = Matrix.Square(size, <span class="hljs-number"><span class="hljs-number">-1.0</span></span> / size); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0462/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0462/">V3064</a> Potential division by zero.  Consider inspecting denominator 'size'.  Accord.Math Matrix.Construction.cs 794 <br><br>  As for me - a very interesting and funny mistake.  The analyzer noted that in the expression <i>-1.0 / size the</i> division by 0 is possible. Now pay attention to the test above.  If <i>size &lt;0</i> , an exception will be generated, but if <i>size == 0</i> , there will be no exception, but division by 0 will be.  In this case, in the literal passed to the exception constructor, it is written that the size of the matrix must be a <i>positive</i> number, but the test is performed for <i>non-negative</i> values.  A <i>positive</i> and <i>non</i> - <i>negative</i> - yet different concepts.  I suppose, to correct the error, it is enough just to correct the check: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (size &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre> <br>  <b>Using bit operator instead of logical</b> <br><br>  Sometimes you have to deal with the fact that not all programmers know the difference between bit and logical operators ('|' and '||', '&amp;' and '&amp;&amp;').  This can lead to completely different consequences - from superfluous calculations to falls.  This project encountered several suspicious places using bit operations: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JaggedSingularValueDecompositionF</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> Single[][] </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> computeLeftSingularVectors, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> computeRightSingularVectors, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> autoTranspose, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> inPlace</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((k &lt; nct) &amp; (s[k] != <span class="hljs-number"><span class="hljs-number">0.0</span></span>)) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0494/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0494/">V3093</a> The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecompositionF.cs 461 <br><br>  The body of the <i>if statement</i> will be executed if both subexpressions ( <i>k &lt;nct</i> and <i>s [k]! = 0.0</i> ) are <i>true</i> .  But at the same time, even if the value of the first subexpression ( <i>k &lt;nct</i> ) is <i>false</i> , the second subexpression will still be calculated, which would not be the case when using the &amp;&amp; operator.  So, if the programmer checked the value of <i>k</i> in order not to go beyond the array, then he did not get anything out of this. <br><br>  Similar warnings: <ul><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecompositionF.cs 510 </li><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecompositionF.cs 595 </li><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecomposition.cs 461 </li><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecomposition.cs 510 </li><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math JaggedSingularValueDecomposition.cs 595 </li><li>  V3093 The '&amp;' operator evaluates both operands.  Perhaps a short-circuit '&amp;&amp; operator should be used instead.  Accord.Math Gamma.cs 296 </li></ul><br>  <b>Check in the loop of the same element</b> <br><br>  An error was found that was found by the diagnostic rule from the latest release of the analyzer. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">[] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Compute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[][] data, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] weights</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> cols = data[<span class="hljs-number"><span class="hljs-number">0</span></span>].Length; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; data.Length; i++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data[<span class="hljs-number"><span class="hljs-number">0</span></span>].Length != cols) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DimensionMismatchException(<span class="hljs-string"><span class="hljs-string">"data"</span></span>, <span class="hljs-string"><span class="hljs-string">"The points matrix should be rectangular. The vector at position {} has a different length than previous ones."</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0502/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0502/">V3102</a> Suspicious access to the element of the 'data' object.  Accord.MachineLearning BinarySplit.cs 121 <br><br>  An interesting mistake.  The programmer wanted to verify that the jagged <i>data</i> array is actually two-dimensional (i.e., is a matrix).  But I made a mistake in the expression <i>data [0] .Length! = Cols</i> , using not the loop counter <i>i</i> , but the integer literal - 0 as the index value. As a result, the expression <i>data [0] .Length! = Cols</i> will always be false, since it is equivalent expression <i>data [0] .Length! = data [0] .Length</i> .  If the <i>data</i> parameter were a two-dimensional array ( <i>Double [,]</i> ), this error, as well as the entire check, could have been avoided.  But it is possible that the use of a gear array due to some features of the application architecture. <br><br>  <b>Passing to the method as the argument of the caller</b> <br><br>  The following code snippet also looks suspicious. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WeightedMean</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] values, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] weights</span></span></span><span class="hljs-function">)</span></span> { .... } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Fit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] observations, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] weights, IFittingOptions options</span></span></span><span class="hljs-function">)</span></span> { .... mean = observations.WeightedMean(observations); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0469/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0469/">V3062</a> An object of the observation of its own method.  Consider checking the 'WeightedMean' method.  Accord.Statistics InverseGaussianDistribution.cs 325 <br><br>  The analyzer found it suspicious that the <i>WeightedMean</i> method takes as argument the same object for which it is called.  This becomes doubly strange when you consider that the <i>WeightedMean</i> is an extension method.  I conducted additional research by looking at how this method is used in other places.  In all places of its use, the array of <i>weights</i> spoke as the second argument (note that such an array exists in the considered <i>Fit</i> method), so most likely this is an error and the correct code should look like this: <br><pre> <code class="cs hljs">mean = observations.WeightedMean(weights);</code> </pre> <br>  <b>Potential serialization error</b> <br><br>  The potential problem of serializing one of the classes was discovered. <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DenavitHartenbergNodeCollection</span></span> : <span class="hljs-title"><span class="hljs-title">Collection</span></span>&lt;<span class="hljs-title"><span class="hljs-title">DenavitHartenbergNode</span></span>&gt; { .... } [Serializable] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">DenavitHartenbergNode</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> DenavitHartenbergNodeCollection Children { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0507/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0507/">V3097.</a> Possible exception: The 'DenavitHartenbergNode' type marked by [Serialable] contains non-serializable members not marked by [NonSerialized].  Accord.Math DenavitHartenbergNode.cs 77 <br><br>  When serializing an instance of the <i>DenavitHartenbergNode</i> class, an exception of the type <i>SerializationException</i> may occur.  It all depends on the type of serializer selected.  If, for example, an instance of the <i>BinaryFormatter</i> type acts as a serializer, an exception will be generated, since all serializable members are required (and this property is also serializable) decorated with the <i>[Serializable]</i> attribute. <br><br>  Some solutions: <ul><li>  implement this property through the field, decorated with the <i>[NonSerialized]</i> attribute.  Then the field (and therefore the property associated with it) will not be serialized; </li><li>  implement the <i>ISerializable</i> interface, and in the <i>GetObjecData</i> method ignore the serialization of this property; </li><li>  decorate the <i>DenavitHartenbergNodeCollection</i> type <i>with the</i> <i>[Serializable]</i> attribute <i>.</i> </li></ul><br>  Judging by the surrounding code (all other properties have serializable types), it is necessary to implement the latter case. <br><br>  If instances of this type are serialized using serializers that do not require all members to be serialized to be decorated with the <i>[Serializable]</i> attribute, you can not worry about this code. <br><br>  The analyzer detected a lot of unsafe event call fragments.  How much?  75 warnings <a href="http://www.viva64.com/ru/d/0485/">V3083</a> !  I propose to consider one piece of code, since the rest, in principle, are similar to it. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">timeUp_Elapsed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, ElapsedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TempoDetected != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) TempoDetected(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EventArgs.Empty); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0485/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/d/0485/">V3083</a> Unsafe invocation of event 'TempoDetected', NullReferenceException is possible.  Consider assigning an event to a local variable before invoking it.  Accord.Audio Metronome.cs 223 <br><br>  In this code snippet, it is checked whether there are subscribers to the <i>TempoDetected</i> event, and, if they exist, the event is triggered.  It was assumed that if, at the time of verification, <i>TempoDetected</i> had no subscribers, this would avoid the occurrence of an exception.  However, there is a possibility that at the time between checking <i>TempoDetected</i> for <i>null</i> inequality and <i>triggering an</i> event, it will not have any subscribers (for example, there will be a reply from this event in other threads).  As a result, if at the time the event is called, <i>TempoDetected</i> does not have subscribers, an exception of type <i>NullReferenceException</i> will be generated.  To avoid such problems you can, for example, use the null-conditional operator '?.', Added in C # 6.0.  You can read more about the problem and other ways to solve it in the documentation for this diagnostic rule. <br><br><h2>  How to and how not to use a static analyzer </h2><br>  Before you finish, I would like to talk a little bit about how you still need to use static analysis tools.  Often we have to deal with this approach: ‚ÄúWe checked our project before release.  Something of no particular interest was found. ‚ÄùNo, no, no!  This is the wrong way to use.  As a parallel, you can give such an example - refuse to develop programs in the IDE, write everything in a simple notebook.  And just before the release, start working in the IDE.  Strange?  Still would!  Sense from this IDE, if most of the time, when from it would have been a sense, she was gathering dust on your SSD / HDD?  The same situation with static analyzers.  They should be applied regularly, not once. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/883/6a9/626/8836a96265474237b690fffacaf06b00.png"></div><br><br>  If you check the application code with the analyzer just before the release, it is obvious that many errors will already be fixed.  But at what cost?  At the cost of nerves and time of the developers who wrote the code, at the cost of numerous tests designed to identify these very errors.  As a result, the cost of such errors becomes, to put it mildly, considerable. <br><br>          ,       .       ,   ,   ,  ,         .  ,    ,      ,    .       <a href="http://www.viva64.com/ru/d/0218/">  </a> ,         . <br><br>           .       ,    ,      .            . <br><br>  ,            . <br><br><h2>  Results </h2><br>       ,         . , - -   ,  -        .      ,    .   ,    ,  <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> .        ,       . <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0410/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>        ,      : Sergey Vasiliev. <a href="http://www.viva64.com/en/b/0410/">Accord.Net: Looking for a Bug that Could Help Machines Conquer Humankind</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/305406/">https://habr.com/ru/post/305406/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../305396/index.html">Projecting Google Material Design onto the desktop system ... (part three)</a></li>
<li><a href="../305398/index.html">Arrow hell, or a new circle of old problems</a></li>
<li><a href="../305400/index.html">Ansible Handbook</a></li>
<li><a href="../305402/index.html">History of programming languages: Perl is an unusual language created by a linguist for programmers.</a></li>
<li><a href="../305404/index.html">Google fixed Android vulnerabilities</a></li>
<li><a href="../305408/index.html">Render to texture using Three.js</a></li>
<li><a href="../305414/index.html">IoT and ViaLatM. Automation of sending commands to Internet of Things objects</a></li>
<li><a href="../305418/index.html">Some Hibernate Practice</a></li>
<li><a href="../305420/index.html">Invitation to the webinar "Automation of end-to-end business processes on the Oracle BPM platform"</a></li>
<li><a href="../305422/index.html">Gogs: lightweight git service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>