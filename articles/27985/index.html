<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Database design. Compoder Pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Web 2.0 triumphantly walks through the virtual world. Social networks grow like mushrooms after rain. Now you can store your photos, videos, write blo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Database design. Compoder Pattern</h1><div class="post__text post__text-html js-mediator-article"> Web 2.0 triumphantly walks through the virtual world.  Social networks grow like mushrooms after rain.  Now you can store your photos, videos, write blogs and listen to music in one place.  All this can be commented on, put in favorites, copied ... There are many possibilities, the content of social networks is diverse and diverse, and this is their advantage. <br><br>  Now imagine the structure of the database of some Vkontakte.  Submitted?  And what do you see?  Many tables with data?  And what else?  Many tables for many-to-many links!  Necessary, from the point of view of a relational database, but superfluous from the point of view of logic.  But that is not all.  Among the fields of the tables we see a huge number of ‚Äúextra‚Äù fields, which are just foreign keys that serve for one-to-many connections, which are also necessary from the point of view of relational theory, but absolutely useless from the point of view of logic. <br><a name="habracut"></a><br>  Imagine now that you decide to create your own social network.  You plan that there will be users in it (where do without them?).  These users will be able to unite in groups, store photos and videos and write blogs.  Imagine the structure of the database, we understand that it seems to be nothing complicated.  So it is, if the structure of relations is simple.  But the requirements can be complicated.  Now the customer needs the content to be owned by several users at the same time, and at the same time the community.  That all this (any object) could be commented.  In order for a user to be able to keep at all whatever they please, including other users and communities and blogs of communities.  You never know what else you can think of!  And each such requirement entails a redesign of the base, the addition of new tables, foreign keys.  I'm not talking about writing code.  Is there any way to get rid of it?  Somehow to make it so that connections between any objects (read records) could be created arbitrarily, without redesigning the database each time. <br><br>  Can!  Open the book ‚ÄúGangs of Four‚Äù, find the description of the Composite pattern and read: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <em><strong>Purpose</strong></em> <em><br><br></em>  <em>Composites objects into tree structures to represent part-whole hierarchies.</em>  <em>Allows customers to consistently treat individual and composite objects.</em>  <em>(I advise you to read the entire chapter)</em> <br><br>  What we need!  So let's consider how to apply this idea for our purposes.  I will say at once that later I will tell only about the idea itself.  It has already been implemented and is working in a real project, a new project is being developed based on this architecture, but I just don‚Äôt have time for a detailed description with pieces of code.  In one of the following articles I will definitely tell you in more detail and give examples and real code. <br><br>  So, the task of this architecture is to allow arbitrarily linking the objects of the system with each other. <br><br>  In the considered architecture, each object is an entry in the table.  For each type of objects (photo, video, user, etc.), a separate table is created in the database.  Each such table consists only of fields in which only those data are stored that relate to the object + primary key of the record (that is, no foreign keys).  Communication is carried out through a single table for all named GUID, consisting of four fields.  Why are there four fields?  Well, 2 fields are clear, these are ID related objects, that is, their foreign keys.  The classical scheme is many-to-many.  But after all, only by ID it is impossible to uniquely identify an object within the entire database.  IDs can be repeated in different tables (the sequence for each table is different).  Therefore, the concept of object type is introduced.  In essence, the type of object is the name of the table in which this object is stored (or the name of the class in the program code, as you wish).  And thus, the ID-TYPE pair is a unique identifier of an object within the entire database.  That is why the GUID relationship table consists of 4 fields, the first 2, as I said above, are the ID of the related objects, and the remaining 2 are their types.  Knowing the ID and type of the object (parent), you can select all objects related to it (children), both all and of a particular type. <br><br>  This allows you to build the most bizarre connections, and to respond very flexibly to changing business requirements for the system. <br><br>  <strong>What flaws do I see in this architecture</strong> ?  First of all, this is a huge GUID table.  After all, min the number of records in it is equal to the number of records in all database tables.  And this is only minimal, since the object can be associated with several other objects at once (however, it‚Äôs not a problem to divide into several tables in the future). <br>  The second is a bit heavier requests.  If the one-to-many relationship is implemented according to the classical scheme, then the sample will be only on the foreign key, and in such a model there is no foreign key, and the GUID table must be jointed <br><br>  True, a model can easily be converted to a classical one both completely and in its individual sections (for example, in narrow places), if there is a need for it, and it is completely transparent for the client.  In reality, it is, some parts of the project work according to the classical scheme, and some of the new, while not interfering with each other. <br><br>  <strong>Well, a few words about the implementation</strong> .  Nobody, of course, wants to write requests with hands, so the whole logic of working with the database is placed in a separate layer called GuidComponent.  This is the base class, which is a kind of pattern ActiveRecord.  All objects of the system inherit it (for example, PhotoComponent, VideoComponent, etc.). The base class, GuidComponent, provides each successor with methods for working with other objects of the system, for linking and deleting connections, for obtaining object data and its associated objects (Childs).  For example, to bind an object, just call the addChild () method;  and pass as a parameter a link to the object to be linked. <br><br>  Here is a brief class diagram (a bit outdated truth): <br><br><img src="http://content.foto.mail.ru/mail/roman_kovrigin/guid/i-20.jpg"><br><br>  And finally, a sample Java code that adds a comment to a photo: <br> <code>//     id = 10 <br> PhotoComponent photo = new PhotoComponent(10); <br> CommentComponent comment = new CommentComponent(); <br> comment.setMessage(" "); <br> comment.save(); <br> <br> photo.addChild(comment); <br> <br> //     <br> List comments = photo.loadChilds(CommentComponent.class); <br> <br> <br>    ,   .      (  ) ,          ,      ,     .    - ,    ,    ,      .</code> </div><p>Source: <a href="https://habr.com/ru/post/27985/">https://habr.com/ru/post/27985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279841/index.html">How to detect overflow of 32-bit variable in long cycles in a 64-bit program</a></li>
<li><a href="../279843/index.html">Laravel TestTools - recording tests for Laravel directly from the Chrome browser</a></li>
<li><a href="../279845/index.html">The open Tarantool database from Mail.ru is certified and placed in the Azure Marketplace</a></li>
<li><a href="../279847/index.html">Less than 2 months, GoPro, a cool idea and team - everything you need to make a first-person game</a></li>
<li><a href="../279849/index.html">NetApp AltaVault: Backup and Archive Data in the Cloud</a></li>
<li><a href="../279851/index.html">Stream-safe signals that are really convenient to use.</a></li>
<li><a href="../279853/index.html">Emacs Mysterious: Journey to Calculator</a></li>
<li><a href="../279855/index.html">Hackathon: Rapid Prototyping of the Internet of Things</a></li>
<li><a href="../279857/index.html">What to put on the perimeter of the network: Cisco router or Cisco ASA?</a></li>
<li><a href="../279859/index.html">Review of design books</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>