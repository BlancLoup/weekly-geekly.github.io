<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Determination of resistance by the controller without ADC</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Actually, there was such a task - several times per second to take readings of a potentiometer. The target information receiver is an ATmega32 control...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Determination of resistance by the controller without ADC</h1><div class="post__text post__text-html js-mediator-article">  Actually, there was such a task - several times per second to take readings of a potentiometer.  The target information receiver is an ATmega32 controller.  It has a built-in ADC, but the result returned by it had a resolution of 2-3 bits, and the remaining bits carried garbage. <br><br>  The first thing that came to mind was to buy an external ADC and screw it to the controller.  But there was neither the time nor the desire to deal with another device.  I decided to try another method, which I was not sure about in working capacity, but nevertheless the scheme turned out to be quite working and gave an accuracy of about 8 bits (maybe more, did not check). <br><a name="habracut"></a><br><br>  Actually the idea is that the digital input of the controller measures the discharge rate of the capacitor.  The capacitor is charged to the supply voltage through a low resistance, then the time report is started, and the capacitor discharges through the potentiometer.  When the voltage on the capacitor drops to 1.4V (the switching voltage of the controller input is low), the value of the logic level at the input switches and the time report stops.  The resulting discharge time is proportional to the current resistance of the potentiometer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Device layout: </h5><br><img src="https://habrastorage.org/storage2/fc8/b9f/06c/fc8b9f06c2536044e0a989acf99832fa.png" alt="image"><br>  A0, A1 - legs MK, digital port A. <br><br>  The transistor in the circuit is used to ensure that the voltage to which the capacitor is charged does not depend on the current position of the potentiometer. <br><br><h5>  Calculation scheme. </h5><br>  To ensure good measurement accuracy, it is necessary to select the circuit elements in such a way that the discharge time at the extreme positions of the potentiometer would differ by about an order of magnitude.  In general, the more the better, but everything has a side-alley. <br>  The formula for the discharge time of a capacitor through a resistor (wiki): <br><img src="https://habrastorage.org/storage2/77f/209/818/77f2098187119dc3fec26c1e0664f295.png" alt="image"><br><br>  It is necessary to select R and C in such a way that to ensure the discharge time from 5V (WU) to 1.4V (level of switching the port to logical 0) for a time of 0.02 seconds at maximum resistance, and at a time of 0.002 seconds at minimum resistance.  The value of C is constant in both cases, and R differs by 50 kŒ© (potentiometer value).  The time was chosen for reasons of accuracy, the speed of the microcontroller, and is chosen to most closely match the available values ‚Äã‚Äãof resistors and capacitors.  (the controller operates at a frequency of 8 MHz) <br>  Solving the system of equations, we determine the value of resistor R13 and capacitor C1. <br><img src="https://habrastorage.org/storage2/119/21f/993/11921f993bc2698de6163780865ac3c6.jpg" alt="image"><br><br>  It does not take into account the internal resistance of the input of the controller, but the speed of the controller allowed to programmatically adjust the circuit and select the coefficient to convert the discharge time to the range 0..255. <br><br>  R12 is used to charge the capacitor and should be small, R14 should provide for the saturation of the transistor at any possible current. <br><h5>  The final selection of the values ‚Äã‚Äãof the elements of the scheme: </h5><br>  R12 = 220 Ohm; <br>  R13 = 6.8 kŒ©; <br>  R14 = 1 kŒ©; <br>  R 15 = 0..50 kŒ©; <br>  C1 = 1 ŒºF. <br><br>  To charge the capacitor, the transistor is turned off, and the A0 foot is tuned to high output (DDRA = 3, PORTA = 1).  and a delay is made for a sufficiently long time to charge the capacitor.  Then A0 switches to the input state, and the transistor opens (DDRA = 2, PORTA = 2).  the capacitor begins to discharge, the discharge time is tracked by an empty cycle. <br><br>  The following is the actual function code that measures the discharge rate. <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> readADC() { <span class="hljs-comment"><span class="hljs-comment">//    DDRA = 2; PORTA = 2; int i = 0, t = 0; while (PINA &amp; 1){ t++; if (t == 43) i++, t = 0; //  43   } PORTA = 1; //      DDRA = 3; //   , //   ,    //      i -= 40; //   if (i &lt; 0) i = 0; //        if (i &gt; 255) i = 255; return i; }</span></span></code> </pre> <br><br>  The circuit works well, the removed 8 bits are stable.  It is probably possible to speed up the operation of the circuit by recalculating the parameters for a shorter time, but the limitations to this are the input parasitic input capacitance and the operating time of the controller. <br>  I did not check it, but I think that it is possible to reduce the discharge time by a factor of 10 to 20, and this will not affect the accuracy of the result. </div><p>Source: <a href="https://habr.com/ru/post/135135/">https://habr.com/ru/post/135135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../135124/index.html">Christmas music card</a></li>
<li><a href="../135126/index.html">What happened to google?</a></li>
<li><a href="../135130/index.html">Connecting the network to global IPv6 space</a></li>
<li><a href="../135131/index.html">Multicore CPU for UAVs</a></li>
<li><a href="../135134/index.html">A preliminary review of the tablet Samsung Galaxy Tab 7.7 or "Wow, my favorite size" ;-)</a></li>
<li><a href="../135137/index.html">Ask a question to a venture investor</a></li>
<li><a href="../135139/index.html">More than SEO: ranking areas of St. Petersburg based on popular search queries of parents</a></li>
<li><a href="../135142/index.html">Create New Year Card with CSS3</a></li>
<li><a href="../135144/index.html">Telehouse Caravan - client-specific data center</a></li>
<li><a href="../135145/index.html">Google reported the cause of failures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>