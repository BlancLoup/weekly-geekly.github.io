<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to speed up the program on Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Alas, I do not keep my blog, and I consider it necessary to publish the result of the recent ‚Äúdiscovery‚Äù in the form of a note. I believe there will b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to speed up the program on Go</h1><div class="post__text post__text-html js-mediator-article"> Alas, I do not keep my blog, and I consider it necessary to publish the result of the recent ‚Äúdiscovery‚Äù in the form of a note.  I believe there will be people to whom this is very useful. <br><br>  Go is a language compiled into native code, and therefore, obviously, should be fast.  However, unfortunately, at the moment this is <a href="http://stackoverflow.com/questions/2704417/why-is-go-language-so-slow">not always true</a> . <br>  In my case, <a href="https://github.com/jzelinskie/whirlpool/issues/1">Go lost PHP</a> (well, in fact, the PHP module in C, but the result is still depressing).  In short, when calculating the Whirlpool-hash, Go lost 3.5-7.5 times! <br><a name="habracut"></a><br>  In the set of sources, the same reason is described - the ‚Äúweak‚Äù standard Go compiler (the one that is invoked via the go build).  This is completely true.  The fact is that the compiler is rather ‚Äúyoung‚Äù and does not yet have baggage optimizations, which, for example, GCC has. <br>  The solution is - there is a version of the compiler Go - gccgo. <br>  Building the program through gccgo with optimizations is as follows: <br> <code>go build -compiler gccgo -gccgoflags "-march=native -O3" main.go</code> <br>  In this case, it will be assembled with all the available optimizations and instructions on the current equipment. <br>  In general, it suffices to use only the -O2 option. <br><br>  Test results <i>for my case</i> : <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  # Standart compiler <br>  ‚ûú go build ./dedup.go <br>  ‚ûú time ./dedup&gt; / dev / null 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      real 0m4.612s <br>  user 0m4.588s <br>  sys 0m0.020s <br><br>  # gccgo compiler without optimizations <br>  ‚ûú go build -compiler gccgo ./dedup.go <br>  ‚ûú time ./dedup&gt; / dev / null <br><br>  real 0m2.110s <br>  user 0m2.084s <br>  sys 0m0.024s <br><br>  # PHP realization <br>  ‚ûú time php hash.php&gt; / dev / null <br><br>  real 0m0.634s <br>  user 0m0.608s <br>  sys 0m0.024s <br><br>  # gccgo with optimizations <br>  ‚ûú go build -a -gccgoflags "-march = native -O3" -compiler gccgo ./dedup.go <br>  ‚ûú time ./dedup&gt; / dev / null <br><br>  real 0m0.534s <br>  user 0m0.512s <br>  sys 0m0.020s <br></div></div><br><br>  The total execution time of the program compiled by gccgo with optimizations turned out to be 4.2-9.2 times faster than the build without optimizations. <br>  Summary "plate": <br><table><tbody><tr><td>  Option </td><td>  Relative time </td></tr><tr><td>  gccgo optimized </td><td>  85% </td></tr><tr><td>  Php </td><td>  100% </td></tr><tr><td>  gc v1.2.1 </td><td>  210% </td></tr><tr><td>  gccgo </td><td>  350% </td></tr><tr><td>  gc v1 </td><td>  750% </td></tr></tbody></table><br>  On this, in general, everything, thank you for your attention. <br><br>  <b>UPD1</b> : Compiler in go 1.2.1 gives significantly better results (added to the table): <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text">  ‚ûú time ./dedup&gt; / dev / null <br><br>  real 0m1.550s <br>  user 0m1.528s <br>  sys 0m0.020s <br></div></div><br>  <i>Also note that there is some difference in the final build when using different compilers for different platforms or different linkers.</i>  <i>Information here: <a href="http://blog.golang.org/gccgo-in-gcc-471">blog.golang.org/gccgo-in-gcc-471</a></i> <i><br></i>  <i>In short, everything will be fine if you use gccgo&gt; = 4.7.1 paired with the linker gold on x86 (32/64 bit).</i>  <i>The problems are perhaps not terribly scary, but more target platforms appear.</i>  <i>Details in the post on the link above.</i> </div><p>Source: <a href="https://habr.com/ru/post/222957/">https://habr.com/ru/post/222957/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222945/index.html">As we developed "Spetskor" - a super-custom mobile application for civilian reporters</a></li>
<li><a href="../222947/index.html">Update on the popularity of CMS-systems, analytics systems and online consultants in RuNet for the 2nd quarter</a></li>
<li><a href="../222951/index.html">Joint experiment of Yandex.Mail and Nginx teams: does SPDY really speed up the Internet?</a></li>
<li><a href="../222953/index.html">Experience one engineering investigation</a></li>
<li><a href="../222955/index.html">Brainstorming is not as effective as it seems</a></li>
<li><a href="../222959/index.html">Accurate video model of the evolution of the universe: Illustris (+ model of the birth of the galaxy and the end of the universe)</a></li>
<li><a href="../222961/index.html">Intel¬Æ License Manager Configuration</a></li>
<li><a href="../222963/index.html">Unit Test Definition</a></li>
<li><a href="../222965/index.html">What is wrong with the Habrahabr design</a></li>
<li><a href="../222967/index.html">The first Omsk geo-hakaton</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>