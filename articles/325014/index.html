<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The company has more similar jobs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On March 2, I gave a talk at Data Science Meetup, which was held in our office. I talked about the experience of creating an algorithm for collapsing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The company has more similar jobs</h1><div class="post__text post__text-html js-mediator-article"><p>  On March 2, I gave a talk at Data Science Meetup, which was held in our office.  I talked about the experience of creating an algorithm for collapsing similar vacancies in search results.  Under the <a href="https://habrahabr.ru/company/superjob/blog/323350/">link</a> you can familiarize yourself with the report on the last meeting, recordings of speeches and links to presentations will also be available there.  For those who prefer to perceive information in text form, I wrote this article. </p><br><p>  We ran into a problem when in the search for vacancies the issue was filled with the same vacancies from the same employer.  For example, at the request of a ‚Äúdriver‚Äù, a visitor could receive 30‚Äì40 variants of the same vacancy for the same position. </p><br><a name="habracut"></a><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a8b/acc/786/a8bacc786c94488db88f350afa1fb8cf.png"></div><br><p>  Where do such vacancies come from?  From large network companies, which we have a lot in Superjob.  As a rule, they hire a large number of staff for the same positions.  Or, recruiters ‚Äúpropagate‚Äù vacancies consciously, hoping, having covered a greater number of search queries, to find the right job seeker faster. </p><br><p>  In this case, the job seeker has to flip through entire pages of similar vacancies, and vacancies that might interest him are quickly crowded out from the first pages of the issue (which, however, also causes dissatisfaction with the employers who posted them). </p><br><p>  The solution would be to remove from the search results all doubles and leave only one vacancy of the ‚Äúdriver‚Äù. </p><br><p>  This would help to solve the problem of the applicant and would save us from customer dissatisfaction.  How can this be achieved? </p><br><ul><li>  It was necessary to learn how to evaluate the similarities of vacancies. </li><li>  Combine similar vacancies into groups. </li><li>  Show in the issuance of the most relevant representative of the group. </li></ul><br><p>  Let us examine each item in more detail. </p><br><p>  What is a vacancy? </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f4d/f6d/3ac/f4df6d3ac0b84a8d905cca6512b4858a.png"></div><br><p>  This is a semi-structured text, parts of which are heading, requirements, duties, etc., plus attributes such as salary, work address, work schedule, and so on. </p><br><p>  Superjob and previously implemented algorithms for identifying duplicates, based on the full or partial coincidence of attributes or other parts of a vacancy, but they all did not give a good enough result. </p><br><p>  This time we decided to try slightly more advanced algorithms to evaluate the lexical similarity of vacancies. </p><br><h2 id="lsh">  LSH </h2><br><p>  Locality-sensitive hashing (LSH) functions are those functions whose purpose is to maximize the likelihood of collisions of similar function arguments.  A minor change in the function argument, for example, the vacancy text, should lead to a slight change in the result of the hash function. </p><br><p>  One of the most frequently used representatives of LSH functions are the functions SimHash and Minhash.  These are hashing algorithms that convert text into a list of values, which ultimately represents the signature of this text. </p><br><p>  In the case of SimHash, the list of values ‚Äã‚Äãis just a list of bits (values ‚Äã‚Äã0 or 1). </p><br><p>  In the case of MinHash, this is the same list of values, but the value in the list is the minimum value of the hash function of each of the words relative to the given hash function.  The number of hash functions is given by the requirement of the largest duplicate detection error. </p><br><p>  The main difference between both algorithms is the probability of collisions.  In the case of SimHash, it is equal to the cosine similarity of the word frequency vectors in the documents, and in the case of MinHash it is equal to the similarity of Jacquard. </p><br><p>  I also met the opinion that MinHash detects copy-paste better, while SimHash - plagiarism. </p><br><p>  We decided that the cosine similarity more meets our requirements for determining the similarity of vacancies, and opted for the SimHash algorithm. </p><br><p>  Description of SimHash algorithm: </p><br><blockquote><ol><li>  Determine the size of simkhesh. </li><li>  Create an array of integers, filled with zeros, with a size equal to the length of the hash in bits. <br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">hash</span></span> = [<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> </li><li>  We divide the source document into words, for each word we calculate its hash using any hash function (md5, sha1), which returns the result of the same length. <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">doc</span></span> = [‚Äú‚Äù,‚Äú‚Äù,‚Äú‚Äù] doc = [<span class="hljs-number"><span class="hljs-number">01111001</span></span>, <span class="hljs-number"><span class="hljs-number">00110101</span></span>, <span class="hljs-number"><span class="hljs-number">00101110</span></span>]</code> </pre> </li><li>  For each bit of the resulting hash, increase the corresponding array element by one if the source bit is 1, and decrease it otherwise. <br><pre> <code class="hljs bash">01111001 00110101 00101110 + <span class="hljs-built_in"><span class="hljs-built_in">hash</span></span> =[-3,-1,3,1,1,1,-1,1]</code> </pre> </li><li>  Based on the resulting array, the hash result is generated as follows: if the array element is greater than zero, then the corresponding bit of the simhash is set to one, otherwise to zero. <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">hash</span></span> =[ <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>] simhash(doc) = <span class="hljs-number"><span class="hljs-number">00111101</span></span></code> </pre> </li></ol><br></blockquote><p>  What can be done now?  You can determine how similar the documents are using only their signatures. </p><br><p>  To do this, it is enough to ‚Äúproxy‚Äù them, as a result of which we will get the number of positions in which these signatures differ. </p><br><pre> <code class="hljs vbscript"> <span class="hljs-number"><span class="hljs-number">00111101</span></span> <span class="hljs-keyword"><span class="hljs-keyword">XOR</span></span> <span class="hljs-number"><span class="hljs-number">00111000</span></span> = <span class="hljs-number"><span class="hljs-number">00000101</span></span></code> </pre> <br><p>  You can get a numerical expression of the similarity of two vacancies by calculating the ratio of matching bits to the length of a simhash.  For the above simhesh, it will be: </p><br><p> <code>Similarity index = 6/8 = 0.75 (75%)</code> </p> <br><p>  Thus, we learned to evaluate the similarity of the two vacancies.  Now we can generate hashes for all vacancies and find similar ones for each of them - say, differing by no more than 2 bits. </p><br><p>  For example, if we find such hashes for h1, </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">h1</span></span> = <span class="hljs-number"><span class="hljs-number">00111101</span></span> h2 = <span class="hljs-number"><span class="hljs-number">00111000</span></span> h3 = <span class="hljs-number"><span class="hljs-number">00001101</span></span></code> </pre> <br><p>  then we find that h2 differs from h3 by more than 2 bits. </p><br><p>  Those.  hashes in a group may differ from each other more than we would like.  This means that hashes will fall into other groups and groups will have intersections. </p><br><p>  Therefore, we define what properties groups of similar vacancies should have: </p><br><ol><li>  all vacancies in a group should differ from each other by no more than a certain amount; </li><li>  adding, changing or deleting should not lead to a complete change in the composition of the groups (there is no main vacancy); </li><li>  the number of groups is not known in advance. </li></ol><br><h2 id="klasterizaciya">  Clustering </h2><br><p>  Hierarchical clustering using the full link (far neighbor) method allows you to perform all three points. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/41f/8c0/310/41f8c0310569437697988e8cab8034d5.png"></div><br><p>  First, we do not need to worry and select the optimal value of the number of clusters (in advance).  Secondly, the full coupling method forms spherical clusters of constant radius, all points within which are located at a certain distance.  Third, adding or deleting a point does not lead to mergers or disintegration of clusters. </p><br><p>  There is one drawback - the complexity of hierarchical clustering O (n ^ 3).  But, since we will cluster the vacancies of one client, we can afford not to pay attention to it in the hope that the number of vacancies for one client will be limited to reasonable values. </p><br><p>  At the output, we get a dendrogram, namely, a graph without intersections of clusters nested into each other. </p><br><img src="https://habrastorage.org/files/328/4c9/49a/3284c949a59442029890db608ef2abfb.png"><br><p>  How can we get clusters of similar vacancies of a certain degree of similarity on its basis? </p><br><img src="https://habrastorage.org/files/1bc/b61/fa8/1bcb61fa88164a4cb2f049af32360e86.png"><br><p>  Cutting the dendrogram, we get N flat clusters that will meet our requirements.  It is only necessary to determine in which place it is better to cut it. </p><br><p>  To do this, you can apply the standard technique with maximizing the second derivative of the function of the dependence of the number of clusters on the cut length of the dendrogram. </p><br><p>  The maximum value of the second derivative will point us to the optimal cut length of the dendrogram, since at this point the rate of change of the number of clusters slows down the fastest. </p><br><img src="https://habrastorage.org/files/77e/922/849/77e92284961b4deb8a79559504d98ffa.png"><br><p>  If we decide to cluster vacancies similar to each other at 80% ¬± 5%, it is enough to find the maximum value of the second derivative in this range and divide the dendrogram into clusters at this point. </p><br><h2 id="realizaciya">  Implementation </h2><br><p>  When creating or changing a job, send the task to the queue in rabbitmq for simhash calculation.  After that, in another queue, we perform the task of clustering client vacancies.  For each vacancy we assign the identifier of the cluster to which it fell.  A full cycle of calculating simkhesh and clustering vacancies of all clients from the beginning to the end takes 5 minutes. </p><br><p>  The cluster ID arrives at the <a href="http://sphinxsearch.com/">Sphinx</a> as a vacancy attribute, according to which the search results are grouped.  Only vacancies with the best value of the ranking function in their cluster are included in the issue.  If there is not one vacancy in the cluster, next to it we make a link that can be used to view the rest of the vacancies from the same cluster. </p><br><p>  Ultimately, we achieved the desired result. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/14c/866/662/14c8666625094ca0abfd87878f3f0eef.png"></div><br><h2 id="rezultaty">  results </h2><br><p>  The resulting algorithm, of course, is not perfect, similar vacancies do not always fall into their groups of similar vacancies.  But we conducted a / b testing of many metrics and got good results: </p><br><p>  - Applicants began to respond more often to vacancies of a larger number of clients, more often from the first page of the search; <br>  - decreased average and average-maximum depth of viewing search results. </p><br><p>  We also found out that in 75% of searches it is possible to group similar vacancies and in 66% of searches a user saw similar vacancies. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325014/">https://habr.com/ru/post/325014/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325000/index.html">What you need to know to take cheaper tours: how it all works (and how to get a hotel in Sochi for 1116 rubles for 5 nights)</a></li>
<li><a href="../325006/index.html">15 VoIP Providers and 8 CRM: Compatibility Overview</a></li>
<li><a href="../325008/index.html">We try to do web-frontend on Rust (WebAssembly)</a></li>
<li><a href="../325010/index.html">Painless inoculation of object thinking</a></li>
<li><a href="../325012/index.html">Managing CST MWS with Matlab</a></li>
<li><a href="../325016/index.html">Little tricks DirectX and HLSL</a></li>
<li><a href="../325018/index.html">‚ÄúSim-Sim, open!‚Äù, Or how to open a link via RemoteApp</a></li>
<li><a href="../325022/index.html">The new chip from Applied Micro is ready to contend with Intel Xeon</a></li>
<li><a href="../325026/index.html">Infrastructure organization with the help of Kubernetes and Helm. Video recordings of reports from Kubernetes meetup March 22, 2017</a></li>
<li><a href="../325028/index.html">Web Scrolling: Primer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>