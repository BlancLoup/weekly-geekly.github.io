<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pulling information from the URL, in the style of Slack and Twitter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many people use Slack, Twitter and have seen such things: 

 How does it work and how to do it yourself? 

 For those who need it urgently and immedia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pulling information from the URL, in the style of Slack and Twitter</h1><div class="post__text post__text-html js-mediator-article">  Many people use Slack, Twitter and have seen such things: <br><table><tbody><tr><td><img width="100%" src="https://habrastorage.org/files/2c9/818/6f7/2c98186f753241b4bd99352f4edad2c9.png"></td><td><img width="100%" src="https://habrastorage.org/files/d04/cb0/db9/d04cb0db96624f298c6fc1a8c301c3ad.png"></td></tr></tbody></table><br>  How does it work and how to do it yourself? <br><a name="habracut"></a><br>  For those who need it urgently and immediately: I wrote a <a href="https://github.com/dyatlov/proclink-api">ready server</a> to return oembed-like URL information.  A working option can be found <a href="http://proc.link/">here</a> . <br><br>  And now the points where you can tear out an interesting info: <br><br><h3>  1. Oembed </h3><br>  Everyone knows about &lt;title&gt; and &lt;description&gt;, we will not dwell on this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There is such a format as <a href="http://oembed.com/">Oembed</a> .  Many large portals have at their disposal an oembed endpoint.  For example: <br><br><ul><li>  Youtube: <a href="http%253A%252F%252Fwww.youtube.com%252Fwatch%253Fv%253DB8BNdhuABIY">www.youtube.com/oembed?format=json&amp;url=http%3A%2F%2Fwww.youtube.com%2Fwatch%3Fv%3DB8BNdhuABIY</a> </li><li>  Twitter: <a href="">api.twitter.com/1/statuses/oembed.json?id=655102676024369154</a> </li><li>  SoundCloud: <a href="https%253A%252F%252Fsoundcloud.com%252Fharlem_fetty%252Fjugg-feat-monty%26format%3Djson">soundcloud.com/oembed?url=https%3A%2F%2Fsoundcloud.com%2Fharlem_fetty%2Fjugg-feat-monty&amp;format=json</a> </li></ul><br>  From oembed information you can get a much more complete squeeze of the page than trying to parse html, so the priority when parsing the URL is to search for oembed links. <br><br>  This is described in <a href="http://oembed.com/">clause</a> 4 on <a href="http://oembed.com/">oembed.com</a> : <br><br>  At the head of the page you need to add at least one link of the following type: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alternate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/json+oembed"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://flickr.com/services/oembed?url=http%3A%2F%2Fflickr.com%2Fphotos%2Fbees%2F2362225867%2F&amp;format=json"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bacon Lollys oEmbed Profile"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alternate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/xml+oembed"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://flickr.com/services/oembed?url=http%3A%2F%2Fflickr.com%2Fphotos%2Fbees%2F2362225867%2F&amp;format=xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bacon Lollys oEmbed Profile"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  As you can see, here is the type of endpoint: xml or json.  Accordingly, when parsing html, if we find a link to oembed, then we can exhale and take the necessary information from oembed ednpoint.  Parsing oembed for Golang is implemented in <a href="https://github.com/dyatlov/go-oembed">my library</a> . <br><br><h3>  2. Open Graph </h3><br>  This is additional metadata on the page that Google+, Facebook and others use to embed the content of the pages in their feeds.  Read more <a href="http://ogp.me/">here</a> .  This markup is used on a huge number of sites, even on Habr√©.  For example, look at the source code for this post and search for 'og:'. <br><br>  Parsing OpenGraph for Golang is implemented in <a href="https://github.com/dyatlov/go-opengraph">my library</a> (the most complete functionality in comparison with analogues). <br><br><h3>  3. We collect information bit by bit from what is </h3><br>  If neither oembed nor opengraph on the page is present, then we are content with the available data: <br><br><ul><li>  &lt;title&gt; - for the title </li><li>  &lt;meta name = "description"&gt; - for description </li><li>  &lt;link rel = "image_src"&gt; - for image </li><li>  * if there are no pictures, then we tear out the first picture from the main text </li><li>  * if there is no description, then we tear out a part of the text from the main content as a description </li></ul><br>  To rip out content, I use <a href="https://github.com/dyatlov/go-readability">github.com/dyatlov/go-readability</a> - this is the <a href="https://github.com/mauidude/go-readability/pull/4">fork of the original go-readability</a> with the addition of whitelabeled attributes (this is necessary for correctly pulling out images). <br><br>  This is implemented at <a href="https://github.com/dyatlov/go-htmlinfo">github.com/dyatlov/go-htmlinfo</a> . <br><br><h3>  4. Generation of oembed for non-html resources </h3><br>  Links can be not only on pages, but also on pictures or video, on archives, etc.  For such links, no information will naturally be obtained.  So you have to generate it yourself. <br><br>  In Golang there is such a thing as <a href="http/">http # DetectContentType</a> .  Based on this information, you can get the type of content located at the specified address, based on the first few hundred bytes.  Then, based on the type of content, you can take the following steps.  In the case of images, I use image decoding of image headers and thus get their sizes, which I then return in the answer.  All this is implemented in the <a href="https://github.com/dyatlov/go-url2oembed">appropriate library</a> . <br><br><h3>  Defend ourselves </h3><br>  Tasks (except obvious ones): <br><br>  1. Expand redirect'y and not go into an infinite loop.  For example, <a href="http://bit.ly/1cWYIdC">bit.ly/1cWYIdC</a> should be Habrom.  <a href="">Decision</a> <br>  2. Protection against attacks on local resources (see <a href="https://www.gnu.gl/blog/Posts/multiple-vulnerabilities-in-pocket/">attack on the pocket</a> ).  <a href="">Decision</a> <br>  3. Load only a limited amount of information (if a link to an ISO image of Linux came, then there is no need to download it all).  <a href="">Decision</a> <br><br><h3>  Conclusion </h3><br>  I apologize for the large number of references to their repositories and a messy description.  I tried to make the code understandable and break it into logical modules, which can then be reused independently.  I hope that it is useful to someone. <br><br>  The source code of the finished server is <a href="https://github.com/dyatlov/proclink-api">here</a> .  And he is <a href="http://proc.link/">here</a> . <br><br>  For what you can use: automatic loading of url preview for urls from comments, popup with preview in posts with urls and other things related to the display of the contents. </div><p>Source: <a href="https://habr.com/ru/post/269055/">https://habr.com/ru/post/269055/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269037/index.html">Program modification and what is better to change: executable code or AST program?</a></li>
<li><a href="../269039/index.html">PHP Digest 72 - interesting news, materials and tools (October 5 - 18, 2015)</a></li>
<li><a href="../269041/index.html">Solving common problems when building an Xcode project generated by Unity3D</a></li>
<li><a href="../269045/index.html">Phone numbers in email clients</a></li>
<li><a href="../269049/index.html">Serge - the solution for continuous localization from Evernote</a></li>
<li><a href="../269057/index.html">Very handy abstract adapter for RecyclerView do it yourself</a></li>
<li><a href="../269061/index.html">Steam Protocol v2</a></li>
<li><a href="../269065/index.html">Big data, Beeline and Coco</a></li>
<li><a href="../269067/index.html">Hackers attack, what to do?</a></li>
<li><a href="../269069/index.html">TypeScript 1.6 release: not just React</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>