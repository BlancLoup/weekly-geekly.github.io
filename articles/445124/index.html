<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Moderate Hardening for Firefox</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The modern web consists of many different technologies that provide the most different possibilities ... but also create a considerable number of thre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Moderate Hardening for Firefox</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/_s/zf/gx/_szfgxe5xiktashexadegaxvfiq.png"></p><br><p>  The modern web consists of many different technologies that provide the most different possibilities ... but also create a considerable number of threats.  Modern browsers have become the most complex applications on a computer long ago, having overtaken even the core of the OS in complexity (Firefox has several times more code lines than Linux kernel or office suites).  We spend most of our time in the browser, so it‚Äôs not surprising that the <strong>browser is under the gun: they constantly try to hack it, use it in a botnet, try to steal our data from it, listen to its traffic, track the sites we visit and our actions on these sites</strong> . </p><br><p>  Now is the time to say that everything is not so bad, and with all these problems you can cope ... but it is not.  Out of the box, browsers are already doing quite a lot: they are regularly updated, they are trying to plug security holes, introduce new technologies for protection, provide an opportunity to expand their functionality with third-party extensions.  But <strong>there is no serious protection out of the box</strong> , and it is unlikely that it will ever appear: it comes complete with the complexity of the browser interface and partial disabling of its functionality, which ‚Äúbreaks‚Äù websites and is unlikely to appeal to ordinary users.  But the saddest thing is that even at such a price it is impossible to fully protect the browser - it has become too complicated. </p><br><p>  However, to enhance browser security, you can do a lot of things. <a name="habracut"></a>  There are a couple of good (English-speaking) projects that offer integrated approaches to additional Firefox protection: the article <a href="https://12bytes.org/articles/tech/firefox/firefoxgecko-configuration-guide-for-privacy-and-performance-buffs">Firefox Configuration Guide for Freaks and Performance Buffs</a> (or its variant for regular users <a href="https://12bytes.org/articles/tech/firefox/the-firefox-privacy-guide-for-dummies">The Firefox Privacy Guide For Dummies!</a> ) From 12bytes.org and <a href="">ghacks-user .js</a> from Thorin-Oakenpants, earthlng and claustromaniac.  They focus on maximum protection, but using such a browser for common daily tasks becomes extremely problematic and inconvenient.  In my opinion, it is worthwhile to limit ourselves to Firefox‚Äôs moderate protection in order to <strong>strike a balance between enhancing protection, preserving the functionality of the sites we need, and the effort expended on all of this</strong> . </p><br><p>  Content: </p><br><p>  <a href="https://habr.com/ru/post/445124/">Threat model</a> <br>  <a href="https://habr.com/ru/post/445124/">Security</a> <br>  <a href="https://habr.com/ru/post/445124/">Privacy</a> <br>  <a href="https://habr.com/ru/post/445124/">Fingerprinting</a> <br>  <a href="https://habr.com/ru/post/445124/">Tracking</a> <br>  <a href="https://habr.com/ru/post/445124/">Anonymity (Anonymity)</a> <br>  <a href="https://habr.com/ru/post/445124/">Available ways to enhance security</a> <br>  <a href="https://habr.com/ru/post/445124/">Extensions</a> <br>  <a href="https://habr.com/ru/post/445124/">CanvasBlocker</a> <br>  <a href="https://habr.com/ru/post/445124/">CSS Exfil Protection</a> <br>  <a href="https://habr.com/ru/post/445124/">Decentraleyes</a> <br>  <a href="https://habr.com/ru/post/445124/">ETag Stoppa</a> <br>  <a href="https://habr.com/ru/post/445124/">Header editor</a> <br>  <a href="&amp;xid=25657,15700022,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhjSBkPlSbMqutgG3uiiT36CDB3q8w#">HTTPS Everywhere</a> <br>  <a href="https://habr.com/ru/post/445124/">Neat URL</a> <br>  <a href="https://habr.com/ru/post/445124/">uBlock Origin</a> <br>  <a href="https://habr.com/ru/post/445124/">uMatrix</a> <br>  <a href="https://habr.com/ru/post/445124/">ghacks user.js</a> <br>  <a href="https://habr.com/ru/post/445124/">I have a little moderate Hardening, I want everything to the maximum!</a> <br>  <a href="https://habr.com/ru/post/445124/">The site does not work - who is to blame, where to fix?</a> <br>  <a href="https://habr.com/ru/post/445124/">Fun facts</a> </p><br><a name="threat"></a><br><h2 id="model-ugroz">  Threat model </h2><br><p>  To begin with, let's analyze the threat model, what exactly we are protecting and from what. </p><br><a name="security"></a><br><h3 id="bezopasnost-security">  Security </h3><br><p>  This is a fairly general concept, but in our case it‚Äôs about preventing others from using the browser in an irregular way: this includes a wide range of threats from hacking the browser with exploits to protecting against phishing. </p><br><p>  Obviously, there will always be holes, so 100% protection here cannot be in principle.  For the most part, it‚Äôs about turning off some browser or web technologies to reduce the attack surface. </p><br><a name="privacy"></a><br><h3 id="konfidencialnost-privacy">  Privacy </h3><br><p>  No one except the sender and the recipient should be able to read the transmitted information. </p><br><p>  Here we are talking mainly about enhancing the protection of https connections.  The default browser settings are more focused on making the connection possible, even at the cost of losing the ability to guarantee its confidentiality. </p><br><a name="fingerprinting"></a><br><h3 id="otpechatki-fingerprinting">  Fingerprinting </h3><br><p>  The user should be able to prevent the website from determining that past and current site views were performed by the same user. </p><br><p>  Here hell begins.  Forget those blessed times when it was enough to clean the cookies and enter the site from another IP, so that in principle it could not link these two visits to each other.  Now sites have access to so many diverse and unique data about the browser, operating system and user hardware that prevent them from becoming impossible.  To be honest, in the process of preparing this article I learned a lot of things that I now would like to "see" - although I knew a lot about what was happening in this area before, I didn‚Äôt imagine the scale of the disaster. </p><br><div class="spoiler">  <b class="spoiler_title">A partial list of what websites can find out about your system:</b> <div class="spoiler_text"><ul><li>  On server: <br><ul><li>  Network connection details (IP, MTU). </li><li>  SSL Session ID.  Usually it changes once a day.  This means that, for example, if you have already visited <a href="https://gmail.com/">https://gmail.com</a> under one account today, and then cleaned the cookies, etc.  and changed VPN to go to <a href="https://gmail.com/">https://gmail.com</a> from another IP - Google will still be able to determine that both visits were made from the same browser. </li><li>  All HTTP headers are being disclosed: browser version, OS, language. </li></ul></li><li>  Via CSS: <br><ul><li>  The size of the browser window.  And this is one of the most unique characteristics of the browser. </li><li>  DPI / Scale </li><li>  Installed fonts.  Through CSS, you can check for only known fonts (JS allows you to get all the fonts), but this is more than enough - after all, the list of all existing fonts is finite and well known. </li><li>  OS (in typical fonts for it). </li></ul></li><li>  Through JS: <br><ul><li>  Iron: <br><ul><li>  The number of parallel browser processes (concurrency). </li><li>  The manufacturer and model of the video card (via WebGL). </li></ul></li><li>  Browser: <br><ul><li>  Name and version. </li><li>  OS </li><li>  Locale. </li><li>  Tongue. </li><li>  Timezone. </li><li>  Settings of access rights (access to location, microphone, etc.) - which are allowed, which are prohibited, which will be asked by the user (which also forms a rather unique set in accordance with the user's settings). </li><li>  Whether private viewing is used. </li></ul></li><li>  Screen: <br><ul><li>  Screen size (resolution), available, external window, internal window, viewport. </li><li>  Is fullscreen enabled? </li><li>  Screen orientation </li><li>  Depth of color. </li><li>  DPI. </li><li>  Is HiDPI used? </li><li>  The current zoom level of the page. </li><li>  devicePixelRatio. </li></ul></li><li>  Data stores (ways to remember the user ID): <br><ul><li>  Cookies </li><li>  localStorage. </li><li>  sessionStorage. </li><li>  indexedDB. </li><li>  appCache. </li><li>  Web Worker. </li><li>  Shared Worker. </li><li>  Service Worker. </li><li>  Cache Service Worker. </li><li>  Notifications </li><li>  Normal cache (including tricks with ETag, etc.). </li></ul></li><li>  Fonts (another of the most unique factors). </li><li>  Canvas (you can get a unique fingerprint by reading the result of the browser rendering). </li><li>  DOMRect. </li><li>  Intersection Observer API. </li><li>  WebGL (among other things, you can find out the name of the video card). </li><li>  Audio API. </li><li>  List of allowed encryption algorithms and TLS versions. </li></ul></li></ul></div></div><br><p>  After looking at this list, the required by the websites websites notification of users about the use of cookies looks like a mockery. </p><br><p>  There are two approaches to protection: reducing the entropy of prints (so that many users have the same fingerprint) and increasing the entropy (so that the fingerprint of one user is different from the previous one).  Usually, entropy reduction works better, but more or less fully it can be implemented only in a Tor browser, because for this it is necessary to severely limit the users' ability to customize the browser, but general-purpose browsers cannot afford it.  As for the increase in entropy, the main problem is that the fact of randomization of a fingerprint can be determined (by making two fingerprints in a row), after which instead of a specific fingerprint value the feature ‚Äúforges a fingerprint‚Äù is used, which in itself puts you in a very narrow category of users and makes it easy to get a print that is unique to you. </p><br><p>  For us, all this means that even trying to prevent the collection of our prints makes no sense, unless it can be obtained "for free" - without sacrificing the efficiency of sites and browser usability. </p><br><a name="tracking"></a><br><h3 id="otslezhivanie-tracking">  Tracking </h3><br><p>  It should not be possible to link together the browsing of different websites by one user, unless he himself informed one site about his account on another site. </p><br><p> Usually, tracking is done through connecting resources (JS / CSS / image) of the same third-party site to many other sites.  It would seem that using extensions to block trackers and advertisements should solve this problem ... but, alas, it is not.  Yes, it helps, but the harsh truth is that sites sell these data, so even if you visit two sites that block all third-party resources, these sites can still sell data on your visits to the same ad network that will allow her to link these visits among themselves (given the above-mentioned possibilities of obtaining a unique user's fingerprint - this will not be a problem). </p><br><p>  Nevertheless, blocking third-party resources is still worth it - it speeds up the loading of sites, eliminates advertising, makes tracking more difficult and expensive, and also reduces the sources of attacks on the browser. </p><br><a name="anonymity"></a><br><h3 id="anonimnost-anonymity">  Anonymity (Anonymity) </h3><br><p>  It should not be possible to associate the browsing of the website with the real identity of the user, if he did not register on this site under his real name and did not log in to him from the IP address registered to him by the provider. </p><br><p>  Considering the possibilities of obtaining fingerprints and tracking - the anonymity of the user, who at least one of the sites visited allowed him to find out his real personality, turns into a fiction. </p><br><p>  Increased anonymity is beyond the scope of our task.  In short, keep in mind: there is no anonymity when using your main browser, and there never will be.  Anonymity is needed - look towards specialized virtual locks (with default settings and without saving the results to disk after turning off the virtual one), VPN + Tor and Tor browser instead of the usual Firefox. </p><br><a name="protection"></a><br><h2 id="dostupnye-sposoby-usileniya-zaschity">  Available ways to enhance security </h2><br><p>  So what can we do?  In order of increasing complexity of use: </p><br><ul><li>  You can use the browser‚Äôs built-in capabilities to monitor and isolate websites on an individual basis: <br><ul><li>  Containers. </li><li>  Private window </li><li>  Manage access rights for websites. </li><li>  Blocking third-party cookies and famous trackers. </li><li>  Deleting data / cache saved by websites. </li></ul></li><li>  You can install a variety of extensions. </li><li> You can pick among the thousands of available browser settings in <code>about:config</code> and change some of them. </li></ul><br><p>  With the first paragraph, everything is trivial, but I would like to highlight the containers.  This is a relatively new feature of Firefox, which allows you to isolate a group of sites in one container from a group of sites in another.  In fact, the use of different containers in one browser should work the same way as the simultaneous use of several different browsers - but to make it more user-friendly.  Insulation of containers is still slightly weaker than when using different browsers, but it is quite good and containers can be used.  However, the containers themselves do not enhance the protection of any of the items considered in our threat model - maximum, they slightly impede the user's fingerprint by isolating the data stores ( <a href="https://wiki.mozilla.org/Security/Contextual_Identity_Project/Containers">cookies, cache, etc.</a> ). </p><br><p>  Extensions come across very different - some are enough to install and they will work without requiring attention and fine-tuning, others need to be constantly configured to restore the functionality of new sites, and still others are a threat to security, privacy and tracking.  Therefore, you should very carefully consider the choice of installed extensions, their privacy policies and their updates. </p><br><p>  As for changing the settings, <code>about:config</code> is the most difficult way to enhance security.  Too many of these settings, too little information about what may break when each setting changes, not too obvious effect on most of them, plus each new version of Firefox brings with it a bunch of new settings and removes some of the old ones. </p><br><a name="extensions"></a><br><h2 id="rasshireniya">  Extensions </h2><br><p>  Consider <strong>whether it is worth using the automatic update of extensions</strong> (you can turn it off on <code>about:addons</code> ).  There are many reasons why it should be turned off (but it is still necessary to update them, just manually and carefully tracking changes, including privacy policies): </p><br><ul><li>  Developers regularly decide to start monetizing the expansion in ways that, in the context of this article, you will definitely not like. </li><li>  Developers sometimes sell extensions, and their new owner usually makes changes to them that you can hardly like. </li><li>  Extensions occasionally "hijack" the developer. </li><li>  Newer versions may break compatibility with your current configuration and / or fail. </li></ul><br><p>  Some extensions use <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">CSP</a> to implement individual features.  Unfortunately, at the moment, the Firefox architecture is such that only one of the extensions will be able to modify the CSP when loading a website - and you cannot be sure which one is in advance.  Since it is very critical to <strong>ensure the correct operation of uMatrix</strong> , it is necessary to carefully monitor the settings of other extensions to make sure that <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki/4.1-Extensions">all features that use CSP</a> are <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki/4.1-Extensions">disabled</a> in them: </p><br><ul><li>  <strong>uBlock Origin</strong> : Turn off the <code>  ‚Üí  ‚Üí    ‚Üí [ ]   </code> (not exactly sure, but it is logical to assume that for individual sites it is also better not to include). </li><li>  <strong>HTTPS Everywhere</strong> : Disable <code> ‚Üí [ ]     (EASE)</code> . </li><li>  <strong>CanvasBlocker</strong> : Disable <code> ‚Üí  ‚Üí [ ] Block data URL pages</code> (to see this item you need to enable <code> ‚Üí [‚úì]  </code> ). </li></ul><br><p>  If you decide not to limit the installation of extensions, and put the following <code>user.js</code> , then consider the additional details: </p><br><ul><li>  The recommended <code>user.js</code> requires the use of the <strong>uMatrix</strong> extension. </li><li>  Some settings in <code>user-overrides.js</code> are needed in order not to break the work of some extensions - adjust them according to what extensions you have installed. </li></ul><br><a name="canvasblocker"></a><br><h3 id="canvasblocker">  CanvasBlocker </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/canvasblocker/">Link</a></strong> </li><li>  <strong>Protects:</strong> Imprints. </li><li>  <strong>Description:</strong> Prevents fingerprinting through various APIs: Canvas, WebGL, Audio, History, Window (disabled by default - can break websites), DOMRect. </li><li>  <strong>Use:</strong> Works automatically, does not require attention.  Shows a separate icon at the end of the address bar on sites that are trying to use protected APIs (through it, you can disable blocking on a specific site). </li><li>  <strong>Icon:</strong> You can hide in the advanced menu. </li><li>  <strong>Setup:</strong> <br><pre> <code class="plaintext hljs">[‚úì]   [‚úì] Block data URL pages` (  CSP  uMatrix)</code> </pre> </li></ul><br><a name="cssexfil"></a><br><h3 id="css-exfil-protection">  CSS Exfil Protection </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/css-exfil-protection/">Link</a></strong> </li><li>  <strong>Protects:</strong> Privacy. </li><li>  <strong>Description:</strong> Blocks attacks like CSS data exfiltration (theft of data from the page through the use of specific CSS selectors). </li><li>  <strong>Use:</strong> Works automatically, does not require attention. </li><li>  <strong>Icon:</strong> You can hide in the advanced menu. </li><li>  <strong>Setup:</strong> Not required. </li></ul><br><a name="decentraleyes"></a><br><h3 id="decentraleyes">  Decentraleyes </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/decentraleyes/">Link</a></strong> </li><li>  <strong>Protects:</strong> Tracking. </li><li>  <strong>Description:</strong> Protects against tracking by ‚Äúfree‚Äù CDNs.  Contains popular files, which are usually requested via CDN, and gives them to the browser without performing a real network request on a CDN.  A side effect is that it speeds up the loading of sites a bit. </li><li>  <strong>Use:</strong> Works automatically, does not require attention. </li><li>  <strong>Icon:</strong> You can hide in the advanced menu. </li><li>  <strong>Setup:</strong> Not required. </li></ul><br><p>  Unfortunately, at me it <a href="https://git.synz.io/Synzvato/decentraleyes/issues/323">hangs up the Firefox interface while in the background some sites are loaded</a> , so I had to turn it off for now. </p><br><a name="etagstoppa"></a><br><h3 id="etag-stoppa">  ETag Stoppa </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/etag-stoppa/">Link</a></strong> </li><li>  <strong>Protects:</strong> Imprints. </li><li>  <strong>Description:</strong> Removes the <code>ETag:</code> header from the server response. </li><li>  <strong>Use:</strong> Works automatically, does not require attention. </li><li>  <strong>Icon:</strong> None. </li><li>  <strong>Setup:</strong> Not required. </li></ul><br><p>  Instead of using this extension, you can add a rule in the <strong>Header Editor</strong> (it makes sense if it is used for other rules): </p><br><ul><li>  Rule type: Modify response header </li><li>  Match type: All </li><li>  Execute type: Custom function </li><li>  Custom function: <br><pre> <code class="plaintext hljs">for (const a in val) { if (val[a].name.toLowerCase() === 'etag') { val[a].value = ''; } }</code> </pre> </li></ul><br><a name="headereditor"></a><br><h3 id="header-editor">  Header editor </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/header-editor/">Link</a></strong> </li><li>  <strong>Protects:</strong> Depends on how to use it. </li><li>  <strong>Description:</strong> Allows you to set your own rules for blocking or redirecting requests, as well as changing the request or response headers. </li><li>  <strong>Use:</strong> Works automatically, does not require attention. </li><li>  <strong>Icon:</strong> You can hide in the advanced menu. </li><li>  <strong>Setting:</strong> By itself, he does nothing at all - you have to define the rules for him. </li></ul><br><p>  One example of the rules is mentioned above in the description of <strong>ETag Stoppa</strong> .  But if there are no other rules, it is easier to use <strong>ETag Stoppa</strong> instead of this extension. </p><br><p>  Another example: I found that the <strong>ImTranslator</strong> extension for some reason sends two cookies to all sites: <code>BL_D_PROV=undefined; BL_T_PROV=undefined</code>  <code>BL_D_PROV=undefined; BL_T_PROV=undefined</code> .  Maybe this is just a bug, but I do not like that it tells all sites that I use this extension.  The problem is solved by this rule: </p><br><ul><li>  Rule type: Modify request header </li><li>  Match type: All </li><li>  Execute type: Custom function </li><li>  Custom function: <br><pre> <code class="plaintext hljs">for (const a in val) { if (val[a].name.toLowerCase() === 'cookie') { val[a].value = val[a].value.split(/;\s*/).filter((kv)=&gt;{ return !kv.match(/^BL_[DT]_PROV=/) }).join('; '); if (val[a].value === '') { delete val[a]; } } }</code> </pre> </li></ul><br><a name="httpseverywhere"></a><br><h3 id="https-everywhere">  HTTPS Everywhere </h3><br><ul><li>  <strong><a href="https-everywhere/">Link</a></strong> </li><li>  <strong>Protects:</strong> Privacy. </li><li>  <strong>Description:</strong> Automatically switches to https wherever possible. </li><li>  <strong>Usage:</strong> It works automatically, <em>almost</em> does not require attention (the last time a site broke down because of this extension a year and a half ago). </li><li>  <strong>Icon:</strong> Used to customize sites. </li><li>  <strong>Setup:</strong> Not required. </li></ul><br><a name="neaturl"></a><br><h3 id="neat-url">  Neat URL </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/neat-url/">Link</a></strong> </li><li>  <strong>Protects:</strong> Tracking. </li><li>  <strong>Description:</strong> Removes trash options from URLs. </li><li>  <strong>Use:</strong> Works automatically, does not require attention. </li><li>  <strong>Icon:</strong> You can hide in the advanced menu. </li><li>  <strong>Setup:</strong> Not required. </li></ul><br><a name="ublockorigin"></a><br><h3 id="ublock-origin">  uBlock Origin </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/ublock-origin/">Link</a></strong> </li><li>  <strong>Protects:</strong> Security, Imprints, Tracking. </li><li>  <strong>Description:</strong> An automatic blocker (based on third-party lists) of any garbage by type and / or url, as well as individual elements of the page: from advertising and notifications about the use of the site cookies to trackers and malware. </li><li>  <strong>Use:</strong> <em>Occasionally</em> you need to set up a new site. </li><li>  <strong>Icon:</strong> Required to configure the current site, including manual blocking of individual elements of the page. </li><li>  <strong>Setup:</strong> (filter lists - a matter of personal preference) <br><pre> <code class="plaintext hljs"> [‚úì]     ‚Üí  [‚úì]    IP-  WebRTC [‚úì]  CSP-   ‚Üí  [‚úì] uBlock filters ‚Äì Annoyances   ‚Üí  [‚úì] Adblock Warning Removal List   ‚Üí  [‚úì] Fanboy's Enhanced Tracking List   ‚Üí   [‚úì] Malvertising filter list by Disconnect [‚úì] Spam404   ‚Üí   [‚úì] AdGuard Annoyances filter [‚úì] Fanboy's Cookie List [‚úì] Fanboy's Annoyance List   ‚Üí  [‚úì] Dan Pollock's hosts file [‚úì] hpHosts' Ad and tracking servers   ‚Üí ,  [‚úì] RUS: RU AdList</code> </pre> </li></ul><br><a name="umatrix"></a><br><h3 id="umatrix">  uMatrix </h3><br><ul><li>  <strong><a href="https://addons.mozilla.org/ru/firefox/addon/umatrix/">Link</a></strong> </li><li>  <strong>Protects:</strong> Security, Imprints, Tracking. </li><li>  <strong>Description:</strong> Manual blocker of individual resources by type and domain. </li><li>  <strong>Use:</strong> <em>Regularly</em> need to customize the new site. </li><li>  <strong>Icon:</strong> Required to configure the current site. </li><li><p>  <strong>Setup:</strong> </p><br><pre> <code class="plaintext hljs"> ‚Üí  [‚úì]      ‚Üí  [‚úì]      [1440]     [‚úì]       [‚úì]     [1440]  #   referer  uMatrix    user.js: [ ]   HTTP referrer      [‚úì]  HTTPS:    #  " ",    ""  "":  ‚Üí   * * script block</code> </pre> <br></li></ul><br><p>  This extension provides the most serious protection, but it has a price: many sites will be broken, and they will need to be repaired manually.  For example, the newly added rule <code>"* * script block"</code> disabled JS execution on all sites - which, of course, has broken many of them.  But do not rush to remove this rule: firstly, it does not help much, because  loading of many types of resources including JS from third-party sites is still disabled (which also breaks many sites);  and secondly, the <strong>white list</strong> approach <strong>: everything that was not explicitly allowed is forbidden</strong> in the modern web is the only acceptable one, since you want to increase the security of Firefox. </p><br><p>  The good news is that repairing sites is not difficult - usually two or three clicks in the matrix, which is shown by the extension icon, and then re-reading the current page are enough.  The main thing is not to forget to save changes in the same matrix after you repair the site. </p><br><p>  And prepare yourself mentally that at first you will have to repair almost every site you often visit - this is due to the fact that on actively used sites you will almost certainly need to include at least JS of the site itself, plus, perhaps, some resources from third-party sites.  Be patient the first days, then it will become much easier, honestly!  :) </p><br><p>  It should be noted that the <strong>uMatrix</strong> interface <strong>is</strong> very clear and convenient - after you <strong>figure</strong> it out.  In other words, it cannot be called intuitive.  Therefore, it is highly desirable to read the documentation!  At a minimum, the <a href="https://12bytes.org/articles/tech/firefox/firefoxgecko-configuration-guide-for-privacy-and-performance-buffs">uMatrix basic usage</a> section (with pictures) from the aforementioned <a href="https://12bytes.org/articles/tech/firefox/firefoxgecko-configuration-guide-for-privacy-and-performance-buffs">Firefox</a> article in the <a href="https://12bytes.org/articles/tech/firefox/firefoxgecko-configuration-guide-for-privacy-and-performance-buffs">Configuration Guide for Freaks and Performance Buffs</a> .  In general, I highly recommend reading the <a href="https://github.com/gorhill/uMatrix/wiki">wiki uMatrix</a> - there are a lot of things, but the information is very necessary and useful. </p><br><p>  There is another additional set of rules that can make sense to add to <code> ‚Üí  </code> - it will help block access to Internet resources for websites on the local network (this is <em>not a</em> defense against DNS rebinding attacks).  If you installed uMatrix a long time ago, you must first delete the <code>"matrix-off: localhost true"</code> rule (new versions of uMatrix do not install it). </p><br><div class="spoiler">  <b class="spoiler_title">Add these rules here:</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">* localhost * block * 127 * block * 10 * block * 192.168 * block * 169.254 * block * 172.16 * block * 172.17 * block * 172.18 * block * 172.19 * block * 172.20 * block * 172.21 * block * 172.22 * block * 172.23 * block * 172.24 * block * 172.25 * block * 172.26 * block * 172.27 * block * 172.28 * block * 172.29 * block * 172.30 * block * 172.31 * block * [::1] * block * [fc00::] * block * [fd00::] * block * [fe80::] * block * [fe80::1%lo0] * block * [ff02::1] * block * [ff02::2] * block localhost localhost * allow 127 127 * allow 10 10 * allow 192.168 192.168 * allow 169.254 169.254 * allow 172.16 172.16 * allow 172.17 172.17 * allow 172.18 172.18 * allow 172.19 172.19 * allow 172.20 172.20 * allow 172.21 172.21 * allow 172.22 172.22 * allow 172.23 172.23 * allow 172.24 172.24 * allow 172.25 172.25 * allow 172.26 172.26 * allow 172.27 172.27 * allow 172.28 172.28 * allow 172.29 172.29 * allow 172.30 172.30 * allow 172.31 172.31 * allow [::1] [::1] * allow [fc00::] [fc00::] * allow [fd00::] [fd00::] * allow [fe80::] [fe80::] * allow [fe80::1%lo0] [fe80::1%lo0] * allow [ff02::1] [ff02::1] * allow [ff02::2] [ff02::2] * allow</code> </pre> </div></div><br><a name="userjs"></a><br><h2 id="ghacks-userjs">  ghacks user.js </h2><br><p>  With extensions everything was simple (yes, and even with <strong>uMatrix</strong> - although it complicates the use of the browser, it also gives the basic protection), and now we have reached the difficult part. </p><br><p>  The <a href="">ghacks user.js</a> project provides us with a base <code>user.js</code> file, plus scripts for updating it and resetting remote settings.  This file contains (for now) a change of <strong>488 settings</strong> in <code>about:config</code> !  And they consider it to be basic not without a reason: using it as is, without making the changes you need - almost guaranteed to lead to a catastrophe (for example, its default settings regularly delete the entire browser history, block Firefox Russification, break many sites and extensions). </p><br><p>  This project is making very serious efforts to protect Fingerprints and Tracking ... so serious that it becomes so inconvenient to use the browser to such an extent that it is more honest to say ‚Äúimpossible‚Äù.  And at the same time, it still noticeably loses in the protection of the Tor browser in the virtual machine.  This in no way means that the project is useless for users - just to use it, you need to spend a lot of time creating your own <code>user-overrides.js</code> . </p><br><p>  For this reason, before using it, you must: </p><br><ul><li>  Carefully read the <a href="">user.js</a> (about 2300 lines). </li><li>  Carefully read all the <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki">wiki</a> pages of the <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki">project</a> . </li><li>  Create your own <code>user-overrides.js</code> file with all the changes regarding <code>user.js</code> that you personally need. </li><li>  <strong>Make a backup of your Firefox profile !!!</strong> </li><li>  And only then activate <code>user.js</code> </li></ul><br><p>  It takes time, and a lot.  Is it worth it?  Complex issue. </p><br><p>  To answer it, I compiled a (incomplete) list of what it improves <em>besides</em> Imprints and Tracking ‚Äî look and decide for yourself: </p><br><ul><li>  Security: <br><ul><li>  Disable <strong>HTTP Auth</strong> cross-origin (phishing accounts). </li><li>  Strengthens protection when using <strong>memorized passwords</strong> . </li><li>  Strengthens security when using <strong>TLS and certificates</strong> . </li><li>  Limits <strong>font support</strong> (high probability of vulnerabilities). </li><li>  Disables <strong>DRM plugins</strong> . </li><li>  Disables <strong>WebGL</strong> (high probability of vulnerabilities). </li><li>  Limits the features of <strong>WebGL</strong> if enabled (high probability of vulnerabilities). </li><li>  Turns off all kinds of options for <strong>workers</strong> (miners, Meltdown / Specter). </li><li>  Disables <strong>asm.js</strong> (high probability of vulnerabilities). </li><li>  Disables <strong>WebAssembly</strong> . </li><li>  Turns off <strong>Shared Memory</strong> (Specter). </li><li>  Adds <code>rel=noopener</code> for links with <code>target=_blank</code> (security). </li><li>  Strengthens protection when interacting with <strong>third-party local applications</strong> . </li><li>  Disables <strong>MathML</strong> (decrease attack surface). </li><li>  Forcing Punycode for <strong>IDN</strong> (anti-spoofing). </li><li>  Enables experimental support for <strong>CSP 1.1</strong> . </li><li>  Includes <strong>first party isolation</strong> . </li></ul></li><li>  Leaks, handling: <br><ul><li>  Disables Firefox <strong>telemetry</strong> and features tied to it (recommendations, etc.). </li><li>  Disables <strong>third-party services</strong> like Pocket. </li><li>  Blocks the <strong>downloading of links that are not clicked</strong> (ping, pre-fetch, etc.). </li><li>  Disables network features through which you can bypass proxy / VPN and <strong>learn IP</strong> (including IPv6 and WebRTC). </li><li>  Limits the leakage of the <strong>history of previous pages</strong> in the current tab. </li><li>  Disables <strong>: visited</strong> (history leak). </li><li>  Blocks a leak in the process of typing in the address bar / text search <strong>through the search engine tips</strong> . </li><li>  Disables <strong>screen sharing</strong> . </li><li>  Denies access to the <strong>clipboard</strong> . </li><li>  Disables the <strong>Intersection Observer API</strong> (stability, ad blocker definition). </li></ul></li></ul><br><p>  To simplify the preparation of your <code>user-overrides.js</code> author of the aforementioned articles on 12bytes.org has posted his own <a href="">user-overrides.js</a> .  He categorically did not suit me, because I need <em>moderate</em> protection, which preserves the usability of the browser, even at the price of weakening the protection against Impressions and Tracking. </p><br><p>  I also laid out my <a href="https://gist.github.com/powerman/b90f3a63fa2f3583d3e89b2468f95388">user-overrides.js</a> , maybe it will simplify your use of ghacks <code>user.js</code> </p><br><p>  So, to start using ghacks <code>user.js</code> , do the following: </p><br><ul><li>  <strong>MANDATORY!</strong>  <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki/1.2-Backing-Up">Backup</a> your current Firefox profile. </li><li>  Download the following files from the <a href="">ghacks user.js</a> project to your current profile <a href="">directory</a> : <br><ul><li> <code>user.js</code> </li> <li>  <code>updater.sh</code> (and make it doable) or <code>updater.bat</code> </li><li>  <code>prefsCleaner.sh</code> (and make it executable) or <code>prefsCleaner.bat</code> </li></ul></li><li>  Create a file <code>user-overrides.js</code> in your current profile directory. <br><ul><li>  You can simply download my <a href="https://gist.github.com/powerman/b90f3a63fa2f3583d3e89b2468f95388">user-overrides.js</a> , then enter your current <code>dom.push.userAgentID</code> value <code>dom.push.userAgentID</code> and make the changes you need. </li></ul></li><li>  Run <code>./updater.sh</code> or <code>updater.bat</code> .  He will update <code>user.js</code> and add the contents of <code>user-overrides.js</code> to the end. </li><li>  Exit Firefox and run <code>./prefsCleaner.sh</code> or <code>prefsCleaner.bat</code> .  It will remove all the settings mentioned in <code>user.js</code> (including commented out) from the <code>prefs.js</code> file (containing your current settings <code>about:config</code> ). </li><li>  Launch Firefox.  Press <code>Ctrl-Shift-Del</code> and delete (for all time): <br><ul><li>  Cookies </li><li>  Cache. </li><li>  Offline website data. </li></ul></li><li>  Look in <code>about:config</code> , the <code>_user.js.parrot</code> parameter should be set to "SUCCESS" - otherwise <code>user.js</code> syntax error somewhere in your <code>user.js</code> </li></ul><br><p>  Keep in mind that all settings specified in <code>user.js</code> will be applied each time Firefox is launched.  So if you change some of them through <code>about:config</code> , and want to save these changes when you restart Firefox, you need to duplicate them in <code>user-overrides.js</code> , and then run <code>./updater.sh</code> or <code>updater.bat</code> . </p><br><p>  Do not forget to periodically run <code>./updater.sh</code> or <code>updater.bat</code> to update <code>user.js</code> (at least after the release of the new version of Firefox).  The update process is described in more detail in the <a href="https://github.com/ghacksuserjs/ghacks-user.js/wiki">project wiki</a> . </p><br><a name="hardcore"></a><br><h2 id="mne-malo-umerennogo-hardening-hochu-vsyo-po-maksimumu">  I have a little moderate Hardening, I want everything to the maximum! </h2><br><p>  Well, in this case, here's what to do next: </p><br><ul><li>  Discard security-weakening changes in <code>user-overrides.js</code> . <br><ul><li>  Instead of unlocking Workers, block them globally in uMatrix. </li></ul></li><li>  Hide IP via Tor and / or public VPN service. </li><li>  Install the <a href="https://addons.mozilla.org/ru/firefox/addon/privacy-oriented-origin-policy/">Privacy-Oriented Origin Policy</a> . </li><li>  Put the extension <a href="https://addons.mozilla.org/ru/firefox/addon/skip-redirect/">Skip Redirect</a> . </li><li>  Put the extension <a href="https://addons.mozilla.org/ru/firefox/addon/temporary-containers/">Temporary Containers</a> . </li><li>  Read <a href="https://12bytes.org/articles/tech/firefox/firefox-search-engine-cautions-and-recommendations">Firefox Search Engine Cautions, Recommendations</a> and clean up the search engine settings in Firefox. </li><li>  Remove the embedded extensions from / usr / lib / firefox / browser / features /. </li><li>  Enable Referer global spoofing for third-party sites in uMatrix. </li></ul><br><a name="troubleshooting"></a><br><h2 id="sayt-ne-rabotaet---kto-vinovat-gde-chinit">  The site does not work - who is to blame, where to fix? </h2><br><p>  I made a list of changes that may disrupt the site so that you can quickly find someone to blame.  The mark "(Blocked)" means that this change is in the original <code>user.js</code> , but it is disabled by my <code>user-overrides.js</code> . </p><br><ul><li>  Extension: CanvasBlocker <br><ul><li>    <strong>Canvas 2D</strong> . </li><li>    <strong>WebGL</strong> . </li><li>    <strong>Audio API</strong> . </li><li>    <strong>history.length</strong> . </li><li>   <strong>window.name</strong>  <strong>window.opener</strong> . </li><li>    <strong>DOMRect API</strong> . </li><li>   <strong>data://</strong> . </li></ul></li><li> : CSS Exfil Protection <br><ul><li> /   <strong>CSS</strong> . </li></ul></li><li> : ETag Stoppa <br><ul><li>      <strong>ETag:</strong> . </li></ul></li><li> : Firefox Multi-Account Containers <br><ul><li>   ( <strong></strong> , <strong>localStorage</strong> , etc.)    . </li></ul></li><li> : HTTPS Everywhere <br><ul><li>  http:// <strong></strong>  https://    . </li></ul></li><li> : Neat URL <br><ul><li>   url  <strong></strong> . </li></ul></li><li> : uBlock Origin <br><ul><li>     <strong> DOM</strong> . </li><li>  <strong></strong>   <strong>  / url</strong> . </li><li>    <strong>popup</strong>  . </li><li>   <strong> </strong>  . </li><li>   <strong>pre-fetching</strong> . </li><li>   <strong>&lt;a ping&gt;</strong>  <strong>sendBeacon</strong> . </li><li>   <strong> CSP</strong> . </li></ul></li><li> : uMatrix <br><ul><li>  <strong></strong>   <strong>   </strong> . </li><li>   <strong>mixed content  </strong> . </li><li>   <strong>workers  </strong> . </li><li>   <strong>Referer:  </strong> . </li><li>   <strong>&lt;noscript&gt;  </strong> . </li><li>   <strong>&lt;a ping&gt;</strong>  <strong>sendBeacon</strong> . </li></ul></li><li> ghacks user.js <br><ul><li> ()    en-US. </li><li>  <strong>pre-fetching</strong>  (, DNS, onMouseOver, etc.). </li><li>  <strong>&lt;a ping&gt;</strong> . </li><li>  <strong>IPv6</strong> ( MAC,  ..   VPN). </li><li> ()  <strong>HTTP/2</strong>  <strong>Alt-Svc:</strong> (fingerprinting). </li><li> ()  <strong>/etc/hosts</strong>  <strong> DNS</strong>   SOCKS. </li><li> ()  <strong>:visited</strong> ( ). </li><li> ()  <strong>date/time picker</strong> ( ). </li><li>  cross-origin <strong>HTTP Auth</strong> (  ). </li><li> ()    https-  <strong>OCSP</strong> . </li><li>  <strong>SHA1</strong> https- (   /MITM). </li><li>  <strong>Public Key Pinning</strong> (   /MITM). </li><li> ()  <strong> mixed content</strong> . </li><li>  <strong>mixed content</strong>   Flash. </li><li> ()  <strong> </strong> (fingerprinting). </li><li>  <strong> </strong> (  ). </li><li>  cross-origin <strong>Referer:</strong>     . </li><li>  <strong>DRM-</strong> . </li><li> ()  <strong>OpenH264 Video Codec</strong>  - WebRTC. </li><li> ()  <strong>WebRTC</strong> ( IP,  ..  VPN). </li><li>  <strong>WebGL</strong> (  ). </li><li> ()   <strong>WebGL</strong>    (  ). </li><li>  <strong>screen sharing</strong> . </li><li>  <strong>  canvas</strong> (fingerprinting). </li><li> ()  <strong>- HTML5 media</strong> . </li><li>   <strong>  window.open</strong> . </li><li>   <strong>  </strong>    . </li><li>    <strong>popup</strong>  click  dblclick. </li><li> ()  <strong>workers</strong> (, Meltdown/Spectre). </li><li>    <strong>clipboard</strong> . </li><li>   <strong>beforeunload</strong> . </li><li>  <strong>asm.js</strong> (  ). </li><li>  <strong>WebAssembly</strong> . </li><li>  <strong>Intersection Observer API</strong> (,   ). </li><li>  <strong>Shared Memory</strong> (Spectre). </li><li>  <code>rel=noopener</code>    <code>target=_blank</code> (). </li><li>  <strong>hardware acceleration</strong> (fingerprinting). </li><li>  <strong>Web Audio API</strong> (fingerprinting). </li><li>  <strong>sendBeacon</strong> . </li><li>   -   <strong>file://</strong> . </li><li>  <strong>MathML</strong> (  ). </li><li> ()  <strong> </strong> . </li><li>  <strong>offline cache</strong> . </li><li> ()  <strong>first party isolation</strong> (  - ). </li><li> ()  <strong>resist fingerprinting</strong> ( / , ,   , ,    ;   ;    , ;   Shift  Alt; etc.). </li></ul></li><li>  user-overrides.js <br><ul><li>  <strong> </strong>  . </li><li>  <strong>TLS 1.0, 1.1</strong> . </li><li>  <strong>  TLS</strong> . </li></ul></li></ul><br><a name="facts"></a><br><h2 id="zabavnye-fakty">   </h2><br><p>   Firefox,     , ,    :      Mozilla. ,   ALSA   PulseAudio  <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1345661"></a>  ,         PulseAudio.  " ,  PulseAudio,   "   ,    ,        (, ,    ‚Äî  PulseAudio,  ). </p><br><p>  Firefox    ,    : , FPI (first party isolation)  RFP (resist fingerprinting).    -             <a href="https://addons.mozilla.org/ru/firefox/addon/temporary-containers/">Temporary Containers</a> ( ,   "   Hardening") ‚Äî       ,          .           ,    . ,     ,       . </p><br><p>  <a href="https://html5test.com/">https://html5test.com</a>         HTML5   508  555 ( ,  <code>user.js</code> )  493 ( <code>user.js</code>   <code>user-overrides.js</code> ). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/445124/">https://habr.com/ru/post/445124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445112/index.html">Unraveling vulnerability on sites</a></li>
<li><a href="../445114/index.html">Improved sandboxing for groovy scripts</a></li>
<li><a href="../445116/index.html">The US Air Force is working on a drone with elements of AI called Skyborg</a></li>
<li><a href="../445118/index.html">In the Telegram personal chat, you can delete any messages - even strangers (added voting result)</a></li>
<li><a href="../445122/index.html">The digest of fresh materials from the world of the frontend for the last week No. 357 (March 18 - 24, 2019)</a></li>
<li><a href="../445126/index.html">Reverse engineering applications after obfuscation (Part 2)</a></li>
<li><a href="../445128/index.html">Oracle Application Express Tutorial IDE Overview</a></li>
<li><a href="../445130/index.html">Interior Ministry bought a PC for 180 million rubles - all the money went to foreign manufacturers</a></li>
<li><a href="../445134/index.html">This is your Haskel (not) only for factorials and fit</a></li>
<li><a href="../445136/index.html">Do not be nervous, do not rush, do not interrupt: the story of one tragedy</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>