<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal template engine for 1 minute from scrap materials</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's no secret for anyone now that the template engine should be a full-fledged programming language. 

 Do not forget that the use of templates is fa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal template engine for 1 minute from scrap materials</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/dfa36c19/7b48b4ef/beb11ef5/db309e10.jpg" alt="Template"><br><br>  It's no secret for anyone now that the template engine should be a full-fledged programming language. <br><br>  Do not forget that the use of templates is far from being limited to WEB. <br>  These include the generation of various types of reports, the generation of code for programs in various languages, the generation of source data for processing, and much more. <br>  In general, I want to apply templates everywhere where there is a lot of text and a little logic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In thought, how to do it quickly and cheaply, you should not deceive yourself (mostly at an early stage) with thoughts like ‚Äúyes I have a static text, just need to glue the cap‚Äù, ‚Äúonly the counter is needed‚Äù, ‚ÄúI need only to withdraw date "etc. <br>  First, the header and the counter, then there will be a conditional block insertion (if), then you will need to generate tables (we need cycles and arrays), then string operations and all other constructions of the normal programming language will be pulled. <br><a name="habracut"></a><br><h4>  Search for a solution </h4><br>  Since I was not going to invent my own programming language, but I wanted a solution quickly and cheaply, I took perl for the beginning with its regexps and started generating output by tags of the form <code>&lt;?=value?&gt;</code> And <code>&lt;? code ?&gt;</code>  <code>&lt;? code ?&gt;</code> . <br>  The code turned out a type <br><pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"text"</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $value; code</code> </pre> <br>  On the other hand, after seeing how double quotes are inserted, I realized that I was doing what was already done before me: the perl compiler itself replaces strings when parsing text <pre> <code class="perl hljs"><span class="hljs-string"><span class="hljs-string">"abc $var cde"</span></span></code> </pre>  on <pre> <code class="perl hljs"><span class="hljs-string"><span class="hljs-string">"abc "</span></span>.$var.<span class="hljs-string"><span class="hljs-string">" cde"</span></span></code> </pre> <br>  Well and fine, it is possible to insert values ‚Äã‚Äãand through $ var, and to receive result eval th. <br>  This is already half the battle: we can already insert variables and array elements into the template. <br>  It remains to decide what to do with the code. <br><br>  Here interpolation of arrays comes to the rescue: <pre> <code class="perl hljs"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"5*5 = </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">@{[</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">5</span></span></span></span><span class="hljs-string"><span class="hljs-subst">*</span></span><span class="hljs-number"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-number">5</span></span></span></span><span class="hljs-string"><span class="hljs-subst">]}</span></span></span><span class="hljs-string">"</span></span></code> </pre>  will lead <br> <code>5*5 = 25</code> <br> <br>  Perhaps this hack requires explanation. <br>  With interpolation, @ means that we will now output an array.  Further, {} separates the array itself from the surrounding text, and [] indicates that we will insert the array by reference. <br>  However, we already generate the contents of the array with the code that is substituted there.  And this must be remembered in the future: everything that we do here in the quadrant brackets is the context of the array. <br><br>  That is, the mechanism of work: creating an array (often with one element), creating a link to it and then outputting this array by reference.  Not optimal, for that - it works. <br><br>  So, we can also insert the code into the string. <br>  A little more - and ... <br><br><h4>  Decision </h4><br><blockquote><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; { local $/ = undef; $txt = &lt;&gt;; } print eval qq{&lt;&lt; "__END_OF_TEMPLATE"\n$txt\n__END_OF_TEMPLATE\n}; die $@ if $@;</span></span></code> </pre> </blockquote><br>  Everything. <br>  This is the template engine. <br>  If desired, it even fits on a single line in perl -e. <br><br><h4>  What is it and why </h4><br>  This is really the shortest and easiest template engine I've ever seen.  You can run it wherever there is perl and you don‚Äôt need to download, build, install anything - in some cases this is quite a big problem. <br><br>  There is a substitution of values ‚Äã‚Äãthrough $, code execution on perl through @ {[]}, there is a correct error output with the correct indication of the line number.  There is even modularity here: important, frequently used and long functions are separated into a separate module or just a source code, which is then connected from the template itself via use or do, respectively. <br>  Practically doing nothing, we got almost everything we need! <br><br>  Templates have the following form: <br><blockquote> <code>! <br>   : @{[''.localtime]}. <br> PID: $$ <br> \@INC path: @INC <br> Environment: <br> @{[join "\n", map {".... $_ =&gt; $ENV{$_}"} sort keys %ENV]} <br> @{[do{use IO::File; IO::File-&gt;new("&lt;tail.inc")-&gt;getlines()}]} <br></code> </blockquote><br>  Almost unchanged, I used it in several tasks: <br>  ‚Ä¢ in a specific samopinny http-server pages were contained in hash (along the way) and the result was calculated and given to the client through the same mechanism; <br>  ‚Ä¢ generated C ++ code with complex structures and dependencies, the data were described in a deep branched perl structure - there was an XSLT equivalent on hashes and arrays; <br>  ‚Ä¢ made a substitute for autotools to generate a Makefile. <br>  Not to mention the many small applications. <br>  The universality here consists in the fact that nowhere is there at all any binding to the generated content, and specific functions can be done for any application. <br><br>  In general, if you have nothing and you urgently need to substitute something in the template, this method is for you. <br><br>  If you want to receive code from clients, you can look in the direction of such modules as <a href="">Safe</a> or <a href="">ops</a> , but at once I want to say that I don‚Äôt offer a complete solution here. <br><br>  Where to use it is not necessary: <br>  ‚Ä¢ Do not try to give this to designers and do not need them to require templates in this format.  Remember that this is actually a PERL program, albeit looking like HTML (or something else). <br>  ‚Ä¢ Without serious improvement, you should not directly push content from users there, most likely this will lead to local code execution and hacking. <br>  ‚Ä¢ Binary data can be generated, but at least we need to think about what to do with the last line feed (probably, just tear it off). <br>  ‚Ä¢ If you already have the ‚Äúcorrect‚Äù template engine, customized for your task, you also do not need this crutch. <br><br>  In areas where this method of templating has been used by me, the method has proved to be excellent and in some places it still works. <br><br>  I will answer all questions if they arise. </div><p>Source: <a href="https://habr.com/ru/post/115173/">https://habr.com/ru/post/115173/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115168/index.html">Microsoft hires new employees to work on a new generation game console</a></li>
<li><a href="../115169/index.html">Greetings to Habra Residents from ServerClub</a></li>
<li><a href="../115170/index.html">We draw a color cube in Mayavi</a></li>
<li><a href="../115171/index.html">Beautiful visualization of urban Wi-Fi networks</a></li>
<li><a href="../115172/index.html">Another ‚Äúhuman twin‚Äù from Danish scientists</a></li>
<li><a href="../115175/index.html">The legitimacy of the Coordination Center‚Äôs activities was questioned.</a></li>
<li><a href="../115176/index.html">Homemade SD Card Shield for Arduino</a></li>
<li><a href="../115178/index.html">Spell Checker for Skype</a></li>
<li><a href="../115181/index.html">Today released xCode4</a></li>
<li><a href="../115183/index.html">iOS 4.3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>