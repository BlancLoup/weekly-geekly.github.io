<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We sculpt a toolbar on PyQt, export data to Excel and HTML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous part, I talked about creating a module for running SQL queries and the shell in which these modules are launched. After a short work w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We sculpt a toolbar on PyQt, export data to Excel and HTML</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/336478/">previous part,</a> I talked about creating a module for running SQL queries and the shell in which these modules are launched.  After a short work with queries, an obvious question arises - how to use the result of the sample, except for how to look on the screen? <br><br>  For this, it is worth making additional tools for exporting and copying data.  We will export to a file in Excel format, and copy to the system buffer in HTML format. <br><br>  But first, we stick a toolbar to our main window. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/ba7/f12/d79/ba7f12d797544692af2569ab6beeb8bd.jpg"><br><a name="habracut"></a><br><h2>  Toolbar </h2><br>  Let me remind you that our application is designed to be simple, universal and extensible.  To make the toolbar also universal and extensible, we will move its definition to the configuration file, and the functions performed will be in external modules that are not explicitly imported into the toolbar module.  Thus, adding a new button and a function will be reduced to prescribing them in the configuration file and adding the module to the program directory. <br><br><div class="spoiler">  <b class="spoiler_title">File toolbar.py</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 # -*- coding: utf-8 -*- import sys from PyQt5.QtCore import * from PyQt5.QtWidgets import * import importlib class ToolBar(QToolBar): def __init__(self, iniFile, parent=None): super(ToolBar, self).__init__(parent) ini = QSettings(iniFile, QSettings.IniFormat) ini.setIniCodec("utf-8") ini.beginGroup("Tools") for key in sorted(ini.childKeys()): v = ini.value(key) title = v[0] params = v[1:] a = self.addAction(title) a.params = params a.triggered.connect(self.execAction) ini.endGroup() def execAction(self): try: params = self.sender().params module = importlib.import_module(params[0]) if len(params) &lt; 2: func = "run()" else: func = params[1] win = self.focusTaskWindow() exec("module.%s(win)" % func) except: print(str(sys.exc_info()[1])) return def focusTaskWindow(self): try: return QApplication.instance().focusedTaskWindow() except: return None if __name__ == '__main__': app = QApplication(sys.argv) ex = ToolBar("tools.ini") flags = Qt.Tool | Qt.WindowDoesNotAcceptFocus # | ex.windowFlags() ex.setWindowFlags(flags) ex.show() sys.exit(app.exec_())</span></span></code> </pre> <br></div></div><br>  For toolbars in Qt there is a ready-made QToolBar class, from it we will generate our ToolBar.  Now we need only one toolbar, but we will lay down the possibility of adding several panels to the program.  Each panel needs its own configuration file with its own set of buttons, so we will pass the file name with the parameter when creating the toolbar. <br>  The configuration file will be traditionally in the Ini format and UTF-8 encoded. <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ToolBar</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(QToolBar)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, iniFile, parent=None)</span></span></span><span class="hljs-function">:</span></span> super(ToolBar, self).__init__(parent) ini = QSettings(iniFile, QSettings.IniFormat) ini.setIniCodec(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>)</code> </pre><br>  The syntax for defining buttons in our hands, in the simplest case, we need three things: <br><br>  - text on the button <br>  - the module containing the button function <br>  - button function <br><br>  Let us determine that the function of the button takes one parameter - the current child window.  What exactly the module will do with it is the task of the button module, and the taskbar task is limited only to its call. <br><br>  Create such a file tools.ini: <br><br><pre> <code class="hljs pgsql">[Tools] <span class="hljs-number"><span class="hljs-number">001</span></span>=Export <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Excel,exportview,"exportToExcel" <span class="hljs-number"><span class="hljs-number">002</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> HTML,exportview,"copyAsHtml"</code> </pre><br>  Now, in python, we parse the definitions from the Ini file: <br><br><pre> <code class="python hljs"> ini.beginGroup(<span class="hljs-string"><span class="hljs-string">"Tools"</span></span>) <span class="hljs-comment"><span class="hljs-comment">#      for key in sorted(ini.childKeys()): #    list, .. ini   #  ,   v = ini.value(key) title = v[0] params = v[1:] #      QAction,    a = self.addAction(title) #      [, ]   QAction a.params = params #          a.triggered.connect(self.execAction) ini.endGroup()</span></span></code> </pre><br>  The execution method assigned to all buttons will import the required module and call the function assigned to the button from it.  To prevent us from registering each module in the import list of the toolbar, we will use the importlib library.  It remains only to find out what button was pressed and from which QAction the signal came - the standard QObject.sender () method is responsible for this, then take the parameters stored in it and do what is intended in the module (whatever that may be). <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: params = self.sender().params module = importlib.import_module(params[<span class="hljs-number"><span class="hljs-number">0</span></span>]) func = params[<span class="hljs-number"><span class="hljs-number">1</span></span>] win = self.focusTaskWindow() exec(<span class="hljs-string"><span class="hljs-string">"module.%s(win)"</span></span> % func) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(str(sys.exc_info()[<span class="hljs-number"><span class="hljs-number">1</span></span>])) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br>  It remains to add our panel to our main window (module tasktree.py) <br><br><pre> <code class="python hljs"> self.tools = ToolBar(<span class="hljs-string"><span class="hljs-string">"tools.ini"</span></span>,self) self.addToolBar(self.tools)</code> </pre><br>  We can start and check if the panel has appeared: <br><br><img src="https://habrastorage.org/web/8d2/1d5/387/8d21d53873394df395fbb3c5857f40c9.png"><br><br>  Maybe not as nice as the first picture, the main thing that works. <br><br><h2>  Tool Functions Module </h2><br>  Now is the time to make a module with button functions.  We will have one module, because the export and copy functions will work with one data source and according to the same rules, there is no sense in spreading them across different modules. <br><br><div class="spoiler">  <b class="spoiler_title">Exportview.py file</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python3 # -*- coding: utf-8 -*- import sys import datetime from PyQt5.QtCore import * from PyQt5.QtWidgets import * import xlsxwriter class ob(): def test(self): return 1 def exportToExcel(win): if win == None: print("No focused window") return view = focusItemView(win) title = win.windowTitle() + '.xlsx' if view == None: print("No focused item view") return # Create a workbook and add a worksheet. fileName = QFileDialog.getSaveFileName(None, 'Save Excel file', title,'Excel files (*.xlsx)') if fileName == ('',''): return indexes = view.selectionModel().selectedIndexes() if len(indexes) == 0: indexes = view.selectAll() indexes = view.selectionModel().selectedIndexes() model = view.model() d = sortedIndexes(indexes) headers = { col:model.headerData(col, Qt.Horizontal) for col in d.columns } minRow = min(d.rows) minCol = min(d.columns) try: workbook = xlsxwriter.Workbook(fileName[0]) worksheet = workbook.add_worksheet() bold = workbook.add_format({'bold': True}) dateFormat = 'dd.MM.yyyy' date = workbook.add_format({'num_format': dateFormat}) realCol = 0 for col in d.columns: worksheet.write(0, realCol, headers[col], bold) realRow = 1 for row in d.rows: if (row, col) in d.indexes: try: v = d.indexes[(row,col)].data(Qt.EditRole) if isinstance(v, QDateTime): if v.isValid() and v.toPyDateTime() &gt; datetime.datetime(1900,1,1): v = v.toPyDateTime() worksheet.write_datetime(realRow, realCol, v, date) else: v = v.toString(dateFormat) worksheet.write(realRow, realCol, v) else: worksheet.write(realRow, realCol, v) except: print(str(sys.exc_info()[1])) realRow += 1 realCol += 1 workbook.close() except: QMessageBox.critical(None,'Export error',str(sys.exc_info()[1])) return def copyAsHtml(win): if win == None: print("No focused window") return view = focusItemView(win) if view == None: print("No focused item view") return indexes = view.selectedIndexes() if len(indexes) == 0: indexes = view.selectAll() indexes = view.selectedIndexes() if len(indexes) == 0: return; model = view.model() try: d = sortedIndexes(indexes) html = '&lt;table&gt;&lt;tbody&gt;\n' headers = { col:model.headerData(col, Qt.Horizontal) for col in d.columns } html += '&lt;tr&gt;' for c in d.columns: html += '&lt;th&gt;%s&lt;/th&gt;' % headers[c] html += '&lt;/tr&gt;\n' for r in d.rows: html += '&lt;tr&gt;' for c in d.columns: if (r, c) in d.indexes: v = d.indexes[(r,c)].data(Qt.DisplayRole) html += '&lt;td&gt;%s&lt;/td&gt;' % v else: html += '&lt;td&gt;&lt;/td&gt;' html += '&lt;/tr&gt;' html += '&lt;/tbody&gt;&lt;/table&gt;' mime = QMimeData() mime.setHtml(html) clipboard = QApplication.clipboard() clipboard.setMimeData(mime) except: QMessageBox.critical(None,'Export error',str(sys.exc_info()[1])) def sortedIndexes(indexes): d = ob() d.indexes = { (i.row(), i.column()):i for i in indexes } d.rows = sorted(list(set([ i[0] for i in d.indexes ]))) d.columns = sorted(list(set([ i[1] for i in d.indexes ]))) return d def headerNames(model, minCol, maxCol): headers = dict() for col in range(minCol, maxCol+1): headers[col] = model.headerData(col, Qt.Horizontal) return headers def focusItemView(win): if win == None: return None w = win.focusWidget() if w != None and isinstance(w, QTableView): return w views = win.findChildren(QTableView) if type(views) == type([]) and len(views)&gt;0: return views[0] return None</span></span></code> </pre><br></div></div><br>  Our functions will work with the QTableView data tables that we used in the modules to view the query results.  To preserve the independence of the modules, we will determine the necessary component ‚Äúon the fly‚Äù - either this is the current (focused) component of QTableView in the current window, or the first required class among the children of the current window. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">focusItemView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(win)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> win == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> w = win.focusWidget() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> w != <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> isinstance(w, QTableView): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> w views = win.findChildren(QTableView) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> type(views) == type([]) <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> len(views)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> views[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre><br>  From the table we get a list of selected cells.  If nothing is selected, then we force everything. <br><br><pre> <code class="python hljs"> indexes = view.selectionModel().selectedIndexes() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(indexes) == <span class="hljs-number"><span class="hljs-number">0</span></span>: indexes = view.selectAll() indexes = view.selectionModel().selectedIndexes() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(indexes) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre><br>  Probably, you already know that in Qt you do not receive an array of data directly, instead you work with indexes in the model.  The QModelIndex index is a simple structure and points to a specific data position (row () row and column (), and in the hierarchy an indication of the parent index parent ()).  Having obtained the index, you can get the data from it by the data () method <br><br>  We received a list of indices of selected cells in the model, but the indices in this list follow in the order in which the user selected them, and not sorted by rows and columns.  It will be more convenient for us to work not with a list, but with a dictionary (position ‚Üí index) and sorted lists of affected rows and columns. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sortedIndexes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indexes)</span></span></span><span class="hljs-function">:</span></span> d = ob() <span class="hljs-comment"><span class="hljs-comment"># - d.indexes = { (i.row(), i.column()):i for i in indexes } d.rows = sorted(list(set([ i[0] for i in d.indexes ]))) d.columns = sorted(list(set([ i[1] for i in d.indexes ]))) return d</span></span></code> </pre><br>  Another thing to keep in mind is that by default QTableView allows you to select unlinked cells, so the list of indexes may contain cells that are almost randomly located: <br><br><img src="https://habrastorage.org/web/ab7/54b/608/ab754b6083764526baaa5b19127ccccc.png"><br><br>  Therefore, in d.rows there is each row used, in d.columns there is each column used, but their combination is not necessarily in d.indexes. <br><br>  We also need a list of column names for greater beauty, which are displayed in QTableView.  Get them from the model using the headerData method: <br><br><pre> <code class="python hljs"> headers = { col:model.headerData(col, Qt.Horizontal) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.columns }</code> </pre><br>  Until now, the code for export and copying was the same, but now the differences have gone. <br><br><h3>  Export to Excel </h3><br>  To export to Excel files, I used the <a href="http://xlsxwriter.readthedocs.io/">xlsxwriter</a> package.  It is installed, as usual, via pip: <br><br><pre> <code class="bash hljs">pip3 install xlsxwriter</code> </pre><br>  The package documentation is quite detailed and understandable, with examples, so I will not dwell on it.  The point is that the record goes to the cells addressed by the row and column numbers.  If you need additional formatting, then you need to define the style and specify it when writing the cell. <br><br>  The name of the xlsx file to which we will export will be requested from the user, Qt has such a function.  In PyQt, the function returns a list of the selected file name and the filter used.  If the list of empty lines is returned, it means that the user has refused the choice. <br><br><pre> <code class="python hljs"> fileName = QFileDialog.getSaveFileName(<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>, <span class="hljs-string"><span class="hljs-string">'Save Excel file'</span></span>, title,<span class="hljs-string"><span class="hljs-string">'Excel files (*.xlsx)'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fileName == (<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br>  Export proper: <br><br><pre> <code class="python hljs"> workbook = xlsxwriter.Workbook(fileName[<span class="hljs-number"><span class="hljs-number">0</span></span>]) worksheet = workbook.add_worksheet() bold = workbook.add_format({<span class="hljs-string"><span class="hljs-string">'bold'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>}) dateFormat = <span class="hljs-string"><span class="hljs-string">'dd.MM.yyyy'</span></span> date = workbook.add_format({<span class="hljs-string"><span class="hljs-string">'num_format'</span></span>: dateFormat}) realCol = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.columns: worksheet.write(<span class="hljs-number"><span class="hljs-number">0</span></span>, realCol, headers[col], bold) realRow = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> row <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.rows: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (row, col) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.indexes: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: v = d.indexes[(row,col)].data(Qt.EditRole) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(v, QDateTime): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> v.isValid() <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> v.toPyDateTime() &gt; datetime.datetime(<span class="hljs-number"><span class="hljs-number">1900</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>): v = v.toPyDateTime() worksheet.write_datetime(realRow, realCol, v, date) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: v = v.toString(dateFormat) worksheet.write(realRow, realCol, v) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: worksheet.write(realRow, realCol, v) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: print(str(sys.exc_info()[<span class="hljs-number"><span class="hljs-number">1</span></span>])) realRow += <span class="hljs-number"><span class="hljs-number">1</span></span> realCol += <span class="hljs-number"><span class="hljs-number">1</span></span> workbook.close()</code> </pre><br>  Dancing around QDateTime was added due to a different understanding of the date / time in Python, Qt and Excel - first, the xlsxwriter package can work with the Python datetime, but does not know how to use QDateTime from Qt, so you have to convert it additionally with a special function toPyDateTime;  secondly, Excel can work only with dates from 01/01/1900, and everything that was before that time for Excel is just a string. <br><br>  Result of export to Excel: <br><br><img src="https://habrastorage.org/web/ba1/6f8/feb/ba16f8feba854f1788c03ab79272153f.png"><br><br><h3>  Copy to system buffer in HTML format </h3><br>  It is not always necessary to have a separate file with a selection, often, especially when there is little data, it is more convenient to copy it in a table form into the system clipboard, and then paste it into the right place, be it Excel, Word, web page editor or something else . <br><br>  The most universal way to copy tabular data through a buffer is the usual HTML format.  On Windows, * nix and MacOS are very different ways of working with the buffer (not to mention the fact that there are several), so it's good that Qt hides implementation details from us. <br><br>  All we need is to create a QMimeData object, fill it through the setHtml method with a fragment of HTML markup, and give it to the system clipboard, which is available through QApplication <br><br><pre> <code class="python hljs"> mime = QMimeData() mime.setHtml(html) clipboard = QApplication.clipboard() clipboard.setMimeData(mime)</code> </pre><br>  The table is collected line by line, starting with the headers. <br><br><pre> <code class="python hljs"> html = <span class="hljs-string"><span class="hljs-string">'&lt;table&gt;&lt;tbody&gt;\n'</span></span> headers = { col:model.headerData(col, Qt.Horizontal) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.columns } html += <span class="hljs-string"><span class="hljs-string">'&lt;tr&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.columns: html += <span class="hljs-string"><span class="hljs-string">'&lt;th&gt;%s&lt;/th&gt;'</span></span> % headers[c] html += <span class="hljs-string"><span class="hljs-string">'&lt;/tr&gt;\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> r <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.rows: html += <span class="hljs-string"><span class="hljs-string">'&lt;tr&gt;'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> c <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.columns: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (r, c) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> d.indexes: v = d.indexes[(r,c)].data(Qt.DisplayRole) html += <span class="hljs-string"><span class="hljs-string">'&lt;td&gt;%s&lt;/td&gt;'</span></span> % v <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: html += <span class="hljs-string"><span class="hljs-string">'&lt;td&gt;&lt;/td&gt;'</span></span> html += <span class="hljs-string"><span class="hljs-string">'&lt;/tr&gt;'</span></span> html += <span class="hljs-string"><span class="hljs-string">'&lt;/tbody&gt;&lt;/table&gt;'</span></span></code> </pre><br>  Result inserted in Word: <br><img src="https://habrastorage.org/web/742/747/347/7427473474094420a194dd327ea397fe.png"><br>  Here, the borders of the table are visible only due to the ‚Äú <i>Show text borders</i> ‚Äù setting enabled in Word; in fact, they are invisible.  In order for the table to be copied with explicit borders, you need to change the style of the table in the table tag.  I leave it to you. <br><br><h2>  Conclusion </h2><br>  So, we got a way to add new functions to our tool, and the functions are added and work no matter what data sources we will use and how to display them - the modules that work with the data, do not know anything about toolbars and their functions, toolbars are not connected neither with the data modules, nor with the functions of the buttons, and the functions of the buttons, not knowing about the toolbars or the data modules, are simply trying to process the current visual component in a manner known to them. <br><br>  The sources used in the examples, as before, are posted on <a href="https://github.com/sshmakov/conopy/tree/master/examples/habr2">github</a> under the MIT license. <br><br>  Start - we <a href="https://habrahabr.ru/post/336478/">grind ourselves a tool on PyQt</a> <br>  Continued - <a href="https://habrahabr.ru/post/338060/">Cut XML by XQuery Markup</a> </div><p>Source: <a href="https://habr.com/ru/post/336716/">https://habr.com/ru/post/336716/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336704/index.html">Development of a mobile application for RosEvroBank: case</a></li>
<li><a href="../336706/index.html">How we created a new product, removing 130 thousand lines of code from the old</a></li>
<li><a href="../336708/index.html">How do i use git</a></li>
<li><a href="../336710/index.html">Chrome DevTools Tricks</a></li>
<li><a href="../336714/index.html">Unity 2017: an overview of new features</a></li>
<li><a href="../336718/index.html">Interview with Herbert Lin (CISAC): ‚ÄúCyber ‚Äã‚Äãsecurity is an endless battle‚Äù</a></li>
<li><a href="../336720/index.html">How to lead introverts without harm to health</a></li>
<li><a href="../336722/index.html">Inside the super-fast CSS engine: Quantum CSS (aka Stylo)</a></li>
<li><a href="../336724/index.html">35-kilobyte post-nuclear caravan</a></li>
<li><a href="../336726/index.html">How well are your SSH sessions secured?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>