<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reveal for everyone!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, Habrovchane ! 
 I'll tell you how I implemented Circual Reveal animation from Lollipop, lowering the threshold to Gingerbread. 

 In Lollipop, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reveal for everyone!</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/626/67f/1d0/62667f1d00eb4ba08d9eda3d93503cc0.jpg"><br><br>  Hello, <strong>Habrovchane</strong> ! <br>  I'll tell you how I implemented Circual Reveal animation from Lollipop, lowering the threshold to Gingerbread. <br><br>  In Lollipop, native HardwareCanvas, RenderNodeAnimator classes appeared for smoother animation and rendering, and Ripple and Reveal animation is built on it.  Now many elements are drawn and animated at the level of iron. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Native animation </h4><br><br><pre><code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Animator </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createCircularReveal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> centerX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> centerY, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startRadius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endRadius)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RevealAnimator(view, centerX, centerY, startRadius, endRadius); }</code> </pre> <br><br>  As described in the documentation, RevealAnimator is an animated circle trim.  It, in turn, is derived from RenderNodeAnimator and calls the native method. <br><br><pre> <code class="hljs java"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">native</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">long</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nCreateRevealAnimator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startRadius, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endRadius)</span></span></span></span>;</code> </pre><br><br>  There is already trimming the circle, through: <br><br><pre> <code class="java hljs">RevealAnimator::RevealAnimator(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerX, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> centerY, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> startValue, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> finalValue) : BaseRenderNodeAnimator(finalValue) , mCenterX(centerX) , mCenterY(centerY) { setStartValue(startValue); } <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> RevealAnimator::getValue(RenderNode* target) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target-&gt;properties().getRevealClip().getRadius(); } <span class="hljs-comment"><span class="hljs-comment">//     void RevealAnimator::setValue(RenderNode* target, float value) { target-&gt;animatorProperties().mutableRevealClip().set(true, mCenterX, mCenterY, value); }</span></span></code> </pre><br><br><h4>  Decision </h4><br><br>  My solution is relatively simple: I created my own custom Layouts (Frame | Linear, original, almost untouched), changing only the method where children are drawn <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawChild</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NonNull Canvas canvas, @NonNull View child, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> drawingTime)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!mClipOutlines &amp;&amp; child != mTarget) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.drawChild(canvas, child, drawingTime); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> state = canvas.save(); mRevealPath.reset(); mRevealPath.addCircle(mCenterX, mCenterY, mRadius, Path.Direction.CW); canvas.clipPath(mRevealPath); <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isInvalidated = <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.drawChild(canvas, child, drawingTime); canvas.restoreToCount(state); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isInvalidated; }</code> </pre><br><br>  I just ask the canvas to trim a certain area during the animation.  The animation is implemented through ObjectAnimator (thanks to Jake Wharton, nineoldsandroid). <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/_vVpwzYb4Dg%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhAWg45R56GSJuk3qRfBfO2GHQ1-A" frameborder="0" allowfullscreen=""></iframe><br><br>  The article turned out a bit crumpled, if you have any questions, write in the comments, I will add the article :) <br><br>  Thanks for attention! <br>  <a href="https://github.com/03uk/CircularReveal">Github</a> </div><p>Source: <a href="https://habr.com/ru/post/243541/">https://habr.com/ru/post/243541/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243527/index.html">November 21 - online conference - about the new Visual Studio 2015 and other announcements of Connect ();</a></li>
<li><a href="../243529/index.html">Through thorns to Unity3D</a></li>
<li><a href="../243531/index.html">How to remove a bucket with 400 million files on Amazon S3</a></li>
<li><a href="../243535/index.html">Ultrastar He6 - the world's first helium HDD with a capacity of 6 TB</a></li>
<li><a href="../243537/index.html">What is memory leak in android, how to check the program for their absence and how to prevent them from appearing</a></li>
<li><a href="../243543/index.html">High-quality interface JIRA-plugin using the AUI Framework</a></li>
<li><a href="../243545/index.html">SPA-architecture for CRM-systems: part 1</a></li>
<li><a href="../243547/index.html">Python Meetup 10/31/14: asynchrony and soft skills</a></li>
<li><a href="../243551/index.html">PDP Recovery 11/04</a></li>
<li><a href="../243553/index.html">Recovery PDP 11/04. Tape station TU60</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>