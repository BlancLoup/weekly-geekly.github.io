<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Formal verification using the wolf, goat and cabbage problem</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In my opinion, in the Russian-speaking sector of the Internet, the subject of formal verification is not sufficiently covered, and especially there ar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Formal verification using the wolf, goat and cabbage problem</h1><div class="post__text post__text-html js-mediator-article">  In my opinion, in the Russian-speaking sector of the Internet, the subject of formal verification is not sufficiently covered, and especially there are not enough simple and clear examples. <br><br>  I will give such an example from a foreign source, and I will supplement with my own solution the well-known problem of crossing a wolf, a goat and a cabbage to the other side of a river. <br><br>  But first I will briefly describe what formal verification is and why it is needed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Formal verification is usually understood as checking one program or algorithm with the help of another. <br><br>  This is necessary in order to make sure that the behavior of the program is as expected and to ensure its safety. <br><br>  Formal verification is the most powerful tool for finding and fixing vulnerabilities: it allows you to find all existing holes and bugs in the program, or to prove that they are not. <br>  It is worth noting that in some cases it is impossible, as for example, in the problem of 8 queens with a board width of 1000 cells: everything depends on the algorithmic complexity or the problem of stopping. <br><br>  However, in any case, one of the three answers will be received: the program is correct, incorrect, or it was not possible to calculate the answer. <br><br>  If it is impossible to find the answer, it is often possible to rework the obscure parts of the program, reducing their algorithmic complexity in order to get a specific answer yes or no. <br><br>  A formal verification is used, for example, in the Windows kernel and Darpa drone operating systems to ensure the maximum level of protection. <br><br>  We will use Z3Prover, a very powerful tool for automated proof of theorems and solving equations. <br><br>  Moreover, Z3 solves the equations, and does not select their values ‚Äã‚Äãwith coarse brute force. <br>  This means that it is able to find the answer, even in cases where combinations of input variants and 10 ^ 100. <br><br>  But this is only about a dozen Integer input arguments, and this is often the case in practice. <br><br>  The task of 8 queens (Taken from the English <a href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">manual</a> ). <br><br><img src="https://habrastorage.org/webt/n-/tp/51/n-tp51sjhdqfs0nk9a571pttkbk.png"><br><a name="habracut"></a><br><pre><code class="plaintext hljs"># We know each queen must be in a different row. # So, we represent each queen by a single integer: the column position Q = [ Int('Q_%i' % (i + 1)) for i in range(8) ] # Each queen is in a column {1, ... 8 } val_c = [ And(1 &lt;= Q[i], Q[i] &lt;= 8) for i in range(8) ] # At most one queen per column col_c = [ Distinct(Q) ] # Diagonal constraint diag_c = [ If(i == j, True, And(Q[i] - Q[j] != i - j, Q[i] - Q[j] != j - i)) for i in range(8) for j in range(i) ] solve(val_c + col_c + diag_c)</code> </pre> <br>  Running Z3, we get the solution: <br><pre> <code class="plaintext hljs">[Q_5 = 1, Q_8 = 7, Q_3 = 8, Q_2 = 2, Q_6 = 3, Q_4 = 6, Q_7 = 5, Q_1 = 4]</code> </pre><br>  The problem of queens is comparable to a program that takes the coordinates of 8 queens as input and displays the answer whether the queens beat each other. <br><br>  If we solved such a program with the help of formal verification, then compared to the task, we would just need to take one more step in the form of converting the program code into the equation: it would turn out to be essentially identical to ours (of course, if the program was written correctly). <br><br>  Practically the same thing will happen if we look for vulnerabilities: we just set the output conditions we need, for example, the admin password, convert the source or decompiled code into equations compatible with verification, and then we get an answer about what data we need to submit to the input to achieve the goal. <br><br>  In my opinion, the problem of wolf, goat and cabbage is even more interesting, since many (7) steps are needed to solve it. <br><br>  If the problem of queens is comparable to the option when you can get to the server with one GET or POST request, wolf, goat and cabbage show an example from a much more complex and common category in which goals can be achieved only with a few requests. <br><br>  This is comparable, for example, with a script where you need to find a SQL injection, write a file through it, then elevate your rights and then get a password. <br><br><div class="spoiler">  <b class="spoiler_title">Problem conditions and its solution</b> <div class="spoiler_text">  A farmer needs to transport a wolf, a goat and a cabbage across the river.  The farmer has a boat in which only one object can fit, in addition to the peasant himself.  A wolf will eat a goat and a goat will eat cabbage if the farmer leaves them unattended. <br><br>  The answer is that at step 4, the farmer will need to take the goat back. </div></div><br>  Now let's get to the solution programmatically. <br><br>  We denote a farmer, a wolf, a goat and a cabbage as 4 variables that take the value of only 0 or 1. Zero means that they are on the left bank, and one means that they are on the right bank. <br><br><pre> <code class="plaintext hljs">import json from z3 import * s = Solver() Num= 8 Human = [ Int('Human_%i' % (i + 1)) for i in range(Num) ] Wolf = [ Int('Wolf_%i' % (i + 1)) for i in range(Num) ] Goat = [ Int('Goat_%i' % (i + 1)) for i in range(Num) ] Cabbage = [ Int('Cabbage_%i' % (i + 1)) for i in range(Num) ] # Each creature can be only on left (0) or right side (1) on every state HumanSide = [ Or(Human[i] == 0, Human[i] == 1) for i in range(Num) ] WolfSide = [ Or(Wolf[i] == 0, Wolf[i] == 1) for i in range(Num) ] GoatSide = [ Or(Goat[i] == 0, Goat[i] == 1) for i in range(Num) ] CabbageSide = [ Or(Cabbage[i] == 0, Cabbage[i] == 1) for i in range(Num) ] Side = HumanSide+WolfSide+GoatSide+CabbageSide</code> </pre><br>  Num is the number of steps required to solve.  Each step represents the state of a river, a boat, and all entities. <br><br>  So far, we choose it at random and with a margin, take 10. <br><br>  Each entity is presented in 10 copies - this is its value in each of the 10 steps. <br><br>  Now let's set the conditions for the start and finish. <br><br><pre> <code class="plaintext hljs">Start = [ Human[0] == 0, Wolf[0] == 0, Goat[0] == 0, Cabbage[0] == 0 ] Finish = [ Human[9] == 1, Wolf[9] == 1, Goat[9] == 1, Cabbage[9] == 1 ]</code> </pre><br>  Then we set the conditions where the wolf eats the goat, or goat cabbage, as constraints in the equation. <br>  (In the presence of a farmer aggression is impossible) <br><br><pre> <code class="plaintext hljs"># Wolf cant stand with goat, and goat with cabbage without human. Not 2, not 0 which means that they are one the same side Safe = [ And( Or(Wolf[i] != Goat[i], Wolf[i] == Human[i]), Or(Goat[i] != Cabbage[i], Goat[i] == Human[i])) for i in range(Num) ]</code> </pre><br>  And finally, we will set all possible actions of the farmer when crossing there or back. <br>  He can either take a wolf, a goat or cabbage, or not take anyone, or not swim at all. <br><br>  Of course, no one can cross without a farmer. <br><br>  This will be expressed by the fact that each next state of the river, boat and entities can differ from the previous one only in a strictly limited way. <br><br>  No more than 2 bits, and with many other limits, since the farmer can transport only one entity at a time and not all can be left together. <br><br><pre> <code class="plaintext hljs">Travel = [ Or( And(Human[i] == Human[i+1] + 1, Wolf[i] == Wolf[i+1] + 1, Goat[i] == Goat[i+1], Cabbage[i] == Cabbage[i+1]), And(Human[i] == Human[i+1] + 1, Goat[i] == Goat[i+1] + 1, Wolf[i] == Wolf[i+1], Cabbage[i] == Cabbage[i+1]), And(Human[i] == Human[i+1] + 1, Cabbage[i] == Cabbage[i+1] + 1, Wolf[i] == Wolf[i+1], Goat[i] == Goat[i+1]), And(Human[i] == Human[i+1] - 1, Wolf[i] == Wolf[i+1] - 1, Goat[i] == Goat[i+1], Cabbage[i] == Cabbage[i+1]), And(Human[i] == Human[i+1] - 1, Goat[i] == Goat[i+1] - 1, Wolf[i] == Wolf[i+1], Cabbage[i] == Cabbage[i+1]), And(Human[i] == Human[i+1] - 1, Cabbage[i] == Cabbage[i+1] - 1, Wolf[i] == Wolf[i+1], Goat[i] == Goat[i+1]), And(Wolf[i] == Wolf[i+1], Goat[i] == Goat[i+1], Cabbage[i] == Cabbage[i+1])) for i in range(Num-1) ]</code> </pre><br>  Run the solution. <br><br><pre> <code class="plaintext hljs">solve(Side + Start + Finish + Safe + Travel)</code> </pre><br>  And we get the answer! <br><br>  Z3 found a consistent, and satisfying all conditions set of states. <br>  A kind of four-dimensional cast of space-time. <br><br>  Let's see what happened. <br><br>  We see that in the end everything was ferried, only at the beginning our farmer decided to rest, and did not swim anywhere in the first 2 steps. <br><br><pre> <code class="plaintext hljs">Human_2 = 0 Human_3 = 0</code> </pre><br>  This suggests that the number of states we have chosen is redundant, and 8 will be quite enough. <br><br>  In our case, the farmer did this: start, rest, rest, crossing the goat, crossing back, crossing the cabbage, returning with the goat, crossing the cabbage, returning back alone, crossing the wolf. <br><br>  But in the end the problem is solved. <br><br><pre> <code class="plaintext hljs">#. Human_1 = 0 Wolf_1 = 0 Goat_1 = 0 Cabbage_1 = 0 # . Human_2 = 0 Wolf_2 = 0 Goat_2 = 0 Cabbage_2 = 0 # . Human_3 = 0 Wolf_3 = 0 Goat_3 = 0 Cabbage_3 = 0 #     . Human_4 = 1 Wolf_4 = 0 Goat_4 = 1 Cabbage_4 = 0 # . Human_5 = 0 Wolf_5 = 0 Goat_5 = 1 Cabbage_5 = 0 #     . Human_6 = 1 Wolf_6 = 0 Cabbage_6 = 1 Goat_6 = 1 #  :    . Human_7 = 0 Wolf_7 = 0 Goat_7 = 0 Cabbage_7 = 1 #     ,       . Human_8 = 1 Wolf_8 = 1 Goat_8 = 0 Cabbage_8 = 1 #   . Human_9 = 0 Wolf_9 = 1 Goat_9 = 0 Cabbage_9 = 1 #         . Human_10 = 1 Wolf_10 = 1 Goat_10 = 1 Cabbage_10 = 1</code> </pre><br>  Now we will try to change the conditions and prove that there are no solutions. <br><br>  To do this, we will give our wolf herbivores, and now he wants to eat cabbage. <br>  This can be compared with the case in which our goal is to protect the application and we must make sure that there are no loopholes. <br><br><pre> <code class="plaintext hljs"> Safe = [ And( Or(Wolf[i] != Goat[i], Wolf[i] == Human[i]), Or(Goat[i] != Cabbage[i], Goat[i] == Human[i]), Or(Wolf[i] != Cabbage[i], Goat[i] == Human[i])) for i in range(Num) ]</code> </pre><br>  Z3 Gave us the following answer: <br><br><pre> <code class="plaintext hljs"> no solution</code> </pre><br>  It means that there really is no solution. <br><br>  Thus, we programmatically proved the impossibility of crossing with an omnivorous wolf, without loss for the farmer. <br><br>  If the audience finds this topic interesting, I will tell you in future articles how to turn an ordinary program or function into an equation compatible with formal methods, and solve it, thus finding both all legitimate scenarios and vulnerabilities.  First, on the same task, but presented in the form of a program, and then gradually complicating and moving on to actual examples from the world of software development. </div><p>Source: <a href="https://habr.com/ru/post/449002/">https://habr.com/ru/post/449002/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448988/index.html">Kingston SSDs have become more capacious, retaining almost the same price - we meet A400-R series</a></li>
<li><a href="../448992/index.html">Universal and perfect hashing</a></li>
<li><a href="../448994/index.html">Is it so difficult to start the way of IT-recruiter?</a></li>
<li><a href="../448996/index.html">Creating a password policy in Linux</a></li>
<li><a href="../448998/index.html">If the bond is just tin, then you need to bury it.</a></li>
<li><a href="../449004/index.html">New in certification of information security tools</a></li>
<li><a href="../449006/index.html">Hidden complexity of video game slots</a></li>
<li><a href="../449008/index.html">Logging HTTP requests in Spring Boot using Reels</a></li>
<li><a href="../449014/index.html">Promoting Ethereum DAPP</a></li>
<li><a href="../449016/index.html">Optical file system steganography</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>