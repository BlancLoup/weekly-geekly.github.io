<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>While Vim is writing the code for you ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I will not grovel for a long time on the topic of how great and powerful Vim is - this has long and reliably been known. Some even argue that "Virtual...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>While Vim is writing the code for you ...</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/c74/591/aee/c74591aeecfc3d08988426a3b66f0f51.png"><br><br>  I will not grovel for a long time on the topic of how great and powerful Vim is - this has long and reliably been known.  Some even argue that "Virtually any string of Latin letters is a syntactically correct command for vi." <br><br>  Sometimes a programmer is so subtly aware of the dark side of power that Vim starts writing code instead of him, leaving time for meditation and other useful things.  One of these useful things could be writing another super useful plugin.  The following lines of this humble treatise tell exactly about this. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h2>  Characters </h2><br><br>  Actually, there are only two of them - Vim and Python.  But the interaction of these components leads to a thousand changes and ten thousand transformations.  And once, when I was once again visited by the desire to transfer part of my daily activity to Vim, I took up writing a plug-in for reading posts from the main page of reddit.  The idea is very simple - to pull out the list of posts in json format and display them in a formatted format in the editor's buffer.  And, of course, this idea was partly educational in nature. <br><br>  Vimscript, Python, Ruby are available as options for writing a plugin.  I don‚Äôt have the opportunity to compare their strengths and weaknesses; I‚Äôll just say that Python was chosen simply because I am well acquainted with it. <br><br><h2>  Plugin: Start </h2><br><br>  The simplest plugin for Vim is a file with the extension <b>* .vim</b> - but it‚Äôs better not to do that) Create a directory with the plugin, which we place in <b>.vim / bundle /</b> (use vundle).  Inside we will get the <b>plugin</b> directory with source codes and add the line <b>Bundle 'vim-reddit'</b> .  After these gestures, the plugin will be launched when Vim starts. <br><br>  The basis of the plugin will still be the code written in Vimscript ( <b>reddit.vim</b> ).  It will contain some settings, highlighting displayed posts, as well as a wrapper for calling Python code.  In brief, I will talk about the main points and ‚Äúrules of good tone‚Äù (although I sometimes ignore them myself). <br><br>  Because  in the code we will use Python, you need to check that Vim is built with support for this language: <br><br><pre><code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !has(<span class="hljs-string"><span class="hljs-string">'python'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Error: Required vim compiled with +python"</span></span> finish <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span></code> </pre> <br><br>  Then you need to check whether the plugin has been downloaded again.  If not, we openly declare to the world our presence: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">if</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">exists</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'g:vim_reddit_module'</span></span></span></span></span><span class="hljs-function">) finish endif </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> g:vim_reddit_module</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br><h2>  Python module </h2><br>  Then the main action begins.  To begin with, I‚Äôll reveal the terrible secret of running Python code from Vimscript: <br><br><pre> <code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">! </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Reddit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> python &lt;&lt; EOF # some <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> EOF endfunction</code> </pre><br><br>  Inside the block, you can relax and call a couple of Python libraries. Let's create a module <b>reddit.py</b> ( <b>__init__.py is</b> meant), which will do all the work of loading json.  But just to connect it does not work, because  python cannot find this module.  To get out of this tragic situation, you can add the path to the module in <b>sys.path</b> : <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys, vim sys.path.append(vim.eval(<span class="hljs-string"><span class="hljs-string">"expand('&lt;sfile&gt;:p:h')"</span></span>))</code> </pre><br><br>  I guess you already guessed that the eval method calculates the Vim command and returns the result) After that you can safely import the module: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> reddit <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> main main()</code> </pre><br><br>  Now we will smoothly move on to the disgrace that occurs in <b>reddit.main ()</b> .  Again, I‚Äôll skip the uninteresting details of json downloads and go straight through the features.  And of the features here, perhaps, only work with the buffer.  The fact is that the current buffer, in which we will add the loaded posts, is a simple array of strings.  Therefore, cleaning looks like this: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">del</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">vim</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.current</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.buffer</span></span><span class="hljs-selector-attr"><span class="hljs-selector-attr">[:]</span></span></code> </pre><br><br>  and adding a string like this: <br><br><pre> <code class="hljs pgsql">vim.<span class="hljs-keyword"><span class="hljs-keyword">current</span></span>.buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>] = "Reddit front page " vim.<span class="hljs-keyword"><span class="hljs-keyword">current</span></span>.buffer.append(<span class="hljs-number"><span class="hljs-number">20</span></span>*"=" + " ")</code> </pre><br><br>  There is nothing more specific in the module.  I will note only my keen desire to make the plugin flexible and customizable.  This led to the appearance of the configuration file <b>default.json</b> , which, in addition to the json source, also contains instructions on which data to choose from it (by simple mapping).  Therefore, in theory, it is possible to adapt this plugin to read any news feed in json format with a similar structure (i.e., a set of posts with certain attributes). <br><br><h2>  Little about the little things </h2><br><br>  To make reading more enjoyable, I added some useful details: <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">setlocal</span></span> nomodifiable <span class="hljs-built_in"><span class="hljs-built_in">setlocal</span></span> buftype=nofile <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> s:reddit_syntax()</code> </pre><br><br>  As a result, we have an uneditable buffer.  The <b>reddit_syntax</b> function paints content in all colors of the rainbow.  She was spied on <a href="https://github.com/vim-scripts/TwitVim">right here</a> , with the exception of one group, which I added exclusively for myself: <br><br><pre> <code class="hljs dos">syntax match <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> /^.\{-<span class="hljs-number"><span class="hljs-number">1</span></span>,} / highlight <span class="hljs-built_in"><span class="hljs-built_in">title</span></span> gui=bold guifg=yellowgreen</code> </pre><br><br>  The group is called <b>title</b> and is described by the corresponding regular, and then it is highlighted with bold font. <br><br><h2>  Conclusion </h2><br><br>  The plugin is simple and low-functional as <s>(to find an appropriate comparison)</s> , but nevertheless it achieves its main goals - I (and, I hope, some of the readers) saw the light of the changes and finishing of Vim to fit my modest needs.  Well, besides, now I can read reddit from Vim) <br><br>  The plugin code is <a href="https://github.com/erthalion/vim-reddit">in my repository</a> , it is extremely easy to install using vundle. <br><br>  PS: It turns out that morning posts are much more difficult) </div><p>Source: <a href="https://habr.com/ru/post/187290/">https://habr.com/ru/post/187290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187280/index.html">In Belarus, problems with access to Google</a></li>
<li><a href="../187282/index.html">The simplest implementation of cross-platform multiplayer on the example of the evolution of a single .NET game. Part two, more technical</a></li>
<li><a href="../187284/index.html">Ubuntu Phone, Core Applications. Inside view</a></li>
<li><a href="../187286/index.html">Interplanetary rally of two centuries</a></li>
<li><a href="../18729/index.html">Bachinsky and classmates</a></li>
<li><a href="../187292/index.html">Development of IntelliJ IDEA plugin. Part 5</a></li>
<li><a href="../187294/index.html">Ice cream trailer on request from a mobile application</a></li>
<li><a href="../187298/index.html">Disney Research has developed a tactile feedback system based on a vortex cannon.</a></li>
<li><a href="../1873/index.html">For 7 Russian technoparks allocated 26.3 billion rubles</a></li>
<li><a href="../18730/index.html">CSS Sprites: everything you knew, but were afraid to ask</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>