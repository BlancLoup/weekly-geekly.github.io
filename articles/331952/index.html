<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Example of creating a WCF service running inside a Windows service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Windows Communication Foundation is a software platform from Microsoft for creating, configuring and deploying distributed network services. WCF-runti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Example of creating a WCF service running inside a Windows service</h1><div class="post__text post__text-html js-mediator-article">  Windows Communication Foundation is a software platform from Microsoft for creating, configuring and deploying distributed network services.  WCF-runtime and its System.ServiceModel namespace, representing its main programming interface, is the successor to the distributed systems technology successfully used by developers to create distributed applications on the Windows platform over the past decade.  Let us analyze the test example of creating a WCF service. <br><br>  Open Visual Studio 2015 and create a new project of type Class Library.  The project is called WCFMyServiceLibrary. <br><br><img src="https://habrastorage.org/web/4b9/a55/763/4b9a55763700499b8a7bd67f68744a24.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  Rename the file Class1.cs to MyService.cs and add another class, the file for which we will call IMyService.cs. <br><br>  Add a link to the assembly System.ServiceModel. <br><br><div class="spoiler">  <b class="spoiler_title">In the IMyService.cs file, we describe the interface:</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">WCFMyServiceLibrary</span></span> { [ServiceContract] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span>; [OperationContract] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span>; } }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">In the file MyService.cs, we describe the interface implementation:</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">WCFMyServiceLibrary</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyService</span></span> : <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> s = <span class="hljs-string"><span class="hljs-string">$"1 You entered: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{x}</span></span></span><span class="hljs-string"> = = = 1"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> s = <span class="hljs-string"><span class="hljs-string">$"2 you entered: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{x}</span></span></span><span class="hljs-string"> = = = 2"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; } } }</code> </pre> </div></div><br>  This development of the service is completed.  We proceed to the creation of a Windows service, which will be a container for this service. <br><br>  In the same solution (Solution) we will create a new project like ‚ÄúWindows Service‚Äù.  We call the project WindowsServiceHostForMyService. <br><br><img src="https://habrastorage.org/web/d94/2d9/5ee/d942d95ee1ec4e99bafe8da5122053cd.png"><br><br>  Then the file Service1.cs (the newly created project) will be renamed into MyService.cs.  In this project we add a link to the System.ServiceModel assembly, and also do not forget to specify the directives in the MyService.cs file: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel.Description;</code> </pre><br>  In the MyService class, add a new member: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ServiceHost service_host = <span class="hljs-literal"><span class="hljs-literal">null</span></span>;</code> </pre> <br>  You also need to add a link to the WCFMyServiceLibrary project, which is in the same solution: <br><br><img src="https://habrastorage.org/web/5c7/4f0/524/5c74f0524dc544aabd3f51714967ab8b.png"><br><br>  Then, in the MyService class, we change the OnStart method so that the endpoints of our service are added to this method (endpoint): <br><br><div class="spoiler">  <b class="spoiler_title">OnStart method</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (service_host != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) service_host.Close(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> address_HTTP = <span class="hljs-string"><span class="hljs-string">"http://localhost:9001/MyService"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> address_TCP = <span class="hljs-string"><span class="hljs-string">"net.tcp://localhost:9002/MyService"</span></span>; Uri[] address_base = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(address_HTTP), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(address_TCP) }; service_host = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceHost(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(WCFMyServiceLibrary.MyService), address_base); ServiceMetadataBehavior behavior = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceMetadataBehavior(); service_host.Description.Behaviors.Add(behavior); BasicHttpBinding binding_http = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BasicHttpBinding(); service_host.AddServiceEndpoint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(WCFMyServiceLibrary.IMyService), binding_http, address_HTTP); service_host.AddServiceEndpoint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(IMetadataExchange), MetadataExchangeBindings.CreateMexHttpBinding(), <span class="hljs-string"><span class="hljs-string">"mex"</span></span>); NetTcpBinding binding_tcp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetTcpBinding(); binding_tcp.Security.Mode = SecurityMode.Transport; binding_tcp.Security.Transport.ClientCredentialType = TcpClientCredentialType.Windows; binding_tcp.Security.Message.ClientCredentialType = MessageCredentialType.Windows; binding_tcp.Security.Transport.ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign; service_host.AddServiceEndpoint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(WCFMyServiceLibrary.IMyService), binding_tcp, address_TCP); service_host.AddServiceEndpoint(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(IMetadataExchange), MetadataExchangeBindings.CreateMexTcpBinding(), <span class="hljs-string"><span class="hljs-string">"mex"</span></span>); service_host.Open(); }</code> </pre></div></div><br>  Then we implement stopping the service in the OnStop method: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnStop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (service_host != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { service_host.Close(); service_host = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } }</code> </pre><br>  Then, in the Solution Explorer, double-clicking on the MyService.cs file (of the WindowsServiceHostForMyService project) will open this file in Design Mode. <br><br><img src="https://habrastorage.org/web/2f1/525/f46/2f1525f463374ea7bab3e8cadec5743f.png"><br><br>  On the empty space, call the context menu (right click of the mouse button) and select "Add installer". <br><br><img src="https://habrastorage.org/web/a8e/bbd/3f6/a8ebbd3f630d4667a5e2c817a72b8b2d.png"><br><br>  This will create a new class ProjectInstaller.cs <br>  Rename the file ProjectInstaller.cs to MyServiceInstaller.cs. <br>  At the same time, a window will appear asking whether to rename the dependent objects - answer "Yes". <br><br>  Add a link to the file <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceProcess;</code> </pre><br>  Then we will change the code of the constructor of the MyServiceInstaller class: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceInstaller</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// InitializeComponent(); serviceProcessInstaller1 = new ServiceProcessInstaller(); serviceProcessInstaller1.Account = ServiceAccount.LocalSystem; serviceInstaller1 = new ServiceInstaller(); serviceInstaller1.ServiceName = "WindowsServiceHostForMyService"; serviceInstaller1.DisplayName = "WindowsServiceHostForMyService"; serviceInstaller1.Description = "WCF Service Hosted by Windows NT Service"; serviceInstaller1.StartType = ServiceStartMode.Automatic; Installers.Add(serviceProcessInstaller1); Installers.Add(serviceInstaller1); }</span></span></code> </pre><br>  Note that we have blocked the call to the InitializeComponent () method using a comment. <br>  This completes the development of the Windows service.  Build the entire solution (Build Solution) and proceed to the next step - installing the Windows service. <br><br>  To install our service, create a bat file (with an arbitrary name, for example, Install_Windows_Service.bat) with the following content: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Windows</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.NET</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Framework</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">v4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.30319</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">InstallUtil</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">WindowsServiceHostForMyService</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span></code> </pre><br>  You need to copy this bat-file to the same folder as the compiled WindowsServiceHostForMyService.exe file (you need to think in advance which folder this file will be in, which will always be running as a Windows service). <br><br>  Run the bat-file, after which our program WindowsServiceHostForMyService.exe will be installed as a Windows service. <br><br>  We will launch this service using the standard service management program. <br><br>  The next stage is the development of a client application for using the services provided by the service. <br><br>  To do this, you first need to organize the so-called "adapter" - Service Proxy - a set of settings that describe the service for the client application. <br><br>  We use for this the standard utility SvcUtil.exe.  Create a file Generate_Proxy.bat as follows <br><br><pre> <code class="hljs lua">SvcUtil http://localhost:<span class="hljs-number"><span class="hljs-number">9001</span></span>/MyService /out:MyServiceProxy.cs /<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>:App.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span></code> </pre><br>  Run this file (the standard utility SvcUtil.exe is located in the folder C: \ Program Files \ Microsoft SDKs \ Windows \ v7.0 \ Bin). <br><br>  This file must be run while our service is running, i.e.  in this case, after the successful launch of the Windows service WindowsServiceHostForMyService. <br><br>  In case of a successful launch, the SvcUtil.exe program will generate 2 files ‚Äî MyServiceProxy.cs and App.config. <br><br>  These files need to be added for the client application so that this application can call the methods of our service (just below you will learn that I decided not to add the App.config file - we can do without it). <br><br>  Note.  A similar result could be achieved by running <br><br><pre> <code class="hljs lua">SvcUtil net.tcp://localhost:<span class="hljs-number"><span class="hljs-number">9002</span></span>/MyService /out:MyServiceProxy.cs /<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>:App.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span></code> </pre><br>  Those.  You can run this utility by specifying only one endpoint, either http or net.tcp. <br><br>  In the same solution (Solution) we will create a regular Windows Forms application.  Let's call it WindowsFormsApplication1 <br><br><img src="https://habrastorage.org/web/1b2/b23/e81/1b2b23e8128546859408a9ac7494e9f3.png"><br><br>  Add to this project a link to System.ServiceModel and, of course, <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel   .</code> </pre><br>  Add the MyServiceProxy.cs file to this project (we generated it with the SvcUtil.exe utility).  In this case, add the following lines to the MyServiceProxy.cs file: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ServiceReference1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.Serialization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; ‚Ä¶     MyServiceProxy.cs ‚Ä¶  ,       <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> }</code> </pre> <br>  After that, we will be able to refer to the MyServiceClient class (this class was created by the SvcUtil.exe program), specifying a directive in the form file. <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ServiceReference1;</code> </pre><br><div class="spoiler">  <b class="spoiler_title">An example of the finished file MyServiceProxy.cs (comments removed):</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">ServiceReference1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Runtime.Serialization; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; [System.CodeDom.Compiler.GeneratedCodeAttribute(<span class="hljs-string"><span class="hljs-string">"System.ServiceModel"</span></span>, <span class="hljs-string"><span class="hljs-string">"3.0.0.0"</span></span>)] [System.ServiceModel.ServiceContractAttribute(ConfigurationName=<span class="hljs-string"><span class="hljs-string">"IMyService"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { [System.ServiceModel.OperationContractAttribute(Action=<span class="hljs-string"><span class="hljs-string">"http://tempuri.org/IMyService/Method1"</span></span>, ReplyAction=<span class="hljs-string"><span class="hljs-string">"http://tempuri.org/IMyService/Method1Response"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span>; [System.ServiceModel.OperationContractAttribute(Action=<span class="hljs-string"><span class="hljs-string">"http://tempuri.org/IMyService/Method2"</span></span>, ReplyAction=<span class="hljs-string"><span class="hljs-string">"http://tempuri.org/IMyService/Method2Response"</span></span>)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span>; } [System.CodeDom.Compiler.GeneratedCodeAttribute(<span class="hljs-string"><span class="hljs-string">"System.ServiceModel"</span></span>, <span class="hljs-string"><span class="hljs-string">"3.0.0.0"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IMyServiceChannel</span></span> : <span class="hljs-title"><span class="hljs-title">IMyService</span></span>, <span class="hljs-title"><span class="hljs-title">System</span></span>.<span class="hljs-title"><span class="hljs-title">ServiceModel</span></span>.<span class="hljs-title"><span class="hljs-title">IClientChannel</span></span> { } [System.Diagnostics.DebuggerStepThroughAttribute()] [System.CodeDom.Compiler.GeneratedCodeAttribute(<span class="hljs-string"><span class="hljs-string">"System.ServiceModel"</span></span>, <span class="hljs-string"><span class="hljs-string">"3.0.0.0"</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyServiceClient</span></span> : <span class="hljs-title"><span class="hljs-title">System</span></span>.<span class="hljs-title"><span class="hljs-title">ServiceModel</span></span>.<span class="hljs-title"><span class="hljs-title">ClientBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">IMyService</span></span>&gt;, <span class="hljs-title"><span class="hljs-title">IMyService</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endpointConfigurationName</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">endpointConfigurationName</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endpointConfigurationName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> remoteAddress</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">endpointConfigurationName, remoteAddress</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endpointConfigurationName, System.ServiceModel.EndpointAddress remoteAddress</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">endpointConfigurationName, remoteAddress</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyServiceClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">System.ServiceModel.Channels.Binding binding, System.ServiceModel.EndpointAddress remoteAddress</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">binding, remoteAddress</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Channel.Method1(x); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Method2</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Channel.Method2(x); } } }</code> </pre> <br></div></div><br>  Let's act extraordinary - and we will not add the App.Config file to the client's project! <br><br>  Then we sketch 3 buttons on the form, a textBox1 text field (the user enters a string to be sent to the server) and a richTextbox1 field (an imitation of the message subsystem of our application ‚Äî this is the field that will receive messages from the program, including those that have been returned to us ) <br><br>  Button btn_Start - creates a client <br>  Button btn_Send - sends the service a text string from the text field <br>  Button btn_Close - removes the client from memory and closes the application <br><br><div class="spoiler">  <b class="spoiler_title">Form Code:</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.ServiceModel; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Windows.Forms; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> ServiceReference1; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">WindowsFormsApplication1</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Form1</span></span> : <span class="hljs-title"><span class="hljs-title">Form</span></span> { MyServiceClient client = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Form1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Print</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> text</span></span></span><span class="hljs-function">)</span></span> { richTextBox1.Text += text + <span class="hljs-string"><span class="hljs-string">"\n\n"</span></span>; richTextBox1.SelectionStart = richTextBox1.Text.Length; richTextBox1.ScrollToCaret(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Print</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Exception ex</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ex == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; Print(ex.Message); Print(ex.Source); Print(ex.StackTrace); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create_New_Client</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { Try_To_Create_New_Client(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Print(ex); Print(ex.InnerException); client = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Print(<span class="hljs-string"><span class="hljs-string">"Cannot create a new client. The current Client is active."</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Try_To_Create_New_Client</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { NetTcpBinding binding = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetTcpBinding(SecurityMode.Transport); binding.Security.Message.ClientCredentialType = MessageCredentialType.Windows; binding.Security.Transport.ClientCredentialType = TcpClientCredentialType.Windows; binding.Security.Transport.ProtectionLevel = System.Net.Security.ProtectionLevel.EncryptAndSign; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> uri = <span class="hljs-string"><span class="hljs-string">"net.tcp://192.168.1.2:9002/MyService"</span></span>; EndpointAddress endpoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EndpointAddress(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(uri)); client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyServiceClient(binding, endpoint); client.ClientCredentials.Windows.ClientCredential.Domain = <span class="hljs-string"><span class="hljs-string">""</span></span>; client.ClientCredentials.Windows.ClientCredential.UserName = <span class="hljs-string"><span class="hljs-string">"Vasya"</span></span>; client.ClientCredentials.Windows.ClientCredential.Password = <span class="hljs-string"><span class="hljs-string">"12345"</span></span>; Print(<span class="hljs-string"><span class="hljs-string">"Creating new client ...."</span></span>); Print(endpoint.Uri.ToString()); Print(uri); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> test = client.Method1(<span class="hljs-string"><span class="hljs-string">"test"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (test.Length &lt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Exception(<span class="hljs-string"><span class="hljs-string">"   "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Print(<span class="hljs-string"><span class="hljs-string">"test is OK ! "</span></span> + test); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ex) { Print(ex); Print(ex.InnerException); client = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_Start_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { Create_New_Client(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_Send_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { Print(<span class="hljs-string"><span class="hljs-string">"sending message . . ."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> s = textBox1.Text; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> x = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { x = client.Method1(s); Print(x); x = client.Method2(s); Print(x); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Print(<span class="hljs-string"><span class="hljs-string">"Error! Client does not exist!"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btn_Close_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, EventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (client != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Print(<span class="hljs-string"><span class="hljs-string">"Closing a client ..."</span></span>); client.Close(); client = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Print(<span class="hljs-string"><span class="hljs-string">"Error! Client does not exist!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Close(); } } }</code> </pre> <br></div></div><br>  We compile and run from another machine from the same network - and test the service by clicking btn_Start first, and then sending messages to the service by pressing btn_Send. <br><br><img src="https://habrastorage.org/web/1fd/70d/6a5/1fd70d6a53984d71801095702fe3cbfe.png"><br><br>  Note that in this example on the client we did not use the end point at all. <br><br> <code>http://localhost:9001/MyService</code> <br>  and only worked with <br><br> <code>net.tcp://localhost:9002/MyService</code> <br>  (you can easily do it yourself - since net.tcp is on your shoulder, then http will do something with closed eyes). <br><br>  In addition, we did not use the App.config file, creating the endpoint on the client not using the settings, but using the C # code.  The reasons for this are subjective ‚Äî the author does not like to tinker with XML settings, and if possible, he does everything explicitly in the code.  Thanks for attention! <br><br>  Lyrical digression.  The author of the article got acquainted with the C # language in March of this year, the first application in C # was written in May (before that, for many years it was form-splitting into Delphi and even MS Access). </div><p>Source: <a href="https://habr.com/ru/post/331952/">https://habr.com/ru/post/331952/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331938/index.html">Configuring Dockerfile to create and run a Docker container with your Go program</a></li>
<li><a href="../331940/index.html">Guide: how to use Python for algorithmic trading on the exchange. Part 2</a></li>
<li><a href="../331944/index.html">Algorithm for finding the best route in linux</a></li>
<li><a href="../331946/index.html">Using GAP analysis to identify and coordinate project tasks</a></li>
<li><a href="../331948/index.html">Multicore DSP TMS320C6678. Core memory organization</a></li>
<li><a href="../331954/index.html">Baking Boards or the secret ingredient in the perfect Agile cuisine</a></li>
<li><a href="../331956/index.html">Open house days before launching a new Python course</a></li>
<li><a href="../331958/index.html">I decided to disable google amp on my website</a></li>
<li><a href="../331960/index.html">Third Coming GOST 28147-89 or Russian Roulette</a></li>
<li><a href="../331962/index.html">Compare #NotPetya and #Petya - is it possible to decrypt your files? Updated</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>