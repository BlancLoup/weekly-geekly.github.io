<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast app resume for Windows Phone 8</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Fast App Resume 

 In continuation of the last article about the integration into the ‚ÄúPhotos‚Äù hub, today we will open the topic Fast Application Resu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast app resume for Windows Phone 8</h1><div class="post__text post__text-html js-mediator-article">  <b>Fast App Resume</b> <br><br>  In continuation of the last article about the <a href="http://habrahabr.ru/company/mailru/blog/213017/">integration</a> into the ‚ÄúPhotos‚Äù hub, today we will open the topic <a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj735579">Fast Application Resume</a> , which appeared in WP8, and consider what it is for, and what advantages the use of this function provides, as well as various scenarios for using App Resume. <br><a name="habracut"></a><br>  Looking ahead, I would like to mention the mentioned problem of using Fast Resume along with Photo Sharing, Push Notification, etc.  As it turned out, there is no problem.  Almost not.  If the user has updated his phone (WP8 Update 3), then with the new update, there are no problems with switching to Url.  However, a colleague <a href="https://habrahabr.ru/users/texnedo/" class="user_link">texnedo</a> showed one interesting scenario in which there is a bug with AppResume.  If App Resume is turned on in the application and the screen is locked without minimizing the application, the application is simply restored without going to the toast url. <br><br>  <b>What is App Resume for?</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the classical model of application execution, clicking on the tile (on the desktop or when clicking on the list of applications) not only launches, but also restarts the application if it was started and minimized.  In some cases, it is easier not to restart the application, but to return to an already running application as if the user had returned via the ‚ÄúBack‚Äù button.  For ‚Äúheavy‚Äù applications, it is much faster to return to the running application than to restart it and reinitialize the data, which subjectively reduces the ‚Äúlaunch‚Äù time. <br><br>  As in the case of Fast Application Switch (unlike App Resume, this ability to quickly return to a running application after minimizing the ‚ÄúBack‚Äù button), App Resume is not a replacement for Tombstone and you need to take into account that if the application is ‚Äúasleep‚Äù, then fully save the data and restore them yourself. <br><br>  Now consider how to integrate this feature into the application, consider the various return scenarios. <br><br>  <b>How to enable App Resume</b> <br><br>  To enable this feature is quite simple: all you need to do is open the WMAppManifest.xml file in the XML editing mode (in the context menu - Open With - Xml editor) and add the attribute: <br><pre><code class="html hljs xml">ActivationPolicy="Resume"</code> </pre> <br>  for the <code>&lt;DefaultTask /&gt;</code> . <br><br>  In the end, the default string in the manifest of the form: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefaultTask</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NavigationPage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainPage.xaml"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre> <br>  would look like this: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DefaultTask</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_default"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NavigationPage</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MainPage.xaml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ActivationPolicy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Resume"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><br>  <b>How App Resume Works</b> <br><br>  To demonstrate the details of the App Resume, let's make a simple application with the ability to navigate between two pages.  Also on both pages, we will display the value of some variable that can be changed by a button, and we will show the navigation history, including whether the application was launched or activated. <br><br>  For simplicity, the value of the variable will be stored in memory in a static class in a static field and will be displayed on both pages in OnNavigateTo <br><br><pre> <code class="html hljs xml">static class FakeCacheStorage { public static int Counter { get; set; } }</code> </pre> <br><br>  In order to figure out exactly how App Resume works, we need to temporarily comment out the line: <br>  RootFrame.Navigated + = CheckForResetNavigation; <br>  in App.xaml.cs, where the handler stores the code. <br><br>  First check Fast Application Switching.  Run the application and increase the counter to some number (let it be 4) and see what we have before the application is minimized and returned via the ‚ÄúBack‚Äù button <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8a5/783/15d/8a578315d3b94eb72dba407b46a60877.png"><img src="https://habrastorage.org/getpro/habr/post_images/cd6/09b/0ce/cd609b0ceb382bded1a8250472cb9eca.png"><br><br>  As we expected, the difference in the way the application is launched.  Initially, the application was launched, and then activated by the "Back" button. <br><br>  And now let's see what it would be like if we turned the application down and instead of the ‚ÄúBack‚Äù button, we started the application through the main application file. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c0/9d9/3ae/9c09d93aed9610d05452d9a3b8af2873.png"><br><br>  As we can see, the application was launched, not activated, and we were on the main page.  In addition, the value of the variable has been reset.  It is obviously necessary to restore all user data from the repository. <br><br>  And now, if you include App Resume in the manifest, then, ultimately, we will see a different picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/431/e89/87b/431e8987b9b6ad9ce4f946d31058cabc.png"><br><br>  But this is more interesting - the application was activated, but not launched, while we were on the main page and the value of the counter is preserved!  And we will see our second page only if we press the ‚ÄúBack‚Äù button.  If we did not display the history of navigation, one would think that the application was simply restarted.  The most interesting thing would have started when the user tried to exit the application using the ‚ÄúBack‚Äù button - for this he would have to press this button three times.  Next, we look at what App Resume was done for and how we can use such scenarios for using such behavior. <br><br>  <b>App Resume as a way to "quickly launch" the application</b> <br><br>  What we saw in the previous section provides interesting food for thought.  We can use App Resume to quickly launch applications while preserving all data loaded into memory, but we need to get rid of the old navigation history.  That is, in fact, the user must wipe out of the application using the ‚ÄúBack‚Äù button.  If you create your WP8-application in the studio starting with version VS2012, then the necessary methods have already been added to the generated project.  To review the work of App Resume, we temporarily commented out the line with the App Resume handler: <br>  RootFrame.Navigated + = CheckForResetNavigation; <br><br>  If we uncomment this line, we will not see the history of navigation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30d/1cb/2db/30d1cb2db3ed9273b36c688a3ad3cbfb.png"><br><br>  In fact, it looks as if the application was launched (the user goes to the main page and exits the application by the "Back" button), but the data remained in memory. <br><br>  Let us consider in more detail what is being done in this method. <br><br>  In the InitializePhoneApplication method (app.xaml.cs file) there is a separate subscription to the Navigated event: <br>  RootFrame.Navigated + = CheckForResetNavigation; <br><br>  The navigation history is deleted by the Reset argument: <br><br><pre> <code class="html hljs xml">private void CheckForResetNavigation(object sender, NavigationEventArgs e) { // If the app has received a 'reset' navigation, then we need to check // on the next navigation to see if the page stack should be reset if (e.NavigationMode == NavigationMode.Reset) RootFrame.Navigated += ClearBackStackAfterReset; }</code> </pre> <br><br>  And, accordingly, further in the ClearBackStackAfterReset method, the navigation history is cleared: <br><br><pre> <code class="html hljs xml">private void ClearBackStackAfterReset(object sender, NavigationEventArgs e) { // Unregister the event so it doesn't get called again RootFrame.Navigated -= ClearBackStackAfterReset; // Only clear the stack for 'new' (forward) and 'refresh' navigations if (e.NavigationMode != NavigationMode.New &amp;&amp; e.NavigationMode != NavigationMode.Refresh) return; // For UI consistency, clear the entire page stack while (RootFrame.RemoveBackEntry() != null) { ; // do nothing } }</code> </pre> <br><br>  Why is there a subscription to New and Refresh?  Consider on our example. <br><br>  If we use App Resume, being on the second page, then we can make a breakpoint in the OnNavigateTo method on our page and see that the page starts with the New parameter.  However, if we were already on the main page when the application was minimized, we would return to the main page first with the Reset navigation parameter, and only then with the Refresh navigation parameter, which is processed in this method. <br><br>  Next, we will consider another interesting scenario of using App Resume - when we do not launch the application, but return to it. <br><br>  <b>App Resume to return to the running application.</b>  <b>"As in iOS or WP8.1"</b> <br><br>  It has been rumored that now applications for WP8.1 on the main tile will not be restarted by default, but restored.  Like it or not, we can only find out after Build.  In the meantime, we can make the behavior ‚Äúlike in iOS‚Äù, that is, if the user minimized the application and clicked on the main tile, it goes to the same page where it was, and the application is not restarted.  It is important to understand that it is necessary to use this opportunity not to make it ‚Äúlike in iOS‚Äù, but in order to make a really convenient and high-quality application that will be convenient to use.  In general, WP users are used to the fact that applications will most likely restart when they click on the main tile. <br>  In fact, the user should get into his application just as if he had just switched to the application using the ‚ÄúBack‚Äù button, while preserving the navigation history and user data on the screen. <br><br>  We need to handle two main behavioral scenarios: <br>  1. The user clicks on the application tile. <br>  2. The user activates the application by reference (Push Notification, Secondary Tile, Photo Share, etc.) <br><br>  In the first case, to implement this scenario, first of all, turn off the reset of the history when App Resume: <br>  in App.xaml.cs, we delete the <b>Navigated</b> subscription and the CheckForResetNavigation method, subscribe to the <b>Navigating</b> event (it comes BEFORE we go to the page and can cancel the transition): <br>  RootFrame.Navigating + = ContinueExecution; <br><br>  When launching the application, we can see in the method that the event comes first with the Reset argument, and then the event with the New argument when the application is clicked. <br><br>  With this behavior in mind, we‚Äôll take a closer look at the implementation of ContinueExecution: <br><br><pre> <code class="html hljs xml">private bool isRelaunch = false; private void ContinueExecution(object sender, NavigatingCancelEventArgs e) { if (e.NavigationMode == NavigationMode.Reset || (isRelaunch &amp;&amp; e.NavigationMode==NavigationMode.New)) { if (isRelaunch &amp;&amp; e.Uri.OriginalString != "/MainPage.xaml") { RootFrame.Navigated+=ClearBackStackAfterReset; return; } e.Cancel = true; isRelaunch = !isRelaunch; } }</code> </pre> <br><br>  The ClearBackStackAfterReset method is generated by the studio for new WP8 projects and simply clears the navigation history: <br><br><pre> <code class="html hljs xml">private void ClearBackStackAfterReset(object sender, NavigationEventArgs e) { RootFrame.Navigated -= ClearBackStackAfterReset; if (e.NavigationMode != NavigationMode.New &amp;&amp; e.NavigationMode != NavigationMode.Refresh) return; while (RootFrame.RemoveBackEntry() != null) { } }</code> </pre> <br><br>  As we can see here, the condition for checking the start page has been added: <br><pre> <code class="html hljs xml">if (isRelaunch &amp;&amp; e.Uri.OriginalString != "/MainPage.xaml")</code> </pre> <br><br>  Validation is required for the second scenario, when the minimized application is activated by secondary tiles, push notification, etc. <br>  In this case, the history will be cleared, and after activating the application and processing the user history using the ‚ÄúBack‚Äù button, we will exit the application. <br><br>  If you want, for example, according to Push Notification, not to delete the history, but continue to use the application, it is enough to delete the line <br>  RootFrame.Navigated + = ClearBackStackAfterReset; <br>  or add another condition for links with push notification. <br><br>  To demonstrate how the second script works, add a button to the next page to generate a second link: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Secondary Tile"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ButtonTile_OnClick"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Button</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Add a fairly simple handler for this button: <br><br><pre> <code class="html hljs xml">private void ButtonTile_OnClick(object sender, RoutedEventArgs e) { var secondTile = ShellTile.ActiveTiles.FirstOrDefault(x =&gt; x.NavigationUri.ToString().Contains("issecondtile")); if (secondTile == null) { var newTileData = new StandardTileData { Title = "Second Page", }; ShellTile.Create(new Uri("/SecondPage.xaml?id=someid&amp;issecondtile=true", UriKind.Relative), newTileData); } }</code> </pre> <br><br>  Now, if we run the application, then go to the second page.  If we then click on the tile after that, we will see that the application has started without the navigation history and at the same time, the main tile is launched with the navigation history. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db0/217/d77/db0217d7737c38c5a842cd3620b14759.png"><img src="https://habrastorage.org/getpro/habr/post_images/085/d3f/87b/085d3f87bd9e453d5a0d037a11f4ced4.png"><br><br>  <b>Results</b> <br><br>  Despite the simplicity of App Resume, the explanation of the principles of work turned out quite lengthy.  As we can see, using App Resume, you can not only speed up the launch of the application, but also make the behavior of the application ‚Äúas in iOS‚Äù.  It is also especially important not to forget about Tombstone in the application recovery script by tile.  In this case, we will save the entire navigation history, but at the same time all user data in memory will be destroyed and we need to restore them on the screen from the storage. </div><p>Source: <a href="https://habr.com/ru/post/214933/">https://habr.com/ru/post/214933/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214921/index.html">Counter common sense. On the possible blocking of Yandex by the decision of the Khabarovsk court</a></li>
<li><a href="../214923/index.html">Found the creator of bitcoin</a></li>
<li><a href="../214925/index.html">The hard-hitting test of your Agile</a></li>
<li><a href="../214927/index.html">Meetup management requires $ 300 for canceling a powerful DDoS attack.</a></li>
<li><a href="../214931/index.html">British authorities abolished VAT on bitcoin transactions</a></li>
<li><a href="../214935/index.html">3d printers: Chinese "twins"</a></li>
<li><a href="../214937/index.html">Javascript UPNP / DLNA server</a></li>
<li><a href="../214943/index.html">Elementary OS: get paid to fix bugs</a></li>
<li><a href="../214945/index.html">Comparison of services for autocompletion of addresses in the form</a></li>
<li><a href="../214949/index.html">GitHub launched Developer Program</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>