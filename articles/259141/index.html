<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Russification and multilingual OpenStreetMap cards</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While developing web maps that use OpenStreetMap data, there is often a question about how to display maps with correct Russian names. This problem do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Russification and multilingual OpenStreetMap cards</h1><div class="post__text post__text-html js-mediator-article">  While developing web maps that use <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> data, there is often a question about how to display maps with correct Russian names.  This problem does not arise if your maps show only <a href="http://www.openstreetmap.org/">Russia</a> .  However, if you look, for example, at a map of <a href="http://www.openstreetsap.org/">China</a> , then you are unlikely to enjoy such an abundance of hieroglyphs, and vain attempts to find Beijing on such a map are not likely to be crowned with success. <br><br><img src="https://habrastorage.org/files/8db/4c4/437/8db4c44379eb4237b35c6ae61bcd4946.png"><br><br>  <a href="http://wiki.openstreetmap.org/wiki/Multilingual_names">It is known</a> that the freedom-loving project <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> allows you to save the names of geographical objects in different languages.  For this purpose, special tags are used, such as <b><i>name: ru</i></b> , <b><i>name: en</i></b> or <b><i>name: es</i></b> , and most importantly, they are filled in by <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> participants.  Of course, the most detailed inscriptions are created by users in the language they speak: in Russia - in Russian, in China - in Chinese, in African countries - in local languages.  There is little chance that some street in Nigeria will have a Russian translation, but the main geographical objects (countries, cities, rivers, etc.) have translations.  This small cartographic information is quite enough for a Russian-speaking user to open, for example, a map of China and find the main names on it.  Thus, your resource will become a little more user friendly. <br><a name="habracut"></a><br>  If you aim to find sensible instructions on how to use these translation tags on your own web maps, then in the whole space of the Runet or even the Internet there is only scattered information about various aspects of the localization of <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> web maps, but you can hardly find the boxed instructions.  On the one hand, this problem is not the most difficult architectural issue, since  The technology was developed within the framework of the <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> project itself.  But on the other hand, in the completed projects of localized web maps, for example, in the well-known Rostelecom <a href="http://maps.sputnik.ru/">Satellite</a> , the localization problem was solved, and the problems faced by the developers and how they were resolved remain unresponsive to the IT public. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/054/f6f/969/054f6f969d6a4e6d9129d8ac1f98b38c.png"><br><br>  There are even web- <a href="http://mlm.jochentopf.com/%3Flang%3Dru%252C_%26zoom%3D6%26lat%3D48.32704%26lon%3D27.55371%26layers%3D0BT">projects</a> with multilingual support, but they are not brought to a logical, user-friendly end. <br><br><img src="https://habrastorage.org/files/d16/1e0/8b5/d161e08b5a614189adf5286f78ca581f.png"><br><br>  This article aims to bring together this scattered information in the form of complete instructions on the localization of <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> maps.  The article provides minimal information about the deployment of tile north based on <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> data, since  this topic was disclosed in detail by other publications on <a href="http://habrahabr.ru/post/144675/">Habr√©</a> , on <a href="http://gis-lab.info/qa/mod_tile.html">Gis-Lab</a> and in other <a href="https://switch2osm.org/serving-tiles/manually-building-a-tile-server-12-04/">special projects</a> .  Within the framework of this article we will deploy the storage of tiles (tiles-pictures, of which the image of a web map is ‚Äústitched‚Äù) according to the <a href="http://habrahabr.ru/post/144675/">well-known instructions</a> , but without going into details or specifying details.  Emerging questions about the deployment of tile storage, look primarily in the <a href="http://habrahabr.ru/post/144675/">instructions</a> mentioned. <br><br>  So, we will need packages (with all the necessary dependencies): <br><ul><li>  PostgreSQL&gt; = 8.4 </li><li>  PostGIS&gt; = 1.5 &lt;2 </li><li>  Python 2.x </li><li>  Mapnik&gt; = 2 </li><li>  Osm2pgsql </li><li>  Subversion </li></ul><br>  A full tile server (with Apache httpd, mod_tile and renderd) is not required to be deployed for the purpose of this article.  But the guiding vectors for the deployment of the tile server will be given below, you will find detailed instructions on the above links. <br><br><h2>  1. Get vector data <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> </h2><br>  We will import this data (using the osm2pgsql utility) into the Postgresql database, and then the Mapnik rendering package will generate raster tiles. <br><br>  So, download the map in a given region in XML format (OSM file) or in compressed binary PBF format from one of the <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> mirrors. <br>  The planet file can be downloaded with the commands: <br><br><pre><code class="bash hljs">wget http://download.bbbike.org/osm/planet/planet-latest.osm.pbf.md5 wget http://download.bbbike.org/osm/planet/planet-latest.osm.pbf md5sum planet-latest.osm.pbf</code> </pre> <br>  You should keep in mind that this data takes up a significant amount.  For example, a file containing vector data for the entire planet <a href="">Planet.osm</a> in uncompressed OSM XML takes more than 1TB, in XML format, compressed bz2, takes 41.8GB, and in binary PBF format 18.1GB.  All of these formats store the same data.  Naturally, if you need only a specific region, and not the entire planet, then these numbers will be much smaller, but the proportions of the data volumes in the formats, OSM XML, OSM XML, compressed bz2, and in the PBF format, will remain the same.  You should keep in mind that before importing into Postgresql, vector data in OSM XML format, compressed BZ2, and binary PBF format will be pre-processed (unpacked, parsed), which will increase the time to import the downloaded file into the Postgresql database.  So, on my Core i5 quad-core machine with 16GB of RAM, 2TB HDD (Ubuntu 14.04 64x), the import of <a href="">Planet.osm.pbf</a> took 2 weeks.  Importing a similar <a href="">Planet.osm.bz2</a> file took an order of magnitude less time.  According to my own feelings, the osm2pgsql utility is demanding on the amount of RAM (for optimal memory management, read about the features of the --cache and --cache-strategy utilities of the osm2pgsql utility), the frequency and number of processor cores (at the time of parsing the file, to control the processor core load, see the --number-processes utility utility of osm2pgsql), as well as the speed of the hard disk (at the time of inserting data and creating indexes in Postgresql, for optimization, see the --disable-parallel-indexing utility utility of osm2pgsql).  If you have an SSD, then importing data into the Postgresql database will be much faster. <br><br>  For the purposes of this article, we will use the region of China, since  it is not Russified by default and has a relatively small size, which is convenient at the stage of debugging technology.  The China vector data files can be downloaded from the <a href="http://download.geofabrik.de/">geofabrik.de</a> project site with the command: <br><br><pre> <code class="bash hljs">wget http://download.geofabrik.de/asia/china-latest.osm.pbf</code> </pre><br><h2>  2. Update the resulting <i><a href="http://www.openstreetmap.org/">OpenStreetMap</a></i> vector data. </h2><br>  The fact is that in the time that has passed since the data file was packaged until it was deployed on your machine, some changes could be made on OpenStreetMap.  Therefore, before importing, we update the data file with the osmupdate command from the osmcutils package: <br><br><pre> <code class="bash hljs">osmupdate china-latest.osm.pbf new-china-latest.osm.pbf</code> </pre><br>  If your OSM file does not contain a timestamp, then most likely the osmupdate utility will return an error.  In this case (if you know the timestamp of your file - it is sometimes published on the file download page) you need to run the command in the following format: <br><br><pre> <code class="bash hljs">osmupdate china-latest.osm.pbf 2015-05-13T14:48:07Z new-china-latest.osm.pbf</code> </pre><br>  The osmupdate utility itself downloads the diff file and applies it to the file specified in the first argument of the call command.  It is not recommended to run the osmupdate utility with large files in OSM XML format (for example, planet-latest.osm.bz2), since  Preliminary processing of the file by the osmconvert utility from the same osmcutils package is necessary, and the osmupdate utility with the received converted file will work for several days.  For large files, it is recommended to use the PBF format.  But keep in mind that importing such a file into Postgresql will take longer than importing an OSM XML file.  So say, a double-edged sword.  Personally, I always choose the PBF format. <br><br><h2>  3. Configure the support of the necessary languages ‚Äã‚Äãin the settings of the utility osm2pgsql </h2><br>  By default, any languages ‚Äã‚Äãare not installed in the /usr/share/osm2pgsql/osm2pgsql/default.style style file.  For inscriptions on the map, the <b><i>name</i></b> tag is used, which is specified in the /usr/share/osm2pgsql/osm2pgsql/default.style file with the line: <br><br><pre> <code class="bash hljs">node,way name text linear</code> </pre><br>  After this we add support for, for example, Russian, English and Spanish languages: <br><br><pre> <code class="bash hljs">node,way name:ru text linear node,way name:en text linear node,way name:es text linear</code> </pre><br>  These three lines will tell the osm2pgsql utility to import from the PBF file also the values ‚Äã‚Äãof the tags <b><i>name: ru</i></b> , <b><i>name: en</i></b> , <b><i>name: se</i></b> .  Other localized names will be ignored. <br><br><h2>  4. Create a Postgresql database to store OpenStreetMap vector data </h2><br>  You must first configure trust-authentication (in order not to enter a password, this article does not require this) and create the necessary database users (see the <a href="http://habrahabr.ru/post/144675/">instruction</a> ).  In this article, we will limit ourselves to trust authentication and the standard postgres user.  So, create a database, for example, china and connect the necessary extensions to it: <br><br><pre> <code class="bash hljs">createdb -U postgres china psql -U postgres -d china -c <span class="hljs-string"><span class="hljs-string">'CREATE EXTENSION hstore; CREATE EXTENSION postgis;'</span></span></code> </pre><br><h2>  5. Import the vector data into the Postgresql database. </h2><br>  Import is carried out by the utility osm2pgsql.  Utility key descriptions can be found in the utility help.  Some explanatory information is provided on an English-language <a href="https://switch2osm.org/loading-osm-data/">resource</a> . <br><br><pre> <code class="bash hljs">osm2pgsql -s -m -d china -U postgres --drop new-china-latest.osm.pbf</code> </pre><br>  The --drop key allows you to reduce the disk space occupied by the database, thus sacrificing the ability to subsequently update the data in the database from fresh PBF or OSM XML files.  In the case of China, the database size has decreased from about 500MB to 92MB.  To see the size of the database, enter the command in the psql console connected to any existing database: <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> pg_size_pretty( pg_database_size( <span class="hljs-string"><span class="hljs-string">'china'</span></span> ) );</code> </pre><br><h2>  6. Create views in the database to display the translated geographical names. </h2><br>  Using the <a href="http://wiki.openstreetmap.org/wiki/Regionalisedmap">instruction,</a> create several SQL views.  For the generation of ‚ÄúRussian‚Äù tiles (tiles containing Russian signatures) we will use the prefix china_ru, for the generation of ‚ÄúEnglish‚Äù tiles - china_en, for the generation of ‚ÄúSpanish‚Äù tiles - china_es.  Below is the SQL script for creating SQL representations for generating only ‚ÄúRussian‚Äù tiles.  Dear reader, I think, he will deal with SQL representations for generating "English" and "Spanish" tiles, taking the "Russian¬ª VIEW as a basis. <br><br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> china_ru_point <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> data.osm_id, data.access, data.<span class="hljs-string"><span class="hljs-string">"addr:housename"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:housenumber"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:interpolation"</span></span>, data.admin_level, data.aerialway, data.aeroway, data.amenity, data.area, data.barrier, data.bicycle, data.brand, data.bridge, data.boundary, data.building, data.capital, data.construction, data.covered, data.culvert, data.cutting, data.denomination, data.disused, data.ele, data.embankment, data.foot, data.<span class="hljs-string"><span class="hljs-string">"generator:source"</span></span>, data.harbour, data.highway, data.historic, data.horse, data.intermittent, data.junction, data.landuse, data.layer, data.leisure, data.lock, data.man_made, data.military, data.motorcar, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> E<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, data.<span class="hljs-string"><span class="hljs-string">"natural"</span></span>, data.office, data.oneway, data.operator, data.place, data.poi, data.population, data.power, data.power_source, data.public_transport, data.railway, data.ref, data.religion, data.route, data.service, data.shop, data.sport, data.surface, data.toll, data.tourism, data.<span class="hljs-string"><span class="hljs-string">"tower:type"</span></span>, data.tunnel, data.water, data.waterway, data.wetland, data.width, data.wood, data.z_order, data.way <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> planet_osm_point <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> china_ru_line <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> data.osm_id, data.access, data.<span class="hljs-string"><span class="hljs-string">"addr:housename"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:housenumber"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:interpolation"</span></span>, data.admin_level, data.aerialway, data.aeroway, data.amenity, data.area, data.barrier, data.bicycle, data.brand, data.bridge, data.boundary, data.building, data.construction, data.covered, data.culvert, data.cutting, data.denomination, data.disused, data.embankment, data.foot, data.<span class="hljs-string"><span class="hljs-string">"generator:source"</span></span>, data.harbour, data.highway, data.historic, data.horse, data.intermittent, data.junction, data.landuse, data.layer, data.leisure, data.lock, data.man_made, data.military, data.motorcar, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> E<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, data.<span class="hljs-string"><span class="hljs-string">"natural"</span></span>, data.office, data.oneway, data.operator, data.place, data.population, data.power, data.power_source, data.public_transport, data.railway, data.ref, data.religion, data.route, data.service, data.shop, data.sport, data.surface, data.toll, data.tourism, data.<span class="hljs-string"><span class="hljs-string">"tower:type"</span></span>, data.tracktype, data.tunnel, data.water, data.waterway, data.wetland, data.width, data.wood, data.z_order, data.way <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> planet_osm_line <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> china_ru_polygon <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> data.osm_id, data.access, data.<span class="hljs-string"><span class="hljs-string">"addr:housename"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:housenumber"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:interpolation"</span></span>, data.admin_level, data.aerialway, data.aeroway, data.amenity, data.area, data.barrier, data.bicycle, data.brand, data.bridge, data.boundary, data.building, data.construction, data.covered, data.culvert, data.cutting, data.denomination, data.disused, data.embankment, data.foot, data.<span class="hljs-string"><span class="hljs-string">"generator:source"</span></span>, data.harbour, data.highway, data.historic, data.horse, data.intermittent, data.junction, data.landuse, data.layer, data.leisure, data.lock, data.man_made, data.military, data.motorcar, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> E<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, data.<span class="hljs-string"><span class="hljs-string">"natural"</span></span>, data.office, data.oneway, data.operator, data.place, data.population, data.power, data.power_source, data.public_transport, data.railway, data.ref, data.religion, data.route, data.service, data.shop, data.sport, data.surface, data.toll, data.tourism, data.<span class="hljs-string"><span class="hljs-string">"tower:type"</span></span>, data.tunnel, data.water, data.waterway, data.wetland, data.width, data.wood, data.z_order, data.way, data.way_area <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> planet_osm_polygon <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">VIEW</span></span> china_ru_roads <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> data.osm_id, data.access, data.<span class="hljs-string"><span class="hljs-string">"addr:housename"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:housenumber"</span></span>, data.<span class="hljs-string"><span class="hljs-string">"addr:interpolation"</span></span>, data.admin_level, data.aerialway, data.aeroway, data.amenity, data.area, data.barrier, data.bicycle, data.brand, data.bridge, data.boundary, data.building, data.construction, data.covered, data.culvert, data.cutting, data.denomination, data.disused, data.embankment, data.foot, data.<span class="hljs-string"><span class="hljs-string">"generator:source"</span></span>, data.harbour, data.highway, data.historic, data.horse, data.intermittent, data.junction, data.landuse, data.layer, data.leisure, data.lock, data.man_made, data.military, data.motorcar, <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.<span class="hljs-string"><span class="hljs-string">"name:ru"</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> E<span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">CASE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHEN</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ELSE</span></span> data.name <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, data.<span class="hljs-string"><span class="hljs-string">"natural"</span></span>, data.office, data.oneway, data.operator, data.place, data.population, data.power, data.power_source, data.public_transport, data.railway, data.ref, data.religion, data.route, data.service, data.shop, data.sport, data.surface, data.toll, data.tourism, data.<span class="hljs-string"><span class="hljs-string">"tower:type"</span></span>, data.tunnel, data.water, data.waterway, data.wetland, data.width, data.wood, data.z_order, data.way <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> planet_osm_roads <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-string"><span class="hljs-string">'china_ru_point'</span></span>, <span class="hljs-string"><span class="hljs-string">'way'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">900913</span></span>, <span class="hljs-string"><span class="hljs-string">'POINT'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-string"><span class="hljs-string">'china_ru_line'</span></span>, <span class="hljs-string"><span class="hljs-string">'way'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">900913</span></span>, <span class="hljs-string"><span class="hljs-string">'LINESTRING'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-string"><span class="hljs-string">'china_ru_polygon'</span></span>, <span class="hljs-string"><span class="hljs-string">'way'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">900913</span></span>, <span class="hljs-string"><span class="hljs-string">'POLYGON'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> geometry_columns <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'public'</span></span>, <span class="hljs-string"><span class="hljs-string">'china_ru_roads'</span></span>, <span class="hljs-string"><span class="hljs-string">'way'</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">900913</span></span>, <span class="hljs-string"><span class="hljs-string">'LINESTRING'</span></span>);</code> </pre><br>  In this case, we will create signatures on the map in the format ‚Äúname: ru \ nname‚Äù, where E '\ n' is, as is known, the carriage return to a new line.  For a more sophisticated placement of signatures on the map, read the <a href="https://github.com/mapnik/mapnik/wiki/TextSymbolizer">Mapnik</a> TextSymbolizer documentation.  In this case, you will need to change the display styles of the signatures on the map, generated in accordance with these instructions in the next paragraph. <br><br><h2>  7. Install scripts from OpenStreetMap to generate tiles </h2><br>  Let us choose the directory / home / osm / mapnik for storing all the necessary Mapnik scripts.  We will download OpenStreetMap scripts into it to generate tiles, extort world shapes (shape files) used to simplify the generation of tiles on small scales, and create Mapnik XML style files to attach to the database: <br><br><pre> <code class="bash hljs">svn co http://svn.openstreetmap.org/applications/rendering/mapnik /home/osm/mapnik /home/osm/mapnik/get-coastlines.sh</code> </pre><br>  Next, we will need to create 3 tile rendering style files, respectively, for Russian, English and Spanish geographical object signatures.  To do this, we set a special variable of the MAPNIK_PREFIX system environment, which allows you to set the prefix of the vector data tables in the Postgres database and which the script /home/osm/mapnik/generate_xml.py will read and substitute into pseudo queries to the database. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_PREFIX=<span class="hljs-string"><span class="hljs-string">'china_ru'</span></span> /home/osm/mapnik/generate_xml.py /home/osm/mapnik/osm.xml china_ru.xml --dbname china --user postgres --accept-none <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_PREFIX=<span class="hljs-string"><span class="hljs-string">'china_en'</span></span> /home/osm/mapnik/generate_xml.py /home/osm/mapnik/osm.xml china_en.xml --dbname china --user postgres --accept-none <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_PREFIX=<span class="hljs-string"><span class="hljs-string">'china_es'</span></span> /home/osm/mapnik/generate_xml.py /home/osm/mapnik/osm.xml china_es.xml --dbname china --user postgres --accept-none</code> </pre><br>  These teams will create 3 special styles for rendering tiles, allowing you to read the data for rendering from the Russian, English or Spanish representations we need. <br><br><h2>  8. Denote in the script of generating tiles the region of China for generating tiles </h2><br>  We find in the script /home/osm/mapnik/generate_tiles_multiprocess.py these lines: <br><br><pre> <code class="python hljs">bbox = (<span class="hljs-number"><span class="hljs-number">-180.0</span></span>,<span class="hljs-number"><span class="hljs-number">-90.0</span></span>, <span class="hljs-number"><span class="hljs-number">180.0</span></span>,<span class="hljs-number"><span class="hljs-number">90.0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#          render_tiles(bbox, mapfile, tile_dir, 0, 5, "World") #     0-  5- </span></span></code> </pre><br>  After these lines we will write: <br><br><pre> <code class="python hljs">bbox = (<span class="hljs-number"><span class="hljs-number">85.0</span></span>,<span class="hljs-number"><span class="hljs-number">19.7</span></span>,<span class="hljs-number"><span class="hljs-number">132.5</span></span>,<span class="hljs-number"><span class="hljs-number">40.8</span></span>) <span class="hljs-comment"><span class="hljs-comment">#       render_tiles(bbox, mapfile, tile_dir, 6, 15, "China") #     6-  15-  exit()</span></span></code> </pre><br>  This will allow China to generate tiles from the 6th to the 15th scale containing signatures in the language we need.  The exit () instruction allows you to opt out of further rendering the default areas in the script /home/osm/mapnik/generate_tiles_multiprocess.py (Muenchen, Muenchen +, Muenchen ++, Nuernberg, Karlsruhe, Karlsruhe +, Augsburg, Augsburg +, Europe +).  There is also a /home/osm/mapnik/generate_tiles.py script that starts the rendering process in one stream.  But we will not use it, because  If there are multiple processor cores, the /home/osm/mapnik/generate_tiles_multiprocess.py script will generally work faster. <br><br><h2>  9. Generate tiles for selected locations </h2><br>  We need to create directories where Mapnik will put the generated tiles: <br><br><pre> <code class="bash hljs">mkdir /home/osm/mapnik/tiles mkdir /home/osm/mapnik/tiles/ru mkdir /home/osm/mapnik/tiles/en mkdir /home/osm/mapnik/tiles/es</code> </pre><br>  We have to start generating tiles three times, changing the values ‚Äã‚Äãof the variables of the system environment MAPNIK_MAP_FILE and MAPNIK_TILE_DIR.  The script will read these variables and pass them to Mapnik to adjust the tile rendering: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_MAP_FILE=/home/osm/mapnik/china_ru.xml <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_TILE_DIR=/home/osm/mapnik/tiles/ru/ <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> python /home/osm/mapnik/generate_tiles_multiprocess.py <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_MAP_FILE=/home/osm/mapnik/china_en.xml <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_TILE_DIR=/home/osm/mapnik/tiles/en/ <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> python /home/osm/mapnik/generate_tiles_multiprocess.py <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_MAP_FILE=/home/osm/mapnik/china_es.xml <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> MAPNIK_TILE_DIR=/home/osm/mapnik/tiles/es/ <span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> python /home/osm/mapnik/generate_tiles_multiprocess.py</code> </pre><br>  Tiles are generated. <br><br><h2>  10. Display the tiles on the web map </h2><br>  To do this, create a simple html-page, in which we will connect the created tile storages.  The page file should be placed next to the generated / home / osm / mapnik / tiles tile directory.  To display web maps, we will use the <a href="http://www.leafletjs.com/">LeafletJS</a> javascript framework: <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">http-equiv</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content-Type"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/html; charset=UTF-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"map"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"height: calc(100vh - 15px)"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> map = L.map(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'map'</span></span></span><span class="actionscript">, { center: [</span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">34.7</span></span></span><span class="actionscript">, </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">111.7</span></span></span><span class="actionscript">], zoom: </span><span class="hljs-number"><span class="actionscript"><span class="hljs-number">6</span></span></span><span class="actionscript"> }); L.control.layers({ </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"ru"</span></span></span><span class="actionscript"> : L.tileLayer(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'tiles/ru/{z}/{x}/{y}.png'</span></span></span><span class="actionscript">).addTo(map), </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"en"</span></span></span><span class="actionscript"> : L.tileLayer(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'tiles/en/{z}/{x}/{y}.png'</span></span></span><span class="actionscript">), </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"es"</span></span></span><span class="actionscript"> : L.tileLayer(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">'tiles/es/{z}/{x}/{y}.png'</span></span></span><span class="actionscript">) }, </span><span class="hljs-literal"><span class="actionscript"><span class="hljs-literal">null</span></span></span><span class="actionscript">).addTo(map); </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This page will be executed locally.  In the upper right corner, a control should be available, allowing you to select a tile source.  Russian, English and Spanish versions of maps will be as follows: <br><br><img src="https://habrastorage.org/files/3fc/bff/e26/3fcbffe261614047a35ec9a0293e6f67.png"><br><img src="https://habrastorage.org/files/fa8/ca9/2dd/fa8ca92ddf264794a05a1c4b7472920e.png"><br><img src="https://habrastorage.org/files/8cd/592/b8a/8cd592b8a6374447a9d4a2fe1037744c.png"><br><br><h2>  11. Tile rendering on the fly </h2><br>  You will need to configure several mod_tile modules of the Apache web server, each of which will be responsible for its mapping - / ru - for rendering Russian tiles, / en - for rendering, respectively, English tiles, and so on.  Details of mod_tile, httpd and renderd settings are in the instructions from <a href="http://gis-lab.info/qa/mod_tile.html">Gis-Lab</a> .  As part of the demonstration of the example of localization of OpenStreetMap maps, I do not consider it necessary to deploy a full-fledged tile server. <br><br><h2>  Notes </h2><br><ul><li>  In the original edition of the article, the author planned to demonstrate an example of the Russification / localization of maps using the example of Cyprus, not China, since  Cyprus occupies an even smaller area than China, which means that the data will be imported to the database faster, tiles will be generated faster, etc.  But, as it turned out, the ‚Äúlocal‚Äù language contains characters similar to the Latin alphabet.  Therefore, translations into English were non-demonstrative.  By the way, the sizes of the Cyprus and China databases (with and without the --drop key) turned out to be approximately the same, plus or minus a couple of megabytes, despite the significant difference in the area occupied by these countries. </li><li>  The author of the article planned to implement within the article the support of the Russian, English and German languages.  But since the English and German translations are written in most cases the same way, in the final version of the article the German language was replaced by Spanish for greater demonstrativeness. </li><li>  The author‚Äôs experiments with the upload of Planet.osm were not completed (as was done in the case of maps of Cyprus and China).  The fact is that considerable time importing the file into the Postgres database (more than two weeks) did not allow ‚Äúplaying‚Äù with one or another settings of the osm2pgsql utility (and its /usr/share/osm2pgsql/osm2pgsql/default.style style file) to an acceptable for the author time.  That is why the article does not contain specific statistics for processing such a large amount of data. </li><li>  Creating views in the database such as china_ru_point, china_ru_roads, etc., as well as forcing the MAPNIK_PREFIX system environment variable to prefix tables with the translations we need is not the only way to get the necessary translations.  In the Mapnik style file generated by the generate_xml.py script, you can customize the format for displaying labels on the map in the TextSymbolizer tag.  In particular, if you replace the generated name of the label field <b>[name]</b> with <b>[name: ru]</b> , then Mapnik will map labels taken from the field <b>name: ru of the</b> tables <i>planet_osm_point</i> , <i>planet_osm_line</i> , <i>planet_osm_polygon</i> , <i>planet_osm_roads</i> .  But, as practice shows, the translation of the names of geographical objects is substantially less than the names of these names themselves.  Perhaps that is why in the <a href="http://mlm.jochentopf.com/%3Flang%3Dru%252C_%26zoom%3D6%26lat%3D48.32704%26lon%3D27.55371%26layers%3D0BT">Multilingual Map</a> project the maps are ‚Äúbare‚Äù, without signatures of geographical objects.  In this regard, the concatenation <b>name: ru \ nname</b> , which we created in the views of china_ru_ *, is more universal. </li><li>  If you do not plan to support multiple languages ‚Äã‚Äãand do not plan to periodically update data (that is, you will use the --drop key of the osm2pgsql utility), then you can replace the cumbersome construction of views in the database with one UPDATE query, which replaces the existing value in the <b>name</b> field for concatenation <b>name: ru \ nname</b> in the tables <i>planet_osm_point</i> , <i>planet_osm_line</i> , <i>planet_osm_polygon</i> and <i>planet_osm_roads</i> .  In this case, it is not necessary to force the setting of the MAPNIK_PREFIX system environment variable.  And, as expected, Mapnik will generate tiles for the selected language only. </li></ul><br><h2>  findings </h2><br>  The problem of localization of maps OpenStreetMap is not very difficult.  There are several approaches to solving this problem.  This article offers a very specific working version.  I am sure that a respected reader will have many questions on the content of this article, and they will have their own ideas for branching the proposed algorithm.  The author of the article does not claim to be the only correct method for solving the problem of Russification / localization of OpenStreetMap maps and is happy to read about your ‚Äútricks‚Äù in solving this issue. </div><p>Source: <a href="https://habr.com/ru/post/259141/">https://habr.com/ru/post/259141/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259129/index.html">Positive Hack Days V WAF Bypass Contest</a></li>
<li><a href="../259133/index.html">IBM cloud grant up to $ 120,000 awaits you at Startup Village</a></li>
<li><a href="../259135/index.html">What was on PHDays V: signs of interception of GSM-signal, the best time to hack Wi-Fi, the future of encryption</a></li>
<li><a href="../259137/index.html">VKontakte launches BugBounty program</a></li>
<li><a href="../259139/index.html">UniFi Controller, displaying RADIUS logins</a></li>
<li><a href="../259143/index.html">Yukon: 1st Annual Software Developer Conference</a></li>
<li><a href="../259145/index.html">Prototype OOP for Lua</a></li>
<li><a href="../259147/index.html">Network Evolution - New 25/50/100 GbE Standard</a></li>
<li><a href="../259149/index.html">SonarQube. We check the code for quality</a></li>
<li><a href="../259151/index.html">Unicorn in search of extraterrestrial intelligence: an analysis of the SETI @ home code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>