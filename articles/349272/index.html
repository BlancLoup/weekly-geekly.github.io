<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basic security practices for iOS applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing any mobile application that processes user data, it is important to pay attention to security. This issue is particularly acute for ap...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basic security practices for iOS applications</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/20/uf/-a/20uf-ajeoii8wyjy_h7n3jjuj_u.png"><br><br>  When developing any mobile application that processes user data, it is important to pay attention to security.  This issue is particularly acute for applications where the full name, phone numbers, passports and other personal information appear.  Our company has developed and continues to develop several projects of this kind, in particular applications for clients of Russian banks.  Based on this experience, we have developed a set of security requirements that we follow.  Naturally, every year there are new technologies and opportunities, and with them - new behaviors and vulnerabilities.  In this article, we fixed the main points of security for iOS applications that are relevant at the beginning of 2018. <br><a name="habracut"></a><br><h3>  Data storage </h3><br>  iOS has always been famous for its security and attention to information security.  Nevertheless, during the existence of this OS, several serious vulnerabilities were identified due to user data leaks.  This once again reminds us that too many security measures do not exist and one cannot hope for everything in the system.  The less information remains on the disk after using the application, the better. <br><br>  Therefore, it is recommended to store only those data, without which it is impossible to do.  If among them there is personal user information - it is stored exclusively in Keychain.  If you need to use a full database, such as Core Data or Realm, it is necessarily encrypted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Information available in a search through Spotlight should also not contain user data. <br><br>  Do not forget about the fact that after interacting with the application on the disk will remain the data that the developer was not going to save specifically, for example, logs.  Therefore, in the application to disk should not be logged either nothing, or only information in which personal data do not appear. <br><br>  In addition, you can disable caching of web requests, because their contents are also saved to disk.  You can do this as follows: <br><br><pre><code class="hljs pgsql">let <span class="hljs-keyword"><span class="hljs-keyword">cache</span></span> = URLCache( memoryCapacity: <span class="hljs-number"><span class="hljs-number">0</span></span>, diskCapacity: <span class="hljs-number"><span class="hljs-number">0</span></span>, diskPath: nil) URLCache.shared = <span class="hljs-keyword"><span class="hljs-keyword">cache</span></span></code> </pre> <br>  And you can delete already cached requests in one line: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">URLCache</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.shared</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.removeAllCachedResponses</span></span>()</code> </pre> <br><h3>  Server connection </h3><br>  Before the release of iOS 9, applications could freely make requests to any address via HTTP.  In this case, the data were transmitted over the network in an unencrypted form, and it was not difficult for attackers to track the contents of the request.  Starting with iOS 9, Apple decided to impose strict network connection requirements and developed App Transport Security (ATS) rules, according to which all requests to the Internet should be made via the HTTPS protocol and encrypted using TLS 1.2 (with forward secrecy support).  The operating system itself by default follows these requirements; therefore, it is only necessary to comply with them from the server side. <br><br>  Developers also had the opportunity to specify connection parameters for all connections and for requests to specific domains.  All of them are written in the file Info.plist application.  Here the main parameter is NSAllowsArbitraryLoads, which disables all ATS rules (disabled by default).  If you turn it on, then Apple, when conducting a review of the application in the App Store, will ask for a weighty rationale for this action.  It may seem strange to have this flag, but in practice it is used in conjunction with another - NSAllowArbitraryLoadsInWebContent, which disables ATS only inside WebView.  It is often necessary because we cannot guarantee that the browser pages in the application meet all Apple security requirements.  This setting appeared only in iOS 10, so in order for web pages to open on devices with iOS 9, you have to turn on the NSAllowsArbitraryLoads flag.  But for all subsequent iOS versions, the value of NSAllowsArbitraryLoads will be ignored if there is NSAllowArbitraryLoadsInWebContent. <br><br><h3>  SSL pinning </h3><br>  Even when using HTTPS connections, it remains possible for third parties to view data when communicating with the server.  For example, in public networks, an attacker could monitor traffic using the Man-in-the-middle attack, in which he becomes an intermediary between the application and the server.  You can fight this with SSL pinning.  In practice, this means that the application knows the SSL server certificate used for the HTTPS connection, and it does not trust other certificates.  When an unknown certificate is received from the server (as in the case of the Man-in-the-middle attack), the connection is terminated.  Pinning can be done in different ways: the certificate file itself, its hash or public key can be stored in the application.  If you use the Alamofire library for network connections, you can use the ServerTrustPolicyManager class, which supports all the pinning options. <br><br>  It should be noted that the use of a hash or certificate has a significant drawback: when the certificate expires, you need to release an application update with new data, otherwise it will simply stop working.  If you use the public key and regenerate the server certificate using the previous key pair, it will not be necessary to update the application, as the public key will remain the same. <br><br><h3>  Authorization in the application </h3><br>  In many applications, authorization occurs by entering a 4-6 digit PIN code, invented by the user during registration.  Naturally, this code cannot be stored in its pure form either on the device or on the server. <br><br>  Verification of the entered code for correctness should occur on the server, where it is sent as a hash obtained using the <a href="https://en.wikipedia.org/wiki/PBKDF2">PBKDF2</a> algorithm (which is still recommended as a password hashing algorithm).  For the operation of this algorithm, a salt is needed - a set of random characters that is generated once during registration and is used for all subsequent authorizations. <br><br>  At best, only this salt should be stored in the application database.  But in applications, it is often possible to log in using Touch ID and Face ID, when a user enters his account, providing only biometric data.  In such situations, you have to store the PIN code itself or the hash resulting from it in Keychain. <br><br>  The number of possible attempts to enter the pin-code is limited, and the restriction must be imposed on the server side.  After using all attempts, the data stored on the disk is erased, and the user is automatically logged out. <br><br>  After authorization on the server, we get a token, on which we make all subsequent requests to the server.  The token has a limited period of validity and after some time it goes rotten.  In this case, the user must enter the pin code again to get a new token.  The action of the token can end both on the server (if no requests were made for this token within 10-15 minutes) or in the application (if it was minimized long enough, about 2 minutes). <br><br>  The token is not stored between sessions, and with each new launch of the application, it must be obtained by entering a PIN code. <br><br><h3>  Touch ID and Face ID </h3><br><img src="https://habrastorage.org/webt/gc/ph/rh/gcphrh_-lunxddnb82rnb69emp8.jpeg"><br><br>  Biometric authentication greatly simplifies entry into mobile applications.  Apple cites statistics according to which the chance of a user's fingerprint coinciding with another person's fingerprint is 1 to 50,000, while the chance of face scans coinciding is 1 to 1,000,000. All related calculations are performed on the Secure Enclave coprocessor, which is completely isolated from the operating system (more about the technology can be found <a href="https://www.apple.com/business/docs/iOS_Security_Guide.pdf">here</a> ).  Because of this, it is impossible to access or use the user's biometric data, so the application developer does not have to take care of this.  However, there are some interesting points related to these technologies. <br><br>  For example, an attacker could find out the PIN code from the phone itself, add its fingerprint to the list of prints known to the system, and log in using it in the application without knowing the PIN code.  To solve this problem, the operating system provides a hash called evaluatedPolicyDomainState, which describes the current fingerprint set.  This hash can be saved to disk during the first successful authorization in the application and during subsequent authorizations to check whether the current value differs from the saved one.  If they are different, the fingerprint database has been changed, the Touch ID input is disabled, and the user must re-enter the application PIN code to save the new hash value.  The same applies to Face ID. <br><br><h3>  Check for jailbreak </h3><br>  You can have different attitudes towards Apple‚Äôs policy of restricting user rights to control a smartphone, but the fact remains: if a user chooses to put Jailbreak on, most aspects of iOS security can be forgotten.  Any installed application can potentially access all stored information. <br>  Currently, Jailbreak has become less common, including due to the fact that with the release of each new version of iOS, it is becoming increasingly difficult. <br><br>  When detecting a jailbreak, you can impose hard restrictions: block access to certain parts of the application or even prohibit its use. <br>  You can check for Jailbreak in different ways.  For example, check the availability of the Cydia package on the device or the ability to write outside the application's sandbox. <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hasCydiaBundle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> filePath = <span class="hljs-string"><span class="hljs-string">"/Applications/Cydia.app"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">FileManager</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.fileExists(atPath: filePath) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">writeOutSandbox</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> filePath = <span class="hljs-string"><span class="hljs-string">"/private/test.txt"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fileContents = <span class="hljs-string"><span class="hljs-string">"test"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> fileContents.write(toFile: filePath, atomically: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, encoding: .utf8) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-type"><span class="hljs-type">FileManager</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">default</span></span>.removeItem(atPath: filePath) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> } }</code> </pre> <br>  It is worth adding that such methods can not fully protect the application from being used on a device with a jailbreak, but this complicates it considerably. <br><br><h3>  Antifraud </h3><br>  Even if the attacker has received full access to the phone or user account, there must be ways to block his ability to perform operations in the application.  To do this, during authorization, it is important to send information about the device to the server (ID, model, iOS version) - if the user has lost access to his phone, the device can be added to the black list on the server. <br><br>  Also, when using the application, you can send data about the user's geolocation to the server (provided that he gave access to it).  If operations are performed from atypical places, it is possible to suspend the service until the user confirms that the actions are actually being performed by him. <br><br>  All important changes to the settings and operations must be confirmed using the SMS code.  The number of attempts to enter the code should also be limited. <br><br><h3>  Data input </h3><br>  It is important to ensure security, including when entering information within the application. <br>  For example, in most text fields it is recommended to disable the autocomplete feature (the UITextField autoCorrectionType property).  If this is not done, the input data (which may be personal) will be indexed by the operating system and will appear as options for auto-completion in other applications.  And all text fields in which passwords are entered are, of course, masked and do not support the ability to copy / paste. <br><br>  To bypass the keyloggers that potentially exist on the device, the pin-code entry during authorization is not performed using the system keyboard, but using the number buttons on the screen. <br><br><h3>  Other iOS Features </h3><br>  When the user minimizes the application, the operating system takes a screenshot of the screen, which is then displayed in the list of minimized applications.  This screenshot is stored in a folder on the smartphone, and it is important to provide an option in which the screenshot may contain personal data.  This can be done in different ways: to block the screen contents or to put a ‚Äúcurtain‚Äù on top of it when the application is minimized, the main thing is that you cannot view the contents of the screen in the screenshot. <br><br>  To perform important operations, it is not recommended to use WebView, in which various vulnerabilities related to the execution of Javascript code were previously found.  However, in some service applications, web pages are indispensable.  In such cases, it is also recommended to use SSL pinning with a set of trusted certificates from third-party sites that the application can receive from the server. <br><br><h3>  Code Security </h3><br>  It is completely impossible to protect oneself from reverse engineering, but there are ways to complicate this process.  For example, when you start an application, you can try to detect a debugger connected to it. <br><br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> disableDebugger() { <span class="hljs-type"><span class="hljs-type">void</span></span> *dllHandle = dlopen(<span class="hljs-number"><span class="hljs-number">0</span></span>, RTLD_GLOBAL | RTLD_NOW); ptrace_ptr_t ptrace_method_pointer = dlsym(dllHandle, "ptrace"); ptrace_method_pointer(PT_DENY_ATTACH, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); dlclose(dllHandle); } static <span class="hljs-type"><span class="hljs-type">int</span></span> __unused isDebuggerPresent(<span class="hljs-type"><span class="hljs-type">void</span></span>) { <span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>[<span class="hljs-number"><span class="hljs-number">4</span></span>]; struct kinfo_proc <span class="hljs-keyword"><span class="hljs-keyword">info</span></span>; size_t infoSize = sizeof(<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.kp_proc.p_flag = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">name</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] = CTL_KERN; <span class="hljs-type"><span class="hljs-type">name</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>] = KERN_PROC; <span class="hljs-type"><span class="hljs-type">name</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>] = KERN_PROC_PID; <span class="hljs-type"><span class="hljs-type">name</span></span>[<span class="hljs-number"><span class="hljs-number">3</span></span>] = getpid(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sysctl(<span class="hljs-type"><span class="hljs-type">name</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, &amp;<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>, &amp;infoSize, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { perror("sysctl failure"); <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(<span class="hljs-number"><span class="hljs-number">-1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ((<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>.kp_proc.p_flag &amp; P_TRACED) != <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre> <br>  If the debugger is found, the application crashes. <br><br>  The application also does not have to be supplied with debug symbols, and in the compilation settings of the project all the values ‚Äã‚Äãrecommended by Apple for assemblies in the AppStore are set. <br><br>  If the project is written in Objective-C, you can use third-party code obfuscation tools that further complicate reverse engineering.  For Swift, there is no such need, since the compiler itself performs obfuscation when compiling in Release-mode. <br><br><h3>  Conclusion </h3><br>  A serious application in most cases is only part of some service, in which besides the mobile client there is a server and a connection with it.  To ensure full protection of the service, all its components must comply with information security requirements.  However, the security guarantee can never be one hundred percent.  The possibility of an attack always exists, and all the points described above only reduce the risks or increase its value.  Therefore, the only thing that can be done when developing applications is to adhere to the following principles: all application code is considered public, the best place for logic and data is on the server, and any protection should be comprehensive. <br><br>  If you want to familiarize yourself with the topic of mobile application security, you should refer to the most popular resource on this topic: <a href="https://www.owasp.org/index.php/OWASP_Mobile_Security_Project">OWASP Mobile Security Project</a> . <br>  Also, Apple provides its own materials on this issue, for example, <a href="https://developer.apple.com/library/content/documentation/Security/Conceptual/SecureCodingGuide/SecurityDevelopmentChecklists/SecurityDevelopmentChecklists.html">Security Development Checklist</a> . </div><p>Source: <a href="https://habr.com/ru/post/349272/">https://habr.com/ru/post/349272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349262/index.html">Simulation of dynamic systems: the problem of external ballistics</a></li>
<li><a href="../349264/index.html">Ready site template with registration, users and admins on Flask with SQL or MongoDB databases</a></li>
<li><a href="../349266/index.html">PaEndpointBundle - an alternative to symfony controllers</a></li>
<li><a href="../349268/index.html">Issue # 11: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../349270/index.html">Student Insider: Keyhole News</a></li>
<li><a href="../349274/index.html">"Calendar tester" for February. Know your customer</a></li>
<li><a href="../349276/index.html">Creating a game on Lua and L√ñVE - 1</a></li>
<li><a href="../349280/index.html">Room: One to many</a></li>
<li><a href="../349282/index.html">Hamster Marketplace development team: how our outsourcer became a partner and why AI is to blame</a></li>
<li><a href="../349284/index.html">Sign symbol: iOS denial of service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>