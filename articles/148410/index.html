<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a simple tower defense game on Unity3D, part one</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I have long wanted to publish this article, but did not have time to allocate time. I would like to warn in advance that the article is intende...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a simple tower defense game on Unity3D, part one</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I have long wanted to publish this article, but did not have time to allocate time.  I would like to warn in advance that the article is intended for a user who does not know Unity3D very well, therefore there will be an abundance of explanations in the text. <br><br>  <a href="http://habrahabr.ru/post/182672/">Part two</a> <br><br>  All interested - welcome under the cat! <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  The first steps </h4><br><h5>  Base scene </h5><br>  It's time to create a surface on which we, in fact, will have our guns, mobs, and more.  Click Terrain -&gt; Create Terrain.  And let's color it at the same time?  Select the terrain in the objects, then click in the properties of the button with the image of the brush, just below we press Edit textures -&gt; Add texture. <br>  The add texture window will appear, there is a small circle on the right side of the first line, it is a direct analogue of the Browse button, click on it and select a texture for our surface). <br><img src="https://habrastorage.org/files/0ed/17f/d69/0ed17fd695ed44768d3378ee622454c7.jpg"><br><img src="https://habrastorage.org/files/ec1/749/7c6/ec17497c6c034533beb2859fea42dfbb.jpg"><br>  Close the texture selection window, go back to the texture settings window, click the Apply button in it.  Voila, our terrain is colored in the texture we have chosen.  You can add more textures in the same way and paint it in more detail.  Experiment with buttons, create some slides, holes and so on;) <br><br><h5>  Add a gun </h5><br>  Played with terrain?  Great, time for serious toys: swing our only gun (5Mb, <a href="">link</a> ) <br>  Unpack the archive in the Assets folder of the project or in the Project window in the editor, the effect will be the same. <br>  We also need to create another folder: in the same Project there is a Create button at the top.  We press it, we select Folder.  Name the folder prefabs.  Right click on this folder and select Create -&gt; Prefab.  And his name will be gun_prefab. <br><br>  <i>A bit of theory: Prefab is a special kind of object that contains another object (s) with its own settings, and they can be quickly spun on the stage (and this will be useful in the future).</i>  <i>Prefabs in the list of scene objects are blue.</i> <br><br>  Click on the gun file (cannon2) - the properties of the gun import plug-in will be loaded in the property inspector. <br>  Set the values ‚Äã‚Äãas follows: <br>  Scale Factor set to 0.1 <br>  Check Generate Colliders <br>  The rest is not touched, just press the Apply button below. <br><br>  By this we set the cannon to an adequate size (the initial 0.01 is too small, and the unit is very huge), and generated colliders so that the gun does not collapse under the ground. <br><br>  In the Project window, drag our cannon (cannon2) onto the newly created prefab (gun_prefab). <br><br>  Now you can drag our prefab directly onto the stage - the gun will be cloned, but at the same time each new instance will be a separate object.  Try it!  And when you play enough - remove all the guns from the scene (select them and press Delete). <br><br><h5>  Create mobs </h5><br><br>  We have the simplest TD, therefore mobs will be simple balls.  Creating them without resorting to 3D modeling is easier than ever. <br>  Click GameObject -&gt; Create Other -&gt; Sphere.  An object with the name Sphere will appear on the scene and in the object inspector.  Create a prefab with the name monster01 for it in a known way and drag our monster to the prefab.  After that, you can remove the monster from the scene, it is no longer needed there, because  we'll spawn it right from the code. <br><br><h4>  <s>Cards, money,</s> two trunks </h4><br>  Drag the gun prefab directly onto the stage from Project, and put it in any convenient place (yes, then the spawn will be implemented differently, but for a start, it will go like this).  Time to write AI guns! <br>  Create a folder in the Project scripts, and in it a folder ai.  Then right click on the ai folder and select Create -&gt; C # Script.  The script is called PlasmaTurretAI. <br>  Open it with a doubleclick, your IDE will load with this script, which will be such a framework for scripting: <br>  <b>PlasmaTurretAI.cs</b> <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">PlasmaTurretAI</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> <span class="hljs-comment"><span class="hljs-comment">//       ,    MonoBehaviour    ""    GameObject. { //     void Start () { } //      void Update () { } }</span></span></code> </pre> <br><br>  And now, actually, the AI ‚Äã‚Äãcode itself in the comments: <br>  <b>PlasmaTurretAI.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Linq; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-comment"><span class="hljs-comment">//       ,    MonoBehaviour    ""    GameObject (     ). public class PlasmaTurretAI : MonoBehaviour { public GameObject[] targets; //   public GameObject curTarget; public float towerPrice = 100.0f; public float attackMaximumDistance = 50.0f; //  public float attackMinimumDistance = 5.0f; public float attackDamage = 10.0f; // public float reloadTimer = 2.5f; //  ,   public const float reloadCooldown = 2.5f; //  ,  public float rotationSpeed = 1.5f; //    public int FiringOrder = 1; //    (    2) public Transform turretHead; public RaycastHit Hit; //     private void Start() { turretHead = transform.Find("pushka"); //      } //      private void Update() { if (curTarget != null) //      { float distance = Vector3.Distance(turretHead.position, curTarget.transform.position); //    if (attackMinimumDistance &lt; distance &amp;&amp; distance &lt; attackMaximumDistance) //          { turretHead.rotation = Quaternion.Slerp(turretHead.rotation, Quaternion.LookRotation(curTarget.transform.position - turretHead.position), rotationSpeed * Time.deltaTime); //     if (reloadTimer &gt; 0) reloadTimer -= Time.deltaTime; //     -   if (reloadTimer &lt; 0) reloadTimer = 0; //     -     if (reloadTimer == 0) //  { MobHP mhp = curTarget.GetComponent&lt;MobHP&gt;(); switch (FiringOrder) //,     { case 1: Debug.Log("  "); //   FiringOrder++; // FiringOrder  1 break; case 2: Debug.Log("  "); //   FiringOrder = 1; // FiringOrder    break; } reloadTimer = reloadCooldown; //        } } } else // { curTarget = SortTargets(); //     } } //    ,    ! public GameObject SortTargets() { float closestMobDistance = 0; //       GameObject nearestmob = null; //    List&lt;GameObject&gt; sortingMobs = GameObject.FindGameObjectsWithTag("Monster").ToList(); //     Monster      foreach (var everyTarget in sortingMobs) //     { //    ,  closestMobDistance    if ((Vector3.Distance(everyTarget.transform.position, turretHead.position) &lt; closestMobDistance) || closestMobDistance == 0) { closestMobDistance = Vector3.Distance(everyTarget.transform.position, turretHead.position); //     ,     nearestmob = everyTarget;//    } } return nearestmob; //   } }</span></span></code> </pre><br><br>  Comments, I think, quite clearly describe the code.  The only incomprehensible may seem such a monster as a quaternion.  Do not hesitate, google, read, this topic is not easy for everyone.  And <a href="http://unity3d.com/support/documentation/ScriptReference/Quaternion.html">here</a> you can read about quaternions in Unity3D on their own website. <br><br>  Save the changes and switch back to Unity3D. <br><br>  To "pull" our newly written script on the gun, you need to drag the script file directly to its prefab.  After that, if you click on the gun prefab, a section with our script will appear in the property inspector, where you can customize all the public fields in the code! <br><img src="https://habrastorage.org/storage2/75a/1ee/3ea/75a1ee3ea201671de762352e57de69f9.jpg"><br><br>  Next, to test our code, we need to attach a Monster tag to our monster.  Click on it in the Project, then look at the Inspector of the object: in its upper part there is a drop-down field Tag, now there is the value Untagged.  Click on this list and at the bottom of it click Add tag. <br><img src="https://habrastorage.org/storage2/eee/9ea/6b8/eee9ea6b88da8450bed988c028353778.jpg"><br><br>  Expand the Tags list, and in the Element 0 field we write ‚ÄúMonster‚Äù (without quotes, as in the screenshot). <br><img src="https://habrastorage.org/storage2/390/801/87c/39080187c61c629e867d9e4cfa976274.jpg"><br><br>  Again we click on our monster, again we expand the list of possible tags - Monster will be among them.  Choose it. <br><br><h4>  Novice Mob School </h4><br>  Until now, our mobs were just objects, but now we will teach them to crawl to the cannon and inflict joy, happiness and, above all, damage on it. <br>  In a well-known way, we create new C # scripts: MobAI, GlobalVars, MobHP, TurretHP, SpawnerAI.  Let's start in order: <br><br>  <b>MobAI.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MobAI</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> GameObject Target; <span class="hljs-comment"><span class="hljs-comment">//  public float mobPrice = 5.0f; //    public float mobMinSpeed = 0.5f; //   public float mobMaxSpeed = 2.0f; //   public float mobRotationSpeed = 2.5f; //   public float attackDistance = 5.0f; //  public float damage = 5; //,   public float attackTimer = 0.0f; //     public const float coolDown = 2.0f; //,         private float MobCurrentSpeed; // ,   private Transform mob; //    private GlobalVars gv; //     private void Awake() { gv = GameObject.Find("GlobalVars").GetComponent&lt;GlobalVars&gt;(); //  mob = transform; //     ( ) MobCurrentSpeed = Random.Range(mobMinSpeed, mobMaxSpeed); //         } private void Update() { if (Target == null) //    { Target = SortTargets(); //      } else //     { mob.rotation = Quaternion.Lerp(mob.rotation, Quaternion.LookRotation(new Vector3(Target.transform.position.x, 0.0f, Target.transform.position.z) - new Vector3(mob.position.x, 0.0f, mob.position.z)), mobRotationSpeed); //-,    ! mob.position += mob.forward * MobCurrentSpeed * Time.deltaTime; //  ,    float distance = Vector3.Distance(Target.transform.position, mob.position); //    Vector3 structDirection = (Target.transform.position - mob.position).normalized; //   float attackDirection = Vector3.Dot(structDirection, mob.forward); //   if (distance &lt; attackDistance &amp;&amp; attackDirection &gt; 0) //         { if (attackTimer &gt; 0) attackTimer -= Time.deltaTime; //    0 -   if (attackTimer &lt;= 0) //         { TurretHP thp = Target.GetComponent&lt;TurretHP&gt;(); //     if (thp != null) thp.ChangeHP(-damage); //   ,   (      ,   ) attackTimer = coolDown; //     } } } } //    ,    ! private GameObject SortTargets() { float closestTurretDistance = 0; //       GameObject nearestTurret = null; //    List&lt;GameObject&gt; sortingTurrets = gv.TurretList; //    foreach (var turret in sortingTurrets) //     { //    ,  closestTurretDistance    if ((Vector3.Distance(mob.position, turret.transform.position) &lt; closestTurretDistance) || closestTurretDistance == 0) { closestTurretDistance = Vector3.Distance(mob.position, turret.transform.position); //     ,     nearestTurret = turret;//    } } return nearestTurret; //   } }</span></span></code> </pre><br><br>  <b>GlobalVars.cs</b> - class of global variables <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GlobalVars</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;GameObject&gt; MobList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;GameObject&gt;(); <span class="hljs-comment"><span class="hljs-comment">//    public int MobCount = 0; //    public List&lt;GameObject&gt; TurretList = new List&lt;GameObject&gt;(); //    public int TurretCount = 0; //    public float PlayerMoney = 200.0f; //  }</span></span></code> </pre><br><br>  <b>MobHP.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MobHP</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> maxHP = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  public float curHP = 100; //  public Color MaxDamageColor = Color.red; //   public Color MinDamageColor = Color.blue; //   private GlobalVars gv; //     private void Awake() { gv = GameObject.Find("GlobalVars").GetComponent&lt;GlobalVars&gt;(); //  if (gv != null) { gv.MobList.Add(gameObject); //      gv.MobCount++; //   } if (maxHP &lt; 1) maxHP = 1; //      -   } public void ChangeHP(float adjust) //    { if ((curHP + adjust) &gt; maxHP) curHP = maxHP;//     adjust   ,    -      else curHP += adjust; //   adjust } private void Update() { gameObject.renderer.material.color = Color.Lerp(MaxDamageColor, MinDamageColor, curHP / maxHP); //       .  :  -    ,  - . if (curHP &lt;= 0) //       { MobAI mai = gameObject.GetComponent&lt;MobAI&gt;(); //   AI  if (mai != null &amp;&amp; gv != null) gv.PlayerMoney += mai.mobPrice; //   -          Destroy(gameObject); //  } } private void OnDestroy() //  { if (gv != null) { gv.MobList.Remove(gameObject); //      gv.MobCount--; //     1 } } }</span></span></code> </pre><br><br>  And I did not comment on the next class, it is almost a complete copy of MobHP, with some differences (for example, he doesn‚Äôt have to use his color). <br><br>  <b>TurretHP.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TurretHP</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> maxHP = <span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  public float curHP = 100; //  private GlobalVars gv; //     private void Awake() { gv = GameObject.Find("GlobalVars").GetComponent&lt;GlobalVars&gt;(); //  if (gv != null) { gv.TurretList.Add(gameObject); gv.TurretCount++; } if (maxHP &lt; 1) maxHP = 1; } public void ChangeHP(float adjust) { if ((curHP + adjust) &gt; maxHP) curHP = maxHP; else curHP += adjust; if (curHP &gt; maxHP) curHP = maxHP; } private void Update() { if (curHP &lt;= 0) { Destroy(gameObject); } } private void OnDestroy() { if (gv != null) { gv.TurretList.Remove(gameObject); gv.TurretCount--; } } }</span></span></code> </pre><br><br>  <b>SpawnerAI.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SpawnerAI</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> waveAmount = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   1      public int waveNumber = 0; //   public float waveDelayTimer = 30.0F; //    public float waveCooldown = 20.0F; // (  !)    ,     public int maximumWaves = 500; //     public Transform Mob; //     Unity public GameObject[] SpawnPoints; //   private GlobalVars gv; //     private void Awake() { SpawnPoints = GameObject.FindGameObjectsWithTag("Spawnpoint"); //      gv = GameObject.Find("GlobalVars").GetComponent&lt;GlobalVars&gt;(); //  } private void Update() { if (waveDelayTimer &gt; 0) // h     { if (gv != null) { if (gv.MobCount == 0) waveDelayTimer = 0; //     -     else waveDelayTimer -= Time.deltaTime; //   } } if (waveDelayTimer &lt;= 0) //      { if (SpawnPoints != null &amp;&amp; waveNumber &lt; maximumWaves) //           { foreach (GameObject spawnPoint in SpawnPoints) //    { for (int i = 0; i &lt; waveAmount; i++) // i    ,          { Instantiate(Mob, new Vector3(spawnPoint.transform.position.x, spawnPoint.transform.position.y, spawnPoint.transform.position.z + i * 10), Quaternion.identity); //  } if (waveCooldown &gt; 5.0f) //    5  { waveCooldown -= 0.1f; //  0.1  waveDelayTimer = waveCooldown; //   } else // { waveCooldown = 5.0f; //     5  waveDelayTimer = waveCooldown; } if (waveNumber &gt;= 50) // 50  { waveAmount = 10; //   10     } } waveNumber++; //   } } } }</span></span></code> </pre><br><br>  And now you need to fix the AI ‚Äã‚Äãcode of the gun.  Find the switch (FiringOrder) there and replace the entire block completely with this: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (FiringOrder) <span class="hljs-comment"><span class="hljs-comment">//,     { case 1: if (mhp != null) mhp.ChangeHP(-attackDamage); //   FiringOrder++; // FiringOrder  1 break; case 2: if (mhp != null) mhp.ChangeHP(-attackDamage); //   FiringOrder = 1; // FiringOrder    break; }</span></span></code> </pre><br><br>  It is also necessary to replace the line at the very end of the same class. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> nearestmob;</code> </pre><br><br>  on such <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> closestMobDistance &gt; attackMaximumDistance ? <span class="hljs-literal"><span class="hljs-literal">null</span></span> : nearestmob;</code> </pre><br><br>  This is called the "ternary operator."  If the condition is before the "?"  true, it will return null, otherwise the nearestmob will return.  The meaning of the expression is that the gun will not grasp the target to which it cannot reach. <br><br>  In general, the code is ready.  Now you need to prepare game objects.  Create a MobSpawner object, its location does not matter, if only it does not interfere further.  Hang the SpawnerAI script on it and set the desired variable values.  On the value of the variable Mob we overtighten our prefab mob. <br><img src="https://habrastorage.org/storage2/ead/567/665/ead56766596d3cc770c11e59bbe30b4b.jpg"><br>  Spawn more do not touch. <br><br>  Create an object with the name GlobalVars and drag the script with the same name onto it, specify the starting amount of money from the player. <br>  Next, create the required number of objects (for convenience, call it in the spirit of "name_orderNumber") for spawn points and place them in the desired locations of the spawn mobs.  Assign a Spawnpoint tag to them, and at the same time create a Turret tag and assign it to the gun prefab. <br><br>  Hang our 2 MobAI and MobHP scripts on your mobs, and TurretHP on your guns.  Do not forget to play around with the values ‚Äã‚Äãof variables. <br>  You do not need to drag the prefab of the gun to the target value in MobAI, AI itself searches for targets.  Very primitive, slow, but looking. <br><br>  Add the Rigidbody component to the monster prefab (Component -&gt; Physics -&gt; Rigidbody). <br><br><img src="https://habrastorage.org/storage2/4e8/8f4/e6a/4e88f4e6a004c696decda7ada02e2bb3.jpg"><br><br><h4>  Getting started? </h4><br>  To create a GUI, we need a new C # script called Graphic: <br><br>  <b>Graphic.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Graphic</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> GlobalVars gv; <span class="hljs-comment"><span class="hljs-comment">//     public Rect buyMenu; //   public Rect firstTower; //     public Rect secondTower; //     public Rect thirdTower; //     public Rect fourthTower; //     public Rect fifthTower; //     public Rect towerMenu; //    (/) public Rect towerMenuSellTower; //    public Rect towerMenuUpgradeTower; //    public Rect playerStats; //   public Rect playerStatsPlayerMoney; //     public GameObject plasmaTower; //  ,     public GameObject plasmaTowerGhost; //  ,     private RaycastHit hit; //   public LayerMask raycastLayers = 1; //    / - ,    private GameObject ghost; //     private void Awake() { gv = GameObject.Find("GlobalVars").GetComponent&lt;GlobalVars&gt;(); //  if (gv == null) Debug.LogWarning("gv variable is not initialized correctly in " + this); //  ,  gv  buyMenu = new Rect(Screen.width - 185.0f, 10.0f, 175.0f, Screen.height - 100.0f); //  ,   X, Y, , . X  Y       firstTower = new Rect(buyMenu.x + 12.5f, buyMenu.y + 30.0f, 150.0f, 50.0f); secondTower = new Rect(firstTower.x, buyMenu.y + 90.0f, 150.0f, 50.0f); thirdTower = new Rect(firstTower.x, buyMenu.y + 150.0f, 150.0f, 50.0f); fourthTower = new Rect(firstTower.x, buyMenu.y + 210.0f, 150.0f, 50.0f); fifthTower = new Rect(firstTower.x, buyMenu.y + 270.0f, 150.0f, 50.0f); playerStats = new Rect(10.0f, 10.0f, 150.0f, 100.0f); playerStatsPlayerMoney = new Rect(playerStats.x + 12.5f, playerStats.y + 30.0f, 125.0f, 25.0f); towerMenu = new Rect(10.0f, Screen.height - 60.0f, 400.0f, 50.0f); towerMenuSellTower = new Rect(towerMenu.x + 12.5f, towerMenu.y + 20.0f, 75.0f, 25.0f); towerMenuUpgradeTower = new Rect(towerMenuSellTower.x + 5.0f + towerMenuSellTower.width, towerMenuSellTower.y, 75.0f, 25.0f); } private void Update() { switch (gv.mau5tate) //    { case GlobalVars.ClickState.Placing: //      { if (ghost == null) ghost = Instantiate(plasmaTowerGhost) as GameObject; //    -       else // { Ray scrRay = Camera.main.ScreenPointToRay(Input.mousePosition); // ,         if (Physics.Raycast(scrRay, out hit, Mathf.Infinity, raycastLayers)) //        (..  ) { Quaternion normana = Quaternion.FromToRotation(Vector3.up, hit.normal); //    ghost.transform.position = hit.point; //          ghost.transform.rotation = normana; //    ,    ,    if (Input.GetMouseButtonDown(0)) //   { GameObject tower = Instantiate(plasmaTower, ghost.transform.position, ghost.transform.rotation) as GameObject; //     if (tower != null) gv.PlayerMoney -= tower.GetComponent&lt;PlasmaTurretAI&gt;().towerPrice; //    Destroy(ghost); //   gv.mau5tate = GlobalVars.ClickState.Default; //      } } } break; } } } private void OnGUI() { GUI.Box(buyMenu, "Buying menu"); //     buyMenu  ,   "" if (GUI.Button(firstTower, "Plasma Tower\n100$")) //      { gv.mau5tate = GlobalVars.ClickState.Placing; //    } if (GUI.Button(secondTower, "Pulse Tower\n155$")) //   { //action here } if (GUI.Button(thirdTower, "Beam Tower\n250$")) { //action here } if (GUI.Button(fourthTower, "Tesla Tower\n375$")) { //action here } if (GUI.Button(fifthTower, "Artillery Tower\n500$")) { //action here } GUI.Box(playerStats, "Player Stats"); GUI.Label(playerStatsPlayerMoney, "Money: " + gv.PlayerMoney + "$"); GUI.Box(towerMenu, "Tower menu"); if (GUI.Button(towerMenuSellTower, "Sell")) { //action here } if (GUI.Button(towerMenuUpgradeTower, "Upgrade")) { //action here } } }</span></span></code> </pre><br><br>  Oh yeah, now we still need a good change to the GlobalVars script: <br><br>  <b>GlobalVars.cs</b> <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections.Generic; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GlobalVars</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;GameObject&gt; MobList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;GameObject&gt;(); <span class="hljs-comment"><span class="hljs-comment">//    public int MobCount = 0; //    public List&lt;GameObject&gt; TurretList = new List&lt;GameObject&gt;(); //    public int TurretCount = 0; //    public float PlayerMoney; //  public ClickState mau5tate = ClickState.Default; //   public enum ClickState //    { Default, Placing, Selling, Upgrading } public void Awake() { PlayerMoney = PlayerPrefs.GetFloat("Player Money", 200.0f); //  ,        -   200$,     } public void OnApplicationQuit() { PlayerPrefs.SetFloat("Player Money", PlayerMoney); //     PlayerPrefs.Save(); } }</span></span></code> </pre><br><br>  Next, we need to create a ghost cannon, and this is done quite easily: we duplicate the cannon, throw some empty GO into it, delete it and untie the gun from its prefab, the main thing is not to save it!  Then we go through the entire hierarchy of objects inside the gun and change the shaders to Transparent Diffuse.  By the way, to see absolutely the whole structure of the gun - it is necessary to put it on the scene and reveal the hierarchy already there.  <s>If there are problems with the creation of a ghost - lay out already ready.</s>  Some people still have a link to the package download <a href="https://ionpri.me/td/tower_ghost.unitypackage">here</a> (3.7 mb). <br><br>  Theoretically should work.  Of course, there are jambs and the most obvious of them is the need to write the code of the mechanism for spawn guns for each state - this is corrected by creating your own method with overloads in the form of states and parsing them within the method, but this is already code optimization that needs to be dealt with immediately because the thoughtful code makes it easy to rule yourself under sudden ideas. <br><br>  And although this part of the lesson is not very long, but the most important in the implementation and understanding of the basic mechanisms of the game. <br><br>  And if everything worked out right for you, it would look something like this: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/529lXz8Rn_w" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  To be continued! <br><br>  <b>07/26/2012</b> : I fixed the errors in the code <br>  <b>05/14/2018</b> : I fixed the broken links </div><p>Source: <a href="https://habr.com/ru/post/148410/">https://habr.com/ru/post/148410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148403/index.html">SOAP Web service using Spring-WS</a></li>
<li><a href="../148404/index.html">A simple bookmarklet as a tool to clean webpage content from unwanted items.</a></li>
<li><a href="../148406/index.html">New standoff between WHATWG and W3C: in whose hands is the future of HTML5?</a></li>
<li><a href="../148407/index.html">PyBrain work with neural networks in Python</a></li>
<li><a href="../148409/index.html">OS X, Dual Stack and VK API problem</a></li>
<li><a href="../148411/index.html">System approach to requirements management</a></li>
<li><a href="../148413/index.html">CRIU - an ambitious new project to preserve and restore the state of processes</a></li>
<li><a href="../148415/index.html">IOS Application Testing Systems</a></li>
<li><a href="../148416/index.html">JScriptInclude Gear v 0.1.0 is a mechanism for cascading import of scripts / libraries. (Revenge)</a></li>
<li><a href="../148417/index.html">Google Earth Engine - a platform for monitoring the state of the Earth</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>