<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Part 2. Creating classes, mappings and filling database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="CLASSES AND MAPPINGS 

 Lessons in FluentNHibernate c ASP.NET MVC and SQL Server. Part 1 
 Part 3. Displaying data from a table (Operation LIST) 

 In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Part 2. Creating classes, mappings and filling database</h1><div class="post__text post__text-html js-mediator-article">  <b>CLASSES AND MAPPINGS</b> <br><br>  <a href="http://habrahabr.ru/post/264907/"><i>Lessons in FluentNHibernate c ASP.NET MVC and SQL Server.</i></a>  <a href="http://habrahabr.ru/post/264907/"><i>Part 1</i></a> <br>  <a href="http://habrahabr.ru/users/qsandrew/topics/">Part 3. Displaying data from a table (Operation LIST)</a> <br><br>  In the previous part, the types of relationships were considered (one-to-one, one-to-many, many-to-many), as well as one class Book and its mapping class BookMap.  In the second part, we will update the Book class, create the other classes and links between them, as was shown in the previous chapter in the Database Chart located above the subtitle 1.3.1 Links. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Code of classes and mappings (With comments)</b> <div class="spoiler_text">  <b>Class Book</b> <br><br><pre><code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Book { //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> MfRaiting { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> PageNumber { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string Image { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   (  !) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual DateTime IncomeDate { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // (--) // ISet   IList?    (IList)     <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span> ,        <span class="hljs-keyword"><span class="hljs-keyword">JOIN</span></span>,       ISet <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual ISet&lt;Genre&gt; Genres { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // (--) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual Series Series { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   (--) private Mind _mind; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual Mind Mind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _mind ?? (_mind = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Mind()); } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _mind = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } // (--) <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual ISet&lt;Author&gt; Authors { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // ,   <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>  . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Book() { //  (       --  ,     ,   ) Genres = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashSet&lt;Genre&gt;(); Authors = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashSet&lt;Author&gt;(); } } //  Book <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> BookMap : ClassMap&lt;Book&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> BookMap() { Id(x =&gt; x.Id); Map(x =&gt; x.Name); Map(x =&gt; x.Description); Map(x =&gt; x.MfRaiting); Map(x =&gt; x.PageNumber); Map(x =&gt; x.Image); Map(x =&gt; x.IncomeDate); // -- HasManyToMany(x =&gt; x.Genres) //  <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> -   ,   ,   ////    .<span class="hljs-keyword"><span class="hljs-keyword">Cascade</span></span>.SaveUpdate() //         Genre! .<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>("Book_Genre"); HasManyToMany(x =&gt; x.Authors) .<span class="hljs-keyword"><span class="hljs-keyword">Cascade</span></span>.SaveUpdate() .<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>("Book_Author"); //    <span class="hljs-keyword"><span class="hljs-keyword">References</span></span>(x =&gt; x.Series); // --.  . HasOne(x =&gt; x.Mind).<span class="hljs-keyword"><span class="hljs-keyword">Cascade</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">All</span></span>().Constrained(); } }</code> </pre> <br><br>  <b>Class Author</b> <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Author { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //- <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string Biography { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual ISet&lt;Book&gt; Books { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Author() { Books=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashSet&lt;Book&gt;(); } } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> AuthorMap : ClassMap&lt;Author&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> AuthorMap() { Id(x =&gt; x.Id); Map(x =&gt; x.Name); Map(x =&gt; x.Biography); // -- HasManyToMany(x =&gt; x.Books) //  <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> -   ,   ,   //    .<span class="hljs-keyword"><span class="hljs-keyword">Cascade</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">All</span></span>() //  .    (Book)     . .Inverse() //         Book! .<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>("Book_Author"); } }</code> </pre><br><br>  <b>Class Genre</b> <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Genre { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string EngName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual ISet&lt;Book&gt; Books { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Genre() { Books=<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HashSet&lt;Book&gt;(); } } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> GenreMap : ClassMap&lt;Genre&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> GenreMap() { Id(x =&gt; x.Id); Map(x =&gt; x.Name); Map(x =&gt; x.EngName); // -- HasManyToMany(x =&gt; x.Books) //  <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> -   ,   ,   //    .<span class="hljs-keyword"><span class="hljs-keyword">Cascade</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">All</span></span>() //  .    (Book)     . .Inverse() //         Book! .<span class="hljs-keyword"><span class="hljs-keyword">Table</span></span>("Book_Genre"); } }</code> </pre><br><br>  <b>Class Opinion:</b> <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Mind { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string MyMind { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string MindFantLab { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual Book Book { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } // ind <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MindMap:ClassMap&lt;Mind&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> MindMap() { Id(x =&gt; x.Id); Map(x =&gt; x.MyMind); Map(x =&gt; x.MindFantLab); //    HasOne(x =&gt; x.Book); } }</code> </pre><br><br>  <b>Class Cycle (Series):</b> <br><br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Series { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  IList,   ISet,    Book, Series      ,     ISet <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual IList&lt;Book&gt; Books { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // . <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Series() { Books = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> List&lt;Book&gt;(); } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> SeriesMap : ClassMap&lt;Series&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> SeriesMap() { Id(x =&gt; x.Id); Map(x =&gt; x.Name); // -- HasMany(x =&gt; x.Books) ////  .    (Book)     . .Inverse() } }</code> </pre><br></div></div><br><br>  <b>Little explanation</b> <br>  <i>public virtual ISet &lt;Genre&gt; Genres {get;</i>  <i>set;</i>  <i>}</i> <i><br></i>  <i>public virtual ISet &lt;Author&gt; Authors {get;</i>  <i>set;</i>  <i>}</i> <br><br>  Why ISet &lt;Class&gt;, and not, for example, familiar to many IList &lt;Class&gt;?  If you use IList instead of ISet, and try to start the project, we will not notice any special differences (Tables and classes will be created).  But when we both have the Genre table and the Authors table for the Book class LeftJoin, and we are still trying to derive non-repeating entries from the Book (Distinct Book.Id) table into the View, Nhibernate throws an exception and an error. <br>  <i>Cannot simultaneously fetch multiple bags.</i> <br>  In such cases, we use ISet, especially the sets for this purpose are intended (ignore duplicate entries). <br><br>  <b>Attitude many-to-many.</b> <br><br><table><tbody><tr><th>  Book </th><th>  Author </th></tr><tr><td>  HasManyToMany (x =&gt; x.Genres) <br>  .Cascade.SaveUpdate () <br>  .Table ("Book_Author"); <br></td><td>  HasManyToMany (x =&gt; x.Books) <br>  .Cascade.All () <br>  .Inverse () <br>  .Table ("Book_Author"); <br></td></tr></tbody></table><br>  In NHibernate there is a concept, the "main" table.  Although the many-to-many relationships between the ‚ÄúBook‚Äù and ‚ÄúAuthor‚Äù tables are equivalent (The author may have many books, the book may have many authors), Nhibernate requires the programmer to specify a table that is saved second (has a method. inverse ()), that is, the entry in the Book table will be created / updated / deleted first, and only then in the Author table. <br>  Cascade.All means performing cascading operations with save-update and delete.  That is, when an object is saved, updated, or deleted, all dependent objects are checked and created / updated / added (Ps. You can add Cascade.All -&gt; .Cascade.SaveUpdate (). Cascade.Delete ()) <br>  Method .Table ("Book_Author");  creates an ‚Äúintermediate‚Äù table ‚ÄúBook_Author‚Äù in the database. <br><br>  <b>A many-to-one, one-to-many relationship.</b> <br><table><tbody><tr><th>  Book </th><th>  Series </th></tr><tr><td>  References (x =&gt; x.Series) .Cascade.SaveUpdate (); <br></td><td>  HasMany (x =&gt; x.Books) <br>  .Inverse (); <br></td></tr></tbody></table><br>  The References method is applied on the many-to-one side, on the other side, the one-to-many method is HasMany. <br><br>  <b>One-to-one relationship</b> <br><table><tbody><tr><th>  Book </th><th>  Mind </th></tr><tr><td>  HasOne (x =&gt; x.Mind) .Cascade.All (). Constrained (); <br></td><td>  HasOne (x =&gt; x.Book); <br></td></tr></tbody></table><br>  The .Constrained () method tells NHibernate that a record from the Mind table must match the record from the Book table (the Mind table id must be equal to the Book table id) <br><br>  If you start the project now and see the Bibilioteca database, new tables with already formed links will appear. <br><img src="https://habrastorage.org/files/75b/cb7/ab2/75bcb7ab243e4cc985f3319133bf415a.png"><br>  Next, fill in the created table data ... <br>  To do this, we will create a test application that will save the data in the database, update and delete it, changing the HomeController as follows (Comment on the unnecessary parts of the code): <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ISession session = NHibernateHelper.OpenSession()) { <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ITransaction transaction = session.BeginTransaction()) { <span class="hljs-comment"><span class="hljs-comment">//,  var createBook = new Book(); createBook.Name = "Metro2033"; createBook.Description = " "; createBook.Authors.Add(new Author { Name = "" }); createBook.Genres.Add(new Genre { Name = " " }); createBook.Series = new Series { Name = "" }; createBook.Mind = new Mind { MyMind = " " }; session.SaveOrUpdate(createBook); // ( ) //var series = session.Get&lt;Series&gt;(1); //var updateBook = session.Get&lt;Book&gt;(1); //updateBook.Name = "Metro2034"; //updateBook.Description = ""; //updateBook.Authors.ElementAt(0).Name = ""; //updateBook.Genres.ElementAt(0).Name = ""; //updateBook.Series = series; //updateBook.Mind.MyMind = "11111"; //session.SaveOrUpdate(updateBook); // ( ) //var deleteBook = session.Get&lt;Book&gt;(1); //session.Delete(deleteBook); transaction.Commit(); } Genre genreAl = null; Author authorAl = null; Series seriesAl = null; Mind mindAl = null; var books = session.QueryOver&lt;Book&gt;() //Left Join   Genres .JoinAlias(p =&gt; p.Genres, () =&gt; genreAl, JoinType.LeftOuterJoin) .JoinAlias(p =&gt; p.Authors, () =&gt; authorAl, JoinType.LeftOuterJoin) .JoinAlias(p =&gt; p.Series, () =&gt; seriesAl, JoinType.LeftOuterJoin) .JoinAlias(p =&gt; p.Mind, () =&gt; mindAl, JoinType.LeftOuterJoin) //  id   Book. .TransformUsing(Transformers.DistinctRootEntity).List(); return View(books); } }</span></span></code> </pre><br><br>  <b>Little explanation</b> <br><ol><li>  <i>var books = session.QueryOver &lt;Book&gt; ()</i> is similar to running the SQL script: <i>Select * From Book</i> ; </li><li>  <i>.JoinAlias ‚Äã‚Äã(p =&gt; p.Genres, () =&gt; genreAl, JoinType.LeftOuterJoin)</i> is similar to running the SQL script: <br>  <i>SELECT * FROM Book</i> <i><br></i>  <i>inner JOIN Book_Genre ON book.id = Book_Genre.Book_id</i> <i><br></i>  <i>LEFT JOIN Genre ON Book_Genre.Genre_id = Genre.id</i> </li><li>  <i>.TransformUsing (Transformers.DistinctRootEntity)</i> - Like executing the SQL script: <i>SELECT distinct Book.Id ...</i> , (removes duplicate entries with the same id) </li></ol><br><br>  <b>Types of associations</b> <br>  <i>.JoinAlias ‚Äã‚Äã(p =&gt; p.Genres, () =&gt; genreAl, JoinType.LeftOuterJoin)</i> <br><ol><li>  LeftOuterJoin - selects all entries from the left table ( <b>Book</b> ), and then appends to them the entries of the right table ( <b>Genre</b> ).  If the corresponding entry in the right table is not found, displays it as Null. </li><li>  RightOuterJoin acts as opposed to LEFT JOIN - selects all the entries from the right table ( <b>Genre</b> ), and then appends the left table entries to them ( <b>Book</b> ) </li><li>  InnerJoin - selects only those records from the left table ( <b>Book</b> ) which has a corresponding record from the right table ( <b>Genre</b> ), and then appends to them records from the right table </li></ol><br><br>  Change the view as follows: <br><div class="spoiler">  <b class="spoiler_title">Index view</b> <div class="spoiler_text"><pre> <code class="html hljs xml">@model IEnumerable<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">NhibernateMVC.Models.Book</span></span></span><span class="hljs-tag">&gt;</span></span> @{ Layout = null; } <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"viewport"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">content</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"width=device-width"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Index<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span><span class="css"><span class="css"> </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">th</span></span></span><span class="css">, </span><span class="hljs-selector-tag"><span class="css"><span class="hljs-selector-tag">td</span></span></span><span class="css"> { </span><span class="hljs-attribute"><span class="css"><span class="hljs-attribute">border</span></span></span><span class="css">: </span><span class="hljs-number"><span class="css"><span class="hljs-number">1px</span></span></span><span class="css"> solid; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">style</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.ActionLink("Create New", "Create")<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Name)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Mind)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Series)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Authors)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayNameFor(model =&gt; model.Genres)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; item.Name)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; item.Mind.MyMind)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @{string strSeries = item.Series != null ? item.Series.Name : null;} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span>@Html.DisplayFor(modelItem =&gt; strSeries)<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var author in item.Authors) { string strAuthor = author != null ? author.Name : null; @Html.DisplayFor(modelItem =&gt; strAuthor) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var genre in item.Genres) { string strGenre = genre!= null ? genre.Name : null; @Html.DisplayFor(modelItem =&gt; strGenre) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.ActionLink("Edit", "Edit", new { id = item.Id }) | @Html.ActionLink("Details", "Details", new { id = item.Id }) | @Html.ActionLink("Delete", "Delete", new { id = item.Id }) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  After checking all the operations one by one, we note that: <br><ul><li>  During the Create and Update operations, all data associated with the Book table is updated (remove Cascade = "save-update" or cascade = "all" and the associated data will not be saved) </li><li>  When deleting, data is deleted from the tables Book, Mind, Book_Author, and the rest of the data is not deleted, because they have Cascade = "save-update" </li><li>  When deleting, data is deleted from the tables Book, Mind, Book_Author, and the rest of the data is not deleted, because they have Cascade = "save-update" </li></ul><br><br>  <b>Mapping for classes that have inheritance.</b> <br>  And how mappit classes that have inheritance?  Suppose we have the following example: <br><pre> <code class="hljs pgsql"> //   <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TwoDShape { // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Width { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } // <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Height { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Triangle : TwoDShape { //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual <span class="hljs-type"><span class="hljs-type">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> virtual string Style { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br><br>  In principle, there is nothing difficult in this mapping, we simply create one mapping for the derived class, that is, the Triangle table. <br><pre> <code class="hljs pgsql"> //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> TriangleMap : ClassMap&lt;Triangle&gt; { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> TriangleMap() { Id(x =&gt; x.Id); Map(x =&gt; x.Style); Map(x =&gt; x.Height); Map(x =&gt; x.Width); } }</code> </pre><br>  After starting the application, the following (empty) table will appear in the Biblioteca database <br><img src="https://habrastorage.org/files/f39/540/21a/f3954021af9d4fc7b172d6fcc939564f.png"></div><p>Source: <a href="https://habr.com/ru/post/264961/">https://habr.com/ru/post/264961/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264943/index.html">Introducing Hub 1.0 - a connector for command products JetBrains</a></li>
<li><a href="../264947/index.html">Breaking down resource compression in Might and Magic III</a></li>
<li><a href="../264949/index.html">SMS from Bash or teach Zabbix new tricks</a></li>
<li><a href="../264953/index.html">New WiFi equipment from Ruckus Wireless. New: access points, controllers and functionality</a></li>
<li><a href="../264955/index.html">Joker 2015: News 1-18 August 2015 - new speakers and reports</a></li>
<li><a href="../264963/index.html">Object language restrictions (and a little about the meta model)</a></li>
<li><a href="../264965/index.html">The right bonus for your new server - Part 2</a></li>
<li><a href="../264967/index.html">How-to: Techniques for creating interactive emails using CSS</a></li>
<li><a href="../264969/index.html">My view on yii 2 configuration files</a></li>
<li><a href="../264973/index.html">A look at Angry Birds 2, Niki Minaj and Jason Statham as new stars of Glu, the rise in price of a loyal user - and other news of the week for a mobile developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>