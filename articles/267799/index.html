<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New PHP, Part 2: Scalar types</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In our previous article, we talked about the benefits of the PHP 7 type system, and in particular, about the new support for typed return values. That...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New PHP, Part 2: Scalar types</h1><div class="post__text post__text-html js-mediator-article"><a href="http://habrahabr.ru/post/267799/"><img align="left" src="https://habrastorage.org/files/0c0/7fe/7f5/0c07fe7f5b294fecb66c428fca14b406.jpg"></a> <br>  In our <a href="http://habrahabr.ru/post/267257/">previous article,</a> we talked about the benefits of the PHP 7 type system, and in particular, about the new support for typed return values.  That in itself is not only a great help in supporting the code, but it is a big step forward for PHP. <br><br>  So far we have talked about types only with respect to classes and interfaces.  For years, we only could use them (and arrays).  However, PHP 7 adds the ability to use scalar values ‚Äã‚Äãtoo, such as <code>int</code> , <code>string</code> and <code>float</code> . <br><br>  But wait.  In PHP, most primitives are interchangeable.  We can pass <code>"123"</code> to a function that wants an <code>int</code> , and trust PHP, which will do everything ‚Äúright‚Äù.  So why then do we need scalar types? <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As well as return types, scalars increase the clarity of the code, make it possible to catch more errors at an early stage.  That, in turn, increases the reliability of the code. <br><br>  PHP 7 adds four new types that can be specified by parameters or return values: <code>int</code> , <code>float</code> , <code>string</code> and <code>bool</code> .  They will join already existing <code>array</code> , <code>callable</code> , classes, and interfaces.  Let's complete our previous example with the new feature: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStreet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span></span>; }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmptyAddress</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStreet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Address</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AddressInterface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $street; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $city; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $state; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $zip; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string $street, string $city, string $state, string $zip)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;street = $street;   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;city = $city;   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;state = $state;   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;zip = $zip; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStreet</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;street; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;city; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;state; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getZip</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">string</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;zip; } }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Employee</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $address; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $id, AddressInterface $address)</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id = $id;   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;address = $address; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAddress</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddressInterface</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;address; } }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $data = []; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-number"><span class="hljs-number">123</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Address(<span class="hljs-string"><span class="hljs-string">'123 Main St.'</span></span>, <span class="hljs-string"><span class="hljs-string">'Chicago'</span></span>, <span class="hljs-string"><span class="hljs-string">'IL'</span></span>, <span class="hljs-string"><span class="hljs-string">'60614'</span></span>));   <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[<span class="hljs-number"><span class="hljs-number">456</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(<span class="hljs-number"><span class="hljs-number">456</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Address(<span class="hljs-string"><span class="hljs-string">'45 Hull St'</span></span>, <span class="hljs-string"><span class="hljs-string">'Boston'</span></span>, <span class="hljs-string"><span class="hljs-string">'MA'</span></span>, <span class="hljs-string"><span class="hljs-string">'02113'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $id)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Employee</span></span></span><span class="hljs-function"> </span></span>{   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[$id])) {     <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidArgumentException(<span class="hljs-string"><span class="hljs-string">'No such Employee: '</span></span> . $id);   }   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;data[$id]; } }</code> </pre><br><pre> <code class="php hljs">$r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmployeeRepository(); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $r-&gt;findById(<span class="hljs-number"><span class="hljs-number">123</span></span>)-&gt;getAddress()-&gt;getStreet() . PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $r-&gt;findById(<span class="hljs-number"><span class="hljs-number">789</span></span>)-&gt;getAddress()-&gt;getStreet() . PHP_EOL; } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InvalidArgumentException $e) { <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> $e-&gt;getMessage() . PHP_EOL; }</code> </pre><br>  The changes affected some methods that give a string or number.  Even taking such a simple step, we have already received some advantages. <br><br><ol><li>  It is now known that the various fields of the <code>Address</code> class are just strings.  Previously, one could only assume that they were lines, not <code>Street</code> objects (consisting of the street number, its name and apartment number) or the city ID from the database.  Of course, both of these things are perfectly reasonable in certain circumstances, but they are not considered in this article. </li><li>  Employee IDs are known to be integers.  In many companies, an employee ID is an alphanumeric string or perhaps a leading zero.  Previously, there was no way to know, but now other interpretations are excluded. </li><li>  Security is also a plus.  We are guaranteed to know that inside <code>findById()</code> <code>$id</code> is a value of type <code>int</code> .  Even if it originally came from user input, it will become integer.  This means that it cannot contain, for example, SQL injections.  Reliance on type checking when working with user input is not the only or even the best defense against attack, but another layer of protection. </li></ol><br>  It seems that the first two benefits are redundant in the presence of documentation.  If you have good doc blocks in the code, you already know that <code>Address</code> consists of strings and the employee ID is integer, right?  It's true;  However, not everyone adheres to fanaticism in the matter of documenting their code, or simply forget to update it.  With the "active" information from the language itself, you are guaranteed to know that there is no desynchronization, because PHP will throw an exception if it is not. <br><br>  Explicit type specification also opens the door to more powerful tools.  Programs - either PHP itself or third-party analysis tools - can study the source code, finding possible errors or optimization possibilities based on the information received. <br><br>  For example, we can check that the following code is incorrect and will always fall, even without starting it: <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $id)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">User</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> User($id); }</code> </pre><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findPostsForUser</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $uid)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Obviously something more robust. return [new Post(), new Post()]; }</span></span></code> </pre><br><pre> <code class="php hljs">$u = loadUser(<span class="hljs-number"><span class="hljs-number">123</span></span>); $posts = findPostsForUser($u);</code> </pre><br>  <code>loadUser()</code> always returns an object of type <code>User</code> , and <code>findPostsForUser()</code> always returns an integer, there is no way to make this code true.  This can be said only by looking at the functions and how to use them.  And this, in turn, means that the IDE also knows in advance and can warn us about an error before launch.  And since the IDE can track a lot more parts than we do, it can also warn of more errors than you can see for yourself ... without executing the code! <br><br>  This process is called ‚Äústatic analysis,‚Äù and it is an incredibly powerful way to evaluate programs to find and fix errors.  This is slightly hampered by the standard weak PHP typing.  Passing an integer to a function that expects a string, or a string to a function that expects an integer, it all continues to work and PHP silently converts the primitives to each other, as well as always.  What makes static analysis, by us or with the help of utilities, less useful. <br><br>  The introduction of strong typing is the cornerstone of the new PHP 7 type system. <br><br>  By default, when working with scalar types (parameters or return values), PHP will do everything possible to bring the value to the expected.  That is, passing an <code>int</code> to a function that expects a <code>string</code> will work fine, and passing <code>bool</code> at the expected <code>int</code> you will get an integer number 0 or 1, because this is natural behavior expected from the language.  For an object passed to a function that is expecting a <code>string</code> , <code>__toString()</code> will be called, the same will happen with the returned values. <br><br>  The only exception is passing a string to the expected <code>int</code> or <code>float</code> .  Traditionally, when a function expects to get <code>int</code> / <code>float</code> values, and a <code>string</code> is passed, PHP will simply truncate the string to the first non-numeric character, resulting in possible data loss.  In the case of scalar types, the parameter will work fine if the string is indeed numeric, but if the value is truncated, this will result in a call to <code>E_NOTICE</code> .  Everything will work, but at the moment this situation is considered as a minor error in the condition. <br><br>  Auto-conversion makes sense in cases where almost all input data is transmitted as strings (from a database or http requests), but at the same time it limits the usefulness of type checking.  Just for this, PHP 7 offers <code>strict_types</code> mode.  Its use is somewhat subtle and not obvious, but with proper understanding the developer gets an incredibly powerful tool. <br><br>  To enable strong typing, add the declaration to the beginning of the file, like this: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br>  This declaration must be the first line in the file, before executing any code.  It affects only the logic located in the file and only the <i>calls and return values</i> in this file.  To understand how <code>strict_types</code> works, let's split our code into several separate files and <code>strict_types</code> it a bit: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// EmployeeRespository.php class EmployeeRepository { private $data = []; public function __construct() {   $this-&gt;data[123] = new Employee(123, new Address('123 Main St.', 'Chicago', 'IL', '60614'));   $this-&gt;data[456] = new Employee(456, new Address('45 Hull St', 'Boston', 'MA', 02113)); } public function findById(int $id) : Employee {   if (!isset($this-&gt;data[$id])) {     throw new InvalidArgumentException('No such Employee: ' . $id);   }   return $this-&gt;data[$id]; } }</span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">// index.php $r = new EmployeeRepository(); try { $employee_id = get_from_request_query('employee_id'); print $r-&gt;findById($employee_id)-&gt;getAddress()-&gt;getStreet() . PHP_EOL; } catch (InvalidArgumentException $e) { print $e-&gt;getMessage() . PHP_EOL; }</span></span></code> </pre><br>  What can be guaranteed?  Most importantly, we probably know that <code>$id</code> inside <code>findById()</code> is an <code>int</code> , not a string.  No matter what <code>$employee_id</code> will be, <code>$id</code> will always take an <code>int</code> type, even if <code>E_NOTICE</code> is thrown.  If we add the <code>strict_type</code> declaration to <code>EmployeeRepository.php</code> , nothing will happen.  We will also all have an <code>int</code> inside <code>findById()</code> . <br><br>  However, if you declare the use of strong typing in <code>index.php</code> , and then use the <code>findById()</code> call, if <code>$employee_id</code> is a string, or a <code>float</code> or something other than <code>int</code> , this will result in a <code>TypeError</code> . <br><br>  In other words, methods and functions will be affected by strong typing <b>only</b> if they are called in the appropriately declared file.  Code in any other part of the project will not be hurt.  The desire of library developers to follow the principle of strong typing will not affect your code, only them. <br><br>  So what's so good about it?  An astute reader may notice that I made a very cunning bug in the last code example.  Check the <code>EntityRespository</code> constructor where we create our fake data.  The second entry sends the ZIP code as an int, not a string.  Most of the time it will not matter.  However, in the US, postal codes in the northeast begin with the leading zero.  If your <code>int</code> starts with a leading zero, PHP will interpret this as an octal number, that is, a number with a base of 8. <br><br>  With weak typing, this means that in Boston the address will not be interpreted as a zip-code 02113, but as an integer number 02113, which in base 10 will be: 1099, that's what PHP will translate into the postcode 1099.  Believe me, the people of Boston hate it.  Such an error can eventually be caught somewhere in the database or during validation, when the code will force you to enter exactly a six-digit number, but at that moment you will have no idea where 1099 came from. Maybe later, after 8 debugs, it will be clear. <br><br>  Instead, we will switch <code>EntityRespository.php</code> to strict mode and immediately catch the type mismatch.  If we run the code, we get quite specific errors that will tell us the exact lines where to find them.  And good utilities (or IDE) can catch them even before launch! <br><br>  The only place where the strict typing mode allows automatic conversions is from <code>int</code> to <code>float</code> .  This is safe (except for extremely large or small values ‚Äã‚Äãwhen there are consequences of overflow) and logical, since this <code>int</code> by definition also a floating-point value. <br><br>  When should we use strong typing?  My answer is simple: as often as possible.  Scalar typing, return types, and strict-mode offer tremendous advantages for debugging and code support.  All of them should be used as much as possible, and as a result, there will be more reliable, supported and bug-free code. <br><br>  An exception to this rule may be code that interacts directly with the input channel, such as databases or incoming http requests.  In these cases, the input data is always going to be strings, because browsing the Internet is just a more elaborate way to concatenate strings.  When manually working with http or DB, you can transfer data from strings to the necessary types, but usually this results in a large amount of unnecessary work;  if the SQL field is of type <code>int</code> , then you know (even if you don‚Äôt know the IDE) that a numeric string will always be returned from it and, therefore, you can be sure that there is no data loss when passing them to a function that expects an <code>int</code> . <br><br>  This means that in our example, <code>EmployeeRespository</code> , <code>Employee</code> , <code>Address</code> , <code>AddressInterface</code> and <code>EmptyAddress</code> should have strict mode enabled.  <code>index.php</code> , on the <code>get_from_request_query()</code> , interacts with incoming requests (via a call to <code>get_from_request_query()</code> ), and thus it will probably be easier for PHP to deal with types rather than manually manually.  As soon as the undefined values ‚Äã‚Äãfrom the request are passed to the typed function, then it is possible to switch to the strictly typed work. <br><br>  Let's hope that the transition to PHP 7 will be much faster than it was with PHP 5. It is really worth it.  One of the main reasons is the expanded type system, which gives us the opportunity to make the code more self-documented and more understandable to each other and our tools.  The result is a lot less ‚Äúhmmm, I don‚Äôt even know what to do with it‚Äù moments than ever before. </div><p>Source: <a href="https://habr.com/ru/post/267799/">https://habr.com/ru/post/267799/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267785/index.html">Go, practice asynchronous interaction</a></li>
<li><a href="../267789/index.html">Flying panels flew away from us ... About navigation and the "Back" button in C # / XAML applications in Windows 10</a></li>
<li><a href="../267791/index.html">Virtual quadrocopter on Unity + OpenCV (Part 1)</a></li>
<li><a href="../267795/index.html">The digest of interesting materials for the mobile # 122 developer (September 21-27)</a></li>
<li><a href="../267797/index.html">Console of the 21st century: mosh, tmux, fish</a></li>
<li><a href="../267801/index.html">CSS games. Part 2: StarCraft</a></li>
<li><a href="../267803/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ178 (September 21 - 27, 2015)</a></li>
<li><a href="../267811/index.html">PHP and OData: we are moving from bicycles to technology from Microsoft</a></li>
<li><a href="../267813/index.html">Deploy infrastructure for development in the cloud InfoboxCloud. Part 1: Starting Gitlab</a></li>
<li><a href="../267815/index.html">We connect Intel devices for the Internet of things to Microsoft Azure IoT Suite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>