<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implement last visited / recent pages in Django</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I often find it so that on a new resource I get lost in a sea of ‚Äã‚Äãdifferent functions and settings, and in order not to lose sight of something inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implement last visited / recent pages in Django</h1><div class="post__text post__text-html js-mediator-article">  I often find it so that on a new resource I get lost in a sea of ‚Äã‚Äãdifferent functions and settings, and in order not to lose sight of something interesting, I open / duplicate a tab.  This is not always convenient, and the ‚Äúback‚Äù button sometimes works unpredictably, for example, in connection with push history, or because of the POST handler (which is broken) on the redirect (not evil, but for the sake of experiment).  Therefore, in order not to irritate the user, I decided to make recent pages.  The story about it under the cut. <br><a name="habracut"></a><br><br><h4>  Option One </h4><br>  Initially, I wanted to implement this function through Middleware, but I ran into a problem: remembering the url and putting it in the cache is not a problem, but getting the current title of the page is yes.  And I still think that the only right way to do this is to use middleware.  Stupid solutions: use <i>process_response ()</i> and parsit title;  use a client-side ajax script to get the title and everything similar to that.  Therefore, you need to somehow get to the template engine from middleware and get the root <b>{% block title%} there</b> .  I would be glad if you share an idea on this. <br><br><h4>  Option Two </h4><br>  Use templatetag.  This is exactly how I did it, but the essential disadvantage of this option is that you need to edit the templates with your hands, or think how to embed this tag in base.html. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Option Three </h4><br>  Use ajax script a la statistics tracker.  The advantage of this option is that the results can be used for different needs, for example, for statistics.  Cons - extra script, extra processors, extra data. <br><br><hr><br><br><h6>  Title tag </h6><br>  If you use ajax requests to the same view, then you should add the <i>request.is_ajax ()</i> check to not save the broken links to the user. <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@register.simple_tag(takes_context=True, name='save_visited') def save_visited(context, title, **kwargs): request = context['request'] # store last five pages identify_by = get_user_identification(request) visited_pages = cache.get('visited_pages_%s' % identify_by, [])[:4] # context.use_tz - why None if set True in settings? # may be we should save datetime.now() and convert it in getter? now = timezone.now() bundle = force_unicode(title), request.get_full_path()[:255], now visited_pages.insert(0, bundle) cache.set('visited_pages_%s' % identify_by, visited_pages, 60*60*24) return title</span></span></code> </pre> <br><br>  Using: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">extends</span></span></span></span></span><span class="hljs-template-tag"> 'forum/themes/default/edit_profile.html' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">load</span></span></span></span></span><span class="hljs-template-tag"> last_visited i18n %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">block</span></span></span></span></span><span class="hljs-template-tag"> title %}</span></span><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">save_visited</span></span></span><span class="hljs-template-tag"> _("Profile setup") %}</span></span><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endblock</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br><br><h6>  The tag getter, unloads the list in the specified context variable </h6><br><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@register.simple_tag(takes_context=True, name='load_visited') def load_visited(context, variable, **kwargs): identify_by = get_user_identification(context['request']) context[variable] = cache.get('visited_pages_%s' % identify_by, []) return u''</span></span></code> </pre><br><br>  Using: <br><pre> <code class="django hljs"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">load_visited</span></span></span><span class="hljs-template-tag"> 'visited' %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">for</span></span></span></span></span><span class="hljs-template-tag"> title, uri, dt </span><span class="hljs-keyword"><span class="hljs-template-tag"><span class="hljs-keyword">in</span></span></span><span class="hljs-template-tag"> visited %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ uri }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ title }}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">trans</span></span></span></span></span><span class="hljs-template-tag"> "at" %}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ dt }}</span></span><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">br</span></span></span></span><span class="xml"><span class="hljs-tag">/&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endfor</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br><br>  For experiments <a href="https://gist.github.com/night-crawler/6193730">gist</a> .  And yet, the middleware option is haunting me. </div><p>Source: <a href="https://habr.com/ru/post/189656/">https://habr.com/ru/post/189656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189634/index.html">LSI Nytro MegaRAID NMR8100-4i in action</a></li>
<li><a href="../189644/index.html">The presumption of guilt on the Internet. When you need to prove that you are not a camel</a></li>
<li><a href="../189646/index.html">GALAXY S4 Active - a smartphone for a better life</a></li>
<li><a href="../189650/index.html">Do not panic (translation of the chapter in the book Passionate Programmer by Chad Fowler)</a></li>
<li><a href="../189652/index.html">An open letter to the ROI and the FID on a petition to cancel the 187-FZ (# Law against Internet)</a></li>
<li><a href="../189658/index.html">Chaos Constructions 2013</a></li>
<li><a href="../189660/index.html">Kivy and Play Store</a></li>
<li><a href="../189662/index.html">Moscow bike</a></li>
<li><a href="../189664/index.html">The story of the creation of the lunar rover</a></li>
<li><a href="../189668/index.html">The Pirate Bay is 10 years old, and they launched a browser to circumvent censorship.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>