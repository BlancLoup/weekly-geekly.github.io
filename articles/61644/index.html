<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Become a maintainer - update the repository</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is not aimed at solving any fundamental problems, but it helps, with a minimum of effort, to automate the building of packages for your p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Become a maintainer - update the repository</h1><div class="post__text post__text-html js-mediator-article">  This article is not aimed at solving any fundamental problems, but it helps, with a minimum of effort, to automate the building of packages for your public repository. <br>  Let's say you build ten packages for your favorite users, each for two distributions (say, Debian unstable and Ubuntu jaunty), and each for two architectures (amd64 and i386).  Remember, we <a href="http://habrahabr.ru/blogs/ubuntu/51427/">learned</a> about the wonderful tool for creating repositories - reprepro.  So, since then, he never learned to include packs in packs in the repository - only one at a time.  This means that you have to enter your gpg-signature 10 * 2 * 2 = 40 times.  And how to effectively collect these 10 packages, especially if they are updated daily? <a name="habracut"></a><br><br>  In fact, my situation was even worse.  In total, when updating the qutIM repository, I had to enter my not short gpg-key as many as 176 (one hundred seventy-six) times.  I must say that by the time when I finally got tired of it and overcame my laziness, I carried out this procedure in just 3 minutes - one second to enter.  But we will not torture you, we will immediately correct the situation.  So, install the gnupg-agent package and edit your <b>~ / .bashrc file</b> , adding the following lines at the end: <br><blockquote><ol><li> <code><font color="black"><font color="#666666"><i># <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#666666"><i>#</i></font> #      GnuPG <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> # gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></i></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID <font color="#000000"><b>fi</b></font></font></code> </li> <li> <code><font color="black"><font color="#000000"><b><font color="#666666"><i>#</i></font> <font color="#666666"><i>#      GnuPG</i></font> <font color="#666666"><i>#</i></font> gpg-agent <font color="#660033">--daemon</font> <font color="#660033">--enable-ssh-support</font> <font color="#660033">--write-env-file</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#660033">-f</font> <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>]</b></font> ; <font color="#000000"><b>then</b></font> . <font color="#ff0000">" <font color="#007800">${HOME}</font> /.gpg-agent-info"</font> <font color="#7a0874"><b>export</b></font> GPG_AGENT_INFO <font color="#7a0874"><b>export</b></font> SSH_AUTH_SOCK <font color="#7a0874"><b>export</b></font> SSH_AGENT_PID fi</b></font></font></code> </li> </ol></blockquote><br>  Now when you start the local console, you will run a gpg-agent that ‚Äúremembers‚Äù the gpg-key you entered for a while.  Voila, we got rid of one big problem. <br><br>  What's next?  Next build packages.  I will tell you about it using the example of the same my favorite qutIM: among the packages I collect there are those that are almost daily updated from svn, and there are those that were downloaded once, and since then they are just rebuilt when updating kernel qutIM. <br>  For a start, I‚Äôll tell you a little about how the directory and package naming structure is organized in me, to make it clearer. <br>  At the root of the build directory, I initially only have a build script and directories of those packages that are not updated from svn, for example, qutim-plugin-floaties.  At the root of the build directory, all source directories are siphoned from svn and the collected packages are put.  Even in this directory, I have a wonderful subdirectory of controls, in which are the debian-folders for packages.  For example, to find the debian-folder for the qutim-protocol-jabber package, I call controls / qutim-protocol-jabber / debian / <br>  Well, in the rep / directory I have repository directories for different distros - rep / jaunty /, rep / unstable /, etc. <br>  From this we will make a start. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, let's start with the caps of our shell script, which will build: <br><blockquote><ol><li>  <font color="#666666"><i>#! / bin / bash</i></font> </li><li>  <font color="#007800">BUILDERRORS</font> = <font color="#ff0000">""</font> <font color="#666666"><i># variable where build errors are written</i></font> </li><li>  <font color="#007800">MAJORVERSION</font> = <font color="#ff0000">"0.2a"</font> <font color="#666666"><i># main version of each package</i></font> </li><li>  <font color="#007800">DISTRIBUTIONS</font> = <font color="#ff0000">"unstable testing stable jaunty"</font> <font color="#666666"><i># repository names</i></font> </li></ol></blockquote><br>  Now let's write two small simple functions, one of which will simply build a package from the current directory for all distributions and architectures, and the second will update package versions in all our pbuilder shells. <br><blockquote><ol><li>  build_it <font color="#7a0874"><b>(</b></font> <font color="#7a0874"><b>)</b></font> <font color="#7a0874"><b>{</b></font> </li><li>  <font color="#007800">OLDDIR</font> = <font color="#000000"><b>`</b></font> <font color="#007800">pwd`</font> </li><li>  <font color="#7a0874"><b>cd</b></font> $ <font color="#000000">1</font> </li><li>  <font color="#000000"><b>for</b></font> i <font color="#000000"><b>in</b></font> <font color="#007800">$ DISTRIBUTIONS</font> ;  <font color="#000000"><b>do</b></font> </li><li>  <font color="#000000"><b>for</b></font> j <font color="#000000"><b>in</b></font> i386 amd64;  <font color="#000000"><b>do</b></font> </li><li>  <font color="#007800">DIST</font> = <font color="#007800">$ i</font> <font color="#007800">ARCH</font> = <font color="#007800">$ j</font> pdebuild <font color="#660033">-</font> <font color="#660033">--basetgz</font> <font color="#000000"><b>/</b></font> var <font color="#000000"><b>/</b></font> cache <font color="#000000"><b>/</b></font> pbuilder <font color="#000000"><b>/</b></font> <font color="#007800">$ i</font> - <font color="#007800">$ j</font> -base.tgz </li><li>  <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#7a0874"><b>[</b></font> <font color="#007800">$?</font>  <font color="#000000"><b>!</b></font>  = <font color="#ff0000">"0"</font> <font color="#7a0874"><b>]</b></font> <font color="#7a0874"><b>]</b></font> </li><li>  <font color="#000000"><b>then</b></font> </li><li>  <font color="#007800">BUILDERRORS</font> = <font color="#ff0000">" <font color="#007800">$ BUILDERRORS</font></font> </li><li>  <font color="#ff0000">$ 1 - <font color="#007800">$ i</font> - <font color="#007800">$ j</font> "</font> </li><li>  <font color="#000000"><b>fi</b></font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#7a0874"><b>cd</b></font> <font color="#007800">$ OLDDIR</font> </li><li>  <font color="#7a0874"><b>}</b></font> </li><li></li><li>  update_it <font color="#7a0874"><b>(</b></font> <font color="#7a0874"><b>)</b></font> <font color="#7a0874"><b>{</b></font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Updating pbuilder environments ..."</font> </li><li>  <font color="#000000"><b>for</b></font> i <font color="#000000"><b>in</b></font> <font color="#007800">$ DISTRIBUTIONS</font> ;  <font color="#000000"><b>do</b></font> </li><li>  <font color="#000000"><b>for</b></font> j <font color="#000000"><b>in</b></font> i386 amd64;  <font color="#000000"><b>do</b></font> </li><li>  <font color="#007800">DIST</font> = <font color="#007800">$ i</font> <font color="#007800">ARCH</font> = <font color="#007800">$ j</font> pbuilder <font color="#660033">--update</font> <font color="#660033">--basetgz</font> <font color="#000000"><b>/</b></font> var <font color="#000000"><b>/</b></font> cache <font color="#000000"><b>/</b></font> pbuilder <font color="#000000"><b>/</b></font> <font color="#007800">$ i</font> - <font color="#007800">$ j</font> -base.tgz </li><li>  <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#7a0874"><b>[</b></font> <font color="#007800">$?</font>  <font color="#000000"><b>!</b></font>  = <font color="#ff0000">"0"</font> <font color="#7a0874"><b>]</b></font> <font color="#7a0874"><b>]</b></font> </li><li>  <font color="#000000"><b>then</b></font> </li><li>  <font color="#007800">BUILDERRORS</font> = <font color="#ff0000">" <font color="#007800">$ BUILDERRORS</font></font> </li><li>  <font color="#ff0000">Updating - <font color="#007800">$ i</font> - <font color="#007800">$ j</font> "</font> </li><li>  <font color="#000000"><b>fi</b></font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#7a0874"><b>}</b></font> </li></ol></blockquote><br><br>  It's simple, isn't it?  The first function will receive the name of the directory as input, go there and try to build a package for all architectures.  The second one doesn't need anything at all; it just updates all the pbuilder shells.  Note that both commands in the case of errors do nothing, just append the message to the error log. <br>  Now we need to make a universal function that will collect our bags.  All packages differ from each other by name, version and place from which to get them.  This will use.  First of all, in those debian / changelog files that I have stored in the controls folder, I have instead written the version ‚Äú--VERSION--‚Äù everywhere.  And secondly, I wrote such a wonderful little function: <br><blockquote><ol><li>  make_package <font color="#7a0874"><b>(</b></font> <font color="#7a0874"><b>)</b></font> <font color="#7a0874"><b>{</b></font> </li><li>  <font color="#007800">_REV</font> = $ <font color="#000000">1</font> </li><li>  <font color="#007800">_URL</font> = $ <font color="#000000">2</font> </li><li>  <font color="#007800">_NAME</font> = $ <font color="#000000">3</font> </li><li>  <font color="#007800">_DIR</font> = $ <font color="#000000">4</font> </li><li>  <font color="#007800">_BREV</font> = $ <font color="#000000">5</font> </li><li>  <font color="#007800">DIRNAME</font> = <font color="#ff0000">""</font> </li><li>  <font color="#007800">PACKAGENAME</font> = <font color="#ff0000">""</font> </li><li>  <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#7a0874"><b>[</b></font> <font color="#007800">$ _URL</font> <font color="#000000"><b>!</b></font>  = <font color="#ff0000">""</font> <font color="#7a0874"><b>]</b></font> <font color="#7a0874"><b>]</b></font> </li><li>  <font color="#000000"><b>then</b></font> </li><li>  <font color="#c20cb9"><b>rm</b></font> <font color="#660033">-rf</font> <font color="#ff0000">" <font color="#007800">$ _DIR</font> "</font> </li><li>  <font color="#7a0874"><b>export</b></font> <font color="#007800">$ _REV</font> = <font color="#000000"><b>`</b></font> <font color="#007800">LANG</font> = C <font color="#c20cb9"><b>svn</b></font> <font color="#7a0874"><b>export</b></font> <font color="#007800">$ _URL</font> <font color="#007800">$ _DIR</font> <font color="#000000"><b>|</b></font>  <font color="#c20cb9"><b>awk</b></font> <font color="#ff0000">'$ 1 == "Exported" &amp;&amp; $ 2 == "revision" {print $ 3}'</font> <font color="#000000"><b>|</b></font>  <font color="#c20cb9"><b>sed</b></font> <font color="#ff0000">'s /.$ //'</font> <font color="#000000"><b>`</b></font> </li><li>  <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#7a0874"><b>[</b></font> <font color="#800000">$ {! _ REV}</font> = <font color="#ff0000">""</font> <font color="#7a0874"><b>]</b></font> <font color="#7a0874"><b>]</b></font> </li><li>  <font color="#000000"><b>then</b></font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Error! Can't get <font color="#007800">$ _NAME</font> revision!"</font>  <font color="#000000"><b>&amp;&amp;</b></font> <font color="#7a0874"><b>exit</b></font> <font color="#000000">1</font> </li><li>  <font color="#000000"><b>fi</b></font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Received <font color="#007800">$ _NAME</font> revision: <font color="#007800">$ {! _ REV}</font> "</font> </li><li>  <font color="#000000"><b>else</b></font> </li><li>  <font color="#7a0874"><b>export</b></font> <font color="#007800">$ _REV</font> = <font color="#ff0000">"1"</font> </li><li>  <font color="#000000"><b>fi</b></font> </li><li>  <font color="#7a0874"><b>export</b></font> <font color="#007800">REVISION</font> = <font color="#ff0000">" <font color="#007800">$ {! _ REV}</font> "</font> </li><li>  <font color="#007800">DIRNAME</font> = <font color="#ff0000">" <font color="#007800">$ {_ DIR}</font> - <font color="#007800">$ {_ BREV}</font> . <font color="#007800">$ {! _ REV}</font> "</font> </li><li>  <font color="#007800">PACKAGENAME</font> = <font color="#ff0000">" <font color="#007800">$ {_ DIR}</font> _ <font color="#007800">$ {_ BREV}</font> . <font color="#007800">$ {! _ REV}</font> "</font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">" <font color="#007800">$ _NAME</font> directory is: <font color="#007800">$ DIRNAME</font> "</font> </li><li>  <font color="#c20cb9"><b>rm</b></font> <font color="#660033">-rf</font> <font color="#ff0000">" <font color="#007800">$ {PACKAGENAME}</font> .orig.tar.gz"</font> <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> "</font> </li><li>  <font color="#c20cb9"><b>cp</b></font> <font color="#660033">-r</font> <font color="#ff0000">" <font color="#007800">$ _DIR</font> "</font> <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> "</font> </li><li>  <font color="#c20cb9"><b>tar</b></font> czf <font color="#ff0000">" <font color="#007800">$ {PACKAGENAME}</font> .orig.tar.gz"</font> <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> "</font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">" <font color="#007800">$ _NAME</font> source archive is: <font color="#007800">$ {PACKAGENAME}</font> .orig.tar.gz"</font> </li><li>  <font color="#c20cb9"><b>cp</b></font> <font color="#660033">-r</font> <font color="#ff0000">"controls / <font color="#007800">$ {_ DIR}</font> / debian"</font> <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> /"</font> </li><li>  <font color="#c20cb9"><b>sed</b></font> <font color="#660033">-i</font> <font color="#ff0000">"s # - VERSION - # <font color="#007800">$ {_ BREV}</font> . <font color="#007800">$ {! _ REV}</font> -1 #"</font> <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> / debian / changelog"</font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Building <font color="#007800">$ _NAME</font> ..."</font> </li><li>  build_it <font color="#ff0000">" <font color="#007800">$ DIRNAME</font> "</font> </li><li>  <font color="#7a0874"><b>}</b></font> </li></ol></blockquote><br><br>  Let's take a closer look at what this function does.  At the input, we pass in succession five parameters: <br><ul><li>  variable name, where to put the number of the downloaded revision; </li><li>  the address from where to download the source; </li><li>  the name of the package, how to call it in log messages; </li><li>  debian package name; </li><li>  Major version number </li></ul><br>  The function is universal - if the URL is passed, the source files are downloaded from it and the .orig.tar.gz archive is automatically created.  If not transmitted, it is created from an existing directory. <br>  Now the package can be assembled in one simple line: <br><blockquote> <code><a href="http://qutim.org/svn/qutim%2522"></a></code> <ol><li>  make_package <font color="#ff0000">"QREV"</font> <font color="#ff0000">"qutim.org/svn/qutim"</font> <font color="#ff0000">"qutIM"</font> <font color="#ff0000">"qutim"</font> <font color="#ff0000">" <font color="#007800">$ MAJORVERSION</font> "</font> </li></ol></blockquote><br>  What is the very first QREV parameter passed for?  When assembling the package, we give qutIM the ‚Äúolder‚Äù version ‚Äú0.2a‚Äù and get the version of the package itself, for example, ‚Äú0.2a.294-1‚Äù.  If I build a protocol package, I want its version to include the kernel version: <br><blockquote> <code><a href="http://qutim.org/svn/mrim%2522"></a></code> <ol><li>  make_package <font color="#ff0000">"MRIM_REV"</font> <font color="#ff0000">"qutim.org/svn/mrim"</font> <font color="#ff0000">"MRIM"</font> <font color="#ff0000">"qutim-protocol-mrim"</font> <font color="#ff0000">" <font color="#007800">$ MAJORVERSION</font> . <font color="#007800">$ QREV</font> "</font> </li></ol></blockquote><br>  At the output we get the version "0.2a.294.357-1".  Isn't it convenient?  Thus, we always know which version of the source we received. <br>  If we have a package locally and I simply reassemble it, without pumping out svn - it doesn‚Äôt matter, just pass an empty parameter as a URL: <br><blockquote><ol><li>  make_package <font color="#ff0000">"FLOATIES_REV"</font> <font color="#ff0000">""</font> <font color="#ff0000">"Floaties"</font> <font color="#ff0000">"qutim-plugin-floaties"</font> <font color="#ff0000">" <font color="#007800">$ MAJORVERSION</font> . <font color="#007800">$ QREV</font> "</font> </li></ol></blockquote><br>  We have only one thing left - to update the packages in the repository, put it from the build machine to the server and let us know when assembling which packages we had errors: <br><blockquote><ol><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Copying packages to local repository ..."</font> </li><li>  <font color="#000000"><b>for</b></font> j <font color="#000000"><b>in</b></font> <font color="#007800">$ DISTRIBUTIONS</font> ;  <font color="#000000"><b>do</b></font> </li><li>  <font color="#000000"><b>for</b></font> i <font color="#000000"><b>in</b></font> <font color="#000000"><b>`</b></font> <font color="#c20cb9"><b>ls</b></font> <font color="#000000"><b>/</b></font> var <font color="#000000"><b>/</b></font> cache <font color="#000000"><b>/</b></font> pbuilder <font color="#000000"><b>/</b></font> <font color="#007800">$ j</font> <font color="#000000"><b>/</b></font> result <font color="#000000"><b>/ *</b></font> amd64.changes`;  <font color="#000000"><b>do</b></font> </li><li>  reprepro <font color="#660033">-b</font> rep <font color="#000000"><b>/</b></font> <font color="#007800">$ j</font> <font color="#000000"><b>/</b></font> <font color="#660033">--ignore</font> = wrongdistribution <font color="#660033">-C</font> main include <font color="#007800">$ j</font> <font color="#007800">$ i</font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#000000"><b>for</b></font> i <font color="#000000"><b>in</b></font> <font color="#000000"><b>`</b></font> <font color="#c20cb9"><b>ls</b></font> <font color="#000000"><b>/</b></font> var <font color="#000000"><b>/</b></font> cache <font color="#000000"><b>/</b></font> pbuilder <font color="#000000"><b>/</b></font> <font color="#007800">$ j</font> <font color="#000000"><b>/</b></font> result <font color="#000000"><b>/ *</b></font> _i386.deb`;  <font color="#000000"><b>do</b></font> </li><li>  reprepro <font color="#660033">-b</font> rep <font color="#000000"><b>/</b></font> <font color="#007800">$ j</font> <font color="#000000"><b>/</b></font> <font color="#660033">--ignore</font> = wrongdistribution <font color="#660033">-C</font> main includedeb <font color="#007800">$ j</font> <font color="#007800">$ i</font> </li><li>  <font color="#000000"><b>done</b></font> </li><li>  <font color="#000000"><b>done</b></font> </li><li></li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Updating main repository ..."</font> </li><li>  <font color="#c20cb9"><b>scp</b></font> <font color="#660033">-r</font> rep <font color="#000000"><b>/ *</b></font> remotehost: <font color="#000000"><b>/</b></font> path <font color="#000000"><b>/</b></font> to <font color="#000000"><b>/</b></font> repo <font color="#000000"><b>/</b></font> </li><li></li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"Done."</font> </li><li>  <font color="#000000"><b>if</b></font> <font color="#7a0874"><b>[</b></font> <font color="#ff0000">" <font color="#007800">$ BUILDERRORS</font> "</font> <font color="#7a0874"><b>]</b></font> ; </li><li>  <font color="#000000"><b>then</b></font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">"There were errors in:"</font> </li><li>  <font color="#7a0874"><b>echo</b></font> <font color="#ff0000">" <font color="#007800">$ BUILDERRORS</font> "</font> </li><li>  <font color="#000000"><b>fi</b></font> </li></ol></blockquote><br>  Notice, since we ‚Äúscrewed‚Äù the gpg-agent to our console, we no longer need the --ask-passphrase key for reprepro. <br><br>  All these wonderful scripts not only allow me to add new packages to the repository now by simply preparing the debian / directory for the package and one line in the script, but they also do not require my attention.  To build, I now run my script, and I'm going about my business.  Returning a few hours later I enter the gpg key once and the password from the remote repository server once.  Simple and convenient. <br><br>  Ps Information for those who like to experiment: besides the convenient reprepro, there is also the official dak utility, which is used for repositories in at least Debian.  I never used it, because for work it uses PostgreSQL and an incorrect python language (I won‚Äôt give a holivarit about it, and don‚Äôt ask for it).  But anyone can try. <br><br>  Pps For those who want to use scripts in their own, I suggest that I use the full script I use.  Edit for yourself on health: <a href="http://pastebin.com/f3289286a">pastebin.com/f3289286a</a> </div><p>Source: <a href="https://habr.com/ru/post/61644/">https://habr.com/ru/post/61644/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61634/index.html">Filter Forge: Aging a photo - quickly and easily (lesson)</a></li>
<li><a href="../61635/index.html">Do you wear glasses or contact lenses?</a></li>
<li><a href="../61640/index.html">Well, yes, C ++ sites</a></li>
<li><a href="../61642/index.html">the fate of a small developer in a large company, or is it necessary to fight windmills</a></li>
<li><a href="../61643/index.html">The irritating behavior of the update manager in Ubuntu 9.04 and how to cure it</a></li>
<li><a href="../61646/index.html">Happy Birthday, PHP!</a></li>
<li><a href="../61648/index.html">HD Tracker.ru and the Day of Russia!</a></li>
<li><a href="../61651/index.html">What the new iPhone 3GS will offer us</a></li>
<li><a href="../61653/index.html">Safari 4</a></li>
<li><a href="../61655/index.html">Caching Linq2Sql tables with automatic cache invalidation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>