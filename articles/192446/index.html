<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Its Certificate Authority - in 5 OpenSSL teams</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do you need it? 
 Imagine that we have two servers, they work for themselves, and periodically they want to ask each other something over the HTTP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Its Certificate Authority - in 5 OpenSSL teams</h1><div class="post__text post__text-html js-mediator-article"><h4>  Why do you need it? </h4><br>  Imagine that we have two servers, they work for themselves, and periodically they want to ask each other something over the HTTP / HTTPS protocol. <br><br>  The HTTP protocol is not secure and it is logical to use the HTTPS protocol to communicate between servers. <br><br>  To organize such communication, we need 2 SSL certificates. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If the servers belong to the same organization, then it may be easier and safer to sign the certificates yourself, rather than buy. <br><a name="habracut"></a><br><h4>  Create our CA </h4><br>  The first command creates a root key. <br><br><pre><code class="bash hljs">openssl genrsa -out rootCA.key 2048</code> </pre> <br>  For me, the 2048 bit key is sufficient, if you want, you can use the 4096 bit key. <br><br>  The second command creates a root certificate. <br><br><pre> <code class="bash hljs">openssl req -x509 -new -key rootCA.key -days 10000 -out rootCA.crt</code> </pre><br>  Here you can answer questions as you please. <br><br><pre> <code class="bash hljs">Country Name (2 letter code) [AU]: State or Province Name (full name) [Some-State]: Locality Name (eg, city) []: Organization Name (eg, company) [Internet Widgits Pty Ltd]: Organizational Unit Name (eg, section) []: Common Name (eg server FQDN or YOUR name) []: Email Address []:</code> </pre><br>  10,000 days is its expiration date, roughly the certificate lives that google requires you to sign an android application for Google Play.  If you are alarmist, sign up for a year or two. <br><br>  Everything!  Now we can create certificates for our servers and install the root certificate on our client machines. <br><br><h4>  Create a certificate signed by our CA </h4><br>  We generate the key. <br><br><pre> <code class="bash hljs">openssl genrsa -out server101.mycloud.key 2048</code> </pre><br>  Create a certificate request. <br><br><pre> <code class="bash hljs">openssl req -new -key server101.mycloud.key -out server101.mycloud.csr</code> </pre><br>  It is important to specify the server name: domain or IP (for example, <b>server101.mycloud</b> domain) <br><br><pre> <code class="bash hljs">Common Name (eg, YOUR name) []: server101.mycloud</code> </pre><br>  and sign the certificate request with our root certificate. <br><br><pre> <code class="bash hljs">openssl x509 -req -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> server101.mycloud.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out server101.mycloud.crt -days 5000</code> </pre><br>  Now clients need to install the root certificate rootCA.crt <br><br>  <b>rootCA.crt</b> - you can give to friends, install, copy not servers, upload to public access <br>  <b>rootCA.key</b> - should be kept private <br><br><h4>  Install Root Certificate </h4><br><h5>  Windows </h5><br>  IE, Chrome - use Windows certificate repository. <br><br>  My path to it is this: <br><br>  Chrome - Settings - Manage Certificates ... <br>  Choose tab Trusted Root Certificate Authorities - Import - rootCA.crt <br>  restart chrome <br><br>  FireFox on Windows has its own repository. <br><br>  Java has its own repository. <br><br><h5>  Mac os x </h5><br>  Safari, FireFox, Chrome - use a system repository. <br><br>  Launch KeyChain Access. <br>  Go to the menu File - Import Items (login or System) - select the file <b>rootCA.crt</b> . <br>  When they ask us, we answer - Always Trust. <br><br><img src="https://habrastorage.org/storage3/c10/72a/8ab/c1072a8abc92f1be5eab3f1c990a0a33.png"><br><br>  For your personal Safari, just select login. <br><br><img src="https://habrastorage.org/storage3/8e9/2c8/ea0/8e92c8ea0716f45c8f957bcf3340ee4b.png"><br><h5>  In ubuntu </h5><br><pre> <code class="bash hljs">sudo mkdir /usr/share/ca-certificates/extra sudo cp rootCA.crt /usr/share/ca-certificates/extra/rootCA.crt sudo dpkg-reconfigure ca-certificates sudo update-ca-certificates</code> </pre><br><h5>  Go server program </h5><br>  A server program on Go myserver.go that uses our signed certificate. <br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"net/http"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { http.Handle(<span class="hljs-string"><span class="hljs-string">"/files/"</span></span>, http.StripPrefix(<span class="hljs-string"><span class="hljs-string">"/files/"</span></span>, http.FileServer(http.Dir(<span class="hljs-string"><span class="hljs-string">"./files/"</span></span>)))) <span class="hljs-keyword"><span class="hljs-keyword">go</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { log.Fatal(http.ListenAndServeTLS(<span class="hljs-string"><span class="hljs-string">":8443"</span></span>, <span class="hljs-string"><span class="hljs-string">"server101.mycloud.crt"</span></span>, <span class="hljs-string"><span class="hljs-string">"server101.mycloud.key"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>)) }() http.ListenAndServe(<span class="hljs-string"><span class="hljs-string">":8080"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) }</code> </pre><br><pre> <code class="bash hljs">go run myserver.go</code> </pre><br>  running the program on server101.mycloud server, your browser will not swear on the page <a href="https://server101.mycloud:8443/">https: //server101.mycloud: 8443 /</a> , and open it as a native if you have installed rootCA.crt in the system as a root certificate. <br><img src="https://habrastorage.org/storage3/a92/389/84e/a9238984eb1c214f02c801079b28cac9.png"><br><h5>  Server on python </h5><br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPServer, SimpleHTTPServer, ssl httpd = BaseHTTPServer.HTTPServer((<span class="hljs-string"><span class="hljs-string">'localhost'</span></span>, <span class="hljs-number"><span class="hljs-number">8443</span></span>), SimpleHTTPServer.SimpleHTTPRequestHandler) httpd.socket = ssl.wrap_socket (httpd.socket, certfile=<span class="hljs-string"><span class="hljs-string">'server101.mycloud.pem'</span></span>, server_side=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) httpd.serve_forever()</code> </pre><br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#        cat server101.mycloud.key server101.mycloud.crt &gt; server101.mycloud.pem #     python myserver.py</span></span></code> </pre><br><h4>  PS </h4><br>  I consider it important to mention that wildcard certificates are not safe, if an attacker takes possession of a wildcard certificate from one server, then this will put all other servers at risk.  Virtual cloud servers are more popular than ever.  Often background tasks run on separate virtual servers.  The number of such servers is constantly growing.  Its Certificate Authority is an important element of security for the entire system. </div><p>Source: <a href="https://habr.com/ru/post/192446/">https://habr.com/ru/post/192446/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192432/index.html">Google interface update</a></li>
<li><a href="../192436/index.html">Android 4.4 got the name Kit Kat (+1 billion activated devices)</a></li>
<li><a href="../192440/index.html">GitHub adds two-factor authentication</a></li>
<li><a href="../192442/index.html">Survey: Do you have a 3D printer and would you like to print for others?</a></li>
<li><a href="../192444/index.html">Happy end of my story with a script for comfortable reading Habr</a></li>
<li><a href="../192448/index.html">How did I count the time of arrival by the Monte Carlo method</a></li>
<li><a href="../192450/index.html">Runetology (207): Timofey Gorshkov, co-founder of inSales</a></li>
<li><a href="../192454/index.html">Having bought Nokia for 7.17 billion dollars, Microsoft leads the Trojan horse home</a></li>
<li><a href="../192456/index.html">RosSpam.org or how to complain about SMS spam in a couple of clicks</a></li>
<li><a href="../192458/index.html">[Poll] Saving vision from the computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>