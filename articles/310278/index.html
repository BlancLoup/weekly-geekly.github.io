<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Gitlab-CI and Ansible-lint syntax checking</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! We continue the DevOps series of articles and look for the most efficient ways to manage the configuration, sharing your experience with you. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Gitlab-CI and Ansible-lint syntax checking</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/d83/293/edf/d83293edf85346cc80b3e4c830d3bea1.png"></div><br><br>  Hello!  We continue the DevOps series of articles and look for the most efficient ways to manage the configuration, sharing your experience with you.  In <a href="https://habrahabr.ru/company/centosadmin/blog/303762/">previous articles,</a> we looked at how to build Ansible configuration management using Jenkins and Serverspec, and now, at your request, consider how to organize configuration management using GitLab-CI. <br><br>  <a href="https://github.com/willthames/ansible-lint">Ansible-lint</a> is a utility for checking the correctness of the playbook syntax and code style, which can be integrated into the CI-service.  In our case, we embed it in gitlab-ci to check playbooks at the stage of accepting a Merge-Request and setting the status of checks. <br>  <a href="https://about.gitlab.com/">GitLab</a> (GitLab Community Edition) is a opensource project, a git repository manager, originally developed as an alternative to the paid corporate version of Github. <br><a name="habracut"></a><br>  Installing GitLab CE is described in <a href="https://habrahabr.ru/company/centosadmin/blog/306596/">this article</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Install gitlab-ci-multirunner <br><br><pre><code class="hljs ruby">curl -L <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/packages.gitlab.com/install</span></span><span class="hljs-regexp"><span class="hljs-regexp">/repositories/runner</span></span><span class="hljs-regexp"><span class="hljs-regexp">/gitlab-ci-multi-runner/script</span></span>.rpm.sh <span class="hljs-params"><span class="hljs-params">| sudo bash yum install gitlab-ci-multi-runner</span></span></code> </pre> <br>  Register runner <br><br><pre> <code class="hljs objectivec">gitlab-ci-multi-runner <span class="hljs-keyword"><span class="hljs-keyword">register</span></span></code> </pre> <br>  Now you need to answer the questions: <br><br><pre> <code class="hljs mel">Running <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>-mode. Please enter the gitlab-ci coordinator URL (eg https:<span class="hljs-comment"><span class="hljs-comment">//gitlab.com/ci): http://domain.example.com/ci Please enter the gitlab-ci token for this runner: your_token Please enter the gitlab-ci description for this runner: [domain.example.com]: Please enter the gitlab-ci tags for this runner (comma separated): ansible Registering runner... succeeded runner= Please enter the executor: docker-ssh+machine, docker, docker-ssh, parallels, shell, ssh, virtualbox, docker+machine: shell Runner registered successfully. Feel free to start it, but if it's running already the config should be automatically reloaded!</span></span></code> </pre> <br>  We take the token and URL from the project settings page. <br><br><img src="https://habrastorage.org/files/5a6/7dd/e9c/5a67dde9c76443149e8cab027b8003b7.png"><br><br><img src="https://habrastorage.org/files/1f4/7bd/709/1f47bd709d7f4902ad047b6d65f77492.png"><br><br><h4>  Features of setting multi-runner. </h4><br>  One runner can handle multiple projects.  In order for one runner to process everything, you just need to register a new runner without specifying tags.  We take the token for the shared runner in the Admin Area: <br><br><img src="https://habrastorage.org/files/77a/269/3ef/77a2693ef7f242468e0527a34d9b5774.png"><br><br>  You can pack a pack of runners on different servers.  And more: in gitlab, as in Jenkins, there is such a thing as tags.  The project with the ansible tag will process the runner marked with the ansible tag, and for other projects, without a label or with a different label, this runner will not work. <br><br>  Also in the admin, you can configure the match runner and project. <br><br>  <a href="http://domain.example.com/admin/runners">domain.example.com/admin/runners</a> <br><br><img src="https://habrastorage.org/files/812/f1c/2b4/812f1c2b4b9542478bd1268c08065e30.png"><br><br><h4>  Install Ansible-lint </h4><br>  Ansible-lint is installed via python-pip or from the EPEL repository. <br><br><h5>  The first way: </h5><br>  First install python-pip, then through it set ansible-lint: <br><br><pre> <code class="hljs sql">sudo yum groupinstall @Development Tools sudo yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> python-pip sudo pip <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--upgrade pip sudo pip install ansible-lint</span></span></code> </pre><br><h5>  Second way </h5><br>  Everything is simple - we put epel-release and put ansible-lint through the package manager: <br><br><pre> <code class="hljs sql">sudo yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> epel-<span class="hljs-keyword"><span class="hljs-keyword">release</span></span> sudo yum <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> ansible-lint</code> </pre><br><h4>  Adjusting the pipeline. </h4><br>  Create a <i>.gitlab-ci.yml</i> file in the root of the repository.  It is important to observe the number of spaces, otherwise there will be an error - yaml is not forgiving, yeah. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">stages</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">test_job</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">stage</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">test</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">script</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ansible-lint</span></span> *<span class="hljs-selector-class"><span class="hljs-selector-class">.yml</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">tags</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ ]</span></span><span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">ansible</span></span></code> </pre> <br>  stages - be sure to describe the assembly stage. <br><br><pre> <code class="hljs">stages: - stagename</code> </pre> <br>  test_job is an arbitrary job title. <br>  stage: test ‚Äî you must describe the test stage specified in the stages section. <br><br><pre> <code class="hljs">jobname: stage: stagename</code> </pre> <br>  script - we carry out the test in the root of the repository <br>  tags - runner tag. <br><br>  Stage name stage: test can be any, for example: converge, pre-test, post-test, deploy. <br>  The job_name test_job can also be any. <br><br>  GitLab has built-in lining for pipelines.  You can check the correctness of the syntax of the <a href="http://domain.example.com/ci/lint">pipeline</a> by URL <a href="http://domain.example.com/ci/lint">domain.example.com/ci/lint</a> <br><br>  Insert pipeline, click Validate. <br><br><img src="https://habrastorage.org/files/ff9/f0e/757/ff9f0e7573f14569b7b3ffff7e314c30.png"><br><br>  If an error occurs, the linter will swear and indicate an error. <br><br><img src="https://habrastorage.org/files/da1/cfc/a65/da1cfca65579414aa3464e5ed46a0e50.png"><br><br>  Must be <i>stages</i> , not <i>stage</i> . <br><br>  Thus, <i>ansible-lint</i> will automatically check all playbooks with the <i>.yml</i> extension from the repository root at each commit. <br><br>  We have two roles in the repository: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">roles</span></span> ‚îú‚îÄ‚îÄ monit ‚îî‚îÄ‚îÄ openssh</code> </pre> <br>  And two playbooks that roll these roles: <br><br><pre> <code class="hljs css">‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">monit</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yml</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">openssh</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.yml</span></span> ‚îú‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">README</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.md</span></span> ‚îî‚îÄ‚îÄ <span class="hljs-selector-tag"><span class="hljs-selector-tag">roles</span></span></code> </pre><br>  <i>openssh.yml</i> <pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">--- - hosts: all user: ansible become: yes roles: - openssh</span></span></code> </pre> <br>  <i>monit.yml</i> <br><br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">--- - hosts: all user: ansible become: yes roles: - monit</span></span></code> </pre> <br><br>  Therefore, by checking the playbook assigning the role, we check all its contents: <br><br><pre> <code class="hljs coffeescript">roles<span class="hljs-regexp"><span class="hljs-regexp">/openssh/tasks/</span></span> ‚îú‚îÄ‚îÄ configure_iptables.yml ‚îú‚îÄ‚îÄ configure_monitoring.yml ‚îú‚îÄ‚îÄ configure_ssh.yml ‚îî‚îÄ‚îÄ main.ym</code> </pre> <br><pre> <code class="hljs coffeescript">roles<span class="hljs-regexp"><span class="hljs-regexp">/monit/tasks/</span></span> ‚îú‚îÄ‚îÄ configure_monit.yml ‚îú‚îÄ‚îÄ configure_monit_checks.yml ‚îú‚îÄ‚îÄ install_monit.yml ‚îî‚îÄ‚îÄ main.yml</code> </pre> <br>  Now, with a commit, the <i>ansible-lint</i> will <i>start</i> automatically and check all the roles listed in the playbooks. <br>  If you try to commit something and go to the web interface ( <i>pipelines</i> tab), then you can see the job status as <i>failed</i> . <br><br><img src="https://habrastorage.org/files/ba0/b3b/1a2/ba0b3b1a22914a9cabb5f19d2f559bb4.png"><br><br>  In order to disable the lint checks when pushing to the repository, it is enough to <i>clear</i> all stages related to running the <i>ansible-lint</i> checks in the <i>.gittab-ci.yml file</i> . <br><br>  Playback check options are also configured: <br><br><pre> <code class="hljs cpp">‚ï∞‚îÄ&gt;$ ansible-lint --help Usage: ansible-lint playbook.yml Options: --version show program's version number <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> -h, --help show <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> help message <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> -L <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> all the rules -q quieter, although <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> silent output -p parseable output in the format of pep8 -r RULESDIR specify one <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more rules directories <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> one <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more -r arguments. Any -r flags override the <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> rules in /usr/local/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist- packages/ansiblelint/rules, unless -R is also used. -R Use <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> rules in /usr/local/lib/python2<span class="hljs-number"><span class="hljs-number">.7</span></span>/dist- packages/ansiblelint/rules in addition to any extra rules directories specified with -r. There is no need to specify <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> no -r flags are used -t TAGS only check rules whose id/tags match these values -T <span class="hljs-built_in"><span class="hljs-built_in">list</span></span> all the tags -v Increase verbosity level -x SKIP_LIST only check rules whose id/tags <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match these values --nocolor disable colored output --exclude=EXCLUDE_PATHS path to directories <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> files to skip. This option is repeatable.</code> </pre> <br><pre> <code class="hljs pgsql">‚ï∞‚îÄ&gt;$ ansible-lint -L ANSIBLE0002: <span class="hljs-keyword"><span class="hljs-keyword">Trailing</span></span> whitespace There should <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be <span class="hljs-keyword"><span class="hljs-keyword">any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">trailing</span></span> whitespace ANSIBLE0004: Git checkouts must contain explicit <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> control checkouts must <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> an explicit <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> tag, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> just "latest" ANSIBLE0005: Mercurial checkouts must contain explicit revision <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> control checkouts must <span class="hljs-type"><span class="hljs-type">point</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> an explicit <span class="hljs-keyword"><span class="hljs-keyword">commit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> tag, <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> just "latest" ANSIBLE0006: <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> command rather than module Executing a command <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an Ansible module <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> generally a bad idea ANSIBLE0007: <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> command rather than an argument <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> eg file Executing a command <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> are arguments <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> modules <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> generally a bad idea ANSIBLE0008: Deprecated sudo <span class="hljs-keyword"><span class="hljs-keyword">Instead</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> sudo/sudo_user, use become/become_user. ANSIBLE0009: Octal file permissions must contain <span class="hljs-keyword"><span class="hljs-keyword">leading</span></span> zero <span class="hljs-type"><span class="hljs-type">Numeric</span></span> file permissions <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-keyword"><span class="hljs-keyword">leading</span></span> zero can behavein unexpected ways. See http://docs.ansible.com/ansible/file_module.html ANSIBLE0010: Package installs should <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> use latest Package installs should use state=present <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> ANSIBLE0011: <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> tasks should be named <span class="hljs-keyword"><span class="hljs-keyword">All</span></span> tasks should have a <span class="hljs-keyword"><span class="hljs-keyword">distinct</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> readability <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-comment"><span class="hljs-comment">--start-at-task to work ANSIBLE0012: Commands should not change things if nothing needs doing Commands should either read information (and thus set changed_when) or not do something if it has already been done (using creates/removes) or only do it if another check has a particular result (when) ANSIBLE0013: Use shell only when shell functionality is required Shell should only be used when piping, redirecting or chaining commands (and Ansible would be preferred for some of those!) ANSIBLE0014: Environment variables don't work as part of command Environment variables should be passed to shell or command through environment argument ANSIBLE0015: Using bare variables is deprecated Using bare variables is deprecated. Update yourplaybooks so that the environment value uses the full variablesyntax ("{{your_variable}}").</span></span></code> </pre> <br>  Some tasks can be skipped when checking <i>ansible-lint</i> doesn‚Äôt like <a href="https://docs.ansible.com/ansible/command_module.html">command</a> and <a href="https://docs.ansible.com/ansible/shell_module.html">shell</a> modules very much, since in the ansible ideology it is considered that regular core modules are sufficient for all tasks.  In fact, this is not always the case. <br><br>  For example, we have a task in the role that uses the <i>command</i> module: <br><br><pre> <code class="hljs cmake">- name: Installing monit <span class="hljs-keyword"><span class="hljs-keyword">command</span></span>: yum -y <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> monit tags: monit</code> </pre> <br>  And if a playbook is prolintim with this role, then <i>ansible-lint will</i> quarrel on the fact that we use the <i>command</i> module <br><br><pre> <code class="hljs pgsql">‚ï∞‚îÄ&gt;$ ansible-lint monit.yml [ANSIBLE0002] <span class="hljs-keyword"><span class="hljs-keyword">Trailing</span></span> whitespace monit.yml:<span class="hljs-number"><span class="hljs-number">7</span></span> - monit [ANSIBLE0012] Commands should <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> change things <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">nothing</span></span> needs doing /tmp/ansible-lint/roles/monit/tasks/install_monit.yml:<span class="hljs-number"><span class="hljs-number">8</span></span> Task/<span class="hljs-keyword"><span class="hljs-keyword">Handler</span></span>: Installing monit [ANSIBLE0006] yum used <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> place <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> yum module /tmp/ansible-lint/roles/monit/tasks/install_monit.yml:<span class="hljs-number"><span class="hljs-number">8</span></span> Task/<span class="hljs-keyword"><span class="hljs-keyword">Handler</span></span>: Installing monit</code> </pre> <br>  To avoid this, you can mark the task with the tag <i>skip_ansible_lint</i> : <br><br><pre> <code class="hljs cmake">- name: Installing monit <span class="hljs-keyword"><span class="hljs-keyword">command</span></span>: yum -y <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> monit tags: monit,skip_ansible_lint</code> </pre> <br>  Now, when running lint on a playbook, it will not swear at the used <i>command</i> module: <br><br><pre> <code class="hljs pgsql">‚ï∞‚îÄ&gt;$ ansible-lint monit.yml [ANSIBLE0002] <span class="hljs-keyword"><span class="hljs-keyword">Trailing</span></span> whitespace monit.yml:<span class="hljs-number"><span class="hljs-number">7</span></span> - monit</code> </pre> <br><h4>  Features Merge Request. </h4><br>  Looking ahead, a few words about the functionality of checks in MR.  By default, merge-request is accepted only upon successful verification.  You can disable it in the project settings, in the Merge Requests section: <br><br><img src="https://habrastorage.org/files/9d4/079/73c/9d407973c1bd41a28cbdbe6c253d8f24.png"><br><br>  Ansible-lint can also be run on a local host without committing and not waiting for a CI service check.  If you are on a Linux or OS X desktop, just install it to yourself. <br><br><h4>  Examples of commits with an error like this in gitlab. </h4><br>  <strong>1.</strong> Open the file in the embedded GitLab editor: <br><br><img src="https://habrastorage.org/files/af9/b82/36a/af9b8236a5884b418a1f18e499f1cbb3.png"><br><br>  <strong>2.</strong> Make changes.  For example, yaml is very sensitive to spaces, try adding an extra space at the beginning of a line: <br><br><img src="https://habrastorage.org/files/ef2/b89/86a/ef2b8986abf6431c9f97ef8cc1edb8b1.png"><br><br>  Click Commit Changes, back to the modified file.  An icon with the check status will appear at the top right: <br><br><img src="https://habrastorage.org/files/b14/ca7/6bc/b14ca76bc45d4ea99e38f7e24206b0ea.png"><br><br>  Now it is in Pending status, as the check is not completed yet.  If we poke a pictogram, we will move on to the status of checking our newly created commit: <br><br><img src="https://habrastorage.org/files/485/d36/b2d/485d36b2d35741a09037c32b3cd862a9.png"><br><br>  It is now in the status Failed, since we intentionally made a mistake in the syntax.  If we poke the Failed icon, we can see the result of the work of ansible-lint: <br><br><img src="https://habrastorage.org/files/ce5/c5d/b39/ce5c5db39d6c43d1b464ba3d9f697c89.png"><br><br>  You can stick a cute badge with the status of the assembly in README.md <br><br><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">![build status</span></span>](<span class="hljs-link"><span class="hljs-link">http://domain.example.com/projectname/badges/master/build.svg</span></span>)](<span class="hljs-link"><span class="hljs-link">http://domain.example.com/projectname/commits/master</span></span>)</code> </pre> <br>  You can take it in the project settings, in the CI / CD Pipelines section <br><br><img src="https://habrastorage.org/files/ac8/da4/1a3/ac8da41a388245c5945072fb6c19bd2a.png"><br><br>  Copy-paste marcown and add it to README.md in the project root, commit, now the check status is displayed on the main page of the project: <br><br><img src="https://habrastorage.org/files/4cf/8df/fc3/4cf8dffc3f5641b59ef4b591356aafb4.png"><br><br>  Green / Passed - if the check was successful. <br>  Red / Failed - if the check ended with an error. <br><br>  In the Pipelines tab you can see the status of all commits: <br><br><img src="https://habrastorage.org/files/c01/d70/ae0/c01d70ae03084dab928d3109515dcb21.png"><br><br>  Thus, we have built the process of checking the syntax correctness in configuration management.  Thank you for your attention and all good automation! <br><br>  Author: DevOps admin Centos-admin - Victor Batuev. </div><p>Source: <a href="https://habr.com/ru/post/310278/">https://habr.com/ru/post/310278/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310264/index.html">How I started writing third-party projects to gain experience</a></li>
<li><a href="../310266/index.html">As the heroes of the game OverWatch once bald, and we returned them the hair</a></li>
<li><a href="../310268/index.html">REST server and thin client using vibe-d</a></li>
<li><a href="../310270/index.html">Naive implementation of std :: bind (boost :: bind)</a></li>
<li><a href="../310276/index.html">Embedding functional objects, functions and lambdas through templates and unification using virtual in C ++</a></li>
<li><a href="../310282/index.html">The second wave of fateful changes GitHub</a></li>
<li><a href="../310284/index.html">React.js: build an isomorphic / universal application from scratch. Part 2: add bootstrap, pages and routing</a></li>
<li><a href="../310286/index.html">What links to use: absolute or relative?</a></li>
<li><a href="../310288/index.html">ClusterR clustering, part 1</a></li>
<li><a href="../310292/index.html">Bug work</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>