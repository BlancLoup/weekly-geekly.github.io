<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the first addon for XenForo. MVC, templates, styles, settings, navigation - we use everything</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Cyrus posted an educational addon on the forum where you can demonstrate how to write addons for XenForo. This is what we will do now. This training a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the first addon for XenForo. MVC, templates, styles, settings, navigation - we use everything</h1><div class="post__text post__text-html js-mediator-article">  Cyrus posted an <a href="http://xenforo.com/community/threads/likes-review-most-liked-posts.5329/">educational addon</a> on the forum where you can demonstrate how to write addons for XenForo.  This is what we will do now.  This training addon contains a couple of errors, perhaps, so that we show ourselves, discovering and correcting them.  We will create the same addon from the very beginning and allow ourselves to slightly improve / correct what happened with Cyrus. <br><br><a name="habracut"></a><br><br>  The challenge is this.  It is necessary to write an addon, which on a separate page will display a list of forum messages that users liked most (ie, the messages that the users like the most).  The administrator should be able to configure the maximum number of messages displayed on the page in the control panel, as well as choose the avatar color in the forum style.  The addon should be fully phrasable and built into the main forum menu in a separate tab. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      First of all, you need to put the forum in debug mode.  This can be done by adding a line to the /library/config.php file. <br><pre><code class="php hljs">$config[<span class="hljs-string"><span class="hljs-string">'debug'</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>;</code> </pre> <br><br>  Log into the admin control panel and go to the Development tab that appears.  Select "Create add-on" there.  As the ID, we need to specify any unique string.  Let it be ‚ÄúLikeReviewRus‚Äù (without quotes, of course).  In the title bar, enter any explanatory text.  It does not affect anything, it will just be displayed in the control panel.  Save.  We got an empty addition. <br><br>  Now let's create an option to limit the number of posts per page.  Go to the Home tab and go to Settings.  Add a group of settings.  Group ID let it be LikeReviewRusSettingsGroup.  Title can be arbitrary.  You will see this text among other groups of settings.  Do not make it too long.  Keep in mind that this is the text to display in the ‚ÄúMaster language‚Äù language of the forum.  In fact, such a language is English, and our addon should ideally also be originally in English.  Then we could translate it and distribute the Russian localization along with the addon file.  But for the sake of simplicity, let's point out all the lines in the native language for now.  As an addition, select our addon and save. <br><br>  After saving you will be in this group of settings.  Initially, it is empty and we need to create a setting here.  Click ‚Äúadd option‚Äù.  For the option name, enter LikeReviewRusMaxToDisplay.  Choose a supplement, create a title and explanatory text.  We need to enter only integer numbers, therefore, as a format, we should choose the ‚ÄúNumber input field with arrows‚Äù.  In the format options you can specify <br><pre> <code class="hljs swift"><span class="hljs-built_in"><span class="hljs-built_in">min</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span> step=<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>=<span class="hljs-number"><span class="hljs-number">100</span></span></code> </pre><br><br>  This means that the minimum setting value is 1, each time you press the arrow, 5 will be added / subtracted, and the maximum number that can be entered there is 100. Let the data type be ‚ÄúUnsigned integer‚Äù.  The default value is 30. The remaining settings are left as is.  Save.  You can immediately check what you got. <br><br>  Now let's create a style setting.  Go to the Exterior view tab and click on Style Settings.  Create a new group there.  Let her ID be LikeReviewRusStyle.  All other parameters, including the Addition item, you can choose by yourself.  Save and then go to this group.  You will immediately enter the dialog for creating a new style property.  The property name is LikeReviewRusAvatarBorder.  Specify Supplement, title and description.  Set the property type to Scalar and select a color.  You may also have to manually select the group again.  This is a bug and will fix it.  Save and see what you got.  Class, right?  :) <br><br>  Now we need to create some phrases so that the addon can be translated into other languages.  Click the Phrases link on the Appearance page.  Create phrases with the captions LikeReviewRus_Header (to display at the very top of the page) and LikeReviewRus_Description to display below as a description.  As the text for this last phrase, enter "This is {numPosts} the posts users liked most."  Below you will see how the quantity is inserted in the template instead of {numPosts}. <br><br>  Now we need to create a template for the page that we will show.  Click on the Templates section on the Appearance tab.  Now create a new template.  For the name of the template, specify likereviewrus.css and insert the following contents. <br><pre> <code class="html hljs xml">.mostLikedPosts { } .mostLikedPosts .avatar { float: left; margin-right: 10px; } .mostLikedPosts .avatar img { width: 64px; height: 64px; border: 3px solid {xen:property LikeReviewRusAvatarBorder}; } .mostLikedPosts .likedPost { position: relative; } .mostLikedPosts .primaryContent { padding: 0; padding-top: 10px; } .mostLikedPosts h3 { font-size: 12pt; margin-bottom: 5px; } .mostLikedPosts .likes { display: block; position: absolute; right: 0px; top: 10px; width: 24px; height: 24px; line-height: 24px; text-align: center; border-radius: 13px; font-weight: bold; background: {xen:property primaryLighterStill}; border: 1px solid {xen:property primaryLighter}; } .mostLikedPosts .likes:hover { background-color: {xen:property secondaryLightest}; border-color: {xen:property secondaryLighter}; color: {xen:property secondaryDark}; text-decoration: none; box-shadow: 0 0 10px {xen:property secondaryMedium}; } .mostLikedPosts .meta { font-size: 11px; padding-top: 5px; padding-bottom: 5px; margin-left: 80px; margin-bottom: -1px; margin-top: 10px; border: 1px solid {xen:property primaryLighterStill}; border-right: none; border-top-left-radius: 10px; } .mostLikedPosts .meta dd { margin-right: 10px; } .mostLikedPosts .meta dd strong { font-weight: bold; }</code> </pre><br>  Select add-on, save and exit.  We just typed a list of CSS styles that we just use in the template.  Tags {xen: property} denote the places where data from the basic style settings will be inserted (find them, by the way).  Please note that we put in there the style setting that we created ourselves, correcting the author's mistake (albeit slightly tasteless). <br><br>  Now create another template and name it likereviewrus_index.  Paste the following content into it: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:title</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase LikeReviewRus_Header}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:navigation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:breadcrumb</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link likes-review}"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase LikeReviewRus_Header}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:breadcrumb</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:navigation</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:require</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">css</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"likereviewrus.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sectionMain mostLikedPosts"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"subHeading"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase LikeReviewRus_Description, 'numPosts={xen:count $likedPosts}'}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$likedPosts"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"likedPost"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"primaryContent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:avatar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"m"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">img</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link posts, $post}"</span></span></span><span class="hljs-tag">&gt;</span></span>{$post.title}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h3</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"muted"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:helper wordTrim, $post.message, 140}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link posts/likes, $post}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"likes OverlayTrigger"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:number $post.likes}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">strong</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"secondaryContent pairsInline meta"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase posted_by}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link members, $post}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">&gt;</span></span>{$post.username}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase date}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:datetime</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">time</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$post.post_date"</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase likes}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link posts/likes, $post}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"OverlayTrigger"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:number $post.likes}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dd</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dl</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sectionFooter"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase showing_x_posts, 'numPosts={xen:count $likedPosts}'}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now let's look at all the tags that we met here. <br><ul><li>  &lt;xen: title&gt; - the tag indicates the title of the page. </li><li>  &lt;xen: require&gt; - include the specified CSS file </li><li>  &lt;xen: navigation&gt; and &lt;xen: breadcrumb&gt; - define what will be shown in the form of a navigation chain.  In this case, it's just one link.  We will not consider more complex options here. </li><li>  {xen: link} - builds a URL using parameters (likes-review) according to the rules of the forum routing.  About routing a little later. </li><li>  {xen: phrase} simply inserts the phrase value in the language that the user specified in their settings.  If there is no translation for a phrase in this language, the original version in the main language will be shown.  In single quotes, a list of parameters for the phrase may follow.  Parameters inside a phrase are defined, as you have already noticed, with curly braces. </li><li>  {xen: count} - returns the number of records received as a result of a query to the database.  We will define the request later. </li><li>  &lt;xen: foreach&gt; - defines a foreach loop, as in PHP </li><li>  &lt;xen: avatar&gt; - inserts the user's avatar, determining it from the data specified in the user parameter. </li><li>  {xen: helper} is just a standard function inside a template for trimming long text.  Such functions can be defined and most. </li><li>  {xen: number} and &lt;xen: datetime&gt; - format the transmitted data, according to the settings specified in the current language (in which the user sees the page) </li><li>  Constructs like {$ post.username} - just insert the value with the username key from the array in the $ post template variable.  I will show how to transfer variables to a template a bit later. </li></ul><br>  That's all.  Please note that the template is incomplete (without, and so on).  That is, it's just the inside of the page, outside of which will be the standard elements of XenForo. <br><br>  Now a little about how XenForo handles requests.  If you are familiar with the MVC model, most likely you are well aware of this.  If not, in short it looks like this.  XenForo parses the HTTP request that arrives to it and, according to the rules of routing, determines which controller to transfer control for its processing.  The controller accepts the request, creates the data model (which, for example, simply reads the data from the database with the request), then builds the view (in fact, turns the templates into HTML code) and passes the model with the data to it.  The resulting messive is sent to the user's browser. <br><br>  In order for XenForo to understand which request to display our page with the list of the coolest messages on the forum, we first need to create a routing rule.  Go to the Development tab and click the link Prefixes for routing.  Create a new public prefix.  As prefix string, specify likes-review.  In the setting for using the class to generate a link, select Never, for the class name, specify LikeReviewRus_Route_Prefix_LikesReview.  Do not forget to choose the right supplement. <br><br>  Setup in the control panel is finished.  Now we get down to coding.  First, let's apply our class to handle the routing prefix.  Go to the Library folder and create a LikeReviewRus subdirectory there, in it the Route folder inside Prefix.  Here truly kashcheeva's death turned out.  Now create the file LikesReview.php. Its contents: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikeReviewRus_Route_Prefix_LikesReview</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XenForo_Route_Interface</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Match a specific route for an already matched prefix. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> XenForo_Route_Interface::match() */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">match</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($routePath, Zend_Controller_Request_Http $request, XenForo_Router $router)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $router-&gt;getRouteMatch(<span class="hljs-string"><span class="hljs-string">'LikeReviewRus_ControllerPublic_Index'</span></span>, <span class="hljs-string"><span class="hljs-string">'index'</span></span>, <span class="hljs-string"><span class="hljs-string">'likes-review'</span></span>); } }</code> </pre><br><br>  In this case, we say that when a likes-review prefix is ‚Äã‚Äãdetected (we set it up in the admin panel), we need to transfer control to the LikeReview_ControllerPublic_Index controller, transfer it as an ‚Äúindex‚Äù action, and like-review to the majorsection.  Kira's second mistake :) <br><br>  Now create the path \ library \ LikeReviewRus \ ControllerPublic, go there and create the Index.php file there.  Its contents are: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikeReviewRus_ControllerPublic_Index</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XenForo_ControllerPublic_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionIndex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $maxResults = XenForo_Application::get(<span class="hljs-string"><span class="hljs-string">'options'</span></span>)-&gt;LikeReviewRusMaxToDisplay; $likedPosts = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;_getLikeReviewModel()-&gt;getMostLikedPosts($maxResults); $viewParams = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'likedPosts'</span></span> =&gt; $likedPosts ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;responseView(<span class="hljs-string"><span class="hljs-string">'LikeReviewRus_ViewPublic_Index'</span></span>, <span class="hljs-string"><span class="hljs-string">'likereviewrus_index'</span></span>, $viewParams); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> LikeReview_Model_LikeReview */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getLikeReviewModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getModelFromCache(<span class="hljs-string"><span class="hljs-string">'LikeReviewRus_Model_LikeReview'</span></span>); } }</code> </pre><br><br>  What's going on here?  This controller has only one action defined (index, camelCase is used in the method name).  This action extracts the contents of the settings for the maximum number of results (remember, we created it).  Then a data model is created for the list of the coolest posts, then parameters are created to be passed to the view (just the parameters for the template, $ viewParams) and then the view is built (the likereview_index template, responseView is rendered) and parameters are passed to it.  The _getLikeReviewModel helper method simply pulls the model out of the shared cache if it has been cached. <br><br>  Now go to our data model.  Create a library \ LikeReviewRus \ Model path and log in there.  Create a LikeReview file.  Its contents are: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikeReviewRus_Model_LikeReview</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XenForo_Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Gets the most liked posts in descending order * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> integer Maximum posts to fetch * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> array */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMostLikedPosts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($limit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    -    xf_liked_content, //    $limitedSql = $this-&gt;limitQueryResults(" SELECT content_id, COUNT(*) AS likes FROM xf_liked_content WHERE content_type = 'post' GROUP BY content_id ORDER BY likes DESC ", $limit); //       (fetchCol)  ID     $postIds = $this-&gt;_getDb()-&gt;fetchCol($limitedSql); //            ID  //,            $postResults = $this-&gt;_getPostModel()-&gt;getPostsByIds($postIds, array ( 'join' =&gt; XenForo_Model_Post::FETCH_THREAD | XenForo_Model_Post::FETCH_USER )); //   ,       "" . $posts = array(); foreach ($postResults AS $post) { $posts["$post[likes].$post[post_date]"] = $post; } // krsort($posts); // return $posts; } /** * @return XenForo_Model_Post */ protected function _getPostModel() { //       return $this-&gt;getModelFromCache('XenForo_Model_Post'); } }</span></span></code> </pre><br><br>  Now try to go to <a href="http://www.xenforo.local/likes-review">www.xenforo.local / likes-review</a> .  You should see a list of posts with thanks.  Pay attention to the thick ugly frame of avatars :) <br><br>  Now we will try to add a bookmark on this page to the main navigation.  Go to the admin panel on the Development tab and create a new event handler.  We will process the navigation_tabs event.  The name of the handler class LikeReviewRus_Tabs_MainTab, the name of the addTab method. <br><br>  Create another template likereviewrus_links with the following content: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"secondaryContent blockLinksList"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link likes-review}"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:phrase LikeReviewRus_Header}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This is a template for creating sub-links for the main section.  For now, we only have one main link there. <br><br>  Create the library \ LikeReviewRus \ Tabs path, go there and create the MainTab.php file there.  Its contents are: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LikeReviewRus_Tabs_MainTab</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTab</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array &amp;$extraTabs, $selected)</span></span></span><span class="hljs-function"> </span></span>{ $extraTabs[<span class="hljs-string"><span class="hljs-string">'likes-review'</span></span>] =<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'title'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XenForo_Phrase(<span class="hljs-string"><span class="hljs-string">'LikeReviewRus_Header'</span></span>), <span class="hljs-comment"><span class="hljs-comment">//   'href' =&gt; XenForo_Link::buildPublicLink('likes-review'), //   'selected' =&gt; ($selected == 'likes-review'), //,      'linksTemplate' =&gt; 'likesreviewrus_links', //    - ); } }</span></span></code> </pre><br><br>  Navigation is ready.  In order for it to be beautifully displayed, you should include CNC references in the SEO forum settings.  In order to see which requests the page uses, open it by adding / _debug = 1 to the end.  In particular, you will see that calling new XenForo_Phrase generates a separate request, which is not good.  In order to avoid this, open the phrase LikeReviewRus_Header and check it so that it is added to the global cache. <br><br>  That's all.  I hope you liked it :) If any typos - report.  However, I think, after everything described, it will not be difficult for you to fix them yourself, if there are any. <br><br>  PS By the way, the <a href="http://www.xf-russia.ru/">Russian community XenForo</a> began developing its add-ons.  In particular, recently <a href="http://www.xf-russia.ru/forum/threads/xfb1-xfr-merge-double-user-post-v-1-0-0-ru.151/unread">an analogue of the add-on VBulletin appeared on our forum for pasting posts posted by the user</a> , written by <a href="http://www.xf-russia.ru/forum/members/pepelac.14/">Pepelac</a> . </div><p>Source: <a href="https://habr.com/ru/post/106046/">https://habr.com/ru/post/106046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../106032/index.html">Class for links</a></li>
<li><a href="../106035/index.html">IT benefits</a></li>
<li><a href="../106036/index.html">How to fit full time at 3 o'clock</a></li>
<li><a href="../106041/index.html">Release Opera 10.63</a></li>
<li><a href="../106042/index.html">Rethinking mobile phone concept</a></li>
<li><a href="../106048/index.html">Industrial robot Panasonic ‚ÄúParallel link‚Äù is able to learn new movements</a></li>
<li><a href="../106049/index.html">Alexey Komissarov - Head of the Business Incubator of the Academy of National Economy</a></li>
<li><a href="../106055/index.html">Kevin Nilsen speaking at Code Camp 2010</a></li>
<li><a href="../106057/index.html">A few words about hybrid encryption and elliptic curves</a></li>
<li><a href="../106059/index.html">Microsoft announces software to synchronize Windows Phone 7 devices with Macs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>