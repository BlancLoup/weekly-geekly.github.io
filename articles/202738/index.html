<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we turned the phone into a bank card</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We recently invited HTC One owners to take part in testing NFC payments and now we want to thank everyone who has joined and contributed to the develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we turned the phone into a bank card</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5b5/541/5d9/5b55415d9386e84b9151a00d4bbc73fa.jpg" alt="image"><br><br>  <a href="http://habrahabr.ru/company/ifree/blog/195214/">We</a> recently <a href="http://habrahabr.ru/company/ifree/blog/195214/">invited HTC One owners to take part in testing NFC payments</a> and now we want to thank everyone who has joined and contributed to the development of contactless payments in our country.  Today, the <a href="http://cardsmobile.ru/">Wallet</a> application is already available to all <a href="http://www.htc.com/ru/smartphones/htc-one/">HTC One</a> and <a href="http://www.philips.ru/c/cell-phone/xenium-w336-black-wcdma-gsm-ctw336blk_00/prd/ru/">Philips Xenium W336 owners</a> after updating the firmware, and in the near future, owners of HTC One Dual SIM, HTC One Max, HTC One SV, HTC Desire 500, HTC Desire 600 will also be able to use it and Philips Xenium W8555. <br><br>  In the comments to the previous post and habrodialogues there were many questions about how Wallet works and what needs to be done to put a bank card or travel ticket in it without removing the back cover of the phone and not using double-sided tape.  In this post I will try to answer these questions and tell you how it works. <br><a name="habracut"></a><br><h2>  How are the payment cards </h2><br>  A payment card (smart card) is a microprocessor placed in a piece of plastic of a standardized size that, when in contact with the reader, receives sufficient power for operation and starts the operating system with the payment application installed in it (most often Java applet in * nix-like operating system).  Contactless smart cards, which have long been public transport fare cards and are rapidly becoming bank cards ( <a href="http://www.paypass.ru/">MasterCard PayPass</a> , <a href="http://visa.com.ru/ru/ru-ru/personal/features/visapaywave.shtml">VISA PayWave</a> ), work on the same principle, only they get power from the electromagnetic field of the reader at the checkout or turnstile.  All contactless bank cards and the vast majority of transport combines the <a href="http://ru.wikipedia.org/wiki/ISO/IEC_14443">ISO 14443 standard</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A bank or transport company purchases ‚Äúblanks‚Äù of cards and records its application with the client‚Äôs ‚Äúpayment data‚Äù on them.  This process, called personalization, is carried out in the so-called perso-bureau, which can be both internal divisions of service providers and individual companies in the market.  In the process of personalization, the data on the card is encrypted and locked with keys, which makes it impossible to change them.  Moreover, the architecture of modern smart cards allows at the hardware level to distinguish their state before and after personalization, which completely excludes the possibility of changing (fake), for example, your billing information after the card is released. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a35/e3d/6ad/a35e3d6ade9a777925966a420e96ea6b.png" alt="image"></div><br>  The evolution of cards from magnetic stripe ( <a href="http://en.wikipedia.org/wiki/Magnetic_stripe_card">MagStripe</a> ) to smart cards with chip ( <a href="http://ru.wikipedia.org/wiki/EMV">EMV</a> ) and contactless interface ( <a href="http://ru.wikipedia.org/wiki/RFID">RFID</a> ) has led to the fact that the form factor of the card has ceased to matter.  This makes it possible to use any object as a ‚Äúcarrier‚Äù of a card: a plastic card, a watch, a bracelet, a sticker, a key ring and, of course, a smartphone. <br><br><h2>  How are NFC-phones </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/ac4/f65/e4c/ac4f65e4c96a0297f64c6f4157b8565d.png" alt="image" align="right">  NFC is just a wireless data transfer technology.  Same as Bluetooth or WiFi, it only works at a short distance and at a not very high frequency (13.56 MHz), which is its advantage, as it eliminates the possibility of a ‚Äúrandom‚Äù connection. <br><br>  At the same time, NFC is an extension of the existing standard of contactless smart cards ISO 14443, which, as we have already noted, is used in modern bank cards, passes to the office and to the parking lot, travel tickets to the metro, Troika and Podorozhniki.  In other words, the NFC standard inherits the entire ISO 14443 standard, due to which 100% compatibility of NFC smartphones, contactless cards and the existing reception infrastructure is realized. <br><br>  In an NFC-compatible phone, in order for it to be a full-fledged NFC device, besides the NFC antenna and the NFC controller, there must be a so-called Secure Element - a separate microprocessor, similar to that found in plastic cards.  He will be responsible for the safe storage and execution of payment applications (for example, MasterCard Mobile PayPass).  The Secure Element can be built-in (installed on the phone‚Äôs motherboard) or reside on a detachable module: a UICC SIM card or an SD memory card. <br><br><h2>  Write a payment card to the phone </h2><br>  If the NFC-enabled phone has the same microprocessor as plastic cards, the output suggests itself - you can write the same payment applications to the phone and make the same contactless payments by touching the phone to the reader. <br><br>  The first attempt to put the card on the phone in the Russian Federation was made by cellular operators, for example, <a href="http://www.mts.ru/bank_service/nfs_services/nfc/bank_russian_standart/">MTS and Russian Standard Bank</a> , <a href="http://svr.megafon.ru/services/finance/oplata_proezda.html">Megafon and a transport card in Yekaterinburg</a> , <a href="">Beeline and a transport card in Kazan</a> , etc.  To do this, they needed to purchase a batch of special UICC SIM-cards with a Secure Element, agree with the bank or the transport company about pre-registering a payment or transport application there, take the SIM-cards to the perso-bureau to implement the ‚Äúcontact personalization‚Äù process common in the industry old SIM cards for new subscribers in service centers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9f0/55a/3a9/9f055a3a9380ad06d42d2c738bac8d12.png" alt="image"></div><br>  Yes, you can put the card in the phone this way, and it works.  But what if you need another bank?  Or a transport company in another city?  Or maybe in two cities?  The SIM card will have to travel in all instances before it falls into your hands, and the cellular operator will have to agree with all these companies.  In this case, to reissue a bank card, for example, because of the expiration date, the operation will have to be repeated. <br><br><h2>  Remote personalization and TSM platform </h2><br>  Fortunately, unlike a plastic card, the phone is an interactive device that is always connected (be it Wi-Fi or a cellular network), which means you can write cards to it, firstly, remotely, and secondly, only those service providers that you need.  To implement this function, the role of TSM ( <a href="http://en.wikipedia.org/wiki/Trusted_service_manager">Trusted Service Manager</a> ) was formulated - a trusted intermediary uniting service providers (banks, transport, etc.) on the one hand, and Secure Element chips in all their forms, on the other.  It is this TSM platform that we developed at i-Free and certified for compliance with all necessary standards. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aad/ecd/c38/aadecdc3848b7fd2f53331dac47583ac.png" alt="image"></div><br>  The main functions of TSM: <br><br><ol><li>  <em>Aggregation of various service providers.</em>  A bank or other service provider connects to TSM using a standard protocol and gets access to a variety of secure element, i.e.  gets the opportunity to issue cards for multiple users.  At the same time, he does not need to negotiate separately with each mobile operator or with each phone manufacturer.  This part of TSM is called TSM Service Provider TSM. <br><br></li><li>  <em>Aggregation of various secure element.</em>  The owner of the Secure Element (cellular operator or phone manufacturer) connects to TSM using a standard protocol and gets access to many service providers, i.e.  gets the opportunity to provide its users with many services.  At the same time, it does not need to negotiate separately with each service provider, it does not need to take into account the features of each service, hardware and system capabilities of different Secure Element.  This part of the TSM is called the SEI TSM (Secure Element Issuer TSM). </li></ol><br><h2>  How the TSM platform works </h2><br>  The TSM platform provides remote control of Secure Element chips in users' phones through a secure communication channel.  At the direction of the service provider, TSM writes (or deletes, for example, in the event of a loss of a smartphone) personalization data of the card to the Secure Element of the phone, using the phone itself exclusively as a modem.  In addition, the platform allows service providers to remotely ‚Äúlook‚Äù at the data of cards issued by them, for example, to conduct an audit or to display on the phone the actual balance on the fare payment cards or loyalty cards (if the balance is stored on the card). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f89/05b/000/f8905b000768833bd9f517374e7e0cde.png" alt="image"></div><br>  The keys to the Secure Element are stored on highly specialized HSM (Hardware Security Module) servers, which are an integral part of the TSM platform.  Without the participation of the latter, it is impossible to access the chip - the plastic card industry works exactly according to this principle, only the keys are managed by the bank or the transport company that issued the card. <br><br>  Which card to pay for the purchase is chosen by the user through the Wallet application, which displays cards issued and available for issue, as well as accepting applications for issuing new cards.  The application is sent to the service provider, which instead of writing the billing data to a plastic card, sends this data through TSM to the Secure Element of the phone. <br><br><h2>  Custom application </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/34c/fbb/56a/34cfbb56a56f4a83bfdb9449823f6460.jpg" alt="image" align="right">  The Wallet application works in the operating system of the phone, which by definition is not secure, and, accordingly, the Wallet does not carry any security related functions.  The main role of the application, in addition to the demonstration of cards issued and available for release, is to provide a communication channel between the Secure Element and TSM, as well as to provide the user with interactive interfaces to the applications (cards) loaded in the Secure Element. <br><br>  In most cases, if the Wallet application uses the built-in Secure Element in phones, then it often does not make sense to upload it to Google.Play, since partnership with the phone manufacturers provides an important advantage: the manufacturer pre-installs the user application to the phone along with the firmware, it is not necessary promote, no need to download or install - it is already in the phone - the same native as the "Calculator". <br><br><h2>  Any card in any phone </h2><br>  To transform the phone into a bank card, TSM must access the Secure Element either from the manufacturer of this phone or from the owner of the SIM card (cellular operator).  Since payment cards are not transferred to the phone and are not ‚Äútied‚Äù (otherwise they will be considered ‚Äúduplicates‚Äù), but will be issued again, then to issue a bank card of a bank to the phone, this bank must connect to TSM. <br><br>  Thus, it will not be possible to release any card to any phone, but the movement in this direction is already underway, and it is obvious to all market participants that this is a logical evolutionary step.  Both phone manufacturers are interested in this (new functionality, which is more abundant than an extra megapixel in the camera), mobile operators (for about the same reason), and service providers (new audience and sales channel with interactive interaction), and users (tired of many different plastic cards). <br><br>  Today in the ‚ÄúWallet‚Äù you can issue a TCS Bank card, by the end of the year it will also be possible to pay transportation fees: the cities of Vologda and Cheboksary will start as a pilot zone.  Next year there will be much more cards available for release.  Contact you impressions! <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/W_CIgo84T4A%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700190,15700253&amp;usg=ALkJrhh3VUyBPlxQbVMsc8x7t62r3aUW_g" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  Afterword </h2><br>  Many of the processes (both technological and business) described in this post are greatly simplified to facilitate understanding of the whole picture.  Perhaps, in a sense, this text is even more suitable for Krestianka magazine than Habra, but this introductory material would not be enough for further publications concerning payment cards in the phone.  Based on your questions and comments, we will gradually reveal certain parts of this large and hopefully interesting topic. </div><p>Source: <a href="https://habr.com/ru/post/202738/">https://habr.com/ru/post/202738/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202722/index.html">Global satellite navigation technology: what are the systems, parameters and functions</a></li>
<li><a href="../202724/index.html">Contactless management: a view from the inside</a></li>
<li><a href="../202726/index.html">Bitcoin took the bar 700 dollars after a positive assessment of the virtual currency by the US Senate</a></li>
<li><a href="../202728/index.html">Phpstorm Life hacking: keep-alive automatic upload on the knee</a></li>
<li><a href="../202730/index.html">Only web, only hardcore</a></li>
<li><a href="../202740/index.html">Toaster. Update</a></li>
<li><a href="../202742/index.html">IP board Monitoring objects without software</a></li>
<li><a href="../202746/index.html">How to invest $ 100,000 in your own karma (part 3, final)</a></li>
<li><a href="../202748/index.html">Programming as a new kind of human activity</a></li>
<li><a href="../202750/index.html">Minesweeper, or again 30 lines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>