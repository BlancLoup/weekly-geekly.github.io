<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple clock on MSP430</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having read a huge number of articles about Arduino / LaunchPad wanted to buy a similar toy. The choice fell on the MSP430, since its price is much mo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple clock on MSP430</h1><div class="post__text post__text-html js-mediator-article">  Having read a huge number of articles about Arduino / LaunchPad wanted to buy a similar toy.  The choice fell on the MSP430, since its price is much more attractive to start in the world of microcontrollers. <br>  After a tedious 5 days of waiting, the magic box was in my hands.  After playing about 10 minutes with LEDs, I wanted to do something more interesting ... For example, watch! <br><img src="https://habrastorage.org/storage2/d7b/474/141/d7b4741417f97fe12903cf589ccd394d.png"><br><a name="habracut"></a><br><br>  At hand was an old Siemens A65, which became a donor for my small project.  We take the screen out of it and think how to connect it.  After a short googling, I successfully got to the branch of the <a href="http://www.radiokot.ru/forum/viewtopic.php%3Ff%3D20%26t%3D26497">RadioKot</a> forum, where pinouts and initialization of screens were discussed.  If someone faced the task of connecting a small screen to a microcontroller, then he knows that it is not enough to know the connection scheme, since there is a controller on the screen, to communicate with which you need to know the commands.  For example, to turn on the screen and display garbage from memory, some controllers need to send several dozen commands, and some have less than 10. So, often datasheets on the controllers are not found, and in that case only reading the screen initialization helps during its operation on the phone .  But I was lucky, the initialization and commands for my small screen (in my case LPH8731-3C with the EPSON S1D15G14 controller) were not only disassembled, but even datashit was found on it. <br><br>  And so, we look pinout, solder the wiring and connect to the microcontroller. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Pinout for LPH8731-3C</b> <div class="spoiler_text"><img src="https://habrastorage.org/storage2/e51/42b/610/e5142b61059303dccc053084929d6625.jpg"><br>  Pinout for LPH8731-3C.  (Taken from the <a href="http://www.radiokot.ru/forum/viewtopic.php%3Ff%3D20%26t%3D26497">RadioKot</a> forum) <br>  Where: <br><ul><li>  CS - Chip Select.  When it is in the Low state, the chip is ready to receive information. </li><li>  RESET - foot for resetting the controller.  A reset signal is a transition from High -&gt; Low -&gt; High (according to the controller's specification, a minimum time of 5 ms). </li><li>  RS - Used to determine the type of data transmitted (in the datasheet and in my designation as a CD).  To send a command it must be able to Low, for data transmission - High. </li><li>  CLK - serves as a clock signal for data transmission. </li><li>  DAT - for data transfer. </li><li>  VDD - according to the specification from + 1.6V to + 3.6V. </li><li>  GND - I hope you can guess yourself ?;) </li><li>  LED_A - both connectors for powering the backlight.  It is better to give voltage through a resistor (it is possible without it, but in my case one of the LEDs started to overheat, which made the light on the screen). </li><li>  LED_K is for GND. </li></ul><br>  By the way, some may have already noticed that SPI is used here for data transmission, so that CLK and DAT can be connected to the SPI MSP430 pin. <br></div></div><br><br><h4>  We get a "barrel organ" </h4><br><br>  Now we need to figure out how to communicate with the controller.  For a screen controller, there are 2 types of received data - a command or data.  To select the type of data used a separate pin.  As for the rest, the data transfer procedure is the same. <br><img src="https://habrastorage.org/storage2/a2b/0c1/620/a2b0c16200a95aad1d5430f07492f3ab.png"><br>  The procedure for transferring data to the controller, taken from the datasheet.  Here, for some reason, the status of the RS / CD pin is not indicated.  By the way, if during the data transmission the state of CS changes to Low -&gt; High, the data reception will stop.  But at the end of the data transfer, it is not necessary to pull the CS up (but it is recommended). <br><br><div class="spoiler">  <b class="spoiler_title">A bit of evil code</b> <div class="spoiler_text">  The code is for CSS (TI's Code Composer Studio). <br>  Here it is not completely, but only in pieces for example.  Comments in English, since I like it better :) <br><br>  LPH87313C.h <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/**********************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">/* Pins and outputs */</span></span> <span class="hljs-comment"><span class="hljs-comment">/**********************************************************/</span></span> <span class="hljs-comment"><span class="hljs-comment">// Chip Select line pin1.0 #define LCD_CS BIT7 #define LCD_CS_DIR P1DIR #define LCD_CS_OUT P1OUT // Hardware Reset pin1.1 #define LCD_RESET BIT6 #define LCD_RESET_DIR P1DIR #define LCD_RESET_OUT P1OUT // Command/Data mode line pin1.4 #define LCD_CD BIT3 #define LCD_CD_DIR P1DIR #define LCD_CD_OUT P1OUT // SPI #define SPI UCA0TXBUF</span></span></code> </pre> <br><br>  LPH87313C.c <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_SendCmd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Cmd)</span></span></span><span class="hljs-function"> </span></span>{ LCD_CS_OUT |= LCD_CS; <span class="hljs-comment"><span class="hljs-comment">// set CS pin to High LCD_CD_OUT &amp;= ~LCD_CD; // set CD pin to Low LCD_CS_OUT &amp;= ~LCD_CS; SPI = Cmd; } void LCD_SendDat(unsigned char Data) { LCD_CD_OUT |= LCD_CD; // set CD pin to High SPI = Data; }</span></span></code> </pre><br></div></div><br><br>  Now we know how to send data to the controller (or at least we have an idea).  Fortunately, the datasheet not only describes all the commands, but even has an example of the initial screen initialization.  In general, it can be divided into 3 stages: we do a controller reset (hardware &amp; software reset), set the initial parameter settings, turn on the display. <br><br><div class="spoiler">  <b class="spoiler_title">And there are a lot of commands sent</b> <div class="spoiler_text">  In principle, most of the parameters are set as is, but some things can be changed.  For example, the order in which the values ‚Äã‚Äãwill be written into memory (from top to bottom - from right to left / from bottom to top - from right to left / etc), contrast, as well as the color depth (256 colors or 4096). <br><br>  LPH87313C.c <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_Init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Set pins to output direction LCD_CS_DIR |= LCD_CS; LCD_RESET_DIR |= LCD_RESET; LCD_CD_DIR |= LCD_CD; LCD_CS_OUT &amp;= ~LCD_CS; LCD_RESET_OUT &amp;= ~LCD_RESET; LCD_CD_OUT &amp;= ~LCD_CD; __delay_cycles(160000); //wait 100ms (F_CPU 16MHz) LCD_RESET_OUT |= LCD_RESET; __delay_cycles(160000); LCD_SendCmd(0x01); //reset sw __delay_cycles(80000); LCD_SendCmd(0xc6); //initial escape LCD_SendCmd(0xb9); //Refresh set LCD_SendDat(0x00); __delay_cycles(160000); LCD_SendCmd(0xb6); //Display control LCD_SendDat(0x80); // LCD_SendDat(0x04); // LCD_SendDat(0x0a); // LCD_SendDat(0x54); // LCD_SendDat(0x45); // LCD_SendDat(0x52); // LCD_SendDat(0x43); // LCD_SendCmd(0xb3); //Gray scale position set 0 LCD_SendDat(0x02); // LCD_SendDat(0x0a); // LCD_SendDat(0x15); // LCD_SendDat(0x1f); // LCD_SendDat(0x28); // LCD_SendDat(0x30); // LCD_SendDat(0x37); // LCD_SendDat(0x3f); // LCD_SendDat(0x47); // LCD_SendDat(0x4c); // LCD_SendDat(0x54); // LCD_SendDat(0x65); // LCD_SendDat(0x75); // LCD_SendDat(0x80); // LCD_SendDat(0x85); // LCD_SendCmd(0xb5); //Gamma curve LCD_SendDat(0x01); // LCD_SendCmd(0xbd); //Common driver output select LCD_SendDat(0x00); // LCD_SendCmd(0xbe); //Power control LCD_SendDat(0x54); //0x58 before LCD_SendCmd(0x11); //sleep out __delay_cycles(800000); LCD_SendCmd(0xba); //Voltage control LCD_SendDat(0x2f); // LCD_SendDat(0x03); // LCD_SendCmd(0x25); //Write contrast LCD_SendDat(0x60); // LCD_SendCmd(0xb7); //Temperature gradient LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendDat(0x00); // LCD_SendCmd(0x03); //Booster voltage ON __delay_cycles(800000); LCD_SendCmd(0x36); //Memory access control LCD_SendDat(0x48); // LCD_SendCmd(0x2d); //Color set LCD_SendDat(0x00); // LCD_SendDat(0x03); // LCD_SendDat(0x05); // LCD_SendDat(0x07); // LCD_SendDat(0x09); // LCD_SendDat(0x0b); // LCD_SendDat(0x0d); // LCD_SendDat(0x0f); // LCD_SendDat(0x00); // LCD_SendDat(0x03); // LCD_SendDat(0x05); // LCD_SendDat(0x07); // LCD_SendDat(0x09); // LCD_SendDat(0x0b); // LCD_SendDat(0x0d); // LCD_SendDat(0x0f); // LCD_SendDat(0x00); // LCD_SendDat(0x05); // LCD_SendDat(0x0b); // LCD_SendDat(0x0f); // LCD_SendCmd(0x3a); //interface pixel format LCD_SendDat(0x03); // 0x02 for 8-bit 0x03 for 12bit __delay_cycles(1600000); LCD_SendCmd(0x29); //Display ON }</span></span></code> </pre><br></div></div><br><br><h4>  Our address is not a house or a street, our address is ... </h4><br><br>  Turning on the display, we will see either garbage or a white / black screen.  This is because the controller changes the state of the matrix relative to the internal memory, and by turning it on, it will display everything that it ‚Äúremembers‚Äù.  To display any information (or its changes), it is enough to change the memory and the controller updates the display (it updates the display constantly with a certain frequency specified in the initial setting, by default the refresh rate is 85Hz).  For example, to change the color of a pixel, you just need to write a new value in memory.  But first you need to specify the address where to write the new value.  If the computer simply sets the memory address and writes a new value, then you must specify the range of memory to which you can send data sequentially. <br><br>  For example, to fill the entire screen you need to select the beginning of the recording area (x0, y0) and the end (x101, y80).  And if you need to change the color of only one pixel, then respectively set the area [x, y] [x + 1, y + 1]. <br><br>  Having chosen a region, we can now simply send data and they will be sequentially stored in memory (and how exactly (from left to right, from top to bottom or vice versa) will depend on the initial setting).  For example, choosing the area 40x40px, we will need to send 1600 consecutive values ‚Äã‚Äã(although this is not quite so, but in order), which will be stored in the memory and this area will be completely updated.  And if you continue to send values, the update will continue from the next pixel (in this case, from the first). <br><br><div class="spoiler">  <b class="spoiler_title">Commands to set the area</b> <div class="spoiler_text"><pre> <code class="cpp hljs">LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2A</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   X (x0 - , x1 - ) LCD_SendDat(x0); LCD_SendDat(x1); LCD_SendCmd(0x2B); //   Y (y0 - , y1 - ) LCD_SendDat(y0+1); //   Y   1,   0 LCD_SendDat(y1+1); LCD_SendCmd(0x2C); //           </span></span></code> </pre><br></div></div><br><br><h4>  Letter for you!  True to Chinese ... </h4><br><br>  We have already figured out how to turn on the display and even how to choose an area for drawing, but how to send the color?  The display can work with 2 color palettes: <br><ul><li>  8bit (256 colors) </li><li>  12bit (4096 colors) </li></ul><br>  In the case of 8-bit color, everything is simple - just send 8 bits for each color (namely R2R1R0G2G1G0B1B0, where R2R1R0 is 3 bits red and so on. Red and green are 3 bits, and blue is 2 bits). <br>  But in the case of 12-bit color everything is dumb harder.  There are already 4 bits for each shade.  I will result a picture from. <br><img src="https://habrastorage.org/storage2/ec9/172/a9a/ec9172a9af5ed08049d187af77b49cb9.png"><br>  As you can see, one and a half bytes is used to send one color.  If you only need to change 1 pixel, then 2 bytes of information are sent, where in the second byte D3-D0 will not be used.  And if you need to change 2 pixels, then it is enough to send 3 bytes (where D3-D0 of the second byte will be the beginning, and D7-D0 of the third byte will be the continuation of the color for the second pixel). <br><br><div class="spoiler">  <b class="spoiler_title">Again a piece of code</b> <div class="spoiler_text">  An example of the function to fill the entire screen. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_Flush</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> R, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> G, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> B)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">4040</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> B0, B1, B2; B0 = ((R &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>) + (G &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>); B1 = ((B &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>) + (R &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>); B2 = ((G &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>) + (B &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>); LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2A</span></span>); LCD_SendDat(<span class="hljs-number"><span class="hljs-number">0</span></span>); LCD_SendDat(<span class="hljs-number"><span class="hljs-number">100</span></span>); LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2B</span></span>); LCD_SendDat(<span class="hljs-number"><span class="hljs-number">1</span></span>); LCD_SendDat(<span class="hljs-number"><span class="hljs-number">80</span></span>); LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2C</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (i--) { LCD_CD_OUT |= LCD_CD; SPI = B0; SPI = B1; SPI = B2; } }</code> </pre><br></div></div><br><br><h4>  And where is the promised watch? </h4><br><br>  And now the most difficult thing is to draw a watch.  As you can see, they are stylized as a segment indicator, so to display the clock, it is enough to draw 2 types of segments (vertical and horizontal) in different places. <br>  First you need to decide on the design.  Thanks to the great program from MS - Paint, it really helped me with this;). <br><img src="https://habrastorage.org/storage2/fd8/ecc/b25/fd8eccb25f9f2ed94b0a7780c8db76d6.png"><br>  Here's what I got.  Each segment is 12x4px in size (and vertical, respectively, on the contrary - 4x12px). <br><br>  And now let's remember about the choice of the drawing area.  You can also set the 12x4 area in the right place and draw a segment without redrawing the entire screen.  If you take a closer look at the segment, you can see that it is almost completely filled with one color, except for the corners.  So the segment drawing algorithm is quite simple: we start filling the memory with an empty color (unfortunately there is no transparency here, so we fill it with a background color), add checks for the upper right and lower left corner, and fill the last pixel with the background color too.  Similarly, for vertical.  And how to draw dots, I will not even tell :). <br><br><div class="spoiler">  <b class="spoiler_title">A set of swear words in an incomprehensible language</b> <div class="spoiler_text">  An example of a function for displaying a horizontal segment.  greenBright is the ‚Äúbright‚Äù color constant (for the active segment), greenDim is the color constant for the inactive segment.  BG0, BG1, BG2 are bit constants for drawing the background. <br>  And if you notice __delay_cycles - this is inexplicable magic, without which it does not work (although it‚Äôs likely that the hardware SPI doesn‚Äôt have time to send data, since it‚Äôs not sent in one clock cycle (but much faster, unlike if you implement sending it yourself)). <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawHorizontal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> i = <span class="hljs-number"><span class="hljs-number">22</span></span>, B2, B1, B0; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (type) { B0 = greenBright; B1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; B2 = (greenBright &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { B0 = greenDim; B1 = <span class="hljs-number"><span class="hljs-number">0</span></span>; B2 = (greenDim &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>; } LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2A</span></span>); LCD_SendDat(x); LCD_SendDat(x+<span class="hljs-number"><span class="hljs-number">11</span></span>); LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2B</span></span>); LCD_SendDat(y+<span class="hljs-number"><span class="hljs-number">1</span></span>); LCD_SendDat(y+<span class="hljs-number"><span class="hljs-number">4</span></span>); LCD_SendCmd(<span class="hljs-number"><span class="hljs-number">0x2C</span></span>); __delay_cycles(<span class="hljs-number"><span class="hljs-number">4</span></span>); LCD_CD_OUT |= LCD_CD; SPI = BG0; SPI = (BG1 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = B2; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i--) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">17</span></span>) { SPI = B0; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = (BG0 &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = (BG0 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span> + (BG1 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i == <span class="hljs-number"><span class="hljs-number">4</span></span>) { SPI = BG0; SPI = (BG1 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span>; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = B2; <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } SPI = B0; SPI = B1; SPI = B2; } SPI = B0; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = (BG0 &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>; __delay_cycles(<span class="hljs-number"><span class="hljs-number">2</span></span>); SPI = (BG0 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span> + (BG1 &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x0F</span></span>; }</code> </pre><br></div></div><br><br>  Now you need to turn the number into a set of segments (for example, to display 1, you need to draw only the right vertical segments).  I decided this quite simply - I created an array of segment values ‚Äã‚Äãfor different digits (from 0 to 9).  Substituting a digit into it, I get an array with values ‚Äã‚Äãof 1/0 that controlled the drawing of the segments.  For example, 1 means that the segment needs to be drawn, and 0 means that it is not necessary (or render it ‚Äúinactive‚Äù).  And knowing what and where to draw, make the function is not difficult. <br><div class="spoiler">  <b class="spoiler_title">Simple massif</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/******************************************************************************************** * Array for Clock * ____ * _|__1_|_ * |6| |2| * |_|____|_| * _|__7_|_ * |5| |3| * |_|____|_| * |__4_| * ********************************************************************************************/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> HH[<span class="hljs-number"><span class="hljs-number">10</span></span>][<span class="hljs-number"><span class="hljs-number">7</span></span>] = { {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, <span class="hljs-comment"><span class="hljs-comment">// 0 {0,1,1,0,0,0,0}, // 1 {1,1,0,1,1,0,1}, // 2 {1,1,1,1,0,0,1}, // 3 {0,1,1,0,0,1,1}, // 4 {1,0,1,1,0,1,1}, // 5 {1,0,1,1,1,1,1}, // 6 {1,1,1,0,0,0,0}, // 7 {1,1,1,1,1,1,1}, // 8 {1,1,1,1,0,1,1} // 9 };</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Clock drawing code</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawClock</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> hh, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mm, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dots)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> h0, h1, m0, m1; h0 = hh / <span class="hljs-number"><span class="hljs-number">10</span></span>; h1 = hh - (h0 * <span class="hljs-number"><span class="hljs-number">10</span></span>); m0 = mm / <span class="hljs-number"><span class="hljs-number">10</span></span>; m1 = mm - (m0 * <span class="hljs-number"><span class="hljs-number">10</span></span>); drawHorizontal(HH[h0][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>); drawHorizontal(HH[h1][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>); drawHorizontal(HH[m0][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>); drawHorizontal(HH[m1][<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">25</span></span>); drawVertical(HH[h0][<span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[h0][<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[h1][<span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[h1][<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[m0][<span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[m0][<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[m1][<span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawVertical(HH[m1][<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">91</span></span>, <span class="hljs-number"><span class="hljs-number">29</span></span>); drawHorizontal(HH[h0][<span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>); drawHorizontal(HH[h1][<span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>); drawHorizontal(HH[m0][<span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>); drawHorizontal(HH[m1][<span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">38</span></span>); drawVertical(HH[h0][<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[h0][<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[h1][<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">28</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[h1][<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">42</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[m0][<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">55</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[m0][<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">69</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[m1][<span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">77</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawVertical(HH[m1][<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">91</span></span>, <span class="hljs-number"><span class="hljs-number">42</span></span>); drawHorizontal(HH[h0][<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">51</span></span>); drawHorizontal(HH[h1][<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">31</span></span>, <span class="hljs-number"><span class="hljs-number">51</span></span>); drawHorizontal(HH[m0][<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">58</span></span>, <span class="hljs-number"><span class="hljs-number">51</span></span>); drawHorizontal(HH[m1][<span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">80</span></span>, <span class="hljs-number"><span class="hljs-number">51</span></span>); drawDots(dots); }</code> </pre><br></div></div><br><br>  And here we come to the end of the article.  Hopefully, I was able to explain the principle of their work as thoroughly as possible :) And for a snack, a small video of how they work and blink ‚Äúdots‚Äù. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/w53Q6lOOFHA%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhhpN7GmTuPGwiX21gfnFum3mvWiKg" frameborder="0" allowfullscreen=""></iframe><br><img src="https://habrastorage.org/storage2/d8b/78f/22f/d8b78f22f3e5cfe2a9b444f8b96c7ba1.jpg"><br><br>  <b>PS</b> <br>  Perhaps this article contains spelling, grammatical and punctuation errors.  If you find them, I urge you to send me a message in a personal, and not to write a comment. <br>  The article is not written about the implementation of watches as such because they are not completed :) It was originally planned to make a small gadget, where the display, external flash memory and external calendar clock would be used, but since I accidentally bought the wrong watch, everything got up :) One more reason - I wanted to use a larger display, but I could not buy a suitable one, for example from the Chinese Nokla n95 8gb.  Can someone tell me where to buy one? <br>  If someone needs the source code - contact me, I can share it :) If anyone has any questions about the implementation of displaying characters on the screen (printing text), I can also share the source code (I didn‚Äôt write about it, here‚Äôs an article about watches: ), and on a separate post also does not pull).  I can also share the library for working with the screen from Siemens CX75 (on the controller SSD-1286, there is even a datasheet), I wrote for myself, but accidentally burned it. </div><p>Source: <a href="https://habr.com/ru/post/159011/">https://habr.com/ru/post/159011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../158999/index.html">The portal Opera redirected users to a malicious resource</a></li>
<li><a href="../159001/index.html">The effect of turning the page. Now - patented</a></li>
<li><a href="../159003/index.html">Lambda functions and implementation of a convenient mechanism for Callbacks in C ++</a></li>
<li><a href="../159005/index.html">How to become a millionaire in the AppStore or a few formulas about promotion and sales. Part 2</a></li>
<li><a href="../159009/index.html">A small overview of Ingress or how to privatize the sights</a></li>
<li><a href="../159013/index.html">Making your local DNS (PDNSD), with blackjack and faster Google Public DNS</a></li>
<li><a href="../159017/index.html">SVG text</a></li>
<li><a href="../159019/index.html">Agile + UX: how to make friends with high-quality user interface and flexible methodologies</a></li>
<li><a href="../159023/index.html">We build Sypex Dumper into our admin area</a></li>
<li><a href="../159027/index.html">CSS sprites: basic techniques and useful tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>