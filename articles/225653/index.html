<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MIDI Wavy: make controlled color music using Arduino and MIDI</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. This manual describes the process of building controlled via MIDI-controller (or midi-track in any sequencer) color music on the Arduino. Initi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MIDI Wavy: make controlled color music using Arduino and MIDI</h1><div class="post__text post__text-html js-mediator-article">  Hello.  This manual describes the process of building controlled <i>via MIDI-controller (or midi-track in any sequencer)</i> color music on the Arduino.  Initially, I made this device for visualizing a live performance; 2 modes of operation are proposed: live play and MIDI track playback. <br><br>  The article is designed for beginners - everything that is needed is explained by the available, more advanced can simply get acquainted with this method of implementation, and, perhaps, use it in creating their own art installations or use it to dynamically control the light.  Knowing programming languages ‚Äã‚Äãis not necessary. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/w6mi8n6k38Y%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700186,15700190,15700253&amp;usg=ALkJrhjy65eg8YCbgaQNuaUuSebAB43POw" frameborder="0" allowfullscreen=""></iframe><br><a name="habracut"></a><br><h4>  Table of contents </h4><br><ol><li>  Visual model </li><li>  Components <br><ol><li>  LED lights </li><li>  Library for working with LED </li><li>  MIDI emulator and sequencer </li><li>  Arduino Communications - MIDI Controller </li><li>  MIDI controller </li><li>  Bread board </li></ol></li><li>  Reflectors </li><li>  Software part </li><li>  Ribbon Animation Example </li><li>  findings </li><li>  Demo video </li><li>  Files </li></ol><br>  MIDI Wavy will consist of: <br><ul><li>  4 homemade LED lights, </li><li>  <i>4 3-pin connectors of different lengths (50 and 30 cm) for communication LED &lt;-&gt; microcontroller,</i> </li><li>  microcontroller (for example, arduino), </li><li>  breadboard (enough is enough) </li><li>  any MIDI controller </li><li>  emulator (namely - Ableton Live + loopBe1) </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  ¬ß 1. Visual model </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/cb1/9ac/98f/cb19ac98fcc300da7aa511c0da05f51f.jpg" alt="image"><br><br>  The path from pressing the key to the moment the LED lights up: <br>  <b>MIDI controller</b> ‚Üí <b>Ableton Live (with ASIO)</b> ‚Üí <b>LoopBe1</b> ‚Üí <b>Hairless MIDI &lt;-&gt; Serial Bridge</b> ‚Üí <b>Arduino</b> ‚Üí <b>LED torch</b> <br><br>  Instead of a MIDI controller, you can use a computer keyboard in a sequencer. <br><br><h2>  ¬ß 2. Components </h2><br><h4>  ¬ß 2.1.  LED lights </h4><br>  The lantern is made of LED strip <b><a href="http://forum.cxem.net/index.php%3Fshowtopic%3D128470">5050 with WS2811 chip</a></b> , <b>5 diodes</b> on the lantern.  WS2811 allows you to control each LED separately, besides, the tape with capacitors is already soldered at the factory, and at the output we have 3 <b>DIN</b> , <b>5V</b> , <b>GND pins</b> .  Sold as without protection, and with a protective transparent silicone case.  To create a presentable device, it is best to use 3-pin connectors.  They are convenient to use, simplifying the removal of LEDs from the system. <br><img src="https://habrastorage.org/getpro/habr/post_images/7b0/bf7/507/7b0bf75071b5691ff8328431d9b867a6.jpg" alt="image"><br>  <i>(for example, ‚Äú15 cm JR 3pin servo extension for servo‚Äù. choose the length according to taste)</i> <br><br><h4>  ¬ß 2.2.  Library for working with LED </h4><br>  In the Arduino sketch, we include the <a href="http://fastled.io/">FastLED</a> library.  It is recommended that you familiarize yourself with <a href="https://github.com/FastLED/FastLED/wiki/Overview">interesting documentation</a> , where you can find the color code and other useful information. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b01/cdc/cef/b01cdccef4bf2e187f8931fa551edde0.jpg"><br><br>  The first time I did something like the one shown below.  Soldering all the lights, you need to check every work: <br><br><div class="spoiler">  <b class="spoiler_title">Show Arduino sketch to check LED</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-meta"><span class="hljs-meta">#include "FastLED.h" #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> NUM_LEDS 5 // 5  #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> DATA_PIN 6 // 6-     DIN   ( ) //     CRGB leds[NUM_LEDS]; void setup() { FastLED.addLeds&lt;NEOPIXEL, DATA_PIN&gt;(leds, NUM_LEDS); //  } void loop() { FastLED.showColor(CHSV(190,255,255)); //      }</span></span></code> </pre> </div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/495/a2a/f32/495a2af32bbd1c0e6db23acb3faf3609.jpg"><br><br>  <i>(this is an old version of a flashlight without a magic connector, just soldered wires from the arduino set, but the meaning does not change)</i> <br><br><h4>  ¬ß 2.3.  MIDI emulator and sequencer </h4><br>  The emulator is needed when we want to connect a sequencer (let Ableton Live) with our color music to control the change of the light pattern in real time, or to play the recorded change.  Anyone will do, but I took <a href="http://www.nerds.de/en/loopbe1.html">LoopBe1 (http://www.nerds.de/en/loopbe1.html)</a> .  Install, reboot, open the sequencer.  The essence of the sequencer setting is to make an output from the sequencer to the virtual MIDI channel, in order to connect this channel with the Arduino. <br><br>  Go to the settings Ableton Live, or in any other, and configure the MIDI-OUTPUT output to our MIDI-emulator: <br><br><div class="spoiler">  <b class="spoiler_title">Show Sequencer Settings</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/eb3/c31/8b8/eb3c318b8f6a80564eac1a0fe1f295ac.png" alt="image"><br><br>  In the sequencer we create 2 MIDI tracks.  On the first one, we put any synthesizer (I advise Drum Rack, because you can conveniently customize the names of the keys, which will help you navigate through all this more easily), then do MUTE on it (you can really not do it if you want to work directly on this track) , and the second is left blank, we do the following setting: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a7/132/316/7a71323163d5ceb2c82726d91bdc396c.png" alt="image"><br><br>  Activate the I / O button (item 2 in the figure), set the settings for the second track (item 1). <br><ul><li>  <b>MIDI From:</b> 1-Drum Rack (specify from where to "take the signal" - from the first track). </li><li>  <b>Pre FX</b> (any value can be used, but Pre FX is used so that the effects from the first round go at the same time as the second one, it is better to read more on the Internet, in this problem it does not matter). </li><li>  <b>Monitor:</b> Auto </li><li>  <b>MIDI To:</b> LoopBe Internal MIDI (choose the name of the MIDI emulator) </li><li>  <b>Ch:</b> 1. (by default, the first (first) channel is used. In total, 16 channels are available, that is, as many as 16 layers of midi messages (notes). It is useful to use different channels when creating a more complex LED control system). </li></ul><br>  Hold down the CTRL button and activate both tracks (point 3 in the figure).  Is done.  Pay attention to paragraph 4 in the figure, this is exactly what I said, then it will be convenient to work with it.  For example, through the editor of notes. <br><br>  <i>In the figure above, the same kind of note map as presented in area No. 4 can be achieved as follows: throw any audio file into the Drum Rack cell (I used kick.wav), right-click on it, ‚ÄúRename‚Äù (or CTRL) + R).</i> <br><br><h5>  <i>Optional:</i> ASIO Driver </h5><br>  This is a sound card emulator, with it you can get a very low delay between pressing a key and the result of signal processing (for comparison, on the basic settings of the sequencer, if you switch between keys a lot and quickly, there will be a delay between pressing a key and starting the LED) . <br><br>  You can find it <a href="http://www.asio4all.com/">on the official site</a> , freely available. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ea/794/74f/4ea79474fae2cfa6e9960b1ce7b7b9f8.png" alt="image"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Creating a MIDI track</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ca4/e0b/725/ca4e0b7251325682f24f01e7400ed37b.png"><br><br>  ‚Üë Let‚Äôs go into the arranging mode, the more expensive the LED must be the None option in step 2 in the figure, otherwise the MIDI clip cannot be created.  Select the zone and create a new clip. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ea/5bf/1ee/8ea5bf1ee97899fc8055a686f2e86c7d.png"><br><br>  ‚Üë Add notes.  For example, the figure above shows the alternate switching of the LEDs on the LEFT_LONG tape.  As soon as the note ends, the LED turns off immediately.  It turns out a sharp flicker of the tape in one direction: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f3/918/fe2/9f3918fe254bbb225eb37ed871b9f1af.gif"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f94/22d/336/f9422d336909d05fa24355f56ec69ce4.png"><br><br>  ‚Üë By lengthening the notes, you can create a loop that is more pleasant to contemplate than just alternating the working LED: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/20f/48b/1cc/20f48b1ccdc7a96f5f1db53aef9c2f67.gif"><br><br>  By changing the value of beats per minute, you can change the track playback speed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/da2/dc2/743/da2dc2743fc10b2fa6bb81b2432d9a17.gif"><br><br>  If we want to make music, then simply add an audio track with an audio file as you need (dragging it to the workspace).  To make the light go in sync with the music, make a Warp sound clip.  <a href="http://wikisound.org/Ableton_Live_%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25B2%25D0%25B0%25D1%2580%25D0%25BF%25D0%25B8%25D0%25BD%25D0%25B3_%25D1%2581%25D1%258D%25D0%25BC%25D0%25BF%25D0%25BB%25D0%25BE%25D0%25B2">More details.</a> <br><br></div></div><br><br><h5>  Arduino Communications - MIDI Controller </h5><br>  Using the <a href="http://projectgus.github.io/hairless-midiserial/">hairless-midiserial program (http://projectgus.github.io/hairless-midiserial/),</a> we create the Serial &lt;-&gt; MIDI bridge (the values ‚Äã‚Äãfrom the emulator / controller will be transmitted via the Serial-port): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/894/c17/5ec/894c175ecc835a1edb657aaf0bfc5351.png" alt="image"><br><br>  <i>As you can see, MIDI In is the entrance to the bridge, Serial port is the output from the bridge to the Arduino.</i>  <i>In this setting, you can directly connect any MIDI controller, for example a MIDI keyboard, but to be honest, the keyboard did not want to work directly with me, apparently you need some kind of special.</i>  <i>application, let's deal with it whenever possible somehow, but control of light through a midi + sequencer is more convenient.</i>  <i>Of the minuses - the sequencer program can load quite slowly.</i> <br><br><h4>  ¬ß 2.4.  MIDI controller </h4><br>  Absolutely anyone will fit (depending on your tasks, of course) a controller that you can buy at a music store, or you can assemble it yourself (there are instructions on the Internet how to do this).  And if you are writing electronic music, then you probably have such a keyboard.  You can use both the keys and the keys themselves.  Each key (note) "hangs" the execution of certain commands, similarly with twists.  In this example, 3 twists (denoted by Master, Color, Delay) and four octave notes are used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2de/e78/290/2dee7829099147afd657250f06f096ff.png" alt="image"><br><br>  <b>In Ableton, FL Studio, etc.</b>  <b>you can do without a MIDI controller.</b>  <b>In these programs, you can use a regular PC keyboard as a piano.</b> <br><br><h4>  ¬ß 2.5.  Bread board </h4><br>  For a prototype device, it is enough to connect everything on one small breadboard.  In the future, it will not be difficult to replace the prototype board with a printed circuit board (soldering all that is necessary will not fall off).  Cases for the device are in some stores with arduino or radio engineering, aluminum, cost from ~ 300 <s></s> depending on the size. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a71/6e6/d93/a716e6d938878b476596ead668ae69da.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/083/e54/dfd/083e54dfd213e9c4fdc220ae0c3c75bc.jpg" alt="image"><br><br>  <i>Unsafe breadboard SYB-170 10x17 holes 60 <s>P</s> ;</i>  <i>Aluminum case 100 * 76 * 35 mm, golden.</i>  <i>300 <s>rub</s> .</i> <br><br><h2>  ¬ß 3. Reflectors </h2><br>  The directivity of the radiation of LEDs can be set using reflectors of arbitrary types.  At will it is possible to fasten any reflector which you can.  I took a plastic corner for the walls - it is matte, white and well illuminated.  One inside (let it be lower) will be glued with aluminum tape (or some kind of mirror), and the other will be left.  Direct the radiation to the non-pasted side, get a frosted glow of the reflector, and limited (ie it will seem that all or some part of the reflector is shining, depending on the proportions of the length of the reflector to the length of the tape).  It is not necessary to glue the tape, but then the reflection coefficient will be less.  It is possible on the contrary, to paste over all areas of the reflector. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/196/cea/335/196cea3354ae73a23a001936a94e08c7.jpg" alt="image"><br><br>  There are reflectors with different textures that affect the shape of the radiation, but we will not consider them. <br><br><h2>  ¬ß 4. Software part </h2><br><h5>  Arduino sketch </h5><br>  To begin with, we will connect the necessary libraries, set the type byte to all variables (it stores from 0 to 255, we just need the values, the rest will not be used): <br><div class="spoiler">  <b class="spoiler_title">Show code part 1</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// MIDI Wavy // JVLNS.ORG 2014 //      #include "FastLED.h" //     ,    #define LEFT_LONG 7 #define LEFT_SHORT 6 #define RIGHT_SHORT 5 #define RIGHT_LONG 4 #define NUM_STRIPS 4 //   #define NUM_LEDS_PER_STRIP 5 //    1  //       CRGB leds[NUM_STRIPS][NUM_LEDS_PER_STRIP]; //     ,      byte colors[] = {0, 32, 64, 96, 128, 160, 192, 224, 239 }; //    Master () - byte ColorBasic = 0; byte Master = 255; byte commandByte; //   MIDI-,      (noteOn, noteOff, Controller) byte noteByte; //  ( ) byte velocityByte; //   ‚Äî  (  noteOn/Off   velocity (https://www.ableton.com/en/manual/editing-midi-notes-and-velocities),   Controller ‚Äî   ). byte velocityByte1; //   map()  0-127  0-255 byte noteOn = 144; //   byte noteOff = 128; //   byte faza = 0; //       delay(faza)   </span></span></code> </pre></div></div><br>  Lantern designation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ad/d73/244/5add73244bf84e48a91854730b756094.png" alt="image"><br><br>  <i>(Note: 0, 1, 2, 3 - numbers of cells in the array)</i> <br><br>  <i>Code, part 2.</i> Set the <b>setup ()</b> function: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  Serial-   256000 Serial.begin(256000); FastLED.addLeds&lt;NEOPIXEL, LEFT_LONG&gt;(leds[0], NUM_LEDS_PER_STRIP); FastLED.addLeds&lt;NEOPIXEL, LEFT_SHORT&gt;(leds[1], NUM_LEDS_PER_STRIP); FastLED.addLeds&lt;NEOPIXEL, RIGHT_SHORT&gt;(leds[2], NUM_LEDS_PER_STRIP); FastLED.addLeds&lt;NEOPIXEL, RIGHT_LONG&gt;(leds[3], NUM_LEDS_PER_STRIP); }</span></span></code> </pre><br>  This method of marking LED strips is necessary for simultaneous control of each tape independently of the other.  Read more <a href="https://github.com/FastLED/FastLED/wiki/Multiple-Controller-Examples">on the FastLED library documentation page</a> . <br><br>  The fact is that 8-bit controllers do not support multi-threading, the code is executed sequentially.  Piling up code slows down its execution.  This method of connecting and working with LEDs (we will consider further) in some sense solves this problem, the program slows down less, and therefore each keystroke will be taken into account (from experience I‚Äôll say that I used to do it differently and there were a lot of jambs with passing note due to delays or misalignments).  In addition, changing the properties of LEDs is much more convenient by this method. <br><br>  We start the Serial-port through which the microcontroller will communicate with the computer.  We specify 256000. In the settings of Hairless Bridge we specify the same <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D0%25BE%25D0%25B4">speed</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af0/a0d/f05/af0a0df0542e5f86d47ef62c7ff0766e.png" alt="image"><br><br>  Let's create a couple of functions that will turn on and off the LEDs with certain settings: <br><br><div class="spoiler">  <b class="spoiler_title">Show code, part 3</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// pointer()           // num_strip =   ( 0  3,    [ ]) // num_led =       num_strip // master =   // color =  void pointer(byte num_strip, byte num_led, byte master, byte color) { leds[num_strip][num_led] = CHSV(color, 255, master); FastLED.show(); } // blackout()           void blackout(byte num_strip, byte num_led) { leds[num_strip][num_led] = CHSV(0, 0, 0); FastLED.show(); }</span></span></code> </pre></div></div><br><br>  Define the function of working with MIDI commands: <br><br><div class="spoiler">  <b class="spoiler_title">Show code part 4</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkMIDI</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">do</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   3   if (Serial.available()){ commandByte = Serial.read();//read first byte noteByte = Serial.read();//read next byte velocityByte1 = Serial.read();//read final byte velocityByte = map(velocityByte1, 0, 127, 0, 255); Master = velocityByte; //  Master   Velocity  //     if(noteByte == 96) ColorBasic = colors[0]; if(noteByte == 97) ColorBasic = colors[1]; if(noteByte == 98) ColorBasic = colors[2]; if(noteByte == 99) ColorBasic = colors[3]; if(noteByte == 100) ColorBasic = colors[4]; if(noteByte == 101) ColorBasic = colors[5]; if(noteByte == 102) ColorBasic = colors[6]; if(noteByte == 103) ColorBasic = colors[7]; if(noteByte == 104) ColorBasic = colors[8]; //  if (commandByte == 176 &amp;&amp; noteByte == 22)ColorBasic = velocityByte; // Color if(commandByte == 176 &amp;&amp; noteByte == 21) Master = velocityByte; // Master if(commandByte == 176 &amp;&amp; noteByte == 23) faza = velocityByte; // Velocity // LEFT_LONG if(noteByte == 36) { //C1 if(commandByte == noteOn) pointer(0, 0, Master, ColorBasic); else if(commandByte == noteOff) blackout(0, 0); } if(noteByte == 38) { if(commandByte == noteOn) pointer(0, 1, Master, ColorBasic); else if(commandByte == noteOff) blackout(0, 1); } if(noteByte == 40) { if(commandByte == noteOn) pointer(0, 2, Master, ColorBasic); else if(commandByte == noteOff) blackout(0, 2); } if(noteByte == 41) { if(commandByte == noteOn) pointer(0, 3, Master, ColorBasic); else if(commandByte == noteOff) blackout(0, 3); } if(noteByte == 43) { if(commandByte == noteOn) pointer(0, 4, Master, ColorBasic); else if(commandByte == noteOff) blackout(0, 4); } // end left_long // LEFT_SHORT if(noteByte == 45) { if(commandByte == noteOn) pointer(1, 0, Master, ColorBasic); else if(commandByte == noteOff) blackout(1, 0); } if(noteByte == 47) { if(commandByte == noteOn) pointer(1, 1, Master, ColorBasic); else if(commandByte == noteOff) blackout(1, 1); } if(noteByte == 48) { if(commandByte == noteOn) pointer(1, 2, Master, ColorBasic); else if(commandByte == noteOff) blackout(1, 2); } if(noteByte == 50) { if(commandByte == noteOn) pointer(1, 3, Master, ColorBasic); else if(commandByte == noteOff) blackout(1, 3); } if(noteByte == 52) { if(commandByte == noteOn) pointer(1, 4, Master, ColorBasic); else if(commandByte == noteOff) blackout(1, 4); } // end left_short // RIGHT_SHORT if(noteByte == 53) { if(commandByte == noteOn) pointer(2, 0, Master, ColorBasic); else if(commandByte == noteOff) blackout(2, 0); } if(noteByte == 55) { if(commandByte == noteOn) pointer(2, 1, Master, ColorBasic); else if(commandByte == noteOff) blackout(2, 1); } if(noteByte == 57) { if(commandByte == noteOn) pointer(2, 2, Master, ColorBasic); else if(commandByte == noteOff) blackout(2, 2); } if(noteByte == 59) { if(commandByte == noteOn) pointer(2, 3, Master, ColorBasic); else if(commandByte == noteOff) blackout(2, 3); } if(noteByte == 60) { if(commandByte == noteOn) pointer(2, 4, Master, ColorBasic); else if(commandByte == noteOff) blackout(2, 4); } // end right_short // RIGHT_LONG if(noteByte == 62) if(commandByte == noteOn) pointer(3, 0, Master, ColorBasic); else if(commandByte == noteOff) blackout(3, 0); } if(noteByte == 64) { if(commandByte == noteOn) pointer(3, 1, Master, ColorBasic); else if(commandByte == noteOff) blackout(3, 1); } if(noteByte == 65) { if(commandByte == noteOn) pointer(3, 2, Master, ColorBasic); else if(commandByte == noteOff) blackout(3, 2); } if(noteByte == 67) { if(commandByte == noteOn) pointer(3, 3, Master, ColorBasic); else if(commandByte == noteOff) blackout(3, 3); } if(noteByte == 69) { if(commandByte == noteOn) pointer(3, 4, Master, ColorBasic); else if(commandByte == noteOff) blackout(3, 4); } // end right_long if(noteByte == 72) { //  C4,  LEFT_LONG   if(commandByte == noteOn) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) pointer(0, i, Master, ColorBasic); } else if(commandByte == noteOff) { //   ‚Äî   for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) blackout(0, i); } } if(noteByte == 74) { //  LEFT_SHORT   if(commandByte == noteOn) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) pointer(1, i, Master, ColorBasic); } else if(commandByte == noteOff) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) blackout(1, i); } } if(noteByte == 76) { //  RIGHT_SHORT   if(commandByte == noteOn) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) pointer(2, i, Master, ColorBasic); } else if(commandByte == noteOff) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) blackout(2, i); } } if(noteByte == 77) { //  RIGHT_LONG   if(commandByte == noteOn) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) pointer(3, i, Master, ColorBasic); } else if(commandByte == noteOff) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) blackout(3, i); } } // ,    if(noteByte == 37) { for(byte x = 0; x &lt; NUM_STRIPS; x++) { // This inner loop will go over each led in the current strip, one at a time for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) { leds[x][i] = CRGB::Black; FastLED.show(); } } } //   if(noteByte == 73){ if(commandByte == noteOn) { for(byte x = 0; x &lt; NUM_STRIPS; x++) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) { leds[x][i] = CHSV(ColorBasic, 255, 255); FastLED.show(); leds[x][i] = CRGB::Black; delay(faza); //      Delay } } } // end Note ON else if(commandByte == noteOff) { for(byte i = 0; i &lt; NUM_LEDS_PER_STRIP; i++) blackout(3, i); } }// end note On // end noteByte 73 //          faza  ,    i  . if(noteByte == 75 &amp;&amp; commandByte == noteOn) { faza = map(faza, 0, 200, 0, 3); for(byte i = 255; i &gt; 0; i--) { FastLED.showColor(CHSV(ColorBasic, 255, i)); delay(faza); } } }// end if }// end do while (Serial.available() &gt; 2);//   3  }</span></span></code> </pre></div></div><br>  Comments on the code: as you noticed, when you press a key, a certain LED lights up, several simultaneously pressed keys will give a continuous glow, for example, one of the tapes, until the key is released.  This allows you to create smooth transitions from one LED to another, creating a loop. <br><br>  It happens that the LED hangs and does not turn off, for this purpose it was assigned to note 37 "RESET, DISABLE ALL LEDS". <br><br>  The values ‚Äã‚Äãin the MIDI commands can be taken <a href="http://www.midi.org/techspecs/midimessages.php">from here (http://www.midi.org/techspecs/midimessages.php)</a> , or you can directly track the key pressed in the <b>hairless-midiserial</b> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/47e/0fa/ee4/47e0faee4135389cb8820f150e7567e1.png" alt="image"><br><br>  You can (but not necessarily) add another function - a simple transfusion of all LEDs with color.  Then the device can be used as a night light: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Rainbow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> delay_time</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> hue = <span class="hljs-number"><span class="hljs-number">0</span></span>; hue &lt; <span class="hljs-number"><span class="hljs-number">255</span></span>; hue++) { FastLED.showColor(CHSV(hue,<span class="hljs-number"><span class="hljs-number">255</span></span>,<span class="hljs-number"><span class="hljs-number">255</span></span>)); delay(delay_time); } }</code> </pre><br><br>  Code, part 5. And the final touch, set the <b>loop ()</b> function: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loop</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     MIDI checkMIDI(); //      .    ,     .   - ,     ,      . delay(50); }</span></span></code> </pre><br><br><h2>  ¬ß 5. Sample tape animations </h2><br><h4>  Wave </h4><br><ul><li> <a href="https://drive.google.com/file/d/0BxYCcOv1ZLcham9lZkxHLTJSNkE/"><img src="http://1450707750181454033057"></a>  <a href="https://drive.google.com/file/d/0BxYCcOv1ZLcham9lZkxHLTJSNkE/">Download MIDI file</a> </li></ul><br>  The ‚Äúlonger‚Äù the notes that you press / insert, the more blurry the picture is due to the ghost effect being created: <br><br>  Consider an example. <br><br><br><br>  Duplicate the notes several times, and each time we lower the Velocity notes by a certain level, say 25%.  In this case, you can specify the tail more precisely: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/RGK5OeCsi1g%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700186,15700190,15700253&amp;usg=ALkJrhiExCFoD-Z9Niv_xjRPan8z-lXzyw" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  ¬ß 6. Conclusions </h2><br><h4>  ¬ß 6.1.  Price issue </h4><br><ul><li>  One such LED costs about 17 rubles, we need 20 such =&gt; 340 <s>P.</s> </li><li>  Arduino (chose one of the cheapest) 400 <s>p</s> . </li><li>  Connectors 4 pcs - I do not remember exactly, about 100 <s>P</s> came out. </li><li>  Development Board - 60 <s>.</s> </li><li>  Total: 908 <s></s> (excluding wires from the Arduino set) </li></ul><br>  The most expensive - LEDs and a microcontroller.  In general, if you are in the subject line, then in terms of arduino, you can use cheaper things. <br><br><h4>  ¬ß 6.2.  Application area </h4><br>  Basically it is the lighting design of installations, concerts, structures, etc.  Restriction on fantasy.  For example, I use MIDI Wavy to highlight my tracks.  LEDs help to give a special atmosphere and drive to the music, but look - do not kill people with epilepsy.  It is desirable to use it with smoke, then the radiation picture looks much more powerful and cooler. <br><br>  I use the simplified version of the control without the midi controller in the backlight of my bike, but about it later. <br><br>  You can twist this case for learning to play the piano, or for your child's color programming, or to improve his memory (although such toys are sold in stores and they are much more compact, but we are not looking for easy ways). <br><br>  If you are interested, I wish you good luck in your endeavors!  Be sure to send a link to your work. <br><br><h2>  ¬ß 7. Demonstration video </h2><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/LLY2iqSLIL8%3Ffeature%3Doembed&amp;xid=17259,1500004,15700022,15700186,15700190,15700253&amp;usg=ALkJrhh2FEWC17CJHLQP-nASO2wnP0QpUg" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  ¬ß 8. Links and files </h2><br><ul><li> <a href="https://drive.google.com/file/d/0BxYCcOv1ZLchSHRlaUcwR0NkcHc/"><img src="http://1450707750181454033057"></a>  <a href="https://drive.google.com/file/d/0BxYCcOv1ZLchSHRlaUcwR0NkcHc/">Download Arduino Sketch</a> </li><li> <a href="https://drive.google.com/file/d/0BxYCcOv1ZLchTlpjdXk5dElWQnM/"><img src="http://1450707750181454033057"></a>  <a href="https://drive.google.com/file/d/0BxYCcOv1ZLchTlpjdXk5dElWQnM/">Download project in Ableton</a> </li><li> <a href="https://drive.google.com/file/d/0BxYCcOv1ZLcham9lZkxHLTJSNkE/"><img src="http://1450707750181454033057"></a>  <a href="https://drive.google.com/file/d/0BxYCcOv1ZLcham9lZkxHLTJSNkE/">Download MIDI file</a> </li><li>  <a href="http://www.midi.org/techspecs/midimessages.php">Midi messages</a> </li><li>  <a href="https://github.com/FastLED/FastLED/wiki/Overview">FastLED library</a> </li><li>  <a href="http://www.adafruit.com/datasheets/WS2811.pdf">Datashit on WS2811 chip</a> </li><li>  <a href="http://www.djtechtools.com/2010/03/08/diy-midi-kit_review/">Making your MIDI controller on the Arduino (English)</a> </li><li>  <a href="http://cxem.net/arduino/arduino18.php">Transferring MIDI data from Arduino to computer</a> </li><li>  <a href="http://www.instructables.com/id/Arduino-Sensors-and-MIDI/">Useful Fiction about Arduino and MIDI (Large useful article in English)</a> </li><li>  <a href="http://vk.com/sorption">Music in video</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/225653/">https://habr.com/ru/post/225653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225643/index.html">Antenna for Wi-Fi on your knee in 10 minutes</a></li>
<li><a href="../225645/index.html">Development of Iframe applications on VK API. From the first cones to the two millionth audience</a></li>
<li><a href="../225647/index.html">IText: we take out the text from PDF</a></li>
<li><a href="../225649/index.html">Creating a custom component based on a ListView</a></li>
<li><a href="../225651/index.html">How to teach a player to understand your application, not nullifying the work of artists, not offending programmers and not considering players mentally retarded</a></li>
<li><a href="../225655/index.html">Syncthing sync + installer review on Raspberry Pi and Macbook</a></li>
<li><a href="../225657/index.html">How to legalize income from Google AdSense for PI</a></li>
<li><a href="../225659/index.html">AngularJS. Data organization</a></li>
<li><a href="../225661/index.html">Space cycles in radioactive decay</a></li>
<li><a href="../225663/index.html">Writing a bot for the Stronghold Kingdoms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>