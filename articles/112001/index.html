<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using bulkloader to backup, restore and migrate data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bulkloader is an interface in Google App Engine for loading data from / to storage on Google servers. Bulkloader is useful for backing up / restoring ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using bulkloader to backup, restore and migrate data</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://code.google.com/appengine/docs/python/tools/uploadingdata.html">Bulkloader</a> is an interface in Google App Engine for loading data from / to storage on Google servers.  Bulkloader is useful for backing up / restoring / migrating application data, but the documentation and usage examples are too low, and you will have to run into various problems and bugs in a complex application.  I myself have been digging up various sources of information for quite a long time, digging through the source code of the SDK, reading the bugs, writing my own desktop workflows;  and now I am ready to present some of the fruits in the form of a detailed article. <br><br>  The article is very large, keep in mind. <br><a name="habracut"></a><br>  I will not particularly go into the details of creating App Engine applications, this topic has been repeatedly raised and examples can be found in the sea, including in Russian.  However, synthetic examples are usually poorly perceived, so we will consider the ‚Äúreal‚Äù application - the personal blog engine, the topic is well-known and understandable.  And as the backup file format, select plain XML. <br><br>  Retelling the <a href="http://code.google.com/appengine/docs/python/tools/uploadingdata.html">documentation</a> here also will not. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Terminology </h5><br>  There is no Russian-language established terminology, so I allowed myself some liberty, calling ‚ÄúKind‚Äù either ‚Äúclass‚Äù or ‚Äútype‚Äù.  ‚ÄúEntity‚Äù has remained ‚Äúentity‚Äù. <br><br>  Import = deserialization = restore.  Export = serialization = backup. <br><br><h5>  Training </h5><br>  Hereinafter we use GAE SDK version 1.4.1 or higher on a local unix / linux machine, on windows everything is almost the same.  When working with the application on google servers, there are certain nuances, but you can read about them in the official documentation, but here we are only working with a local server. <br><br>  The main programs of the GAE SDK (appcfg.py, dev_appserver.py) should be available for execution in the console (the paths to the SDK are specified in the appropriate environment variables, for example). <br><br><h5>  What is bulkloader </h5><br>  Bulkloader is a Python framework, and to use it you will have to not only write configuration files, but also code.  But, having mastered the framework, you will get a very powerful mechanism for saving and restoring data from your server inside App Engine. <br><br>  You choose which format to store data on the local machine, and bulkloader converts it according to certain rules (import and export).  At the end of the article there is a link by which you can learn more about bulkloader. <br><br>  In order for the bulkloader to work, the application first needs to enable an access point to the API.  So, turn on remote_api, for this we add a section to the application configuration (app.yaml) (if it is not there) <br><br><pre>  builtins:
 - remote_api: on </pre><br>  This section includes an access point to the API at http: // servername / _ah / remote_api, for a local server with default settings it will be http: // localhost: 8080 / _ah / remote_api. <br><br><h5>  Data schema </h5><br>  Let's start with the data scheme of the application.  Everything is clear for a blog: Articles (Article), Comments (ArticleComment), RenderedArticle.  Comments are presented in the form of a tree.  The rendered html article is stored in a separate repository entity. <br><br>  Entity classes refer to each other as follows: <br><br>  Article ‚Üí RenderedArticle (link to a rendered article in an article) <br>  ArticleComment ‚Üí Article (link to article from comment) <br>  ArticleComment ‚Üí ArticleComment (link to parent comment) <br><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RenderedArticle</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span> html_body = db.TextProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span> shortcut = db.StringProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) title = db.StringProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) body = db.TextProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) html_preview = db.TextProperty() rendered_html = db.ReferenceProperty(RenderedArticle) published = db.DateTimeProperty(auto_now_add=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) updated = db.DateTimeProperty(auto_now_add=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) tags = db.StringListProperty() is_commentable = db.BooleanProperty() is_draft = db.BooleanProperty() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleComment</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(db.Model)</span></span></span><span class="hljs-class">:</span></span> parent_comment = db.SelfReferenceProperty() name = db.StringProperty() email = db.StringProperty() homepage = db.StringProperty() body = db.TextProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) html_body = db.TextProperty(required=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) published = db.DateTimeProperty(auto_now_add=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) article = db.ReferenceProperty(Article) ip_address = db.StringProperty() is_approved = db.BooleanProperty(default=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) is_subscribed = db.BooleanProperty(default=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre> <br><br>  It is clear from the models that many different types of data are used: two kinds of references, dates, strings, booleans, lists.  Looking ahead, I note that the lists and links have the biggest problems. <br><br><h5>  Checking the work of bulkloader </h5><br>  We fill the database with data and check the work of the bulkloader via the API: <br><br><pre>  appcfg.py download_data --email = doesntmatter -A wereword --url = http: // localhost: 8080 / _ah / remote_api --kind = Article --filename = out.dat </pre><br><br>  In the -A parameter, we specify the name of the application, in the --email parameter any string (for the local server it is not important), in the --kind parameter - the entity class that we want to download (look at the download_data argument).  After executing the command (just press Enter when prompted for a password) a file with a backup of the specified entity class (out.dat) and a bunch of different logs will appear in the current directory (files like bulkloader- *).  The default backup format is SQLITE3, the resulting file (out.dat) can be opened in any SQLITE3 viewer and studied.  Its structure is of little use for practical use (for example, migration), so we will continue to write the config (and other related files) for the bulkloader so that the data export is made in a more convenient format for us. <br><br><h5>  Writing a configuration file for bulkloader </h5><br>  The current SDK version supports two data export / import formats: CSV and XML, we will use the second one.  The configuration file is already familiar to you YAML-file, it describes exactly how the data is transformed when exporting / importing data from the repository.  The official documentation says how to generate the basic config from the application, but we will write it from scratch.  This file is called config.yaml, I usually create a separate backup directory in the application tree and place everything I need in it, it practically doesn‚Äôt intersect with the main application. <br><br>  At the beginning - in the python_preamble section - those python modules are defined that will be needed during the export / import process.  Here is the ‚Äúgentleman's set‚Äù of modules, base64 and re are standard python modules, google. * Are modules from the SDK, but helpers is our own module, the helpers.py file located in the current directory.  In helpers.py, we will have various workflows and other useful functions for importing / exporting data, but in the beginning just create an empty file with that name, add the code later. <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">python_preamble</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">base64</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">re</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">google</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.appengine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bulkload</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.transform</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">google</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.appengine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bulkload</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bulkloader_wizard</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">google</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.appengine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.ext</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.db</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">google</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.appengine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.api</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.datastore</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">google</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.appengine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.api</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.users</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">import</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">helpers</span></span></code> </pre> <br><br>  The next section of the config is transformers, it describes the ‚Äúconverters‚Äù of entities into the local backup format and vice versa.  Here you should describe all the fields of the entity class that you need.  Each entity class is described in a separate section named kind, here is the simplest example of such a section, in which we describe the converter for the Article class: <br><br><pre> <code class="hljs pgsql">transformers: - kind: Article connector: simplexml #   connector_options: #   xpath_to_nodes: "/blog/Articles/Article" # XPath,          style: element_centric #    <span class="hljs-type"><span class="hljs-type">XML</span></span>,    ‚Äî - property_map: - property: __key__ external_name: key export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string</code> </pre> <br>  A small note, XPath support is very weak, you really can only use the expression "/ AAA / BBB / CCC". <br><br>  Now download the data from the server using the newly created config (option --config): <br><br><pre>  appcfg.py download_data --email = doesntmatter -A wereword --url = http: // localhost: 8080 / _ah / remote_api --kind = Article --config = test.yaml --filename = Article.xml </pre><br><br>  And we get this final XML containing data about two objects: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Articles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Articles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Please note that only the fields that we described in the configuration file in the transformers section are included in the XML;  in our case, this is only a recording key.  In the export_transform parameter, we have specified a specific converter for this field - transform.key_id_or_name_as_string.  This is a feature from the google.appengine.ext.bulkload.transform module.  For fields of a different type, other converter functions are used, and the usual lambda expression on python can act as such a converter. <br><br>  And now the whole piece of the config describing the entity class Article: <br><br><pre> <code class="hljs pgsql">- kind: Article connector: simplexml connector_options: xpath_to_nodes: "/blog/Articles/Article" style: element_centric property_map: - property: __key__ external_name: key export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string - property: rendered_html external_name: rendered-html export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string # deep key! It<span class="hljs-string"><span class="hljs-string">'s required here! import_transform: transform.create_deep_key(('</span></span>Articl<span class="hljs-string"><span class="hljs-string">e', '</span></span>key<span class="hljs-string"><span class="hljs-string">'), ('</span></span>RenderedArticl<span class="hljs-string"><span class="hljs-string">e', transform.CURRENT_PROPERTY)) - property: shortcut external_name: shortcut - property: body external_name: body - property: title external_name: title - property: html_preview external_name: html-preview - property: published external_name: published export_transform: transform.export_date_time('</span></span>%Y-%m-%dT%H:%M<span class="hljs-string"><span class="hljs-string">') import_transform: transform.import_date_time('</span></span>%Y-%m-%dT%H:%M<span class="hljs-string"><span class="hljs-string">') - property: updated external_name: updated export_transform: transform.export_date_time('</span></span>%Y-%m-%dT%H:%M<span class="hljs-string"><span class="hljs-string">') import_transform: transform.import_date_time('</span></span>%Y-%m-%dT%H:%M<span class="hljs-string"><span class="hljs-string">') - property: tags external_name: tags import_transform: "lambda x: x is not None and len(x) &gt; 0 and eval(x) or []" - property: is_commentable external_name: is-commentable import_transform: transform.regexp_bool('</span></span>^<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>$<span class="hljs-string"><span class="hljs-string">') - property: is_draft external_name: is-draft import_transform: transform.regexp_bool('</span></span>^<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>$<span class="hljs-string"><span class="hljs-string">')</span></span></code> </pre> <br><br>  Let's analyze it in detail.  For each object field, a property parameter is set, which describes the data conversion rules for this field. <br><br>  The external_name parameter specifies the name of the corresponding element in the XML file. <br><br>  In the parameter import_transform is a function for importing data, it converts the data from the backup into the required field data type.  We can assume that this is deserialization. <br><br>  In the parameter export_transform - the function of converting a field into text, which will be recorded in backup, serialization of data. <br><br>  For simple types (String, for example), an explicit description of the import and export functions is not needed, the standard one is used, which is quite sufficient.  On the other types of talk separately. <br><br>  Let's start with the rendered_html field, it is, firstly, a reference (reference) to an object of another class (in our case, RenderedArticle), and secondly, this object of the RenderedArticle class is a <a href="http://code.google.com/appengine/docs/python/datastore/entities.html">child</a> of the corresponding Article object.  Therefore, during deserialization, it is necessary to ‚Äúconstruct‚Äù a valid link to an object; this is done from the values ‚Äã‚Äãof two fields using the standard transform.create_deep_key method: <br><br><pre> <code class="hljs pgsql"> - property: rendered_html external_name: rendered-html export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string # deep key! It<span class="hljs-string"><span class="hljs-string">'s required here! import_transform: transform.create_deep_key(('</span></span>Articl<span class="hljs-string"><span class="hljs-string">e', '</span></span>key<span class="hljs-string"><span class="hljs-string">'), ('</span></span>RenderedArticl<span class="hljs-string"><span class="hljs-string">e', transform.CURRENT_PROPERTY))</span></span></code> </pre> <br><br>  Note that in the import / export_transform parameters there should be expressions that eventually result in a function that takes one argument and returns one value.  And in the example above, we see a function call with specific arguments, this function is a kind of decorator and returns the already prepared function for data conversion.  transform.create_deep_key accepts several two-element tuples as input, each of which reflects one level in the chain of object relations, and the tuple itself contains the name of the entity class and the element name (from the XML file);  key fields are generated from the specified fields. <br><br>  In our case, the chain consists of two objects, and we use the value transform.CURRENT_PROPERTY to get rid of specifying the name of the field of the current object from the chain of relations.  In principle, instead of transform.CURRENT_PROPERTY it is quite possible to write rendered_html. <br><br>  Fields with dates also require a special approach, but everything is simple here - we use function generators from the SDK, in the argument we specify a date / time formatting pattern: <br><br><pre> <code class="hljs delphi"> - <span class="hljs-keyword"><span class="hljs-keyword">property</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">published</span></span> external_name: <span class="hljs-keyword"><span class="hljs-keyword">published</span></span> export_transform: transform.export_date_time(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%dT%H:%M'</span></span>) import_transform: transform.import_date_time(<span class="hljs-string"><span class="hljs-string">'%Y-%m-%dT%H:%M'</span></span>)</code> </pre> <br><br>  Fields with a list of strings, here the standard method is used for serialization, so you do not need to write anything, but for import you need a special approach: <br><br><pre> <code class="hljs vbscript"> - <span class="hljs-keyword"><span class="hljs-keyword">property</span></span>: tags external_name: tags import_transform: <span class="hljs-string"><span class="hljs-string">"lambda x: x is not None and len(x) &gt; 0 and eval(x) or []"</span></span></code> </pre> <br>  When exporting (serializing), the list of strings is converted to an element of this type: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span>[u'x2', u'another string']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  However, an empty list of strings is converted to an empty string: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And when importing using a standard converter, an empty field will be converted to None, which is obviously not a valid list and will cause problems when trying to read this field in an application.  Therefore, we use a lambda expression that performs the correct (relatively) transformation.  However, because of the <a href="http://code.google.com/p/googleappengine/issues/detail%3Fid%3D3646">bug in the SDK,</a> it will still help you a little, since an error in the field type validator. <br><br>  When working with Boolean fields, we also use a simple converter for deserialization: <br><br><pre> <code class="hljs pgsql"> - property: is_commentable external_name: <span class="hljs-keyword"><span class="hljs-keyword">is</span></span>-commentable import_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.regexp_bool(<span class="hljs-string"><span class="hljs-string">'^True$'</span></span>)</code> </pre> <br>  With standard export, boolean values ‚Äã‚Äãare converted to strings ‚ÄúTrue‚Äù and ‚ÄúFalse‚Äù, while we use an even more general method during import ‚Äî only the string ‚ÄúTrue‚Äù is converted to True, and all others are converted to False. <br><br>  The resulting XML file with the imported objects of the Article class looks like this: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Articles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>aaa bbb ccc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span>2011-01-20T08:19<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-draft</span></span></span><span class="hljs-tag">&gt;</span></span>False<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-draft</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>this is new article<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-preview</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>aaa bbb ccc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-preview</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shortcut</span></span></span><span class="hljs-tag">&gt;</span></span>short-cut-1295418565<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shortcut</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rendered-html</span></span></span><span class="hljs-tag">&gt;</span></span>7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rendered-html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span>2011-01-19T06:29<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-commentable</span></span></span><span class="hljs-tag">&gt;</span></span>True<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-commentable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>ff gg hh<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span>2011-01-19T06:30<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">updated</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-draft</span></span></span><span class="hljs-tag">&gt;</span></span>False<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-draft</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>another article<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-preview</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>ff gg hh<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-preview</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span>[u'x2']<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tags</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shortcut</span></span></span><span class="hljs-tag">&gt;</span></span>short-cut-1295418590<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shortcut</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rendered-html</span></span></span><span class="hljs-tag">&gt;</span></span>9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rendered-html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span>2011-01-19T06:29<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">published</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-commentable</span></span></span><span class="hljs-tag">&gt;</span></span>True<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">is-commentable</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Articles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><h5>  Work with object relationship chains </h5><br>  Relationships or dependencies between objects are lined up using the parent argument when creating an object of some class of entities.  A new object then falls into the same <i>group of entities</i> as the one specified in parent.  This approach allows you to use, for example, transactions to preserve the integrity of the data.  Chains of relations during import and export must be processed in a special way.  And here there are several nuances that we consider below. <br><br>  So, we have a Article entity class, objects of this type are articles, it contains the source code of the article in the markup language, a small preview and other service information.  And the article text rendered in html code is stored in a separate object of the RenderedArticle class.  The separation of the rendered text into a separate entity class was made in order to circumvent the limitation on the overall size of an object adopted in App Engine, and in fact the Article and RenderedArticle objects act in relation to the one-to-one relationship.  The RenderedArticle object is created in the same entity group as the Article object. <br><br>  Here is what the config.yaml config part of the RenderedArticle entity class looks like <br><br><pre> <code class="hljs pgsql">- kind: RenderedArticle connector: simplexml connector_options: xpath_to_nodes: "/blog/RenderedArticles/Article" style: element_centric property_map: - property: __key__ external_name: key export: - external_name: ParentArticle export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string_n(<span class="hljs-number"><span class="hljs-number">0</span></span>) - external_name: key export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string_n(<span class="hljs-number"><span class="hljs-number">1</span></span>) import_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.create_deep_key((<span class="hljs-string"><span class="hljs-string">'Article'</span></span>, <span class="hljs-string"><span class="hljs-string">'ParentArticle'</span></span>), (<span class="hljs-string"><span class="hljs-string">'RenderedArticle'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.CURRENT_PROPERTY)) - property: html_body external_name: html-body</code> </pre> <br><br>  Notice how the data export is described in the example above.  First, one key field of the object is converted into <i>two</i> elements in the backup.  Secondly, during import, the key field is ‚Äúassembled‚Äù from the values ‚Äã‚Äãof two elements - the ParentArticle and key.  The transform.key_id_or_name_as_string_n (0) code returns a function that, as a result of execution on the key field, returns the specified component of the composite key. <br><br>  The generated XML based on this config looks like this: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RenderedArticles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ParentArticle</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ParentArticle</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>aaa bbb ccc<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>7<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ParentArticle</span></span></span><span class="hljs-tag">&gt;</span></span>8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ParentArticle</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>ff gg hh<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html-body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>9<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Article</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RenderedArticles</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">blog</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Now consider the export-import of the object of the ArticleComment class, I remind you that comments are a tree, that is, a comment can have a ‚Äúparent‚Äù comment, in addition, each comment has a link to the parent post. <br><br><pre> <code class="hljs pgsql">- kind: ArticleComment connector: simplexml connector_options: xpath_to_nodes: "/blog/Comments/Comment" style: element_centric property_map: - property: __key__ external_name: key export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string import_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.create_deep_key((<span class="hljs-string"><span class="hljs-string">'Article'</span></span>, <span class="hljs-string"><span class="hljs-string">'article'</span></span>), (<span class="hljs-string"><span class="hljs-string">'ArticleComment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.CURRENT_PROPERTY)) - property: parent_comment external_name: parent-<span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string import_transform: helpers.create_deep_key((<span class="hljs-string"><span class="hljs-string">'Article'</span></span>, <span class="hljs-string"><span class="hljs-string">'article'</span></span>), (<span class="hljs-string"><span class="hljs-string">'ArticleComment'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.CURRENT_PROPERTY)) - property: article external_name: article export_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.key_id_or_name_as_string import_transform: <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.create_foreign_key(<span class="hljs-string"><span class="hljs-string">'Article'</span></span>) - property: <span class="hljs-type"><span class="hljs-type">name</span></span> external_name: <span class="hljs-type"><span class="hljs-type">name</span></span> - property: body external_name: body</code> </pre> <br><br>  At first glance, everything looks simple, but at one point the ‚Äúsilent‚Äù behavior of the converters breaks down.  Note that the parent_comment field can be None, which means a top-level comment.  If we use the transform.create_deep_key method in the import process, we get an error on the value None: <br><br><pre>  BadArgumentError: Expected an integer id or string name as argument 4;  received None (a NoneType). </pre><br>  I also <a href="http://code.google.com/p/googleappengine/issues/detail%3Fid%3D4324">started a bug</a> about this error, but so far I haven‚Äôt received any reaction from the developers to it.  To bypass this bug, use the helpers.py file, where we place the replacement of the transform.create_deep_key method.  Workeround is very simple, we only generate the key if the value is not None: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_deep_key</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*path_info)</span></span></span><span class="hljs-function">:</span></span> f = transform.create_deep_key(*path_info) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_deep_key_lambda</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(value, bulkload_state)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> f(value, bulkload_state) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> create_deep_key_lambda</code> </pre> <br>  In the comments I can tell in more detail about what is happening in this function, if anyone is interested. <br><br>  Thus, when an optional object reference is restored correctly. <br><br>  Now we are working with the article field, which contains a link to the article to which the comments belong.  To restore an object reference, we use the transform.create_foreign_key method, it works similarly to the transform.create_deep_key method, only without regard to chains of relationships.  Here I want to draw attention to a potential bug, if the link to the object is empty, during restoration you will encounter exactly the same error that a couple of paragraphs are higher. <br><br><h5>  Conclusion </h5><br>  It is quite possible to work with bulkloader, but very carefully.  You need to constantly monitor the announcements and read the documentation carefully after each release of the SDK, since not all changes are included in the changelog.  Also overboard is an overview of working with binary data, but everything is simple: <br><br><pre> <code class="hljs haskell"> - property: <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> external_name: </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class"> export_transform: base64.b64encode import_transform: transform.blobproperty_from_base64</span></span></code> </pre> <br><br>  Next time we will talk about the features of localization in GAE-python-django applications. <br><br><h5>  Links </h5><ul><li>  <a href="http://code.google.com/appengine/docs/python/tools/uploadinganapp.html">Bulkloader documentation home page</a> </li><li>  <a href="http://bulkloadersample.appspot.com/showfile/bulkloader-presentation.pdf">PDF with the presentation of bulkloader on Google IO'2010</a> , I strongly recommend to see, there is described in detail the whole scheme of this subsystem </li><li>  <a href="http://bulkloadersample.appspot.com/">Demo site bulkloader</a> , examples from the presentation </li><li>  <a href="http://code.google.com/p/wereword-gae">A test project</a> in which I run around the methods of working with GAE. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/112001/">https://habr.com/ru/post/112001/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111992/index.html">The final version of the open source development environment SharpDevelop 4.0 has been released.</a></li>
<li><a href="../111994/index.html">Do you use the www prefix in the addresses of your sites?</a></li>
<li><a href="../111995/index.html">qrTip: plugin for displaying QR codes for links</a></li>
<li><a href="../111998/index.html">How to spend less time watching videos and listening to audiobooks</a></li>
<li><a href="../111999/index.html">Statistics for users using Piwik</a></li>
<li><a href="../112002/index.html">A major reorganization awaits Skype this year.</a></li>
<li><a href="../112004/index.html">Jim Collins book abstract ‚ÄúFrom Good to Great‚Äù</a></li>
<li><a href="../112008/index.html">Increase your choice of IT partners with erumpo</a></li>
<li><a href="../112009/index.html">Facebook offers limited access to phone and home address of users to third-party applications.</a></li>
<li><a href="../112011/index.html">Presented a layout of the new user interface LibreOffice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>