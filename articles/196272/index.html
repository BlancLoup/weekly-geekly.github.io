<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What are scripts and what they eat - Lua & C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habrahabr! 
 I decided to write this topic on the topic of scripts 

 What you need to know? 


- C ++ at a decent level (there will be temp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What are scripts and what they eat - Lua & C ++</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habrahabr! <br>  I decided to write this topic on the topic of scripts <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f86/12e/069/f8612e0691da4500e2a8733425c372e3.gif"><h4>  What you need to know? </h4><br><ul><li>  C ++ at a decent level (there will be templates in the lesson) </li><li>  Lua, a very easy scripting language.  I advise <a href="http://tylerneylon.com/a/learn-lua/">this</a> lesson. </li></ul><br><h4>  Why writing game dialogs in a .cpp file was a big mistake. </h4><br>  If you have developed large projects (for example, large-scale games), have you noticed that with each new hundred lines of code, the compilation is slower? <br>  The game creates more weapons, more dialogues, more menus, more etc. <br>  One of the main problems arising in connection with innovations is to maintain the innumerable number of weapons and badges rather difficult task. <br>  In a situation where a friend / boss / teammate request to change the dialogue or add a new type of weapon takes too much time, you have to resort to some measures - for example, recording all this garbage in separate text files. <br>  Almost every game developer has ever made a level map or dialog in a separate text file and then read them.  Take at least the simplest option - Olympiad tasks in computer science with an input file <br><br>  But there is a way, head down - using scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h4>  Solution to the problem </h4><br>  ‚ÄúOkay, for such cases a regular file with a description of player characteristics is enough.  But what to do if in a rapidly developing project almost every day you have to slightly change the logic of the main player, and, therefore, compile the project many times? ‚Äù <br>  Good question.  In this case, scripts come to the rescue, holding exactly the logic of the player with all the characteristics or some other part of the game. <br>  Naturally, it‚Äôs best to keep the player‚Äôs logic in the form of a programming language code. <br>  The first thought - to write your own interpreter of your scripting language, is thrown out of the brain in a few seconds.  The logic of the player is definitely not worth such terrible costs. <br>  Fortunately, there are special libraries of scripting languages ‚Äã‚Äãfor C ++, which take a text file as input and execute it. <br><br>  One such scripting language Lua will be discussed. <br><br><h4>  How it works? </h4><br>  Before you begin, it is important to understand how a scripting language works.  The fact is that there are very few functions in scripting languages, in the presence of for, while, if, and other constructs. <br>  These are mainly text output functions in the console, math functions and functions for working with files. <br>  How, then, can a player be controlled through scripts? <br><br>  We in the C ++ program do any functions, ‚Äúregister‚Äù them under some name in the script and call it in the script.  That is, if we registered the SetPos (x, y) function to determine the player's position in the C ++ program, then, having encountered this function in the script, the ‚Äúinterpreter‚Äù from the script language library calls this function in the C ++ program, of course with the transfer of all methods. <br>  Amazing right?  :) <br><br>  <b>UPD:</b> Attention!  One user sent me a mail that when I filled in the code, I didn‚Äôt completely eliminate all errors - <a href="http://habrahabr.ru/post/196272/">habrahabr.ru/post/196272/#comment_6850016</a> <br>  In the code with the permission of Habr penetrated bugs <br>  Replace sections of code like <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodName</span></span></span><span class="hljs-class">();</span></span></code> </pre> <br>  On <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MethodName</span></span></span><span class="hljs-class">();</span></span></code> </pre><br>  And instead of lua_CFunction skips lua_cfunction <br>  Thank! <br><br><h4>  I'm ready! </h4><br>  When you understand the benefits of scripting programming languages, it's time to start working! <br>  Download from the repository on the githab (bottom of the topic) lib'u and includ'y Lua, or take them on the official website. <br><br>  Create a console project or Win32 (it does not matter) in Visual Studio (I have version 2012) <br><br>  Go to Project-&gt; Properties-&gt; Configuration Properties-&gt; VC ++ directories and in the ‚Äúinclude directories‚Äù and ‚Äúlibrary catalogs‚Äù add the folder Include and Lib from the repository, respectively. <br><br>  Now create the main.cpp file, write in it: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br>  As you guessed, I have a console application. <br><br>  Now go to coding <br><br>  I promise that I will carefully explain every moment. <br><br>  We will be responsible for the scripts class Script.  I will declare and simultaneously implement functions in Script.h / .cpp <br>  Create Script.cpp and write in it. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Script.h"</span></span></span></span></code> </pre><br>  Create Script.h and write in it. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _SCRIPT_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _SCRIPT_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span></span></code> </pre><br>  After 2 lines and before #endif we define the class of scripts <br>  This code is written to prevent mutual inclusion of files.  Suppose that the Game.h file connects Script.h, and Script.h connects Game.h - disorder!  And with this code inclusion is performed only 1 time. <br><br>  Now we write inside this code <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> comment(lib,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lua.lib"</span></span></span><span class="hljs-meta">) extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;lua.h&gt; #include &lt;lualib.h&gt; #include &lt;lauxlib.h&gt; }</span></span></span></span></code> </pre><br>  The first line connects lua.lib from the archive itself. <br>  What is extern "C" for?  The fact is that lua is written in C and therefore such code is needed to connect the libraries. <br><br>  Next comes the connection of well-known files for working with the console. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;iostream&gt; #include &lt;sstream&gt; using namespace std;</span></span></span></span></code> </pre><br><br>  Now we proceed to class definition. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Script</span></span></span><span class="hljs-class"> {</span></span></code> </pre><br>  The main object of the Lua library for C ++ is lua_State, it is required for script execution. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: lua_State *lua_state;</code> </pre><br>  Next come the public functions. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br>  This function initializes lua_State <br><br><div class="spoiler">  <b class="spoiler_title">Create ()</b> <div class="spoiler_text">  Its definition in Script.cpp <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Create() { lua_state = luaL_newstate(); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> luaL_Reg lualibs[] = { {<span class="hljs-string"><span class="hljs-string">"base"</span></span>, luaopen_base}, {<span class="hljs-string"><span class="hljs-string">"io"</span></span>, luaopen_io}, {<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>} }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> luaL_Reg *lib = lualibs; lib-&gt;func != <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; lib++) { luaL_requiref(lua_state, lib-&gt;name, lib-&gt;func, <span class="hljs-number"><span class="hljs-number">1</span></span>); lua_settop(lua_state, <span class="hljs-number"><span class="hljs-number">0</span></span>); } }</code> </pre><br>  The first line we initialize our lua_State. <br>  Then we declare a list of "connected libraries."  The fact is that in the ‚Äúpure‚Äù form in Lua there is only a function print ().  For mathematical and other functions, you need to connect special libraries and then call them as math.foo, base.foo, io.foo.  To connect other libraries, add to lualibs, for example, {"math", luaopen_math}.  All library names begin with luaopen _..., at the end of lialibs must be {NULL, NULL} <br></div></div><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Close</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><br>  This feature frees Lua resources. <br><div class="spoiler">  <b class="spoiler_title">Close ()</b> <div class="spoiler_text">  Her definition <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Close() { lua_close(lua_state); }</code> </pre><br>  Just use lua_close () <br></div></div><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* ScriptFileName)</span></span></span></span>;</code> </pre><br>  And this function executes the file.  It accepts the file name as input, for example, ‚ÄúC: \\ script.lua‚Äù. <br>  Why does it return an int?  Just some scripts may contain return, interrupting the script and returning some value. <br><br><div class="spoiler">  <b class="spoiler_title">Dofile ()</b> <div class="spoiler_text">  Her definition <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Script::DoFile(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* ScriptFileName) { luaL_dofile(lua_state,ScriptFileName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lua_tointeger(lua_state, lua_gettop(lua_state)); }</code> </pre><br>  As you can see, I execute the script and return the int.  But the function can return not only int, but also bool and char *, I just always return numbers (lua_toboolean, lua_tostring) <br></div></div><br><br>  Now we will make a function registering constants (numbers, strings, functions) <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterConstant</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">char</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constantname</span></span></span><span class="hljs-class">);</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">RegisterConstant ()</b> <div class="spoiler_text">  We operate through templates.  Example of function call: <pre> <code class="cpp hljs">RegisterConstant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-string"><span class="hljs-string">"goodvalue"</span></span>);</code> </pre><br>  Her definition <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstant&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* constantname) { lua_pushinteger(lua_state, value); lua_setglobal(lua_state,constantname); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstant&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* constantname) { lua_pushnumber(lua_state, value); lua_setglobal(lua_state,constantname); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstant&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* value, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* constantname) { lua_pushstring(lua_state, value); lua_setglobal(lua_state,constantname); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstant&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* constantname) { lua_pushboolean(lua_state, value); lua_setglobal(lua_state,constantname); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstant&lt;lua_cfunction&gt;(lua_CFunction value, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* constantname) { lua_pushcfunction(lua_state, value); lua_setglobal(lua_state,constantname); }</code> </pre><br>  For each possible value of class T, we define our actions. <br>  * Captain * Last Definition - Registration Function <br>  Functions suitable for registration, look like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lua_State*)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ... return n; }</span></span></code> </pre><br>  Where n is the number of returned values.  If n = 2, then in Lua you can do this: <br><pre> <code class="lua hljs">a, b = Foo()</code> </pre><br>  Read Lua manuals if you were surprised that one function returns multiple values ‚Äã‚Äã:) <br></div></div><br><br>  The following function creates a <i>table</i> for Lua.  If it is not clear what this means, then the table there is just like an array <br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Array</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><div class="spoiler">  <b class="spoiler_title">Array ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Array() { lua_createtable(lua_state, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); }</code> </pre></div></div><br><br>  The following function registers an item in the table. <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RegisterConstantArray</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">);</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">RegisterConstantArray ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstantArray&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { lua_pushnumber(lua_state, index); lua_pushinteger(lua_state, value); lua_settable(lua_state, <span class="hljs-number"><span class="hljs-number">-3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstantArray&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { lua_pushnumber(lua_state, index); lua_pushnumber(lua_state, value); lua_settable(lua_state, <span class="hljs-number"><span class="hljs-number">-3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstantArray&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* value, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { lua_pushnumber(lua_state, index); lua_pushstring(lua_state, value); lua_settable(lua_state, <span class="hljs-number"><span class="hljs-number">-3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstantArray&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> value, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { lua_pushnumber(lua_state, index); lua_pushboolean(lua_state, value); lua_settable(lua_state, <span class="hljs-number"><span class="hljs-number">-3</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterConstantArray&lt;lua_cfunction&gt;(lua_CFunction value, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { lua_pushnumber(lua_state, index); lua_pushcfunction(lua_state, value); lua_settable(lua_state, <span class="hljs-number"><span class="hljs-number">-3</span></span>); }</code> </pre><br>  If you don't know Lua, you are probably surprised that so many types fit into one array?  :) <br>  In fact, a table element may also contain a table, I never do that. <br></div></div><br><br>  Finally, the completed table needs to be registered. <br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterArray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* arrayname)</span></span></span></span>;</code> </pre><div class="spoiler">  <b class="spoiler_title">RegisterArray ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::RegisterArray(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* arrayname) { lua_setglobal(lua_state, arrayname); }</code> </pre><br>  Nothing special <br></div></div><br><br>  The following functions are mainly intended only for functions of type int foo (lua_State *) that are needed for registration in Lua. <br><br>  The first one gets the number of arguments. <br><pre> <code class="cpp hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetArgumentCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>;</code> </pre><div class="spoiler">  <b class="spoiler_title">Create ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Script::GetArgumentCount() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lua_gettop(lua_state); }</code> </pre><br>  This function is needed, for example, for the Write () function, where you can cram as many arguments as you like, or you can push <br>  We will implement a similar function later. <br></div></div><br><br>  The following function receives the argument passed to the function in the script. <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GetArgument</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">index</span></span></span><span class="hljs-class">);</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">GetArgument ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Script::GetArgument&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lua_tointeger(lua_state,index); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> Script::GetArgument&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lua_tonumber(lua_state,index); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* Script::GetArgument&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)lua_tostring(lua_state,index); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Script::GetArgument&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> index) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lua_toboolean(lua_state,index); }</code> </pre><br>  You can get all the types described earlier, except for tables and functions <br>  The index is the number of the argument.  And the first argument starts with 1. <br></div></div><br><br>  Finally, the last function that returns the value in the script <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">t</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">void</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Return</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">);</span></span></code> </pre><div class="spoiler">  <b class="spoiler_title">Return ()</b> <div class="spoiler_text">  Her description <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value) { lua_pushinteger(lua_state,value); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span> value) { lua_pushnumber(lua_state,value); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* value) { lua_pushstring(lua_state,value); } <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Script::Return&lt;<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span>&gt;(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> value) { lua_pushboolean(lua_state,value); }</code> </pre></div></div><br><br><h4>  Combat code </h4><br><br>  Time to do something! <br>  Change main.cpp <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Script.h"</span></span></span><span class="hljs-meta"> int main() { return 0; }</span></span></code> </pre><br>  Compile.  Now you can start testing our class. <br><br>  Remember, I promised to do the Write function?  :) <br>  Modify main.cpp <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Script.h"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   _getch() #include &lt;conio.h&gt; //   Script script; //  Write   int Write(lua_State*) { //          for(int i = 1; i &lt; script.GetArgumentCount()+1; i++) cout &lt;&lt; script.GetArgument&lt;char*&gt;(i); //       _getch(); return 0; } int main() { script.Create(); //      ,    script.RegisterConstant&lt;lua_cfunction&gt;(Write,"Write"); script.DoFile("script.lua"); script.Close(); }</span></span></span></span></code> </pre><br>  And in the folder with the project create a file script.lua <br><pre> <code class="lua hljs">Write(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>)</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bbd/a6c/0ff/bbda6c0ff1c09602d81ce5e925e59d48.png" alt="image"><br><br>  Compile and run the project. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bcc/411/2f3/bcc4112f388b7f9fc85e1ee5d094afdc.png" alt="image"><br><br>  Now we change script.lua <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Write(i, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hier kommt die Sonne"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) end</code> </pre><br>  Now the program will display 2 lines of each ("\ n" - creating a new line), wait for Enter and press the lines again. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/db2/1b2/1c4/db21b21c489bca21f10db8921e7486a7.png" alt="image"><br><br>  Experiment with scripts! <br><br>  Here is an example main.cpp with functions and an example script.lua <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Script.h"</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;conio.h&gt; #include &lt;Windows.h&gt; #include &lt;time.h&gt; Script script; int Write(lua_State*) { //          for(int i = 1; i &lt; script.GetArgumentCount()+1; i++) cout &lt;&lt; script.GetArgument&lt;char*&gt;(i); cout &lt;&lt; "\n"; return 0; } int GetString(lua_State*) { //     cin   ,   Script char* str = ""; cin &gt;&gt; str; script.Return&lt;char*&gt;(str); //  !    1  -&gt; return 1 return 1; } int Message(lua_State*) { //    MessageBox  Windows.h // ,    -        :) char* msg = script.GetArgument&lt;char*&gt;(1); MessageBox(0,msg,"",MB_OK); return 0; } int GetTwoRandomNumbers(lua_State*) { //      1000 srand(time(NULL)); for(int i = 0; i &lt; 2; i++) script.Return&lt;int&gt;(rand()%1000); //  2  return 2; } int GetLotOfRandomNumbers(lua_State*) { //      1000 srand(time(NULL)); for(int i = 0; i &lt; script.GetArgument&lt;int&gt;(1); i++) script.Return&lt;int&gt;(rand()%1000); //   ,     return script.GetArgument&lt;int&gt;(1); } int main() { script.Create(); script.RegisterConstant&lt;lua_CFunction&gt;(Write,"Write"); script.RegisterConstant&lt;lua_CFunction&gt;(GetString,"GetString"); script.RegisterConstant&lt;lua_CFunction&gt;(Message,"Message"); script.RegisterConstant&lt;lua_CFunction&gt;(GetTwoRandomNumbers,"Rand1"); script.RegisterConstant&lt;lua_CFunction&gt;(GetLotOfRandomNumbers,"Rand2"); script.Array(); script.RegisterConstantArray&lt;int&gt;(1,1); script.RegisterConstantArray&lt;int&gt;(2,2); script.RegisterConstantArray&lt;int&gt;(3,3); script.RegisterConstantArray&lt;int&gt;(4,4); script.RegisterArray("mass"); script.DoFile("script.lua"); script.Close(); //    _getch(); }</span></span></span></span></code> </pre><br><pre> <code class="lua hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i = <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Write(i, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-string"><span class="hljs-string">"Hier kommt die Sonne"</span></span>, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Write(<span class="hljs-number"><span class="hljs-number">2</span></span>*<span class="hljs-number"><span class="hljs-number">100</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>) Message(<span class="hljs-string"><span class="hljs-string">"!"</span></span>) a, b = Rand1() Write(a, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, b, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) Write(Rand1(), <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) a, b, c, d = Rand2(<span class="hljs-number"><span class="hljs-number">4</span></span>) Write(a, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, b, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, c, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, d, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br><br><h5>  Useful tips </h5><br><ul><li>  For the Script class, it doesn‚Äôt matter what extension the script is in, even in .txt, even in .lua, even in .bmp, just .lua is opened by a lot of editors, namely Yap Lua </li><li>  Use Lua code editors, it is very difficult to write code, you can forget to write end, do, or something else.  The program due to an error in the loa script does not crash, but simply does not execute code </li><li>  Lua may be much more flexible than you might think.  For example, numbers are freely converted to strings, it is untyped.  If you pass 100 parameters to a function, and in C ++ it reads only the first 2, the program will not crash.  There are many more similar assumptions. </li></ul><br><h5>  Questions and answers </h5><br><ul><li>  <b>Question:</b> Why do not we use the light that is in every such function - int foo (lua_State * L)? <br>  <b>Answer:</b> For the entire program, we use only one state in Script, where we register functions, initialize it and do other things.  In addition, it would simply be unprofitable, having written a whole class, to again turn straight to lua_State via lua_pushboolean and other functions. </li></ul><br><br>  Full listing Script.h and Script.cpp <br><div class="spoiler">  <b class="spoiler_title">Script.h</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> _SCRIPT_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> _SCRIPT_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">pragma</span></span></span><span class="hljs-meta"> comment(lib,</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"lua.lib"</span></span></span><span class="hljs-meta">) extern </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"C"</span></span></span><span class="hljs-meta"> { #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;lua.h&gt; #include &lt;lualib.h&gt; #include &lt;lauxlib.h&gt; } class Script { private: lua_State *lua_state; public: void Create(); void Close(); int DoFile(char* ScriptFileName); template&lt;class t&gt; void RegisterConstant(T value, char* constantname); void Array(); template&lt;class t&gt; void RegisterConstantArray(T value, int index); void RegisterArray(char* arrayname); int GetArgumentCount(); template&lt;class t&gt; T GetArgument(int index); template&lt;class t&gt; void Return(T value); }; #endif</span></span></span></span></code> </pre><br>  I deleted the console to work <br></div></div><div class="spoiler">  <b class="spoiler_title">Script.cpp</b> <div class="spoiler_text"><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Script.h"</span></span></span><span class="hljs-meta"> void Script::Create() { lua_state = luaL_newstate(); static const luaL_Reg lualibs[] = { {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"base"</span></span></span><span class="hljs-meta">, luaopen_base}, {</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"io"</span></span></span><span class="hljs-meta">, luaopen_io}, {NULL, NULL} }; for(const luaL_Reg *lib = lualibs; lib-&gt;func != NULL; lib++) { luaL_requiref(lua_state, lib-&gt;name, lib-&gt;func, 1); lua_settop(lua_state, 0); } } void Script::Close() { lua_close(lua_state); } int Script::DoFile(char* ScriptFileName) { luaL_dofile(lua_state,ScriptFileName); return lua_tointeger(lua_state, lua_gettop(lua_state)); } template</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;&gt; void Script::RegisterConstant&lt;int&gt;(int value, char* constantname) { lua_pushinteger(lua_state, value); lua_setglobal(lua_state,constantname); } template&lt;&gt; void Script::RegisterConstant&lt;double&gt;(double value, char* constantname) { lua_pushnumber(lua_state, value); lua_setglobal(lua_state,constantname); } template&lt;&gt; void Script::RegisterConstant&lt;char&gt;(char* value, char* constantname) { lua_pushstring(lua_state, value); lua_setglobal(lua_state,constantname); } template&lt;&gt; void Script::RegisterConstant&lt;bool&gt;(bool value, char* constantname) { lua_pushboolean(lua_state, value); lua_setglobal(lua_state,constantname); } template&lt;&gt; void Script::RegisterConstant&lt;lua_cfunction&gt;(int(*value)(lua_State*), char* constantname) { lua_pushcfunction(lua_state, value); lua_setglobal(lua_state,constantname); } void Script::Array() { lua_createtable(lua_state, 2, 0); } template&lt;&gt; void Script::RegisterConstantArray&lt;int&gt;(int value, int index) { lua_pushnumber(lua_state, index); lua_pushinteger(lua_state, value); lua_settable(lua_state, -3); } template&lt;&gt; void Script::RegisterConstantArray&lt;double&gt;(double value, int index) { lua_pushnumber(lua_state, index); lua_pushnumber(lua_state, value); lua_settable(lua_state, -3); } template&lt;&gt; void Script::RegisterConstantArray&lt;char&gt;(char* value, int index) { lua_pushnumber(lua_state, index); lua_pushstring(lua_state, value); lua_settable(lua_state, -3); } template&lt;&gt; void Script::RegisterConstantArray&lt;bool&gt;(bool value, int index) { lua_pushnumber(lua_state, index); lua_pushboolean(lua_state, value); lua_settable(lua_state, -3); } template&lt;&gt; void Script::RegisterConstantArray&lt;lua_cfunction&gt;(lua_CFunction value, int index) { lua_pushnumber(lua_state, index); lua_pushcfunction(lua_state, value); lua_settable(lua_state, -3); } void Script::RegisterArray(char* arrayname) { lua_setglobal(lua_state, arrayname); } int Script::GetArgumentCount() { return lua_gettop(lua_state); } template&lt;&gt; int Script::GetArgument&lt;int&gt;(int index) { return lua_tointeger(lua_state,index); } template&lt;&gt; double Script::GetArgument&lt;double&gt;(int index) { return lua_tonumber(lua_state,index); } template&lt;&gt; char* Script::GetArgument&lt;char&gt;(int index) { return (char*)lua_tostring(lua_state,index); } template&lt;&gt; bool Script::GetArgument&lt;bool&gt;(int index) { return lua_toboolean(lua_state,index); } template&lt;&gt; void Script::Return&lt;int&gt;(int value) { lua_pushinteger(lua_state,value); } template&lt;&gt; void Script::Return&lt;double&gt;(double value) { lua_pushnumber(lua_state,value); } template&lt;&gt; void Script::Return&lt;char&gt;(char* value) { lua_pushstring(lua_state,value); } template&lt;&gt; void Script::Return&lt;bool&gt;(bool value) { lua_pushboolean(lua_state,value); }</span></span></span></span></code> </pre></div></div><br><br>  Repository with lib and includami: <a href="https://github.com/Izaron/LuaForHabr">https://github.com/Izaron/LuaForHabr</a> <br><br>  Send all questions to me in the LAN, or in this topic, or, if you are not lucky enough to be registered on Habr√©, email me izarizar@mail.ru <br><br></div><p>Source: <a href="https://habr.com/ru/post/196272/">https://habr.com/ru/post/196272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196258/index.html">Detailed educational program about corporate backup, how to compare systems + a couple of practical tips</a></li>
<li><a href="../196260/index.html">Ask a question to IT industry gurus</a></li>
<li><a href="../196262/index.html">Webasyst 1.2.0 release and developer store</a></li>
<li><a href="../196264/index.html">Intel introduced a Galileo development board</a></li>
<li><a href="../196268/index.html">One of the easiest options for VoIP security</a></li>
<li><a href="../196274/index.html">Livkoding immediately for multiple devices</a></li>
<li><a href="../196276/index.html">History of Apple operating systems. Part 2. Macintosh Takeoff</a></li>
<li><a href="../196278/index.html">Community reaction played a role - Yahoo rewarded its reward program for found vulnerabilities</a></li>
<li><a href="../196280/index.html">How to improve the quality of the code</a></li>
<li><a href="../196282/index.html">About space kindness and Chelyabinsk meteorite</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>