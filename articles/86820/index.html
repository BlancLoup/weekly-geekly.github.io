<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parallel notes ‚Ññ4 - we continue to get acquainted with the structures of OpenMP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Let's continue our introduction to OpenMP technology and consider some features and new directives. 

 OpenMP has a number of helper functions. To use...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parallel notes ‚Ññ4 - we continue to get acquainted with the structures of OpenMP</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/e02/f65/023/e02f650235769fc35f565f7d76e13cee.png" alt="image"><br>  Let's continue our introduction to OpenMP technology and consider some features and new directives. <br><a name="habracut"></a><br>  <a href="http://www.viva64.com/terminology/OpenMP_rus.html">OpenMP</a> has a number of helper functions.  To use them, do not forget to include the header file &lt;omp.h&gt;. <br><br><h5>  Functions of the Runtime Environment </h5><br>  These functions allow you to query and set various parameters of the OpenMP environment: <br><ul><li>  omp_get_num_procs - returns the number of compute nodes (processors / cores) in a computer. </li><li>  omp_in_parallel - allows a <a href="http://www.viva64.com/terminology/Thread_Parallel_thread_rus.html">thread to</a> find out if it is currently engaged in the execution of a parallel region. </li><li>  omp_get_num_threads - returns the number of threads included in the current thread group. </li><li>  omp_set_num_thread - sets the number of threads to execute the next parallel region that will meet the current executed thread.  The function can help allocate resources.  For example, if we simultaneously process sound and video on a processor with four cores, then we can create one stream for sound, and three for sound processing. </li><li>  omp_get_max_threads - returns the maximum allowed number of threads for use in the next parallel area. </li><li>  omp_set_nested - allows or denies nested parallelism.  If nested parallelism is allowed, then each thread in which the description of a parallel region occurs will generate a new group of threads for its execution and will become the main one in it. </li><li>  omp_get_nested - Returns whether nested parallelism is allowed or not. </li></ul><br>  If the function name begins with omp_set_, then it can only be called outside of parallel regions.  All other functions can be used both inside parallel regions and outside those. <br><br><h5>  Sync / Lock Functions </h5><br>  OpenMP allows you to build parallel code without using these functions, as there are directives that allow for certain types of synchronization.  However, in some cases, these functions are convenient and even necessary. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      OpenMP has two types of locks: simple and nested.  Nested have suffix "nest".  Locks can be in one of three states - uninitialized, locked and unlocked. <br><ul><li>  omp_init_lock / omp_init_nest_lock - initialization of a variable of type omp_lock_t / omp_nest_lock_t.  Analogue InitializeCriticalSection. </li><li>  omp_destroy_lock / omp_destroy_nest_lock - release of a variable of type omp_lock_t / omp_nest_lock_t.  Analogue DeleteCriticalSection. </li><li>  omp_set_lock / omp_set_nest_lock - one thread sets a lock, and the remaining threads wait until the thread that calls this function releases the lock using the omp_unset_lock () function.  Analogue EnterCriticalSection. </li><li>  omp_unset_lock / omp_unset_nest_lock - unlock.  Analogue LeaveCriticalSection. </li><li>  omp_test_lock / omp_test_nest_lock - non-blocking attempt to lock the lock.  This function tries to lock the specified lock.  If it succeeds, then for a simple lock, the function returns 1. If the lock cannot be captured, then it returns 0. The analogue of TryEnterCriticalSection. </li></ul><br>  Simple locks (omp_lock_t) cannot be set more than once, even by the same thread.  Nested locks (omp_nest_lock_t) are identical to simple ones with the exception that when a thread tries to establish a locking that already belongs to it, it is not blocked. <br><br>  Let's give an example of the code using the described functions.  All created threads in turn will display the message ‚ÄúBegin work‚Äù and ‚ÄúEnd work‚Äù.  Between these two messages from the same thread, messages from other threads that are output when an unsuccessful attempt to enter a closed section may occur. <br><br><pre>  omp_lock_t lock;
 int n;
 omp_init_lock (&amp; ‚Äã‚Äãlock);
 #pragma omp parallel private (n)
 {
   n = omp_get_thread_num ();
   while (! omp_test_lock (&amp; ‚Äã‚Äãlock))
   {
     printf ("Wait ..., thread% d \ n", n);
     Sleep (3);
   }
   printf ("Begin work, thread% d \ n", n);
   Sleep (5);  // Work ...
   printf ("End work, thread% d \ n", n);
   omp_unset_lock (&amp; ‚Äã‚Äãlock);
 }
 omp_destroy_lock (&amp; ‚Äã‚Äãlock); </pre><br><br>  On a machine with four cores, the following output can be obtained: <br><br>  <b>Begin work, thread 0</b> <br>  Wait ..., thread 1 <br>  Wait ..., thread 2 <br>  Wait ..., thread 3 <br>  Wait ..., thread 2 <br>  Wait ..., thread 3 <br>  Wait ..., thread 1 <br>  <b>End work, thread 0</b> <br>  <b>Begin work, thread 2</b> <br>  Wait ..., thread 3 <br>  Wait ..., thread 1 <br>  Wait ..., thread 3 <br>  Wait ..., thread 1 <br>  <b>End work, thread 2</b> <br>  <b>Begin work, thread 3</b> <br>  Wait ..., thread 1 <br>  Wait ..., thread 1 <br>  <b>End work, thread 3</b> <br>  <b>Begin work, thread 1</b> <br>  <b>End work, thread 1</b> <br><br><h5>  Timer Functions </h5><br><ul><li>  omp_get_wtime ‚Äî Returns the astronomical time in seconds in the calling stream (a real double-precision number is double) that has elapsed since some point in the past.  If a certain section of the program is surrounded by calls to this function, then the difference in return values ‚Äã‚Äãwill be shown by the time of operation of this section. </li><li>  omp_get_wtick () - returns the resolution of the timer in seconds in the calling thread, that is, the accuracy of the timer. </li></ul><br>  On this familiarity with the functions we will complete and consider a couple of new directives.  These directives can be called options for creating parallel regions. <br><br><h5>  if (condition) </h5><br>  Execution of a parallel domain by condition.  Creation of several threads is carried out only when some condition is met.  If the condition is not met, the code is executed in sequential mode. <br><br>  Example of use: <br><pre>  void test (bool x)
 {
   #pragma omp parallel if (x)
   if (omp_in_parallel ())
   {
     #pragma omp single
     printf_s ("parallelized with% d threads \ n",
              omp_get_num_threads ());
   }
   else
   {
     printf_s ("single thread \ n");
   }
 }

 int _tmain (int argc, _TCHAR * argv [])
 {
   test (false);
   test (true);
   return 0;
 } </pre><br><br>  Result of work: <br><pre>  single thread
 parallelized with 4 threads </pre><br><br><h5>  num_threads </h5><br>  Explicitly specifying the number of threads that will execute the parallel area.  By default, the last value set using the omp_set_num_threads () function is selected. <br><br>  If we modify the example above as follows: <br><br><pre>  ...
 #pragma omp parallel if (x) num_threads (3)
 ... </pre><br><br>  then we get the following output: <br><br><pre>  single thread
 parallelized with 3 threads </pre><br><br>  In the next issue of "Parallel Notes" we will continue ... </div><p>Source: <a href="https://habr.com/ru/post/86820/">https://habr.com/ru/post/86820/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86810/index.html">Visit to Juniper Networks office</a></li>
<li><a href="../86812/index.html">Monetization forum. Part two</a></li>
<li><a href="../86815/index.html">Alternative announcement of the new release of UMI.CMS</a></li>
<li><a href="../86817/index.html">Two ATMs</a></li>
<li><a href="../86818/index.html">Raise the software business</a></li>
<li><a href="../86821/index.html">Sony's ‚ÄúDegrading‚Äù Games</a></li>
<li><a href="../86822/index.html">Final Fantasy XIII: Xbox 360 vs PlayStation 3</a></li>
<li><a href="../86823/index.html">How to make friends with Visual Studio 2005/2008 with Firebird ADO.NET Data Provider</a></li>
<li><a href="../86825/index.html">CASIO Darwin CX-1 - or the omnipotent word processor (c) Stephen King (ATTENTION TRAFFIC!)</a></li>
<li><a href="../86826/index.html">Unicredit hacked?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>