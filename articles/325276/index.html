<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix for DevOps: how we implemented the monitoring system in the development and testing processes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the cycle of publications on the implementation of DevOps tools and practices in our company. Recently, we talked about how we analyze vul...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix for DevOps: how we implemented the monitoring system in the development and testing processes</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/company/pt/blog/325276/"><img src="https://habrastorage.org/files/f1a/3f2/208/f1a3f22082a8441fafbf749de724c0ed.jpg"></a> <br><br>  We continue the cycle of publications on the implementation of DevOps tools and practices in our company.  Recently, we talked about how we analyze vulnerabilities <a href="https://habrahabr.ru/company/pt/blog/323436/">using neural networks and fuzzy logic</a> , and today we will talk about the implementation of the Zabbix monitoring system in the development and testing processes. <a name="habracut"></a><br><br><h2>  Typical testing problems </h2><br>  One of the serious problems that we wanted to solve with the help of the implementation of DevOps practices was the organization of monitoring of IT systems.  Prior to that, it was not actively implemented.  This led to a number of difficulties.  For example, we could lately notice that the place on the disk of the necessary machine ran out, problems were signaled by interruptions in the work of services and applications.  All these are acute problems for the development and testing process, since due to such errors the product may be unstable, and it becomes more difficult to catch bugs in it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When testing a product, it is necessary to analyze a variety of indicators: logs, server load, availability of internal and external services, etc.  In addition, from version to version, the list of observed parameters may vary. <br><br>  To solve all these problems, we decided to integrate the Zabbix monitoring system into the development and testing processes.  That's how we did it, and what happened in the end. <br><br><h2>  How we implemented Zabbix </h2><br>  In general, monitoring systems are divided by function and type.  The division by function can be described as: <br><br><ul><li>  Situation monitoring - notification of critical events and errors (the classic situation is ‚ÄúSMS at 2 nights‚Äù). </li><li>  Trend monitoring - information is collected for further analysis. </li><li>  Performance monitoring - tracking system performance. </li></ul><br>  Monitoring by type is divided into: <br><br><ul><li>  System monitoring - analyzes the state of the OS and system services. </li><li>  Application Monitoring - implemented within the application. </li><li>  Business metrics - implemented within the application. </li></ul><br>  The mechanism we use allows us to ‚Äúclose‚Äù all these functions and carry out system monitoring in full, and application monitoring in part. <br><br>  To optimize the testing process, we decided to delimit the areas of responsibility between the DevOps team, developers and testers, wrote our own tools for interacting with Zabbix (zabbixtools) and switched to using the ‚Äúmonitoring as code‚Äù approach. <br><br>  The division of responsibility looks like this - if we have a host that needs to be monitored, then the tester assigns him a certain role.  Each host can have only one role in which there can be several profiles - they are provided by the DevOps team.  Profiles can be different - for monitoring processes, services, API, etc. <br><br><img src="https://habrastorage.org/files/c24/ad8/961/c24ad8961efd4c5cb1d01e8abc8a96fd.jpg"><br><br>  The zabbixtools package includes Python and Powershell scripts ( <a href="https://github.com/devopshq/zabbixtools">project repository on GitHub</a> ), which extend the functionality of the Zabbix system in the following parts: <br><br><ul><li>  custom checks on Zabbix agents and external checks on the server; </li><li>  customization of alerts - integration with various services and workflow; </li><li>  work through the API - for example, mass editing of hosts and other entities; </li><li>  Configuring monitoring when deploying a product or tests. </li></ul><br>  The monitoring system should be flexible and easily configurable, which cannot be said about the Zabbix web interface.  Therefore, to simplify the configuration, it was decided to implement a system in which Zabbix had to take as much data as possible about the observed indicators from the target server.  To simplify setup, <b>zabbixtools</b> uses <b><a href="https://www.zabbix.com/documentation/3.2/ru/manual/discovery/low_level_discovery">Low Level Discovery</a> (LLD)</b> functionality. <br><br>  This allows you to make any monitoring settings on the monitored server itself, and not in the Zabbix admin panel. <br><br>  The approximate scheme of the implementation of this function is presented in the diagram: <br><br><img src="https://habrastorage.org/files/8bc/a17/5aa/8bca175aaa574ddb83b02eacce0442e1.png"><br><br>  Here's how it works: <br><br><ul><li>  <b>LLD</b> requests a monitoring configuration from <b>Zabbix agent</b> (with the required parameters).  For example, lists of services, available sites or disks with the required amount of space. </li><li>  <b>The Zabbix agent</b> provides the parameters, in fact, it takes them from a yaml-format file. </li><li>  <b>LLD</b> creates the required <b>Item</b> and <b>Trigger</b> on the host.  Moreover, the trigger trigger conditions can also be set on the agent side. </li></ul><br>  Thus, to set up a new host with certain rules, the teams do not need to learn the administrative interface; it is enough just to add the necessary set of profiles to the role that will be associated with this server.  The web interface will only be used to view current status / historical information. <br><br>  An example of embedding a monitoring system in the development / testing processes <br>  The problem of monitoring during the development and testing of a product is a list of observed parameters that varies from version to version. <br><br>  For example, it is possible that for two releases we need to monitor the following indicators: <br><br><blockquote><code>1. Release N.0</code> </blockquote> <br><ul><li>  We monitor the availability of resource A via HTTP </li><li>  Monitor Service B </li><li>  Monitor Service C </li><li>  For resource X set the critical value of Y </li></ul><br><blockquote> <code>2. Release N+1.0</code> </blockquote> <br><ul><li>  We monitor the availability of resource A via HTTPS </li><li>  Monitor Service C (but its name has changed) </li><li>  Monitor service D </li><li>  For resource X, set the critical value Z </li></ul><br>  And today, at the SERVER-1 stand, one version of the product will be deployed, and tomorrow - the other should be deployed.  In monitoring systems, any changes are made manually in the web interface with static preset parameters. <br><br>  zabbixtools with LLD allows you to solve this problem in two possible ways: <br><br><blockquote>  1. The monitoring configuration (yaml files) is deployed when the product is deployed (files are taken from the same repository as the source code of the product). </blockquote><br><ul><li>  Maintaining the relevance of monitoring configuration remains a task for developers. </li><li>  The monitoring configuration varies from branch to branch / from feature to feature. </li><li>  SMOKE testing is already underway when a product is deployed, even if there is no need to run tests. </li></ul><br><blockquote>  2. The monitoring configuration (yaml files) is deployed when testing the product (files are taken from the same repository as the code for the test). </blockquote><br><ul><li>  Maintaining the relevance of monitoring configuration is the task of testers. </li><li>  SMOKE tests can be performed by the monitoring system. </li></ul><br><img src="https://habrastorage.org/files/8e8/fb7/904/8e8fb7904e2b4dabb41ee57dc1ea7859.jpg"><br><br>  This scheme allows you to customize monitoring depending on the product release and keep it under version control.  We can also implement SMOKE testing using the monitoring system itself.  In addition, this configuration allows for the division of responsibilities between the DevOps, development and testing teams - in particular, programmers and testers do not need to deal with the work of Zabbix and its API. <br><br>  As a result, the participation of different teams is required only at certain intervals.  For example, when deploying a product, developers are responsible for maintaining the relevance of the monitoring configuration, the monitoring configuration is different from branch to branch and from feature to feature, and SMOKE testing is performed during deployment even without running tests. <br><br>  When testing a product, testers are responsible for maintaining the relevance of the monitoring configuration, SMOKE tests can be performed by the monitoring system. <br><br><h2>  Work examples </h2><br>  Below are sample configurations for monitoring sites, services, processes and folder sizes. <br><br>  Consider a situation in which we need to monitor the availability of internal and external sites - from them we should receive an HTTP 200 OK response.  To do this, simply add the lines to the <code>websites.yaml</code> file.  If it is required to monitor the work of services (services should be included), they should be added to <code>services.yaml</code> . <br><br><img src="https://habrastorage.org/files/f98/927/fd2/f98927fd257a40e6bb34884b38659231.jpg"><br><br>  In case you need to monitor the memory consumption of certain processes, you can do this with a few lines in process.yaml. <br><br>  Another useful feature of this tool is the ability to set different threshold values ‚Äã‚Äãfor metrics.  If, for example, it is important for us that the size of the Cache folder is small, and the logs can grow in size, then you can simply add different <code>CriticalSize</code> folders in <code>foldersize.yaml</code> . <br><br><img src="https://habrastorage.org/files/819/a9e/70c/819a9e70ce984a97b17cd0c53ccb35ba.jpg"><br><br>  PS The story about our experience of integrating monitoring with the help of Zabbix into the development and testing processes was presented as part of the DevOps mitap, which took place in the fall of 2016 in Moscow. <br><br>  Video: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/N_v2TIlGr_0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Slides <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  The <a href="http://www.slideshare.net/phdays">link</a> presents presentations of 16 reports presented during the event.  All presentations and video presentations are added to the table at the end of this <a href="https://habrahabr.ru/company/pt/blog/310584/">topic</a> . <br><br>  <b>Author</b> : <a href="https://habrahabr.ru/users/allburov/">Alexey Burov</a> </div><p>Source: <a href="https://habr.com/ru/post/325276/">https://habr.com/ru/post/325276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325264/index.html">Release DBMS InterSystems Cach√© 2017.1</a></li>
<li><a href="../325268/index.html">Formation of the Support Division of the Krasnodar studio Plarium</a></li>
<li><a href="../325270/index.html">Exploiting eXternal Entity XML (XXE) Vulnerabilities</a></li>
<li><a href="../325272/index.html">7 workflow optimization techniques you may not have heard about</a></li>
<li><a href="../325274/index.html">CAPWAP State Machine in the Cisco Unified Wireless Implementation: Join State</a></li>
<li><a href="../325278/index.html">Abstract lectures on the design of game mechanics sandbox projects from the creator of Life is Feudal</a></li>
<li><a href="../325280/index.html">Specification Design Pattern in C #</a></li>
<li><a href="../325282/index.html">Twitter infrastructure: scale</a></li>
<li><a href="../325284/index.html">VR Design: scene content</a></li>
<li><a href="../325286/index.html">Live stream from MoscowJS Superjob office</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>