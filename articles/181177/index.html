<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Veeam Backup & Replication: tips and tricks. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On May 17, another VMware Users Community Group was held in Moscow. The company Veeam, as usual, did not pass this event party. I was going to give a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Veeam Backup & Replication: tips and tricks. Part 1</h1><div class="post__text post__text-html js-mediator-article">  On May 17, another VMware Users Community Group was held in Moscow.  The company Veeam, as usual, did not pass this event party.  I was going to give a presentation on how to take into account all aspects to properly build a backup system based on Veeam Backup &amp; Replication software - based on last year‚Äôs presentation at VMworld. <br><br>  But after the preparation of all the slides, I realized that the topic was extensive enough to fit into the framework of a short presentation.  And the format of the presentation slides is not very suitable for it.  Plus I did not want to load people with text.  In general, at the very last moment before the start of the speech, having received a few questions on the innovations of version 7, I changed the presentation theme to ‚ÄúThe History of Veeam Backup &amp; Replication‚Äù, where I talked about what happened, what we have now, and what we plan to do in the next version. <br><br>  The topic of how to configure Veeam Backup remains relevant.  In addition, during the speech, and much more - after it, I received technical questions, which I am going to cover in a series of articles.  And most importantly - ask questions here, in the comments, and we will definitely answer them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Before turning to today's topic, I will note one question asked me on the VMUG forum.  When will Veeam Backup back up data not through VMware snapshots, but ‚Äúiron‚Äù DSS snapshots?  At that time, I could not voice, but now I am fully answering: from version 7, Veeam Backup will be able to copy data from SAN snapshots.  At the initial stage, support will be provided for HP equipment: LeftHand (including VSA) and 3PAR. <br>  The principle is simple: now there is Veeam Explorer for SAN Snapshots, which allows you to pull data from snapshots.  With this technology and VMware Changed Block Tracking (CBT), Veeam Backup will incrementally retrieve data already for backups. <br><br>  And now for the first part of the tips: <br><a name="habracut"></a><br><h4>  Copy Modes in Veeam Backup </h4><br>  Briefly, the backup construction architecture of Veeam Backup looks like this: <br>  Veeam Backup server runs the task and determines the best Veeam Backup Proxy for copying data.  Veeam Backup Proxy pulls vSphere virtual machine data, deduplicates data, archives and streams to the Veeam Backup Repository.  Veeam Backup Repository writes data to disk in backup copies, and also monitors the storage policy of copies: for example, it collects full synthetic copies if necessary. <br><img src="https://habrastorage.org/storage2/bec/823/187/bec8231874a11ff2b12c3b8360fc4b50.png"><br>  Veeam Backup Proxy can be a physical server or a virtual machine with MS Windows, and the data retrieval methods can be: over the SAN network, via VMware Hot Add technology or over the LAN network. <br><br>  This is about these methods, what they are and what you should pay attention to and the story goes on. <br><br><h5>  Direct SAN Access (Direct SAN Access) </h5><br><h6>  How it works </h6><br>  Veeam Backup Proxy server we present VMFS with virtual machine disks.  During the copying process, the proxy reads the necessary data blocks directly from the storage system. <br><br><h6>  Good </h6><br><ol><li>  This mode is considered the fastest way to copy.  But I note right away that data over the 10G network can be copied faster. </li><li>  The method gives the least impact on the virtual infrastructure: <br><ul><li>  First, because the copying process itself is completely handed over to dedicated proxy servers, and is not performed on the hypervisor hosts; </li><li>  Traffic is isolated by SAN (LAN-free) </li></ul></li></ol><br><br><h6>  poorly </h6><br><ol><li>  Only block access to storage is supported.  Those.  does not work for NFS storage. </li><li>  Working with FC storage requires physical servers.  VM with a dedicated physical FC-adapter does not work.  And this moment does not really fit into the project of total infrastructure virtualization.  On the other hand, old servers can be occupied by the business, on which hypervisors will not be deployed, but be sure to read the recommendations subsection below. </li><li>  This is not for beginners.  It requires knowledge of how to set up SAN, hosts.  Need to plan. </li><li>  SAN configuration required: mapping, zonning. </li></ol><br><br><h6>  Evil </h6><br>  Here are three easy ways to hurt yourself: <br><ol><li>  Enable automount Windows Explorer to recognize new drives (enabled by default) </li><li>  Thoughtless clatter in the console Disk Management.  ‚ÄúO-pa!  Some kind of wheels here! ‚Äù </li><li>  Issuance of local Administrator rights "on the ball." </li></ol><br><br>  The worst thing that can happen is that Windows will ‚Äúcapture‚Äù LUNs from VMFS, and vSphere will not be able to recognize them as its datastores.  But do not panic!  VMware Support can fix this.  And secondly, read the "safe path" to avoid this situation. <br><br><h6>  Safe way </h6><br><ol><li>  Present VMFS LUNs to backup-proxy servers in read-only mode. </li><li> Disable automounting on backup proxy servers. <br>  Installing Veeam Backup Proxy does it herself.  But if you want to present the disks before you install the proxy on the server, then use the <code>diskpart</code> utility.  And keep in mind that it is better to do this through <code>SAN Policy</code> (OfflineShared), and not <code>AutoMount</code> . <br></li><li>  Disable the Disk Management snap-in via Group Policy: <br> <code>User Configuration &gt; Administrative Templates &gt; Window Components &gt; Microsoft Management Console &gt; Restricted/Permitted snap-ins &gt; Disk Management</code> </li> </ol><br><br><h6>  Tips and tricks </h6><br><ol><li>  If you have a modern fast SAN, and you want to get the most out of it (i.e. copy speed) from the Direct SAN Access mode, then use modern servers for the Veeam Backup Proxy.  Yes, this is somewhat at odds with the recommendation to use old equipment, but ultimately you decide: save on equipment or save on time (speeding up the process). </li><li>  Update firmware and server drivers (especially if the server is physical), SAN equipment, FC-cards. </li><li>  Disabling MPIO (also known as Multi-Path Input / Output, also known as multipassing) on ‚Äã‚Äãthe Veeam Backup Proxy server can improve performance.  If you install MPIO, then more often everything is better to install software from the hardware manufacturer, and not Windows MPIO. </li><li>  For iSCSI SAN on Veeam Backup Proxy, optimize TCP / IP performance for better performance: <code>netsh int tcp set global autotuninglevel=disabled</code> </li><li>  Increase the read ahead buffers.  The default is 4MB, which is optimal for most SANs.  However, in some cases it may help to increase.  On the main Veeam Backup server in the registry, create a new value in bytes: <code>VddkPreReadBufferSize</code> (DWORD) </li><li>  Look for your specific glands on the official forum: <a href="http://forums.veeam.com/viewforum.php%3Ff%3D2">http://forums.veeam.com/viewforum.php?f=2</a> </li></ol><br><br><h6>  useful links </h6><br><ol><li>  Learn more about the <a href="http://go.veeam.com/v7-ru">new features of Veeam Backup &amp; Replication v7</a> </li><li>  Download a free version of Veeam Backup &amp; Replication - <a href="http://www.veeam.com/ru/virtual-machine-backup-solution-free.html">Veeam Backup Free Edition</a> </li><li>  Read more about the new v7 feature - <a href="http://www.veeam.com/ru/news/veeam-enables-dramatically-better-rpos-with-backup-from-storage-snapshots.html">backup using hardware snapshots.</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/181177/">https://habr.com/ru/post/181177/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181159/index.html">Device of points of virtual reality Oculus Rift</a></li>
<li><a href="../181161/index.html">The new technology of noise reduction allows you to transfer 400 Gb / s over fiber for 12,800 km without signal repeaters</a></li>
<li><a href="../181165/index.html">Robotic Data Center of the Future</a></li>
<li><a href="../181173/index.html">Servers and data centers in the Netherlands - operating experience</a></li>
<li><a href="../181175/index.html">Does the programmer need free buns?</a></li>
<li><a href="../181179/index.html">Features of jQuery fadeIn, fadeOut, and fadeTo methods</a></li>
<li><a href="../181187/index.html">Household computer BK-0010-01. Take two</a></li>
<li><a href="../181193/index.html">Creator Mode, Manager Mode</a></li>
<li><a href="../181195/index.html">Unexpected results from a simple MySQL query</a></li>
<li><a href="../181197/index.html">WordPress turns 10 years old</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>