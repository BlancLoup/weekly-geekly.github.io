<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kerio Control for Windows to Kerio Control Appliance Migration Guide</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few introductory words. 

 Fifteen years ago, a company of four enthusiasts in a small Czech town developed and released the first version of a revo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kerio Control for Windows to Kerio Control Appliance Migration Guide</h1><div class="post__text post__text-html js-mediator-article"><h4>  A few introductory words. </h4><br><br>  Fifteen years ago, a company of four enthusiasts in a small Czech town developed and released the first version of a revolutionary solution, which marked the beginning of Kerio Technologies.  WinRoute Pro was an advanced software router and NAT firewall running on the Windows operating system used on standard user PCs, it was the combination of these features that led to the huge popularity of the product among IT professionals. <br><a name="habracut"></a><br>  Let's move forward to 2009.  The past decade was marked by increased attention to security, in connection with this version of Kerio Winroute Firewall 6.7.1.  enjoyed particular success.  In this version, the first version of the software module (Software Appliance) was released.  This module was built on the basis of a proprietary Linux-like OS using a proprietary web-based administration interface to perform system management functions.  Simultaneously with the software module, a virtual module (Virtual Appliance) was prepared for the VMware virtualization environment.  However, both Appliance modules were less functional than the main Windows version of the application.  A year later there was a significant change in the name of the product, it became known as Kerio Control.  This was due to the inclusion of the Intrusion Prevention System (IPS) into the product‚Äôs functionality and its transformation into a fully-fledged Unified Threat Management (UTM) solution. <br><br>  With the growing popularity of the product among users, the goal of Kerio Control development has been to increase productivity and expand opportunities for organizing and maintaining security.  In version Kerio Control 7.4, this is reflected in the form of adding support for virtual local area networks (VLANs).  However, this function, like some others added over the last two years, were no longer available for the Kerio Control Windows application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It was the fact of the release of a weighty VLAN feature that marked the end of the Kerio Control ‚Äúera‚Äù for Windows.  Version of Kerio Control 7.4 is the latest "Windows-version" of Kerio Control. <br>  Support for this version (both user and application code support) is provided by Kerio until the end of 2014.  We urge all our users, if possible, to make the transition from the current Windows versions of the Kerio Control application to the Kerio software or virtual modules. <br><br>  To simplify the transition, we have added support for virtualization from Microsoft - Hyper-V.  User authentication through the Microsoft Active Directory directory service is preserved in full and familiar to our users.  Administration and access to the user statistics interface can still be performed using standard web browsers installed on any modern OS.  VPN server Kerio and IPsec VPN allow you to connect from a variety of stationary operating systems, including Windows, Linux, MacOS, and using the built-in VPN clients of Android and Apple mobile devices. <br><habracut><br>  Yes, Windows is an excellent platform, but everything passes, and Kerio OS comes to replace - Linux-like OS, which is a universal platform for all Appliance assemblies of the Kerio Control application.  And just to help our current users make the transition from the Windows version of our KControl / KWF application, we decided to publish a special guide on switching from Windows to the Appliance platform, which can also be downloaded from a special page in our <a href="https://samepage.io/app/">Samepage.io</a> cloud as pdf- file for review in "offline" mode. <br><br><h4>  And he said, "Let's go !!" </h4><br><br>  So, I suggest to start in order.  First of all, I would like to consider some of the most common misconceptions that stop UTM Kerio Control administrators from such a migration: <br><br><ol><li>  The difficulty of the transition. </li><li>  The inability to save the configuration, application logs, user statistics data when switching to an Appliance assembly. </li><li>  Mandatory knowledge of open source. </li><li>  The inability to perform more than one role on one physical server. </li><li>  The complexity of backing up Linux solutions. </li><li>  ‚ÄúIt works ‚Äî don't touch it‚Äù (‚ÄúIf there is a possibility that some kind of trouble may happen, then it will happen‚Äù (‚ÄúMurphy's law‚Äù). </li></ol><br><br>  In a refutation of these "myths", I propose to briefly review the real picture of what is happening during the migration process from the Windows version to the Appliance version of Kerio Control: <br><br><ul><li>  The transition with the implementation of additional steps of updating the version in cases where it is needed, takes no more than two hours of ‚Äúdirty‚Äù time. </li><li>  Configuration, log data and user statistics database are transferred completely.  This will be discussed separately in this Guide. </li><li>  Knowledge and experience with OpenSource in general and with the Linux operating system in particular are not needed.  The installation of the application and the configuration of the basic parameters (IP-addresses, time and language of the system interface) is carried out through a graphic user interface in Russian.  All other actions to administer your Kerio Control UTM Gateway are performed through the usual Russian-language web-based administration interface.  There is no need to access the Linux console, although this is possible and we will take a closer look at when it may be necessary. </li><li>  Using the ‚Äúvirtual module‚Äù of Kerio Control, you can fulfill as many IT roles as you need within a single virtualization server.  Virtualization as a whole allows for better utilization of server hardware resources and expanding boundaries in IT infrastructure planning. </li><li>  Another advantage of the transition is a simplified backup method for the configuration of the Kerio Control ‚Äúsoftware module‚Äù using automatic backup of the configuration to the Kerio company's cloud ‚Äî Samepage.io, or to any FTP server convenient for you. </li><li>  The requirement for a version upgrade can come not only from the IT department, but also be a consequence of the business requirements for expanding the capabilities of the UTM solution.  Do not forget that "everything achieved to ensure flight safety is the result of overcoming the" Murphy's Law. " </li></ul><br><br>  Now I propose to get acquainted with what the software (Software Appliance) and virtual (Virtual Appliance) Kerio Control modules represent. <br><br><p>  <strong>Kerio Control Software Appliance</strong> </p><br><p></p><br><p> <strong><img height="178" src="https://habrastorage.org/getpro/habr/post_images/080/b92/9e7/080b929e729f55c9b62c043ccaa35e40.png" width="196"><img height="133" src="https://habrastorage.org/getpro/habr/post_images/41b/bbc/166/41bbbc166eb90a08baedc68ea55fc617.png" width="134"><img height="191" src="https://habrastorage.org/getpro/habr/post_images/491/e92/947/491e92947d25f7da5bc50764fe72b6d4.png" width="173"></strong> </p><br><p></p><br><p>  <strong>Features of the Kerio Control Software Appliance</strong> </p><br><ul><li><p>  Kerio Control combined with a secure OS </p><br></li><li><p>  32-bit Debian OS on Linux Kernel 3.12 with the ability to use up to 64GB of OP (support for PAE) </p><br></li><li><p>  Available in image (ISO) </p><br></li><li><p>  Burns to CD / DVD or USB-Flash for installation on bare hardware. </p><br></li></ul><br><p></p><br><p>  <strong>The main advantages of the platform</strong> </p><br><ul><li>  Lack of software and hardware conflicts </li><li>  No virus threats </li><li>  The familiar-easy administration interface of Kerio Control </li><li>  No need for knowledge of * nix systems. </li></ul><br><br><br><p>  <strong>Kerio Control Virtual Appliance</strong> </p><br><p></p><br><p>  Kerio Control Hypervisors from </p><br><p>  Software Appliance VMware and Microsoft </p><br><p><img height="96" src="https://habrastorage.org/getpro/habr/post_images/080/b92/9e7/080b929e729f55c9b62c043ccaa35e40.png" width="102"><img height="75" src="https://habrastorage.org/getpro/habr/post_images/41b/bbc/166/41bbbc166eb90a08baedc68ea55fc617.png" width="75"><img height="61" src="https://habrastorage.org/getpro/habr/post_images/eb4/278/474/eb42784742eb2fdfb92077bfe997f763.png" width="175"><img height="58" src="https://habrastorage.org/getpro/habr/post_images/aa6/95d/e2b/aa695de2ba304efc4c1a6617c723be3a.jpg" width="145"></p><br><p></p><br><p>  <strong>Supported Virtualization Tools:</strong> </p><br><ul><li><p>  VMware (workstation, player, server, ESX) </p><br></li><li><p>  Hyper-V (2008 r2, 2012, 2012 r2) </p><br></li></ul><br><p></p><br><p>  <strong>The main advantages of the platform</strong> </p><br><ul><li>  Execution of several isolated roles on the same physical <br>  server </li><li>  Transferring UTM to another server is possible in minutes </li><li>  The ability to add a network adapter without changing the hardware <br>  funds </li><li>  Increased network security without having to purchase a new one. <br>  equipment </li></ul><br><br>  After we got acquainted with the possible distributions, it's time to contact the users of the ‚Äúbearded‚Äù versions of Kerio Winroute.  Below is information on updating old Windows versions of KWF to Kerio Control 7.4 (the final version of the application for the Windows platform) as well as a few nuances that must be taken into account when performing the procedure for updating the version of the Kerio Control / KWF application as a whole. <br><br><p>  Upgrades from version 6.X.X to version 7.X.X should be carried out in stages in accordance with the following scheme: </p><br><ol><li>  Step-by-step transition from KWF 6.5.x to KControl 7.4.x (Windows) </li></ol><br><ul><li>  6.5.X&gt; 6.6.0 &gt;&gt; 6.7.1&gt; 7.0.X&gt; 7.1.X &gt;&gt; 7.4.X </li></ul><br><p>  Direct migration to 7.4.X is possible only from version 7.1.X and later versions. </p><br><br><ol><li>  Upgrade from version 7.0.X to version 8.XX (Appliance) </li></ol><br><ul><li>  7.0.X&gt; 7.1.X &gt;&gt; 8.0.X (Software Appliance) </li></ul><br><p>  When updating, it is important to consider the following points: </p><br><ul><li>  Exporting the configuration of the Windows version of KControl / KWF can be used to apply only on a similar version of the Applaince assembly, to guarantee 100% of all settings to be transferred </li><li>  It is possible to transfer the database of user statistics of visits to the Internet and the contents of the logs of the Kerio Control application. </li><li>  The transfer of the user statistics database of Internet visits and the contents of the Kerio Control application logs must be performed within version 7.4.2 (the final version of the Kerio Control application for Windows OS) </li></ul><br><br>  This is all about the introductory part. <br><br>  Now, for familiarization directly with the order of the administrator to update the version of KControl / KWF in use. <br><br>  Below we list the steps that, for everyone, for someone, for only a part, will be done by the administrators <br><br><ul><li>  Update Version Used </li><li>  Switch to Appliance Platform </li><li>  Install Software Appliance </li><li>  Install VMware Virtual Appliance </li><li>  Install Hyper-V Virtual Appliance </li><li>  Configuring Network Interfaces </li><li>  Save and migrate user configuration and data </li><li>  Migrating database of application logs and database of user statistics of Internet visits </li><li>  Check the integrity of transferred data </li><li>  Update to the current version of the Kerio Control Appliance </li></ul><br><br><h4>  Updating the version of the Kerio Control application (KWF) in use </h4><br><br>  The first thing we need is to get those versions of the KControl / KWF distributions that you need to complete the transition, according to the order of transition described a little above.  To download the necessary distributions, use only the official source - the Kerio company website: <a href="http://www.kerio.ru/">www.kerio.ru</a> or directly the site of our archive of releases: <a href="http://download.kerio.com/archive">download.kerio.com/archive</a> <br><br>  The path to the archive is shown in the following images: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c63/15f/ba5/c6315fba54ad89da92a3549bb10a7e43.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/78a/7cb/b1c/78a7cbb1c1283321bc54c715f9d5a54c.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/e78/c90/34e/e78c9034ecbfd8154c9ce5c0f1b93dfd.png"><img src="https://habrastorage.org/getpro/habr/post_images/a2c/ddc/98f/a2cddc98f46223d0d549c4d389c11702.png"><br><br>  Suppose you are migrating from the latest version of KWF 6.7.1, your goal is a working version of Kerio Control Appliance 8.3 (the current version of the application is for April 2014) <br><br>  The main ‚Äúdifficulty‚Äù of the transition in this case is the need to perform not a direct update from the version of KWF 6.7.1 to Kerio Control 8.3, but a sequential transition to some ‚Äúmajor‚Äù versions.  This need is due to the inclusion in the configuration files of these "major" versions of some features that require post-processing after installing the application. <br>  To upgrade from KWF 6.7.1 to Kerio Control 8.3, you will need to complete the following upgrade steps: <br><br>  1. Upgrade to Kerio Control 7.0.0 <br>  2. Update to Kerio Control version 7.1.0 <br>  3. Update to Kerio Control version 7.4.2 (final version for Windows) <br><br>  You can download the necessary distributions from our <a href="http://dowanload.kerio.com/archive">archive of releases</a> . <br>  The process of updating from version to version is the usual installation of the new version "on top" of the old one.  The installation program will automatically shut down the Kerio Control system service (Kerio Winroute Firewall), determine the installation directory of the current version of Kerio Control (Kerio Win-route Firewall) and replace the application files that need to be updated;  protocol files of the application and user configuration are saved unchanged.  Configuration files will be saved in a special directory ‚ÄúUpgradeBackups‚Äù located in the root of the% programmfiles% \ Kerio \ directory. <br><br>  Video clip of the regular update process: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/qSLSCApO8cs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Switching to the latest Windows version of Kerio Control 7.4.2 will be the final upgrade step for this platform.  The next steps in the transition are to prepare the Appliance platform, migrate the configuration, database of logs and user statistics. <br><br><h4>  Switch to the Appliance Platform. </h4><br><br>  In this section, we will look at options for deploying various Kerio Control Appliance distributions. <br><br><h5>  Install Software Appliance </h5><br><br>  This version of the installation package can be deployed in the following ways: <br><ul><li>  An ISO image can be burned onto a physical CD or DVD media, which you will need to use later to install Kerio Control on a physical or virtual host. </li><li>  In the case of virtual PCs, the ISO image can be connected as a virtual CD / DVD-ROM to install from it, without the need to write to physical media. </li><li>  An ISO image can be written to a USB flash drive and installed from it.  For instructions, refer to the relevant article ( <a href="http://kb.kerio.com/928">kb.kerio.com/928</a> ) in our knowledge base. </li></ul><br><br><h5>  Install VMware Virtual Appliance </h5><br><br>  To install the Kerio Control VMware Virtual Appliance on various virtualization tools from VMware, use the appropriate version of the Kerio Control VMware Virtual Appliance distribution kit: <br><br>  For VMware Server, Workstation, Player, Fusion, use the archived (*. Zip) VMX file: <br><br>  Installing a virtual module in a VMware player <br><img src="https://habrastorage.org/getpro/habr/post_images/06d/7cb/8ba/06d7cb8bac57a57cf1ddeced00e98862.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fef/7a5/4bc/fef7a54bcdba36f776732225fb099a89.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/13a/ccb/8e3/13accb8e3becd2b9399dc572ebd92613.png"><br><br><ul><li>  For VMware ESX / ESXi / vSphere Hypervisor, use a special OVF link to import a virtual module that looks like this: </li></ul><br> <code>http://download.kerio.com/en/dwn/control/kerio-control-appliance-1.2.3-4567-linux.ovf</code> <br> <br>  VMware ESX / ESXi will automatically download the OVF configuration file and the corresponding virtual hard disk image (.vmdk) <br>  When using the OVF format, the following aspects should be considered: <br><ul><li>  In the virtual Kerio Control module, time synchronization with the virtualization server is disabled.  However, Kerio Control has built-in time synchronization tools with public network time sources on the Internet.  Thus, the use of synchronization between the virtual machine and the virtualization server is optional. </li><li>  The ‚Äúshutdown‚Äù and ‚Äúrestart‚Äù tasks of the virtual machine will be set to the ‚Äúdefault‚Äù values.  The ability to set these values ‚Äã‚Äãto ‚Äúforced‚Äù shutdown and ‚Äúforced‚Äù restart modes is retained, however, these shutdown and restart options can cause data loss in the virtual Kerio Control module.  Virtual module Kerio Control supports the so-called.  ‚ÄúSoft‚Äù shutdown and ‚Äúsoft‚Äù reboot, allowing you to shut down or restart the guest OS correctly, so it is recommended to use the default values. </li></ul><br><br>  Installing a virtual module (ovf) in VMware vSphere <br><img src="https://habrastorage.org/getpro/habr/post_images/9b1/758/aad/9b1758aad0eea61610e0c68eb74c6766.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/62a/5c0/a14/62a5c0a14d8fcff904099165d239ef34.png"><br><br><h5>  Install Virtual Appliance for Hyper-V </h5><br><br><ul><li>  Download the archived (* .zip) distribution kit, unpack it into the necessary folder. </li><li>  Create a new virtual machine, select the "Use existing virtual hard disk" option, specifying the file unpacked from the downloaded archive as the disk image </li></ul><br><br>  Installing a virtual module in MS Hyper-V <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f22/add/3f1/f22add3f15b4713d187348b85f9a04ee.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bd8/460/5d1/bd84605d16b84232b577cfa3c5c40e2f.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/676/e11/644/676e1164453375b2cc68137fe3d08c5c.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/25f/1cc/2a9/25f1cc2a959936096317268461023136.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/8aa/de7/e06/8aade7e067be307f7740f6378247ea78.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/67e/2a4/51d/67e2a451d01972a805eaeaa080daf76e.png"><br><br>  The next important point in preparing for the transition to the Appliance platform is the correct configuration of the network interfaces on the selected Appliance platform. <br><br><h5>  Configuring Network Interfaces in the Software Appliance </h5><br><br>  In the pseudo-graphical interface of the Kerio Control Software Appliance, you can configure IP addresses / multiple addresses in static or dynamic mode, create VLAN interfaces, and configure the interface in PPPoE mode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e51/fbb/abb/e51fbbabbde54a23702ad9a9f05cdb00.png"><br><br>  <em><b>Note: The</b> initial configuration of network interfaces in the distribution of the Kerio Control Software Appliance itself is identical for all assemblies of the Kerio Control Appliance, there are differences only when configuring virtual network interfaces in various virtualization environments where Kerio Control can be used.</em> <br><br><h5>  Preparing virtual network interfaces in Hyper-V </h5><br><br>  To perform the correct and minimally required configuration of the Hyper-V virtual switch, you will need to complete the following steps: <br><br>  Mapping of physical and virtual network interfaces <br><img src="https://habrastorage.org/files/83c/cc1/d97/83ccc1d974064dd184c66530c9a9592d.png"><br><br>  Checking the availability of the virtual bridge service on the physical network interfaces of the server <br><img src="https://habrastorage.org/getpro/habr/post_images/217/37b/54f/21737b54f62e560f6197bf3fa4d1786b.png"><br><br>  For a quick setup of the Kerio Control Hyper-V virtual Appliance network interfaces of the virtual Appliance, watch the following video clip: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/pug5UIP8lt0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  <em><b>Note:</b> Complete recommendations for configuring network interfaces for the Hyper-V virtualization environment must be obtained from the official source of the manufacturer's company.</em> <em><br></em>  <em>(http://technet.microsoft.com/ru-ru/)</em> <br><br><h5>  Prepare virtual network interfaces in VMware vSphere </h5><br><br>  Approximately the same chain of actions in the case of the preparation of virtual network interfaces in vSphere. <br><br>  Creating multiple virtual switches, the number depends on your needs for virtual network communications. <br><img src="https://habrastorage.org/getpro/habr/post_images/cae/e24/5fb/caee245fb5e3704438d8765ee61d7780.png"><br><br>  Creating a virtual switch in VMware vSphere <br><img src="https://habrastorage.org/getpro/habr/post_images/f8a/14a/598/f8a14a598fbd950aa2a3fb781d37b75c.png"><br><br>  Creating a virtual switch in VMware vSphere <br><img src="https://habrastorage.org/getpro/habr/post_images/b8c/ac0/7e1/b8cac07e14b29c90247b9393dd73909d.png"><br><br>  Creating a virtual switch in VMware vSphere <br><img src="https://habrastorage.org/getpro/habr/post_images/6fe/fce/d39/6fefced399e32cbe963d9c3e32b11875.png"><br><br>  Add the appropriate physical network interfaces to the virtual switches to allow the physical LAN of the enterprise to interact with them <br><img src="https://habrastorage.org/getpro/habr/post_images/9d8/ed7/230/9d8ed7230ec982028200fc1f9904c3ac.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/fdd/dd3/5b2/fdddd35b2023241be16ef964ebbf6ee6.png"><br><br>  Mapping of created virtual switches with virtual network interfaces Kerio Control VMware Virtual Appliance <br><img src="https://habrastorage.org/getpro/habr/post_images/b15/1d6/722/b151d6722366e96bc050bc2f3f973b60.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/91d/719/e4c/91d719e4c913a58ec4b2fd0532a08e45.png"><br><br>  <em><b>Note:</b> Full recommendations for configuring network interfaces for VMware virtualization environments should be taken from the official source of the manufacturer‚Äôs company ( <a href="https://www.vmware.com/support/vsphere-hypervisor.html">www.vmware.com/support/vsphere-hypervisor.html</a> )</em> <br><br>  After the Appliance assembly has been deployed and the network interfaces have been configured, you can proceed to migrate the basic user configuration with your Windows version of Kerio Control. <br>  The configuration transfer process itself consists of two steps: <br><br><h5>  Save the current configuration using the Configuration Assistant </h5><br><br>  When saving the configuration, it is recommended to remember, or better write out, the MAC addresses of your current network interfaces and their correspondence to the IP addresses used.  You will need this when restoring a configuration on a new installation of a Kerio Control Appliance. <br><br>  The process of saving the configuration is shown in the following images: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08f/2a4/741/08f2a4741e896f7678af7a40db43f415.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/863/980/acf/863980acfd0d223f116148ce94c126c3.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd7/7ba/d54/fd77bad546f33e813fd845d7e9f9f908.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f2c/60b/2ad/f2c60b2ad96f444b88fe7d10d0c7a94d.png"><br><br>  After this step, you saved the archive, which includes all the user configuration files of the current version of Kerio Control. <br><br>  The next step is to restore the previously saved configuration on the Appliance.  When restoring the configuration, the configuration assistant will suggest matching the configuration of the old network interfaces with the new ones used on the Kerio Control Appliance server. <br><br>  <em><b>Note:</b> This is exactly the moment when you need information about the MAC and IP addresses from the old server that you wrote out or remembered while saving the configuration to the old one.</em> <br><br>  The process of restoring the configuration is shown in the images below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b64/ac4/3b8/b64ac43b8ebd1ad758a4b7bc5cdc896b.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/1ad/924/1aa/1ad9241aaf3df24f767921d51beb44cc.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a37/eb4/96f/a37eb496fd11bb78eb948ba7089b251d.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/792/97b/3e1/79297b3e1bdbd28cea4e124e46305813.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/03f/7b2/a67/03f7b2a677e692455257a0a23c7bb9ac.png"><br><br>  To save the configuration, the Kerio Control Appliance server will automatically reboot, after which it can be used. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/223/5ee/374/2235ee374d611da90d816f92e231034e.png"><br><br>  However, the migration process is still too early to be considered complete, since  we need to transfer application protocol data and user statistics database from your old server. <br><br>  And here the most interesting begins!  What you read below is not described in any official, or in informal documentation, i.e.  there will be several acceptable live hacks, the use of which will help you in carrying out such an important process, transition to the appliance Kerio Control platform. <br><br>  And as usual, before we go with you to the immediate description, the usual "disclaimer": <br><br>  <b>IMPORTANT:</b> The procedure described below is not a documented possibility, therefore, in order to avoid undesirable consequences, before you start performing the data transfer, create a full backup of them by copying the data to a secure repository. <br><br>  And so transgress!  To begin, save the current database of application protocols.  To do this, save the protocol files located in the specified path. <br><br> <code>%programfiles%\kerio\winroute firewall\logs\*</code> <br> <br>  For better security of this data, it is recommended to back them up to an accessible secure storage before performing the transfer. <br><br>  Then, save the current user statistics database.  All this information is concentrated in the database file firebird, located in the folder <br><br> <code>%programfiles%\kerio\winroute firewall\star\data\</code> <br> <br>  From there, we just need the <code>star.fdb</code> file.  For better security of this data, it is recommended to perform a backup to an accessible secure storage before performing the transfer. <br><br>  After we have discovered and saved all the necessary information, we need to transfer it to a new server running Kerio Control Appliance. For this, the first thing you need to do to upload the previously saved data to the Kerio Control Appliance is to enable the SSH server for perform SFTP access.  To do this, in the web-based administration interface of Kerio Control, go to the menu <b>Status -&gt; System Status</b> , press and hold the ‚ÄúShift‚Äù key and click on the ‚Äú <b>Actions</b> ‚Äù button.  In the list that appears, select " <b>Enable SSH</b> ", confirm your actions by agreeing to the question in the window that appears. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/886/13e/d57/88613ed574c59e5bd160b62b94fc7b93.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9aa/b03/323/9aab033235f0d889afe6a5f8ef212a8c.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f26/dd8/d7e/f26dd8d7e0ca0bb4b9147ed0c4c14d23.png"><br><br>  After that, you need to make sure that in the Kerio Control traffic rules you have allowed access to the Kerio Control Appliance host via the SSH protocol from the location you need. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/99c/bc1/d50/99cbc1d505acb8a5a3f2b6ba91f79889.png"><br><br>  After you have enabled SSH and allowed the appropriate access, you need to connect to the Kerio Control Appliance server in order to upload the necessary protocol data and user statistics database to it.  To do this, we will use the WinSCP application, which allows you to make connections using SFTP. <br>  To connect to the Kerio Control Appliance server, you must specify a username and an access password; enter ‚Äúroot‚Äù as the user name (without quotes);  as the password, enter the password of the ‚ÄúAdmin‚Äù account built into Kerio Control. <br><br>  SFTP settings to connect to the Kerio Control server <br><img src="https://habrastorage.org/getpro/habr/post_images/419/241/afb/419241afb48dfc3a4650964447180645.png"><br><br>  After establishing the connection, you must place your data in certain folders of the server.  The log files must be copied to the <b>/ var / winroute / logs</b> folder, and the user statistics file must be copied to the <b>/ var / winroute / star / data</b> folder, while the old files must either be deleted or renamed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/daa/89c/f44/daa89cf444d99a935f5cde2d4f309dd2.png"><br><br>  <em><b>Note:</b> It is better to rename old files to save a backup of current data.</em>  <em>In the case of application log files, you only need to rename old files with the * .log extension.</em> <br><br>  After copying is complete, you need to restart the Kerio Control service.  To do this, you need to get direct access to the Kerio Control Appliance server.  In the case of a Software Appliance, access is provided through the monitor and keyboard of the server itself, on which the Kerio Control Software Appliance is installed.  In the case of the Kerio Control virtual module, access is provided via the console of the corresponding virtualization environment.  Otherwise, the actions will be the same. <br><br>  To go from a pseudographic console to the command line interface, press the ‚ÄúAlt-F2‚Äù key combination.  In the invitation to enter a username, enter the name ‚Äúroot‚Äù (without quotes), click ‚Äúenter‚Äù, in the password field enter the password of the Admin account built into Kerio Control. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45c/928/02f/45c92802f0d2f857c8cd86d7be53f3cd.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/905/d6a/f76/905d6af76eb47b7303ca2fc68e1f32d9.png"><br><br>  <em><b>Note:</b> it is necessary to take into account that the introduction of a password in the OS of the Linux family is not displayed even by the asterisk icons, and if you make a mistake, you will not be able to correct it - you will have to enter the password again.</em> <br><br>  At the command prompt, enter the following: <br><br> <code>/etc/boxinit.d/60winroute restart</code> <br> <br>  This command will restart the Kerio Control daemon (service), after which Kerio Control will ‚Äúhook‚Äù the previously copied application protocols and user statistics. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0cf/876/232/0cf876232ebc6a835de27300a18251da.png"><br><br>  After the start of the Kerio Control daemon, you need to check the integrity of the transferred data, for this you can use the user statistics web interface and / or the Kerio Control web administration interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/115/faf/4a7/115faf4a7511d7dde91a4c4cfe2dfe77.png"><br><br>  If everything is in order with all the data, then the transition to the new Kerio Control Appliance platform can be considered completed and it remains only to complete the regular update procedure for Kerio Control to the current version.  If with some part of the data "not everything is in order", then there are two options: <br>  <em>1) make sure that the data taken from the source Kerio Control server (KWF) was initially in order;)</em> <em><br></em>  <em>2) if everything is OK with the source data, then it is necessary to repeat the procedure of transferring the part of the data with which there were problems.</em> <em><br></em>  <em>3) if the solutions of paragraphs.</em>  <em>1 and 2 did not help, then leave a comment here, try to figure it out together :)</em> <em><br></em> <br><br>  Now that all important data is in place, you can ‚Äúpull‚Äù the version of the Kerio Control Appliance to the latest.  The standard update process can take place in two ways, in automatic and manual modes. <br><br><h5>  Automatic update mode version. </h5><br><br>  Kerio Control can automatically check for new versions on the Kerio update site. <br><ol><li>  In the web-based administration interface go to the ‚Äú <b>Additional options</b> ‚Äù menu item, to the ‚Äú <b>Check for updates</b> ‚Äù tab </li><li>  Enable the option ‚Äú <b>Periodically check for new versions</b> ‚Äù.  Kerio Control will check for new versions every 24 hours.  As soon as the availability of a new version is established, a link to download the update will be displayed on the ‚Äú <b>Check for Updates</b> ‚Äù tab.  In order to check for updates immediately, click on the ‚Äú <b>Check Now</b> ‚Äù button. </li><li>  If you want to download updated versions immediately after their detection, enable the option ‚Äú <b>Download new versions automatically</b> ‚Äù.  As soon as the new version is downloaded, you will receive a notification in the web-based administration interface. </li><li>  After downloading the update, click " <b>Update Now</b> " </li><li>  Confirm your intention to update and perform a subsequent automatic restart of Kerio Control </li><li>  Wait until the installation of the new version is complete and the Kerio Control reboot. </li><li>  Upgrade complete. </li></ol><br><br><img src="https://habrastorage.org/getpro/habr/post_images/a27/7f8/593/a277f85932324638421a1f82e5a9d93d.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/762/20e/f4d/76220ef4ddbcd924b44c95c739d2286d.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c18/824/402/c18824402bf428c7ad5536e479fbd040.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/82f/387/7af/82f3877afe51c4255781bedab300bbb6.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/719/0ae/ac3/7190aeac38ea0e5a8eb96a2bf0048c3d.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/517/142/30f/51714230f5fdc81db4b743706a4ba9bf.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/47b/66d/56d47b66dfc5846368f94d90209e6c81.png"><br><br><h5>  Manual update mode version. </h5><br><br>  This update mode can be useful in the following circumstances: <br><br><ul><li>  Rollback to the previous version of Kerio Control </li><li>  Update to an intermediate or non-regular version (for example, closed Beta release). </li><li>  Update the gateway with the maximum restrictions for ITU on access to Internet resources. </li></ul><br><br>  To perform the update in manual mode, you need to download a special image (Upgrade Image) from the Kerio Control download page (http://www.kerio.ru/support/kerio-control). <br><br>  After downloading, follow these steps: <br><ul><li>  In the web-based administration interface go to the ‚Äú <b>Additional options</b> ‚Äù menu item, to the ‚Äú <b>Check for updates</b> ‚Äù tab </li><li>  Click on the " <b>Select</b> " button </li><li>  Specify the location of the update image file (kerio-control-upgrade.img) </li><li>  Click on the button ‚Äú <b>Download version update file</b> ‚Äù </li><li>  After downloading, click on the button ‚Äú <b>Start update version</b> ‚Äù </li><li>  Wait for the update and reboot Kerio Control </li><li>  Upgrade complete. </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/87d/679/238/87d679238940eb6f2f40c059a65e9661.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/339/81f/534/33981f5344f2e6a7613bfe7ec6cdeddb.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d8a/88a/b3e/d8a88ab3e0e65552336f0c9d1d01a62d.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/b86/b44/25f/b86b4425f5d04f9627aa7d433e6ed96e.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/208/ab8/603/208ab8603516f24879221f120ee0f95a.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9aa/96a/031/9aa96a031ec7e74566479ef27489328e.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/517/142/30f/51714230f5fdc81db4b743706a4ba9bf.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/56d/47b/66d/56d47b66dfc5846368f94d90209e6c81.png"><br><br>  Voila, you have a full-fledged Internet gateway based on the Kerio Control Appliance!  Congratulations on completing the transition to the UTM Kerio Control! </habracut></div><p>Source: <a href="https://habr.com/ru/post/224883/">https://habr.com/ru/post/224883/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224867/index.html">Why did we choose Bitbucket for code review, not GitHub?</a></li>
<li><a href="../224869/index.html">The future of Ethernet & FC</a></li>
<li><a href="../224871/index.html">The electronic cigarette will count every puff</a></li>
<li><a href="../224875/index.html">Feature # 2 - Podcast on entrepreneurs and current trends in the IT ecosystem</a></li>
<li><a href="../224879/index.html">Anemic Domain Model [Translation]</a></li>
<li><a href="../224889/index.html">Google maps clustering</a></li>
<li><a href="../224891/index.html">(May 25, Kiev) Fighters of the invisible front or the story of how to protect themselves from DDoS-attacks in a short time using Radware</a></li>
<li><a href="../224895/index.html">The main international standards and best practices for auditing information technology</a></li>
<li><a href="../224897/index.html">WebRTC or how I taught our CRM to call phones</a></li>
<li><a href="../224901/index.html">Automatic downloading of the list of prohibited sites from the Roskomnadzor service</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>