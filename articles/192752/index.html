<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Solving Japanese crosswords with a single SQL query</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi habr! The day of the programmer is approaching, and I am in a hurry to share my abnormal experiences. 

 Japanese Crossword - NP-complete task, as ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Solving Japanese crosswords with a single SQL query</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b53/ad8/a5d/b53ad8a5d6c97f2c05a02c4521b89f92.png" align="right">  Hi habr!  The day of the programmer is approaching, and I am in a hurry to share my abnormal experiences. <br><br>  Japanese Crossword - NP-complete task, as well as the task of a traveling salesman, laying a backpack, etc. When a person solves it, you should consistently determine the guaranteed filled and empty cells.  One by one, cross out the columns and lines until the whole picture is folded.  How is it possible to program the solution of a similar problem in a language that is not even officially a programming language, does not contain cycles and variables?  SQL is a query language, its main task is to select rows.  So we will generate a lot of all possible permutations and, like a sculptor, cut off all unnecessary. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To reproduce the request, you will need Oracle Database 11g or higher (12th on the way).  Earlier versions are not suitable because of the use of the analytic function listagg.  It is possible to use Express Edition (XE), but this stub is use up to 1GB of memory, so the maximum field size that this version can crack is 5x4.  Already on the field 5x5 memory limit ends. <br><br>  The query does not use any real database tables, you do not need to prepare anything for it.  Input data is passed in the WITH subquery.  You can use the proposed crossword puzzle or make your own.  To do this, describe the task - a list of numbers above and to the left of the crossword, specify the size of the field.  You can also specify the characters for filled and empty cells to your liking. <br><br>  In the process of working lines will have to sort a lot, unrealistically a lot!  The field consists of cells, the total number of rows * number of columns.  Each cell can be filled (1) or empty (0).  Then the number of all possible permutations grows nonlinearly according to the formula 2 ^ (number of cells).  And since the size of the field is not fixed in advance, each cell is represented by a separate line.  As a result, the resulting number of permutations must be multiplied by the number of cells.  Here, for example, several square fields: <br>  3x3 = 4 608 <br>  4x4 = 1,048,576 <br>  5x5 = 838 860 800 <br>  6x6 = 412 316 860 416 <br>  8x8 = 1 180 591 620 717 411 303 424 <br><br>  The positive side of a complete search - there will be all solutions.  So, if you have idle computing power, now you know what to do with them!  I don‚Äôt tell about the algorithm - it‚Äôs necessary to read from the end, each subquery is commented. <br><br><div class="spoiler">  <b class="spoiler_title">Request itself</b> <div class="spoiler_text"><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-comment"><span class="hljs-comment">-----------------------------   --------------------------------- --        .     --  .  (  5)  - . --  ,    . --    -. select '2, 1 1, 1 2, 3' as FIELD_COLS, --     '2, 1 1, 1 2, 3' as FIELD_ROWS, --     4 as COL_COUNT, --     4 as ROW_COUNT, --     '#' as FILL, -- -   ' ' as EMPT -- -   from dual ) -------------------------------------------------------------------------------- -- :         . select max(RES) as SOLUTION from ( --     (       ) select PERM, listagg( decode(VAL, '1', FILL, EMPT) || decode(mod(CELL, COL_COUNT), 0, chr(13)) ) within group (order by PERM, CELL) over (partition by PERM) as RES from ( --    . select CELL, PERM, VAL from ( --       ,  -- '1011001110' -&gt; '1 2 3',     . --        ,   --   1,  0.       --  ,     . select CELL, PERM, VAL, min( case when nvl(trim(replace( length(regexp_substr(VALUES_COL, REG, 1, 1, 'c', 1)) || ' ' || length(regexp_substr(VALUES_COL, REG, 1, 1, 'c', 2)) || ' ' || length(regexp_substr(VALUES_COL, REG, 1, 1, 'c', 3)) || ' ' || length(regexp_substr(VALUES_COL, REG, 1, 1, 'c', 4)) || ' ' || length(regexp_substr(VALUES_COL, REG, 1, 1, 'c', 5)) ,' 0', '' )), '0') = RULE_COL and nvl(trim(replace( length(regexp_substr(VALUES_ROW, REG, 1, 1, 'c', 1)) || ' ' || length(regexp_substr(VALUES_ROW, REG, 1, 1, 'c', 2)) || ' ' || length(regexp_substr(VALUES_ROW, REG, 1, 1, 'c', 3)) || ' ' || length(regexp_substr(VALUES_ROW, REG, 1, 1, 'c', 4)) || ' ' || length(regexp_substr(VALUES_ROW, REG, 1, 1, 'c', 5)) ,' 0', '' )), '0') = RULE_ROW then 1 else 0 end ) over (partition by PERM) as IS_PERM_VALID from ( --    ,     --      X  Y,  '1011001110'. select CELL, RULE_COL, RULE_ROW, PERM, VAL, listagg(VAL) within group (order by PERM, X, CELL) over (partition by PERM, X) as VALUES_COL, listagg(VAL) within group (order by PERM, Y, CELL) over (partition by PERM, Y) as VALUES_ROW, '0*(1*)0*(1*)0*(1*)0*(1*)0*(1*)0*' as REG from ( --      . --   (1/0)     . select CELL, X, Y, RULE_COL, RULE_ROW, PERM, to_char(mod(trunc(PERM / power(2, CELL -1)), 2)) as VAL from ( --         X  Y --      .  select CELL, X, Y, trim(regexp_substr( FIELD_COLS, substr(rpad('s', X * length(REG) +1, REG), 3), 1, 1, 'c', X )) as RULE_COL, trim(regexp_substr( FIELD_ROWS, substr(rpad('s', Y * length(REG) +1, REG), 3), 1, 1, 'c', Y )) as RULE_ROW from ( --   ! --       , --      X  Y. select LEVEL as CELL, --   mod(LEVEL -1, COL_COUNT) +1 as X, trunc((LEVEL -1) / COL_COUNT) +1 as Y, ',([^,]+)' as REG, FIELD_COLS, FIELD_ROWS from INPUT connect by LEVEL &lt;= COL_COUNT * ROW_COUNT ) ), ( --      select LEVEL -1 as PERM --  ,   0 from INPUT connect by LEVEL &lt;= power(2, COL_COUNT * ROW_COUNT) ) ) ) ) where IS_PERM_VALID = 1 ), ( --      select COL_COUNT, FILL, EMPT from INPUT ) ) group by PERM;</span></span></code> </pre> <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/192752/">https://habr.com/ru/post/192752/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192738/index.html">0 dB Silent computer. Version 1.0</a></li>
<li><a href="../192740/index.html">CornerJS, or ‚Äúas in AngularJS‚Äù directives, only better</a></li>
<li><a href="../192742/index.html">About Selenium and one "bike"</a></li>
<li><a href="../192744/index.html">Web design 2013: traditions, innovations, basics</a></li>
<li><a href="../192748/index.html">Pressy - the all-powerful Android button</a></li>
<li><a href="../192754/index.html">Business plan template (financial model) studios / agencies</a></li>
<li><a href="../192756/index.html">API services Mangomag.ru</a></li>
<li><a href="../192758/index.html">SEO vs development, how not to suffer the customer</a></li>
<li><a href="../192760/index.html">Robot Vacuum Cleaner Test: iRobot Roomba 780, Moneual MR7700, iClebo Arte and Neato XV-11</a></li>
<li><a href="../192762/index.html">Sony Xperia Z1 - coming soon!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>