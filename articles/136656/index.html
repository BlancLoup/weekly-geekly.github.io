<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We create our own framework based on symfony2. (Part 4)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Part 1 
- Part 2 
- Part 3 
- Part 4 
- Part 5 

 Before we move on to today's topic, we‚Äôll change our framework a bit, so as to make templating mor...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We create our own framework based on symfony2. (Part 4)</h1><div class="post__text post__text-html js-mediator-article"><ul><li>  <a href="http://habrahabr.ru/blogs/symfony/136110/">Part 1</a> </li><li>  <a href="http://habrahabr.ru/blogs/symfony/136430/">Part 2</a> </li><li>  <a href="http://habrahabr.ru/blogs/symfony/136471/">Part 3</a> </li><li>  <b>Part 4</b> </li><li>  <a href="http://habrahabr.ru/blogs/symfony/138010/">Part 5</a> </li></ul><br><br>  Before we move on to today's topic, we‚Äôll change our framework a bit, so as to make templating more convenient: <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// example.com/web/front.php require_once __DIR__.'/../src/autoload.php'; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpFoundation\Response; $request = Request::createFromGlobals(); $map = array( '/hello' =&gt; 'hello', '/bye' =&gt; 'bye', ); $path = $request-&gt;getPathInfo(); if (isset($map[$path])) { ob_start(); extract($request-&gt;query-&gt;all(), EXTR_SKIP); include sprintf(__DIR__.'/../src/pages/%s.php', $map[$path]); $response = new Response(ob_get_clean()); } else { $response = new Response('Not Found', 404); } $response-&gt;send();</span></span></code> </pre> <br><a name="habracut"></a><br>  Since we imported variables from the query array into the current symbol table, <i>let's</i> simplify the <i>hello.php</i> template as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="php hljs">&lt;!-- example.com/src/pages/hello.php --&gt; Hello <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> htmlspecialchars($name, ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>) <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><br>  Now add new functionality will be much more convenient. <br>  An important aspect of any site is the look of its links.  Thanks to the reference map, we have separated them from the code that generates the associative answer, but it is still not flexible enough.  For example, that if we want to process data from dynamically generated paths, instead of a parameterized string: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># Before /hello?name=Fabien # After /hello/Fabien</span></span></code> </pre><br><br>  To support this feature, we will use the Symfony2 routing component (the Symfony2 <i>"Routing"</i> component).  As always, add the component to composer.json and run the <code>php composer.phar update</code> command to install it: <br><br><pre> <code class="php hljs">{ <span class="hljs-string"><span class="hljs-string">"require"</span></span>: { <span class="hljs-string"><span class="hljs-string">"symfony/class-loader"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"symfony/http-foundation"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span>, <span class="hljs-string"><span class="hljs-string">"symfony/routing"</span></span>: <span class="hljs-string"><span class="hljs-string">"2.1.*"</span></span> } }</code> </pre><br><br>  From now on, we will use the autoloader generated by Composer instead of our <i>autoload.php</i> .  Delete the <i>autoload.php</i> file and change the link to it in <i>front.php</i> : <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// example.com/web/front.php require_once __DIR__.'/../vendor/.composer/autoload.php'; // ...</span></span></code> </pre><br><br>  The routing component uses an instance of the class <i>‚ÄúRouteCollection‚Äù</i> , instead of an array of matches (reference map). <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RouteCollection</span></span>; $routes = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouteCollection();</code> </pre><br><br>  Let's add a route for the link of the form <i>/ hello / SOMETHING</i> and one more for simple <i>/ bye</i> : <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">Route</span></span>; $routes-&gt;add(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Route(<span class="hljs-string"><span class="hljs-string">'/hello/{name}'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'World'</span></span>))); $routes-&gt;add(<span class="hljs-string"><span class="hljs-string">'bye'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Route(<span class="hljs-string"><span class="hljs-string">'/bye'</span></span>));</code> </pre><br><br>  Each element of the collection is defined by a name (hello) and an instance of the class <i>‚ÄúRoute‚Äù</i> , which in turn is determined by the pattern of the route <code>(/hello/{name})</code> and the array of default attributes <code>(array('name' =&gt; 'World'))</code> . <br>  In the official documentation for this component, you will find information about its other functions, such as URL generation, attribute requirements, compliance with HTTP methods, a YAML or XML file uploader, exporting rewrite rules to PHP or Apache to improve performance, and much more. <br>  Based on the information in the instance of the <i>‚ÄúRouteCollection‚Äù</i> class, an instance of the <i>‚ÄúUrlMatcher‚Äù</i> class will link the paths: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">RequestContext</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>\<span class="hljs-title"><span class="hljs-title">Matcher</span></span>\<span class="hljs-title"><span class="hljs-title">UrlMatcher</span></span>; $context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestContext(); $context-&gt;fromRequest($request); $matcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlMatcher($routes, $context); $attributes = $matcher-&gt;match($request-&gt;getPathInfo());</code> </pre><br><br>  The <b>match ()</b> method splits the requested path into an array (note that matching paths are automatically saved under the special <i>_route</i> key): <br><br><pre> <code class="php hljs">print_r($matcher-&gt;match(<span class="hljs-string"><span class="hljs-string">'/bye'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'_route'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'bye'</span></span>, ); print_r($matcher-&gt;match(<span class="hljs-string"><span class="hljs-string">'/hello/Fabien'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Fabien'</span></span>, <span class="hljs-string"><span class="hljs-string">'_route'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'hello'</span></span>, ); print_r($matcher-&gt;match(<span class="hljs-string"><span class="hljs-string">'/hello'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'World'</span></span>, <span class="hljs-string"><span class="hljs-string">'_route'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'hello'</span></span>, );</code> </pre><br><br>  Even if in our example the query parameters are not needed, they are used on real projects to verify the requirements of the methods and so on. <br>  If a match cannot be found with a single path, an exception is thrown: <br><br><pre> <code class="php hljs">$matcher-&gt;match(<span class="hljs-string"><span class="hljs-string">'/not-found'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// throws a Symfony\Component\Routing\Exception\ResourceNotFoundException</span></span></code> </pre><br><br>  Now, using acquired knowledge, it's time to write the following version of our framework: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// example.com/web/front.php require_once __DIR__.'/../vendor/.composer/autoload.php'; use Symfony\Component\HttpFoundation\Request; use Symfony\Component\HttpFoundation\Response; use Symfony\Component\Routing; $request = Request::createFromGlobals(); $routes = include __DIR__.'/../src/app.php'; $context = new Routing\RequestContext(); $context-&gt;fromRequest($request); $matcher = new Routing\Matcher\UrlMatcher($routes, $context); try { extract($matcher-&gt;match($request-&gt;getPathInfo()), EXTR_SKIP); ob_start(); include sprintf(__DIR__.'/../src/pages/%s.php', $_route); $response = new Response(ob_get_clean()); } catch (Routing\Exception\ResourceNotFoundException $e) { $response = new Response('Not Found', 404); } catch (Exception $e) { $response = new Response('An error occurred', 500); } $response-&gt;send();</span></span></code> </pre><br><br>  New code changes: <br>  ‚Ä¢ Path names are used for template names. <br>  ‚Ä¢ Error 500 is processed correctly. <br>  ‚Ä¢ Query parameters are separated to keep patterns simple. <br><pre> <code class="php hljs">&lt;!-- example.com/src/pages/hello.php --&gt; Hello <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> htmlspecialchars($name, ENT_QUOTES, <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span>) <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  ‚Ä¢ The route configuration has been moved to a separate file: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// example.com/src/app.php use Symfony\Component\Routing; $routes = new Routing\RouteCollection(); $routes-&gt;add('hello', new Routing\Route('/hello/{name}', array('name' =&gt; 'World'))); $routes-&gt;add('bye', new Routing\Route('/bye')); return $routes;</span></span></code> </pre><br><br>  We completely separated the configuration (everything, the characteristics of our application - in <i>app.php</i> ) and the framework (the rest of the code on which our application is based - in <i>front.php</i> ). <br>  Having added about 30 lines of code, we got a new framework - more productive, more flexible than the previous one.  Enjoy! <br>  Using the routing component has another great advantage: the ability to generate URLs based on Route definitions.  If you simultaneously use URL matching and URL generation in your code, there should be no consequences when changing the URL type.  Want to know how to use a generator?  Insanely simple: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">Routing</span></span>; $generator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Routing\Generator\UrlGenerator($routes, $context); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $generator-&gt;generate(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Fabien'</span></span>)); <span class="hljs-comment"><span class="hljs-comment">// outputs /hello/Fabien</span></span></code> </pre><br><br>  The code is absolutely clear; we can also generate absolute paths by adding the third parameter true: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $generator-&gt;generate(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Fabien'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">// outputs something like http://example.com/somewhere/hello/Fabien</span></span></code> </pre><br><br>  Concerned about performance?  Using your route definitions, create an optimized URL match class that will replace the default <i>UrlMatcher</i> : <br><br><pre> <code class="php hljs">$dumper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Routing\Matcher\Dumper\PhpMatcherDumper($routes); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $dumper-&gt;dump();</code> </pre><br><br>  Want even more performance?  Export your routes as mod_rewrite rules for Apache: <br><br><pre> <code class="php hljs">$dumper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Routing\Matcher\Dumper\ApacheMatcherDumper($routes); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $dumper-&gt;dump();</code> </pre><br><br>  We agreed with the user <a href="https://habrahabr.ru/users/fozzy/" class="user_link">fozzy</a> to translate this cycle together. </div><p>Source: <a href="https://habr.com/ru/post/136656/">https://habr.com/ru/post/136656/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136646/index.html">From Basra to Rome. Convert Arabic numbers to Roman</a></li>
<li><a href="../136647/index.html">Canobuvosti, 127th edition</a></li>
<li><a href="../136650/index.html">Bitcoin-like ownership transfer mechanism</a></li>
<li><a href="../136652/index.html">FBI, give me back the files that I stored on MegaUpload</a></li>
<li><a href="../136654/index.html">A selection of html / javascript / css tools and libraries from SmashingMagazine</a></li>
<li><a href="../136658/index.html">GPS Past, present and future through the eyes of the inhabitant</a></li>
<li><a href="../136659/index.html">Administrative Interface with SonataAdminBundle</a></li>
<li><a href="../136662/index.html">Microsoft released a cloud-optimized math library: Cloud Numerics</a></li>
<li><a href="../136663/index.html">What is the best way to participate in Imagine Cup Software Design, go to Australia and win</a></li>
<li><a href="../136664/index.html">Myths about the App Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>