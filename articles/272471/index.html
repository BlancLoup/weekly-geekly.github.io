<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to scale Ruby applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The main goal of our work is to make IaaS simple and straightforward, even for those who have not experienced IT. Therefore, we carry out continuous o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to scale Ruby applications</h1><div class="post__text post__text-html js-mediator-article">  The main goal of our work is to make IaaS simple and straightforward, even for those who have not experienced IT.  Therefore, we carry out continuous optimization of all systems and talk about what we managed to do in our blog on Habr√©. <br><br>  A couple of examples: <br><br><ul><li>  <a href="https://habrahabr.ru/company/1cloud/blog/260523/">How our IaaS provider API works</a> </li><li>  <a href="https://habrahabr.ru/company/1cloud/blog/261139/">How we developed our DNS manager</a> </li></ul><br>  Today we decided to take a look at Western experience and briefly analyze the topic of scaling applications.  We were attracted by the <a href="http://www.nateberkopec.com/2015/07/29/scaling-ruby-apps-to-1000-rpm.html">leadership of</a> Nate Berkopec, an expert in Ruby. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="https://habrahabr.ru/company/1cloud/blog/272471/"><img src="https://habrastorage.org/files/c7e/cbc/085/c7ecbc08513d4c69b174041c54bfd962.jpg"></a> <a name="habracut"></a><br>  <i>/ photo <a href="https://www.flickr.com/photos/juhansonin/">Juhan Sonin</a> <a href="https://creativecommons.org/licenses/by/2.0/">CC</a></i> <br><br>  Nate begins by talking about the complexity of the topic as a whole.  There is a certain difference between those methods that are suitable for scaling from 10 to 1000 requests per minute, and those that use companies like Twitter to go to handle 600 requests per second. <br><br>  Special thrust to scaling is usually compensated by the fact that at a certain stage you have problems with input / output in the database.  Managing the number of processes, CPU and RAM load complicates scaling for those who develop Rails applications. <br><br>  Here, Nate talks about using Memcached and Redis with RabbitMQ and Kafka.  Basically, he applied similar solutions on the Heroku platform, which is generally suitable for solving a similar problem with scaling up to 1000 requests per minute. <br><br>  He emphasizes that simply adding Dyno-containers on Heroku will not give the desired effect - the application will not be faster.  These containers can only increase reliability.  If we talk about AWS, the transition from one instance type to another (from T2 to M4) may already have an impact on application performance. <br><br>  Some insights from Nate's <a href="http://www.nateberkopec.com/2015/07/29/scaling-ruby-apps-to-1000-rpm.html">examples</a> : <br><br><ul><li>  Scaling can affect latency if you have a queue </li><li>  To solve the problem you need to understand the principles of the application server </li><li>  Heroku documentation does not explain all the nuances of routing HTTP requests </li><li>  A Ruby web application needs protection from a slow client and response </li><li>  You can not scale only on the basis of response time - here waiting time in a queue can play a role.  The same applies to workers' hosts. </li><li>  The web application can work not with one, but with dozens of queues, which are formed in the load balancer, Heroku routers, multiprocess server and in the ‚Äúmain process‚Äù </li><li>  The Little's Law allows you to determine the number of required instances of an application as the product of the average number of requests per second by the average response time (in seconds).  If you start scaling at 25% performance, it will be something in the spirit of a false start.  Performance here is the ratio of the number of application instances to the average response time. </li></ul><br><h3>  Query routing </h3><br>  Briefly about how this process works: <br><br>  1. First of all, the request meets the load balancer - it distributes requests between the Heroku routers. <br><br>  2. The router sends a processing request to a random Dyno container that is related to your application. <br><br>  3. While the router is determined by which container to choose, the request is in its waiting queue.  This process is similar to running nginx and sending health check requests. <br><br>  Next, the server of your choice works with the request: <br><br>  1. For Webrick - opens a connection with the router to download the request, then launches the response to the router and proceeds to the next request.  This process completely loads the host and allows it to work with requests from other routers. <br><br>  2. Thin works a little differently.  It is event driven.  It uses EventMachine, which is similar to the work of Node.js.  Thin accepts the request in parts, but only after the request is fully downloaded, it sends it to the application.  It is well suited for handling slow requests, but is not multi-tasking. <br><br>  3. Unicorn is a single-threaded, but already multi-tasking web server.  It is built on workers and listening to a single Unix socket.  Here the situation is similar - the request must be fully loaded, so Unicorn is not very suitable for slow clients, like Webrick.  While loading other connections can not be established.  This problem is solved by query buffering, which Passenger handles. <br><br>  4. Phusion Passenger 5 - it allows you to install something like nginx right before workers.  It incorporates a reverse proxy server that protects workflows from slow clients and downloads.  As the request loads, it is passed to HelperAgent, which distributes requests between workers.  It is quite suitable for scaling.  The alternative is Puma in cluster mode or Unicorn in conjunction with nginx. <br><br>  PS A little about the work of our IaaS provider: <br><br><ul><li>  <a href="http://habrahabr.ru/company/1cloud/blog/244121/">About IT infrastructure IaaS-provider</a> </li><li>  <a href="http://habrahabr.ru/company/1cloud/blog/243133/">About the redesign of our site</a> </li><li>  <a href="http://habrahabr.ru/company/1cloud/blog/250427/">About the development of our API</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/272471/">https://habr.com/ru/post/272471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272457/index.html">Announced the start of acceptance of works at the symposium CTCrypt'2016</a></li>
<li><a href="../272459/index.html">Intro to rxjava</a></li>
<li><a href="../272461/index.html">How to split VPN traffic in MacOS</a></li>
<li><a href="../272467/index.html">Analysis of key performance indicators - Part 2, analysis of user, business and application metrics</a></li>
<li><a href="../272469/index.html">Translation: Instructions for conducting code review</a></li>
<li><a href="../272473/index.html">About system thinking</a></li>
<li><a href="../272475/index.html">Simple Computer Classroom Management System</a></li>
<li><a href="../272477/index.html">The digest of interesting materials for the mobile developer # 132 (November 30 - December 6)</a></li>
<li><a href="../272479/index.html">Java 8 in parallel. Learn to create subtasks and monitor their implementation</a></li>
<li><a href="../272483/index.html">Basic laws for creating development teams</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>