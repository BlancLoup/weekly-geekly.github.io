<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Load data into postgresql</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I read an article about overclocking the performance of insert operations in an Oracle DBMS using Java transactions. Since I am currently working with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Load data into postgresql</h1><div class="post__text post__text-html js-mediator-article">  I read <a href="http://habrahabr.ru/post/196828/">an article</a> about overclocking the performance of insert operations in an Oracle DBMS using Java transactions.  Since I am currently working with postgresql, I decided to check how much this DBMS will issue in conjunction with the golan. <br>  Used stack: golang-1.1.2 + postgresql-9.3.1. <br>  To run the program, you need a Golang driver for postgresql.  I use the github.com/lib/pq driver, which I installed using the go get -u github.com/lib/pq command. <br><a name="habracut"></a><br><h4>  Testing environment </h4><br>  Home desktop with archlinux-x86_64, kernel-3.11.5, 4GB of RAM (at the time of the test was approximately 1.2GB free), the usual old spindle HDD.  Postgres is more or less configured (shared_buffers increased to 768MB and max_connections to 1000, + some other tuning), but without hardcore. <br>  For the purity of the experiment did not make any Goroutin - all in 1 stream. <br><br><div class="spoiler">  <b class="spoiler_title">Text of the program</b> <div class="spoiler_text"><pre><code class="go hljs"><span class="hljs-comment"><span class="hljs-comment">/* sql_insertion_test01.go * Synthetic test for simple insert operations into postgresql database * Call: ./sql_insertion_test01 * Pls, do not use name "insert_test", because this name is always used by go-pkg-system */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( _ <span class="hljs-string"><span class="hljs-string">"github.com/lib/pq"</span></span> <span class="hljs-string"><span class="hljs-string">"database/sql"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"time"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> DB_CONNECT_STRING = <span class="hljs-string"><span class="hljs-string">"host=localhost port=5432 user=your_role password=your_password dbname=your_database sslmode=disable"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { db, err := sql.Open(<span class="hljs-string"><span class="hljs-string">"postgres"</span></span>, DB_CONNECT_STRING) <span class="hljs-keyword"><span class="hljs-keyword">defer</span></span> db.Close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> err != <span class="hljs-literal"><span class="hljs-literal">nil</span></span> { fmt.Printf(<span class="hljs-string"><span class="hljs-string">"Database opening error --&gt;%v\n"</span></span>, err) <span class="hljs-built_in"><span class="hljs-built_in">panic</span></span>(<span class="hljs-string"><span class="hljs-string">"Database error"</span></span>) } init_database(&amp;db) make_insertion(&amp;db) } <span class="hljs-comment"><span class="hljs-comment">/*-----------------------------------------------------------------------------*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_database</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pdb **sql.DB)</span></span></span></span> { db := *pdb init_db_strings := []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>{ <span class="hljs-string"><span class="hljs-string">"DROP SCHEMA IF EXISTS sb CASCADE;"</span></span>, <span class="hljs-string"><span class="hljs-string">"CREATE SCHEMA sb;"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//be careful - next multiline string is quoted by backquote symbol `CREATE TABLE sb.test_data( id serial, device_id integer not null, parameter_id integer not null, value varchar(100), event_ctime timestamp default current_timestamp, constraint id_pk primary key (id));`} for _, qstr := range init_db_strings { _, err := db.Exec(qstr) if err != nil { fmt.Printf("Database init error --&gt;%v\n", err) panic("Query error") } } fmt.Println("Database rebuilded successfully") } /*-----------------------------------------------------------------------------*/ func make_insertion(pdb **sql.DB) { db := *pdb const TEST_NUMBER = 400000 // backquotes for next multiline string const INSERT_QUERY = `insert into sb.test_data(device_id, parameter_id, value) values ($1, $2, $3);` insert_query, err := db.Prepare(INSERT_QUERY) defer insert_query.Close() if err != nil { fmt.Printf("Query preparation error --&gt;%v\n", err) panic("Test query error") } t1 := time.Now() for i := 0; i &lt; TEST_NUMBER; i++ { _, err = insert_query.Exec(i, i, "0") if err != nil { fmt.Printf("Query execution error --&gt;%v\n", err) panic("Error") } } t2 := time.Since(t1) fmt.Printf("%v queries are executed for %v seconds (%v per second)\n", TEST_NUMBER, t2.Seconds(), TEST_NUMBER/t2.Seconds()) // do not forget clean up after work ) //_, err = db.Query("TRUNCATE sb.test_data;") }</span></span></code> </pre> <br></div></div><br><br>  As can be seen from the text - no special allotments in the transaction, Gorotin, temporary tables and other tricks - direct input. <br>  Well, of course, a bunch of prepare-exec. <br><h4>  results </h4><br>  Results - 16000-17000 inserts per second on my machine. <br>  The results do not depend on the constant TEST_NUMBER (set 1000, 2000, 4000, 40,000 and stopped at 400,000).  It is possible that plugging will occur at large values, but I think that there is enough of such performance for current purposes. <br>  I expected to get the worst numbers and planned to tinker with transactions, but it was not necessary. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  findings </h4><br>  I think that the test is still somewhat synthetic - just the data fit into the cache.  Do not leave the feeling that with some parameters had to rest against the performance of the disk subsystem.  And the desktop core allocates memory more vigorously than the server one. <br>  It is possible that the authors of the driver use some kind of trick.  But nevertheless, I think that this bundle of applications is quite usable. </div><p>Source: <a href="https://habr.com/ru/post/197718/">https://habr.com/ru/post/197718/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197704/index.html">Kickstarter is now available for Australia and New Zealand</a></li>
<li><a href="../197706/index.html">Apple invites you to look at new products on October 22</a></li>
<li><a href="../197708/index.html">Visiting MakeItLab, the first hackspace of Yekaterinburg</a></li>
<li><a href="../197712/index.html">The General Assembly project launched an online course for those who want to master CSS, JavaScript and HTML</a></li>
<li><a href="../197714/index.html">Where to go Russian in Silicon Valley - answer the questions of a person who wants to move to the Valley</a></li>
<li><a href="../19772/index.html">Across the Universe will sound in the open spaces of the universe</a></li>
<li><a href="../197720/index.html">CommuniGate Pro Unified Communications Server API</a></li>
<li><a href="../197728/index.html">Hacking Counter Strike Server or Security? No, have not heard!"</a></li>
<li><a href="../197730/index.html">Mail.Ru: Russian Developers Cup - accepting applications</a></li>
<li><a href="../197732/index.html">BlackBerry: you can continue to count on us</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>