<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic quest generator</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! 

 I want to talk about the quest generator, which I do for my browser-based ZPG. 



 Despite the fact that the issue of automatic generati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic quest generator</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr! <br><br>  I want to talk about the quest generator, which I do for my browser-based ZPG. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4cb/120/abc/4cb120abcd0a0b254406fd6956efd6be.jpg" align="left">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Despite the fact that the issue of automatic generation of tasks in the RPG is quite ancient, there are almost no generally available working versions of such generators (rather than none at all), except for quite primitive options.  There are not many works on this topic either, although if you actively google, you can dig up something.  Therefore, I hope that this text (and the generator itself, the link to the repository is at the end of the article) will be useful. <br><a name="habracut"></a><br><br>  For the hurried: <a href="">visualization of one of the received tasks</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Why generator needed</b> <div class="spoiler_text">  ZPG - Zero Player Game - a game without participation of the player, the closest popular analogue is Godville. <br><br>  The character of the player (hero) in the game acts completely independently and his main occupation is, of course, the execution of NPC tasks. <br><br>  The key point is that the tasks are non-linear and the player must make a choice, which NPC his hero will help and which one to harm.  The fate of the world directly depends on this (for example, an NPC may leave the game if many people harm him). <br><br>  In addition, the hero has a ‚Äúcharacter‚Äù that can influence his actions when performing a task (for example, you can indicate that he will seek to help a particular NPC). <br><br>  The hero gains experience only for completing quests. <br><br>  Based on this, a mechanism was needed to create interesting and complex tasks that do not contradict common sense and require the player to think before making a choice. <br></div></div><br>  Further, instead of ‚Äúquest‚Äù, I will use the term ‚Äúhistory‚Äù as more convenient to explain (each quest is a story limited by a couple of conventions, so it‚Äôs wiser to speak about the story generator). <br><br><h4>  Formulation of the problem </h4><br>  The requirements that I put forward for the stories can be formulated as follows: <br><br><ul><li>  nonlinearity (any number of forks and end options); </li><li>  nesting (one story can have any number of nested or consecutive sub stories); </li><li>  integrity (history must always have an ending, no matter what path the hero goes); </li><li>  feasibility (the hero must be guaranteed to go through any story in a finite time); </li><li>  consistency (history should not contradict the state of the world or itself); </li><li>  scalability (history participants can be any number of player characters or NPCs); </li><li>  variability (the stories should differ from each other, even if they are all about the same thing in general). </li></ul><br>  In addition to the requirements for the stories themselves, there are several more requirements directly to the generator: <br><br><ul><li>  the absence of defective stories (if the story is generated, then it must meet all the requirements); </li><li>  the ability to visualize the result (without visualization, the development will turn into hell). </li></ul><br>  Having defined the requirements, it was necessary to determine the fact that, in fact, such a quest or story.  In the end, I came to the following definition: <br><br><blockquote>  History is a directed acyclic connected graph.  The nodes of which describe the state (state requirements) of the participating objects and the environment at a specific stage in history, and the edges determine possible transitions between these stages. </blockquote><br>  From the definition of smoothly follows the idea of ‚Äã‚Äãimplementing history in the form of a state machine, which is given under the control of the game. <br><br>  As a result, our generator should, on the basis of information about the current state of the world, create a graph of history with the properties listed earlier. <br><br>  In turn, the resulting graph should be interpreted by the logic of the game.  Which, based on information about the current state of the story and the expected future state, will initiate the necessary changes in the actions of the hero or the environment, leading to the fulfillment of all the requirements necessary to move the story to the next stage. <br><br>  The interpreter itself is implemented rather trivially (at the end of the article there will be a link to an example implementation). <br><br><h4>  History structure </h4><br>  So, history is a graph consisting of nodes and edges.  Each node has a list of requirements (or checks, if you wish) that must be fulfilled so that history can go to the state corresponding to the node.  The requirement may be finding a hero in a particular place or having the necessary amount of money. <br><br>  In addition to the requirements for the state of the "world" for each node added a list of actions that must be performed when the story will be in this node.  Of course, they could be arranged as separate nodes with requirements, but this would significantly increase the graph itself and complicate its analysis by the developers.  The action, in this case, may be sending a message to the player, starting a battle with the monster or issuing a reward to the hero.  The same lists of actions are assigned to the beginning and end of movement along the edge. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ba/8e9/b15/6ba8e9b153fe69a816a95bd06becb079.png"><br>  <sup>Something like this might look like a simple story.</sup> <br><br><div class="spoiler">  <b class="spoiler_title">Symbols for graphs in the pictures</b> <div class="spoiler_text"><ul><li>  gray knots - the beginning and end of the story; </li><li>  purple nodes are points of choice; </li><li>  green nodes are common plot points; </li><li>  red nodes - conditional transitions; </li><li>  turquoise contours - subhistory; </li><li>  A dark background in the nodes indicates the requirements for the situation that must be met to be able to go to this point of the plot; </li><li>  brighter background highlights the actions that should be performed immediately after the transition to the plot point. </li></ul><br></div></div><br>  Movement between nodes can be represented as a loop: <br><br><ol><li>  selection of the edge of the graph, which will move; </li><li>  execution of actions assigned to the beginning of the movement along the edge; </li><li>  waiting until all the requirements of the next node are met; </li><li>  execution of actions assigned to the end of the motion along the edge; </li><li>  transition to the next node; </li><li>  performing actions on the node </li><li>  return to point 1. </li></ol><br>  History nodes are conveniently divided into types that define their role: <br><br><ul><li>  the beginning is the only entry point to the story (or sub-story).  The requirements of this state must ensure that further everything happens correctly from the point of view of common sense; </li><li>  the end is a marker for the completion of a story (or sub-story); </li><li>  point of choice - a node in which the hero (or player) must make a choice of the further course of events; </li><li>  A conditional transition point is a node in which the further path is determined by some dynamic parameter (for example, the amount of money the hero has); </li><li>  a normal node is a node that does not have additional properties (it simply defines the next event in a linear sequence). </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/e6f/548/2df/e6f5482dfbab17540d645b5ee817a4ba.png"><br>  <sup>This is a more complicated story.</sup> <br><br><h4>  History generation </h4><br>  The story may consist of several "atomic" tasks.  For example, a sick NPC can send a hero for a medicine to a witch who will require a service for him (performing another ‚Äúnested‚Äù task). <br><br>  Therefore, it is built from a set of "atomic" patterns.  The template is the same graph of history, but with all the variants of the development of events (even those that can make the history contradictory). <br><br>  The important point here is the combination of templates (remember that as a result we should have a connected graph): <br><br><ul><li>  at least one node of the parent history must go to the starting node of the child; </li><li>  At least one end node of the child history must go to the parent node. </li></ul><br>  After much deliberation, it was decided that all stories, in general, are characterized by a set of key "objects" (places, characters, objects).  Therefore, for each template, a set of constructors is created that accept data of a fixed format.  Here are some examples of constructors: <br><br><ul><li>  from a specific place - if it is important for us that the story begins in a certain place, and everything else can be as you please; </li><li>  between two NPCs - when it is necessary for one NPC (initiator) to give a task related to the second NPC (recipient) </li></ul><br>  When generating a child history, the parent filters all templates by the presence of the necessary constructor, from which it chooses a random one. <br><br>  Linking the parent history to the start of the child is simple - the parent creates an edge from the desired node to the only starting node of the child history. <br><br>  There may be several end nodes, and they may have different semantic meaning for the story.  For example, in a story about a witch, a hero can not only accomplish her task, but also fail him; accordingly, arcs from different end nodes must be kept strictly in the corresponding nodes of the parent story. <br><br>  To do this, each end node specifies a list of job results for each of the participant objects.  At the moment there are three possible results: <br><br><ul><li>  positive - the task has a positive impact on the object; </li><li>  neutral - the task had no effect on the object; </li><li>  negative - the task caused damage to the object. </li></ul><br>  Due to this, for each end node it is possible to determine its general meaning and correctly associate it with the parent history. <br><br><h4>  Postprocessing and validation </h4><br>  After the actions described above, we will have a visually correct history graph in our hands, but without a guarantee of consistency.  This column contains all variants of the development of events, even contradicting the current state of the world. <br><br>  For example, in one of the branches the hero can harm his friend.  Or two NPCs marked by enemies can act together. <br><br>  Therefore, the history must be further processed.  This involves the following actions: <br><ol><li>  Random events are activated - some nodes are combined into groups of alternative options for the development of history.  One node is selected from each group, the rest are deleted. </li><li>  All end nodes containing forbidden job results for objects are deleted. </li><li>  The resulting graph is cleared of "hanging" nodes.  The following types of nodes are considered "hanging": <br><ul><li> a node that is not the end node of the external history itself and from which the edges do not extend. </li><li>  a node that is not the starting node of the most external history and which does not have incoming edges. </li></ul></li></ol><br>  The resulting graph will be at least consistent.  But it can become impracticable or unrelated (the story will become inappropriate).  Therefore, the next step is to check all the necessary properties of the resulting history. <br><br>  If the check was successful, then we have a new story. <br><br>  If not, we start creating it from the beginning. <br><br>  The full rollback approach can lead to very long generation, in case the game world is very small and has a large number of connections.  But in practice, there are usually many objects in the world, and there are few links between them, so there are no problems. <br><br>  In the case of frequent errors, a game using a generator can reduce the number of properties to be set in the world (for example, stop considering friendship).  The generator itself does not attempt to make additional assumptions about the state of the world. <br><br><h4>  Links </h4><br>  The generator is written in Python, laid out on github under the BSD license: <br><br><ul><li>  repository: <a href="https://github.com/Tiendil/questgen">questgen</a> </li><li>  example interpreter: <a href="https://github.com/Tiendil/questgen/blob/master/helpers/example.py">example.py</a> </li><li>  visualization of the finished task: <a href="">large_quest.svg</a> </li><li>  game for which it was made: <a href="http://the-tale.org/">http://the-tale.org</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/201680/">https://habr.com/ru/post/201680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../201668/index.html">Use external Windows Azure Mobile Services authentication in a WPF desktop application</a></li>
<li><a href="../201670/index.html">SassyStudio - SCSS / SASS / Compass support in Visual Studio</a></li>
<li><a href="../201674/index.html">Asynchronous utm tag mining</a></li>
<li><a href="../201676/index.html">On five screens</a></li>
<li><a href="../201678/index.html">How programming skills can allow to save the mind of a loved one or ‚ÄúFrom programming to psychotherapy‚Äù</a></li>
<li><a href="../201682/index.html">Once again about obfuscation javascript or tale about how i obfuscator wrote. Part 1</a></li>
<li><a href="../201686/index.html">Vanilla JS vs jQuery 2.0</a></li>
<li><a href="../201688/index.html">Autorun Yandex.Disk as systemd service in Fedora 19</a></li>
<li><a href="../201692/index.html">Postmorthem: how to manage to make 14 mistakes, having developed one social game</a></li>
<li><a href="../201694/index.html">Performance comparison of various encryption systems for linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>