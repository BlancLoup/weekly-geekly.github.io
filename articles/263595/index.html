<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>When Chef and Puppet are not the solution. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past five years, I have seen a lot of articles on ‚Äúsuccessful‚Äù recipes for building deployment and configuration management systems based on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>When Chef and Puppet are not the solution. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/a61/851/764/a618517642b84d499c40562583191e6e.jpg" alt="image"><br><br>  Over the past five years, I have seen a lot of articles on ‚Äúsuccessful‚Äù recipes for building deployment and configuration management systems based on Chef / Puppet / Vagrant / Ansible.  I spent about 7 years solving the problems of automatic deployment in the company in which I was working at that time, and now I think that I have enough experience to criticize many common tools. <br><br>  I cannot disclose a lot of details due to the NDA and non-expired nondisclosure, although I would very much like to describe in detail my approach.  In this article I would like to outline the general principle and ideas and get constructive criticism in the comments.  The following examples, of course, do not apply to any particular company and are simply intended to give examples. <br><a name="habracut"></a><br>  The article was intended to be rather specific, but suddenly it turned out to be rather large, so I decided to split it into several parts for the convenience of perception, and at the same time in order to get comments on specific parts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I would like to address readers who have 5-10 servers in production and all of them are limited to the ‚Äúweb server - base - pair of application servers‚Äù model.  Since the topic in this article can be very holistic, please consider my features.  I agree that for small companies a solution with Chef / Puppet / Vagrant / Ansible / still might work well.  It can.  I'm not trying to tell how bad these tools are at all.  I try to warn against overuse of fashionable solutions and to think about how well this can really help and if there are any other options before implementation. <br><br>  My main idea, which I am going to explain further: for a large company, comes the moment when developing your own deployment solution turns out to be more profitable and convenient than using ready-made tools or even adapting them to your processes. <br><br>  If your company is large enough, but, nevertheless, you cannot afford to single out one or two, and better than 5-6 developers to develop their own solution to this problem, it is better to take ready.  Or you can try to convince the authorities of the harm (precisely harm!) Of third-party decisions.  I once was not convincing enough and, in my opinion, because of this, we lost three years. <br><br>  I notice that most of the presentations and video lectures on the introduction of auto-warmup begin with something like ‚Äúlet's see how easy it is to secure a php file on a local host‚Äù.  Suddenly, they end with just this successfully completed file, and at best, it still shows how easy it is to install apache and mysql on two servers with roles assigned to them.  On this impressed viewer decides that it is really simple and let's all use this cool shmappet in our production right now. <br><br>  But it would be worth thinking about ... <br><br><img src="https://habrastorage.org/files/8c1/f50/f59/8c1f50f59b254f42b5fa3c2e3efff351.jpg" alt="image"><br><br>  Unfortunately, something similar happened with us and I could not prevent the attempt to use Chef, although from us, sensible people, there were a lot of dangerous questions to the initiators of the introduction.  Having connected to the task in time, I was able to smooth out the negative effect a bit and further get rid of Chef.  True, by that time I did not keep track of it and Puppet made our way to us. <br><br><h4>  Environment.  "Brief" introduction. </h4><br>  Let's imagine some company that provides SaaS services.  The company has been on the market for 5-10 years and it already has a good and selling service with happy users.  At some point, their happiness overflows and attracts many more users and partners.  That is, the company begins to grow rapidly. <br><br>  Suppose there used to be 20 servers in production and they worked, and editing 5 configs on 6 servers was considered quite common, as well as outage for 3-4 hours on weekends to update servers.  Servers are different - about 80% is Windows Server with ASP through IIS5 or self-written services - we do not just host the site, we have telephony, messages, there may be fax support or any solutions for integration with Skype and other services.  Do not forget about billing.  All, of course, tied to the database.  She seems to be coping for now.  Developers code on their machines, QA has two old desktops in the corner, all services are tested in turn.  Everything is calm, 2 major releases per year, bugfixes and minor features sometimes.  Developers do not hesitate to check a couple of ideas to go over RDP / SSH to one of the production servers and tweak a couple of files to collect logs or put a remote debugger.  The usual thing.  Everyone knows the whole structure of services and their communication. <br><br>  There are few servers and why not register the address of the billing server in the config of your server?  Anyway, he is one and has not changed for a long time.  Do not ask this gloomy guy who is in charge of the database to add a sign with parameters - again he will cry out that we keep all the garbage in his precious base and change the scheme all the time.  Add and then remove after refactoring.  In the billing server, we add the address of the external payment gateway to the config too - it is always the same, but it‚Äôs bad hardcoded, and we‚Äôll not be given again to push the constants again. <br><br>  Suddenly, for growth, it is necessary to bring the number of servers to 100 in production, because after a successful advertising campaign, the number of users has grown well.  The CEO arrived, showed a beautiful presentation, hinted that this was just the beginning.  He told us that we have two new partners, the largest in our industry, and we need not to lose face, and in general he has already said that we can do this and this feature.  A month later, the demo, but we can also make these features from scratch, right? <br><br>  It is necessary - it means it is necessary, the prospects are good.  Premiums promise good.  One-two - and features are quickly made.  Two new services appear, so as not to overwrite the old ones - then combine them if necessary.  These services, unfortunately, are very strongly connected with all the others - they need billing, telephony, and web.  But here common sense prevailed and we decided to store the addresses of all servers in the database - otherwise there are already a lot of them.  Now all services at the start of the database take a list of servers and work with it later.  Conveniently.  The old components, however, still have something in the configs, but then we clean it up. <br><br>  The CEO and CTO came with a bunch of other managers, very satisfied.  Partners appreciated the demo, gave money.  Lot.  Here you have a pack, buy as many servers as you need and what did they say about refactoring?  So be it, figachim.  Is java in fashion now?  Is everything taken in Java to write in successful offices?  So we are now successful - let's make Java!  And at once we will do everything right, divided into several services that will communicate through the API. <br><br>  [skip the first one and a half years to refactor and refactor it]. <br><br>  Now we have 200 production servers and test servers about 50. The number of different internal components is about 20. Many are similar, but they do different things.  All samopisnye. <br><br>  All 10 system administrators are working, very nice guys.  Releases every 2-3 months, dofig plans.  There is money.  Users go.  Developers and testers are gaining flow, PM does not get out of the interviews. <br><br>  But there are problems. <br><br><img src="https://habrastorage.org/files/8ef/710/86d/8ef71086db884985ba079a3049b9050c.gif"><br><br>  To be continued‚Ä¶ <br><br>  Here is the best place to take a breath and to make a discussion in the comments.  I think many have learned something from their companies. <br><br>  In the following parts, I will describe the first attempts at automation, the emergence of Chef and, in conclusion, my view of the architecture of an ideal service that can solve most of the problems for the company. </div><p>Source: <a href="https://habr.com/ru/post/263595/">https://habr.com/ru/post/263595/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263571/index.html">SoC: we write framebuffer implementation for controller in FPGA</a></li>
<li><a href="../263575/index.html">An example of solving a typical OOP problem in the Haskell language</a></li>
<li><a href="../263577/index.html">Competition of the user design from the Roketbank or how to order a bank card with the Habr logo</a></li>
<li><a href="../263581/index.html">Welcome to FPConf.ru</a></li>
<li><a href="../263591/index.html">Review and video of reports on information security from the conference SECR-2014</a></li>
<li><a href="../263597/index.html">The finite element method on the example of the Poisson equation</a></li>
<li><a href="../263599/index.html">Convenient data serialization with Variadic Templates</a></li>
<li><a href="../263601/index.html">PHP Digest number 67 - interesting news, materials and tools (July 12 - 27, 2015)</a></li>
<li><a href="../263603/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ169 (July 19 - 25, 2015)</a></li>
<li><a href="../263605/index.html">Full guide to creating landing pages that sell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>