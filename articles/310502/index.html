<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GitLab CI: Learning to Deploy</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article focuses on the success story of an imaginary news portal, of which you are the happy owner. Fortunately, you already have the project cod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GitLab CI: Learning to Deploy</h1><div class="post__text post__text-html js-mediator-article"><p>  This article focuses on the success story of an imaginary news portal, of which you are the happy owner.  Fortunately, you already have the project code on GitLab.com and you know that <a href="https://about.gitlab.com/2016/07/29/the-basics-of-gitlab-ci/">you can use GitLab CI for testing</a> . <br>  Now you are wondering whether it is possible to go further and use CI also to deploy the project, and if so, what opportunities open up. </p><br><p>  In order not to become attached to any particular technology, suppose that your application is a simple set of HTML files, no execution of code on the server, no compilation of JS assets.  Deploy will be on <a href="https://aws.amazon.com/s3/">Amazon S3</a> . </p><br><p>  The author has no purpose to give recipes for a particular technology in this article.  On the contrary, code samples are as primitive as possible, so that they do not get stuck too much.  The point is that you look at the features and principles of GitLab CI in action, and then apply them to your technology. </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/intro.jpg"></p><br><a name="habracut"></a><br><p>  Let's start from the beginning: in your fictional application there is no CI support yet. </p><br><h2 id="nachalo">  Start </h2><br><p>  <strong>Deployment</strong> : in this example, the result of the deployment should be the appearance of a set of HTML files in your bucket (bucket S3, which is already configured to <a href="http://docs.aws.amazon.com/AmazonS3/latest/dev/HowDoIWebsiteConfiguration.html%3FshortFooter%3Dtrue">host static websites</a> ). </p><br><p>  This can be achieved in many different ways.  We will use the library <br>  <a href="http://docs.aws.amazon.com/cli/latest/reference/s3/cp.html">awscli</a> from amazon </p><br><p>  The complete deployment team looks like this: </p><br><pre><code class="hljs ruby">aws s3 cp ./ <span class="hljs-symbol"><span class="hljs-symbol">s3:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/yourbucket/</span></span> --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/13.jpg" alt="Manual deployment">  <em>Push code to the repository and deployment are two different processes.</em> </p><br><p>  <strong>Important</strong> : this command <a href="http://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html">expects</a> you to pass the environment variables <code>AWS_ACCESS_KEY_ID</code> and <code>AWS_SECRET_ACCESS_KEY</code> .  You may also be required to specify <code>AWS_DEFAULT_REGION</code> . </p><br><p>  Let's try to automate this process using GitLab CI. </p><br><h2 id="pervoe-avtomaticheskoe-razvertyvanie">  First automatic deployment </h2><br><p>  When working with GitLab, all the same commands are used as when working on the local terminal.  You can configure the GitLab CI to suit your requirements in the same way that you configure your local terminal.  All the commands that can be executed on your computer can be executed in GitLab by transferring them to CI.  Just add your script to the <code>.gitlab-ci.yml</code> and push - that‚Äôs all, CI runs the <em>job (job)</em> and executes your commands. </p><br><p>  Add details to our history: your website is small - 20-30 visitors per day, and in the repository there is only one branch - <code>master</code> . </p><br><p>  Let's start by adding a <em>task</em> with the aws command to <code>.gitlab-ci.yml</code> : </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">script:</span></span> aws s3 cp ./ <span class="hljs-symbol"><span class="hljs-symbol">s3:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/yourbucket/</span></span> --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p>  Failure: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/fail1.png" alt="Failed command"></p><br><p>  We need to make sure the <code>aws</code> executable is <code>aws</code> .  Installing <code>awscli</code> requires a <code>pip</code> tool to install Python packages.  Specify the Docker image with Python preinstalled, which should also contain a <code>pip</code> : </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">python:</span></span>latest <span class="hljs-symbol"><span class="hljs-symbol">script:</span></span> - pip install awscli - aws s3 cp ./ <span class="hljs-symbol"><span class="hljs-symbol">s3:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/yourbucket/</span></span> --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/14.jpg" alt="Automated deployment">  <em>When pushed to GitLab, the code is automatically deployed using CI.</em> </p><br><p>  Installing <code>awscli</code> increases the task execution time, but now we are not particularly worried.  If you still want to speed up the process, you can <a href="https://hub.docker.com/explore/">search for a Docker image</a> with a pre-installed <code>awscli</code> , or create one on your own. </p><br><p>  Also, do not forget about environment variables derived from the <a href="https://console.aws.amazon.com/">AWS Console</a> : </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">variables:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">AWS_ACCESS_KEY_ID:</span></span> <span class="hljs-string"><span class="hljs-string">"AKIAIOSFODNN7EXAMPLE"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">AWS_SECRET_ACCESS_KEY:</span></span> ‚ÄúwJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY‚Äù <span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">python:</span></span>latest <span class="hljs-symbol"><span class="hljs-symbol">script:</span></span> - pip install awscli - aws s3 cp ./ <span class="hljs-symbol"><span class="hljs-symbol">s3:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/yourbucket/</span></span> --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p>  It should work, but keeping the secret keys open (even in a private repository) is not a good idea.  Let's see what can be done with this. </p><br><h3 id="sohranenie-sekretov">  Keeping secrets </h3><br><p>  GitLab has a special section for secret variables: <strong>Settings&gt; Variables</strong> </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/variables.png" alt="Picture of Variables page"></p><br><p>  All data placed in this section will become <strong>environment variables</strong> .  Access to this section is only for the project administrator. </p><br><p>  The <code>variables</code> section can be removed from the CI settings, but better let's use it for another purpose. </p><br><h3 id="sozdanie-i-ispolzovanie-publichnyh-peremennyh">  Creating and using public variables </h3><br><p>  With the increase in the size of the configuration file, it becomes more convenient to store some parameters at the beginning as variables.  This approach is especially relevant when these parameters are used in several places.  Although in our case it hasn‚Äôt yet reached this point, for demonstration purposes, we will create a <a href="http://docs.gitlab.com/ee/ci/variables/README.html"><strong>variable</strong></a> for the name of the S3 bake: </p><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">variables:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">S3_BUCKET_NAME:</span></span> <span class="hljs-string"><span class="hljs-string">"yourbucket"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">deploy:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">python:</span></span>latest <span class="hljs-symbol"><span class="hljs-symbol">script:</span></span> - pip install awscli - aws s3 cp ./ <span class="hljs-symbol"><span class="hljs-symbol">s3:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/$S3_BUCKET_NAME/</span></span> --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p>  Build successful: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/build.png" alt="Successful build"></p><br><p>  In the meantime, your site traffic has increased, and you have hired a developer to help you.  Now you have a team.  Let's see how teamwork affects the workflow. </p><br><h2 id="rabota-v-komande">  Teamwork </h2><br><p>  Now two people work in the same repository, and it is no longer advisable to use the <code>master</code> branch for development.  Therefore, you decide to use different branches for developing new features and writing articles and merging them into <code>master</code> as soon as you are ready. </p><br><p>  The problem is that with the current setup, CI does not support working with branches ‚Äî when pushing to any branch on GitLab, the current <code>master</code> state is deployed to S3. </p><br><p>  Fortunately, this is easy to fix - just add <code>only: master</code> to the <code>deploy</code> task. </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/15.jpg" alt="Automated deployment of master branch">  <em>We want to avoid deploying every branch on the site.</em> </p><br><p>  On the other hand, it would be nice to be able to preview changes made from the branches for the selected functionality (feature-branches). </p><br><h3 id="sozdanie-otdelnogo-prostranstva-dlya-testirovaniya">  Creating a separate space for testing </h3><br><p>  Patrick (the developer you recently hired) reminds you that there is such functionality as <br>  <a href="http://pages.gitlab.io/">GitLab Pages</a> .  Just what you need - a place to preview the new changes. </p><br><p>  To <a href="https://about.gitlab.com/2016/04/07/gitlab-pages-setup/">host a website on GitLab Pages,</a> your CI configuration must meet three simple requirements: </p><br><ul><li>  <em>The task</em> must be named <code>pages</code> </li><li>  There must be a section <code>artifacts</code> , and it contains a folder <code>public</code> </li><li>  In this very <code>public</code> folder should be everything that you want to place on the site </li></ul><br><p>  The contents of the public folder will be located at <code>http://&lt;username&gt;.gitlab.io/&lt;projectname&gt;/</code> </p><br><p>  After adding the code from the <a href="">example for sites in pure HTML,</a> the CI configuration file looks like this: </p><br><pre> <code class="hljs perl">variables: S3_BUCKET_NAME: <span class="hljs-string"><span class="hljs-string">"yourbucket"</span></span> deploy: image: python:latest script: - pip install awscli - aws s3 cp ./ s3:<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>$S3_BUCKET_NAME/ --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --include <span class="hljs-string"><span class="hljs-string">"*.html"</span></span> only: - master pages: image: alpine:latest script: - <span class="hljs-keyword"><span class="hljs-keyword">mkdir</span></span> -p ./public - cp ./*.html ./public/ artifacts: paths: - public except: - master</code> </pre> <br><p>  In total, it contains two tasks: one ( <code>deploy</code> ) deploys the site to S3 for your readers, and the other ( <code>pages</code> ) to GitLab Pages.  Let's call them the ‚Äú <strong>Production</strong> environment‚Äù and ‚Äú <strong>Staging</strong> environment‚Äù, respectively. </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/16.jpg" alt="Deployment to two places">  <em>All branches except master will be deployed on GitLab Pages</em> </p><br><h2 id="sredy-razvertyvaniya">  Deployment environments </h2><br><p>  GitLab <a href="http://docs.gitlab.com/ee/ci/environments.html">supports deployment environments</a> .  All you need to do is assign the appropriate environment for each deployment <em>task</em> : </p><br><pre> <code class="hljs perl">variables: S3_BUCKET_NAME: <span class="hljs-string"><span class="hljs-string">"yourbucket"</span></span> deploy to production: environment: production image: python:latest script: - pip install awscli - aws s3 cp ./ s3:<span class="hljs-regexp"><span class="hljs-regexp">//</span></span>$S3_BUCKET_NAME/ --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --include <span class="hljs-string"><span class="hljs-string">"*.html"</span></span> only: - master pages: image: alpine:latest environment: staging script: - <span class="hljs-keyword"><span class="hljs-keyword">mkdir</span></span> -p ./public - cp ./*.html ./public/ artifacts: paths: - public except: - master</code> </pre> <br><p>  GitLab keeps track of all your deployment processes, so you can always see what is currently being deployed on your servers: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/environments.png" alt="List of environments"></p><br><p>  Also, GitLab keeps a complete history of all deployments for each environment: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/staging.png" alt="List of deployments to staging environment"></p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/17.jpg" alt="Environments"></p><br><p>  So, we have optimized and set up everything that we could, and are ready for new challenges that will not take long to wait. </p><br><h2 id="rabota-v-komande-chast-2">  Teamwork, part 2 </h2><br><p>  Again.  It happened again.  All you had to do was push out your feature branch for the preview, after a minute Patrick did the same and overwrites the contents of the staging.  # $ @!  Third time today! </p><br><p>  Idea!  We use Slack for deployment alerts so that no one pushes the new changes before the old ones finish deploying. </p><br><h3 id="opovescheniya-slack">  Slack Alerts </h3><br><p>  Customizing Slack alerts is a <a href="http://docs.gitlab.com/ce/project_services/slack.html">snap</a> .  We just need to take from the Slack URL of the <a href="https://api.slack.com/incoming-webhooks">incoming webhuk</a> ... <br><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/incoming-webhook.png" alt="Grabbing Incoming WebHook URL in Slack"></p><br><p>  ... and transfer it to <strong>Settings&gt; Services&gt; Slack</strong> along with your Slack login: <br><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/services-slack.png" alt="Configuring Slack Service in GitLab"></p><br><p>  Since you only want to be notified about deployments, in the settings shown above you can uncheck all items except ‚ÄúBuild‚Äù.  That's all, now you will receive alerts about each deployment: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/slack.png" alt="Deployment notifications in Slack"></p><br><h2 id="rabota-v-bolshoy-komande">  Work in a big team </h2><br><p>  Over time, your site has become very popular, and your team has grown from two to eight people.  Development takes place in parallel, and people increasingly have to wait in line for a preview on Staging.  The ‚ÄúDeploy each branch to Staging‚Äù approach no longer works. </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/queue.jpg" alt="For review on Staging"></p><br><p>  It's time to re-work the workflow.  You and your team agreed that in order to roll out changes to a staging server, you must first merge these changes into the ‚Äústaging‚Äù branch. </p><br><p>  To add this functionality, you need to make only minor changes to the <code>.gitlab-ci.yml</code> : </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: - master</code> </pre> <br><p>  becomes </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">only</span></span>: - staging</code> </pre> <br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/18.jpg" alt="Staging branch">  <em>Developers spend merge their feature-branches before the Staging preview</em> <em><br></em> </p><br><p>  Of course, with this approach, extra time and effort is spent on merge, but everyone in the team agrees that it is better than waiting in a queue. </p><br><h3 id="nepredvidennye-obstoyatelstva">  Unseen circumstances </h3><br><p>  It is impossible to control everything, and troubles tend to happen.  For example, someone misunderstood branches incorrectly and pushed the result right in production just when your site was in the top of HackerNews.  As a result, thousands of people saw a crooked version of the site instead of your chic home page. </p><br><p>  Fortunately, there was a man who knew about the <strong>Rollback</strong> button, so that just a minute after the discovery of the problem, the site assumed the same form. </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/rollback-arrow.png" alt="List of environments">  <em>Rollback restarts an earlier task spawned in the past by some other commit.</em> </p><br><p>  To avoid this in the future, you decided to disable automatic deployment in production and switch to manual deployment.  To do this, add the <em>task</em> <code>when: manual</code> . </p><br><p>  In order to start the deployment manually, go to the <strong>Pipelines&gt; Builds</strong> tab and click on this button: </p><br><p><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/skipped.png" alt="Skipped job is available for manual launch"></p><br><p>  And so your company has become a corporation.  Hundreds of people are working on the site, and some of the previous work practices are no longer well suited to new circumstances. </p><br><h3 id="revyu-prilozheniy">  App review </h3><br><p>  The next logical step is to add the ability to deploy a temporary instance of an application for each feature branch for a review. </p><br><p>  In our case, for this you need to configure another S3 baket, with the only difference that in this case the contents of the site are copied into the ‚Äúfolder‚Äù with the name of the branch.  Therefore, the URL looks like this: </p><br><p> <code>http://&lt;REVIEW_S3_BUCKET_NAME&gt;.s3-website-us-east-1.amazonaws.com/&lt;branchname&gt;/</code> </p> <br><p>  And this is how the code replacing <em>the</em> <code>pages</code> <em>task</em> will look like: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">review</span></span> apps: variables: S3_BUCKET_NAME: <span class="hljs-string"><span class="hljs-string">"reviewbucket"</span></span> image: python:latest environment: review script: - pip install awscli - mkdir -p ./<span class="hljs-variable"><span class="hljs-variable">$CI_BUILD_REF_NAME</span></span> - cp ./<span class="hljs-regexp"><span class="hljs-regexp">*.html</span></span> ./<span class="hljs-variable"><span class="hljs-variable">$CI_BUILD_REF_NAME</span></span>/ - aws s3 cp ./ s3://<span class="hljs-variable"><span class="hljs-variable">$S3_BUCKET_NAME</span></span>/ --recursive --exclude <span class="hljs-string"><span class="hljs-string">"*"</span></span> --include <span class="hljs-string"><span class="hljs-string">"*.html"</span></span></code> </pre> <br><p>  It‚Äôs worth explaining where we got the <code>$CI_BUILD_REF_NAME</code> variable - from the list of <a href="http://docs.gitlab.com/ce/ci/variables/README.html">predefined GitLab environment variables</a> that you can use for any of your tasks. </p><br><p>  Note that the variable <code>S3_BUCKET_NAME</code> defined inside the <em>task</em> ‚Äî this way you can rewrite the definitions of a higher level. </p><br><p>  Visual interpretation of this configuration: <br><img src="https://about.gitlab.com/images/blogimages/ci-deployment-and-environments/19.jpg" alt="Review apps"></p><br><p>  The technical details of implementing this approach vary greatly depending on the technologies used in your stack and on how your deployment process is arranged, which is beyond the scope of this article. </p><br><p>  Real projects, as a rule, are much more complicated than our example with a site on static HTML.  For example, since the instances are temporary, this greatly complicates their automatic loading with all the required services and software on the fly.  However, this is doable, especially if you use Docker or at least Chef or Ansible. </p><br><p>  About deployment with Docker will be discussed in another article.  Honestly, I feel a little guilty for having simplified the process of unloading to simply copying HTML files, completely missing out on more hardcore scripts.  If you're interested, I recommend reading the article <a href="https://about.gitlab.com/2016/08/11/building-an-elixir-release-into-docker-image-using-gitlab-ci-part-1/">"Building an Elixir Release into a Docker image using GitLab CI"</a> . </p><br><p>  For now let's discuss another, last problem. </p><br><h3 id="razvertyvanie-na-razlichnye-platformy">  Deploy to various platforms </h3><br><p>  In reality, we are not limited to S3 and GitLab Pages;  Applications are deployed to various services. </p><br><p>  Moreover, at some point you may decide to move to another platform, and for this you will need to rewrite all deployment scripts.  In such a situation, using gem <code>dpl</code> greatly simplifies life. </p><br><p>  In the examples in this article, we used <code>awscli</code> as a tool for delivering code to Amazon S3.  Actually, no matter what tool you use and where you deliver the code - the principle remains the same: a command is run with certain parameters and a secret key is somehow transferred to it for identification. </p><br><p>  The <code>dbl</code> deployment <code>dbl</code> follows this principle and provides a unified interface for a <a href="https://github.com/travis-ci/dpl">specific list of plug-ins (providers)</a> for deploying your code on different hosting sites. </p><br><p>  <em>The task</em> for deployment in production using dpl will look like this: </p><br><pre> <code class="hljs pgsql">variables: S3_BUCKET_NAME: "yourbucket" deploy <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> production: environment: production image: ruby:latest script: - gem install dpl - dpl <span class="hljs-comment"><span class="hljs-comment">--provider=s3 --bucket=$S3_BUCKET_NAME only: - master</span></span></code> </pre> <br><p>  So if you deploy to different hosting sites or frequently change target platforms, consider using <code>dpl</code> in deployment scripts - this contributes to their consistency. </p><br><h2 id="podvodya-itogi">  Summing up </h2><br><ol><li>  Deployment occurs through regular execution of a command (or set of commands), so that it can be run as part of GiLab CI </li><li>  In most cases, these commands need to transfer various secret keys.  Store these keys in the <strong>Settings&gt; Variables</strong> section <strong>.</strong> </li><li>  With GitLab CI, you can choose which branches to deploy. </li><li>  GitLab saves deployment history, allowing you to roll back to any previous version. </li><li>  It is possible to enable manual deployment (rather than automatically) for the most important parts of the project infrastructure. </li></ol><br><p>  <i>Translation from English is made by translational artel "Nadmozg and partners", <a href="http://nadmosq.ru/">http://nadmosq.ru</a> .</i>  <i>Over translation worked <a href="https://habrahabr.ru/users/sgnl_05/" class="user_link">sgnl_05</a> .</i> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310502/">https://habr.com/ru/post/310502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310492/index.html">Vladislav Kochetkov, President of FINAM Holding: ‚ÄúWe are better able to teach than aggressively sell‚Äù</a></li>
<li><a href="../310494/index.html">CIKM Cup 2016 - an international competition in the field of Data Science</a></li>
<li><a href="../310496/index.html">Just a label on the site</a></li>
<li><a href="../310498/index.html">Quick integration of Google Chromecast in Android app</a></li>
<li><a href="../310500/index.html">Matrix-based collection development</a></li>
<li><a href="../310504/index.html">Equation Group exploit box added a new instance</a></li>
<li><a href="../310506/index.html">Universal mobile electronic key</a></li>
<li><a href="../310510/index.html">Eddystone technologies replace QR codes</a></li>
<li><a href="../310512/index.html">Oracle promises new products to help Amazon beat Amazon in the cloud market</a></li>
<li><a href="../310514/index.html">Adapting a mobile Android TV application or why I love Google</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>