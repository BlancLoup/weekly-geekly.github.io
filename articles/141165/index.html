<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing ExtJS / Sencha components and applications using the PhantomJS engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PhantomJS is a WebKit engine assembly without a graphical interface that allows you to load a web page in console mode, execute JavaScript, fully work...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing ExtJS / Sencha components and applications using the PhantomJS engine</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://www.phantomjs.org/">PhantomJS</a> is a <a href="http://www.webkit.org/">WebKit</a> engine assembly without a graphical interface that allows you to load a web page in console mode, execute JavaScript, fully work with DOM, Canvas and SVG.  One of the main applications declared PhantomJS is automated functional testing of the user interface.  PhantomJS has integration with various frameworks for testing JavaScript and web pages.  Let's see what can be done on the basis of the standard PhantomJS functionality to test a single component and an entire application written in <a href="http://www.sencha.com/">ExtJS / Sencha</a> .  In this article, I will provide some simplest template for a testing framework, illustrating the approach to testing code based on a third-party JavaScript library.  All the code presented in the article is available on <a href="https://github.com/forketyfork/ExtPhantomTesting">GitHub</a> . <br><br><a name="habracut"></a><br><br><h2>  Component testing </h2>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider a simple component that extends the standard Ext.form.ComboBox drop-down list.  It should contain a list of months, customizable using the months configuration parameter, an array containing the numbers of the displayed months, starting with zero.  For example, if an array consists of the numbers 1, 3, and 5, then the drop-down list should display the months of February, April, and June. <br><br><pre><code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'MonthComboBox'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span> : <span class="hljs-string"><span class="hljs-string">'Ext.form.ComboBox'</span></span>, <span class="hljs-attr"><span class="hljs-attr">alias</span></span> : <span class="hljs-string"><span class="hljs-string">'widget.monthcombo'</span></span>, <span class="hljs-attr"><span class="hljs-attr">store</span></span> : Ext.create(<span class="hljs-string"><span class="hljs-string">'Ext.data.Store'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fields</span></span> : [ <span class="hljs-string"><span class="hljs-string">'num'</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span> ] }), <span class="hljs-attr"><span class="hljs-attr">queryMode</span></span> : <span class="hljs-string"><span class="hljs-string">'local'</span></span>, <span class="hljs-attr"><span class="hljs-attr">displayField</span></span>: <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-attr"><span class="hljs-attr">valueField</span></span> : <span class="hljs-string"><span class="hljs-string">'num'</span></span>, <span class="hljs-attr"><span class="hljs-attr">allMonths</span></span> : [<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> ], <span class="hljs-attr"><span class="hljs-attr">months</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">initComponent</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *     ,      {@link MonthComboBox#months} */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.months.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store.add({ <span class="hljs-attr"><span class="hljs-attr">num</span></span> : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.months[i], <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.allMonths[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.months[i]] }); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callParent(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); } });</code> </pre> <br><br>  Create an HTML page ExtjsTesterPage.html, within which the component will be tested.  To include ExtJS stylesheets and scripts in a page, you must at least import the ext-all.css and ext-all.js files.  For this purpose, we use the version of ExtJS 4.0.2a, which is hosted on CacheFly. <br><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>ExtJS Test Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://extjs.cachefly.net/ext-4.0.2a/resources/css/ext-all.css"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://extjs.cachefly.net/ext-4.0.2a/ext-all.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Let's prepare a small sample framework for testing.  This is the ExtjsTester.js file that will be sent to PhantomJS for execution and take the name of the script with the test as an argument.  At the beginning of it we will place a check for the presence of a command line argument: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (phantom.args.length == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'      '</span></span>); phantom.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre><br>  Using this code snippet, two important elements of the PhantomJS API can be illustrated.  First, passing parameters to the script: phantom.args is an array of command line arguments.  The second API element is a call to the phantom.exit () method, which causes PhantomJS to terminate and return the specified error code. <br><br>  We will connect the module of work with the file system, which we will need to load scripts in runtime mode.  The fs module has a fairly extensive functionality that allows you to search, read and write files. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'fs'</span></span>);</code> </pre><br><br>  For the sake of simplicity, I did not include any existing libraries for functional JavaScript testing, although PhantomJS has integration with them.  Let's declare an assert exception type class: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AssertionError</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message = message; } AssertionError.prototype.toString = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'AssertionError: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.message; };</code> </pre><br><br>  Now for testing purposes we will create a wrapper over the standard PhantomJS class - WebPage. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TestPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">scriptUnderTest, testFun</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      if (!fs.exists(scriptUnderTest)) { console.log("File " + scriptUnderTest + " not found"); phantom.exit(1); } var me = this; //   this.page = require('webpage').create(); //           this.page.onConsoleMessage = function (msg) { console.log(msg); }; //    this.page.open("ExtjsTesterPage.html", function() { //    me.page.injectJs(scriptUnderTest); //   ExtJS     me.waitForExtReady(function() { me.doTest(testFun); }); }); }</span></span></code> </pre><br><br>  The parameter of the scriptUnderTest constructor is the name of the file with the script to be tested, for example, with the ExtJS component code.  Using the previously imported fs dependency, we make sure that this file exists, and using the WebPage # injectJs function, we inject it into our test page, which we downloaded from the previously created ExtjsTesterPage.html file. <br><br>  It is worth paying attention to the WebPage # onConsoleMessage method.  If you do not specify it, the entire console output that occurred on the page will be lost, since the page is running in the sandbox. <br><br>  The testFun parameter is our future test function.  In order to ensure correct testing of the ExtJS component, you need to make sure that the ExtJS framework is fully loaded and initialized.  The Ext.onReady () method is intended for this, but in our case it is difficult to use it because the page runs in the sandbox, and passing any code into the page is only possible using the WebPage # evaluate method.  Therefore, let's equip the TestPage class with a method waiting for ExtJS to load: <br><br><pre> <code class="javascript hljs">TestPage.prototype.waitForExtReady = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fun</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> me = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">' ExtJS...'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> readyChecker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isReady = me.page.evaluate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Ext.isReady; }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isReady) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'ExtJS .'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(readyChecker); fun.call(me); } }, <span class="hljs-number"><span class="hljs-number">100</span></span>); };</code> </pre><br><br>  When ExtJS is fully loaded, the doTest method will be executed as follows: <br><br><pre> <code class="javascript hljs">TestPage.prototype.doTest = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">testFun</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    testFun.call(this); phantom.exit(0); } catch (e) { console.log(e); phantom.exit(1); } };</span></span></code> </pre><br><br>  Here, the test function call and the completion of PhantomJS with a return code corresponding to the test function results are implemented. <br><br>  Finally, we will add to the TestPage class several conservative methods for assertions and code execution in the context of the page: <br><br><pre> <code class="javascript hljs">TestPage.prototype.evaluate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fun</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.page.evaluate(fun); }; TestPage.prototype.assert = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assert</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">test, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!test) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AssertionError(message); } }; TestPage.prototype.evaluateAndAssertEquals = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">expectedValue, actualFun, message</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assert(expectedValue === <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.evaluate(actualFun), message); };</code> </pre><br><br>  The evaluate method delegates the execution of the passed function to the wrapped WebPage object.  The assert method executes a typical diagnostic statement with an AssertionError overrun if this assertion fails.  The evaluateAndAssertEquals method compares the result of executing a function in the context of the page with the expected value. <br><br>  The last line of the ExtjsTester file will be the download of the test script itself, which we will pass through the command line parameter.  We will use the module for working with the file system for this - we will load the script as a string and execute it via eval: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">eval</span></span>(fs.read(phantom.args[<span class="hljs-number"><span class="hljs-number">0</span></span>]));</code> </pre><br><br>  And here is the test script itself - the file MonthComboBoxTest.js: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TestPage(<span class="hljs-string"><span class="hljs-string">"MonthComboBox.js"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   MonthComboBox      this.evaluate(function() { Ext.widget('monthcombo', { months : [1, 2, 5], renderTo: Ext.getBody() }); }); // ,        this.evaluateAndAssertEquals(3, function() { return Ext.ComponentQuery.query('monthcombo')[0].store.getCount(); }, "Wrong element count"); });</span></span></code> </pre><br><br>  Here we create our TestPage wrapper object, passing it the script of the component being tested and a function for testing.  In it, we first create a component on a page with such a configuration that it contains only three months, and then check that our design is true, the component is really present on the page, and its storage contains exactly three elements. <br><br>  To run the test, use the command: <br><br> <code>phantomjs ExtjsTester.js MonthComboBoxTest.js <br></code> <br><br><h2>  Application Testing </h2><br><br>  First of all, to test the application, we need to modify our framework a bit.  The test function should be executed upon completion of the application launch.  One way to determine this is to check the presence of the Viewport component on the page.  Add the following method to the TestPage class, which is basically the same as the TestPage # waitForExtReady method: <br><br><pre> <code class="javascript hljs">TestPage.prototype.waitForViewport = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fun</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> me = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'  Viewport...'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> launchedChecker = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> isLaunched = me.page.evaluate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> Ext.ComponentQuery.query(<span class="hljs-string"><span class="hljs-string">'viewport'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isLaunched) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Viewport .'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.clearInterval(launchedChecker); fun.call(me); } }, <span class="hljs-number"><span class="hljs-number">100</span></span>); };</code> </pre><br><br>  We also add the waitForViewport parameter to the constructor of the TestPage object, the value of which true will mean that it is necessary to wait for the appearance of the Viewport before executing the test function.  We slightly modify the fragment in which the test function is called: <br><pre> <code class="javascript hljs">me.waitForExtReady(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (waitForViewport) { me.waitForViewport(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ me.doTest(testFun); }) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { me.doTest(testFun); } });</code> </pre><br><br>  For the sake of brevity, I will not give here all the code of the application under test - you can take a look at it on <a href="https://github.com/forketyfork/ExtPhantomTesting">GitHub</a> .  I will explain only that the application consists of a main form with a button and a window that appears when you click on this button.  The main form and the window are served by various controllers, the connection between them is organized through application-level messages (Ext.app.Application # fireEvent).  Here is a test code that checks that when you click a button, a pop-up window really appears: <br><br><pre> <code class="hljs lua">new TestPage(<span class="hljs-string"><span class="hljs-string">"app.js"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { //     this.evaluate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { Ext.ComponentQuery.query(<span class="hljs-string"><span class="hljs-string">'mainform &gt; button[action=popup]'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].btnEl.dom.click(); }); // ,      this.evaluateAndAssertTrue(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> typeof Ext.ComponentQuery.query(<span class="hljs-string"><span class="hljs-string">'popupwindow'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>] !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>; }, <span class="hljs-string"><span class="hljs-string">"Popup window not opened"</span></span>); }, <span class="hljs-literal"><span class="hljs-literal">true</span></span>);</code> </pre><br><br>  The component query 'mainform&gt; button [action = popup]' matches the button on the main form of the application.  The request 'popupwindow' corresponds to a popup window.  The third parameter of the TestPage constructor (true value) means that you need to wait for the appearance of the Viewport before executing the test function.  The test function starts similarly: <br> <code>phantomjs ExtjsTester.js AppTest.js <br></code> <br><br>  The article illustrates an approach to testing components and applications on ExtJS / Sencha based on the PhantomJS engine and has developed an example preparation for a testing framework, which can equally well be used for testing other JavaScript libraries.  In conclusion, I would like to note that such functional testing is limited to browsers running on the WebKit engine.  However, given the high standards of compliance of this engine with modern Web standards, as well as an acceptable level of abstraction and cross-browser compatibility of the ExtJS library (Sencha), it can be concluded that the PhantomJS component may be sufficient for testing the logic of the application‚Äôs operation or functioning. <br><br>  The code of the test component and the application, as well as the testing framework presented in the article, is available on <a href="https://github.com/forketyfork/ExtPhantomTesting">GitHub</a> . <br><br></div><p>Source: <a href="https://habr.com/ru/post/141165/">https://habr.com/ru/post/141165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141158/index.html">Adobe will not take royalties from games that brought less than $ 50K</a></li>
<li><a href="../141160/index.html">Comprehend git</a></li>
<li><a href="../141161/index.html">MTS sues Twitter</a></li>
<li><a href="../141162/index.html">Sovereign: algorithm</a></li>
<li><a href="../141164/index.html">Lightcube (photobox, lightbox) do-it-yourself for 300r</a></li>
<li><a href="../141166/index.html">Google Chrome: AdBlock now shows you cats instead of ads!</a></li>
<li><a href="../141171/index.html">Since the first of April!</a></li>
<li><a href="../141172/index.html">OpenMP Optimization</a></li>
<li><a href="../141173/index.html">Childish poems demand justice</a></li>
<li><a href="../141174/index.html">The world's slowest Linux computer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>