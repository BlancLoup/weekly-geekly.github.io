<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Worst case execution time on x86</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last post I described how and why interrupt latency is measured on the Atom platform. 

 Today I will talk about why the same code with the sam...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Worst case execution time on x86</h1><div class="post__text post__text-html js-mediator-article">  In the last <a href="http://habrahabr.ru/company/intel/blog/106598/">post</a> I described how and why interrupt latency is measured on the Atom platform. <br><br>  Today I will talk about why the same code with the same input data can be executed at different times.  For some realtime applications, this is a very undesirable effect that has to be fought. <br><a name="habracut"></a><br>  Just in case, I will say that the term " <a href="http://en.wikipedia.org/wiki/Worst-case_execution_time">Worst case execution time</a> " in the title I applied, of course, without understanding the essence of the phenomenon.  It has nothing to do with x86. <br><br>  Suppose we have, for example, an interrupt that is triggered when a certain piece of hardware has adjusted new data to memory using DMA.  In the <a href="http://en.wikipedia.org/wiki/Interrupt_handler">ISR,</a> we drive them through the <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D1%2581_%25D0%25BA%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D0%25BE%25D0%25B9_%25D0%25B8%25D0%25BC%25D0%25BF%25D1%2583%25D0%25BB%25D1%258C%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2585%25D0%25B0%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D1%2581%25D1%2582%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B9">FIR filter</a> , and give, for example, another piece of hardware.  Just do not ask why in this problem x86.  This is just an example, and in this example let the mass of other necessary code be simultaneously executed on the machine. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this case, it turns out that each interrupt performs strictly the same sequence of instructions.  Each time it must be executed at the same time.  So?  Not this way! <br><br>  There are two main traps. <br>  1. Cache.  The filter coefficients are taken from memory.  They can be in L1D cache, L2 cache, L3 cache (if any), or in memory.  You can not tell in advance.  If virtual memory was used in the example, <a href="http://en.wikipedia.org/wiki/Translation_lookaside_buffer">DTLB</a> miss could have occurred (or not).  Finally, the ISR code itself may lie in L1I cache, L2, etc.  The main source of unpredictability here is the fact that the previously executed code could have clogged the cache with its data.  And the cache can be shared between real or HT cores. <br>  2. Hypertrading.  Depending on which instructions are executed in the second thread, the first thread is slowed down in different ways.  (1-3 times, on average one and a half times on the Atom) The slowdown mechanism is slightly different in the Core with the OOO-conveyor and in the Atom with the In-Order conveyor.  Atoms hyperlinks, on average, can have a stronger effect on each other‚Äôs performance, because  they have to share more limited resources, like cache access. <br><br>  What can be done? <br>  1. Cache.  First, use the s / w prefetch.  At the beginning of the ISR code, first of all order the filter coefficients in the cache. <br>  If we are talking about a shared L3 cache in the new Core, there is one more way.  You can use cache coloring to allocate a region of memory in the cache that will be harder to force out to processes running on other cores.  If you patch work with virtual memory in the OS, you can give the application pieces of virtual memory that can only fall into certain areas of the total last level cache.  You can divide the L3 cache on the Core into 32 regions, and when allocating memory on different cores, select non-intersecting segments.  I saw how this technique helps to change the execution time of a particular code from 400-900us to 500-600us. <br>  Unfortunately, this kind of magic does not apply to fairly long areas of physical memory. <br><br>  2. Hypertrading.  <s>Disable!</s>  It is possible to send <a href="http://en.wikipedia.org/wiki/Inter-processor_interrupt">IPI</a> to the second stream at the beginning of the work of a code that is critical in terms of predictability of performance.  And write its handler, which, when receiving such an IPI, will wait, for example, on mwait.  So you can continue to use the performance gain that hypertreaming gives, but almost without an undesirable side effect. <br><br>  The existence of both the above phenomena, in fact, helps to increase overall performance.  Just for some realtime applications, possible small (100-500us), but unpredictable delays are very undesirable.  Therefore, in new architectures will appear features that help to get more predictable performance.  For example, there may be support for finer caching software. </div><p>Source: <a href="https://habr.com/ru/post/107075/">https://habr.com/ru/post/107075/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107066/index.html">Own Google Search - now for document scans</a></li>
<li><a href="../107067/index.html">Opera Extensions: Buttons, Badges and Pop-ups</a></li>
<li><a href="../107069/index.html">Sencha Animator - a tool for creating animation using CSS and HTML</a></li>
<li><a href="../107070/index.html">Final of the Result from Innovation Contest at Cisco Expo-2010</a></li>
<li><a href="../107072/index.html">Layout with "Ears" addition, working in IE7, with the basement "nailed" to the bottom</a></li>
<li><a href="../107076/index.html">5 alternatives to the new MacBook Air?</a></li>
<li><a href="../107079/index.html">Apple killed CDs today</a></li>
<li><a href="../107080/index.html">RMA-Silicon Trip. Microsoft office</a></li>
<li><a href="../107081/index.html">Prince and the Pauper</a></li>
<li><a href="../107083/index.html">McAfee report published: the most dangerous domain zones in the world</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>