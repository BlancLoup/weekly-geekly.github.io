<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating plug-ins for AutoCAD using the .NET API (Part 5 - Introduction to Blocks)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the fifth part of the cycle devoted to the development of plug-ins under AutoCAD, I will tell you about creating simple blocks and placing them in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating plug-ins for AutoCAD using the .NET API (Part 5 - Introduction to Blocks)</h1><div class="post__text post__text-html js-mediator-article">  In the fifth part of the <a href="http://habrahabr.ru/post/235723/"><u>cycle</u></a> devoted to the development of plug-ins under AutoCAD, I will tell you about creating simple blocks and placing them in a drawing. <br><br><pre><code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> disclaimer = <span class="hljs-string"><span class="hljs-string">"          AutoCAD.   ‚Äì      ."</span></span></code> </pre> <br><a name="habracut"></a><br><h1>  Introduction </h1><br>  If, when working with a drawing, it becomes necessary to create objects of the same type, then it is best to do this using the mechanism of <b>blocks</b> ‚Äî named groups of objects that behave as a single object.  General information about the blocks can be found <a href="http://knowledge.autodesk.com/support/autocad/learn-explore/caas/CloudHelp/cloudhelp/2015/ENU/AutoCAD-Core/files/GUID-2DA2ADA1-C8CC-4E61-9598-06580FFD3544-htm.html"><u>here</u></a> . <br><br>  It is important to be able to clearly distinguish between two concepts: the <b>definition of a block</b> and the <b>occurrence of a block</b> .  A detailed description of the differences is given <a href="http://knowledge.autodesk.com/support/autocad-lt/getting-started/caas/CloudHelp/cloudhelp/2016/ENU/AutoCAD-LT/files/GUID-BC0FD3C1-3BFC-4C5D-AB9A-BF480D5084BE-htm.html"><u>here</u></a> (English) and <a href="http://exchange.autodesk.com/autocadlt/rus/online-help/browse"><u>here</u></a> (rus).  Briefly set out the essence: when we create a new block, AutoCAD places its description in a special block table.  This description is called <b>a block definition</b> .  The block definition exists exclusively in the block table and is not displayed in the drawing.  Directly on the drawing field, AutoCAD places a <b>block reference entry</b> ‚Äî a link to the block definition.  When the block definition is changed, all occurrences of the block repeat these changes.  Further in the article I will sometimes omit the first word (‚Äúdefinition‚Äù or ‚Äúentry‚Äù) and write simply ‚Äúblock‚Äù. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Nb:</b> <div class="spoiler_text">  I must say that I personally like the translation of a ‚Äúblock copy‚Äù much more than the ‚Äúblock entry‚Äù.  But since it is so written in the documentation ... <br>  As they say, honor your father, honor your mother, and honor the operating manual. <br></div></div><br>  In the process of communicating with Autocad, I came across two types of blocks: <b>normal</b> and <b>dynamic</b> .  The main feature of the second is the ability to set their elements with some ‚Äúcustomizable‚Äù parameters (for example, the length of a line in a block or its angle of inclination).  The main disadvantage of dynamic blocks is that they <i>cannot be</i> created using the .NET API. <br><br>  I will tell about dynamic blocks another time.  In the meantime, let's see how you can work with ordinary blocks. <br><br><h1>  Creating a block manually using AutoCAD </h1><br>  To begin, let's create a block directly in AutoCAD.  There will be no programming here - but the ability to create a block manually is useful in order to be able to at least approximately estimate the result of the plug-in.  Details of the process - under the spoiler. <br><br><div class="spoiler">  <b class="spoiler_title">If the reader is already familiar with editing blocks in AutoCAD, then he will not learn anything new from this section.</b> <div class="spoiler_text">  So, firstly, you need to add elements to the drawing, which we will combine into a block.  To begin with, add a simple circle to the block. <br><br>  In the AutoCAD command line, execute the <b>CIRCLE</b> command, then specify the center and radius.  A circle will appear on the drawing: <br><br><img src="https://habrastorage.org/files/98f/b17/a3d/98fb17a3da2a4903afd615f2bd9569bc.png"><br><br>  Select the circle and execute the <b>BLOCK</b> command.  A block creation menu will appear on the screen.  Pressing the ‚ÄúCreate‚Äù button on the ‚ÄúBlock‚Äù panel will lead to a similar result: <br><br><img src="https://habrastorage.org/files/562/4ae/3a6/5624ae3a648142bc8bac4491de665a87.png"><br><br>  Set the name of the block, set the unit of measure ‚ÄúUnitless‚Äù and uncheck the box ‚ÄúOpen in Block Editor‚Äù, then click ‚ÄúOK‚Äù: <br><br><img src="https://habrastorage.org/files/b51/cc1/e59/b51cc1e59c5a4a0c8e8af68ea807e2a8.png"><br><br><div class="spoiler">  <b class="spoiler_title">Nb:</b> <div class="spoiler_text">  The choice of units of measurement allows you to set the block size, which will be automatically recalculated in different measurement systems (European, with meters and millimeters - and American, with feet and inches).  If you set the value to "Unitless", the block will use the units that are installed in the drawing.  I have always set the value ‚ÄúUnitless‚Äù;  good or bad - I do not know. <br></div></div><br>  After that, AutoCAD will ask you to specify a point on the drawing, which will be the base for the block.  Usually, the center of the block or its lower left corner is set as this point.  We indicate the center point of the circle as the base point. <br><br>  We have completed the creation of the block.  The first block entry will be added to the drawing automatically and will replace the elements from which this block was created.  To add several occurrences of a created block to a drawing, you can use the <b>INSERT command</b> or the button of the same name in the ‚ÄúBlock‚Äù panel: <br><br><img src="https://habrastorage.org/files/580/351/48d/58035148da3c4ec992dbd9fc7a344aea.png"><br><br>  After executing the command or pressing the button, the block insertion window will appear on the screen: <br><br><img src="https://habrastorage.org/files/640/da7/921/640da7921359498988aa97715ef747ac.png"><br><br>  Select the desired block in the list, click "OK", specify the insertion point - and the block appears in the drawing.  You can make sure that this is a block by selecting the object and looking at the properties window: <br><br><img src="https://habrastorage.org/files/fb3/425/eac/fb3425eac4564972b1750d11d3cadee5.png"><br><br>  To edit blocks, use the editor, which is called by the <b>BEDIT</b> command or the corresponding button on the ‚ÄúBlock‚Äù panel: <br><br><img src="https://habrastorage.org/files/225/4ba/644/2254ba644dfe4fcc93770dbad93fa205.png"><br><br>  After executing a command or pressing the mentioned button, a window for selecting a block definition will appear on the screen: <br><br><img src="https://habrastorage.org/files/193/4a1/8ce/1934a18ce6124cd7a04e8fd3c38e5346.png"><br><br>  In this window, you must select a definition that we will edit, and click "OK".  After that, AutoCAD will open the block editor.  Let's go over the most important, in my opinion, important editor panel buttons: <br><br><img src="https://habrastorage.org/files/c09/5ec/2ec/c095ec2ec9ac43afa26c834c00c131ce.png"><br><br><ul><li>  <b>Save Block</b> - save all changes made.  After closing the block editor, all block occurrences placed on the drawing will be updated according to the changes in the block definition. </li><li>  <b>Authoring Palettes</b> - show or hide the attribute window.  This window is useful when working with dynamic blocks. </li><li>  <b>Point</b> - in this pop-up submenu there is a ‚ÄúBasepoint‚Äù item, with which you can set a new base point for a block. </li><li>  <b>Close Block Editor</b> - close the block editor.  All unsaved changes will be lost. </li></ul><br>  Inside the editor, you can add new objects to the block definition and delete unnecessary ones.  Editing a block is similar to editing a regular drawing. <br><br>  This completes the brief excursion into the creation of blocks in AutoCAD.  You can go to the code.  :-) <br></div></div><br><br><h1>  Block creation using the AutoCAD .NET API </h1><br><br><h2>  An example of creating a simple block </h2><br>  This section is based on the corresponding <a href="http://through-the-interface.typepad.com/through_the_interface/2010/01/creating-an-autocad-block-using-net.html"><u>post</u></a> on the Kean Walmsley blog (our example compared to the original source will be much easier).  We will create the simplest block consisting of a polyline, a circle and a block of text. <br><br><div class="spoiler">  <b class="spoiler_title">a little about sausage cuts</b> <div class="spoiler_text">  By the way, since I started talking about sausage trimmings ... <br>  Over the past couple of years (God, how time flies!) A lot of good things have happened.  In particular, the <a href="http://habrahabr.ru/company/microsoft/"><u><b>Best and Greatest Company In The World</b></u></a> still <a href="http://habrahabr.ru/post/256401/"><u>released a</u></a> free <i>professional</i> version of Visual Studio. <br>  Yes, Visual Studio Community Edition takes up more space than Express, and its interface is a bit more complicated - but sooner or later the developer usually needs to work with IDE add-ons, and they are not supported in Express versions.  So it goes. <br>  A real-life example: the author of these lines had fun writing a plugin in VS Express, and nothing foreshadowed trouble ... until the task to add an installer came up (a msi file created using Wix technology).  As a result, all the installer code had to be written in Notepad ++, every minute referring to the documentation, and compiled manually. <br><br>  And in Visual Studio Professional you could just plug in a plug-in for working with Wix and do everything directly in the IDE - with hints, code completion and compilation right in the project.  Can.  Would‚Ä¶ <br><br>  In general, if you work in a company that has no more than 250 PCs and an annual income of less than $ 1,000,000, I highly recommend that if you have a couple of extra, meaningless hours of life, you can spend it on installing this product and continue to work with it. <br>  If there are no meaningless hours in your life, then realize that everything is perishable, life is pain, and dragging out your existence without the established Visual Studio Community Edition only means increasing the entropy of this world. <br></div></div><br>  To create a block and place its entry on a drawing, you must do the following: <br><ol><li>  Create a new entry in the block table (block definition). </li><li>  Add the necessary geometric objects to the block definition. </li><li>  Add a block entry to the drawing. </li></ol><br>  So let's get started. <br><br>  I will no longer dwell on such minor features of creating a plug-in as connecting external links, banning <code>CopyLocal</code> , specifying the version of .NET, and the like ‚Äî this has been discussed many times in past posts of the cycle.  In this example, we will need references to <b>AcMgd</b> and <b>AcDBMgd libraries</b> .  There will be little code;  Immediately bring it all, and then analyze the details. <br><br><div class="spoiler">  <b class="spoiler_title">Code:</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.Runtime; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.DatabaseServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.Geometry; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.ApplicationServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.EditorInput; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> acad = Autodesk.AutoCAD.ApplicationServices.Application; namespace HabrPlug_SimpleBlock { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ClassMyAutoCADDLL_SimpleBlock { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Commands : IExtensionApplication { //        AutoCAD  "HabrCommand" [CommandMethod("HabrCommand")] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> HabrCommand() { //        Document doc = Application.DocumentManager.MdiActiveDocument; <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> db = doc.<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>; //   "Editor"         AutoCAD Editor ed = doc.Editor; //    const string blockName = "pvtBlock"; //   <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> tr = db.TransactionManager.StartTransaction(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (tr) { /<span class="hljs-comment"><span class="hljs-comment">/*** //  1 -       //*** //      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForWrite); //  ,         //   -         if (bt.Has(blockName)) { ed.WriteMessage("\nA block with the name \"" + blockName + "\" already exists."); return; } //    ,    BlockTableRecord btr = new BlockTableRecord(); btr.Name = blockName; //          , //  ID    (   ) ObjectId btrId = bt.Add(btr); tr.AddNewlyCreatedDBObject(btr, true); //*** //  2 -        //*** //   Polyline poly = new Polyline(); poly.SetDatabaseDefaults(); poly.AddVertexAt(0, new Point2d(-50, -125), 0, 0, 0); poly.AddVertexAt(1, new Point2d(-50, 105), 0, 0, 0); poly.AddVertexAt(2, new Point2d(-20, 125), 0, 0, 0); poly.AddVertexAt(3, new Point2d(20, 125), 0, 0, 0); poly.AddVertexAt(4, new Point2d(50, 105), 0, 0, 0); poly.AddVertexAt(5, new Point2d(50, -125), 0, 0, 0); poly.AddVertexAt(6, new Point2d(-50, -125), 0, 0, 0); //         btr.AppendEntity(poly); tr.AddNewlyCreatedDBObject(poly, true); //   Circle cir = new Circle(); cir.SetDatabaseDefaults(); cir.Center = new Point3d(0, 90, 0); cir.Radius = 15; //         btr.AppendEntity(cir); tr.AddNewlyCreatedDBObject(cir, true); //   DBText text = new DBText(); text.Position = new Point3d(-25, -95, 0); text.Height = 35; text.TextString = "BC"; //         btr.AppendEntity(text); tr.AddNewlyCreatedDBObject(text, true); //*** //  3 -       //*** //      BlockTableRecord ms = (BlockTableRecord)tr.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite); //    ,    ID   BlockReference br = new BlockReference(Point3d.Origin, btrId); //           ms.AppendEntity(br); tr.AddNewlyCreatedDBObject(br, true); //   tr.Commit(); } } //  Initialize()  Terminate() ,    IExtensionApplication public void Initialize() { } public void Terminate() { } } } }</span></span></code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">After loading the plugin and executing the HabrCommand command, we get the following image:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1ef/2bb/d78/1ef2bbd78e52459a9e44d078844d8cf4.png"></div></div><br>  Now let's understand what happens in the code. <br><br>  First, we carry out preparatory operations: we obtain references to the document, its database and the <code>Editor</code> property, set the name of the new block, and begin the transaction.  There is nothing new in this, except perhaps <code>Editor</code> properties. <br><br>  I could not find detailed information on the <code>Editor</code> class.  I would be glad if someone from more knowledgeable people prompts a link to the imputed description of this class and its methods (or at least where to find it in the ObjectARX Reference).  In this example, the <code>Editor</code> class is used only to display a message that a block with the same name already exists in the database.  In AutoCAD, this message looks like this: <br><br><img src="https://habrastorage.org/files/a5f/e5f/c94/a5fe5fc948c745d08a0cb3f5d25d98d7.png"><br><br>  Inside the transaction, we act on the algorithm outlined at the beginning of this subsection. <br><br>  <u>In the first step,</u> we create a new entry in the block table, for which: <br><ol><li>  open the block table (request write access, since we will make changes); </li><li>  check if there is a block with the same name in the table (when trying to create a block with a name that is already in the block table, we will get the exception <code>eDuplicateRecordName</code> , which we absolutely do not need); </li><li>  create a new block definition; </li><li>  set the created block definition name; </li><li>  Add the created block definition to the block table and to the transaction. </li></ol><br>  <u>In the second step,</u> we add the necessary geometric primitives to the created record.  We will have three of them: a polyline, a circle and a text. <br><br>  Adding a polyline and a circle to a drawing was explained in the previous article;  with the text everything happens in a similar way.  Adding a graphic object to a block usually takes place in three steps: <br><ol><li>  the required object is created; </li><li>  properties of this object are set; </li><li>  The created object is added to the block definition and to the transaction. </li></ol><br>  This applies to both the polyline and the circle, and to the text.  What part of the code is responsible for which item is quite obvious.  You can read more about adding text to a drawing <a href="http://knowledge.autodesk.com/search-result/caas/CloudHelp/cloudhelp/2015/ENU/AutoCAD-NET/files/GUID-3C694C6C-8BB7-4997-9D1E-1D0B6E810245-htm.html"><u>here</u></a> (English) and <a href="https://sites.google.com/site/bushmansnetlaboratory/translate-manual/sozdanie-i-redaktirovanie-obektov-autocad/dobavlenie-teksta-v-certezi/ispolzovanie-odnostrocnogo-teksta-text/sozdanie-odnostrocnogo-teksta"><u>here</u></a> (rus). <br><br>  <u>In the third step,</u> we add the occurrence of the created block to the drawing.  The procedure here is: <br><ol><li>  opens the model space for recording; </li><li>  a new block entry is created; </li><li>  the created block entry is added to the model space and to the transaction. </li></ol><br>  Let us dwell a little bit more on the constructor of the <code>BlockReference</code> class used to create a new block entry.  This constructor takes two parameters: the block placement point (the base entry point of the block will be combined with this point) and the block definition ID.  In other words, we need to tell AutoCAD <i>which</i> block we want to see and <i>where</i> .  In our example, the origin of the block is the origin ( <code>Point3d.Origin</code> ), and we saved the block definition ID in the first step when creating this definition. <br><br><h2>  Using blocks already present in the document block table </h2><br>  If in the previous example execute the <b>HabrCommand</b> command, then remove the appeared block from the drawing and execute the <b>HabrCommand</b> again, we will see the message ‚ÄúA block with the name‚Äû pvtBlock ‚Äúalready exists‚Äù, and nothing will appear on the drawing.  To use a previously created block definition, you need to know the <code>ObjectID</code> this definition.  In our case, the code can be rewritten as: <br><br><div class="spoiler">  <b class="spoiler_title">Command Code:</b> <div class="spoiler_text"><pre> <code class="hljs ruby">[CommandMethod(<span class="hljs-string"><span class="hljs-string">"HabrCommand"</span></span>)] public void HabrCommand() { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>        Document doc = Application.DocumentManager.MdiActiveDocument; Database db = doc.Database; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-string"><span class="hljs-string">"Editor"</span></span>         AutoCAD Editor ed = doc.Editor; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    const string blockName = <span class="hljs-string"><span class="hljs-string">"pvtBlock"</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Transaction tr = db.TransactionManager.StartTransaction(); using (tr) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span> -       (  ID ) /<span class="hljs-regexp"><span class="hljs-regexp">/*** /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForRead); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ ,         /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   -   ID ObjectId btrId; if (bt.Has(blockName)) { btrId = bt[blockName]; } else { /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      bt.UpgradeOpen(); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    ,    BlockTableRecord btr = new BlockTableRecord(); btr.Name = blockName; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       ,   ID btrId = bt.Add(btr); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/       tr.AddNewlyCreatedDBObject(btr, true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/*** /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  2 -        /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/*** /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   Polyline poly = new Polyline(); poly.SetDatabaseDefaults(); poly.AddVertexAt(0, new Point2d(-50, -125), 0, 0, 0); poly.AddVertexAt(1, new Point2d(-50, 105), 0, 0, 0); poly.AddVertexAt(2, new Point2d(-20, 125), 0, 0, 0); poly.AddVertexAt(3, new Point2d(20, 125), 0, 0, 0); poly.AddVertexAt(4, new Point2d(50, 105), 0, 0, 0); poly.AddVertexAt(5, new Point2d(50, -125), 0, 0, 0); poly.AddVertexAt(6, new Point2d(-50, -125), 0, 0, 0); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/         btr.AppendEntity(poly); tr.AddNewlyCreatedDBObject(poly, true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   Circle cir = new Circle(); cir.SetDatabaseDefaults(); cir.Center = new Point3d(0, 90, 0); cir.Radius = 15; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/         btr.AppendEntity(cir); tr.AddNewlyCreatedDBObject(cir, true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   DBText text = new DBText(); text.Position = new Point3d(-33, -95, 0); text.Height = 35; text.TextString = "BC"; /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/         btr.AppendEntity(text); tr.AddNewlyCreatedDBObject(text, true); } /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/*** /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  3 -       /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/*** /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      BlockTableRecord ms = (BlockTableRecord)tr.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    ,    ID   BlockReference br = new BlockReference(Point3d.Origin, btrId); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/          ms.AppendEntity(br); tr.AddNewlyCreatedDBObject(br, true); /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/   tr.Commit(); } }</span></span></code> </pre></div></div><br>  If we now execute the <b>HabrCommand</b> command, then remove the block that appears from the drawing and rerun the <b>HabrCommand</b> command, the occurrence of our block will reappear on the drawing.  In this case, a new block definition will not be created - the plugin will take the record that already exists in the block table. <br><br>  In the <code>UpgradeOpen()</code> example, I used the <code>UpgradeOpen()</code> method for a <code>UpgradeOpen()</code> , which quite often appears in the examples and documentation.  Let's see how it works. <br><br>  If in the first example we immediately opened the block table for writing ( <code>OpenMode.ForWrite</code> ), now we first open it only for reading ( <code>OpenMode.ForRead</code> ).  This is enough for us to view the table and find out whether it contains a block with our name.  If there is such a block, then we can read its <code>ObjectID</code> , for which, again, we only have access for reading.  If there is no block with our name in the table, then we need to add it, and for this we need write access.  To get this access, the <code>UpgradeOpen()</code> method is used - after calling this method we can work with the block table, as if we opened it with the <code>OpenMode.ForWrite</code> access <code>OpenMode.ForWrite</code> . <br><br><div class="spoiler">  <b class="spoiler_title">Nb:</b> <div class="spoiler_text">  Using <code>UpgradeOpen()</code> is probably good practice.  At least Kean Walmsley does exactly that.  But I don‚Äôt have detailed information about what treasures and life benefits come to those who use <code>UpgradeOpen()</code> .  I myself did not use this construction in my work and did not feel any particular disappointment about this.  If someone can submit their position on the use of <code>UpgradeOpen()</code> - I will be glad to see it in the comments or drugs. </div></div><br><h2>  Changing the position of the block insert </h2><br>  Where the block will appear in the drawing, it <s>is impossible to predict in advance it</s> depends on two things: <br><ul><li>  from the base point specified in the block definition; </li><li>  from the insertion point specified in the block entry. </li></ul><br>  In our example, the base point is located in the center of the block. <br><br><div class="spoiler">  <b class="spoiler_title">Picture:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/529/be6/1a2/529be61a211d4adb8e94e0010437f2c8.png"></div></div><br>  Note that when creating a block definition, we never set the base point anywhere explicitly - in such a case, AutoCAD assumes that the base point is the origin.  In our example, the "center" of the shape was specially selected so that it coincided with the center of coordinates. <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">You can manually change the base definition point of a block using the block editor (as described in the first section of the post) or using the .NET API. </font><font style="vertical-align: inherit;">In the latter case, the </font></font><code>Origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">property is used for this purpose </font></font><code>BlockTableRecord</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">As an example, let's move the base definition point of a block to the bottom left corner. </font><font style="vertical-align: inherit;">To do this, after specifying the block name, set the property </font></font><code>Origin</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><pre> <code class="hljs pgsql">//    btr.Name = blockName; //    btr.Origin = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">-50</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The numbers -50 and -125 are the minimum coordinates of our block along the X and Y axes, respectively (such coordinates are the lower left vertex of the polyline, which forms the outer boundary of our block). </font></font><br><br><div class="spoiler">  <b class="spoiler_title">Result:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/2e0/5b4/926/2e05b49260f44180bb42322610a9aa01.png"><br><br>  . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now let's deal with the insertion point of the block. </font><font style="vertical-align: inherit;">It is set for each block entry and shows where its base point will be after inserting the block. </font><font style="vertical-align: inherit;">This property is set in the class constructor </font></font><code>BlockReference</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- for example, like this:</font></font><br><pre> <code class="hljs lisp">BlockReference br = new BlockReference(<span class="hljs-name"><span class="hljs-name">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), btrId)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After a simultaneous change of the base point and the insertion point, we get the following picture:</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1da/0f0/6a7/1da0f06a7b014c39924fe5bdb65abbac.png"><br><br>   . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The block insertion point can also be changed using the </font></font><code>Position</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">class </font><font style="vertical-align: inherit;">property </font></font><code>BlockReference</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><pre> <code class="hljs cs">BlockReference br = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockReference(Point3d.Origin, btrId); br.Position = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The effect will be the same as when defining a point directly in the class constructor </font></font><code>BlockReference</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Using blocks inside a block </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We all love blocks here, so let's add a couple of blocks to our block to simplify the drawing, while we simplify the drawing. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Yo dawg!</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/458/cea/3e9/458cea3e9a704b20b0861d5e28a32762.jpg"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Adding a block to a block definition is easy. </font><font style="vertical-align: inherit;">The main feature is that if we add not a geometric primitive to the block, but an entry of an auxiliary block, then we definitely need to ensure that the definition of this auxiliary block is in the table of document blocks.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command Code:</font></font></b> <div class="spoiler_text"><pre> <code class="hljs coffeescript">[CommandMethod(<span class="hljs-string"><span class="hljs-string">"HabrCommand"</span></span>)] public void HabrCommand() { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>        Document doc = Application.DocumentManager.MdiActiveDocument; Database db = doc.Database; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   <span class="hljs-string"><span class="hljs-string">"Editor"</span></span>         AutoCAD Editor ed = doc.Editor; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    const string blockName = <span class="hljs-string"><span class="hljs-string">"ltBlock"</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    const string auxBlockName = <span class="hljs-string"><span class="hljs-string">"starBlock"</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Transaction tr = db.TransactionManager.StartTransaction(); using (tr) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForWrite); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">0</span></span> -         (  ID ) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,         <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   -   ID ObjectId btrIdAux; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bt.Has(auxBlockName)) { btrIdAux = bt[auxBlockName]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,    BlockTableRecord btr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockTableRecord(); btr.Name = auxBlockName; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       ,   ID btrIdAux = bt.Add(btr); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       tr.AddNewlyCreatedDBObject(btr, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Polyline poly = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Polyline(); poly.SetDatabaseDefaults(); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-9</span></span>, <span class="hljs-number"><span class="hljs-number">-12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-7</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-14</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">-12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); poly.AddVertexAt(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         btr.AppendEntity(poly); tr.AddNewlyCreatedDBObject(poly, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     (  ID  ) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span> -       (  ID ) <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> ,         <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   -   ID ObjectId btrId; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bt.Has(blockName)) { btrId = bt[blockName]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,    BlockTableRecord btr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockTableRecord(); btr.Name = blockName; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       ,   ID btrId = bt.Add(btr); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       tr.AddNewlyCreatedDBObject(btr, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">2</span></span> -        <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Polyline polyExt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Polyline(); polyExt.SetDatabaseDefaults(); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-50</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-50</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-20</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">105</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-50</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         btr.AppendEntity(polyExt); tr.AddNewlyCreatedDBObject(polyExt, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>     Polyline polyIn = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Polyline(); polyIn.SetDatabaseDefaults(); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-5</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">-5</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point2d(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">-125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>          btr.AppendEntity(polyIn); tr.AddNewlyCreatedDBObject(polyIn, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   Circle cir = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Circle(); cir.SetDatabaseDefaults(); cir.Center = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); cir.Radius = <span class="hljs-number"><span class="hljs-number">15</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         btr.AppendEntity(cir); tr.AddNewlyCreatedDBObject(cir, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         BlockReference starLeft = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockReference(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">-27</span></span>, <span class="hljs-number"><span class="hljs-number">-75</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), btrIdAux); btr.AppendEntity(starLeft); tr.AddNewlyCreatedDBObject(starLeft, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); BlockReference starRight = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockReference(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">27</span></span>, <span class="hljs-number"><span class="hljs-number">-75</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), btrIdAux); btr.AppendEntity(starRight); tr.AddNewlyCreatedDBObject(starRight, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); } <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>  <span class="hljs-number"><span class="hljs-number">3</span></span> -       <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>*** <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      BlockTableRecord ms = (BlockTableRecord)tr.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    ,    ID   BlockReference br = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BlockReference(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>), btrId); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>          ms.AppendEntity(br); tr.AddNewlyCreatedDBObject(br, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>   tr.Commit(); } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Result:</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/37a/e81/969/37ae819695b7488d9de8f5e1f09e7a63.png"></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By and large, there is nothing to comment here: we simply add a definition of an auxiliary block to the block table, and then create an entry for the auxiliary block and give it the coordinates of the insertion point. </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a simple independent exercise, readers are invited to paint the elements of the block and bring their size and location in accordance with the </font></font><a href="http://base.garant.ru/55172439/"><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Order number 1500</font></font></u></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></i> <br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sample:</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/af5/10b/4f8/af510b4f8c354d5b92257813d2f2c41e.png"></div></div><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Why use blocks? </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There are two main reasons ... Let's start with the second. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The second reason </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When a drawing contains a large number of objects of the same type, using blocks greatly reduces the size of the drawing file. </font><font style="vertical-align: inherit;">The following code will help us to feel this:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Plugin code:</font></font></b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.IO; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.Runtime; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.DatabaseServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.Geometry; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.ApplicationServices; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Autodesk.AutoCAD.EditorInput; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> acad = Autodesk.AutoCAD.ApplicationServices.Application; namespace HabrPlug_SimpleBlock { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> ClassMyAutoCADDLL_SimpleBlock { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Commands : IExtensionApplication { // ,         <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> drawFigure(<span class="hljs-type"><span class="hljs-type">double</span></span> x, <span class="hljs-type"><span class="hljs-type">double</span></span> y) { //        Document doc = Application.DocumentManager.MdiActiveDocument; <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> db = doc.<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>; //   <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> tr = db.TransactionManager.StartTransaction(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (tr) { //      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForWrite); //      BlockTableRecord ms = (BlockTableRecord)tr.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite); //   Polyline polyExt = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Polyline(); polyExt.SetDatabaseDefaults(); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">50</span></span>, y - <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">50</span></span>, y + <span class="hljs-number"><span class="hljs-number">105</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">20</span></span>, y + <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">20</span></span>, y + <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">50</span></span>, y + <span class="hljs-number"><span class="hljs-number">105</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">50</span></span>, y - <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyExt.AddVertexAt(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">50</span></span>, y - <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); //         ms.AppendEntity(polyExt); tr.AddNewlyCreatedDBObject(polyExt, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //    Polyline polyIn = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Polyline(); polyIn.SetDatabaseDefaults(); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">5</span></span>, y + <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">5</span></span>, y + <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); polyIn.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">125</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); //          ms.AppendEntity(polyIn); tr.AddNewlyCreatedDBObject(polyIn, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //   <span class="hljs-type"><span class="hljs-type">Circle</span></span> cir = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Circle(); cir.SetDatabaseDefaults(); cir.Center = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point3d(x, y + <span class="hljs-number"><span class="hljs-number">90</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); cir.Radius = <span class="hljs-number"><span class="hljs-number">15</span></span>; //         ms.AppendEntity(cir); tr.AddNewlyCreatedDBObject(cir, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //  ,         Polyline starLeft= <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Polyline(); starLeft.SetDatabaseDefaults(); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">9</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">7</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">7</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">9</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starLeft.AddVertexAt(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x - <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); ms.AppendEntity(starLeft); tr.AddNewlyCreatedDBObject(starLeft, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); Polyline starRight = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Polyline(); starRight.SetDatabaseDefaults(); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">9</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">7</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">14</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> - <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">15</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">5</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">14</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> + <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">7</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">2</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span> + <span class="hljs-number"><span class="hljs-number">9</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">12</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); starRight.AddVertexAt(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point2d(x + <span class="hljs-number"><span class="hljs-number">27</span></span>, y - <span class="hljs-number"><span class="hljs-number">75</span></span> - <span class="hljs-number"><span class="hljs-number">6</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); ms.AppendEntity(starRight); tr.AddNewlyCreatedDBObject(starRight, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //   tr.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>(); } } // ,       <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> drawBlock(<span class="hljs-type"><span class="hljs-type">double</span></span> x, <span class="hljs-type"><span class="hljs-type">double</span></span> y) { //        Document doc = Application.DocumentManager.MdiActiveDocument; <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> db = doc.<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>; //   "Editor"         AutoCAD Editor ed = doc.Editor; //    const string blockName = "ltBlock"; const string auxBlockName = "starBlock"; //   <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> tr = db.TransactionManager.StartTransaction(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (tr) { //      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForWrite); /<span class="hljs-comment"><span class="hljs-comment">/*** //  0 -         (  ID ) //*** ObjectId btrIdAux; if (bt.Has(auxBlockName)) { btrIdAux = bt[auxBlockName]; } else { //    ,    BlockTableRecord btr = new BlockTableRecord(); btr.Name = auxBlockName; //       ,   ID btrIdAux = bt.Add(btr); //       tr.AddNewlyCreatedDBObject(btr, true); //   Polyline poly = new Polyline(); poly.SetDatabaseDefaults(); poly.AddVertexAt(0, new Point2d(0, -6), 0, 0, 0); poly.AddVertexAt(1, new Point2d(-9, -12), 0, 0, 0); poly.AddVertexAt(2, new Point2d(-7, -2), 0, 0, 0); poly.AddVertexAt(3, new Point2d(-14, 6), 0, 0, 0); poly.AddVertexAt(4, new Point2d(-5, 6), 0, 0, 0); poly.AddVertexAt(5, new Point2d(0, 15), 0, 0, 0); poly.AddVertexAt(6, new Point2d(5, 6), 0, 0, 0); poly.AddVertexAt(7, new Point2d(14, 6), 0, 0, 0); poly.AddVertexAt(8, new Point2d(7, -2), 0, 0, 0); poly.AddVertexAt(9, new Point2d(9, -12), 0, 0, 0); poly.AddVertexAt(10, new Point2d(0, -6), 0, 0, 0); //         btr.AppendEntity(poly); tr.AddNewlyCreatedDBObject(poly, true); } //*** //  1 -       (  ID ) //*** // ,         //   -   ID ObjectId btrId; if (bt.Has(blockName)) { btrId = bt[blockName]; } else { //    ,    BlockTableRecord btr = new BlockTableRecord(); btr.Name = blockName; //       ,   ID btrId = bt.Add(btr); //       tr.AddNewlyCreatedDBObject(btr, true); //*** //  2 -        //*** //   Polyline polyExt = new Polyline(); polyExt.SetDatabaseDefaults(); polyExt.AddVertexAt(0, new Point2d(-50, -125), 0, 0, 0); polyExt.AddVertexAt(1, new Point2d(-50, 105), 0, 0, 0); polyExt.AddVertexAt(2, new Point2d(-20, 125), 0, 0, 0); polyExt.AddVertexAt(3, new Point2d(20, 125), 0, 0, 0); polyExt.AddVertexAt(4, new Point2d(50, 105), 0, 0, 0); polyExt.AddVertexAt(5, new Point2d(50, -125), 0, 0, 0); polyExt.AddVertexAt(6, new Point2d(-50, -125), 0, 0, 0); //         btr.AppendEntity(polyExt); tr.AddNewlyCreatedDBObject(polyExt, true); //    Polyline polyIn = new Polyline(); polyIn.SetDatabaseDefaults(); polyIn.AddVertexAt(0, new Point2d(-5, -125), 0, 0, 0); polyIn.AddVertexAt(1, new Point2d(-5, 125), 0, 0, 0); polyIn.AddVertexAt(2, new Point2d(5, 125), 0, 0, 0); polyIn.AddVertexAt(3, new Point2d(5, -125), 0, 0, 0); //          btr.AppendEntity(polyIn); tr.AddNewlyCreatedDBObject(polyIn, true); //   Circle cir = new Circle(); cir.SetDatabaseDefaults(); cir.Center = new Point3d(0, 90, 0); cir.Radius = 15; //         btr.AppendEntity(cir); tr.AddNewlyCreatedDBObject(cir, true); //   BlockReference starLeft = new BlockReference(new Point3d(-27, -75, 0), btrIdAux); btr.AppendEntity(starLeft); tr.AddNewlyCreatedDBObject(starLeft, true); BlockReference starRight = new BlockReference(new Point3d(27, -75, 0), btrIdAux); btr.AppendEntity(starRight); tr.AddNewlyCreatedDBObject(starRight, true); } //*** //  3 -       //*** //      BlockTableRecord ms = (BlockTableRecord)tr.GetObject(bt[BlockTableRecord.ModelSpace], OpenMode.ForWrite); //    ,    ID   BlockReference br = new BlockReference(new Point3d(x, y, 0), btrId); //          ms.AppendEntity(br); tr.AddNewlyCreatedDBObject(br, true); //   tr.Commit(); } } //        AutoCAD  "HabrCommand_DrawFigures" [CommandMethod("HabrCommand_DrawFigures")] public void HabrCommand_DrawFigures() { for (int x = 0; x &lt; 100; x++) { for (int y = 0; y &lt; 100; y++) { drawFigure(125 * x, 300 * y); } } } //        AutoCAD  "HabrCommand_DrawBlocks" [CommandMethod("HabrCommand_DrawBlocks")] public void HabrCommand_DrawBlocks() { for (int x = 0; x &lt; 100; x++) { for (int y = 0; y &lt; 100; y++) { drawBlock(125 * x, 300 * y); } } } //  Initialize()  Terminate() ,    IExtensionApplication public void Initialize() { } public void Terminate() { } } } }</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The code is very simple: there are two procedures - </font></font><code>drawFigure(double x, double y)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>drawBlock(double x, double y)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">The first draws a set of shapes at a given point that exactly repeats our block, and the second creates an entry of our block at a given point. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is followed by two commands - </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HabrCommand_DrawFigures</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HabrCommand_DrawBlocks</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">The first draws 10,000 sets of shapes in the drawing, the second draws 10,000 entries of the block.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Work results</font></font></b> <div class="spoiler_text">  : <br><br><img src="https://habrastorage.org/files/b7f/a75/fe0/b7fa75fe0f9141458c0d45d7d093aeda.png"><br><br>  : <br><br><img src="https://habrastorage.org/files/b17/03f/d48/b1703fd4827949f39bca4e0d23addb95.png"><br><br>  : <br><br><img src="https://habrastorage.org/files/9a1/ce2/be3/9a1ce2be33de4f199198e70b755589f5.png"><br><br>    : <br><br><img src="https://habrastorage.org/files/04c/bdf/763/04cbdf763a88476a8a84809c0dce4f41.png"><br><br>    : <br><br><img src="https://habrastorage.org/files/9f9/681/d2d/9f9681d2d7e84d64bc557b6942a4ae25.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Run AutoCAD, execute the first command, save the drawing. </font><font style="vertical-align: inherit;">Then close AutoCAD and repeat the same procedure for the second command. </font><font style="vertical-align: inherit;">As a result, we get two dwg-file. </font><font style="vertical-align: inherit;">Let's compare their sizes.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The end is a bit predictable:</font></font></b> <div class="spoiler_text">    : <br><br><img src="https://habrastorage.org/files/5d2/e8d/c0a/5d2e8dc0a9e84d018eee3d5acf0edf3d.png"><br><br>    : <br><br><img src="https://habrastorage.org/files/f6a/355/b0d/f6a355b0df66425a831eff8153264e74.png"><br></div></div><br><h3>  First reason </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Some increase in the size of the drawing file is not good, but not so terrible: Russia is big, there is enough space for everyone. </font><font style="vertical-align: inherit;">However, there are problems and more serious. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Imagine that in the aforementioned Order ‚Ññ1500 made an addition, strictly regulating the location of the buttons on the chase, and we need to move </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">on all shoulder straps a</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> circle slightly higher from the current position. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we used blocks, the problem is solved in several lines of code: we simply open the definition of the block, find a circle there and shift its center to the desired point. </font><font style="vertical-align: inherit;">Since all occurrences of the block refer to the same definition, after the execution of the command, they will all be updated automatically.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Command Code:</font></font></b> <div class="spoiler_text"><pre> <code class="hljs pgsql">[CommandMethod("HabrCommand_MoveButton")] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> HabrCommand_MoveButton() { //        Document doc = Application.DocumentManager.MdiActiveDocument; <span class="hljs-keyword"><span class="hljs-keyword">Database</span></span> db = doc.<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>; //   "Editor"         AutoCAD Editor ed = doc.Editor; //    const string blockName = "ltBlock"; //   <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> tr = db.TransactionManager.StartTransaction(); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (tr) { //      BlockTable bt = (BlockTable)tr.GetObject(db.BlockTableId, OpenMode.ForWrite); // ,         //   -       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!bt.Has(blockName)) { ed.WriteMessage("Block not found!"); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //      BlockTableRecord btr = tr.GetObject(bt[blockName], OpenMode.ForWrite) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> BlockTableRecord; //    ID     <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (ObjectId id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> btr) { //   ID   ,     DBObject obj = tr.GetObject(id, OpenMode.ForRead); //    -  (<span class="hljs-type"><span class="hljs-type">Circle</span></span>),           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.GetType() == typeof(<span class="hljs-type"><span class="hljs-type">Circle</span></span>)) { obj.UpgradeOpen(); (obj <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-type"><span class="hljs-type">Circle</span></span>).Center = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Point3d(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } } //   tr.<span class="hljs-keyword"><span class="hljs-keyword">Commit</span></span>(); } }</code> </pre></div></div><br><div class="spoiler">  <b class="spoiler_title">Nb:</b> <div class="spoiler_text">     ,      .     ;                  .     <a href="http://www.acadnetwork.com/index.php%3Ftopic%3D313.0"><u></u></a> (.)  <a href="http://spiderinnet1.typepad.com/blog/2015/02/various-ways-in-vbnet-to-check-object-types-of-autocad-net.html"><u></u></a> (.) .   , ,         ,    . , ,   <s></s>     . <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A small detail: AutoCAD does update all the occurrences of the blocks, but to see it, you need to run the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">REGEN</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> command </font><font style="vertical-align: inherit;">:</font></font><br><br><img src="https://habrastorage.org/files/35e/ef6/4ad/35eef64ad18841b19d8cd80b68798a39.png"><br><br><div class="spoiler">  <b class="spoiler_title">Result:</b> <div class="spoiler_text">  BEFORE: <br><br><img src="https://habrastorage.org/files/e4c/c84/048/e4cc840482624ae7b48faa19770a0839.png"><br><br> : <br><br><img src="https://habrastorage.org/files/228/9a0/87d/2289a087d8f94155b845efb2936ee9b4.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, a similar operation can be rotated in the case of geometric shapes, not block occurrences, but then you have to work with the whole drawing and change the coordinates of the center of the circle not once, but ten thousand. </font><font style="vertical-align: inherit;">I did not conduct tests, but I think that this procedure will take a little longer than editing the block definition. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the other hand, each coin has obverse and reverse, and the use of blocks imposes its own limitations. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, if it is necessary to replace the lieutenant shoulder strap, located in the eleventh row and forty-second column, with a captain, then using blocks in no normal way, we cannot do it.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> It is necessary either to create a new block for the captain, or to finish drawing asterisks manually, or to resort to some additional distortions. </font></font><br><br><div class="spoiler">  <b class="spoiler_title">Nb:</b> <div class="spoiler_text"> <i>NBpaeHu</i> ‚Äî   ,    <u></u>  .      <a href="http://habrahabr.ru/post/251341/"> </a> ,   . <br></div></div><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A brief conclusion</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (where would it be without it): the use of blocks can save a lot of time and effort, but they must be applied reasonably, if necessary. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On this I, perhaps, complete. </font><font style="vertical-align: inherit;">Next time I will tell about the search and editing of objects in the drawing. </font><font style="vertical-align: inherit;">As always, I will be glad to any comments, comments and suggestions - in the comments or drugs.</font></font><br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/259303/">https://habr.com/ru/post/259303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259293/index.html">Time management for the developer</a></li>
<li><a href="../259295/index.html">From detour to Dijkstra‚Äôs algorithm</a></li>
<li><a href="../259297/index.html">Interface settings and much more in the assembly Vivaldi 1.0.190.2</a></li>
<li><a href="../259299/index.html">Rusty evidence</a></li>
<li><a href="../259301/index.html">Cackle comment system: how we did the analytics</a></li>
<li><a href="../259305/index.html">PHP Digest number 63 - interesting news, materials and tools (May 11 - 31, 2015)</a></li>
<li><a href="../259307/index.html">Operations as objects</a></li>
<li><a href="../259309/index.html">Web Application Security Audit Methodology</a></li>
<li><a href="../259311/index.html">AngularJS vs. Backbone.js vs. Ember.js</a></li>
<li><a href="../259315/index.html">HL7: one day in the operating room</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>