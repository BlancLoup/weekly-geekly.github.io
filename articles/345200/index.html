<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to deal with miners cryptocurrency in the corporate network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The problem of using corporate IT resources for mining cryptocurrency is becoming increasingly common ( Transneft recently mentioned them). And the ot...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to deal with miners cryptocurrency in the corporate network</h1><div class="post__text post__text-html js-mediator-article">  The problem of using corporate IT resources for mining cryptocurrency is becoming increasingly common ( <a href="https://www.securitylab.ru/news/490332.php">Transneft</a> recently mentioned them).  And the other day, the FSB <a href="https://www.securitylab.ru/news/490293.php">descended</a> on Vnukovo Airport and detained the administrator, who mined cryptocurrency at the computing capacity of the aviation harbor.  I will immediately answer the frequently asked question: ‚ÄúAnd where is the FSB?‚Äù Everything is very simple.  Vnukovo is not only an airport for ordinary passengers;  the President of Russia and members of the Government flies from Vnukovo-2, which makes this air port a critical object for national security.  And when, for some unknown reason, power surges occur in it, which can lead to the shutdown of individual air traffic control systems, then the FSB takes up the matter.  But back to the mining.  Recently, we have received several requests from customers with a request to explain how to detect the fact of using miners in a corporate or departmental network?  Given the growing number of such issues, we decided to write this note. <a name="habracut"></a><br><br>  To begin with, mining is not a typical threat to information security.  Mining software cryptocurrency does not directly harm your information assets.  No data theft or modification (usually).  Interception management of technological or production processes, too.  Accessibility violations?  Probably too.  But there is a braking computer, the load on the grid (and the company pays for electricity), the cost of Internet traffic (may be an actual problem with limited traffic) and a laptop battery dropping to zero, which you can try to translate into financial damage for the company (although this and not easy).  The most annoying thing is that someone at your expense can profit and get fabulous profits (just look at the course of cryptocurrency to nervously bite your elbows and regret that conscience does not allow itself to be minted on corporate resources).  But ... it also happens that mining accompanies malicious software, which makes it a more serious problem for information security specialists.  In any case, one of the tasks of information security (and IT too) is to know what is happening on its farm and have the tools to control any activity, whether legal or not.  Therefore, the issue of detection and, often, blocking miners, is becoming increasingly important. <br><br>  If you read a lot of notes on the Internet about how to find a miner on your computer, then usually all the recommendations are reduced to one main thing - to pay attention to the inhibition of your PC, which is determined by the sensations or by using visual analysis of the task scheduler (Task manager in Windows or Activity monitor on MacOS), which displays CPU utilization for various applications and processes.  However, this recommendation is more suitable for home users than for corporate users who cannot track the processor load of hundreds or thousands of computers.  Therefore, we will try to look at the mining problem from a slightly different angle, or rather from the point of view of the so-called kill chain, which displays the set of steps that the intruder performs (his user, installing the miner to his PC, is also such) in the process of launching the mining software yourself on the site.  If this is your user, then usually the sequence will be like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  visiting mining sites </li><li>  downloading mining software </li><li>  installation software for mining </li><li>  running mining software </li><li>  mining </li><li>  interaction with miners' pools to exchange information on blocks and hashes received </li><li>  Remuneration </li></ul><br>  Unauthorized installation of the miner on the computer of an unsuspecting user looks a little different in the first and last stages of the kill chain: <br><br><ul><li>  victim search </li><li>  preparing a bridgehead (introducing a mining script to the site, creating mining software, introducing mining software into any free or conditionally free or pirated software, introducing mining functionality into malware) </li><li>  ‚ÄúInfection‚Äù of the user by the mining software (via a script on the site, by downloading it from the Internet, by receiving it as an attachment to an email or on a flash drive) </li><li>  miner launch </li><li>  mining </li><li>  interaction with miners' pools or with the command center for the transfer of information obtained as a result of calculations. </li></ul><br>  In addition to the usual loading of the miner or the inclusion of mining functionality, for example, in the torrent client, various multi-pass schemes are also possible.  For example, a non-malicious software first gets to the user's computer (and therefore it may not be detected by antivirus or security tools), which is loaded by a special downloader, which downloads the miner from the Internet and secretly installs it on an unsuspecting user‚Äôs computer.  Please note that instead of the file being downloaded, this may be the script on the site you are visiting (the Coin Hive script is very popular). <br><br><img src="https://habrastorage.org/webt/0e/ch/ob/0echobile8rk8kteudq74ihv7l8.png" alt="Access statistics on coin-hive.com obtained using Cisco Umbrella Investigate"><br><br>  A less popular, but also possible way is to get a miner on a computer through an attachment to an e-mail or a link in a letter, as well as through an advertising banner or a fake button on the site, clicking on which leads to downloading the miner to the computer.  I would like to again draw your attention to the fact that the miner itself does not have malicious functions.  Moreover, the user himself could legally install it.  For this reason, in traditional antivirus software, this type of software is not blocked by default, but can only be detected (if the antivirus has the corresponding set of signatures). <br><br><img src="https://habrastorage.org/webt/hm/on/sg/hmonsgiaiusqyyc-hqvmzjanivu.png" alt="An example of a fake button that initiates the launch of the miner"><br><br>  Another important point is that the miner does not work alone.  He is usually part of a whole botnet (pool of miners), with the command center of which he interacts - receiving commands or sending the results of his work.  Therefore, a miner can be detected not only by its activity on the host, but also in the process of network interaction ‚Äî after sending hashes or receiving new commands or data for calculations. <br><br>  How does the Cisco company offer to fight with the mining software?  Following our classic ‚Äú <a href="https://gblogs.cisco.com/ru/bda/">BEFORE - DURING - AFTER</a> ‚Äù strategy, which takes into account the life cycle of an attack or other controlled activity, we propose to split all the control and protection measures into three parts: <br><br><ul><li>  <b>BEFORE</b> - preventing interaction with sites for mining or miners getting into the network through various channels </li><li>  <b>DURING</b> - detection of installation and operation of mining software </li><li>  <b>AFTER</b> - conduct a retrospective analysis of the behavior of files that fall inside a corporate or departmental network. </li></ul><br>  At the first stage, in addition to standard recommendations for protecting end devices from malicious software, we advise you to configure network equipment, firewalls or Internet access controls to block access to mining sites.  For example, to coin-hive.com or minergate.com.  This can be done using <b>Cisco ISR</b> , <b>Cisco Firepower</b> , <b>Cisco Web Security Appliance</b> , <b>Cisco Umbrella</b> , <b>Cisco ASA</b> , etc.  I will not give a ready list of such domains, since today there are already over a thousand mining pools and, given the increasing complexity of computational tasks, they will become more and more.  Therefore, I would recommend to regularly monitor mining pools ratings, which can be freely found on the Internet.  I will name only a few names: <br><br><ul><li>  suprnova [.] cc, </li><li>  nanopool [.] org, </li><li>  zpool [.] ca, </li><li>  coinmime [.] pl, </li><li>  eth.pp [.] ua, </li><li>  zcash.flypool [.] org, </li><li>  dwarfpool [.] org, </li><li>  p2pool [.] org, </li><li>  bitclubnetwork [.] com, </li><li>  miningrigrentals [.] com, </li><li>  minergate [.] com, </li><li>  nicecash [.] com, </li><li>  hashing24 [.] com, </li><li>  hashcoin [.] io, </li><li>  hashflare [.] io, </li><li>  eobot [.] com, </li><li>  antpool [.] com, </li><li>  pool.btcchina [.] com, </li><li>  bw [.] com, </li><li>  mining.bitcoin [.] cz, </li><li>  eligius [.] st, </li><li>  ghash [.] io, </li><li>  bitminter [.] com, </li><li>  bitfury [.] org, </li><li>  kncminer [.] com, </li><li>  21 [.] Co, </li><li>  slushpool [.] com, etc. </li></ul><br>  You can track lists of pools at btc [.] Com and blockchain [.] Info.  By the way, workers' access control to the last two domains (can be implemented via Firepower, Umbrella or Web Security Appliance with reference to user accounts) will let you know which of your users are interested in the subject of mining and are willing to try their hand at working with cryptocurrency, And this is important information to enhance future control. <br><br>  Blocking access to the above-described domains will allow not only to prevent downloading of mining software (stage ‚ÄúTO‚Äù), but also to block interaction with pools in the case when the corresponding software somehow got on the user's computer (via attachment to e-mail , via a USB flash drive, with the help of malware or functionality in conditionally free software, in which mining is an imperceptible ‚Äúload‚Äù or ‚Äúprice‚Äù for free) and tries to interact with them (stage ‚ÄúDURING‚Äù). <br><br>  Unfortunately, we must admit that we cannot eliminate blocking access to mining pools - they appear all the time and keep track of them is not easy (remember, these are not malicious resources, the control of which is a top priority for <a href="https://www.talosintelligence.com/">Cisco Talos</a> ).  In addition, a user or malware can use tunneling (for example, SSH) or other methods of communication (for example, Tor) with appropriate pools.  Therefore, we should be able to track the work of miners in real time (stage ‚ÄúIN TIME‚Äù).  This can be done either by using the aforementioned interaction tracking with the relevant domains, or by tracking the ports that mining software uses to interact with pools and command centers.  These ports include: <br><br><ul><li>  3333 (bitcoin) </li><li>  3336 (litecoin) </li><li>  8333 (bitcoin) </li><li>  8545 (Ethereum), </li><li>  9333 (litecoin) </li><li>  9999 (Dashcoin), </li><li>  10034 (ypool.net) </li><li>  22556 (Dogecoin), </li><li>  30301 (Ethereum), </li><li>  30303 (Ethereum), </li><li>  45550 (bytecoin), </li><li>  45560 (monero), </li><li>  45620 (DigitalNote), </li><li>  45570 (QuazarCoin), </li><li>  45610 (Fantomcoin), </li><li>  45640 (MonetaVerde), </li><li>  45690 (Aeoncoin), </li><li>  45720 (Dashcoin), </li><li>  45750 (Infinium-8). </li></ul><br>
 ,       . -,      8080  8081       ‚Äî       (<b>Cisco Stealthwatch</b>),   HTTP (  Cisco Firepower, <b>Cisco Cognitive Threat Analytics</b>, <b>Cisco AVC</b>)  DNS (  Cisco Umbrella). -,          . -,              . ,    Zotob     3333, ,    ,    .  Cisco Firepower, Cisco ASA, Cisco Stealthwatch, Cisco ISR         ,      , ,   ,        .<br>
<br>
<img src="https://habrastorage.org/webt/mw/28/ro/mw28roq8byurr7zunp17ywptppq.png" alt="  Litecoin  Firepower"><br>
<br>
  ,   Cisco Firepower    ,  , ,  Bitcoin  Litecoin.              ,       (    ,        ),   ,         .      Cisco ISR   AVC (Application Visibility and Control),       ,   .<br>
<br>
<img src="https://habrastorage.org/webt/ug/ib/gt/ugibgtev5aivwjxwqkehrqibsyy.png" alt="  Bitcoin  Firepower"><br>
<br>
   <b>Cisco NGIPS</b>          ,    ,   . ,    SID 1-40840, 1-40841, 1-40842,      Stratum   .    SID 1-31273  1-20057 ,  ,        (CoinMiner  Win.Trojan.Vestecoin),      .              . ,    :<br>
<br>
<code>alert tcp $EXTERNAL_NET any -&gt; $HOME_NET any (msg:"Possible Bitcoin/LiteCoin Mining"; flow:established; content:"|7B 22 70 61 72 61 6D 73 22 3A 20 5B 22|"; Depth:15; classtype:bad-unknown; reference:url,mining.bitcoin.cz/stratum-mining; sid:1000500; rev:1;)</code><br>
<br>
 <br>
<br>
<code>alert tcp $HOME_NET any -&gt; $EXTERNAL_NET any (msg:"ET TROJAN W32/BitCoinMiner.MultiThreat Subscribe/Authorize Stratum Protocol Message"; flow:established,to_server; content:"{|22|id|22|"; depth:10; content:"|22|method|22 3A| |22|mining."; within:100; content:"|22|params|22|"; within:50; pcre:"/\x22mining\x2E(subscribe|authorize)\x22/"; classtype:trojan-activity; reference:url,talosintelligence.com/; reference:url,www.btcguild.com/new_protocol.php; reference:url,mining.bitcoin.cz/stratum-mining; sid:1000501; rev:1;)</code><br>
<br>
,                     . ‚Äú       -? ?   ?‚Äù              .<br>
<br>
  ,    ,   Cisco Cognitive Threat Analytics, Cisco Umbrella  Cisco Web Security Appliance,         . <a href="https://www.youtube.com/watch%3Fv%3DmZOJGGpZ0IE">Cisco Umbrella</a>         /      , IPS     .   Umbrella         Potentially Harmful Domains.<br>
<br>
<img src="https://habrastorage.org/webt/u0/02/oa/u002oaa2pg7aavwvm5avp_ny-xo.png" alt="        Cisco Umbrella"><br>
<br>
,     ,   ,   ,      ¬´¬ª . ,   <a href="https://www.youtube.com/watch%3Fv%3DH4wVjbVSokw">Cisco Umbrella Investigate</a>     ,   coin-hive,               :<br>
<br>
<img src="https://habrastorage.org/webt/mm/4l/t3/mm4lt3jzam7bqi85xyj7t6yktfy.png" alt=" ,  Cisco Umbrella Investigate"><br>
<br>
        ,     ,    <b>AMP for Endpoints</b>,      .  ,           ,       ‚Äî svchost.exe, chrome.exe   steam.exe ( ).       AMP4E,  ,    ,   . <br>
<br>
<img src="https://habrastorage.org/webt/lv/gd/je/lvgdjenroew2wjmqzvkz3q0pae0.png" alt="       Cisco AMP4E"><br>
<br>
 ,      W32.Cryptocurrencyminer,      .   ,     ,    ,        Virus Total,          ‚Äú ‚Äù.    , AMP4E       ,      .     ‚Äú  ‚Äù (application white listening, AWL)  ‚Äú  ‚Äù, ,         . AMP4E        ,      ,      .<br>
<br>
<img src="https://habrastorage.org/webt/94/is/y-/94isy-j29txcmvjmb7ia0xaxbbm.png" alt="   Desktop Windows Manager,  "><br>
<br>
<img src="https://habrastorage.org/webt/wk/wc/kr/wkwckrzfbt1ibn5jwjtylmx2ozi.png" alt="   dwarfpool"><br>
<br>
<img src="https://habrastorage.org/webt/bw/ov/9x/bwov9xle9lqa2e3jmeuvbbrrrao.png" alt="     "><br>
<br>
     ‚Äú‚Äù,     ,  -  -             .      ,  ,     <a href="https://habrahabr.ru/company/cisco/blog/271191/">Cisco AMP Threat Grid</a>,     ,    ( ,  Web,  ,  ,  FTP  ..),      700         .    cryptominer-detected, cryptominer-network-detected  cryptominer-pool-contacted,  <b>AMP Threat Grid</b>        :<br>
<br>
<ul>
<li>   -<br>
<br>
<img src="https://habrastorage.org/webt/sb/vr/_l/sbvr_luvk_clgbn5_pychrpz9ak.png" alt="Cisco AMP Threat Grid  "><br>
<br>
<img src="https://habrastorage.org/webt/xo/wb/dh/xowbdhcafpuo55eadbkjqnfongg.png" alt="   ,  Cisco AMP Threat Grid"><br>
<br>
</li>
<li>   <br>
<br>
<img src="https://habrastorage.org/webt/on/dl/cz/ondlcz9o7-kmmmdpebt6k5amk74.png" alt="Cisco AMP Threat Grid  "><br>
<br>
<img src="https://habrastorage.org/webt/eo/im/9j/eoim9jjrjct2hy6jjoarwo5hlh8.png" alt=",     ,  Cisco AMP Threat Grid"><br>
<br>
<img src="https://habrastorage.org/webt/ig/-b/ly/ig-blypi8gxholjrt_cfm_5dnc4.png" alt=",  ,  Cisco AMP Threat Grid"></li>
<li>    .<br>
<br>
<img src="https://habrastorage.org/webt/og/9-/l4/og9-l4g1md2lklbf3fbkpwlb5_i.png" alt="Cisco AMP Threat Grid  "><br>
<br>
<img src="https://habrastorage.org/webt/v7/us/h6/v7ush6d0owckitkkaofg3xvokcg.png" alt="   ,    ,  "></li>
</ul><br>
<br>
  , ,  .                  ? .  ,     .      ‚Äî                          .  ,    ,    ,     ,       ,      .        .          ,           .   Cisco     Cisco Talos,      ,        ,     /  ,  ,  ,      ,         ,     ‚Äî Cisco Firepower, Cisco Umbrella, Cisco Stealthwatch, Cisco Web Security Appliance, Cisco AMP for Endpoints, Cisco Cognitive Threat Analytics, Cisco AMP Threat Grid  .<br>
<br>
, ,    ,           (        )-        ,    (, NoScript  Firefox, minerBlock  No Coin  Chrome),    (, AdBlock),       ,        ,     .</div><p>Source: <a href="https://habr.com/ru/post/345200/">https://habr.com/ru/post/345200/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../345190/index.html">We generate fake news headlines in the style of Tapy.ru</a></li>
<li><a href="../345192/index.html">Understand what happened with the course of Bitcoin</a></li>
<li><a href="../345194/index.html">Information security of bank non-cash payments. Part 2 - Typical IT infrastructure of the bank</a></li>
<li><a href="../345196/index.html">Attention! S in Ethereum stands for Security. Part 1. Blockchain things</a></li>
<li><a href="../345198/index.html">Dynamic identification of control objects</a></li>
<li><a href="../345202/index.html">Typescript. Read Only Properties</a></li>
<li><a href="../345204/index.html">How to learn to think in images using visual analogies</a></li>
<li><a href="../345206/index.html">We tried to hire these two for five years. And every minute of our waiting paid off.</a></li>
<li><a href="../345208/index.html">1Kb autocomplete</a></li>
<li><a href="../345210/index.html">Anonymous Father Frost 2017-2018: post boasting New Year's gifts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>