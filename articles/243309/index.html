<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The hacker group Sednit specializes in attacks against isolated air-gapped networks.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sednit Cybercrime Group, also known as Sofacy, APT28 or Fancy Bear has specialized in attacks against various organizations for many years. We recentl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The hacker group Sednit specializes in attacks against isolated air-gapped networks.</h1><div class="post__text post__text-html js-mediator-article">  <b>Sednit</b> Cybercrime Group, also known as Sofacy, APT28 or Fancy Bear has specialized in attacks against various organizations for many years.  We recently discovered that this group began to specialize in attacks against air-gapped networks protected from the Internet.  For this purpose, a special malicious program is used, with the help of which the confidential data of computers in a compromised network is stolen. <br><br><img src="https://habrastorage.org/files/e51/6c3/e96/e516c3e9694b4290bdb3f6b1bdb4e550.jpg"><br><br>  Earlier we <a href="http://habrahabr.ru/company/eset/blog/239979/">wrote</a> about the criminal activity of this group, which used its own set of exploits to compromise legitimate websites and subsequently infect users with malware.  FireEye also reported on the activity of this group in its report on the <a href="http://www.fireeye.com/resources/pdfs/apt28.pdf">APT28</a> group, as well as Trend Micro in the <a href="http://www.trendmicro.com/vinfo/us/security/news/cyber-attacks/pawn-storm-espionage-attacks-use-decoys-deliver-sednit">Operation Pawn Storm</a> report.  In this article we will focus on the new attack area of ‚Äã‚Äãthis group, which uses the <a href="http://www.virusradar.com/en/Win32_USBStealer/detail">Win32 / USBStealer malware</a> to steal confidential data from computer networks that are isolated from the Internet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Our research shows that the Sednit team has been using <b>Win32 / USBStealer malware</b> since at least 2005.  The targets of such attacks are various government organizations in Eastern Europe.  Several versions of this malware have been used in attacks of varying degrees of complexity. <br><br>  One of the security measures that can be used by the enterprise security service in order to prevent leakage of confidential data from computers connected to the corporate network is its isolation from the Internet by technical means.  However, the use of removable media may be the starting point for leaking such data.  It is assumed that some employee of the enterprise can transfer corporate data on a USB-drive, and they will be copied to a computer that has access to the worldwide network. <br><br>  This scenario is used by the Sednit team when using <b>Win32 / USBStealer</b> .  In this case, the scheme for obtaining confidential data using a malicious program will be multistage and consists of five stages. <br><br>  <b>Stage 1</b> <br><br>  In the first stage, attackers compromise a computer that has access to the Internet (for example, an employee‚Äôs home computer).  Let's call it "Computer A".  During the compromise process, Computer A becomes infected with a dropper of a malicious program that we detect as <b>Win32 / USBStealer.D</b> .  The executable file of this dropper is called <i>USBSRService.exe</i> , and its fake resource section indicates that this file is the installer of the legitimate Russian program <a href="https://ru.wikipedia.org/wiki/USB_Disk_Security">USB Disk Security</a> . <br><br><img src="https://habrastorage.org/files/9e9/03d/d65/9e903dd65c104c6a87c8fe6836f6ebcb.png"><br>  Fig.  <b>Win32 / USBStealer dropper metadata</b> . <br><br>  The basic logic of the dropper is as follows: <br><br><ul><li>  It monitors the connection to the removable storage system through the creation of a window with <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms633573(v%3Dvs.85).aspx">a callback function</a> , which will be called in the event of such an event. </li><li>  As soon as the removable drive is inserted into the system, the dropper decrypts several elements of its resource section of the executable file.  One of them is another <b>Win32 / USBStealer</b> executable file, which is copied to a removable drive under the name <i>USBGuard.exe</i> .  The second element of the resource section is an AUTORUN.INF file, the contents of which are presented below. </li><li>  Files are copied to the root of a removable drive and, if the autorun function is enabled, they will be executed as soon as the drive is inserted into the computer with autorun enabled, or by double clicking on the drive icon (see AUTORUN.INF format below).  The ‚ÄúStartup‚Äù setting for Windows was eliminated back in 2009 by updating <a href="http://support.microsoft.com/kb/971029">KB971029</a> .  However, our data show that attackers started using <b>Win32 / USBStealer</b> four years earlier, that is, in 2005. In addition, for computers that operate on air-gapped networks, the absence of updates is considered to be quite common. </li><li>  In the last step, the malware copies an empty file called <i>destktop.in</i> to the root of the disk.  This serves as a signal to the malicious program that this drive has already been connected to a computer that has access to the Internet. </li></ul><br><br><img src="https://habrastorage.org/files/d2d/7ff/685/d2d7ff6853344083a52c595f6efcef38.png"><br>  Fig.  The contents of the file AUTORUN. <br><br>  When writing files to a removable drive, the dropper modifies the file metadata, namely, their ‚ÄúLast Access‚Äù and ‚ÄúLast Recorded‚Äù timestamps for values ‚Äã‚Äãthat correspond to their counterparts in Windows system files.  They are assigned the attributes of system and hidden files.  Thus, an illusion of some kind of ‚Äúsystemic‚Äù malicious files is created.  It is also worth noting that the decrypted in memory elements of the resource section are back encrypted after writing the files, which excludes their removal from the memory by any forensic analysis tools. <br><br>  <b>Stage 2</b> <br><br>  When an infected USB drive is inserted into a computer in an isolated enterprise network, <b>Win32 / USBStealer</b> will automatically install itself into the system.  This will happen when the autorun feature is enabled on this computer.  Let's call this computer, which works in an isolated air-gapped network, Computer B. As soon as <b>Win32 / USBStealer</b> gets control, it lists all the disks that are currently connected to the system, and, depending on the type of disk, uses a different pattern of its behavior. <br><br><ul><li>  If the detected disk is removable and is labeled as a desktop.in file located in the root of the disk (i.e., this detected drive was already present in the system with Internet connection), then the malicious program creates a directory in the root of this disk, where the name is the computer name.  This operation allows operators to distinguish between computers into which an infected drive has been inserted.  Subsequently, this data will be used when sending data to the attacker's server, when the drive returns to Computer A connected to the Internet. </li><li>  If the disk is not removable, <b>Win32 / USBStealer</b> performs special preparation for the procedure of subsequent exfiltration (theft) of data. </li></ul><br>  The meaning of this last step is to group the files of interest in the malicious code into one local directory.  This step can be called preparatory to this exfiltration data.  It will happen as soon as the same removable drive is inserted into the USB port of Computer B. Once again, the types of files that are of interest to the malware are listed. <br><br><ul><li>  Files with the extensions ".skr", ".pkr" or ".key".  The first two refer to the PGP Desktop cryptographic files.  They store public and private encryption keys.  The third extension is often used by other cryptographic tools for storing similar keys. </li><li>  Files whose names match the list below.  We found two lists of such files, they are listed in the table below. </li></ul><br><img src="https://habrastorage.org/files/e08/8cb/bee/e088cbbeeaf54ed9a2887dce572461fb.png"><br><br>  The initial period of use is calculated based on the compilation date of the executables from which these lists were extracted.  We found very few references to most of these file names in open sources.  Perhaps because they belong to narrowly specialized software.  It is also interesting that the name Talgar (talgar.exe) coincides with the name of the city of Almaty region in the south-east of Kazakhstan. <br><br>  The malware looks for these files listed above everywhere on hard drives, except for directories that have the same name as the following anti-virus products: Symantec, Norton, McAfee, ESET Smart Security, AVG9, Kaspersky Lab, Doctor Web. <br><br>  <b>Stage 3</b> <br><br>  This step assumes that the user inserts the infected USB drive back into Computer A, after he has already been to the isolated Computer B at the second stage.  In this step, the malware component on computer A sends a set of <b>Win32 / USBStealer commands</b> that it must execute in step 4. To do this, the necessary commands are written into an encrypted file named <i>COMPUTER_NAME.in</i> in the drive root. <br><br>  <b>Stage 4</b> <br><br>  It is assumed that at the fourth stage, the same infected media will again get to Computer B. At the same time, instructions for the bot of the malicious program are already stored there, which it must execute.  At this stage, the files chosen by the attackers should be copied from the directory that was created on Computer B in the second stage (file grouping).  Then at the final stage they will be sent to the remote server of the attackers. <br><br>  At this stage, <b>Win32 / USBStealer</b> decrypts the batch file ( <i>COMPUTER_NAME.in</i> ), which was dropped to the root of the USB drive in the previous step.  This file contains commands that the bot must execute sequentially.  A command is identified by a two-byte identifier, followed by a command argument. <br><br><img src="https://habrastorage.org/files/ac6/16d/e3c/ac616de3c3314ae8a4a747e31d4ad728.png"><br><br>  Commands 0x0003 and 0x0005 operate with a special file that the malicious program creates on the local disk of Computer B. It contains templates of information about files in the format ‚ÄúRoot = Path = Day‚Äù.  Each time you boot Windows, <b>Win32 / USBStealer</b> executes the 0x0002 command for files from this list. <br><br>  The command 0x0008 is used to detect files that may be of interest to attackers.  We can assume that the attackers start the attack with this command, and then use the 0x0002 and 0x0003 commands to collect data. <br><br>  For teams that perform operations to copy files to removable media, a special backup method is provided.  If the malware cannot copy files to the media, for example, it is write-protected, the files will be copied to a special directory on the local disk.  In the future, the malicious code will try to copy them from there when another infected media is connected. <br><br>  <b>Stage 5</b> <br><br>  At this stage, the infected USB drive again goes to Computer A. The malicious program then transfers the files copied from Computer B to the remote server. <br><br>  <b>Conclusion</b> <br><br>  The <b>Win32 / USBStealer malware</b> shows the specific targeting of the Sednit group intruders towards corporate users of air-gapped networks.  We also noticed the following interesting features: <br><br><ul><li>  <b>The operation has been going on for almost 10 years.</b>  We detected a file with a malware compilation date of May 2005, as shown in the screenshot below.  The date the file was compiled also corresponds to the version of the compiler that was used to compile the file at that time.  Other malware files that were detected also have realistic compilation dates, which allows us to say that this data is not fake. </li><li>  <b>The obvious focus of the attack.</b>  As we have already mentioned, the names and extensions of files used to steal, let us speak about the obvious focus of this attack. </li></ul><br><br><img src="https://habrastorage.org/files/2b4/f29/6eb/2b4f296eb7c34cd98ffbc0ba1aa3625e.png"><br>  Fig.  Compilation date of the malicious file (Timestamp). <br><br>  Some questions are still open.  For example, in what specific way did the initial infection by Computer A malware occur. We can assume that phishing messages were used for this.  It may be noted that the FireEye report about this group mentioned by us at the beginning of the material contains information about the campaign for sending phishing messages.  In this case, the messages indicated the following text: "USB storage.". </div><p>Source: <a href="https://habr.com/ru/post/243309/">https://habr.com/ru/post/243309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243295/index.html">ReactOS 0.3.17 - ‚Äúnumerological‚Äù release of the operating system</a></li>
<li><a href="../243297/index.html">My first Eclipse plugin</a></li>
<li><a href="../243301/index.html">Loading Eloquent links using left join instead of additional requests</a></li>
<li><a href="../243305/index.html">Creating plug-ins for AutoCAD using the .NET API (Part 2 - Working with Ribbon [Ribbon])</a></li>
<li><a href="../243307/index.html">Tips for a novice entrepreneur from Oliver Amberton</a></li>
<li><a href="../243311/index.html">Expressive javascript: javascript and browser</a></li>
<li><a href="../243313/index.html">7 reasons why Dropbox grows to $ 4 billion</a></li>
<li><a href="../243315/index.html">Stability as a result</a></li>
<li><a href="../243321/index.html">One-liner to compile Lua templates</a></li>
<li><a href="../243323/index.html">Mobile Pwn2Own 2014: results</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>