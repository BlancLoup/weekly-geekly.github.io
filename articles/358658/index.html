<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating Destructive Meshes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Part 1. Introducing the Marching cubes 
 How to create a mesh from any chaos 
 In Minecraft, we can dig in any direction, removing one block at a time...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating Destructive Meshes</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c7/7b2/9b1/3c77b29b1504dbef18c4d531c395fae9.png" alt="image"></div><br><h2>  Part 1. Introducing the Marching cubes </h2><br>  <em>How to create a mesh from any chaos</em> <br>  In Minecraft, we can dig in any direction, removing one block at a time with clearly defined edges.  But in other games, developers manage to destroy the relief smoothly, without the cubicity of Minecraft. <br><br>  Here is an example from <a href="https://www.nomanssky.com/">No Man's Sky</a> : <a href="">video</a> . <br><br>  A similar technique is used to display <a href="https://www.youtube.com/watch%3Fv%3DOS9NtvCnnBk">images from MRI</a> , <a href="https://en.wikipedia.org/wiki/Metaballs">metaballs,</a> and voxelization of the relief. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this part I will talk about the technique of creating the crumbling relief of the Marching Cubes, and in a more general application - to create a smooth boundary mesh of a solid object.  In this article we will start with a two-dimensional technique, then a three-dimensional, and in the third part we will consider Dual Contouring.  Dual Contouring is a more advanced technique that creates the same effect. <br><a name="habracut"></a><br><h2>  Our goal </h2><br>  To begin with, we will decide on what we want to achieve.  Suppose we have a function that can be discretized over the whole space, and we want to plot its boundary on the graph.  In other words, determine where the function performs the transition from positive to negative and vice versa.  In the example with a destructible relief, we will interpret the positive areas as solid and the negative areas as empty. <br><br>  A function is a great way to describe an arbitrary shape.  but it does not help us draw it. <br><br>  To draw, we need to know its <strong>boundary</strong> , for example, the points between positive and negative values, where the function intersects zero.  The Marching Cubes algorithm takes such a function and creates a polygonal approximation of its boundary, which can be used for rendering.  In 2d, this boundary will be a continuous line.  When you go to 3d, it becomes a mesh. <br><br><h2>  Implementation of two-dimensional marching cubes </h2><br>  <strong>Note:</strong> this tutorial focuses more on concepts and ideas than on implementation methods and code.  If you are more interested in the implementation, then examine the <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/marching_cubes_2d.py">code in python</a> , which contains the commented code with all necessary. <br><br>  For simplicity, let's start with 2d, and later move on to 3d.  I will call algorithms in 2d and in 3d ‚ÄúMarching Cubes‚Äù, because in essence they are one algorithm. <br><br><h3>  Step 1 </h3><br>  First, we divide the space into a uniform grid of squares (cells).  Then, for each cell, we can use the function calculation to determine whether each vertex of the cell is inside or outside a solid region. <br><br>  Below is a function describing a circle, and black dots mark all vertices whose coordinates are positive. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/43c/a83/5eb/43ca835eb8d5b929caa087e486f604b3.svg"></div><br><h3>  Step 2 </h3><br>  Then we process each cell separately, filling it with the appropriate boundary. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2db/d22/400/2dbd224007509414d197902fef47a2b7.svg"></div><br>  A simple <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/marching_cubes_2d.py">lookup table</a> provides 16 possible combinations of angles, either outside or inside.  In each case, it determines which border should be drawn. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/404/214/092/404214092cf2f31e96b3b6f2a267c622.svg"></div><br>  <i>All combinations of two-dimensional marching cubes</i> <br><br><h3>  Step 3 </h3><br>  After repeating the process for all the cells, the boundaries are connected, creating a ready mesh, even though each cell was considered independently. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/58b/f3f/2b6/58bf3f2b675936851dffd3305e1ff007.svg"></div><br>  Fine!  I think this <em>is generally</em> similar to the original circle described by the formula.  But as you can see, it is all broken, and the segments are located at angles of 45 degrees.  This happened because we decided to select the vertices of the borders (red squares) equidistant from the cell points. <br><br><h2>  Adaptability </h2><br>  The best way to get rid of angles of 45 degrees is an <strong>adaptive</strong> algorithm for marching cubes.  Instead of simply specifying all the vertices of the borders from the central points of the cells, they can be positioned so that they best fit the solid region.  For this we need not only to know whether the point is inside or outside;  we also need to know <em>how deep it is</em> . <br><br>  This means that we need some function that gives us a measure of how deep the point is inside / outside.  It does not have to be exact, because we only use it for approximations.  In the case of our ideal circle, which has a radius of 2.5 units, we apply the <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/marching_cubes_2d.py">following function</a> . <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">f</span><span class="MJXp-mo" id="MJXp-Span-3" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">x</span><span class="MJXp-mo" id="MJXp-Span-5" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">y</span><span class="MJXp-mo" id="MJXp-Span-7" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-8" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-9">2.5</span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-11">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-12">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15">t</span><span class="MJXp-mrow" id="MJXp-Span-16"><span class="MJXp-msubsup" id="MJXp-Span-17"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-19" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-20" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-23" style="vertical-align: 0.5em;">2</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="27.586ex" height="3.021ex" viewBox="0 -987.6 11877.1 1300.8" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-2C" x="1512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-79" x="1957" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-29" x="2455" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-3D" x="3122" y="0"></use><g transform="translate(4178,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-2212" x="5680" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-73" x="6931" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-71" x="7400" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-72" x="7861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-74" x="8312" y="0"></use><g transform="translate(8674,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="809" y="583"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-2B" x="1248" y="0"></use><g transform="translate(2249,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-79" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="706" y="583"></use></g></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> f (x, y) = 2.5 - \ sqrt {x ^ 2 + y ^ 2} </script></p><br>  In which positive values ‚Äã‚Äãare inside, and negative values ‚Äã‚Äãare outside. <br><br>  Then we can use numerical values. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.279ex" height="2.419ex" viewBox="0 -780.1 550.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> f </script>  on either side of the face, to <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/common.py">determine how far along the face you need to position the point</a> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/19c/cfe/2a4/19ccfe2a41380807c5138b47bc39f934.svg"></div><br>  If you put everything together, it will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/873/35f/b4c/87335fb4c80519b5c6bd5c47d3202b17.svg"></div><br>  Despite the fact that we have the same vertices and segments as before, a slight change in position makes the resulting shape much more like a circle. <br><br><h2>  Part 2. Three-dimensional Marching Cubes </h2><br>  So, in 2D, we divide the space into a grid, and then for each vertex of the cell, we calculate where this point is - inside or outside the solid region.  In a 2d grid, each square has 4 corners, and for each of them there are two options, that is, each cell exists <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-mn" id="MJXp-Span-27">2</span><span class="MJXp-mtext" id="MJXp-Span-28">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-30">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-33">s</span><span class="MJXp-mn" id="MJXp-Span-34">2</span><span class="MJXp-mtext" id="MJXp-Span-35">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-40">s</span><span class="MJXp-mn" id="MJXp-Span-41">2</span><span class="MJXp-mtext" id="MJXp-Span-42">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-43">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">s</span><span class="MJXp-mn" id="MJXp-Span-48">2</span><span class="MJXp-mo" id="MJXp-Span-49" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msubsup" id="MJXp-Span-50"><span class="MJXp-mn" id="MJXp-Span-51" style="margin-right: 0.05em;">2</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-52" style="vertical-align: 0.5em;">4</span></span><span class="MJXp-mo" id="MJXp-Span-53" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-54">16</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="34.7ex" height="2.419ex" viewBox="0 -935.7 14940 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-74" x="750" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-69" x="1112" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-6D" x="1457" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-65" x="2336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-73" x="2802" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="3272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-74" x="4022" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-69" x="4384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-6D" x="4729" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-65" x="5608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-73" x="6074" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="6544" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-74" x="7294" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-69" x="7656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-6D" x="8001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-65" x="8880" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-73" x="9346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="9816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-3D" x="10594" y="0"></use><g transform="translate(11650,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-34" x="707" y="557"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-3D" x="12882" y="0"></use><g transform="translate(13939,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-31"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-36" x="500" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-3"> 2 \ times 2 \ times 2 \ times 2 = 2 ^ 4 = 16 </script>  possible combinations of angle states. <br><br>  Then we fill the cell with our own segment for each of the 16 cases, and all the segments of all the cells are naturally joined together.  We use <strong>adaptability</strong> to best fit these segments to the target surface. <br><br>  <em>The good news</em> is that in the three-dimensional case, everything works almost the same.  We divide the space into a grid of cubes, consider them separately, draw some edges for each cube, and they are connected, creating the desired mesh border. <br><br>  <em>The bad news</em> is that the cube has 8 angles, that is, there is <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-55"><span class="MJXp-msubsup" id="MJXp-Span-56"><span class="MJXp-mn" id="MJXp-Span-57" style="margin-right: 0.05em;">2</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-58" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-59">8</span></span></span><span class="MJXp-mo" id="MJXp-Span-60" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-61">256</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.803ex" height="2.419ex" viewBox="0 -935.7 3790 1041.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-38" x="707" y="557"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-3D" x="1232" y="0"></use><g transform="translate(2288,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-32"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-35" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-36" x="1001" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-4"> 2 ^ {8} = 256 </script>  possible cases under consideration.  And some of these cases are much more complex than in 2D. <br><br>  <em>The very good news</em> is that we absolutely do not need to understand this.  You can simply copy the <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/marching_cubes_3d.py">cases I have collected</a> and go directly to the results section (‚ÄúPutting It All Together‚Äù), without thinking about all the difficulties.  And then start reading about dual contouring, if you need a more powerful technique. <br><br><h2>  All difficulties </h2><br>  <strong>Note:</strong> this tutorial focuses more on concepts and ideas than on implementation methods and code.  If you are more interested in the implementation, then study the <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/marching_cubes_3d.py">implementation in 3D on python</a> , which contains commented code with all necessary. <br><br>  Are you still reading?  Great, I like that. <br><br>  The secret is that we are not really <em>obligated</em> to collect all 256 different cases.  Many of them are mirror reflections or turns of each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6b2/82b/580/6b282b580def7a8cbb4d0de1c817c3d9.png"></div><br>  Here are three different cases of cells.  The red corners are solid, all others are empty.  In the first case, the bottom corners are solid, and the top corners are empty, therefore, to correctly draw the dividing border, it is necessary to divide the cell vertically.  For convenience, I painted the outer side of the border yellow, and the inside - blue. <br><br>  The remaining two cases can be found by simply turning the first case. <br><br>  We can use another trick: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/956/d69/56f/956d6956ff2470d5f6c33d968d231fd4.png"><br>  These two cases are <em>opposite to</em> each other - the solid corners of one are empty of the other, and vice versa.  We can easily generate one case from another - they have the same border, only inverted. <br><br>  Given all this, in fact, we need to consider only 18 cases from which we can generate all the rest. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f6b/f88/352/f6bf88352eae823b2fcd2bcf57f0db3a.png"></div><br><h2>  The only reasonable person </h2><br>  If you read the <a href="https://en.wikipedia.org/wiki/Marching_cubes">article on Wikipedia</a> or most of the tutorials on the Marching Cubes, then they say that only 15 cases are needed.  How so?  Well, actually this is true - the three lower cases from my scheme are not necessarily necessary.  Here again these three cases in comparison with other cases opposite to them, giving a similar surface. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/add/b42/381/addb42381c1242535727dec5a451bafe.svg"></div><br>  Both the second and third columns correctly separate solid angles from empty ones.  But only when we consider one cube separately.  If you look at the edges of each face of a cell, you can see that they are different for the second and third columns.  Inverted will not properly connect with adjacent cells, leaving holes in the surface.  After adding three extra cases, all the cells are correctly connected. <br><br><h2>  We put everything together </h2><br>  As in the two-dimensional case, we can simply process all cells independently.  Here is a spherical mesh created from the Marching Cubes. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/i8PYBO3q8yA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  As you can see, the shape of the sphere as a whole is done correctly, but in some parts there is a chaos of narrow generated triangles.  You can solve this problem with the Dual Contouring algorithm, which is more advanced than the Marching Cubes. <br><br><h2>  Part 3. Dual Contouring </h2><br>  Marching Cubes are easy to implement, so they are often used.  But the algorithm has many problems: <br><br><ol><li>  Complexity.  Even though we only need to process one cube at a time, the Marching Cubes, as a result, turn out to be quite difficult, because it is necessary to consider many different cases. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3c7/7b2/9b1/3c77b29b1504dbef18c4d531c395fae9.png"></div></li><li>  Uncertainty.  Some cases in Marching Cubes cannot be resolved in an obvious way in one way or another.  If in 2d we have two opposite corners, then it is impossible to say whether they should connect or not. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f97/196/3cd/f971963cda96c53af74f5d343156db5c.svg"></div><br>  In 3d, the problem is further aggravated, because an uncoordinated sequence of elections can create a leaky mesh.  In the second part, we had to write additional code to solve this problem. </li><li>  Marching Cubes cannot create sharp edges and corners.  Here is a square, approximated by the Marching Cubes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/290/b0a/ee0/290b0aee0dd90fb6ed938aa36458a0fa.svg"></div><br>  The corners were cut off.  Adaptability cannot help here - Marching Squares always create straight line segments within any cell where the angle of the target square is. </li></ol><br>  What do we do? <br><br><h2>  Dual Contouring appears on stage </h2><br>  <strong>Note:</strong> this tutorial focuses more on concepts and ideas than on implementation methods and code.  If you are more interested in the implementation, then examine the implementation in python, which contains the commented code with all necessary ( <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/dual_contour_2d.py">2d</a> and <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/dual_contour_3d.py">3d</a> ). <br><br>  Dual Contouring solves these problems and is much more expandable.  Its disadvantage is that we need even more information about <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63">f</span><span class="MJXp-mo" id="MJXp-Span-64" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65">x</span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.418ex" height="2.66ex" viewBox="0 -832 1902 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-29" x="1512" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> f (x) </script>  , that is, a function that determines what is solid and empty.  We need to know not only the value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">f</span><span class="MJXp-mo" id="MJXp-Span-69" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">x</span><span class="MJXp-mo" id="MJXp-Span-71" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.418ex" height="2.66ex" viewBox="0 -832 1902 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-78" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-29" x="1512" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> f (x) </script>  but also gradient <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-72"><span class="MJXp-msup" id="MJXp-Span-73"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74" style="margin-right: 0.05em;">f</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-75" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mo" id="MJXp-Span-76" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-77">x</span><span class="MJXp-mo" id="MJXp-Span-78" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.144ex" height="2.66ex" viewBox="0 -832 2214.9 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-2032" x="804" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-28" x="863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-78" x="1252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMAIN-29" x="1825" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> f '(x) </script>  .  This additional information will improve adaptability compared to marching cubes. <br><br>  Dual Contouring places one vertex into each cell, and then ‚Äúconnects the dots‚Äù, creating a full mesh.  The points are joined along each edge that has a change of sign, as in the marching cubes. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e77/e37/809/e77e37809d7847833cc459993c554341.svg"></div><br>  <strong>Note: the</strong> word "dual" ("dual") in the name appeared because the cells in the grid become the vertices of the mesh, which connects us with the <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B2%25D0%25BE%25D0%25B9%25D1%2581%25D1%2582%25D0%25B2%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584"><strong>dual graph</strong></a> . <br><br>  Unlike the Marching Cubes, we cannot calculate cells individually.  In order to ‚Äúconnect the dots‚Äù and find the full mesh, we must consider the neighboring cells.  But in fact, it is a much <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/dual_contour_3d.py">simpler algorithm</a> than Marching Cubes, because there are no many individual cases.  We simply find each edge with a change of sign and connect the vertices of the cells adjacent to this edge. <br><br><h2>  Getting gradient </h2><br>  In our simple example with a 2d circle of radius 2.5 <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-79"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.279ex" height="2.419ex" viewBox="0 -780.1 550.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/358658/&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhjNyrIaXybO7JUeR08tNQJ8JZj-3A#MJMATHI-66" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> f </script>  is set as follows: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-81"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82">f</span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84">x</span><span class="MJXp-mo" id="MJXp-Span-85" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86">y</span><span class="MJXp-mo" id="MJXp-Span-87" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-88" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-89">2.5</span><span class="MJXp-mo" id="MJXp-Span-90" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mtext" id="MJXp-Span-91">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95">t</span><span class="MJXp-mrow" id="MJXp-Span-96"><span class="MJXp-msubsup" id="MJXp-Span-97"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-98" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-99" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-103" style="vertical-align: 0.5em;">2</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-9"> f (x, y) = 2.5 - \ sqrt {x ^ 2 + y ^ 2} </script></p><br>  (in other words, 2.5 minus the distance from the center point) <br><br>  Using the differential calculus, we can calculate the gradient: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-104"><span class="MJXp-msup" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106" style="margin-right: 0.05em;">f</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-107" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mo" id="MJXp-Span-108" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">x</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">y</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-114">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-115">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-117">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-118">t</span><span class="MJXp-mrow" id="MJXp-Span-119"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">c</span><span class="MJXp-mn" id="MJXp-Span-123">2</span></span><span class="MJXp-mtext" id="MJXp-Span-124">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-125">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-128">t</span><span class="MJXp-mo" id="MJXp-Span-129" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-130">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-131">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-133">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-134">c</span><span class="MJXp-mrow" id="MJXp-Span-135"><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-137">x</span></span><span class="MJXp-mrow" id="MJXp-Span-138"><span class="MJXp-mtext" id="MJXp-Span-139">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-140">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-141">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-142">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">t</span><span class="MJXp-mrow" id="MJXp-Span-144"><span class="MJXp-msubsup" id="MJXp-Span-145"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-147" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-149"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-150" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-151" style="vertical-align: 0.5em;">2</span></span></span></span><span class="MJXp-mo" id="MJXp-Span-152" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-153">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-154">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">c</span><span class="MJXp-mrow" id="MJXp-Span-158"><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">y</span></span><span class="MJXp-mrow" id="MJXp-Span-161"><span class="MJXp-mtext" id="MJXp-Span-162">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">t</span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-msubsup" id="MJXp-Span-168"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-169" style="margin-right: 0.05em;">x</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-170" style="vertical-align: 0.5em;">2</span></span><span class="MJXp-mo" id="MJXp-Span-171" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-msubsup" id="MJXp-Span-172"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173" style="margin-right: 0.05em;">y</span><span class="MJXp-mn MJXp-script" id="MJXp-Span-174" style="vertical-align: 0.5em;">2</span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-175">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-176">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-177">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">t</span><span class="MJXp-mo" id="MJXp-Span-181" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> f '(x, y) = \ text {Vec2} \ left (\ frac {-x} {\ sqrt {x ^ 2 + y ^ 2}}, \ frac {-y} {\ sqrt {x ^ 2 + y ^ 2}} \ right) </script></p><br>  A gradient is a pair of numbers for each point, indicating how much the function changes as it moves along the x or y axis. <br><br>  But to obtain the gradient function, we do not need complex calculations.  We can just measure change <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-182"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-183">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> f </script>  when <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-184"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">x</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> x </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-186"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">y</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> y </script>  deviate by a small amount <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-188"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> d </script>  . <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-190"><span class="MJXp-msup" id="MJXp-Span-191"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-192" style="margin-right: 0.05em;">f</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-193" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mo" id="MJXp-Span-194" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-195">x</span><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-197">y</span><span class="MJXp-mo" id="MJXp-Span-198" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mtext" id="MJXp-Span-199">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-201">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-202">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-204">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205">x</span><span class="MJXp-mtext" id="MJXp-Span-206">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-207">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-208">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">t</span><span class="MJXp-mrow" id="MJXp-Span-211"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">V</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-214">c</span><span class="MJXp-mn" id="MJXp-Span-215">2</span></span><span class="MJXp-mtext" id="MJXp-Span-216">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">l</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">t</span><span class="MJXp-mo" id="MJXp-Span-221" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mtext" id="MJXp-Span-222">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226">c</span><span class="MJXp-mrow" id="MJXp-Span-227"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-228">f</span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-230">x</span><span class="MJXp-mo" id="MJXp-Span-231" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-232">d</span><span class="MJXp-mo" id="MJXp-Span-233" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-234">y</span><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-237">f</span><span class="MJXp-mo" id="MJXp-Span-238" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">x</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-240">d</span><span class="MJXp-mo" id="MJXp-Span-241" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242">y</span><span class="MJXp-mo" id="MJXp-Span-243" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mrow" id="MJXp-Span-244"><span class="MJXp-mn" id="MJXp-Span-245">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-246">d</span></span><span class="MJXp-mo" id="MJXp-Span-247" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-248">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-250">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-251">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252">c</span><span class="MJXp-mrow" id="MJXp-Span-253"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-254">f</span><span class="MJXp-mo" id="MJXp-Span-255" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256">x</span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258">y</span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260">d</span><span class="MJXp-mo" id="MJXp-Span-261" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-263">f</span><span class="MJXp-mo" id="MJXp-Span-264" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">x</span><span class="MJXp-mo" id="MJXp-Span-266" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267">y</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268">d</span><span class="MJXp-mo" id="MJXp-Span-269" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-mrow" id="MJXp-Span-270"><span class="MJXp-mn" id="MJXp-Span-271">2</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-272">d</span></span><span class="MJXp-mtext" id="MJXp-Span-273">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-274">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-275">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-276">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-277">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-278">t</span><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-15"> f '(x, y) \ approx \ text {Vec2} \ left (\ frac {f (x + d, y) - f (xd, y)} {2d}, \ frac {f (x, y + d) - f (x, yd)} {2d} \ right) </script></p><br>  It will work for any smooth <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-280"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-281">f</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> f </script>  if selected <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-282"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-283">d</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> d </script>  quite a few.  In practice, it turns out that even functions with sharp points turn out to be fairly smooth, because in order for this to work, it is not necessary to calculate the gradient near sharp sections.  <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/dual_contour_2d.py">Link to code</a> . <br><br><h2>  Adaptability </h2><br>  While we got the same stepped view, which was the Marching Cubes.  We need to add adaptability.  In the Marching Cubes algorithm, we chose where the vertex will be along the edge.  Now we can freely choose any point of the internals of the cell. <br><br>  We want to choose the point that most closely matches the information we received, i.e.  calculated value <p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-284"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-285">f</span><span class="MJXp-mo" id="MJXp-Span-286" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-287">x</span><span class="MJXp-mo" id="MJXp-Span-288" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-18"> f (x) </script></p>  and gradient.  Notice that we sampled the gradient along the edges, not in the corners. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ba6/12d/7a9/ba612d7a9b4fab613a9d6f55a007ea37.svg"></div><br>  Choosing the shown point, we guarantee that the displayed faces of this cell will correspond to the normals as much as possible: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a1/0d2/854/5a10d2854a7f55b187b15b5f27ae9492.svg"></div><br>  In practice, not all the normals in the cell will fit.  We need to choose the most suitable point.  In the last section I will tell you how to choose this point. <br><br><h2>  Go to 3d </h2><br>  The cases in 2D and in 3d are not really very different.  The cell is now a cube, not a square.  We draw faces, not edges.  But the differences end there.  The procedure for selecting a single point in the cell looks the same.  And we still find the edges with a change of sign, and then we connect the points of neighboring cells, but now four cells, which gives us a four-sided polygon: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b3f/2b7/1b6/b3f2b71b6ff1b5c4f5f6815c6906347f.png"></div><br>  <i>The face associated with a separate edge.</i>  <i>She has points in each adjacent cell.</i> <br><br><h2>  results </h2><br>  Dual contouring creates much more natural shapes than marching cubes, which can be seen in the sphere created with it: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/wXmIQfTC0rU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  In 3d, this procedure is reliable enough to select points located along the edge of a sharp section and the choice of angles when they occur. <br><br><div style="text-align:center;"> <a href="http://jamesgregson.blogspot.co.uk/2011/04/dual-contouring.html"><img src="https://habrastorage.org/getpro/habr/post_images/c44/3e2/b8d/c443e2b8d46a72fcc013bb4250c0eeec.png"></a> </div><br><h2>  Choosing a vertex location </h2><br>  A serious problem that I had previously ignored is the choice of the location of a point when the normals do not point to the same place. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/07c/1c2/5ed/07c1c25ed35892ad54acf289d7b57a19.png"></div><br>  In 3d, the problem is even more aggravated, because here there are more normals. <br><br>  The solution is to select a point that is mutually best for all normals. <br><br>  At first, for each normal, we assign a penalty for places remote from the ideal.  Then we summarize all the penalty functions, which gives us a penalty in the form of an ellipse.  After that we select the point with the smallest penalty. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/94b/a79/ef8/94ba79ef8761775ddc69482fd1bbca0a.png"></div><br>  From a mathematical point of view, the individual penalty functions are the square of the distance from the ideal line for the current normal.  The sum of all square members is a <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B2%25D0%25B0%25D0%25B4%25D1%2580%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2584%25D1%2583%25D0%25BD%25D0%25BA%25D1%2586%25D0%25B8%25D1%258F">quadratic function</a> , so the total penalty function is called a <strong>QEF</strong> (quadratic error function, quadratic error function).  Finding the minimum point of a quadratic function is a standard procedure found in most matrix work libraries. <br><br>  In my <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/qef.py">python implementation,</a> I used the <a href="https://docs.scipy.org/doc/numpy-1.14.0/reference/generated/numpy.linalg.lstsq.html">lstsq</a> function from numpy. <br><br><h2>  Problems </h2><br><h3>  Collinear normals </h3><br>  Most tutorials stop there, but the algorithm has a small dirty secret - the QEF solution in accordance with the description in the original article on Dual Contouring actually does not work very well. <br><br>  Having solved the QEF, we can find the point that most closely matches the function normals.  But in reality there <strong>are no guarantees that the resulting point is inside the cell</strong> . <br><br>  In fact, quite often it is outside when we work with large flat surfaces.  In this case, all the sampled normals will be the same or very close, as in this figure. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e6d/19f/ce9/e6d19fce95619645e540a03e4369ed96.svg"></div><br>  I have seen many tips for solving this problem.  Some people gave up, discarding the gradient information and using instead the center of the cell or the average of the positions of the borders.  This is called Surface Nets, and in this solution, at least, there is simplicity. <br><br>  But based on my experience, I recommend using a combination of two techniques. <br><br><h4>  Technique 1: QEF Restricted Solution </h4><br>  Do not forget that we found the point of the cell, finding the point that minimizes the value of the given function, called QEF.  By making small changes, we can find a minimizing point <em>inside the</em> cell. <br><br><h4>  Technique 2: QEF Offset </h4><br>  We can add any quadratic function to QEF and get another quadratic function that will be solved anyway.  Therefore, I added a quadratic function that has a minimum point in the center of the cell. <br><br>  Thanks to this, the entire QEF solution is pulled to the center. <br><br>  In fact, this has a greater effect when the normals are collinear and most likely will give poor results, but have little effect on positions in a good case. <br><br>  The use of both techniques is rather redundant, but it seems to me that it gives the best visual results. <br><br>  More details on both techniques are shown in the <a href="https://github.com/BorisTheBrave/mc-dc/blob/a165b326849d8814fb03c963ad33a9faf6cc6dea/qef.py">code</a> . <br><br><h3>  Self-crossing </h3><br>  Another dual contouring problem is that it can sometimes generate a self-intersecting 3d surface.  In most cases, this is not paid attention, so I did not solve this problem. <br><br>  There is an article that tells about her decision: <a href="http://www.cs.wustl.edu/~taoju/research/interfree_paper_final.pdf">"Intersection-free Contouring on An Octree Grid", Ju and Udeshi, 2006</a> <br><br><h3>  Uniformity </h3><br>  Although the resulting dual contouring mesh is always sealed, the surface is not always well defined.  Since the cell has only one point, when two surfaces pass through the cell, it will be common to them.  This is called a ‚Äúhomogeneous‚Äù mesh and can cause problems with some texturing algorithms.  The problem often arises when solid objects are thinner than the size of a cell or several objects almost touch each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fcf/45a/815/fcf45a815d72af06e00754ec0e2227c3.svg"></div><br>  The handling of such cases is a significant expansion of the functionality of the base Dual Contouring.  If you need this function, I recommend to study <a href="https://github.com/Lin20/isosurface">this implementation of Dual Contouring</a> or <a href="http://faculty.cs.tamu.edu/schaefer/research/dualsimp_tvcg.pdf">this article.</a> <br><br><h2>  Algorithm extension </h2><br>  Due to the relative simplicity of creating Dual Contouring meshes, it is much easier to expand to work with cell diagrams that differ from the standard grids discussed above.  As a rule, the algorithm can be performed for <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25BA%25D1%2582%25D0%25BE%25D0%25B4%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B2%25D0%25BE">octree trees</a> in order to obtain different cell sizes exactly where details are needed.  In general, the idea is similar - we select by a point on a cell using sampled normals, then for each edge with a change of sign we find neighboring 4 cells and combine their vertices to the face.  In octree, you can use recursion to find these edges and neighboring cells.  Matt Keater has a <a href="https://www.mattkeeter.com/projects/contours/">detailed tutorial</a> on this. <br><br>  Another interesting extension is that for Dual Contouring we need only a definition of what is inside / outside and the corresponding normals.  Although I said that we have a function to do this, we can extract the same information from another mesh.  This allows us to perform a ‚Äústrap‚Äù, i.e.  generate a clean set of vertices and edges clearing the source mesh.  An example is the Blender <a href="https://docs.blender.org/manual/de/dev/modeling/modifiers/generate/remesh.html">remesh modifier</a> . <br><br><h1>  Additional reading </h1><br><ul><li>  <a href="https://github.com/BorisTheBrave/mc-dc/tree/master">Adjacent code</a> </li><li>  <a href="http://www.frankpetterson.com/publications/dualcontour/dualcontour.pdf">Original article - Dual Contouring of Hermite Data - Tao Ju, Frank Losasso, Scott Schaefer, Joe Warren</a> </li><li>  Dual Contouring is one of many similar techniques.  See other approaches with their pros and cons in <a href="https://swiftcoder.wordpress.com/planets/isosurface-extraction/">the SwiftCoder list</a> . </li></ul></div><p>Source: <a href="https://habr.com/ru/post/358658/">https://habr.com/ru/post/358658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358646/index.html">Security Week 17: Rise of the Machines</a></li>
<li><a href="../358648/index.html">How we invented the OTDR</a></li>
<li><a href="../358650/index.html">The mechanism of Arbitrary Code Guard (ACG) on the example of Microsoft Edge</a></li>
<li><a href="../358654/index.html">Parsing 0.5Tb xml in a few hours. Search for organizations in the open data of the register of SMEs of the Federal Tax Service</a></li>
<li><a href="../358656/index.html">Welcome to Java Meetup at Raiffeisenbank UPD Broadcast</a></li>
<li><a href="../358660/index.html">Open broadcast of the main hall of HolyJS</a></li>
<li><a href="../358662/index.html">Safe car sharing: components, main problems and Yandex competition</a></li>
<li><a href="../358664/index.html">Correction of typos, side view</a></li>
<li><a href="../358668/index.html">How to learn anything?</a></li>
<li><a href="../358670/index.html">Laser hair removal for a virtual server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>