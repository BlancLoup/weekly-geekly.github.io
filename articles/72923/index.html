<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a basic wave robot in python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By the summer I got an invite to google sandbox. But there were a lot of people in this sandbox, all the waves were public, and my poor netbook only d...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a basic wave robot in python</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/07e/8e4/6ca/07e8e46cad6a50a5d76fcfe51ed0544c.jpg" alt="Glory to the robots"><br>  By the summer I got an invite to google sandbox.  But there were a lot of people in this sandbox, all the waves were public, and my poor netbook only digested all this activity with a big creak, so, after playing a little, I scored on a sandbox :) <br><br>  And just recently my account in the sendbox turned into a live account, and I, having sent invites to those I got to, and waited until at least one of my acquaintances received them, sat down to deal with the robot api. <br><a name="habracut"></a><br><br>  The result of the proceedings was such a basic robot: bakarobo@appsot.com, which is able to do nothing yet: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>on command! br: bor!</i>  <i>get a random quote from bash</i> <i><br></i>  <i>on the team! br: rb!</i>  <i>get a photo of the day with <a href="http://rosbest.ru/">rosbest</a></i> <i><br></i>  <i>on team! br: BakaRobo!</i>  <i>respond :)</i> <i><br></i>  <i>and swear in response to all unfamiliar commands.</i> <br><br>  And in the process of creation, I realized a funny thing: a large, cool apishka was developed for wave robots ... Virtually not documented at the moment :) At least, the reference for Python api is just a generic list of classes and functions, from which practically nothing is understood . <br><br>  And so, having spent some time reading different docks and samples, I, it seems to me, singled out some basic set of information necessary to make some kind of useful robot already.  I want to tell about all these necessary things, maybe not very well structured :) <br><br>  Let's start with the fact that robots should be placed on <a href="http://appspot.com/">Google App Engine</a> .  I will not tell you how to create an application there and download the toolkit for commits of the code - everything is very clearly explained there. <br><br>  So, we downloaded the tools, and in some folder on the disk, we had something like this: <br><br> <code>. <br> .. <br> google_appengine <br> our_robot <br></code> <br><br>  Where our_robot is the folder in which our robot will be located.  And in this folder we download and unpack <a href="">this</a> archiver from code.google.com - this is, in fact, a Python apish. <br><br>  Now we are ready for the actual development. <br><br>  <i>Just in case: the commit code in the appengin is done like this:</i> <i><br></i>  <i>python ./google_appengine/appcfg.py update ./our_robot/ - then we are asked about the password and password and give to fill in the file.</i> <br><br>  In the base case, there will be three main files in the project: <br><br><pre> our_robot.py - actually, the robot code
 app.yaml - something like a manifest
 _wave / capabilities.xml - a file announcing events that the robot wants to listen to.
</pre><br>  <b>Addition</b> from <a href="http://farcaller.habrahabr.ru/">farcaller</a> : <br>  <i>Python api xml-ku castati itself generates, on the basis of the arguments to robot.Robot, but you need to write to jaw pen with pens</i> . <br>  So, apparently, from the number of gestures in the development process can be waived. <br><br>  <i>The list of events can be found <a href="http://wave-robot-python-client.googlecode.com/svn/trunk/pydocs/toc-waveapi.events-module.html">here</a> , but the most important ones for the robot, in my opinion, are:</i> <i><br></i>  <i><b>WAVELET_SELF_ADDED</b> - triggered when the robot is added to the wave, at this moment it is good to show a little info on the use;</i> <i><br></i>  <i><b>BLIP_SUBMITTED</b> - triggered when a wave blip is created / edited, and not at the time of writing the text, but when the ‚ÄúDone‚Äù button is pressed.</i> <i><br></i> <br><br>  Let's go further. <br>  The manifest app.yaml looks, judging by the tutorial on code.google.com, like this: <br><br> <code>application: <b>our_robot</b> <br> version: <b>1</b> <br> runtime: python <br> api_version: 1 <br> handlers: <br> - url: /_wave/.* <br> script: <b>our_robot.py</b> <br> - url: /assets <br> static_dir: assets <br> - url: / <b>icon.png</b> <br> static_files: <b>icon.png</b> <br> upload: <b>icon.png</b> <br></code> <br><br>  Here, it seems, everything is clear.  The name of the robot, the version, what we launch, the version of api and handlers for different urls. <br><br>  The only thing you should pay attention to is "-url: /icon.png" in the handlers section.  This, it seems, is not present in the tutorial, the design allows you to specify the way to handle the robot icon.  We draw it in the png, save it to the folder of the robot, declare it inside the Python file :) <br><br>  capabilities.xml, again, on the tutorial, also looks straightforward: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="utf-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">w:robot</font> <font color="#ff0000">xmlns:w</font> <font color="#0000ff">="http://wave.google.com/extensions/robots/1.0"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">w:capabilities</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">w:capability</font> <font color="#ff0000">name</font> <font color="#0000ff">="WAVELET_SELF_ADDED"</font> <font color="#ff0000">content</font> <font color="#0000ff">="true"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">w:capability</font> <font color="#ff0000">name</font> <font color="#0000ff">="BLIP_SUBMITTED"</font> <font color="#ff0000">content</font> <font color="#0000ff">="true"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">w:capabilities</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">w:version</font> <font color="#0000ff">&gt;</font> 1 <font color="#0000ff">&lt;/</font> <font color="#800000">w:version</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">w:robot</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Actually, there‚Äôs really nothing to change in this file: only the version number and the events that we want to listen to. <br><br>  But after all this preliminary confusion has ended and, actually, quite pleasant fuss with writing of the Python code of the robot begins. <br><br>  To begin, I will describe the general structure of the code, as it is given in the examples and tutorial, and then distribute all sorts of minor utilities that are not in the tutorial, I still have to get to the reference in the reference, so I had to extract them from the examples. <br><br>  So, in general, the code for a robot blank looks like this: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">from</font> waveapi import events <br> <font color="#0000ff">from</font> waveapi <font color="#0000ff">import</font> model <br> <font color="#0000ff">from</font> waveapi <font color="#0000ff">import</font> robot <br> <font color="#A31515"><b>def</b></font> OnRobotAdded(properties, context): <br> pass <br> <font color="#A31515"><b>def</b></font> OnBlipSubmitted(properties, context): <br> pass <br> <font color="#0000ff">if</font> __name__ == <font color="#A31515">'__main__'</font> : <br> myRobot = robot.Robot( <font color="#A31515">'our_robot'</font> , <br> image_url= <font color="#A31515">'http://our_robot.appspot.com/icon.png'</font> , <font color="#0000ff">#   </font> <br> version= <font color="#A31515">'2.3'</font> , <font color="#0000ff">#</font> <br> profile_url= <font color="#A31515">'http://our_robot.appspot.com/'</font> ) <font color="#0000ff">#  </font> <br> <font color="#0000ff">#  :</font> <br> myRobot.RegisterHandler(events.WAVELET_SELF_ADDED, OnRobotAdded) <br> myRobot.RegisterHandler(events.BLIP_SUBMITTED, OnBlipSubmitted) <br> <font color="#0000ff"># </font> <br> myRobot.Run()</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  And it seems that everything is wonderful and clear.  But when you start writing the actual functions of events, you understand that it is completely unclear how, for example, to replace a piece of text with another piece of text, not to mention something to paint or emphasize. <br><br>  As a result of a not too long, but rather stubborn examination, I dug up a list of useful methods, which was enough for me to write a robot: <br><br>  First, in order to get the blip in the event-handling functions, with which the event occurred (if, of course, this event happened with the blip), we use <br>  <b>blip = context.GetBlipById (properties ['blipId'])</b> <br><br>  Secondly, to get the text of the blip and to operate with it, we do <br>  <b>doc = blip.GetDocument ()</b> <b><br></b>  <b>contents = doc.GetText ()</b> <br><br>  Accordingly, in order to replace some piece of text with another, use the resulting doc <br>  <b>doc.SetTextInRange (model.document.Range (BEGINNING, END), NEW_TEXT)</b> <br><br>  To paste a piece of text anywhere: <br>  <b>doc.InsertText (BEGIN, TEXT)</b> <br><br>  To add a piece of text to the end: <br>  <b>doc.AppendText (TEXT)</b> <br><br>  To insert a picture: <br>  At the end - <b>doc.AppendElement (model.document.Image (ADDRESS_KARTINKI, WIDTH, HEIGHT, ATTACHMENT_ID, ALT))</b> <br>  In a certain place - <b>doc.InsertElement (BEGINNING, model.document.Image (ADDRESS_KARTINKI, WIDTH, HEIGHT, ATTACHMENT_ID, ALT))</b> <br><br>  In general, it is useful to look at <a href="http://wave-robot-python-client.googlecode.com/svn/trunk/pydocs/waveapi.ops.OpBasedDocument-class.html">this</a> reference in order to find out what can be done with the document.  In order to find out the types of elements that can be created, look at the references to the waveapi.document. * - there is both Image, Link and even Gadget. <br><br>  Farther.  All design and various other utility blip stored in the so-called annotations.  It's simple with her: <br><br>  <b>doc.SetAnnotation (model.document.Range (BEGINNING, END), TYPE, VALUE)</b> <br><br>  Moreover, TYPE is the thing that describes what we add for the annotation.  The most important, IMHO, is the 'style / STYLE_PROP', where STYLE_PROP is the css attribute entry in the js form. <br>  <i><font color="#eeeeee">Suddenly, someone who does not know is a transformed css properties entry used in js scripts, it‚Äôs easier to show its essence with examples :) For example, color is just color, but font-size is fontSize.</font></i>  <i><font color="#eeeeee">In the sense, where there is a hyphen in css, there is no hyphen in this record, but every word except the first one begins with a capital letter.</font></i>  <i><font color="#eeeeee">backgroundColor, backgroundImage, marginTop, and so on.</font></i> <br><br>  They are cleaned just as plainly, you can stupidly kill all the annotations of the same type, for example, about the font color, or the background color, like this: <br><br>  <b>doc.DeleteAnnotationsByName (TYPE)</b> <br><br>  And you can only clear a certain range of text from annotations of a certain type: <br><br>  <b>doc.DeleteAnnotationsInRange (model.document.Range (BEGINNING, END), TYPE)</b> <br><br>  Annotations are also useful because you can store any info that relates to this blip in them. <br><br>  To annotate the whole blot, use: <br>  <b>doc.AnnotateDocument (TYPE, VALUE)</b> <br><br>  To find out if there is any type of annotation in the blip, call <br>  <b>doc.HasAnnotation (TYPE)</b> <br><br>  Somewhere around such a set, it seems to me, is already allowing to create robots that can do something useful.  Of course, beyond the scope of the text, for example, the use of the GAE database system and other pleasant things remain, but I hope the text will not be completely useless. <br><br>  <i>PS: By the way, I noticed a bug that greatly prevented the development at first: in the logs tab in the appspot (the only debug tool available to us), the level of messages displayed by default is set in Error.</i>  <i>Hochma is that if a log of a level first goes to a log entry, for example, Info, and only then a piece with an error, such a record will not be shown to us.</i>  <i>So - we rearrange the alert level on Debug and we are happy to have the opportunity to review all the errors that occurred.</i> <i><br><br></i>  <i>PPS: Thank you, moved to the appropriate blog.</i> <i><br></i> </div><p>Source: <a href="https://habr.com/ru/post/72923/">https://habr.com/ru/post/72923/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../72910/index.html">‚ÄúDemonoid is an ordinary client for us‚Äù: an interview with a Ukrainian pirate tracker provider</a></li>
<li><a href="../72913/index.html">Apple introduced updated iMac, Mac Book and Mac mini</a></li>
<li><a href="../72915/index.html">Zend Framework and magic quotes</a></li>
<li><a href="../72917/index.html">Apple is returning to using Twitter to promote content from the iTunes Store</a></li>
<li><a href="../72920/index.html">The script to automatically build qutIM from SVN for Linux</a></li>
<li><a href="../72924/index.html">Contests non stop!</a></li>
<li><a href="../72925/index.html">Configuring mysql for ssl replications (Debian, Ubuntu)</a></li>
<li><a href="../72927/index.html">Simplicity in good web design</a></li>
<li><a href="../72929/index.html">Multithreading, general data and mutexes</a></li>
<li><a href="../72930/index.html">Jeff Dean reveals Google secrets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>