<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Code "smell": automatic properties</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third post in the Poka-yoke design series - also known as encapsulation. 

 Automatic properties are one of the most redundant features in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Code "smell": automatic properties</h1><div class="post__text post__text-html js-mediator-article">  This is the third post in the <a href="http://habrahabr.ru/post/205086/">Poka-yoke design</a> series - also known as encapsulation. <br><br>  <a href="http://msdn.microsoft.com/en-us/library/bb384054.aspx">Automatic properties</a> are one of the most redundant features in C #.  I know that many people love them very much, but they solve a problem you don‚Äôt have to face. <br><a name="habracut"></a><br>  I absolutely agree that the code that looks like this is completely redundant: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre> <br>  However, the solution is not to rewrite this code as follows: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  The problem with the code in the first example is not its ceremoniality.  The problem is that it breaks encapsulation.  In fact <br><blockquote>  ‚Äú[...] getters and setters do not provide encapsulation or information hiding: they are a way of violating these principles, which is legalized by the programming language.‚Äù <br>  James O. Coplien &amp; Gertrud Bj√∏rnvig.  Lean Architecture.  Wiley.  2010. p.  134. </blockquote><br>  While I personally believe that automatic properties have their uses, I very rarely find them.  They are never suitable for reference types and are only rarely applicable in value types. <br><br>  <b>Code smell: automatic property of reference type</b> <br>  First of all, let's consider a very large set of properties that are disclosed by the reference type. <br>  In the case of reference types, the possible value is null.  However, considering the Poka-yoke design, null is never a suitable value, since it leads to a NullReferenceExceptions.  <a href="http://en.wikipedia.org/wiki/Null_Object_pattern">The Null Object</a> pattern is the best alternative to cope with situations where the value may be undefined. <br>  In other words, automatic properties like the Name property are never appropriate.  The setter must have some kind of protective expression in order to protect itself against the null value (and, possibly, against other non-valid values).  Here is a solid example: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-string"><span class="hljs-string">"value"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  Alternatively, the guard expression can also check for null and provide a default value: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  However, this implementation contains a <a href="http://en.wikipedia.org/wiki/Principle_of_least_astonishment">POLA</a> violation, because the getter sometimes returns values ‚Äã‚Äãother than the assigned ones.  You can correct this problem by adding an associated field of type Boolean, which indicates whether the name was assigned null, so that null could be returned from the setter in this exceptional case, but this leads to another ‚Äúsmell‚Äù in the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Code smell: automatic properties of value types</b> <br>  If the property type is a value type, the case becomes less clear, since the values ‚Äã‚Äãcannot accept null.  This means that nods never fit.  However, straightforward consumption of a value type may also not be appropriate.  In essence, <a href="http://blog.ploeh.dk/2011/05/25/DesignSmellPrimitiveObsession.aspx">it is only permissible for the class to intelligently accept and process any values ‚Äã‚Äãof this type.</a> <br>  If, for example, a class can actually work only with a certain subset of all possible values, a protective expression can be entered.  Consider an example: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RetryCount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  This property could be used to set the desired number of attempts to perform a given operation.  The problem is that the automatic property allows you to set a negative value, which is meaningless.  One possible solution is to add a protective expression: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> retryCount; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> RetryCount { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.retryCount; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException(); } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.retryCount = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } }</code> </pre><br>  However, in many cases, the disclosure of a property of a primitive type is most likely a case of ‚Äúobsession with primitives‚Äù. <br><br>  <b>Revised design: protective expression</b> <br>  As I described earlier, the fastest way to fix the problem with an automatic property is to implement a property with a protective expression.  This ensures that class invariants are properly encapsulated. <br><br>  <b>Revised design: value type property</b> <br>  When an automatic property is a value type, the implementation of a protective expression can still make sense.  However, when a property is a real symptom of ‚Äúprimitive obsession,‚Äù the best alternative is to introduce the correct value object. <br>  Consider, as an example, the following property: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Temperature { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; }</code> </pre><br>  This is a bad design for several reasons.  It is not related to the meaning of the unit of measurement and allows the assignment of unlimited values.  What happens if it is assigned to -100?  If the unit of measurement is Celsius, then everything is fine, but if - Kelvin, then there is an error.  Regardless of the unit of measurement, the attempt to assign an int.MinValue should fail. <br>  A more sustainable design could be achieved by introducing a new type of Temperature and by changing the type of property to the one entered.  In addition to protecting invariants, a new class could also encapsulate conversion between different temperature measures. <br>  However, if the value object is implemented as a reference type, the situation becomes equivalent to the situation described above and a null check is necessary.  The use of automatic properties is appropriate if the value object is implemented as a value type. <br>  Conclusion: automatic properties are rarely relevant.  In fact, they are valid only when the property type is a value type and all probable values ‚Äã‚Äãare valid.  Since there are several cases in which automatic properties are appropriate, their use cannot be completely excluded, but the need to use them should be considered as a reason for further investigation.  The use of automatic properties is a ‚Äúsmell‚Äù in the code, but not an anti-pattern. <br>  It is worth noting that the properties may also violate the <a href="http://en.wikipedia.org/wiki/Law_of_Demeter">law of Demeter</a> , but this is already a topic for a future post. </div><p>Source: <a href="https://habr.com/ru/post/205096/">https://habr.com/ru/post/205096/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205082/index.html">The results of one study: a minute of inactivity of the average data center costs $ 7900</a></li>
<li><a href="../205084/index.html">MacroGroovy - working with AST on Groovy has never been easier</a></li>
<li><a href="../205086/index.html">POKA-YOKE design: from ‚Äúsmell‚Äù to fragrance</a></li>
<li><a href="../205088/index.html">The "smell" of design: an obsession with primitives</a></li>
<li><a href="../205092/index.html">Friday post: phone case with airbags</a></li>
<li><a href="../205098/index.html">Design smell: excessive attribute Required</a></li>
<li><a href="../205100/index.html">Record Gain. Part 2</a></li>
<li><a href="../205102/index.html">Design Smell: Default Designer</a></li>
<li><a href="../205106/index.html">GCD calculation ‚Äî an error that is not noticed</a></li>
<li><a href="../205108/index.html">At the borders, applications are not object-oriented.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>