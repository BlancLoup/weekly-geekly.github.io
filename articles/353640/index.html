<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Checking the source C # Unity code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, a long-awaited event for many people happened - Unity Technologies has posted the original C # code of the Unity game engine for free downlo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Checking the source C # Unity code</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/70e/817/001/70e8170019af33fea1a37ce95ca778aa.png" alt="Picture 5"></p>  Recently, a long-awaited event for many people happened - Unity Technologies has posted the original C # code of the Unity game engine for free download on GitHub.  Introduced engine code and editor.  Of course, we could not pass by, especially since lately we have written not so many articles on checking C # projects.  Unity allows you to use the provided source code for reference purposes only.  That is exactly what we will do.  Let's test the latest version of PVS-Studio 6.23 on the Unity code. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  We have previously written <a href="https://www.viva64.com/ru/b/0423/">an article</a> on Unity verification.  At that time, not much C # code was available for analysis: some components, libraries and usage examples.  Nevertheless, the author of the article managed to detect some rather interesting errors. <br><br>  What is Unity pleased this time?  I say "pleased" and I hope that I will not offend the authors of the project.  Moreover, the volume of the original Unity C # code presented on <a href="https://github.com/Unity-Technologies/UnityCsReference">GitHub</a> is about 400 thousand lines (excluding empty) in 2058 files with the extension ‚Äúcs‚Äù.  This is quite a lot, and the analyzer had a very wide field of activity. <br><br>  Now about the results.  Before starting the analysis, I simplified my work a bit by turning on the CWE classification display codes for the errors found, and also activating the third confidence level warning suppression mode (Low).  These settings are available in the PVS-Studio drop-down menu of the Visual Studio development environment, as well as in the analyzer settings.  Having thus gotten rid of low confidence warnings, I analyzed the Unity source code, which resulted in 181 warnings of the first confidence level (High) and 506 warnings of the second confidence level (Medium). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I didn‚Äôt study absolutely all received warnings, as there are quite a lot of them.  Developers or enthusiasts can easily conduct in-depth analysis by running the Unity check themselves.  To do this, PVS-Studio provides trial and <a href="https://www.viva64.com/ru/b/0457/">free</a> use modes.  Companies can also <a href="https://www.viva64.com/ru/order/">buy our product</a> and get quick and detailed support besides the license. <br><br>  Judging by the fact that in almost every group of warnings I managed to find a real mistake from one or two attempts at once - there are a lot of them in Unity.  And yes, they are diverse.  Let's explore the most interesting bugs. <br><br><h2>  Test results </h2><br>  <b>Something is wrong with the flags</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3001/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3001/">V3001</a> There are identical sub-expressions 'MethodAttributes.Public'  operator.  SyncListStructProcessor.cs 240 <br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">MethodReference </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateSerialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... MethodDefinition serializeFunc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MethodDefinition(<span class="hljs-string"><span class="hljs-string">"SerializeItem"</span></span>, MethodAttributes.Public | MethodAttributes.Virtual | MethodAttributes.Public | <span class="hljs-comment"><span class="hljs-comment">// &lt;= MethodAttributes.HideBySig, Weaver.voidType); .... }</span></span></code> </pre> <br>  An <i>error</i> was made when combining the <i>MethodAttributes</i> enumeration flags: the <i>Public</i> value was used twice.  Perhaps the reason for this is bad code formatting. <br><br>  A similar error was made in the <i>GenerateDeserialization</i> method code: <ul><li>  V3001 There are identical sub-expressions 'MethodAttributes.Public' to the left  operator.  SyncListStructProcessor.cs 309 </li></ul><br>  <b>Copy paste</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3001/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3001/">V3001</a> There are identical sub-expressions' format == RenderTextureFormat.ARGBFloat  operator.  RenderTextureEditor.cs 87 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsHDRFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(RenderTextureFormat format)</span></span></span><span class="hljs-function"> </span></span>{ Return (format == RenderTextureFormat.ARGBHalf || format == RenderTextureFormat.RGB111110Float || format == RenderTextureFormat.RGFloat || format == RenderTextureFormat.ARGBFloat || format == RenderTextureFormat.ARGBFloat || format == RenderTextureFormat.RFloat || format == RenderTextureFormat.RGHalf || format == RenderTextureFormat.RHalf); }</code> </pre> <br>  I gave the code snippet, having preformatted it, so the error is easily detected visually: a comparison with the <i>RenderTextureFormat.ARGBFloat is</i> made twice.  In the original code, it looks a little different: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3b6/6ff/c0b/3b66ffc0b50c95f98f6c4936f6bc9c6c.png" alt="Picture 3"></p><br>  Probably, in one of two identical comparisons it is necessary to use a different value of the <i>RenderTextureFormat</i> enumeration. <br><br>  <b>Double work</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3008/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3008/">V3008</a> CWE-563 The 'fail' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 1633, 1632. UNetWeaver.cs 1633 <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Weaver</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fail; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValidTypeToGenerate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... Weaver.fail = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; fail = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } .... }</code> </pre> <br>  The variable is set to <i>true</i> twice, because <i>Weaver.fail</i> and <i>fail</i> are the same static field of the <i>Weaver</i> class.  Perhaps a blunder is not here, but the code definitely needs attention. <br><br>  <b>No options</b> <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3009/">V3009</a> CWE-393 It's one odd that this method returns.  ProjectBrowser.cs 1417 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Returns true if we should early out of OnGUI bool HandleCommandEventsForTreeView() { .... if (....) { .... if (....) return false; .... } return false; }</span></span></code> </pre> <br>  The method always returns <i>false</i> .  Pay attention to the comment at the beginning. <br><br>  <b>Forgot about the result</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3010/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3010/">V3010</a> CWE-252 The return value of the function 'Concat' is required to be utilized.  AnimationRecording.cs 455 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UndoPropertyModification[] Process(....) { .... discardedModifications.Concat(discardedRotationModifications); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> discardedModifications.ToArray(); }</code> </pre> <br>  When concatenating two arrays, <i>discardedModifications</i> and <i>discardedRotationModifications</i> forgot to save the result.  Probably, the programmer suggested that the result will be reflected immediately in the <i>discardedModifications</i> array.  But it is not.  As a result, the original array of the <i>discardedModifications is</i> returned from the method.  The code needs to be corrected as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> UndoPropertyModification[] Process(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> discardedModifications.Concat(discardedRotationModifications) .ToArray(); }</code> </pre> <br>  <b>Not checked</b> <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3019/">V3019</a> CWE-697;  Check variables 'obj', 'newResolution'.  GameViewSizesMenuItemProvider.cs 104 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> GameViewSize </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CastToGameViewSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ GameViewSize newResolution = obj as GameViewSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj == null) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"Incorrect input"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> null; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newResolution; }</code> </pre> <br>  In this method, we forgot to foresee a situation where the <i>obj</i> variable will not be <i>null</i> , but it cannot be <i>converted</i> to the <i>GameViewSize</i> type.  Then the variable <i>newResolution</i> will receive a <i>null</i> value, and debugging output will not be produced.  The corrected version of the code could be: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> GameViewSize </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CastToGameViewSize</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object obj)</span></span></span><span class="hljs-function"> </span></span>{ GameViewSize newResolution = obj as GameViewSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (newResolution == null) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"Incorrect input"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> newResolution; }</code> </pre> <br>  <b>Imperfection</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3020/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3020/">V3020</a> CWE-670 An unconditional 'return' within a loop.  PolygonCollider2DEditor.cs 96 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">HandleDragAndDrop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Rect targetRect)</span></span></span><span class="hljs-function"> </span></span>{ .... foreach (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } .... }</code> </pre> <br>  The loop will perform only one iteration, after which the method will complete the work.  Different scenarios are likely.  For example, <i>return</i> must be inside an <i>if</i> block, or the <i>continue</i> directive is missing before <i>return</i> .  It may well be that there is no error here, but then you should make the code more understandable. <br><br>  <b>Unreachable code</b> <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3021/">V3021</a> CWE-561 There are two 'if' statements with identical conditional expressions.  The first 'if' statement contains method return.  This means that the statement is a senseless customScript Assembly.cs 179 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsCompatibleWith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buildingForEditor) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> IsCompatibleWithEditor(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (buildingForEditor) buildTarget = BuildTarget.NoTarget; <span class="hljs-comment"><span class="hljs-comment">// Editor .... }</span></span></code> </pre> <br>  Two identical checks, one after the other.  Obviously, in the case of equality of the <i>buildingForEditor</i> to <i>true</i> , the second check is meaningless, as a result of the first method completes the work.  If the value of the <i>buildingForEditor</i> is <i>false</i> , then neither the then-branch of the first <i>if statement</i> nor the second one will be executed.  There is an erroneous design requiring correction. <br><br>  <b>Unconditional condition</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3022/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-570 Expression 'index &lt;0 &amp;&amp; index&gt; = parameters.Length' is always false.  AnimatorControllerPlayable.bindings.cs 287 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AnimatorControllerParameter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ AnimatorControllerParameter[] param = parameters; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; index &gt;= parameters.Length) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexOutOfRangeException( <span class="hljs-string"><span class="hljs-string">"Index must be between 0 and "</span></span> + parameters.Length); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> param[index]; }</code> </pre> <br>  The index check condition is incorrect - the result will always be <i>false</i> .  However, in the case of an erroneous index being passed to the <i>GetParameter</i> method, an <i>IndexOutOfRangeException</i> exception will still be thrown, but already when attempting to access an array element in a <i>return</i> block.  True, the error message will be somewhat different.  In order for the code to behave as the developer expects, it is necessary instead of the &amp;&amp; operator in the condition to use ||: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> AnimatorControllerParameter </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetParameter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> index)</span></span></span><span class="hljs-function"> </span></span>{ AnimatorControllerParameter[] param = parameters; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> || index &gt;= parameters.Length) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IndexOutOfRangeException( <span class="hljs-string"><span class="hljs-string">"Index must be between 0 and "</span></span> + parameters.Length); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> param[index]; }</code> </pre> <br>  Probably due to the use of the Copy-Paste technique, another exact error is present in the Unity code: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3022/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-570 Expression 'index &lt;0 &amp;&amp; index&gt; = parameters.Length' is always false.  Animator.bindings.cs 711 <br><br>  And one more similar error, also related to the incorrect condition for checking the array index: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3022/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-570 Expression 'handle.valueIndex &lt;0 &amp;&amp; handle.valueIndex&gt; = list.Length' is always false.  StyleSheet.cs 81 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> T CheckAccess&lt;T&gt;(T[] <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>, StyleValueType type, StyleValueHandle handle) { T value = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle.valueType != type) { Debug.LogErrorFormat(.... ); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handle.valueIndex &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; handle.valueIndex &gt;= <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>.Length) { Debug.LogError(<span class="hljs-string"><span class="hljs-string">"Accessing invalid property"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { value = <span class="hljs-built_in"><span class="hljs-built_in">list</span></span>[handle.valueIndex]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value; }</code> </pre> <br>  And in this case, a throw exception <i>IndexOutOfRangeException.</i>  To correct the error, it is necessary, as in the previous code fragments, to use the operator in the condition ||  instead of &amp;&amp;. <br><br>  <b>Just a weird code</b> <br><br>  Two warnings immediately indicate the following code snippet: <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-571 Expression 'bRegisterAllDefinitions ||  (AudioSettings.GetSpatializerPluginName () == "GVR Audio Spatializer") 'is always true.  AudioExtensions.cs 463 <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-571 Expression 'bRegisterAllDefinitions ||  (AudioSettings.GetAmbisonicDecoderPluginName () == "GVR Audio Spatializer") 'is always true.  AudioExtensions.cs 467 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// This is where we register our built-in spatializer extensions. static private void RegisterBuiltinDefinitions() { bool bRegisterAllDefinitions = true; if (!m_BuiltinDefinitionsRegistered) { if (bRegisterAllDefinitions || (AudioSettings.GetSpatializerPluginName() == "GVR Audio Spatializer")) { } if (bRegisterAllDefinitions || (AudioSettings.GetAmbisonicDecoderPluginName() == "GVR Audio Spatializer")) { } m_BuiltinDefinitionsRegistered = true; } }</span></span></code> </pre> <br>  Looks like an unfinished method.  It is not clear why he was left in this form and did not comment out useless blocks of code.  All that the method is doing at the moment: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!m_BuiltinDefinitionsRegistered) { m_BuiltinDefinitionsRegistered = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  <b>Useless method</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3022/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-570 Expression 'PerceptionRemotingPlugin.GetConnectionState ()! = HolographicStreamerConnectionState.Disconnected' is always false.  HolographicEmulationWindow.cs 171 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Disconnect</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PerceptionRemotingPlugin.GetConnectionState() != HolographicStreamerConnectionState.Disconnected) PerceptionRemotingPlugin.Disconnect(); }</code> </pre> <br>  To clarify the situation, you need to look at the declaration of the <i>PerceptionRemotingPlugin.GetConnectionState ()</i> method: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HolographicStreamerConnectionState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConnectionState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HolographicStreamerConnectionState.Disconnected; }</code> </pre> <br>  Thus, calling <i>Disconnect ()</i> does not lead to anything. <br><br>  There is one more error associated with the same <i>PerceptionRemotingPlugin.GetConnectionState ()</i> method: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3022/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> CWE-570 Expression 'PerceptionRemotingPlugin.GetConnectionState () == HolographicStreamerConnectionState.Connected' is always false.  HolographicEmulationWindow.cs 177 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsConnectedToRemoteDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PerceptionRemotingPlugin.GetConnectionState() == HolographicStreamerConnectionState.Connected; }</code> </pre> <br>  The result of the method is equivalent to the following: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsConnectedToRemoteDevice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  As you can see, among the warnings <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> found a lot of interesting.  Probably, if you spend some more time, you can increase the list.  But let's move on. <br><br>  <b>Not in format</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3025/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3025/">V3025</a> CWE-685 Incorrect format.  A different number of formatted items is expected while calling 'Format' function.  Arguments not used: index.  Physics2D.bindings.cs 2823 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException( String.Format(<span class="hljs-string"><span class="hljs-string">"Negative path index is invalid."</span></span>, index)); .... }</code> </pre> <br>  There is no error, but the code, as they say, "with the smell."  Probably the earlier message was more informative, like this: <i>"Negative path index {0} is invalid."</i> .  Then it was simplified, but the <i>index</i> parameter for the <i>Format</i> method was forgotten.  Of course, this is not the same as a forgotten parameter for the specified output specifier in a string, that is, a structure of the form <i>String.Format (‚ÄúNegative path index {0} is invalid.‚Äù)</i> .  In that case, an exception would be thrown.  But in our case, careful refactoring is required.  The code needs to be fixed like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (index &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentOutOfRangeException( <span class="hljs-string"><span class="hljs-string">"Negative path index is invalid."</span></span>); .... }</code> </pre> <br>  <b>Substring substring</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3053/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3053/">V3053</a> An excessive expression.  Examine the substrings 'UnityEngine.'  and 'UnityEngine.SetupCoroutine'.  StackTrace.cs 43 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsSystemStacktraceType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> casted = (<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>)name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"UnityEditor."</span></span>) || casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"UnityEngine."</span></span>) || casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"System."</span></span>) || casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"UnityScript.Lang."</span></span>) || casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"Boo.Lang."</span></span>) || casted.StartsWith(<span class="hljs-string"><span class="hljs-string">"UnityEngine.SetupCoroutine"</span></span>); }</code> </pre> <br>  Searching for the substring "UnityEngine.SetupCoroutine" in the condition is meaningless, since before this a search for "UnityEngine." Is performed.  Thus, you should delete the last check, or clarify the correct substrings. <br><br>  Another similar error: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3053/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3053/">V3053</a> An excessive expression.  Examine the substrings 'Windows.dll' and 'Windows.'.  AssemblyHelper.cs 84 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CouldBelongToDotNetOrWindowsRuntime</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> assemblyPath)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> assemblyPath.IndexOf(<span class="hljs-string"><span class="hljs-string">"mscorlib.dll"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span> || assemblyPath.IndexOf(<span class="hljs-string"><span class="hljs-string">"System."</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span> || assemblyPath.IndexOf(<span class="hljs-string"><span class="hljs-string">"Windows.dll"</span></span>) != <span class="hljs-number"><span class="hljs-number">-1</span></span> || <span class="hljs-comment"><span class="hljs-comment">// &lt;= assemblyPath.IndexOf("Microsoft.") != -1 || assemblyPath.IndexOf("Windows.") != -1 || // &lt;= assemblyPath.IndexOf("WinRTLegacy.dll") != -1 || assemblyPath.IndexOf("platform.dll") != -1; }</span></span></code> </pre> <br>  <b>Size matters</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3063/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3063/">V3063</a> CWE-571 A part of the conditional expression is always true if it is evaluated: pageSize &lt;= 1000. UNETInterface.cs 584 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.IsValid() &amp;&amp; (pageSize &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> || pageSize &lt;= <span class="hljs-number"><span class="hljs-number">1000</span></span>) &amp;&amp; totalFilters &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br>  The condition for checking the valid page size is wrong.  Instead of the operator ||  nessesary to use &amp;&amp;.  Corrected code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsValid</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base.IsValid() &amp;&amp; (pageSize &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; pageSize &lt;= <span class="hljs-number"><span class="hljs-number">1000</span></span>) &amp;&amp; totalFilters &lt;= <span class="hljs-number"><span class="hljs-number">10</span></span>; }</code> </pre> <br>  <b>Division by zero is possible</b> <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3064/">V3064</a> CWE-369 Potential division by zero.  Consider inspecting denominator '(float) (width - 1)'.  ClothInspector.cs 249 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Texture2D </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateColorTexture</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> width)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; width; i++) colors[i] = GetGradientColor(i / (<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)(width - <span class="hljs-number"><span class="hljs-number">1</span></span>)); .... }</code> </pre> <br>  The problem may occur when passing to the method the value <i>width = 1</i> .  In the method itself, this is not verified.  The <i>GenerateColorTexture</i> method is called in the code only once with the parameter 100: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnEnable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (s_ColorTexture == null) s_ColorTexture = GenerateColorTexture(<span class="hljs-number"><span class="hljs-number">100</span></span>); .... }</code> </pre> <br>  So there is no error yet.  But, just in case, the <i>GenerateColorTexture</i> method should provide the ability to transfer incorrect width values. <br><br>  <b>Paradoxical check</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> CWE-476 Possible null dereference.  Consider inspecting 'm_Parent'.  EditorWindow.cs 449 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowPopup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Parent == null) { .... Rect r = m_Parent.borderSize.Add(....); .... } }</code> </pre> <br>  Probably due to a typo, the execution of this code guarantees the use of the <i>m_Parent</i> null reference.  Corrected code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowPopup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Parent != null) { .... Rect r = m_Parent.borderSize.Add(....); .... } }</code> </pre> <br>  Exactly the same error occurs later in the code: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> CWE-476 Possible null dereference.  Consider inspecting 'm_Parent'.  EditorWindow.cs 470 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ShowWithMode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ShowMode mode)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_Parent == null) { .... Rect r = m_Parent.borderSize.Add(....); .... }</code> </pre> <br>  And here is another interesting error that can lead to access via a null link due to incorrect verification: <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> CWE-476 Possible null dereference.  Consider inspecting 'objects'.  TypeSelectionList.cs 48 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TypeSelection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName, Object[] objects)</span></span></span><span class="hljs-function"> </span></span>{ System.Diagnostics.Debug.Assert(objects != null || objects.Length &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>); .... }</code> </pre> <br>  It seems to me that Unity developers quite often make mistakes due to improper use of operators ||  and &amp;&amp; in terms.  In this case, if <i>objects</i> will be <i>null</i> , this will check the second part of the condition <i>(objects! = Null || objects.Length&gt; = 1)</i> , which will cause an unexpected exception to be thrown.  The error must be corrected as follows: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TypeSelection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> typeName, Object[] objects)</span></span></span><span class="hljs-function"> </span></span>{ System.Diagnostics.Debug.Assert(objects != null &amp;&amp; objects.Length &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>); .... }</code> </pre> <br>  <b>Early zeroed</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> CWE-476 Possible null dereference.  Consider inspecting 'm_RowRects'.  TreeViewControlGUI.cs 272 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFirstAndLastRowVisible</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowCount != m_RowRects.Count) { m_RowRects = null; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, rowCount, m_RowRects.Count)); } .... }</code> </pre> <br>  In this case, an exception is thrown (access via the null link <i>m_RowRects</i> ) will occur when a message string is formed for another exception.  The code can be fixed, for example, like this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetFirstAndLastRowVisible</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rowCount != m_RowRects.Count) { var m_RowRectsCount = m_RowRects.Count; m_RowRects = null; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"...."</span></span>, rowCount, m_RowRectsCount)); } .... }</code> </pre> <br>  <b>Again check error</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3080/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> CWE-476 Possible null dereference.  Consider inspecting 'additionalOptions'.  MonoCrossCompile.cs 279 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CrossCompileAOT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (additionalOptions != null &amp; additionalOptions.Trim().Length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) arguments += additionalOptions.Trim() + <span class="hljs-string"><span class="hljs-string">","</span></span>; .... }</code> </pre> <br>  Due to the fact that &amp; is used in the condition, the second part of the condition will always be checked, regardless of the result of checking the first part.  If the variable <i>additionalOptions</i> is <i>null</i> , an exception is inevitable.  The error must be corrected by using the &amp;&amp; operator instead of &amp;. <br><br>  As you can see, among the warnings with the number <a href="http://www.viva64.com/ru/w/V3080/">V3080</a> there are quite insidious errors. <br><br>  <b>Late check</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3095/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3095/">V3095</a> CWE-476 The 'element' object was used against null.  Check lines: 101, 107. StyleContext.cs 101 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeginElementTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualElement element, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.IsDirty(ChangeType.Styles)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element != null &amp;&amp; element.styleSheets != null) { .... } .... }</code> </pre> <br>  The variable <i>element is</i> used without first checking for <i>null</i> inequality.  At the same time further in the code such verification is performed.  The code probably needs to be fixed this way: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnBeginElementTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VisualElement element, ....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element != null) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.IsDirty(ChangeType.Styles)) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (element.styleSheets != null) { .... } } .... }</code> </pre> <br>  There are 18 more such errors in the code.  I will list the first 10: <ul><li>  V3095 CWE-476 The 'property' object was used against it.  Check lines: 5137, 5154. EditorGUI.cs 5137 </li><li>  V3095 CWE-476 The 'exposedPropertyTable' object has been verified against null.  Check lines: 152, 154. ExposedReferenceDrawer.cs 152 </li><li>  V3095 CWE-476 The 'rectObjs' object was verified against null.  Check lines: 97, 99. RectSelection.cs 97 </li><li>  V3095 CWE-476 The m_EditorCache The object was used before it was verified against null.  Check lines: 134, 140. EditorCache.cs 134 </li><li>  V3095 CWE-476 The 'setup' object was verified against null.  Check lines: 43, 47. TreeViewExpandAnimator.cs 43 </li><li>  V3095 CWE-476 The 'response.job' object was used against it.  Check lines: 88, 99. AssetStoreClient.cs 88 </li><li>  V3095 CWE-476 The 'compilationTask' object has been verified against null.  Check lines: 1010, 1011. EditorCompilation.cs 1010 </li><li>  V3095 CWE-476 The m_GenericPresetLibraryInspector The object has been verified against null.  Check lines: 35, 36. CurvePresetLibraryInspector.cs 35 </li><li>  PVS-Studio Warning: V3095 CWE-476 The 'Event.current' object was verified against null.  Check lines: 574, 620. AvatarMaskInspector.cs 574 </li><li>  V3095 CWE-476 The m_GenericPresetLibraryInspector The object has been verified against null.  Check lines: 31, 32. ColorPresetLibraryInspector.cs 31 </li></ul><br>  <b>Invalid Equals method</b> <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3115/">V3115</a> CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  CurveEditorSelection.cs 74 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> override </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object _other)</span></span></span><span class="hljs-function"> </span></span>{ CurveSelection other = (CurveSelection)_other; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> other.curveID == curveID &amp;&amp; other.key == key &amp;&amp; other.type == type; }</code> </pre> <br>  The overload of the <i>Equals</i> method is done carelessly.  It is necessary to take into account the possibility of obtaining <i>null</i> as a parameter, since this may lead to an exception being thrown, which was not provided for in the calling code.  Also throwing an exception will result in the situation when it is not possible to bring <i>_other</i> to the <i>CurveSelection</i> type.  Code requires correction.  A good example of implementing <i>Equals</i> overload is provided in the <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/statements-expressions-operators/how-to-define-value-equality-for-a-type">documentation</a> . <br><br>  There are other similar errors in the code: <ul><li>  V3115 CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  SpritePackerWindow.cs 40 </li><li>  V3115 CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  PlatformIconField.cs 28 </li><li>  V3115 CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  ShapeEditor.cs 161 </li><li>  V3115 CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  ActiveEditorTrackerBindings.gen.cs 33 </li><li>  V3115 CWE-684 Passing 'null' to 'Equals' method should not result in 'NullReferenceException'.  ProfilerFrameDataView.bindings.cs 60 </li></ul><br>  <b>And again about checking for null inequality</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3125/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3125/">V3125</a> CWE-476 The camera has been verified against null.  Check lines: 184, 180. ARBackgroundRenderer.cs 184 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisableARBackgroundRendering</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (camera != null) camera.clearFlags = m_CameraClearFlags; <span class="hljs-comment"><span class="hljs-comment">// Command buffer camera.RemoveCommandBuffer(CameraEvent.BeforeForwardOpaque, m_CommandBuffer); camera.RemoveCommandBuffer(CameraEvent.BeforeGBuffer, m_CommandBuffer); }</span></span></code> </pre> <br>  When the <i>camera</i> variable is first used, it is checked for <i>null</i> inequality.  But then they forget to make it by code.  The corrected version could be: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DisableARBackgroundRendering</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (camera != null) { camera.clearFlags = m_CameraClearFlags; <span class="hljs-comment"><span class="hljs-comment">// Command buffer camera.RemoveCommandBuffer(CameraEvent.BeforeForwardOpaque, m_CommandBuffer); camera.RemoveCommandBuffer(CameraEvent.BeforeGBuffer, m_CommandBuffer); } }</span></span></code> </pre> <br>  Another similar error: <br><br>  <b>PVS-Studio Warning:</b> <a href="http://www.viva64.com/ru/w/V3125/">V3125</a> CWE-476 The 'item' object has been verified against null.  Check lines: 88, 85. TreeViewForAudioMixerGroups.cs 88 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override Texture </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIconForItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TreeViewItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != null &amp;&amp; item.icon != null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item.icon; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.id == kNoneItemID) <span class="hljs-comment"><span class="hljs-comment">// &lt;= return k_AudioListenerIcon; return k_AudioGroupIcon; }</span></span></code> </pre> <br>  An error was made, leading in some cases to access via a null link.  Fulfillment of the condition in the first <i>if</i> block provides an exit from the method.  However, if this does not happen, then there are no guarantees that the <i>item</i> link is nonzero.  Corrected code: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> override Texture </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetIconForItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(TreeViewItem item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item != null) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.icon != null) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item.icon; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.id == kNoneItemID) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> k_AudioListenerIcon; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> k_AudioGroupIcon; }</code> </pre> <br>  There are 12 more similar errors in the code.  I will list the first 10: <ul><li>  V3125 CWE-476 The 'element' object was used after it was verified against null.  Check lines: 132, 107. StyleContext.cs 132 </li><li>  V3125 CWE-476 The 'mi.DeclaringType' object was verified against null.  Check lines: 68, 49. AttributeHelper.cs 68 </li><li>  V3125 CWE-476 The 'label' object was used after it was verified against null.  Check lines: 5016, 4999. EditorGUI.cs 5016 </li><li>  V3125 CWE-476 The 'Event.current' object was used after it was verified against null.  Check lines: 277, 268. HostView.cs 277 </li><li>  V3125 CWE-476 The 'bpst' object was used after it was verified against null.  Check lines: 96, 92. BuildPlayerSceneTreeView.cs 96 </li><li>  V3125 CWE-476 The 'state' object was used after it was verified against null.  Check lines: 417, 404. EditorGUIExt.cs 417 </li><li>  V3125 CWE-476 The 'dock' object used after it was verified against null.  Check lines: 370, 365. WindowLayout.cs 370 </li><li>  V3125 CWE-476 The 'info' object was used after it was verified against null.  Check lines: 234, 226. AssetStoreAssetInspector.cs 234 </li><li>  V3125 CWE-476 The 'platformProvider' object was used against it.  Check lines: 262, 222. CodeStrippingUtils.cs 262 </li><li>  V3125 CWE-476 The 'm_ControlPoints' object has been verified against null.  Check lines: 373, 361. EdgeControl.cs 373 </li></ul><br>  <b>The choice was small</b> <br><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/w/V3136/">warning</a> <b>:</b> <a href="http://www.viva64.com/ru/w/V3136/">V3136</a> CWE-691 Constant expression in switch statement.  HolographicEmulationWindow.cs 261 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConnectionStateGUI</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ .... HolographicStreamerConnectionState connectionState = PerceptionRemotingPlugin.GetConnectionState(); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (connectionState) { .... } .... }</code> </pre> <br>  And here the <i>PerceptionRemotingPlugin.GetConnectionState ()</i> method was to blame.  We have already encountered it when we studied the warnings of <a href="http://www.viva64.com/ru/w/V3022/">V3022</a> : <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">internal </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> HolographicStreamerConnectionState </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetConnectionState</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HolographicStreamerConnectionState.Disconnected; }</code> </pre> <br>  The method will return a constant.  Very strange code.  It is necessary to pay close attention to it. <br><br><h2>  findings </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/730/02a/ae2/73002aae246f6096f388a8462a3d31ee.png" alt="Picture 6"></p><br>  I think this can be stopped, otherwise the article will become boring and lengthy.  I repeat, I brought errors that immediately caught my eye.  The Unity code undoubtedly contains a greater number of erroneous or incorrect constructions that require correction.  The difficulty lies in the fact that many of the issued warnings are very controversial and only the author of the code can make an accurate ‚Äúdiagnosis‚Äù in each specific case. <br><br>  In general, one can say about the Unity project that it is rich in errors, but considering the size of its code base (400 thousand lines), everything is not so bad.  Nevertheless, I hope that the authors will not neglect the tools of code analysis to improve the quality of their product. <br><br>  Use <a href="https://www.viva64.com/ru/pvs-studio-download/">PVS-Studio</a> and the reckless code! <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0568/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>        ,      : Sergey Khrenov. <a href="http://www.viva64.com/en/b/0568/">Checking the Unity C# Source Code</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/353640/">https://habr.com/ru/post/353640/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353630/index.html">The ILV has blocked several Amazon and Google MAJOR subnets (UPD .: and continues to block new ones!)</a></li>
<li><a href="../353632/index.html">Learn OpenGL. Lesson 5.2 - Gamma Correction</a></li>
<li><a href="../353634/index.html">PushAll as a partial Telegram replacement</a></li>
<li><a href="../353636/index.html">And again about blocking Telegram. Deploy your own VPN</a></li>
<li><a href="../353638/index.html">Connecting Avaya IP Phones to IP PBX 3CX</a></li>
<li><a href="../353642/index.html">Automate attacker's actions using metasploit and Python</a></li>
<li><a href="../353648/index.html">Useful VPN features</a></li>
<li><a href="../353650/index.html">Fintech Digest: a trillion rubles to the wind, a bank branch managed by robots and PayPal as a bank</a></li>
<li><a href="../353652/index.html">Not a bot yet, but already something - we receive notifications from Zabbix to instant messengers</a></li>
<li><a href="../353654/index.html">Why SQLite does not use Git</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>