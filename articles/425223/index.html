<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android applications on JPHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="People who write PHP code will do everything not to switch to other languages. Yes, I know that earlier on Habr√© there was already a way to write Andr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android applications on JPHP</h1><div class="post__text post__text-html js-mediator-article"><p>  People who write PHP code will do everything not to switch to other languages.  Yes, I know that earlier on Habr√© there was already a <a href="https://habr.com/post/106075/">way</a> to write Android applications in PHP, but it was decided to adapt it to a faster and faster Java-compatible JPHP. </p><br><p><img src="https://habrastorage.org/webt/an/wt/ni/anwtnimygyt5vbxjo5idig80mn8.jpeg" alt="logo"></p><a name="habracut"></a><br><h2 id="o-yazyke-jphp">  About JPHP </h2><br><p>  I assume that you may have a question.  And what about JPHP?  The answer is right there on Habr√©: </p><br><ul><li>  <a href="https://habr.com/post/216651/">JPHP - New php engine for Java VM + JIT</a> </li><li>  <a href="https://habr.com/post/218021/">JPHP - How it works.</a>  <a href="https://habr.com/post/218021/">History of creation</a> </li></ul><br><p>  Well, we will continue.  Over the 4 years that have passed since writing these posts about JPHP, this language has changed for the better.  For example, our own package manager <a href="https://github.com/jphp-group/jphp/tree/master/packager">jppm has appeared</a> about which we will also have to talk about today too. </p><br><h2 id="kak-vsyo-nachalos">  How it all began </h2><br><p>  It all started when my friend got the idea to create Android apps on JPHP.  I gave him the post that we talked about at the beginning, but he didn‚Äôt like this method because it uses regular PHP.  Well, we are developers who write in an unknown language JPHP decided to do everything themselves. </p><br><p>  Having looked through the Internet, we then did not find another way out other than how to use JavaFXPorts.  Yes, and the creator of this language wanted to use it as a GUI engine for JPHP for 2 years, without having done anything. </p><br><p>  As they say - "Who else but you"? .. I rushed to globally study the work of the JPHP language. </p><br><p>  The first few weeks were unsuccessful.  I have already written an automatic generation of the build script for gradle and everything would be fine, apk was going to, but when I started it was an error unknown to me at that time.  I immediately realized that she was due to JPHP, but I had not seen one before.  Now I can say for sure that this error was due to the generated bytecode.  DalvikVM tritely could not run the bytecode generated for the JVM.  This has become a huge obstacle.  Since PHP files in JPHP applications are not compiled at all.  There was an option with phb files, but this did not solve our problem at all.  The only way was to write your own compiler, which really worked, but brought a number of limitations related to include and eval, thanks, Dalvik. </p><br><p>  After many trial and error, I still managed to make the very first version.  Its source is <a href="https://github.com/VenityStudio/android">here</a> .  This version was not very fast.  Yes, and use JavaFX on Android is mazahizm. </p><br><p>  By this, I decided to rewrite everything from scratch.  I made this decision relatively recently.  That's why the JPHP library is a bit damp.  But it works. </p><br><h2 id="kak-eto-rabotaet">  How it works </h2><br><p> It all starts with the fact that jppm collects all your source code and dependencies in one jar file.  Then compiling in them all <code>php</code> files in <code>class</code> files.  After that, the resulting jar file is added depending on the gradle.  And he already in turn compiles these class files in dex.  That's the whole secret. </p><br><p>  With the launch of the application all the more difficult.  <code>AndroidManifest.xml</code> initially just one <code>BootstrapActivity</code> that loads the entire JPHP.  After downloading this <code>BootstrapActivity</code> can be changed from JPHP.  For <code>Activity</code> I created classes of the same name. </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">php</span></span>\<span class="hljs-title"><span class="hljs-title">android</span></span>\<span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; $bootstrapActivity = Application::getMainActivity();</code> </pre> <br><p>  With this code you can get the very <code>BootstrapActivity</code> from which the JPHP was loaded. </p><br><p>  I think you have already become aware of the work of the JPHP loader. </p><br><h2 id="nebolshoy-primer">  Small example </h2><br><p>  For example, in order to create the most primitive clicker you need to use this code: </p><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">php</span></span>\<span class="hljs-title"><span class="hljs-title">android</span></span>\<span class="hljs-title"><span class="hljs-title">app</span></span>\<span class="hljs-title"><span class="hljs-title">Application</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">php</span></span>\<span class="hljs-title"><span class="hljs-title">android</span></span>\<span class="hljs-title"><span class="hljs-title">widget</span></span>\<span class="hljs-title"><span class="hljs-title">Button</span></span>; Application::setMainActivityHandler(fn =&gt; { <span class="hljs-comment"><span class="hljs-comment">//   jPHP $activity = Application::getMainActivity(); //  BootstrapActivity $activity-&gt;setTitle("test"); //   $activity-&gt;setContentView($button = new Button($activity)); //     $button-&gt;text = "Hello from JPHP!"; //     $button-&gt;on("click", function () use ($button) { //     ... $GLOBALS['clicks']++; $button-&gt;text = "Clicks: " . $GLOBALS['clicks']; }); });</span></span></code> </pre> <br><p>  As a result, we got a simple application with a button: </p><br><p><img src="https://habrastorage.org/webt/lf/04/3w/lf043wq0xgwej0yty6islmvwtnk.jpeg"></p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  I do not think that my project will be interesting to anyone.  Since he does not describe so far and 10% of the Android API.  Yes, and writing applications for Android in PHP is not canon.  But I think the project will find its audience. </p><br><p>  ‚Üí <a href="https://github.com/VenityStudio/jphp-android">Github Project</a> <br>  ‚Üí <a href="https://github.com/jphp-group">Github JPHP</a> <br>  ‚Üí <a href="https://vk.com/venity">Group in VK</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/425223/">https://habr.com/ru/post/425223/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425213/index.html">Plans for the next version of Vue.js</a></li>
<li><a href="../425215/index.html">4 tips for optimizing a webpack application</a></li>
<li><a href="../425217/index.html">Resiliency of the application when updating the cluster Cubernetes</a></li>
<li><a href="../425219/index.html">What is mental health: a view from the psychology / psychotherapy</a></li>
<li><a href="../425221/index.html">How to produce plastic for 3D printing</a></li>
<li><a href="../425225/index.html">How to see the links inside your PowerShell module</a></li>
<li><a href="../425227/index.html">Researchers have found a way to detect and circumvent Honeytoken keys in a number of Amazon services.</a></li>
<li><a href="../425229/index.html">How we helped CDN MegaFon.TV not to fall on the 2018 World Cup</a></li>
<li><a href="../425231/index.html">FAQ about the work of the stewardess</a></li>
<li><a href="../425233/index.html">Python 3 to facebook</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>