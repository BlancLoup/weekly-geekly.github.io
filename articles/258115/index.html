<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bluetooth heart rate monitor or photoplethysmograph device. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article you will learn about the design of the device, which allows to measure the pulse wave and transmit data via radio to the android devic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bluetooth heart rate monitor or photoplethysmograph device. Part 1</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/b6b/cb2/738/b6bcb2738aa34a418120b88534b6cb88.jpg"><br><br>  In this article you will learn about the design of the device, which allows to measure the pulse wave and transmit data via radio to the android device. <br><a name="habracut"></a><br><h3>  Lyrical introduction </h3><br>  Photoplethysmograph - a device that determines the change in the size of human organs using photosensitive elements.  It can be used to measure the pulse.  In this case, a change in the intensity of light from an artificial source due to the passage of a pulse wave is recorded.  As a rule, the last phalanx of the finger, the earlobe, the wrist, or the temple is used for registration.  Very often the principle of photoplethysmography is used in various sports accessories. <br><br>  To register photoplethysmogram you need a light source and a photodetector.  The source is usually an LED, and the receiver is a phototransistor or photodiode.  The light emitted by the source is absorbed by the human body.  In the first approximation, we can say that the degree of absorption depends on the amount of blood in the point of the body where the sensor is located.  When the amount of blood changes, the absorption of light and the signal at the output of the photodetector change. <br>  In relation to each other, the source and receiver can be arranged in two ways.  These methods are called "reflection" and "light".  In the case of "reflection" receiver and source are located in the same plane.  Light from the source hits the skin, is partially absorbed and, reflected, hits the receiver.  The following figure is a self-produced sensor.  It consists of a printed circuit board, with a phototransistor and a LED soldered to it.  The wire goes to the measuring box. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/69a/2c5/9c0/69a2c59c082a478e9ebdfd693e0473e9.jpg"><br><br>  In the variant "on the lumen," the source and receiver are located on opposite sides of the body part.  In the following picture, they are in different halves of the pulsator clip.  The emitted light passes through the finger and enters the photodetector.  This clip is designed to measure the pulse from the earlobe.  There is a finger in the picture, because it is more convenient to photograph it. <br><br><img src="https://habrastorage.org/files/88e/d51/ce1/88ed51ce1bba4fbb95200ab5de33a869.jpg"><br><br>  The signal from the photodetector enters the amplification and filtering circuit.  An example of such a scheme is shown in the following figure.  Resistors R1 and R2 set the LED current and the operating point of the phototransistor, respectively.  The separation capacitor C1 removes the constant component, which occurs due to the illumination of the room where the measurement takes place.  Pull-up resistor R3 shifts the voltage in the positive region (as the amplifier is unipolar).  The shear stress is also fed into the feedback of the amplifier to avoid saturation.  After amplification, the signal enters another separation stage to finally remove the shear stress.  Then the data is digitized using an ADC. <br><br><img src="https://habrastorage.org/files/403/863/c64/403863c6485b4f27bf09de029edb9b63.jpg"><br><br>  This scheme is common, but not the only one.  Anyone can follow the <a href="http://ww1.microchip.com/downloads/en/AppNotes/00001525B.pdf">link</a> to an interesting article of the company Microchip.  In addition to measuring the pulse using photodiodes, you will read there about the principles of measuring blood oxygen saturation (oxygenation), it also shows the typical circuit solutions used, and programs for the microcontroller.  By the way, quite recently, the Microchip has a <a href="http://www.microchip.com/pagehandler/en-us/promo/pulseoximeterdemo/home.html">demo board</a> for pulse metering. <br><br><h3>  Description of photoplethysmograph </h3><br>  To increase the mobility of the pulsogram measurement, a device was developed that contains a ‚Äúreflection‚Äù sensor, an amplification circuit, a microcontroller, and a radio module HC-05 of the bluetooth standard. <br><br><img src="https://habrastorage.org/files/e23/cf3/265/e23cf32656224c69b31e5ee816362b9f.jpg"><br><br><img src="https://habrastorage.org/files/8a5/b7a/142/8a5b7a142c7a4544896b395243f07105.jpg"><br><br><img src="https://habrastorage.org/files/a24/7ac/8ba/a247ac8ba86f428b96c43d87b216259d.jpg"><br><br><img src="https://habrastorage.org/files/569/238/c69/569238c69d1d49e3a5a4531737ac92a3.jpg"><br><br><h3>  Operating principle </h3><br>  The main element of the sensor is the PIC16F1705 microcontroller.  He has onboard a built-in operational amplifier, an ADC, a DAC, a COM port and enough resources to carry out simple calculations.  The originally developed circuit for switching on the amplifier corresponded to the one given above.  After testing, some nodes have been changed.  In particular, a 47 ŒºF capacitor was added to the feedback instead of the bias voltage.  It performs the function of eliminating the DC component, which is created by a voltage divider.  To reduce power consumption, the LED is connected to the output of the DAC, which only works at the time of sampling ADC data.  The supply voltage comes from a Li-Ion LP502030 battery with a capacity of 250 mAh.  Charging takes place via the mini-USB connector and the circuit implemented on the MCP73831 charge controller.  Radio communication is provided by the module HC-05.  To communicate with a computer or smartphone using a character protocol.  The sensor is located in the <a href="http://www.okw.com/de/Kunststoffgeh%25C3%25A4use/Minitec.htm">OKW minitec case</a> , complete with which can come with a wrist strap. <br><br><img src="https://habrastorage.org/files/e51/13b/709/e5113b7096c044cda1efd53d0f870742.jpg"><br><br>  The sensor has the following characteristics: <br><ul><li>  pulse wave measurement; </li><li>  sampling frequency 200 Hz; </li><li>  250 mAh battery, charge from USB; </li><li>  at least five hours of continuous work; </li><li>  dimensions 50 x 45 x 16 mm; </li><li>  weight 20 g </li></ul><br><br><h3>  Android program, data processing </h3><br>  To display the pulse wave on the graph and save the data, an android application was developed.  The routine for working with the Bluetooth module uses codes from the freely distributed program of the <a href="https://play.google.com/store/apps/details%3Fid%3Des.pymasde.blueterm%26hl%3Dru">BlueTerm</a> terminal.  From the bluetooth adapter, the data is transmitted to the decoder class for decoding, and then to the handler class to form an array of samples and, possibly, to perform the necessary calculations.  Currently, libraries for calculating heart rate and other relevant parameters are not connected.  After the handler, the data goes to the main application window, where it is displayed on a graph and saved to a file that can be opened by a third-party application.  While working on the project, I came across a good <a href="http://www.adinstruments.com/products/labchart">LabChart</a> program that works with several file formats, including text files.  There are paid and free versions of this program.  Free displays data on a graph and allows for mathematical processing: smoothing, filtering and Fourier analysis.  The following figure shows the window of this program with a graph of data received from the sensor.  A high pass filter has been applied. <br><br><img src="https://habrastorage.org/files/fb6/f40/d48/fb6f40d48ed2402da13c022193e5d562.jpg"><br><br>  The paid version of the program has not yet come into my hands.  The developer‚Äôs site describes some very interesting characteristics.  The program allows you to calculate heart rate, mode, amplitude mode, build intervalograms and much more. <br><br><h4>  To be continued </h4><br>  In the following articles I will talk about some of the details that need to be taken into account when designing the hardware of the photoplethysmograph, data processing methods, elimination of noise and artifacts. <br><br><h4>  PS </h4><br>  You can familiarize yourself with the <a href="">drawings and the sensor program</a> , as well as the source code of the <a href="">android application</a> . <br><br><h4>  Added (05/20/2015) </h4><br><br>  - a file with a pulsogram record in 10 minutes was added to the repository in the info / folder; <br>  - added the frequency response of the analog part of the sensor, its original file is also in the repository; <br><br><img src="https://habrastorage.org/files/e61/b0a/85a/e61b0a85a6eb4b4db6e5236fe32c1863.jpg"></div><p>Source: <a href="https://habr.com/ru/post/258115/">https://habr.com/ru/post/258115/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258105/index.html">Social network on Android for a few days off - part I (client)</a></li>
<li><a href="../258107/index.html">Transitions with CoreAnimation: animating the appearance of the image</a></li>
<li><a href="../258109/index.html">Mexico and Russia: similar problems in learning to develop electronics</a></li>
<li><a href="../258111/index.html">Social network on Android for a few days off - part II (server)</a></li>
<li><a href="../258113/index.html">HL7v3 vs. HL7 FHIR comparison</a></li>
<li><a href="../258119/index.html">What is so special about Nim?</a></li>
<li><a href="../258121/index.html">Simple suffix tree</a></li>
<li><a href="../258125/index.html">The digest of interesting materials for the mobile # 103 developer (on May 12-17)</a></li>
<li><a href="../258127/index.html">OpenHAB and home controller - we make iron</a></li>
<li><a href="../258129/index.html">Installing OTRS v4 on Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>