<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HeadScript Focus (build into one file)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you do this: 
<? php $ this- > headScript()- > appendFile('/js/my1.js');? > 
 <? php $ this- > headScript()- > appendFile('/js/my2.js');? > 
 <? ph...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HeadScript Focus (build into one file)</h1><div class="post__text post__text-html js-mediator-article">  If you do this: <br><blockquote><code><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> appendFile('/js/my1.js');? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> appendFile('/js/my2.js');? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> captureStart() ? <font color="#0000ff">&gt;</font> <br> var action = ' <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> baseUrl ? <font color="#0000ff">&gt;</font> '; <br> <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> captureEnd() ? <font color="#0000ff">&gt;</font> <br> <br> <s><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript(); ? <font color="#0000ff">&gt;</font></s> <br> <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> magicHeadScript(); ? <font color="#0000ff">&gt;</font></code> <br> </blockquote><br>  then instead of something like this: <br><blockquote> <code>&lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"/js/my1.js"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"/js/my2.js"</font> &gt;&lt;/script&gt; <br> &lt;script type= <font color="#A31515">"text/javascript"</font> &gt; <br> <font color="#0000ff">var</font> action = <font color="#A31515">'/123'</font> ; <br> &lt;/script&gt;</code> <br> </blockquote>  get the output: <br><blockquote> <code><font color="black">&lt;script type= <font color="#A31515">"text/javascript"</font> src= <font color="#A31515">"/cache/js/1b1004a203..._compressed.js"</font> &gt;&lt;/script&gt;</font> <br></code> </blockquote><br><a name="habracut"></a><br><h1>  Secret focus <br></h1><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">/**</font> <br> <font color="#008000">* @license Public domain</font> <br> <font color="#008000">*/</font> <br> <font color="#0000ff">class</font> My_View_Helper_MagicHeadScript extends Zend_View_Helper_HeadScript <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> $cacheDir; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> $combine = 1; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> $compress = 1; <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> $symlinks = array(); <br> <br> <font color="#0000ff">private</font> $_cache = array(); <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">public</font> <font color="#0000ff">function</font> setConfig($cacheDir, $combine = 1, $compress = 1, $symlinks = array()) <br> { <br> self::$cacheDir = rtrim($dir, <font color="#A31515">'/'</font> ) . <font color="#A31515">'/'</font> ; <br> self::$symlinks = $symlinks; <br> self::$combine = $combine; <br> self::$compress = $compress; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> magicHeadScript() <br> { <br> <font color="#0000ff">if</font> (self::$combine) { <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;toString(); <br> } <font color="#0000ff">else</font> { <br> <font color="#0000ff">return</font> $ <font color="#0000ff">this</font> -&gt;view-&gt;headScript(); <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> itemToString($item, $indent, $escapeStart, $escapeEnd) <br> { <br> $attrString = <font color="#A31515">''</font> ; <br> <font color="#0000ff">if</font> (!empty($item-&gt;attributes)) { <br> <font color="#0000ff">foreach</font> ($item-&gt;attributes <font color="#0000ff">as</font> $key =&gt; $value) { <br> <font color="#0000ff">if</font> (!$ <font color="#0000ff">this</font> -&gt;arbitraryAttributesAllowed() <br> &amp;&amp; !in_array($key, $ <font color="#0000ff">this</font> -&gt;_optionalAttributes)) <br> { <br> <font color="#0000ff">continue</font> ; <br> } <br> <font color="#0000ff">if</font> ( <font color="#A31515">'defer'</font> == $key) { <br> $value = <font color="#A31515">'defer'</font> ; <br> } <br> $attrString .= sprintf( <font color="#A31515">' %s="%s"'</font> , $key, ($ <font color="#0000ff">this</font> -&gt;_autoEscape) ? $ <font color="#0000ff">this</font> -&gt;_escape($value) : $value); <br> } <br> } <br> <br> $type = ($ <font color="#0000ff">this</font> -&gt;_autoEscape) ? $ <font color="#0000ff">this</font> -&gt;_escape($item-&gt;type) : $item-&gt;type; <br> $html = $indent . <font color="#A31515">'&lt;script type="'</font> . $type . <font color="#A31515">'"'</font> . $attrString . <font color="#A31515">'&gt;'</font> ; <br> <font color="#0000ff">if</font> (!empty($item-&gt;source)) { <br> $html .= PHP_EOL . $indent . <font color="#A31515">'  '</font> . $escapeStart . PHP_EOL . $item-&gt;source . $indent . <font color="#A31515">'  '</font> . $escapeEnd . PHP_EOL . $indent; <br> } <br> $html .= <font color="#A31515">'&lt;/script&gt;'</font> ; <br> <br> <font color="#0000ff">if</font> (isset($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ]) <br> &amp;&amp; !empty($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ]) <br> &amp;&amp; is_string($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ])) <br> { <br> $html = <font color="#A31515">'&lt;!--[if '</font> . $item-&gt;attributes[ <font color="#A31515">'conditional'</font> ] . <font color="#A31515">']&gt; '</font> . $html . <font color="#A31515">'&lt;![endif]--&gt;'</font> ; <br> } <br> <br> <font color="#0000ff">return</font> $html; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> searchJsFile($src) <br> { <br> $path = $_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ] . $src; <br> <font color="#0000ff">if</font> (is_readable($path)) { <br> <font color="#0000ff">return</font> $path; <br> } <br> <font color="#0000ff">foreach</font> (self::$symlinks <font color="#0000ff">as</font> $virtualPath =&gt; $realPath) { <br> $path = str_replace($virtualPath, $realPath, <font color="#A31515">"/$src"</font> ); <br> <font color="#0000ff">if</font> (is_readable($path)) { <br> <font color="#0000ff">return</font> $path; <br> } <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> isCachable($item) <br> { <br> <font color="#0000ff">if</font> (isset($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ]) <br> &amp;&amp; !empty($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ]) <br> &amp;&amp; is_string($item-&gt;attributes[ <font color="#A31515">'conditional'</font> ])) <br> { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <br> <font color="#0000ff">if</font> (!empty($item-&gt;source) &amp;&amp; <font color="#0000ff">false</font> ===strpos($item-&gt;source, <font color="#A31515">'//@non-cache'</font> )) { <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">if</font> (!isset($item-&gt;attributes[ <font color="#A31515">'src'</font> ]) || !$ <font color="#0000ff">this</font> -&gt;searchJsFile($item-&gt;attributes[ <font color="#A31515">'src'</font> ])) { <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> cache($item) <br> { <br> <font color="#0000ff">if</font> (!empty($item-&gt;source)) { <br> $ <font color="#0000ff">this</font> -&gt;_cache[] = $item-&gt;source; <br> } <font color="#0000ff">else</font> { <br> $filePath = $ <font color="#0000ff">this</font> -&gt;searchJsFile($item-&gt;attributes[ <font color="#A31515">'src'</font> ]); <br> $ <font color="#0000ff">this</font> -&gt;_cache[] = array( <br> <font color="#A31515">'filepath'</font> =&gt; $filePath, <br> <font color="#A31515">'mtime'</font> =&gt; filemtime($filePath) <br> ); <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">function</font> toString($indent = <font color="#0000ff">null</font> ) <br> { <br> $headScript = $ <font color="#0000ff">this</font> -&gt;view-&gt;headScript(); <br> <br> $indent = ( <font color="#0000ff">null</font> !== $indent) <br> ? $headScript-&gt;getWhitespace($indent) <br> : $headScript-&gt;getIndent(); <br> <br> <font color="#0000ff">if</font> ($ <font color="#0000ff">this</font> -&gt;view) { <br> $useCdata = $ <font color="#0000ff">this</font> -&gt;view-&gt;doctype()-&gt;isXhtml() ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <br> } <font color="#0000ff">else</font> { <br> $useCdata = $headScript-&gt;useCdata ? <font color="#0000ff">true</font> : <font color="#0000ff">false</font> ; <br> } <br> $escapeStart = ($useCdata) ? <font color="#A31515">'//&lt;![CDATA['</font> : <font color="#A31515">'//&lt;!--'</font> ; <br> $escapeEnd  = ($useCdata) ? <font color="#A31515">'//]]&gt;'</font> : <font color="#A31515">'//--&gt;'</font> ; <br> <br> $items = array(); <br> $headScript-&gt;getContainer()-&gt;ksort(); <br> <font color="#0000ff">foreach</font> ($headScript <font color="#0000ff">as</font> $item) { <br> <font color="#0000ff">if</font> (!$headScript-&gt;_isValid($item)) { <br> <font color="#0000ff">continue</font> ; <br> } <br> <font color="#0000ff">if</font> (!$ <font color="#0000ff">this</font> -&gt;isCachable($item)) { <br> $items[] = $ <font color="#0000ff">this</font> -&gt;itemToString($item, $indent, $escapeStart, $escapeEnd); <br> } <font color="#0000ff">else</font> { <br> $ <font color="#0000ff">this</font> -&gt;cache($item); <br> } <br> } <br> <br> array_unshift($items, $ <font color="#0000ff">this</font> -&gt;itemToString($ <font color="#0000ff">this</font> -&gt;getCompiledItem(), $indent, $escapeStart, $escapeEnd)); <br> <br> $ <font color="#0000ff">return</font> = implode($headScript-&gt;getSeparator(), $items); <br> <font color="#0000ff">return</font> $ <font color="#0000ff">return</font> ; <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">function</font> getCompiledItem() <br> { <br> $filename = md5(serialize($ <font color="#0000ff">this</font> -&gt;_cache)); <br> $path = self::$cacheDir . $filename . (self::$compress? <font color="#A31515">'_compressed'</font> : <font color="#A31515">''</font> ) . <font color="#A31515">'.js'</font> ; <br> <font color="#0000ff">if</font> (!file_exists($path)) { <br> <font color="#008000">//...debug("Combine javascripts to $path...");</font> <br> mkdir(dirname($path), 0777, <font color="#0000ff">true</font> ); <br> $jsContent = <font color="#A31515">''</font> ; <br> <font color="#0000ff">foreach</font> ($ <font color="#0000ff">this</font> -&gt;_cache <font color="#0000ff">as</font> $js) { <br> <font color="#0000ff">if</font> (is_array($js)) { <br> $jsContent .= file_get_contents($js[ <font color="#A31515">'filepath'</font> ]) . <font color="#A31515">"\n\n"</font> ; <br> <font color="#008000">//...debug($js['filepath'] . ' ... OK');</font> <br> } <font color="#0000ff">else</font> { <br> $jsContent .= $js . <font color="#A31515">"\n\n"</font> ; <br> <font color="#008000">//...debug('Inline JavaScript ... OK');</font> <br> } <br> } <br> <font color="#0000ff">if</font> ($compress) { <br> $jsContent = JSMin::minify($jsContent); <br> } <br> file_put_contents($path, $jsContent); <br> } <br> <br> $url = str_replace($_SERVER[ <font color="#A31515">'DOCUMENT_ROOT'</font> ], <font color="#A31515">''</font> , $path); <br> $item = $ <font color="#0000ff">this</font> -&gt;createData( <font color="#A31515">'text/javascript'</font> , array( <font color="#A31515">'src'</font> =&gt;$url)); <br> <font color="#0000ff">return</font> $item; <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h1>  Comments <br></h1><br>  The meaning of the helper's work is to bypass all the added scripts, calculate the hash taking into account the file names, the date the scripts were modified (mtime), the texts of the embedded scripts, build it all into one file and compress (optionally) finally using JSMin <br><br>  If you do not need to cache any built-in script, because, for example, it often changes, then you need to add // @ non-cache: <br><blockquote> <code><font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> captureStart() ? <font color="#0000ff">&gt;</font> <br> //@non-cache <br> var ip = <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> <font color="#ff0000">echo</font> $ <font color="#ff0000">ip</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;?</font> <font color="#800000">php</font> $ <font color="#ff0000">this-</font> <font color="#0000ff">&gt;</font> headScript()- <font color="#0000ff">&gt;</font> captureEnd() ? <font color="#0000ff">&gt;</font></font> <br></code> </blockquote><br>  Missing embedded scripts will be connected after the assembled file, so you need to make sure that there are no dependencies from them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Do not forget to place the plugin correctly and then specify Zend_View addHelperPath <br><br>  If script compression is required, you need to put it in the accessible by __autoload (or add require) place of the <a href="http://github.com/rgrove/jsmin-php/blob/master/jsmin.php">JSMin</a> class <br><br>  Before using the helper directly, you need to specify somewhere in which folder the script should write the collected file: <br> <code>My_View_Helper_MagicHeadScript::setConfig('/path/to/cache');</code> <br> <br>  After modifying the JS scripts, no additional gestures need to be made - the hash will change and the helper will make the new file assembly itself (and it will already be with a different name, so there will be no problems with client caching).  Naturally, the assembly is performed once at the first circulation. <br><br>  MagicHeadLink is a similar solution for building CSS files, but only using <a href="http://code.google.com/p/minify/">Minify</a> can be downloaded below (too lazy to make out a separate article - I'm tired of coloring the source :)). <br><br><br><h1>  Download </h1><br>  MagicHeadScript + JSMin: <br>  <a href="">mhs.zip</a> (4 Kb) <br><br>  MagicHeadLink + Minify (trimmed): <br>  <a href="">mhl.zip</a> (8 Kb) </div><p>Source: <a href="https://habr.com/ru/post/85324/">https://habr.com/ru/post/85324/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../85316/index.html">Withdraw WMZ to Webmoney Dinero card</a></li>
<li><a href="../85317/index.html">Comic competition with practical prizes</a></li>
<li><a href="../85321/index.html">Review of ID3 tag editors in Mac OS X</a></li>
<li><a href="../85322/index.html">Great news: iBay is now available in Russian</a></li>
<li><a href="../85323/index.html">TwiPartyUA in Kiev</a></li>
<li><a href="../85326/index.html">Google Contacts Corporate Address Book</a></li>
<li><a href="../85328/index.html">NetBeans 6.9 Milestone 1 Released</a></li>
<li><a href="../85330/index.html">Imagine that you were offered a contract for the exact date of your death in 50 years. Will you agree?</a></li>
<li><a href="../85332/index.html">Beeline deceives subscribers by sending SMS spam</a></li>
<li><a href="../85333/index.html">Russian Producers Guild welcomes the closure of torrents.ru</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>