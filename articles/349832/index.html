<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alternative to paid off ads in the free Android application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habrahabr! 

 My name is Alexander, I am a developer under the Android OS. Today I want to share with you the experience of implementing an ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alternative to paid off ads in the free Android application</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habrahabr! <br><br>  My name is Alexander, I am a developer under the Android OS.  Today I want to share with you the experience of implementing an alternative to a paid method of disabling advertising in an application - disabling advertising for viewing ads (AdMob Rewarded Video Ads).  Interesting?  Then welcome under cat. <br><a name="habracut"></a><br><a name="main"></a><div class="spoiler">  <b class="spoiler_title">Contents for easy navigation</b> <div class="spoiler_text"><ol><li>  <a href="https://habr.com/ru/post/349832/">How was everything?</a> </li><li>  <a href="https://habr.com/ru/post/349832/">Implementation, Part 1: How it works (in words)</a> </li><li>  <a href="https://habr.com/ru/post/349832/">Implementation, Part 2: Appearance</a> </li><li>  <a href="https://habr.com/ru/post/349832/">Implementation, part 3: Principle of operation (java code)</a> </li><li>  <a href="https://habr.com/ru/post/349832/">Conclusion</a> </li></ol><br></div></div><br><a name="part0"></a><h4>  How was everything? </h4><br>  Back in 2013, I decided to start developing applications for Android, started reading thematic books, articles, watched video lessons, etc.  Wrote the first underapplication and depressed, because  I wanted to do something useful, necessary for society, but there were no ideas.  In 2014, a friend of mine asked me to develop for him a mobile reference book on the syntax of the Arduino platform (C language there).  With great desire, I took this project and implemented the first version for Android 3.0+.  After a while, it was decided to improve it, and so the second version appeared (for Android 4.0+).  Both are free with an AdMob banner at the bottom and a paid shutdown.  Everything was good, until I began to write that ~ 150-170 rubles of the Russian Federation is expensive to turn off advertising forever in their favorite directory.  To which I answered with a "barter" solution of the question - the user can turn off the banner at the bottom for a while for viewing the video ads from AdMob. <br>  <a href="https://habr.com/ru/post/349832/">[back to content]</a> <br><br><a name="part1"></a><h4>  Implementation, Part 1: How it works (in words) </h4><br>  When the application is launched, the user will be shown Dialog, with a suggestion to turn off advertising, unless, of course, he has previously disconnected it or if there is no connection to the Internet.  In the case of a positive response, the application shows a fragment with buttons with which you can disable advertising in the application in a convenient way. <br>  <a href="https://habr.com/ru/post/349832/">[back to content]</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="part2"></a><h4>  Implementation, Part 2: Appearance </h4><br><div class="spoiler">  <b class="spoiler_title">Dialogue with the proposal to disable advertising</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ne/uf/s6/neufs6oeihh5rgravu3kcyx8aiu.png" alt="Dialogue with the proposal to disable advertising"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Screen off advertising</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ra/0a/9i/ra0a9itzvrjd7oud0v-g7b50464.png" alt="Screen off advertising"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">1 video advertisement viewed</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rb/ab/uk/rbabuks6jtcmaweornvv-qqeke8.png" alt="1 video advertisement viewed"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">5 video ads viewed</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/0_/yl/8o/0_yl8o2j6d_73y3mfdlo_-qstuq.png" alt="5 video ads viewed"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Ads disabled for 1 hour</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/nv/-3/ak/nv-3akyajhxksozg4ry_ogmzu6a.png" alt="Ads disabled for 1 hour"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Advertising is disabled for 1 day</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rx/xz/io/rxxzioyot53-0wzar2fxgmemshu.png" alt="Advertising is disabled for 1 day"><br></div></div><br>  <a href="https://habr.com/ru/post/349832/">[back to content]</a> <br><br><a name="part3"></a><h4>  Implementation, part 3: Principle of operation (java code) </h4><br>  Main Activity Code <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActivityMain</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> internet; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> isAdsDisabled; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); <span class="hljs-comment"><span class="hljs-comment">// get SharedPreferences prefManager = new PreferencesManager(this); isAdsDisabled = prefManager.isAdsDisabled(); // true - disable | false - enabled // ...     UI internet = CheckURLConnection.isNetworkAvailable(); // true - disable | false - enabled if (internet &amp;&amp; !isAdsDisabled &amp;&amp; isTimeUp()) { DialogFragment disableAds = new DisableAdsDialog(); if (!disableAds.isResumed()) { disableAds.show(getSupportFragmentManager(), ConstantHolder.DIALOG_DISABLE_ADS); } } private boolean isTimeUp() { return System.currentTimeMillis() &gt; prefManager.getEstimatedAdsTime(); } }</span></span></code> </pre> <br><br>  Class Code CheckURLConnection <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CheckURLConnection</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isNetworkAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ConnectivityManager connectivityManager = (ConnectivityManager) MyAppClass.getContext().getSystemService(Context.CONNECTIVITY_SERVICE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (connectivityManager != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { NetworkInfo activeNetworkInfo = connectivityManager.getActiveNetworkInfo(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> activeNetworkInfo != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> &amp;&amp; activeNetworkInfo.isConnected(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } }</code> </pre><br><br>  PreferencesManager class code <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PreferencesManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Context mContext; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> SharedPreferences mSPref; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SharedPreferences.Editor mSPEditor; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PreferencesManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mContext = context; mSPref = mContext.getSharedPreferences(ConstantHolder.APP_PREF, Context.MODE_PRIVATE); } <span class="hljs-comment"><span class="hljs-comment">//      SharedPreferences public boolean isAdsDisabled() { return mSPref.getBoolean(ConstantHolder.APP_PREF_DISABLE_ADS, false); } //    ,     public long getEstimatedAdsTime() { return mSPref.getLong(ConstantHolder.APP_DISABLE_ADS_PERIOD, 0); } }</span></span></code> </pre><br>  The ConstantHolder class is a class in which I store constants in order not to import them from everywhere, but only from one place to take (analogue of class R) <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConstantHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Preferences Constants public static final String APP_PREF = "app_pref"; public static final String APP_PREF_DISABLE_ADS = "disableAds"; //  public static final String APP_DISABLE_ADS_PERIOD = "disableAdsPeriod"; //    }</span></span></code> </pre><br>  And the most interesting is the class-fragment of the advertisement <br><br><div class="spoiler">  <b class="spoiler_title">java whole class code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SettingsAdsFrag</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String VIEWED_ZERO_VIDEO_ADS = <span class="hljs-string"><span class="hljs-string">"0"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VIEWED_ADS_NUMBER_PER_HOUR = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> VIEWED_ADS_NUMBER_PER_DAY = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-comment"><span class="hljs-comment">//5 private static final long DISABLE_ADS_PERIOD_1_HOUR = 60 * 60 * 1000; private static final long DISABLE_ADS_PERIOD_24_HOURS = 24 * 60 * 60 * 1000; private Context mContext; private PreferencesManager prefManager; private RewardedVideoAd mRewardedVideoAd; private AdRequest mAdRequest; private boolean internet; private boolean readyToPurchase; private boolean bDisableAds; private String ready; private String notReady; private static int adsViewedCounter = 0; private Button btnReadyToViewing; private Button btnDisableAdsPerHour; private Button btnDisableAdsPerDay; private TextView tvViewedAds; private TextView tvEstimatedDate; private ToggleButton tbDisableAds; private BillingProcessor bp; @Override public void onAttach(Context context) { super.onAttach(context); this.mContext = context; //       prefManager = new PreferencesManager(context); //      internet = CheckURLConnection.isNetworkAvailable(); //  " "  readyToPurchase = false; //      " "  ""  .  ,         ready = context.getString(R.string.txt_cat_ads_ready_for_viewing); notReady = context.getString(R.string.txt_cat_ads_not_ready_for_viewing); } @Override public void onCreate(@Nullable Bundle savedInstanceState) { super.onCreate(savedInstanceState); //    Toolbar setHasOptionsMenu(false); //       Anjlab - In-App-Billing-v3 bp = new BillingProcessor(getActivity(), InAppBillingResources.getRsaKey(), //  RSA  InAppBillingResources.getMerchantId(), //  ID   Google Play Developer Console bpHandler //    ); //       bDisableAds = prefManager.isAdsDisabled(); // true - disable | false - enabled } @Nullable @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { //      Toolbar,  , ..     // [START AdMob Rewarded Video Ads - ] mRewardedVideoAd = MobileAds.getRewardedVideoAdInstance(getActivity()); mRewardedVideoAd.setRewardedVideoAdListener(rewardedVideoAdListener); //     ,   Google     AdMob ( 1      !) if (BuildConfig.DEBUG) { mAdRequest = new AdRequest.Builder() .addTestDevice(DeviceHash.getHtcDeviceHash()) .build(); } else { mAdRequest = new AdRequest.Builder() .build(); } //    loadRewardedVideoAd(); // [END AdMob Rewarded Video Ads] //  View   -   View settAdsView = inflater.inflate(R.layout.frag_sett_ads_screen, container, false); // [START ToggleButton Disable Ads] tbDisableAds = (ToggleButton) settAdsView.findViewById(R.id.tb_disable_ads); //       ,     SharedPrefereces   ""  - // --,       Google   .        ? if (readyToPurchase) { if (bp.isPurchased(InAppBillingResources.getSKU_DisableAds())) { setAdsDisable(); tbDisableAds.setChecked(false); } } else { //     ,    // true - disable | false - enabled tbDisableAds.setChecked(!bDisableAds); } //      tbDisableAds.setOnClickListener(this); // [END ToggleButton Disable Ads] //            .   // [START TextView Rewarded Video Ads Disabling Guide] TextView tvRewardedGuide = (TextView) settAdsView.findViewById(R.id.tv_rewarded_video_disabling_guide); tvRewardedGuide.setText(String.format(getActivity().getString(R.string.txt_cat_ads_disable_tmp_text), VIEWED_ADS_NUMBER_PER_HOUR, VIEWED_ADS_NUMBER_PER_DAY)); // [END TextView Rewarded Video Ads Disabling Guide] // [START TextView Viewed Ads] tvViewedAds = (TextView) settAdsView.findViewById(R.id.tv_viewed_ads); // [END TextView Viewed Ads] // [START Button Ready for Viewing] btnReadyToViewing = (Button) settAdsView.findViewById(R.id.btn_ready_to_viewing); btnReadyToViewing.setText(notReady); btnReadyToViewing.setEnabled(false); btnReadyToViewing.setOnClickListener(this); // [END Button Ready for Viewing] // [START Button Disable Ads Per Hour] btnDisableAdsPerHour = (Button) settAdsView.findViewById(R.id.btn_disable_ads_per_hour); btnDisableAdsPerHour.setEnabled(false); btnDisableAdsPerHour.setOnClickListener(this); // [END Button Disable Ads Per Hour] // [START Button Disable Ads Per Day] btnDisableAdsPerDay = (Button) settAdsView.findViewById(R.id.btn_disable_ads_per_day); btnDisableAdsPerDay.setEnabled(false); btnDisableAdsPerDay.setOnClickListener(this); // [END Button Disable Ads Per Day] // [START TextView Last Viewing Time] tvEstimatedDate = (TextView) settAdsView.findViewById(R.id.tv_estimated_date); // [END TextView Last Viewing Time] //        updateTextView(); updateButtons(); return settAdsView; } @Override public void onResume() { // Rewarded Video Ad -        if (mRewardedVideoAd != null) { mRewardedVideoAd.resume(getActivity()); } super.onResume(); // updateUI -   updateTextView(); updateButtons(); } @Override public void onPause() { // Rewarded Video Ad -        if (mRewardedVideoAd != null) { mRewardedVideoAd.pause(getActivity()); } super.onPause(); } @Override public void onDestroy() { // Rewarded Video Ad -        if (mRewardedVideoAd != null) { mRewardedVideoAd.destroy(getActivity()); } super.onDestroy(); } //     @Override public void onClick(View v) { switch (v.getId()) { case R.id.tb_disable_ads: // disable ads ? setText(..OFF) : setText(..ON) // if state ON (disableAds - false) // true - ads disabled; false - ads enabled if (!bDisableAds &amp;&amp; readyToPurchase) { //       ,   "   " bp.purchase(getActivity(), InAppBillingResources.getSKU_DisableAds()); } break; case R.id.btn_ready_to_viewing: //    ,     if (mRewardedVideoAd.isLoaded()) { mRewardedVideoAd.show(); } break; case R.id.btn_disable_ads_per_hour: //   1  disableAdsPerPeriod(DISABLE_ADS_PERIOD_1_HOUR); adsViewedCounter--; updateTextView(); updateButtons(); break; case R.id.btn_disable_ads_per_day: //   1  disableAdsPerPeriod(DISABLE_ADS_PERIOD_24_HOURS); clearAdsCounter(); updateTextView(); updateButtons(); break; default: break; } // true - ads disabled; // false - ads enabled if (bDisableAds) { tbDisableAds.setChecked(false); showSnackbar(); } } // ========================================================== // [START REWARDEDVIDEOAD] private RewardedVideoAdListener rewardedVideoAdListener = new RewardedVideoAdListener() { @Override public void onRewardedVideoAdLoaded() { //      ,    btnReadyToViewing.setText(ready); btnReadyToViewing.setEnabled(true); } @Override public void onRewardedVideoAdOpened() { } @Override public void onRewardedVideoStarted() { //         btnReadyToViewing.setText(notReady); btnReadyToViewing.setEnabled(false); } @Override public void onRewardedVideoAdClosed() { //     loadRewardedVideoAd(); } @Override public void onRewarded(RewardItem rewardItem) { //          ,    if (adsViewedCounter &lt; VIEWED_ADS_NUMBER_PER_DAY) { adsViewedCounter++; } //    updateTextView(); updateButtons(); } @Override public void onRewardedVideoAdLeftApplication() { } @Override public void onRewardedVideoAdFailedToLoad(int i) { //    loadRewardedVideoAd(); } }; private void loadRewardedVideoAd() { //      ,    if (internet) { mRewardedVideoAd.loadAd(mContext.getString(R.string.admob_rewarded_video_id), mAdRequest); } } // [END REWARDEDVIDEOAD] // ========================================================== //          //      ,     private void updateTextView() { // true - disable | false - enabled if (bDisableAds) { tvViewedAds.setText(String.valueOf(adsViewedCounter)); tvEstimatedDate.setText(""); } else { // [START UPDATETEXTVIEW : tvViewedAds] if (adsViewedCounter &gt; 0 &amp;&amp; adsViewedCounter &lt;= VIEWED_ADS_NUMBER_PER_DAY) { String strViewedAdsCount = adsViewedCounter + " / " + VIEWED_ADS_NUMBER_PER_DAY; tvViewedAds.setText(strViewedAdsCount); } else { tvViewedAds.setText(VIEWED_ZERO_VIDEO_ADS); } // [END UPDATETEXTVIEW : tvViewedAds] // [START UPDATETEXTVIEW : tvEstimatedDate] long estimatedDate = prefManager.getEstimatedAdsTime(); long currentDate = System.currentTimeMillis(); if (estimatedDate != 0 &amp;&amp; estimatedDate &gt; currentDate) { String strEstimatedDate = convertTime(estimatedDate); String strEstimatedDateFinal = "&lt;b&gt;" + mContext.getString(R.string.txt_tv_header_estimated_time).toUpperCase() + "&lt;/b&gt;" + "&lt;br&gt;" + strEstimatedDate; tvEstimatedDate.setText(Html.fromHtml(strEstimatedDateFinal)); } // [END UPDATETEXTVIEW : tvEstimatedDate] } } //   private void updateButtons() { // 0 if (adsViewedCounter == 0) { btnDisableAdsPerHour.setEnabled(false); btnDisableAdsPerDay.setEnabled(false); } // 1 - 4 if (adsViewedCounter &gt; 0 &amp;&amp; adsViewedCounter &lt; VIEWED_ADS_NUMBER_PER_DAY) { btnDisableAdsPerHour.setEnabled(true); } // 5 if (adsViewedCounter == VIEWED_ADS_NUMBER_PER_DAY) { btnDisableAdsPerHour.setEnabled(true); btnDisableAdsPerDay.setEnabled(true); } } //      private void disableAdsPerPeriod(long disablePeriod) { //     long currentDate = System.currentTimeMillis(); //      long estimatedDate = currentDate + disablePeriod; //      prefManager.setEstimatedDate(estimatedDate); //     AdMobAds.disableBanner(getActivity(), true); } //   private void clearAdsCounter() { adsViewedCounter = 0; } //         public String convertTime(long time) { Date date = new Date(time); Format format = new SimpleDateFormat("dd MMM yyyy @ HH:mm:ss"); return format.format(date); } // ========================================================== // [START IN APP BILLING] BillingProcessor.IBillingHandler bpHandler = new BillingProcessor.IBillingHandler() { @Override public void onProductPurchased(@NonNull String productId, @Nullable TransactionDetails details) { // Called when requested PRODUCT ID was successfully purchased // ,   PRODUCT ID    if (bp.isPurchased(productId)) { //     ""   ""  - setAdsDisable(); tbDisableAds.setChecked(false); //   restartDialog(); } else { //   "" tbDisableAds.setChecked(true); } } @Override public void onPurchaseHistoryRestored() { //,     , //          Google Play } @Override public void onBillingError(int errorCode, @Nullable Throwable error) { // ,   . .   //      } @Override public void onBillingInitialized() { // ,  bp       readyToPurchase = true; } }; // [START IN APP BILLING] // ========================================================== //      private void setAdsDisable() { prefManager.setAdsDisabled(); } //    // [START restartDialog] private void restartDialog() { AlertDialog.Builder builder; View alertLayout = View.inflate(mContext, R.layout.dialog_restart, null); if (prefManager.getAppTheme() == 0) { builder = new AlertDialog.Builder(getActivity(), R.style.AppThemeDialogStyleLight); } else { builder = new AlertDialog.Builder(getActivity(), R.style.AppThemeDialogStyleDark); } builder.setTitle(getActivity().getString(R.string.msg_notification_Title)); builder.setView(alertLayout); builder.setPositiveButton(getActivity().getString(R.string.ans_restart), new DialogInterface.OnClickListener() { @Override public void onClick(DialogInterface dialog, int which) { restartApp(); } }); builder.show(); } // [END restartDialog] //    // [START restartApp] private void restartApp() { Intent i = getActivity().getPackageManager().getLaunchIntentForPackage(getActivity().getPackageName()); if (i != null) { i.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP); getActivity().startActivity(i); } } // [END restartApp] // Snackbar  ,    .         private void showSnackbar() { Snackbar.make(getActivity().getWindow().getDecorView().getRootView(), getActivity().getResources().getString(R.string.advertising_is_already_disabled), Snackbar.LENGTH_SHORT).show(); } }</span></span></code> </pre><br></div></div><br>  Class work with the banner AdMob.  Nothing complicated, publish for review.  Although I‚Äôve posted it on StackOverFlow too <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AdMobAds</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">disableBanner</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Activity activity, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> disableAds)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> View adsContainer = activity.findViewById(R.id.container); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AdView adView = (AdView) activity.findViewById(R.id.adView); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (disableAds) { adView.setVisibility(View.GONE); adsContainer.setPadding(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { AdRequest adRequest; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BuildConfig.DEBUG) { adRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdRequest.Builder() .addTestDevice(DeviceHash.getHtcDeviceHash()) .build(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { adRequest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdRequest.Builder() .build(); } adView.loadAd(adRequest); adView.setAdListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AdListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAdFailedToLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> errorCode)</span></span></span><span class="hljs-function"> </span></span>{ MyAppLogs.show(<span class="hljs-string"><span class="hljs-string">"[bottom-banner] &gt;&gt; onAdFailedToLoad:   \terrorCode = "</span></span> + errorCode + <span class="hljs-string"><span class="hljs-string">"."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAdFailedToLoad(errorCode); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAdLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAdLoaded(); MyAppLogs.show(<span class="hljs-string"><span class="hljs-string">"[bottom-banner] &gt;&gt; onAdLoaded"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (adView.getVisibility() == View.GONE) { adView.setVisibility(View.VISIBLE); } View adsContainer = activity.findViewById(R.id.container); adsContainer.setPadding(adsContainer.getPaddingLeft(), adsContainer.getPaddingTop(), adsContainer.getPaddingRight(), adView.getHeight() + <span class="hljs-number"><span class="hljs-number">8</span></span>); } }); } } }</code> </pre><br>  <a href="https://habr.com/ru/post/349832/">[back to content]</a> <br><br><a name="part4"></a><h4>  Conclusion </h4><br>  That's all.  The essence of the article is to share with the community its idea and its implementation.  And also get an invitation to Habrahabr, if someone likes what I shared.  I will be glad and grateful for your opinion in questions of finalizing the code and / or ideas.  If you need additional clarification - write, I will in the shortest possible time make corrections to the article or give an answer in the comments. <br><br>  For obvious reasons, the link to the application is not published in the public domain.  Ethics is ethics!  Who needs - I will give in HP. <br><br>  AdMob statistics is still raw, only 2 weeks have passed since the introduction of this alternative.  Not all users updated.  But for sure there are those who use this way to turn off the banner below. <br><br>  <b>UPDATE: Link to the article with the results</b> <a href="https://habr.com/post/359124">TOTAL 3 months: Alternative to a paid outage of advertising in the free Android application</a> <br><br>  I thank everyone who read the article to the end! </div><p>Source: <a href="https://habr.com/ru/post/349832/">https://habr.com/ru/post/349832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349820/index.html">–ï–ì–ê–ò–° 3.0 - 100% readiness! Alcohol accounting markup</a></li>
<li><a href="../349822/index.html">Qt: Writing a generic model for QML ListView</a></li>
<li><a href="../349824/index.html">Drop Stack Overflow: What Happened</a></li>
<li><a href="../349826/index.html">Sleight of hand and no fraud: practical tips on accelerated design training for developers</a></li>
<li><a href="../349830/index.html">Personal experience: a selection of materials about the virtual infrastructure, information security and trends in the IaaS market</a></li>
<li><a href="../349836/index.html">Understanding Dependencies</a></li>
<li><a href="../349838/index.html">The story of the internet in Germany and the undocumented features of Juniper SRX</a></li>
<li><a href="../349840/index.html">iPaaS - cloud ESB ... or not?</a></li>
<li><a href="../349842/index.html">Check Point Technical Support (TAC). Quick Start Guide</a></li>
<li><a href="../349844/index.html">Microsatellites for Earth Remote Sensing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>