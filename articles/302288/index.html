<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Requests to the Rest API from JavaScript are compact and beautiful</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I did a small project here on pure JS and during this I needed to work with the Rest API. Well, not with XMLHttpRequest handles to pull, I decided, fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Requests to the Rest API from JavaScript are compact and beautiful</h1><div class="post__text post__text-html js-mediator-article"><p>  I did a small project here on pure JS and during this I needed to work with the Rest API.  Well, not with XMLHttpRequest handles to pull, I decided, for sure there are countless ready-made solutions for such a simple task? .. </p><br><p>  As you can guess from the KDPV, I was somewhat mistaken;  however, first things first.  But if in brief - it turned out <a href="https://github.com/Amareis/another-rest-client">such a pretty bike</a> , with which requests to the Rest API are obtained, as promised in the title, compact and beautiful. </p><br><p><img src="https://habrastorage.org/files/646/7c5/6df/6467c56dfdce4ae4a52bc918f7766407.jpg" alt="image"></p><a name="habracut"></a><br><h1>  Candidates </h1><br><p>  So, I needed a Java API client for the Rest API.  <a href="http://www.google.com/search%3Fq%3Djs%2Brest%2Bapi%2Bclient">Google</a> issued a bit of libraries - <a href="">restful.js</a> , <a href="https://github.com/cujojs/rest">rest</a> , <a href="https://github.com/lincolnloop/amygdala">amygdala</a> .  Actually, there was another <a href="https://github.com/jpillora/jquery.rest/">such</a> library, but this is a jQuery plugin.  jQuery in the project is not used and drag it somehow did not want to;  but, in part, I liked the syntax offered by the library and it will still pop up later. </p><br><p>  Amygdala disappeared immediately - no Promise, which means no async / await.  Its functionality bounds are also strange, amygdala rather claims something like an under-data-layer;  about the absence of a downgraded version and unnecessary dependencies, I tactfully keep silent. <br>  There are two candidates left - restful.js and rest. </p><br><p>  rest offers a kind of minimal core and gives ample opportunities for its customization with the help of so-called "interceptors" - interceptors in the original.  I don‚Äôt know how cool it is - the prospect of building full URLs and indicating the method with my hands with each request didn‚Äôt tempt me at all, there were no interceptors for modifying this behavior, and the documentation didn‚Äôt delight.  I switched to the last option - restful.js. </p><br><blockquote>  RESTful resources.  Think Restangular without Angular. </blockquote><br><p>  Actually, I prefer Ember, but what's the difference?  The main thing is that it was convenient to use! </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> articleCollection = api.all(<span class="hljs-string"><span class="hljs-string">'articles'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// http://api.example.com/articles // http://api.example.com/articles/1 api.one('articles', 1).get().then((response) =&gt; { const articleEntity = response.body(); // if the server response was { id: 1, title: 'test', body: 'hello' } const article = articleEntity.data(); article.title; // returns `test` article.body; // returns `hello` // You can also edit it article.title = 'test2'; // Finally you can easily update it or delete it articleEntity.save(); // will perform a PUT request articleEntity.delete(); // will perform a DELETE request }, (response) =&gt; { // The reponse code is not &gt;= 200 and &lt; 400 throw new Error('Invalid response'); });</span></span></code> </pre> <br><p>  This is <a href="">an example from the documentation</a> .  It looks good in comparison with competitors, and the documentation is quite intelligible ... There are no options anyway.  Take?  We take. </p><br><h1>  Small lyrical digression </h1><br><p>  There is such a concept of "reasonable silence", which implies, if you retell in your own words that the solution of a certain problem is sharpened, conditionally, under 90% of user cases, and in the remaining 10% you need to explicitly say that there are special circumstances. </p><br><p>  A trivial example of this concept is the default settings in most programming languages. </p><br><p>  Much less trivial example (which is, nevertheless, just a generalization of the previous one) - optimization of any interface based on the expected behavior of the user, be it a command, graphic, software or physical interface: switches there, buttons and other hardware twirls. </p><br><p>  The overall strategy of these optimizations is the same - 90% of users must take as few actions as possible to achieve their goals.  It would not be a great exaggeration to say that this is the general formula for progress - the invention of more and more simple, in terms of the number of necessary movements, interfaces for solving all the same tasks. <br>  And, in general, these most reasonable defaults are one of the main ways to simplify. </p><br><p>  Why do I play Captain Obvious, spreading over the head of a tree?  Because the next bike is just another bike, but a bike with a philosophical base under it is no longer just another bike, but can even be seen from afar on a motorcycle! <br>  The end of a small lyrical digression. </p><br><h1>  restful.js </h1><br><p>  So restful.js.  I used it extremely briefly - and a couple of days did not pass, as I understood that: </p><br><ol><li><p>  Each time, it is not cool to call all () explicitly. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> games = api.all(<span class="hljs-string"><span class="hljs-string">'games'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//&lt;--   games.get(); //... games.post();</span></span></code> </pre> <br><p>  API resources are what underlie the whole frontend, so how are they created manually each time?  These are the things that should be sewn into the fabric of the project. <code>api.games.get(); api.games.post()</code>  <code>api.games.get(); api.games.post()</code> - it looks much better (yes, it was just the influence of the syntax of that library on jQuery).  However, it was still possible to get around, we are dynamic boyars: <code>api.games = api.all('games');</code> </p><br></li><li><p>  Manually expanding the response and entity is not cool at all! </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> games = (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> api.games.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>()).body().data(); <span class="hljs-comment"><span class="hljs-comment">//&lt;-- that sucks</span></span></code> </pre> <br><p>  My eyes would not see, fingers would not write;  but I had to.  Here those interceptors from rest would be useful, there the functionality of deploying a raw response to an object is just implemented.  Restful.js also has interceptors, but here they are more modest, not that. </p><br></li><li>  Oh, and also - the above line of code is already twice incorrect.  First, not get, but getAll, we are requesting the collection, not a separate instance.  Secondly, the data () of the collection is not defined - you get <code>Uncaught (in promise) TypeError: _temp.body(...).data is not a function</code> .  Be kind, use forEach, defined as a method on the entity, which is returned by body () on response, which is returned by getAll (). </li></ol><br><p>  In general, a classic example of an uncomfortable interface.  I don‚Äôt know if it‚Äôs the influence of an angulyar, which seems to be famous for its academic character, or it‚Äôs more about orientation by the framework rather than the library, but I didn‚Äôt like the interface offered restful.js much.  In fact, according to the result, I liked it, probably even less than the interface of competitors - apparently, the effect of an <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2589%25D0%25B0%25D1%258F_%25D0%25B4%25D0%25BE%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25B0">ominous valley</a> affects: close to the ideal, but not reached, and from love to hate only one bike. </p><br><h1>  What did I do? </h1><br><p>  I threw restful.js and threw two classes, which in 150 lines of code did in principle the same as restful.js for 6000 (six thousand, <a href="">this is not a typo</a> ). <br>  Then I thought, put it on <a href="https://github.com/Amareis/another-rest-client">github</a> , refactored, mastered the webpack (great stuff!), Mocha + chai, sinon and travis, laid it out on <a href="https://www.npmjs.com/package/another-rest-client">npm</a> and bower, wrote the documentation, wrote an example and finally wrote this article to make life easier for those who encounter with the same problem. </p><br><p>  At the moment (June 2016) there are not enough tests, there are no HEAD and OPTIONS methods, it is difficult to get a raw answer and too few badges in the README (only one, what a shame! ..). <br>  However, this is all easy to fix.  The main thing is that another-rest-client provides a clear and simple interface that I like working with;  I hope that not only me. </p><br><h1>  Some code </h1><br><p>  Using the github API: </p><br><pre> <code class="hljs pgsql">var api = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> RestClient(<span class="hljs-string"><span class="hljs-string">'https://api.github.com'</span></span>); api.res({repos: <span class="hljs-string"><span class="hljs-string">'releases'</span></span>}); api.repos(<span class="hljs-string"><span class="hljs-string">'Amareis/another-rest-client'</span></span>).releases(<span class="hljs-string"><span class="hljs-string">'latest'</span></span>).<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>().<span class="hljs-keyword"><span class="hljs-keyword">then</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>){ console.log(<span class="hljs-keyword"><span class="hljs-keyword">release</span></span>); document.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-string"><span class="hljs-string">'Latest release of another-rest-client:&lt;br&gt;'</span></span>); document.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-string"><span class="hljs-string">'Published at: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">release</span></span>.published_at + <span class="hljs-string"><span class="hljs-string">'&lt;br&gt;'</span></span>); document.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(<span class="hljs-string"><span class="hljs-string">'Tag: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">release</span></span>.tag_name + <span class="hljs-string"><span class="hljs-string">'&lt;br&gt;'</span></span>); });</code> </pre> <br><p>  Investments?  Easily: </p><br><pre> <code class="hljs python">var api = new RestClient(<span class="hljs-string"><span class="hljs-string">'http://example.com/api/v1'</span></span>); api.res({ //<span class="hljs-keyword"><span class="hljs-keyword">or</span></span> it gets object <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> returns object where resource <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> available by name dogs: [ <span class="hljs-string"><span class="hljs-string">'toys'</span></span>, <span class="hljs-string"><span class="hljs-string">'friends'</span></span>], cats: <span class="hljs-number"><span class="hljs-number">0</span></span>, humans: <span class="hljs-string"><span class="hljs-string">'posts'</span></span> }); /* last string <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> equal to: api.res(<span class="hljs-string"><span class="hljs-string">'dogs'</span></span>).res([<span class="hljs-string"><span class="hljs-string">'toys'</span></span>, <span class="hljs-string"><span class="hljs-string">'friends'</span></span>]); api.res(<span class="hljs-string"><span class="hljs-string">'cats'</span></span>); api.res(<span class="hljs-string"><span class="hljs-string">'humans'</span></span>).res(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>); */ api.dogs(<span class="hljs-number"><span class="hljs-number">1337</span></span>).toys.get(); //GET http://example.com/api/v1/dogs/<span class="hljs-number"><span class="hljs-number">1337</span></span>/toys api.dogs(<span class="hljs-number"><span class="hljs-number">1337</span></span>).friends(<span class="hljs-number"><span class="hljs-number">2</span></span>).delete(); //DELETE http://example.com/api/v1/dogs/<span class="hljs-number"><span class="hljs-number">1337</span></span>/friends/<span class="hljs-number"><span class="hljs-number">2</span></span> //POST http://example.com/api/v1/humans/me/posts, body=<span class="hljs-string"><span class="hljs-string">"{"</span></span>site<span class="hljs-string"><span class="hljs-string">":"</span></span>habrahabr.r<span class="hljs-string"><span class="hljs-string">u","</span></span>nick<span class="hljs-string"><span class="hljs-string">":"</span></span>Amareis<span class="hljs-string"><span class="hljs-string">"}"</span></span> api.humans(<span class="hljs-string"><span class="hljs-string">'me'</span></span>).posts.post({site: <span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span>, nick: <span class="hljs-string"><span class="hljs-string">'Amareis'</span></span>});</code> </pre> <br><p>  With async / await, the code is much more fun: </p><br><pre> <code class="hljs pgsql">var me = api.humans(<span class="hljs-string"><span class="hljs-string">'me'</span></span>); var i = await me.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(); console.log(i); //just <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>, ie {id: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Amareis'</span></span>, profession: <span class="hljs-string"><span class="hljs-string">'programmer'</span></span>} var post = await me.posts.post({site: <span class="hljs-string"><span class="hljs-string">'habrahabr.ru'</span></span>, nick: i.name}) console.log(post); //<span class="hljs-keyword"><span class="hljs-keyword">object</span></span></code> </pre> <br><h1>  Random Fun Facts </h1><br><ol><li>  Why such a name?  Well, initially it was just rest-client.  But this name (as well as a few more similar ones) is taken up in npm, and the uniqueness is so-so, so I added a bit of self-irony and it became another-rest-client. </li><li>  At the <a href="https://github.com/marmelab/restful.js/tree/eea59ff38abb348fd71ec4716250f21fc94edd0f">very beginning of its existence,</a> restful.js was very similar to the first versions of another-rest-client.  Then, apparently, slipped into the enterprise. </li><li>  In the code another-rest-client there are only two comments (and I am outraged by the fact that there are too many of them) and both of them contain curses in the direction of Javascript, which does not allow making the code completely beautiful. </li><li>  I still do not understand how the WTFPL differs from the MIT license. </li></ol><br><p>  Thanks for attention. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/302288/">https://habr.com/ru/post/302288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../302276/index.html">Virus living exclusively in PLC</a></li>
<li><a href="../302278/index.html">Docker Container Development with Sparrow Multipurpose Scripting System</a></li>
<li><a href="../302280/index.html">Events in Angular Light</a></li>
<li><a href="../302284/index.html">RxJS: Reactive Extension for Front End Development</a></li>
<li><a href="../302286/index.html">DUMP-2016: video of all reports in one post. Is free. Without SMS</a></li>
<li><a href="../302290/index.html">Tehnostart-2016 Student IT Project Championship</a></li>
<li><a href="../302292/index.html">We struggle with remote control: how to disable Intel ME</a></li>
<li><a href="../302296/index.html">Space network data center</a></li>
<li><a href="../302298/index.html">I invite you to a virtual reality party VR-Today</a></li>
<li><a href="../302300/index.html">Storage Market Perspectives</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>