<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The older Spring, the more contexts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For many years working with spring, I noticed a funny pattern: in each new version a new way of configuring the context is added. Let's remember how i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The older Spring, the more contexts</h1><div class="post__text post__text-html js-mediator-article">  For many years working with spring, I noticed a funny pattern: in each new version a new way of configuring the context is added.  Let's remember how it was: <br><ul><li>  In the first spring, the configuration could be written exclusively on xml-e.  (ClassPathXmlApplicationContext (‚Äúcontext.xml‚Äù)) </li><li>  In the second (more precisely, from 2.5) it became possible to create a context through annotations.  (AnnotationConfigApplicationContext (‚Äúpackage.name‚Äù)) </li><li>  The third spring added a configuration on java.  (AnnotationConfigApplicationContext (JavaConfig.class)) </li><li>  The fourth one has also preserved the tradition and since December 2013 it can be configured using the groove of scripts (GenericGroovyApplicationContext (‚Äúcontext.groovy‚Äù)) </li></ul><br>  Consultation and conducting trainings in different companies, I saw a very different attitude to these methods of configuration.  Large companies, often living according to the principle ‚Äúworks - don't touch‚Äù, still cherish the old xml configurations, continuing to multiply and feed them with new bins.  ‚ÄúBut we have everything centralized!‚Äù - their architects shout, adding a 100,500 thousandth line to the xml-God. <br>  Smaller companies, trying to keep up with the innovation of technology, mercilessly burn old XMLs, rewriting everything they can, to annotations, and what they cannot to Java-config.  And they are already rubbing their hands, trying to think of, and where would they now stick the configuration on the grooves. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ef/cc9/be9/2efcc9be9049e771f085b88b4c615409.jpg"><br><br>  I saw absolutely funny situations when a junior who is not very well versed in all this mess, duplicated the bins declaration, writing them in the xml-e and through annotations (well, so for sure). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And where is the truth?  Is as always in the middle? <br>  Let's try to figure it out ... <br><br>  First, let's compare the bean declaration strategies. <br><br><h5>  Let's start with the classic XML-a: </h5><br><a name="habracut"></a><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans....</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.inwhite.spring.compare.CoolDaoImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"coolDao"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"coolService"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.inwhite.spring.compare.CoolServiceImpl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">init-method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"init"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">destroy-method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"closeResources"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prototype"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">property</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"dao"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"coolDao"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><h5>  Now the same, but with the help of annotations </h5><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Repository</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolDaoImpl</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoolDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doCRUD</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//some logic here } } @Service @Scope(BeanDefinition.SCOPE_PROTOTYPE) public class CoolServiceImpl implements CoolService { @Autowired private CoolDao dao; @PostConstruct public void init() { //init logic here } @PreDestroy public void closeResources() { //close resources here } @Override public void doWork() { dao.doCRUD(); } }</span></span></code> </pre><br><br><h5>  Once more, but with the configuration on Java: </h5><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JavaConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CoolDao </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoolDaoImpl(); } <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span>(initMethod = <span class="hljs-string"><span class="hljs-string">"init"</span></span>, destroyMethod = <span class="hljs-string"><span class="hljs-string">"closeResources"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Scope</span></span>(BeanDefinition.SCOPE_PROTOTYPE) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CoolService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">coolService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ CoolServiceImpl service = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CoolServiceImpl(); service.setDao(dao()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> service; } }</code> </pre><br><br><h5>  And finally, the same thing on the groove: </h5><br><pre> <code class="java hljs">beans { coolDao(CoolDaoImpl) coolService(CoolService){bean-&gt; bean.scope = <span class="hljs-string"><span class="hljs-string">'prototype'</span></span> bean.initMethod = <span class="hljs-string"><span class="hljs-string">'init'</span></span> bean.destroyMethod = <span class="hljs-string"><span class="hljs-string">'closeResources'</span></span> } }</code> </pre><br><br>  If we compare the expended efforts, then annotations are in the lead for this configuration (there are only 6 of them, minus the setter). <br>  But since the configuration of a full-fledged application (and not a separate module), which also includes third-party libraries, cannot be kept only on annotations, it would be more honest to compare between the Groovy, Java and XML configurations.  Even without glasses, it is clear that the configuration on the groove is leading in brevity and elegance, but I would like to leave it for a snack.  Moreover, it is not yet fully finished. <br><br>  In the meantime, let's discuss the advantages and disadvantages of what was before Spring 4. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4ec/c2a/b5c/4ecc2ab5c8c2ce97ebb07c1d43453cc9.jpg"><br><br>  After reading the last line, the harsh critics have probably already made a mark for themselves, they say aha, the author of the article is not aware of Factory Beans, SpEL and any tricky profiles ... But let's be honest, XML has already earned a lot of advantages in this table, and on their background This plus will look far-fetched.  SpEL is quite limited, and Factory Beans are not part of XML-a.  And honestly, even the most ardent fans of XML would hardly have chosen it as a programming language. <br><br>  Another question that I often get asked at trainings: ‚ÄúWhy not recompile when changing the configuration is a plus?  Who will risk on the production to change the implementation of the bins without having banished the tests after this?  And all sorts of little things like names, passwords and ports can be simply kept in the files whose contents can also be changed without recompiling. ‚Äù <br><br>  Here it will be appropriate to tell one case from my practice, which can be titled something like this: <br><br><h5>  How XML with JBoss th party saved </h5><br>  A few years ago, I worked in a single IT company where, for security reasons, programmers could not connect to the work environment via remote access.  And after another week of work, we went to rest.  We sit in the pub, the time is the beginning of the third morning, the mood is excellent, and suddenly, our support call.  Come, says urgently.  Production falls. <br><br>  Common situation?  There are many reasons for not wanting to go to work on Friday night ... In my attempts to persuade him to try to solve everything on the phone, he insists that he is only a support and the only thing he can do is dial the phone number of the one who needs to be called.  In the end, he nevertheless agreed to read me an exception.  The problem turned out to be trivial: one of the web services began to fail, and the bin that addressed it threw out an exeptnn due to which the entire application fell.  Apparently, the author of Bina did not expect such an ambush, and the expedition was not caught.  And since this did not happen before, QA missed this code in production. <br><br>  And I knew perfectly well that nothing could be done until Monday, since the web service is not ours, and there is nobody to talk to.  But it was impossible to leave everything as it was, on the server there were still many other jobs that could work fine if you throw the problematic bin out of context.  I will not go into details, but I am sure that you yourself can think out a similar scenario.  The question is how to change the configuration on the phone, talking to a person who does not understand anything in the code. <br><br>  Fortunately for me, this bin was registered in xml-e.  Then the following dialogue took place: <br>  ‚ÄúGo to the comp production, open the JBoss / server / default / deploy folder, find the idi.ear file there and open it.  What do you mean, how?  Okay, rename it to zip and open it.  Great, do you see the META-INF folder there?  Does it have applicationContext.xml?  Go into it, find a SchedulerFactoryBean there and just below there is a datacarTrigger.  Comment out this line.  What do you mean, how?  It does not matter, erase it.  Great, now write it down, close it, rename it back to ear, and turn on the server in a new way. ‚Äù <br><br>  Well and everything, further the happy end.  Now imagine that this bin would be registered in the java config ... Apparently you would have to go to work. <br><br>  You can tell a lot of such stories, and the ability to change the configuration without compiling anything and not building anew is often a big plus.  Starting from aspects that need to be turned on, then off, then reconfigured, and ending with delivery-oriented companies that customize the same product for different customers. <br><br>  Such an architect initially implies that xml will lie outside the archive (war, ear), and where it is easy to reach.  And most likely, in companies where such an approach is used, there is an entire ecosystem, honed under such dynamism, with special tests and roller backs. <br><br>  On the other hand, when it comes to complex configurations that cannot be purely declarative, working with XML becomes extremely inconvenient.  All the crutches invented for this even in the first versions of Spring make the configuration very confusing and difficult to maintain. <br>  . <br>  Java configuration has a big advantage in such cases.  All bins, settings that require a certain business logic, it is much more correct to write in it.  Not to mention the fact that for a Java developer it is much more pleasant to write Java, and not XML. <br><br>  Another small, but still the advantage of a Java configuration is performance.  We all know, since high school, that "reflexion slows down."  And bins written in XML-e or using annotations will be created using it.  If they are all singletons, then this is not so important: just the bootstrap time will increase slightly.  However, if your program constantly creates prototypes, Reflection is not desirable.  Well, with the configuration in Java, reflex is simply not used.  Beans are created using regular Java code. <br><br>  The advantage of annotations is that they reduce the configuration.  In addition, if each new bin, forcing the developer to run into the config, and something there to edit or append, then in addition to the inconvenience and permanent murgi, there is a chance that someone will accidentally ruin someone else's.  In addition, as we well know, if in the first act a gun hangs on the stage ... <br><br>  That is why, far from every company, architects allow everyone to poke around in the config file and prescribe their bins there, for fear of Krivoruk programmers who do not know what they are doing. <br><br>  Someone will say, they say, but we do not use annotations at all: yes it is not always convenient, but everything is centralized.  Well, here one of two things, either your project is very small, and the cat wept for springing in it, or all this ‚Äúcentralization‚Äù does not bring clarity.  Huge XML or Java configs, which only a chess grandmaster can understand, ultimately lead to even more confusion. <br><br><h4>  Results </h4><br>  All of our classes, which should be Spring bins, are declared and set up with annotations, beautifully arranged by package and scanned, as directed by the central configuration. <br>  All bins from third-party libraries, and what needs a complex configuration is defined in the Java config. <br>  And that part of the configuration that needs dynamism is put into XML, which, in addition, can also be stored as an external resource. <br><br>  Why was it necessary to invent a configuration on Groovy, when even without it there was already a mess?  Gruvy, of course, is in fashion today, but is this a reason to add another configuration, increasing confusion?  Let's understand what its essence? <br><br><h5>  Config on Groovy </h5><br>  The idea behind the Groovy configuration is to replace everything except annotations.  It has all the advantages of XML - because it is a script, and you can also keep it as an external resource.  Moreover, the dynamism can be even more, in potential, changes in the configuration will not require a restart. <br>  On the other hand, it also has all the advantages of a Java config, and moreover, the code on the groove is more concise, more elegant and more powerful. <br>  However, at this stage, it cannot be fully used instead of the Java configuration, because there is no support for namespacs for @EnableAspectJAutoProxy, @EnableAsync, and much more.  This, of course, can be solved by setting all the necessary bins in the configuration, but in order not to bother, it is easier for now to leave the Java config.  But XML can already be thrown out :) <br><br>  Feeling the fists clenching from the XML supporters from the last phrase, I propose to arrange a battle. <br>  All optimists who are not afraid of new technologies are invited to the blue corner of the ring; on the contrary, they are trying to implement them in order to move forward and move their company.  They will fight for maximum dynamism, for the possibility of developers to do more and easier, for Agile development and for technical innovations. <br>  Realists, taught by bitter experience, who know what will happen when everyone has the power, are invited to the red corner of the ring.  These people today appreciate the fact that the configuration on Java is Type Safe, and XML does not give anyone the opportunity to break firewood. <br><br>  In the meantime, the battle continues, I venture to express my assumption as to how the war against the XML will end.  Let's look at the picture again and remember the old movie: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ef/cc9/be9/2efcc9be9049e771f085b88b4c615409.jpg"><br>  Schwarzenegger, of course, eventually won, but at what price ... <br><br>  Well, if someone wants to continue the battle live, come to my report: <a href="http://javapoint.ru/talks/">Spring the Ripper</a> , who wants to seriously improve their skills - come to the <a href="http://jugru.timepad.ru/event/113437/">Spring for Seniors</a> training </div><p>Source: <a href="https://habr.com/ru/post/218203/">https://habr.com/ru/post/218203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../218193/index.html">How the Chinese printed 10 homes in one day</a></li>
<li><a href="../218195/index.html">One cool gist: whiteboardCleaner</a></li>
<li><a href="../218197/index.html">Some interesting and useful things for web developer # 15</a></li>
<li><a href="../218199/index.html">Best paid Photoshop plugins for web designers</a></li>
<li><a href="../218201/index.html">It's time to stop saving</a></li>
<li><a href="../218205/index.html">Project Lazybones - ‚ÄúLazy‚Äù that works for you</a></li>
<li><a href="../218207/index.html">Brenden Ike resigned as Mozilla leader under pressure from LGBT</a></li>
<li><a href="../218209/index.html">How I entered the distance education in the master course of Walden (USA)</a></li>
<li><a href="../218211/index.html">How a web-studio from Russia makes the first steps of opening a representative office in Germany (part 1 is theoretical)</a></li>
<li><a href="../218213/index.html">RAW Developers for Mac OS X RPP and Aperture: Apple Exclusive in the hands of amateur photographer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>