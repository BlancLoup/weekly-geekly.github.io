<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Download images in the background. JavaScript module</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago I started writing a large project with a high load, in which JavaScript features were widely used. During this time, many things had to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Download images in the background. JavaScript module</h1><div class="post__text post__text-html js-mediator-article">  Some time ago I started writing a large project with a high load, in which JavaScript features were widely used.  During this time, many things had to be rethought and faced with unusual problems and various tricks to solve them.  About one of these tricks and will be discussed further. <br><br><a name="habracut"></a><br><h5>  Problem: </h5><br>  The site consists of a single page on which all the information is generated using ajax requests and a large number of scripts.  And with the growth of the functionality, the number of layouts and pictures that were originally on the download page increased.  If we add to this the function of predicting user actions and background content loading - the situation with the initial rendering of the page and the response time of the interface becomes quite sad. <br><br><h5>  Decision: </h5><br>  One of the measures to solve the problem was to write a module that would not only load pictures as needed, but also put stubs in case the download fails for some reason. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/74d/717/fd1/74d717fd17e278a0539d05a53005f626.png" alt="   . JavaScript" title="Download images in the background. Javascript"><br><br><h5>  When you need a script: </h5><br><ul><li>  You have a difficult site </li><li>  You load the information with ajax </li><li>  Many layouts that may not be shown to the user. </li></ul><br>  Using the script of delayed loading of images, you can upload content as needed, thereby reducing the load on the server and speeding up the site for the user. <br><br><h5>  How it works: </h5><br><ul><li>  You have some hidden page with pictures. </li><li>  Instead, load the image in 1px. </li><li>  The script runs through all the pictures, dividing them into groups. </li><li>  If you have free time without load, you can load pictures of a certain group with a script (if you assume that the user may need them soon). </li><li>  If the user requested your hidden page - you are showing pictures. </li><li>  If you entered the wrong address of the image - it will just leave your stub in 1px and will not change the image. </li></ul><br>  Download: <a href="http://rghost.ru/41226960">demo</a> , <a href="http://rghost.ru/41225910">the module itself</a> <br><br><h5>  Benefits: </h5><br>  The module is written in native javascript. <br>  No libraries are needed for his work. <br>  Compressed using Google Compressor to 1.5 kb. <br>  Supports chaining pattern.  That is, methods can be called like this: <br>  lazyLoadingImages.show ("1"). load ("2"). load ("3"); <br>  If desired, you can send a link to your object or variable in the module and avoid creating another global variable. <br><br><h5>  Using: </h5><br>  In the page header insert: <br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">defer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/lazyLoadingImages.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Describe the pictures in the document as follows: <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./images/empty.png"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">url</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./images/1200.jpg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"group1"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><h6>  Where: </h6><br>  src = "./ images / empty.png" - the address of the image is a 1px stub <br>  url = "./ images / 1200.jpg" - the address of the original large image <br>  type = "group1" - group ID, optional parameter <br><br><img src="https://habrastorage.org/getpro/habr/post_images/102/8ec/588/1028ec588d3e0a7807bea0c644596ae4.png" alt="   . JavaScript" title="Download images in the background. Javascript"><br><br><h5>  Interface </h5><br>  Upon the DOMContentLoaded event (the end of the DOM download), the global object that was thrown into the module is assigned the lazyLoadingImages method (by default, this is window.lazyLoadingImages). <br><br>  <b>lazyLoadingImages.update ()</b> - updates the list of images and remembers their url to download original images.  This method is called automatically when the module is initialized.  May be useful if the DOM page has changed. <br><br>  <b>lazyLoadingImages.load (type)</b> - will load pictures of a certain group (the type parameter indicates which one).  The type parameter is optional.  By default, it loads images that have no group ID specified. <br><br>  <b>lazyLoadingImages.show (type)</b> - show pictures of a specific group (the type parameter indicates which one).  The type parameter is optional.  By default, it shows images that have no group ID specified. <br><br>  <b>UPD:</b> <br>  Due to the fact that rghost is not available <a href="https://github.com/bakhirev/lazyLoadingImages">link to GitHub</a> <br>  MechanisM thanks for the comment, the parameters are renamed.  Now data-url and data-type. <br><br><h5>  About picture stub </h5><br><br>  When inserting pictures into a document (for example, displaying a long list of players via innerHTML) you can add a small trick: <br><ul><li>  All images are inserted with the property visibility = hidden (and better display: none) </li><li>  Hang onload event on all pictures </li><li>  If onload has occurred, remove visibility, if not, leave as is </li></ul><br><br>  It turns out that if there are no pictures on the server - we just have a white square in its place.  I also recommend setting the size in all the pictures, so that if there is just a white square left, it takes up the required area.  If necessary, in the same function, you can insert or remove alt and title images in the moments before and after loading. <br><br>  CSS <br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.visibility</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">visibility</span></span>: hidden; }</code> </pre><br><br>  Javascript <br><pre> <code class="javascript hljs">utils.showAfterLoading: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">node</span></span></span><span class="hljs-function">) </span></span>{ utils.removeClass(node, <span class="hljs-string"><span class="hljs-string">"visibility"</span></span>); }</code> </pre><br><br>  HTML <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" url"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"visibility"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utils.showAfterLoading(this)"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  <b>UPD2:</b> <br><br>  Added two methods according to the DjOnline notes: <br><br>  <b>lazyLoadingImages.onScroll (type)</b> - show pictures of a specific group (the optional parameter type indicates which one) when scrolling the page (namely, to start loading the image when the ‚Äúscreen half‚Äù remains).  By default, it shows images that have no group ID specified. <br><br>  <b>lazyLoadingImages.offScroll (type)</b> - cancels the display of a picture of a specific group (the optional parameter type indicates which one) when scrolling the page (see the method above).  By default, it resets onScroll to images with no group ID specified. <br><br>  So now the module can upload images when scrolling.  Weight: 2.7 kb <br><br>  Demo: <a href="http://encom-spb.ru/habr/lli/demo.html">here</a> or <a href="https://github.com/bakhirev/lazyLoadingImages/blob/master/demo.html">here</a> </div><p>Source: <a href="https://habr.com/ru/post/156589/">https://habr.com/ru/post/156589/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../156579/index.html">We collect and make run the budget hexapod</a></li>
<li><a href="../156581/index.html">Check the balance of the phone in the console</a></li>
<li><a href="../156583/index.html">Nokia is no longer among the Top 5 smartphone manufacturers</a></li>
<li><a href="../156585/index.html">Multitouch technology</a></li>
<li><a href="../156587/index.html">EGPU assembly experience and its interaction with a laptop</a></li>
<li><a href="../156591/index.html">Internet radio station on Liquidsoap + IceCast</a></li>
<li><a href="../156593/index.html">The whole truth about integer types in C</a></li>
<li><a href="../156597/index.html">Monitoring Windows services with PowerShell and Python</a></li>
<li><a href="../156599/index.html">‚ÄúMnemotechnics‚Äù and ‚Äúlearning a foreign language‚Äù are incompatible concepts ?! Let's see</a></li>
<li><a href="../156601/index.html">Why you shouldn‚Äôt part with your ‚Äúold‚Äù iPad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>