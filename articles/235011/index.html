<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making the game right before your eyes - part 7: 2D animations in Unity (‚Äúas in a flash‚Äù)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article will talk about 2D animations in Unity. I will talk about my experience of working with my family‚Äôs animations in a unit, about how timel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making the game right before your eyes - part 7: 2D animations in Unity (‚Äúas in a flash‚Äù)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e99/f1c/af4/e99f1caf4db1400bafeb0824b8398a77.gif" align="right">  This article will talk about 2D animations in Unity.  I will talk about my experience of working with my family‚Äôs animations in a unit, about how timelines are similar to the Flash ones, about managing animations, events, nesting, and how the artist copes with animation. <br><br>  For a start, a little theory. <br><br>  There are two entities in Unity: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. <b>Animation</b> (what is displayed in the "Animation" window) <br>  2. <b>Mechanim</b> animation tree (that is displayed in the window "Animator"). <br><br><img src="https://habrastorage.org/files/8d2/d4b/662/8d2d4b662d28469690e44190d88dcaa5.png"><br><br>  Below, I will tell you a little about what it is and how we may have to (or not be useful). <br><a name="habracut"></a><br><h4>  Animation </h4><br>  So, the animation.  In essence, this is a timeline with keyframes.  Here you can move, rotate, scale your objects.  Naturally, you can draw curves and use different isings.  And even manage any (including self-written) their properties.  That is, it is possible to write a component with a float public-value "brightness" and animate this very "brightness" along with x, y, z by standard means.  Sprites support frame-by-frame animation. <br><br><img src="https://habrastorage.org/files/427/ba2/46b/427ba246b8e6433fa939fd09517e6333.png"><br><br>  By the way, despite the fact that each animation has an FPS (‚Äúsample‚Äù field), the animations themselves are not attached to the FPS.  They are tied to time.  Those.  If you make an animation with 5 FPS, where your object moves from point A to point B by setting two keyframes at the beginning and end, then in the game this object will not move with 5 FPS steps.  The animation is calculated every frame of the game, and the FPS inside the animation is made only for your convenience, so that you do not part frames. <br><br><h4>  Animator </h4><br>  This is a large and complex system that directly controls the animations.  That is, the animation is just a file (resource) with the settings of key frames and by itself can not do anything.  That's exactly the component "Animator" - this is what can play these animations. <br><br>  In addition, you can create a tree of these animations with morphing in between.  Those.  if you have a character that is animated with relays (when each part of the body is a separate spraytik that you rotate / move), then it is quite possible to animate the legs separately, animating the arms separately.  And then (with the help of the mouse) adjust the condition that the speed of movement of your object, the mechanim animator will include either walking or running.  A shoot your character will be a separate animation, which has nothing to do with the speed of rearranging the legs. <br><br>  In the simplest case, your animator will look like this: <br><br><img src="https://habrastorage.org/files/7dc/04a/02f/7dc04a02fa7a456d943f7f7b36030786.png"><br><br>  that is, contain one single animation and no links / transitions. <br><br><h4>  Begin to shaman. </h4><br>  So far, everything is clear.  But let's think about how to do something a little more complicated? <br><br>  My particular case is that we have a snow drift in which the hare sits.  The drift itself moves: <br><br><img src="https://habrastorage.org/files/522/228/d8c/522228d8c95d4e0194de1bb1b70a4270.gif"><br><br>  Next, we want to make this animation: <br><br><img src="https://habrastorage.org/files/54b/498/7b3/54b4987b38d34861ba7682b58b98f4d0.png"><br><br>  1. the snowdrift, moving, moves to the left <br>  2. a hare peeps out of a snowdrift (the animation of the pulsation stops): <br><img src="https://habrastorage.org/files/e99/f1c/af4/e99f1caf4db1400bafeb0824b8398a77.gif"><br>  3. snowdrift moves to the right <br><br>  In principle, nothing complicated.  We animate the ripple of a snowdrift inside the object, with the external animator we move it to the left, then we hide it, instead we show a frame-by-frame animation of a peeping hare, then back.  And all this on one timeline (except for the ‚Äúinternal‚Äù animation of a snowdrift). <br><br>  But this option I do not like its rigidity.  First of all, I consider it wrong that in this version the frame-by-frame animation of a crawling rabbit turns out to be on the same timeline as the movement of the snowdrift.  This means that if we want to make a variation of this animation, where the snowdrift will move along a different path, we will have to re-animate the hare crawling out.  And if we later want to correct this getting out, we will have to do it in all the animations where it is used. <br><br>  I would like more flexibility. <br><br>  There is another option.  We animate the hare peeping in a separate object (just like we did with the movement of a snowdrift), but in the main time line we just turn on this object (active) at the right moment and the animation begins. <br><br>  This is much better, but still not perfect.  Indeed, in this case, we must in our main timeline know how long the animation of this climb is.  To enable and disable it at the right time.  But what if we again change this animation and the hare will look around longer?  And indeed, in some more complicated cases it will be even more difficult for us to fit everything in one timeline. <br><br>  It would be ideal to be able to pause the main timeline, start playing the nested animation and remove it from the pause after this nested animation is completed (or by some event in it). <br><br>  That is, do so: <br><br><img src="https://habrastorage.org/files/99e/c36/ad1/99ec36ad16a04ae091b81352c4a575e0.png"><br><br>  1. move left <br>  2. hide the pulsating snowdrift, show the rabbit crawling animation, pause <br>  3. hide the animation of a rabbit coming out, show a moving snowdrift, move to the right <br><br>  What do we need for this?  Unity allows you to add custom event event calls to the animation.  This is exactly what we need!  It remains only to write everything correctly. <br><br>  The first thing we need is to write a simple component (in our case it is called <code>GJAnim</code> ) and hang it on the same object on which our animator hangs.  It is the methods of this component that we can call events from the timeline. <br><br>  Let's write a method for pausing.  By the way, in a unit there is no such direct possibility.  In order to pause the animation, a slightly dirty hack is usually used with setting its speed to 0. It generally works, but there are some oddities (this is the last part of the article). <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pause</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _animator.speed = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resume</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { _animator.speed = <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre><br>  Where <code>_animator</code> is a variable in which we cached the " <code>Animator</code> " component: <br><br><pre> <code class="cs hljs">_animator = GetComponent&lt;Animator&gt;();</code> </pre><br><br>  If you paid attention to the screen above, above the keyframe, which I marked with the number ‚Äú2‚Äù, there is a small vertical bar.  Behind it lies the challenge of the event (method) ‚ÄúPause‚Äù: <br><br><img src="https://habrastorage.org/files/39f/2c8/8d8/39f2c88d8157460b96992c2ca1f92568.png"><br><br>  It is worth noting that in such events you can even pass a parameter.  String, float and object from the library are supported (not from the stage). <br><br>  Ok, we paused.  Now the task is to remove from the pause.  Obviously, this should be done by nested animation.  That is, the animation of the crawling out rabbit played to the end, and skipped upward the ‚Äúgo further‚Äù events. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ResumeParent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Transform pr = transform; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-literal"><span class="hljs-literal">true</span></span>) { pr = pr.parent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pr == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { Debug.LogWarning(<span class="hljs-string"><span class="hljs-string">"No GJAnim found in parents!"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } GJAnim a = pr.gameObject.GetComponent&lt;GJAnim&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (a != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { a.Resume(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } }</code> </pre><br><br>  This method searches the parents for the component " <code>GJAnim</code> " and removes it from the pause.  Accordingly, we set this event to end the animation of our rabbit: <br><br><img src="https://habrastorage.org/files/7ba/8e0/fc2/7ba8e0fc2a5c4b018ca5cde601e55367.png"><br><br><h4>  Profit! </h4><br>  Actually, everything.  We wrote a simple component that allows you to manage nested / parent animations and has enough flexibility.  You may need another method of type <code>ResumeByName(string)</code> , which would remove a specific animation from the pause, and not the first parent. <br><br>  In addition, everything is done within the Unite UI and is transparent enough for any animator.  Our artist, after an hour of falling into his hands of this tool, was already fully animated. <br><br><h4>  About Unity bugs and madness. </h4><br>  However, not everything is so smooth.  At some point, after creating the animation, we saw that it was behaving incorrectly. <br><br>  We had a parent (main) animation that showed one object (hid all the others), paused, at this time its (nested) animation started playing, which removed the parent from the pause at the end.  Then - the next object was shown, etc. <br><br>  So, we noticed that frames sometimes skip. <br><br>  Debugged for a long time, they wrote a lot to the log ... and this is what they found out: <br><br>  Apparently, there is a stack of animation frames / events in the unit.  And when the computer (the unity editor) slows down, it can put two frames on this stack at once, so that in the next iteration, they can both be executed. <br><br>  This entails an almost completely unrecoverable file.  We caught the situation when the animator performed all the actions with the frame and paused (this is ok), and then the next frame <b>also</b> performed the <b>same</b> frame.  That is, for one frame I counted two animation frames at once.  And the fact that in the 1st frame there was an event that sets the animation speed to 0 did not prevent him from calculating the next frame, which, apparently, was already on the stack. <br><br>  And if nobody would have noticed this in the animation with the rabbit (the rabbit would have climbed to the pixel in the wrong place), then when you hide something every frame and show, there may be a file. <br><br>  At the moment, the problem seems unrecoverable.  How did we do it?  They put FPS of such animations at 20. Apparently, on such FPS, there is no case when a unit wants to calculate two frames per iteration. <br><br>  But still, the situation is not very.  It turns out that with some friezes on the computer (or very slow), the player will still be able to catch the animation crashes. <br><br>  What to do with it is not clear. <br><br>  <b>All articles in the series:</b> <br><ol><li>  <a href="http://habrahabr.ru/post/210534/">Idea, vision, choice of setting, platform, distribution model, etc.</a> </li><li>  <a href="http://habrahabr.ru/post/211140/">Shaders for styling images under the CRT / LCD</a> </li><li>  <a href="http://habrahabr.ru/post/211576/">We fasten the scripting language to Unity (UniLua)</a> </li><li>  <a href="http://habrahabr.ru/post/213253/">Shader for fade in on the palette (a la NES)</a> </li><li>  <a href="http://habrahabr.ru/post/214799/">Subtotal (prototype)</a> </li><li>  <a href="http://habrahabr.ru/post/225761/">Let's talk about the indie games</a> </li><li>  <a href="http://habrahabr.ru/post/235011/">2D animations in Unity ("as in flash")</a> </li><li>  <a href="http://habrahabr.ru/post/244493/">Visual scripting of cut scenes in Unity (uScript)</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/235011/">https://habr.com/ru/post/235011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234999/index.html">New media consoles on Rockchip RK3288 from the company Tronsmart already on sale</a></li>
<li><a href="../235001/index.html">Google accepted Ice Bucket Challenge from Rambler & Co</a></li>
<li><a href="../235003/index.html">Rendering 3D illustrations for IKEA</a></li>
<li><a href="../235007/index.html">Skype bot for deployment without Skype API</a></li>
<li><a href="../235009/index.html">Git Live service displays real-time activity on GitHub</a></li>
<li><a href="../235017/index.html">Refreshment of the gloomy MantisBT interface</a></li>
<li><a href="../235021/index.html">YUI developers have announced the termination of further library development.</a></li>
<li><a href="../235023/index.html">Intel introduced its first 8-core processor for desktop computers</a></li>
<li><a href="../235031/index.html">Internet Archive will upload over 14 million free historical images to Flickr</a></li>
<li><a href="../235033/index.html">On e-bikes around Russia or in search of outlets outside the Moscow Ring Road</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>