<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Why is it important to check the values ‚Äã‚Äãreturned by the function?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I really wanted to share my experience and I would like to talk about why it is important to check the values ‚Äã‚Äãreturned by a function. Take python an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Why is it important to check the values ‚Äã‚Äãreturned by the function?</h1><div class="post__text post__text-html js-mediator-article"><p>  I really wanted to share my experience and I would like to talk about why it is important to check the values ‚Äã‚Äãreturned by a function.  Take python and ctypes as an example.  Some time ago I ran into an interesting enough bug whose essence was that when running the script on the Linux system there were incorrect data, but there was no traceback, and on the Windows system they immediately received the traceback.  The study of the code showed that the incorrect date data was to blame for the strptime () function.  Now, let's take a look at an example of working with the strptime () function in python. <a name="habracut"></a></p><br><h4 id="pod-windows-my-mozhem-ispolzovat-funkciyu-strptime-iz-modulya-datetime">  Under Windows, we can use the strptime () function from the datetime module </h4><br><p>  An example with the correct date: </p><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime date_str = <span class="hljs-string"><span class="hljs-string">"30-10-2016 16:18"</span></span> format_str = <span class="hljs-string"><span class="hljs-string">"%d-%m-%Y %H:%M"</span></span> dt = datetime.strptime(date_str, format_str) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> repr(str(dt))</code> </pre> <br><p>  Here is what we will see in this case: </p><br><blockquote>  2016-10-30 16:18:00 </blockquote><p>  If in the code above we replace the date string with an incorrect one: </p><br><blockquote>  date_str = "30-10-2016 16: fhadjkfh" </blockquote><p>  then we will see the following output: </p><br><pre> <code class="hljs pgsql">File "E:\Python27\lib\_strptime.py", <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">325</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> _strptime (data_string, <span class="hljs-keyword"><span class="hljs-keyword">format</span></span>)) ValueError: <span class="hljs-type"><span class="hljs-type">time</span></span> data <span class="hljs-string"><span class="hljs-string">'30-10-2016 16:fhadjkfh'</span></span> does <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> match <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> <span class="hljs-string"><span class="hljs-string">'%d-%m-%Y %H:%M'</span></span></code> </pre> <br><h4 id="pri-ispolzovanii-linux-my-mozhem-tak-zhe-ispolzovat-funkciyu-strptime-importiruya-eyo-iz-biblioteki-libc">  When using Linux, we can also use the strptime () function by importing it from the libc library. </h4><br><p>  More about the strptime () function in C is best read <a href="http://man7.org/linux/man-pages/man3/strptime().3.html">here</a> .  I just note that in this case, the date parameters will be saved to the following structure: </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">tm</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_sec; <span class="hljs-comment"><span class="hljs-comment">/* Seconds (0-60) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_min; <span class="hljs-comment"><span class="hljs-comment">/* Minutes (0-59) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_hour; <span class="hljs-comment"><span class="hljs-comment">/* Hours (0-23) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_mday; <span class="hljs-comment"><span class="hljs-comment">/* Day of the month (1-31) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_mon; <span class="hljs-comment"><span class="hljs-comment">/* Month (0-11) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_year; <span class="hljs-comment"><span class="hljs-comment">/* Year - 1900 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_wday; <span class="hljs-comment"><span class="hljs-comment">/* Day of the week (0-6, Sunday = 0) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_yday; <span class="hljs-comment"><span class="hljs-comment">/* Day in the year (0-365, 1 Jan = 0) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> tm_isdst; <span class="hljs-comment"><span class="hljs-comment">/* Daylight saving time */</span></span> };</code> </pre> <br><p>  Here‚Äôs how pyrone might look like using the strptime () function when working with the ctypes module: </p><br><pre> <code class="hljs python"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> ctypes <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * libc = CDLL(<span class="hljs-string"><span class="hljs-string">'libc.so.6'</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TM</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Structure)</span></span></span><span class="hljs-class">:</span></span> _fields_ = [ (<span class="hljs-string"><span class="hljs-string">"tm_sec"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_min"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_hour"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_mday"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_mon"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_year"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_wday"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_yday"</span></span>, c_int), (<span class="hljs-string"><span class="hljs-string">"tm_isdst"</span></span>, c_int) ] tm_struct = TM() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> field_name, field_type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tm_struct._fields_: print(<span class="hljs-string"><span class="hljs-string">"{}: {}"</span></span>.format(field_name, getattr(tm_struct, field_name))) strptime = libc.strptime strptime.restype = c_char_p date_str = <span class="hljs-string"><span class="hljs-string">"30-10-2016 16:18"</span></span> format_str = <span class="hljs-string"><span class="hljs-string">"%d-%m-%Y %H:%M"</span></span> rez = strptime(date_str, format_str, pointer(tm_struct)) print(<span class="hljs-string"><span class="hljs-string">"######"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> field_name, field_type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tm_struct._fields_: print(<span class="hljs-string"><span class="hljs-string">"{}: {}"</span></span>.format(field_name, getattr(tm_struct, field_name))) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"strptime returned: %s"</span></span> % repr(rez)</code> </pre> <br><p>  And we will see the following conclusion </p><br><pre> <code class="hljs coffeescript">tm_sec: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_min: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_hour: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_mday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_mon: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_year: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_wday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_yday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_isdst: <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">######</span></span> tm_sec: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_min: <span class="hljs-number"><span class="hljs-number">18</span></span> tm_hour: <span class="hljs-number"><span class="hljs-number">16</span></span> tm_mday: <span class="hljs-number"><span class="hljs-number">30</span></span> tm_mon: <span class="hljs-number"><span class="hljs-number">9</span></span> tm_year: <span class="hljs-number"><span class="hljs-number">116</span></span> tm_wday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_yday: <span class="hljs-number"><span class="hljs-number">303</span></span> tm_isdst: <span class="hljs-number"><span class="hljs-number">0</span></span> strptime returned: <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br><p>  It is important to note here that the fields of the tm_struct object will be initialized with zeros, and the value returned by the strptime () function will be an empty string. </p><br><p>  If in the code above we replace the date string with an incorrect one: </p><br><blockquote>  date_str = "30-10-2016fahdkjfa 16:18" </blockquote><p>  then we will see the following output (for brevity, I have removed the printing of the field values ‚Äã‚Äãof the tm_struct object after its creation): </p><br><pre> <code class="hljs pgsql">tm_sec: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_min: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_hour: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_mday: <span class="hljs-number"><span class="hljs-number">30</span></span> tm_mon: <span class="hljs-number"><span class="hljs-number">9</span></span> tm_year: <span class="hljs-number"><span class="hljs-number">116</span></span> tm_wday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_yday: <span class="hljs-number"><span class="hljs-number">0</span></span> tm_isdst: <span class="hljs-number"><span class="hljs-number">0</span></span> strptime returned: <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre> <br><p>  Here you can see that in the case of an incorrect date, only those fields that could be recognized in the date string with incorrect data will change in the tm_struct object, and the remaining fields will remain with zero values.  And the strptime () function itself will return the value <code>None</code> .  In this case, we will not get any trays back.  That is why it is important to be more careful and check the value returned by the function. </p><br><p>  The correct call option here could be, for example, like this: </p><br><pre> <code class="hljs pgsql">#    <span class="hljs-string"><span class="hljs-string">''</span></span>  <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>,      <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> strptime(date_str, format_str, pointer(tm_struct)) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> ValueError("datestring `{}` does not match expected format `{}`".format(date_str, format_str))</code> </pre> <br><p>  Now let's imagine, for example, that we have our own schedule aggregator of something.  And with an incorrect code, such a bug can only be seen by the user, in case he sees the difference between the schedule shown by our aggregator and the schedule on the site from which we received it. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/312658/">https://habr.com/ru/post/312658/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../312646/index.html">Anti-pager for paranoiac in Safari</a></li>
<li><a href="../312648/index.html">Administrator's summary: the difference between a microscope and a hammer when building a SAN (updated)</a></li>
<li><a href="../312652/index.html">Creating shared storage based on CEPH RBD and GFS2</a></li>
<li><a href="../312654/index.html">Blockchain decomposition</a></li>
<li><a href="../312656/index.html">Two-factor authentication in Redmine</a></li>
<li><a href="../312660/index.html">Free seminar "Operation of the data center: what you need to do yourself", October 27, Moscow</a></li>
<li><a href="../312662/index.html">PHP multithreaded server implementation</a></li>
<li><a href="../312664/index.html">Moscow part of the hackathon TADHack: tomorrow</a></li>
<li><a href="../312666/index.html">5 reasons why employers do not like remote workers (and 4 ways to get a job anyway)</a></li>
<li><a href="../312668/index.html">‚ÄúHi, Siri. Turn on the heaters "- Integration of NooLite smart home with Apple HomeKit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>