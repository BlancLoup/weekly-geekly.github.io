<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Confrontation" PHDays VII: Beginners are lucky or rob banks, break GSM</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year we (CARK Kazakhstan) for the first time participated in the Battle of Attackers and Defenders (The Standoff) on PHDays as evil hackers. In t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Confrontation" PHDays VII: Beginners are lucky or rob banks, break GSM</h1><div class="post__text post__text-html js-mediator-article">  This year we (CARK Kazakhstan) for the first time participated in the Battle of Attackers and Defenders (The Standoff) on PHDays as evil hackers.  In the post we will try to describe how the event took place, due to which we managed to win and what ultimately lay in that metal case. <br><br>  <b>Introductory</b> <br><br>  We have been visiting PHDays for several years with our team and mostly won small contests.  Therefore, this year we were only interested in winning the main competition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Composition</b> <br><br>  This year we went to the conference with a team of 13 people: pentesters, reversers, hardwarders, system administrators, Ph.D., students, students and fitness trainers.  But seven people participated directly in the confrontation. <br><br><img src="https://habrastorage.org/web/5ed/581/30a/5ed58130a99348a399ae2cbb9fe9a1e4.jpg" alt="image"><br><a name="habracut"></a><br>  <b>A few links to start:</b> <br><br>  1) <a href="https://www.phdays.ru/standoff/">The Standoff</a> rules themselves <br>  2) On Habr√© there are already several posts on ‚ÄúConfrontation‚Äù from Defenders and SOC: <a href="https://habrahabr.ru/company/pm/blog/329730/">one</a> and <a href="https://habrahabr.ru/company/solarsecurity/blog/329890/">two</a> . <br><br>  <b>Training</b> <br><br>  From the equipment we took: <br><br>  MikroTik RB951Ui-2HnD - 1pc. <br>  Zyxel Keenetic - 1 pc.  (lost) <br>  Tplink 8port hub - 1pc <br>  Alfa Usb Wifi Adapter - 5pcs <br>  SDR, Proxmark with LF and HF antennas, BladeRF, HackRF, equipment for GSM, etc. As you can guess, we were watched very carefully at the airport.  And our hands itched to raise their own base station during the flight to communicate. <br><br>  Also in the office in Astana, a brutal machine (we call it Brute Alice) was prepared with the Radeon R9 290X on board and access via VPN.  This baby played a key role in our victory. <br><br>  <b>First day</b> <br><br>  We arrived at the site as early as 8-9 in the morning.  We were among the first and managed to take a table in the farthest corner.  There was no access to the local area network yet, and we started working on organizing the work space: we bought local SIMs for the Internet, set up a router, set firewall rules, created a wifi access point KNFC (Kairat Nurtas Fan Club, a club of fans of the local superstar Kairat Nurtas), which at the end competitions other teams mercilessly attacked, and began to expect the start of the competition.  By 12 o'clock, access to the internal network appeared and we were given a login and password to the portal with tasks.  The standoff has begun. <br><br><img src="https://habrastorage.org/web/d77/893/af8/d77893af8ad4498bab406eecb813b2cf.png"><br>  <i>System with taska.</i> <br><br>  After viewing the list of tasks (there were about 50 of them), part of the team began to scan subnets, another part - look for vulnerabilities on web resources, and hardwarders immediately switched to tasks from GSM.  Two guys made themselves badges for the media and started walking around the teams of the attackers and defenders, interviewing (and quite successfully!) And photographing the desktops of the participants.  They managed to do a lot of pictures. <br><br>  From mining: <br><br>  Password from teamviewer one of the organizers of the competition.  Gave access to the screen with the control of traffic lights in the city.  And we did not miss the opportunity to take advantage of this: we managed to stop the movement in the city, but nothing was counted for ‚Äúpeeping‚Äù =) Although there were no prohibitions in the rules of participation in social engineering. <br><br><img src="https://habrastorage.org/web/800/dfa/57f/800dfa57f7bc4c61a0f034a9c4b5fc6d.jpg"><br><br>  Until the evening, we mainly carried out reconnaissance, tried to exploit services.  They delved into the essence of the infrastructure, dealt with tasks, threw minor vulnerabilities into the local bugbounty portal and did not even stay in the top 5. In the evening, the hardwarders were able to carry out the interception of compromising materials to the mayor of the city, which immediately provided us with the first place until the morning.  For this task, 150 000 posts were given (the game currency of the city). <br><br>  After our hardwarders from the press changed their clothes back to the participants of the confrontation, they began to pray to the GSM-network gods. <br><br><img src="https://habrastorage.org/web/877/b2d/7c5/877b2d7c5fb6409e8c808db2c8514a12.png"><br><br>  And having received their support, they rushed to the GSM network. <br><br>  The primary scan on BladeRF using GnuRadio blocks to decrypt GSM traffic showed that the network works completely on 2G and several devices with specific numbers are connected to it (presumably bots in the base station itself), as well as several devices with numbers that are formed from IMSI Sims.  We determined the latter by connecting to the network using ordinary phones (in Kazakhstan, they are called ‚ÄúZhaiFony‚Äù).  At the base station there was no identification via IMSI, which made it easier for us to connect to the network using jajfonov.  But we were ready for a different outcome: we would simply create virtual sims based on osmocombb programs and the motorola c118 phone, which would have IMSI with MNC and MMC identification as the base station. <br><br>  But then we got stuck: we could not get more data from BladeRF and GnuRadio, but it was clearly visible that the packets were still present.  Then we decided to connect to the 2G network scan what was created to work in 2G and feels like a fish in it - a motorola c118 phone with a Calypso GSM modem inside and osmocombb programs on the backend.  Since the task was to scan the network, we used the osmocombb program branch called sylvain.  In the first minutes of network scanning, we realized that it does not encrypt, or rather, encryption is implemented at the A5 / 0 level. <br><br>  We listened to the network using the implementation of the stack of programs: <br><br>  1) On the motorola itself, the osmocombb / master firmware was launched for compal e88 of the first layer layer1.highram.bin.  This is the layer1 of the OSI model, which implements the entire physical part of the modem. <br>  2) The host launched an osmocombb / sylvian receiver in the misc - ccch_scan folder.  This tool allows you to receive data from layer1 and manages it to search for data from a specific ARFCN, that is, the base station on the CCCH.  Then it allows you to send them to the desired address, in our case, the loopback. <br>  3) Loopback with us listened to all your favorite wireshark, which showed the scan results. <br><br>  The screen on which it is clear that we started for this task: <br><br><img src="https://habrastorage.org/web/152/450/fea/152450fea09a4f809df39591ba4cda6a.png"><br><br>  At some point, we noticed a high activity of two clients of the network: they were actively exchanging messages.  As soon as their correspondence talked about money (well, our hardwarders know English perfectly), we recorded the entire conversation.  It turned out that the conversation was between the mayor of the city and someone else about affiliated structures and corruption, ‚Äúgreat!  - we thought, - we spotted you, bad-bad mayor! ‚Äù. <br><br>  Screen on which correspondence in wireshark is visible: <br><br><img src="https://habrastorage.org/web/303/fe8/370/303fe837084c4c45b0ac1ccb051a0baf.png"><br><br>  And of course, the correspondence itself: <br><br><div class="spoiler">  <b class="spoiler_title">Correspondence</b> <div class="spoiler_text">  Secret sms chat: <br>  to: 901708 <br>  from: 901706 <br>  sms: Dear Tomas,  Can I call you now? <br><br>  to: 901706 <br>  from: 901708 <br>  sms: Hello.  I thought we already discounted this yesterday.  I have no time to talk with you ... <br><br>  to: 901706 <br>  from: 901708 <br>  sms: how much? <br><br>  to: 901708 <br>  from: 901706 <br>  sms: 10,000 EUR. <br><br>  from: 901708 <br>  to: 901706 <br>  sms: Well, ok.  I'll wait for your payment.  Hereby you can open five sale points downtown. <br><br>  from: 901708 <br>  to: 901706 <br>  sms: And, btw: nobody.  This is our both interest. <br></div></div><br>  <b>Night</b> <br><br>  After we climbed to the first line, a keen desire arose to hold out there to the end.  Our team decided to stay overnight and continue the night battles.  Some of the guys switched to SCADA systems, others tried to break the bank itself, in which participants and city residents had money, the hardwarders continued to hack GSM (but by the middle of the night they still went to bed, because some genius turned off the GSM network, which the respected the organizers had to re-raise in the morning).  A git-repository with the source code of the bank and an API was found, through which it was possible to pull out the logins and md5-hashes of the bank users.  And then the heat began.  The RDot team for 5-10 minutes before us found the same vulnerability and has already started withdrawing users' money to their accounts.  We also quickly began to change passwords and withdraw money to ourselves.  In the process of transferring money, we noticed that someone is trying to divert our session through the XSS-sniffer, good, they did not succeed.  XSS did not work, but we decided to punish the negligent attacker and began to generate fake cookies, similar to the original ones, and send it all to a remote attacking server in order to fill them with false data.  We also discovered the Server-side Template Injection vulnerability, but we didn‚Äôt have time to unleash it.  Most of the users had four or five-digit passwords, but some of the fattest accounts had 12-digit passes, which only got lost in the morning.  In the morning, we and the RDot team removed almost all the money from the accounts with easy passwords.  At this point, we noticed that the password from the bank account, issued to us by the organizers, consisted of only 12 hex characters in lower case.  We assumed that the passwords to the bank accounts of other participants were generated in the same way, and, setting the ‚Äúcorrect‚Äù mask, we began to crack the hashes of the opposing teams, at the same time changing our own password to a more complex one.  After a couple of hours, baby Alice gave us the password from the bank account of one of the attacking teams!  5 minutes and we managed to transfer all their money to your account. <br><br>  Unfortunately, the organizers did not count the transfer of money from the account of the other team and returned the balance to them. <br><br>  By morning, the Defenders woke up, realized that they had not followed the bank, and temporarily closed it. <br><br>  <b>Second day</b> <br><br>  Pentesters continued to find minor vulnerabilities and toss them into the bugbounty.  The hardwarders woke up and started performing the next GSM call.  By lunchtime, they managed to perform a task with the interception of the machine.  Here is what the team member himself writes: <br><br>  ‚ÄúI'll tell you about the task with the search and interception of the stolen car.  The task itself was difficult, but some hacker made it more fun.  We were already able to clone the phone of the thief, and the last task remained - to write the number of the tracker inside the stolen vehicle and take control, but someone had tipped the tracker.  And when I started sending commands to the tracker, this someone started to answer for him.  At some point, he sends me a message ‚Äúu win!‚Äù, And I run to the organizer - look!  And they are with a surprised face: we did not program the robot to such answers.  Then we learned that some kind of hacker troll us.  He raised the spirits of the whole team, the organizers and the participants. ‚Äù <br><br>  But it is worth highlighting the technical details of intercepting a car tracker. <br><br>  First of all, we found commands sent to the tracker, and tried to send the same commands, but this didn‚Äôt work - it means that the tracker checks the sending number.  This did not stop our hardwarders, because the support of the GSM gods has already been received, and they need more hack.  The guys got the thief in the TMSI data packets and forged the same one, which should have given our virtual sim card the same number as that of the thief, but this did not help either. <br><br>  It was decided to completely copy the mobile phone thief - we began to hunt for his IMSI.  Every mobile phone changes its TMSI from time to time, and at this moment, in an open form, you can catch its IMSI if you look for localization packages, or rather its updates.  Having found such a package, we received the data to clone the phone thief.  We cloned it using software from osmocombb and virtual sims in motorola c118.  Having gained control, we determined the location of the car and transferred control to one of our zhayfon, so that no one could repeat our success, because we stopped sending commands and the broadcast became quiet after the hunt. <br><br>  Screen interception control: <br><br><img src="https://habrastorage.org/web/391/416/6f6/3914166f62514a3780f80dbea8899fa6.png"><br><br>  And, of course, I remember the location of the car itself - oddly enough, it was in Silicon Valley: <br><br><img src="https://habrastorage.org/web/ce3/9d2/389/ce39d2389a1c4ab58af64d10428ec9c6.png"><br><br>  The bank did not work the whole day.  By lunchtime, we already got rid of the passwords from the ‚Äúfat‚Äù accounts and we sat waiting for the organizers to open it at least temporarily, and it happened!  We got into the 5-minute window when they had to start the bank in order to change the passwords for the teams (after our teams were hacked), and at that moment we managed to transfer another 3 million posts to our account.  This moment was captured on video when the Buffalos took the stage and we returned the lead in real time. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/kwQsG8aMWq4" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  So it happened to hold out until the end of the event.  Until the last moment, they doubted whether it would be possible to keep the first place.  But luck and the GSM Gods were on our side. <br><br><img src="https://habrastorage.org/web/674/af4/2f5/674af42f594d4292856e7ae1f0663ced.png"><br><br><img src="https://habrastorage.org/web/a95/e98/f10/a95e98f102cb4cd5bef4a5e14c732621.jpg"><br><br>  In general, the organization was at a high level, the organizers were very friendly and helped with technical problems.  There were a lot of tasks, but it so happened that part of the team concentrated on the bank and stealing money from the accounts, although according to the organizers, there should not have been vulnerabilities in the bank service. <br><br>  PS: and the suitcase <s>contained the cash prize</s> was actually empty.  The money was in a separate envelope. </div><p>Source: <a href="https://habr.com/ru/post/329980/">https://habr.com/ru/post/329980/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329968/index.html">‚ÄúPreparing for the transition to Angular 4‚Äù: Tinkoff.ru about JS-development</a></li>
<li><a href="../329970/index.html">Basics of CQRS</a></li>
<li><a href="../329972/index.html">Creating a 2.5D software engine</a></li>
<li><a href="../329974/index.html">Andrei Satarin, Yandex: ‚ÄúThe biggest mistake is the lack of understanding of the system‚Äù</a></li>
<li><a href="../329978/index.html">Was Gartner right in predicting a change in approach to providing information security?</a></li>
<li><a href="../329982/index.html">Determining the number of a Telegram user using brute force in the address book</a></li>
<li><a href="../329984/index.html">Chronicles of Confrontation: how to hack the whole city in two days</a></li>
<li><a href="../329986/index.html">Unequal battle: CRM vs. Excel</a></li>
<li><a href="../329988/index.html">Yes, Python is slow, but I don't care</a></li>
<li><a href="../329990/index.html">New architecture of Android applications - we try in practice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>