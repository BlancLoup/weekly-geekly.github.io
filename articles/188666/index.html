<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Benchmark of graphic libraries for PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the project that we are currently developing a lot of work with photos, as a result, the speed of the graphic library is actually the main factor i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Benchmark of graphic libraries for PHP</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/f93/ef8/527/f93ef8527bb1649916a5881405bc2c95.jpg" alt="image" align="right"><br>  In the project that we are currently developing a lot of work with photos, as a result, the speed of the graphic library is actually the main factor in optimizing the site.  It's no secret that ImageMagick has long become a standard for developing in PHP, although for some time it has been pushed from there by a fork called GraphicsMagick.  I wondered how much they differ and how much the odds can give the good old GD.  Fortunately, just recently a <a href="http://phpixie.com/modules/image-module/">graphics module for PHPixie was released</a> which supports all three libraries, which allowed me to conduct quite interesting tests. <br><a name="habracut"></a><br><br>  In the spirit of the framework itself, we will experiment on the fairy that is on the right (taken from <a href="http://j-scott-campbell.deviantart.com/">http://j-scott-campbell.deviantart.com/</a> ).  If it seems to someone that there is too much innuendo in it, then I dare to remind that for more than 20 years <a href="https://en.wikipedia.org/wiki/Lenna">Lenna</a> from the playboy is the standard pattern of testing of graphical algorithms. <br><br>  Now follows a short description of the tests and the output drawings.  At the end of the article there will be a benchmark of the speed of work in one table. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Simple scaling </h5><br>  So first try to reduce it to 100 pixels in width. <br><pre><code class="php hljs">$pixie-&gt;image-&gt;read($dir.<span class="hljs-string"><span class="hljs-string">'fairy.jpg'</span></span>) -&gt;resize(<span class="hljs-number"><span class="hljs-number">200</span></span>) -&gt;save($dir.<span class="hljs-string"><span class="hljs-string">'resize.jpg'</span></span>);</code> </pre> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d0/ee9/3a3/4d0ee93a3b69e42edbe913d0e2909805.png" alt="image"><br><br>  The difference is not noticeable at first glance, but for example its eye on the GD version does not have that pronounced green color like Imagick and Gmagick. <br><br><h5>  Create square avatars </h5><br>  To make an autark square it must first be scaled on the smaller side and then cut off on the larger side.  At PHPixie, this is done quite simply: <br><br><pre> <code class="php hljs">$pixie-&gt;image-&gt;read($dir.<span class="hljs-string"><span class="hljs-string">'fairy.jpg'</span></span>) -&gt;resize(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) -&gt;crop(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>) -&gt;save($dir.<span class="hljs-string"><span class="hljs-string">'crop.jpg'</span></span>);</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/8a5/ecf/41a/8a5ecf41a22b147d5c0df2995273e217.png" alt="image"><br>  It is obvious that they will look like the previous one. <br><br><h5>  Writing text and creating a blank image </h5><br>  Now we will try to create a white drawing and write the text in purple using the TTF font. <br><br><pre> <code class="php hljs">$pixie-&gt;image-&gt;create(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">70</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffff</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt;text(<span class="hljs-string"><span class="hljs-string">"Hello World"</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, $dir.<span class="hljs-string"><span class="hljs-string">'/Sofia-Regular.ttf'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">0x5B43AA</span></span>) -&gt;save($dir.<span class="hljs-string"><span class="hljs-string">'text.jpg'</span></span>);</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c7/ea2/f21/0c7ea2f218ccf453c733cfb1e19b4a23.png" alt="image"><br><br>  Here the results are slightly more dramatic.  GD for some reason made the text color darker and anti-aliasing worked much worse, with the result that the edges of the text are slightly blurred.  Both Magick's text is much better. <br><br><h5>  Splitting text into lines </h5><br>  The text itself is broken into lines by PHPixie, but for this it uses information about the text metrics from the graphics library.  Since you have to consider the size of each word, this can be a rather expensive process.  So try to put on a blank page a piece of a song. <br><pre> <code class="php hljs">$text = <span class="hljs-string"><span class="hljs-string">"When I closed my eyes to the shimmering light "</span></span>. <span class="hljs-string"><span class="hljs-string">"all memory faded and I could see "</span></span>. <span class="hljs-string"><span class="hljs-string">"that a mushroom circle of red and white "</span></span>. <span class="hljs-string"><span class="hljs-string">"and myriad fairies surrounded me. "</span></span>; $pixie-&gt;image-&gt;create(<span class="hljs-number"><span class="hljs-number">300</span></span>, <span class="hljs-number"><span class="hljs-number">180</span></span>, <span class="hljs-number"><span class="hljs-number">0xffffff</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) -&gt;text($text, <span class="hljs-number"><span class="hljs-number">20</span></span>, $dir.<span class="hljs-string"><span class="hljs-string">'/Sofia-Regular.ttf'</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">0x5B43AA</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">300</span></span>) -&gt;save($dir.<span class="hljs-string"><span class="hljs-string">'wrap.jpg'</span></span>);</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/516/ebf/49c/516ebf49c447358c3b570a9e34e27b8a.png" alt="image"><br><br>  On a smaller font, the flaws are not so noticeable, but if you look at the bends, you can quite easily distinguish them.  But it should be noted that Imagick spent much more time, primarily because of recalculating the font metrics on each word (after all, you have to read the font again from the disk each time) while GD and Gmagick were much faster. <br><br><h5>  Overlay and wrapping pictures </h5><br>  This test is the most disconnected from reality, but I wanted to beat the speed of overlaying pictures and, in general, the operation was more complicated.  So, we create an empty picture, on the one hand we put the fairy autarka and on the other side the same avatar only wrapped horizontally and vertically and also unfolded sideways. <br><br><pre> <code class="php hljs">$canvas = $pixie-&gt;image-&gt;create(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); $fairy = $pixie-&gt;image-&gt;read($dir.<span class="hljs-string"><span class="hljs-string">'fairy.jpg'</span></span>) -&gt;resize(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) -&gt;crop(<span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>); $canvas -&gt;overlay($fairy, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) -&gt;overlay($fairy-&gt;flip(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)-&gt;rotate(<span class="hljs-number"><span class="hljs-number">90</span></span>), <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) -&gt;save($dir.<span class="hljs-string"><span class="hljs-string">'overlay.jpg'</span></span>);</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/685/411/9ee/6854119ee605b9b991838bc717ee3e92.png" alt="image"><br><br><h4>  Work speed </h4><br>  And here is the benchmark itself.  Horizontal left-to-right tests, vertical average execution time (each test was run 100 times). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c97/933/ada/c97933adad02e49980604da2cbebacbf.png" alt="image"><br><br>  Conclusion, it‚Äôs best to use Gmagick if it‚Äôs not there, then Imagick.  You can think about GD only if you need to write a lot of text and that is not a very intricate font. <br><br>  By the way, I‚Äôll separately note how much I liked the interface of PHPixie itself in this regard, especially the presence of functions for a variety of standard actions (the same text wrap) for which previously had to download separate classes. </div><p>Source: <a href="https://habr.com/ru/post/188666/">https://habr.com/ru/post/188666/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188656/index.html">Another portable radio in a secure case - teXet TM-540R</a></li>
<li><a href="../188658/index.html">Videos in MMO. The development of the genre or art form?</a></li>
<li><a href="../188660/index.html">The new version of ipLex.Profi - "mobilization" of Ukrainian lawyers</a></li>
<li><a href="../188662/index.html">Acquaintance with UnrealEngine. Part 2</a></li>
<li><a href="../188664/index.html">Backup rule "3-2-1". Part 2</a></li>
<li><a href="../188670/index.html">About Bill Wagner's Effective C # book</a></li>
<li><a href="../188676/index.html">Features of development for Android on Titanium</a></li>
<li><a href="../188678/index.html">The seine with the mud sea has returned ...</a></li>
<li><a href="../188682/index.html">Optimize the speed of [search] applications</a></li>
<li><a href="../188690/index.html">The contract for the development of the site: so and not otherwise</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>