<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Part 3. Where to store data for decentralized applications on the blockchain?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of the article, we found problems with storing application data in the blockchain. In the second part, we described the requirements...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Part 3. Where to store data for decentralized applications on the blockchain?</h1><div class="post__text post__text-html js-mediator-article">  In the <a href="https://habrahabr.ru/post/327836/">first part of the article,</a> we found problems with storing application data in the blockchain.  In the <a href="https://habrahabr.ru/post/327947/">second part,</a> we described the requirements for the data warehouse and examined how the existing implementations meet these requirements.  The results were disappointing - there was no satisfactory implementation.  In this part we will propose the concept of a decentralized data warehouse that meets the requirements.  Of course, for a deeper understanding of what is happening, it is recommended to review the two <a href="https://habrahabr.ru/post/327836/">previous</a> <a href="https://habrahabr.ru/post/327947/">parts</a> . <br><a name="habracut"></a><br>  So, <a href="https://habrahabr.ru/post/327947/">current implementations of</a> storages do not meet the requirements for a database that will suit a wide class of decentralized applications on the blockchain. <br><br>  Given that a speedless connection with the blockchain is acceptable for the sake of speed (that is, not all transactions will pass through the blockchain), it must be resistant to malicious behavior of other database nodes, provide a sufficient level of replication, and have mechanisms for motivating participants to support the network.  That is, such a database will need the support of the blockchain with smart contracts. <br><br>  When creating such a database, it is proposed to build on existing noSql implementations, for example, <a href="http://cassandra.apache.org/">Apache Cassandra</a> , but at the same time to endow our database with the following properties: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  The database is public, the user (client) of the database is identified by its public key (the same key as in the blockchain) is the user ID. </li><li>  Each user can send transactions to the database, each transaction must be signed by this user. </li><li>  The new record created by the user remembers that he is its owner. </li><li>  After the creation, only the owner (or the user for whom trust is established through the permission mechanism implemented as a smart contract on the blockchain) can change the entry. </li><li>  Everyone can read all the records. </li><li>  In order to prevent conflicts between the keys of their records between different users, all keys of the user's records are prefixed with: user ID. </li><li>  More complex permissions can be set using a smart contract in the blockchain (for example, trust between specific users, rights to create / delete tables), etc. </li><li>  All permissions must be checked for both transactions and replications. </li></ul><br>  Mandatory cryptographic signature of each record ensures that its modification or deletion by the malicious party is impossible without knowing the private key of the owner of the record.  That is, the data storage thus constructed is stable to the <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587%25D0%25B0_%25D0%25B2%25D0%25B8%25D0%25B7%25D0%25B0%25D0%25BD%25D1%2582%25D0%25B8%25D0%25B9%25D1%2581%25D0%25BA%25D0%25B8%25D1%2585_%25D0%25B3%25D0%25B5%25D0%25BD%25D0%25B5%25D1%2580%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B2">Byzantine problem</a> even without a consensus mechanism. <br><br>  This gives hope that the speed of such a scheme will not differ much from the speed of existing noSql database implementations.  However, an attacker can produce a <a href="https://en.wikipedia.org/wiki/Sybil_attack">sybil attack</a> , generating key pairs and creating garbage entries in the database.  This problem is solved by introducing motivation. <br><br><h2>  Motivation </h2><br>  The public network assumes that participants are free to join it, providing equipment that enhances computing power, information storage and distribution of the network.  To stimulate this behavior, equipment owners should receive a reward that motivates them to work honestly. <br><br>  This means that database operations will be paid for by the end user.  This may sound crazy for a person who is not familiar with the blockchain, but it is quite reasonable.  The fact is that blockchain projects often do not have an owner.  They own the community.  As a result, the community itself must pay the costs of the project.  The money is very small, but nonzero.  The existing decentralized file storages, which we discussed in the previous part of the article, also charge the user for file storage.  And we are nowhere without this, at the basic level the functioning of the equipment must be paid for by its users.  In principle, these costs can then be offset from other sources, but this topic is beyond the scope of this article. <br><br>  Similar to <a href="https://github.com/ethersphere/swarm">Ethereum Swarm</a> , the following awards are assumed: <br><br><ul><li>  Data Retrieval Reward </li><li>  Data storage reward </li></ul><br>  Awards are allocated from the funds of the user making requests to the database.  Since payments through the blockchain take a very long time, you can use two methods for fast payments - <a href="https://en.bitcoin.it/wiki/Off-Chain_Transactions">off-chain transactions</a> and checkbooks.  In the case of off-chain transactions, the user will need to create an off-chain channel with each database node (or use intermediate channels between nodes).  Given that each such channel requires the reservation of funds on it, it can be quite expensive.  Therefore, we will adopt the ‚Äúcheckbook‚Äù approach as the main approach.  Explain what it is. <br><br>  Before accessing the database, the user must reserve part of the funds on a special smart contract ‚Äúcheckbook‚Äù.  The address of this contract is then used by the database node to receive remuneration ‚Äî the checkbook contract stores its owner‚Äôs money and allows third parties to cash in checks signed by the owner simply by sending the transaction with the check as data to the cash contract method. <br><br><ul><li>  The contract tracks the total amount written to each recipient during the connection. </li><li>  When sending the check, the owner must remember the total amount sent </li></ul><br>  Check cashed if <br><br><ul><li>  contract address corresponds to the address on the check </li><li>  check is signed by the owner (user ID - public key) </li><li>  the total amount on the check is greater than the previous canceled check for the recipient </li></ul><br>  Then, if you need to reward the database node, the user simply sends her a check.  The receiving node can save only the last received check from each user and periodically cash it, sending a ‚Äúcheckbook‚Äù to the contract, which allows, with some confidence, to save on blockchain transactions. <br><br><h3>  Data Retrieval Reward </h3><br>  The data on the database nodes have a certain level of replication, that is, data with a certain key is stored only on a part of the nodes, for example, on <i>N.</i>  However, the user can refer to any node for data.  The node to which the user has addressed acts further as the ‚Äúcoordinator‚Äù. <br><br>  The value of the data key is used to calculate the <i>N</i> nodes responsible for storing these keys, and requests are sent to them.  The data returned by the nodes is checked by the coordinator for compliance with electronic signatures, compared by the time stamp, and the latest record is returned to the user. <br><br>  Payment is subject to the work of the coordinator and the replicas that store data.  The proportions of payment are subject to a more detailed calculation, but in order to stimulate the correct behavior, the following principles should be followed: <br><br><ul><li>  The faster the node returns the data, the more payment it deserves. </li><li>  If the node returns the old data, payment decreases </li><li>  Node not returning data gets nothing </li><li>  The coordinator gets a fixed small portion </li></ul><br>  Together with the data, the coordinator issues an invoice, which indicates which node is entitled to how much.  The user writes checks to everyone.  The coordinator sends checks to the nodes.  As well as updated data, if the node did not return anything or returned old data. <br><br>  To protect against malicious coordinators and users who will not pay, each node keeps a list of users from whom it expects payment, and coordinators sending requests from these users.  If the debt level exceeds a certain threshold value, the node may stop accepting requests from specified users and coordinators.  Upon receipt of checks lists are adjusted. <br><br><h3>  Reward for storage </h3><br>  The extraction reward indirectly stimulates and stores, but only works for popular and frequently requested data.  To encourage long-term storage of data, especially if they are rarely requested, a reward for storage is required. <br><br>  The article on <a href="http://swarm-gateways.net/bzz:/theswarm.eth/ethersphere/orange-papers/1/sw%255E3.pdf">Ethereum Swarm</a> describes the storage reward system.  Nodes enter into a data storage contract with the information owner for a period of time.  Payment for storage can occur at the moment of saving (updating) data or after some time, provided that the data is actually stored.  In case of detection of data loss during the contract, the site can be fined, for which each node requires initial registration with a security deposit. <br><br>  When saving data, the node returns a receipt, which serves as proof that the node has accepted the file for storage.  This receipt subsequently allows you to check whether the data corresponding to them is still stored, and if not, initiate a transaction for a court smart contract that will allow the punished node to be punished. <br><br>  In our case, the data is not static, a record with the same key can be overwritten several times.  In this case, not only the original record, but also a newer record with the same key can correspond to the presented receipt. <br><br>  When a user initiated a data deletion operation, instead of a physical deletion, the data is replaced with a special ‚Äúzero‚Äù entry.  The record can be physically deleted after the expiration of the storage contract on it. <br><br><h2>  Full-text search, secondary indexes </h2><br>  In noSql databases, a quick search using a small number of nodes is possible only by the primary key.  Our database is not much different in this respect.  Meanwhile, the search for records by keywords, as well as the grouping of records by some criteria is difficult to achieve without secondary indexes and full-text search.  For full-text search, as well as the use of secondary indexes, it is proposed to use a solution similar to <a href="http://www.elassandra.io/">Elassandra</a> .  This solution is the local full-text <a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a> indexes on each node of the distributed noSql base of <a href="http://cassandra.apache.org/">Cassandra</a> .  Full-text requests are sent by the coordinator to all nodes, then mixed and returned to the client.  Since additional indexes are created locally and independently at each node, additional prevention of the problem of Byzantine generals is not required. <br><br><h2>  Results </h2><br>  Thus, we presented the concept of a public database associated with the blockchain, which satisfies the requirements for use by decentralized applications: <br><br><ul><li>  <b>Distribution</b> <br>  The database supports an unlimited number of replicas, each of which can be a coordinator.  That is, referring to one of them, the user gets access to all the data. <br><br></li><li>  <b>Publicity</b> <br>  The database is designed to work in a public environment.  New nodes can be added to the network and take on part of the load at any time. <br><br></li><li>  <b>Resistance to the problem of Byzantine generals and other types of attacks in the public network</b> <br>  Considering that all data placed in the database is signed by their owner, nodes cannot replace data at their discretion, nor can they spoil data when replicating to other nodes.  Substitution attempts are immediately detected using an electronic signature mechanism.  For an attempt to substitute the offending node may be deprived of the registration deposit and excluded from the network.  For placing a deposit, setting access rights, mechanisms for mutual settlements between nodes, an external (for DB) blockchain is used, which must support turing-complete smart contracts. <br><br></li><li>  <b>Sharding support</b> (the ability to replicate only a part of the data on each node to increase the maximum total amount of data). <br>  Each database node is responsible for a certain interval of the primary keys of the data it stores.  The level of replication (the number of nodes that store copies of data with the same primary key) is set separately and can grow as the network grows. <br><br></li><li>  <b>Speed</b> <br>  The principles of data storage suggest that the speed of writing and reading data in such a database will not differ much from current implementations of such databases, for example, Apache Cassandra. <br><br></li><li>  <b>Ability to store structured data</b> <br>  Data in such a database maintain structure.  This may be a JSON document with a structure suitable for a particular application. <br><br></li><li>  <b>Ability to delete data</b> <br>  Deletion of data is supported.  It is impossible to guarantee instant removal, but in the end, with respectable behavior of the nodes, the data will be deleted.  A malicious node can consciously save all data that is deleted.  However, he will not be able to do this for all data, because requests are sent to him only in a certain interval of primary keys. <br><br></li><li>  <b>Query language with the ability to search not only the primary key</b> <br>  Using <a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a> , similar to the methods of integration with <a href="http://cassandra/">Cassandra</a> in the <a href="http://www.elassandra.io/">Elassandra</a> project, <a href="http://www.elassandra.io/">it is</a> possible to extend the query language with secondary keys and full-text search. </li></ul><br>  Such a database can be used by decentralized applications on any blockchains that support Turing-complete smart contracts (however, decentralized applications are not created for other blockchains).  For example, it can be used for the needs of distributed applications on top of the <a href="https://ethereum.org/">Ethereum</a> , <a href="https://www.rchain.coop/">RChain</a> and other <a href="https://www.rchain.coop/">blockchains</a> . <br><br>  The concept of such a database was developed in the framework of the open-source project <a href="https://ubermensch.store/">Superman</a> .  There is no implementation yet (but it is clearly in demand), and the concept is being submitted to the public today.  We hope that for the first time the introduced concept of a public decentralized noSql database will interest you enough to discuss it or even join the <a href="https://ubermensch.store/">development</a> .  You can also join the <a href="https://t.me/UbermenschProject">channel in telegrams</a> , where you can chat with developers (in English). <br><br>  ‚Üí <a href="https://habrahabr.ru/post/327836/">The first part of the article</a> <br>  ‚Üí <a href="https://habrahabr.ru/post/327947/">The second part of the article</a> </div><p>Source: <a href="https://habr.com/ru/post/328004/">https://habr.com/ru/post/328004/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327994/index.html">We check the code of the dynamic analyzer Valgrind using a static analyzer</a></li>
<li><a href="../327996/index.html">BK-0010 emulator on FPGA</a></li>
<li><a href="../327998/index.html">Conference Outsource-People 2017, Krakow (day two)</a></li>
<li><a href="../328000/index.html">Segmentation of text lines of documents into characters using convolutional and recurrent neural networks</a></li>
<li><a href="../328002/index.html">SimplePage: a simple, declarative framework for rapid prototyping</a></li>
<li><a href="../328006/index.html">‚ÄúThe incident with Gitlab is a very good and revealing story‚Äù, - Alexey Lesovsky about PostgreSQL administration</a></li>
<li><a href="../328008/index.html">UAC Bypass or the story of three escalations</a></li>
<li><a href="../328010/index.html">Bildim under stm32duino using CMake (and scavenging from the linker)</a></li>
<li><a href="../328012/index.html">Redux as the heart of the front-end architecture of the Unified Frontal System</a></li>
<li><a href="../328014/index.html">Build 2017: text translation. Day 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>