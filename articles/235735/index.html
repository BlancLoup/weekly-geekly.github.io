<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>3D mode in Diablo 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a translation of the post Don't Starve, Diablo - Parallax 7 from the blog of Simon Schreibt on February 25, 2014. 
 Careful, heavy gifs. 

 In...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>3D mode in Diablo 2</h1><div class="post__text post__text-html js-mediator-article">  <i>This is a translation of the post Don't Starve, Diablo - Parallax 7 from the blog of Simon Schreibt on February 25, 2014.</i> <br>  Careful, heavy gifs. <br><br>  In the 90s, games began to move from 2D to 3D.  If the UFO then visited the earth, the aliens would have decided that the low-poly models used at that time were not needed by anyone without any filtering, and would have destroyed the Earth. <br><br>  Over time, of course, they would have learned what made people special: even in the 2D era, they had an incredible desire to render in 3D, even though it was simply impossible then! <a name="habracut"></a>  It all started with the implementation of the parallax effect (depending on the "distance", some elements moved faster than others).  This parallax effect blew people‚Äôs brain back in 1982: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/42a/86c/bdf/42a86cbdf8f748c3aac03d3d30bc013a.gif"><br>  <i>Game: <a href="http://en.wikipedia.org/wiki/Moon_Patrol">Moon Patrol</a> source: <a href="http://www.youtube.com/watch%3Fv%3DHBOKWCpwGfM">YouTube</a></i> <br><br>  Indeed, it is interesting that several planes moving in different ways create such an impressive effect.  But it looks a little flat, right?  A promising camera above the ground would have looked better, but could it not be done without the use of ‚Äúreal‚Äù 3D?  Ok, let's use the time machine and move to the SNES era: <br><br><img src="https://habrastorage.org/files/74a/de2/9d5/74ade29d56da43b5a92efbe9df28fdad.gif"><br>  <i>Game: <a href="http://en.wikipedia.org/wiki/Moon_Patrol">Moon Patrol</a> source: <a href="http://www.youtube.com/watch%3Fv%3DsqkQr89wcTc">YouTube</a></i> <br><br>  It looks like 3D, but it is not 3D!  This is a <a href="https://ru.wikipedia.org/wiki/Super_Nintendo_Entertainment_System">SNES</a> technology called ‚Äú <a href="https://ru.wikipedia.org/wiki/Mode_7">Mode 7</a> ‚Äù.  To visualize it, Nintendo manipulated textures (reducing height in favor of depth) using some kind of programmer magic.  Here are the words of a person who knows how to apply it (he talks about the <a href="https://ru.wikipedia.org/wiki/Game_Boy_Advance">Gameboy Advance</a> , but as far as I know, the recipe is also suitable for SNES): <br><blockquote>  ‚ÄúGBA has no hardware capabilities to render 3D, but you can fake it by smartly controlling the scale and transitions of REG_BGxX-REG_BGxPD for each line,‚Äù <a href="http://www.coranac.com/tonc/text/mode7.htm">Cearn</a> </blockquote><br>  By the way, even today some people go crazy over Mode 7 and use it for <a href="http://www.youtube.com/watch%3Fv%3DBO_GZzrdE9Y">projects</a> with <a href="https://www.google.ru/search%3Fq%3Drpg%2Bmaker">RPG Maker</a> .  Impressive! <br>  Today, you can render each resource in ‚Äúpresent‚Äù 3D to add volume, but there are examples where it is simply not necessary.  In fact, sometimes it's even better to use an old school: <br><br><img src="https://habrastorage.org/files/d8c/e9c/87d/d8ce9c87d6ea4bc987134de2d24aece3.gif"><br>  <i>Source: <a href="http://www.dontstarvegame.com/">Don't Starve</a></i> <br><br>  All bushes, trees and enemies in Don't starve are flat.  I think it looks cool! <br>  For me, Diablo 2 (2D ARPG 2000) was the first game that combined the parallax effect from Moon Patrol and something similar to the Mode 7 approach. <br>  Let's take a look at the game with the default settings.  Pure 2D.  No prospects.  No parallax: <br><br><img src="https://habrastorage.org/files/a1e/81e/738/a1e81e7381f44f9988aaabd221c1e7ec.gif"><br>  <i>Source: <a href="http://us.blizzard.com/en-us/games/d2/">Diablo 2</a></i> <br><br>  But the game had ‚ÄúPerspective Mode‚Äù.  Let's turn it on!  Notice that the stakes cover different pixels on the ground at different times: <br><br><img src="https://habrastorage.org/files/5f4/470/11b/5f447011b53e400ea40198ff416bb3b8.gif"><br><br>  It looks like Don't Starve, but remember: Diablo 2 is a 2D game!  There was no official information about this mode.  Everything that you are reading now has become known thanks to the excellent tools / documentation by <a href="http://www.angelfire.com/sc/mpq/">Tom Amigo</a> and <a href="http://paul.siramy.free.fr/">Paul Simari</a> .  Special thanks to Paul for answering all my questions and in many ways supporting me. <br><br>  It may seem that Blizzard programmers just somehow moved the sprites, but if you compare the game with the perspective mode turned on and turned off, and do not move, you will notice that they, in fact, shifted everything relative to the horizon line. <br><br><img src="https://habrastorage.org/files/1e3/2ce/e3a/1e32cee3ab1d410fafe7b58c2786dd6a.gif"><br><br>  If you replace the texture of the earth with an excellent chess texture, you can see even better: <br><br><img src="https://habrastorage.org/files/078/369/dbe/078369dbe61b4b5194fba6b46e5906e7.gif"><br><br>  In a sense, think about this: each resource in the scene had to be somehow transformed so that it looked promising without gaps at the edges of the sprite.  Especially considering the number of sprites in the scene (the chance to get a gap was big enough ...): <br><br><img src="https://habrastorage.org/files/744/d97/6c1/744d976c1d354fb0ae5b7923e6808e9f.gif"><br><img src="https://habrastorage.org/files/f80/a84/a83/f80a84a838ab41beb17ae96b0f38095b.gif"><br><br>  In this case, the code of the game should not be too confusing!  So please keep in mind that Blizzard divided the sprites into <a href="http://paul.siramy.free.fr/_divers/dt1_doc/">32x32px pieces</a> .  Download only those parts of the picture that are needed - it looks like an optimization.  Plus, it becomes useful when you need to apply a transformation.  See how the sprites are divided in the game: <br><br><img src="https://habrastorage.org/files/164/651/5d8/1646515d877644368486208714344ff0.jpg"><br>  <i>Source: <a href="http://paul.siramy.free.fr/_divers/dt1_doc/">D1 format by Paul Simary</a></i> <br><br>  I draw lines on every transparent texture every 32px to show a false grid.  The result exceeded my expectations!  As the vertical lines show, the sprite has a ‚Äúreal‚Äù vanishing point deep in the ground (what could you expect from a perspective): <br><br><img src="https://habrastorage.org/files/0de/978/58e/0de97858e1944523b2a721b048b487ac.jpg"><br><br>  However, I do not know why the bottom edge is so arched.  For perspective, this is not necessary (below there is a scene from 3ds Max, showing that if the camera does not rotate around its axis, then the horizontal lines remain straight): <br><br><img src="https://habrastorage.org/files/1a1/41b/c89/1a141bc898874db7bbfae814ec19a850.jpg"><br><br>  In any case, the wizards of Blizzard know why they did it.  Maybe it does not cost anything, but such a deformation depends on the ‚Äúangle‚Äù under which you look at the sprite (player / camera position).  See how the bottom edge straightens: <br><br><img src="https://habrastorage.org/files/b97/519/03c/b9751903c2b243cbb24f5ecc0e99b84a.gif"><br><br>  Here is a screenshot for those who are interested in the distortion of the chess texture: <br><br><img src="https://habrastorage.org/files/20f/4df/ff3/20f4dfff337349c7bb9cc53022dc7b39.jpg"><br><br>  If you think that this is all interesting enough, then read on and go crazy.  Paul <a href="http://paul.siramy.free.fr/_divers/dt1_doc/">writes</a> that sprites can have some kind of orientation value.  Depending on this value, the sprites are distorted differently (yes ... even more difficult)!  Here is an example: the wall has directions (Left edge, top edge, left bottom edge, etc.) <br><br><img src="https://habrastorage.org/files/dc3/4a7/c45/dc34a7c45a0047b8bff63be0eb42e8db.jpg"><br>  <i>Source: <a href="http://paul.siramy.free.fr/_divers/dt1_doc/">DT1 format by Paul Siramy</a></i> <br><br>  Let me demonstrate how (in my opinion) this is done.  The following image shows the standard ISO view.  Below are the steps I took to make sprites "promising."  I had to move them, scale them and deform them twice to achieve this effect. <br><br><img src="https://habrastorage.org/files/909/998/3b0/9099983b03c84f10810e0adf0c73c3ea.gif"><br><br>  As you can see, the transformation in my view is a bit confusing.  Let's see how this is actually done in the game: <br><br><img src="https://habrastorage.org/files/f96/13b/af8/f9613baf8a3f4ebf859bde9d31d37682.jpg"><br><br>  This sprite is oriented differently than in the example I mentioned earlier.  See, the deformation is completely different!  The upper and lower boundaries are no longer bent, instead, they seem to ‚Äúlook‚Äù at the vanishing point on the left.  Again, let's look at an example of how it looks in 3ds Max: <br><br><img src="https://habrastorage.org/files/234/d9f/f81/234d9ff814ec47eca73729bf79d8418b.jpg"><br><br>  Apparently, the game exaggerates the distortion to avoid the gaps between the sprites and it seems to me, quite successfully, because every sprite of the fence is great.  Note that the direction of the faces (top and bottom) changes depending on their location: <br><br><img src="https://habrastorage.org/files/413/cae/e9e/413caee9e2fb407c8bb18bbc72dd21b3.jpg"><br><br>  The following example shows how important the value of orientation is in sprites.  If you just say the game: ‚Äúthis is not the left wall, but the right one‚Äù, it is time for the slots: <br><br><img src="https://habrastorage.org/files/1ed/08d/562/1ed08d5623314fa2a2f872a0e651ec6c.jpg"><br><br>  This mode could only be activated in full-screen mode with D3D (Diablo 2 also supported Glide and Software Acceleration modes), which made me try to deal with the old DirectX documentation, without success. <br><br>  So ... our journey ends here, and I hope that you are impressed with this example of craving to make 2D look like 3D, just like me.  The lack of official information and the absence of official statements about this (look at the government‚Äôs website, there‚Äôs nothing on the ‚ÄúPerspective Mode in Diablo 2‚Äù) led me to the inevitable conclusion: <br><br>  <b>This is all alien technology!</b> <br><br>  Tools used: <br><ul><li>  <a href="http://www.angelfire.com/sc/mpq/">MPQ Editor</a> (to extract DT1 files from MPQ) by Tom Amigo </li><li>  <a href="">DT1 Tools</a> (to extract PCX files from DT1) by Paul Simary </li><li>  <a href="http://paul.siramy.free.fr/_divers/dt1_doc/">DT1 Tutorial</a> (for understanding DT1 format) by Paul Simary </li><li>  <a href="http://www.gimp.org/">GIMP</a> (for editing / saving PCX files) </li><li>  <a href="http://paul.siramy.free.fr/_divers/ds1/doc/index.html">Diablo 2 Map Editor</a> (for understanding D2 maps) by Paul Simary </li></ul><br>  Thanks to Hans Wust for <a href="http://toothwalker.org/optics/distortion.html">this wonderful article</a> on image distortion, it all looks almost like Diablo 2 (with perspective mode enabled).  I don‚Äôt know, maybe D2 programmers used exactly this information, but it looks very familiar. </div><p>Source: <a href="https://habr.com/ru/post/235735/">https://habr.com/ru/post/235735/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235723/index.html">Creating plug-ins for AutoCAD using the .NET API (part 1 - first steps)</a></li>
<li><a href="../235725/index.html">OOBD without OOP</a></li>
<li><a href="../235727/index.html">Uploading sketches to Arduino via Bluetooth</a></li>
<li><a href="../235729/index.html">Realistic gravity lensing on Unity</a></li>
<li><a href="../235731/index.html">Ideal development environment for PIC - personal experience</a></li>
<li><a href="../235739/index.html">Recycling Gadgets</a></li>
<li><a href="../235741/index.html">Writing a lossless audio player in JavaScript</a></li>
<li><a href="../235743/index.html">Das Experiment, or a few days of life without Resharper</a></li>
<li><a href="../235745/index.html">Study: how users actually work with touch screens</a></li>
<li><a href="../235749/index.html">Smart watches from Lively service: personal rescue service that is always in touch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>