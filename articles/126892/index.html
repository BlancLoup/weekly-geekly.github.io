<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Alerts from Nagios phone call</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It still seems incredible that the server can call me in case of problems, but in reality the implementation was even simpler than I thought. I want t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Alerts from Nagios phone call</h1><div class="post__text post__text-html js-mediator-article">  It still seems incredible that the server can call me in case of problems, but in reality the implementation was even simpler than I thought.  I want to share my decision. <br><a name="habracut"></a><br>  All actions are performed on Ubuntu, sipnet.ru is a sip-provider <br><br>  Load and <a href="http://www.pjsip.org/download.htm">build pjsip</a> : <br><br><pre><code class="bash hljs">wget http://www.pjsip.org/release/1.10/pjproject-1.10.tar.bz2 tar xfv pjproject-1.10.tar.bz2 <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> pjproject-1.10 ./configure --<span class="hljs-built_in"><span class="hljs-built_in">disable</span></span>-sound make dep make</code> </pre> <br>  From all that I have <a href="http://www.pjsip.org/pjsua.htm">gathered,</a> only <a href="http://www.pjsip.org/pjsua.htm">pjsua</a> will be <a href="http://www.pjsip.org/pjsua.htm">needed</a> : 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">sudo cp pjsip-apps/bin/pjsua-x86_64-unknown-linux-gnu /usr/bin/pjsua</code> </pre> <br>  Create the / etc / pjsuarc file with the following content: <br><br><pre> <code class="bash hljs">--duration=1 <span class="hljs-comment"><span class="hljs-comment">#  ,      --null-audio # pjsua       --id sip:SIPID@sipnet.ru #  sipnet.ru --registrar sip:sipnet.ru --realm etc.tario.ru --username SIPID --password PASSWORD</span></span></code> </pre> <br>  Now it's time to check the configuration and make a test call: <br><br><pre> <code class="bash hljs">pjsua --config-file=/etc/pjsuarc sip:+12345678901@sipnet.ru</code> </pre> <br>  In the case of sipnet, if the Caller ID service is not included in the Premium Services section (I don‚Äôt know why premium, the service is free), or the same number that the call is made to, the number will be determined +74993462198 (at least for Russia ), it does not allow to identify what our server is calling. <br>  Therefore, I did the following: I registered my second number in sipnet and indicated it as the displayed number.  In the phone he saved it under the name of Nagios and set him a pleasant loud melody. <br><br>  Next, change the permissions on / etc / pjsuarc, so that only root and nagios can see the password: <br><br><pre> <code class="bash hljs">sudo chmod 640 /etc/pjsuarc sudo chown root:nagios /etc/pjsuarc</code> </pre> <br>  Add the following lines to /etc/nagios3/commands.cfg: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># 'notify-host-by-sip' command definition define command{ command_name notify-host-by-sip command_line (sleep 120 &amp;&amp; echo q) | /usr/bin/pjsua --config-file=/etc/pjsuarc sip:$CONTACTEMAIL$ } # 'notify-service-by-sip' command definition define command{ command_name notify-service-by-sip command_line (sleep 120 &amp;&amp; echo q) | /usr/bin/pjsua --config-file=/etc/pjsuarc sip:$CONTACTEMAIL$ }</span></span></code> </pre> <br>  Add the contact to /etc/nagios3/conf.d/contacts_nagios2.cfg: <br><br><pre> <code class="bash hljs">define contact{ contact_name user_sip <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> useralias service_notification_period 24x7 host_notification_period 24x7 service_notification_options c host_notification_options d service_notification_commands notify-service-by-sip host_notification_commands notify-host-by-sip email +12345678901@sipnet.ru }</code> </pre> <br>  Nagios will call at any time, but only in critical cases. <br><br>  And do not forget to add a new contact in the same config to the desired group: <br><br><pre> <code class="bash hljs">define contactgroup{ contactgroup_name admins <span class="hljs-built_in"><span class="hljs-built_in">alias</span></span> Nagios Administrators members root,user_email,user_sip }</code> </pre> <br>  Just in case, we are convinced that in a critical case, the server really calls us, for example, by correcting the password for accessing MySQL to the wrong one in /etc/nagios3/conf.d/services_nagios2.cfg <br><br>  Restart Nagios: <br><br><pre> <code class="bash hljs">sudo service nagios3 restart</code> </pre> <br>  And waiting for a call. <br><br>  If you wish, you can go ahead and add text-to-speech, but it turned out to be enough for me to call from a certain number to see that there was a problem, and you can find out the details by checking the mail. <br><br>  <a href="http://www.pjsip.org/pjsua.htm">Pjsu manual</a> </div><p>Source: <a href="https://habr.com/ru/post/126892/">https://habr.com/ru/post/126892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126887/index.html">Do not rewrite classes in Magento</a></li>
<li><a href="../126888/index.html">Evernote major update for iOS</a></li>
<li><a href="../126889/index.html">Completely new Evernote for Mac 3.0, Lion version</a></li>
<li><a href="../126890/index.html">Stages of development of the company in terms of IT</a></li>
<li><a href="../126891/index.html">HAF X Mini Bike is a very unusual modding gaming PC.</a></li>
<li><a href="../126893/index.html">Idea: Startup Exchange or Nasdak for Small</a></li>
<li><a href="../126894/index.html">Free Windows Phone Phones for webOS Developers</a></li>
<li><a href="../126897/index.html">Twitter users have image galleries</a></li>
<li><a href="../126898/index.html">MySQL sandbox # 2</a></li>
<li><a href="../126899/index.html">Android in e-mobile</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>