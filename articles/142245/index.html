<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual monitoring of a large number of objects (for example, IPTV channels) using Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will tell you how I implemented my old idea - a visual display of the state of IPTV channels. In general, initially it was all about...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual monitoring of a large number of objects (for example, IPTV channels) using Arduino</h1><div class="post__text post__text-html js-mediator-article"> In this article I will tell you how I implemented my old idea - a visual display of the state of IPTV channels.  In general, initially it was all about monitoring - for example, a map of the city, LEDs were placed on it (in the places where the equipment is located), and looking at this map you can always clearly see what happened where it broke. <br>  But in my case we are talking about IPTV channels. <br><br>  We have a lot of these channels, almost 160 of them, not counting service channels, of which the federalka is multiplexed (for example, TNT channel is taken from two receivers located in different parts of the city (ideally, of course, I want to come from another city), multicast private streams are driven into a multiplexer, which already produces one public multicast, while in case of a failure of one of the channels it automatically switches to the reserve. <br><a name="habracut"></a><br>  Naturally, I monitored software monitoring, i.e.  made a whole complex of, for example, scripts that run through all channels - subscribe to them, check if there are any errors in the stream, if the channel coding has failed, trying to fix them by distorting the cam modules (using telnet, snmp) just trite rebooting the receiver if the number of failed channels coming from him more than half, of course, sms-ka me about all the significant events.  Also, statistics on the entire network are collected from STB-NIS, from switches, which firmware people have, which consoles, which channels and which programs people watch most of all (very curious data by the way). <br><br>  For clarity, there is a program that runs through the channels in the form of a mosaic, or holds a certain <br>  part of the channels on the screen (all 160 channels, you know, do not fit on one screen, but 4x6 = 24 SD channels on a computer with good process / video / network card is quite real). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, programmatically, all this is already there, but so that without a computer and in the form of LEDs - it was not ... <br>  And then I met with Arduino. <br>  You probably understand what it led to. <br><br>  Since I was not friends with a soldering iron (and even now I am not strong - but I hope to have certain progress), and I was not at all friendly with circuitry, etc.  - It was hard for me at first (and now, too), but that was the goal - to learn something new, to know the unknown before.  I will not dwell on how in the process I learned about such things as shift registers, insights, how one can control a whole array of LEDs, using such a phenomenon as ‚Äúdynamic indication‚Äù.  Just tell you what happened in the end (and I did it!). <br><br> <a href=""><img src="http://www.ibz.ru/website/Pics/IPTV_MONITORING_schema_small.png" alt="clickable"></a> <br><br>  So, I soldered a matrix of 16x10 LEDs to the finished prototype board, connected them through 4 shift registers 74HC595.  Used arduino and ethershield on enc28j60 for it. <br>  It turned out about here (pictures are clickable) <br><br> <a href=""><img src="http://www.ibz.ru/website/Pics/IMG_2519_small.png" alt="clickable"></a> <br><br> <a href=""><img src="http://www.ibz.ru/website/Pics/IMG_2517_small.png" alt="clickable"></a> <br><br> <a href=""><img src="http://www.ibz.ru/website/Pics/IMG_2516_small.png" alt="clickable"></a> <br><br>  The code for the development environment with version 0.22 and the ethershield version 1.1 library. <br>  Already at the moment I know for sure that there is a newer, if you suddenly want to repeat it, you may have to adapt <br><br><pre> <code class="hljs lua">#include <span class="hljs-string"><span class="hljs-string">"etherShield.h"</span></span> static uint8_t mymac[<span class="hljs-number"><span class="hljs-number">6</span></span>] = {<span class="hljs-number"><span class="hljs-number">0x00</span></span>,<span class="hljs-number"><span class="hljs-number">0x80</span></span>,<span class="hljs-number"><span class="hljs-number">0x48</span></span>,<span class="hljs-number"><span class="hljs-number">0x2d</span></span>,<span class="hljs-number"><span class="hljs-number">0xf7</span></span>,<span class="hljs-number"><span class="hljs-number">0x25</span></span>}; //  mac-  static uint8_t myip[<span class="hljs-number"><span class="hljs-number">4</span></span>] = {<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span>}; // ip- <span class="hljs-number"><span class="hljs-number">10.20</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span><span class="hljs-number"><span class="hljs-number">.40</span></span> #define MYPORT <span class="hljs-number"><span class="hljs-number">5555</span></span> #define BUFFER_SIZE <span class="hljs-number"><span class="hljs-number">500</span></span> static uint8_t buf[BUFFER_SIZE+<span class="hljs-number"><span class="hljs-number">1</span></span>]; static <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> number[<span class="hljs-number"><span class="hljs-number">7</span></span>]; const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> clockPin = <span class="hljs-number"><span class="hljs-number">7</span></span>; // const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> latchPin = <span class="hljs-number"><span class="hljs-number">8</span></span>; //         const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> dataPin = <span class="hljs-number"><span class="hljs-number">9</span></span>; // const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> NumRegs = <span class="hljs-number"><span class="hljs-number">4</span></span>; //    const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> NumCols=<span class="hljs-number"><span class="hljs-number">10</span></span>; const <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> NumRows=<span class="hljs-number"><span class="hljs-number">16</span></span>; //      -       , //       //    <span class="hljs-number"><span class="hljs-number">4</span></span> ,       , //   //     ()   <span class="hljs-number"><span class="hljs-number">1</span></span>  <span class="hljs-number"><span class="hljs-number">32</span></span> //     <span class="hljs-number"><span class="hljs-number">26</span></span>  (<span class="hljs-number"><span class="hljs-number">10</span></span>+<span class="hljs-number"><span class="hljs-number">16</span></span>) -      <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> Col_bits[NumCols] = {<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">7</span></span>,<span class="hljs-number"><span class="hljs-number">11</span></span>,<span class="hljs-number"><span class="hljs-number">13</span></span>,<span class="hljs-number"><span class="hljs-number">15</span></span>,<span class="hljs-number"><span class="hljs-number">19</span></span>,<span class="hljs-number"><span class="hljs-number">21</span></span>,<span class="hljs-number"><span class="hljs-number">23</span></span>,<span class="hljs-number"><span class="hljs-number">27</span></span>}; //         //    , .. <span class="hljs-number"><span class="hljs-number">1</span></span>-  //    <span class="hljs-number"><span class="hljs-number">3</span></span>    .. <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> Row_bits[NumRows] = {<span class="hljs-number"><span class="hljs-number">32</span></span>,<span class="hljs-number"><span class="hljs-number">30</span></span>,<span class="hljs-number"><span class="hljs-number">28</span></span>,<span class="hljs-number"><span class="hljs-number">26</span></span>,<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">22</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">18</span></span>,<span class="hljs-number"><span class="hljs-number">16</span></span>,<span class="hljs-number"><span class="hljs-number">14</span></span>,<span class="hljs-number"><span class="hljs-number">12</span></span>,<span class="hljs-number"><span class="hljs-number">10</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>}; //      //      <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> Regs[NumRegs]; int reg_n, bit_n, in_r, in_c; // , . //       <span class="hljs-number"><span class="hljs-number">2</span></span>! ;) // -   <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> matrix[NumRows][NumCols]={{<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}, {<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>}}; EtherShield es=EtherShield(); void setup() { pinMode(latchPin, OUTPUT); pinMode(dataPin, OUTPUT); pinMode(clockPin, OUTPUT); es.ES_enc28j60Init(mymac); //   es.ES_init_ip_arp_udp_tcp(mymac,myip, MYPORT); //   } void loop() { uint16_t plen, dat_p, ptr; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>) { burn_matrix(); //          //        ( ).    //       ,     //     -      //   - <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> packet, handle ping <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a tcp packet: dat_p=es.ES_packetloop_icmp_tcp(buf,es.ES_enc28j60PacketReceive(BUFFER_SIZE, buf)); /* dat_p will be unequal to zero <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> there is a valid request */ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(dat_p == <span class="hljs-number"><span class="hljs-number">0</span></span>) { // no request continue; } //             :) //        <span class="hljs-string"><span class="hljs-string">"IbZ "</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strncmp(<span class="hljs-string"><span class="hljs-string">"IbZ "</span></span>,(<span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *)&amp;(buf[dat_p]),<span class="hljs-number"><span class="hljs-number">4</span></span>)==<span class="hljs-number"><span class="hljs-number">0</span></span>) { //   <span class="hljs-number"><span class="hljs-number">4</span></span>-       ptr = dat_p+<span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(in_r=<span class="hljs-number"><span class="hljs-number">0</span></span>; in_r &lt; NumRows; in_r++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(in_c=<span class="hljs-number"><span class="hljs-number">0</span></span>; in_c &lt; NumCols; in_c++) { matrix[in_r][in_c] = <span class="hljs-number"><span class="hljs-number">0</span></span>; //    ( ,    ;) ) } } //    -   -   //   ,   - <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(buf[ptr] != <span class="hljs-number"><span class="hljs-number">0</span></span>) { in_r = (buf[ptr]<span class="hljs-number"><span class="hljs-number">-1</span></span>) % <span class="hljs-number"><span class="hljs-number">16</span></span>; in_c = (buf[ptr]<span class="hljs-number"><span class="hljs-number">-1</span></span>) / <span class="hljs-number"><span class="hljs-number">16</span></span>; matrix[in_r][in_c] = <span class="hljs-number"><span class="hljs-number">1</span></span>; //     ptr++; } } } } void burn_matrix() { //     -  <span class="hljs-number"><span class="hljs-number">1</span></span>- ,  , //  <span class="hljs-number"><span class="hljs-number">2</span></span>- ,       <span class="hljs-number"><span class="hljs-number">10</span></span>-  <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int c = <span class="hljs-number"><span class="hljs-number">0</span></span>; c &lt; NumCols; c++) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; NumRegs; i++) { Regs[i]=<span class="hljs-number"><span class="hljs-number">255</span></span>; } reg_n = (Col_bits[c]<span class="hljs-number"><span class="hljs-number">-1</span></span>) / <span class="hljs-number"><span class="hljs-number">8</span></span>; bit_n = (Col_bits[c]<span class="hljs-number"><span class="hljs-number">-1</span></span>) % <span class="hljs-number"><span class="hljs-number">8</span></span>; bitWrite(Regs[reg_n], bit_n, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int r = <span class="hljs-number"><span class="hljs-number">0</span></span>; r &lt; NumRows; r++) { reg_n = (Row_bits[r]<span class="hljs-number"><span class="hljs-number">-1</span></span>) / <span class="hljs-number"><span class="hljs-number">8</span></span>; bit_n = (Row_bits[r]<span class="hljs-number"><span class="hljs-number">-1</span></span>) % <span class="hljs-number"><span class="hljs-number">8</span></span>; bitWrite(Regs[reg_n], bit_n, matrix[r][c]); } registerWrite(); delay(<span class="hljs-number"><span class="hljs-number">1</span></span>); } } //      -     void registerWrite() { digitalWrite(latchPin, LOW); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(int cur_reg = NumRegs<span class="hljs-number"><span class="hljs-number">-1</span></span>; cur_reg &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>; cur_reg<span class="hljs-comment"><span class="hljs-comment">-- ) { shiftOut(dataPin, clockPin, MSBFIRST, Regs[cur_reg]); } digitalWrite(latchPin, HIGH); } </span></span><br></code> </pre> <code>#include "etherShield.h" static uint8_t mymac[6] = {0x00,0x80,0x48,0x2d,0xf7,0x25}; //  mac-  static uint8_t myip[4] = {10,20,30,40}; // ip- 10.20.30.40 #define MYPORT 5555 #define BUFFER_SIZE 500 static uint8_t buf[BUFFER_SIZE+1]; static char number[7]; const byte clockPin = 7; // const byte latchPin = 8; //         const byte dataPin = 9; // const byte NumRegs = 4; //    const byte NumCols=10; const byte NumRows=16; //      -       , //       //    4 ,       , //   //     ()   1  32 //     26  (10+16) -      byte Col_bits[NumCols] = {3,5,7,11,13,15,19,21,23,27}; //         //    , .. 1-  //    3    .. byte Row_bits[NumRows] = {32,30,28,26,24,22,20,18,16,14,12,10,8,6,4,2}; //      //      byte Regs[NumRegs]; int reg_n, bit_n, in_r, in_c; // , . //       2! ;) // -   byte matrix[NumRows][NumCols]={{1,0,1,0,0,0,1,1,1,1}, {1,0,1,0,0,0,0,0,0,1}, {1,0,1,0,0,0,0,0,0,1}, {1,0,1,0,0,0,0,0,1,0}, {1,0,1,0,0,0,0,0,1,0}, {1,0,1,1,0,0,0,0,1,0}, {1,0,1,0,1,0,0,1,0,0}, {1,0,1,0,1,0,0,1,0,0}, {1,0,1,0,1,0,0,1,0,0}, {1,0,1,0,1,0,1,0,0,0}, {1,0,1,0,1,0,1,0,0,0}, {1,0,1,1,0,0,1,1,1,1}, {0,0,0,0,0,0,0,0,0,0}, {0,0,0,0,0,0,0,0,0,0}, {0,0,0,0,0,0,0,0,0,0}, {0,0,0,0,0,0,0,0,0,0}}; EtherShield es=EtherShield(); void setup() { pinMode(latchPin, OUTPUT); pinMode(dataPin, OUTPUT); pinMode(clockPin, OUTPUT); es.ES_enc28j60Init(mymac); //   es.ES_init_ip_arp_udp_tcp(mymac,myip, MYPORT); //   } void loop() { uint16_t plen, dat_p, ptr; while(1) { burn_matrix(); //          //        ( ).    //       ,     //     -      //   - read packet, handle ping and wait for a tcp packet: dat_p=es.ES_packetloop_icmp_tcp(buf,es.ES_enc28j60PacketReceive(BUFFER_SIZE, buf)); /* dat_p will be unequal to zero if there is a valid request */ if(dat_p == 0) { // no request continue; } //             :) //        "IbZ " if (strncmp("IbZ ",(char *)&amp;(buf[dat_p]),4)==0) { //   4-       ptr = dat_p+4; for(in_r=0; in_r &lt; NumRows; in_r++) { for(in_c=0; in_c &lt; NumCols; in_c++) { matrix[in_r][in_c] = 0; //    ( ,    ;) ) } } //    -   -   //   ,   - 0 while(buf[ptr] != 0) { in_r = (buf[ptr]-1) % 16; in_c = (buf[ptr]-1) / 16; matrix[in_r][in_c] = 1; //     ptr++; } } } } void burn_matrix() { //     -  1- ,  , //  2- ,       10-  for(int c = 0; c &lt; NumCols; c++) { for(int i = 0; i &lt; NumRegs; i++) { Regs[i]=255; } reg_n = (Col_bits[c]-1) / 8; bit_n = (Col_bits[c]-1) % 8; bitWrite(Regs[reg_n], bit_n, 0); for(int r = 0; r &lt; NumRows; r++) { reg_n = (Row_bits[r]-1) / 8; bit_n = (Row_bits[r]-1) % 8; bitWrite(Regs[reg_n], bit_n, matrix[r][c]); } registerWrite(); delay(1); } } //      -     void registerWrite() { digitalWrite(latchPin, LOW); for(int cur_reg = NumRegs-1; cur_reg &gt;= 0; cur_reg-- ) { shiftOut(dataPin, clockPin, MSBFIRST, Regs[cur_reg]); } digitalWrite(latchPin, HIGH); } <br></code> <br><br>  The algorithm is simple: if the channel stops working, you can immediately see that the LED starts to burn and does not go out. <br>  When the channel is checked, the LED is on, if everything is good, the LED will go out, i.e.  it is visible as the script checking channels runs.  It runs on the monitoring server once every half hour (each channel takes a little more than 8 seconds), the private federal user is checked separately and is not displayed here - in the plans (unfortunately, the truth is probably already impossible :() to make a matrix for a larger number of LEDs, to run several servers monitoring (parallel process so that all channels are checked every 5-10 minutes). <br><br>  Here is a short video: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DWBttNEFcK4%3Ffeature%3Doembed&amp;xid=17259,15700019,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhiBGzGHvMvys26wINEBtIqjwp57DA" frameborder="0" allowfullscreen=""></iframe><br><br>  Well, as is customary, the approximate cost of the main materials used (basically everything is bought on ebay / Chinese shops): <br><table><tbody><tr><td>  Breadboard Prototype PCB Print Circuit Board 18 x 30 </td><td align="right">  ~ $ 4 </td></tr><tr><td>  160 3mm green LEDs </td><td align="right">  less than $ 5 can be found </td></tr><tr><td>  Arduino </td><td align="right">  ~ $ 16 </td></tr><tr><td>  ENC28J60 Ethernet Shield for Arduino Duemilanove / Uno </td><td align="right">  ~ $ 16 </td></tr><tr><td>  4 registers 74HC595 </td><td align="right">  ~ $ 3 </td></tr><tr><td>  <b>Total</b> </td><td align="right">  <b>~ $ 45-50</b> </td></tr></tbody></table></div><p>Source: <a href="https://habr.com/ru/post/142245/">https://habr.com/ru/post/142245/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142240/index.html">SVG stacks</a></li>
<li><a href="../142241/index.html">Optimization of flatpages project on django under the minimum system requirements. Joke article</a></li>
<li><a href="../142242/index.html">Compression without loss of information. Part one</a></li>
<li><a href="../142243/index.html">How would I do BusyIndicator</a></li>
<li><a href="../142244/index.html">Do you really want to use the cancel button in your apps?</a></li>
<li><a href="../142247/index.html">The Pirate Bay: and .torrent files have not gone anywhere</a></li>
<li><a href="../142248/index.html">Media Piracy in Developing Economies</a></li>
<li><a href="../142249/index.html">Domain.RUS application filed with ICANN</a></li>
<li><a href="../142252/index.html">Results of the initiative to support the development of Windows Phone applications in MCP-clubs and User Group</a></li>
<li><a href="../142253/index.html">Remart: how I created my business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>