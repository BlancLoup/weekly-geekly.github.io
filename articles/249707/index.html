<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing FreeBSD over the network (PXE) from a linux server (dnsmasq + nfs)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There was a need to install FreeBSD on a laptop. Since the laptop is ancient, it does not support booting from a flash drive by usb. There were no bla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing FreeBSD over the network (PXE) from a linux server (dnsmasq + nfs)</h1><div class="post__text post__text-html js-mediator-article">  There was a need to install FreeBSD on a laptop.  Since the laptop is ancient, it does not support booting from a flash drive by usb.  There were no blanks at hand either, it was decided to test the installation via PXE (Preboot eXecution Environment).  Googling, I found several articles on this topic, but they describe installing linux from a linux server, or FreeBSD from a FreeBSD server.  I do not pretend to create any particular method, just posting my instructions for quickly deploying FreeBSD 10.1 over the network. <br><a name="habracut"></a><br>  The theoretical part of the PXE boot is well described in the article: <a href="http://xgu.ru/wiki/PXE">http://xgu.ru/wiki/PXE</a> <br><br>  So let's get started.  We will need: dhcp, tftp, nfs. <br><br>  A server with Debian 7 installed will act as a server. I have already installed dnsmasq on it, which is both a dhcp and dns server.  This is very convenient for a small home network, so as not to lift dhcp and bind separately.  In addition, dnsmasq has its own tftp server, so it is ideally suited for our task, as they say - ‚Äúall in one bottle‚Äù.  It remains to install the nfs server and configure the whole thing.  The PXE bootloader is available in the FreeBSD distribution image. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Install the necessary packages: <br><br><pre><code class="bash hljs">apt-get install dnsmasq nfs-kernel-server</code> </pre> <br>  We download FreeBSD iso-image from the official site freebsd.org.  I used the minimum bootonly image: <br><br><pre> <code class="bash hljs">wget ftp://ftp.freebsd.org/pub/FreeBSD/releases/i386/i386/ISO-IMAGES/10.1/FreeBSD-10.1-RELEASE-i386-bootonly.iso</code> </pre> <br>  Mount it: <br><br><pre> <code class="bash hljs">mount -o loop FreeBSD-10.1-RELEASE-i386-bootonly.iso /mnt</code> </pre> <br>  Copy all image files to the directory that will be accessible via nfs: <br><br><pre> <code class="bash hljs">cp -a /mnt /srv/nfs/freebsd</code> </pre> <br>  Add nfs-ball to / etc / exports <br><br><pre> <code class="bash hljs">/srv/nfs/freebsd 192.168.0.0/24(rw,sync,no_subtree_check)</code> </pre> <br>  Restart nfs: <br><br><pre> <code class="bash hljs">service nfs-kernel-server restart</code> </pre> <br><br>  <b>Now it is necessary to correct something:</b> <br><br>  Let's comment or delete the line in / srv / nfs / freebsd / etc / fstab so that the system does not try to mount the disk (the image is intended for writing to the disc) when booting, and mounted our nfs-ball as the root file system: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /dev/iso9660/10_1_RELEASE_I386_BO / cd9660 ro 0 0</span></span></code> </pre> <br>  Remove the symbolic link /srv/nfs/freebsd/etc/resolv.conf, which refers to a nonexistent file /srv/nfs/freebsd/tmp/bsdinstall_etc/resolv.conf.  In theory, the address of the dns server should have been obtained via dhcp and written to this file by the FreeBSD installer at startup.  However, this does not happen: the installer creates an empty file, and if a file has already been created, overwrites it.  Therefore, instead of a symlink, we create a new file /srv/nfs/freebsd/etc/resolv.conf and write the address of our dns server into it: <br><br><pre> <code class="bash hljs">nameserver 192.168.0.101</code> </pre> <br>  We edit the /etc/dnsmasq.conf file, cite only those options that are required to solve our problem, i.e.  dhcp + tftp without dns: <br><br><pre> <code class="bash hljs">interface=eth0 <span class="hljs-comment"><span class="hljs-comment">#,    dhcp- dhcp-range=192.168.0.200,192.168.0.250,12h #  ip-    dhcp-option=17,/srv/nfs/freebsd/ #   nfs dhcp-boot=/srv/nfs/freebsd/boot/pxeboot #   PXE- enable-tftp #  tftp- tftp-root=/srv/nfs/freebsd/ #  tftp</span></span></code> </pre><br>  Restart dnsmasq: <br><br><pre> <code class="bash hljs">service dnsmasq restart</code> </pre> <br>  That's all.  Go to the BIOS, select the boot order from the LAN (PXE).  The network card loads pxe-loader, then the kernel is copied and started via tftp, the root file system is mounted via nfs, the FreeBSD installer is started, and then the standard FreeBSD installation.  Do not forget only to complete the installation to change the boot order in the BIOS to the previous one. </div><p>Source: <a href="https://habr.com/ru/post/249707/">https://habr.com/ru/post/249707/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../249697/index.html">Using graphs to reveal insider plans</a></li>
<li><a href="../249699/index.html">Programming training. The point of view of the teacher and his advice</a></li>
<li><a href="../249701/index.html">Freeswitch - installation and integration with SIPML5</a></li>
<li><a href="../249703/index.html">Windows 10 comes to Raspberry Pi 2</a></li>
<li><a href="../249705/index.html">Own browser - mouse path: WHY?</a></li>
<li><a href="../249711/index.html">Audiocodes + Lync 2013 + provider that does not support History-info</a></li>
<li><a href="../249715/index.html">HP Vertica: Big Data DBMS</a></li>
<li><a href="../249717/index.html">Streaming interactive content. No Plugins</a></li>
<li><a href="../249719/index.html">How we implemented HTTPS on the main page of the Mail.Ru portal</a></li>
<li><a href="../249721/index.html">A banal XSS vulnerability on the Fidobank p2p transfer page that allows you to steal cvv2 user code</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>