<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Lagger - error handling and debugging in PHP with eyes closed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This tool was first introduced to the general public in 2008 at the Highload.ru conference, after which it was thoroughly optimized and refined. About...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Lagger - error handling and debugging in PHP with eyes closed</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/995/571/a91/995571a91fbca7fdc32f97489933df58.jpg" alt="image"><br><br>  This tool was first introduced to the general public in 2008 at the <a href="http://highload.ru/">Highload.ru</a> conference, after which it was thoroughly optimized and refined.  About what kind of animal it is and how it is convenient to use <a name="habracut"></a>  read on. <br><br><h4>  Article format </h4><br>  At first there was a desire to write a detailed guide-specification on the entire functionality of the library.  Then I realized that it would be much clearer and clearer to cite simple examples of its practical use, and then briefly list the main features.  So‚Ä¶ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  On <s>fingers</s> examples </h4><br>  <b>config.php</b> - all constants are fictional, any coincidences are random.  It is important to understand that these constants are given for example only.  Ideally, you can prescribe everything without them at all (see further <b>lagger_init.php</b> ). <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">&lt;?php <br> <br> define( <font color="#A31515">'SKIPER_DIR'</font> , LOGS_DIR . DIRECTORY_SEPARATOR . <font color="#A31515">'skip'</font> ); <br> define( <font color="#A31515">'SKIPER_EXPIRE'</font> , 60 * 60 * 24); <br> define( <font color="#A31515">'SKIPER_HASH_TEMPLATE'</font> , <font color="#A31515">'{file}{line}'</font> ); <br> <br> define( <font color="#A31515">'ERRORS_STDOUT'</font> , <font color="#0000ff">true</font> ); <br> define( <font color="#A31515">'ERRORS_STDOUT_TAGS'</font> , <font color="#0000ff">null</font> ); <br> define( <font color="#A31515">'ERRORS_STDOUT_TEMPLATE'</font> , <font color="#A31515">'&lt;div&gt;&lt;font color="red"&gt;&lt;b&gt;{type}:&lt;/b&gt; {message}&lt;br /&gt;&lt;em&gt;{file} [{line}]&lt;/em&gt;&lt;/font&gt;&lt;/div&gt;'</font> ); <br> <br> define( <font color="#A31515">'ERRORS_LOGING'</font> , <font color="#0000ff">true</font> ); <br> define( <font color="#A31515">'ERRORS_LOGING_TAGS'</font> , <font color="#A31515">'warning,fatal'</font> ); <br> define( <font color="#A31515">'ERRORS_LOGING_FILEPATH'</font> , LOGS_DIR . DIRECTORY_SEPARATOR . <font color="#A31515">'errors_log.htm'</font> ); <br> define( <font color="#A31515">'ERRORS_LOGING_LIMIT_SIZE'</font> , 500000); <br> define( <font color="#A31515">'ERRORS_LOGING_LIMIT_DAYS'</font> , 180); <br> define( <font color="#A31515">'ERRORS_LOGING_TEMPLATE'</font> , <font color="#A31515">'{date} {time} &lt;a href="http://{host}{uri}"&gt;http://{host}{uri}&lt;/a&gt;&lt;br /&gt;&lt;b&gt;{type}&lt;/b&gt;: {message|htmlentities}&lt;br /&gt;{file} [{line}]&lt;hr /&gt;'</font> ); <br> <br> define( <font color="#A31515">'ERRORS_SMS'</font> , <font color="#0000ff">false</font> ); <font color="#008000">// TODO: check /library/SmsSender.php before enable it</font> <br> define( <font color="#A31515">'ERRORS_SMS_TAGS'</font> , <font color="#A31515">'warning,fatal'</font> ); <br> define( <font color="#A31515">'ERRORS_SMS_TO'</font> , <font color="#A31515">'79627271169,79218550471'</font> ); <br> define( <font color="#A31515">'ERRORS_SMS_FROM'</font> , <font color="#A31515">'MyWebSite'</font> ); <br> define( <font color="#A31515">'ERRORS_SMS_MESSAGE'</font> , <font color="#A31515">'Web site error, check log at {date} {time}'</font> ); <br> <br> define( <font color="#A31515">'ERRORS_EMAIL'</font> , <font color="#0000ff">true</font> ); <font color="#008000">// TODO: must be TRUE on production server</font> <br> define( <font color="#A31515">'ERRORS_EMAIL_TAGS'</font> , <font color="#A31515">'warning,fatal'</font> ); <br> define( <font color="#A31515">'ERRORS_EMAIL_FROM'</font> , <font color="#A31515">'Lagger &lt;lagger@mywebsite.com&gt;'</font> ); <br> define( <font color="#A31515">'ERRORS_EMAIL_TO'</font> , <font color="#A31515">'Jack Johnson &lt;jack_admin@gmail.com&gt;, mike_developer@gmail.com'</font> ); <br> define( <font color="#A31515">'ERRORS_EMAIL_SUBJECT'</font> , <font color="#A31515">'{type} error in my website'</font> ); <br> define( <font color="#A31515">'ERRORS_EMAIL_MESSAGE'</font> , <font color="#A31515">"Date: {date} {time}\nURL: http://{host}{uri}\nError({type}): {message}\nSource: {file} [{line}]\n\nPOST:\n{post}\n\nSESSION:\n{session}"</font> ); <br> <br> define( <font color="#A31515">'DEBUG_STDOUT'</font> , <font color="#0000ff">true</font> ); <br> define( <font color="#A31515">'DEBUG_STDOUT_TAGS'</font> , <font color="#A31515">'test,high'</font> ); <br> define( <font color="#A31515">'DEBUG_STDOUT_TEMPLATE'</font> , <font color="#A31515">'&lt;div&gt;&lt;font color="green"&gt;{message|htmlentities}&lt;/font&gt;&lt;/div&gt;'</font> ); <br> <br> define( <font color="#A31515">'DEBUG_LOGING'</font> , <font color="#0000ff">true</font> ); <br> define( <font color="#A31515">'DEBUG_LOGING_TAGS'</font> , <font color="#A31515">'sql'</font> ); <br> define( <font color="#A31515">'DEBUG_LOGING_FILEPATH'</font> , LOGS_DIR . DIRECTORY_SEPARATOR . <font color="#A31515">'debug_sql_log.csv'</font> ); <br> define( <font color="#A31515">'DEBUG_LOGING_LIMIT_SIZE'</font> , 500000); <br> define( <font color="#A31515">'DEBUG_LOGING_LIMIT_DAYS'</font> , 7); <br> define( <font color="#A31515">'DEBUG_LOGING_TEMPLATE'</font> , <font color="#A31515">"{date} {time};{process_id|csv};{microtime|csv};{tags|csv};{message|trim|csv}\n"</font> );</font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  <b>lagger_init.php</b> - direct configuration of Lagger handlers.  In this case, from the constants of the config, although it is possible without them. <br><blockquote> <code><font color="black">&lt;?php <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">REGISTER EVENTSPACE VARS</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> $laggerES = <font color="#0000ff">new</font> Lagger_Eventspace(); <br> $laggerES-&gt;registerReference( <font color="#A31515">'host'</font> , $_SERVER[ <font color="#A31515">'HTTP_HOST'</font> ]); <br> $laggerES-&gt;registerReference( <font color="#A31515">'uri'</font> , $_SERVER[ <font color="#A31515">'REQUEST_URI'</font> ]); <br> $laggerES-&gt;registerReference( <font color="#A31515">'post'</font> , $_POST); <br> $laggerES-&gt;registerReference( <font color="#A31515">'session'</font> , $_SESSION); <font color="#008000">// Session must be already started!</font> <br> $laggerES-&gt;registerCallback( <font color="#A31515">'date'</font> , <font color="#A31515">'date'</font> , array( <font color="#A31515">'Ym-d'</font> )); <br> $laggerES-&gt;registerCallback( <font color="#A31515">'time'</font> , <font color="#A31515">'date'</font> , array( <font color="#A31515">'H:i:s'</font> )); <br> $laggerES-&gt;registerCallback( <font color="#A31515">'microtime'</font> , <font color="#A31515">'microtime'</font> , array( <font color="#0000ff">true</font> )); <br> $laggerES-&gt;registerVar( <font color="#A31515">'session_id'</font> , session_id()); <br> $laggerES-&gt;registerVar( <font color="#A31515">'process_id'</font> , substr(md5(mt_rand()), 25)); <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">REGISTER EVENTSPACE MODIFIERS</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> function varToStringLine($ <font color="#0000ff">value</font> ) { <br> <font color="#0000ff">return</font> str_replace(array( <font color="#A31515">"\r\n"</font> , <font color="#A31515">"\r"</font> , <font color="#A31515">"\n"</font> ), <font color="#A31515">' '</font> , is_scalar($ <font color="#0000ff">value</font> ) ? $ <font color="#0000ff">value</font> : var_export($ <font color="#0000ff">value</font> , 1)); <br> } <br> $laggerES-&gt;registerModifier( <font color="#A31515">'line'</font> , <font color="#A31515">'varToStringLine'</font> ); <br> <br> function quoteCSV($ <font color="#0000ff">string</font> ) { <br> <font color="#0000ff">return</font> varToStringLine(str_replace( <font color="#A31515">';'</font> , <font color="#A31515">'\\;'</font> , $ <font color="#0000ff">string</font> )); <br> } <br> $laggerES-&gt;registerModifier( <font color="#A31515">'csv'</font> , <font color="#A31515">'quoteCSV'</font> ); <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">SKIPER</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> $daylySkiper = <font color="#0000ff">new</font> Lagger_Skiper($laggerES, SKIPER_HASH_TEMPLATE, SKIPER_EXPIRE, <font color="#0000ff">new</font> Lagger_ExpireList(SKIPER_DIR, <font color="#A31515">'.dayly_skiper'</font> )); <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">LAGGER INTERNAL ERRORS AND EXCEPTIONS HANDLING</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> $emailAction = <font color="#0000ff">new</font> Lagger_Action_Mail(ERRORS_EMAIL_FROM, ERRORS_EMAIL_TO, ERRORS_EMAIL_SUBJECT, ERRORS_EMAIL_MESSAGE); <br> $emailAction-&gt;setSkiper($daylySkiper, <font color="#A31515">'errors_email'</font> ); <br> <br> Lagger_Handler::addInternalErrorAction($emailAction); <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">DEBUG HANDLER</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> $debug = <font color="#0000ff">new</font> Lagger_Handler_Debug($laggerES); <br> <br> function toDebug($message, $tags = <font color="#0000ff">null</font> ) { <br> <font color="#0000ff">if</font> (isset($GLOBALS[ <font color="#A31515">'debug'</font> ])) { <br> $GLOBALS[ <font color="#A31515">'debug'</font> ]-&gt;handle($message, $tags); <br> } <br> } <br> <br> <font color="#0000ff">if</font> (DEBUG_STDOUT) { <br> <font color="#008000">// Allows to rewrite DEBUG_STDOUT_TAGS. Try $_GET['__debug'] = 'high' or $_GET['__debug'] = ''</font> <br> $debugTagger = <font color="#0000ff">new</font> Lagger_Tagger( <font color="#A31515">'__debug'</font> ); <br> <br> $debug-&gt;addAction( <font color="#0000ff">new</font> Lagger_Action_Print(DEBUG_STDOUT_TEMPLATE), DEBUG_STDOUT_TAGS, $debugTagger); <br> $debug-&gt;addAction( <font color="#0000ff">new</font> Lagger_Action_FirePhp( <font color="#A31515">'{message}'</font> , <font color="#A31515">'{tags}'</font> , FirePHP::INFO), DEBUG_STDOUT_TAGS, $debugTagger); <br> } <br> <font color="#0000ff">if</font> (DEBUG_LOGING) { <br> $debug-&gt;addAction( <font color="#0000ff">new</font> Lagger_Action_FileLog(DEBUG_LOGING_TEMPLATE, DEBUG_LOGING_FILEPATH, DEBUG_LOGING_LIMIT_SIZE, DEBUG_LOGING_LIMIT_DAYS), DEBUG_LOGING_TAGS); <br> } <br> <br> <font color="#008000">// Just for fun in windows servers it will speak the text :)</font> <br> <font color="#0000ff">if</font> (stristr(PHP_OS, <font color="#A31515">'win'</font> ) !== <font color="#0000ff">false</font> ) { <br> $debug-&gt;addAction( <font color="#0000ff">new</font> Lagger_Action_WinSpeak( <font color="#A31515">'{message}'</font> , 100), <font color="#A31515">'speak'</font> ); <br> } <br> <br> <font color="#008000">/**************************************************************</font> <br> <font color="#008000">ERRORS AND EXCEPTIONS HANDLERS</font> <br> <font color="#008000">**************************************************************/</font> <br> <br> $errors = <font color="#0000ff">new</font> Lagger_Handler_Errors($laggerES); <br> $exceptions = <font color="#0000ff">new</font> Lagger_Handler_Exceptions($laggerES); <br> <br> <font color="#0000ff">if</font> (ERRORS_STDOUT) { <br> $printAction = <font color="#0000ff">new</font> Lagger_Action_Print(ERRORS_STDOUT_TEMPLATE, <font color="#0000ff">false</font> ); <br> $errors-&gt;addAction($printAction); <br> $exceptions-&gt;addAction($printAction); <br> <br> $errorsFirePhpAction = <font color="#0000ff">new</font> Lagger_Action_FirePhp( <font color="#A31515">'{message} {file} [{line}]'</font> , <font color="#A31515">'{type}'</font> , FirePHP::ERROR); <br> $errors-&gt;addAction($errorsFirePhpAction); <br> $exceptions-&gt;addAction($errorsFirePhpAction); <br> } <br> <br> <font color="#0000ff">if</font> (ERRORS_LOGING) { <br> $logAction = <font color="#0000ff">new</font> Lagger_Action_FileLog(ERRORS_LOGING_TEMPLATE, ERRORS_LOGING_FILEPATH, ERRORS_LOGING_LIMIT_SIZE, ERRORS_LOGING_LIMIT_DAYS); <br> $errors-&gt;addAction($logAction, ERRORS_LOGING_TAGS); <br> $exceptions-&gt;addAction($logAction, ERRORS_LOGING_TAGS); <br> } <br> <br> <font color="#0000ff">if</font> (ERRORS_SMS) { <br> $smsAction = <font color="#0000ff">new</font> Lagger_Action_Sms(ERRORS_SMS_FROM, ERRORS_SMS_TO, ERRORS_SMS_MESSAGE, <font color="#0000ff">true</font> ); <br> $smsAction-&gt;setSkiper($daylySkiper, <font color="#A31515">'errors_sms'</font> ); <br> $errors-&gt;addAction($smsAction, ERRORS_SMS_TAGS); <br> $exceptions-&gt;addAction($smsAction, ERRORS_SMS_TAGS); <br> } <br> <br> <font color="#0000ff">if</font> (ERRORS_EMAIL) { <br> $errors-&gt;addAction($emailAction, ERRORS_EMAIL_TAGS); <br> $exceptions-&gt;addAction($emailAction, ERRORS_EMAIL_TAGS); <br> }</font> <br></code> </blockquote><br><br><h4>  Those. </h4><br>  There are 3 classes of event handlers: <br><ul><li>  PHP system error handler of all levels (including E_FATAL &amp; E_COMPILE) </li><li>  PHP exception handler (Exceptions) </li><li>  Debug message handler </li></ul>  There are 7 classes of custom actions: <br><ul><li>  Write to the log file </li><li>  Email sending </li><li>  SMS sending </li><li>  Output on display </li><li>  Output to the console and popup notifications Google Chrome through the extension <a href="https://chrome.google.com/extensions/detail/nfhmhhlpfleoednkpnnnkolmclajemef">PHP Console</a> </li><li>  <a href="http://www.firephp.org/">FirePHP</a> panel output </li><li>  Exception generation </li><li>  Sounding the text of the event with the voice of Sam from Microsoft :) Windows only </li></ul>  There are many other things: <br><ul><li>  Ignoring re-processing of events (Lagger_Skiper) </li><li>  Mini template engine with the ability to expand the list of variable events (don't be scared! It's very easy!) </li><li>  Tagging events and setting actions to trigger on certain tags </li><li>  Dynamic redefinition of action trigger tags via GET (Lagger_Tagger) </li><li>  Handling internal errors </li><li>  Total 20kb concise PHP5 code (100% OOP) </li></ul><br><h4>  100% Open Source </h4><br>  <a href="http://code.google.com/p/lagger/downloads/list">Download the latest version</a> <br>  <a href="http://code.google.com/p/lagger/wiki/Example">Examples instead of documentation</a> <br>  <a href="http://lagger.googlecode.com/svn/trunk">SVN / trunk</a> <br>  <a href="http://code.google.com/p/lagger">Google Code Project Page</a> <br><br>  Anyone wishing to join the project - very happy :) <br>  Thank you all for your constructive criticism and feedback! </div><p>Source: <a href="https://habr.com/ru/post/74162/">https://habr.com/ru/post/74162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../74155/index.html">Happy Halloween!</a></li>
<li><a href="../74156/index.html">Internet, telegraph ... the main thing is the tail!</a></li>
<li><a href="../74157/index.html">Venezuelan unemployed bought Yandex - cheap ...</a></li>
<li><a href="../74158/index.html">Cross-platform data storage system. Where to get?</a></li>
<li><a href="../74161/index.html">How to make money wifi on broadcom 43xx chip under Linux</a></li>
<li><a href="../74163/index.html">Innova systems FAIL list</a></li>
<li><a href="../74164/index.html">Learn Haskell for ... Haskell</a></li>
<li><a href="../74165/index.html">We fasten django-registration</a></li>
<li><a href="../74166/index.html">Understandable about Software + Services and SaaS</a></li>
<li><a href="../74170/index.html">Acer announced a new flagship - Aspire 8940</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>