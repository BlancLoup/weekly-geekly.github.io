<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Takari: Maven on steroids</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 I have been working for quite a long time in a project that uses the Maven build system. At first, when the project was not as large as i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Takari: Maven on steroids</h1><div class="post__text post__text-html js-mediator-article"><h2>  Prehistory </h2><br>  I have been working for quite a long time in a project that uses the Maven build system.  At first, when the project was not as large as it is now, the time it was fully compiled was relatively reasonable and did not cause any complaints.  But over time, the code has grown, the number of subprojects has increased dramatically, and the average full compilation time has grown to 6 - 10 minutes.  What served as a constant source of reproaches from the developers. <br><br>  It should also be noted.  that we did not use parallel assembly, since  this regularly caused various problems.  Then the artifacts in the local storage will be beaten, then it will simply collect in the wrong order and the old, uncompiled code will get into the final WAR artifact.  Of course, some developers used parallel build at their own risk.  But sooner or later they got into a situation where they could not figure out what was going on.  And a simple recompilation into one stream immediately helped. <br><br>  This went on for quite a long time, until I came across a rather curious website of Takari, which suggests <a href="http://takari.io/book/index.html">ways</a> to improve the methods of working with Maven. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Three things are most interesting there: <br><ul><li>  <a href="http://takari.io/book/30-team-maven.html">Concurrent Safe Local Repository</a> </li><li>  <a href="http://takari.io/book/30-team-maven.html">Takari smart builder</a> </li><li>  <a href="http://takari.io/book/40-lifecycle.html">The takari lifecycle</a> </li></ul><br>  They also have a <a href="https://github.com/takari/maven-wrapper">Maven Wrapper</a> on their GitHub (an analog of the wrapper from Gradle). <br><br>  Looking ahead, I note that the tools described here not only solve the problem of incorrect operation of Maven, but also give a significant increase in assembly speed. <a name="habracut"></a><br><br><h2>  <a href="http://takari.io/book/30-team-maven.html">Concurrent Safe Local Repository</a> </h2><br>  This enhancement is intended to solve the problem of broken artifacts in the local repository. <br><br>  The fact is that in Maven, working with local storage (in fact, a directory on the file system) is implemented in a non-thread safe manner.  Those.  if parallel projects that are being collected start simultaneously pumping out the same dependency, the result is a broken file.  Exactly this problem is solved by this addition. <br><br>  In order to use it, you must modify the directly installed Maven itself: <br><br><pre><code class="bash hljs">curl -O https://repo1.maven.org/maven2/io/takari/aether/takari-local-repository/0.10.4/takari-local-repository-0.10.4.jar mv takari-local-repository-0.10.4.jar <span class="hljs-variable"><span class="hljs-variable">$M2_HOME</span></span>/lib/ext curl -O https://repo1.maven.org/maven2/io/takari/takari-filemanager/0.8.2/takari-filemanager-0.8.2.jar mv takari-filemanager-0.8.2.jar <span class="hljs-variable"><span class="hljs-variable">$M2_HOME</span></span>/lib/ext</code> </pre> <br>  Everything.  No further action required.  Now all operations with the local repository will be safe.  In itself, this extension can only be used on CI servers, when multiple assemblies occur at the same time and you want to use one repository to save space.  But for an ordinary developer, it is more interesting to use in conjunction with Smart Builder, which works on the assumption that this extension is already installed. <br><br>  Experience has shown that when using this solution, the assembly starts to work a little slower, but more reliably. <br><br><h2>  <a href="http://takari.io/book/30-team-maven.html">Takari smart builder</a> </h2><br>  This extension is installed in the same way as the previous one: <br><br><pre> <code class="bash hljs">curl -O https://repo1.maven.org/maven2/io/takari/maven/takari-smart-builder/0.4.0/takari-smart-builder-0.4.0.jar mv takari-smart-builder-0.4.0.jar <span class="hljs-variable"><span class="hljs-variable">$M2_HOME</span></span>/lib/ext</code> </pre><br>  And provides a more advanced algorithm for paralleling the assembly of Maven projects.  The difference in the work of the standard maven assembly planner and Smart Builder is illustrated in the diagram below: <br><br><img src="https://habrastorage.org/files/463/426/a36/463426a36c9a45be8c6f868eef667a7c.png"><br><br>  Maven's standard paralleling strategy is simple and naive.  It is based on the calculation of the depth of dependencies.  Maven launches a parallel build of all projects of the same level until they run out and only then goes on to the next level. <br><br>  Takari Smart Builder, in turn, uses a more advanced strategy.  It calculates dependency chains, performs topological sorting and only after that makes a decision about the sequence in which it is necessary to assemble the projects. <br><br>  Moreover.  During the compilation process, he remembers the compilation time of each project into the <b>.mvn / timing.properties file</b> and uses it as additional information to complete the compilation the next time as quickly as possible. <br><br>  In order to use this functionality, you need to specify an additional key when starting Maven.  For example: <br><br><pre> <code class="bash hljs">mvn clean install --builder smart -T1.0C</code> </pre><br><h2>  <a href="http://takari.io/2015/03/19/core-extensions.html">Everything gets easier with Maven 3.3.1</a> </h2><br>  In the version of Maven 3.3.1 was implemented several innovations.  First and foremost, the ability to declare Maven kernel extensions right in the project.  To do this, add the file <b>.mvn / extensions.xml</b> .  In the annex to the previously described, this file may have the following form: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.takari.maven<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>takari-smart-builder<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.4.1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.takari.aether<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>takari-local-repository<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>0.11.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Now we don‚Äôt need to report libraries directly to the Maven distribution.  In this case, we get the same result. <br><br>  The <b>extensions.xml</b> file is not the only one possible in the <b>.mvn</b> directory.  There may be two more files: <b>jvm.config</b> and <b>maven.config</b> . <br><br>  <b>jvm.config</b> contains JVM options for running a compilation of the current project.  For example, this file might look like this: <br><br><pre> -Xmx2g
 -XX: + TieredCompilation
 -XX: TieredStopAtLevel = 1
</pre><br>  The first option sets the heap size to 2 GB, and the next two optimize the JVM operation for the needs of Maven (peeped <a href="http://zeroturnaround.com/rebellabs/your-maven-build-is-slow-speed-it-up/">here</a> ). <br><br>  <b>maven.config</b> is another file with parameters, but this time for Maven itself.  For example: <br><br><pre> --builder smart
 -T1.0C
 -e
</pre><br>  Thus, we can specify that the default smart builder is used with the number of threads equal to the number of logical cores.  Ie, if we just execute <br><br><pre> <code class="bash hljs">mvn clean install</code> </pre><br>  this build will be performed in multiple threads and using all extensions and optimizations.  Moreover, even if we perform the assembly of the nested module, these settings will still be applied, since  Maven searches the .mvn directory not only in the current directory, but also in the parent directory. <br><br>  Here, however, there is one nuance.  Since  the assembly goes in several streams, then the assembly log is displayed by these streams concurrently.  As a result, when problems arise, it is not always clear what is happening, due to the fact that the lines are mixed.  In this case, if you want to run the assembly in one thread and understand the causes of trouble, you have to manually switch the assembly to single-threaded mode: <br><br><pre> <code class="bash hljs">mvn -T1 clean install</code> </pre><br><h2>  <a href="http://takari.io/book/40-lifecycle.html">The takari lifecycle</a> </h2><br>  The Takari Lifecycle is an alternative to the default Maven life cycle (building JAR files).  Its distinctive feature is that instead of five separate plug-ins for one standard life cycle, one universal is used with the same functionality, but with a much smaller number of dependencies.  As a result - a much faster start, more optimal work and less consumption of resources.  That gives a significant performance boost when compiling complex projects with a large number of modules. <br><br>  To activate the upgraded life cycle, you need to add the <b>takari-lifecycle-plugin</b> as an extension of the assembly: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.takari.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>takari-lifecycle-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extensions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  And also override the assembly of JAR modules as takari-jar: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">project</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span>4.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">modelVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.takari.lifecycle.its.basic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>basic<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span>takari-jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">packaging</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  After that, all projects such as POM, as well as takari-jar projects will be collected using the new life cycle. <br><br>  You can also enable this life cycle for all JAR modules (see the documentation), in our case it has begun to lead to conflicts with various Maven plugins.  As a result, it was decided to simply redefine the packaging modules, where this can be done without affecting the assembly.  As practice has shown, this turned out to be more than enough. <br><br>  It should also be noted that when using the takari-lifecycle-plugin extension, the location of the various assembly settings changes.  They move to the configuration section of this plugin.  For example: <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>io.takari.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>takari-lifecycle-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag">&gt;</span></span>1.8<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugins</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  More information can be found in the <a href="http://takari.io/book/40-lifecycle.html">documentation.</a>  . <br><br><h2>  <a href="https://github.com/takari/maven-wrapper">Takari maven wrapper</a> </h2><br>  Takari has another nice thing - <a href="https://github.com/takari/maven-wrapper">Maven Wrapper</a> .  By analogy with Gradle Wrapper, it allows you to run a project build immediately after cloning.  Without the need to install and configure Maven on your computer.  In addition, it allows you to secure the necessary version of Maven for the project. <br><br>  The easiest way to add a vrapper to your project is to use the archetype.  Perform in the project root: <br><br><pre> <code class="bash hljs">mvn -N io.takari:maven:wrapper</code> </pre><br>  After that in the current directory we will have two scripts: <br><br><ul><li>  mvnw.bat - for Windows </li><li>  mvnw - for * nix systems </li></ul><br>  As well as the <b>wrapper</b> itself and its configuration file will appear in the <b>.mvn / wrapper</b> directory. <br><br>  Everything.  After that you can call: <br><br><pre> <code class="bash hljs">./mvnw clean install</code> </pre><br>  And if you need another version of Maven, you can set the required URL in the configuration <b>.mvn / wrapper / maven-wrapper.properties</b> . <br><br>  And again, this is not without nuances.  So in organizations with a closed network, Maven proxying repositories such as <a href="http://www.sonatype.org/nexus/">Nexus</a> or <a href="http://www.jfrog.com/open-source/">Artifactory</a> are often used.  In this case, each developer is forced to separately set up a Maven mirror for this repository.  Which is a bit contrary to the wrapper's ideology - no need for any settings. <br><br>  Exit the situation as follows: create in our project an <b>.mvn / settings.xml</b> file of the form <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirrors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirror</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>nexus-m2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirrorOf</span></span></span><span class="hljs-tag">&gt;</span></span>*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirrorOf</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span>http://repo.org.ru/nexus/content/groups/repo-all-m2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Nexus M2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirror</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mirrors</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  and add a line to the <b>.mvn / maven.config</b> file <br><br><pre> - global-settings .mvn / settings.xml
</pre><br>  As a result, the mirror will start to pick up automatically. <br><br><h2>  Testing and results </h2><br>  All of the above would not make sense if it did not give impressive results on speeding up the assembly of the project.  And not to be unfounded - I will give the results that were obtained in one of our working projects. <br><br>  So we have: <br><ul><li>  Work computer: Intel Core (TM) i5-3470 CPU @ 3.20GHz </li><li>  Linux Kubuntu 14.04 </li><li>  Java 8b60 </li><li>  Maven 3.3.3 </li><li>  Multiproject in which there are 234 pom.xml files.  Most of them collect various jar artifacts, but there are a certain number of ejb, war, ear, etc. </li></ul><br>  Since  in the ‚Äúvanilla‚Äù Maven with a multi-threaded assembly, problems were observed, then (almost) only one stream was always used, which ultimately led to an assembly time of 5:32 (5 minutes 32 seconds) and above.  After all the optimizations (parallel build + takari lifecycle) the build time turned out to be 1:33.  Almost 4 times! <br><br>  All intermediate results are tabulated below: <br><table><tbody><tr><th>  How was going </th><th>  Number of threads </th><th>  Time spent </th></tr><tr><td>  default </td><td>  one </td><td>  5:32 </td></tr><tr><td>  default </td><td>  four </td><td>  3:25 </td></tr><tr><td>  smart build </td><td>  four </td><td>  3:18 </td></tr><tr><td>  smart build + takari-jar </td><td>  one </td><td>  3:23 </td></tr><tr><td>  smart build + takari-jar </td><td>  four </td><td>  1:33 </td></tr></tbody></table><br>  Smart Build was launched two times, and the second result was recorded, since  after the first launch, the order of assembly execution may be optimized (see documentation). <br><br>  Curiously, adding Takari Lifecycle in single-threaded mode gives the same performance boost as building in the 4th thread but on the ‚Äúvanilla‚Äù Maven. <br><br><h2>  As a conclusion </h2><br><br>  I just recently discovered the tools described in this article.  So the practice of using them is still very modest.  Perhaps over time, any reefs will come out.  But in any case, such a radical acceleration of the assembly turned out to be enough to risk using these opportunities in our process.  Time will tell what happens. <br><br>  I also want to note that in the <a href="https://github.com/takari">github repositories of the</a> company Takari there are some more interesting projects.  Their description is beyond the scope of this article, but perhaps someone else will be interested in something else. <br><br><h2>  UPD </h2><br>  As already noted in the comments, feedback from developers began to come.  It turned out that the mvnw.bat file does not perform its functions.  A quick fix was made, which brought the functionality to the proper form: <br><br><div class="spoiler">  <b class="spoiler_title">Corrected script</b> <div class="spoiler_text"><pre> <code class="hljs perl">@REM ---------------------------------------------------------------------------- @REM Licensed to the Apache Software Foundation (ASF) under one @REM <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more contributor license agreements. See the NOTICE file @REM distributed with this work <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> additional information @REM regarding copyright ownership. The ASF licenses this file @REM to you under the Apache License, Version <span class="hljs-number"><span class="hljs-number">2.0</span></span> (the @REM <span class="hljs-string"><span class="hljs-string">"License"</span></span>); you may <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> this file except in compliance @REM with the License. You may obtain a copy of the License at @REM @REM http:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.apache.org/licenses/LICENSE-<span class="hljs-number"><span class="hljs-number">2.0</span></span> @REM @REM Unless required by applicable law <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> agreed to in writing, @REM software distributed under the License is distributed on an @REM <span class="hljs-string"><span class="hljs-string">"AS IS"</span></span> BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY @REM KIND, either express <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> implied. See the License <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the @REM specific language governing permissions <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> limitations @REM under the License. @REM ---------------------------------------------------------------------------- @REM ---------------------------------------------------------------------------- @REM Maven2 Start Up Batch script @REM @REM Required ENV vars: @REM JAVA_HOME - location of a JDK home dir @REM @REM Optional ENV vars @REM M2_HOME - location of maven2<span class="hljs-string"><span class="hljs-string">'s installed home dir @REM MAVEN_BATCH_ECHO - set to '</span></span>on<span class="hljs-string"><span class="hljs-string">' to enable the echoing of the batch commands @REM MAVEN_BATCH_PAUSE - set to '</span></span>on<span class="hljs-string"><span class="hljs-string">' to wait for a key stroke before ending @REM MAVEN_OPTS - parameters passed to the Java VM when running Maven @REM eg to debug Maven itself, use @REM set MAVEN_OPTS=-Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=y,address=8000 @REM MAVEN_SKIP_RC - flag to disable loading of mavenrc files @REM ---------------------------------------------------------------------------- @REM Begin all REM lines with '</span></span>@' in case MAVEN_BATCH_ECHO is <span class="hljs-string"><span class="hljs-string">'on'</span></span> @echo off @REM enable echoing <span class="hljs-keyword"><span class="hljs-keyword">my</span></span> setting MAVEN_BATCH_ECHO to <span class="hljs-string"><span class="hljs-string">'on'</span></span> @if <span class="hljs-string"><span class="hljs-string">"%MAVEN_BATCH_ECHO%" == "</span></span>on<span class="hljs-string"><span class="hljs-string">" echo %MAVEN_BATCH_ECHO% @REM set %HOME% to equivalent of $HOME if "</span></span>%HOME%" == <span class="hljs-string"><span class="hljs-string">""</span></span> (set <span class="hljs-string"><span class="hljs-string">"HOME=%HOMEDRIVE%%HOMEPATH%") @REM Execute a user defined script before this one if not "</span></span>%MAVEN_SKIP_RC%" == <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> skipRcPre @REM check <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> pre script, once with legacy .bat ending <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> once with .cmd ending <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%HOME%\mavenrc_pre.bat"</span></span> call <span class="hljs-string"><span class="hljs-string">"%HOME%\mavenrc_pre.bat"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%HOME%\mavenrc_pre.cmd"</span></span> call <span class="hljs-string"><span class="hljs-string">"%HOME%\mavenrc_pre.cmd"</span></span> :skipRcPre @setlocal set ERROR_CODE=<span class="hljs-number"><span class="hljs-number">0</span></span> @REM To isolate internal variables from possible post scripts, we <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> another setlocal @setlocal @REM ==== START VALIDATION ==== <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">"%JAVA_HOME%" == "</span></span><span class="hljs-string"><span class="hljs-string">" goto OkJHome echo. echo Error: JAVA_HOME not found in your environment. &gt;&amp;2 echo Please set the JAVA_HOME variable in your environment to match the &gt;&amp;2 echo location of your Java installation. &gt;&amp;2 echo. goto error :OkJHome if exist "</span></span>%JAVA_HOME%\bin\java.exe<span class="hljs-string"><span class="hljs-string">" goto chkMHome echo. echo Error: JAVA_HOME is set to an invalid directory. &gt;&amp;2 echo JAVA_HOME = "</span></span>%JAVA_HOME%" &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo Please set the JAVA_HOME variable in your environment to match the &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo location of your Java installation. &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo. <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> error :chkMHome <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">"%M2_HOME%"=="</span></span><span class="hljs-string"><span class="hljs-string">" goto valMHome SET "</span></span>M2_HOME=%~dp<span class="hljs-number"><span class="hljs-number">0</span></span>..<span class="hljs-string"><span class="hljs-string">" if not "</span></span>%M2_HOME%"==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> valMHome echo. echo Error: M2_HOME <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> found in your environment. &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo Please set the M2_HOME variable in your environment to match the &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo location of the Maven installation. &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo. <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> error :valMHome :stripMHome <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">"_%M2_HOME:~-1%"=="</span></span><span class="hljs-number"><span class="hljs-number">_</span></span>\<span class="hljs-string"><span class="hljs-string">" goto checkMCmd set "</span></span>M2_HOME=%M2_HOME:~<span class="hljs-number"><span class="hljs-number">0</span></span>,-<span class="hljs-number"><span class="hljs-number">1</span></span>%" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> stripMHome :checkMCmd @rem <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%M2_HOME%\bin\mvn.cmd"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> init echo. echo Error: M2_HOME is set to an invalid directory. &gt;&amp;<span class="hljs-number"><span class="hljs-number">2</span></span> echo M2_HOME = <span class="hljs-string"><span class="hljs-string">"%M2_HOME%" &gt;&amp;2 echo Please set the M2_HOME variable in your environment to match the &gt;&amp;2 echo location of the Maven installation &gt;&amp;2 echo. goto error @REM ==== END VALIDATION ==== :init set MAVEN_CMD_LINE_ARGS=%* @REM Find the project base dir, ie the directory that contains the folder "</span></span>.mvn<span class="hljs-string"><span class="hljs-string">". @REM Fallback to current working directory if not found. set MAVEN_PROJECTBASEDIR=%MAVEN_BASEDIR% IF NOT "</span></span>%MAVEN_PROJECTBASEDIR%"==<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> endDetectBaseDir set EXEC_DIR=%CD% set WDIR=%EXEC_DIR% :findBaseDir IF EXIST <span class="hljs-string"><span class="hljs-string">"%WDIR%"\.mvn goto baseDirFound cd .. IF "</span></span>%WDIR%"==<span class="hljs-string"><span class="hljs-string">"%CD%" goto baseDirNotFound set WDIR=%CD% goto findBaseDir :baseDirFound set MAVEN_PROJECTBASEDIR=%WDIR% cd "</span></span>%EXEC_DIR%" <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> endDetectBaseDir :baseDirNotFound set MAVEN_PROJECTBASEDIR=%EXEC_DIR% cd <span class="hljs-string"><span class="hljs-string">"%EXEC_DIR%" :endDetectBaseDir IF NOT EXIST "</span></span>%MAVEN_PROJECTBASEDIR%\.mvn\jvm.config<span class="hljs-string"><span class="hljs-string">" goto endReadAdditionalConfig @setlocal EnableExtensions EnableDelayedExpansion for /F "</span></span>usebackq delims=<span class="hljs-string"><span class="hljs-string">" %%a in ("</span></span>%MAVEN_PROJECTBASEDIR%\.mvn\jvm.config<span class="hljs-string"><span class="hljs-string">") do set JVM_CONFIG_MAVEN_PROPS=!JVM_CONFIG_MAVEN_PROPS! %%a @endlocal &amp; set JVM_CONFIG_MAVEN_PROPS=%JVM_CONFIG_MAVEN_PROPS% :endReadAdditionalConfig SET MAVEN_JAVA_EXE="</span></span>%JAVA_HOME%\bin\java.exe<span class="hljs-string"><span class="hljs-string">" @rem for %%i in ("</span></span>%M2_HOME%"\boot\plexus-classworlds-*) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> set CLASSWORLDS_JAR=<span class="hljs-string"><span class="hljs-string">"%%i"</span></span> set WRAPPER_JAR=<span class="hljs-string"><span class="hljs-string">""</span></span>.\.mvn\wrapper\maven-wrapper.jar<span class="hljs-string"><span class="hljs-string">""</span></span> set WRAPPER_LAUNCHER=org.apache.maven.wrapper.MavenWrapperMain %MAVEN_JAVA_EXE% %JVM_CONFIG_MAVEN_PROPS% %MAVEN_OPTS% %MAVEN_DEBUG_OPTS% -classpath %WRAPPER_JAR% <span class="hljs-string"><span class="hljs-string">"-Dmaven.home=%M2_HOME%" "</span></span>-Dmaven.multiModuleProjectDirectory=%MAVEN_PROJECTBASEDIR%" %WRAPPER_LAUNCHER% %MAVEN_CMD_LINE_ARGS% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ERRORLEVEL <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> error <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> end :error set ERROR_CODE=<span class="hljs-number"><span class="hljs-number">1</span></span> :end @endlocal &amp; set ERROR_CODE=%ERROR_CODE% <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-string"><span class="hljs-string">"%MAVEN_SKIP_RC%" == "</span></span><span class="hljs-string"><span class="hljs-string">" goto skipRcPost @REM check for post script, once with legacy .bat ending and once with .cmd ending if exist "</span></span>%HOME%\mavenrc_post.bat<span class="hljs-string"><span class="hljs-string">" call "</span></span>%HOME%\mavenrc_post.bat<span class="hljs-string"><span class="hljs-string">" if exist "</span></span>%HOME%\mavenrc_post.cmd<span class="hljs-string"><span class="hljs-string">" call "</span></span>%HOME%\mavenrc_post.cmd<span class="hljs-string"><span class="hljs-string">" :skipRcPost @REM pause the script if MAVEN_BATCH_PAUSE is set to 'on' if "</span></span>%MAVEN_BATCH_PAUSE%" == <span class="hljs-string"><span class="hljs-string">"on"</span></span> pause <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"%MAVEN_TERMINATE_CMD%" == "</span></span>on<span class="hljs-string"><span class="hljs-string">" exit %ERROR_CODE% exit /B %ERROR_CODE%</span></span></code> </pre><br></div></div><br>  It also turned out that the overall build under Windows is much slower than under Linux.  Why is this related is not yet clear. <br><br><h2>  UPD2 </h2><br>  Another subtle point has surfaced.  The build for <a href="http://www.sonarqube.org/">SonarQube</a> conflicts with Smart Builder.  Since  By default, the <b>--builder smart</b> option is <b>enabled</b> , then it‚Äôs not enough to build under SonarQube <br><br><pre> <code class="bash hljs">mvn sonar:sonar</code> </pre><br>  You also need to switch back to the standard build strategy: <br><br><pre> <code class="bash hljs">mvn --builder multithreaded sonar:sonar</code> </pre><br>  or <br><br><pre> <code class="bash hljs">mvn --builder singlethreaded sonar:sonar</code> </pre><br>  depending on the situation. </div><p>Source: <a href="https://habr.com/ru/post/266011/">https://habr.com/ru/post/266011/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265997/index.html">Grokay RxJava, part four: Jet Android</a></li>
<li><a href="../266003/index.html">Sell ‚Äã‚Äãin 60 seconds. Call center in the cloud and a special SIM card</a></li>
<li><a href="../266005/index.html">Tyuni memory and network stack in Linux: the history of the transfer of high-loaded servers to a fresh distribution</a></li>
<li><a href="../266007/index.html">Industrial control system: how we created a system for the exact calculation of the machine tool life of a large plant</a></li>
<li><a href="../266009/index.html">Apache Spark or the return of the prodigal user</a></li>
<li><a href="../266013/index.html">Digest of grocery design, August 2015</a></li>
<li><a href="../266015/index.html">IBM Watson cognitive system: principles of working with natural language</a></li>
<li><a href="../266017/index.html">Centrifuge + Go = Centrifugo - harder, better, faster, stronger</a></li>
<li><a href="../266019/index.html">The first book of the young programmer. Learning to write programs on Scratch</a></li>
<li><a href="../266021/index.html">Publish DITA to PDF using the DITA Open Toolkit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>