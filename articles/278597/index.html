<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Decomposition of the affine transformation matrix</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, in the process of developing a 2D graphics editor, a task arose to decompose the affine transformation matrix on a plane, into a prod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Decomposition of the affine transformation matrix</h1><div class="post__text post__text-html js-mediator-article">  Not so long ago, in the process of developing a 2D graphics editor, a task arose to decompose the affine transformation matrix on a plane, into a product of simple transformation matrices in order to display them to the user and offer some more or less adequate interpretation of what happened to the object on the canvas.  To be honest, this task caused me some difficulties.  I finished university a long time ago, and it was not clear to me whether it was possible in principle, given that the original matrix could be the result of an arbitrary sequence of shifts, scales, turns, and transfers, with each transformation having its own arbitrary center.  And, secondly, it was not clear how to find the seven parameters, having only six matrix coefficients.  The key to solving this problem was the article "Decomposition of the centro-affine transformation matrix for image normalization" <a href="https://habr.com/ru/post/278597/">¹</a> , in which the same problem is considered, but without taking into account the transfer transformation and for transformations relative to the coordinate center.  Then I actually just adapt the results of this article to the transfer and for an arbitrary center of transformation. <a name="habracut"></a><br><br>  So, let the matrix defining an arbitrary transformation on a plane be: <br><br><pre><code class="hljs">┌ ┐ │ a11 a12 0 │ M = │ a21 a22 0 │. │ a31 a32 1 │ └ ┘</code> </pre> <br>  Its determinant 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">det</span></span> = a11⋅a22 - a12⋅a21, det ≠ <span class="hljs-number"><span class="hljs-number">0</span></span>.</code> </pre> <br>  Let a point on a plane be given by a row vector of the form (x, y, 1), and its transformation by a multiplication to the right of the transformation matrix: <br><br><pre> <code class="hljs"> ┌ ┐ ┌ ┐ │ a11 a12 0 │ p1 = p0 • M = │ x0 y0 1 │ • │ a21 a22 0 │ └ ┘ │ a31 a32 1 │ └ ┘</code> </pre> <br>  The article  mentioned above states that an arbitrary matrix M of a centro-affine transformation can be represented as a product of rotation matrices R, a shift matrix Hx along the X axis, and a scaling matrix S: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Mc</span></span> = R • Hx • S</code> </pre> <br>  Here <br><br><pre> <code class="hljs pgsql"> ┌ ┐ │ cos(α) sin(α) <span class="hljs-number"><span class="hljs-number">0</span></span> │ R = │ -sin(α) cos(α) <span class="hljs-number"><span class="hljs-number">0</span></span> │, │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘ ┌ ┐ │ <span class="hljs-number"><span class="hljs-number">1</span></span> hx <span class="hljs-number"><span class="hljs-number">0</span></span> │ Hx = │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │, │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘ ┌ ┐ │ sx <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │ S = │ <span class="hljs-number"><span class="hljs-number">0</span></span> sy <span class="hljs-number"><span class="hljs-number">0</span></span> │, │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘</code> </pre> <br>  When decomposing an arbitrary affine transformation matrix, it is necessary to bring the transformation center to the center of coordinates, and also consider the transfer transformation: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">M</span></span> = T0 • S • H • R • T0⁻¹ • T, ┌ ┐ │ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │ T0 = │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │, │ -tx0 -ty0 <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘ ┌ ┐ │ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │ T0⁻¹ = │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │, │ tx0 ty0 <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘ ┌ ┐ │ <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │ T = │ <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> │. │ tx ty <span class="hljs-number"><span class="hljs-number">1</span></span> │ └ ┘</code> </pre> <br>  Substituting the expression for the matrix of simple transformations, we obtain the following expressions for the coefficients M: <br><br><pre> <code class="hljs pgsql">a11 = sx⋅cos(α) - sx⋅hx⋅sin(α) a12 = sx⋅hx⋅cos(α) + sx⋅sin(α) a21 = -sy⋅sin(α) a22 = sy⋅cos(α) a31 = tx + tx0⋅(<span class="hljs-number"><span class="hljs-number">1</span></span> - (sx⋅cos(α) - sx⋅hx⋅sin(α))) + ty0⋅sy⋅sin(α) = tx + tx0⋅(<span class="hljs-number"><span class="hljs-number">1</span></span> - a11) - ty0⋅a21 a32 = ty + ty0⋅(<span class="hljs-number"><span class="hljs-number">1</span></span> - cos(α)⋅sy) - tx0⋅(sx⋅hx⋅cos(α) + sx⋅sin(α)) = ty + ty0⋅(<span class="hljs-number"><span class="hljs-number">1</span></span> - a22) - tx0⋅a12</code> </pre> <br>  Solving these equations for sx, sy, α, hx, tx, ty, after some simplifications, we obtain expressions for the desired parameters: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> a22=<span class="hljs-number"><span class="hljs-number">0</span></span> α = π/<span class="hljs-number"><span class="hljs-number">2</span></span>, sy = -a21 <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> α = atan(-a21/a22), sy = a22/cos(α), sx = det(M)/sy, hx = (a11⋅a21 + a12⋅a22)/det, tx = a31 + ty0⋅a21 + tx0⋅(a11 - <span class="hljs-number"><span class="hljs-number">1</span></span>), ty = a32 + tx0⋅a12 + ty0⋅(a22 - <span class="hljs-number"><span class="hljs-number">1</span></span>).</code> </pre> <br>  The expressions for α, sx, sy, hx are similar in the article <a href="https://habr.com/ru/post/278597/">¹</a> , although they differ somewhat from them in form.  In addition, we have obtained formulas for calculating the parameters of the transfer transformation tx and ty.  I would also like to note that even if there were shifts along both axes in the original sequence, only a shift along one of the axes is enough in the decomposition (here, along the X axis).  In addition, since the angle of rotation is defined as the result of the function of the arctangent, it is fundamentally limited to values ​​from -90˚ to + 90˚.  Considering also that the rotation angle of 180 corresponds to sx = -1 and sx = -1, we have here some ambiguity.  For example, initially having a turn of 120˚ when decomposing according to this algorithm, we get -60˚ and sx = sy = -1. <br><br><hr><br><a name="1"></a>  ¹) <a href="http://cyberleninka.ru/article/n/razlozhenie-matritsy-tsentroaffinnogo-preobrazovaniya-dlya-normalizatsii-izobrazheniy">Putiatin EP, Yakovleva E.V., Lyubchenko V.A.</a>  <a href="http://cyberleninka.ru/article/n/razlozhenie-matritsy-tsentroaffinnogo-preobrazovaniya-dlya-normalizatsii-izobrazheniy">"Decomposition of the centroaffine transformation matrix for image normalization"</a> </div><p>Source: <a href="https://habr.com/ru/post/278597/">https://habr.com/ru/post/278597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278583/index.html">Work with FireBird from 1C. Collection of proven recipes</a></li>
<li><a href="../278585/index.html">Margaret Hamilton: "Guys, I'll send you to the moon"</a></li>
<li><a href="../278589/index.html">libuniset2 is a library for creating ACS. It’s better to see once ... Part 4 (Adjustment)</a></li>
<li><a href="../278593/index.html">We get acquainted with web standards. Work with audio. - Video and creation history</a></li>
<li><a href="../278595/index.html">SQL engine for generating reports. Idea</a></li>
<li><a href="../278599/index.html">We send Angular 2 routs through Laravel 5 router</a></li>
<li><a href="../278601/index.html">WG Labs Announces Developer Contest</a></li>
<li><a href="../278603/index.html">Build FreeType library for Android x86 using NDK</a></li>
<li><a href="../278605/index.html">The history of one technology. Mob</a></li>
<li><a href="../278607/index.html">libuniset2 is a library for creating ACS. It’s better to see once ... Part 5 (uniset2-testsuite)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>