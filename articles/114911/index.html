<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hash navigation in AJAX sites</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you build ajax-site, then sooner or later, you encounter the problem ‚Äúthe back and forth buttons in the browser do not work‚Äù. Because ajax is async...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hash navigation in AJAX sites</h1><div class="post__text post__text-html js-mediator-article"> If you build ajax-site, then sooner or later, you encounter the problem ‚Äúthe back and forth buttons in the browser do not work‚Äù.  Because ajax is asynchronous, it does not perform the transition to other pages, but it only changes a certain part of the content to the current one. <br><br>  The second problem that all developers are struggling with - the project just before delivery to production simply abounds in heaps of javascript (ajax) code.  All this code is in its essence - just requests for pages from the north "without a template", i.e., the pure content of the page. <br><a name="habracut"></a><br>  If the first problem is a problem for users, then the second is for developers.  Below I will try to describe how both problems are solved in a very elegant way.  By a very similar method of building links to facebook and twitter. <br><br>  Of course, the developer wants him not to think about ajax, but his project was full-ajax :-) Therefore, if the developer writes a link: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/contacts/"</span></span></span><span class="hljs-tag">&gt;</span></span>Contacts<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  then it should automatically be replaced by ajax-ovuyu.  But in order to control ajax / non_ajax, it is better to add a special class to all links in the code, for example: <br><br><pre> <code class="hljs cs">&lt;a href=<span class="hljs-string"><span class="hljs-string">"/contacts/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>=<span class="hljs-string"><span class="hljs-string">"EngineAJAX"</span></span>&gt;Contacts&lt;/a&gt;</code> </pre> <br><br>  After loading the DOM model (the dom: loaded event), you need to find all the links ‚Äî remove the EngineAJAX class from them and add them to the href "#!".  As a result, the link will look like: <br><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#!/contacts/"</span></span></span><span class="hljs-tag">&gt;</span></span>Contacts<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Ie, now our link is ‚Äúanchor‚Äù.  When you click on such a link, the browser does not overload the page, but tries to find the element with the specified ID and position itself on it. <br>  I think it is clear that the ajax request must be executed exactly when switching to this kind of link.  Unfortunately, it is impossible to catch the document.location.hash onChange event, so the entire document will have to hang up the onClick handler and ‚Äúlisten‚Äù on which element was clicked. <br><br>  Half of the puzzle is solved: when you click on a link, you go to the anchor, the click is caught, and ajax is executed.  In order for the buttons to work back and forth in the browser, you need to check in the perpetual loop whether document.location.hash has changed, and if it has changed, then perform an ajax request.  Problem # 1 for the user - solved. <br><br>  Now a little about the problem # 2, or about the same ajax'e, which should get ‚Äúpure page content‚Äù from the server.  It all depends on the engine or CMS that you use.  In the engine in any way you like to add this possibility: if a certain parameter is passed (for example, the GET parameter notemplate = 1), then the engine should display the contents of the page ‚Äúwithout a template‚Äù.  Ie, for the example above, the ajax request just hits the URL: <br><br> <code>/contacts/?notemplate=1</code> <br> <br>  And so, problems # 1 and # 2 are almost solved.  Almost because there was a problem # 3: after executing any ajax, the html-code of the entire document changes, and new links may appear in it with the EngineAJAX class, which need to be converted into anchors.  The problem is further aggravated by the fact that events like dom: changed do not exist.  The only ‚Äúhead on‚Äù option that I came up with is to check 10 times per second whether the content of the body tag (+1 perpetual cycle) has changed - and if it has changed - go through all the links and try to convert them (that's why we cleaned the class EngineAJAX from the processed links - in order not to go over them again). <br><br>  PS: in jQuery there is an onHashChanged event and it seems to be onDomChanged, but in jQuery, I think, catching such events will still be reduced to perpetual loops. </div><p>Source: <a href="https://habr.com/ru/post/114911/">https://habr.com/ru/post/114911/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../114905/index.html">Empowering your google apps for domains account</a></li>
<li><a href="../114906/index.html">Happy Birthday, Pi!</a></li>
<li><a href="../114907/index.html">In Great Britain, the creators of the Gh0stMarket forum were planted</a></li>
<li><a href="../114908/index.html">ABBYY CEO Sergey Andreev answers questions from Habr's readers about the company's participation in the Skolkovo project</a></li>
<li><a href="../114910/index.html">Choosing a population size for a genetic algorithm</a></li>
<li><a href="../114912/index.html">We manage the server via SMS</a></li>
<li><a href="../114913/index.html">Extending jQuery style functionality</a></li>
<li><a href="../114914/index.html">Age of Relevance</a></li>
<li><a href="../114915/index.html">"Beeline" fined 100,000 rubles for sending advertising messages</a></li>
<li><a href="../114916/index.html">Google unmanned cars demonstrate racing driving style</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>