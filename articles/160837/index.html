<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>10 Active Directory Administrative Tasks Solved With PowerShell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Jeffery Hicks prepared an article on Windows IT Pro about using PowerShell to administer AD. As a starting point, the author decided to take 10 typica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>10 Active Directory Administrative Tasks Solved With PowerShell</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/eef/1be/c68/eef1bec6878c24a31ad68b76ed06356e.jpg">  <a href="http://jdhitsolutions.com/">Jeffery Hicks</a> prepared <a href="http://www.windowsitpro.com/article/windows-powershell/top-10-active-directory-tasks-solved-powershell-144567">an article on Windows IT Pro</a> about using PowerShell to administer AD.  As a starting point, the author decided to take 10 typical AD administration tasks and consider how to simplify them using PowerShell: <br><ol><li>  Reset user password </li><li>  Activate and deactivate accounts </li><li>  Unlock User Account </li><li>  Delete your account </li><li>  Find empty groups </li><li>  Add users to a group </li><li>  List the group members </li><li>  Find obsolete computer accounts </li><li>  Deactivate a computer account </li><li>  Find computers by type </li></ol><br><br>  In addition, the author maintains a blog (of PowerShell, of course), we recommend to take a look - <a href="http://jdhitsolutions.com/blog/">jdhitsolutions.com/blog</a> .  And the most relevant you can get from his <a href="http://twitter.com/jeffhicks">twitter.com/jeffhicks</a> . <br>  So, below is a translation of the article ‚ÄúTop 10 Active Directory Tasks Solved with PowerShell‚Äù. <a name="habracut"></a><br><br>  Managing Active Directory (AD) with Windows PowerShell is easier than you think, and I want to prove it to you.  You can simply take the scripts below and use them to solve a number of AD management tasks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Requirements </h4><br><br>  To use PowerShell to manage AD, you must meet several requirements.  I'm going to demonstrate how cmdlets for AD work on the example of a computer on Windows 7. <br>  To use cmdlets, you must have a Windows Server 2008 R2 level domain controller, or you can download and install <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D2852">Active Directory Management Gateway Service</a> on legacy DCs inherited from domain controllers.  Read the documentation carefully before installation;  reboot CD is required. <br>  On the client side, download and install <b>Remote Server Administration Tools</b> (RSAT) for either <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D7887">Windows 7</a> or <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D28972">Windows 8</a> .  In Windows 7, you will need to open the <i>Programs</i> section in the <i>Control Panel</i> and select <i>Turn Windows Features On or Off</i> .  Find <i>Remote Server Administration Tools</i> and expand the <i>Role Administration Tools</i> section.  Select the appropriate items for AD DS and AD LDS Tools, especially note that the <i>Active Directory Module for Windows PowerShell</i> should be selected, as shown in Figure 1. (In Windows 8, all tools are selected by default).  Now we are ready to work. <br><br><img src="https://habrastorage.org/storage2/90d/472/d83/90d472d83296fbe2ef85b3c7c4959e56.jpg"><br>  Figure 1 Turning on AD DS and AD LDS Tools <br><br>  I am logged in as a domain administrator.  Most of the cmdlets I will show will allow you to specify alternative credentials.  In any case, I recommend reading the help ( <b>Get-Help</b> ) and examples that I will demonstrate below. <br>  Start a PowerShell session and import the module: <br><br><pre><code class="vbscript hljs">PS C:\&gt; Import-Module ActiveDirectory</code> </pre> <br><br>  The import creates a new PSDrive, but we will not use it.  However, you can see which commands are available in the imported module. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-command -module ActiveDirectory</code> </pre><br><br>  The beauty of these commands is that if I can use the command for one AD object, then it can be used for 10, 100 and even 1000. Let's see how some of these cmdlets work. <br><br><h4>  Task 1: Reset User Password </h4><br><br>  Let's start with a typical task: reset a user password.  This can be done easily and simply via the <b>Set-ADAccountPassword</b> cmdlet  The tricky part is that the new password must be specified as a secure string: a piece of text that is encrypted and stored in memory for the PowerShell session.  First, create a variable with a new password: <br><pre> <code class="vbscript hljs">PS C:\&gt; $<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>=Read-Host <span class="hljs-string"><span class="hljs-string">"Enter the new password"</span></span> -AsSecureString</code> </pre><br><br>  Then, enter the new password: <br><br><pre> <code class="vbscript hljs">PS C:\&gt;</code> </pre><br><br>  Now we can retrieve the account (using <b>samAccountname</b> is the best option) and set a new password.  Here is an example for the user Jack Frost: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-ADAccountPassword jfrost -NewPassword $<span class="hljs-keyword"><span class="hljs-keyword">new</span></span></code> </pre><br><br>  Unfortunately, in the case of this cmdlet there is a bug: <i>-Passthru</i> , <i>-Whatif</i> , and <i>‚ÄìConfirm</i> do not work.  If you prefer a short cut, try the following: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-ADAccountPassword jfrost -NewPassword (ConvertTo-SecureString -AsPlainText -<span class="hljs-built_in"><span class="hljs-built_in">String</span></span> <span class="hljs-string"><span class="hljs-string">"P@ssw0rd1z3"</span></span> -force)</code> </pre><br><br>  As a result, I need Jack to change the password the next time I log in, and I modify my account using <b>Set-ADUser</b> . <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span>-ADUser jfrost -ChangePasswordAtLogon $<span class="hljs-literal"><span class="hljs-literal">True</span></span></code> </pre><br><br>  The cmdlet results are not written to the console.  If this needs to be done, use <b>‚ÄìTrue</b> .  But I can find out whether the operation was successful or not by retrieving the user name using the <b>Get-ADUser cmdlet</b> and specifying the <b>PasswordExpired</b> property, as shown in Figure 2. <br><br><img src="https://habrastorage.org/storage2/278/1ee/f74/2781eef746da3defe31843b339e5f0e2.jpg"><br>  Fig.  2. Results of the Get-ADUser Cmdlet cmdlet with the PasswordExpired property <br><br>  Bottom line: resetting a user's password using PowerShell is not at all difficult.  I admit that resetting the password is also easy via the <i>Microsoft Management Console (MMC)</i> snap-in in <i>Active Directory Users and Computers</i> <i>.</i>  But using PowerShell is suitable if you need to delegate a task, you do not want to deploy the above-mentioned snap-in, or reset the password during a large automated IT process. <br><br><h4>  Task 2: Activate and deactivate accounts </h4><br><br>  And now let's deactivate the account.  We continue to work with Jack Frost.  This code uses the <b>‚ÄìWhatif</b> parameter, which you can see on other cmdlets that make changes to test my command without running it. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Disable-ADAccount jfrost -whatif What <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: Performing operation <span class="hljs-string"><span class="hljs-string">"Set"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Target <span class="hljs-string"><span class="hljs-string">"CN=Jack Frost, OU=staff,OU=Testing,DC=GLOBOMANTICS,DC=local"</span></span>.</code> </pre><br><br>  And now we deactivate for real: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Disable-ADAccount jfrost</code> </pre> <br><br>  And when the time comes to activate the account, which cmdlet will help us? <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Enable-ADAccount jfrost</code> </pre><br><br>  These cmdlets can be used in a pipelined expression, allowing you to activate or deactivate as many accounts as you want.  For example, this code deactivates all accounts in the sales department (Sales) <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-aduser -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"department -eq 'sales'"</span></span> | disable-adaccount</code> </pre><br><br>  Of course, writing a filter for <b>Get-ADUser is</b> quite difficult, but it is here that using the <b>‚ÄìWhatif</b> parameter with the <b>Disable-ADAccount cmdlet</b> comes to the rescue. <br><br><h4>  Task 3: Unlock User Account </h4><br><br>  Consider the situation when Jack blocked his account, trying to enter a new password.  In order to try to find his account through the GUI, the unlock procedure can be performed using a simple command. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Unlock-ADAccount jfrost</code> </pre><br><br>  The cmdlet also supports the <b>-Whatif</b> and <b>-Confirm parameters</b> . <br><br><h4>  Task 4: Delete Account </h4><br><br>  No matter how many users you delete, this is easy to accomplish using the <b>Remove-ADUser cmdlet</b> .  I do not want to remove Jack Frost, but if I wanted to, I would use the following code: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Remove-ADUser jfrost -whatif What <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: Performing operation <span class="hljs-string"><span class="hljs-string">"Remove"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Target <span class="hljs-string"><span class="hljs-string">"CN=Jack Frost,OU=staff,OU=Testing,DC=GLOBOMANTICS,DC=local"</span></span>.</code> </pre><br><br>  Or I can enter several users and delete them with one simple command: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-aduser -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"enabled -eq 'false'"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> WhenChanged -SearchBase <span class="hljs-string"><span class="hljs-string">"OU=Employees, DC=Globomantics,DC=Local"</span></span> | where {$_.WhenChanged -le (<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>).AddDays(<span class="hljs-number"><span class="hljs-number">-180</span></span>)} | Remove-ADuser -whatif</code> </pre><br><br>  This command will find and delete all deactivated accounts of the unit (OU) Employees that have not changed for 180 days or more. <br><br><h4>  Task 5: Search for empty groups </h4><br><br>  Managing groups is endless and ungrateful.  There are many ways to find empty groups.  Some expressions may work better than others, depending on your organization.  The code below will allow you to find all groups in the domain, including the built-in ones. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adgroup -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> * | where {-<span class="hljs-keyword"><span class="hljs-keyword">Not</span></span> ($_ | <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adgroupmember)} | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> Name</code> </pre><br><br>  If you have groups with hundreds of members, then using this command can take a long time;  <b>Get-ADGroupMember</b> checks each group.  If you can limit or customize, it will be better. <br>  Here is another approach: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adgroup -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"members -notlike '*' -AND GroupScope -eq 'Universal'"</span></span> -SearchBase <span class="hljs-string"><span class="hljs-string">"OU=Groups,OU=Employees,DC=Globomantics, DC=local"</span></span> | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> Name,Group*</code> </pre><br><br>  This command finds all Universal groups that do not have membership in OU Groups and displays some of the properties.  The result is shown in Figure 3. <br><img src="https://habrastorage.org/storage2/1bf/3b6/f8b/1bf3b6f8bb103d8ecf02ec7fd1ab1654.jpg"><br>  Fig.  3. Search and filter universal groups <br><br><h4>  Task 6: Add Users to a Group </h4><br><br>  Let's add Jack Frost to the Chicago IT group: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; add-adgroupmember <span class="hljs-string"><span class="hljs-string">"chicago IT"</span></span> -Members jfrost</code> </pre><br><br>  Yes, everything is so simple.  You can also easily add hundreds of users to groups, although in my opinion this is slightly inconvenient: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Add-ADGroupMember <span class="hljs-string"><span class="hljs-string">"Chicago Employees"</span></span> -member (<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-aduser -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"city -eq 'Chicago'"</span></span>)</code> </pre><br><br>  I used the parenthetical pipelined expression to find all users who have a City property in Chicago.  The code in brackets is executed, and the resulting objects are passed to the ‚ÄìMember parameter.  Each user object is added to the Chicago Employees group.  It doesn't matter if we deal with 5 or 5,000 users, group membership updates take only a few seconds.  This expression can also be written using <b>ForEach-Object</b> , which can be more convenient: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADUser -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"city -eq 'Chicago'"</span></span> | foreach {Add-ADGroupMember <span class="hljs-string"><span class="hljs-string">"Chicago Employees"</span></span> -Member $_}</code> </pre><br><br>  Task 7: List the group members <br><br>  You may want to know who is in a particular group.  For example, you should periodically find out who is in the Domain Admins group: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADGroupMember <span class="hljs-string"><span class="hljs-string">"Domain Admins"</span></span></code> </pre><br><br>  Figure 4 shows the result. <br><br><img src="https://habrastorage.org/storage2/88e/995/b0d/88e995b0d0b3efd253bba72856e7d29e.jpg"><br>  Fig.  4. Members of Domain Admins <br><br>  The cmdlet prints an AD object for each group member.  And what to do with nested groups?  My Chicago All Users group is a collection of nested groups.  To get a list of all accounts, I just have to use the <b>‚ÄìRecursive</b> parameter. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADGroupMember <span class="hljs-string"><span class="hljs-string">"Chicago All Users"</span></span> -Recursive | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> DistinguishedName</code> </pre><br><br>  If you want to go the other way ‚Äî find out which groups the user is in ‚Äî use <b>Member Member</b> property: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-aduser jfrost -<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Memberof | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> -ExpandProperty memberOf CN=NewTest,OU=Groups,OU=Employees, DC=GLOBOMANTICS,DC=local CN=Chicago Test,OU=Groups,OU=Employees, DC=GLOBOMANTICS,DC=local CN=Chicago IT,OU=Groups,OU=Employees, DC=GLOBOMANTICS,DC=local CN=Chicago Sales Users,OU=Groups,OU=Employees, DC=GLOBOMANTICS,DC=local</code> </pre><br><br>  I used the <b>-ExpandProperty</b> parameter to print <b>MemberOf</b> names as strings. <br><br><h4>  Task 8: Find obsolete computer accounts </h4><br><br>  I am often asked this question: ‚ÄúHow to find outdated computer accounts?‚Äù.  And I always answer: ‚ÄúAnd what is obsolete for you?‚Äù Companies differently determine when a computer account (or user, whatever) is considered obsolete and is not subject to further use.  As for me, I pay attention to those accounts whose passwords have not changed for a certain period of time.  This period is 90 days for me - if the computer has not changed the password along with the domain for this period, most likely it is offline and outdated.  The <b>Get-ADComputer</b> cmdlet is <b>used</b> : <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adcomputer -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"Passwordlastset -lt '1/1/2012'"</span></span> -properties *| <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> name,passwordlastset</code> </pre><br><br>  The filter works fine with a hard value, but this code will be updated for all computer accounts that have not changed their passwords since January 1, 2012.  The results are shown in Figure 5. <br><br><img src="https://habrastorage.org/storage2/759/524/588/7595245888d0c0bed70e391143191fa8.jpg"><br>  Fig.  5. Find obsolete computer accounts <br><br>  Another option: suppose you are at least at the functional level of the Windows 2003 domain. Set the filter by the <b>LastLogontimeStamp</b> property.  This value is the number of 100 nanosecond intervals from January 1, 1601, and stored in GMT, so working with this value is slightly difficult: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adcomputer -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"LastlogonTimestamp -gt 0"</span></span> -properties * | <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> name,lastlogontimestamp, @{Name=<span class="hljs-string"><span class="hljs-string">"LastLogon"</span></span>;Expression={[datetime]::FromFileTime ($_.Lastlogontimestamp)}},passwordlastset | Sort LastLogonTimeStamp</code> </pre><br><br>  I took responsibility and added a custom property that takes the value of <b>LastLogontimeStamp</b> and converts it into the usual format.  Figure 6 shows the result. <br><br><img src="https://habrastorage.org/storage2/759/524/588/7595245888d0c0bed70e391143191fa8.jpg"><br>  Fig.  6. Convert the LastLogonTimeStamp value to the usual format <br><br>  To create a filter, I need to convert the date, for example, January 1, 2012, into the correct format.  Conversion is carried out in FileTime: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; $cutoff=(<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span> <span class="hljs-string"><span class="hljs-string">"1/1/2012"</span></span>).ToFileTime() PS C:\&gt; $cutoff <span class="hljs-number"><span class="hljs-number">129698676000000000</span></span></code> </pre><br><br>  Now I can use this variable in the filter for <b>Get-ADComputer</b> : <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADComputer -<span class="hljs-built_in"><span class="hljs-built_in">Filter</span></span> <span class="hljs-string"><span class="hljs-string">"(lastlogontimestamp -lt $cutoff) -or (lastlogontimestamp -notlike '*')"</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">property</span></span> * | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> Name,LastlogonTimestamp,PasswordLastSet</code> </pre><br><br>  The above code finds the same computers that were shown in Figure 5. <br><br><h4>  Task 9: Deactivate the computer account </h4><br><br>  Perhaps when you find inactive or outdated accounts, you will want to deactivate them.  Make it pretty simple.  We will use the same cmdlet used in working with user accounts.  You can refine it by using the <b>samAccountname</b> account. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; Disable-ADAccount -Identity <span class="hljs-string"><span class="hljs-string">"chi-srv01$"</span></span> -whatif What <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>: Performing operation <span class="hljs-string"><span class="hljs-string">"Set"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> Target <span class="hljs-string"><span class="hljs-string">"CN=CHI-SRV01, CN=Computers,DC=GLOBOMANTICS,DC=local"</span></span>.</code> </pre><br><br>  Or using a pipeline expression: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adcomputer <span class="hljs-string"><span class="hljs-string">"chi-srv01"</span></span> | Disable-ADAccount</code> </pre><br><br>  I can also use my code to find outdated accounts and deactivate all of them: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>-adcomputer -<span class="hljs-built_in"><span class="hljs-built_in">filter</span></span> <span class="hljs-string"><span class="hljs-string">"Passwordlastset -lt '1/1/2012'"</span></span> -properties *| Disable-ADAccount</code> </pre><br><br><h4>  Task 10: Find computers by type </h4><br><br>  I am also often asked how to find computer accounts by type, for example, servers or workstations.  For your part, this requires some creativity.  In AD, there is nothing that distinguishes a server from a client, except the OS.  If your computer is running Windows Server 2008, you will have to do a few additional steps. <br>  First you need to get a list of operating systems, and then we filter accounts by existing operating systems. <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADComputer -<span class="hljs-built_in"><span class="hljs-built_in">Filter</span></span> * -Properties OperatingSystem | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> OperatingSystem -unique | Sort OperatingSystem</code> </pre><br><br>  The results are shown in Figure 7. <br><br><img src="https://habrastorage.org/storage2/07b/756/849/07b75684942bcfad1d49f78653dd5b86.jpg"><br>  Fig.  7. Extract OS List <br><br>  I want to find all the computers on which the server OS is running: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADComputer -<span class="hljs-built_in"><span class="hljs-built_in">Filter</span></span> <span class="hljs-string"><span class="hljs-string">"OperatingSystem -like '*Server*'"</span></span> -properties OperatingSystem,OperatingSystem ServicePack | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> Name,Op* | format-list</code> </pre><br><br>  The results are shown in Figure 8. <br><br><img src="https://habrastorage.org/storage2/9bf/48b/594/9bf48b594685febd6f9dafcff27b53ee.jpg"><br><br>  Like other AD Get cmdlets, you can configure search parameters and limit the query to individual OUs, if necessary.  All the expressions that I showed can be integrated into large PowerShell expressions.  For example, you can sort, group, apply filters, export to CSV, or create and send HTML email reports - all from PowerShell!  At the same time you do not have to write a single creak. <br>  Here's a bonus for you: a report on the age of a user password (user password-age report), saved in an HTML file: <br><br><pre> <code class="vbscript hljs">PS C:\&gt; <span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-ADUser -<span class="hljs-built_in"><span class="hljs-built_in">Filter</span></span> <span class="hljs-string"><span class="hljs-string">"Enabled -eq 'True' -AND PasswordNeverExpires -eq 'False'"</span></span> -Properties PasswordLastSet,PasswordNeverExpires,PasswordExpired | <span class="hljs-keyword"><span class="hljs-keyword">Select</span></span> DistinguishedName,Name,pass*,@{Name=<span class="hljs-string"><span class="hljs-string">"PasswordAge"</span></span>; Expression={(<span class="hljs-keyword"><span class="hljs-keyword">Get</span></span>-<span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>)-$_.PasswordLastSet}} |sort PasswordAge -Descending | ConvertTo-Html -Title <span class="hljs-string"><span class="hljs-string">"Password Age Report"</span></span> | Out-File c:\Work\pwage.htm</code> </pre><br><br>  Although this expression may look a bit intimidating, with minimal knowledge of PowerShell it is easy to use.  And there remains only the last tip: how to define a custom property called <b>PasswordAge</b> .  The value is the gap between today and the PasswordLastSet property.  Then I sort the results for my new property.  Figure 9 shows the output for my small test domain. <br><br><img src="https://habrastorage.org/storage2/4c3/770/7bf/4c37707bffd173bda977864cd0c63f74.jpg"><br><br>  Upd: <br>  The post contains a translation of an article on the <a href="http://www.windowsitpro.com/">WindowsITPro</a> portal <a href="http://www.windowsitpro.com/">.</a> <br>  <a href="http://www.windowsitpro.com/article/windows-powershell/top-10-active-directory-tasks-solved-powershell-144567">Top 10 Active Directory Tasks Solved with PowerShell</a> <br><br>  Bonus: PowerShell for system administration purposes \\ Articles on Habr√© <br><ul><li>  <a href="http://habrahabr.ru/post/160599/">Notifications about password expiration in Active Directory using PowerShell</a> </li><li>  <a href="http://habrahabr.ru/post/150149/">Audit of deletion and access to files and recording events to a log file using Powershell</a> </li><li>  Active Directory Audit Powershell Change Alert.  <a href="http://habrahabr.ru/post/147750/">Part 1</a> and <a href="http://habrahabr.ru/post/150122/">Part 2</a> </li><li>  <a href="http://habrahabr.ru/post/138600/">Lost group.</a>  <a href="http://habrahabr.ru/post/138600/">We find out the appointment of "strange" groups in AD</a> </li></ul><br><br>  How do you use PowerShell to simplify your work? </div><p>Source: <a href="https://habr.com/ru/post/160837/">https://habr.com/ru/post/160837/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160827/index.html">Lumia 920 in Minecraft</a></li>
<li><a href="../160829/index.html">The development of Israeli scientists will allow the blind to "see" like bats</a></li>
<li><a href="../160831/index.html">MiniTV MK808 review with Android 4.1</a></li>
<li><a href="../160833/index.html">Google Drive now supports website publishing.</a></li>
<li><a href="../160835/index.html">Answers Minister of Communications to the questions of users</a></li>
<li><a href="../160839/index.html">Team Presentation NMSYS</a></li>
<li><a href="../160841/index.html">Native MVC for Silex PHP Framework</a></li>
<li><a href="../160843/index.html">ImageResizer module for IIS</a></li>
<li><a href="../160845/index.html">Choosing an ORM Strategy (.NET)</a></li>
<li><a href="../160849/index.html">Yandex.Amnestia</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>