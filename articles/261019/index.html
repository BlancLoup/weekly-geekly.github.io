<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The importance of controlling the output of the serializing API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, the author examines the issue of changing the presentation of data and objects, and shoals, which inevitably follow this change. He p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The importance of controlling the output of the serializing API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/462/4dc/5ed/4624dc5edec4449592eeda9bcc41d53a.png"><br><br>  <i>In this article, the author examines the issue of changing the presentation of data and objects, and shoals, which inevitably follow this change.</i>  <i>He proposes in such cases to use serializers, which can convert one presentation format to another without loss.</i>  <i>This allows not only to transfer data over the network and save to files.</i>  <i>When you have a customized serialization library, you can change the data store at your convenience and without prejudice to the project.</i>  <i>It also becomes easy to return answers in the form in which it is convenient for the requesting party to receive.</i> <br><a name="habracut"></a><br>  <i>Disclaimer</i>  <i>Just started reading <a href="http://habrahabr.ru/post/260975/">habrahabr.ru/post/260975</a> .</i>  <i>Translation is very clumsy, careless.</i>  <i>I began to write to the author more familiar to our ear translation options for some phrases in order to help him fix it all, but then I realized that while reading I stumble on every third phrase.</i>  <i>I decided to cut down my entire version.</i>  <i>Although it is not entirely fair, it is also not very human to make people read such a level.</i>  <i>I would even say, very machine-like.</i>  <i>Well, let the community judge.</i>  <i>The text is really difficult, I will leave my comments in italics.</i>  <i>I translate <a href="https://habrahabr.ru/users/drondo/" class="user_link">without looking</a> into the translation of <a href="https://habrahabr.ru/users/drondo/" class="user_link">drondo</a> .</i>  <i>If there is a match - I will not change.</i>  <i>Still, I translate English words into the most similar Russian words, like <a href="https://habrahabr.ru/users/drondo/" class="user_link">drondo</a> , but the Devil is in the details.</i>  <i>On typos please report in a personal, I'll fix everything in the morning.</i>  <i>Thank.</i> <br><br>  For a year, I spoke a thousand times about <a href="https://www.youtube.com/watch%3Fv%3D3W7bQj6OdLU">dangerous places in the API</a> .  Only in 2015 it was on: <br><ul><li>  <a href="https://joind.in/talk/view/13552">Lone star php</a> </li><li>  <a href="https://joind.in/talk/view/13899">OpenWest</a> </li><li>  <a href="https://joind.in/talk/view/13621">ConFoo</a> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The part of the report, which I call ‚Äúadding the presentation layer to the data‚Äù, where I speak about serialization, received a great response. <br><br>  MSDN says it like this: <br><blockquote>  Serialization is the process of converting an object into a stream of bytes in order to save an object or transfer it to memory, a database or a file.  Its main purpose is to preserve the state of the object in order to be able to recreate it, if necessary.  The reverse process is called deserialization. <br>  <i>Source: <a href="https://msdn.microsoft.com/en-us/library/ms233843.aspx">MSDN Programming Concepts</a></i> </blockquote><br><br>  PHP developers often use <a href="http://php.net/serialize">serialization ()</a> as <a href="http://php.net/serialize">serialization</a> .  Yes, this is one of the options, but not the only one.  Another common way to serialize is of course the <a href="http://php.net/json_encode">json_encode ()</a> function.  Modern frameworks automatically convert to JSON any array that returns from a controller method.  So you yourself do not even have to call json_encode (). <br><br>  This is very convenient, but if you create an HTTP API (AJAX / RESTful / Hypermedia), then you need to be extremely careful with what you derive. <br><br>  Here you have the most frequent rake: <br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PlaceController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CoreController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">show</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Place::find($id); } }</code> </pre> <br><br>  I apologize for the extremely simplified example, the point is that we are talking about a model (possibly using ORM) and about returning the result. <br><br>  It looks very nice, but in the end there will be a lot of problems. <br><br><h2>  Enough secrets </h2><br>  Each method that you add to your data warehouse will end up responding to the calling API.  If this is an internal API, it is still not so scary.  But if this information slips somewhere in the browser, or in some other external source such as a mobile device, then everything will be very bad. <br><br>  The most obvious example is user passwords.  Of course, they are encrypted, but you obviously do not want to give them to strangers.  Leakage of things that are not so thrown into consideration, such as password reset tokens, can also lead to hacking your users. <br><br>  But things can happen even more inconspicuously.  In the example of ‚Äúplace‚Äù <i>(comment: PlaceController)</i> from a business process, it may be necessary to add a ‚Äúcontact email‚Äù for internal use.  If you have spent months of work and have established unique connections <i>(note: in business)</i> , you will not want these email addresses to flow to your competitors. <br><br>  Yes, in many ORM you can specify a list of visible or hidden properties.  But over time, the chances of hiding all the important parameters melt away.  Especially if you got a junior, which is not yet aware that one of these fields is super secret.  A tired examiner with a hard working day will allow the whole case to leak unnoticed. <br><br>  Here is one example from <a href="http://fractal.thephpleague.com/">Fractal</a> ‚Äî my PHP serialization library, which I did to simplify serialization in my APIs: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">League</span></span>\<span class="hljs-title"><span class="hljs-title">Fractal</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">League</span></span>\<span class="hljs-title"><span class="hljs-title">Fractal</span></span>\<span class="hljs-title"><span class="hljs-title">Resource</span></span>\<span class="hljs-title"><span class="hljs-title">Collection</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Create a top level instance somewhere $fractal = new Manager(); // Ask the ORM for 10 books $books = Book::take(10)-&gt;get(); // Turn this collection $resource = new Collection($books, function(array $book) { return [ 'id' =&gt; (int) $book-&gt;id, 'title' =&gt; $book-&gt;title, 'year' =&gt; (int) $book-&gt;yr, 'author' =&gt; [ 'name' =&gt; $book-&gt;author_name, 'email' =&gt; $book-&gt;author_email, ], 'links' =&gt; [ [ 'rel' =&gt; 'self', 'uri' =&gt; '/books/'.$book-&gt;id, ] ] ]; });</span></span></code> </pre><br>  Yes, everything is extremely simplified here again, and callbacks are used instead of classes, but the basic idea is clear. <br><br>  The same tools will be found for every language in the world.  I worked with <a href="https://github.com/rails-api/active_model_serializers">ActiveModel Serializer</a> .  He is almost the same. <br><br>  Regardless of the language you use this week, I would like to explain to you why this is so important.  How to do this, you can find out for yourself.  And this article is about why. <br><br><h2>  Attribute Data Types </h2><br>  When it comes to data binding drivers, many languages, including PHP, are not very smart.  Such pieces like MySQL or PostgreSQL have all sorts of data types: integers, floats, booleans, etc.  But what comes to the user is always a string. <br><br>  Instead of true and false, you see "1" and "0", or even "t" and "f".  The floats from -41.235 turn into "-41.235". <br><br>  For a language with weak typing, this may not seem very important.  But languages ‚Äã‚Äãwith strict typing will fly out if such a change happens.  A couple of times I saw a string with a number turning into an integer due to some kind of math in the <a href="http://laravel.com/docs/4.2/eloquent">ORM accessory</a> , in which ‚Äú1‚Äù + ‚Äú2‚Äù = 3. Such a conversion can in principle pass your unit tests if they are not clear enough .  But your iOS app will just blow your head off. <br><br>  Rails ActiveRecord will track which field the data type should have when they add to the schema through migrations.  But if something changes - in accessors, or when changing the type of scheme - then expect trouble. <br><br>  If you use serialization as in the example above, then you will be able to cast the type on your data, and when outputting, be sure that this is the very type, and it will change only if you change it yourself in the serializer. <br><br><h2>  Field name change </h2><br>  Renaming fields in the data warehouse should not break your API.  If it seems painful for you to update all your tests, imagine what mobile application developers and other front-end teams need to update and deploy new applications.  Maybe you even forgot the lock-step <i>(comment: you need help with the translation of this case. The nearest Russian word, no matter how ridiculous, turns out to be "parallelized") is</i> deployed.  If yes, then your users will end up with non-working applications, which, even if you release an update on iOS, will remain non-working until they update them. <br><br>  All you need to get around this hell of changing the field name is the serialization layer, which allows you to update the link to the field without changing its external representation. <br><br><h2>  Various data storages </h2><br>  Many of these ORM serialization methods have one very important assumption: all your data lives in the same repository all the time.  And what will happen if some of your data leaves SQL and moves to Redis or where? <br><br>  Even if you did not transfer part of the data from SQL to Redis, maybe you divided your table into two?  Or began to use pivot tables?  Most ORM serializers just <s>crap</s> if you try this.  <i>(comment Per .: if anyone is interested, then there was ‚Äúlanded on his face‚Äù - will land on their face. Since a considerable amount of cruelty and brutality is embedded in this expression, I decided to translate this into a very appropriate word.)</i> <br><br>  Or maybe instead use the ‚Äúrepository‚Äù pattern that has become so popular in Laravel?  You can transfer all data from anywhere, where it is stored, to the serializer, and the serializer will take care of the consistency of the result. <br><br><h2>  Versions of serializers </h2><br>  Once I had serializers of different versions.  FooSerializer v1 and v2 can both exist, each with its own tests, and can satisfy the various needs of API clients.  <i>(comment. I did not understand what it is for. Maybe v1 and v2 are so different that they are perceived as independent products and exist in parallel)</i> <br><br><h2>  Formats of serializers </h2><br>  The fact that Fractal has not yet succeeded, but it is planned to be fixed to v1.0 - these are various ‚Äúadapters‚Äù of formats.  This has already been done in the Rails community - it was possible to send different headers and receive different response formats. <br><br><ul><li>  <a href="http://jsonapi.org/">JSON-API</a> </li><li>  <a href="http://stateless.co/hal_specification.html">HAL</a> </li><li>  <a href="http://emberjs.com/api/data/classes/DS.RESTAdapter.html">Emberdata</a> </li></ul><br><br>  By sending a mime type, you can tell the serializer in which format to send the answer, without littering all your code with potentially complex logic. <br><br><h2>  Solutions </h2><br>  I could give the reasons for the days on the flight, but today my plane sat down at five in the morning, and the guys in the adjacent chairs did not let me sleep all night. <br><br>  I covered the topic of why in serialization, but not how.  I recommend looking at these solutions: <br><ul><li>  <a href="http://fractal.thephpleague.com/">Fractal - PHP</a> </li><li>  <a href="http://jmsyst.com/bundles/JMSSerializerBundle">JMSSerializerBundle - PHP + Symfony2</a> </li><li>  <a href="http://marshmallow.readthedocs.org/en/latest/">Marshmallow - Python</a> </li><li>  <a href="https://github.com/rails-api/active_model_serializers">ActiveModel Serializer - Ruby + Rails</a> </li><li>  <a href="https://github.com/rails/jbuilder">JBuilder - Ruby + Rails</a> </li><li>  <a href="https://github.com/apotonick/roar">Roar - Ruby</a> </li></ul><br><br>  I heard a great story on RailsConf 2015 by my new friend <a href="https://twitter.com/joaomdmoura">Jo√£o Moura</a> , which was called <a href="https://www.youtube.com/watch%3Fv%3DPqgQNgWdUB8">AMS Love Story, API, Rails, and development</a> , which reveals some cool functionality. <br><br>  Whichever system you choose, there‚Äôs about one idea everywhere. <br><br>  If you are doing an API of any kind - please use this. <br><br>  The API is not just a proxy for SQL commands.  It needs to be planned, thought out and carefully maintained.  And then just changing the data storage location will not ruin all your network applications and services. </div><p>Source: <a href="https://habr.com/ru/post/261019/">https://habr.com/ru/post/261019/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261005/index.html">TKGate - an open-source digital circuit simulator: the project is alive again</a></li>
<li><a href="../261007/index.html">How to pass "test free data recovery software" (part 2)</a></li>
<li><a href="../261011/index.html">About interviews (by Eric Lippert)</a></li>
<li><a href="../261013/index.html">Adobe fixed critical flash player vulnerability</a></li>
<li><a href="../261017/index.html">Unity 5 uNet is a new network subsystem. Study on authoritarian architecture</a></li>
<li><a href="../261023/index.html">Create a simple UI5 ‚Äã‚Äãapplication in a web development environment</a></li>
<li><a href="../261027/index.html">Tail recursion in C ++ using 64-bit variables - Part 1</a></li>
<li><a href="../261029/index.html">Tail recursion in C ++ using 64-bit variables - Part 2</a></li>
<li><a href="../261031/index.html">Reactive extensions</a></li>
<li><a href="../261033/index.html">Turing's Cathedral: the origin of the digital universe</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>