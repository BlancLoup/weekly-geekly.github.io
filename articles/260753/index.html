<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Collection and visualization of application metrics in Graphite and Graph-Explorer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Often there is a need to track the various parameters of the application / service. For example, interest is the number of requests per second, the av...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Collection and visualization of application metrics in Graphite and Graph-Explorer</h1><div class="post__text post__text-html js-mediator-article">  Often there is a need to track the various parameters of the application / service.  For example, interest is the number of requests per second, the average server response time, the number of server responses with different HTTP status (technical metrics), the number of user registrations per hour, the number of payment transactions per minute (business metrics), etc. Without the metrics collection system product development and maintenance is almost blind. <br><br><img src="https://habrastorage.org/files/a1e/7a0/663/a1e7a066313d456a8046389870f2e720.jpg"><br><br>  This article is a guide to setting up a system for collecting and analyzing application metrics based on <a href="http://graphite.wikidot.com/">Graphite</a> and <a href="https://github.com/vimeo/graph-explorer">vimeo / graph-explorer</a> . <br><a name="habracut"></a><br><h2>  Motivation </h2><br>  The metrics collection system is not a monolith.  When deploying, you have to deal with a significant number of components, each of which somehow interacts with the others, has its own configuration file and a unique launch method.  Even Graphite, in itself, consists of at least three subsystems - a metrics (carbon) daemon, a database with metrics (whisper, etc.) and a web application for visualization.  When it is necessary to add graph-explorer support, everything becomes more interesting.  Each of the subsystems has its own separate documentation, but nowhere is there a document describing the whole picture. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Metrics </h2><br>  A metric is a sequence of (numeric) values ‚Äã‚Äãover time.  Very simple thing in essence.  In fact, there is some string key and its corresponding row (sample <sub>1</sub> , time <sub>1</sub> ), (sample <sub>2</sub> , time <sub>2</sub> ), ... A typical way for Graphite to name metrics is to split string keys into parts using the " <b>.</b> " Symbol, for example, <i>stats.web .request.GET.time</i> .  Graphite allows you to group metrics with a common prefix, using the " <b>*</b> " symbol when plotting graphs.  Obviously, this is not the most flexible way to work with keys.  If you need to add another component to the key, it can break the construction of graphs.  For example, casting the key from the example above to the form <i>stats.web.</i>  <i><b>server1</b> .request.GET.time</i> will break the common prefix for historical data.  The second significant disadvantage of such naming of metrics is the potential ambiguity of their interpretation.  Much more self-sufficient would be metrics that have keys of the form <i>service = web server = server1 what = request_time unit = ms</i> with the further ability to build combined charts using common tags, and not just general prefixes.  Fortunately, the guys from <a href="http://vimeo.github.io/graph-explorer/">vimeo</a> came up with <a href="http://metrics20.org/">metrics 2.0</a> and started their <a href="https://github.com/vimeo/graph-explorer">graph-explorer</a> running on top of graphite.  The main idea is a logical representation of metrics, like entities with a set of tag-value pairs.  Each metric in the 2.0 format still eventually is converted into a regular string key, separated by dots and placed in carbon, but previously an ‚Äúindex‚Äù is created in a separate storage that stores information about the correspondence of these keys and tag-value pairs.  Thus, using information from indexes, graph-explorer and implements the combination of different metrics on the same graph. <br><br><h2>  General view </h2><br>  In general, the metrics collection system can be represented by the following diagram: <br><img src="https://habrastorage.org/files/b24/9e4/fa3/b249e4fa3ad046d8ab391db710f13e35.png"><br>  Thus, an application (web service, daemon, etc.), written not in any language, sends metrics to a collector through a certain interface (layer), collects them partially, aggregates, calculates the update frequency (optional), and sends them in a certain amount of time. in carbon, which gradually puts them in storage.  The web application pulls data from the repository (and partially from carbon itself) and builds graphs for us.  The carbon daemon is actually 3 whole daemons: carbon-cache, carbon-relay and carbon-aggregator.  In the simplest case, you can use carbon-cache.  The carbon-relay implementation can be used for the purpose of sharding (load distribution among several carbon-cache) or replication (sending the same metrics to carbon-cache only).  The carbon-aggregator daemon is able to perform intermediate processing of metrics before sending them to the repository.  Metrics data in carbon can be transferred in one of two formats: plain text (so-called line protocol) to port 2003 and serialized to pickle to port 2004. At the same time, carbon-relay only returns data to the pickle (important! ). <br><br>  The graph-explorer add-in adds another storage for the so-called.  indexes of metrics.  <i>Elastic search is</i> used as such storage.  It is obvious that in some place of the system represented in the diagram it is necessary to add a link that will ‚Äúindex‚Äù the metrics.  This link is <a href="https://github.com/vimeo/carbon-tagger">carbon-tagger</a> .  As a result, the system takes the following form: <br><img src="https://habrastorage.org/files/413/7c5/3c6/4137c53c6a524dd69b6546d70c7a04f8.png"><br><br><h2>  Technology stack </h2><br>  Next comes the specifics, in your case, perhaps some of the components will be replaced by another solution. <br><ul><li>  Python application </li><li>  <a href="https://pypi.python.org/pypi/statsd">statsd client</a> for Python </li><li>  <a href="https://github.com/etsy/statsd">statsd</a> / <a href="https://gowalker.org/github.com/vimeo/statsdaemon">statsdaemon</a> </li><li>  <a href="http://graphite.wikidot.com/">graphite</a> <ul><li>  carbon-relay / <a href="https://github.com/graphite-ng/carbon-relay-ng">carbon-relay-ng</a> </li><li>  carbon-cache </li><li>  whisper </li><li>  webapp </li></ul></li><li>  <a href="https://github.com/vimeo/carbon-tagger">carbon-tagger</a> </li><li>  <a href="https://github.com/vimeo/graph-explorer">graph explorer</a> </li></ul><br>  The system is designed to collect metrics 2.0 and then use them in graph-explorer. <br><br><h2>  Installation </h2><br>  The installation will take place in the / opt / graphite directory, which is the default directory.  Some of the components are written in Go, so it will also have to be preset and set the corresponding environment variables.  Installation implies that Go is one in the system.  If you have several versions of Go installed, then you can skip this step and configure the required version at your own discretion. <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt wget https://storage.googleapis.com/golang/go1.4.2.linux-amd64.tar.gz tar -C /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span> -xzf go1.4.2.linux-amd64.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'export PATH=$PATH:/usr/local/go/bin'</span></span> &gt;&gt; /etc/profile <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'export GOPATH=/opt/go'</span></span> &gt;&gt; /etc/profile <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'export GOBIN="$GOPATH/bin"'</span></span> &gt;&gt; /etc/profile <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'export PATH=$PATH:$GOBIN'</span></span> &gt;&gt; /etc/profile <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> /etc/profile go env <span class="hljs-comment"><span class="hljs-comment">#      #GOBIN="/opt/go/bin" #GOPATH="/opt/go" #GOROOT="/usr/local/go"</span></span></code> </pre> <br>  Another important point when deploying the system is to closely monitor the ports.  It is a lot of components, everyone uses on several ports and it is easy to be mistaken, with whom to connect.  Plus, most components do not have any built-in authorization mechanism and at the same time listen to the interface 0.0.0.0 by default.  Therefore, I highly recommend wherever it is possible to change the interface to the local one and close all ports on the server via iptables. <br><br><h4>  statsd python client </h4><br>  The most popular <a href="https://pypi.python.org/pypi/statsd">statsd was</a> chosen as the client involved in sending metrics from the application.  Its implementation is infinitely simple.  In fact, this is sending text data to the specified UDP / TCP port with the addition of minimal protocol service data. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#     pip install statsd</span></span></code> </pre><br>  An example of use in the application code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> statsd client = statsd.StatsClient(host=<span class="hljs-string"><span class="hljs-string">'statsdaemon.local'</span></span>, port=<span class="hljs-number"><span class="hljs-number">8125</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    metrics 2.0  tag_is_value client.gauge('service_is_myapp.server_is_web1.what_is_http_request.unit_is_ms', &lt;execution_time&gt;)</span></span></code> </pre><br><h4>  statsd </h4><br>  In the ‚Äúclassic‚Äù graphite installation scheme, statsd is often used as an intermediate collector.  In our case, the <a href="https://gowalker.org/github.com/vimeo/statsdaemon">statsdaemon is</a> used, as it out of the box can work with metrics 2.0, while maintaining backward compatibility with the statsd protocol.  It is written on Go and its installation is extremely simple (caution, now in README.md an annoying error in the installation team): <br><br><pre> <code class="bash hljs">go get github.com/Vimeo/statsdaemon/statsdaemon</code> </pre><br>  After that, the statsdaemon executable file should appear in the / opt / go / bin directory.  The settings for this daemon are quite simple: <br><div class="spoiler">  <b class="spoiler_title">statsdaemon.ini</b> <div class="spoiler_text"><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta"># --- /etc/statsdaemon.ini --- listen_addr = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":8125"</span></span></span><span class="hljs-meta"> #     statsd- () admin_addr = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">":8126"</span></span></span><span class="hljs-meta"> graphite_addr = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"carbon.local:2013"</span></span></span><span class="hljs-meta"> #  carbon   ,   flush_interval  flush_interval = 30 prefix_rates = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stats."</span></span></span><span class="hljs-meta"> prefix_timers = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stats.timers."</span></span></span><span class="hljs-meta"> prefix_gauges = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stats.gauges."</span></span></span><span class="hljs-meta"> percentile_thresholds = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"90,75"</span></span></span><span class="hljs-meta"> max_timers_per_s = 1000</span></span></code> </pre><br></div></div><br>  Running statsdaemon: <br><br><pre> <code class="bash hljs">statsdaemon -config_file=<span class="hljs-string"><span class="hljs-string">"/etc/statsdaemon.ini"</span></span> -debug=<span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br>  At this stage, it is already possible to start statsdaemon and send several packages to it from the application using the statsd client.  The console output will speak for itself. <br><br><h4>  Graphite </h4><br>  The current installation guide is <a href="https://graphite.readthedocs.org/en/latest/install.html">here</a> .  Installation is best done inside the virtual environment, located in / opt / graphite. <br><br><pre> <code class="bash hljs">sudo apt-get install python-pip python-dev pip install pip --upgrade pip install virtualenv mkdir /opt/graphite virtualenv /opt/graphite <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/graphite <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> bin/activate sudo apt-get install libcairo2 python-cairo libffi-dev <span class="hljs-comment"><span class="hljs-comment">#    graphite  pip install https://github.com/graphite-project/ceres/tarball/master pip install whisper pip install carbon # pip install carbon --install-option="--prefix=/opt/graphite" --install-option="--install-lib=/opt/graphite/lib" pip install graphite-web # pip install graphite-web --install-option="--prefix=/opt/graphite" --install-option="--install-lib=/opt/graphite/webapp" #   Graphite WebApp pip install uwsgi pip install django pip install cairocffi pip install django-tagging #  webapp (cd /opt/graphite/webapp/graphite; python manage.py syncdb)</span></span></code> </pre><br>  After installation, the graphite will be located in / opt / graphite.  Next, you need to perform its configuration.  Sample configuration files are in / opt / graphite / conf.  The minimum that needs to be done is to create the carbon and whisper settings file. <br><br><pre> <code class="bash hljs">cp /opt/graphite/conf/carbon.conf.example /opt/graphite/conf/carbon.conf <span class="hljs-comment"><span class="hljs-comment"># carbon.conf    carbon-cache, carbon-relay  carbon-aggregator. #         carbon-cache: # LINE_RECEIVER_INTERFACE = 127.0.0.1 # LINE_RECEIVER_PORT = 2003 cp /opt/graphite/conf/storage-schemas.conf.example /opt/graphite/storage-schemas.conf # storage-schemas.conf   whisper,    - fixed-size db. #      1 ,     ( #  ),          . ...</span></span></code> </pre><br>  Next you need to run carbon-cache: <br><br><pre> <code class="bash hljs">carbon-cache.py --conf=conf/carbon.conf start <span class="hljs-comment"><span class="hljs-comment"># --debug tail -f /opt/graphite/storage/log/carbon-cache/carbon-cache-a/*.log</span></span></code> </pre><br>  And graphite webapp using uwsgi + any web server (for example, nginx): <br><br><pre> <code class="bash hljs">cp /opt/graphite/webapp/graphite/local_settings.py.example /opt/graphite/webapp/graphite/local_settings.py <span class="hljs-comment"><span class="hljs-comment">#  local_settings.py   SECRET_KEY  TIME_ZONE. /opt/graphite/bin/uwsgi --socket localhost:6001 --master --processes 4 --home /opt/graphite --pythonpath /opt/graphite/webapp/graphite --wsgi-file=/opt/graphite/conf/graphite.wsgi.example --daemonize=/var/log/graphite-uwsgi.log</span></span></code> </pre><br>  Nginx settings: <br><div class="spoiler">  <b class="spoiler_title">graphite.conf</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">upstream</span></span> graphite_upstream { <span class="hljs-attribute"><span class="hljs-attribute">server</span></span> <span class="hljs-number"><span class="hljs-number">127.0.0.1:6001</span></span>; } <span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">8085</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> graphite.local; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">include</span></span> uwsgi_params; <span class="hljs-attribute"><span class="hljs-attribute">uwsgi_pass</span></span> graphite_upstream; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span> <span class="hljs-string"><span class="hljs-string">'*'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span> <span class="hljs-string"><span class="hljs-string">'GET, POST, OPTIONS'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span> <span class="hljs-string"><span class="hljs-string">'origin, authorization, accept'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">add_header</span></span> <span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span> <span class="hljs-string"><span class="hljs-string">'true'</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_redirect</span></span> <span class="hljs-literal"><span class="hljs-literal">off</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> Host <span class="hljs-variable"><span class="hljs-variable">$host</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Real-IP <span class="hljs-variable"><span class="hljs-variable">$remote_addr</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-For <span class="hljs-variable"><span class="hljs-variable">$proxy_add_x_forwarded_for</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">proxy_set_header</span></span> X-Forwarded-Host <span class="hljs-variable"><span class="hljs-variable">$server_name</span></span>; } }</code> </pre><br></div></div><br>  It remains only to install carbon-tagger (it is he who fills in the index base for graph-explorer) and set up duplicate sending of metrics to carbon-cache and carbon-tagger using carbon-relay.  But unfortunately, carbon-tagger does not know how to work using the pickle protocol, and carbon-relay only sends data in this format.  Therefore, you need to install a drop-in replacement for carbon-relay from vimeo - <a href="https://github.com/graphite-ng/carbon-relay-ng">carbon-relay-ng</a> : <br><br><pre> <code class="bash hljs">go get -d github.com/graphite-ng/carbon-relay-ng go get github.com/jteeuwen/go-bindata/... <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-string"><span class="hljs-string">"/opt/go/src/github.com/graphite-ng/carbon-relay-ng"</span></span> make cp carbon-relay-ng /opt/go/bin/carbon-relay-ng touch /opt/graphite/conf/carbon-relay-ng.ini <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/graphite carbon-relay-ng conf/carbon-relay-ng.ini</code> </pre><br><div class="spoiler">  <b class="spoiler_title">carbon-relay-ng.ini</b> <div class="spoiler_text"><pre> <code class="hljs scala">instance = <span class="hljs-string"><span class="hljs-string">"default"</span></span> listen_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:2013"</span></span> admin_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:2014"</span></span> http_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:8081"</span></span> spool_dir = <span class="hljs-string"><span class="hljs-string">"spool"</span></span> log_level = <span class="hljs-string"><span class="hljs-string">"notice"</span></span> bad_metrics_max_age = <span class="hljs-string"><span class="hljs-string">"24h"</span></span> init = [ <span class="hljs-symbol"><span class="hljs-symbol">'addRoute</span></span> sendAllMatch carbon-<span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">2003</span></span> spool=<span class="hljs-literal"><span class="hljs-literal">true</span></span> pickle=<span class="hljs-literal"><span class="hljs-literal">false</span></span>', #    carbon-cache <span class="hljs-symbol"><span class="hljs-symbol">'addRoute</span></span> sendAllMatch carbon-tagger <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>:<span class="hljs-number"><span class="hljs-number">2023</span></span> spool=<span class="hljs-literal"><span class="hljs-literal">true</span></span> pickle=<span class="hljs-literal"><span class="hljs-literal">false</span></span>' #    carbon-tagger ] [instrumentation] graphite_addr = <span class="hljs-string"><span class="hljs-string">""</span></span> graphite_interval = <span class="hljs-number"><span class="hljs-number">1000</span></span></code> </pre><br></div></div><br><h4>  carbon-tagger </h4><br>  The carbon-tagger daemon is written in Go and deals with sending indexes of metrics to Elastic Search for later use in graph-explorer.  First of all, it is necessary to install java and <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-repositories.html">Elastic Search</a> on the server.  Carbon-tagger setting: <br><br><pre> <code class="bash hljs">go get github.com/Vimeo/carbon-tagger go get github.com/mjibson/party go build github.com/Vimeo/carbon-tagger</code> </pre><br><div class="spoiler">  <b class="spoiler_title">carbon-tagger.conf</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">[<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> = <span class="hljs-number"><span class="hljs-number">2023</span></span> #    carbon-relay-ng [elasticsearch] host = <span class="hljs-string"><span class="hljs-string">"esearch.local"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> = <span class="hljs-number"><span class="hljs-number">9200</span></span> index = <span class="hljs-string"><span class="hljs-string">"graphite_metrics2"</span></span> flush_interval = <span class="hljs-number"><span class="hljs-number">2</span></span> max_backlog = <span class="hljs-number"><span class="hljs-number">10000</span></span> max_pending = <span class="hljs-number"><span class="hljs-number">5000</span></span> [stats] host = <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> = <span class="hljs-number"><span class="hljs-number">2003</span></span> #  carbon-tagger      (  ) id = <span class="hljs-string"><span class="hljs-string">"default"</span></span> flush_interval = <span class="hljs-number"><span class="hljs-number">10</span></span> http_addr = <span class="hljs-string"><span class="hljs-string">"127.0.0.1:8123"</span></span></code> </pre><br></div></div><br>  Running carbon-tagger: <br><br><pre> <code class="bash hljs">(<span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/go/src/github.com/Vimeo/carbon-tagger/; ./recreate_index.sh) <span class="hljs-comment"><span class="hljs-comment">#    ES carbon-tagger -config="/opt/graphite/conf/carbon-tagger.conf" -verbose=true</span></span></code> </pre><br><h4>  graph explorer </h4><br>  And finally, the installation of the nail program: <br><br><pre> <code class="bash hljs">pip install graph-explorer</code> </pre><br><div class="spoiler">  <b class="spoiler_title">graph-explorer.conf</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">[graph_explorer] listen_host = <span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> #  ,   HTTP Basic Auth  nginx listen_port = <span class="hljs-number"><span class="hljs-number">8080</span></span> filename_metrics = metrics.json log_file = /var/<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>/graph-explorer/graph-explorer.<span class="hljs-keyword"><span class="hljs-keyword">log</span></span> [graphite] url_server = http://localhost url_client = http://graphite.<span class="hljs-keyword"><span class="hljs-keyword">local</span></span>:<span class="hljs-number"><span class="hljs-number">8085</span></span> #  graphite webapp</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">nginx / graph-explorer.conf</b> <div class="spoiler_text"><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">server</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">listen</span></span> <span class="hljs-number"><span class="hljs-number">80</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">server_name</span></span> metrics.yourproject.net; <span class="hljs-attribute"><span class="hljs-attribute">location</span></span> / { <span class="hljs-attribute"><span class="hljs-attribute">auth_basic</span></span> <span class="hljs-string"><span class="hljs-string">"Who are you?"</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">auth_basic_user_file</span></span> /etc/nginx/.htpasswd; <span class="hljs-attribute"><span class="hljs-attribute">proxy_pass</span></span> http://localhost:8080; } }</code> </pre><br></div></div><br>  Running graph-explorer: <br><br><pre> <code class="bash hljs">mkdir /var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/graph-explorer run_graph_explorer.py /opt/graphite/conf/graph_explorer.conf</code> </pre><br>  After that, the graph-explorer web interface will be available at <i>metrics.yourproject.net</i> . <br><br><h2>  Instead of conclusion </h2><br>  Stop <s>living</s> with your eyes closed,% habrauser%!  Expand metrics collection systems and share interesting schedules from your projects!  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/260753/">https://habr.com/ru/post/260753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../260739/index.html">Sencha: About licenses and restrictions</a></li>
<li><a href="../260741/index.html">Getting started with OpenCV and its use in C #</a></li>
<li><a href="../260745/index.html">Basics of multithreading in the .NET Framework</a></li>
<li><a href="../260747/index.html">Black archeology date of mining</a></li>
<li><a href="../260749/index.html">Making homemade accessories for Dendy</a></li>
<li><a href="../260755/index.html">How the PVS-Studio team improved the Unreal Engine code</a></li>
<li><a href="../260757/index.html">How we made programming language from JSON</a></li>
<li><a href="../260761/index.html">Bindings QCustomPlot for Python</a></li>
<li><a href="../260763/index.html">Programming for beginners. My acquaintance with Processing</a></li>
<li><a href="../260765/index.html">SAP's electronic signature is just</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>