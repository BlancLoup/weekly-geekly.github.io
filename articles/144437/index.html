<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of the "compass of the 21st century"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time of day Habr! 
 And the story is such that a young specialist came to our company (I don‚Äôt say the name, as the company works with the State ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of the "compass of the 21st century"</h1><div class="post__text post__text-html js-mediator-article"><h4>  Good time of day Habr! </h4><br>  And the story is such that a young specialist came to our company (I don‚Äôt say the name, as the company works with the State customer) (I‚Äôm not disclosing his name because he would be quickly taken otherwise) who will defend his master‚Äôs thesis this summer.  And as a friendly person and colleague, I wanted to get to know him better.  When we met, he revealed to me the secret of his dissertation (about which I will probably write later, when he successfully defends her), and in the dissertation there was an electronic compass module: <br><img src="https://habrastorage.org/storage2/2d8/95e/49b/2d895e49b536555997a652d4d7592465.png"><br><br>  True, he is not at the final stage but, in my opinion, quite a worthy thing, because he can work autonomously.  After a short conversation, we came to an agreement with him, and now I will describe his projects, which are quite a lot and they are applicable in everyday life. <a name="habracut"></a><br><br><h5>  So here we go (carefully many pictures) </h5><br>  The idea of ‚Äã‚Äãa compass is quite simple, based on the STM32F103CB microcontroller in the LQFP48 package 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><img src="https://habrastorage.org/storage2/641/582/678/6415826782e734cc130b49c58abbc4ee.png"><br><br>  More details can be found <a href="http://www.st.com/internet/mcu/product/189782.jsp">here</a> , the company STMicroelectronics, many of those who are familiar with this MK or viewed the information on the link will say that 72 MHz is a bit too much for such a simple device, I can give a price as an argument (the price ranges from 95 to 150 rubles), and In the plans of the author of the device ‚Äúto finish‚Äù the program component to a pleasant look, which I understand and will require performance. <br>  Also in the device there is a display from the phone SIEMENS S65 (if I‚Äôm really interested I can drop the datasheet on the mail to everyone), the temperature and humidity sensor SHT21 (if you‚Äôre interested in more details <a href="http://www.sensirion.com/01_humidity_sensors/05_humidity_sensor_sht21/00_humidity_sensor_sht21.htm">here</a> ), which looks like this: <br><br><img src="https://habrastorage.org/storage2/0a9/1b8/d27/0a91b8d2775da6cd607c3b75864bc68a.png"><br><br>  And just the accelerometer combined in one case with the LSM303DLH magnetometer (in <a href="http://www.st.com/internet/com/TECHNICAL_RESOURCES/TECHNICAL_LITERATURE/DATASHEET/CD00260288.pdf">more detail</a> about it) from the same STMicroelectronics is responsible for the compass part; its appearance is not very remarkable, but in the article keep: <br><br><img src="https://habrastorage.org/storage2/e4a/010/6cf/e4a0106cfb945d1ec2a2fed53d56ccd9.png"><br><br>  Well, it feeds all this with no name 1050 mAh battery, 3.7V external which looks like this: <br><br><img src="https://habrastorage.org/storage2/2a7/8ef/154/2a78ef154af57a6d8ed25ce6c0f42bac.png"><br><br>  More about the battery I have nothing to say. <br>  I will not describe the binding of the main elements as there are datasheets, read the main points and interesting solutions in the next article, which I will write thoroughly after consulting the author of the ‚Äúmiracle‚Äù, and I almost forgot to have a keyboard <br><br><img src="https://habrastorage.org/storage2/475/37f/06c/47537f06c88a745399da9c1fc6ad4cc5.png"><br><br>  for three buttons, it is homemade and about it below, as well as two switches for power and backlight: <br><br><img src="https://habrastorage.org/storage2/935/dc8/eb5/935dc8eb583e136c2f4e48bb2f25e996.png"><br><br><h5>  And so with the hardware, we figured out and now turn to the description of the manufacturing process </h5><br>  Here, the first item, as it should be, is the manufacture of a printed circuit board, of course darkness, and many use their favorites, so I‚Äôll just say that he used a laser printer and an iron, the layout of the board and keyboard turned out to be: <br><br><br><img src="https://habrastorage.org/storage2/b0e/6a8/549/b0e6a8549854f93dca6984a7600c5024.png"><br><br>  (if someone needs this creation, then I will send you a PDF, of course, if the author will not mind) <br>  As a result, the assembly should work according to the drawing as follows: <br><br><img src="https://habrastorage.org/storage2/2d7/c04/bd5/2d7c04bd5f8645b0e2d3fe9e12aea2f1.png"><br><br>  Well, we then saw that it came about like this. <br>  As you can see, the keyboard is a three grid made on the PCB and is an analogue of the buttons on the NES <a href="http://piccy.info/view3/3046462/8799b01dfebb84964b28b5be78272c5a/">controller</a> from Nintendo. <br>  So now we solder the whole thing according to a scheme that turned out to be quite simple and consists of four small fragments (why I‚Äôm not combined into one I can‚Äôt answer because I don‚Äôt know the scheme editor): <br>  Part containing port pinout pattern <br><br><img src="https://habrastorage.org/storage2/de6/ead/1cd/de6ead1cdf00e0fd0d734139efd7fe6f.png"><br><br>  - part of the power system and connecting the displays and buttons <br><br><img src="https://habrastorage.org/storage2/f6a/2b0/73c/f6a2b073cbbc584ab18a21ad79c9cdc2.png"><br><br>  - part of the accelerometer connection <br><br><img src="https://habrastorage.org/storage2/c35/342/ece/c35342eced117d7248e42402b2ec5ff4.png"><br><br>  - and the pearl of the scheme (according to the author) is a step-up stabilizer <br><br><img src="https://habrastorage.org/storage2/0c8/9c6/4ca/0c89c64ca6753d8b30c418a0a6a61d49.png"><br><br>  After the manipulations with an iron and a soldering iron, we get a practically finished product, the printed circuit board in this case is the body, although there are drawbacks to this design.  For example, there is no back cover (as in the photo of the battery) and no display holder (as seen in the first photo in the post) and reliability is doubtful because of the ‚Äútoo‚Äù great durability of rubber bands for money.  But I can assure you that the author is working to eliminate these shortcomings (and, more specifically, is looking for a simple and convenient body). <br>  In the end, after the assembly, we get the device itself, but without the notorious gums, the result will be: <br><br><img src="https://habrastorage.org/storage2/b5d/61c/912/b5d61c9123decfb199579fd996c369dd.png"><br><br><h5>  Now go to the software part </h5><br>  Here, according to the author, there is nothing complicated.  But for me, to whom the programming of the MK has not resigned, it seems that everything is pretty difficult.  And so we have in the project a module of the operating system (which is a task manager), you can see it <a href="http://pastebin.com/NXUHyiS7">here.</a>  The OS configuration file is <a href="http://pastebin.com/YHfhXqKz">here</a> . The device initialization module is <a href="http://pastebin.com/UQ5yY1Wn">here</a> . <br>  And directly <a href="http://pastebin.com/DXs19hgU">keyboard</a> modules, <br>  <a href="http://pastebin.com/cbszEuEc">temperature and humidity sensor</a> <br>  <a href="http://pastebin.com/sTe356fz">accelerometer and magnetometer</a> . <br><br>  The device works smartly and because of the temporary lack of datasheet it can deal with keystroke combinations and their results only by looking at the source code, which, to my joy, is written in C (The assembler for some unknown reason causes my panic and I cannot understand the code).  That's probably all that concerns the software part. <br><br><h5>  Go to testing </h5><br>  After switching on, the author‚Äôs name and OS version are shown on the screen (unfortunately I didn‚Äôt have time to catch it), although it doesn‚Äôt last that long, but the same information is also available while the device is working (I‚Äôve erased the author‚Äôs name from conspiracy motives) <br><br><img src="https://habrastorage.org/storage2/a0a/ac3/ced/a0aac3ced6ff41ce9ddf4aec7dba5675.png"><br><br>  As you can see in the photo, the backlight is not at all superfluous, after turning it on, everything looks like this: <br><br><img src="https://habrastorage.org/storage2/816/cd3/156/816cd3156a646cc8c028cbb514791dd1.png"><br><br>  After the download, a favorite twist slash actually appears, prompting the user that the device is busy collecting and outputting data (although you can admit you can watch it for a long time, reflecting on the questions of being).  Information from the accelerometer is displayed in the upper left corner (a dot on a white background moves along the white area indicating the slope), in the upper right corner there is information from a magnetometer that points north and south (although this is a line so far), the letter T denotes the temperature , RH relative humidity, numbers above temperature and humidity denote speed and movement.  With a seemingly small battery capacity, it was enough for two days of intense tests (while it was charging directly, which I did not dare to do), due to the high sensitivity of the magnetometer, household appliances made their own, almost noticeable error, but somewhere in the forests of the Amazon or Siberia This problem will disappear by itself (Primus then hardly hurts).  My personal verdict for this device is rather encouraging, rather than vice versa, the more the author modifies it in free time and as a result you can get a very useful gadget if you go on a hike without a modern smartphone (because there grows the likelihood of breaking it, running away from a bear) . <br><br>  PS I apologize for the quality of the background in the photos, Ikea flashlight clips are obviously not enough for LightBox, but there were no others at hand.  And also if there is a solution to demonstrate the source more compactly, I will be glad to help (thanks to <a href="http://geektimes.ru/users/g3kas/" class="user_link">G3kas</a> , <a href="http://geektimes.ru/users/pel/" class="user_link">pel</a> , <a href="http://geektimes.ru/users/ruma7a/" class="user_link">Ruma7a</a> , <a href="http://geektimes.ru/users/ocelot/" class="user_link">Ocelot</a> , <a href="http://geektimes.ru/users/zona7o/" class="user_link">zona7o</a> , <a href="http://geektimes.ru/users/morr/" class="user_link">morr</a> , <a href="http://geektimes.ru/users/ertaquo/" class="user_link">ertaquo</a> for help in finding errors. Special Thanks to <a href="http://geektimes.ru/users/rmk/" class="user_link">rmk</a> for a detailed comment). </div><p>Source: <a href="https://habr.com/ru/post/144437/">https://habr.com/ru/post/144437/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144429/index.html">Oracle vs Google: fronts</a></li>
<li><a href="../144430/index.html">Kinect for Windows SDK has learned to work with individuals</a></li>
<li><a href="../144431/index.html">The simplest ESR meter for electrolytic capacitors</a></li>
<li><a href="../144433/index.html">Web Evolution (Part 2: Who will own the Internet?)</a></li>
<li><a href="../144435/index.html">Using CAN network and CANopen stack</a></li>
<li><a href="../144438/index.html">UIImage and resizableImageWithCapInsets</a></li>
<li><a href="../144439/index.html">Find admin + shell on *******. Alfabank.ru using Google</a></li>
<li><a href="../144441/index.html">Opera Mobile and Opera Mini Updates</a></li>
<li><a href="../144442/index.html">Comparison of approaches to site creation: design, brief and agile</a></li>
<li><a href="../144443/index.html">The second day of the broadcast with DevCon'12! More reports</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>