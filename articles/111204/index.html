<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using HDAPS in ThinkPad Linux Laptops when needed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Instead of introducing 
 Becoming a relatively happy owner of a Lenovo ThinkPad T410 laptop, my first 
 a political decision was the change of state a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using HDAPS in ThinkPad Linux Laptops when needed</h1><div class="post__text post__text-html js-mediator-article"><h4>  Instead of introducing </h4><br>  Becoming a relatively happy owner of a <i>Lenovo ThinkPad T410</i> laptop, my first <br>  a political decision was the change of state arrangement - the installation of a convenient Linux for me <br>  as the primary operating system.  The Debian Testing (Squeeze) distribution kit was chosen as the messenger carrying good and light. <br><br>  Agree that it makes little sense to buy a business class laptop and not to use at least all its possibilities. <br><br><h4>  HDAPS </h4><br>  Among the many not only the most interesting and useful buns provided by ThinkPads there is one about which will be discussed below.  Her name is <b>HDAPS</b> (Hard Drive Active Protection System; active hard disk protection system).  The principle of its operation is similar to car airbags, triggered in an accident.  On the motherboard of the laptop there is a microchip that controls the sudden acceleration of the computer case.  For example, the fall of the laptop.  When such a situation arises, the system instantly blocks the head of the hard disk.  When the system returns to its former, quieter state, the hard drive starts up in normal mode. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br>  The ability to respond to such events allows you to avoid hard disk crashes when falling or just shaking.  But the most important thing, of course, is preventing data loss. <br><br>  HDAPS is not a unique solution of Lenovo (IBM) in the market of computing equipment.  Similar or even more advanced buns are provided by other major laptop manufacturers.  For example, SMS (Sudden Motion Senser) from Apple or FFS (Free Fall Sensor) from Dell <b>[0]</b> . <br><br><h4>  There are no problems in Linux either. </h4><br>  HDAPS works in Windows that is out of the box.  In Linux, the situation is somewhat different: our bun will work there too.  But according to the time-tested tradition, only after a couple of harmless and weak blows with a file. <br><br>  There is an incredibly beautiful and useful website on the Web, which is just a wealth of information on how to tweak a ThinkPad in Linux - <i>ThinkWiki</i> <b>[1]</b> .  If a question arises on the ThinkPad, then with a probability of ~ 85%, the most relevant answer to it can be found on ThinkWiki.  There is also a wonderful article <i>‚ÄúHow to protect the harddisk through APS‚Äù</i> <b>[2]</b> , which tells in detail what is required to be done in order for HDAPS to work in Linux: compile a couple of modules and install a magic demon.  After that, the HDD protection system will start working.  Anytime and anywhere. <br><br><h4>  We make it even wiser </h4><br>  But we are rational people.  Why does such a useful system work even when the computer is not only standing on the table, but also still connected to the power supply?  It makes sense to include HDAPS only when the laptop begins to use in its basic quality - a mobile computer;  transferring in the included from place to place state.  Then, when the risk of dropping a laptop from any height is high enough.  In other cases, you can simply turn off our subsystem. <br><br><h5>  Step 1: Determine the Power Supply </h5><br>  In order to perform an action when the power supply of the laptop changes, it is necessary to use the features of the pm-utils package, which is installed by default in most Linux distributions.  To do this, put in /etc/pm/power.d the following hdaps <i>file</i> with the right of execution ( <i>chmod + x /etc/pm/power.d/hdaps</i> ): <br><blockquote><ol><li>  <font color="#666666">#! / bin / sh</font> </li><li></li><li>  <font color="#007800">HDAPS_MODULES</font> = <font color="#ff0000">"thinkpad_ec tp_smapi hdaps"</font> </li><li>  <font color="#007800">HDAPSD_INIT_SCRIPT</font> = <font color="#000000">/</font> etc <font color="#000000">/</font> init.d <font color="#000000">/</font> hdapsd </li><li>  <font color="#007800">MODPROBE</font> = <font color="#000000">/</font> sbin <font color="#000000">/</font> modprobe </li><li>  <font color="#007800">RMMOD</font> = <font color="#000000">/</font> sbin <font color="#000000">/</font> rmmod </li><li></li><li>  <font color="#000000">case</font> <font color="#ff0000">"$ 1"</font> <font color="#000000">in</font> </li><li>  <font color="#666666">### CASE: Work on battery</font> </li><li>  <font color="#c20cb9">true</font> <font color="#7a0874">)</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"Enabling HDAPS"</font> </li><li></li><li>  <font color="#000000">for</font> module <font color="#000000">in</font> <font color="#007800">$ HDAPS_MODULES</font> ;  <font color="#000000">do</font> </li><li>  <font color="#007800">$ MODPROBE</font> <font color="#007800">$ module</font> </li><li>  <font color="#000000">done</font> </li><li></li><li>  <font color="#007800">$ HDAPSD_INIT_SCRIPT</font> start </li><li>  <font color="#000000">;;</font> </li><li></li><li>  <font color="#666666">### CASE: Work on AC-adapter</font> </li><li>  <font color="#c20cb9">false</font> <font color="#7a0874">)</font> </li><li>  <font color="#7a0874">echo</font> <font color="#ff0000">"Disabling HDAPS"</font> </li><li></li><li>  <font color="#007800">$ HDAPSD_INIT_SCRIPT</font> stop </li><li></li><li>  <font color="#666666">### NOTE: modules should be unloaded in the reverse order</font> </li><li>  <font color="#000000">for</font> module <font color="#000000">in</font> <font color="#7a0874">echo</font> <font color="#007800">$ HDAPS_MODULES</font> <font color="#000000">|</font>  <font color="#c20cb9">tac</font> <font color="#660033">-s</font> <font color="#ff0000">''</font> <font color="#000000">`</font> ;  <font color="#000000">do</font> </li><li>  <font color="#007800">$ RMMOD</font> <font color="#007800">$ module</font> </li><li>  <font color="#000000">done</font> </li><li>  <font color="#000000">;;</font> </li><li>  <font color="#000000">esac</font> </li><li></li></ol></blockquote><br>  When the power source (battery or adapter) changes, the scripts located in <i>/etc/pm/power.d are called</i> in <i>turn</i> .  So the turn reaches and our code.  Each script is called with one argument: <i>true</i> or <i>false</i> .  If true, then our ThinkPad switched to battery mode;  therefore we need to activate HDAPS.  To do this, we use modprobe to load the modules required for the subsystem (aka ‚Äúdrivers‚Äù without which nothing will take off) and the hdapsd daemon starts.  If the computer is powered by an adapter, our hdaps script gets false as an argument.  In this case, all previous steps must be repeated in the reverse order to pause HDAPS. <br><br><h5>  Step 2: Disable HDAPS autoloading </h5><br><br>  Since the scripts from /etc/pm/power.d are always called when you turn on / wake up your laptop, it makes no sense to unconditionally download HDAPS every time, in just a few seconds to disable it using our script.  To disable autoloading enough: <br>  1. Remove from / etc / modules the list of dependent modules ( <i>thinkpad_ec, tp_smapi, hdaps</i> ); <br>  2. Disable hdapsd daemon autostart: <i>update-rc.d -f hdapsd remove</i> . <br><br><h4>  Result </h4><br>  HDAPS now only works when you really need it.  For a "clean" check, just restart the computer and try disconnecting the adapter from the laptop: the list of loaded modules ( <i>lsmod + grep</i> ) should change and the list of running processes ( <i>ps -aux + grep</i> ) <i>should be updated</i> . <br><br>  <b>UPD:</b> Naturally, this instruction is by no means mandatory for all ThinkPad owners with Linux on board.  If there is a rather big risk that the laptop can make a swift flight towards the floor while being connected to the adapter, it makes sense to leave the HDAPS settings ‚Äúas is‚Äù. <br><br><h4>  Literature </h4><br><ol><li>  <b>[0]</b> Active Hard Drive Protection, <a href="http://en.wikipedia.org/wiki/Active_hard_drive_protection">en.wikipedia.org/wiki/Active_hard_drive_protection</a> </li><li>  <b>[1]</b> ThinkWiki, <a href="http://thinkwiki.org/">thinkwiki.org</a> </li><li>  <b>[2]</b> How to enable HDAPS, <a href="http://www.thinkwiki.org/wiki/How_to_protect_the_harddisk_through_APS">www.thinkwiki.org/wiki/How_to_protect_the_harddisk_through_APS</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/111204/">https://habr.com/ru/post/111204/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111199/index.html">About hatred for C ++</a></li>
<li><a href="../111200/index.html">VLC based video player. Part 1</a></li>
<li><a href="../111201/index.html">Google Chrome Voice Search</a></li>
<li><a href="../111202/index.html">PHP and Dropbox. Remote storage of user files</a></li>
<li><a href="../111203/index.html">MODx - Accounting visitors and schedule visits</a></li>
<li><a href="../111205/index.html">Drupal module for working with Yandex.Mail</a></li>
<li><a href="../111207/index.html">Track Changes in SQL Server 2008</a></li>
<li><a href="../111208/index.html">Review of an inexpensive dual-core netbook, Packard Bell DOT SE W-301RU</a></li>
<li><a href="../111210/index.html">Some ideas of writing an artificial intellect for chess</a></li>
<li><a href="../111211/index.html">Drupal 7 released</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>