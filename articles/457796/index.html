<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Features RTC M41T56</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="M41T56 is a chip of Real Time Clock, which is an analogue of the popular DS1307. And even though the pinout of the microcircuits coincides, they have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Features RTC M41T56</h1><div class="post__text post__text-html js-mediator-article">  M41T56 is a chip of Real Time Clock, which is an analogue of the popular DS1307.  And even though the pinout of the microcircuits coincides, they have significant differences, which I will try to tell about. <br><a name="habracut"></a><br><h2>  Short description </h2><br>  I will not stop at the work of the IIC bus, I‚Äôll just note that both chips have the address 0xd0.  To work with the time of the chip contain seven registers of the account and the control register.  Counting registers contain numbers in binary coded decimal format, however some bits have a special meaning. <br><br>  <b>Registers</b> <br>  xxx - the value of a bit is undefined. <br><div class="scrollable-table"><table><tbody><tr><th rowspan="2">  function </th><th rowspan="2">  index </th><th colspan="8">  bits </th><th rowspan="2">  possible values </th></tr><tr><th>  7 </th><th>  6 </th><th>  five </th><th>  four </th><th>  3 </th><th>  2 </th><th>  one </th><th>  0 </th></tr><tr><td>  seconds </td><td>  0x00 </td><td>  ST </td><td colspan="3">  tens of seconds </td><td colspan="4">  units of seconds </td><td>  0 - 59 </td></tr><tr><td>  minutes </td><td>  0x01 </td><td>  xxx </td><td colspan="3">  tens of minutes </td><td colspan="4">  units of minutes </td><td>  0 - 59 </td></tr><tr><td>  clock </td><td>  0x02 </td><td>  SEB </td><td>  SB </td><td colspan="2">  tens of hours </td><td colspan="4">  units of hours </td><td>  0 - 23 </td></tr><tr><td>  day </td><td>  0x03 </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td colspan="3">  day of the week </td><td>  1 - 7 </td></tr><tr><td>  day of the month </td><td>  0x04 </td><td>  xxx </td><td>  xxx </td><td colspan="2">  tens of days </td><td colspan="4">  units of the day </td><td>  1 - (28 | 29 | 30 | 31) </td></tr><tr><td>  month </td><td>  0x05 </td><td>  xxx </td><td>  xxx </td><td>  xxx </td><td colspan="1">  dess </td><td colspan="4">  units of the month </td><td>  1 - 12 </td></tr><tr><td>  year </td><td>  0x06 </td><td colspan="4">  tens of years </td><td colspan="4">  units of the year </td><td>  0 - 99 </td></tr><tr><td>  control register </td><td>  0x07 </td><td>  Out </td><td>  FT </td><td>  S </td><td colspan="5">  correction value </td><td>  - </td></tr></tbody></table></div><br>  <b>Bits</b> <br>  x - after switching on, the bit state can be any. <br><div class="scrollable-table"><table><tbody><tr><th>  bit </th><th>  after reset </th><th>  description </th></tr><tr><td>  ST </td><td>  x </td><td>  When writing 1 to this bit, the generator stops. </td></tr><tr><td>  CEB </td><td>  x </td><td rowspan="2">  When the CEB (Century Enable Bit) bit is set, when the new century is reached, the CB (Century Bit) bit will change the value to the opposite. </td></tr><tr><td>  CB </td><td>  x </td></tr><tr><td>  Out </td><td>  one </td><td rowspan="2">  When the OUT (OUTput level) and FT (Frequency Test) bits are equal to zero, the FT / OUT pin is pressed to ground.  With FT = 1, the output of FT / OUT is 512 Hz and the OUT bit does not matter. </td></tr><tr><td>  FT </td><td>  0 </td></tr><tr><td>  S </td><td>  x </td><td>  RTC stroke calibration sign. </td></tr></tbody></table></div><br>  Differences begin in the assignment of bits 7, 6 and 5 of the watch register.  In M41T56, bits 7 and 6 are used to indicate the transition to the new century, and bits 5 and 4 are used to count dozens of hours.  Moreover, the counting hours is possible only in mode 24, AM / PM mode is not available.  In DS1307, bit 7 is not used, zero in bit 6 indicates that the count mode is 24, and in this case bits 5 and 4 contain tens of hours.  If bit 6 is one, then bit 5 becomes the AM / PM flag, and bit 4 contains dozens of hours. <br><br>  Significant differences exist in the control register, which contains the word for stroke correction. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Stroke correction </h2><br>  M41T56 allows you to compensate for the error of the quartz resonator in the range from -62 to +124 ppm, which gives a deviation of no more than ¬± 5 seconds per month.  For the compensation of the six lower bits of the control register.  Bits 4-0 contain an integer without the sign of the correction value, and bit 5 specifies the direction of the correction.  If bit 5 contains zero, the course slows down in 2,034 ppm increments; otherwise, the RTC is accelerated in 4,068 ppm increments.  This is inconvenient, so I sketched a couple of simple functions to convert from ppm to word correction and back. <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*        . */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MASK_CALIBR ((1 &lt;&lt; 4) | (1 &lt;&lt; 3) | (1 &lt;&lt; 2) | (1 &lt;&lt; 1) | (1 &lt;&lt; 0)) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*        . */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> MASK_CALIBR_SIGN (1 &lt;&lt; 5) </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** *    . * @param caliber    RTC. * @return    ppm. */</span></span></span><span class="hljs-meta"> int8_t caliber_to_ppm(uint8_t caliber) { int8_t result = caliber &amp; MASK_CALIBR; result = (uint8_t) result * 2; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> ((caliber &amp; MASK_CALIBR_SIGN) != 0) { result = -result; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { result = (uint8_t) result * 2; } return result; } </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/** *   . * @param ppm    ppm. * @return    RTC. */</span></span></span><span class="hljs-meta"> uint8_t ppm_to_caliber(int8_t ppm) { uint8_t result; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (ppm &lt; 0) { result = (uint8_t) (-ppm + 1) / 2; result |= MASK_CALIBR_SIGN; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { result = (uint8_t) (ppm + 2) / 4; } return result; }</span></span></code> </pre> <br><h2>  Crash Detection </h2><br>  Neither DS1307, but M41T56 are not able to detect generation failures, but they guarantee that when power is turned on, some bits will be in a certain state.  M41T56 when enabled in the control register will be 10xxxxxx.  To track crashes in a program, you can follow the following algorithm.  If when turning on the microcontroller, the RTC control register contains 10xxxxxx, then there was a power failure and the register needs to write a value whose high bits are not 10. The simplest thing is to write the correction word with bits 7 and 6 equal to zero. <br><br><h2>  Literature </h2><br><ul><li>  Reference sheet <a href="https://www.st.com/resource/en/datasheet/m41t56.pdf">M41T56</a> </li><li>  <a href="https://datasheets.maximintegrated.com/en/ds/2688.pdf">DS1307</a> Reference Sheet </li></ul></div><p>Source: <a href="https://habr.com/ru/post/457796/">https://habr.com/ru/post/457796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45778/index.html">The new version of Ruby is faster up to 5 times</a></li>
<li><a href="../457784/index.html">Custom'a Eye-tracker calibration</a></li>
<li><a href="../457786/index.html">Updated Anet A8 Plus. Large and made of metal</a></li>
<li><a href="../457790/index.html">BuratinoPhone mobile phone</a></li>
<li><a href="../457794/index.html">The symmetry property of the cointegration relation</a></li>
<li><a href="../457798/index.html">What do open-end funds do - talk about fresh OpenStack and Linux Foundation projects</a></li>
<li><a href="../4578/index.html">Microsoft refuses copyright on Sender ID</a></li>
<li><a href="../457800/index.html">Critical vulnerabilities of MacOS Mojave are actively exploited by hackers.</a></li>
<li><a href="../457804/index.html">ListenIt - Google Chrome extension to automatically create audio versions of articles.</a></li>
<li><a href="../457808/index.html">Thermal Imager Seek Thermal Compact</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>