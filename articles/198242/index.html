<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Core Data for iOS. Chapter 4 Theoretical part</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, good day! 
 Today I want to start writing a series of lectures with practical tasks on the book ‚ÄúPro Core Data for iOS‚Äù by Michael Privat an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Core Data for iOS. Chapter 4 Theoretical part</h1><div class="post__text post__text-html js-mediator-article">  Good day, good day! <br>  Today I want to start writing a series of lectures with practical tasks on the book ‚ÄúPro Core Data for iOS‚Äù by Michael Privat and Robert Warner, which you can buy from <a href="http://www.apress.com/9781430236566">this</a> link.  Each chapter will contain a theoretical and practical part. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/10b/0e6/5ef/10b0e65efd9b395b8e3e3b9f41bdc354.png"><br><br>  Content: <br><ul><li>  <a href="http://habrahabr.ru/post/191334/">Chapter number 1.</a>  <a href="http://habrahabr.ru/post/191334/">Getting Started</a> ( <a href="http://habrahabr.ru/post/191472/">Practical Part</a> ) </li><li>  <a href="http://habrahabr.ru/post/191580/">Chapter number 2.</a>  <a href="http://habrahabr.ru/post/191580/">Digest Core Data</a> ( <a href="http://habrahabr.ru/post/192090/">practical part</a> ) </li><li>  <a href="http://habrahabr.ru/post/192960/">Chapter number 3.</a>  <a href="http://habrahabr.ru/post/192960/">Data storage: SQLite and other options</a> </li><li>  <a href="http://habrahabr.ru/post/198242/">Chapter 4</a>  <a href="http://habrahabr.ru/post/198242/">Creating a data model</a> </li><li>  Chapter number 5.  We work with data objects </li><li>  Chapter number 6.  Processing Result Sets </li><li>  Chapter number 7.  Performance tuning and memory usage </li><li>  Chapter number 8.  Version Control and Migration </li><li>  Chapter number 9.  Managing tables using NSFetchedResultsController </li><li>  Chapter number 10.  Using Core Data in Advanced Applications </li></ul><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Introduction </h5><br>  You can create custom applications with a terrific interface that helps them in everyday life and problem solving, but if you incorrectly present the data in the application, the application will become difficult to maintain, its performance will fall and over time it may become completely unsuitable for use.  In this chapter, we will look at how to design models (data) so that they do not <a href="http://slovari.yandex.ru/undermine/en-ru/">spoil</a> your application. <br><br><h5>  Database Design </h5><br>  The American philosopher Ralph Waldo Emerson once said: ‚ÄúA foolish consistency is the hobgoblin of little minds‚Äù (Stupid following of something is the lot of fools).  People often use this statement in order to protect themselves from attacks and questions from others to the details.  We hope that we will not fall for this bait, although we periodically assert that Core Data is not a database, but treat it as a database (author: something is remembered ‚Äúif something goes like a duck, quacks like duck, it means duck ").  In this section, we will look at how to design the data structure of the application, and drawing a parallel to this process to the process of designing the structure of a relational database will help us a lot, not only with discussion, but also with the final result.  At some points, of course, analogies will not exist, but during the discussion we will try to mark these points. <br><br>  Core Data entities look, act, smell, and taste the same as the tables in relational databases.  Attributes are table fields, relationships are JOINs for primary and foreign keys, and entities themselves are the same records in the tables.  If our data model is ‚Äúsuperimposed‚Äù on the storage type SQLite, then Core Data itself implements everything in exactly the way that we described above and in chapters ‚Ññ2 / ‚Ññ3.  However, you should not forget that your data can be stored in memory, or, for example, in some file (atomic storage), and there are no tables and fields, primary keys and external ones.  Core Data abstracts the data structure from the type of storage used, thereby achieving convenience and versatility in the design and interaction with data.  Allow Core Data to embrace your mind, merge into one with Core Data: either you will feel all the power using Core Data, or you will find yourself at the bottom of the trough using non-optimal data structures. <br><br>  Newbies who are just starting to learn Core Data, creating their first data models, constantly resent that they don‚Äôt have the ability to create and be responsible for the primary keys in their entities, as they used to do in traditional modeling of the database structure.  There are no auto-keying keys in Core Data because they are not needed there.  Core Data takes responsibility for creating a unique key for each object to be added (managed object).  No primary keys imply that there are no foreign keys: Core Data manages the relationships between the entities themselves and performs any necessary joins.  Immediately stop!  Stop feeling uncomfortable because you don‚Äôt need to declare primary and foreign keys! <br><br>  Another place that can drag you down into the quagmire is the modeling of many-to-many relationships.  Imagine for a moment that players in the League Manager application may belong to different teams.  If that were the case, then each team could have a lot of players, and each player could play for different teams.  If you created a traditional relational database, then you would have three tables: one for teams, one for players, and one for tracking which player belongs to which team.  At the same time, in Core Data, the same 2 entities are Player and Team, and the many-to-many relationship is configured by setting the usual tick.  Core Data, however, ‚Äúunder the hood‚Äù still implements this using 3 tables: ZTEAM, ZPLAYER and Z1TEAMS, but these are implementation details.  You do not need to know that there will be a third or fourth table, Core Data will take care of this, it will do it better. <br><br>  <b>Tip</b> : Take care of the data, not the data storage mechanisms. <br><br><h5>  Normalization of the relational database </h5><br>  The theory of designing relational databases combines a data modeling process, called normalization (the normalization process), which aims to reduce or eliminate redundancy, as well as provide efficient access to data in the database. <br>  <abbr title="The normalization process of the sixth form">The normalization process consists of five levels, or forms, and work continues at level 6.</abbr>  Perhaps only mathematicians will like the definitions of the first five forms, only they will most likely understand them.  They look like this: <br><blockquote>  ‚ÄúIf you‚Äôre there, it‚Äôs a MVD in R, say A -&gt; -&gt; B, then you‚Äôll have only dependencies (FDs or MVDs) in X ().  Equivalently: If you are in BCNF and all are in FDs. ‚Äù <br></blockquote><br>  (c) <a href="http://www.databasedesign-resource.com/normal-forms.html">www.databasedesign-resource.com/normal-forms.html</a> <br><br>  We have neither a sufficient number of pages to describe all forms, nor a desire to go through the definitions of all normal forms and explain their essence.  Instead, this section will describe each normal form relative to Core Data and give some design tips.  Remember that following a certain normal form requires following all the normal forms that precede this one. <br><br>  The database that corresponds to the first normal form (1NF) is considered normalized.  To follow this form (level) of normalization, each record in the database must have the same number of fields.  In the context of Core Data, this means that any managed object must have a certain (predetermined) number of attributes.  Given that Core Data does not allow you to create one entity with a different number of attributes, we can conclude that the models in Core Data are automatically normalized. <br><br>  <abbr title="It is a question that the second normal form (2NF) and the third normal form (3NF) can be corrected.">The second normal form (2NF) and the third normal form (3NF) relate to the connections between non-key and key fields, requiring that non-key fields be facts about the key field to which they belong.</abbr>  Since in Core Data you do not care about the keys, this question is removed.  However, you must make sure that all attributes of an entity describe this particular entity, and not something else.  For example, the Player entity should not have the uniformColor attribute, since the color of the form describes the state of the team, rather than the player. <br><br>  The following two normal forms, the fourth normal form (4NF) and the fifth normal form (5NF) can be considered the same forms in the Core Data world.  They are responsible for reducing or eliminating the redundancy of the described data, <abbr title="pushing you to move">pushing you to transfer attributes with multiple values ‚Äã‚Äãinto separate entities and create many-to-many connections between entities.</abbr>  In terms of Core Data, the 4NF form states that an entity should not have attributes that can have multiple values.  Instead, it is worth transferring these attributes to a separate entity and creating a many-to-many relationship between entities.  Consider the example of our application with teams and players from the application LeagueManager.  The data model, which will violate 4 normal form and 5 normal form, will consist of one entity, Team, with an additional attribute - player.  Then we will create new Team instances for each player, with the result that we will have some superfluous (unnecessary) team objects.  Instead, in the data model used in the LeagueManager application, a Player entity is created, which is combined by a many-to-many relationship with the Team entity. <br><br>  In the process of modeling, do not forget about these simple rules.  For example, in the data model in the LeagueManager application, the uniformColor attribute in the Team essence represents an opportunity for normalization.  The names of the colors of the forms is a finite set, which means that it would be possible to create an additional entity called Color, which will have the name attribute and which is connected by a many-to-one relationship with the Team entity. <br><br><h5>  Using Model Designer in Xcode </h5><br>  Some developers simply agree to use the default development tools.  Others create tools only when the current ones seem to be inferior to them.  Others stubbornly insist on creating their own tools.  We fall into the last category of developers who use only the tools that we ourselves have made.  We are proud of the products we create, and sometimes we even celebrate small victories and good luck in saving development time.  We never consider the time spent on developing our tools because this time is included in the category of ‚Äúplaying time‚Äù which is enjoyable.  However, no matter how surprisingly it sounded, it never occurred to us to write our own designer of models for Core Data, probably because XCode is doing a good job with the task.  Perfect integration into the development environment, which we probably can not surpass in their tools.  Everything else, Xcode comes with a built-in graphical data model maker, which makes it much easier to design.  In previous chapters, we have already had to deal with him.  In this section, we will have less time to understand how Core Data works, and we will pay attention to tools that we will often use. <br><br>  No code will be written in this section.  Instead, we will focus on the data modeler's user interface.  To add a data model to our project, select the menu items: File -&gt; New -&gt; New FIle, in the left part of the window select the section ‚ÄúCore Data‚Äù.  You will see three types of files: Data Model, Mapping Model, NSManagedObject subclass.  Mapping models help you in migrating data from one data model to another (for more details, see Chapter 8).  Select the type of Data Model, specify the name of the data model and save it. <br><img src="https://habrastorage.org/getpro/habr/post_images/706/bcd/8ae/706bcd8ae41ad1655e088f7ecacd9a90.png"><br><br>  Opening the newly created model file, Xcode opens it in the visual model editor.  The presence of a large number of buttons and options can confuse you.  The figure below shows the elements that are used in the simulation and their description is given. <br><img src="https://habrastorage.org/getpro/habr/post_images/e4e/cba/3f5/e4ecba3f54013aafa36a4f4de70783db.png"><br><br>  The model editor allows you to easily switch between entities, properties, relationships (relationships), queries, and data model configurations.  It is also possible to switch between options for displaying data models: a graph view, or a tabular view. <br><img src="https://habrastorage.org/getpro/habr/post_images/97b/2bf/c54/97b2bfc546e154bc9e192a90b2f614b8.png"><br><br>  To make it more interesting to discuss the data model, I propose to open the model that we developed in the League Manager application. <br><img src="https://habrastorage.org/getpro/habr/post_images/690/532/4c2/6905324c2e9f1752edba6e64d52722ad.png"><br><br>  As we can see, by default, Xcode displays entities as tables.  If it is more convenient for you to work with a graphical representation of models, then you need to click on the ‚ÄúGraph View‚Äù button located above the ‚ÄúEditor Style‚Äù label in the lower right part of the editor. <br><img src="https://habrastorage.org/getpro/habr/post_images/272/87c/03f/27287c03f300219ef1d8edd88baf91e6.png"><br><br>  The graphical representation should be familiar to the designers and is something standard, describing the entities and the connections between them.  You, probably, have already noticed that the connection from the essence of the Team to the Player with two arrows.  This is because a relationship is a one-to-many relationship.  A team may have several players.  Feedback from Player to Team is a one-to-one relationship and is respectively indicated by one arrow.  A player can belong to only one team. <br>  From the experience of using the visual designer of models, we can confidently say that editing entities and attributes is much more convenient in tabular form, the graphical representation is good for visualizing the connections between them.  However, you may have your own approach. <br>  You can get more information about a property or entity by choosing him / her.  In the figure below, for example, the entity Player is selected.  In the upper right part, you can see details about the Player entity;  her name, her NSManagedObject class, missing parent class, not an abstract class.  By selecting a property, the panel changes its appearance to display the properties of the properties.  If we select the email attribute, the panel will change its form as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/1fc/c4e/d4e/1fcc4ed4e11c7cc284df04fd29ca3a5f.png"><br><br>  + Email attribute is called <br>  + Is optional <br>  + Not temporary or indexable. <br>  + String type <br>  + No minimum and maximum length restrictions. <br>  + No default <br>  + No associated regular expressions <br>  + The field is not indexed by Spotlight. <br>  + The field value will not be stored in an external record. <br><br>  Switching to the team connection entity Player changes the panel as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/0e9/9c7/a97/0e99c7a97b2ecb39d5eb16b053a3519f.png"><br><br>  + Is called the team attribute <br>  + The ultimate (related) entity is the entity Team <br>  + There is feedback and it's called players <br>  + Is optional but not temporary <br>  + Not a one-to-many relationship <br>  + Minimum and maximum number is 1 <br>  + Nullify removal rule is used. <br>  + The field is not indexed by Spotlight. <br>  + The field value will not be stored in an external record. <br><br>  Take a look at the essence of the Player: <br><img src="https://habrastorage.org/getpro/habr/post_images/1c9/520/ede/1c9520edee8489e3264ec32a0880790b.png"><br><br>  Entities are defined by their names.  Core Data allows you to inherit from NSManagedObject in order to provide an alternative implementation of managed objects.  If you create a subclass of the NSManagedObject class and want to associate it with a specific entity, then you will need to specify the name of the new class in the Class field in the Entity section (image above). <br><br><h5>  View and edit attributes </h5><br>  Select any attribute in the "Attributes" section of Xcode so that the right pane changes its view and displays all the information on the selected attribute.  The table below describes the name of the attribute property and its purpose. <br><table><tbody><tr><th align="center">  Name </th><th align="center">  Description </th></tr><tr><td align="center">  Name </td><td align="center">  Attribute Name </td></tr><tr><td align="center">  Transient </td><td align="center">  Tells Core Data not to retain this attribute.  It is useful to use this type of property in conjunction with the second attribute to support non-standard or custom types.  Custom types will be discussed later in this chapter. </td></tr><tr><td align="center">  Optional </td><td align="center">  An optional attribute can be nil.  Non-optional attributes must take any non-nil value. </td></tr><tr><td align="center">  Indexed </td><td align="center">  By indexed attributes search faster, but they take up more space in the repository. </td></tr><tr><td align="center">  Attribute type </td><td align="center">  Attribute type.  Depending on the type selected, certain validation (verification) fields will be displayed. </td></tr><tr><td align="center">  Validation </td><td align="center">  Used to set the minimum and maximum length for the selected String type, or the minimum / maximum value for the selected integer type. </td></tr><tr><td align="center">  Min Length </td><td align="center">  Checkbox to enable verification of the minimum length </td></tr><tr><td align="center">  Max Length </td><td align="center">  Checkbox to enable verification of maximum length </td></tr><tr><td align="center">  Minimum </td><td align="center">  Checkbox to enable minimum value check </td></tr><tr><td align="center">  Maximum </td><td align="center">  Checkbox to enable maximum value check </td></tr><tr><td align="center">  Default value </td><td align="center">  The default value for this attribute is if no value has been specified. </td></tr><tr><td align="center">  Reg.  Ex. </td><td align="center">  Regular expression for data validation </td></tr></tbody></table><br><br><h5>  View and edit links </h5><br>  In the same way as when viewing attribute information, we can view the properties of the link by selecting any link. <br><br>  Links have several properties.  Firstly, they have a name and a final entity (the entity <b>to</b> which the link belongs).  The final entity describes the type of object the link points to.  For the Player entity, the ‚Äúteam‚Äù link is, as expected, pointing to the Team entity.  Core Data architects strongly advise to indicate in every connection its feedback (inverse relashionship) - a relationship that is directed in the opposite direction.  For example, the Player entity has a connection with the Team, so based on the recommendation, as we implemented, the Team should also have a connection with the Player.  In fact, if you forget or don‚Äôt want to give feedback, a warning will be generated by the compiler.  Additional two properties are available for attributes: Transient and Optional.  Transient communication is not stored in the repository during the save operation.  If the team connection was of type Transient, then if you save and then restart the application, you would lose information about which team the player belongs to.  The Player object would still be saved, but there is no connection to the Team object.  Transient communications can be useful when you need to set values ‚Äã‚Äãat run time, for example, a password or something that results from the information received while the application is running.  If the link is Optional, then it simply means that you can set it to nil.  For example, a player may not have a team. <br><br>  The multiplicity of relationships determines the number of targets to which the source object may relate: to-one or to-many.  By default, a relationship is one-to-one, which means that the source object can only refer to one endpoint.  This is just the case in the team example with the Player entity: a player can have no more than one team.  However, a team can have many players, which is why the player connection is essentially a Team to many connection.  These values ‚Äã‚Äã(from the co-many side) are represented as a set (NSSet) of objects.  The multiplicity of a connection can also be determined by changing the minimum and maximum values, which represent the <a href="http://slovari.yandex.ru/cardinality/en-ru/">power of a</a> finite set of entities in a connection. <br><br>  Finally, Core Data uses the rules for removing links in order to know what to do with target objects when deleting the source.  There are many deletion options that Core Data supports.  There are such types of deletions: No action, Nullify, Cascade, Deny.  The ‚ÄúRules of Settings‚Äù section in this chapter discusses the rules of deletion and their meaning. <br><br><h5>  Using Queries as Properties </h5><br>  So far in the book, we have mentioned attributes and links several times already.  The third property that an entity may have: a query (selection).  Requests as properties are comparable to links in that they can refer to other objects.  If the entity property of the type ‚ÄúLink‚Äù refers directly to the target objects, then the ‚ÄúRequests‚Äù (also the entity property) refers to the objects selected by the specified predicate.  Requests as properties are a kind of ‚Äúsmart‚Äù playlist in iTunes, in which the user specifies the music library and then filters the content according to certain criteria.  Although requests as properties do not behave in the same way as sampling in iTunes, they are calculated once at the first request, the results of this selection are cached until we ourselves say we need to refresh by calling the <code>refreshObject:mergeChanges:</code> method. <br><br>  In the League Manager application, we can, for example, create a query property that will return all players from a team whose names begin with a ‚ÄúW‚Äù.  Select the Team entity, click the "+" button in the "Fetched Properties" section and name the new request wPlayers.  Select the Player entity as the final one (the type of the entity that will be requested and returned). <br><br>  In the "Predicate" field, specify the criteria for the filter using the standard NSPredicate format (for more information about the format and NSPredicate, we will talk in Chapter 6).  In this example, the predicate will look like this: <code>lastName BEGINSWITH "W"</code> . <br><br>  After that, the personalized query we have created will become the same attribute of the Player object as the name attribute.  You can use it in the same way as other attributes.  You can ensure that the added request works correctly by adding code to the delegate method of the League Manager <code>application:didFinishLaunchingWithOptions:</code> which will use the <b>wPlayer</b> attribute.  The code shown below requests all teams, takes the first team (if one exists) and selects all players according to the specified predicate in the wPlayer attribute.  After that, all players satisfying the condition are displayed in the console (their names and surnames). <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSFetchedRequest</span></span> *fetchRequest = [[<span class="hljs-built_in"><span class="hljs-built_in">NSFetchedRequest</span></span> alloc] init]; [fetchRequest setEntity:[<span class="hljs-built_in"><span class="hljs-built_in">NSEntityDescription</span></span> entityForName:<span class="hljs-string"><span class="hljs-string">@"Team"</span></span> inManagedObjectContext:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.managedObjectContext]]; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *teams = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.managedObjectContext executeFetchRequest:fetchRequest error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>([teams count] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> *team = [teams objectAtIndex:<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span> *wPlayers = [team valueForKey:<span class="hljs-string"><span class="hljs-string">@"wPlayers"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> *wPlayer <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> wPlayers) { <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"%@ %@"</span></span>, [wPlayer valueForKey:<span class="hljs-string"><span class="hljs-string">@"firstName"</span></span>], [wPlayer valueForKey:<span class="hljs-string"><span class="hljs-string">@"lastName"</span></span>]); } }</code> </pre><br>  If we run this code for execution, depending on what data you already have in the application, we should see something like the following output: <br><pre> <code class="bash hljs">2011-07-31 19:08:23.005 League Manager[8039:f203] Dwyane Wade 2011-07-31 19:08:23.006 League Manager[8039:f203] Tyson Warner</code> </pre><br>  The last important point to consider is creating queries as properties in Xcode.  We can use queries as properties in the same way as we use NSFetchRequests in the application, with the only difference being that the queries as properties are set in advance in the model editor.  To create a new query as a property that will select all teams with a green color of the form, for example, select the Team entity in the Entities section, hold the Add Entity button until a drop-down list appears, select the option from this list "Add Fetch Request".  Let's call this query ‚ÄúGreenTeams‚Äù.  In the middle column in Xcode, you should see the "+" button to add a new filtering criterion.  Click on the "+" button and type in the text box: uniformColor == "Green".  Everything should look something like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/54e/1ad/d5e/54e1add5efd743931b6f83667b8b8374.png"><br><br>  Requests as properties created in this way are stored in the data model and can be obtained using the NSManagedObjectModel class's <code>fetchRequestTemplateForName:</code> method.  Add some code to the <code>application:didFinishLaunchingWithOptions:</code> delegate method to test the functionality of the new request: <br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSFetchRequest</span></span> *fetchRequest = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.managedObjectModel fetchRequestForTemplateName:<span class="hljs-string"><span class="hljs-string">@"GreenTeams"</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *teams = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.managedObjectContext executeFetchRequest:fetchRequest error:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSManagedObject</span></span> *team <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> teams){ <span class="hljs-built_in"><span class="hljs-built_in">NSLog</span></span>(<span class="hljs-string"><span class="hljs-string">@"%@"</span></span>, [team valueForKey:<span class="hljs-string"><span class="hljs-string">@"name"</span></span>]); }</code> </pre><br>  Depending on the data that you have in the application, you should see something like the following output: <br><pre> <code class="bash hljs">2011-07-31 19:17:25.598 League Manager[8184:f203] Boston Celtics</code> </pre><br><br><h5>  Entity creation </h5><br>  So far, we have been actively discussing entities.  Entities describe attributes and relationships that a managed object possesses.  In order to add a new entity, you must click on the "+" button labeled "Add Entity" and specify the name. <br><br>  By default, instances of entity objects are represented by the NSManagedObject type, however, as the size and complexity of the project increases, it may be necessary to create your own classes that will represent managed objects.  The managed objects you create must inherit from the NSManagedObject class, the name of the created class must be specified in the "Class" field when editing the entity. <br><img src="https://habrastorage.org/getpro/habr/post_images/22f/a0c/653/22fa0c653e96db8e277be62fc5a441f4.png"><br><br>  We have not yet touched on one topic at this stage - the inheritance of entities.  The mechanism of inheritance of entities is similar to the mechanism of class inheritance, when created attributes / methods are inherited.  For example, you can create a Person entity, and inherit a Player entity from Person.  If the application had other representations of people, for example, a trainer, then the Coach essence could also be inherited from Person.  If we wanted to prohibit a programmer from directly creating an instance of a Person entity, then it suffices for us to indicate that this entity is abstract.  For example, create a Person entity with a dateOfBirth field and mark it as an abstract entity. <br><img src="https://habrastorage.org/getpro/habr/post_images/07c/086/f2e/07c086f2ef9e296cb1f9c756c07ec09b.png"><br><br>  The next step is to change the Player entity: setting up the parent (inherited) Person entity.  Select the Player entity and in the drop-down list named ‚ÄúParent Entity‚Äù select ‚ÄúPerson‚Äù: <br><img src="https://habrastorage.org/getpro/habr/post_images/f38/3d3/0c2/f383d30c2d1b41f75c666fb87e9cdc15.png"><br><br>  Now the DateOfBirth attribute will be available to the Player entity. <br><img src="https://habrastorage.org/getpro/habr/post_images/ae5/796/38c/ae579638c5cd51ebeb7da42f29f576b5.png"><br><br><h5>  Creating Attributes </h5><br>  Attributes describe the entity.  Entity attributes describe the current state of an entity and can be represented by various types of data.  Select any entity, in the "Attributes" section, click on the "+" (add a new attribute, do not forget to specify the name).  The figure below shows the possible attribute settings: <br><img src="https://habrastorage.org/getpro/habr/post_images/8e8/fe7/f04/8e8fe7f04c9e316e2738b7f14decd386.png"><br><br>  Earlier in this chapter we already talked about the various properties of attributes.  Undoubtedly, the most important attribute property is its type.  By default, Core Data provides several types: <br><img src="https://habrastorage.org/getpro/habr/post_images/364/482/96c/36448296ca1ad998bcec29d3258450c0.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/a27/ffc/52c/a27ffc52cc7255e3fd3de2cb5970e12a.png"><br><br>  Most of the types listed above are directly related to data types in Objective-C.  The only type that falls out of the overall picture is the type Transformable, which is designed for custom (created by the programmer) types.  It is recommended to use the Transformable type in cases where none of the existing types can contain the data you require.  As an example, you can take again our League Manager application, in which you need to store colors that can be represented by the type of CGColorRef.  In this case, the attribute must be Transient and Transformable, and at the same time we will have to provide Core Data the mechanism for converting an attribute to an already existing type.  Use custom (custom) attributes when you create your own class that inherits from NSManagedObject. <br><br><h5>  Making connections </h5><br>  In the normalization process, you will most likely create several entities, depending on the complexity of the data model.  Connections allow you to associate entities with each other, as is done in the League Manager application with Player and Team entities.  Core Data allows you to tune (I repent, I like that word) connections, so that they, in turn, most accurately reflect the relationship between the simulated data. <br><br>  In Xcode, when creating a connection or when choosing one, we see a set of settings that will allow us to change the nature of the connection.  For example, if we select the team connection in the Player entity, we will see something like the following picture: <br><img src="https://habrastorage.org/getpro/habr/post_images/026/6ab/c0d/0266abc0de9a855b9912653c73f7fef8.png"><br><br>  List of fields: <br><ul><li>  Name </li><li>  Ultimate essence </li><li>  Feedback </li><li>  Transient </li><li>  Optional </li><li>  Is the relationship "to-many" </li><li>  Qty (minimum and maximum) </li><li>  Removal rules </li></ul><br><br>  In the following sections, we will look at these fields in more detail how they affect the properties of an entity and what they mean. <br><br><h5>  Name of communication (Name) </h5><br>  The first field, Name, becomes the name of the NSManagedObject attribute of the related object.  Under accepted agreements, the name must be in lower case (lowercase).  If the connection is "to-many", then the name should take the form of pl.  including  It should be understood that all these are only agreements, following which will make your models more understandable, readable and easily supported.  It can be noted that in the League Manager application we follow the agreements, so the link in the essence of the Player is called team.  In essence, the Team connection with players is called "players". <br><br><h5>  Finite and Inverse Entities (Destination and Inverse) </h5><br>  The next field, Destination, defines an entity from the other end of the link.  Inverse field allows you to select the same connection, but only from the side of the final entity. <br><br>  Leaving the Inverse field in the No Inverse Relationship value guarantees that you receive two warnings: a consistency error and an incorrectly configured attribute. <br><br>  You can ignore, after all, these are just compiler warnings, not errors, but you may have unexpected consequences.  Core Data uses two-way communication information to maintain the consistency of the object graph to process the Redo / Undo operation.  Leaving the connection without specifying the Inverse entity, you take responsibility for maintaining the consistency of the object graph to perform Undo / Redo operations.  Apple documentation strongly advises against this, in particular in the case of using the ‚Äúto-many‚Äù relationship.  In case you do not specify an inverse link, the managed object from the <b>other end of the</b> link will not be marked as a modified object if the managed object <b>on this side of the</b> link has changed. <br><br><h5>  Transient </h5><br>  By marking the connection as ‚ÄúTransient‚Äù, you indicate to Core Data that this connection should not be stored in the repository.  Transitional communication still supports Redo / Undo operations, but disappears when the application is closed.  Here are some possible uses for the transition link: <br><ul><li>  Relationships between entities that are temporary and should not exist any longer than the current application launch session </li><li>  Communication information that can be obtained from some external data source, be it another Core Data store or some other source of information. </li></ul><br><br>  In most cases, you will want your connections to be permanent and maintained. <br><br><h5>  Optional </h5><br>  The next field, Optional, is a checkbox that determines whether a relationship can be nil or not.  Consider it to be something like NULL or non-NULL values ‚Äã‚Äãin a database field.  If the checkbox is set, the entity may be saved without specifying a connection.  If you try to save the entity with the checkbox cleared, the saving will end in failure.  If, in essence, Player in the League Manager application leaves the team connection with the checkbox cleared, then each player will have to belong to some team.  Setting the team connection in nil and then saving (calling the save method :) will result in an error with the text "team is a required value". <br><br><h5>  Communication "to many" (To-many) </h5><br>  The option is also a checkbox.  If the checkbox is set, then the current link may indicate a set of objects at that end, but if not, then we get a ‚Äúto-one‚Äù link. <br><br><h5>  Quantity (minimum and maximum) </h5><br>  It determines the number of objects on the side of communication that the current object can have.  The option is valid only if the ‚Äúto-many‚Äù type connection is selected. <br>  Exceeding the limit while saving will give an error ‚ÄúToo many items‚Äù, and an insufficient number - ‚ÄúToo few items‚Äù. <br>  By the way, the minimum value may be greater than the maximum, which is generally acceptable to Core Data, since no checks are performed.  Therefore, if the minimum value is greater than the maximum, any attempt to save the object graph will fail. <br><br><h5>  Delete Rule </h5><br>  Delete rules define the actions that Core Data needs to take when deleting an object with links. <br>  There are 4 types of deletion: <br>  1. Cascade - the source object is deleted, all related (final) objects are also deleted. <br>  2. Deny - if the source object is associated with some objects, the deletion does not occur. <br>  3. Nullify - the source object is deleted, the feedback of all related objects is set to nil. <br>  4. No Action - the source object is deleted, the related objects do not change at all. <br><br>  In the League Manager application, the deletion rule for player communication is Cascade, which means that when a team is deleted, all of its players will also be deleted.  If we changed the deletion rule to Deny, the deletion would not happen if the team had at least one player.  Setting the same deletion rules in Nullify led to the fact that all players would remain in the vault, but with the link to the team set to zero, while the team itself would be deleted. </div><p>Source: <a href="https://habr.com/ru/post/198242/">https://habr.com/ru/post/198242/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198230/index.html">Programming language J. Amateur look. Part 4. Boxes and cycles. Conclusion</a></li>
<li><a href="../198232/index.html">Apogee: Man Orchestra and Online Game Publisher 1987</a></li>
<li><a href="../198234/index.html">The digest of news from the world of mobile development for the last week ‚Ññ29 (October 14‚Äì20, 2013)</a></li>
<li><a href="../198236/index.html">Facebook CSRF closed vulnerability</a></li>
<li><a href="../198238/index.html">Overview of the new features of C ++ 14: Part 2</a></li>
<li><a href="../198244/index.html">Case Popova-Babushkina lives</a></li>
<li><a href="../198246/index.html">‚ÄúMy Tetris are a werewolf‚Äù or nostalgia from childhood</a></li>
<li><a href="../198250/index.html">Self-identification of robots: books, movies, anime</a></li>
<li><a href="../198252/index.html">Localization of Node.js applications Part 3: localization in action</a></li>
<li><a href="../198254/index.html">Only a few will be left.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>