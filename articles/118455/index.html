<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create an application for Windows Phone 7 from start to finish. Part 12. Isolated storage: saving and loading data</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Previous part 

 As already mentioned in the previous section, isolated storage is usually used on the phone for long-term storage. 

 In this part yo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create an application for Windows Phone 7 from start to finish. Part 12. Isolated storage: saving and loading data</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/blogs/windows_mobile/118420/">Previous part</a> <br><br>  As already mentioned in the previous section, isolated storage is usually used on the phone for long-term storage. <br><br>  In this part you will learn: <br><ul><li>  How to save data in isolated storage. </li><li>  How to load data from isolated storage. </li><li>  How to delete data from isolated storage. </li></ul><a name="habracut"></a><h4>  Using isolated storage </h4><br>  Isolated storage is the analogy of a file system on a desktop computer.  However, each application can only access its part of isolated storage and does not have access to data used by any other application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Tip:</b> <br>  Even if you save and retrieve data from outside using web services, you must cache the data on the phone for future use if the network is not available, and in this case you will need to use isolated storage for this purpose. <br><br>  Isolated storage is slower than in-memory dictionaries, so you should only use it for data that potentially requires long-term storage and for non-serializable objects that are not supported by state dictionaries.  Most classes are serializable by default, but some are not and, accordingly, require special handling, as will be described below.  For example, a non-serializable is an ImageSource object, which is a binary image file, such as a JPG. <br><br>  You should carefully consider where your code is located to work with isolated storage in order to minimize the impact of any delays.  For example, if your application has a lot of data to store, you should avoid saving it at the same time when you exit the application, and instead save it gradually.  In general, you should save data to isolated storage as soon as it becomes available or as far in advance as possible. <br><br>  <b>Tip:</b> <br>  Unlike the desktop version of Silverlight, there is no limit on the phone‚Äôs amount of isolated storage space that an application can use.  However, phones have a significantly smaller total amount of storage space compared to desktop computers, so you should use as little space as possible. <br><br>  Isolated storage provides two forms of access: <br><ul><li>  A state dictionary that you can use to store key / value pairs, where values ‚Äã‚Äãcan be primitive types or serializable objects. </li><li>  A virtual file system interface that can be used to save, load, and delete application files. </li></ul>  Isolated repository state dictionary is easy to use.  You simply access it through the static property IsolatedStorageSettings.ApplicationSettings, and then add, delete, or change values, as you would with a regular dictionary.  The dictionary automatically performs the work of loading and storing values ‚Äã‚Äãto isolated storage at a suitable time, although you can also override this behavior. <br><br>  To use isolated storage to save and load files, use the IsolatedStorageFile class, which is a virtual file system interface.  You can access the repository by calling the GetUserStoreForApplication method.  Once you have accessed the repository, you can call methods to open, create, and delete files and folders. <br><br><h4>  Saving data in isolated storage </h4><br>  In order to save the object being serialized to isolated storage using a dictionary, you simply assign the IsolatedStorageSettings.ApplicationSettings object and specify the key.  Then you call the IsolatedStorageSettings.Save method.  Calling Save is not required, because the application will automatically save all stored values ‚Äã‚Äãwhen exiting the application. <br><br>  The following code snippet shows how to save the <b>Car</b> object (without taking into account its non-serializable <b>Picture</b> property) in the dictionary.  The <b>CarDataStore.SaveCar</b> method assigns the value of the <b>Car</b> property directly to the <b>IsolatedStorageSettings.ApplicationSettings</b> dictionary using the <b>CAR_KEY</b> constant.  The value will be written to the isolated storage when the IsolatedStorageSettings.Save method is called in the next line. <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } }</font> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> <ol><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { try { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> <li> <code><font color="black"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } } <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></font></code> </li> </ol> <code><font color="gray"><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_FILE_NAME = <font color="#A31515">"CarPhoto.jpg"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_KEY = <font color="#A31515">"FuelTracker.Car"</font> ; <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">readonly</font> IsolatedStorageSettings appSettings = IsolatedStorageSettings.ApplicationSettings; <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCar(Action errorCallback) { <font color="#0000ff">try</font> { appSettings[CAR_KEY] = Car; appSettings.Save(); SaveCarPhoto(CAR_PHOTO_FILE_NAME, Car.Picture, errorCallback); DeleteTempCarPhoto(); } <font color="#0000ff">catch</font> (IsolatedStorageException) { errorCallback(); } }</font> * This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  It is possible that there is no available space in the isolated storage.  In this case, a call to the Save method will throw an exception.  It is important to handle the exception, but it does not make sense to do it at the data access level (in the data access layer).  Instead, a warning is usually displayed for the user.  For this reason, the <b>SaveCar</b> method <b>is</b> accepted by the Action delegate, which is called when an exception occurs.  This allows the calling code to handle errors in its own way, without the need for its own Try / Catch block or any dependency on a specific type of exception.  This method will be described in more detail in the ‚ÄúValidation of Input Data‚Äù section. <br><br>  <b>Certification Requirement:</b> <br>  Your application should handle all exceptions and not terminate unexpectedly. <br><br>  The <b>Car.Picture</b> property is a car image and is an object of type BitmapImage.  Since the BitmapImage type is not serializable, the <b>Car.Picture</b> property cannot be stored in the IsolatedStorageSettings.ApplicationSettings dictionary, so the image will be considered separately.  However, you must explicitly exclude the <b>Picture</b> property from serialization or a call to the Save method will always throw an exception.  To exclude a property from serialization, you must apply IgnoreDataMemberAttribute to it, as shown in the following example from Car.cs. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  [System.Runtime.Serialization.IgnoreDataMemberAttribute] </li><li>  <font color="#0000ff">public</font> BitmapImage Picture </li><li>  { </li><li>  <font color="#0000ff">get</font> { <font color="#0000ff">return</font> _picture;  } </li><li>  <font color="#0000ff">set</font> </li><li>  { </li><li>  _picture = <font color="#0000ff">value</font> ; </li><li>  NotifyPropertyChanged ( <font color="#A31515">"Picture"</font> ); </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  To save the file to isolated storage, use the IsolatedStorageFile.CreateFile or IsolatedStorageFile.OpenFile methods.  There are also methods in IsolatedStorageFile to check if the file exists and to create directories. <br><br>  Since the <b>Car.Picture</b> property <b>is</b> not serializable, it is saved as a file in isolated storage.  It would be great if you could just refer to the selected photo by reference in the media library so that you do not need to save it separately in an isolated storage.  However, at the time of writing this article it was not possible.  Additional information will be presented in the section ‚ÄúAccessing photos on Windows Phone‚Äù. <br><br>  The following code shows the <b>SaveCarPhoto</b> method, which saves the image of the car as a file in a directory in isolated storage.  The OpenFile method is used to create a new file.  Note the use of the Extensions.SaveJpeg method.  This helper method simplifies the conversion of BitmapImage to Stream. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">const</font> <font color="#0000ff">string</font> CAR_PHOTO_DIR_NAME = <font color="#A31515">"FuelTracker"</font> ; </li><li></li><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> SaveCarPhoto ( <font color="#0000ff">string</font> fileName, BitmapImage carPicture, </li><li>  Action errorCallback) </li><li>  { </li><li>  <font color="#0000ff">if</font> (carPicture == <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> ; </li><li>  <font color="#0000ff">try</font> </li><li>  { </li><li>  <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> store = IsolatedStorageFile.GetUserStoreForApplication ()) </li><li>  { </li><li>  <font color="#0000ff">var</font> bitmap = <font color="#0000ff">new</font> WriteableBitmap (carPicture); </li><li>  <font color="#0000ff">var</font> path = Path.Combine (CAR_PHOTO_DIR_NAME, fileName); </li><li></li><li>  <font color="#0000ff">if</font> (! store.DirectoryExists (CAR_PHOTO_DIR_NAME)) </li><li>  { </li><li>  store.CreateDirectory (CAR_PHOTO_DIR_NAME); </li><li>  } </li><li></li><li>  <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> stream = store.OpenFile (path, <font color="#2B91AF">FileMode</font> .Create)) </li><li>  { </li><li>  Extensions.SaveJpeg (bitmap, stream, </li><li>  bitmap.PixelWidth, bitmap.PixelHeight, 0, 100); </li><li>  } </li><li>  } </li><li>  } </li><li>  <font color="#0000ff">catch</font> (IsolatedStorageException) </li><li>  { </li><li>  errorCallback (); </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  The following image shows how a <b>Car</b> object is stored in isolated storage. <br><br><img src="http://i.msdn.microsoft.com/dynimg/IC484193.png" alt="image"><br><br><h4>  Reading data from isolated storage </h4><br>  To read an object from a dictionary in isolated storage, you simply specify the key of the object you want.  The following code demonstrates how to retrieve values ‚Äã‚Äãfrom a dictionary in isolated storage.  This is the code for the <b>CarDataStore.Car</b> property from the "Using Access to Class Data" section, but this time it includes details regarding data storage. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> Car car; </li><li></li><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> Car Car </li><li>  { </li><li>  <font color="#0000ff">get</font> </li><li>  { </li><li>  <font color="#0000ff">if</font> (car == <font color="#0000ff">null</font> ) </li><li>  { </li><li>  <font color="#0000ff">if</font> (appSettings.Contains (CAR_KEY)) </li><li>  { </li><li>  car = (Car) appSettings [CAR_KEY]; </li><li>  car.Picture = GetCarPhoto (CAR_PHOTO_FILE_NAME); </li><li>  } </li><li>  <font color="#0000ff">else</font> </li><li>  { </li><li>  car = <font color="#0000ff">new</font> car () </li><li>  { </li><li>  FillupHistory = <font color="#0000ff">new</font> ObservableCollection &lt;Fillup&gt; () </li><li>  }; </li><li>  } </li><li>  } </li><li>  <font color="#0000ff">return</font> car; </li><li>  } </li><li>  <font color="#0000ff">set</font> {car = <font color="#0000ff">value</font> ;  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  In this code, if the <b>Car</b> property does not yet have a value, it is checked whether the dictionary contains a value for the key specified by the <b>CAR_KEY</b> constant.  (Using a constant allows you to select a value using IntelliSense, which avoids the possibility of a typo.) If there is no existing value, a new instance of the <b>Car</b> object and its <b>FillupHistory</b> property are <b>initialized</b> .  Otherwise, <b>Car</b> is taken from the dictionary.  However, it should be noted that the property <b>Car.Picture</b> is of type BitmapImage, which is not serializable.  Since the IsolatedStorageSettings dictionary only supports serializable values, the <b>Picture</b> property must be processed separately. <br><br>  To read files from isolated storage, use the IsolatedStorageFile.OpenFile method.  The following code shows the <b>GetCarPhoto</b> method in the Fuel Tracker application, <b>retrieving an</b> image from isolated storage. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">private</font> <font color="#0000ff">static</font> BitmapImage GetCarPhoto ( <font color="#0000ff">string</font> fileName) </li><li>  { </li><li>  <font color="#0000ff">using</font> (IsolatedStorageFile store = </li><li>  IsolatedStorageFile.GetUserStoreForApplication ()) </li><li>  { </li><li>  <font color="#0000ff">string</font> path = Path.Combine (CAR_PHOTO_DIR_NAME, fileName); </li><li></li><li>  <font color="#0000ff">if</font> (! store.FileExists (path)) <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; </li><li></li><li>  IsolatedStorageFileStream stream = </li><li>  store.OpenFile (path, <font color="#2B91AF">FileMode</font> .Open); </li><li></li><li>  <font color="#0000ff">try</font> </li><li>  { </li><li>  <font color="#0000ff">var</font> image = <font color="#0000ff">new</font> BitmapImage (); </li><li>  image.SetSource (stream); </li><li>  <font color="#0000ff">return</font> image; </li><li>  } </li><li>  <font color="#0000ff">finally</font> </li><li>  { </li><li>  stream.Dispose (); </li><li>  } </li><li>  } </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br><h4>  Remove data from isolated storage </h4><br>  To remove values ‚Äã‚Äãfrom the state dictionary, call the IsolatedStorageSettings.Remove method and specify the key.  Then call the IsolatedStorageSettings.Save method to apply the changes.  To remove a file from isolated storage, call the IsolatedStorageFile.DeleteFile method. <br><br>  The following <b>CarDataStore.DeleteCar</b> method demonstrates how to delete a value from the state dictionary and delete the file. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a></code> <ol><li>  <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> DeleteCar () </li><li>  { </li><li>  Car = <font color="#0000ff">null</font> ; </li><li>  appSettings.Remove (CAR_KEY); </li><li>  appSettings.Save (); </li><li>  DeleteCarPhoto (); </li><li>  DeleteTempCarPhoto (); </li><li>  } </li></ol>  <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font> </blockquote><br>  The <b>CarDataStore.DeleteCar</b> method first sets the <b>Car</b> property to null so that it can be reinitialized if it is accessed in the future.  Then the <b>CAR_KEY</b> entry is removed from the ApplicationSettings dictionary, and the Save method is called to apply the changes.  Finally, this method removes photographs of the car from isolated storage. <br><br>  <b>Interface Design Recommendation:</b> <br>  Application actions that overwrite or delete data or cannot be reversible should have a Cancel button. <br><br>  <a href="http://habrahabr.ru/blogs/windows_mobile/118459/">Next part</a> </div><p>Source: <a href="https://habr.com/ru/post/118455/">https://habr.com/ru/post/118455/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../11845/index.html">The European Commission is interested in the war of DVD-formats</a></li>
<li><a href="../118450/index.html">Synchronization features in Android application</a></li>
<li><a href="../118451/index.html">A souvenir souvenir with their own hands</a></li>
<li><a href="../118452/index.html">"I repaired" Gateway MT6840</a></li>
<li><a href="../118454/index.html">Lost audio encoding. What is what?</a></li>
<li><a href="../118456/index.html">Do you use CRM in your web studio for project management?</a></li>
<li><a href="../118457/index.html">Visually about popular Open Source licenses</a></li>
<li><a href="../118458/index.html">NTRUEncrypt: the fastest asymmetric cipher</a></li>
<li><a href="../118459/index.html">Create an application for Windows Phone 7 from start to finish. Part 13. Application recovery after decontamination</a></li>
<li><a href="../11846/index.html">Moonshine. Methods and recipes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>