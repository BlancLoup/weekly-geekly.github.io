<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Clean php code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="These are the principles of software development, taken from the book Clean Code by Robert Martin and adapted for PHP. This guide is not about program...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Clean php code</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/web/75e/9a1/4cd/75e9a14cd96b437d95087e221a7ed330.jpg"></p><br><p>  These are the principles of software development, taken from the book <em>Clean Code by</em> Robert Martin and adapted for PHP.  This guide is not about programming styles, but about creating readable, reusable, and refactoring PHP code. </p><br><p>  Not each of these principles must be strictly observed, and with even fewer, everyone will agree.  These are only recommendations, no more, but they are all codified in the <em>Clean Code</em> author's many years of collective experience. </p><br><p>  The article is inspired by <a href="https://github.com/ryanmcdermott/clean-code-javascript">clean-code-javascript</a> . </p><a name="habracut"></a><br><h2 id="soderzhanie">  Content </h2><br><ol><li>  Variables </li><li>  Functions </li><li>  Objects and data structures </li><li>  Classes <br><ul><li>  S: Single Responsibility Principle (SRP) </li><li>  O: Open / Closed Principle (OCP) </li><li>  L: The Substitution Principle of Barbara Liskov (LSP) </li><li>  I: Interface Segregation Principle (ISP) </li><li>  D: Dependency Inversion Principle (DIP) </li></ul></li></ol><br><h2 id="peremennye">  Variables </h2><br><h3 id="ispolzuyte-znachimye-i-proiznosimye-imena-peremennyh">  Use meaningful and pronounced variable names. </h3><br><p>  <strong>Poorly:</strong> </p><br><pre><code class="php">$ymdstr = $moment-&gt;format('y-m-d');</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$currentDate = $moment-&gt;format('y-m-d');</code></pre><br>
<h3 id="dlya-odnogo-tipa-peremennyh-ispolzuyte-edinyy-slovar">      </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">getUserInfo();
getClientData();
getCustomerRecord();</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">getUser();</code></pre><br>
<h3 id="ispolzuyte-imena-po-kotorym-udobno-iskat"> ,    </h3><br>
<p>   ,  - .     ,       .    ,     ,    .   ,    . </p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">// What the heck is 86400 for?
addExpireAt(86400);</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">// Declare them as capitalized `const` globals.
interface DateGlobal {
    const SECONDS_IN_A_DAY = 86400;
}

addExpireAt(DateGlobal::SECONDS_IN_A_DAY);</code></pre><br>
<h3 id="ispolzuyte-poyasnitelnye-peremennye">  </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$address = 'One Infinite Loop, Cupertino 95014';
$cityZipCodeRegex = '/^[^,\\]+[,\\\s]+(.+?)\s*(\d{5})?$/';
preg_match($cityZipCodeRegex, $address, $matches);

saveCityZipCode($matches[1], $matches[2]);</code></pre><br>
<p><strong>:</strong></p><br>
<p> ,         .</p><br>
<pre><code class="php">$address = 'One Infinite Loop, Cupertino 95014';
$cityZipCodeRegex = '/^[^,\\]+[,\\\s]+(.+?)\s*(\d{5})?$/';
preg_match($cityZipCodeRegex, $address, $matches);

list(, $city, $zipCode) = $matches;
saveCityZipCode($city, $zipCode);</code></pre><br>
<p><strong>:</strong></p><br>
<p>        .</p><br>
<pre><code class="php">$address = 'One Infinite Loop, Cupertino 95014';
$cityZipCodeRegex = '/^[^,\\]+[,\\\s]+(?&lt;city&gt;.+?)\s*(?&lt;zipCode&gt;\d{5})?$/';
preg_match($cityZipCodeRegex, $address, $matches);

saveCityZipCode($matches['city'], $matches['zipCode']);</code></pre><br>
<h3 id="izbegayte-mentalnogo-sopostavleniya">  </h3><br>
<p>  ,     ,   .   ,  .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$l = ['Austin', 'New York', 'San Francisco'];

for ($i = 0; $i &lt; count($l); $i++) {
    $li = $l[$i];
    doStuff();
    doSomeOtherStuff();
    // ...
    // ...
    // ...
    // Wait, what is `$li` for again?
    dispatch($li);
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$locations = ['Austin', 'New York', 'San Francisco'];

foreach ($locations as $location) {
    doStuff();
    doSomeOtherStuff();
    // ...
    // ...
    // ...
    dispatch($location);
});</code></pre><br>
<h3 id="ne-dobavlyayte-nenuzhnyy-kontekst">   </h3><br>
<p>   /  -   ,       .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$car = [
    'carMake'  =&gt; 'Honda',
    'carModel' =&gt; 'Accord',
    'carColor' =&gt; 'Blue',
];

function paintCar(&amp;$car) {
    $car['carColor'] = 'Red';
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$car = [
    'make'  =&gt; 'Honda',
    'model' =&gt; 'Accord',
    'color' =&gt; 'Blue',
];

function paintCar(&amp;$car) {
    $car['color'] = 'Red';
}</code></pre><br>
<h3 id="vmesto-sokraschyonnyh-ili-uslovnyh-ispolzuyte-argumenty-po-umolchaniyu">       </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function createMicrobrewery($name = null) {
    $breweryName = $name ?: 'Hipster Brew Co.';
    // ...
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function createMicrobrewery($breweryName = 'Hipster Brew Co.') {
    // ...
}</code></pre><br>
<h2 id="funkcii"></h2><br>
<h3 id="argumenty-funkciy-v-ideale-dva-ili-menshe">  (    )</h3><br>
<p>     ,     .      ¬´ ¬ª,           .</p><br>
<p>  ‚Äî   . -  ,    .    ,   ,   .       ,     .   ,    ,          .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function createMenu($title, $body, $buttonText, $cancellable) {
    // ...
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class MenuConfig
{
    public $title;
    public $body;
    public $buttonText;
    public $cancelLabel = false;
}

$config = new MenuConfig();
$config-&gt;title = 'Foo';
$config-&gt;body = 'Bar';
$config-&gt;buttonText = 'Baz';
$config-&gt;cancelLabel = true;

function createMenu(MenuConfig $config) {
    // ...
}</code></pre><br>
<h3 id="funkcii-dolzhny-delat-chto-to-odno">   - </h3><br>
<p>, ,      .      ,   ,   .        -  ,     ,      .         ,  ,       .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function emailClients($clients) {
    foreach ($clients as $client) {
        $clientRecord = $db-&gt;find($client);
        if ($clientRecord-&gt;isActive()) {
            email($client);
        }
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function emailClients($clients) {
    $activeClients = activeClients($clients);
    array_walk($activeClients, 'email');
}

function activeClients($clients) {
    return array_filter($clients, 'isClientActive');
}

function isClientActive($client) {
    $clientRecord = $db-&gt;find($client);
    return $clientRecord-&gt;isActive();
}</code></pre><br>
<h3 id="imena-funkciy-dolzhny-byt-govoryaschimi">    </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function addToDate($date, $month) {
    // ...
}

$date = new \DateTime();

// It's hard to tell from the function name what is added
addToDate($date, 1);</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function addMonthToDate($month, $date) {
    // ...
}

$date = new \DateTime();
addMonthToDate(1, $date);</code></pre><br>
<h3 id="funkcii-dolzhny-byt-lish-odnim-urovnem-abstrakcii">      </h3><br>
<p>     ,       .         .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function parseBetterJSAlternative($code) {
    $regexes = [
        // ...
    ];

    $statements = split(' ', $code);
    $tokens = [];
    foreach($regexes as $regex) {
        foreach($statements as $statement) {
            // ...
        }
    }

    $ast = [];
    foreach($tokens as $token) {
        // lex...
    }

    foreach($ast as $node) {
        // parse...
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function tokenize($code) {
    $regexes = [
        // ...
    ];

    $statements = split(' ', $code);
    $tokens = [];
    foreach($regexes as $regex) {
        foreach($statements as $statement) {
            $tokens[] = /* ... */;
        });
    });

    return $tokens;
}

function lexer($tokens) {
    $ast = [];
    foreach($tokens as $token) {
        $ast[] = /* ... */;
    });

    return $ast;
}

function parseBetterJSAlternative($code) {
    $tokens = tokenize($code);
    $ast = lexer($tokens);
    foreach($ast as $node) {
        // parse...
    });
}</code></pre><br>
<h3 id="uberite-dubliruyuschiy-kod">  </h3><br>
<p>     .   ,      ,       .</p><br>
<p>,      ,   : , , ,   . .        ,      ,    - .    ,        .</p><br>
<p>    ,       ,    .          ,          .    ,    ,         //.</p><br>
<p>    ,     SOLID,    ¬´¬ª.       ,    !     ,   !  ,  ,           .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function showDeveloperList($developers) {
    foreach($developers as $developer) {
        $expectedSalary = $developer-&gt;calculateExpectedSalary();
        $experience = $developer-&gt;getExperience();
        $githubLink = $developer-&gt;getGithubLink();
        $data = [
            $expectedSalary,
            $experience,
            $githubLink
        ];

        render($data);
    }
}

function showManagerList($managers) {
    foreach($managers as $manager) {
        $expectedSalary = $manager-&gt;calculateExpectedSalary();
        $experience = $manager-&gt;getExperience();
        $githubLink = $manager-&gt;getGithubLink();
        $data = [
            $expectedSalary,
            $experience,
            $githubLink
        ];

        render($data);
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function showList($employees) {
    foreach($employees as $employe) {
        $expectedSalary = $employe-&gt;calculateExpectedSalary();
        $experience = $employe-&gt;getExperience();
        $githubLink = $employe-&gt;getGithubLink();
        $data = [
            $expectedSalary,
            $experience,
            $githubLink
        ];

        render($data);
    }
}</code></pre><br>
<h3 id="ne-ispolzuyte-flagi-v-kachestve-parametrov-funkciy">      </h3><br>
<p>   ,      .     - .   ,            .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function createFile($name, $temp = false) {
    if ($temp) {
        touch('./temp/'.$name);
    } else {
        touch($name);
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function createFile($name) {
    touch($name);
}

function createTempFile($name) {
    touch('./temp/'.$name);
}</code></pre><br>
<h3 id="izbegayte-pobochnyh-effektov">  </h3><br>
<p>    ,          /,    - .       ,           .</p><br>
<p>     . ,     .    .      ,    -  ,     . .</p><br>
<p>  ‚Äî           - ;    ,    - ;     .     ,       .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">// Global variable referenced by following function.
// If we had another function that used this name, now it'd be an array and it could break it.
$name = 'Ryan McDermott';

function splitIntoFirstAndLastName() {
    global $name;
    $name = preg_split('/ /', $name);
}

splitIntoFirstAndLastName();

var_dump($name); // ['Ryan', 'McDermott'];</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">$name = 'Ryan McDermott';

function splitIntoFirstAndLastName($name) {
    return preg_split('/ /', $name);
}

$newName = splitIntoFirstAndLastName($name);

var_dump($name); // 'Ryan McDermott';
var_dump($newName); // ['Ryan', 'McDermott'];</code></pre><br>
<h3 id="ne-pishite-v-globalnye-funkcii">    </h3><br>
<p>  ‚Äî     ,        ,    API     ,      production.  :    .      <code>config()</code>,       ,     .      ¬´¬ª   .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function config() {
    return  [
        'foo' =&gt; 'bar',
    ]
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Configuration {
    private static $instance;
    private function __construct() {/* */}
    public static function getInstance() {
        if (self::$instance === null) {
            self::$instance = new Configuration();
        }
        return self::$instance;
    }
    public function get($key) {/* */}
    public function getAll() {/* */}
}

$singleton = Configuration::getInstance();</code></pre><br>
<h3 id="inkapsulirovanie-uslovnyh-vyrazheniy">  </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">if ($fsm-&gt;state === 'fetching' &amp;&amp; is_empty($listNode)) {
    // ...
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function shouldShowSpinner($fsm, $listNode) {
    return $fsm-&gt;state === 'fetching' &amp;&amp; is_empty($listNode);
}

if (shouldShowSpinner($fsmInstance, $listNodeInstance)) {
  // ...
}</code></pre><br>
<h3 id="izbegayte-negativnyh-uslovnyh-vyrazheniy">   </h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function isDOMNodeNotPresent($node) {
    // ...
}

if (!isDOMNodeNotPresent($node)) {
    // ...
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function isDOMNodePresent($node) {
    // ...
}

if (isDOMNodePresent($node)) {
    // ...
}</code></pre><br>
<h3 id="izbegayte-uslovnyh-vyrazheniy">  </h3><br>
<p>,   .   ,  : ¬´   -    <code>if</code>?¬ª   : ¬´,  ,    ?¬ª        :    - .       ,   <code>if</code>,       ,      .   ‚Äî   - .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Airplane {
    // ...
    public function getCruisingAltitude() {
        switch ($this-&gt;type) {
            case '777':
                return $this-&gt;getMaxAltitude() - $this-&gt;getPassengerCount();
            case 'Air Force One':
                return $this-&gt;getMaxAltitude();
            case 'Cessna':
                return $this-&gt;getMaxAltitude() - $this-&gt;getFuelExpenditure();
        }
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Airplane {
    // ...
}

class Boeing777 extends Airplane {
    // ...
    public function getCruisingAltitude() {
        return $this-&gt;getMaxAltitude() - $this-&gt;getPassengerCount();
    }
}

class AirForceOne extends Airplane {
    // ...
    public function getCruisingAltitude() {
        return $this-&gt;getMaxAltitude();
    }
}

class Cessna extends Airplane {
    // ...
    public function getCruisingAltitude() {
        return $this-&gt;getMaxAltitude() - $this-&gt;getFuelExpenditure();
    }
}</code></pre><br>
<h3 id="izbegayte-proverki-tipov-chast-1">   ( 1)</h3><br>
<p>PHP  , . .       .             .      . ,   ,   API.</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function travelToTexas($vehicle) {
    if ($vehicle instanceof Bicycle) {
        $vehicle-&gt;peddle($this-&gt;currentLocation, new Location('texas'));
    } else if ($vehicle instanceof Car) {
        $vehicle-&gt;drive($this-&gt;currentLocation, new Location('texas'));
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function travelToTexas($vehicle) {
  $vehicle-&gt;move($this-&gt;currentLocation, new Location('texas'));
}</code></pre><br>
<h3 id="izbegayte-proverki-tipov-chast-2">   ( 2)</h3><br>
<p>      ( , )  ,     .   ,       ,        (strict mode).        PHP-.      ,       ,    ¬´¬ª     .    PHP,        .    ,     PHP-    . </p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function combine($val1, $val2) {
    if (is_numeric($val1) &amp;&amp; is_numeric($val2)) {
        return $val1 + $val2;
    }

    throw new \Exception('Must be of type Number');
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code>function combine(int $val1, int $val2) {
    return $val1 + $val2;
}</code></pre><br>
<h3 id="ubirayte-myortvyy-kod">  </h3><br>
<p>   ,    .       .  -  ,   !  ,        .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function oldRequestModule($url) {
    // ...
}

function newRequestModule($url) {
    // ...
}

$req = new newRequestModule($requestUrl);
inventoryTracker('apples', $req, 'www.inventory-awesome.io');</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">function requestModule($url) {
    // ...
}

$req = new requestModule($requestUrl);
inventoryTracker('apples', $req, 'www.inventory-awesome.io');</code></pre><br>
<h2 id="obekty-i-struktury-dannyh">   </h2><br>
<h3 id="ispolzuyte-gettery-i-settery">   </h3><br>
<p> PHP       <code>public</code>, <code>protected</code>  <code>private</code>.         .</p><br>
<ul>
<li>       ,         (accessor)   . </li>
<li> <code>set</code>   . </li>
<li>   . </li>
<li>          . </li>
<li>         . </li>
<li>     ,     . </li>
</ul><br>
<p>    /,       .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class BankAccount {
    public $balance = 1000;
}

$bankAccount = new BankAccount();

// Buy shoes...
$bankAccount-&gt;balance -= 100;</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class BankAccount {
    private $balance;

    public function __construct($balance = 1000) {
      $this-&gt;balance = $balance;
    }

    public function withdrawBalance($amount) {
        if ($amount &gt; $this-&gt;balance) {
            throw new \Exception('Amount greater than available balance.');
        }
        $this-&gt;balance -= $amount;
    }

    public function depositBalance($amount) {
        $this-&gt;balance += $amount;
    }

    public function getBalance() {
        return $this-&gt;balance;
    }
}

$bankAccount = new BankAccount();

// Buy shoes...
$bankAccount-&gt;withdrawBalance($shoesPrice);

// Get balance
$balance = $bankAccount-&gt;getBalance();</code></pre><br>
<h3 id="u-obektov-dolzhny-byt-lichnyezaschischyonnye-komponenty-members">    /  (members)</h3><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Employee {
    public $name;

    public function __construct($name) {
        $this-&gt;name = $name;
    }
}

$employee = new Employee('John Doe');
echo 'Employee name: '.$employee-&gt;name; // Employee name: John Doe</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Employee {
    protected $name;

    public function __construct($name) {
        $this-&gt;name = $name;
    }

    public function getName() {
        return $this-&gt;name;
    }
}

$employee = new Employee('John Doe');
echo 'Employee name: '.$employee-&gt;getName(); // Employee name: John Doe</code></pre><br>
<h2 id="klassy"></h2><br>
<h3 id="princip-edinstvennoy-otvetstvennosti-single-responsibility-principle-srp">   (Single Responsibility Principle, SRP)</h3><br>
<p>    Clean Code: ¬´         ¬ª.      ,        ,         .   ,        (conceptually cohesive),       .    ,     .   ,            ,     ,         .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class UserSettings {
    private $user;
    public function __construct($user) {
        $this-&gt;user = user;
    }

    public function changeSettings($settings) {
        if ($this-&gt;verifyCredentials()) {
            // ...
        }
    }

    private function verifyCredentials() {
        // ...
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class UserAuth {
    private $user;
    public function __construct($user) {
        $this-&gt;user = user;
    }

    protected function verifyCredentials() {
        // ...
    }
}

class UserSettings {
    private $user;
    public function __construct($user) {
        $this-&gt;user = $user;
        $this-&gt;auth = new UserAuth($user);
    }

    public function changeSettings($settings) {
        if ($this-&gt;auth-&gt;verifyCredentials()) {
            // ...
        }
    }
}</code></pre><br>
<h3 id="princip-otkrytostizakrytosti-openclosed-principle-ocp"> / (Open/Closed Principle, OCP)</h3><br>
<p>   : ¬´  (, ,   . .)     ,    ¬ª.   ?        .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">abstract class Adapter {
    protected $name;
    public function getName() {
        return $this-&gt;name;
    }
}

class AjaxAdapter extends Adapter {
    public function __construct() {
    parent::__construct();
        $this-&gt;name = 'ajaxAdapter';
    }
}

class NodeAdapter extends Adapter {
    public function __construct() {
        parent::__construct();
        $this-&gt;name = 'nodeAdapter';
    }
}

class HttpRequester {
    private $adapter;
    public function __construct($adapter) {
        $this-&gt;adapter = $adapter;
    }

    public function fetch($url) {
        $adapterName = $this-&gt;adapter-&gt;getName();
        if ($adapterName === 'ajaxAdapter') {
            return $this-&gt;makeAjaxCall($url);
        } else if ($adapterName === 'httpNodeAdapter') {
            return $this-&gt;makeHttpCall($url);
        }
    }

    protected function makeAjaxCall($url) {
        // request and return promise
    }

    protected function makeHttpCall($url) {
        // request and return promise
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">abstract class Adapter {
    abstract protected function getName();
    abstract public function request($url);
}

class AjaxAdapter extends Adapter {
    protected function getName() {
        return 'ajaxAdapter';
    }

    public function request($url) {
        // request and return promise
    }
}

class NodeAdapter extends Adapter {
    protected function getName() {
        return 'nodeAdapter';
    }

    public function request($url) {
        // request and return promise
    }
}

class HttpRequester {
    private $adapter;
    public function __construct(Adapter $adapter) {
        $this-&gt;adapter = $adapter;
    }

    public function fetch($url) {
        return $this-&gt;adapter-&gt;request($url);
    }
}</code></pre><br>
<h3 id="princip-podstanovki-barbary-liskov-liskov-substitution-principle-lsp">    (Liskov Substitution Principle, LSP)</h3><br>
<p>       .  : ¬´ S ‚Äî   ,          S (,         S)   -   (,   . .)¬ª.    . </p><br>
<p>  :        ,         .       .      ‚Äî  ,      is-a  ,     .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Rectangle {
    private $width, $height;

    public function __construct() {
        $this-&gt;width = 0;
        $this-&gt;height = 0;
    }

    public function setColor($color) {
        // ...
    }

    public function render($area) {
        // ...
    }

    public function setWidth($width) {
        $this-&gt;width = $width;
    }

    public function setHeight($height) {
        $this-&gt;height = $height;
    }

    public function getArea() {
        return $this-&gt;width * $this-&gt;height;
    }
}

class Square extends Rectangle {
    public function setWidth($width) {
        $this-&gt;width = $this-&gt;height = $width;
    }

    public function setHeight(height) {
        $this-&gt;width = $this-&gt;height = $height;
    }
}

function renderLargeRectangles($rectangles) {
    foreach($rectangle in $rectangles) {
        $rectangle-&gt;setWidth(4);
        $rectangle-&gt;setHeight(5);
        $area = $rectangle-&gt;getArea(); // : Will return 25 for Square. Should be 20.
        $rectangle-&gt;render($area);
    });
}

$rectangles = [new Rectangle(), new Rectangle(), new Square()];
renderLargeRectangles($rectangles);</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">abstract class Shape {
    private $width, $height;

    abstract public function getArea();

    public function setColor($color) {
        // ...
    }

    public function render($area) {
        // ...
    }
}

class Rectangle extends Shape {
    public function __construct {
    parent::__construct();
        $this-&gt;width = 0;
        $this-&gt;height = 0;
    }

    public function setWidth($width) {
        $this-&gt;width = $width;
    }

    public function setHeight($height) {
        $this-&gt;height = $height;
    }

    public function getArea() {
        return $this-&gt;width * $this-&gt;height;
    }
}

class Square extends Shape {
    public function __construct {
        parent::__construct();
        $this-&gt;length = 0;
    }

    public function setLength($length) {
        $this-&gt;length = $length;
    }

    public function getArea() {
        return $this-&gt;length * $this-&gt;length;
    }
}

function renderLargeRectangles($rectangles) {
    foreach($rectangle in $rectangles) {
        if ($rectangle instanceof Square) {
            $rectangle-&gt;setLength(5);
        } else if ($rectangle instanceof Rectangle) {
            $rectangle-&gt;setWidth(4);
            $rectangle-&gt;setHeight(5);
        }

        $area = $rectangle-&gt;getArea(); 
        $rectangle-&gt;render($area);
    });
}

$shapes = [new Rectangle(), new Rectangle(), new Square()];
renderLargeRectangles($shapes);</code></pre><br>
<h3 id="princip-razdeleniya-interfeysa-interface-segregation-principle-isp">   (Interface Segregation Principle, ISP)</h3><br>
<p> ISP, ¬´     ,   ¬ª.</p><br>
<p>   : ,       (settings objects).        ,         .    ,      .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">interface WorkerInterface {
    public function work();
    public function eat();
}

class Worker implements WorkerInterface {
    public function work() {
        // ....working
    }
    public function eat() {
        // ...... eating in launch break
    }
}

class SuperWorker implements WorkerInterface {
    public function work() {
        //.... working much more
    }

    public function eat() {
        //.... eating in launch break
    }
}

class Manager {
  /** @var WorkerInterface $worker **/
  private $worker;

  public function setWorker(WorkerInterface $worker) {
        $this-&gt;worker = $worker;
    }

    public function manage() {
        $this-&gt;worker-&gt;work();
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">interface WorkerInterface extends FeedableInterface, WorkableInterface {
}

interface WorkableInterface {
    public function work();
}

interface FeedableInterface {
    public function eat();
}

class Worker implements WorkableInterface, FeedableInterface {
    public function work() {
        // ....working
    }

    public function eat() {
        //.... eating in launch break
    }
}

class Robot implements WorkableInterface {
    public function work() {
        // ....working
    }
}

class SuperWorker implements WorkerInterface  {
    public function work() {
        //.... working much more
    }

    public function eat() {
        //.... eating in launch break
    }
}

class Manager {
  /** @var $worker WorkableInterface **/
    private $worker;

    public function setWorker(WorkableInterface $w) {
      $this-&gt;worker = $w;
    }

    public function manage() {
        $this-&gt;worker-&gt;work();
    }
}</code></pre><br>
<h3 id="princip-inversii-zavisimostey-dependency-inversion-principle-dip">   (Dependency Inversion Principle, DIP)</h3><br>
<p>  :</p><br>
<ol>
<li>      .      . </li>
<li>     .     .</li>
</ol><br>
<p>      ,      PHP- ( Symfony),            (Dependency Injection, DI).     , DI           .      DI.    ,    (coupling)  .  ‚Äî    ,   .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Worker {
  public function work() {
    // ....working
  }
}

class Manager {
    /** @var Worker $worker **/
    private $worker;

    public function __construct(Worker $worker) {
        $this-&gt;worker = $worker;
    }

    public function manage() {
        $this-&gt;worker-&gt;work();
    }
}

class SuperWorker extends Worker {
    public function work() {
        //.... working much more
    }
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">interface WorkerInterface {
    public function work();
}

class Worker implements WorkerInterface {
    public function work() {
        // ....working
    }
}

class SuperWorker implements WorkerInterface {
    public function work() {
        //.... working much more
    }
}

class Manager {
    /** @var Worker $worker **/
    private $worker;

    public function __construct(WorkerInterface $worker) {
        $this-&gt;worker = $worker;
    }

    public function manage() {
        $this-&gt;worker-&gt;work();
    }
}</code></pre><br>
<h3 id="obedinyayte-metody-v-cepochki">   </h3><br>
<p>     ,    ,   PHPUnit  Doctrine.          .        (chaining),    ,     .        <code>this</code> ‚Äî        .</p><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Car {
    private $make, $model, $color;

    public function __construct() {
        $this-&gt;make = 'Honda';
        $this-&gt;model = 'Accord';
        $this-&gt;color = 'white';
    }

    public function setMake($make) {
        $this-&gt;make = $make;
    }

    public function setModel($model) {
        $this-&gt;model = $model;
    }

    public function setColor($color) {
        $this-&gt;color = $color;
    }

    public function dump() {
        var_dump($this-&gt;make, $this-&gt;model, $this-&gt;color);
    }
}

$car = new Car();
$car-&gt;setColor('pink');
$car-&gt;setMake('Ford');
$car-&gt;setModel('F-150');
$car-&gt;dump();</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Car {
    private $make, $model, $color;

    public function __construct() {
        $this-&gt;make = 'Honda';
        $this-&gt;model = 'Accord';
        $this-&gt;color = 'white';
    }

    public function setMake($make) {
        $this-&gt;make = $make;

        // NOTE: Returning this for chaining
        return $this;
    }

    public function setModel($model) {
        $this-&gt;model = $model;

        // NOTE: Returning this for chaining
        return $this;
    }

    public function setColor($color) {
        $this-&gt;color = $color;

        // NOTE: Returning this for chaining
        return $this;
    }

    public function dump() {
        var_dump($this-&gt;make, $this-&gt;model, $this-&gt;color);
    }
}

$car = (new Car())
  -&gt;setColor('pink')
  -&gt;setMake('Ford')
  -&gt;setModel('F-150')
  -&gt;dump();</code></pre><br>
<h3 id="kompoziciya-luchshe-nasledovaniya">  </h3><br>
<p>     ¬´<a href="https://ru.wikipedia.org/wiki/Design_Patterns"> </a>¬ª  ,      ,   .       ,   .       ,      ,   ,       .  -      .</p><br>
<p> : ¬´    ?¬ª     ,       ,    :</p><br>
<ol>
<li>  ‚Äî   is-a,   has-a. :  ‚Üí  vs.  ‚Üí   (UserDetails). </li>
<li>       . (  ,  .) </li>
<li>       ,   . (       .)</li>
</ol><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class Employee {
    private $name, $email;

    public function __construct($name, $email) {
        $this-&gt;name = $name;
        $this-&gt;email = $email;
    }

    // ...
}

// Bad because Employees "have" tax data. 
// EmployeeTaxData is not a type of Employee

class EmployeeTaxData extends Employee {
    private $ssn, $salary;

    public function __construct($ssn, $salary) {
        parent::__construct();
        $this-&gt;ssn = $ssn;
        $this-&gt;salary = $salary;
    }

    // ...
}</code></pre><br>
<p><strong>:</strong></p><br>
<pre><code class="php">class EmployeeTaxData {
    private $ssn, $salary;

    public function __construct($ssn, $salary) {
        $this-&gt;ssn = $ssn;
        $this-&gt;salary = $salary;
    }

    // ...
}

class Employee {
    private $name, $email, $taxData;

    public function __construct($name, $email) {
        $this-&gt;name = $name;
        $this-&gt;email = $email;
    }

    public function setTaxData($ssn, $salary) {
        $this-&gt;taxData = new EmployeeTaxData($ssn, $salary);
    }
    // ...
}</code></pre></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/336788/">https://habr.com/ru/post/336788/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336774/index.html">Happy birthday, Linux! Recall Core 1.0</a></li>
<li><a href="../336778/index.html">Modern hiring - sucks</a></li>
<li><a href="../336780/index.html">In search of a lost gigabit or a bit about windows in TCP</a></li>
<li><a href="../336782/index.html">Interview with Ivar Jacobson, founder of UML, RUP, Essence</a></li>
<li><a href="../336784/index.html">256 bytes of intro "Springs" for the computer Vectrex</a></li>
<li><a href="../336790/index.html">The practice of forming requirements for IT projects from A to Z. Part 2. Objectives and Needs</a></li>
<li><a href="../336792/index.html">Social media mining at ITMO University</a></li>
<li><a href="../336796/index.html">Low branch trees</a></li>
<li><a href="../336798/index.html">Kotlin: combat use experience</a></li>
<li><a href="../336800/index.html">Education from Mail.Ru Group: telling live on Tehnostrim about training opportunities</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>