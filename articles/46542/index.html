<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MySQL locks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© often discussed the principles of MySQL. This habratopic is devoted to locking mechanisms used in MySQL. The topic will help beginners to lea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MySQL locks</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© often discussed the principles of MySQL.  This habratopic is devoted to locking mechanisms used in MySQL.  The topic will help beginners to learn MySQL and, to some extent, experienced habra people. <br><br><h2>  MySQL blocking mechanism </h2><br>  Simultaneous access of several clients to the data warehouse can lead to errors of various types.  For example, simultaneous reading by one client and writing another client of the same row of a table with a high probability will lead to failure or reading of incorrect data.  Locking mechanisms allow you to avoid situations of simultaneous access to data, regulating the mechanism of user interaction with each other. <a name="habracut"></a><br><br>  MySQL on behalf of one of the clients imposes a lock on a specific resource, while other clients are waiting for the lock to be released.  A lock can be at the table level (the table is locked) or at the row level (certain rows of the table are blocked).  The MyISAM storage engine (used by default) has a table lock, and the InnoDB mechanism is row-based.  Line-by-line locking is achieved by complicating the storage structure: in MyISAM, the data file structure is a simple enumeration of table rows, while the InnoDB storage is structured and supports multiversion of data.  Therefore, InnoDB wins in applications in which there is a multithreaded change of data in the same table, despite the necessary maintenance losses of more complex storage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are two types of locks: read and write. <ol><li>  If A wants to read data, other clients can also read data, but no one can write until A has finished reading (read lock). </li><li>  If A wants to write data, then other clients should neither read nor write this data until A has finished (write lock). </li></ol>  The lock can be imposed explicitly or implicitly. <ol><li>  If the client does not explicitly assign the lock, the MySQL server implicitly sets the required lock type at the time the expression or transaction is executed.  For example, in the case of a SELECT statement, the server will set READ LOCK, and in the case of UPDATE, WRITE LOCK.  For implicit locking, the lock level depends on the type of data storage: for MyISAM, MEMORY and MERGE, the entire table is locked, for InnoDB, only the lines used in the expression (if the set of these lines can be uniquely determined by the primary key values, otherwise, the entire table is blocked ). </li><li>  Often there is a need to perform several requests in a row without the intervention of other customers at this time.  Implicit blocking is not suitable for these purposes, as it is set only for the duration of the execution of a single request.  In this case, the client can explicitly assign and then cancel the lock using the LOCK TABLES and UNLOCK TABLES expressions.  Explicit locking always locks the entire table, regardless of the storage mechanism. </li></ol><h2>  Using explicit locks </h2><br>  In the case of explicit blocking, you can gain performance gains by assigning the blocking once and delaying the recording of the updated indexes until the blocking time.  When assigning an explicit lock, the table name and type of lock are specified: LOCK TABLES Country READ, City WRITE; The UNLOCK TABLES operator has no arguments and removes all locks that are explicitly set during the current session. <br><br>  Note the following features of explicit locks: <ul><li>  As long as the client holds an explicit lock, he cannot use other tables, so you need to lock everything you need right away (with one expression), since reusing the LOCK TABLES operator cancels the locks that were previously made. </li><li>  The lock can be set to view (VIEW) since version 5.0.6.  For earlier versions, it is necessary to set a lock on all tables included in the view. </li><li>  Disconnecting the connection, or ending the session, automatically removes all locks set during the session. </li><li>  Table locking can be broken by a transaction and vice versa.  START TRANSACTION implicitly performs UNLOCK TABLES and vice versa LOCK TABLES rolls back an incomplete transaction. </li><li>  To set the lock, you must have LOCK TABLES and SELECT privileges on each locked table. </li><li>  If one of the required tables is locked in another session, then the lock statement will not be executed until all tables are freed. </li></ul>  Types of locks: <ul><li>  READ - locks the table for reading.  All clients can receive data at the same time, but no one can change it, even the client who has set the lock. </li><li>  WRITE - locks the table for writing.  Only the client who has set the lock can receive and modify data. </li><li>  READ LOCAL - locks the table for reading, but allows data insertion (INSERT).  Applies only to MyISAM tables that do not have holes resulting from changing or deleting rows.  In this case, new data is added to the end of the table.  If the table has holes, then they can be eliminated using the OPTIMIZE TABLE statement. </li><li>  LOW_PRIORITY WRITE - locks the table for writing, but while waiting for a lock, skips those clients who are in the queue to receive a lock of type READ.  While waiting for a lock, new incoming READ lock requests are also skipped ahead, which could potentially lead to a write never being made (if there are always clients in the read queue). </li></ul>  <b>Note</b> : The concurrent_inserts system variable defines the ability to add data to the end of the MyISAM table that is locked for reading.  By default, this variable is 1, which means that you can add data if there are no holes in the table.  Thus, in the case of implicit locking, READ LOCAL is set for MyISAM tables and not READ.  A value of concurrent_inserts equal to 0 prohibits adding data in parallel with reading, and equal to 2 allows inserting data at the end of the table even if there are holes in the table. <br><br><h2>  Conclusion </h2><br>  The article covers only the main issues of using locks in MySQL.  Not covered transactions, isolation levels, advisory lock, etc. Write in the comments which of the questions you are interested in. <br><br>  Crosspost <a href="http://webew.ru/articles/1383.webew">Lock in MySQL</a> with Webew. </div><p>Source: <a href="https://habr.com/ru/post/46542/">https://habr.com/ru/post/46542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../46533/index.html">Scandal: Obama noticed Zune</a></li>
<li><a href="../46534/index.html">TDD and fair sex</a></li>
<li><a href="../46536/index.html">Kidizoom Digital Camera - a gift to a young photographer</a></li>
<li><a href="../46538/index.html">D-link router is buggy: is this normal?</a></li>
<li><a href="../46541/index.html">Medvedev abolished Runet censorship</a></li>
<li><a href="../46544/index.html">Vikings are attacking (Worm.Win32.Viking.hb)</a></li>
<li><a href="../46548/index.html">Very important survey of users</a></li>
<li><a href="../46550/index.html">I do not want QIP Infium</a></li>
<li><a href="../46551/index.html">Concept mp3-player from Nuno Teixeira</a></li>
<li><a href="../46553/index.html">Yii Framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>