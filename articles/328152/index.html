<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>As I wrote my Redux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Or the Hunt for the Kraken . In previous posts ( here and here ) I shared my braindump on various architectural styles, in particular Model-View-Contr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>As I wrote my Redux</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6a3/586/17a/6a358617a45a359a89b194fbefbfbaf8.jpg" alt="image"><br><br>  Or the <b>Hunt for the Kraken</b> .  In previous posts ( <a href="https://habrahabr.ru/post/326046/">here</a> and <a href="https://medium.com/%40arturbasak/%25D0%25B7%25D0%25B0%25D0%25B3%25D0%25B0%25D0%25B4%25D0%25BA%25D0%25B0-%25D0%25BA%25D1%2580%25D0%25B0%25D0%25BA%25D0%25B5%25D0%25BD%25D0%25B0-1b46f310dd4b">here</a> ) I shared my braindump on various architectural styles, in particular <b>Model-View-Controller</b> and <b>Flux</b> . <br><br>  I noted that I did not see any revolution in the face of Flux, this template is not something new.  I saw in it a similarity with the <b>1979 Reenskaug-MVC</b> .  Also, I mentioned that I decided to remove Redux from my code (one of the implementations of Flux).  It seems to me that these points need to be explained more fully.  My goal was not to convince the reader that Flux should be called MVC, I also did not want to say that the redux module is bad and should be completely abandoned. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  So how does it relate to Flux? </h3><br>  First you need to decide what is Flux.  First of all, this is definitely an architectural style, and at that moment, not only for client web applications.  Secondly, it is a set of well-defined components and terms. <br><a name="habracut"></a><br>  There are already a dozen implementations of this concept, these are only the most popular: <b>Facebook / Flux</b> , <b>Redux</b> , <b>Fluxxor</b> , <b>Reflux</b> , <b>Vuejs / Vuex</b> , <b>Mobx</b> .  There is an exotic in the form of <b>SAM.js</b> (State-Action-Model). <br><br>  But it is important that the terms <b>Dispatcher</b> , <b>Action</b> , <b>Store,</b> and <b>State (State) are</b> tightly occupied in modern client application architectures.  Just as before, the developer who came to the new system was looking for the Controller layer, now he is looking for the Vault or Dispatcher. <br><br>  So how to treat this?  Treat definitely good.  For me, Flux is a second-level <b>SoC (Separation of Concerns)</b> , a division of responsibility within a specific MVC component.  This is not a new idea; this is what <b>Taligent-MVP</b> tried to do when the Controller layer was rethought and divided into several other layers. <br><br>  This is not a replacement, this is the next round, this is the evolution of architectural patterns. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d62/cb3/5a8/d62cb35a8ac054f821fe51d63b52fd60.png" alt="image"></div><br>  <i>From the note ‚ÄúEverything new is well forgotten old‚Äù</i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0ef/1e7/29d/0ef1e729d0fa5240430b98a5a5e85cf4.png" alt="image"></div><br>  <i>From the presentation of I.Panin ‚ÄúWhy the domain first?‚Äù</i> <br><br><h3>  Motivation </h3><br>  Responsibility is an approach that allows you to not turn the project code into a scary pasta monster, whose tentacles are randomly intertwined, building mazes of code designs ( <i>Kraken, see previous notes</i> ). <br><br>  However, as I mentioned earlier, each concept or pattern begins with a problem for which they were invented.  Facebook is a large company, it is a web-application of colossal proportions, the amount of interactivity at the highest level.  That's what Flux was coined for.  But that is precisely why this concept was so difficult for the community.  How many companies develop similar software? <br><br>  Consider how many applications you have developed really need multiple storage?  By developing how many of your applications would this template really help? <br><br>  For each lock you need your own key.  Sometimes the keys fit several locks, sometimes we force it in and still open the door.  In my head and the phrase pops up: <br><br><blockquote>  <i>Too often we don‚Äôt want to listen to the voice of reason and pay a lot of attention to sellers of panacea, singing voices</i> </blockquote><br>  V.M. Tursky (from the book of F. Brooks ‚ÄúThe Mythical Man-Month‚Äù) <br><br><blockquote>  <i>I saw a group of developers who were losing their heads from publicized standards and forgot about their main task: to realize the interests of the client.</i> </blockquote><br>  R. Martin <br><br>  Redux is loved by the community.  This implementation is what the average application needed.  When I moved to this stack of technologies, the first applications were written, one can say, as standard.  A bunch of React-Redux-Thunk (Middleware) was used.  There were both <b>Action Creators</b> and string constants for <b>Action</b> types <b>(Actions)</b> , there were also so-called <b>Bound Action Creators</b> .  All guide to the official site. <br><br>  But at a certain point, the question became, how does this pair of magic modules work under the hood?  For a developer like me who dealt with the Documentum Foundation Classes codebase, read the source code of ExtJS 3.1 integrated into Webtop, it‚Äôs easy to figure out a couple of functions of the redux module.  As with most other experienced programmers.  But it is not a secret for anyone that developers of different levels work on projects.  How to ensure that even the youngest could understand what is happening under this very ‚Äú <i>hood</i> ‚Äù?  After all, the programmer must know his tool. <br><br>  I was faced with the fact that not all the developers around me understood or even thought about <b>how</b> this magic <b>works</b> , how the rabbit emerges from a hat.  This was probably the first point that served as a catalyst for writing your own implementation of Flux / Redux.  In the end, the best way to figure out something, to rethink something, is to write it yourself.  The code will be available to the whole team, everyone will be able to add or remove something, go through the debugger and understand the purpose of any line. <br><br>  Go through the rest of the motivating points.  <b>Unidirectional Data Flow</b> concept must be clean.  Unidirectional data flow is what will kill a monster with tentacles.  And, probably, the most uncertain point in this approach is the asynchrony of JavaScript and how it lies on the concept of a unidirectional data flow. <br><br>  There are several options that people choose to solve this moment.  One example is Thunk.  Personally for me, <b>middleware (intermediate computing)</b> looks like a kind of side effect within the framework of the architectural style of Flux.  Attempt to plug the hole, which does not allow to use the template in its pure form.  These are like Utils, Helper or Service classes in OOP.  When a developer cannot take out logic in a particular business class, he will have this magical place where he begins to put all this side <i>(useful?)</i> Functionality.  In fact, this side effect is nothing more than a feature of our Vault.  <b>Storage is persistent</b> , and this is what keeps us from thinking about data through the lens of monosyllabic CRUD operations. <br><br>  Definitely the code should be clean.  This is what professional programmers strive for in their projects.  Most tools are redundant since they were created for a wide range of tasks.  They were not created for your project, sometimes not even for your type of task.  But everyone is chasing trends, everyone is chasing a panacea. <br><br>  Thunk and <b>bindActionCreators</b> are a side effect for me.  I choose the approach in which the second argument of the <b>connect</b> function, namely <b>mapDispatchToProps</b> , I will not need.  By the way, has anyone ever used the third argument of the connect function in their projects?  Can the mysterious <b>pure</b> flag? <br><br>  The second point that served as a catalyst is the <b>redundancy of the</b> tools used. <br><br>  By the way, one of Niklaus Wirth's favorite phrases: <br><br><blockquote>  <i>The tool must match the task.</i>  <i>If the tool does not match the task, you need to come up with a new one that would fit it, and not try to adapt an existing one.</i> <br></blockquote><br>  The third point is <b>‚Äúbecause I can‚Äù</b> .  Yes, yes, exactly, we are programmers too, we can also write our tools.  I do not urge to rewrite, for example, React or Spring-framework.  But dragging the whole Spring into a project that doesn't need it doesn't make sense.  For example, I am absolutely not too lazy to spend one Saturday evening on my little implementation of Flux, which will satisfy the needs of my applications.  I even enjoy it. <br><br>
<h3>  Bike or let it have a name, Artux </h3><br><img src="https://habrastorage.org/getpro/habr/post_images/4f9/4b9/aa0/4f94b9aa0558187d309a3d201b5ac20f.jpg" alt="image"><br><br>  Redux is written in a functional style, in the question of programming paradigms, I am the happy medium, JavaScript is an amazing language that opens up a multi-paradigm curtain.  I am for the very balance of the dark and light side. <br><br>  But classes make it easier to describe interfaces.  When you say "Storage", it is easier to perceive it as an object with a specific API method, rather than a set of functions, united by one name. <br><br>  Below is just the interface of my implementation of the Store.  It is very similar to the Redux variant, except that the <b>unsubscribe</b> function has appeared in public methods.  In the redux module, it is closed in the <b>subscribe</b> function. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/58a/2c3/423/58a2c3423b3a504fea7dca9ab377ad1a.png" alt="image"></div><br>  The Storage Designer accepts <b>Models (Models)</b> cards with the appropriate <b>Action Model (Reducers / Receivers)</b> with the corresponding models. <br><br>  The model is a logical named subdivision of the Storage, which corresponds to a specific business entity, part of a domain.  In my view, the Vault contains only business information, no states of graphical widgets, such as checkboxes or radio buttons. <br><br>  Handlers are functions or classes that react to received commands from the outside and, based on useful information that a command carries, change the state of their Model. <br><br>  Below the interface of the <b>StoreProvider</b> class <b>(Storage Provider)</b> , it is almost identical to the original and simply puts an instance of the Storage in the application context. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c1/d76/a3b/7c1d76a3b2606cd7e800fd6d228f665e.png" alt="image"></div><br>  The following describes the <b>higher order component</b> interface <b>(Higher-order Component / HoC)</b> that the <b>subscribeToStore</b> function generates, replacing the connect function. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9b5/932/d09/9b5932d09f8e7f6ccb23e882d11c1aa7.png" alt="image"></div><br>  As I mentioned above, I removed the redundancy and now only the listener of the repository state is transmitted to the input.  The main logic that is mixed with this component is to check the data being listened and their values ‚Äã‚Äãobtained from the next state.  In the case of obtaining new values, the lifecycle methods of the component are run, which as a result will update all or part of the whole view. <br><br>  And the last component of my modest implementation.  Interface Manager. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ecc/770/31d/ecc77031d8bac76043b85ee152980b88.png" alt="image"></div><br>  The main purpose of the component is to send messages to the Vault.  The interface provides a method that allows you to create an action object, as well as methods for scheduling actions that ‚Äú <i>bury</i> ‚Äù the asynchronous nature of persistent operations.  Let me draw the reader‚Äôs attention to the fact that the promise is not thrown out; any reactions in the system occur only on the basis of changes in the state of a certain model. <br><br>  The action is a JSON object containing the following fields: <br><br><ul><li>  <b>Type (Type)</b> - string literal, the name of the user's actions; </li><li>  <b>Useful Information (Payload)</b> - this can be a scalar value or a data structure; </li><li>  <b>Meta or Side Information (Meta)</b> - additional data can be thrown through this property, for example, input arguments necessary to perform an operation comparable to the action; </li><li>  <b>Error Indicator (Error)</b> - a Boolean value that reflects the success or failure of an operation comparable to the action; </li></ul><br>  Also, with the use of es6-objects <b>Proxy</b> and <b>Reflect</b> , a logging mechanism was added to the state transition console for easier debugging. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ad/4e0/4cb/8ad4e04cbc01d9147d62f16cb6b8835b.png" alt="image"><br><br><h3>  App device </h3><br>  At the top of the view are <b>Pages</b> .  It can be said, the components-containers, which are the parent for the entire tree of graphic widgets. <br><br>  Pages are exactly the same HoC components that subscribe to changes in the state of the Storage, forwarding the data stream down through the tree.  Also, each such object has its own <b>Interactors</b> layer.  This layer combines two types of operations: transitions between Pages (Pages) or Anchors (Anchors) and the initialization of the execution of <b>Actions (Actions / Commands)</b> . <br><br>  The class of interaction is, in fact, a bridge, allowing to combine in one place communication with the Manager and the <b>Router</b> .  Below is an example of an interface of this class. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63d/b23/424/63db234246e2a52c2f2d8f5441562c7a.png" alt="image"></div><br>  Each model in the system corresponds to its <b>Handler (Reducer / Receiver)</b> , it is he who, on the basis of the received action, changes or does not change the state of the model. <br><br>  Many terms I write through the line, giving two options for naming.  By this, I would like to note that a similar concept can be implemented, already familiar to many, with behavioral design patterns. <br><br>  My version of the handler is <b>Reducers</b> .  I have always been annoyed by tons of constants that I had to write for the fork of action types (PENDING, SUCCESS, FAIL).  First, I decided to dwell on literals right at the handlers.  Secondly, I believe that the object-action is a very flexible tool that could carry all the necessary information.  Thirdly, for me personally, it is somehow difficult to perceive the user's action, which is called GET_ITEMS FAIL.  Agree, this is not the action that the end user wanted to perform, he performed GET_ITEMS, and it is this action that should go to the model in the repository. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f7/7ae/d52/0f77aed52a40ab06cc318aee90da6d7a.png" alt="image"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/328/1de/e8f/3281dee8f6b71d718f790cf39052e411.png" alt="image"><br><br>  Now you can display the general scheme of the application.  She might look like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f5/305/022/9f53050229267b9a0a8285cee494bc81.png" alt="image"><br><br><h3>  #DMP_END </h3><br>  Like any scheme, this architecture can also turn into an octopus with tentacles.  The <i>thickest</i> place in this version is the performance.  But here we are called upon to help React itself, a library focused on the implementation of the presentation layer.  There are also a number of techniques, for example, <b>component inheritance (HoC and OOP Inherits)</b> .  The task is about simple - to prevent the birth of a new monster - <b>FSUV (Fat Stupid Ugly View)</b> . <br><br>  I must clarify that in the description, I referred to the module redux version 3.6.0.  To be honest, I didn‚Äôt particularly gain in performance, page rendering takes place in the same time.  But if suddenly this module disappears altogether from npm, then as you already understood, I will not be very sad. <br><br>  Summing up, there is a tool for each task, I wrote my own little implementation of the tool, and for subsequent applications it may not be suitable.  Perhaps it is evolving into something more universal, and maybe I will again return to the standard react-stack. <br><br>  By the way, I did not specifically show the implementation of the methods, only the interfaces, let it be a motivation for the reader to go see the source codes of the libraries used, and try to create his own small implementation that would suit his project. <br><br>  On this note, I will cut off my chaotic dump, the theme of which was a mess of thoughts about the architecture of Flux.  I would welcome any feedback artur.basak.devingrodno@gmail.com <br><br><h3>  Links </h3><br>  <a href="https://github.com/acdlite/flux-standard-action">+ Flux Standard Actions</a> <br>  <a href="http://redux.js.org/docs/introduction/">+ Redux</a> <br>  <a href="https://facebook.github.io/flux/">+ Flux</a> <br>  <a href="https://docs.google.com/presentation/d/18LN1FDX0dLi4DtmlpfsKEQ-hGuLP1Fex5AjKoR8ezyU/edit">+ I.Panin ‚ÄúWhy the domain first?‚Äù</a> </div><p>Source: <a href="https://habr.com/ru/post/328152/">https://habr.com/ru/post/328152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328134/index.html">Recovering data from damaged RAID 5 to Linux NAS</a></li>
<li><a href="../328138/index.html">Neuroculture Part 0. Or neuro-free chicken coop</a></li>
<li><a href="../328144/index.html">Docker containers slightly increase server power consumption</a></li>
<li><a href="../328146/index.html">A simple model of the adaptive Kalman filter by means of Python</a></li>
<li><a href="../328148/index.html">BK-0010 emulator on FPGA - part 2</a></li>
<li><a href="../328156/index.html">How Studying Smalltalk Can Improve Your Programming Skills</a></li>
<li><a href="../328158/index.html">As we did a short-term forecast of precipitation. Lecture in Yandex</a></li>
<li><a href="../328160/index.html">Change in perception of complexity</a></li>
<li><a href="../328162/index.html">Count to three: three</a></li>
<li><a href="../328164/index.html">IaaS Digest: ‚ÄúvCloud and His Friends‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>