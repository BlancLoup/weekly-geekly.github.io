<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write MVP application on Kotlin for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Application development on Kotlin for Android is gaining popularity among developers, but there are few articles in the Russian-speaking segment of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write MVP application on Kotlin for Android</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/ad1/e16/e49/ad1e16e4935a4ca487ccd75f7aa277fe.png"></div><br><br>  Application development on Kotlin for Android is gaining popularity among developers, but there are few articles in the Russian-speaking segment of the Internet.  I decided to tweak the situation a bit and write a tutorial on developing an application on Kotlin.  We will write a full-fledged application using all trend libraries (except RxJava) in the world of Android development.  In the end, we should have an extensible and easily testable application (we will not write the tests themselves). <a name="habracut"></a><br><br>  <b>Attention!</b>  This article describes how to create an application version <a href="">1.0</a> .  The current code in the repository may differ from that described in the article. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Probably, some of you know that in addition to the programming language, Kotlin JetBrains also develops the <a href="https://github.com/Kotlin/anko">Anko</a> library, to create a UI application, as a replacement for regular XML files.  We will not use it in our project in order not to embarrass people who are not familiar with Anko. <br><br>  Content: <br><ul><li>  <a href="https://habr.com/ru/post/275255/">Setting up Android Studio</a> </li><li>  <a href="https://habr.com/ru/post/275255/">What are we going to write?</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Application structure</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Create a Model</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Screen with notes</a> <br><ul><li>  <a href="https://habr.com/ru/post/275255/">Create a MainView and MainPresenter</a> </li><li>  <a href="https://habr.com/ru/post/275255/">We implement a search for notes</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Implement note sorting</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/275255/">Screen with content notes</a> <br><ul><li>  <a href="https://habr.com/ru/post/275255/">Create a NoteView and NotePresenter</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Implement saving notes</a> </li></ul></li><li>  <a href="https://habr.com/ru/post/275255/">Thanks</a> </li><li>  <a href="https://habr.com/ru/post/275255/">Conclusion</a> </li></ul><br><br><br><h1>  Setting up Android Studio </h1><br><br>  To write applications in the Kotlin language, Android Studio needs a special plugin.  Installation instructions for the plugin can be found <a href="http://java-help.ru/kotlin-introduction/">here</a> .  Also, do not forget to turn off the ‚ÄúInstant Run‚Äù feature in the Android Studio settings, since at the moment it is not supported by the Kotlin plugin. <br><br>  For correct code generation, you need to use a version of the plugin not lower than 1.0.1.  I used the <a href="https://discuss.kotlinlang.org/t/kotlin-1-0-2-eap/1581/1">Kotlin</a> version <a href="https://discuss.kotlinlang.org/t/kotlin-1-0-2-eap/1581/1">1.0.2 EAP</a> .  This is how the application's build.gradle file looks in my project: <br><br><pre><code class="java hljs">apply plugin: <span class="hljs-string"><span class="hljs-string">'com.android.application'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android-extensions'</span></span> apply plugin: <span class="hljs-string"><span class="hljs-string">'kotlin-android'</span></span> android { compileSdkVersion <span class="hljs-number"><span class="hljs-number">23</span></span> buildToolsVersion <span class="hljs-string"><span class="hljs-string">"23.0.2"</span></span> defaultConfig { applicationId <span class="hljs-string"><span class="hljs-string">"imangazaliev.notelin"</span></span> minSdkVersion <span class="hljs-number"><span class="hljs-number">15</span></span> targetSdkVersion <span class="hljs-number"><span class="hljs-number">23</span></span> versionCode <span class="hljs-number"><span class="hljs-number">1</span></span> versionName <span class="hljs-string"><span class="hljs-string">"1.0"</span></span> } buildTypes { release { <span class="hljs-function"><span class="hljs-function">minifyEnabled </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">false</span></span></span><span class="hljs-function"> proguardFiles </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDefaultProguardFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'proguard-android.txt'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">, 'proguard-rules.pro' } } sourceSets </span></span>{ main.java.srcDirs += <span class="hljs-string"><span class="hljs-string">'src/main/kotlin'</span></span> androidTest.java.srcDirs += <span class="hljs-string"><span class="hljs-string">'src/androidTest/kotlin'</span></span> } } dependencies { ... } kapt { generateStubs = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } buildscript { ext.kotlin_version = <span class="hljs-string"><span class="hljs-string">'1.0.2-eap-15'</span></span> repositories { mavenCentral() maven { url <span class="hljs-string"><span class="hljs-string">'https://dl.bintray.com/kotlin/kotlin-eap'</span></span> } } dependencies { classpath <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"</span></span> } } repositories { mavenCentral() }</code> </pre> <br><br><br><h1>  What are we going to write? </h1><br><br>  So, first we need to decide what we will write?  Without thinking, I stopped at the application-notes.  The name also came up easily - Notelin.  The application is very simple and consists of two screens: <br><br>  - Main screen - contains a list with notes <br>  - Notes screen - here you can view / edit the content of the selected note <br><br>  Application requirements are small: <br><br>  - Add / view / delete notes <br>  - View information about the note <br>  - Sort notes by title and date <br>  - Search by note headers <br><br><h1>  Used libraries </h1><br><br>  To work with the database, I will use the <b>Android Active</b> library.  A lesson on working with it can be found at this <a href="http://java-help.ru/activeandroid-orm-review/">link</a> .  To implement Depency Injection, the Dagger 2 library was used. On Habr√© there are many articles on working with it.  The basis of the entire application will be the <a href="https://habrahabr.ru/post/276189/">Moxy</a> library.  With its help, we implement the MVP pattern in our project.  It completely solves the problems of the life cycle, so you can not worry about re-creating the components of your application.  We will also use a set of extensions for the Kotlin language in Android - <a href="https://github.com/pawegio/KAndroid">KAndroid</a> .  About the rest of the library, I will talk along the way. <br><br>  Below is a list of project dependencies: <br><br><pre> <code class="java hljs">allprojects { repositories { jcenter() mavenCentral() maven { url <span class="hljs-string"><span class="hljs-string">"https://oss.sonatype.org/content/repositories/snapshots/"</span></span> } maven { url <span class="hljs-string"><span class="hljs-string">"https://mvn.arello-mobile.com/"</span></span> } maven { url <span class="hljs-string"><span class="hljs-string">"https://jitpack.io"</span></span> } maven { url <span class="hljs-string"><span class="hljs-string">'https://dl.bintray.com/kotlin/kotlin-eap'</span></span> } } }</code> </pre><br><br>  And here is the list of dependencies of the application: <br><br><pre> <code class="java hljs">dependencies { compile <span class="hljs-string"><span class="hljs-string">"org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"</span></span> compile <span class="hljs-string"><span class="hljs-string">"com.android.support:appcompat-v7:23.1.1"</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.android.support:recyclerview-v7:23.1.1'</span></span> compile <span class="hljs-string"><span class="hljs-string">'com.android.support:cardview-v7:23.1.1'</span></span> <span class="hljs-comment"><span class="hljs-comment">//   Android Kotlin compile 'com.pawegio.kandroid:kandroid:0.5.0@aar' //ActiveAndroid DB compile 'com.michaelpardo:activeandroid:3.1.0-SNAPSHOT' //FAB compile 'com.melnykov:floatingactionbutton:1.3.0' //MaterialDialog compile 'com.github.afollestad.material-dialogs:core:0.8.5.6@aar' //MVP compile 'com.arello-mobile:moxy:0.4.2' compile 'com.arello-mobile:moxy-android:0.4.2' kapt 'com.arello-mobile:moxy-compiler:0.4.2' //RX compile 'io.reactivex:rxjava:1.1.0' compile 'io.reactivex:rxandroid:1.1.0' //Depency Injection kapt 'com.google.dagger:dagger-compiler:2.0.2' compile 'com.google.dagger:dagger:2.0.2' provided 'org.glassfish:javax.annotation:10.0-b28' //EventBus compile 'org.greenrobot:eventbus:3.0.0' }</span></span></code> </pre><br><br>  Note that instead of apt I use <a href="http://blog.jetbrains.com/kotlin/2015/06/better-annotation-processing-supporting-stubs-in-kapt/">kapt</a> .  This is a Gradle plugin that allows you to annotate Kotlin elements. <br><br><h1>  Application structure </h1><br><br>  Here is the structure of our project in the final version: <br><br><img src="https://habrastorage.org/files/d9d/739/b13/d9d739b131b74d4d807d6a62e35dd674.png"><br><br><h1>  Create a Model </h1><br><br>  The notes will have four fields: <br><br><ul><li>  date of creation </li><li>  Date of change </li><li>  Headline </li><li>  Text </li></ul><br><br>  We implement all this in the code: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Note</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Model</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"title"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: String? = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"text"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text: String? = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"create_date"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> createDate: Date? = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column</span></span>(name = <span class="hljs-string"><span class="hljs-string">"change_date"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> changeDate: Date? = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">null</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(title: String, createDate: Date, changeDate: Date)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.title = title <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.createDate = createDate <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.changeDate = changeDate } constructor() <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInfo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: String </span></span>= <span class="hljs-string"><span class="hljs-string">":\n$title\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" :\n${formatDate(createDate)}\n"</span></span> + <span class="hljs-string"><span class="hljs-string">" :\n${formatDate(changeDate)}"</span></span>; }</code> </pre><br><br>  According to this model, the ActiveAndroid library will create a database in which our notes will be stored.  If you notice, we have two constructors: empty and with parameters.  We will use the first constructor, and the second - ActiveAndroid.  Our model is inherited from the Model class, so we can save and delete our notes simply by calling the <b>save ()</b> and <b>delete ()</b> methods, for example: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> note = Note(<span class="hljs-string"><span class="hljs-string">" "</span></span>, Date()) note.save() ... note.delete()</code> </pre><br><br>  But before using our model, we need to register some meta data in the Manifest file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AA_DB_NAME"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Notelin.db"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"AA_DB_VERSION"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  I think everything is clear without comment.  It remains to inherit the Application class from com.activeandroid.app.Application: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotelinApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class">() </span></span>{ ... }</code> </pre><br><br>  To make the application less dependent on the database, I created a <a href="">NoteDao</a> wrapper on our model, in which all operations for creating, saving, updating and deleting notes will take place: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** *    */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: Note </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> note = Note(<span class="hljs-string"><span class="hljs-string">" "</span></span>, Date()) note.save() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> note } <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(note: Note)</span></span></span><span class="hljs-function"> </span></span>= note.save() <span class="hljs-comment"><span class="hljs-comment">/** *        View */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAllNotes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>= Select().from(Note::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">execute</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Note</span></span></span><span class="hljs-class">&gt;() /** *    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">    */ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">fun</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">getNoteById</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">noteId</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Long</span></span></span><span class="hljs-class">) </span></span>= Select().from(Note::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">).</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">where</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class"> </span></span>= ?<span class="hljs-string"><span class="hljs-string">", noteId).executeSingle&lt;Note&gt;() /** *     */ fun deleteAllNotes() { Delete().from(Note::class.java).execute&lt;Note&gt;(); } /** *    id */ fun deleteNote(note: Note) { note.delete() } }</span></span></code> </pre><br><br>  You probably noticed that for creating objects we did not use the <b>new</b> keyword - this is the difference between Kotlin and Java. <br><br><br><h1>  Screen with notes </h1><br><br>  Also is the main screen of the application.  On it, the user can add / delete a note, view information about the note, sort them by date or title, and also search by title. <br><br><br><h3>  Create a MainView and MainPresenter </h3><br><br><img width="40%" src="https://habrastorage.org/files/10b/d1e/6b8/10bd1e6b8e08489abc94a0c89c9c74c4.png"><br><br>  Now we need to translate all this into code.  First, create the interface for our View: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@StateStrategyType</span></span>(value = AddToEndSingleStrategy::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainView</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNotesLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notes: List&lt;Note&gt;)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSearchResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notes: List&lt;Note&gt;)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAllNotesDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNoteDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteInfoDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(noteInfo: String)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteInfoDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteDeleteDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notePosition: Int)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteDeleteDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteContextDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notePosition: Int)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteContextDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br><br>  Next, we will implement the created interface in our activit: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpAppCompatActivity</span></span></span><span class="hljs-class">(), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainView</span></span></span><span class="hljs-class"> </span></span>{</code> </pre><br><br>  One of the features of Kotlin is that the inheritance and implementation of interfaces is indicated by a colon after the class name.  It also does not make any difference to the name of the parent class before the interfaces, after or even between them, as long as the class in the list is one.  That is, the entry above could look like this: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainView</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpAppCompatActivity</span></span></span><span class="hljs-class">() </span></span>{</code> </pre><br><br>  If you try to add the name of another class, separated by a comma, the IDE will give an error and underline the name of the class that follows the second line. <br><br>  For now, leave the methods empty.  As you can see, activit is inherited from <a href="">MvpAppCompatActivity</a> .  This is necessary so that the activit could restore the state when the screen is rotated. <br><br>  Create a class presenter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@InjectViewState</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainPresenter</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpPresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainView</span></span></span><span class="hljs-class">&gt;() </span></span>{ }</code> </pre><br><br>  A presenter is also inherited from MvpPresenter, to which we indicate which View we will work with. It remains to inject our model into the presenter.  To do this, we create a module - supplier NoteDao: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Module</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteDaoModule</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Provides</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">provideNoteDao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : NoteDao</span></span>= NoteDao() }</code> </pre><br><br>  Create a Component to inject the presenter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-meta"><span class="hljs-meta">@Component</span></span>(modules = arrayOf(NoteDaoModule::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">)) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(mainPresenter : MainPresenter)</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br><br>  Now we need to create a static instance of the AppComponent class in the Application class: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotelinApplication</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Application</span></span></span><span class="hljs-class">() </span></span>{ companion object { lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> graph: AppComponent } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() graph = DaggerAppComponent.builder().noteDaoModule(NoteDaoModule()).build() } }</code> </pre><br><br>  Now we can inject our model in the presenter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@InjectViewState</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainPresenter</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpPresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainView</span></span></span><span class="hljs-class">&gt;() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNoteDao: NoteDao init { NotelinApplication.graph.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } }</code> </pre><br><br>  For the interaction between MainView and MainPresenter, we need to create a variable in MainActivity: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@InjectPresenter</span></span> lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mPresenter: MainPresenter</code> </pre><br><br>  The Moxy plugin will link the View to the fragment and perform other necessary actions. <br><br>  Create a layout screen with a list and a floating button.  Activity_main.xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:tools</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/tools"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tools:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">".ui.activities.MainActivity"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvNotesIsEmpty"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/notes_is_empty"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">android.support.v7.widget.RecyclerView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/rvNotesList"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scrollbars</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:layoutManager</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.support.v7.widget.LinearLayoutManager"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.melnykov.fab.FloatingActionButton</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/fabButton"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"bottom|right"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"16dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@mipmap/ic_add"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:fab_colorNormal</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/colorPrimary"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:fab_colorPressed</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@color/colorPrimaryDark"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  To implement the flying button, I used the <a href="https://github.com/makovkastar/FloatingActionButton">FloatingActionButton</a> library.  Google has already added FAB to the support library, so you can use their solution. <br><br>  Let us indicate to our Activity which layout it should show: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) setContentView(R.layout.activity_main) }</code> </pre><br><br>  Next, we need to link the FAB and the list so that when scrolling up the list, the button disappears: <br><br><pre> <code class="java hljs">fabButon.attachToRecyclerView(rvNotesList)</code> </pre><br><br>  We do not need to write the <b>findViewById</b> order, we just need to register one line in the import block: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> kotlinx.android.synthetic.main.activity_main.*</code> </pre><br><br>  As you can see, the last package matches the name of our xml file.  The IDE automatically initializes the properties of our View and their names are the same as the ID we specified in the markup. <br><br>  Let's implement the loading of notes from the database.  Notes need to be loaded only once and used later.  With this we will be helped by the onFirstViewAttach method of the MvpPresenter class, which is called once the first time the View is bound to the presenter.  Further, no matter how much we twist and turn our Activity, the data will be cached in a presenter. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onFirstViewAttach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onFirstViewAttach() loadAllNotes() } <span class="hljs-comment"><span class="hljs-comment">/** *        View */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadAllNotes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ mNotesList = mNoteDao.loadAllNotes() viewState.onNotesLoaded(mNotesList) }</code> </pre><br><br>  Create an adapter for our list: <br><br><div class="spoiler">  <b class="spoiler_title">Adapter code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotesAdapter</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Adapter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotesAdapter</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNotesList: List&lt;Note&gt; = ArrayList() constructor(notesList: List&lt;Note&gt;) { mNotesList = notesList } <span class="hljs-comment"><span class="hljs-comment">/** *   View  ViewHolder  ,    . */</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewGroup: ViewGroup, i: Int)</span></span></span><span class="hljs-function">: ViewHolder </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> v = LayoutInflater.from(viewGroup.context).inflate(R.layout.note_item_layout, viewGroup, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ViewHolder(v); } <span class="hljs-comment"><span class="hljs-comment">/** *   View       i */</span></span> <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBindViewHolder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewHolder: ViewHolder, i: Int)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> note = mNotesList[i]; viewHolder.mNoteTitle.text = note.title; viewHolder.mNoteDate.text = formatDate(note.changeDate); } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getItemCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: Int </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> mNotesList.size } <span class="hljs-comment"><span class="hljs-comment">/** *   ViewHolder,    . */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ViewHolder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNoteTitle: TextView <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNoteDate: <span class="hljs-function"><span class="hljs-function">TextView </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">constructor</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(itemView: View)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">super</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(itemView)</span></span></span><span class="hljs-function"> </span></span>{ mNoteTitle = itemView.findViewById(R.id.tvItemNoteTitle) as TextView mNoteDate = itemView.findViewById(R.id.tvItemNoteDate) as TextView } } }</code> </pre><br></div></div><br><br>  In the adapter, we use the formatDate method.  It is used to format the date in the string: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@file</span></span>:JvmName(<span class="hljs-string"><span class="hljs-string">"DateUtils"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> imangazaliev.notelin.utils <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.text.SimpleDateFormat <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.* <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">formatDate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(date: Date?)</span></span></span><span class="hljs-function">: String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dateFormat = SimpleDateFormat(<span class="hljs-string"><span class="hljs-string">"yyyy-MM-dd HH:mm"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dateFormat.format(date) }</code> </pre><br><br>  This method is in the DateUtils.kt file and we can use it as a regular static method.  The difference from the static method here is that the method does not belong to the class, but to the package, and we do not need to write the class name before the method name.  In the annotation we indicate the name of the class through which we will access the method from Java.  For example, in Java, the melon method will be called like this: <br><br><pre> <code class="java hljs">String formattedDate = DateUtils.formatDate(date);</code> </pre><br><br>  In the onNotesLoaded method of our Activity we show our notes: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNotesLoaded</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notes: List&lt;Note&gt;)</span></span></span><span class="hljs-function"> </span></span>{ rvNotesList.adapter = NotesAdapter(notes) updateView() } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ rvNotesList.adapter.notifyDataSetChanged() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rvNotesList.adapter.itemCount == <span class="hljs-number"><span class="hljs-number">0</span></span>) { rvNotesList.visibility = View.GONE tvNotesIsEmpty.visibility = View.VISIBLE } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { rvNotesList.visibility = View.VISIBLE tvNotesIsEmpty.visibility = View.GONE } }</code> </pre><br><br>  If there are no notes, then we display the ‚ÄúNo Notes‚Äù message in TextView. <br><br>  As far as I know, there is no ‚Äúofficial‚Äù OnItemClickListener for handling clicks on RecycleView items.  Therefore, we will use our solution: <br><br><div class="spoiler">  <b class="spoiler_title">ItemClickSupport.kt</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemClickSupport</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constructor</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">recyclerView</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RecyclerView</span></span></span><span class="hljs-class">) </span></span>{ companion object { <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: RecyclerView)</span></span></span><span class="hljs-function"> </span></span>= view.getTag(R.id.item_click_support) as? ItemClickSupport ?: ItemClickSupport(view) <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeFrom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: RecyclerView)</span></span></span><span class="hljs-function">: ItemClickSupport? </span></span>{ val support = view.getTag(R.id.item_click_support) as? ItemClickSupport support?.detach(view) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> support } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ItemClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recyclerView: RecyclerView, position: Int, view: View)</span></span></span><span class="hljs-function"> } interface ItemLongClickListener </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLongClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recyclerView: RecyclerView, position: Int, view: View)</span></span></span><span class="hljs-function">: Boolean } </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">var</span></span></span><span class="hljs-function"> itemClickListener: ItemClickListener? </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> itemLongClickListener: ItemLongClickListener? = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> val onClickListener = View.OnClickListener { val holder = recyclerView.getChildViewHolder(it) itemClickListener?.onClick(recyclerView, holder.adapterPosition, it) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> val onLongClickListener = View.OnLongClickListener listener@{ val position = recyclerView.getChildViewHolder(it).adapterPosition <span class="hljs-keyword"><span class="hljs-keyword">return</span></span><span class="hljs-meta"><span class="hljs-meta">@listener</span></span> itemLongClickListener?.onLongClick(recyclerView, position, it) ?: <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> val attachListener = object : RecyclerView.OnChildAttachStateChangeListener { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChildViewAttachedToWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: View)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemClickListener != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { view.setOnClickListener(onClickListener) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (itemLongClickListener != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { view.setOnLongClickListener(onLongClickListener) } } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onChildViewDetachedFromWindow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: View)</span></span></span><span class="hljs-function"> </span></span>= Unit } init { recyclerView.setTag(R.id.item_click_support, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) recyclerView.addOnChildAttachStateChangeListener(attachListener) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnItemClickListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(listener: ItemClickListener)</span></span></span><span class="hljs-function">: ItemClickSupport </span></span>{ itemClickListener = listener <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnItemClickListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(listener: (RecyclerView, Int, View)</span></span></span><span class="hljs-function"> -&gt; Unit) </span></span>= setOnItemClickListener(object : ItemClickListener { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recyclerView: RecyclerView, position: Int, view: View)</span></span></span><span class="hljs-function"> </span></span>{ listener(recyclerView, position, view) } }) <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnItemLongClickListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(listener: ItemLongClickListener)</span></span></span><span class="hljs-function">: ItemClickSupport </span></span>{ itemLongClickListener = listener <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOnItemLongClickListener</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(block: (RecyclerView, Int, View)</span></span></span><span class="hljs-function"> -&gt; Boolean): ItemClickSupport </span></span>= setOnItemLongClickListener(object : ItemLongClickListener { <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLongClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(recyclerView: RecyclerView, position: Int, view: View)</span></span></span><span class="hljs-function">: Boolean </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> block (recyclerView, position, view) } }) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">detach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(view: RecyclerView)</span></span></span><span class="hljs-function"> </span></span>{ view.removeOnChildAttachStateChangeListener(attachListener) view.setTag(R.id.item_click_support, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) } }</code> </pre><br></div></div><br><br>  In the onCreate method of our Activity, we write: <br><br><pre> <code class="java hljs"> with(ItemClickSupport.addTo(rvNotesList)) { setOnItemClickListener { recyclerView, position, v -&gt; mPresenter.openNote(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span><span class="hljs-meta"><span class="hljs-meta">@MainActivity</span></span>, position) } setOnItemLongClickListener { recyclerView, position, v -&gt; mPresenter.showNoteContextDialog(position); <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } }</code> </pre><br><br>  The <b>with</b> function allows you not to write the name of the variable each time, but only to call methods on the object that we passed to it.  Please note that to get an Activity, I used not just <b>this</b> , but <a href="https://kotlinlang.org/docs/reference/this-expressions.html">this @ MainActivity</a> .  This is due to the fact that when using this in the with block, the object that we passed to the with function is returned.  With the usual click on the item, we turn to Activity, where we can view the text of our note.  With a long press, a context menu appears.  If you noticed, before the closing bracket I did not write the word <b>return</b> .  This is not an error, but a feature of the Kotlin language. <br><br>  Here is what happens when you click on the menu item in the presenter: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *       */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activity: Activity, position: Int)</span></span></span><span class="hljs-function"> </span></span>{ val intent = Intent(activity, NoteActivity::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">intent</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">putExtra</span></span></span><span class="hljs-class">("</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">note_id</span></span></span><span class="hljs-class">", </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">mNotesList</span></span></span><span class="hljs-class">[</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">].</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">activity</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">startActivity</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">intent</span></span></span><span class="hljs-class">) }</span></span></code> </pre><br><br>  We have not yet created the NoteActivity class, so the compiler will generate an error.  To solve this problem, you can create a NoteActivity class or comment out the code inside the openNote method altogether.  The NoteActivity :: class.java entry is similar to NoteActivity.class in Java.  Also note that we refer to the list not through the get (position) method, but through square brackets, like a regular array. <br><br>  When using the MVP library in your application, we need to get used to the fact that all actions from the View, such as the show / close dialog and others, must pass through the presenter.  Initially, this is not very familiar and inconvenient, but there is much more benefit from this, since we can be sure that our dialog box will not disappear anywhere when recreating the Activity. <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteContextDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(position: Int)</span></span></span><span class="hljs-function"> </span></span>{ viewState.showNoteContextDialog(position) } <span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteContextDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ viewState.hideNoteContextDialog() }</code> </pre><br><br>  I will not show the context menu code, delete and display information about the note because the article is very large.  But I think you get the general sense.  It should also be noted that the presenter's hideNoteContextDialog method should be invoked even when the dialog is closed via the back button or when you click on an area outside the dialog boundaries. <br><br>  When you click on FAB, a new note should be created: <br><br><pre> <code class="java hljs">fabButton.setOnClickListener { mPresenter.openNewNote(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) }</code> </pre><br><br>  To create a new note, we call the openNewNote function in the presenter: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">openNewNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(activity: Activity)</span></span></span><span class="hljs-function"> </span></span>{ val newNote = mNoteDao.createNote() mNotesList.add(newNote) sortNotesBy(getCurrentSortMethod()) openNote(activity, mNotesList.indexOf(newNote)) }</code> </pre><br><br>  The openNewNote method uses the openNote we created earlier, to which we pass the Context and the position of the note in the list. <br><br><br><h3>  We implement a search for notes </h3><br><br><img width="40%" src="https://habrastorage.org/files/3db/047/107/3db047107fe4480aa862a4325e011750.png"><br><br>  Let's add a search for notes.  Create a main.xml file in the res / menu folder: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:app</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/action_search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:icon</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@android:drawable/ic_menu_search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:actionViewClass</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.support.v7.widget.SearchView"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">app:showAsAction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"always"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  In the MainActivity we write: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(menu: Menu)</span></span></span><span class="hljs-function">: Boolean </span></span>{ menuInflater.inflate(R.menu.main, menu) initSearchView(menu) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initSearchView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(menu: Menu)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchViewMenuItem = menu.findItem(R.id.action_search); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> searchView = searchViewMenuItem.actionView as SearchView; searchView.onQueryChange { query -&gt; mPresenter.search(query) } searchView.setOnCloseListener { mPresenter.search(<span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> } }</code> </pre><br><br>  When changing the text in the search field, we pass a string from the field to the presenter, and then show the results in the list.  In fact, SearchView has no onQueryChange method, it was added by the KAndroid library. <br><br>  Implement a search in the presenter: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">search</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(query: String)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (query.equals(<span class="hljs-string"><span class="hljs-string">""</span></span>)) { viewState.onSearchResult(mNotesList) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { val searchResults = mNotesList.filter { it.title!!.startsWith(query, ignoreCase = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) } viewState.onSearchResult(searchResults) } }</code> </pre><br><br>  Notice how beautiful, in one line, we implemented a search on the list using the filter and lambda methods.  In Java, the same functionality would take 6-7 lines.  It remains to display the search results: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onSearchResult</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notes: List&lt;Note&gt;)</span></span></span><span class="hljs-function"> </span></span>{ rvNotesList.adapter = NotesAdapter(notes) }</code> </pre><br><br><br><h3>  Implement note sorting </h3><br><br>  And the last step in creating the main screen is sorting notes.  Add the following lines to res / menu / main.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/sort_by"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/menuSortByName"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/sort_by_title"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/menuSortByDate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@string/sort_by_date"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">menu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">item</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now we need to handle clicking on the menu items: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: MenuItem)</span></span></span><span class="hljs-function">: Boolean </span></span>{ when (item.itemId) { R.id.menuSortByName -&gt; mPresenter.sortNotesBy(MainPresenter.SortNotesBy.NAME) R.id.menuSortByDate -&gt; mPresenter.sortNotesBy(MainPresenter.SortNotesBy.DATE) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onOptionsItemSelected(item) }</code> </pre><br><br>  The <b>when clause</b> is a more functional counterpart to switch-case in Java.  Sort code in MainPresenter: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** *   */</span></span> <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sortNotesBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sortMethod: SortNotesBy)</span></span></span><span class="hljs-function"> </span></span>{ mNotesList.sortWith(sortMethod) viewState.updateView() }</code> </pre><br><br><br><h1>  Screen with content notes </h1><br><br>  Now we need to create a screen with the contents of the notes.  Here the user can view / edit the title and text of the note, save or delete it, as well as view information about the note. <br><br><br><h3>  Create a NoteView and NotePresenter </h3><br><br><img width="40%" src="https://habrastorage.org/files/b15/984/b7a/b15984b7aa4a405fb5495ac25dc51f88.png"><br><br>  The screen contains only three views: <br><br>  -Headline <br>  -Date of last change <br>  -Text notes <br><br>  And here is the markup itself: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/etTitle"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:singleLine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#EEEEEE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#212121"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingTop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:hint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/tvNoteDate"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:singleLine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#EEEEEE"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#212121"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingBottom</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EditText</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@+id/etText"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:textColor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#000000"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"start"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:hint</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@null"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:paddingLeft</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10dp"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  At the beginning of the article, I briefly mentioned Anko.  The library allows you to significantly reduce the code without losing readability.  So, for example, our markup would look when using Anko: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppCompatActivity</span></span></span><span class="hljs-class">() </span></span>{ <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) MyActivityUI().setContentView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyActivityUI</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnkoComponent</span></span></span><span class="hljs-class"> </span></span>{ companion object { val ET_TITLE_ID = View.generateViewId() val TV_NOTE_DATE_ID = View.generateViewId() val ET_TEXT_ID = View.generateViewId() } <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ui: AnkoContext&lt;MainActivit&gt;)</span></span></span><span class="hljs-function"> </span></span>= with(ui) { verticalLayout { editText { id = ET_TITLE_ID singleLine = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> backgroundColor = <span class="hljs-number"><span class="hljs-number">0xEE</span></span>.gray.opaque textColor = <span class="hljs-number"><span class="hljs-number">0x21</span></span>.gray.opaque leftPadding = dip(<span class="hljs-number"><span class="hljs-number">10</span></span>) topPadding = dip(<span class="hljs-number"><span class="hljs-number">10</span></span>) bottomPadding = dip(<span class="hljs-number"><span class="hljs-number">5</span></span>) hint = <span class="hljs-string"><span class="hljs-string">""</span></span> }.lparams(matchParent, wrapContent) textView { id = TV_NOTE_DATE_ID singleLine = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> backgroundColor = <span class="hljs-number"><span class="hljs-number">0xEE</span></span>.gray.opaque textColor = <span class="hljs-number"><span class="hljs-number">0x21</span></span>.gray.opaque leftPadding = dip(<span class="hljs-number"><span class="hljs-number">10</span></span>) bottomPadding = dip(<span class="hljs-number"><span class="hljs-number">10</span></span>) }.lparams(matchParent, wrapContent) editText { id = ET_TEXT_ID textColor = Color.BLACK gravity = Gravity.START hint = <span class="hljs-string"><span class="hljs-string">""</span></span> background = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> leftPadding = dip(<span class="hljs-number"><span class="hljs-number">10</span></span>) } } } }</code> </pre><br><br>  But let's not get distracted and start writing the code.  First we need to create a View: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteView</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(note: Note)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNoteSaved</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNoteDeleted</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteInfoDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(noteInfo: String)</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteInfoDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNoteDeleteDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hideNoteDeleteDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> }</span></span></code> </pre><br><br>  Implement NoteView in NoteActivity: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteActivity</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpAppCompatActivity</span></span></span><span class="hljs-class">(), </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteView</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@InjectPresenter</span></span> lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mPresenter: <span class="hljs-function"><span class="hljs-function">NotePresenter override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(savedInstanceState: Bundle?)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState) setContentView(R.layout.activity_note) val noteId = intent.extras.getLong(<span class="hljs-string"><span class="hljs-string">"note_id"</span></span>, -<span class="hljs-number"><span class="hljs-number">1</span></span>) mPresenter.showNote(noteId) } }</code> </pre><br><br>  In onCreate, we retrieve the id of the note so that the presenter gets the note from the database and passes the data to the View.  Create a presenter: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@InjectViewState</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotePresenter</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MvpPresenter</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NoteView</span></span></span><span class="hljs-class">&gt;() </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNoteDao: NoteDao lateinit <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mNote: Note init { NotelinApplication.graph.inject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) } <span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(noteId: Long)</span></span></span><span class="hljs-function"> </span></span>{ mNote = mNoteDao.getNoteById(noteId) viewState.showNote(mNote) } }</code> </pre><br><br>  Do not forget to add the following line to the AppComponent class: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(notePresenter: NotePresenter)</span></span></span></span></code> </pre><br><br>  Show our note: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">showNote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(note: Note)</span></span></span><span class="hljs-function"> </span></span>{ tvNoteDate.text = DateUtils.formatDate(note.changeDate) etTitle.setText(note.title) etText.setText(note.text) }</code> </pre><br><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Implement saving notes </font></font></h3><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To save a note, we need to select the corresponding item in the menu. </font><font style="vertical-align: inherit;">Create a </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">res / menu / note.xml file</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="java hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;menu xmlns:android=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span> xmlns:app=<span class="hljs-string"><span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span> &gt; &lt;item android:id=<span class="hljs-string"><span class="hljs-string">"@+id/menuSaveNote"</span></span> android:title=<span class="hljs-string"><span class="hljs-string">"@string/save"</span></span> app:showAsAction=<span class="hljs-string"><span class="hljs-string">"never"</span></span> /&gt; &lt;/menu&gt;</code> </pre><br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateOptionsMenu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(menu: Menu)</span></span></span><span class="hljs-function">: Boolean </span></span>{ menuInflater.inflate(R.menu.note, menu) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }    Activity: <span class="hljs-function"><span class="hljs-function">override fun </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onOptionsItemSelected</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: MenuItem)</span></span></span><span class="hljs-function">: Boolean </span></span>{ when (item.itemId) { R.id.menuSaveNote -&gt; mPresenter.saveNote(etTitle.text.toString(), etText.text.toString()) } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onOptionsItemSelected(item) }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Again, I did not give the code to delete and display information about the note. </font><font style="vertical-align: inherit;">When viewing the source code, you may notice that in addition to the note identifier, I passed the position of the note in the list to NoteActivity. </font><font style="vertical-align: inherit;">This is necessary so that when you delete a note on the note viewing screen, it is also removed from the list. </font><font style="vertical-align: inherit;">To implement this functionality, I used EventBus. </font><font style="vertical-align: inherit;">And again, I did not give the code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That's all: notes are added, edited and deleted. </font><font style="vertical-align: inherit;">We can also search and sort notes. </font><font style="vertical-align: inherit;">Be sure to look at the full source code, the link to which I gave at the end of the article, to better understand how everything works.</font></font><br><br><br><h1>  Thanks </h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, we must not forget about the people who helped me in writing this article. I would like to thank Habrayuser Yuri Shmakov (@senneco) for helping with his Moxy library and for helping with other issues. Also, I want to say thank you to JetBrains employee Roman Belov (@belovrv) for reviewing the article and for providing the code on Anko. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UPD: I</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> also wanted to say thanks to </font></font><a href="https://habrahabr.ru/users/sirikid/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sirikid</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for the EPIC COMMIT, thanks to which I redid an impressive part of the code using the features of Kotlin.</font></font><br><br><br><h1>  Conclusion </h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope this article was able to convince you that writing applications to Kotlin is not difficult, and maybe even easier than in Java. </font><font style="vertical-align: inherit;">Of course, there may be bugs that JetBrains staff members quickly fix. </font><font style="vertical-align: inherit;">If you have any questions, you can ask them directly to the developers on the </font></font><a href="https://kotlinlang.slack.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Slack channel</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You can also read Kotlin development articles </font></font><a href="http://java-help.ru/category/android-kotlin/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Project Source Code: </font></font><a href="https://github.com/ImangazalievM/Notelin"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Notelin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font></div><p>Source: <a href="https://habr.com/ru/post/275255/">https://habr.com/ru/post/275255/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275239/index.html">System plug-ins and modules in Unreal Engine 4</a></li>
<li><a href="../275245/index.html">The best gift book for well-read fans of JavaScript</a></li>
<li><a href="../275247/index.html">Almost perfect computer security may be closer than you think.</a></li>
<li><a href="../275249/index.html">The problem of duplication and obsolescence of knowledge in mock objects or Integration tests is good</a></li>
<li><a href="../275251/index.html">Notes on SQL and relational algebra</a></li>
<li><a href="../275259/index.html">Bareos: tapes, Hyper-V and more</a></li>
<li><a href="../275265/index.html">The digest of interesting materials for the mobile # 136 developer (on January 11-17)</a></li>
<li><a href="../275267/index.html">Personal account for dealers in 5 minutes</a></li>
<li><a href="../275269/index.html">Parallel Sequential Scan Commited</a></li>
<li><a href="../275271/index.html">The story of one integration, or how we stopped worrying and fell in love with InterSystems Ensemble</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>