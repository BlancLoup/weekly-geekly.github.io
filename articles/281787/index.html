<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The source code of the bot Gozi leaked to the network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Subj, the source package of the Gozi ISFB bot (aka Ursnif) is publicly available and is available to everyone. The Ursnif malware is a serious enough ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The source code of the bot Gozi leaked to the network</h1><div class="post__text post__text-html js-mediator-article">  Subj, the source package of the Gozi ISFB bot (aka Ursnif) is publicly available and is available to everyone.  The Ursnif malware is a serious enough tool for working with http and https traffic on a victim's computer; it contains 32-bit and 64-bit payload components for integrating them into various working processes of web browsers such as Google Chrome, Microsoft Internet Explorer , Mozilla Firefox, as well as the preferred Services Manager service process. <br><br><img src="https://habrastorage.org/files/378/c21/032/378c210322aa4ca4a2bbca27904b47ed.jpeg"><br><br>  Ursnif began to be actively used by cyber criminals five years ago, and its very first versions were released back in 2008. The attackers actively used the Blackhole exploit kit exploit to distribute the Trojan droppers.  Recently we <a href="https://habrahabr.ru/company/eset/blog/281655/">wrote</a> that the author of Blackhole himself received seven years in prison.  Gozi or Ursnif was used by attackers as a thief of various information on the victim's system, including credentials of services such as FTP, Telnet, POP3, and IMAP. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The set of source texts contains a fairly detailed description of the functions performed by the bot, as well as the purpose of its various components and files.  Operators manage Ursnif through a command C &amp; C server, passing it instructions.  The configuration files and command sets passed to the bot are signed using the asymmetric RSA algorithm.  If such files are incorrectly signed, the bot discards the data sent to it. <br><br><img src="https://habrastorage.org/files/be6/c29/093/be6c290938064843a8cb535ceb247aa0.png"><br>  Fig.  Information about the part of the Ursnif project from the Readme file. <br><br>  The bot uses encryption of droppers and DLL files used as payloads, which complicates their analysis by antivirus analysts.  As an example, the following Gozi files. <br><br>  Dropper file <a href="https://www.virustotal.com/file/4f48554c99445b40001517e9c533f76d863b79151baf51597b7f7557829c22a0/analysis/">link</a> . <br>  Decrypted dropper body <a href="https://www.virustotal.com/file/3e4c5c963cacb6ba08eee570ba4f8feac3d2a2878ba27e8daa4226aac0f29af0/analysis/">link</a> . <br>  Extracted 32bit dll file <a href="https://www.virustotal.com/file/4df409983e91d12929d5e2957029ab29225e7bc0926bc2b7bb38401b1c871da9/analysis/1342278900//">link</a> . <br>  Extract 64bit dll file <a href="https://www.virustotal.com/file/3f2bfd295014c0723d1c741c1a6704b27ee67d9544e154e2ba80b3fc34aeb198/analysis/1342278955/">link</a> . <br><br>  Gozi uses the following trusted registry key to register the HKLM \ System \ CurrentControlSet \ Session Manager \ AppCertDlls payload.  It also intercepts a number of system functions of various Windows libraries to gain control over system functions: <br><br><ul><li>  <i>CreateProcessAsUser (A / W)</i> </li><li>  <i>CreateProcess (A / W)</i> </li><li>  <i>CryptGetUserKey</i> </li><li>  <i>InternetReadFile</i> </li><li>  <i>HttpSendRequest (A / W)</i> </li><li>  <i>InternetReadFileEx (A / W)</i> </li><li>  <i>InternetCloseHandle</i> </li><li>  <i>InternetQueryDataAvailable</i> </li></ul><br>  Since Gozi is embedded in the Windows Explorer process, it can control the creation of all the processes of interest to it, including the aforementioned web browsers, by intercepting the <i>CreateProcess</i> and <i>CreateProcessAsUser</i> functions.  An example of such an interception is shown below. <br><br><img src="https://habrastorage.org/files/b4e/f26/221/b4ef262217b0478caa15943617507269.png"><br>  Fig.  Part of the source code of the <i>kernel32! CreateProcess</i> hook function.  The presence of the _KERNEL_MODE_INJECT macro indicates a possible rootkit component of the bot. <br><br><img src="https://habrastorage.org/files/518/75b/582/51875b582e634502861048b72e432f65.png"><br>  Fig.  Information about the assembly project. <br><br>  According to IBM Security researchers, a hybrid of this malicious program, the Nymaim Trojan, has already been created on the basis of the source code of Gozi, more about this can be found <a href="https://securityintelligence.com/meet-goznym-the-banking-malware-offspring-of-gozi-isfb-and-nymaim/">here</a> .  ESET antivirus products detect Gozi as <b>Win32 / PSW.Papras</b> . </div><p>Source: <a href="https://habr.com/ru/post/281787/">https://habr.com/ru/post/281787/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281775/index.html">GECOn 2016: First Gomel IT Conference (April 24)</a></li>
<li><a href="../281777/index.html">Prediction of the outflow of players from World of Tanks from Yandex Data Factory. Lecture for the Small ShAD</a></li>
<li><a href="../281779/index.html">Apple discontinues QuickTime support for Windows</a></li>
<li><a href="../281783/index.html">Unity and MVC: how to pump game development</a></li>
<li><a href="../281785/index.html">Freedom to the tests</a></li>
<li><a href="../281789/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ207 (11 - 17 April 2016)</a></li>
<li><a href="../281791/index.html">Spring meeting of Pattern Recognition and Computer Vision Colloquium 2016 in Prague: how it was</a></li>
<li><a href="../281793/index.html">How a secure printing system is implemented on a follow-me printing device</a></li>
<li><a href="../281797/index.html">Integration of two Dynamics CRM Online tenants using the Azure Service Bus and the Azure Cloud Service</a></li>
<li><a href="../281799/index.html">Hadoop performance comparison on DAS and Isilon</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>