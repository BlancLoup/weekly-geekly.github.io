<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CUBA 7: what's new?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Three years ago we announced the release of CUBA 6 . That version became revolutionary: instead of a closed proprietary license, we began to distribut...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CUBA 7: what's new?</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/f8/-f/_k/f8-f_kslug-6yzi1yx-ui1e51gy.png"></p><br><p>  Three years ago we announced the release of <a href="https://www.cuba-platform.com/blog/whats-new-in-cuba-platform-6-0-and-studio-2-0">CUBA 6</a> .  That version became revolutionary: instead of a closed proprietary license, we began to distribute the framework freely, under the Apache 2.0 license.  At that time, we could not even imagine how closely this would affect the development of the framework in the long term.  The CUBA community began to grow exponentially, and we were faced with all possible (and sometimes impossible) ways to use the framework.  Now we bring to your attention <a href="https://www.cuba-platform.com/blog/cuba-7-the-new-chapter">CUBA 7</a> .  We hope that this version will make the development even easier and more pleasant for all members of the community: from beginners who just got acquainted with CUBA and Java, to experienced developers, who have more than one completed project of a large company. </p><a name="habracut"></a><br><h2 id="instrumenty-razrabotki">  Development tools </h2><br><p>  Much of the success of CUBA is due to <a href="https://www.cuba-platform.com/development-tools">CUBA Studio</a> .  This development environment significantly simplified the execution of typical tasks that are done in every Java project, reducing them to creating simple configurations in visual designers.  You do not need to know all the attributes of the Persistence API annotations, the Gradle syntax or the subtleties of the Spring configuration to develop a complete and multifunctional CRUD application ‚Äî CUBA Studio undertakes the creation of sample code. </p><br><p><img src="https://habrastorage.org/webt/lr/5f/8g/lr5f8gtzh5ls_zvskmqccmrccpc.png"></p><br><p>  Studio was a separate web application, which caused a number of significant limitations: </p><br><ul><li>  Firstly, Studio was not a full-fledged IDE, so developers had to switch between Studio and IntelliJ IDEA or Eclipse in order to develop business logic and still use easy navigation, code completion and other necessary things, which strained a little. </li><li>  Secondly, all this magical simplicity was built on a huge amount of work that we spent on writing algorithms for parsing and generating the source code.  The implementation of even more advanced functionality would mean a transition to the development of a full-fledged IDE - too ambitious idea for us. </li></ul><br><p>  We decided to rely on another giant to overcome these limitations and built a Studio based on IntelliJ IDEA.  Now you can install Studio both as a separate application (IntelliJ IDEA Bundle) and as a plugin for IDEA. </p><br><p><img src="https://habrastorage.org/webt/bh/qk/kg/bhqkkgmeebyr6fjyecadq1ln_cm.png"></p><br><p>  And it gives us new opportunities: </p><br><ul><li>  Support for other JVM languages ‚Äã‚Äã(and, above all, Kotlin) </li><li>  Improved Hot deploy </li><li>  Intuitive navigation throughout the project </li><li>  More clever tips and code generators </li></ul><br><p>  Currently, we are actively developing a new version of Studio - we transfer functionality from the old version and add new things using the functionality of the IntelliJ platform.  In the near future, we are going to translate CUBA-specific editors to IntelliJ components and improve navigation through the project code. </p><br><h2 id="obnovlenie-tehnologicheskogo-steka">  Technology stack update </h2><br><p>  By tradition, the technological stack at the heart of CUBA has been updated to new versions: Java 8/11, Vaadin 8, Spring 5. </p><br><p>  By default, new projects use Java 8, but you can specify the Java version by adding the following code to the build.gradle file: </p><br><pre><code class="plaintext hljs">subprojects { sourceCompatibility = JavaVersion.VERSION_11 targetCompatibility = JavaVersion.VERSION_11 }</code> </pre> <br><p>  An especially big problem was the upgrade to Vaadin 8, which greatly changed the data binding API.  Fortunately, CUBA shields developers from internal Vaadin components, wrapping them in their own API.  The CUBA team did a great job updating the internal components without changing the CUBA API.  This means that compatibility is fully preserved, and you can use all the new features of Vaadin 8 immediately after migrating the project to CUBA 7 without doing any refactoring. </p><br><p>  A complete list of updated dependencies is available in the <a href="http://files.cuba-platform.com/cuba/release-notes/7.0/">list of changes</a> . </p><br><h2 id="novyy-api-ekranov">  New Screen API </h2><br><p>  This section could be called ‚Äúthe first API for working with screens‚Äù, since CUBA never had an officially declared API for working with screens in the web client module.  This happened historically, including due to some prerequisites that arose at the initial stage: </p><br><ul><li>  The declarative-oriented approach - everything that can be described declaratively, it was necessary to declare it in the screen descriptor, and not to do it in the controller code. </li><li>  Standard screens (browser and editor) provided some common functionality, and there was no need to change it. </li></ul><br><p><img src="https://habrastorage.org/webt/vd/ym/le/vdymlejgwnh3eco6adm3ly5smmi.png"></p><br><p>  Already at the time when the first thousand participants joined our community, we understood how many different requirements are being placed on the ‚Äústandard‚Äù CRUD screens.  And all these requirements were far beyond the initial functionality.  Nevertheless, for a long time we could satisfy the requests for the implementation of non-standard screen behavior without changing the API - thanks to another architectural principle laid down at the initial stage: Open Inheritance.  In fact, Open Inheritance means that you can rewrite any public or protected method of the main class to customize its behavior according to your needs.  This may seem like a wonderful cure-all, but in fact you could not rely on it even in the short term.  What if the override method is renamed, deleted, or simply never will be used in future versions of the framework? </p><br><p>  So in response to the growing demand from the community, we decided to introduce a new API of screens.  This API provides clear (without hidden magic) flexible and easy-to-use extensibility points that are guaranteed not to change for a long time. </p><br><h3 id="deklaraciya-ekranov">  Screen Declaration </h3><br><p>  In CUBA 7, declaring screens is extremely simple: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"new-screen"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// screen id public class NewScreen extends Screen { }</span></span></code> </pre> <br><p>  In the example above, you can see that the screen identifier is clearly defined just above the controller class declaration.  In other words, the screen ID and controller class now match each other in a unique way.  So, we have good news: now the screens can be safely accessed directly by the type of controller: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ScreenBuilders screenBuilders; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeClose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BeforeCloseEvent event)</span></span></span><span class="hljs-function"> </span></span>{ screenBuilders.screen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .withScreenClass(SomeConfirmationScreen.class) .build() .show(); }</code> </pre> <br><p>  The screen handle becomes an optional part of the screen.  The UI can be created programmatically or declared as an xml screen descriptor, which is defined by the <code>@UiDescriptor</code> annotation over the controller class.  This makes controllers and markup much easier to read and understand - this approach is very similar to the one used in Android development. </p><br><p>  Previously, it was also required to register a screen descriptor in the web-screens.xml file and assign it an identifier.  In CUBA 7, this file is saved for compatibility, but a new way of creating screens does not require such registration. </p><br><h3 id="zhiznennyy-cikl-ekrana">  Screen life cycle </h3><br><p>  The new API presents simple and self-explanatory screen life cycle events: </p><br><ul><li>  Init </li><li>  AfterInit </li><li>  BeforeShow </li><li>  Aftershow </li><li>  BeforeClose </li><li>  AfterClose </li></ul><br><p>  All events in CUBA 7 can be subscribed as follows: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"new-screen"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InitEvent event)</span></span></span><span class="hljs-function"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBeforeShow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BeforeShowEvent event)</span></span></span><span class="hljs-function"> </span></span>{ } }</code> </pre> <br><p>  Compared to the old approach, the new API shows that we do not overlap hook methods that are implicitly called during initialization, but explicitly define the logic for handling a specific, defined screen life cycle event. </p><br><h3 id="obrabotka-sobytiy-i-funkcionalnye-delegaty">  Event handling and functional delegates </h3><br><p>  In the previous section, we learned how to subscribe to life cycle events, but what about the other components?  Is it still necessary to put all the necessary listeners in one heap when initializing the screen, in the init () method, as it was in versions 6.x?  The new API is quite uniform, so you can subscribe to other events as you would to screen life cycle events. </p><br><p>  Consider a simple example with two UI elements: a button and a field for displaying the amount of money in a certain currency;  The XML descriptor will look like this: </p><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.haulmont.com/cuba/screen/window.xsd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"msg://caption"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">messagesPack</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.company.demo.web"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spacing</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currencyField</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"currencyField"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currency</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">currencyLabelPosition</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LEFT"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"calcPriceBtn"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">caption</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Calculate Price"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hbox</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">layout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">window</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  When you click on the button, we call the service from the backend, which returns a number, we write it in the amount field.  This field should change the style depending on the price value. </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PricingService pricingService; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span>(<span class="hljs-string"><span class="hljs-string">"calcPriceBtn"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCalcPriceBtnClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Button.ClickEvent event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.setValue(pricingService.calculatePrice()); } <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span>(<span class="hljs-string"><span class="hljs-string">"currencyField"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPriceChange</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HasValue.ValueChangeEvent&lt;BigDecimal&gt; event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.setStyleName(getStyleNameByPrice(event.getValue())); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getStyleNameByPrice</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal price)</span></span></span><span class="hljs-function"> </span></span>{ ... } }</code> </pre> <br><p>  In the above example, we see two event handlers: one is called when the button is pressed, and the other is started when the currency field changes its value - everything is simple. </p><br><p>  Now imagine that we need to check the price and make sure that its value is positive.  This can be done ‚Äúin the forehead‚Äù - add a validator during screen initialization: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Subscribe</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InitEvent event)</span></span></span><span class="hljs-function"> </span></span>{ currencyField.addValidator(value -&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(<span class="hljs-string"><span class="hljs-string">"Price should be greater than zero"</span></span>); }); } }</code> </pre> <br><p>  In real applications, the initialization method after some time will be a mess of initializers, validators, listeners, etc.  To solve this problem, CUBA has a useful <code>@Install</code> annotation.  Let's see how she can help in our case: </p><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@UiController</span></span>(<span class="hljs-string"><span class="hljs-string">"demo_MyFirstScreen"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@UiDescriptor</span></span>(<span class="hljs-string"><span class="hljs-string">"my-first-screen.xml"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyFirstScreen</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Screen</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CurrencyField&lt;BigDecimal&gt; currencyField; <span class="hljs-meta"><span class="hljs-meta">@Install</span></span>(to = <span class="hljs-string"><span class="hljs-string">"currencyField"</span></span>, subject = <span class="hljs-string"><span class="hljs-string">"validator"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">currencyFieldValidator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(BigDecimal value)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value.compareTo(BigDecimal.ZERO) &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationException(<span class="hljs-string"><span class="hljs-string">"Price should be greater than zero"</span></span>); } }</code> </pre> <br><p>  In fact, we delegate the logic of validating a currency field to the currencyFieldValidator method in the screen.  This may seem a bit complicated at first glance, however, developers surprisingly quickly got used to this method of adding functionality and immediately started using it. </p><br><h3 id="postroiteli-ekranov-notifikacii-dialogi">  Screen builders, notifications, dialogs </h3><br><p><img src="https://habrastorage.org/webt/mo/ni/n-/monin-pixoctyntukkkflsdgvc4.png"></p><br><p>  CUBA 7 has a set of useful components with a convenient API: </p><br><ul><li>  <strong>ScreenBuilders</strong> integrates fluent factories to create standard screens for viewing and editing entities, as well as custom screens.  The example below shows how you can open one screen from another.  Note that the build () method immediately returns the screen of the desired type without the need for a cast: <br><pre> <code class="java hljs">CurrencyConversions currencyConversions = screenBuilders.screen(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) .withScreenClass(CurrencyConversions.class) .withLaunchMode(OpenMode.DIALOG) .build(); currencyConversions.setBaseCurrency(Currency.EUR); currencyConversions.show();</code> </pre> </li><li>  The <strong>Screens</strong> component provides a lower level of abstraction for creating and displaying screens, unlike the <em>ScreenBuilders API</em> .  It also provides access to information about all open screens in your CUBA application ( <em>Screens # getOpenedScreens</em> ), if you suddenly need to go through them all in one cycle. </li><li>  The <strong>Notifications</strong> and <strong>Dialogs components</strong> provide a convenient and literally self-documenting API.  The following is an example of creating and displaying a dialog box and notification: <br><pre> <code class="java hljs">dialogs.createOptionDialog() .withCaption(<span class="hljs-string"><span class="hljs-string">"My first dialog"</span></span>) .withMessage(<span class="hljs-string"><span class="hljs-string">"Would you like to thank CUBA team?"</span></span>) .withActions( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogAction(DialogAction.Type.YES).withHandler(e -&gt; notifications.create() .withCaption(<span class="hljs-string"><span class="hljs-string">"Thank you!"</span></span>) .withDescription(<span class="hljs-string"><span class="hljs-string">"We appreciate all community members"</span></span>) .withPosition(Notifications.Position.MIDDLE_CENTER) .withHideDelayMs(<span class="hljs-number"><span class="hljs-number">3000</span></span>) .show()), <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DialogAction(DialogAction.Type.CANCEL) ) .show();</code> </pre> </li></ul><br><h3 id="privyazka-dannyh">  Data binding </h3><br><p>  CUBA provides extremely fast UI development for the back office, not only through advanced visual development tools and a powerful code generation system, but also thanks to a rich set of components available directly from the box.  These components just need to know what data they are working with, and the rest will be done automatically.  For example, drop-down lists, calendars, tables with embedded CRUD operations, and so on. </p><br><p>  Prior to version 7, data binding was carried out through the so-called datasource, objects that wrap one or more entities for their reactive binding to components.  This approach worked very well, but in terms of implementation it was a monolith.  Monolithic architecture is usually problematic to tune, so in CUBA 7 this huge cobblestone was divided into three components for working with data: </p><br><ul><li>  Data loader (data loader) is a data provider for data containers.  The loader does not store data, it simply transfers all the necessary request parameters to the data warehouse and places the resulting data in data containers. </li><li>  Data container (data container) saves the loaded data (one or several entities) and provides them to the data components: all changes in these entities are transferred to the corresponding components, and vice versa, all changes in the components will lead to corresponding changes in the entities lying in the data container. </li><li>  Datacontext (data context) is a class that tracks changes and saves all changed entities.  Tracked entities are marked as "dirty" whenever they change their attributes, and the DataContext saves dirty instances to the Middleware when its commit () method is called. </li></ul><br><p>  Thus, the flexibility to work with data.  Artificial example: the loader can select data in the UI from the RDBMS, and the context can save changes to the REST service. </p><br><p>  In CUBA 6.x, you will need to write your own datasource, which can work with RDBMS and REST.  In CUBA 7, you can take a standard loader that can work with a database and write only your own context implementation for working with REST. </p><br><p>  Components for working with data can be declared in screen descriptors or created programmatically using a specialized factory, DataComponents. </p><br><h3 id="prochee">  Other </h3><br><p>  Whew ... The most significant parts of the new screen API are described, so let's briefly list other important functions at the web client level: </p><br><ul><li>  <strong>URL history and navigation</strong> .  This feature solves a very common SPA problem ‚Äî not always the correct behavior of the back button in a web browser.  Now an easy way to assign routes to application screens is provided and allows the API to display the current screen status in a URL. </li><li>  <strong>Form instead of FieldGroup</strong> .  <a href="https://doc.cuba-platform.com/manual-6.10/gui_FieldGroup.html">FieldGroup</a> is a component for displaying and changing fields of a single entity.  It displays the UI for the field in runtime.  In other words, if there is a Date field in the entity, it will be displayed as a <em><a href="https://doc.cuba-platform.com/manual-6.10/gui_DateField.html">DateField</a></em> .  However, if you want to work with this field programmatically, you will need to enter it into the screen controller and manually bring it to the correct type ( <em>DateField in our example</em> ).  If we later change the field type to another, then our application will crash at runtime.  The form solves this problem by explicitly declaring the field type.  More information about the component can be found <a href="https://doc.cuba-platform.com/manual-7.0/gui_Form.html">here</a> . </li><li>  <strong>The integration of third-party JavaScript components is</strong> greatly simplified; read the <a href="https://doc.cuba-platform.com/manual-7.0/jsComponent.html">documentation</a> for embedding custom JavaScript components in the CUBA application. </li><li>  <strong>HTML / CSS</strong> attributes can now be easily defined directly from the xml screen descriptor or set programmatically.  More information can be found <a href="https://doc.cuba-platform.com/manual-7.0/gui_attributes.html">here</a> . </li></ul><br><h2 id="novye-vozmozhnosti-bekend-modulya">  New features backend module </h2><br><p>  The previous section on the new screen API turned out to be more than I expected, so in this section I will be brief. </p><br><h3 id="sobytie-entity-changed">  Entity Changed Event </h3><br><p>  The Entity Changed event is an event in the Spring application that runs when an entity enters the data store, physically fits, and is in a step from commit.  When processing this event, you can configure additional checks (for example, check the availability of goods in stock before order confirmation) and change the data (for example, recalculate totals) right before they are visible to other transactions (of course, if you have a level isolation read committed).  This event may also be the last opportunity to abort a transaction, throwing an exception, which can be useful in some tricky cases. </p><br><p>  There is also a way to handle the Entity Changed event immediately after the commit. </p><br><p>  You can look at an example in this <a href="https://doc.cuba-platform.com/manual-7.0/entityChangedEvent.html">chapter of the documentation</a> . </p><br><h3 id="tranzakcionnyy-menedzher-dannyh">  Transactional Data Manager </h3><br><p>  When developing an application, we usually work with detached entities - those that are not in the context of any transaction.  However, working with detached entities is not always possible, especially when you need to fully comply with ACID requirements - this is the case when you can use transactional data manager.  He is very similar to the usual manager, but differs in the following aspects: </p><br><ul><li>  He can join an existing transaction (being called in the context of this transaction) or create his own transaction. </li><li>  It does not have a commit method, but there is a save method, which does not lead to an immediate commit, but waits until the current transaction is committed. </li></ul><br><p>  Here is <a href="https://doc.cuba-platform.com/manual-7.0/transactionalDataManager.html">an example of</a> its use. </p><br><h3 id="obratnye-vyzovy-jpa">  JPA callbacks </h3><br><p>  Finally, CUBA 7 supports JPA callbacks.  In order not to repeat known materials, for which these callbacks can be used, I will simply leave a <a href="https://docs.oracle.com/cd/E16439_01/doc.1013/e13981/undejbs003.htm">link</a> here.  In this article, the topic kollbekov fully disclosed. </p><br><h2 id="kak-naschet-sovmestimosti">  How about compatibility? </h2><br><p><img src="https://habrastorage.org/webt/tk/fu/lb/tkfulbguaccnmhsisnhgsgepteg.png"></p><br><p>  A fair question with any major release, especially when there are so many critical changes!  We developed all of these new features and APIs with backward compatibility: </p><br><ul><li>  The old API is supported in CUBA 7 and under the hood is implemented through a new one :) </li><li>  We also provided adapters for data binding through the old API.  These adapters will work fine for screens created according to the old scheme. </li></ul><br><p>  The good news is that the migration process from version 6 to 7 should be pretty simple. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  Concluding the technical review, I want to note that there are other important innovations, especially in the field of licensing: </p><br><ul><li>  The 10 entity limit for Studio is now removed. </li><li>  Add-ons Reporting, BPM, Charts and Maps and Full text search are now free and open source. </li><li>  The commercial version of Studio adds convenience to the development using visual designers of entities, screens, menus, and other platform elements, while the free version is focused on working with code. </li><li>  ,    6.x       Platform  Studio  ! </li></ul><br><p> ,            .  ,     7!       <a href="http://files.cuba-platform.com/cuba/release-notes/7.0/"> </a> . <br></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/447538/">https://habr.com/ru/post/447538/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447522/index.html">What is useful you can get out of the logs of the workstation based on Windows</a></li>
<li><a href="../447526/index.html">Your bike to sync MariaDB and Sphinx</a></li>
<li><a href="../447528/index.html">Who is responsible for the quality?</a></li>
<li><a href="../447530/index.html">OceanLotus: Malvari update for macOS</a></li>
<li><a href="../447536/index.html">IdM implementation. Preparation for implementation by the customer</a></li>
<li><a href="../447540/index.html">RHEL 8 Beta Workshop: We build working web applications</a></li>
<li><a href="../447546/index.html">Bowers & Wilkins PX. Belated Neobzor</a></li>
<li><a href="../447548/index.html">How justified is the introduction of VDI in small and medium-sized businesses?</a></li>
<li><a href="../447552/index.html">How to optimize catalog sections in an online store: step-by-step instructions</a></li>
<li><a href="../447554/index.html">An overview of the new features of NestJS 6</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>