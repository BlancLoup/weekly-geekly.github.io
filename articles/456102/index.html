<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy report creation in C / C ++</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you develop any software for operators (administrators) of hospitals, stores, rental services of gyroscooters, cell phone repair services, then you...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy report creation in C / C ++</h1><div class="post__text post__text-html js-mediator-article">  If you develop any software for operators (administrators) of hospitals, stores, rental services of gyroscooters, cell phone repair services, then you probably faced the task of creating reports to print them on a printer, or at least in PDF.  There are many third-party packages for Embarcadero RAD Studio that allow you to do this.  Such as FastReport, QuickReport, Crystal Reports, etc.  But in my opinion all these packages require a deep understanding of their mechanism and interface.  It takes a lot of time to study them, and most importantly, the code to generate even the simplest report will consist of a huge number of lines.  When I first encountered the task of generating reports under C / C ++, I started with FastReport and realized that I absolutely do not like this tool. <br><br>  At that very moment, a wonderful thought came to mind: how cool it would be to take a simple EXCEL file, add static information to it and format it to fit your needs.  The program will only open this file, fill it with dynamic data and save or send to print!  This was the starting point for my study of the OLE mechanism for working with MS Office files from the programs developed in Embarcadero RAD Studio. <br><a name="habracut"></a><br>  In the course of my activity, I managed to penetrate deep enough into the topic and now I can say with confidence that all the tools provided by MS Office and OLE cover all my reporting needs.  Well, if so, then probably for other developers, it would be a self-contained, simple and convenient tool.  Therefore, it was decided to write a DLL and package it with a list of all commonly used MS Excel functions that you have to face during the creation of Excel documents.  This is very convenient, because in order to create a report, you do not need to study a bunch of manuals or OLE.  All that is required is to load the DLL and the functions included in it.  Well, many people can work with DLL. <br><br>  <a href="https://lightreport.wixsite.com/index">Here is the site of the project itself</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project site describes in some detail the mechanism for working with DLLs, there is an example and a description of all functions. <br><br>  The DLL comes without a header file and without a static LIB library.  Thus, it is necessary to connect DLLs dynamically using the LoadLibrary function.  ZIP archive with the library includes the following files: <br><br><ul><li>  " <i>light_report.dll</i> " is the DLL library itself; </li><li>  " <i>DLLTest.cpp</i> " - an example of using the library; </li><li>  " <i>LPDLL.h</i> " - header file for the library usage example (this is not a DLL header file); </li><li>  " <i>Report.xlsx</i> " - MS EXCEL document for an example library use. </li></ul><br>  The header file for the example of using the library " <i>LPDLL.h</i> " contains the following declarations: <br><br><ul><li>  Enumerations that are used as arguments to DLL functions </li><li>  types of DLL functions; </li><li>  instances of DLL functions; </li><li>  The handle of the DLL being loaded (" <i>HINSTANCE DLL_Handle;</i> "); </li><li>  the <i>LoadLightReportDLL</i> function, which dynamically loads the DLL and all functions included in it; </li><li>  the <i>FreeLightReportDLL</i> function, which unloads the DLL. </li></ul><br>  The file <i>"LPDLL.h"</i> already contains everything you need to work with the DLL and its functions.  But you can also edit it or take only the most necessary for your project. <br><br>  Imagine that you simply connected the header file <i>‚ÄúLPDLL.h‚Äù</i> to your project. <br><br>  Then in the project itself you just need to: <br><br>  1) Declare a variable descriptor of your report: <br><br><pre><code class="cpp hljs">Variant report;</code> </pre> <br>  2) Dynamically load a DLL and all its functions: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!LoadLightReportDLL(<span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\light_report.dll"</span></span>))<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>;</code> </pre> <br>  3) Next, in the try-catch structure, open a previously prepared report template (MS Excel file): <br><br><pre> <code class="cpp hljs">report=OpenReport(<span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report.xlsx"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  4) Add some data to the report: <br><br><pre> <code class="cpp hljs">WriteCell(report, <span class="hljs-string"><span class="hljs-string">"Sheet1"</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"Hello world!"</span></span>);</code> </pre> <br>  ... <br>  5) Save file or print: <br><br><pre> <code class="cpp hljs">Save(report); SaveAs(report, <span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report copy.xlsx"</span></span>); ExportToPDF(report, <span class="hljs-string"><span class="hljs-string">"C:\\LightReport\\Report.pdf"</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); PrintOut(report);</code> </pre> <br>  6) Close the file: <br><br><pre> <code class="cpp hljs">CloseReport(report);</code> </pre> <br>  7) Unload DLL library: <br><br><pre> <code class="cpp hljs">FreeLightReportDLL();</code> </pre> <br>  And that's it!  Absolutely nothing extra!  There is only one nuance, but also that, it is shown only at debugging.  In a running application, everything will work fine.  I mean a situation in which there is any error when working with a report.  The fact is that the OLE mechanism for working with documents involves only throwing exceptions when errors occur.  That is why when working with DLL functions it is necessary to use the try-catch construct.  In the catch block, close the report without saving: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(...){CloseReport(report);}</code> </pre>  . <br>  When debugging, when an error occurs, you can stop the program.  At the same time, the MS Excel process will remain running, and it will be possible to close it only through the task manager.  Therefore, when debugging an application several times, several instances of the MS Excel process can be started, depending on how often you suspend the program when an error occurs, without waiting for the code to run in catch.  This must be monitored. <br><br>  In the release, if an error occurs, the code specified in the catch block will surely work, the report will close and the MS Excel process will be completed.  No MS Excel processes hanging in the system will be observed.  But still trying to write an error-free code, so I hope you will not have such a situation in a running application. <br><br>  Finally, add: <br><br><ol><li>  The DLL uses platform-specific data types, such as <i>unsigned short</i> , <i>unsigned long,</i> and <i>char</i> .  This is understandable why. </li><li>  The example is written in the Embarcadero Builder C ++ 10 environment. Accordingly, all the code corresponds to this environment and you may need to make some changes to the example code in order for it to work in your environment. </li><li>  The bottleneck of this DLL is the use of the Variant report file descriptor.  This is a rather specific format, and I suspect that it may be difficult to use the library outside Embarcadero RAD Studio.  Honestly, did not check. </li></ol><br>  Therefore, for the future, it is planned to pack all the functionality into a class and hide this <i>Variant</i> format inside the class, so that only the generally accepted C / C ++ formats are provided to the user.  I have never tried to package classes in a DLL, I read that with this there will definitely be difficulties.  Nevertheless, we will understand!  In the meantime, thank you for your attention, I will be very happy if this article and the DLL help someone. <br><br>  <a href="https://lightreport.wixsite.com/index">Link to the project</a> . </div><p>Source: <a href="https://habr.com/ru/post/456102/">https://habr.com/ru/post/456102/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../456094/index.html">Read datasheets 2: SPI on STM32; PWM, timers and interrupts on STM8</a></li>
<li><a href="../456096/index.html">What does the average reader Geektimes, soaring in the clouds</a></li>
<li><a href="../456098/index.html">Russian ICT as the foundation of national information security</a></li>
<li><a href="../4561/index.html">Internet Explorer 7 caused a wave of criticism in the blogosphere</a></li>
<li><a href="../456100/index.html">Now in the new package - Kingston A400 in M.2 format hurries to the market</a></li>
<li><a href="../456104/index.html">Ezblock Pi - programming without programming, this time for fans of Raspberry Pi</a></li>
<li><a href="../456108/index.html">Habr Weekly # 5 / Dark themes everywhere, Chinese factories in the Russian Federation, where the bases of banks have flowed away, Pixel 4, ML pollutes the atmosphere</a></li>
<li><a href="../456110/index.html">What does your text look like?</a></li>
<li><a href="../456112/index.html">"Overcoming" Moore's Law: how to replace traditional planar transistors</a></li>
<li><a href="../456114/index.html">What's new in the development of Mamba</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>