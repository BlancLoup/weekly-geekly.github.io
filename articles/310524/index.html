<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nursery project on React-redux with diapers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Earlier this year, we at HeadHunter launched a project aimed at automating various HR processes for client companies. The architecture of this project...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nursery project on React-redux with diapers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/957/658/ff5/957658ff515342d48acfa7cb2ca45cae.png" alt="intro" align="right" width="300"><br>  Earlier this year, we at HeadHunter launched a project aimed at automating various HR processes for client companies.  The architecture of this project at the front chose React-Redux stack. <br><br>  For 9 months it has grown from a small application for testing employees into a multi-module project, which today is called <a href="https://test.hh.ru/">‚ÄúTalent Evaluation‚Äù</a> .  As it grew, we encountered the following questions: <br><br><ul><li>  storage of the state, its normalization; </li><li>  building a scalable project architecture, convenient hierarchy - both in structure and in business logic. </li></ul><br>  This was manifested in a change in the approach to the construction of components, the architecture of reducer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's talk about how we developed the project and what decisions we made.  Some of them may be ‚Äúholivar‚Äù, while others, on the contrary, ‚Äúclassics‚Äù in the construction of a large project on redux.  I hope that the practices described below will help you in building react-redux applications, and living examples will help you understand how this or that approach works. <br><a name="habracut"></a><br><h4>  General information.  Intro. </h4><br>  The web application is a SPA.  Application rendering only on the client (we will explain why below).  When developing, we used React-redux stack with various middlewares, for example redux-thunk.  In the project we use es6, compiled when building through babel.  Development is carried out without the use of es7, because we do not want to take solutions that are not accepted in the standard. <br>  Partially, the project is available at <a href="https://test.hh.ru/">test.hh.ru</a> , but it can be used only by companies registered on hh. <br><br><h4>  Project structure </h4><br>  As a project structure, we initially took the division of the application into several parts.  The result is a ‚Äúclassic‚Äù structure for this stack: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/45a/344/2fc/45a3442fc35c4d8c851edd36515c50e3.png"></div><br>  Here: <br><br><ul><li>  actions are responsible for storing all the action creators of the project; <br><br></li><li>  components - all react components; <br><br></li><li> constants - constants.  It is important that in this folder we collect not only constants like <code>ENTER_KEY = 13</code> , but also various names of actions, for example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> FETCH_ACCOUNT = <span class="hljs-string"><span class="hljs-string">'FETCH_ACCOUNT'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> RECEIVE_ACCOUNT = <span class="hljs-string"><span class="hljs-string">'RECEIVE_ACCOUNT'</span></span>;</code> </pre><br>  This is done so that the import can easily see the dependencies, without the need to line up. <br>  We do not make those constants that are relevant only for a specific component.  For example: the distance in pixels from the lower border of the container, upon reaching which we load new data (that is, an infinite scroll); <br><br></li><li>  containers is a specific directory.  It consists of page components, which, if necessary (for example, lack of data) call the action creators and send the components to render.  In addition to similar page components, there are various decorators / fronts in the folder.  What is such a decorator?  To do this, analyze the code of one of the containers: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { compose } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Content <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/content/content'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Managers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/managers/managers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> composeRestricted <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./restricted/restricted'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { loadManagers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/managers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./title/title'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManagersPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentWillMount() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.firstLoad) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.loadManagers(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.location); } } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'page'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Managers</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> compose( connect( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state.location, {loadManagers} ), title(<span class="hljs-string"><span class="hljs-string">'managers'</span></span>, <span class="hljs-string"><span class="hljs-string">'title.base'</span></span>), composeRestricted({<span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) )(ManagersPage);</code> </pre><br>  Here we are interested in the lower part, which describes the export module.  connect is the standard react-redux decorator.  It wraps our component in the additional react component, which subscribes to state changes of the global redux store and transfers the location field (plus wraps the action creator loadManagers in the dispatch store).  Title, composeRestricted are handwritten decorators that likewise wrap a component.  Here title adds titles.  The second decorator - composeRestricted - is responsible for determining the user's rights, drawing restricted pages if the backend sent the corresponding error: for example, there are no rights or no data.  There may be a large number of such decorators: ‚Äúsomething went wrong‚Äù, additional calculations, etc .; <br><br></li><li>  reducers - nothing interesting, just managing the application's state;).  It also stores a ‚Äúroot‚Äù reducer that unites all the others (using combineReducers); <br><br></li><li>  store - store configuration, its initialization; <br><br></li><li>  index.js is the entry point to our application.  Initializes react, describes the routing, creates a stor, etc .; <br></li></ul><br>  With such a structure, we began to develop our project.  It is impossible to predict in advance all the requirements for the system and all the difficulties that may be encountered in the development process.  Therefore, we have chosen the path of incremental modernization of our project.  It works as follows: <br><br><ol><li>  choose a specific application model; </li><li>  We face the fact that some approach does not solve our problems in the way we want; </li><li>  we refactor, change the structure of the application. </li></ol><br>  Let us analyze the change in the structure of the application over time: <br><br><h5>  Building a structure.  Childhood </h5><br>  When a project is young and not overgrown with a large number of files, it is advisable to choose a simple construction model.  This is exactly what we did. <br><br>  All action creators were stored according to the principle - one group of operations, combined in the sense = one file.  All files were stored in one list in a folder. <br><br>  It looked like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9c8/2b6/0f8/9c82b60f8cf5476e9b7c9582cd4120c5.png"></div><br>  What is ‚Äúone group of operations‚Äù?  It can be said that one action creators file is responsible for actions within one reducer.  In this case, both the action creator and the reducer have the same name, but this does not happen 100% of the time.  In the sense, these are operations on one type of objects.  For example, employee.js contains various methods for working with a particular object - ‚Äúemployee‚Äù.  This is getting information about him, handling data loading errors, changing data and adding a new employee. <br><br>  Typical code of similar operations: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  action,   ,      employee dispatch(fetchEmployee()); fetch(`/employees/${id}`) //    .then(checkStatus) //  .then(result =&gt; result.json()) .then(result =&gt; { //  ,      (,       ,     ) dispatch(receiveEmployee(result)); }) .catch(() =&gt; { //  ,     : 1)   ; 2)    ; 3)     ; 4)    react . dispatch(releaseEmployee()); dispatch(errorRecord(t('employee.error'))); }); }; }</span></span></code> </pre> <br>  It is important to note that in this code we process a single catch at once a group of errors ‚Äî both server-side and work of reducers and reactant components.  In more detail, why we decided to make just such an architecture - in the section of ambiguous decisions at the end of the article. <br><br>  A similar construction model was adopted for reducers, containers and components.  For components, there are only some ‚Äúconventions‚Äù.  Each component is in a separate folder.  This allows us to put inside the folder as a .js module, as well as styles, and in some cases also images / other data: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/16b/192/4ef/16b1924efc264169af4c9ec92e2da04c.png"></div><br><h5>  Adolescence </h5><br>  This structure lived exactly until the end of the work on the first module.  Before moving to a new module, we looked at the resulting set of components with a sober look and decided that as the system was enlarged, this approach to the project structure would bring ‚Äúporridge‚Äù, where there would be a huge number of files on one level of the system.  In addition, if we decide to send all js to the front not in one file (for example, when the size of our js bundle grows into megabytes of minifen-aglyphine information), but in several bundles, then we will have to settle all the dependencies of the modules for quite a long time. <br><br>  That is why we made the following decision (I will describe for the two modules A and B, you can scale to any number): <br><br><ol><li>  All action creators, reducers and containers are divided into three types: common, moduleA, moduleB. <br><br></li><li>  All constants that do not describe the action type are inside the constants folder.  The same folder contains the actions directory, which describes the action types we need.  Moreover, they are also divided into two types. <br><br></li><li>  Components are divided into 4 types: <br><br>  common - includes general react modules.  They are the dummy react component (i.e., components that only describe the UI, do not control it, do not affect / do not depend directly on the application state, do not cause actions) In fact, these are components that are reusable anywhere in the application. <br><br>  blocks - components that depend on the overall application state.  For example, the ‚Äúnotification‚Äù or ‚Äúnotification‚Äù block. <br>  moduleA, moduleB - specific components for the module. <br><br>  Both blocks and modules can be smart components, trigger some actions, etc. </li></ol><br>  With the accepted rules, the structure of the application began to look as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/ca9/a89/02f/ca9a8902fedf46f595ea67d7428bfd33.png"></div><br>  Thus, we have a clear structure that describes the modular essence of the project, in which you can easily determine the ratio of the js file to a particular module, which means that if we decide to create different bundles for modules, then it will not be difficult for us (just ‚Äúset off "Webpack for the necessary parts). <br><br><h4>  Division of application state into modules </h4><br>  Ok, we shared our files structurally, the eye is happy, but what about the support of a multi-module structure at the level of logic, reducers? <br><br>  For small applications, the description of a root viewer is usually: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers({ account, location, records, managers, tooltip, validation, progress, restrictedData, command, translations, status, features, <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>, settings, menu, <span class="hljs-attr"><span class="hljs-attr">routing</span></span>: routeReducer, }); };</code> </pre> <br>  For small applications, this is convenient, since all data is located in a plain-collection.  But with the increase in the size of the application, the amount of data sent increases, there is a need for crushing reducer, dividing them into modules.  How can I do that?  Before proceeding to the result, consider two situations. <br><br><h5>  Situation one: ‚ÄúCrushing an object into separate reducers‚Äù </h5><br>  Suppose we have the essence of employees.  This entity is perfect for analyzing various situations and describing decision making.  With the essence of ‚Äúemployee‚Äù, company managers can do various actions: upload, edit, create, invite to tests, view test results.  This field is an object with two fields: status and data.  status defines the current state of the field (FETCH \ COMPLETE \ FAIL), and data defines useful data, an array of employees.  This is enough to get data from the server and display a list of employees. <br>  Now we need to add the ability to select employees: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/448/04f/85d/44804f85d5ea4cee875385dce2e96dd6.png"></div><br>  This problem can be solved in three ways: <br><br><h6>  Method one: </h6><br>  We modify the elements inside the employees.data array so that, in addition to the id, first name, last name, position, each element will contain the selected field.  When rendering a checkbox, we look at this field, and we count the total amount, for example, like this: <br><br><pre> <code class="javascript hljs">employees.data.reduce(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">employee, memo</span></span></span><span class="hljs-function">) =&gt;</span></span> employee.selected ? memo + <span class="hljs-number"><span class="hljs-number">1</span></span> : memo, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  If in the future we need to send the selected id, then we find them all through the same filter.  Adding \ deleting selected is done in the same way, via map.  The advantage of this method is that the data is stored centrally.  With a minus, we touch on the whole object for each ‚Äúsneeze‚Äù (adding / removing the selected flag).  This leads to a considerable amount of action.  Logic to work with selected employees is added to the employees redundant, action creator.  If you want to separate these parts (since working with selected employees does not affect the main task of the employees reducer - output employees and do pagination), then you should look at two other ways. <br><br><h6>  Method two: </h6><br>  Create a separate reducer, for example <code>selectedEmployees</code> .  This is an immutable map (you can optionally have an array, just an object) that stores only the selected id.  Adding and removing id from such a structure looks much easier.  Drawing the checkbox is complicated only by the need to go along the path <code>store.selectedEmployees.has(id)</code> .  Accordingly, all work with selected employees goes into a separate reducer, a separate group of actions. <br><br>  This solution is better in that it does not deal with the modification and loading of another part of the state, but adds one more side by side.  Total, if our application consists of these two reduers, we get the following structure: <br><br><pre> <code class="javascript hljs">employees {<span class="hljs-attr"><span class="hljs-attr">state</span></span>: COMPLETE, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [{<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, ...}, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, ...}]} selectedEmployees <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>})</code> </pre> <br><h6>  Method three: </h6><br>  Over time, if you use the second method each time, we will get a bloated state, which will consist of employees, selectedEmployees, employee, employeeTest, etc. Note that reductors are related to each other: selectedEmployees refers to employees, and employeeTest to employee .  Therefore, we structure the application by creating a combined reducer.  This will give us a clearer and more convenient structure: <br><br><pre> <code class="javascript hljs">employees: - list [{<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, ...}, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, ...}] - selected <span class="hljs-built_in"><span class="hljs-built_in">Map</span></span>({<span class="hljs-number"><span class="hljs-number">1</span></span> =&gt; <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) - status COMPLETE employee: - data - test</code> </pre> <br>  To achieve such a structure, you can build a hierarchy of reducers: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers({ <span class="hljs-attr"><span class="hljs-attr">employees</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">list</span></span>: employees, <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: selectedEmployees, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: employeesStatus }) routing: routeReducer, }); };</code> </pre> <br>  <i>Note: status is not important at this level, it can be left inside the reducer, which was responsible for the list of employees, as it was before.</i> <br><br>  This is the way we decided to use.  It is great for various situations where group work with objects is necessary. <br><br><h5>  Situation Two: ‚ÄúData Normalization‚Äù </h5><br>  When developing a SPA, data normalization plays a big role.  We will continue to work with our employees.  We selected the right employees and sent them to the test.  Then the employee passes it, and the company receives the test results.  Our application needs to store data - employee test results.  One employee may have several results. <br>  A similar problem can also be solved in several ways. <br><br><h6>  Bad way (man-orchestra) </h6><br>  This method proposes to refine the employees structure in order to preserve complete data about the test inside itself.  I.e: <br><br><pre> <code class="javascript hljs">employees: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: COMPLETE, <span class="hljs-attr"><span class="hljs-attr">list</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">testResults</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">score</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> speed: <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'...'</span></span> ... } } ] }</code> </pre> <br>  We got an orchestra object in our store.  This is inconvenient, it carries in itself an extra nesting.  The solution with normalized data looks much more beautiful. <br><br><h6>  Good way </h6><br>  Note that the employee and the test have an id.  In the database there is a link between tests and employees just by employee id.  We adopt the same approach from the backend and get the following structure: <br><br><pre> <code class="javascript hljs">employees: { <span class="hljs-attr"><span class="hljs-attr">status</span></span>: COMPLETE, <span class="hljs-attr"><span class="hljs-attr">list</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-attr"><span class="hljs-attr">testResults</span></span>: [<span class="hljs-number"><span class="hljs-number">123</span></span>] } ] }, <span class="hljs-attr"><span class="hljs-attr">tests</span></span>: { <span class="hljs-number"><span class="hljs-number">123</span></span>: { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">123</span></span>, <span class="hljs-attr"><span class="hljs-attr">score</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> speed: <span class="hljs-number"><span class="hljs-number">146</span></span>, <span class="hljs-attr"><span class="hljs-attr">description</span></span>: <span class="hljs-string"><span class="hljs-string">'...'</span></span> ... } }</code> </pre> <br>  In rutovom reducer we get: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers({ <span class="hljs-attr"><span class="hljs-attr">employees</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">list</span></span>: employees, <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: selectedEmployees, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: employeesStatus }), tests, <span class="hljs-attr"><span class="hljs-attr">routing</span></span>: routeReducer, }); };</code> </pre> <br>  We structured our story, put everything on the shelves, getting a clear understanding of the functionality of the application. <br><br><h5>  Add modules </h5><br>  When adding modules, we divide the presentation of the state into a common group and groups belonging to different modules: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers({ <span class="hljs-attr"><span class="hljs-attr">moduleA</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">employees</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">list</span></span>: employees, <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: selectedEmployees, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: employeesStatus }), tests, }), <span class="hljs-attr"><span class="hljs-attr">moduleB</span></span>: combineReducers({...}), <span class="hljs-comment"><span class="hljs-comment">// common     ,    notifications, routing: routeReducer, }); };</span></span></code> </pre> <br>  This method allows to repeat the file structure in the structure of the store.  Thus, the structure of the application is repeated both at the file and at the logical level.  This means that the understanding of the work of the entire application as a whole is simplified and the threshold for new developers to enter the project is reduced. <br><br><h4>  Principles of building React components </h4><br>  We have successfully built the structure of the application, divided the code into modules, our actions and reducers are hierarchical and allow us to write scalable code.  It's time to return to the question of how to build the components responsible for the UI. <br><br>  We adhere to the principles of redux, which means that the global stor is the only source of truth.  Our goal is to build the application in such a way that, according to the data from the site, you can completely restore the site display at any time.  Of the permissible errors, we allow ourselves not to recover data about animations / states of dropdowns, tooltips - open / closed. <br><br>  Based on these conditions, we construct an application model. <br><br><h5>  Smart and dumb components </h5><br>  The approach to building and dividing by these attributes is well described in the following resources: <br><br>  " <a href="https://medium.com/%40dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0">Medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0#.aszvx1fh1</a> <br>  ¬ª <a href="http://jaketrent.com/post/smart-dumb-components-react/">Jaketrent.com/post/smart-dumb-components-react</a> <br><br>  We follow a similar approach.  All common components are dummy components that only get properties, etc. Components related to a module can be either smart or dumb.  We do not make a hard distinction between them in the structure, they are stored nearby. <br><br><h5>  Pure components </h5><br>  Virtually all of our components do not have their own state.  Such components either get a state, the action creators through the connect decorator, or with the help of a ‚Äúwaterfall‚Äù from the parent components. <br><br>  But there are about 5% of the components that have their own state.  What are such components?  What is kept in your stey?  Similar components in our application can be divided into two groups. <br><br><h6>  Popup Status: </h6><br><div style="text-align:center;"><img src="https://habrastorage.org/files/2d0/96a/6f8/2d096a6f83ae436fa25498dc976ec752.png"></div><br>  One more example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c4b/3a8/2b7/c4b3a82b7dcf46048508e84715ddf0e8.gif"></div><br>  This group contains components that store information - display a pop-up element (dropdown, tooltip) or not. <br><br>  Typical code for such a component: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PseudoLink <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../pseudoLink/pseudoLink'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Dropdown <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../common/dropdown/dropdown'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./dropdownHint-styles.less'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DropdownHint</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(props, context) { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(props, context); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state = { <span class="hljs-attr"><span class="hljs-attr">dropdown</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }; } renderDropdown() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.state.dropdown) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> &lt;Dropdown onClose={(</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setState({ <span class="hljs-attr"><span class="hljs-attr">dropdown</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }); }}&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'dropdown-hint'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.props.children}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/Dropdown&gt; ); } render() { return ( &lt;PseudoLink onClick={() =&gt; { this.setState({ dropdown: true, }); }}&gt; {this.renderDropdown()} {this.props.text} &lt;/</span></span>PseudoLink&gt; ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> DropdownHint;</code> </pre> <br><br><h6>  The second task of the internal state: temporary caching or addition. </h6><br><br>  Consider the following example: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b0f/c6d/7bb/b0fc6d7bb10c479a8257b6a0fc93b5ea.gif"></div><br>  Notifications at the top of the screen are animated when they appear and hide.  The essence of the notification is stored in the global state of the application, but for the process of hiding (and then deleting) the notification, you can use one of several approaches without contaminating the global state with such unimportant information as animation. <br><br>  <b>The first method is caching.</b> <br>  Pretty easy way.  We create the NotificationsManager component, which is responsible for rendering the Notification components (Notification).  After the NotificationsManager has rendered the next notification, it starts the timer, after which the action to hide the notification will be called.  Before calling NotificationsManager, it caches notifications in its state.  This allows you to delete the notification itself from the store, and the cached data inside the local state of the component allows you to animate its disappearance. <br>  This method is inconvenient because we deceive our story - he believes that there is no notification, but it is actually stored in the local style of our component.  We want an ‚Äúhonest‚Äù story, so this method does not suit us. <br><br>  <b>Method two - we supplement information from the store locally.</b> <br>  This method is more honest and attractive, as it does not interfere with high accuracy to recover data from the store.  It consists in the fact that the NotificationsManager, when receiving notification changes from the side of the store, adds information to its state about what needs to be done with the notification (to animate its appearance, disappearance or nothing to do).  In this case, the NotificationManager notifies the story through the CLOSE_NOTIFICATION action only at the moment when the animation of the disappearance of the notification is completed.  This approach eliminates unnecessary information in the store (the status of the animation of the notification), and at the same time the story remains ‚Äúthe only source of truth‚Äù with which you can accurately restore the display of the entire application. <br><br>  We describe approximately how this approach will work.  In the store we get: <br><br><pre> <code class="javascript hljs">notifications: [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'  ,   '</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'  ,   '</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'  , ?'</span></span> }, ]</code> </pre> <br>  In the local component stack: <br><br><pre> <code class="javascript hljs">notifications: { <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-string"><span class="hljs-string">'out'</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-string"><span class="hljs-string">'in'</span></span> }</code> </pre> <br>  Let's look at an example.  At the level of the entire application, we know that we have 3 notifications.  At the local component level, we save information that does not carry a semantic load for the application, but is important for the local render: id === 1 disappears, id == 3 leaves, and id === 2 is static. <br><br>      ,        .    ,    .                    .        ‚Äú-  ‚Äù. <br><br>      .       ,     ,   ,        . . ,           .        . <br><br><h4>  .  Rendering </h4><br>        .      react-router,  redux     react-router-redux. <br>       . <br>         ,           json,      :   ,   ,   ( ).       . <br><br>       : <br><br><ol><li>   js   ; </li><li>        ,    ; </li><li>  node.js  . </li></ol><br>         json-.      acceptType-. <br><br>    : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a1f/41e/ba0/a1f41eba0625484697ebd70d8e51bfbd.png"></div><br>    employees      (employees)     (account). <br><br>        ,    html-,   json: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.pageData = { <span class="hljs-attr"><span class="hljs-attr">account</span></span>: <span class="hljs-comment"><span class="hljs-comment">//    employees: //    }</span></span></code> </pre> <br>  ,    ,         . <br><br>     : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initialData = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.pageData.employees; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employees</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = initialData, actions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// reducer }</span></span></code> </pre> <br>     employees   ,      -,     . <br><br>   ‚Äî        .        action creator,      acceptType: application/json      ( ).   . ‚Äú      ‚Äù. <br><br><h4>   </h4><br><h5>     </h5><br>          action creator': <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//  action,   ,      employee dispatch(fetchEmployee()); fetch(`/employees/${id}`) //    .then(checkStatus) //  .then(result =&gt; result.json()) .then(result =&gt; { //  ,      (,       ,     ) dispatch(receiveEmployee(result)); }) .catch(() =&gt; { dispatch(releaseEmployee()); dispatch(errorRecord(t('employee.error'))); }); }; }</span></span></code> </pre> <br>        receiveEmployee. ,       ,   ,  .    .      ‚Äî catch    : <br><br><ol><li>   ; </li><li>    ; </li><li>     ; </li><li>    react . </li></ol><br>   - ‚Äú‚Äù .  ,        ,     t('employee.error'). t ‚Äî ,      (). <br><br>   ‚Äú‚Äù   .    ,         ,     ,    . .    ,   :      .        .      ,  : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { <span class="hljs-comment"><span class="hljs-comment">//  action,   ,      employee dispatch(fetchEmployee()); let json; try { const res = await fetch(`/employees/${id}`); checkStatus(res); json = await getJson(res); } catch () { dispatch(releaseEmployee()); dispatch(errorRecord(t('employee.error'))); } dispatch(receiveEmployee(result)); }; }</span></span></code> </pre> <br>       try-catch  dispatch: <br><br> dispatch(receiveEmployee(result)); <br><br>       ,      catch: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">loadEmployee</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> dispatch =&gt; { <span class="hljs-comment"><span class="hljs-comment">//  action,   ,      employee dispatch(fetchEmployee()); let json; try { const res = await fetch(`/employees/${id}`); checkStatus(res); json = await getJson(res); } catch () { dispatch(releaseEmployee()); dispatch(errorRecord(t('employee.error'))); } try { dispatch(receiveEmployee(result)); } catch() { dispatch(releaseEmployee()); dispatch(errorRecord(t('employee.error'))); } }; }</span></span></code> </pre> <br>       ,       . <br><br> <b> ,        ,    ,   ,    .</b> <br><br><h5>   </h5><br>    ,         ,      ,  ‚Äú ‚Äù.    (,    5‚Äî10 ,     40‚Äî50 )              .  Why do so?        ,           .      ,  .    ,   ‚Äú ‚Äù ,     . ,      ,      , -,  , -,  (,             , ).  ,         ,           .     .   ,      . <br><br>         : <br> ¬ª <a href="https://github.com/reactjs/redux/issues/37">github.com/reactjs/redux/issues/37#issue-85098222</a> <br> ¬ª <a href="https://gist.github.com/gaearon/0a2213881b5d53973514">gist.github.com/gaearon/0a2213881b5d53973514</a> <br> ¬ª <a href="http://stackoverflow.com/questions/34095804/replacereducer-causing-unexpected-key-error">stackoverflow.com/questions/34095804/replacereducer-causing-unexpected-key-error</a> <br><br>    : <br><br> <i> 1.</i> <br>  ,   .     ,     .         ( ). <br><br>  <i>Step 2.</i> <br>        .          : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers({ <span class="hljs-attr"><span class="hljs-attr">moduleA</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">employee</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">list</span></span>: employees, <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: selectedEmployees, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: employeesStatus }), tests, }), <span class="hljs-attr"><span class="hljs-attr">moduleB</span></span>: combineReducers({...}), <span class="hljs-comment"><span class="hljs-comment">// common     ,    notifications, routing: routeReducer, }); }</span></span></code> </pre> <br>      : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createReducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dynamicReducers = {}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> combineReducers(<span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, { notifications, <span class="hljs-attr"><span class="hljs-attr">routing</span></span>: routeReducer, <span class="hljs-comment"><span class="hljs-comment">// ,    module, }, dynamicReducers)); };</span></span></code> </pre> <br>     ,    : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> aReducers = { <span class="hljs-attr"><span class="hljs-attr">moduleA</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">employee</span></span>: combineReducers({ <span class="hljs-attr"><span class="hljs-attr">list</span></span>: employees, <span class="hljs-attr"><span class="hljs-attr">selected</span></span>: selectedEmployees, <span class="hljs-attr"><span class="hljs-attr">status</span></span>: employeesStatus }), tests, }), }</code> </pre> <br>  <i>Step 3.</i> <br>       ,      : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStoreWithMiddleware(createReducer()); store.dynamicReducers = {}; storeInstance = store; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (store.getState().module) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> A: injectAsyncReducer(aReducers); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> B: injectAsyncReducer(bReducers); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   } return store; } export function injectAsyncReducer(reducers) { if (reducers !== storeInstance.dynamicReducers) { storeInstance.dynamicReducers = reducers; storeInstance.replaceReducer(createReducer(storeInstance.dynamicReducers)); } }</span></span></code> </pre> <br>    injectAsyncReducer,        . <br><br> <i> 4.</i> <br>   action creator.     action    .  For example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> checkoutAModule = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    injectAsyncReducer(aReducers); return { type: CHECKOUT_MODULE, module: A, }; };</span></span></code> </pre> <br>     ,   ,  . <br><br> <i> 5.</i> <br>  ,     .    : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { checkoutModuleA } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../actions/module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { A } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../constants/module'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkoutA</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Container</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AContainer</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentWillMount() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.module !== A) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.checkoutModuleA(); } } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Container</span></span></span></span><span class="xml"><span class="hljs-tag"> {</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">...this.props</span></span></span></span><span class="xml"><span class="hljs-tag">} /&gt;</span></span></span><span class="xml"> ); } } return connect( state =&gt; { return { module: state.module, }; }, { checkoutModuleA, } )(AContainer); }; }</span></span></code> </pre> <br> ,    ,      . <br><br> <i> 6.</i> <br>       : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React, { Component } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { connect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react-redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { compose } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Content <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/content/content'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Managers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../components/managers/managers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> composeRestricted <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./restricted/restricted'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { loadManagers } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../actions/managers'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> title <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./title/title'</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ManagersPage</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ componentWillMount() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.firstLoad) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.loadManagers(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.location); } } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">className</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'page'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Managers</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Content</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ); } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> compose( connect( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function"> =&gt;</span></span> state.location, {loadManagers} ), checkoutA(), title(<span class="hljs-string"><span class="hljs-string">'managers'</span></span>, <span class="hljs-string"><span class="hljs-string">'title.base'</span></span>), composeRestricted({<span class="hljs-attr"><span class="hljs-attr">user</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}) )(ManagersPage);</code> </pre> <br>  Done!        . <b>,        .</b>   ,   ‚Äú‚Äù  .            (,  ,   ). <br><br><h4>  Instead of output </h4><br>      .       ,      .    ,       ,     ,     ,     .  ,     (  ),               . </div><p>Source: <a href="https://habr.com/ru/post/310524/">https://habr.com/ru/post/310524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310514/index.html">Adapting a mobile Android TV application or why I love Google</a></li>
<li><a href="../310516/index.html">Use the Entity Framework Core with the universal Windows platform application</a></li>
<li><a href="../310518/index.html">We catch notifications using beacons</a></li>
<li><a href="../310520/index.html">Why Augmented Reality Adds Network Risk</a></li>
<li><a href="../310522/index.html">We launch our game on Android TV</a></li>
<li><a href="../310526/index.html">Step to the left, step to the right - scale. Or from absolute to simple order</a></li>
<li><a href="../310528/index.html">Plan "B": open a cafe or go to programmers?</a></li>
<li><a href="../310530/index.html">Packaging a jvm application in a docker image</a></li>
<li><a href="../310532/index.html">Preview Rambler.iOS # 8</a></li>
<li><a href="../310534/index.html">Dynamic DNS in C # and Yandex.API</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>