<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic Component Rendering in Angular 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="opening speech 
 In the process of working on a project on Angular 2 using maps, the following task arose: you need to render your Angulean component ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic Component Rendering in Angular 2</h1><div class="post__text post__text-html js-mediator-article"><h1>  opening speech </h1><br>  In the process of working on a project on Angular 2 using maps, the following task arose: you need to render your Angulean component into a standard leaflet popup.  In this article, the dynamic rendering of components will be considered in the context of this particular problem, but you can use this information in your own cases in the same way. <br><a name="habracut"></a><br><h1>  Formulation of the problem </h1><br>  The initial project is located by <a href="https://github.com/bodryi/angular2-dynamic-component-rendering/tree/master/angular2-leaflet-start">reference</a> .  This is an angular 2+ application to which the library is connected to work with the leaflet.js map.  In MapService there are methods for creating a map, adding markers to it and centering on markers.  MapComponent - component to display the map.  Webpack 2 is used to build the project. If you start the application, you will see a map with a marker with a popup of the following form: <br><br><pre><code class="plaintext hljs">marker.bindPopup(` &lt;h3&gt;Leaflet PopUp&lt;/h1&gt; &lt;p&gt;Some text&lt;/p&gt; &lt;p *ngIf="false"&gt;Should be deleted from DOM if it was angular component because of ngIf = false&lt;p&gt; `);</code> </pre> <br>  Click on it and see the following picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/483/170/34d/48317034df5333cff28e8d39dc6d8488.png" alt="Map with open popup"></div><br>  In the DOM there is an element with the text ‚ÄúShould be deleted from DOM ...‚Äù, which I would like to delete using * ngIf, however in the popup you just cannot write the code of the angular to make it work right away.  This is where the dynamic rendering of the angular components comes into play. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  The solution of the problem </h1><br>  First, create the component that we want to dynamically render: <br><br><pre> <code class="plaintext hljs">@Component({ selector: 'custom-popup', template: require('./custom-popup.component.html') }) export class CustomPopUpComponent { public inputData: any; private title: string = 'Angular component'; private array: Array&lt;string&gt; = ['this', 'array', 'was viewed', 'by', 'ngFor!']; }</code> </pre><br>  His template: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>{{title}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>{{inputData}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngFor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"let text of array"</span></span></span><span class="hljs-tag">&gt;</span></span>{{text}}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> *</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ngIf</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"false"</span></span></span><span class="hljs-tag">&gt;</span></span>Should be deleted from DOM if it was angular component because of ngIf = false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Next, create a new service dynamic-render.service.ts: <br><br><pre> <code class="plaintext hljs">@Injectable() export class RenderService { private componentRef: ComponentRef&lt;any&gt;; constructor(private ngZone: NgZone, private injector: Injector, private appRef: ApplicationRef, private componentFactoryResolver: ComponentFactoryResolver) { } public attachCustomPopUpsToMap(map: Map) { this.ngZone.run(() =&gt; { map.on("popupopen", (e: any) =&gt; { const popup = e.popup; const compFactory = this.componentFactoryResolver.resolveComponentFactory(popup.options.popupComponentType); this.componentRef = compFactory.create(this.injector); this.componentRef.instance.geoObject = popup.options.object; this.appRef.attachView(this.componentRef.hostView); let div = document.createElement('div'); div.appendChild(this.componentRef.location.nativeElement); popup.setContent(div); }); }); } }</code> </pre><br>  Since addListener is launched outside the angular area, we need to manually add it ourselves there.  Thus, each time a popup is opened, a componentFactory is called, which creates a component that we have passed in the options field.  Then we can use the instance of this component to write data into its fields, which we can also throw into the options popup.  In this example, we assign the component inputData data from options.data.  Then create a div element to which we attach our newly created component and assign it as content to the popup. <br><br>  <i>Note:</i> this code is written for angular 2.3.0+.  For earlier versions, this solution will look like this.  Instead <br><br><pre> <code class="plaintext hljs"> this.appRef.attachView(this.componentRef.hostView);</code> </pre><br>  will need to write <br><br><pre> <code class="plaintext hljs">if (this.appRef['attachView']) { this.appRef['attachView'](this.componentRef.hostView); this.componentRef.onDestroy(() =&gt; { this.appRef['detachView'](this.componentRef.hostView); }); } else { this.appRef['registerChangeDetector'](this.componentRef.changeDetectorRef); this.componentRef.onDestroy(() =&gt; { this.appRef['unregisterChangeDetector'](this.componentRef.changeDetectorRef); }); }</code> </pre><br>  Let's set the RenderService in the MapModule.  You also need to add our CustomPopUpComponent to the MapModule in declarations and entryComponents.  Call the renderService and add the ability for our map element to render Angulyar components in popup, then attach a custom component to the marker: <br><br><pre> <code class="plaintext hljs">this.renderService.attachCustomPopUpsToMap(this.mapService.getMap()); let options = { data: 'you can provide here anything you want', popupComponentType: CustomPopUpComponent }; let myPopUp = L.popup(options); marker.bindPopup(myPopUp);</code> </pre><br>  In the data field, proxy data for the component, in the popupComponentType, the component itself.  This design can be wrapped in the interface for ease of use, but in this example we will not do this, the article is not about that.  To display correctly, we will slightly correct the styles, after which we can launch the application.  Clicking on the marker, we see that our component averaged in leaflet popup'e: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/34d/e96/06d/34de9606d3567c65d78e88a3c77ee6ee.png" alt="Our component has been rendered!"><br><br><h1>  Conclusion </h1><br>  We managed to significantly expand the functionality of standard leaflet popups in conjunction with angular 2+.  As a bonus, our components get an open / close animation, resize with zoom and other standard leaflet things. <br><br>  The source code of the project in which everything described in the article is implemented is <a href="https://github.com/bodryi/angular2-dynamic-component-rendering/tree/master/angular2-leaflet-start">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/331298/">https://habr.com/ru/post/331298/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331288/index.html">CameraTablet - how to make a graphics tablet using a webcam</a></li>
<li><a href="../331290/index.html">New tech trends in finance: why do we need chat bots</a></li>
<li><a href="../331292/index.html">Automate testing of Windows applications using Winium</a></li>
<li><a href="../331294/index.html">Google Play and 2K installations per day without cash investment (+ statistics and earnings)</a></li>
<li><a href="../331296/index.html">Market applications for cash registers: the first conference CHANGE</a></li>
<li><a href="../331300/index.html">Vulnerability Stack Clash allows you to get root-privileges in Linux and other operating systems</a></li>
<li><a href="../331302/index.html">Birobidzhan on the bright side: how we have lit up the city for our money</a></li>
<li><a href="../331304/index.html">How do neural networks help us with technical support</a></li>
<li><a href="../331306/index.html">Modern convergent technologies on the market in the Russian Federation - let's try to compare? Import Substitution, Ceph + OpenStack, Nutanix</a></li>
<li><a href="../331308/index.html">Xamarin.Forms for WPF and UWP developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>