<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we won in SmartMailHack 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last weekend (July 14-15), another SmartMailHack hackathon took place at the Mail.Ru Group office. We were offered "to come up with a feature that wil...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we won in SmartMailHack 2</h1><div class="post__text post__text-html js-mediator-article"><p>  Last weekend (July 14-15), another SmartMailHack hackathon took place at the Mail.Ru Group office.  We were offered "to come up with a feature that will allow access to data from the Post and more effectively interact with them." </p><a name="habracut"></a><br><h2>  Description of data, ideas and solutions </h2><br><p>  We received a test box with more than 1500 messages, as well as full access to it through the API.  The organizers provided a large, detailed manual on its use (547-page booklet).  With the help of a token and simple JSON requests, we could receive all the necessary information about the mail: letters, sender names, various characteristics. </p><br><p>  After discussing that each of us has about several thousand unread mailings from mailings in the mail, we decided to deal with this problem.  In our case, the relevance of the letter is no longer determined by the time of its appearance in the mailbox.  And if we proceed from the fact that not all letters will be opened, then it is better to show the user only those that he is likely to open.  And everything else can be removed to hell.  So we decided to do the sorting for the mail. </p><br><p>  Sort letters were supposed to be categorized, and categories placed inside the tiles (hello, Trello).  The top row of tiles united within the meaning of the letter from different senders.  There can be ‚ÄúTrips‚Äù, ‚ÄúRegistrations‚Äù, ‚ÄúCorrespondence with Vasya‚Äù, ‚ÄúEvents‚Äù, ‚ÄúFinance‚Äù and so on, all in all about 10 categories.  The second row were tiles with the coolest offers from companies.  We searched for the most relevant promotional codes, the most discount promotions, the most valuable offers, and showed them here, grouped by company.  Then came all the other letters distributed by the sending companies, and these senders, in turn, were scattered in categories (‚ÄúFood‚Äù, ‚ÄúCosmetics‚Äù, ‚ÄúElectronics‚Äù and others).  Moreover, the categories were also ranked by the relevance of the letters, and only letters that crossed a certain threshold of relevance were shown inside.  Having supported the idea with the words ‚ÄúFind the right and get rid of the superfluous‚Äù, we got into ML. </p><br><h2>  Machine learning </h2><br><p>  We decided to build three models: </p><br><ul><li>  classifier from more than 30 categories that we have designated as basic for all users; </li><li>  clustering and highlighting new categories based on user preferences; </li><li>  ranking of letters within a category, from the most relevant to the least. </li></ul><br><img src="https://habrastorage.org/webt/z1/lp/4c/z1lp4ctrc2qjtboon88dpqpe2iw.png"><br><h2>  Signs of </h2><br><p>  It seems that this item should be described personally for each task.  However, we generated one common feature dataset and trained all the models on it.  There was no time for careful selection. </p><br><p>  There was a bunch of binary features that are unloaded using the API.  However, most of them were generated on the texts: </p><br><ul><li>  tf-idf on document collections; </li><li>  embeddings obtained with Word2Vec; </li><li>  behavioral signs such as: <br>  - the number of read messages for the last window (1, 2, 5 weeks ago); <br>  - the number of messages from this. </li></ul><br><h2>  Classification task </h2><br><p>  We marked out 1000 letters for learning by hand.  It turned out that this is not such a slow and tedious job as it may seem at first.  If you use addresses and headers, you can significantly speed up the work.  For example, Lamoda almost always sends letters to the ‚ÄúClothing‚Äù category. </p><br><p>  Next, we train LightGBMs on the whole set of features and obtained the quality of 0.913 accuracy and 0.892 f1 measures, which we determined as a very good result at the base line level.  This shows that letters can be classified very well. </p><br><h2>  Ranking task </h2><br><p>  We used the binary flag 0/1 as the target variable - whether the letter was read by the user.  Further ranked in terms of probability, predicted by the model, since this is precisely how the model is confident that the person will read the message or not. </p><br><p>  Here, we also trained LightGBMs on the whole set of features and got the quality around 0.816 auc-roc. </p><br><h2>  Clustering and highlighting new categories </h2><br><p>  In addition to the main categories, we have the ‚ÄúOther‚Äù category.  From it, you can select new topics. </p><br><p>  We trained standard DBSCAN on letters from this group, and then we chose those clusters in which there were many messages (the threshold can be optimized, but it was fixed by chance).  For example, thematic modeling can be set on a cluster of documents collection, get the most relevant topic for this cluster and select it as a separate group.  Dismiss this algorithm is not enough time. </p><br><p>  So, incoming letters are passed through the classifier, if they fall into the category ‚ÄúOther‚Äù - they are clustered, new topics try to stand out, and then the ranking takes place.  A request is sent to the backend, which aggregates everything, and the frontend is rendered. </p><br><img src="https://habrastorage.org/webt/hh/im/e2/hhime2drbnnlgca1jorvldzfvou.png"><br><hr><br><p>  <strong>Remaining ideas</strong> </p><br><ul><li>  improved machine learning models; </li><li>  collecting data from a larger number of users to better predict the behavior of each of them; </li><li>  thorough validation of new emerging categories; </li><li>  the use of pictures as signs, for example, the allocation of embeddings from pre-trained neural networks. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/417531/">https://habr.com/ru/post/417531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417515/index.html">What I learned by creating 100 games in 5 years</a></li>
<li><a href="../417517/index.html">Intel history pages. Photo chronicle and quiz</a></li>
<li><a href="../417521/index.html">Validation of SSL certificates for revocation</a></li>
<li><a href="../417527/index.html">We develop Shrimp: we control parallel requests, we log in via spdlog and more ...</a></li>
<li><a href="../417529/index.html">Three technological trends that change trade and consumer</a></li>
<li><a href="../417533/index.html">Windows Notepad received the first significant update in two decades</a></li>
<li><a href="../417535/index.html">CUBA development - a big step away from Spring?</a></li>
<li><a href="../417537/index.html">"Your game is boring", or how to raise the already high retention of the first day</a></li>
<li><a href="../417539/index.html">Google fined a record $ 5 billion for violating antitrust laws in Europe</a></li>
<li><a href="../417541/index.html">The Apollo mission talks with NASA Mission Control Center are digitized.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>