<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How GPS tracker became a logger or a simple and cheap way to organize monitoring of physical parameters of remote objects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Task 
 As often happens tasks do not fit into the standard features of the available tools. It happened this time. Next, outline the problem. 

 There...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How GPS tracker became a logger or a simple and cheap way to organize monitoring of physical parameters of remote objects</h1><div class="post__text post__text-html js-mediator-article"><h4>  Task </h4><br>  As often happens tasks do not fit into the standard features of the available tools.  It happened this time.  Next, outline the problem. <br><br>  There are several remote sites in the vast country (Ukraine) electrified, but not having simple technical capabilities to connect to the Internet.  Objects are usually located so that about 3G or WiMax do not stutter.  Only GPRS is available.  You need to be able to monitor the temperature in several rooms of these objects.  Moreover, it is desirable if not in real time with a minimum delay.  Complicated is still the fact that the objects, although real estate, but there may be a situation that there will be a move.  Therefore, capital equipment installation methods disappear. <br><br>  That is, it would be good to have such a complex that can be easily transferred to a new place, plugged into an outlet and hanging up the sensors to forget about it.  I am well aware that this hour the market is full of suitable solutions, but as always there is a fly in the ointment - this is the price in this case.  Plus, often such solutions come with their software.  And if God forbid you need to change something in it, then I will not tell you further, many probably talked themselves on similar topics with support services. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/e11/5e6/e2b/e115e6e2b0f67021497767cc39035d54.jpg"><br><a name="habracut"></a><br><br><h4>  Equipment </h4><br>  It so happened that in connection with another project I had a GPS tracker on my desk, something like this - <a href="http://habrahabr.ru/post/100747/">habrahabr.ru/post/100747</a> Their peculiarity is that they are implemented using the modules of the Italian company Telit.  This company produces both GPS-GSM modules and simply GSM.  The peculiarity of these modules is that they have inside Python.  That is, they can execute scripts.  And it is natural that all devices and module resources are available from Python.  Do you understand what all goes?) <br><br>  Many trackers have the ability to directly connect sensors, but in the first place you will not install sensors at a significantly distance, and secondly their number is limited to two - four.  By this I went the other way.  Fortunately, the tracker also has a COM port.  But with its help it is already possible to interrogate almost any equipment for stationary SCADA systems. <br><br>  It is worth noting here that since Telit modules almost all have Python on board and scripts written for one module with minimal changes will work on another.  It‚Äôs just that if a module doesn‚Äôt have a GPS, for example, you need to be very smart and don‚Äôt try to use it in a script. <br><br>  I wrote and tested the script on the tracker, and then the modem <a href="http://gprs-modem.ru/product/gsm-modem-teleofis-rx108-r-rs485-s-opciej-kreplenie-na-din-rejku/">gprs-modem.ru/product/gsm-modem-teleofis-rx108-r-rs485-s-opciej-kreplenie-na-din-rejku</a> was purchased on the Telit GL868-Dual module and it all worked right away! <br><br>  Also nearby was the <a href="http://www.owen.ru/catalog/95286354">OVEN</a> MVA-8 analog input module <a href="http://www.owen.ru/catalog/95286354">www.owen.ru/catalog/95286354</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af5/110/7b9/af51107b9e01a24d11f40d7b881b7813.jpg"><br><br>  This is a simple analog input module for 8 sensors.  Supports Modbus protocols (ASCII, RTU), DCON, OWEN.  That's just the tracker and Python does not know about such protocols.  We'll have to train. <br><br>  Communication between devices is RS485 and therefore they can be mutually located at a considerable distance from each other.  In addition, the sensors themselves can be located quite far from the MBA-8. <br><br><h4>  Implementation </h4><br>  Working with Telit modules is quite simple.  The written script is loaded into the module and marked for execution.  Docks for AT commands and Python functions can be found here <a href="http://www.telit.com/en/products/gsm-gprs.php%3Fp_id%3D12%26p_ac%3Dshow%26p%3D47">www.telit.com/en/products/gsm-gprs.php?p_id=12&amp;p_ac=show&amp;p=47</a> GL865-DUAL - a module in SMT format and a platform of a module similar to GE865-QUAD.  Just drank it a bit for our countries. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/224/a22/483/224a22483487d9a701bfb4ac8ce71f2b.jpg"><br><br>  It can be seen that it can be soldered without problems at home.  The harness is minimal. <br><br>  I want to note that when you download the documentation, be sure to check that it is suitable for the specific version of the firmware of your module.  This is a serious rake.  It can be a long and tedious search for a bug, but it turns out that just a function is not supported.  Supported firmware versions can be found right from the start. <br><br>  I will not retell all that is written in the docks.  Everything is available there.  In short, we have at our disposal several devices on board: MDM, MDM2, SER, SER2, MOD, GPS (if any).  I think the name you guessed is what is what.  And in the end, it all comes down to the fact that we, through the SER, interrogate the MBA8 and try to send it via MDM (modem) to our server, and if that didn‚Äôt work out, we add the data to the history file until better times. <br><br>  MDM and MDM2 are not two modems and just two interfaces of the same modem.  For what?  This you will learn if you want to implement something like this. <br><br>  Now in order.  How to organize work with a modem can be found above the link where I gave an example of the tracker.  It remains a survey MBA8.  We are going to do it. <br><br>  I was not lucky, I turned out to be an old MBA8 and it supported only its own protocol OWEN.  This protocol made me very surprised.  Why is it so wise to me it is not clear, but I managed to implement a poll on it.  You do not have to go head to log.  I will give here already ready functions of interrogation and calculation of a checksum.  Please do not kick, this is the first thing I wrote in Python.  By the way, Python is 1.5.2 there, but badly curtailed.  For example, it is absent as a floating point number phenomenon.  Therefore, be sure to read the docks. <br><br>  Function to calculate the checksum: <br><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Crc16Owen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(buffer)</span></span></span><span class="hljs-function">:</span></span> CRC = <span class="hljs-number"><span class="hljs-number">0x0000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,len(buffer)): byte = ord(buffer[j]) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((byte^(CRC&gt;&gt;<span class="hljs-number"><span class="hljs-number">8</span></span>))&amp;<span class="hljs-number"><span class="hljs-number">0x80</span></span>): CRC = (CRC &amp; <span class="hljs-number"><span class="hljs-number">0x7FFF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> CRC = CRC ^ <span class="hljs-number"><span class="hljs-number">0x8F57</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> : CRC= (CRC &amp; <span class="hljs-number"><span class="hljs-number">0x7FFF</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> byte = (byte&amp;<span class="hljs-number"><span class="hljs-number">0x7F</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> CRC</code> </pre> <br><br>  The function to translate the lines ARIES into a normal form: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OwenToHex</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S)</span></span></span><span class="hljs-function">:</span></span> Sr=<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>,len(S)<span class="hljs-number"><span class="hljs-number">-1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>): a = ((ord(S[i])+<span class="hljs-number"><span class="hljs-number">0x09</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0xF0</span></span> b = (ord(S[i+<span class="hljs-number"><span class="hljs-number">1</span></span>])+<span class="hljs-number"><span class="hljs-number">0x09</span></span>)&amp;<span class="hljs-number"><span class="hljs-number">0x0F</span></span> Sr = Sr + chr(a+b) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Sr</code> </pre><br><br>  MVA8 polling function having the address number 8: <br><br><pre> <code class="python hljs">ToMva8Request = [<span class="hljs-string"><span class="hljs-string">'#GOHGONOKHTVU\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GPHGONOKINGG\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GQHGONOKMOGI\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GRHGONOKLIVS\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GSHGONOKVMGM\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GTHGONOKSSVO\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GUHGONOKOJVQ\r'</span></span>, <span class="hljs-string"><span class="hljs-string">'#GVHGONOKRPGK\r'</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetMva8Data</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> Mva8Data = <span class="hljs-string"><span class="hljs-string">''</span></span> SER.receive(<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-comment"><span class="hljs-comment">#     for i in range(0,len(ToMva8Request)): ValCurSensor = FFFFFFh + chr(0xf1) #    SER.send(ToMva8Request[i]) MOD.sleep(20) SRcv = SER.receive(10) if len(SRcv)==0: ValCurSensor = FFFFFFh + chr(0xf3) #   MVA8 else: if len(SRcv) &gt; 13: SRcv = OwenToHex(SRcv) if (ord(SRcv[-2])*0x100+ord(SRcv[-1])) == Crc16Owen(SRcv[:-2]): if (len(SRcv)==7): ValCurSensor = FFFFFFh + SRcv[4] if (len(SRcv)==12): ValCurSensor = SRcv[4:8] else: ValCurSensor = FFFFFFh + chr(0xf2) # CRC  OWEN Mva8Data = Mva8Data + ValCurSensor Mva8Data = ShortImei + Mva8Data Mva8Data = Ascii2Bin("%08x"%MOD.secCounter()) + Mva8Data Mva8Data = Mva8Data + Ascii2Bin("%04x"%Crc16Owen(Mva8Data)) return Mva8Data</span></span></code> </pre><br><br>  I want to remind once again that before yelling at me with a foul language it is worth understanding the intricacies of the built-in python, there are a lot of problems. <br><br>  There are a few limitations.  For example, space for scripts and other files is only 2 Mb.  But for the file history is enough.  Also, work with files is very slow and the cold start of such a logger lasts about 1.5 minutes.  It is certainly possible to organize a survey more often than once every 30 seconds, but you will have to do it.  Since I am satisfied with the survey every 5 minutes, this problem has not touched me.  And do not forget about the fact that we use a memory that has a limited number of overwrites.  If your logger will peel the data permanently into one and the same cell, then you will have enough memory for two months, after which there will be failures.  But it is possible to realize the history file in such a way that the recording was kept all the time in different cells, which was realized.  Estimated time of memory use in this mode turned out about 500 years., If you rely on data from memory manufacturers. <br><br>  The modem has one drawback - it resets the clock when the power is turned off, it was necessary to organize the receipt of time from the server. <br><br>  And by the way, I know that there are the same smart Siemens modems, but I like Telit more.  And there are other reasons but they will not be there. <br><br>  Well, now the main thing - the price. <br><br>  Modem - 2 950 rubles. <br>  MVA8 - 4,189.00 rubles <br>  Sensors + wires add on. <br><br>  In my pretty cheap work.  And do not forget that all this can be easily transferred and installed elsewhere. <br><br>  PS The basic idea is that the modem performs not only the functions of a modem, but also the functions of a master that polls equipment and storage functions.  And you do not need to use a separate, even minimal buffer server. </div><p>Source: <a href="https://habr.com/ru/post/153719/">https://habr.com/ru/post/153719/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../153705/index.html">Egor Kulikov - World Programming Champion</a></li>
<li><a href="../153707/index.html">In Skolkovo, a prototyping center was opened, and I went to look at it.</a></li>
<li><a href="../153711/index.html">Divine Space: how we prepared for Kickstarter</a></li>
<li><a href="../153715/index.html">Rocket engine printed on a 3D printer</a></li>
<li><a href="../153717/index.html">SQL Server 2012 Virtual Machine in the Cloud</a></li>
<li><a href="../153721/index.html">Redirect static web pages appeared on Amazon S3</a></li>
<li><a href="../153723/index.html">Sony Xperia J goes on sale</a></li>
<li><a href="../153727/index.html">ABBYY FineScanner and Yandex.Disk - beautiful copies of documents are always at hand</a></li>
<li><a href="../153729/index.html">Review of two cradle for HTC Desire S by Mugen Power</a></li>
<li><a href="../153731/index.html">Implementing a phased script using AJAX</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>