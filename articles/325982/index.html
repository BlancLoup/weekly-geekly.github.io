<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Photo-realistic graphics in a mobile game or the world's first "video" game (mobile)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A video game, according to Wikipedia, is a game using images generated by electronic equipment. 





 In our case, the "video" game is a video game b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Photo-realistic graphics in a mobile game or the world's first "video" game (mobile)</h1><div class="post__text post__text-html js-mediator-article"><p>  A video game, according to Wikipedia, is a game using images generated by electronic equipment. </p><br><p><img src="https://habrastorage.org/files/0b7/a51/71b/0b7a5171b111401fa1d7528675756df3.JPG" alt="image"></p><br><p>  In our case, the "video" game is a video game based on real video. </p><br><a name="habracut"></a><br><p>  If you find this title too yellow and there is a ‚Äúvideo‚Äù -game in our understanding, made earlier - write about it in the comments and I will correct the title.  At that time, we did not find and did not remember similar games. </p><br><p>  <strong>Update</strong> : here I meant mobile games, but thanks to the commentators, the heading has been corrected.  Also add that on YouTube at one time video quests were popular.  To real videos, by the built-in functionality of YouTube, transitions to other videos were attached, which gave a certain interactivity.  First available example: <a href="https://www.youtube.com/watch%3Fv%3D1z2VoErwlx8">Hostage</a> . </p><br><p>  An article can no longer be counted as an advertisement, since  Since the development and publication of the game, so much time has passed that my developer account has expired and the game is no longer available in the Apple AppStore. </p><br><p>  In the article I will talk about the process of preparing the game and about the features of working with video in IOS and Android on Adobe AIR. </p><br><p>  It all started on a bright sunny May St. Petersburg morning.  Although no, this does not happen.  It all started very much in the second half of the usual May day, when the sky was covered with clouds and we left to shoot a video. </p><br><p><img src="https://habrastorage.org/files/999/c9c/912/999c9c912e78424ea491292e2a3917d0.jpg" alt="image"></p><br><p>  I introduce myself, we are two developers: Andrei is a server programmer, far from game development, who, in fact, planned to make a game, and Fyodor is a professional game programmer who helped with video shooting and development tips. </p><br><p>  Although, no, it all started earlier.  Somehow the idea to make a game based on real video shooting came to mind.  At the same time, the video had to be interactively tied to the game.  The video was supposed to be beautiful.  The game is both interesting, entertaining and simple.  So the idea of ‚Äã‚ÄãPiterJump was born and then everything started to happen. </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/f6GpOpQ7Gmk" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><h2 id="podgotovka-k-syomke">  Preparing to shoot </h2><br><p>  A script was written which, according to the full list of streets of St. Petersburg (street names returned to normal: Ave., Avenue, Street - Street, etc.) made inquiries (like St. Petersburg "Nevsky Prospect") on Google, received a number of results and thus the rating of street fame was compiled. </p><br><p>  It was planned to use the shooting of these streets for the game, assuming that since the street is more famous, then it is more interesting.  The idea was untenable.  The list has been preserved for history, I cite its beginning (sorted by descending "fame"). </p><br><table><thead><tr><th>  Number of results </th><th>  Title </th></tr></thead><tbody><tr><td>  313000000 </td><td>  Russian street </td></tr><tr><td>  244000000 </td><td>  18th line IN </td></tr><tr><td>  170000000 </td><td>  St. Petersburg Ave. </td></tr><tr><td>  139000000 </td><td>  19th passage </td></tr><tr><td>  59400000 </td><td>  Leningradskaya st. </td></tr><tr><td>  5,600,000 </td><td>  Culture Street </td></tr></tbody></table><br><p>  As you can see, especially the residents of the city, the streets are not the most significant.  For example, Nevsky Prospect, perhaps the most famous central avenue of St. Petersburg, is on the 273th place in the rating with 3.8 million results. </p><br><p>  I had to go on the simplest way - to use the shooting of the city center. </p><br><p>  Made the route (map of the central part of St. Petersburg on 8 A4 sheets) </p><br><p><img src="https://habrastorage.org/files/d26/35f/f91/d2635ff9101e421f9d14405f6ef6898a.JPG" alt="image"></p><br><p>  We drove through it once with a record of tracking in the navigator </p><br><p><img src="https://habrastorage.org/files/353/bde/25f/353bde25f65d4fa1a98ee561a02802fe.png" alt="image"></p><br><p>  The length of the route is 30 kilometers. </p><br><h2 id="podgotovka-video">  Video preparation </h2><br><p>  So, we have chosen a bright day, but also so that there is no bright sun, for uniform illumination. </p><br><p>  Charge the batteries, stocked up with cassettes. </p><br><p>  They took the camera (Canon XH A1), a tripod, installed, fixed. </p><br><p><img src="https://habrastorage.org/files/761/4d8/a60/7614d8a60a13438ca5c553eba2ed414d.JPG" alt="image"></p><br><p>  Special sign </p><br><p><img src="https://habrastorage.org/files/41a/ef9/722/41aef9722ab64be78915646ff9eaeb91.JPG" alt="image"></p><br><p>  During filming </p><br><p><img src="https://habrastorage.org/files/4f7/d19/996/4f7d19996b384df6afd7828ad55d4de8.JPG" alt="image"></p><br><p>  The plans were to make about 30 minutes of beautiful video, it is easy to cut it into pieces and make levels for the game.  The reality was cruel. </p><br><p>  The video turned out so much that I had to buy an additional cassette on the way.  We received a total of 1 hour and 40 minutes of video. </p><br><p>  Beautiful views from the window were not so beautiful in the video, as their eyes saw. </p><br><p>  The video turned out just incredibly many uninteresting moments that needed to be cut out and get in the end about 40 minutes of gameplay. </p><br><h3 id="oshibki-nachinayuschih-operatorov">  Errors novice operators </h3><br><p>  Too fast travel speed when shooting.  I tried to go at a speed of about 30-40 km. / H.  It turned out that it was too fast and gave several video flaws. </p><br><p>  First, when the sidewalk is close to the roadway, the relative speed of pedestrians is too fast, which results in a lack of reaction speed to jump over them.  During the game, I had to take this moment into account and do an auto-jump. </p><br><p>  Secondly, the video turned out with a small, but noticeable, effect of a stroboscope.  Probably, this could be corrected by the camera settings, but on the camera screen it seemed that the video looks good, and we are not professional operators.  Later on, I tried to fix this for a long time in a video editor, applying various filters.  As a result, I stopped at two filters at the same time: a slight horizontal blur (so that motion blurred) and a stabilization filter, which slightly improved the video. </p><br><p>  Wrong point selection for shooting.  The center of St. Petersburg consists of cars. </p><br><p><img src="https://habrastorage.org/files/17e/6a9/46f/17e6a946fb884a84b9868172de591c07.jpg" alt="image"></p><br><p>  More precisely from the machines-machines-machines.  All streets, streets, alleys are made by cars.  Recently, the city is a little civilized in this direction, paid parking is introduced.  But at that time, that was, that was.  Yes, the camera was set quite high, but not enough.  As a result, the video in some places turned out almost a continuous series of cars, instead of the beauty of St. Petersburg, houses and people.  Ideally, it was necessary to shoot at the same height as the cars that shoot Yandex / Google panoramas. </p><br><h2 id="napisanie-igry">  Writing a game </h2><br><p> At first, on the advice, I was thinking of writing a game on Unity (then still Unity3D).  But Unity had a fatal flaw.  After numerous experiments, it turned out that on mobile devices it is not supported to overlay video as texture on the object.  There were plugins that supported it.  But one was paid, the second one reproduced a video broken into pictures and, with a long duration, the ‚Äúvideo‚Äù gave an unfit frame rate for the game. </p><br><p>  Looked at Xcode.  It immediately became clear: to write a game on Xcode, you need to be a super hero or have ready-made ideas that can be used in all games.  In fact, you first need to write the graphics engine of the game, then just the game itself.  I was not ready for such a feat (besides, an alien language syntax from solid square brackets ...). </p><br><p>  I don‚Äôt remember how to use Adobe AIR.  I knew Flash quite well (I didn‚Äôt see such a convenient graphic / animation editor before or after), ActionScript 2.0 / 3.0, but only rumors were heard about AIR - there is such a technology for mobile. </p><br><p>  Did you know that Adobe, despite the decline of flash, still regularly releases new versions of AIR, there is a community (and far from 1.5 people) that various plug-ins for AIR write, there are integrations for basic mobile technologies like in-app purchases under Apple / Google, all the necessary integration for Google / Apple gaming platforms? </p><br><p>  Armed with Flash Develop + FLEX + AIR SDK, we started new tests.  The video was surprisingly easy - it was enough to set the rendering settings using the GPU.  Later, the rendering had to be changed to "Direct", since  The GPU did not support the overlay on the video images with the alpha channel. </p><br><p>  To display the video in AS 3.0, the video loading technique in the Stage is used.  Documentation and examples are not always obvious and did not work immediately, but in general, everything is quite simple. </p><br><p>  Set the event handler that StageVideo is available. </p><br><pre><code class="actionscript hljs">main.main_stage.addEventListener(StageVideoAvailabilityEvent.STAGE_VIDEO_AVAILABILITY, init_video);</code> </pre> <br><p>  After checking the availability of StageVideo, the init_video callback is called. </p><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init_video</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e:StageVideoAvailabilityEvent)</span></span></span><span class="hljs-function">:void</span></span></code> </pre> <br><p>  In which a streaming video object is created from a network / file </p><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nc:NetConnection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetConnection(); nc.connect(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); ns = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NetStream(nc); ns.client = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>;</code> </pre> <br><p>  When StageVideo is available (on IOS, Android part), create an object, bind the streaming object </p><br><pre> <code class="actionscript hljs">stageVideoAvail = (e.availability == StageVideoAvailability.AVAILABLE); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stageVideoAvail) { sv = main.main_stage.stageVideos[<span class="hljs-number"><span class="hljs-number">0</span></span>]; sv.addEventListener(StageVideoEvent.RENDER_STATE, onRender); sv.attachNetStream(ns); }</code> </pre> <br><p>  When unavailable (on the part of Android, on the emulator on the PC) create a regular video object </p><br><pre> <code class="actionscript hljs">video = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Video(Data.video_width, Data.video_height); video.y = int(Data.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - Data.video_height / <span class="hljs-number"><span class="hljs-number">2</span></span>); addChildAt(video, <span class="hljs-number"><span class="hljs-number">0</span></span>); video.attachNetStream(ns);</code> </pre> <br><p>  Next, the stream starts to play. </p><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fl:File = File.applicationStorageDirectory.resolvePath(quality + <span class="hljs-string"><span class="hljs-string">"/level_"</span></span> + level + <span class="hljs-string"><span class="hljs-string">".mp4"</span></span>); ns.play(fl.url);</code> </pre> <br><p>  At the same time, you need to set the ViewPort, without which the video is not displayed in StageVideo mode </p><br><pre> <code class="actionscript hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onRender</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(e:StageVideoEvent)</span></span></span><span class="hljs-function">:void </span></span>{ sv.viewPort = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>, Data.height / <span class="hljs-number"><span class="hljs-number">2</span></span> - Data.video_height / <span class="hljs-number"><span class="hljs-number">2</span></span>, Data.video_width, Data.video_height);</code> </pre> <br><p>  When working with video in AIR, you need to consider that you need to compile the flash drive or, in the ‚ÄúSoftware rendering‚Äù mode, for testing on a PC in emulator mode.  Or in the "GPU rendering" mode - it works on IOS, but does not support the overlay of images with the alpha channel (the video just disappears), and it seems to work fine on Android.  Or in the mode "Direct rendering" - works on IOS, but probably gives more power consumption. </p><br><p>  During the development of the prototype gameplay, refactoring, alpha version - an article appeared on Habr√© at that time, in which there was a mention of a certain Adobe Gaming SDK. </p><br><p>  This package provides the developer with many useful developments for mobile games.  Interface, access to the native IOS / Android API, your 2D and 3D engines. </p><br><p>  At that time, the alpha version of the game was already ready, and again there was no point in refactoring the game for using the ready-made components of the 2D engine, so I took only plug-ins of the native IOS functions of accessing the game center and the product store.  Plug-ins in AIR are implemented as some ready-made packaged modules ANE (AIR Native Extensions) - which are plain zip archives containing xml files (describing the namespace and access interfaces) and packed compiled swf-files. </p><br><p>  After the implementation of the main video display functionality, without which it was impossible to make a game, everything else was not particularly difficult: draw simple graphics, arrange in flash, make animation with built-in tools, write various classes of the game‚Äôs business logic and send for approval in Apple AppStore . </p><br><h2 id="itogi">  Results </h2><br><p>  At the time of the writing of the game, I thought that the stream of downloads would soon begin, I would have to add servers (the video was loaded into the game on the fly, as it took about 3 GB in total in different quality), the money would go (purchases were built into the game 4 levels - free to go to the rest - 1 dollar), development of further MoscowJump, ParisJump, New-YorkJump will begin, people will be able to shoot themselves on the phone and add new levels, others will play them, give marks, share comments and play turn into some kind of social en  a log of recent games Pokemon. </p><br><p>  In fact, I, of course, did not think so.  I saw all the flaws of the game.  To start the game now (even with some kind of new game approach) - money is required, promotion.  The game itself must be of better quality, interesting features must be built into the game, the graphics are a little better, the video is more qualitative. </p><br><p>  In the meantime, as a result, I will say that Adobe AIR + Flash is, albeit forgotten now, but a good technology, with the help of which you can easily make mobile games even to non-professionals. </p><br><p>  For the story, I published a <a href="https://www.youtube.com/watch%3Fv%3D9e96LGKksHc%26feature%3Dyoutu.be">full gameplay</a> , a <a href="https://www.youtube.com/watch%3Fv%3DSyVkhLc1E8E%26list%3DPLFKj63kZgj-6PuA0S4Gy-vsI8JlcKeZE_%26index%3D1">full video of</a> all levels of the game on youtube, maybe someone recognizes himself on video :) and transferred the source code from a private repository to <a href="https://github.com/kak-tus/PiterJump">github</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325982/">https://habr.com/ru/post/325982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325968/index.html">Archaic video compression algorithms of the era of FMV games</a></li>
<li><a href="../325972/index.html">Security Week 14: Hacking a bank with a Brazilian scale, ATMs throw money in bitch, 54 hours Mirai</a></li>
<li><a href="../325976/index.html">How an IaaS provider can make payment for services more convenient: 2 simple rules</a></li>
<li><a href="../325978/index.html">WebRTC, Safari</a></li>
<li><a href="../325980/index.html">Using IMS QTI in ePUB e-learning courses</a></li>
<li><a href="../325986/index.html">EGaaS Digital Ecosystem</a></li>
<li><a href="../325988/index.html">Checking the integrity of the roulette game on the Ethereum smart contract</a></li>
<li><a href="../325990/index.html">Character Design 2B for Nier: Automata</a></li>
<li><a href="../325992/index.html">VAT and freelancers working with Upwork</a></li>
<li><a href="../325994/index.html">6 fresh examples of parsing and design improvements in simple ways</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>