<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Relatively positioned elements in WPF documents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A couple of months ago, I had to implement an interface using WPF. Mainly used FlowDocument, since it was necessary to organize the UI in the style of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Relatively positioned elements in WPF documents</h1><div class="post__text post__text-html js-mediator-article">  A couple of months ago, I had to implement an interface using WPF.  Mainly used FlowDocument, since  it was necessary to organize the UI in the style of web pages as close as possible. <br>  Accustomed to freedom in positioning HTML elements with CSS, I could not find a solution for the relative positioning of nested elements.  Top, Left, Right, Bottom properties are completely absent in floating WPF documents.  MSDN issued only the <a href="http://msdn.microsoft.com/en-us/library/system.windows.documents.figure.aspx">Figure</a> class.  However, HorizontalOffset and VerticalOffset do not work when using FlowDocumentScrollViewer.  Search in Google also did not help. <br>  However, the solution was more than simple. <br><a name="habracut"></a><br><h5>  How browser engines work </h5><br>  The most interesting information about its internal implementation provides WebKit.  <a href="http://www.webkit.org/blog/">A blog</a> is a valuable source of information for those who do not want to study the source code of the project, but want to know about its architecture. <br><br>  Of particular interest was the cycle of posts about WebCore Rendering.  The main phrase was found on this <a href="http://www.webkit.org/blog/117/webcore-rendering-iv-absolutefixed-and-relative-positioning/">page</a> , which prompted a solution to the problem: ‚ÄúRelative positioning is literally nothing more than a paint-time translation‚Äù, which is in Russian: ‚ÄúRelative positioning is literally nothing more than movement when drawing‚Äù. <br><br>  Armed with this ‚Äúpostulate‚Äù, I decided to find something similar in the depths of WPF. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Texteffect </h5><br>  If for UIElement we usually use the RenderTrasform and 2D transformations of the Translate, Rotate and Scale views, the same mechanism is provided for objects containing text.  The container of all transformations is the <a href="http://msdn.microsoft.com/ru-ru/library/system.windows.media.texteffect.aspx">TextEffect</a> class. <br><br>  So, we will start implementation.  An example <a href="http://www.webkit.org/blog/117/webcore-rendering-iv-absolutefixed-and-relative-positioning/">from the blog page</a> will be used as an example. <br><img src="https://habrastorage.org/storage1/6092174e/120f80a9/ffe4ce1c/f8845615.png"><br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"border:5px solid black; padding:20px; width:300px; margin-left:auto; margin-right:auto"</span></span></span><span class="hljs-tag">&gt;</span></span> Here is a line of text. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"position:relative;top:-10px; background-color:#eeeeee"</span></span></span><span class="hljs-tag">&gt;</span></span>This part is shifted<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span> up a bit<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">span</span></span></span><span class="hljs-tag">&gt;</span></span>, but the rest of the line is in its original position. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The same example, but only for WPF, without positioning: <br><img src="https://habrastorage.org/storage1/6ed0ff21/3034a246/2558cae6/b10ce524.png"><br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocumentScrollViewer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocumentScrollViewer.Document</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocument</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"doc"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontFamily</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Verdana"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontSize</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"12px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">LineHeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"18px"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Paragraph</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"20px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5px"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Black"</span></span></span><span class="hljs-tag">&gt;</span></span> Here is a line of text. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Span</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"shiftedText"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#EEE"</span></span></span><span class="hljs-tag">&gt;</span></span>This part is shifted<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LineBreak</span></span></span><span class="hljs-tag">/&gt;</span></span> up a bit <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Span</span></span></span><span class="hljs-tag">&gt;</span></span>, but the rest of the line is in its original position. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Paragraph</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocument</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocumentScrollViewer.Document</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FlowDocumentScrollViewer</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  <i>Before you apply a TextEffect, you need to know that it only works with the <a href="http://msdn.microsoft.com/en-us/library/system.windows.documents.run.aspx">Run</a> type.</i>  <i>When applied to Span, or another element in the document, the effect will not be observed.</i> <br><br>  Apply effect: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DoEffect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> run <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> shiftedText.Inlines.OfType&lt;Run&gt;()) { TextEffect f = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextEffect(); TranslateTransform t = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TranslateTransform(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">-10</span></span>d); f.Transform = t; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> selectionStart = doc.ContentStart.GetOffsetToPosition(run.ElementStart); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> selectionLength = run.ElementStart.GetOffsetToPosition(run.ElementEnd); f.PositionStart = selectionStart; f.PositionCount = selectionLength; run.TextEffects.Add(f); } }</code> </pre><br>  And the code to cancel: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UndoEffect</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> run <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> shiftedText.Inlines.OfType&lt;Run&gt;()) { run.TextEffects.Clear(); } }</code> </pre><br>  Thus, we were able to get the desired effect.  I hope that the code is useful to others. <br>  Link <a href="http://www.4shared.com/file/Fk6RD7ZR/RelativeTextWPF.html">to the project with an example</a> . <br></div><p>Source: <a href="https://habr.com/ru/post/128209/">https://habr.com/ru/post/128209/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128201/index.html">The titans. Steve Jobs (translation)</a></li>
<li><a href="../128202/index.html">Details about the new programming language Google Dart (Dash)</a></li>
<li><a href="../128204/index.html">Digital Communications Kazakhstan 2011</a></li>
<li><a href="../128207/index.html">Hi-Tech@Mail.Ru: Samsung Wave 3 + Bada 2.0 Review</a></li>
<li><a href="../128208/index.html">Crisis drupal</a></li>
<li><a href="../128210/index.html">External Rounding Tabs</a></li>
<li><a href="../128211/index.html">Hacked by linux.com</a></li>
<li><a href="../128212/index.html">Symbol Studio Pixar recreated in reality</a></li>
<li><a href="../128213/index.html">Measuring speech intelligibility: a formant approach</a></li>
<li><a href="../128214/index.html">Examples of landing pages, lead generation and integration with other services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>