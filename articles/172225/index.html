<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kinect + 3D Display + HTML5</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Features create interactive 3D HTML5 applications using the sensor Kinect. 

 Task 
 Show 3D photos and videos, captured in different parts of our lar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kinect + 3D Display + HTML5</h1><div class="post__text post__text-html js-mediator-article">  Features create interactive 3D HTML5 applications using the sensor Kinect. <br><br><h5>  Task </h5><br>  Show 3D photos and videos, captured in different parts of our large Motherland, on a 3D display, and so that playback starts when the user enters a certain geographic area on a map placed in front of the screens.  Ideally, the stand should consist of 6 3D displays and 3 Kinect sensors in order to maximize the spreading of geofences in front of the screens and allow multiple users to manage their displays. <br><a name="habracut"></a><br><h5>  Decision </h5><br>  During the discussion, we investigated the issue of displaying full-fledged stereoscopic (non-anaglyph) 3D content.  Among the possible ways of implementation was the technology nVidia 3D Vision, whose driver and add-ons for Firefox allowed to display 3D. <br>  Among the technologies of 3D displays, we stopped at less expensive than active 3D (shutter glasses + 100 Hz frame-by-frame sweep), namely, passive polarization 3D technology with line-wise technology of separation of left and right channels.  The polarization was chosen to be circular as the most adequate when moving and turning the head relative to the screen. <br>  It should be noted that the nVidia 3D Vision driver turned out to be omnivorous and knew how to work with any type of display (at least with most of the ones at our disposal).  However, the vague API, instability and commercial policy of nVidia made it necessary to quickly doubt the correctness of the choice.  So the idea was to build your own driver.  And the arguments were: <br><ol><li>  the technology with line-by-line output of the left and right channels implies the presence of two images, joined by side-by-side (top-bottom or left-right), </li><li>  If you recombine the pixels on the FullHD side-by-side image in the ‚Äúleft / right‚Äù lines alternately, and also achieve a strict display of the ‚Äúpixel to pixel‚Äù raster on the LCD matrix, you can achieve a reasonable 3D display without special drivers. </li></ol><br><h5>  side-by-side </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/4fe/936/daa/4fe936daa46686cb86dd83f7869553fc.jpg" alt="image"><br><br><h5>  interlace </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/29c/c11/d77/29cc11d775142403b317a6149b9c9f1f.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So technological intuition led us to shaders.  To begin with, we tested GLSL for WebGL with examples from the threejs framework.  The shader was written in several lines: the parity of the line is checked, if it is odd, we output pixels from the left image, even ones from the right.  All of this went well and worked quickly on HD - about 30fps (Windows 7, Chrome, nVidia GPU).  FullHD video reduced this figure to about 12 fps.  The profiler showed a bottleneck - before each draw call it was necessary to transfer a huge buffer with a texture that changed in each frame.  And it was no way to win "on the fly."  Then Flash and the well-known Pixel Bender technology (2D) came to the rescue.  Essentially this is the same GLSL syntax, just a slightly different specification.  For several hours we implemented a flash component of a 3D player, which had a simple JS api, as close as possible to HTML5 &lt;video&gt;.  So, we have two implementations of the 3D player in the JS wrapper.  Tests on FullHD video with Flash 3D player showed more decent results ~ 25fps.  So we won the dampness. <br><br><h5>  Webgl </h5><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> GL_ES precision highp float; #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> uniform sampler2D Sample0; varying vec2 vUv; void main () { vec3 colour; float row = ceil(vUv.y * 1080.0); vec2 pixel; float mod = mod(row, 2.0); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (mod == 0.0) { pixel = vec2(vUv.x / 2.0, vUv.y); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { pixel = vec2(0.5 + vUv.x / 2.0, vUv.y); } colour = texture2D(Sample0, pixel).xyz; gl_FragColor.xyz = colour; gl_FragColor.w = 1.0; }</span></span></code> </pre> <br><br><h5>  Pixel bender </h5><br><pre> <code class="cpp hljs">&lt;languageVersion: <span class="hljs-number"><span class="hljs-number">1.0</span></span>;&gt; kernel interlace &lt; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> : <span class="hljs-string"><span class="hljs-string">"Interlace 3D"</span></span>; vendor : <span class="hljs-string"><span class="hljs-string">"NMT"</span></span>; version : <span class="hljs-number"><span class="hljs-number">2</span></span>; description : <span class="hljs-string"><span class="hljs-string">"Create interlaced video from side-by-side"</span></span>; &gt; { input image4 oImage; output float4 outputColor; parameter <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> swapEyes &lt; description: <span class="hljs-string"><span class="hljs-string">"swap eyes"</span></span>; defaultValue: <span class="hljs-literal"><span class="hljs-literal">false</span></span>; &gt;; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">evaluatePixel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ float2 relativePos = outCoord(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> modulus = mod(relativePos.y, <span class="hljs-number"><span class="hljs-number">2.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (swapEyes &amp;&amp; modulus &lt;= <span class="hljs-number"><span class="hljs-number">1.0</span></span> || !swapEyes &amp;&amp; modulus &gt;= <span class="hljs-number"><span class="hljs-number">1.0</span></span>) { relativePos.x = <span class="hljs-number"><span class="hljs-number">960.0</span></span> + relativePos.x / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { relativePos.x = relativePos.x / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; } outputColor = sampleLinear( oImage, relativePos ); } }</code> </pre><br><br>  And then it's easier!  We implemented a Kinect bundle tcp server with JS using WebSocket.  Adapted tracking of users in the field of visibility of Kinect under several zones, screwed up the effects, superimposed the design and <a href="http://www.youtube.com/watch%3Ffeature%3Dplayer_detailpage%26v%3D4LN1Ugn-4Sc">it turned out</a> ! <br><br><h5>  Results </h5><br><h6>  Driver vs Shader </h6><br><ul><li>  The advantage of shader technology is the ability to display 3D content not only rendered in photo or video, but also runtime 3D scenes in stereoscopic mode, that is, True 3D in HTML5 / WebGL or Flash / Pixel Bender / Stage3D applications in the browser;  however, for this approach, a display with line-wise separation technology of the left and right channels is important. </li></ul><br><br><h6>  Kinect </h6><br><ul><li>  it is important for the user to see his / her own image or image of hands during the process of </li><li>  natural gestures with imitation of physical laws (inertia, collisions) are required, </li><li>  it is very useful to develop in the open space (almost in combat) conditions, "everyones go here", </li><li>  Using tcp is a restriction only for JS applications, if you can afford UDP (flash) - use, avoid problems with memory leaks and low fps, although at the time of creation UDP was available in Chrome Canary. </li></ul><br><br><h6>  3D display </h6><br><ul><li>  to obtain a full stereo effect, it is important to configure the display of pixel-to-pixel in a video card-display bundle, this is achieved by resetting all possible scaling in the video card drivers and display settings, as well as the exact resolution supported by the monitor, </li><li>  It is important to follow the rules of depth order for objects on the screen: the layer of controls and text information, the layer of 3D objects, the background, the overlapping depth of these entities severely affects perception and can lead to fatigue, </li><li>  It is important to pick up the glasses so that they close the opposit channels well (right from the left and vice versa) - even glasses from the manufacturer of the 3D panel itself let an opposit channel in the form of a purple ghost image, we found a fairly high quality pair of 3D Screen LG 55 ‚Äù+ Philips Glasses </li><li>  take care of the highlights on the screen - they should not be, very distracting from the perception of 3D - looks like an extra layer of the image. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/172225/">https://habr.com/ru/post/172225/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172215/index.html">Programming Arduino from Linux, gentoo-way, quick start</a></li>
<li><a href="../172217/index.html">Photo archive metadata. XMP tags of individuals. [HowTo]</a></li>
<li><a href="../172219/index.html">Displaying python projects with pip and wheel</a></li>
<li><a href="../172221/index.html">Synology has released the official version of DiskStation Manager (DSM) 4.2</a></li>
<li><a href="../172223/index.html">A bit about Steam Web Api</a></li>
<li><a href="../172227/index.html">Automatic Customer Calling System</a></li>
<li><a href="../172229/index.html">Experience in managing business processes in a new way, or how ACM replaces BPM, CRM, ECM, SCRUM, ITSM - in one fell swoop</a></li>
<li><a href="../172231/index.html">Sparse image processing</a></li>
<li><a href="../172233/index.html">RestKit - description of one of the possibilities</a></li>
<li><a href="../172235/index.html">Mozilla does not plan to return to iOS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>