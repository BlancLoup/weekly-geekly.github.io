<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Level generation in the arcade on the example of indie game</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to tell you about the level generation algorithm in the simplest game of the ‚Äúrunner‚Äù genre, which I developed a few days...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Level generation in the arcade on the example of indie game</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/503/163/7d6/5031637d60efc2ebf75e7f1e672a3412.png"><br><br>  In this article I would like to tell you about the level generation algorithm in the simplest game of the <abbr title="A genre of video games in which you need to play as a continuously running character and dodge various obstacles.">‚Äúrunner‚Äù</abbr> genre, which I developed a few days ago.  If you are interested in the topic of game development, as well as algorithms for random generation of game levels, dungeons, traps or landscape, welcome to the cat. <br><a name="habracut"></a><br><h4>  About the game </h4><br>  To begin with, to make it clear what's what, I‚Äôll tell you a little about the game itself.  The game is a hardcore <abbr title="A genre of video games in which you need to play as a continuously running character and dodge various obstacles.">runner</abbr> in which a small pixel man runs from left to right, and you need to have time to press one button (or tap on the screen, if this is a mobile version), so that this man jumped or planned in the air and dodged numerous spikes from traps.  The main mechanic of the game consists in timely jumping up to the trap and correctly calculating the planning time on small handles (yes, in the animation, the little man waves his arms, and the fall slows down due to this). <br><br><h4>  First generation version </h4><br>  The game was developed in the <abbr title="Quickly, in a couple of days">hackathon</abbr> format, so for the first version of the game the <abbr title="If you want to go directly to the most interesting, then scroll to the next title">simplest minimally working algorithm</abbr> was created, which, as the player moved, created one of three types of spikes at a random distance from the previous one. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Types of thorns: <br><img src="https://habrastorage.org/getpro/habr/post_images/bc7/30d/d10/bc730dd10362048d2f08a6ce1bd9398c.png"><br><br>  The spikes, which I called the "Shuriken," were created at a random height between the floor and the ceiling.  "Spikes on the floor" and "Spikes on the ceiling" corresponded to their name and were located on the floor and on the ceiling, so that the height, in contrast to the Shuriken, was stable. <br><br>  For the first version, the generation turned out to be very good and interesting, but, unfortunately, there were two big minuses: <br><ul><li>  Often, traps were generated too high, because of this there were moments when you could run for a very long time without pressing anything. </li><li>  Periodically created combinations of thorns, which are impossible to pass. </li></ul><br>  Based on the problems outlined above, I decided to create a good, well-developed generation algorithm that would not allow the creation of "impassable" places, would keep the player in constant tension and with all this would be non-uniform and unique at each level segment. <br><br><h4>  Final generation algorithm </h4><br><h5>  Basic concepts </h5><br><ul><li>  <b>Difficulty</b> - a number from 0 to 100, at the beginning of the game equals 0, as the game progresses gradually increases with a speed of 1 unit.  on 15 meters.  When it reaches 100, it stops growing.  Responsible for the ‚Äúcomplexity‚Äù of the generated traps, however trite it may be. </li><li>  <b>Zone</b> - a section of a level in which traps are generated according to a certain principle, depending on the type of zone. </li><li>  <b>A trap</b> is one thorn or a group of spikes created simultaneously.  There are several types of traps. </li><li>  <b>1 meter</b> - width / height of the little man. </li></ul><br><h5>  Zones </h5><br>  There are several types of zones, for simplicity, I will give a piece of code: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Zones <span class="hljs-comment"><span class="hljs-comment">//  { Random_spikes_on_floor, //      Random_spikes_on_floor_and_solid_ceiling, //          Solid_spikes_on_floor, //     Shuriken_walls, //    ( ) Random //   }</span></span></code> </pre> <br>  At the beginning of the game, the zone is selected randomly from the 5 types above.  The length of the zone is limited when the player completely runs through it, the next zone is selected as well as at the beginning of the game, randomly.  When creating a new zone, a new random length is set (mostly, from 40 to 100 meters).  Also, when changing zones, a small safety net is created between zones, so that they do not ‚Äúinterfere‚Äù with each other. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ff/f35/91f/8fff3591f937b39cf37f453d2442763d.png"><br><br>  Each type of zone has its own chance of appearance, for example, a new zone will be a zone with ‚Äúwalls of shuriken‚Äù with a probability of 30%. <br><br>  The type of zone is responsible for which traps will be generated at this site.  Therefore, each zone has its own peculiarities and ways to overcome obstacles, and, consequently, special rules for generation (so as not to create an impassable section). <br><br>  As mentioned above, the game has a parameter <b>Difficulty</b> , which increases with time from 0 to 100, and this parameter directly affects the number or location of traps during generation in each zone.  But let's move from abstract things to concrete examples. <br><br><h5>  Zone with "random spikes on the floor" </h5><br>  In this zone, the algorithm is based on creating traps mainly from spikes on the floor in a more or less random sequence. <br><br>  An example of generation with minimal complexity (complexity = 0) <br><img src="https://habrastorage.org/getpro/habr/post_images/82f/39c/78f/82f39c78fda2e24b2a4aef4e986ad8cf.png"><br><br>  Generation example with maximum complexity (Complexity = 100) <br><img src="https://habrastorage.org/getpro/habr/post_images/38c/074/28e/38c07428e45829b823609d25bb618c78.png"><br><br>  To begin with, I will explain a little how generation inside any zone works.  When entering the zone, one of the possible (randomly selected) traps is created, and depending on which trap was selected, a new <b>delay</b> is set (after how many meters a new trap will be created in this zone).  As soon as the player passes the <b>delay</b> , a new trap is created, again chosen randomly.  Naturally, for each type of trap in each zone there is a chance of appearance. <br><br>  The basic principle in our area: create or not create spikes on the floor (depending on the randomness).  This zone of all is the simplest in terms of the algorithm and finding problem areas, because it consists mainly of spikes on the floor, which are always at the same height.  Accordingly, we can determine how many spikes in a row can be set, and how many can not be by means of routine testing. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b06/9c2/786/b069c2786ade07cee3b724feafa8430b.png"><br><br>  The image above shows that with a maximum jump height and hovering time, the player can overcome no more than 5 spikes coming close to each other.  Accordingly, the algorithm requires a condition: if there are already at least 5 traps in front of the generated trap, be sure to leave empty space (do not generate a trap).  To do this, it is necessary to remember which traps were before the current one (for this purpose I used the usual array of enums of size 10, since more than 10 it is not necessary to remember). <br><br>  In this zone, each next trap (or absence of a trap) is generated with a <b>delay</b> equal to the trap width.  Thus, if the traps are created continuously, then there will be no free space between them until they are 5 in a row (our condition ‚Äúno longer than 5 spikes in a row‚Äù will work). <br><br>  But we must not forget about the role of randomization in the generation.  Each new trap can either be created or not created.  Here, finally, <b>complexity</b> will play its role.  The higher the <b>complexity</b> , the higher the chance of a spike on the floor. <br><pre> <code class="cs hljs">random = UnityEngine.Random.Range(<span class="hljs-number"><span class="hljs-number">0f</span></span>, <span class="hljs-number"><span class="hljs-number">100f</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    0  100 if (random &lt; 40f + (Difficulty.Difficulty_of_game() * 0.4f)) // Difficulty.Difficulty_of_game()    { // ... ... } else { // ... ... }</span></span></code> </pre><br>  Great, it turned out a good algorithm for generating spikes on the floor, but something is missing.  It is necessary to add rare spikes on the ceiling to add variety, but it is impossible to break the basic logic of overcoming traps.  For example, if you make spikes on the ceiling just above 5 spikes somewhere between them, then the player simply cannot jump as high as he needs to overcome 5 spikes in a row.  Therefore, the spikes on the ceiling should be located somewhere along the edges of such large groups of "floor" traps. <br><br>  Add to the algorithm the creation of "spikes on the ceiling" with a probability of from 70% to 100% (depending on complexity), provided that: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Last_traps[<span class="hljs-number"><span class="hljs-number">1</span></span>] == Traps.None) || (Last_traps[<span class="hljs-number"><span class="hljs-number">2</span></span>] == Traps.None) || (Last_traps[<span class="hljs-number"><span class="hljs-number">3</span></span>] == Traps.None)) { <span class="hljs-comment"><span class="hljs-comment">// ...      ... } else { // ...  ... }</span></span></code> </pre><br>  That is, if the penultimate, or the pre-penultimate, or the pre-penultimate trap is missing (there are no thorns on the ground), then you can create thorns on the ceiling, otherwise you cannot. <br><br>  Great, one algorithm is ready.  It remains to disassemble the remaining 4! <br><br><h5>  Zone with "random spikes on the floor and solid spikes on the ceiling" </h5><br>  This zone is essentially a complicated version of the "zone with random spikes on the floor." <br><br>  Differences: <br><ul><li>  Throughout the zone there are spikes on the ceiling. </li><li>  For variety added ‚Äúshurikens‚Äù in some places. </li><li>  The maximum number of spikes on the floor in a row is not 5, but 4 (due to the spikes on the ceiling, the maximum jump height is reduced). </li></ul><br>  Difficulty = 0 (minimal) <br><img src="//habrastorage.org/files/91a/5b9/f70/91a5b9f70da04f8aa989985895cf35a3.png"><br><br>  Difficulty = 50 (medium) <br><img src="//habrastorage.org/files/9e1/98a/e42/9e198ae42fe844b9a76ab39dc9270b66.png"><br><br>  Difficulty = 100 (maximum) <br><img src="//habrastorage.org/files/b01/9f6/58e/b019f658e70d4fc8acc0bd4556625b60.png"><br><br>  There are no strong differences in the algorithm from the previous zone, except that not spikes on the ceiling are randomly generated, but ‚Äúshurikens‚Äù, and at various difficulties there is a different chance of the appearance of a ‚Äúshuriken‚Äù.  A ‚Äúshuriken‚Äù can appear with a probability from 30% to 60% (linearly dependent on complexity) over a place without spikes on the floor (because if you create them over spikes, there is a very high probability that an impassable place will occur). <br><br>  In addition, "shurikens" can appear at different heights, depending on the complexity.  If you look at the screenshots, it becomes clear that the lower the shuriken, the more difficult it is not to touch it when jumping.  Based on this, I created the dependence of height on complexity: <br><br>  <b>Difficulty [0-50)</b> - Create a shuriken high. <br>  <b>Difficulty [50-80)</b> - 50% Build high;  50% Build at medium height <br>  <b>Difficulty [80-100]</b> - Create at medium height. <br><br><h5>  Spiked Area on the Floor </h5><br>  This zone strongly resembles the first zone ‚Äúwith random spikes on the floor,‚Äù but it has two differences: <br><ul><li>  Spikes always go in a row in groups of 3 to 5 spikes (depending <b>only on the complexity</b> , random does not matter). </li><li>  Between groups of thorns there is always a gap in width comparable to the width of the thorns (2.25 meters). </li></ul><br>  Difficulty = 0 (minimal) <br><img src="//habrastorage.org/files/98e/f40/4c3/98ef404c3240433e8dcbdb64d120b42a.png"><br><br>  Difficulty = 50 (medium) <br><img src="//habrastorage.org/files/822/fcd/54a/822fcd54affd42d1abdcd60d9eebd000.png"><br><br>  Difficulty = 100 (maximum) <br><img src="//habrastorage.org/files/f69/423/7f3/f694237f351b410780683504f052c6c1.png"><br><br>  The main focus in this zone was that the player should always jump to his maximum, that is, through 5 spikes.  But, since the game has a changing <b>complexity</b> , 3 variations of the zone were introduced (see screenshots above): <br><br>  <b>Difficulty [0-25)</b> - Light zone, 3 spikes in a row. <br>  <b>Difficulty [25-75)</b> - Middle zone, 4 spikes in a row. <br>  <b>Difficulty [75-100]</b> - Difficult area, 5 spikes in a row. <br><br>  This zone is probably the easiest, because there are no unexpected and very difficult places, the same situation repeats throughout the zone (N spikes in a row, space, N spikes in a row, space, etc.).  Although, with a complexity of 75, problems begin, because if at least a little wrong time is calculated and you jump earlier, you will fall on the spikes. <br><br>  The spikes on the ceiling here are generated on the same principle as in the first zone, but unlike the first zone, there is no benefit from them except fear and diversity, since it is impossible to run into them because of too small islands without spikes. . <br><br><h5>  Area with ‚Äúwalls of shuriken‚Äù </h5><br>  Here we come to, probably, the most difficult to pass zone.  Its main principle is similar to the trick with the "ring of fire" in the circus: you need to fly between the spikes, without hitting them at the same time.  Let's look at the screenshots for various difficulties: <br><br>  Difficulty = 0 (minimal) <br><img src="//habrastorage.org/files/4ca/fa7/583/4cafa75831da48a5b747cfe7a26d937e.png"><br><br>  Difficulty = 50 (medium) <br><img src="//habrastorage.org/files/256/080/90a/25608090aca3479b8f42312023bb9c75.png"><br><br>  Difficulty = 100 (maximum) <br><img src="//habrastorage.org/files/b91/0d9/b58/b910d9b581b34eac9ce45eba98772674.png"><br><br>  As well as in the previous zone, we have 3 variations in complexity: <br><br>  <b>Difficulty [0-40)</b> - Light zone, holes of width mostly 2 shurikens each. <br>  <b>Difficulty [40-90)</b> - The middle zone is much more complicated than the ‚ÄúLight‚Äù one, since basically there are holes with a width of 1 ‚Äúshuriken‚Äù, there are different ways to overcome it. <br>  <b>Difficulty [90-100]</b> - Difficult area, the holes are always 1 ‚Äúshuriken‚Äù wide, a bit more difficult than the ‚ÄúMedium‚Äù, since the passage is always the same. <br><br>  The main principle of generation of such walls: between each wall is always a constant distance (independent of the randomness), which varies depending on the current <b>complexity</b> .  The distance between the walls is always from 8.5 m to 7.5 m (the higher the <b>complexity</b> , the smaller the distance), and when moving from one subtype of the zone to another (for example, from the Light Zone to the Middle Zone) the distance between the walls will again decrease from 8.5 m to 7.5 m. Thus, with a <b>difficulty of</b> 39.99, there will be ‚Äúlight walls‚Äù in the zone, but the distance between them is 7.5 meters, and with a <b>difficulty of</b> 40 - ‚Äúmedium walls‚Äù, but a distance of 8.5 meters. <br><br>  The distances were tested on different combinations of walls, and it was found that 7.5 meters is the minimum distance at which you can comfortably manage to land and jump again without hitting the spikes.  A gradual decrease from 8.5 meters was made to allow at least some complication within the subtype of the zone. <br><br>  Now how it is determined which wall will be next in the zone.  Everything is very simple, for each complexity there is a certain set of walls from ‚Äúshurikens‚Äù, and each time a random wall is selected from this set: <br><br><img src="//habrastorage.org/files/952/ee2/86e/952ee286ed224ad3bcea2f66d70d32c6.png"><br><br><h5>  Zone with "random generation" </h5><br>  When I created 4 previous zones, everything was fine, but something was missing.  Although my first generation version (full random) was flawed, it still had its own charm.  Therefore, I decided to create another zone, which would essentially be a copy of my first generation version, but without its previous drawbacks (impassable and boring places): <br><br><img src="//habrastorage.org/files/55c/0ac/488/55c0ac48835c4c3dbd94ad9cfaf6766d.png"><br><br>  To create an improved version of the old generation, I created a zone from already existing traps and asked them certain rules and odds: <br><ul><li>  <b>35% "Shuriken" at a random height</b> - the distance to the next trap from 7 to 4 meters (depending on the complexity). </li><li>  <b>30% Weak wall of ‚Äúshuriken‚Äù</b> - created 4 meters further from the previous trap, distance to the next trap from Random (9.5, 11.5) to Random (7.5, 8.5) meters (depending on complexity), provided that Random ( N, M) is a random number from N to M. </li><li>  <b>20% Spikes on the ground and ceiling</b> - the distance to the next trap is from 6 to 3.75 meters (depending on the complexity). </li><li>  <b>10% Spikes on the ground</b> - the distance to the next trap is from 6 to 3.75 meters (depending on the complexity). </li><li>  <b>5% Spikes on the ceiling</b> - the distance to the next trap is from 6 to 3.75 meters (depending on the complexity). </li></ul><br>  The distances between the traps were obtained by numerous tests (including the most critical cases), although after the release one cant was found in creating a wall of ‚Äúshurikens‚Äù, because of which an impassable or very difficult place was very rarely created, but I quickly corrected this cant . <br><br><h4>  Conclusion </h4><br>  As a result, I obtained a fairly complete and non-trivial algorithm for generating traps in a game that: <br><ul><li>  Dynamically generates difficult to pass levels, which creates a <abbr title="call">challenge</abbr> . </li><li>  Does not create dead ends or near dead ends. </li><li>  Each time it creates a unique level, not similar to the previous one. </li><li>  Depends on the gradually increasing complexity. </li></ul><br>  Thank you for reading!  If you have <abbr title="Game Name: niceplay 'Hardmode ON' (free)">questions</abbr> or find any errors, be sure to write about it in the comments.  You can play the game for free here - <a href="http://niceplay-games.com/games/hardmode-on.html">niceplay-games.com/games/hardmode-on.html</a> . </div><p>Source: <a href="https://habr.com/ru/post/230943/">https://habr.com/ru/post/230943/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230931/index.html">Quick Start ST Nucleo-F401 + Quick Start Guide</a></li>
<li><a href="../230933/index.html">Key trends in the market of digital agencies / studios and golden hundred Ruward</a></li>
<li><a href="../230937/index.html">ViMove helps you understand what‚Äôs wrong with your back.</a></li>
<li><a href="../230939/index.html">How I improved the performance of SSRS reports</a></li>
<li><a href="../230941/index.html">Modular comics - an easy way to captivate an audience</a></li>
<li><a href="../230945/index.html">Programmers, speak correctly!</a></li>
<li><a href="../230949/index.html">Tournament of Young Physicists</a></li>
<li><a href="../230951/index.html">Build routes with OpenStreetMap, OSRM and Leaflet</a></li>
<li><a href="../230955/index.html">GoPro Hero 3+ Black Edition - sight of the tourist and cyclist</a></li>
<li><a href="../230957/index.html">Magento step by step</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>