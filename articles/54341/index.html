<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mohawk / Working with Ajax</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I will describe the work with Ajax in Mohawk. 
 Working with Ajax is implemented through the Ajax class, which is located in the kerne...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mohawk / Working with Ajax</h1><div class="post__text post__text-html js-mediator-article">  In this article I will describe the work with Ajax in Mohawk. <br>  Working with Ajax is implemented through the Ajax class, which is located in the kernel / Ajax.js file. <br><br>  The Ajax class takes over the basic routine operations: <br>  - create XmlHttpRequest request <br>  - conversion of special characters in the request data <br>  - drawing up and sending a request to the server <br>  - acceptance of the response from the server <br><br><a name="habracut"></a><br>  For more convenient work, the following classes are also used: <br>  - XML ‚Äã‚Äã- for lightweight work with XML <br>  - FormsInterface - for working with HTML forms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Form and FormsInterface </h4><br>  Let's create a simple HTML form with which we will work.  Let, for example, this will be a feedback form: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">form</font> <font color="#ff0000">id</font> <font color="#0000ff">="feedback"</font> <font color="#ff0000">method</font> <font color="#0000ff">="post"</font> <font color="#ff0000">onsubmit</font> <font color="#0000ff">="return send(this)"</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">fieldset</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">label</font> <font color="#ff0000">for</font> <font color="#0000ff">="name"</font> <font color="#0000ff">&gt;</font> Name: <font color="#0000ff">&lt;/</font> <font color="#800000">label</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="name"</font> <font color="#ff0000">name</font> <font color="#0000ff">="name"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">label</font> <font color="#ff0000">for</font> <font color="#0000ff">="email"</font> <font color="#0000ff">&gt;</font> Email: <font color="#0000ff">&lt;/</font> <font color="#800000">label</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">input</font> <font color="#ff0000">id</font> <font color="#0000ff">="email"</font> <font color="#ff0000">name</font> <font color="#0000ff">="email"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">label</font> <font color="#ff0000">for</font> <font color="#0000ff">="message"</font> <font color="#0000ff">&gt;</font> Message: <font color="#0000ff">&lt;/</font> <font color="#800000">label</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">textarea</font> <font color="#ff0000">id</font> <font color="#0000ff">="message"</font> <font color="#ff0000">name</font> <font color="#0000ff">="message"</font> <font color="#ff0000">cols</font> <font color="#0000ff">="40"</font> <font color="#ff0000">rows</font> <font color="#0000ff">="8"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">textarea</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">li</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">ul</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">button</font> <font color="#ff0000">type</font> <font color="#0000ff">="submit"</font> <font color="#0000ff">&gt;</font> Submit <font color="#0000ff">&lt;/</font> <font color="#800000">button</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">fieldset</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">form</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  At the <i>onsubmit</i> event, the form will call the <i>send</i> function and pass a reference to itself as an argument.  In the function <i>send,</i> we will work.  First we need to get the data from the form.  The DOM extension <i>FormsInterface</i> provides a convenient method for retrieving data from a form: form.  <b>getData</b> (), where form is the form itself.  The <i>getData</i> () method will return data from the form as an associative array: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> send(form) { <br> <font color="#0000ff">var</font> data = form.getData(); <br> <font color="#008000">// data = {'name': 'Alice', 'email': 'alice@example.com', message: 'Hello world!'}</font> <br> <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  Ajax and XML </h4><br>  To work with the Ajax class, you need to connect it: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">include( <font color="#A31515">'mohawk.kernel.Ajax'</font> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  In order to submit the form data, we need to create an Ajax request: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">var</font> request = <font color="#0000ff">new</font> Ajax( <font color="#A31515">'test.xml'</font> , Ajax.METHOD_POST); <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The constructor of the <i>Ajax</i> class takes arguments: the address to which the request will be sent and the HTTP method.  If the method is not specified, the request will be sent by the GET method.  Through the class, you can send not only the usual GET and POST requests, but also PUT, DELETE, HEAD, OPTIONS.  In the latter case, it is possible to emulate requests through POST with sending the corresponding X-Request-Method header.  Ie, for example, a PUT request will be sent via POST, but the header will be: X-Request-Method: PUT.  This is necessary if for some reason you cannot send requests other than GET and POST (for example, Kerio firewall blocks the HTTP DELETE method). <br><br>  So, in order to send a request, you need to call the <b>request.send</b> (data) method, which takes the sent data as an associative array as an argument.  For example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">request.send({ <font color="#A31515">'a'</font> : 1, <font color="#A31515">'b'</font> : 2}); <font color="#008000">// a=1&amp;b=2</font> <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Add an AYAX request to the <i>send</i> function: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> send(form) { <br> <font color="#0000ff">var</font> request = <font color="#0000ff">new</font> Ajax( <font color="#A31515">'test.xml'</font> , Ajax.METHOD_POST); <br> <font color="#0000ff">var</font> data = form.getData(); <br> request.send(data); <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  When you call the <i>send</i> () function, these forms will be sent to the server.  However, we still need to find out that the server has successfully received this data, and in more complex applications it also receives the response from the server.  To do this, we define a handler function that will be called when a response is received from the server.  The handler is set via the request.responseHandler property: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> send(form) { <br> <font color="#0000ff">var</font> request = <font color="#0000ff">new</font> Ajax( <font color="#A31515">'test.xml'</font> , Ajax.METHOD_POST); <br> request.responseHandler = <font color="#0000ff">function</font> (request) { <br> alert( <font color="#A31515">'Tada!'</font> ); <br> } <br> <font color="#0000ff">var</font> data = form.getData(); <br> request.send(data); <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Create a <i>test.xml</i> file to emulate our server.  Suppose the server tells us that everything is ok and displays the message ‚ÄúDone‚Äù: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;?</font> <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">="1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">="UTF-8"</font> ? <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">data</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">status</font> <font color="#0000ff">&gt;</font> ok <font color="#0000ff">&lt;/</font> <font color="#800000">status</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font> Done <font color="#0000ff">&lt;/</font> <font color="#800000">message</font> <font color="#0000ff">&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">data</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  If we test the form, then after sending, we are given an alert box "Tada!". <br>  Let's complicate our handler.  We want to get a response from the server, namely: status and message.  The argument to the <i>request.responseHandler</i> function, we pass, refers to the AYAX request: <i>request</i> .  After receiving the server's response, the request.data property will appear on the request object, which will contain data from the server.  The <i>XML</i> object automatically parses the XML response, and as a result, the <i>request.data</i> will contain the associative array with the server response: {'status': 'ok', 'message': 'Done!'} <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> send(form) { <br> <font color="#0000ff">var</font> request = <font color="#0000ff">new</font> Ajax( <font color="#A31515">'test.xml'</font> , Ajax.METHOD_POST); <br> request.responseHandler = <font color="#0000ff">function</font> (request) { <br> <font color="#0000ff">var</font> response = request.data; <br> alert( <font color="#A31515">'Status: '</font> + response.status + <font color="#A31515">', message: '</font> + response.message); <br> } <br> <font color="#0000ff">var</font> data = form.getData(); <br> request.send(data); <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h4>  Json </h4><br>  Many developers prefer JSON instead of XML.  For example, the server response may be in this format ( <i>test.js</i> ): <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">{ <br> status: <font color="#A31515">'ok'</font> , <br> message: <font color="#A31515">'Done!'</font> <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  To accept JSON data, you need to change only two lines: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">function</font> send(form) { <br> <font color="#008000">//  test.xml  test.js</font> <br> <font color="#0000ff">var</font> request = <font color="#0000ff">new</font> Ajax( <font color="#A31515">'test.js'</font> , Ajax.METHOD_POST); <br> <br> <font color="#008000">//     - 'json'</font> <br> request.type = Ajax.TYPE_JSON; <br> <br> request.responseHandler = <font color="#0000ff">function</font> (request) { <br> alert( <font color="#A31515">'Tada!'</font> ); <br> } <br> <font color="#0000ff">var</font> data = form.getData(); <br> request.send(data); <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  As you can see from the example, the Ajax class allows you to completely abstract from the format of the transmitted and received data.  We can work with XML, and with JSON, without changing the logic of the application. <br><br><h4>  Debugging Ajax Requests </h4><br>  When developing applications that use Ajax, debugging requests are often required.  You need to see what went where and what came from there.  Firefox has a wonderful firebug for this purpose, and Opera has a built-in console for web developers.  In the beta version of Chrome 2, it seems that it is possible to view Ajax requests.  But in IE, as usual, problems arise with debugging. <br><br>  You can see the requests and responses sent by Ajax from the server using the Mohawk debugging console.  The console connects quite simply: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">include( <font color="#A31515">'mohawk.UI.Console'</font> ); <br> <br> <font color="#0000ff">var</font> Console = <font color="#0000ff">new</font> Mohawk.UI.Console(); <br> Console.regKey(); <br> <font color="#0000ff">document</font> .addLoader( <font color="#0000ff">function</font> () { <br> Console.append(); <br> });</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  An example of console logs: <br> <code>Ajax query sent to: test.xml <br> Data: <br> name:Alice <br> email:alice@emaxmple.cmo <br> message:Hello world! <br> Query: name=Alice&amp;email=alice@emaxmple.cmo&amp;message=Hello world! <br> <br> Ajax query received from: test.xml <br> Data: <br> &lt;?xml version="1.0" encoding="UTF-8"?&gt; <br> &lt;data&gt; <br> &lt;status&gt;ok&lt;/status&gt; <br> &lt;message&gt;Done&lt;/message&gt; <br> &lt;/data&gt; <br></code> <br><br>  <a href="http://demo.irokez.org/mohawk/ajax.html">View console operation and sample form.</a> <br>  <a href="http://irokez.org/download/mohawk/">Download Mohawk with examples</a> <br>  You can also read the <a href="http://habrahabr.ru/blogs/irokez_cms/53778/">introduction to Mohawk</a> and about <a href="http://habrahabr.ru/blogs/irokez_cms/54086/">JS-templating</a> </div><p>Source: <a href="https://habr.com/ru/post/54341/">https://habr.com/ru/post/54341/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../54330/index.html">CUDA: Start</a></li>
<li><a href="../54331/index.html">Interview with Peter Didenko (Microsoft)</a></li>
<li><a href="../54333/index.html">Test drive a RAID array of 24 SSDs</a></li>
<li><a href="../54338/index.html">Audiowood wooden players</a></li>
<li><a href="../54339/index.html">Cufflinks for the printer</a></li>
<li><a href="../54342/index.html">You rummaged through the security system of any service and discovered a vulnerability. Your actions:</a></li>
<li><a href="../54346/index.html">Launching torrents from a mobile phone through a DVD photo</a></li>
<li><a href="../54347/index.html">Caviar</a></li>
<li><a href="../54348/index.html">Giftologia.com eliminates misunderstandings</a></li>
<li><a href="../54349/index.html">Advertising on VKontakte "in action" or how to become a fraudster!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>