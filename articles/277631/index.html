<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kilometers of logs and recovery of databases on MS SQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Or how to easily restore databases from a long chain of backups 
  

 Introduction 
 If you are using SQL Server, you have probably heard about the Fu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kilometers of logs and recovery of databases on MS SQL</h1><div class="post__text post__text-html js-mediator-article"><h3>  Or how to easily restore databases from a long chain of backups </h3><br> <a href="https://habrahabr.ru/company/softlab/blog/277631/"><img src="https://habrastorage.org/getpro/habr/post_images/46e/3a6/792/46e3a6792a2b3936cb845f1cf48de09e.jpg"></a> <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  If you are using SQL Server, you have probably heard about the Full and Simple Database Recovery Model.  You may know that the Simple Model allows you to restore data only at the time of the backup, while Full - at any point in time, you only need to regularly make backup copies of the transaction log.  However, to restore data with the Full Model, you will need to "roll" backups of transaction logs in a certain sequence.  This can be done without problems using SSMS, but only on the SQL Server volume where the backups were made.  To restore to another server, you will need to manually write a T-SQL script.  And the longer the backup chain will be, the more the script itself will be and the more time it will take to create it.  For the same reason, administrators rarely use already created backups when they need to deploy a copy of the database to another SQL Server, and prefer to create a fresh full backup.  But such a procedure can be a real problem for large databases due to high server load.  In addition, if the server is "down", then, as a rule, there is no time to write a long T-SQL script for recovery.  At such moments, you need to do everything as quickly as possible and without unnecessary hassle. <br><br>  On the Internet, including on Habr√© (for example, <a href="https://habrahabr.ru/post/154907/">here</a> ), you can find various methods that solve the problem of automated creation of a T-SQL recovery script.  These are mainly different scripts based on backup file names or requests to the source server for the backup history (to the <i>msdb</i> database).  In this article, I would like to review the capabilities of the XML recovery plans that appeared in Quick Maintenance &amp; Backup for MS SQL since version 1.6. <br><br>  An overview of the utility itself can be found in the article at <a href="https://habrahabr.ru/company/softlab/blog/266033/">this link</a> or on the official <a href="http://qmbsql.ru/">site</a> .  The presence of an XML recovery plan in a network folder along with backups will not waste time preparing a T-SQL script.  No matter how long the backup chain is, in a few clicks you will restore the database to another SQL Server.  You can also do this on a schedule, on a test or production server, for example, to check the entire backup chain or update database copies. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What is an XML Recovery Plan? </h2><br>  An XML recovery plan is an XML file that lists backup file names in the sequence required to restore one or more databases.  Sample XML content: <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre><code class="hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="cp866"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanInfo</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:i</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.datacontract.org/2004/07/ScriptManagerServer.Core.ScriptManagerServerCore.BackupRestore"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Version</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerName</span></span></span><span class="hljs-tag">&gt;</span></span>London<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerVersion</span></span></span><span class="hljs-tag">&gt;</span></span>10<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerVersion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerDescriptrion</span></span></span><span class="hljs-tag">&gt;</span></span>Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ServerDescriptrion</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CreationDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T17:00:04.65625+03:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CreationDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Databases</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span>Northwind<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorePoint</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T17:00:02<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorePoint</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span>London\Northwind\Full\20160216_155457_London_Northwind_Full.bak<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span>Full<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T15:54:57<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000021900037<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000023500001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StopAt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i:nil</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span>London\Northwind\Diff\20160216_162546_London_Northwind_Diff.bak<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span>Differential<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T16:25:47<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000024300034<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000025800001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StopAt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i:nil</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span>London\Northwind\Log\20160216_163000_London_Northwind_Log.trn<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span>Log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T16:30:01<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000024300001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000025800001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StopAt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i:nil</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span>London\Northwind\Log\20160216_170001_London_Northwind_Log.trn<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FileName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span>Log<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Position</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span>2016-02-16T17:00:02<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BackupStartDate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000025800001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FirstLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span>58000000025800001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LastLsn</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StopAt</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">i:nil</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbFileInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Files</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanDbInfo</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Databases</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">RestorationPlanInfo</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br>  The XML file is always located in the root folder with backup copies and contains relative paths to the backup files.  Such an organization allows not to lose relevance after copying files to another location, for example, to a network folder. <br><br><h2>  Creating an XML Plan </h2><br>  The program allows you to create an XML plan in two ways: <br><br><ul><li>  For those who serve databases using QMB, it is sufficient to set the <i>Create XML Recovery Plan</i> property in the service policy.  Now the XML file will be recreated every time after creating any backup in the maintenance script.  If the program is configured to copy backups to a network folder, the XML-plan file will also be copied.  Thus, there will always be a fresh XML recovery plan in the network folder. <br><br></li><li>  Those who already have a regular <i>maintenance plan that</i> creates backups can take advantage of a special task and create an XML recovery plan on schedule.  In the task, you must specify the name of the XML file, the database and the connection to the folder where the XML recovery plan will be created, see the figure.  In order for a task to run on a schedule, it must be included in the script. <br></li></ul><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2d7/76a/061/2d776a0613de4e16bf361b6d56979df4.png"></div><br>  Before creating the XML file, the program will determine the sequence of backup copies of the information stored in the <i>mdsb</i> system database, in the same way as SQL Server Management Studio does.  For the first and second methods, the XML plan will contain the sequence of backups needed to restore the database <u>to the last possible state</u> . <br><br>  An important feature is that when creating an XML plan, the program always checks for the presence of backup files.  If at least one of the files is not found, the program will generate an error.  In this way, the integrity of the entire chain is further monitored.  If the XML plan is created using a task, you can automatically copy the missing backups from the source server.  To do this, you need to install the corresponding sign in the task. <br><br><h2>  XML plan recovery </h2><br>  Recovery of databases on the XML plan can be performed in two ways: <br><br>  <b>1. Manually.</b>  To do this, the program has a special window that is called by the ‚Äú <i>Restore by XML-plan‚Äù</i> command from the context menu in the tree-like list of servers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7df/eaf/d93/7dfeafd93977caf50fa40fff0f8dac19.png"></div><br>  On the form you need to select the XML file and the database, which backups will be restored.  Please note, you can restore to the same database, temporary or specified database.  The recovery mode to a temporary database is convenient for checking the backup chain.  The mode in the <i>Specified database</i> can be useful if you need to restore to a specific database, for example, with non-standard placement of its files on disks.  By clicking the "Show T-SQL" button, you can view the generated T-SQL script that will be launched for recovery. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0e2/4a5/829/0e24a582984a12c61aba69a050bd9f0c.png"></div><br>  <b>2. Automatically according to the set schedule.</b>  For example, if you need to regularly check the backup chain on a test SQL Server, or update databases.  For these purposes, the program has a special task.  The parameters specified in the task are almost the same as those specified on the manual recovery form. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5c3/d6f/5e6/5c3d6f5e65087837b144bd0719e2a0f2.png"></div><br>  In order for a task to run on a schedule, it must be included in the script.  For example, at night.  A detailed log of the recovery can be viewed in the maintenance log. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14f/4d4/ddc/14f4d4ddc73c0159389bfe13a4ff46a0.png"></div><br><h2>  Conclusion </h2><br>  The mechanism of XML recovery plans in QMB is an excellent opportunity to make it much easier for administrators to recover data from kilometer logs, transfer databases to another SQL Server and check backups.  The mechanism can be used even in cases where a standard Maintenance Plan is used for backup.  In the future, we plan to prepare an article on how to do this with the help of the program. <br><br>  If you already use QMB and did not use this feature, then rather include an XML recovery plan!  We are pleased to answer your questions in the comments or by e-mail <a href="">support@qmbsql.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/277631/">https://habr.com/ru/post/277631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277609/index.html">What to replace Cisco? Import Substitution Access Switches</a></li>
<li><a href="../277615/index.html">Testing plugins for Apache Cordova</a></li>
<li><a href="../277617/index.html">Do not miss the chance to get on // Build: develop or update the UWP application and participate in Race to Build 2016</a></li>
<li><a href="../277625/index.html">Blockchain application stack</a></li>
<li><a href="../277629/index.html">Write code that is easy to remove and not add</a></li>
<li><a href="../277635/index.html">Get websocket data using swift and populate UITableView (node.js server)</a></li>
<li><a href="../277637/index.html">Automatic work with SMS on the modem ZTE-MF823</a></li>
<li><a href="../277639/index.html">Implementing a MODBUS RTU server using the Fastwel interface module and CoDeSys software</a></li>
<li><a href="../277643/index.html">Load testing - product quality assurance stage</a></li>
<li><a href="../277645/index.html">Amelisa. Offline and realtime engine for React and Mongo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>