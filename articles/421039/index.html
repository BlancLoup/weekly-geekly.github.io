<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitor UPS workstations in Windows with Network UPS Tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When does the task arise to monitor workstations without failures? Squeaked - replaced, the end. Repairing UPSs is a thankless task, changing batterie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitor UPS workstations in Windows with Network UPS Tools</h1><div class="post__text post__text-html js-mediator-article">  When does the task arise to monitor workstations without failures?  Squeaked - replaced, the end.  Repairing UPSs is a thankless task, changing batteries ‚Äî not everyone wants to mess around (or even moveton). <br><br>  So I thought, especially after the UPS series with the failed electronics.  The situation was aggravated by software from manufacturers.  He, as if to put it more softly, junk.  And at all - APC, Ippon, Powercom, TrippLite.  What server that for workstations.  Trying the paid versions after the experience with free ones - no desire has arisen.  But quite fun when UPS from different manufacturers. <br><br>  But still need to monitor.  The advantages are obvious: 1) you can change the UPS before it gives a farewell squeak;  2) you can immediately see where the battery died, and where the electronics. <br>  The minus is as simple as ever: the cost of the solution, in money or man-hours. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This problem will be solved. <br><a name="habracut"></a><br>  If we have a zoo, then the most adequate way is <a href="http://www.networkupstools.org/">Network UPS Tools</a> . <br><br>  According to him there is little information about Windows, but there is still no GUI.  But we will <a href="https://github.com/automatize-it/NUT_UPS_monitoring_webserver_for_Windows">solve it</a> . <br><br>  In fairness it should be noted that there is a similar <a href="https://github.com/rshipp/webNUT">project in Python</a> .  But for me personally, it seems completely unnecessary to use Python (and similar technical solutions) where you can get along with a couple of lines of native scripting. <br><br><div class="spoiler">  <b class="spoiler_title">Disclaimer</b> <div class="spoiler_text"><ul><li>  This is not a ‚Äúturnkey solution‚Äù. </li><li>  This is not a sentence, but a story. </li><li>  Yes, there is Zabbix, Cacti, etc, and these are heavyweight solutions for large companies that require a dedicated server and still some kind of intermediate layer to support the appropriate UPS protocol. </li><li>  With all of the above, the solution is quite simple, easy enough and costs 0 currency. </li></ul><br></div></div><br>  Of course, to collect information, you will need UPS with the info-port.  I have problems with IPPON COM-port, everything else works with a bang. <br><br>  Usually for workstations using the connection of the UPS via USB, this case and consider.  It is necessary to install NUT on all workstations with UPS. <br>  Possible problems with this: <br><br><ul><li>  &gt; The <b>libusb</b> driver <b>should be installed separately</b> .  Those included do not understand all UPSs; </li><li>  If libusb offers the <b>standard name HID UPS Battery</b> , you need to <b>change it</b> - with a standard name some systems for some reason do not see the UPS; </li><li>  if the installation process has the message " <b>Driver without digital signature</b> ", then it <b>must be reinstalled by hand</b> , otherwise it will fly off; </li><li>  if libusb did not recognize the UPS model, then the first time the driver is set to INCORRECT!  This is indicated by the error "upsmon ERROR ACCESS DENIED", or the driver simply flies.  It is necessary: ‚Äã‚Äãto stop the NUT service, remove the libusb driver, wait until the ‚ÄúUSB input device‚Äù is installed, select the libusb driver for it manually; </li><li>  For NUT <b>, third-party libraries are needed</b> , which are not included in the installation kit.  Setup speaks about it, but who reads it :) Plus, often the systems already have software with these libraries.  Exactly needed: libeay32.dll, ssleay32.dll, libgcc_s_dw2-1.dll (available in the NUT-bin folder), libusb.dll (available in the libusb distribution), msvcr71.dll (included in Net Framework 1.1).  All these files must be in the Windows \ System32 folder; </li><li>  sometimes you need to specify bus = "bus-0" for USB UPS in ups.conf; </li><li>  on fast machines and on some network cards, the NUT service starts earlier than the driver and / or network interface.  In this case, the startup type ‚ÄúStartup (delayed launch)‚Äù results in the error ‚Äúupsc ERROR DATA STALE‚Äù.  Solution: create a task that will check for the presence of the upsd process when an event with code 1 appears from the source ‚ÄúNetwork UPS Tools‚Äù and restart the Network UPS Tools service download the xml file of the task download script (must be in the NUT \ others folder). </li></ul><br>  An example script of semi-automatic installation of NUT on clients: <br><br><pre><code class="hljs pgsql">N:\NUT-Installer<span class="hljs-number"><span class="hljs-number">-2.6</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span><span class="hljs-number"><span class="hljs-number">-6.</span></span>msi /qn <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\ssleay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libeay32.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libgcc_s_dw2<span class="hljs-number"><span class="hljs-number">-1.</span></span>dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\dll\libusb.dll C:\Windows\System32 /Y <span class="hljs-keyword"><span class="hljs-keyword">copy</span></span> N:\etc\* "%programfiles%\NUT\etc" rem  IP-    NUT  <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.100</span></span><span class="hljs-number"><span class="hljs-number">.10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IP Address" rem Uncomment the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Windows <span class="hljs-number"><span class="hljs-number">7</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">with</span></span> removing "rem")! <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> ip_address_string="IPv4-" REM echo Network <span class="hljs-keyword"><span class="hljs-keyword">Connection</span></span> Test <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> /f "usebackq tokens=2 delims=:" %%f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (`ipconfig ^| findstr /c:%ip_address_string%`) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> IP=%%f ECHO <span class="hljs-keyword"><span class="hljs-keyword">LISTEN</span></span> %IP% <span class="hljs-number"><span class="hljs-number">3493</span></span> &gt;&gt; "%programfiles%\NUT\etc\upsd.conf" rem   libusb  N:\libusb-win32-bin<span class="hljs-number"><span class="hljs-number">-1.2</span></span><span class="hljs-number"><span class="hljs-number">.6</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>\bin\inf-wizard.exe rem  ,     notepad "%programfiles%\NUT\etc\ups.conf" notepad "%programfiles%\NUT\etc\upsmon.conf" pause net use N: /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> /Y</code> </pre> <br>  <b>How to understand why NUT does not work under Windows:</b> <br><br><ul><li>  check if nut.exe processes </li><li>  if it is, check upsd.exe and upsmon.exe </li><li>  if upsd is not in the processes, go to nut \ sbin and run with your hands: </li><li>  ‚ÄúUpsd cannot be started because there is no dll‚Äù - check dll in system32, reboot just in case; </li><li>  "Upsd error creating named pipe" - upsd is already running </li><li>  starts and closes immediately - check the ip-address in upsd.conf in the LISTEN section, especially true if it is on a DHCP machine; </li><li>  Upsd started, but does not see UPS - install or reinstall libusb, check libusb.dll in system32, rename the device from the HID UPS Battery; </li><li>  if upsd started, go to bin and execute upsc our_ups @ localhost </li><li>  ‚ÄúUpsc cannot be started because there is no dll‚Äù - check the libraries; </li><li>  ‚ÄúUpsc failed connection unknown error‚Äù - check whether upsd and upsmon are running, carefully check the MONITOR section in upsmon.conf, check dll libraries once again; </li><li>  ‚ÄúUpsc error data stale‚Äù - either the UPS started up once and no longer works, then reinstall the libusb driver and rename the HID UPS Battery, or the NUT service went up faster than the network interface or USB UPS became visible, restart the service; </li><li>  ‚ÄúUpsmon error ACCESS DENIED‚Äù - reinstall the driver as described above. </li></ul><br>  <b>For the monitoring server are needed:</b> <br><br><ul><li>  NUT in standalone mode; </li><li>  any web server with php and mysql.  I use <a href="http://www.uniformserver.com/">Uniform Server</a> </li><li>  MySQL-base and folder www from the repository, and a couple of batch-scripts from there. </li></ul><br>  Base SQL and www put in the appropriate directories of the web north.  Scripts from batch_scripts are copied to the NUT installation folder.  We start the web server, go to <a href="http://localhost/index_ups.php">localhost / index_ups.php</a> .  Add any of the client UPS in the format UPS_name @ host.  Run the get_ups_list_mysql.cmd script.  We are checking.  Enjoy <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/7ca/2c0/c3c/7ca2c0c3c4d9aca4d199dbbd452f0341.png" width="400" alt="image"></a> <br><br>  What can we see useful, besides the current state?  For example: <br><br><ul><li>  if the minimum battery voltage is close to 10, it is better to replace it in advance; </li><li>  at normal voltages, the failure of the UPS will most likely be related to the failure of the electronics (yours, KO); </li><li>  a load of more than 70 percent is undesirable, 100 is not normal, if not associated with the self-test event; </li><li>  A minimum battery charge of less than 30% indicates a battery failure or incorrect auto shut-off settings when discharged at the client. </li></ul><br>  A few points: <br><br><ul><li>  columns can be sorted by clicking on the header; </li><li>  maximum / minimum values ‚Äã‚Äãare displayed through a slash to the current, critical values ‚Äã‚Äãare marked in red; </li><li>  be careful with the self-test button. </li></ul><br>  If someone has problems with the installation / operation of NUT under Windows - write, let's figure it out together. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/421039/">https://habr.com/ru/post/421039/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421029/index.html">How to increase the capacity of stores and get rid of queues</a></li>
<li><a href="../421031/index.html">Random.org - a story length of 20 years</a></li>
<li><a href="../421033/index.html">Smart book - where the evolution of digital printing will lead</a></li>
<li><a href="../421035/index.html">New 3D stars of social networks, and why they can be dangerous for us</a></li>
<li><a href="../421037/index.html">What is an ‚Äúintuitive interface‚Äù in chatbots, virtual assistants, avatars and social robots?</a></li>
<li><a href="../421041/index.html">KDD 2018, the fifth and final day</a></li>
<li><a href="../421043/index.html">Mitap about writing applications on Lua using the Corona engine</a></li>
<li><a href="../421047/index.html">Analogs in the "Nomenclature". Another way to save wisely. Part 1</a></li>
<li><a href="../421049/index.html">Designing application screens: from planning to design layout</a></li>
<li><a href="../421051/index.html">How I launched my first SaaS project by being employed all day</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>