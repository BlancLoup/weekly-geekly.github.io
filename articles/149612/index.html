<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CPython vs. IronPython: MD5 Hash Calculation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was necessary somehow to make an auto-update for the client application in the project. Since it worked with domestic crypto-providers, which were ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CPython vs. IronPython: MD5 Hash Calculation</h1><div class="post__text post__text-html js-mediator-article">  It was necessary somehow to make an auto-update for the client application in the project.  Since it worked with domestic crypto-providers, which were easier to access from .Net, it was written in IronPython.  At the same time, C # was not chosen, since python was already actively used on the server side and we didn‚Äôt want to relearn much. <br><br>  It would seem simple.  A script was compiled that calculates md5 hashes for the files included in the application, combines everything into one file with strings of the ‚Äúrelative path‚Äù type: "md5" and puts nginx in the distribution directory of statics.  The client application takes a file when it starts up, runs a similar script, and compares the result with the standard. <br><br>  But then a little detail came to light.  In IronPython, the script ran several times slower.  And it is on a fairly fast iron.  The user could be much weaker.  Optimization began, during which the idea was born to compare the performance of CPython and IronPython using this example.  The article, respectively, considers three separate results: for CPython, IronPython and IronPython with an adapted script. <br>  Results under the cut. <br><a name="habracut"></a><br><h5>  Configuration </h5><br><ul><li>  Core i5 650 3.20 GHz </li><li>  8 GB of RAM </li><li>  Windows 7 Enterprise x64 </li><li>  Python 2.7.1 </li><li>  IronPython 2.7.3 </li></ul><br>  The directory with the application files was used as the ‚Äúfood‚Äù for the script.  It includes the IronPython Runtime itself, additional libraries, and other necessary files.  Only about 350 files from kilobytes to three megabytes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Script code: <br><pre><code class="python hljs"><span class="hljs-number"><span class="hljs-number">1</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-number"><span class="hljs-number">2</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib <span class="hljs-number"><span class="hljs-number">3</span></span>| <span class="hljs-number"><span class="hljs-number">4</span></span>| <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMD5sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fileName)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>| m = hashlib.md5() <span class="hljs-number"><span class="hljs-number">6</span></span>| fd = open(fileName, <span class="hljs-string"><span class="hljs-string">'rb'</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span>| b = fd.read() <span class="hljs-number"><span class="hljs-number">8</span></span>| m.update(b) <span class="hljs-number"><span class="hljs-number">9</span></span>| fd.close() <span class="hljs-number"><span class="hljs-number">10</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m.hexdigest() <span class="hljs-number"><span class="hljs-number">11</span></span>| <span class="hljs-number"><span class="hljs-number">12</span></span>| output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>| rootpath = <span class="hljs-string"><span class="hljs-string">'app'</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>| <span class="hljs-number"><span class="hljs-number">15</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dirname, dirnames, filenames <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(rootpath): <span class="hljs-number"><span class="hljs-number">16</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> filenames: <span class="hljs-number"><span class="hljs-number">17</span></span>| fname = os.path.join(dirname, filename).replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-number"><span class="hljs-number">18</span></span>| md5sum = getMD5sum(fname) <span class="hljs-number"><span class="hljs-number">19</span></span>| output+=<span class="hljs-string"><span class="hljs-string">'{0}:{1}\n'</span></span>.format(fname.replace(rootpath, <span class="hljs-string"><span class="hljs-string">''</span></span>), md5sum) <span class="hljs-number"><span class="hljs-number">20</span></span>| <span class="hljs-number"><span class="hljs-number">21</span></span>| f = open(<span class="hljs-string"><span class="hljs-string">'./checksums.csv'</span></span>, <span class="hljs-string"><span class="hljs-string">'w'</span></span>) <span class="hljs-number"><span class="hljs-number">22</span></span>| f.write(output) <span class="hljs-number"><span class="hljs-number">23</span></span>| f.close()</code> </pre> <br><br>  The same script adapted for IronPython: <br><pre> <code class="python hljs"> <span class="hljs-number"><span class="hljs-number">1</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-number"><span class="hljs-number">2</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> System.IO <span class="hljs-number"><span class="hljs-number">3</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> System.Security.Cryptography <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MD5CryptoServiceProvider <span class="hljs-number"><span class="hljs-number">4</span></span>| <span class="hljs-number"><span class="hljs-number">5</span></span>| <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMD5sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fileName)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>| b = System.IO.File.ReadAllBytes(fileName) <span class="hljs-number"><span class="hljs-number">7</span></span>| md5 = MD5CryptoServiceProvider() <span class="hljs-number"><span class="hljs-number">8</span></span>| hash = md5.ComputeHash(b) <span class="hljs-number"><span class="hljs-number">9</span></span>| result = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> b <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> hash: <span class="hljs-number"><span class="hljs-number">11</span></span>| result += b.ToString(<span class="hljs-string"><span class="hljs-string">"x2"</span></span>) <span class="hljs-number"><span class="hljs-number">12</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result <span class="hljs-number"><span class="hljs-number">13</span></span>| <span class="hljs-number"><span class="hljs-number">14</span></span>| output = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>| rootpath = <span class="hljs-string"><span class="hljs-string">'app'</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span>| <span class="hljs-number"><span class="hljs-number">17</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> dirname, dirnames, filenames <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> os.walk(rootpath): <span class="hljs-number"><span class="hljs-number">18</span></span>| <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> filenames: <span class="hljs-number"><span class="hljs-number">19</span></span>| fname = os.path.join(dirname, filename).replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, <span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-number"><span class="hljs-number">20</span></span>| md5sum = getMD5sum(fname) <span class="hljs-number"><span class="hljs-number">21</span></span>| output += fname.replace(rootpath, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">':'</span></span> + md5sum + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>| <span class="hljs-number"><span class="hljs-number">22</span></span>| System.IO.File.WriteAllText(<span class="hljs-string"><span class="hljs-string">'checksums.csv'</span></span>, output)</code> </pre><br>  In principle, the whole adaptation comes down to the fact that the reading / writing of files and the calculation of hashes are rewritten to .Net.  This gives a sufficient performance boost.  This is due to the fact that ipy itself is written in c # and most of the ‚Äúbatteries‚Äù are just a wrapper for .Net.  In this sense, the difference between the 19 lines of the main line and 21 adapted ones may look interesting: <br><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">19</span></span>| output += <span class="hljs-string"><span class="hljs-string">'{0}:{1}\n'</span></span>.format(fname.replace(rootpath, <span class="hljs-string"><span class="hljs-string">''</span></span>), md5sum)</code> </pre><br><pre> <code class="python hljs"><span class="hljs-number"><span class="hljs-number">21</span></span>| output += fname.replace(rootpath, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) + <span class="hljs-string"><span class="hljs-string">':'</span></span> + md5sum + <span class="hljs-string"><span class="hljs-string">'\n'</span></span></code> </pre><br>  In ipy, the second option was faster.  As for python, I could not see the difference exceeding the statistical error. <br><br><h5>  results </h5><br>  And so, the results of cold starts (average): <br><ul><li>  CPython: ~ 0.06 s. </li><li>  IronPython: ~ 0.33 s. </li><li>  IronPython (adapted script): ~ 0.16 s. </li></ul><br>  With the naked eye it can be seen that the same script in python and IronPython are executed with a more than five-fold advantage on the python side.  At the same time, the script adapted for ipy, although it is still executed slower, but the result is already quite acceptable. <br><br>  There is another nuance: on the client, this script must be embedded in the application itself.  Accordingly, it is not so much the time of cold start that is of interest, but the time of its direct execution, without taking into account the start of the interpreter.  Let's reproduce this behavior by putting the code in a loop. <br><br>  Typical results: <table><tbody><tr><td>  CPython </td><td>  ipy </td><td>  ipy (adapt.) </td></tr><tr><td>  0: 00: 00.057000 </td><td>  0: 00: 00.327000 </td><td>  0: 00: 00.161000 </td></tr><tr><td>  0: 00: 00.056000 </td><td>  0: 00: 00.243000 </td><td>  0: 00: 00.093000 </td></tr><tr><td>  0: 00: 00.055000 </td><td>  0: 00: 00.234000 </td><td>  0: 00: 00.099000 </td></tr><tr><td>  0: 00: 00.058000 </td><td>  0: 00: 00.228000 </td><td>  0: 00: 00.096000 </td></tr><tr><td>  0: 00: 00.055000 </td><td>  0: 00: 00.226000 </td><td>  0: 00: 00.093000 </td></tr><tr><td>  0: 00: 00.055000 </td><td>  0: 00: 00.236000 </td><td>  0: 00: 00.093000 </td></tr><tr><td>  0: 00: 00.055000 </td><td>  0: 00: 00.225000 </td><td>  0: 00: 00.093000 </td></tr><tr><td>  0: 00: 00.055000 </td><td>  0: 00: 00.261000 </td><td>  0: 00: 00.092000 </td></tr><tr><td>  0: 00: 00.057000 </td><td>  0: 00: 00.240000 </td><td>  0: 00: 00.092000 </td></tr><tr><td>  0: 00: 00.057000 </td><td>  0: 00: 00.227000 </td><td>  0: 00: 00.093000 </td></tr></tbody></table><br><h5>  findings </h5><br>  According to the results of this test, it is already possible to draw a more or less plausible conclusion.  It can be seen that approximately 0.7 seconds is the time required just to launch the IronPython interpreter itself.  During this time, the script running in the native python has time to complete.  CPython starts virtually instantly and as you can see, the first iteration was as fast as the next ones.  At the same time, it is clear that even code optimized for ipy, launched on hot, is almost one and a half times slower than the native one. <br><br>  Using the same code for CPython and IronPython seems to be of no use at all if performance is at all critical.  However, this is not the only IronPython restriction when using the same code.  There are some nuances and bugs not related to performance, but this is beyond the scope of this article.  However, I want to make a reservation that the refusal to use IronPython is also out of the question.  He quite successfully copes with the responsibilities assigned to him. <br><br>  I will be glad to hear constructive criticism. <br><br>  <b>UPD</b> <br>  <a href="http://habrahabr.ru/users/mstyura/" class="user_link">mstyura</a> offered a more optimized version of the script for ipy with a more interesting result: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> System.IO <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StreamWriter, Directory, SearchOption, File, Path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> System <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> String, BitConverter, Environment, Array <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> System.Security.Cryptography <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> MD5CryptoServiceProvider <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMD5sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(fileName)</span></span></span><span class="hljs-function">:</span></span> stm = File.OpenRead(fileName) md5 = MD5CryptoServiceProvider() hash = md5.ComputeHash(stm) stm.Close() <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> BitConverter.ToString(hash).Replace(<span class="hljs-string"><span class="hljs-string">"-"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).ToLower() rootpath = <span class="hljs-string"><span class="hljs-string">'app'</span></span> workingDir = Environment.CurrentDirectory Environment.CurrentDirectory = rootpath appFiles = Directory.EnumerateFiles(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>, SearchOption.AllDirectories) output = StreamWriter(File.OpenWrite(Path.Combine(workingDir, <span class="hljs-string"><span class="hljs-string">'checksums.csv'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> _, file <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> enumerate(appFiles): output.Write(file.replace(<span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"\\"</span></span>, <span class="hljs-string"><span class="hljs-string">"/"</span></span>)) output.Write(<span class="hljs-string"><span class="hljs-string">":"</span></span>) output.WriteLine(getMD5sum(file)) output.Close() Environment.CurrentDirectory = workingDir</code> </pre><br>  The result of this option: <br>  0: 00: 00.116000 <br>  0: 00: 00.063000 <br>  0: 00: 00.064000 <br>  0: 00: 00.063000 <br>  0: 00: 00.059000 <br>  0: 00: 00.059000 <br>  0: 00: 00.058000 <br>  0: 00: 00.058000 <br>  0: 00: 00.058000 <br>  0: 00: 00.059000 <br><br>  It is seen that a little bit more and he will overtake python - they are almost on a par.  The start is of course still slow, but it has also become faster, apparently due to the fact that Python libraries are not imported and used.  But if you just add import os and call os.walk (rootpath) once for a single time, it will increase the time of the first iteration to ~ 0.145 c!  However, apparently this function itself is so heavy.  If you call something simple like os.getcwd (), the speed does not change much </div><p>Source: <a href="https://habr.com/ru/post/149612/">https://habr.com/ru/post/149612/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149605/index.html">Teach computer feelings (sentiment analysis in Russian)</a></li>
<li><a href="../149606/index.html">Bart Chalkboard Generator</a></li>
<li><a href="../149607/index.html">Java computer vision for Android. BoofCV Library Overview</a></li>
<li><a href="../149608/index.html">Work and travel - stupid, useless, humiliating?</a></li>
<li><a href="../149610/index.html">What should Android apps look like?</a></li>
<li><a href="../149613/index.html">Report on the attempt to get the declared performance from the prepared statements</a></li>
<li><a href="../149615/index.html">Published records of the Summer School reports Windows 8</a></li>
<li><a href="../149616/index.html">IT Compote # 18 Programming and Technology Podcast</a></li>
<li><a href="../149618/index.html">Open blog Medium from Twitter creators</a></li>
<li><a href="../149620/index.html">Business is like football</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>