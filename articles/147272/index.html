<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Compare the performance of integer multiplication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting to write a test program for this article, I internally expected that the Intel CPU will put on both blades of AMD, as well as the eponymous c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Compare the performance of integer multiplication</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage1/22ada24c/d5fa13ab/2b40684c/2517a28e.png">  Starting to write a test program for this article, I internally expected that the Intel CPU will put on both blades of AMD, as well as the eponymous compiler will win Visual Studio without a fight.  But not everything is so simple, maybe it was influenced by the choice of software test? <br><br>  For the test, I used the integer multiplication of two 128-bit numbers to get a 256-bit result.  The test was repeated 1 billion times and took only 12 to 85 seconds.  AMD FX-8150 3.60GHz and Intel Core i5 2500 3.30GHz processors were used.  No multi-threading, no overclocking. <br><br>  The compilers used were Intel Parallel Studio XE Version 12.0.0.104 Build 20101006, its newer reincarnation 12.1.5.344 Build 20120612, Visual Studio 2010 SP1 and the most modern Visual Studio 2012 (with the Metro and CAPSLOCK menu), also known as C ++ 11.0 Release Candidate.  We do not forget about the -O2 option, it is enabled in Visual Studio.  And for Intel this is optional, it optimizes with -O2 by default, for Intel the -O3 option is enabled. <br><a name="habracut"></a><br>  I will give the test itself.  I agree that for a 64-bit code it would be necessary to make BN_WORD equal to __int64, then BN_DWORD should be divided into low and high parts, and to multiply this economy, use an intrinsic called _mul128, which is supported by data compilers.  All this is in the plans and is supposed to be done later.  The purpose of this article is to compare optimizing compilers, but not to compare the speed of 32-bit and 64-bit multiplication, as well as discarding one myth. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs mel">#include &lt;stdio.h&gt; #include &lt;windows.h&gt; #define QUANTITY <span class="hljs-number"><span class="hljs-number">4</span></span> typedef unsigned <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> BN_WORD; typedef unsigned __int64 BN_DWORD; void Mul(BN_WORD *C, BN_WORD *A, BN_WORD *B ) { BN_WORD Carry = <span class="hljs-number"><span class="hljs-number">0</span></span>; BN_WORD h = *(B++); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j; union { BN_DWORD sd; BN_WORD sw[<span class="hljs-number"><span class="hljs-number">2</span></span>]; } s; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = QUANTITY; i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; --i) { s.sd = (BN_DWORD) *(A++) * h + Carry; *C++ = s.sw[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Carry = s.sw[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } *C = Carry; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( j = QUANTITY<span class="hljs-number"><span class="hljs-number">-1</span></span>; j &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; --j ) { A -= QUANTITY; h = *(B++); C -= QUANTITY<span class="hljs-number"><span class="hljs-number">-1</span></span>; Carry = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( i = QUANTITY; i &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; --i ) { s.sd = (BN_DWORD) *(A++) * h + *C + Carry; *C++ = s.sw[<span class="hljs-number"><span class="hljs-number">0</span></span>]; Carry = s.sw[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } *C = Carry; } } typedef void (*my_proc)(BN_WORD*, BN_WORD*, BN_WORD*); void put_addr(void) { FILE *f=<span class="hljs-keyword"><span class="hljs-keyword">fopen</span></span>(<span class="hljs-string"><span class="hljs-string">"tmp.$$$"</span></span>, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>); my_proc <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> = Mul; <span class="hljs-keyword"><span class="hljs-keyword">fwrite</span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, sizeof(<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>), f); <span class="hljs-keyword"><span class="hljs-keyword">fclose</span></span>(f); } my_proc get_addr(void) { FILE *f=<span class="hljs-keyword"><span class="hljs-keyword">fopen</span></span>(<span class="hljs-string"><span class="hljs-string">"tmp.$$$"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); my_proc <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> = NULL; <span class="hljs-keyword"><span class="hljs-keyword">fread</span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, sizeof(<span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>), f); <span class="hljs-keyword"><span class="hljs-keyword">fclose</span></span>(f); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(void) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i,j; LARGE_INTEGER lFrequency, lStart, lEnd; double dfTime1; BN_WORD A[QUANTITY], B[QUANTITY], C[QUANTITY*<span class="hljs-number"><span class="hljs-number">2</span></span>]; BN_WORD RES[QUANTITY*<span class="hljs-number"><span class="hljs-number">2</span></span>]={<span class="hljs-number"><span class="hljs-number">0xd7a44a41</span></span>, <span class="hljs-number"><span class="hljs-number">0xf6e4895c</span></span>, <span class="hljs-number"><span class="hljs-number">0x1624c878</span></span>, <span class="hljs-number"><span class="hljs-number">0x35650795</span></span>, <span class="hljs-number"><span class="hljs-number">0xa55cb22f</span></span>, <span class="hljs-number"><span class="hljs-number">0x861c7313</span></span>, <span class="hljs-number"><span class="hljs-number">0x66dc33f7</span></span>, <span class="hljs-number"><span class="hljs-number">0x479bf4db</span></span> }; <span class="hljs-comment"><span class="hljs-comment">// ,   inline    Mul   main void (*mul)( BN_WORD *C, BN_WORD *A, BN_WORD *B ); put_addr(); mul = get_addr(); for( i=0; i&lt;QUANTITY; ++i) { A[i] = B[i] = 0x87654321; } QueryPerformanceFrequency(&amp;lFrequency); QueryPerformanceCounter(&amp;lStart); for( i=0; i&lt;1000; ++i) { for( j=0; j&lt;1000000; ++j) { mul(C, A, B); } if (memcmp(RES, C, sizeof(RES))!=0) { printf("Something wrong!\n"); } } QueryPerformanceCounter(&amp;lEnd); dfTime1 = (double)(lEnd.QuadPart - lStart.QuadPart) / (double)lFrequency.QuadPart; printf("Time = %g sec\n", dfTime1); }</span></span></code> </pre> <br><br>  The results are shown in the table: <br><table><tbody><tr><th></th><th>  AMD FX-8150 3.60GHz 64 bit </th><th>  AMD FX-8150 3.60GHz 32 bit </th><th>  Core i5-2500 3.30GHz 64 bit </th><th>  Core i5-2500 3.30GHz 32 bit </th></tr><tr><th>  Intel Parallel Studio XE 12.0.0.104 Build 20101006 </th><td>  22.6235 sec </td><td>  25.913 sec </td><td>  13.0921 sec </td><td>  23.1986 sec </td></tr><tr><th>  Intel Parallel Studio XE 12.1.5.344 Build 20120612 </th><td>  22.2398 sec </td><td>  26.0347 sec </td><td>  12.9242 sec </td><td>  23.1603 sec </td></tr><tr><th>  Visual Studio 2010 C ++ 10.0 SP1 </th><td>  22.5853 sec </td><td>  84.1714 sec </td><td>  12.4991 sec </td><td>  53.633 sec </td></tr><tr><th>  Visual Studio 2012 C ++ 11.0 Release Candidate </th><td>  22.2952 sec </td><td>  72.8279 sec </td><td>  12.6212 sec </td><td>  47.1136 sec </td></tr></tbody></table><br><br>  On 64-bit code we have approximately the same result for all three compilers. <br><br>  On 32 bits, Intel wins a lot, VS2010 lags behind it, and the newest VS2012 demonstrates strong growth, although Intel is far from it. <br><br>  It is also interesting to compare the speed of work on AMD and Core i5.  With a similar price of 7,000 rubles, processors show similar performance in 32-bit applications on the Intel compiler.  Although it was expected that in the single-threaded test will always be the advantage of Core i5.  There are plans to write a multi-threaded test to tap the full power of 8 AMD cores.  And then he will most likely win, since he has 8 integer arithmetic cores (but 4 floating point cores) against 4 cores in Core i5, there is no multi-threading support for (my) Core i5. <br><br>  One more important conclusion suggests itself - compiler manufacturers have thrown all their efforts into creating an optimizing 64-bit compiler, while achieving similar results.  Processor manufacturers also threw all their forces on the 64-bit platform, while Intel significantly outperforms AMD. <br><br>  Another interesting fact is that the myth has been debunked that the Intel compiler allegedly creates code that works well only on Intel, and shows disastrous performance on AMD (2 or more times slower).  It is easy to see that the Intel compiler on 32-bit code gives about the same result when switching from AMD to Intel CPU, but the VS compiler gives a boost, why the Core i5 is undergoing significant acceleration, if you use the code from VS, you haven‚Äôt figured out yet.  (Really, why?) <br><br>  UPD1.  In the first edition of this article, an error crept in due to the fact that, due to the cunning optimization, VS2010 did not multiply and the code was obtained 5.5 times faster.  Now the source code has been corrected (the mul pointer has been entered on f-ju Mul, and the pointer is written / read from the file to deceive the compiler), the results are updated.  And _WORD corrected to BN_WORD for full clarity, judging by the first comment. </div><p>Source: <a href="https://habr.com/ru/post/147272/">https://habr.com/ru/post/147272/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147264/index.html">Speech, language and music</a></li>
<li><a href="../147266/index.html">Mining and processing of gaming traffic</a></li>
<li><a href="../147267/index.html">Ultrabooks Lenovo IdeaPad U310 and U410</a></li>
<li><a href="../147269/index.html">How REG.RU climbed to the top</a></li>
<li><a href="../147271/index.html">Hacking hashes at PHDays 2012: Hash Runner contest</a></li>
<li><a href="../147273/index.html">Remote control of a windows user session using standard tools</a></li>
<li><a href="../147274/index.html">Google transfers GWT project management to an independent committee.</a></li>
<li><a href="../147275/index.html">Some experience in working with the FatFree Framework</a></li>
<li><a href="../147276/index.html">How Microsoft became what it used to despise</a></li>
<li><a href="../147277/index.html">Single-line C / C ++. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>