<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ivideon launched cloud video storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some artists cannot stand the sight of their creations when they are finished. And I am my biggest fan. OW Grant (Interstate 60) 



 The Ivideon team...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ivideon launched cloud video storage</h1><div class="post__text post__text-html js-mediator-article">  <i>Some artists cannot stand the sight of their creations when they are finished.</i>  <i>And I am my biggest fan.</i>  OW Grant (Interstate 60) <br><br><img src="https://habrastorage.org/storage2/2b9/335/d79/2b9335d794cd00705040768da112c071.png"><br><br>  The Ivideon team has been working on the remote storage service for archived video records in its own cloud for more than a year (I don‚Äôt like this word).  Why so long, technical details and how to get free access to it for Habr's readers - you will learn under the cut. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Why not use existing cloud storage? </h4><br><br><img src="https://habrastorage.org/storage2/32d/a94/caa/32da94caafe3379ce289bafc6ee8fc1d.png"><br><br>  There are several well-known platforms for creating cloud storage.  For example, the same OpenStack, which, by the way, we also supported.  Nevertheless, they have completely realized their decision for themselves.  Why did we do that?  To answer this question you need to understand the specifics of storing a remote archive of video surveillance.  The fact is that almost all cloud platforms are designed primarily for the predominance of read operations on the record.  This is partly why incoming traffic to the clouds is free, and outgoing costs money.  For such a platform, in most cases it is not so important in what order the recorded files are stored on disks.  Although work on the optimization is certainly underway. <br><br>  The situation is different with video surveillance system storage.  First of all, there is an obvious significant predominance of write operations on read operations.  People view no more than 1 - 2% of all archived records.  And sometimes even less. <br><br>  Despite the fact that the recording is made by the motion detector, with a large number of clients the data flow is constantly.  And everything would be fine if it were not for the limited amount of hard drives.  At some point, the oldest user entries need to be deleted in order to make room for new ones.  And here problems with ordinary clouds already begin. <br><br>  Imagine the average user according to our statistics per day can generate about 1200 video recordings of observation of different duration from one camera.  For the video to be available to the user not after the end of the entire recording, but, for example, in a minute, it is required to divide each recording into small portions, which should be stored in the cloud.  That is, files may not be 1200, but significantly more.  Suppose they are 2500. <br><br><img src="https://habrastorage.org/storage2/af7/34d/523/af734d52395c01041023cb22a3f95510.jpg"><br><br>  Now imagine that on a single physical hard disk, there are files for a week from 200 users.  And at some point, the procedure of archive rotation is launched - deleting the oldest files recorded in three days.  It is necessary to delete about 1.5 million files at once!  Certainly - the cloud will work.  Slowly, but it will work.  Only hard drives for a long time will not sustain such a load, and as you know, in cloud storage it is one of the most expensive elements.  And we get that cloud storage will be a very expensive service for the average user.  And we have always strived to give people not only the highest quality, but also affordable service from all that is on the market. <br><br><h4>  How we implemented our storage </h4><br>  The Ivideon cloud has a hierarchical structure and is created as an independent element of the entire Ivideon platform.  That is, it can be developed and tested separately from the entire service as a whole.  We strive to provide this approach throughout our development so that relatively independent groups of developers can work on individual modules.  As a result, we are able to increase the speed of developing elements of our platform, attracting new developers to the project. <br><br>  As frontend we use a group of servers with a large amount of RAM.  Currently, each of these servers contains about 96 GB of memory. <br><br>  The task of this server is the accumulation of ready fragments from the cameras for several minutes.  All these fragments are written exclusively in memory. <br>  About 80 - 100 MB are allocated for each camera.  The server receives many video frames from different cameras.  As soon as the fragment finishes, it is immediately queued for sending to the backend storage.  The memory is specially allocated more than the size of one fragment, so that at the time of sending the completed fragment there is a place to write a new one. <br><br>  What are backends like?  This is a group of servers with 36 disks each, which can be located in one data center or in several, depending on the required degree of reliability of storage.  Let's call these servers nodes.  Each fragment can be duplicated on a given number of nodes, depending on the setting of the user's tariff plan.  And to distribute the load on the nodes are used sharding mechanisms.  The maximum speed of a physical record in a node is calculated and controlled so that the amount of data transferred per unit of time does not exceed this parameter. <br><br><img src="https://habrastorage.org/storage2/8ed/510/627/8ed510627c39303a98629676491fb3f3.jpg"><br><br>  From a software point of view, we support the nodes OpenStack, web-dav, nfs, etc.  But to store the archive in our data centers, we use our own software implementation of the node.  In this case, the connection with it is carried out via the internal HTTP-base protocol.  In fact, an almost instantaneous transfer of an already completed fragment and its writing to the node is performed.  As well as entering the fragment data into the internal database.  The base is mongoDB, installed on separate servers. <br><br>  But that is not all.  To solve the problem of deleting a large amount of old records and reducing disk fragmentation as a result of this deletion in our node implementation, we developed our own file system.  Of course, it sounds quite loud, but there‚Äôs really nothing complicated about it.  Each fragment is written to disk no longer as a separate file, but combined in series with the previous ones, forming one large file with records within an hour.  In the following articles we will try to tell about it in more detail. <br><br>  At the moment when it is necessary to rotate the archive and delete the data for several days, the node is temporarily marked as not ready for recording and new fragments are distributed among other nodes.  This is done so that during deletion no entry is made to the node to prevent fragmentation. <br><br>  Then the uninstall process itself starts.  In which you need to delete not 7500 small files from each user, but only 72, since each file is a record in one hour. <br><br><h4>  Summary </h4><br>  Here I did not talk about many of the intricacies of the work of our platform, for example, associated with different tariff plans.  Someone keeps a week archive, and someone month.  Also, I did not focus on the specific details of working with well-known elements used in our platform.  For example, MongoDB.  And this is the topic for the next article. <br><br>  I hope, thanks to this, the presentation turned out clear and at the same time useful. <br>  I just want to add that, as always, we only use Linux in our data centers and optimize our server software for it. <br><br>  And finally.  We tried very hard to conduct a comprehensive and load testing of our remote storage platform.  And nevertheless, we launch it in Beta mode and set a ‚Äúrestraining‚Äù tariff so that the growth in load is controlled from our side.  But if someone from Habr's reader wants to help us, by taking part in testing, write in a personal note, specify the e-mail of your personal account and we will deposit the required amount of money into your account so that the use of <a href="http://xn--b1aedjb6ag.xn--p1ai/">Ivideon</a> cloud storage is <a href="http://xn--b1aedjb6ag.xn--p1ai/">free</a> for you. </div><p>Source: <a href="https://habr.com/ru/post/147894/">https://habr.com/ru/post/147894/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147886/index.html">Mobile applications in China: developers do not earn</a></li>
<li><a href="../147889/index.html">Do you block your smartphone / phone with a password?</a></li>
<li><a href="../147890/index.html">Why object-oriented programming sucks</a></li>
<li><a href="../147891/index.html">Ouya: $ 5 million with Kickstarter is just the beginning</a></li>
<li><a href="../147892/index.html">How to put an investor on the shoulder or the three principles of Khoja Nasreddin</a></li>
<li><a href="../147896/index.html">Why OOP doesn't suck</a></li>
<li><a href="../147897/index.html">Facebook began implementing SPDY protocol</a></li>
<li><a href="../147899/index.html">AWS ELB: Forced disconnection of the instance from the balancer</a></li>
<li><a href="../147900/index.html">800,000 signed a petition for the right to download videos from Youtube</a></li>
<li><a href="../147901/index.html">A fresh look at impurities in javascript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>