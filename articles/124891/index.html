<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Peer network in video player</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some users have already noticed in our video player a window with a proposal to allow the use of a peering network. Watching videos using peer-to-peer...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Peer network in video player</h1><div class="post__text post__text-html js-mediator-article">  Some users have already noticed in our video player a window with a proposal to allow the use of a peering network.  Watching videos using peer-to-peer technology is the last stage of testing.  Of all the videos uploaded to the site at one time or another, as a rule, no more than 10‚Äì15% are viewed.  Another 15‚Äì20% of these clips can be considered popular.  Switching to P2P significantly reduces server load, allowing users to receive video stream from neighboring clients (of course, who also confirmed their participation in the peer-to-peer network). <br><br><img src="http://k.min.us/iefHT2.png"><br><br><a name="habracut"></a><br>  The development uses the <a href="http://www.adobe.com/devnet/flashmediaserver/articles/p2p_rtmfp_groups.html">RTMFP</a> protocol implemented by Flash Player 10.1 from the client side and Adobe Cirrus from the server side. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This reduces latency when playing videos at once for two reasons.  On the one hand, direct requests to the north are rarely made, and it becomes easier for the server to breathe and respond to other requests.  On the other hand, the speed of receiving data from the "neighbors" can often be higher than from the server in the data center, because the system selects partners based on considerations of maximum efficiency. <br><br>  A video player can only distribute the video that is viewed at one time or another - and only that part of it that has been downloaded and is still in memory.  At the same time, the size of the buffer can not exceed 64 MB, in order not to eat off too much RAM.  Theoretically, it is enough to have two simultaneously watching video users to enable P2P mode.  However, it is advisable only for those videos that are watched simultaneously by dozens of users (as mentioned above, for VKontakte, such videos make up about 15‚Äì20% of those that are actively viewed).  In the case of playing videos for which the use of p2p will not bring visible results, the player switches to standard download. <br><br>  To identify clients, only the key issued by the Adobe Cirrus server is used, neither the IP address nor the user's uid can be recovered using it). <br><br><img src="http://k.min.us/ibSASA.png"><br><br><h2>  Technical details </h2><br>  As mentioned above, to merge into a separate group of users viewing the same video (in the same resolution), the Cirrus service from Adobe is currently used, interacting with the RTMFP protocol.  Support for the corresponding NetGroup class appeared only in Flash Player version 10.1 - therefore, users with a tenth version player will not see the offer to use P2P. <br><br>  To organize the exchange between users of parts of one video, the file is divided into chunks of 64 KB.  Each chunk is first requested from neighboring peers (this whole process is governed internally by the Flash player and the Cirrus server), and if there is no answer, a request is made directly to Vkontakte video servers within a few seconds - the data is divided into chunks and distributed to other users. <br><br>  To output the loaded chunks, the so-called ‚ÄúData Generation Mode‚Äù of the NetStream class is used.  Unfortunately, it doesn‚Äôt support the MP4 format, which is now used to store the V Kontakte video, so the video files collected from the chunks now have an MP4 to FLV container on the fly. <br><br>  Due to the need to keep the reproduced file identical regardless of the starting point, it was decided to abandon the creation of key frames on the server side when playing from an arbitrary location.  The selection of the frame closest to the selected moment is now also made by the client, which additionally reduces delays when rewinding the video. <br><br><br><h2>  Subtotals </h2><br>  The main results at the current stage are a noticeable reduction in delays: <ol><li>  When playing popular videos simultaneously downloaded by a large number of users. </li><li>  When playing any video from any place. </li></ol>  Larger conclusions at this stage do early.  Statistics collected now indicates that approximately 7 to 10% of all data is downloaded from peers.  The percentage is growing steadily. </div><p>Source: <a href="https://habr.com/ru/post/124891/">https://habr.com/ru/post/124891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../124885/index.html">Changes in Kohana 3.2 in Russian</a></li>
<li><a href="../124886/index.html">The evolution of a web project - what not to forget to provide in the TK</a></li>
<li><a href="../124887/index.html">Business trip: getting ready. Part Two - Suitcase</a></li>
<li><a href="../124889/index.html">Chatroulette on Google+</a></li>
<li><a href="../124890/index.html">How would I talk about the capabilities of the Intel Z68 Express chipset using the example of MSI Z68A-GD80 (B3)</a></li>
<li><a href="../124893/index.html">Google Image Search has started to show EXIF ‚Äã‚Äãmetadata</a></li>
<li><a href="../124896/index.html">Another archive of scientific papers is online</a></li>
<li><a href="../124898/index.html">Yandex continues to issue</a></li>
<li><a href="../124899/index.html">Chosen: make drop-down lists more friendly</a></li>
<li><a href="../124902/index.html">Dark color scheme for Netbeans</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>