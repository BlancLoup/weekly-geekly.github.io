<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>BitPaymer (FriedEx) coder created by Dridex banker trojan authors</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dridex successfully attacked private users, companies and financial institutions for several years, becoming a nominal category of banking Trojans. 

...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>BitPaymer (FriedEx) coder created by Dridex banker trojan authors</h1><div class="post__text post__text-html js-mediator-article">  Dridex successfully attacked private users, companies and financial institutions for several years, becoming a nominal category of banking Trojans. <br><br>  The new ESET study proves that the authors of Dridex are behind another well-known malware family ‚Äî BitPaymer‚Äôs sophisticated coder, which is detected by ESET antivirus products like Win32 / Filecoder.FriedEx and Win64 / Filecoder.FriedEx. <br><br><img src="https://habrastorage.org/webt/l1/um/er/l1umer5udtjaqk93ah-4ri1ytyg.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><h3>  Dridex </h3><br>  The Dridex banking trojan was first discovered in 2014 and was a relatively simple bot created on the basis of older projects.  However, the authors quickly turned it into one of the most sophisticated banking Trojans on the market.  It seems that the development continues - new versions of the bot with minor corrections and updates are released almost weekly.  From time to time there are major updates with new features or significant changes.  The latest update from version 3 to version 4 was introduced in early 2017, <a href="https://thehackernews.com/2017/03/dridex-atombombing-malware.html">with the Atom Bombing injection technique</a> introduced.  Later in 2017, the authors introduced a <a href="https://www.proofpoint.com/us/threat-insight/post/dridex-campaigns-millions-recipients-unpatched-microsoft-zero-day">new 0-day exploit</a> using a vulnerability in Microsoft Word, which made it possible to cover millions of victims. <br><br>  At the time of writing this post, the newest version of Dridex 4.80 includes support for web injects in Chrome version 63. Dridex 4.80 was released on December 14, 2017. <br><br>  Note: Last year we released a <a href="https://github.com/eset/volatility-browserhooks">tool</a> to identify malicious hooks in popular web browsers.  The tool is designed to help detect potential infections by banker Trojans, including Dridex. <br><br><h3>  FriedEx </h3><br>  Originally named BitPaymer (based on text on the site with a ransom demand), the encoder was discovered in early July 2017 by <a href="https://twitter.com/demonslay335/status/884545841691844608">Michael Gillespie</a> .  In August, Malvar attracted attention after a <a href="https://www.bleepingcomputer.com/news/security/bit-paymer-ransomware-hits-scottish-hospitals/">successful attack</a> on the institutions of the National Health Service of Scotland. <br><br>  FriedEx is focused on high-ranking targets and companies, rather than ordinary users, and is usually delivered via RDP brute force.  The program encrypts each file using a randomly generated RC4 key, which is then encrypted using a hard-coded 1024-bit RSA public key and stored in the appropriate <code>.readme_txt</code> file. <br><br>  In December 2017, we reviewed one of the FriedEx samples and almost immediately found similarities with Dridex.  Interested in the discovery, we conducted a detailed study and found out that FriedEx uses the same methods of hiding information about behavior as Dridex. <br><br>  FriedEx recognizes all system API calls on the fly, searching for them with a hash, stores all strings in an encrypted form, scans keys and registry values ‚Äã‚Äãwith a hash, etc. The resulting binary file is hardly noticeable from the point of view of static properties;  finding out what malware does without a more in-depth analysis is problematic. <br><br>  For this reason, we conducted a further analysis that revealed additional attributes that confirmed suspicions - two families of malicious programs were created by the same developers. <br><br><h3>  Code similarities </h3><br><img src="https://habrastorage.org/webt/ci/5k/_b/ci5k_bp-v8g8c70kko3u2eprddo.png"><br>  <i>Figure 1. Comparison of the GetUserID function in the Dridex and FriedEx samples - find ten differences</i> <br><br>  Figure 1 shows the part of the function used to generate the UserID, which can be found in all Dridex binary files (bootloaders and bot modules).  The function specific to Dridex is also used in FriedEx binary files.  The task of the function is the same - to generate a string from several attributes of the victim's machine, which serves as a unique identifier - in the botnet, if we are talking about Dridex and for the encoder in the case of FriedEx. <br><br>  Such similarity with Dridex is present in all binary files FriedEx.  Only a few functions do not match the Dridex pattern, usually associated with the specific capabilities of the encoder (the encryption cycle and the creation of files with the message of redemption). <br><br><img src="https://habrastorage.org/webt/x4/fd/a0/x4fda0hylhm7wjm6tvjrcp1rjo8.png"><br>  <i>Figure 2. Comparison of the order of functions in the Dridex and FriedEx samples.</i>  <i>Functions missing in another sample are highlighted in color.</i> <br><br>  Another common feature is the sequence of functions in binary files, which occurs when the same code base or static library is used in several projects.  As we can see in Figure 2, in the FriedEx sample some of the functions that are present in the Dridex sample are missing and vice versa, but the order remains the same. <br><br>  Note: automatic generated pairs of function names based on addresses in the code ( <code>sub_CA5191</code> and <code>sub_2A56A2</code> , etc.) are obviously not the same, but the code to which they refer is the same. <br><br>  It is worth mentioning that both the Dridex and FriedEx use the same malicious packer.  However, this packer is currently extremely popular, which is probably due to its effectiveness in preventing detection and complicating the analysis.  It is used in other malware families, including QBot, Emotet, and Ursnif, so we do not consider its presence to be conclusive evidence. <br><br><h3>  PDB paths </h3><br>  When creating a Windows executable file, the linker may include a PDB (Program Database) path pointing to a file that contains debugging symbols to help the developer fix bugs and identify failures.  In fact, a PDB file is almost never present in malware, since it is a separate file that does not fall into the distribution. <br><br>  The path can provide valuable information, because PDB files are located by default in the same directory as the compiled executable file, and usually have the same base name followed by the .pdb extension.  Logically, the PDB path is usually not included in malware, because the authors do not want to disclose any information.  Fortunately, in some samples of Dridex and FriedEx there is a PDB path. <br><br><img src="https://habrastorage.org/webt/8q/xt/we/8qxtwefrnh74v0htew-o3lkhv2a.png"><br>  <i>Figure 3. All PDB paths found in the Dridex and FriedEx projects</i> <br><br>  As you can see in Figure 3, the binary files of both projects are collected in the same directory.  Based on a search in the metadata of the available malware samples, we concluded that the path <code>S:\Work\_bin\</code> is unique for the Dridex and FriedEx projects. <br><br><h3>  Timestamps </h3><br>  We have several cases of detecting Dridex and FriedEx with the same compilation date.  This could be a coincidence, but after closer examination, we excluded such a version. <br><br>  Moreover, compilations with the same dates differ by several minutes (it can be assumed that the authors of Dridex compiled both projects at the same time), but the randomly generated constants in these samples are also identical.  Constants change in each compilation as a form of polymorphism to make analysis more difficult and to help avoid detection.  This can be completely randomized at each compilation or based on some variable, such as the current date. <br><br><img src="https://habrastorage.org/webt/w2/7u/t-/w27ut-2po-xlcmzvqksfhh7nchs.png"><br>  <i>Figure 4. The GetAPIByHash function in Dridex samples with a compilation time difference of three days.</i>  <i>Selected constants differ</i> <br><br>  In Figure 4, we compare two Dridex samples with a three-day compile-time difference.  Loaders are almost identical, the only difference is hard-coded data, such as encryption keys and IP addresses of C &amp; C servers.  In this case, the constants are different, and therefore all the hashes are based on them. <br><br>  On the other hand, in Figure 5 you can see a comparison of Dridex and FriedEx bootloaders compiled on the same day (the difference in timestamps is two minutes).  The constants are the same; this indicates that both samples were created during the same compilation session. <br><br><img src="https://habrastorage.org/webt/lb/gq/lr/lbgqlrvtdrt_2xfsuhq-uuvfowg.png"><br>  <i>Figure 5. The GetAPIByHash function in binary Dridex and FriedEx files compiled on the same day.</i>  <i>Selected constants are identical in both samples.</i> <br><br><h3>  Compiler info </h3><br>  The compiler information confirms the proofs listed earlier - the Dridex and FriedEx binary files are compiled in Visual Studio 2015. This is confirmed by the linker version found in the PE header, and the Rich Header data. <br><br><img src="https://habrastorage.org/webt/su/d8/4u/sud84um0ox1khhlbd7mnrof68n4.png"><br>  <i>Figure 6. Rich header data in Dridex and FriedEx samples</i> <br><br>  In addition to the obvious similarity with Dridex, we are faced with a previously undocumented 64-bit version of the encoder.  Since the usual 32-bit version can be focused on x86 and x64 systems, this sample seems to be quite interesting. <br><br><h3>  Conclusion </h3><br>  In view of the above evidence, we believe that FriedEx is the work of the creators of Dridex.  This discovery gives us a more complete picture of the activities of the cyber group - we found that hackers remain highly active and not only constantly update the banking Trojan (web injection support for the latest versions of Chrome or the introduction of new features, including Atom Bombing), but also follow the latest trends by creating your own encoder. <br><br>  It is difficult to predict the future, but we believe that the Dridex group is not going to curtail activities in the near future, will continue to support the old project and, possibly, expand the portfolio with new samples. <br><br>  For a long time, the Dridex group was considered an ‚Äúactor of one role‚Äù focused on its banking Trojan.  Today we found out that this is not the case;  hackers easily adapt to new trends and create other types of malware that can compete with the most advanced in their category. <br><br><h3>  Indicators of compromise </h3><br> <code>Win32/Dridex.BE C70BD77A5415B5DCF66B7095B22A0DEE2DDA95A0 <br> Win64/FriedEx.A CF1038C9AED9239B6A54EFF17EB61CAB2EE12141 <br> Win32/FriedEx.A 8AE1C1869C42DAA035032341804AEFC3E7F3CAF1</code> </div><p>Source: <a href="https://habr.com/ru/post/348364/">https://habr.com/ru/post/348364/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348354/index.html">How ZFS Stores Data</a></li>
<li><a href="../348356/index.html">Transition from AngularJS to Angular: goals, plans and rules for transferring elements (1/3)</a></li>
<li><a href="../348358/index.html">10 Gigabit Ethernet: Newbie Tips</a></li>
<li><a href="../348360/index.html">OpenVPN OSPF between two servers, multiple tunnels</a></li>
<li><a href="../348362/index.html">Where in Siberia to talk about IT</a></li>
<li><a href="../348366/index.html">Personal experience with Firebase Cloud Firestore</a></li>
<li><a href="../348368/index.html">Dynamic font size change throughout an Android application using Configuration.fontScale</a></li>
<li><a href="../348374/index.html">Translation of the book "Social Architecture": Chapter 5. Design, development, innovation</a></li>
<li><a href="../348376/index.html">pdbe is an assistant to the built-in python debugger and debugging process</a></li>
<li><a href="../348378/index.html">VDOM do it yourself</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>