<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Composite "datasource" object and elements of the functional approach</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I (well, not even me) faced the task of adding one cell of a completely different type to a UICollectionView with a certain cell type, and doing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Composite "datasource" object and elements of the functional approach</h1><div class="post__text post__text-html js-mediator-article"> Once I (well, not even me) faced the task of adding one cell of a completely different type to a <code><a href="https://developer.apple.com/documentation/uikit/uicollectionview">UICollectionView</a></code> with a certain cell type, and doing this only in a special case that is processed ‚Äúabove‚Äù and does not depend on <code>UICollectionView</code> directly.  This task gave rise to, if my memory serves me, a couple of ugly <a href="https://docs.swift.org/swift-book/ReferenceManual/Statements.html"><code>if</code> - <code>else</code></a> blocks inside the <code><a href="https://developer.apple.com/documentation/uikit/uicollectionviewdatasource">UICollectionViewDataSource</a></code> and <code><a href="https://developer.apple.com/documentation/uikit/uicollectionviewdelegate">UICollectionViewDelegate</a></code> , which safely settled into the ‚Äúproduction‚Äù code and probably won't get anywhere from there. <br><br>  Within the framework of the mentioned task, it makes no sense to think over any more elegant solution, to waste time and ‚Äúthinking‚Äù energy, there was not.  Nevertheless, I remember this story: I thought about trying to implement some kind of ‚Äúdatasource‚Äù object, which could be composed of any number of other ‚Äúdatasource‚Äù objects into a single whole.  The solution, obviously, should be generalized, suitable for any number of components (including zero and one) and not depend on specific types.  It turned out that this is not only real, but not too difficult (although it is a little harder to make the code also ‚Äúbeautiful‚Äù). <a name="habracut"></a><br><br>  I will show what I got on the example of <code><a href="https://developer.apple.com/documentation/uikit/uitableview">UITableView</a></code> .  If desired, to write a similar code for a <code>UICollectionView</code> should be no difficulty. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  "The idea is always more important than its embodiment" </h2><br>  <i>This aphorism belongs to the great comic book author <a href="https://en.wikipedia.org/wiki/Alan_Moore">Alan Moore</a> ( <a href="https://en.wikipedia.org/wiki/Watchmen">‚ÄúKeepers‚Äù</a> , <a href="https://en.wikipedia.org/wiki/V_for_Vendetta">‚ÄúV means Vendetta‚Äù</a> , <a href="https://en.wikipedia.org/wiki/The_League_of_Extraordinary_Gentlemen">‚ÄúLeague of Distinguished Gentlemen‚Äù</a> ), but this is not exactly about programming, right?</i> <br><br>  The main idea of ‚Äã‚Äãmy approach is to store an array of <code><a href="https://developer.apple.com/documentation/uikit/uitableviewdatasource">UITableViewDataSource</a></code> objects, return their total number of sections, and be able to determine which of the original ‚Äúdatasource‚Äù objects to redirect this call to when accessing a section. <br><br>  The <code>UITableViewDataSource</code> protocol already has the necessary methods for obtaining the number of sections, lines, etc., but, unfortunately, in this case I found it extremely inconvenient to use them because of the need to pass a link to a specific instance of <code>UITableView</code> as one of the arguments.  So I decided to extend the standard <code>UITableViewDataSource</code> protocol with a couple of extra simple members: <br><br><pre> <code class="swift hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComposableTableViewDataSource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> numberOfSections: <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfRows</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">for</span></span></span></span><span class="hljs-function"><span class="hljs-params"> section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> }</code> </pre><br>  And the composite ‚Äúdatasource‚Äù turned out to be a simple class that implements the <code>UITableViewDataSource</code> requirements and is initialized with just one argument ‚Äî a set of concrete instances of the <code>ComposableTableViewDataSource</code> : <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ComposedTableViewDataSource</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSources: [<span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(dataSources: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>...) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.dataSources = dataSources <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>() { <span class="hljs-built_in"><span class="hljs-built_in">fatalError</span></span>(<span class="hljs-string"><span class="hljs-string">"ComposedTableViewDataSource: Initializer with parameters must be used."</span></span>) } }</code> </pre><br>  Now it only remains to write the implementations of all methods of the <code>UITableViewDataSource</code> protocol so that they refer to the methods of the corresponding components. <br><br><h2>  ‚ÄúIt was the right decision.  My decision" </h2><br>  <i>These words belonged to <a href="https://ru.wikipedia.org/wiki/%25D0%2595%25D0%25BB%25D1%258C%25D1%2586%25D0%25B8%25D0%25BD,_%25D0%2591%25D0%25BE%25D1%2580%25D0%25B8%25D1%2581_%25D0%259D%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25BB%25D0%25B0%25D0%25B5%25D0%25B2%25D0%25B8%25D1%2587">Boris Nikolayevich Yeltsin</a> , the first <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B5%25D0%25B7%25D0%25B8%25D0%25B4%25D0%25B5%25D0%25BD%25D1%2582">president of the</a> <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25BE%25D1%2581%25D1%2581%25D0%25B8%25D1%258F">Russian Federation</a> , and do not really relate to the text below, I just liked them.</i> <br><br>  The right decision seemed to me to use the <a href="https://en.wikipedia.org/wiki/Functional_programming">functionality</a> of the <a href="https://swift.org/">Swift</a> language, and it really turned out to be convenient. <br><br>  To begin with, we will implement a method that returns the number of sections - this is easy.  As mentioned above, we only need the full number of all sections of the components: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberOfSections</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Default value if not implemented is "1". return dataSources.reduce(0) { $0 + ($1.numberOfSections?(in: tableView) ?? 1) } }</span></span></code> </pre><br>  (I will not explain the syntax and meaning of standard functions. If this is required, the Internet is full of <a href="https://raywenderlich.com/9222-an-introduction-to-functional-programming-in-swift">good</a> <a href="https://medium.com/%40sdrzn/functional-programming-in-swift-221a8cabb8c">introductory</a> <a href="https://medium.com/%40geisonfgfg/functional-swift-41f1bed646d">articles</a> <a href="https://blog.usejournal.com/functional-programming-in-swift-fe241e114867">on the topic</a> . And I can also advise a <a href="https://www.objc.io/books/functional-swift">pretty good book</a> .) <br><br>  Skimming through all the <code>UITableViewDataSource</code> methods, you notice that they take as arguments only the reference to the table and the value of either the section number or the corresponding <code><a href="https://developer.apple.com/documentation/foundation/indexpath">IndexPath</a></code> string.  We will write several helpers who will be useful to us when implementing all the other protocol methods. <br><br>  First, all tasks can be reduced to a <a href="https://docs.swift.org/swift-book/LanguageGuide/Generics.html">‚Äúgeneric‚Äù</a> function, which takes as its argument a link to the specific <code>ComposableTableViewDataSource</code> and the value of the section number or <code>IndexPath</code> .  For convenience and brevity, we assign <a href="https://docs.swift.org/swift-book/ReferenceManual/Declarations.html">pseudonyms to the</a> types of these functions.  Plus, for additional readability, I propose to declare an alias for the section number: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span> = <span class="hljs-type"><span class="hljs-type">Int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">AdducedSectionTask</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; = (<span class="hljs-number"><span class="hljs-number">_</span></span> composableDataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> sectionNumber: <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typealias</span></span> <span class="hljs-type"><span class="hljs-type">AdducedIndexPathTask</span></span>&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt; = (<span class="hljs-number"><span class="hljs-number">_</span></span> composableDataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, <span class="hljs-number"><span class="hljs-number">_</span></span> indexPath: <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span></code> </pre><br>  (I will explain the chosen names below.) <br><br>  Secondly, we will implement a simple function that, by the <code>ComposedTableViewDataSource</code> section <code>ComposedTableViewDataSource</code> determines the specific <code>ComposableTableViewDataSource</code> and the corresponding section number: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(section: SectionNumber)</span></span></span></span> -&gt; (dataSource: <span class="hljs-type"><span class="hljs-type">ComposableTableViewDataSource</span></span>, decomposedSection: <span class="hljs-type"><span class="hljs-type">SectionNumber</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> section = section <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataSourceIndex = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (index, dataSource) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dataSources.enumerated() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> diff = section - dataSource.numberOfSections dataSourceIndex = index <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> diff &lt; <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { section = diff } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (dataSources[dataSourceIndex], section) }</code> </pre><br>  Perhaps, if you think a little longer than mine, the implementation will be more elegant and less straightforward.  For example, colleagues immediately suggested that I implement a <a href="https://en.wikipedia.org/wiki/Binary_search_algorithm">binary search</a> in this function (previously, for example, during initialization, having compiled the index of the number of sections ‚Äî a simple <a href="https://developer.apple.com/documentation/swift/array">array</a> of <a href="https://developer.apple.com/documentation/swift/int">integers</a> ).  Or even spend a little time on the compilation and memory of storing the table of correspondence of the section numbers - but then instead of constantly using the method with the <a href="https://en.wikipedia.org/wiki/Time_complexity">time complexity</a> O (n) or O (log n) you can get the result with the price O (1).  But I decided to use the advice of the great <a href="https://en.wikipedia.org/wiki/Donald_Knuth">Donald Knuth</a> not to engage in premature optimization without visible need and appropriate measurements.  And not about this article. <br><br>  And finally, the functions that take the <code>AdducedSectionTask</code> and <code>AdducedIndexPathTask</code> indicated above and ‚Äúredirect‚Äù them to specific <code>ComposedTableViewDataSource</code> instances: <br><br><pre> <code class="swift hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adduce</span></span></span><span class="hljs-function">&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> section: SectionNumber, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> task: AdducedSectionTask&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (dataSource, decomposedSection) = decompose(section: section) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task(dataSource, decomposedSection) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">adduce</span></span></span><span class="hljs-function">&lt;T&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> indexPath: IndexPath, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> task: AdducedIndexPathTask&lt;T&gt;)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> (dataSource, decomposedSection) = decompose(section: indexPath.section) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task(dataSource, <span class="hljs-type"><span class="hljs-type">IndexPath</span></span>(row: indexPath.row, section: decomposedSection)) }</code> </pre><br>  And now you can explain the names I chose for all these functions.  It's simple: they reflect a functional naming style.  Those.  little mean literally, but they sound impressive. <br><br>  The last two functions look almost like twins, but, after thinking a little, I quit trying to get rid of code duplication because it brought more inconvenience than advantages: I had to output or transfer the conversion functions to the section number and back to the original type.  In addition, the probability of reusing this generalized approach tends to zero. <br><br>  All these preparations and helpers give an incredible advantage in implementing, in fact, the protocol methods.  Table configuration methods: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, titleForHeaderInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, titleForHeaderInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, titleForFooterInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">String?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, titleForFooterInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(section) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView(tableView, numberOfRowsInSection: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(indexPath) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView(tableView, cellForRowAt: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre><br>  Insert and delete lines: <br><br><pre> <code class="swift hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, commit editingStyle: UITableViewCell.EditingStyle, forRowAt indexPath: IndexPath)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> adduce(indexPath) { $<span class="hljs-number"><span class="hljs-number">0</span></span>.tableView?(tableView, commit: editingStyle, forRowAt: $<span class="hljs-number"><span class="hljs-number">1</span></span>) } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, canEditRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-comment"><span class="hljs-comment">// Default if not implemented is "true". return adduce(indexPath) { $0.tableView?(tableView, canEditRowAt: $1) ?? true } }</span></span></code> </pre><br>  In a similar way, you can implement support for section index headers.  In this case, instead of the section number, it is necessary to operate with a header index.  It is also likely that it will be useful for this to add an additional field to the <code>ComposableTableViewDataSource</code> protocol.  I left this part outside the material. <br><br><h2>  ‚ÄúThe impossible today will be possible tomorrow‚Äù </h2><br>  <i>These are the words of the Russian scientist <a href="https://ru.wikipedia.org/wiki/%25D0%25A6%25D0%25B8%25D0%25BE%25D0%25BB%25D0%25BA%25D0%25BE%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9,_%25D0%259A%25D0%25BE%25D0%25BD%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D1%2582%25D0%25B8%25D0%25BD_%25D0%25AD%25D0%25B4%25D1%2583%25D0%25B0%25D1%2580%25D0%25B4%25D0%25BE%25D0%25B2%25D0%25B8%25D1%2587">Konstantin Eduardovich Tsiolkovsky</a> , the founder of theoretical cosmonautics.</i> <br><br>  First, the solution presented does not support dragging lines.  The original intention included dragging support within one of the components of the ‚Äúdatasource‚Äù objects, but, unfortunately, this cannot be done with just the <code>UITableViewDataSource</code> .  The methods of this protocol determine whether a specific string can be ‚Äúdragged‚Äù and receive a callback when the drag is completed.  And the processing of the event itself is implied inside the <code><a href="https://developer.apple.com/documentation/uikit/uitableviewdelegate">UITableViewDelegate</a></code> methods. <br><br>  Secondly, more importantly, it is necessary to consider the mechanisms for updating the data on the screen.  I think this can be done by declaring the <code>ComposableTableViewDataSource</code> delegate protocol, whose methods will be implemented by <code>ComposedTableViewDataSource</code> and receive a signal that the original ‚Äúdatasource‚Äù has received an update.  Two questions remain open: how inside the <code>ComposedTableViewDataSource</code> reliably determine which <code>ComposableTableViewDataSource</code> has changed and how it is a separate and not the most trivial task, but having a number of solutions (for example, <a href="https://github.com/tonyarnold/Differ">such</a> ).  And, of course, you will need the <code>ComposedTableViewDataSource</code> delegate <code>ComposedTableViewDataSource</code> , whose methods will be called when the composite ‚Äúdatasource‚Äù is updated and implemented by the client type (for example, a <a href="https://en.wikipedia.org/wiki/Model%25E2%2580%2593view%25E2%2580%2593controller">controller</a> or a <a href="https://en.wikipedia.org/wiki/Model%25E2%2580%2593view%25E2%2580%2593viewmodel">view-model</a> ). <br><br>  I hope over time to explore these issues better and cover them in the second part of the article.  In the meantime, lol, you were curious to read about these experiments! <br><br><h2>  PS </h2><br>  Just the other day, I had to get into the code mentioned in the introduction to modify it: it took me to swap the cells of those two types.  In short, I had to suffer and "beat" the <code>Index out of bounds</code> constantly appearing in different places.  When using the described approach, it would only be necessary to swap two ‚Äúdatasource‚Äù objects in the array passed in as an initializer argument. <br><br>  <b>References:</b> <br>  - <a href="https://github.com/lazarevzubov/composed_data_source">Playgroud with full code and example</a> <br>  - <a href="https://twitter.com/lazarevzubov">My Twitter</a> </div><p>Source: <a href="https://habr.com/ru/post/442138/">https://habr.com/ru/post/442138/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442128/index.html">Life on particles</a></li>
<li><a href="../442130/index.html">3CX v16 tests on the Raspberry Pi 3B + and WebMeeting update</a></li>
<li><a href="../442132/index.html">Get started with Azure Machine Learning using the Python SDK</a></li>
<li><a href="../442134/index.html">Calculations in 128 characters: winners of the one-line Wolfram contest</a></li>
<li><a href="../442136/index.html">Half-daily forecast of wind power will help optimize the output power of wind turbines</a></li>
<li><a href="../442140/index.html">How to disable Specter protection: a new parameter was added to the Linux kernel</a></li>
<li><a href="../442142/index.html">Roskomnadzor accidentally blocked the "stub" of providers</a></li>
<li><a href="../442144/index.html">GitLab 11.8 released with JavaScript support in SAST, subgroups in Pages and error tracking</a></li>
<li><a href="../442146/index.html">Energizer Phone: 18,000 mAh Clean Energy</a></li>
<li><a href="../442148/index.html">VS Code - Puppeteer Snippets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>