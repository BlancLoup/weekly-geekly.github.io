<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Network non-cross-platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! In this article, I would like to share my experience with novice developers who are learning to write mobile applications, but have not advance...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Network non-cross-platform</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/pt/blog/146342/"><img src="https://habrastorage.org/getpro/habr/post_images/68f/7b4/e66/68f7b4e665a78cd3326e6d23052dfba1.jpg"></a> <br><br>  Hello!  In this article, I would like to share my experience with novice developers who are learning to write mobile applications, but have not advanced very far in this field.  To be precise, I would like to tell you how to write portable code and design applications that will work both on native .NET platforms (Windows Phone 7 and Windows desktop applications) and on portable .NET versions for mobile platforms, such as Monotouch and Monodroid. <a name="habracut"></a><br><br><h4>  A bit about Mono and Portable Class Library </h4><br>  In order to understand in detail how to write portable code, you first need to understand how .NET works on iOS and Android.  This topic is very large, therefore, as Vladimir Vladimirovich says, I will be brief. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Monotouch </h5><br>  Mono on iOS works like this: no JIT compiler and no .NET on iOS itself.  All code, absolutely all, including the entire implementation of .NET, is compiled into the native bytecode and ‚Äústretches‚Äù with the distribution package of the application. <br><br>  From here follow the following "pluses, minuses and an underwater rake".  Plus - speed (native code, by definition, faster).  Minus number 1: the volume of the distribution package of the application - at least 6 MB.  Minus number 2: unfortunately, only the Silverlight 4 profile is ported, and not completely. <br><br>  The main surprise: no generics and no reflection.  And therefore - no games with collections, custom proxy classes for WCF, data binding a la WPF. <br><br><h5>  Monodroid </h5><br>  On .NET on Android, you need to say the following: at first glance, not everything is so sad: there is a JIT, and generics.  However ... Generics are inferior (parameter classes must inherit from Java.Lang.Object), and JIT is not exactly JIT.  Here, too, it is possible to single out the topic for a separate article, if this topic is interesting to the Habras community. <br><br><h5>  Portable Class Library and Windows Phone 7 </h5><br>  The most extensive use of C # has, of course, the mobile platform from Microsoft.  Especially for it was developed version of Silverlight.  However, the builds that were compiled for Windows Phone will not work on the desktop application.  This is understandable, although very inconvenient: the target platforms are still different. <br><br>  To adequately support code portability between Windows Phone and a fully-fledged .NET, the Portable Class Library (PCL) profile was implemented - a set of base classes that are present on all platforms that support the official version of .NET - Windows, Metro, Windows Phone, Silverlight and Xbox. <br><br><h5>  Nuance </h5><br>  When developing for Mono *, you can directly refer to assemblies that have been compiled for full-fledged versions of .NET to 3.5.  And if your build uses only classes from supported namespaces, everything will work fine.  If you try to access an unimplemented class, you just get a NotImplementedException exception;  such is the white magic of the Monotouch compiler. <br><br>  However, the project for Windows Phone 7 will simply not allow adding a link to such a collection (which is quite logical).  "But what about the Portable Class Library? .." - you ask.  This is where black magic begins: when you try to use assemblies compiled for PCL or WP7 in Mono * projects, you will receive an error message: it is impossible to load an assembly that references WP7 or PCL libraries. <br><br>  It is still not clear to me why it is implemented this way;  All questions about this technical support answers: "Coming soon."  I am glad only that the new version of MonoDevelop (the development environment for Monotouch on Mac) was released not so long ago, in the description of which it was explicitly stated that partial support for PCL is being implemented, but I could not understand where exactly. <br><br><h4>  Implementation </h4><br>  So, having the implementation of the libraries we need on all the platforms we are interested in, we cannot create one assembly for all platforms that would use the necessary classes.  We will have to compile two assemblies - for Windows platforms and for Mono platforms. <br><br>  But here we again face a small problem.  The most convenient class when implementing a client for a web service is WebClient.  But for some mysterious reasons, it was removed from the second edition of PCL, although it is implemented on Windows Phone 7 and in desktop applications.  The developers argue that WebClient is not supported in Metro applications.  Therefore, if you want to develop an application, including for Metro, you will have to use the lower-level classes WebHttpRequest and WebHttpResponse.  For simplicity, I will show an example of the implementation of a proxy class for working with WebClient. <br><br>  What we need: <br><br><ul><li>  Visual Studio 2010 SP 1; </li><li>  Windows Phone SDK for Visual Studio 2010; </li><li>  Monodroid for Visual Studio 2010; </li><li>  MonoDevelop 3.0.2 on Mac; </li><li>  Newtonsoft.Json. </li></ul><br>  Getting Started. <br><br>  1. Install Windows Phone SDK and Monodroid.  We create two projects: the first project is the Windows Phone Library, the second is the Android Class Library.  If you want to develop a universal Windows library, create a Portable Class Library instead of the Windows Phone Class Library.  But in this case, you will have to use the same less convenient HttpWebRequest and HttpWebResponse to work with the web service. <br><br>  2. Further, we will conduct the main work with the Android Class Library.  To ensure compatibility of this assembly with the Monotouch project, it is necessary to ensure that there are no unnecessary references specific to Monodroid in this assembly.  In the project, leave the following links: <br><br><ul><li>  System; </li><li>  System.Net; </li><li>  Newtonsoft.Json (library for JSON deserialization). </li></ul><br>  3. Suppose that we have a spherical REST service in vacuum, which is located at <a href="http://webservice:47154/rest/vendor">http: // webservice: 47154 / rest / vendor</a> and returns us a list of software manufacturers. <br><br><img src="https://habrastorage.org/storage2/99e/d19/88b/99ed1988ba650bf78f46f1f4d47938ea.png"><br><br>  To use this service, just write the following code (create a class into which our web service response will be deserialized, and the proxy class itself, which will request the service). <br><br><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//   public class Vendor { public int Id { get; set; } public string Name { get; set; } public string Description { get; set; } } // -    - public class VendorsProxy { private string _host; public VendorsProxy(string host) { _host = host; } public event VendorsEventHandler GetVendorsCompleted; public void GetVendors() { var client = new WebClient(); client.DownloadStringCompleted += (s, e) =&gt; { var vendors = JsonConvert.DeserializeObject&lt;IEnumerable&lt;Vendor&gt;&gt;(e.Result); if (GetVendorsCompleted != null) GetVendorsCompleted(new VendorsEventArgs(vendors)); }; client.DownloadStringAsync(new Uri(_host + @"rest/vendor")); } } public delegate void VendorsEventHandler(VendorsEventArgs vendors); public class VendorsEventArgs : EventArgs { public IEnumerable&lt;Vendor&gt; Vendors { get; private set; } public VendorsEventArgs(IEnumerable&lt;Vendor&gt; vendors) { Vendors = vendors; } }</span></span></code> </pre> <br>  4. Now in the WP Library project it‚Äôs enough to add not the files themselves, but the links to the files from the Android Class Library project. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b97/709/03d/b9770903d1d72dff3a81658194f0622a.png"><br>  That's all.  Now, if you build a complete solution, the output will be two assemblies that work equally well on both Windows Phone and iOS and Android devices.  You can use your web service on any platform as follows. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> proxy = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> VendorsProxy(<span class="hljs-string"><span class="hljs-string">"http://mywebservice:8080/"</span></span>); proxy.GetVendorsCompleted += (vendors) =&gt; { BindVedorsToVoewModel(vendors.Vendors); }; proxy.GetVendors();</code> </pre><br><h4>  Doubts </h4><br>  Of course, one can argue about the need for such ‚Äúdances with a tambourine‚Äù to achieve such universality: for sure, each platform will have its own specifics and its own best practices.  However, if you are a confident .NET programmer and you need to quickly create a simple mobile application that works with a web service, this solution may be useful. <br><br>  If the Habrasoobshchestvo shows interest in this topic, then in the next article I will talk about how to protect connections in cross-platform applications. <br><br>  <i>Author: Sergey Shulik, senior programmer at Positive Technologies.</i> </div><p>Source: <a href="https://habr.com/ru/post/146342/">https://habr.com/ru/post/146342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146336/index.html">VIM - cruel and merciless</a></li>
<li><a href="../146338/index.html">QML and QtQuick Webinars: QML and C ++ Integration</a></li>
<li><a href="../146339/index.html">Russian Design Cup</a></li>
<li><a href="../146340/index.html">How to solve the problem of 10,000 connections?</a></li>
<li><a href="../146341/index.html">10 steps to top paid 25 overall on the App Store</a></li>
<li><a href="../146344/index.html">Chinese IP Camera</a></li>
<li><a href="../146345/index.html">The Wikimedia Foundation showed the prototype of the visual Wiki editor</a></li>
<li><a href="../146346/index.html">A simple example of encoding a text string according to Huffman</a></li>
<li><a href="../146347/index.html">Growing social media using Reddit</a></li>
<li><a href="../146348/index.html">Google introduced the Coordinate service for managing mobile workers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>