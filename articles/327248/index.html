<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bash scripts, part 6: functions and library development</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bash scripts: start 
 Bash scripts, part 2: loops 
 Bash scripts, part 3: command line options and keys 
 Bash scripts, part 4: input and output 
 Bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bash scripts, part 6: functions and library development</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <a href="https://habrahabr.ru/company/ruvds/blog/325522/">Bash scripts: start</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/325928/">Bash scripts, part 2: loops</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326328/">Bash scripts, part 3: command line options and keys</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326594/">Bash scripts, part 4: input and output</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326826/">Bash Scripts, Part 5: Signals, Background Tasks, Script Management</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327248/">Bash scripts, part 6: functions and library development</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327530/">Bash scripts, part 7: sed and word processing</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327754/">Bash scripts, part 8: awk data processing language</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327896/">Bash scripts, part 9: regular expressions</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328346/">Bash scripts, part 10: practical examples</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328436/">Bash scripts, part 11: expect and automate interactive utilities</a> </blockquote><br>  Being engaged in the development of bash-scripts, you will sooner or later encounter the fact that you periodically have to use the same code fragments.  Constantly typing them manually is boring, and copying and pasting is not our method.  How to be?  It would be nice to find a tool that allows you to write a block of code once and, when you need it again, just refer to it in the script. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/327248/"><img src="https://habrastorage.org/files/803/892/bfe/803892bfe548499aa763df324d40fd01.png"></a> <br><br>  The bash shell provides this capability, allowing you to create functions.  Bash functions are named blocks of code that can be reused in scripts. <br><a name="habracut"></a><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#3AC1EF">Function declaration</font> </h2><br>  You can declare a function like this: <br><br><pre><code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">functionName</span></span> { }</code> </pre> <br>  Or so: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">functionName</span></span>() { }</code> </pre> <br>  The function can be called without arguments and with arguments. <br><br><h2>  <font color="#3AC1EF">Use of functions</font> </h2><br>  Let's write a script containing the function declaration and using it: <br><br><pre> <code class="hljs smalltalk">#!/bin/bash function myfunc { echo <span class="hljs-comment"><span class="hljs-comment">"This is an example of using a function"</span></span> } count=<span class="hljs-number"><span class="hljs-number">1</span></span> while [ <span class="hljs-string"><span class="hljs-string">$c</span></span>ount -le <span class="hljs-number"><span class="hljs-number">3</span></span> ] do myfunc count=<span class="hljs-string"><span class="hljs-string">$(</span></span>( <span class="hljs-string"><span class="hljs-string">$c</span></span>ount + <span class="hljs-number"><span class="hljs-number">1</span></span> )) done echo <span class="hljs-comment"><span class="hljs-comment">"This is the end of the loop"</span></span> myfunc echo <span class="hljs-comment"><span class="hljs-comment">"End of the script"</span></span></code> </pre> <br>  Here is a function called <code>myfunc</code> .  To call a function, it is enough to specify its name. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a69/61e/d02/a6961ed0295a812c7cc767030fe449ca.png"></div><br>  <i><font color="#999999">Function call results</font></i> <br><br>  The function can be called as many times as necessary.  Please note that trying to use the function before its declaration, you will encounter an error.  Let us write a script demonstrating this: <br><br><pre> <code class="hljs smalltalk">#!/bin/bash count=<span class="hljs-number"><span class="hljs-number">1</span></span> while [ <span class="hljs-string"><span class="hljs-string">$c</span></span>ount -le <span class="hljs-number"><span class="hljs-number">3</span></span> ] do myfunc count=<span class="hljs-string"><span class="hljs-string">$(</span></span>( <span class="hljs-string"><span class="hljs-string">$c</span></span>ount + <span class="hljs-number"><span class="hljs-number">1</span></span> )) done echo <span class="hljs-comment"><span class="hljs-comment">"This is the end of the loop"</span></span> function myfunc { echo <span class="hljs-comment"><span class="hljs-comment">"This is an example of using a function"</span></span> } echo <span class="hljs-comment"><span class="hljs-comment">"End of the script"</span></span></code> </pre> <br>  As expected, nothing good happened after its launch. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/81d/eab/837/81deab837f98ff07e863886c31df2e5f.png"></div><br>  <i><font color="#999999">Attempt to use the function before its announcement</font></i> <br><br>  When coming up with names for functions, keep in mind that they must be unique, otherwise problems cannot be avoided.  If you override a previously declared function, the new function will be called instead of the old one without any notifications or error messages.  Let us demonstrate this with an example: <br><br><pre> <code class="hljs pgsql">#!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myfunc { echo "The first function definition" } myfunc <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myfunc { echo "The second function definition" } myfunc echo "End of the script"</code> </pre> <br>  As you can see, the new function quietly wiped out the old one. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7de/8b1/fbb/7de8b1fbbff8a720b9d3ac669dcaccfc.png"></div><br>  <i><font color="#999999">Function override</font></i> <br><br><h2>  <font color="#3AC1EF">Using the return command</font> </h2><br>  The <code>return</code> command allows you to specify the integer completion code returned by the function.  There are two ways to deal with what is the result of a function call.  Here is the first: <br><br><pre> <code class="hljs mel">#!/bin/bash function myfunc { read -p <span class="hljs-string"><span class="hljs-string">"Enter a value: "</span></span> value echo <span class="hljs-string"><span class="hljs-string">"adding value"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $(( $value + <span class="hljs-number"><span class="hljs-number">10</span></span> )) } myfunc echo <span class="hljs-string"><span class="hljs-string">"The new value is $?"</span></span></code> </pre> <br>  The <code>echo</code> team found the sum of the entered number and the number 10. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/afa/a32/9ee/afaa329ee155e253e462c95ec41b5f81.png"></div><br>  <i><font color="#999999">Output of the value returned by the function</font></i> <br><br>  The <code>myfunc</code> adds 10 to the number that is contained in the <code>$value</code> variable, the value of which is set by the user while the script is running.  It then returns the result using the <code>return</code> command.  What the function returned is displayed with the <code>echo</code> command using the <code>$?</code> variable <code>$?</code>  . <br>  If you execute any other command before extracting from the <code>$?</code> variable <code>$?</code>  the value returned by the function, this value will be lost.  The fact is that this variable stores the return code of the last command executed. <br><br>  Note that the maximum number that the return command can <code>return</code> is 255. If the function should return a larger number or string, another approach will be needed. <br><br><h2>  <font color="#3AC1EF">Writing function output to a variable</font> </h2><br>  Another way to return the results of a function is to write the data output by the function to a variable.  This approach allows you to bypass the limitations of the <code>return</code> command and return any data from the function.  Consider an example: <br><br><pre> <code class="hljs smalltalk">#!/bin/bash function myfunc { read -p <span class="hljs-comment"><span class="hljs-comment">"Enter a value: "</span></span> value echo <span class="hljs-string"><span class="hljs-string">$(</span></span>( <span class="hljs-string"><span class="hljs-string">$v</span></span>alue + <span class="hljs-number"><span class="hljs-number">10</span></span> )) } result=<span class="hljs-string"><span class="hljs-string">$(</span></span> myfunc) echo <span class="hljs-comment"><span class="hljs-comment">"The value is $result"</span></span></code> </pre> <br>  That's what happens after calling this script. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/70e/84d/7c9/70e84d7c95b8253fcde9a66ab19eb01b.png"></div><br>  <i><font color="#999999">Writing the results of the function to a variable</font></i> <br><br><h2>  <font color="#3AC1EF">Function arguments</font> </h2><br>  The bash functions can be thought of as small pieces of code that save time and space, eliminating the need to constantly type from the keyboard or copy the same command sets.  However, the possibilities of functions are much wider.  In particular, we are talking about the transfer of arguments to them. <br><br>  Functions can use standard positional parameters, which write what is passed to them when they are called.  For example, the function name is stored in the <code>$0</code> parameter, the first argument passed to it is in <code>$1</code> , the second is in <code>$2</code> , and so on.  The number of arguments passed to the function can be found by accessing the <code>$#</code> variable.  If you are familiar with the <a href="https://habrahabr.ru/company/ruvds/blog/326328/">third part of</a> this cycle of materials, you can not help but notice that all this is very similar to how scripts process the command line parameters passed to them. <br><br>  Arguments pass functions by writing them after her name: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">myfunc</span></span> <span class="hljs-variable"><span class="hljs-variable">$val1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre> <br>  Here is an example in which a function is called with arguments and processes them: <br><br><pre> <code class="hljs mel">#!/bin/bash function addnum { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $# -eq <span class="hljs-number"><span class="hljs-number">0</span></span> ] || [ $# -gt <span class="hljs-number"><span class="hljs-number">2</span></span> ] then echo <span class="hljs-number"><span class="hljs-number">-1</span></span> elif [ $# -eq <span class="hljs-number"><span class="hljs-number">1</span></span> ] then echo $(( $1 + $1 )) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> echo $(( $1 + $2 )) fi } echo -n <span class="hljs-string"><span class="hljs-string">"Adding 10 and 15: "</span></span> value=$(addnum <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>) echo $value echo -n <span class="hljs-string"><span class="hljs-string">"Adding one number: "</span></span> value=$(addnum <span class="hljs-number"><span class="hljs-number">10</span></span>) echo $value echo -n <span class="hljs-string"><span class="hljs-string">"Adding no numbers: "</span></span> value=$(addnum) echo $value echo -n <span class="hljs-string"><span class="hljs-string">"Adding three numbers: "</span></span> value=$(addnum <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>) echo $value</code> </pre> <br>  Run the script. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a44/ee3/acc/a44ee3accb8dc9a2d797de1aae892f64.png"></div><br>  <i><font color="#999999">Function call with arguments</font></i> <br><br>  The <code>addnum</code> function checks the number of arguments passed to it when calling from the script.  If there are none, or more than two, the function returns the value -1.  If the parameter is only one, it adds it to itself and returns the result.  If there are two parameters, the function adds them. <br><br>  Please note that the function cannot directly work with parameters that are passed to the script when it is launched from the command line.  For example, write the following script: <br><br><pre> <code class="hljs pgsql">#!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myfunc { echo $(( <span class="hljs-meta"><span class="hljs-meta">$1</span></span> + <span class="hljs-meta"><span class="hljs-meta">$2</span></span> )) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $# -eq <span class="hljs-number"><span class="hljs-number">2</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=$( myfunc) echo "The result is $value" <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> echo "Usage: myfunc  a b" fi</code> </pre> <br>  When it is launched, or rather, when calling the function declared in it, an error message will be displayed. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/68e/3f3/526/68e3f352698961ee8915fef1c2f623c4.png"></div><br>  <i><font color="#999999">The function cannot directly use the parameters passed to the script.</font></i> <br><br>  Instead, if the function intends to use the parameters passed to the script when called from the command line, you need to pass them to it when you call: <br><br><pre> <code class="hljs pgsql">#!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myfunc { echo $(( <span class="hljs-meta"><span class="hljs-meta">$1</span></span> + <span class="hljs-meta"><span class="hljs-meta">$2</span></span> )) } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $# -eq <span class="hljs-number"><span class="hljs-number">2</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>=$(myfunc <span class="hljs-meta"><span class="hljs-meta">$1</span></span> <span class="hljs-meta"><span class="hljs-meta">$2</span></span>) echo "The result is $value" <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> echo "Usage: myfunc a b" fi</code> </pre> <br>  Now everything works correctly. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6cd/cbd/4eb/6cdcbd4ebc0e4e2531b0a01cfecbb9e3.png"></div><br>  <i><font color="#999999">The transfer function of the parameters with which the script is running</font></i> <br><br><h2>  <font color="#3AC1EF">Work with variables in functions</font> </h2><br>  Variables that we use in scripts are characterized by scope.  These are the code points from which you can work with these variables.  Variables declared inside functions behave differently from those variables that we have already encountered.  They can be hidden from other parts of the scripts. <br><br>  There are two kinds of variables: <br><br><ul><li>  Global variables </li><li>  Local variables. </li></ul><br><h3>  <font color="#3AC1EF">‚ñçGlobal variables</font> </h3><br>  Global variables are variables that are visible from anywhere in the bash script.  If you declare a global variable in the main script code, such a variable can be accessed from a function. <br><br>  Almost the same is true for global variables declared in functions.  You can also access them in the main script code after calling the functions. <br><br>  By default, all variables declared in scripts are global.  So, variables declared outside of functions can easily be accessed from functions: <br><br><pre> <code class="hljs lua">#!/bin/bash <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">myfunc</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-function">=$</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(( $value + 10 )</span></span></span></span>) } <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> -p <span class="hljs-string"><span class="hljs-string">"Enter a value: "</span></span> value myfunc echo <span class="hljs-string"><span class="hljs-string">"The new value is: $value"</span></span></code> </pre> <br>  This is what this script will output. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b81/e9e/2e0/b81e9e2e0af276ca5e8174cf94e4375f.png"></div><br>  <i><font color="#999999">Accessing a global variable from a function</font></i> <br><br>  When a variable is assigned a new value in a function, this new value is not lost when the script accesses it after the function ends.  This is what can be seen in the previous example. <br><br>  What if this behavior does not suit us?  The answer is simple - you need to use local variables. <br><br><h3>  <font color="#3AC1EF">‚ñçLocal variables</font> </h3><br>  Variables that are declared and used inside a function can be declared local.  To do this, use the <code>local</code> keyword in front of the variable name: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">local</span></span> temp=$(( $value + <span class="hljs-number"><span class="hljs-number">5</span></span> ))</code> </pre> <br>  If there is a variable with the same name outside the function, it will not affect it.  The <code>local</code> keyword allows you to separate variables used inside a function from other variables.  Consider an example: <br><br><pre> <code class="hljs kotlin">#!/bin/bash function myfunc { local temp=$[ $value + <span class="hljs-number"><span class="hljs-number">5</span></span> ] echo <span class="hljs-string"><span class="hljs-string">"The Temp from inside function is </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$temp</span></span></span><span class="hljs-string">"</span></span> } temp=<span class="hljs-number"><span class="hljs-number">4</span></span> myfunc echo <span class="hljs-string"><span class="hljs-string">"The temp from outside is </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$temp</span></span></span><span class="hljs-string">"</span></span></code> </pre> <br>  Run the script. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/74b/9a7/b17/74b9a7b17c8b03fd60e1177686229841.png"></div><br>  <i><font color="#999999">Local variable in function</font></i> <br><br>  Here, when we work with the <code>$temp</code> variable inside a function, this does not affect the value assigned to a variable with the same name outside of it. <br><br><h2>  <font color="#3AC1EF">Passing Arrays to Functions as Arguments</font> </h2><br>  Let's try to pass functions to the array as an argument.  I just want to say that this construction will work incorrectly: <br><br><pre> <code class="hljs smalltalk">#!/bin/bash function myfunc { echo <span class="hljs-comment"><span class="hljs-comment">"The parameters are: $@"</span></span> arr=<span class="hljs-string"><span class="hljs-string">$1</span></span> echo <span class="hljs-comment"><span class="hljs-comment">"The received array is ${arr[*]}"</span></span> } myarray=(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) echo <span class="hljs-comment"><span class="hljs-comment">"The original array is: ${myarray[*]}"</span></span> myfunc <span class="hljs-string"><span class="hljs-string">$m</span></span>yarray</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a1f/f18/1b8/a1ff181b8a0570c9d36c7813e8884773.png"></div><br>  <i><font color="#999999">Wrong Approach to Passing Array Functions</font></i> <br><br>  As can be seen from the example, when transferring the function of an array, it will get access only to its first element. <br><br>  In order to solve this problem, it is necessary to extract the data available in it from the array and transfer their functions as independent arguments.  If necessary, inside the function, the arguments it receives can be reassembled into an array: <br><br><pre> <code class="hljs pgsql">#!/bin/bash <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> myfunc { <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> newarray newarray=("$@") echo "The new array value is: ${newarray[*]}" } myarray=(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) echo "The original array is ${myarray[*]}" myfunc ${myarray[*]}</code> </pre> <br>  Run the script. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f42/4e1/d3f/f424e1d3f7d188c4753ec339a76ff360.png"></div><br>  <i><font color="#999999">Build an array inside a function</font></i> <br><br>  As you can see from the example, the function collected an array of the arguments passed to it. <br><br><h2>  <font color="#3AC1EF">Recursive functions</font> </h2><br>  Recursion is when a function calls itself.  The classic example of recursion is the function for calculating factorial.  The factorial of a number is the product of all natural numbers from 1 to that number.  For example, factorial 5 can be found as follows: <br><br><pre> <code class="hljs markdown">5! = 1 <span class="hljs-bullet"><span class="hljs-bullet">* 2 *</span></span> 3 <span class="hljs-bullet"><span class="hljs-bullet">* 4 *</span></span> 5</code> </pre> <br>  If you write the formula for calculating factorial in recursive form, you get the following: <br><br><pre> <code class="hljs erlang-repl">x! = x * (x-<span class="hljs-number"><span class="hljs-number">1</span></span>)!</code> </pre> <br>  This formula can be used to write a recursive function: <br><br><pre> <code class="hljs mel">#!/bin/bash function factorial { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $1 -eq <span class="hljs-number"><span class="hljs-number">1</span></span> ] then echo <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> local temp=$(( $1 - <span class="hljs-number"><span class="hljs-number">1</span></span> )) local result=$(factorial $temp) echo $(( $result * $1 )) fi } read -p <span class="hljs-string"><span class="hljs-string">"Enter value: "</span></span> value result=$(factorial $value) echo <span class="hljs-string"><span class="hljs-string">"The factorial of $value is: $result"</span></span></code> </pre> <br>  Check if this script works correctly. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/941/ac5/d77/941ac5d774ca48512ae25c2802414368.png"></div><br>  <i><font color="#999999">Factorial calculation</font></i> <br><br>  As you can see, everything works as it should. <br><br><h2>  <font color="#3AC1EF">Creating and using libraries</font> </h2><br>  So now you know how to write functions and how to call them in the same script where they are declared.  What if you need to use a function, that block of code that it represents, in another script, without using copy and paste? <br><br>  The bash shell allows you to create so-called libraries - files that contain functions, and then use these libraries in any scripts where they are needed. <br><br>  The key to using libraries is in the <code>source</code> command.  This command is used to connect libraries to scripts.  As a result, the functions declared in the library become available in the script, otherwise the functions from the libraries will not be available in the scope of other scripts. <br><br>  The <code>source</code> command has an alias ‚Äî the dot operator.  In order to connect the file in the script, add the following construction to the script: <br><br><pre> <code class="hljs">. ./myscript</code> </pre> <br>  Suppose we have a file <code>myfuncs</code> that contains the following: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">function</span></span> addnum { <span class="hljs-attribute"><span class="hljs-attribute">echo</span></span> $(( <span class="hljs-variable"><span class="hljs-variable">$1</span></span> + <span class="hljs-variable"><span class="hljs-variable">$2</span></span> )) }</code> </pre> <br>  This is a library.  Let's use it in the script: <br><br><pre> <code class="hljs objectivec"><span class="hljs-meta"><span class="hljs-meta">#!/bin/bash . ./myfuncs result=$(addnum 10 20) echo </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"The result is: $result"</span></span></span></span></code> </pre> <br>  Call it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8da/da9/1fc/8dada91fc5635e589800ca9e4363a460.png"></div><br>  <i><font color="#999999">Use of libraries</font></i> <br><br>  We have just used the library function inside the script.  All this is great, but what if we want to call a function declared in the library from the command line? <br><br><h2>  <font color="#3AC1EF">Calling bash functions from the command line</font> </h2><br>  If you have mastered the <a href="https://habrahabr.ru/company/ruvds/blog/326826/">previous part</a> of this series, you probably already guess that the function from the library can be included in the file.  <code>bashrc</code> using the <code>source</code> command.  As a result, the function can be called directly from the command line. <br><br>  Edit <code>.bashrc</code> , adding the following line to it (the path to the library file on your system, of course, will be different): <br><br><pre> <code class="hljs">. /home/likegeeks/Desktop/myfuncs</code> </pre> <br>  Now the function can be called directly from the command line: <br><br><pre> <code class="hljs ruby">$ addnum <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5ef/592/943/5ef59294384dfd3fe9e1188a2ceda324.png"></div><br>  <i><font color="#999999">Calling a function from the command line</font></i> <br><br>  Even more pleasant is that such a library is available to all child shell processes, that is, it can be used in bash scripts without worrying about connecting this library to them. <br><br>  It is worth noting that in order for the above example to work, you may need to log out and then log in again.  In addition, note that if the name of the function from the library matches the name of a standard command, the function will be called instead.  Therefore, pay attention to the function names. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Functions in bash scripts allow you to decorate blocks of code and call them in scripts.  And the most frequently used functions should be allocated to libraries that can be connected to scripts using the <code>source</code> operator.  If among your functions there are those without which you just can‚Äôt live without - libraries with them can be included in the <code>.bashrc</code> .  This will allow you to conveniently use them on the command line or in other scripts.  The main thing is that the names of your functions do not coincide with the names of the built-in commands. <br><br>  That's all for today.  Next time, let's talk about the <code>sed ‚Äî</code> utility <code>sed ‚Äî</code> powerful string handling tool. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> <br><br>  Dear readers!  Do you use the functions of your own design to solve everyday problems? </div><p>Source: <a href="https://habr.com/ru/post/327248/">https://habr.com/ru/post/327248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327238/index.html">We invite you to the IV conference on the practical application of data science DataScience Lab May 13</a></li>
<li><a href="../327240/index.html">As we from the CRUD-engine service did</a></li>
<li><a href="../327242/index.html">Open machine learning course. Topic 9. Time Series Analysis with Python</a></li>
<li><a href="../327244/index.html">How to make life Redux developer easier?</a></li>
<li><a href="../327246/index.html">Carousel on Vanilla.JS</a></li>
<li><a href="../327250/index.html">Open machine learning course. Theme 10. Gradient boosting</a></li>
<li><a href="../327252/index.html">Go meetup report April 14</a></li>
<li><a href="../327254/index.html">A prototype of a simple service for healthy eating.</a></li>
<li><a href="../327256/index.html">How DDos-attacks are ‚Äúordered‚Äù: life story</a></li>
<li><a href="../327258/index.html">Why do we need chat bots, or the story of Bitrix24</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>