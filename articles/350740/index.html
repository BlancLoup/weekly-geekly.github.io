<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create your cryptocics (Part 1)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first days of December 2017, the Ethereum blockchain project users faced an unpleasant discovery - any of their transactions simply ceased to b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create your cryptocics (Part 1)</h1><div class="post__text post__text-html js-mediator-article">  In the first days of December 2017, the Ethereum blockchain project users faced an unpleasant discovery - any of their transactions simply ceased to be confirmed.  In fact, the entire network has ceased to function due to a memory map that has suddenly expanded in size. <br><br>  Very soon it became clear what the matter was - the <a href="https://www.cryptokitties.co/">CryptoKitties</a> project was to <a href="https://www.cryptokitties.co/">blame</a> .  This is a fun toy that works on the Ethereum blockchain and allows users to breed ‚Äúkittens‚Äù, cross them and sell them as usual currency tokens.  At some point, 15% of all transactions in Ethereum accounted for cryptocause!  And at the time of this writing, the players have already <a href="https://kittysales.herokuapp.com/">spent $</a> 23 million on kittens! <br><br>  So I just could not get past such an interesting topic and decided to tell you how to make this kind of game.  This article (and its continuation) will describe in detail how you can create a similar project to Ethereum, primarily using the code analysis of the original CryptoKitties contract. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/49e/bef/c48/49ebefc48b5bacbeeb6a5c0b2b02a28a.png" alt="cryptocat"><br><a name="habracut"></a><br><h2>  CryptoKitties game source code </h2><br><p>  Almost all the code of the CryptoKitties game is open, so the best way to understand how it works is to read the source code. </p><br><p>  The code has approximately 2000 lines, so in this article we will go over only the most important parts of it.  But if you want to read the source code yourself, here <a href="https://ethfiddle.com/09YbyJRfiI">is a copy of it</a> , and immediately in the online IDE EthFiddle. </p><br><h2>  general review </h2><br><p>  If you hear about CryptoKitties for the first time, then know that players sell, buy and breed digital seals in it.  Each cat is unique, its appearance is determined by genes.  When you cross two cats, their genes unite in a unique way and you get a very special kitten, which you can sell or continue to cross with other cats. </p><br><p>  The CryptoKitties code is divided into a series of small interconnected contracts, so there is no need to store one huge file with all the information. </p><br><p>  <a href="http://solidity.readthedocs.io/en/develop/contracts.html">Solidity allows you to inherit contracts</a> , this is how the chain of inheritance looks in the case of kittens: </p><br><pre><code class="javascript hljs">contract KittyAccessControl contract KittyBase is KittyAccessControl contract KittyOwnership is KittyBase, ERC721 contract KittyBreeding is KittyOwnership contract KittyAuction is KittyBreeding contract KittyMinting is KittyAuction contract KittyCore is KittyMinting</code> </pre> <br><br><p>  So, in essence, the <code>KittyCore</code> contract will be published at the address to which the application refers, and it stores all the information and methods of previous contracts.  Run through all the contracts. </p><br><h2>  1. KittyAccessControl: who controls the contract? </h2><br><blockquote><p>  <em>This contract manages various addresses and restrictions that can only be exercised by certain users, let's call them CEO, CFO and COO.</em> </p><br></blockquote><br><p>  This contract is needed for management and does not apply to the mechanics of the game.  In essence, he attributes the methods to the users of ‚ÄúCEO‚Äù, ‚ÄúCOO‚Äù and ‚ÄúCFO‚Äù - addresses on the Ethereum platform, who own and control specific functions of the contract. </p><br><p>  KittyAccessControl defines <a href="http://solidity.readthedocs.io/en/develop/contracts.html">function modifiers</a> , for example, <code>onlyCEO</code> (limits the function so that only the CEO user can perform it), and also adds methods for actions such as pause / resume a game or withdraw money: </p><br><pre> <code class="javascript hljs">modifier onlyCLevel() { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>( msg.sender == cooAddress || msg.sender == ceoAddress || msg.sender == cfoAddress ); _; } <span class="hljs-comment"><span class="hljs-comment">//...some other stuff // Only the CEO, COO, and CFO can execute this function: function pause() external onlyCLevel whenNotPaused { paused = true; }</span></span></code> </pre> <br><p>  The <code>pause()</code> function was most likely added so that developers could gain time for themselves if there are any bugs in the contract ... But <a href="https://medium.com/loom-network/your-crypto-kitty-isnt-forever-why-dapps-aren-t-as-decentralized-as-you-think-871d6acfea">Luke says</a> that she can also allow developers to completely freeze the contract and no one will either transfer, sell, or breed kittens!  Not that the developers wanted to do this - but this is interesting, especially given the fact that many people think that the DApp is completely decentralized, because it is on Ethereum. </p><br><h2>  2. KittyBase: what kind of cat is this? </h2><br><blockquote><p>  It is in this contract that we determine the most important code that is responsible for the main functionality, including the main data store, constants, data types and internal functions for managing them. </p><br></blockquote><br><p>  <strong>KittyBase</strong> defines many application master data.  First, this contract sets the cat as a <a href="http://solidity.readthedocs.io/en/develop/types.html%3Fhighlight%3Dstruct">structure</a> : </p><br><pre> <code class="javascript hljs">struct Kitty { uint256 genes; uint64 birthTime; uint64 cooldownEndBlock; uint32 matronId; uint32 sireId; uint32 siringWithId; uint16 cooldownIndex; uint16 generation; }</code> </pre> <p>  So the cat is all just a bunch of integers :) Let's look at each element: </p><br><ul><li>  <code>genes</code> is a 256-bit integer representing the kit‚Äôs genetic code.  This is a key piece of information that determines the appearance of a cat. </li><li>  <code>birthTime</code> - block timestamp, the moment at which it is born <br>  cat </li><li>  <code>cooldownEndBlock</code> - the minimum time period after which the cat can again multiply. </li><li>  <code>matronId</code> &amp; <code>sireId</code> - mum and dad seal accounts <br>  respectively. </li><li>  <code>siringWithId</code> - this indicator with reference to a pregnant mother <br>  added to dad's account.  Otherwise, the indicator is zero. </li><li>  <code>cooldownIndex</code> - the current duration of the rest of the cat (after what time after crossing the cat will be able to multiply again). </li><li>  <code>generation</code> is the ‚Äúgeneration number‚Äù of a cat.  The first seals in the game <br>  belong to the zero generation, and each subsequent generation of cats has a number, 1 superior generation of their parents. </li></ul><br><p>  Please note that the game CryptoKitties seals asexual, and you can cross any two seals. </p><br><p>  Then the <strong>KittyBase</strong> contract defines arrays of our feline structures: </p><br><pre> <code class="javascript hljs">Kitty[] kitties;</code> </pre> <br><p>  This array contains the data of all existing cats, so this is a kind of common database. </p><br><p>  When you create a new seal, it is added to the array, and its index in the array becomes the seal account.  In the example below, the Genesis-1 seal account. <br><img src="https://habrastorage.org/getpro/habr/post_images/62f/3bd/c58/62f3bdc585ee41cc94d6ba16fe8ba0b4.png" alt="The index in the array for this cat is ‚Äú1‚Äù!"><br>  <em>The index in the array for this cat is ‚Äú1‚Äù!</em> </p><br><p>  Also in this contract there is a dictionary (in Solidity this is called mapping, but I think we understand each other), linking the seal accounts and the addresses of their owners, so that you can keep track of who owns a particular seal: </p><br><pre> <code class="javascript hljs">mapping (<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint256</span></span></span><span class="hljs-function"> =&gt;</span></span> address) public kittyIndexToOwner;</code> </pre> <br><p>  The contract also contains other dictionaries, I recommend you to run through them with your own eyes, there is nothing complicated there. </p><br><p>  When the owner sends the cat to another person, the <code>kittyIndexToOwner</code> dictionary <code>kittyIndexToOwner</code> updated and begins to link the cat with the new owner: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// @dev Assigns ownership of a specific Kitty to an address. function _transfer(address _from, address _to, uint256 _tokenId) internal { // Since the number of kittens is capped to 2^32 we can't overflow this ownershipTokenCount[_to]++; // transfer ownership kittyIndexToOwner[_tokenId] = _to; // When creating new kittens _from is 0x0, but we can't account that address. if (_from != address(0)) { ownershipTokenCount[_from]--; // once the kitten is transferred also clear sire allowances delete sireAllowedToAddress[_tokenId]; // clear any previously approved ownership exchange delete kittyIndexToApproved[_tokenId]; } // Emit the transfer event. Transfer(_from, _to, _tokenId);</span></span></code> </pre><br><p>  <em>The transfer of the seal establishes the connection</em> <code>kittyIndexToOwner</code> <em>seal account and the address of the new owner</em> <code>_to</code> . </p><br><p>  Now let's see what happens when we create a new cat: </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_createKitty</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> uint256 _matronId, uint256 _sireId, uint256 _generation, uint256 _genes, address _owner </span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">uint</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// These requires are not strictly necessary, our calling code should make // sure that these conditions are never broken. However! _createKitty() is already // an expensive call (for storage), and it doesn't hurt to be especially careful // to ensure our data structures are always valid. require(_matronId == uint256(uint32(_matronId))); require(_sireId == uint256(uint32(_sireId))); require(_generation == uint256(uint16(_generation))); // New kitty starts with the same cooldown as parent gen/2 uint16 cooldownIndex = uint16(_generation / 2); if (cooldownIndex &gt; 13) { cooldownIndex = 13; } Kitty memory _kitty = Kitty({ genes: _genes, birthTime: uint64(now), cooldownEndBlock: 0, matronId: uint32(_matronId), sireId: uint32(_sireId), siringWithId: 0, cooldownIndex: cooldownIndex, generation: uint16(_generation) }); uint256 newKittenId = kitties.push(_kitty) - 1; // It's probably never going to happen, 4 billion cats is A LOT, but // let's just be 100% sure we never let this happen. require(newKittenId == uint256(uint32(newKittenId))); // emit the birth event Birth( _owner, newKittenId, uint256(_kitty.matronId), uint256(_kitty.sireId), _kitty.genes ); // This will assign ownership, and also emit the Transfer event as // per ERC721 draft _transfer(0, _owner, newKittenId); return newKittenId; }</span></span></code> </pre><br><p>  This feature ‚Äúaccepts‚Äù <strong>mother</strong> and <strong>father</strong> accounts, cat <strong>generation</strong> , <strong>256-bit genetic code</strong> and <strong>owner address</strong> .  She then creates <code>Kitty</code> , sends it to the main cat array and calls the <code>_transfer()</code> command to bind the cat to the new owner. </p><br><p>  Cool - now we can see how CryptoKitties identifies cats in the form of a data type, how it stores them in the blockchain and how it keeps track of who owns this or that cat. </p><br><h2>  3. KittyOwnership: seals as tokens </h2><br><blockquote><p>  This contract contains the methods necessary for basic non-interchangeable operations with tokens in accordance with the ERC-721 standard. </p><br></blockquote><br><p>  CryptoKitties is compliant <a href="https://github.com/ethereum/EIPs/issues/721">with the ERC721 token standard</a> .  This is a non-interchangeable token that has proven itself to track ownership of digital collections, such as digital playing cards or rare items in role-playing games. </p><br><p>  <em><strong>Note about interchangeability</strong> : Ethereal cryptocurrency is <strong>interchangeable</strong> , because any five ethereums are equal to the other five ethereums.</em>  <em>But if we are talking about CryptoKitties tokens, one cat is not equal to the other, so they are <strong>not interchangeable</strong> .</em> </p><br><p>  From the definition of this contract, we can see that the <code>KittyOwnership</code> inherits the <code>ERC721</code> contract: </p><br><pre> <code class="javascript hljs">contract KittyOwnership is KittyBase, ERC721</code> </pre> <br><p>  All ERC721 tokens conform to the same standard, so as a result of inheritance, the KittyOwnership contract is responsible for the following functions: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/// @title Interface for contracts conforming to ERC-721: Non-Fungible Tokens /// @author Dieter Shirley &lt;dete@axiomzen.co&gt; (https://github.com/dete) contract ERC721 { // Required methods function totalSupply() public view returns (uint256 total); function balanceOf(address _owner) public view returns (uint256 balance); function ownerOf(uint256 _tokenId) external view returns (address owner); function approve(address \_to, uint256 \_tokenId) external; function transfer(address \_to, uint256 \_tokenId) external; function transferFrom(address \_from, address \_to, uint256 _tokenId) external; // Events event Transfer(address from, address to, uint256 tokenId); event Approval(address owner, address approved, uint256 tokenId); // Optional // function name() public view returns (string name); // function symbol() public view returns (string symbol); // function tokensOfOwner(address _owner) external view returns (uint256\[\] tokenIds); // function tokenMetadata(uint256 \_tokenId, string \_preferredTransport) public view returns (string infoUrl); // ERC-165 Compatibility (https://github.com/ethereum/EIPs/issues/165) function supportsInterface(bytes4 _interfaceID) external view returns (bool); }</span></span></code> </pre> <br><p>  Since all of these methods are open, there is a standard way for users to interact with CryptoKitties tokens ‚Äî and they can also interact with any other ERC721 token.  You can transfer tokens to another user, directly interacting with the CryptoKitties contract on the Ethereum platform without having to use their web interface, so in this sense you are really the owner of your cats.  (Unless the CEO stops the contract). </p><br><p>  If you are interested in writing your game on Ethereum, you can practice on <a href="https://cryptozombies.io/">CryptoZombies</a> : an interactive Solidity programming programming school, <a href="https://cryptozombies.io/">Russian localization is present</a> . </p><br><hr><br>  Many thanks to <a href="https://facebook.com/profile.php%3Fid%3D100010968962682">Sasha Ivanova</a> for help in the translation! <br><p>  To be continued. </p></div><p>Source: <a href="https://habr.com/ru/post/350740/">https://habr.com/ru/post/350740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350728/index.html">How to recover lost text</a></li>
<li><a href="../350730/index.html">Creating a network with Internet access in GNS3 on Windows 10</a></li>
<li><a href="../350732/index.html">Solve problems without self-balancing trees in Python</a></li>
<li><a href="../350734/index.html">As I wrote my VNC, and then no</a></li>
<li><a href="../350738/index.html">802.11ax - details (webinar, english)</a></li>
<li><a href="../350742/index.html">Optimization of the code in the mind, or "Well, just as definitely faster"</a></li>
<li><a href="../350744/index.html">SSO and Kibana: Kibana integration with integrated Windows authentication (Single Sign-On)</a></li>
<li><a href="../350746/index.html">Swift vs. Kotlin. Differences are important</a></li>
<li><a href="../350748/index.html">How not to become a Python-developer</a></li>
<li><a href="../350750/index.html">How to write a one-page application (SPA) using Vue.js</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>