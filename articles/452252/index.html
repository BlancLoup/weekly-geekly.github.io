<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Security with a taste of Google</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Google I / O 2019 died down and it's time  rewrite projects to new architecture  learn new items. Since I am interested in the security of mobile appl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Security with a taste of Google</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/ap/ef/vq/apefvqv6y3kscabrrbsz3zpnn-k.png"><br><p><br>  Google I / O 2019 died down and it's time <del>  rewrite projects to new architecture </del>  learn new items.  Since I am interested in the security of mobile applications, first of all I paid attention to the new library in the JetPack family - <strong>security-crypto</strong> .  The library helps to organize data encryption correctly while protecting developers from all the nuances that accompany this process. </p><a name="habracut"></a><br><h2 id="istoricheskaya-spravka">  History reference </h2><br><p>  Data encryption in Android has always spawned a lot of discussion.  Which algorithm to choose?  What encryption mode to use?  What is padding?  Where to store the keys?  For an ordinary developer, learning all this and keeping knowledge up to date can be difficult.  Therefore, the story most often ended in one of three scenarios: </p><br><ul><li>  copy-paste of the first stackoverflow solution </li><li>  search for a "suitable manual" followed by implementation and collecting a rake </li><li>  activation of the protocol "And so it will come down!" </li></ul><br><p>  As the community of Android developers developed, libraries began to emerge to help solve this problem.  The quality of these solutions was very different: of all this variety, I can only select <a href="https://github.com/tozny/java-aes-crypto">java-aes-crypto</a> , which we used in Redmadrobot.  Pretty high-quality implementation, but there were a couple of problems with it. </p><br><p>  First, it was just string encryption.  This in itself is not bad, but after all these lines need to be stored somewhere, in a DB or SharedPreferences.  So, you need to write a wrapper over the data source, so that everything is encrypted on the fly (which we once did).  But this is the code that needs to be maintained, dragged from project to project, or processed into a library for ease of use.  In the end, this was also done, but it did not bring peace to inquiring minds. </p><br><p>  Secondly, this solution offered nothing to solve the problem of key management.  They could be generated, but the storage fell entirely on the shoulders of the developer.  With all the squats around AndroidKeystore on different versions of the OS and devices that came from China Mainland. </p><br><h2 id="etomu-gorodu-nuzhen-novyy-geroy">  This city needs a new hero </h2><br><p>  Everything went on as usual, until in the summer of 2018 I discovered that there is such a wonderful library from Google as <a href="https://github.com/google/tink">Tink</a> .  It is quite simple to learn and protects the developer from the huge number of nuances related to cryptography.  Using this library is almost impossible to do something wrong.  Moreover, Tink completely assumes key management and abstracts all operations from the developer from AndroidKeystore. </p><br><p>  But it was still just string encryption.  And then <a href="https://github.com/yandextaxitech/binaryprefs">Binary Preferences</a> turned up very well - a library from a domestic producer, which I have long wanted to look at.  It allows you to encrypt all the stored data of any algorithms - for this it was enough to write the implementation of two interfaces, <a href="">KeyEncryption</a> and <a href="">ValueEncryption</a> (for keys and values, respectively). </p><br><p>  As a result, we began to use these two libraries in a bundle and were happy that our code became cleaner and easier to understand. </p><br><h2 id="security-crypto">  security-crypto </h2><br><p><img src="https://habrastorage.org/webt/ee/hh/kn/eehhknztxkcmryvtrryidbblwla.png"></p><br><p>  Now, Google has once again decided to meet the developers and simplify their lives in the area of ‚Äã‚Äãencryption of stored data.  Another JetPack library was announced to help with this.  It became interesting to me that they wrote such a revolutionary there, and I found it useful to search for documentation (spoiler: there is none).  I found only <a href="https://devmir.teamusec.de/reference/kotlin/androidx/security/crypto/package-summary">javadocs</a> for the classes in the library, but thanks for that.  It turned out that there are few opportunities: file encryption, SharedPreferences, and working with keys. </p><br><p>  To test the library, I wrote a couple of snippets: </p><br><div class="spoiler">  <b class="spoiler_title">File Encryption</b> <div class="spoiler_text"><pre><code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> file = File(filesDir, <span class="hljs-string"><span class="hljs-string">"super_secure_file"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedFile = EncryptedFile.Builder(file, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"my_secret_key"</span></span>, EncryptedFile.FileEncryptionScheme.AES256_GCM_HKDF_4KB) .setKeysetAlias(<span class="hljs-string"><span class="hljs-string">"my_test_keyset_alias"</span></span>) .setKeysetPrefName(<span class="hljs-string"><span class="hljs-string">"keyset_pref_file"</span></span>) .build() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> outputStream = encryptedFile.openFileOutput() outputStream.use { it.write(<span class="hljs-string"><span class="hljs-string">"secret info"</span></span>.toByteArray()) }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">Encryption SharedPreferences</b> <div class="spoiler_text"><pre> <code class="kotlin hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> encryptedPreferences = EncryptedSharedPreferences.create( <span class="hljs-string"><span class="hljs-string">"super_secret_preferences"</span></span>, <span class="hljs-string"><span class="hljs-string">"prefrences_master_key"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, EncryptedSharedPreferences.PrefKeyEncryptionScheme.AES256_SIV, EncryptedSharedPreferences.PrefValueEncryptionScheme.AES256_GCM ) encryptedPreferences.edit().putString(<span class="hljs-string"><span class="hljs-string">"secret"</span></span>, <span class="hljs-string"><span class="hljs-string">"super secret token"</span></span>)</code> </pre> </div></div><br><p>  To my great surprise, everything worked the first time, and I climbed to look at what code they wrote for this library.  Having fallen into the sources, I saw that this is actually a wrapper around the already known Tink library, and the written code is almost one-on-one as we wrote for encrypted BinaryPreferences. </p><br><p>  I was very glad that Google didn‚Äôt reinvent the bike this time, but used his well-proven ideas.  Let's hope that the <code>security</code> package that came to JetPack will not be limited to this library, but will develop further. </p><br><p>  <a href="https://github.com/Fi5t/advanced-tink">Demonstration of the work of the BinaryPreferences + Tink bundle</a> <br>  <a href="https://github.com/aosp-mirror/platform_frameworks_support/tree/androidx-master-dev/security/crypto">Source code of the security-crypto library</a> <br>  <a href="https://github.com/Fi5t/jetpack-security">Demonstration of security-crypto</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/452252/">https://habr.com/ru/post/452252/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../452234/index.html">Thermometer & Hygrometer on ATMEGA 328P-MU - Raising the level of arduino developments</a></li>
<li><a href="../452236/index.html">Harmony of scripts inside the Android application</a></li>
<li><a href="../45224/index.html">In Ukraine, the most popular browser is Opera 9.x</a></li>
<li><a href="../452248/index.html">We pump over development on Vue by means of patterns: HOC</a></li>
<li><a href="../45225/index.html">Sorry, but Gmail themes with Opera don't work for me?</a></li>
<li><a href="../452258/index.html">Corda - open source blockchain for business</a></li>
<li><a href="../452262/index.html">Angular: library creation and publishing</a></li>
<li><a href="../452264/index.html">How we made the site for the Mascots auto award</a></li>
<li><a href="../452266/index.html">Serverless racks</a></li>
<li><a href="../452272/index.html">Girl under the waterfall</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>