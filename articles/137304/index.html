<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Batniki against exploits</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear% USERNAME%. My name is Sergey Golovanov, and I still am the leading virus analyst at Kaspersky Lab. I understand that the name of this ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Batniki against exploits</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear% USERNAME%.  My name is Sergey Golovanov, and I still am the leading virus analyst at Kaspersky Lab.  I understand that the name of this post in the company's corporate blog can cause laughter, sadness, and some even have an epileptic seizure, but let me explain everything. <br><br>  I understand that for all batch files look like something very simple and since AUTOEXEC.BAT is almost forgotten, at the same time, exploits, if you are certainly not a professional vulnerability researcher, look very difficult and almost implausible, especially for some developers.  But!  In this post I will try to turn these ideas around and tell you that everything seems to be the opposite.  The batniki are a little lighter and stronger in terms of <a href="http://en.wikipedia.org/wiki/Brainfuck">brainfuck‚Äôs</a> functionality, and the exploits are no worse than sorting by the bubble on basic. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/49c/174/f76/49c174f76233477c45e382e6cffd570c.jpg" alt="image"></div><br>  <i>(Caution! 3 MB of illustrated stream of consciousness and a bunch of scripts)</i> <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How did I get to this? </h4><br>  I came across a box with Windows 7 x64 with minimal system requirements of 2 GB of RAM!  And here I thought, really, in all these gigabytes there is no pair of kilobytes of code that could protect users from such misfortunes as exploits and <a href="http://en.wikipedia.org/wiki/Drive-by_download">Drive-by</a> ?  This scourge of all OS from MS is already five years old!  Should there be means for at least some protection?  But how to use them, and even standard means?  With the help of batch file.  But as?  To understand this, you need to read this sheet to the end.  eight) <br><br><h4>  Theory </h4><br>  In the simplified theory of the exploitation of exploits, everything looks like this: ‚Äúsomething looked somewhere, something was sent somewhere, something started somewhere‚Äù.  In real life, it often looks like this: when a user is browsing the Internet, he ends up on an honestly hacked site, where he is given, along with useful information, either JavaScript or a redirect to JavaScript, which, by analyzing USER-AGENT, information about plugins, etc.  gives the user an exploit that will work for the user.  After that, the Trojan is downloaded to the user's machine, it starts up, is registered in the system, and starts doing its dirty work. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c5/32d/e6b/4c532de6b9eeff5179789315bb4f1473.png" alt="image"></div><br>  <b>Google's Anti-Malware Team's Drive-By Picture for Visuals,</b> <b><br></b>  <b>reading in the language of the likely opponent</b> <br><br>  <i>(-SH. Yulia, please correct the following sentence within the meaning of it so that it is understandable and delete this comment. Editor. By the meaning of ??? Yes, I already don‚Äôt understand anything after ‚Äúallocating my memory‚Äù. comment.)</i> <br><br>  If you dig a little deeper, it turns out that in such exploit packs often (almost always) the payload allocates itself memory in the victim process, searches for the necessary system functions, saves the file from the Internet to the locale and does CreateProcess or very rarely - ShellExecute, while privilege elevation problems are shifted to what is downloaded.  Everything is in principle simple and clear.  And what to do with it?  Grab <s>the fifth point</s> for weak points!  There is one weak spot in this whole scheme: it does not matter which application was pierced, the main thing is to launch the file with the Trojan.  Thus, it turns out that we simply need to ensure that the extra files on the user's computer do not run, and this must be done by standard means. <br><br><h4>  Standard tools </h4><br>  In Windows 7, there are several ways to limit or extend the work of programs.  Perhaps the most popular means are the <a href="http://en.wikipedia.org/wiki/Access_control_list">ACL</a> and all sorts of politicians. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/89c/a1a/3f6/89ca1a3f6402bb42c8fcb247be87b99e.gif" alt="image"></div><br>  <b>Visual SRP (Software Restriction Policies) from Microsoft</b> <br><br>  In principle, it is not a secret to anyone that you can create a special user account, assign special rights to it in the system and drive potentially vulnerable applications under it.  Five minutes of taxiing with the mouse - and everything is ready.  The problem is that a rare user will do this, especially if admins need to do this on all machines on the network.  Therefore, let's try to make a batch file, in which we will do approximately the same, only better, and even so that it would be convenient to use. <br><br><h4>  Batnik </h4><br>  Total: our batch file must create a user with standard rights, then modify these rights to run only certain software and, finally, make it transparent and convenient for the user.  Let's start with ... <br><br><h5>  1. Create a user.  Freebie. </h5><br> <code>net user saferun_user Passw0rd /add</code> <br> <br>  The username and password here are for example only, they will have to be diluted with% random% 's so that it does not turn out that all of the batch file users have the same usernames and passwords on the machines.  And then it turns out a sort of Backdoor.Bat.Hren.a, it still has to be detected ...))) <br><br><h5>  2. Modify rights.  Uh ... and here there are already problems </h5><br>  In an amicable way, <a href="http://technet.microsoft.com/en-us/library/dd548340%2528WS.10%2529.aspx">AppLocker</a> needs to assign permissions to execute using PowerShell, for example: <br><br> <code>PS C:\&gt; Get-ApplockerFileInformation -Directory 'C:\Program Files (x86)\Adobe\' -Recurse -FileType Exe | New-ApplockerPolicy -RuleType Publisher -User SafeRun_user -RuleNamePrefix Adobe -Optimize -Xml &gt; Adoby.xml <br> PS C:\&gt; Set-AppLockerPolicy ‚ÄìXmlPolicy Adoby.xml</code> <br> <br>  However, all this cunning crap "is only available in the Ultimate and Enterprise versions of Windows 7."  Therefore, as an alternative to the Home version of Windows 7, you can use Parental Control ( <a href="http://ssj100.fullsubject.com/t306-parental-controls-as-an-srp-for-windows-7-home-users">link to the forum</a> - I'm not joking), which stores information about which programs you can run in: <br><br> <code>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Parental Controls\Users\UID\App Restrictions</code> <br> <br>  This means that politicians are in the firebox, for it is inconvenient, we will use ACLs, especially since, starting with Vista, a wonderful ICACLS team has appeared.  In principle, everything that is written further can be projected on XP using XCACLS, but by default there is no such command in XP, and it is included only in the Resource Kit. <br><br>  In total, in Windows 7, first we will remove the user from the default group in order to limit its ability thanks to group permissions to create files anywhere: <br><br> <code>net localgroup users saferun_user /delete</code> <br> <br>  And now let's say that, dear user, <s>you are a loser</s> , you are not allowed to run files from a profile, the only place where you are allowed to create files. <br><br> <code>icacls %USERPROFILE% /deny saferun_user:(OI)(IO)(WDAC,WO,X)</code> <br> <br>  <i>(-Editor. You would still be here to ask me to check something and correct it. Comments, do not forget to kill.)</i> <br><br>  The parameters ‚Äú(OI) (IO)‚Äù seem to tell us that all the files in the specified folder inherit the rights of the parent, which, in fact, Deny Execute.  We check that the rights set out work: <br><br> <code>C:\Users\Golovanov&gt;runas /user: saferun_user cmd.exe <br> Enter the password for saferun_user: <br> Attempting to start cmd.exe as user ‚Äúsaferun_user" ... <br> C:\Windows\system32&gt; cd %temp% <br> C:\Users\saferun_user\AppData\Local\Temp&gt;%windir%notepad.exe <br> C:\Users\saferun_user\AppData\Local\Temp&gt;copy c:\windows\notepad.exe . <br> 1 file(s) copied. <br> C:\Users\saferun_user\AppData\Local\Temp&gt;.\notepad.exe <br> Access is denied.</code> <br> <br>  Total: Notepad.exe from the Windows folder works, and if you copy it to the TEMP folder and run it, ACCESS IS DENIED.  All OK.  Go ahead. <br><br><h5>  3. Usability </h5><br>  For usability, we need to provide transparent launch support for the maximum number of different browsers under the new user.  I propose to do this as follows: <br><br>  1. Copy the current user's browser profile to the new user.  For example, for Firefox like this: <br><br> <code>xcopy /E /I /C /Y /Q /H /R %APPDATA%\Mozilla\* C:\Users\saferun_user\AppData\Roaming\Mozilla\</code> <br> <br>  2. Create a file in the folder with the VBS browser in which to register the launch of the Runas browser.  You need to do this through VBS to bypass the restriction on receiving a password in STDIN for Runas.  Perfect Microsoft did it to <a href="http://blogs.msdn.com/b/oldnewthing/archive/2004/11/29/271551.aspx">increase the security of its OS</a> .  As usual, security remained in question, and hemorrhoids increased.  The VBS file will look like this, for example: <br><br> <code>Option explicit <br> Dim oShell <br> set oShell= Wscript.CreateObject("WScript.Shell") <br> oShell.Run "RunAs /noprofile /user:saferun_user Firefox.exe" <br> WScript.Sleep 1000 <br> oShell.Sendkeys "Passw0rd" <br> oShell.Sendkeys "{ENTER}" <br> Wscript.Quit</code> <br> <br>  Little comment.  On the Internet, they write that Sendkeys is missing or forbidden in some versions, but on Windows 7 Professional, Ultimate and Home everything works.  We continue. <br><br>  3. Create a shortcut to the newly created VBS file with a browser icon. <br><br> <code>Set oWS = WScript.CreateObject("WScript.Shell") <br> sLinkFile = "C:\firefox_saferun.LNK" <br> Set oLink = oWS.CreateShortcut(sLinkFile) <br> oLink.TargetPath = "C:\Program Files (x86)\Mozilla Firefox\firefox.vbs" <br> oLink.IconLocation = "C:\Program Files (x86)\Mozilla Firefox\firefox.exe,0" <br> oLink.WorkingDirectory = "C:\Program Files (x86)\Mozilla Firefox\" <br> oLink.Save</code> <br>  4. Replace the new label with all the existing user labels on browsers.  Joke.  We put the shortcuts in a separate folder on the desktop, and then let the user decide for himself. <br><br><h4>  Batch file listing </h4><br>  Total like everything is OK, it remains all to comb and test. <br><br><pre> <code class="cpp hljs">::Writed by: Sergey.Golovanov at kaspersky.com <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> habrahabr.ru @echo on @Echo This batch file will create a <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> browsers with no rights to run downloaded from Internet files. Pause ::Setup <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> user:: <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> safeusername=saferun_user_%random% <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> safepassword=%random%Ai%random% echo Login: %safeusername% echo Password: %safepassword% net user %safeusername% /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> del Browserlist4saferun.txt net user %safeusername% %safepassword% /add ::init <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> user profile:: echo Option <span class="hljs-keyword"><span class="hljs-keyword">explicit</span></span> &gt; init_new_user_profile.vbs echo Dim oShell &gt;&gt; init_new_user_profile.vbs echo <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> oShell= Wscript.CreateObject(<span class="hljs-string"><span class="hljs-string">"WScript.Shell"</span></span>) &gt;&gt; init_new_user_profile.vbs echo oShell.Run <span class="hljs-string"><span class="hljs-string">"RunAs /profile /user:%safeusername% ping"</span></span> &gt;&gt; init_new_user_profile.vbs echo WScript.Sleep <span class="hljs-number"><span class="hljs-number">1000</span></span> &gt;&gt; init_new_user_profile.vbs echo oShell.Sendkeys <span class="hljs-string"><span class="hljs-string">"%safepassword%"</span></span> &gt;&gt; init_new_user_profile.vbs echo oShell.Sendkeys <span class="hljs-string"><span class="hljs-string">"{ENTER}"</span></span> &gt;&gt; init_new_user_profile.vbs echo Wscript.Quit &gt;&gt; init_new_user_profile.vbs call cscript init_new_user_profile.vbs ping -n <span class="hljs-number"><span class="hljs-number">10</span></span> localhost &gt;&gt; nul del init_new_user_profile.vbs ::Setup privileges <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> user:: net localgroup users %safeusername% /<span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> icacls c:\users\%safeusername%\ /deny %safeusername%:(OI)(IO)(WDAC,WO,X) ::Setup browsers:: :FindOpera <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist %APPDATA%\Opera\ xcopy /E /I /C /Y /Q /H /R %APPDATA%\Opera\* C:\Users\%safeusername%\AppData\Roaming\Opera\ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%Programfiles%\Opera\Opera.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> run4opera <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%Programfiles(x86)%\Opera\Opera.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> run4operax86 Goto FindFireFox :run4opera echo Opera^|%Programfiles%\Opera&gt;&gt; Browserlist4saferun.txt Goto FindFireFox :run4operax86 Set Browsername=Opera echo Opera^|%Programfiles(x86)%\Opera&gt;&gt; Browserlist4saferun.txt Goto FindFireFox :FindFireFox <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist %APPDATA%\Mozilla\ xcopy /E /I /C /Y /Q /H /R %APPDATA%\Mozilla\* C:\Users\%safeusername%\AppData\Roaming\Mozilla\ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%Programfiles%\Mozilla Firefox\Firefox.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> run4Firefox <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exist <span class="hljs-string"><span class="hljs-string">"%Programfiles(x86)%\Mozilla Firefox\Firefox.exe"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> run4Firefoxx86 Goto FindChrome :run4Firefox echo Firefox^|%Programfiles%\Mozilla Firefox&gt;&gt; Browserlist4saferun.txt Goto FindChrome :run4Firefoxx86 echo Firefox^|%Programfiles(x86)%\Mozilla Firefox&gt;&gt; Browserlist4saferun.txt Goto FindChrome :FindChrome If exist %LOCALAPPDATA%\Google\Chrome\Application\chrome.exe <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> run4chrome Goto FindIE :run4chrome ::<span class="hljs-comment"><span class="hljs-comment">// Can work for some versions of Chrome by not stable. Dissabled for performance. ::xcopy /E /I /C /Y /Q /H /R %LOCALAPPDATA%\Google\Chrome\* C:\Users\%safeusername%\AppData\Local\Google\Chrome\ ::for /r C:\Users\%safeusername%\AppData\Local\Google\Chrome\ %%C in (*.exe) do icacls %%C /grant %safeusername%:(X) ::for /r C:\Users\%safeusername%\AppData\Local\Google\Chrome\ %%C in (*.dll) do icacls %%C /grant %safeusername%:(X) ::echo Chrome^|C:\Users\%safeusername%\AppData\Local\Google\Chrome\Application\&gt;&gt; Browserlist4saferun.txt Goto FindIE :FindIE ::// TODO A lot of XCOPYs if exist "%LOCALAPPDATA%\Microsoft\Internet Explorer" ( xcopy /E /I /C /Y /Q /H /R "%USERPROFILE%\Favorites\*" "C:\Users\%safeusername%\Favorites\" xcopy /E /I /C /Y /Q /H /R "%LOCALAPPDATA%\Microsoft\Internet Explorer\*" "C:\Users\%safeusername%\AppData\Local\Microsoft\Internet Explorer\" xcopy /E /I /C /Y /Q /H /R "%LOCALAPPDATA%\Microsoft\Windows\History\*" "C:\Users\%safeusername%\AppData\Local\Windows\History\" xcopy /E /I /C /Y /Q /H /R "%APPDATA%\Roaming\Microsoft\Windows\Cookies\*" "C:\Users\%safeusername%\AppData\Roaming\Microsoft\Windows\Cookies\" ) if exist "%Programfiles(x86)%\Internet Explorer\iexplore.exe" goto run4iex86 if exist "%Programfiles%\Internet Explorer\iexplore.exe" goto run4ie :run4iex86 echo IExplore^|%Programfiles(x86)%\Internet Explorer&gt;&gt; Browserlist4saferun.txt goto MakeLinks :run4ie echo IExplore^|%Programfiles%\Internet Explorer&gt;&gt; Browserlist4saferun.txt ::Make links:: :MakeLinks rd /s /q %USERPROFILE%\Downloads\Browser rd /s /q %USERPROFILE%\Desktop\SafeLinks mklink /d %USERPROFILE%\Downloads\Browser C:\Users\%safeusername%\Downloads mkdir %USERPROFILE%\Desktop\SafeLinks echo on For /f "tokens=1,2 delims=|" %%A in (Browserlist4saferun.txt) do ( echo Option explicit &gt; "%%B\%%A.vbs" echo Dim oShell &gt;&gt; "%%B\%%A.vbs" echo set oShell= Wscript.CreateObject^("WScript.Shell"^) &gt;&gt; "%%B\%%A.vbs" echo oShell.Run "RunAs /user:%safeusername% %%A.exe" &gt;&gt; "%%B\%%A.vbs" echo WScript.Sleep 1000 &gt;&gt; "%%B\%%A.vbs" echo oShell.Sendkeys "%safepassword%" &gt;&gt; "%%B\%%A.vbs" echo oShell.Sendkeys "{ENTER}" &gt;&gt; "%%B\%%A.vbs" echo Wscript.Quit &gt;&gt; "%%B\%%A.vbs" echo Set oWS = WScript.CreateObject^("WScript.Shell"^) &gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo sLinkFile = "%USERPROFILE%\Desktop\SafeLinks\%%A_saferun.LNK" &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo Set oLink = oWS.CreateShortcut^(sLinkFile^) &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo oLink.TargetPath = "%%B\%%A.vbs" &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo oLink.IconLocation = "%%B\%%A.exe,0" &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo oLink.WorkingDirectory = "%%B\" &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" echo oLink.Save &gt;&gt; "%USERPROFILE%\Desktop\SafeLinks\%%A.lnk.vbs" ) for /r %USERPROFILE%\Desktop\SafeLinks\ %%p in (*.vbs) do cscript %%p for /r %USERPROFILE%\Desktop\SafeLinks\ %%v in (*.vbs) do del %%v :: Open Explorer with links:: explorer %USERPROFILE%\Desktop\SafeLinks\ :: Create Uninstall:: echo @echo off &gt; uninstall_%~n0.bat echo net user %safeusername% /del &gt;&gt; uninstall_%~n0.bat echo rd /s /q %USERPROFILE%\Downloads\Browser &gt;&gt; uninstall_%~n0.bat echo rd /s /q %USERPROFILE%\Desktop\SafeLinks &gt;&gt; uninstall_%~n0.bat echo rd /s /q C:\Users\%safeusername%\ &gt;&gt; uninstall_%~n0.bat echo For /f "tokens=1,2 delims=|" %%%%A in (Browserlist4saferun.txt) do del "%%%%B\%%%%A.vbs" &gt;&gt; uninstall_%~n0.bat echo del Browserlist4saferun.txt &gt;&gt; uninstall_%~n0.bat echo del %%0 &gt;&gt; uninstall_%~n0.bat :Exit</span></span></code> </pre> <br><h4>  Testing </h4><br>  Well, now let's try how it all works in the wild: <br><br>  1. Turn off the antivirus and downgrade, for example, JAVA (the couple immediately became uncomfortable for me). <br><br>  2. Copy-paste batch file from listing. <br><br>  3. Save it as saferun.bat, take a deep breath and click on it twice. <br><br>  4. The console blinks and the explorer window opens.  We look at the window with labels and think a lot. <br><br>  5. Choose any browser.  We go to Youtube, check that everything works, clicks, etc. <br><br>  6. Now we go to Google and look for the ‚ÄúMost Popular Runet Browser‚Äù (this is what my sister showed me how to download a free porn blocker).  We click on several links, and our computer begins to pop suspiciously.  We are waiting for a minute.  It seems nothing terrible happened.  We look in Process Explorer and see that our browser has launched JAVA.exe, which successfully inherited our new user. <br><div style="text-align:center;"> <a href="http://img-fotki.yandex.ru/get/4606/126183829.2/0_7ea80_6254450c_orig"><img src="https://habrastorage.org/getpro/habr/post_images/9d5/4ad/83f/9d54ad83faa49dcba2270d3c1fc63b52.png" alt="image"></a> </div><br><br>  7. Now go to the temporary directory of the new user and see the following there ... <br><div style="text-align:center;"> <a href="http://img-fotki.yandex.ru/get/4402/126183829.2/0_7ea81_fdd2966e_orig"><img src="https://habrastorage.org/getpro/habr/post_images/aa6/e3c/726/aa6e3c726d61457b60a650b539df0acf.png" alt="image"></a> </div><br><br>  8. Check the rights to the file "____ 991.exe" <br><div style="text-align:center;"> <a href="http://img-fotki.yandex.ru/get/4606/126183829.2/0_7ea82_cb5f7173_orig"><img src="https://habrastorage.org/getpro/habr/post_images/f12/4d9/cf8/f124d9cf83fb157b22cdc0a59a76fcc9.png" alt="image"></a> </div><br><br>  9. Disable cmd.exe under the created user.  The password for it can be viewed, for example, in the VBS script next to the browser's EXE <br><div style="text-align:center;"> <a href="http://img-fotki.yandex.ru/get/4703/126183829.2/0_7ea83_4fa16e44_orig"><img src="https://habrastorage.org/getpro/habr/post_images/efc/455/0a5/efc4550a58521fd32e601fb01afc861d.png" alt="image"></a> </div><br><br>  10. Make cd% temp% in the new console and write ". \ ____ 991.exe".  Hit Enter! <br><div style="text-align:center;"> <a href="http://img-fotki.yandex.ru/get/5601/126183829.2/0_7ea84_c5323946_orig"><img src="https://habrastorage.org/getpro/habr/post_images/2df/675/d71/2df675d71d8dbc0dea4753a7fdc09593.png" alt="image"></a> </div><br><br>  11. URA-URA !!!  This is victory. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e64/bcc/f1f/e64bccf1fc4592fedd2f4fe245aed200.png" alt="image"></div><br>  12. Who are interested in the details, then <br><br><pre> <code class="cpp hljs">C:\Users\saferun_user_31714\AppData\Local\Temp&gt;d:\md5.exe ____991.ex ____991.ex : <span class="hljs-number"><span class="hljs-number">04</span></span>DA16B5447D8F2B4BD23AFD469FB153</code> </pre> <br>  If this file were launched, we would see funny pictures and a request to work with the payment terminal. <br><br><h4>  Instead of conclusion </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/adb/356/a1c/adb356a1cdaed3eab899e75153a59de9.png" alt="image"></div><br>  In total, our batch file will be very useful for protecting against Drive-by attacks and exploits when working with Windows 7 both from under the admin and as a simple user.  Yes, he has a theoretical limit on payloads with elevated privileges, but such a benefit in the wild is rare.  Pros when working with a batch file - you can quickly edit it and add support for new programs, such as email clients, office programs, etc.  Adjustment, flexibility, coolness and coolness are very important, and we in LK understand this very well. <br><br>  Thank you very much for reading this stream of consciousness of the author to the end and have never pressed a minus.  8) Good luck! <br><br>  <b>PS</b>  This batch file has nothing to do with SafeBrowser, which is a part of LC products. <br>  <b>PPP.</b>  The batch file creates a very convenient Uninstall - just in case something suddenly went wrong. <br>  <b>Ppps</b>  As usual in comments a friendly user <a href="http://habrahabr.ru/users/k1k/">k1k</a> hangs out, who pretends to be the author of the article.  The way it is.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/137304/">https://habr.com/ru/post/137304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../137299/index.html">Google+ demography in Russia</a></li>
<li><a href="../137300/index.html">Making the library written in .Net understandable for Unmanaged code</a></li>
<li><a href="../137301/index.html">Restore individual pages in the database</a></li>
<li><a href="../137302/index.html">MegaUpload files want to delete this week</a></li>
<li><a href="../137303/index.html">High-quality interface for Microsoft</a></li>
<li><a href="../137305/index.html">Learning foreign languages: live teachers or the Internet?</a></li>
<li><a href="../137306/index.html">Authentication in OpenVPN using Rutoken EDS</a></li>
<li><a href="../137308/index.html">Is it time for usability in the state. the sector?</a></li>
<li><a href="../137309/index.html">Carberp, Facebook and ddos.plug</a></li>
<li><a href="../137311/index.html">Google+ information flow on Ruby, Rails, Sinatra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>