<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Web audio offline in Safari for iOS 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Playback of cached audio in offline mode in Safari for iOS has long been a real challenge, which was considered an unattainable goal . But with the ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Web audio offline in Safari for iOS 6</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage2/10c/be3/303/10cbe3303ca7ee19cfbe4cf676a8e547.png"></div><br>  Playback of cached audio in offline mode in Safari for iOS has long been a real challenge, which was considered an <a href="http://happyworm.com/blog/2012/05/29/playing-web-audio-offline-on-mobile-safari-mission-impossible/">unattainable goal</a> .  But with the advent of the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">web audio API</a> (only in the WebKit engines), it finally became possible, despite the fact that you still have to take a few steps. <br><br>  The bad news is that you still won't be able to cache mp3 files using the <a href="http://html5doctor.com/go-offline-with-application-cache/">application's cache</a> and simply download them using <code>XmlHttpRequest</code> .  Safari for iOS 6 will cache mp3 files, but then silently refuses to play them (very useful!) <br><a name="habracut"></a><br><h4>  Base64 goes to the rescue </h4><br>  Due to the fact that the web audio API provides developers with direct access to the <a href="https://dvcs.w3.org/hg/audio/raw-file/tip/webaudio/specification.html">audio buffer</a> , you can change the data format on the fly and send them directly to the web audio API for playback.  For example, if you encode an mp3 file into a base64 string, then you can decode it into an <a href="https://developer.mozilla.org/en/JavaScript_typed_arrays/ArrayBuffer">ArrayBuffer</a> and convert the raw audio data. <br><h4>  Encoding audio file </h4><br>  You can easily convert mp3 file to base64 string using <a href="http://www.openssl.org/">OpenSSL</a> .  If you are running Mac OS X, where it is pre-installed, simply open Terminal.app and enter the following command: <br><br><pre> <code class="bash hljs">openssl base64 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [infile] -out [outfile]</code> </pre><br>  Replace [infile] with the path to your mp3 file, and [outfile] with the path to save the encoded data. <br>  The command will save the base64-encoded audio file representation.  Then you can cache this string using any web storage of your choice (for example, <a href="http://html5doctor.com/go-offline-with-application-cache/">application cache</a> , <a href="http://html5doctor.com/storing-data-the-simple-html5-way-and-a-few-tricks-you-might-not-have-known/">local storage</a> or <a href="http://html5doctor.com/introducing-web-sql-databases/">webSQL</a> ) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Base64 in ArrayBuffer </h4><br>  To convert base64 to ArrayBuffer, you need to use your solution.  See Daniel Baser's solution for <a href="">base64-</a> binary.js (Daniele Guerrero).  This is a good script that was created specifically for this purpose.  It converts the base64 string to a <a href="https://developer.mozilla.org/en/JavaScript_typed_arrays/Uint8Array">Uint8Array</a> and saves it to an ArrayBuffer. <br>  After that you can simply decode the audio data using honey <code>decodeAudioData()</code> from the web audio API. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buff = Base64Binary.decodeArrayBuffer(sound); myAudioContext.decodeAudioData(buff, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">audioData</span></span></span><span class="hljs-function">) </span></span>{ myBuffer = audioData; });</code> </pre><br>  After transcoding audio data, transfer them to the audio buffer and play the sound: <br><br><pre> <code class="objectivec hljs">mySource = myAudioContext.createBufferSource(); mySource.buffer = myBuffer; mySource.connect(myAudioContext.destination); mySource.noteOn(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br><br><h4>  Demo and source code </h4><br>  View an <a href="http://alxgbsn.co.uk/offlinewebaudio/">online demo</a> and <a href="https://github.com/alexgibson/offlinewebaudio">source code</a> with additional examples of using the technique from this article. <br><br><h4>  Browser support </h4><br>  Presented demos work under Safari 6, Chrome Desktop and Safari under iOS6.  Technique, potentially, can work in any browser that supports web audio API, therefore, we hope Chrome Mobile will soon add support for it. <br>  At the moment, W3C is promoting the web audio API <a href="http://www.w3.org/2011/audio/wiki/W3C_Audio_Publications_and_Milestones">as standard</a> . </div><p>Source: <a href="https://habr.com/ru/post/160465/">https://habr.com/ru/post/160465/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../160455/index.html">Beautiful disabled icons "little blood"</a></li>
<li><a href="../160457/index.html">SMS alert plugin for critical tasks for Redmine</a></li>
<li><a href="../160459/index.html">NetWrix Change Reporter Suite licenses for Microsoft Certified Professionals</a></li>
<li><a href="../160461/index.html">Sixth Kiev Habravstrecha</a></li>
<li><a href="../160463/index.html">Industrial Internet can add 15 trillion dollars to global GDP</a></li>
<li><a href="../160473/index.html">Examples of using trigonometric functions for animation</a></li>
<li><a href="../160477/index.html">"Offline first" approach to creating web applications</a></li>
<li><a href="../160479/index.html">Catalog of companies - exporters of IT solutions in St. Petersburg</a></li>
<li><a href="../160481/index.html">Gmail increases attachment size up to 10 GB (with links to GDrive)</a></li>
<li><a href="../160483/index.html">"Leaving, extinguish everything." The principle of building a partially disconnected apartment grid is one of the stages of preparation for the creation of a ‚Äúsmart home‚Äù</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>