<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Is the smart home controller (with Ethernet, WiFi, USB, blackjack and buns) for $ 20?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, we were approached by one potential customer with his own idea of ‚Äã‚Äãa ‚Äúsmart home‚Äù project. We are always glad for customers, especiall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Is the smart home controller (with Ethernet, WiFi, USB, blackjack and buns) for $ 20?</h1><div class="post__text post__text-html js-mediator-article">  Some time ago, we were approached by one potential customer with his own idea of ‚Äã‚Äãa ‚Äúsmart home‚Äù project.  We are always glad for customers, especially if they have a more or less intelligible idea and enough money to implement it (I‚Äôll say right away that this customer is still the ideal for a spherical customer in a vacuum, we are lucky with him).  So after a couple of meetings, a general description of the project was born, and we began to look for options for technical implementation.  We needed an inexpensive controller with WiFi and USB support, low power consumption and, most importantly, with an open enough architecture so that we could make our own customized solution on its basis. <br><br>  And then a very good <a href="http://habrahabr.ru/post/159745/">article</a> caught our eye.  Wow, what things happen, it turns out!  I myself have used the mini-router TP-LINK TL-WR702N, bought rubles for 700, as a mobile access point for traveling around China (where until now the RJ-45 socket in the room with no WiFi is quite common) the fact that a decent single board computer lives inside with a bunch of extra features was a pleasant surprise for me.  And since we are tightly tied with China in our main business (and Chinese electronics manufacturers in particular), it became interesting to us - how much will our own board based on SoC AR9331 cost, if the whole is a complete solution in the package, in the box, with wires and block food costs 700r in Russia ($ 22 at the time) in retail? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a49/8a3/3f3/a498a33f3f0252411224e17068aa365b.jpg" alt="image"><br><a name="habracut"></a><br><h5>  1. What is so attractive about SoC AR9331? </h5><br>  For a start, what is the basis of all these extremely cheap mini-routers?  This is a SoC (system-on-chip) Atheros AR9331 ( <a href="http://www.openhacks.com/uploadsproductos/ar9331_datasheet.pdf">datashit</a> ).  In one small chip (12x12mm) are concentrated: <br><ul><li>  MIPS 400MHz 32-bit processor </li><li>  memory interfaces (DRAM and serial Flash) </li><li>  five-port Ethernet switch </li><li>  2.4 GHz WiFi interface 802.11b / g / n (up to 130 Mbps) </li><li>  USB 2.0 controller (host / client) </li><li>  UART, I2S / SPDIF, SLIC interfaces </li><li>  up to 28 GPIO (!!!). </li></ul><br>  This all works (in addition to proprietary firmware) under control of <a href="https://openwrt.org/">OpenWRT</a> .  But the most interesting thing is that this chip in China is wholesale in the region of 5-6 USD!  But‚Ä¶ 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  2. Give two! </h5><br>  I really wanted to look at this miracle alive, to conduct a couple of inhuman experiments.  It turned out that in the "walking distance" there are two options for the CPU board based on the AR9331.  These are Lithuanian <a href="http://8devices.com/carambola-2">Carambola2</a> and Chinese <a href="http://www.aliexpress.com/item/FREE-SHIPPING-2PCS-LOT-EL-M150-openwrt-m150-AR9331-wifi-MODULE-flash-4m-8m-16m/1391647330.html">EL-M150 boards</a> .  Of course, for convenience we ordered a development board for a couple or three ( <a href="http://shop.8devices.com/carambola2-bundle">this one</a> and <a href="http://www.aliexpress.com/item/Ar9331-m150-wifi-module-el-m150-development-board-openwrt-wireless/1618071572.html">this one</a> , respectively). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/82e/0b2/e1d/82e0b2e1d6f25a2fcee526f53588db9f.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/699/bf6/350/699bf635091f36a334aff215df10b32a.jpg" alt="image"><br>  It is clear that we ordered Chinese motherboards through our own channels in Shenzhen, and they were much cheaper (65 USD with delivery).  At the same time, the Chinese have acquired several pieces of processor boards to find out how much their production actually costs?  (Chinese retail sells them for $ 25).  Here are these: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a82/266/7bf/a822667bfb995567ade0686de9afa5cd.jpg" alt="image"><br><br><h5>  3. Carambola2 development board </h5><br><div class="spoiler">  <b class="spoiler_title">Lyrical digression.</b> <div class="spoiler_text">  I can not share my memories of the first time when I came across this funny word - ‚Äúcarambola‚Äù.  At the dawn of perestroika, the USSR began to publish a local version of the magazine "Burda Fashion".  It was an unconditional hit, our women (in my case - mother) stood in a queue to get acquainted with the advanced Western ideas of cutting and sewing.  At that time, I was not interested in rags, but now there were all sorts of interesting recipes (and I always loved to devour, and now ... oh ...), which I always read with pleasure and the extreme degree of curiosity.  Painfully, all this glossy splendor was noticeably different from the beloved desktop ‚ÄúBooks about tasty and healthy food‚Äù of 1976 edition.  So, in one of the recipes I met the golden words: "... take two cannons."  To say that I fell into a stupor is to say nothing.  Not only did I have absolutely no idea <i>where</i> they could be taken in the late 80s in Leningrad?  To my deepest shock, I could not even imagine - <i>what is it all about</i> ?!  Vegetable?  Fruit?  Nut?  Seasoning?  Spice?  And, alas, there was no photo of a magical object with the miraculous (or miraculous) name of "carambola" ... That's how I had to live in ignorance until the Internet appeared. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/41b/f03/eca/41bf03eca4611d1e45fe58cd7564c97b.jpg" alt="image"></div></div><br><img src="https://habrastorage.org/getpro/habr/post_images/925/04d/78a/92504d78aef2768e15f9f9642db323c1.jpg" alt="image"><br><br>  What well: <br><ul><li>  inexpensive (33 Euro) </li><li> miniUSB connector (connect to computer and immediately get power plus console) </li><li>  small (84x63x12mm with connectors) </li><li>  ceramic WiFi antenna plus connector for a small external antenna </li><li>  16MB of flash memory </li><li>  developed community of enthusiasts. </li></ul><br>  What is not very good: <br><ul><li>  few things: connectors, buttons, LEDs, etc. </li><li>  WiFi is disabled by default, SCP and console are inaccessible, out of the box - only WEB access via Ethernet </li><li>  non-informative indication of the current state </li><li>  I got a version with some kind of a very truncated firmware </li><li>  It is not clear that with accessibility: I bought before the New Year, but now the site is only available pre-order. </li></ul><br>  Since the power is from the computer via miniUSB, the power consumption has not yet been measured. <br><br><h5>  4. EL-M150 development board </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/ebc/5aa/e1e/ebc5aae1ef6eb95cfede23b9387c9429.jpg" alt="image"><br>  What well: <br><ul><li>  Dofig total on the board (14 LEDs, two relays, three Ethernet connectors, three USB (full-sized), SD card slot, power button with latching, three buttons without latching (including Reset), 16 jumpers), connector for a large WiFi antenna </li><li>  the firmware is completely full at once, it was not necessary to reflash right away </li><li>  WiFi is included out of the box in the ‚Äúaccess point‚Äù mode - initial setup without problems </li><li>  The SCP and console are available immediately (if the buyer is sufficiently quick to guess the ‚Äúadmin‚Äù password for the ‚Äúroot‚Äù user). </li></ul><br>  What is not very good: <br><ul><li>  <s>more expensive and more Carambola</s> (this is not a drawback - see the list of opportunities a little higher) </li><li>  need a separate power supply (7-12V) </li><li>  flash memory - 8Mb </li><li>  Built-in WiFi antenna (track on the board) - not a fountain (although it works) </li><li>  Initially, the WEB-interface is <b>in Chinese</b> (oh, how can I use foul <b>language</b> !) </li><li>  2 relays of the magic brand ‚ÄúHUI KE‚Äù for some reason in nominal 1A 125V (which prevented 230V from supplying - it is not clear) </li><li>  Chinese specifics - technical support will not wait </li><li>  I somehow managed to turn one board into a brick. </li></ul><br>  Power consumption (without external connected devices) is about 1.1 W. <br><br><h5>  5. Processor board EL-M150 </h5><br>  As I already mentioned, it was very interesting to us - what is the cost price of the product of our Chinese friends (I remind you that they sell this board for an average of $ 25 at retail)?  We counted.  So, in circulation in 1000 pcs.  The cost of the card goes a little less than $ 12: <br>  SoC AR9331 $ 5.4 <br>  RAM DDR2 64Mb $ 1.5 <br>  Serial flash 8Mb $ 1.1 <br>  PCB fabrication (4 layers) plus installation - $ 3.2 <br>  Plus small things, testing and firmware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/400/6ad/bf4/4006adbf45d6ce6efab47257ffedaca4.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/02f/d30/892/02fd308929052dc574b09a771705b1f8.jpg" alt="image"><br><br>  Our own payment will turn out to be a bit more expensive in the cost than the Chinese, because  we make a 5V power input (the Chinese have 3.3V) so that we can directly connect USB clients to the processor board (and feed it from the same USB).  In general, $ 20 retail in Russia is quite real.  Again, the Chinese friends made the bottom surface smooth <s>like a baby's ass</s> , in order to use their favorite way of mounting on the "carrier board" - hardworking yesterday's peasants with hot ( <i>very</i> hot - solder, everyone already has lead-free!) Soldering irons in their callused hands.  We want to make the fee "two-way" and reduce the size of one and a half times.  How to make prototypes - open all documentation for the board. <br><br>  By the way.  The processor board "assembled" consumes about 0.4W and is not heated (in general!). <br><br><hr><br><br>  Well, now, as an experiment, we will try to do with each of these two development boards and the cheapest USB WEB-camera (some Logitech was in the nightstand, bought sometime later 500r) IP-camera with video broadcasting via local network via WiFi.  Need to start somewhere? <br><img src="https://habrastorage.org/getpro/habr/post_images/ac4/ef2/052/ac4ef2052b35412db11a5725a5e247d2.jpg" alt="image"><br><br><h5>  1. EL-M150 </h5><br>  Let's start with the Chinese board, because  everything is easier with her. <br>  1. Turn on the power.  Seconds 20 board flashes lights like a Christmas tree, after which a pair of LEDs start to burn constantly.  The board is ready for experiments. <br>  2. Look at the available WiFi networks.  We find something like "Unsafe Wireless Network OpenWRT_el-m150_020020".  We cling to it, we get an IP address. <br>  3. We climb the browser to 192.168.1.1.  Enter the password "admin".  We see the unearthly beauty and rejoice, damn it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d9d/a4d/a28/d9da4da28a69d052a38a2c49a6aa4aaa.jpg" alt="image"><br><br>  4. Switch the language to English, rejoice again, but much stronger.  (I found a <a href="http://www.youtube.com/watch%3Fv%3D4waViO_Btyg">video on YouTube</a> , where a <i>slightly different</i> OpenWRT interface was switched, and compared hieroglyphs, ... !!!).  At the same time, we set the date / time and save all configs.  You can also go to the tab "LEDX / RELAYX", look at the flashing LEDs and listen to relay clicks. <br>  5. Transfer the card from the ‚Äúaccess point‚Äù mode to the client mode of your (home or work) WiFi network.  How to do it - is written in detail <a href="http://habrahabr.ru/post/159745/">here</a> .  We remember the board's IP address. <br>  6. Connect the camera to the USB port. <br>  7. Go to the board already at the new IP-address in your own local network.  In the WEB interface, select the usbd / webcam tab and check the box ‚Äúenable or disable mjpg-streamer webcam‚Äù.  Save the changes - voila, the green LED lights up on the camera, we're on the air! <br>  Now you can watch the video (for example, in the VLC player) at http: // &lt;board IP address&gt;: 8080 /? Action = stream, or catch screenshots at http: // &lt;board IP address&gt;: 8080 /? action = snapshot. <br><br><h5>  2. Carambola2 </h5><br>  There is more work here (well, at least there are no adventures with the Chinese language). <br><br>  1. Connect the board to the computer with a USB-miniUSB lanyard.  The board blinks happily (once) with a green LED.  There is nothing in the console.  No new WiFi networks.  Only gently (and constantly!) Green LEDs on two RJ-45 connectors are lit.  What is going on?! <br><br>  2. Cling the twisted pair port J4 on Karambol to the computer network card.  Yeah, the computer got an IP address!  Go to 192.168.1.1, we see LuCI, hurray! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/327/9ff/618/3279ff618a6e4c766c5cf3ea16f3066d.jpg" alt="image"><br><br>  3. Set a password for root.  Now the board is "visible" in the console and on the SCP.  Cool. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/948/99f/d24/94899fd241ea583defdaa327722c4a4e.jpg" alt="image"><br><br>  4. Turn on WiFi, change the mode from "access point" to "client".  We cling to a payment in a local network through WiFi - hurray!  Now the board can go online (needed for the next item). <br><br>  5. We want to put the package mjpg-streamer.  Bummer !!!  There is no such package in the repository!  Gosha‚Ä¶ <br><br><img src="https://habrastorage.org/getpro/habr/post_images/203/5ea/df7/2035eadf7fc6f65a19a707719f1e6cd4.jpg" alt="image"><br><br>  6. Download <a href="http://pkg.8devices.com/">the</a> latest firmware <a href="http://pkg.8devices.com/">from the site</a> , reflash the board via the WEB-interface with saving the settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d1e/424/9a3/d1e4249a396b5eeeadbfaa551fc77810.jpg" alt="image"><br><br>  Cheers, mjpg-streamer appeared in the list of packages!  Install. <br><br>  7. Connect the camera to USB. <br><br>  8. Everything is cool, only mjpg_streamer does not start.  Error "Init v4L2 failed".  Compare the installed packages on the M150 (where the video works) and on Karambol.  It turns out that there is not enough package kmod-video-videobuf2.  Installing the package, restarting the streamer - hurray!  It worked. <br><br><hr><br><br>  There are no problems with connecting and using USB flash drives.  Now we are slowly torturing GPIO, connecting a 3G modem, building our own OpenWRT firmware, etc.  For this money, I believe both development boards are just a gift.  And the processor board itself is a fairy tale. <br><br>  How suitable is the AR9331 solution as a smart home controller?  In my opinion, perfect.  It integrates into the local network without any problems (if you want - via Ethernet cable, and PoE has not been canceled, if you want - via WiFi).  The power of 400 MHz MIPS processor is more than enough.  OpenWRT allows you to do anything with this board without any special programming difficulties; a lot of packages are available from the repository as a finished product.  Peripherals connect easily.  It is worth quite reasonable money.  In general, if you do not need hardware encoding / decoding video - in my opinion, just a plague. </div><p>Source: <a href="https://habr.com/ru/post/215215/">https://habr.com/ru/post/215215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../215203/index.html">Is IntelliJ based .NET support a reality?</a></li>
<li><a href="../215205/index.html">Cebit 2014 through the eyes of a robot webot</a></li>
<li><a href="../215207/index.html">IBM Watson supercomputer has learned to create its own recipes</a></li>
<li><a href="../215211/index.html">Monkeyrunner. Pixel-perfect testing web pages on Android</a></li>
<li><a href="../215213/index.html">Image Catalyst 2.5</a></li>
<li><a href="../215223/index.html">Stanford University developed a paper microscope worth less than a dollar</a></li>
<li><a href="../215225/index.html">Break me down completely (ZeroNightsCrackme, Part 2)</a></li>
<li><a href="../215227/index.html">Simple monitoring of server load in real time with a web interface</a></li>
<li><a href="../215229/index.html">‚ÄúStolen‚Äù money found on MtGox accounts</a></li>
<li><a href="../215233/index.html">DDOS of any site using Google Spreadsheet</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>