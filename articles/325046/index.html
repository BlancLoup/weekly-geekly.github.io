<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What would i change in go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For half a year I programmed mostly on Go. And I am disappointed. For two reasons: 


- Go is especially difficult to adhere to the functional paradig...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What would i change in go</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/a66/8fc/093/a668fc093c9942d1a8374a62d5e237c8.jpg" alt="image"></p><br><p>  For half a year I programmed mostly on Go.  And I am disappointed.  For two reasons: </p><br><ul><li>  Go is especially difficult to adhere to the functional paradigm.  In essence, the language <a href="https://en.wikipedia.org/wiki/Go_%2528programming_language%2529">interferes with functional programming</a> .  It disappointed me, because in the imperative code that I write, a large number of sample pieces.  Moreover, it seems to me that in this case the risk of errors is higher, in contrast to the use of functional abstractions. </li><li>  I think Go misses its chances.  There are some great innovations in the programming languages ‚Äã‚Äã(especially in the field of type checking and type inference), which make the code safer, faster and cleaner.  I would like Google to use its influence to support some of these ideas. </li></ul><br><p>  I am not the first to take Go in this way.  Here are the publications of other people sharing my impressions: </p><br><ul><li>  <a href="http://yager.io/programming/go.html">Why go is not good</a> </li><li>  <a href="http://crufter.com/%40crufter/everyday-hassles-in-go">Everyday hassles in go</a> </li><li>  <a href="https://www.barrucadu.co.uk/posts/etc/2016-08-25-three-months-of-go.html">Three Months of Go (from a Haskeller's perspective)</a> </li><li>  <a href="http://journal.stuffwithstuff.com/2010/10/21/the-language-i-wish-go-was/">The Language I Wish Go Was</a> </li></ul><br><p>  Below I will add my thoughts.  To show exactly how Go can be improved, I will compare it with Rust. </p><a name="habracut"></a><br><p>  Work on Go and Rust began at about the same time: Go was announced in 2009, and Rust in 2010.  Both languages ‚Äã‚Äãuse similar approaches: </p><br><ul><li>  Compiling to fast native binary files. </li><li>  Avoiding inheritance in favor of composition. </li><li>  Support imperative programming. </li><li>  Refusal to intercept exceptions in favor of explicit transmission of erroneous results. </li><li>  Emphasis on multithreading. </li><li>  Static type checking. </li><li>  Modern package system with support for modularity. </li></ul><br><p>  Probably, both languages ‚Äã‚Äãwere intended to replace C ++: the <a href="https://en.wikipedia.org/wiki/Go_%2528programming_language%2529">Go developers claimed</a> that discontent with the complexity of C ++ was the primary motivator for them.  <a href="https://servo.org/">Servo</a> is one of the main Rust products of Mozilla.  This is a potential successor to the Gecko HTML rendering engine written in C ++. </p><br><p>  In my opinion, the key differences between these languages ‚Äã‚Äãare: </p><br><ul><li>  <em>Rust is more suitable for high performance and powerful soundness abstractions.</em>  <em>(Soundness is a property of the type system when any ‚Äústatements‚Äù made by types are guaranteed to be observed throughout the entire program run. If the language is sound, then run-time type errors are not executed at runtime.)</em> </li><li>  Go provides accessibility, it is simple and fast to compile. </li></ul><br><p>  In other words, Rust does not necessarily replace Go.  I do not urge everyone who uses Go to switch to Rust.  In Rust there is support for real-time operations, if necessary, it is able to operate only with stack memory.  In Rust, a complex type system that can, for example, identify problems through a multi-threaded (concurrent) reference to shared data during compilation.  All this increases the complexity of Rust programs.  The same <a href="https://doc.rust-lang.org/book/ownership.html">borrow-checker</a> is famous for its learning curve.  But I want to make comparisons with Rust in certain contexts to illustrate options for improving Go.  Rust borrowed a lot of good ideas from other languages ‚Äã‚Äãand competently combined them.  And it seems to me that if Go had adopted the same ideas, it would benefit him. </p><br><p>  Code samples from the article are available <a href="https://github.com/hallettj/comparing-go-and-rust">here</a> .  You can also take executable tests and experiment there. </p><br><h2 id="horoshiy">  Good </h2><br><p>  I think Go‚Äôs is an excellent mechanism for using interfaces to structure data. </p><br><p>  I like the separation of behavior from the data itself: structures store data, methods manipulate data in structures.  This is a clear separation of state (structures) and behavior (methods).  I believe that in languages ‚Äã‚Äãwith inheritance this distinction may not be so obvious. </p><br><p>  Go just to study.  Object-oriented ideas in it are modified in such a way that they become more accessible to programmers familiar with other object-oriented languages. </p><br><p>  Often, a fairly simple way to solve problems ‚Äúin the style of Go‚Äù is used.  The same can be said, for example, about Python.  The emergence of such stable idioms suggests that any Go programmer will surely understand the code written by any other Go programmer.  This is part of the philosophy of simplicity described in the publication <a href="https://dave.cheney.net/2015/03/08/simplicity-and-collaboration">Simplicity and Cooperation</a> . </p><br><p>  The standard Go library has many carefully thought out features.  One of my favorites: </p><br><pre><code class="go">fiveSeconds := 5 * time.Second</code></pre><br>
<p> ,    ,        .        .  Go    :  Erlang  Scala     (actors).  Rust          (concurrent)   .</p><br>
<p>       Rust,  ,            Go.   Rust   ,   .     ‚Äî , enum‚Äô   (traits).     ,               ,     .    Go,  Rust  ,   ,   (type safety),    .  :   Rust    ,      . </p><br>
<p>      Go.      .</p><br>
<h2 id="plohoy"></h2><br>
<p>     Go.</p><br>
<h3 id="nil">nil</h3><br>
<p>    null-   ,        . ,      <code>nil</code>      (bottom-ish type),      ,    (pass-by-reference type).</p><br>
<p> ,   <code>nil</code> ‚Äî   null-.     ,          <code>nil</code>.    <a href="https://speakerdeck.com/campoy/understanding-nil">Understanding Nil</a>  ,    ,  <code>nil</code>  ,     .  Go    <code>nil</code>.    :     ,   ,    ,         <code>nil</code>.       runtime'a.   ,     ,   ,      .</p><br>
<p><code>null</code>       ,    ,       (, <a href="http://fantom.org/">Fantom</a>  <a href="https://flowtype.org/">Flow</a>).          null.    Flow     ,  null,     React:</p><br>
<pre><code class="go">function LoginForm(props) {
  // `?`  `HTMLInputElement` ,  `emailInput`   `null`.
  let emailInput: ?HTMLInputElement

  // JSX-       HTML
  return &lt;form onSubmit={event =&gt; props.onLogin(event, emailInput)}&gt;
    &lt;input type="email" ref={thisElement =&gt; emailInput = thisElement} /&gt;
    &lt;input type="submit" /&gt;
  &lt;/form&gt;
}

function onLoginTake1(event: Event, emailInput: ?HTMLInputElement) {
  event.preventDefault()

  //  !    `value`  , , , `null`  `undefined`.
  dispatch(loginEvent(emailInput.value))
}

function onLoginTake2(event: Event, emailInput: ?HTMLInputElement) {
  event.preventDefault()

  if (emailInput) {
    //   ,   Flow ,  `emailInput`       `null`  `undefined`.
    dispatch(loginEvent(emailInput.value))
  }
}
</code></pre><br>
<p>    null  <code>nil</code>  ,     .   Go ,       <code>User</code>.        ,      <code>nil pointer dereference</code>:</p><br>
<pre><code class="go">func validate(user *User) bool {
    return user.Name != ""
}</code></pre><br>
<p> Go   ,   ,   : ¬´‚Ä¶   <code>nil</code>¬ª.  ,   null,    ,    .</p><br>
<p>  <code>nil</code>  Go  ,    <code>nil</code>  .     (interface value)  - ,   <code>nil</code>,  <a href="http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html">   nil    true</a>.    ,        <code>nil</code>:    ,       <code>nil</code>.     .     --nil ,    (receiver value)       <code>nil</code>.</p><br>
<p>     (zero value)?      ,    <code>nil</code>? ,    ‚Äî   .</p><br>
<p>     Go ‚Äî        ,    .   ,        ,      .  ,      Go   :    ,     .   ++  <a href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html"> </a>,           .        ‚Äî  . (,    ,    ++ ,       .)  ,   Go     ++         .       !     ,    :  Rust, Flow          <a href="https://en.wikipedia.org/wiki/Data-flow_analysis">  </a>.     ,     .</p><br>
<p>     : <code>nil</code>  ,      .      (sensible)   ,   <code>nil</code> ‚Äî  .     . </p><br>
<p> :  Go             (domain-specific types).      ,    (soundness) .         (,     runtime-)    .   (pointer types)     <code>nil</code>-.     ,       (sensible behavior)     .        .       ,    .</p><br>
<p>  <a href="https://www.barrucadu.co.uk/posts/etc/2016-08-25-three-months-of-go.html">  Go</a>      :</p><br>
<p><em>      . ,   ,   -  ,           . ,    ,       (,    ).</em></p><br>
<h3 id="kak-eto-sdelano-v-rust">    Rust</h3><br>
<p> Rust   <code>null-</code>,  <code>nil</code>-.   enum‚Äô.  ,      ,   ,  , ‚Äî   .      ,    enum  .      Option- (Option Pattern).      <code>Option</code>    Rust:</p><br>
<pre><code class="rust">pub enum Option&lt;T&gt; {
    None,    //   
    Some(T), //    
}</code></pre><br>
<p><code>None</code>  <code>Some</code> ‚Äî  :     ,    <code>Option&lt;T&gt;</code>. <code>Some</code>   , <code>None</code>   .   <code>Option&lt;T&gt;</code>,        (pattern matching),  ,      .       (read back)   .      <code>Some(x)</code>,         <code>x</code>.</p><br>
<p>  Option- (<a href="http://rustbyexample.com/std/option.html"></a>):</p><br>
<pre><code class="rust">fn checked_division(dividend: i32, divisor: i32) -&gt; Option&lt;i32&gt; {
    if divisor == 0 {
        //     `None`
        None
    } else {
        //    `Some`
        Some(dividend / divisor)
    }
}

#[test]
fn divides_a_number() {
    let result = checked_division(12, 4);
    match result {
        Some(num) =&gt; assert_eq!(3, num), //     (bind) `num`
        None      =&gt; assert!(false, "Expected `Some` but got `None`")
    };
}
</code></pre><br>
<p> Option-  ,   null,   ,      <code>None</code>  <code>Some(None)</code>.  , ,    ,   <code>None</code>  ,        .   <code>Some(None)</code>  ,       ‚Äî <code>None</code>.</p><br>
<p>    Option-  ,     Java.                 ,      . Rust    Option-,         (zero-cost abstractions).     <code>Option&lt;T&gt;</code>     (reference type),    runtime     None     (null pointer).   <code>Some</code>  <code>None</code>    .       ,      <code>null</code>-.</p><br>
<p>    <code>Option&lt;i32&gt;</code>,  <code>i32</code>    .         ,    ,   <code>Some</code>  <code>None</code>.      ,    .</p><br>
<p> ¬´ Rust¬ª    <a href="https://doc.rust-lang.org/book/error-handling.html">  </a>   .</p><br>
<p> Go        Option-.    <code>match</code>       ,   .    <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)"> ¬´¬ª</a> (<a href="https://github.com/hallettj/comparing-go-and-rust/tree/master/go/option"></a>).        ,    <code>Option</code>.</p><br>
<h3 id="shablonnost-obrabotki-oshibok-i-nehvatka-proverok-na-oshibki-pri-kompilirovanii">         </h3><br>
<p>    Go    : </p><br>
<ul>
<li>    ; </li>
<li>                (error variable),     .</li>
</ul><br>
<pre><code class="go">func doStuff() error {
    _, err := doThing1()
    if err != nil {
        return err
    }

    _, errr := doThing2()  // Error not propagated due to a bouncy key
    if errr != nil {
        return err
    }

    return nil
}</code></pre><br>
<p> Rust   <code>Result&lt;T,E&gt;</code>,  <code>Option&lt;T&gt;</code>.    ,  ¬´¬ª  enum‚Äô <code>Result&lt;T,E&gt;</code>   ‚Äî     ( <code>E</code>).    <code>Result&lt;T,E&gt;</code>   <code>Ok(value)</code> (  )  <code>Err(err)</code> (  ).</p><br>
<pre><code class="rust">pub enum Result&lt;T, E&gt; {
    Ok(T),
    Err(E),
}</code></pre><br>
<p>   Option  Result   -      (successful) .        .      (first-class result values)    ,         ,      .</p><br>
<p>   Go:</p><br>
<pre><code class="go">func fetchAllBySameAuthor(postID string) ([]Post, error) {
    post, err := fetchPost(postID)
    if err != nil {
        return nil, err
    }

    author, err := fetchUser(post.AuthorID)
    if err != nil {
        return nil, err
    }

    return fetchPosts(author.Posts)
}</code></pre><br>
<p> Rust  <code>fetchAllBySameAuthor</code>      . ,     ,        Option  Result, ‚Äî   :</p><br>
<pre><code class="rust">fn fetch_all_by_same_author(post_id: &amp;str) -&gt; Result&lt;Vec&lt;Post&gt;, io::Error&gt; {
    let post = match fetch_post(post_id) {
        Ok(p)    =&gt; p,
        Err(err) =&gt; return Err(err),
    };

    let author = match fetch_user(&amp;post.author_id) {
        Ok(a)    =&gt; a,
        Err(err) =&gt; return Err(err),
    };

    fetch_posts(&amp;author.posts)
}</code></pre><br>
<p>  <code>match</code>      (pattern-match block).     (pattern)      ,   ,    . -  <a href="https://golang.org/doc/effective_go.html"> </a>  Go,           <code>switch</code>.   Rust             .      .         :        ,   .</p><br>
<p>  Rust    ,    Go.   ,      <code>Result&lt;T,E&gt;</code>  <code>Option&lt;T&gt;</code>       <code>nil</code>.     Rust     ,       .</p><br>
<p> Rust   <code>try!</code>,          ,    .     :</p><br>
<pre><code class="rust">fn fetch_all_by_same_author(post_id: &amp;str) -&gt; Result&lt;Vec&lt;Post&gt;, io::Error&gt; {
    let post   = try!(fetch_post(post_id));
    let author = try!(fetch_user(&amp;post.author_id));
    fetch_posts(&amp;author.posts)
}</code></pre><br>
<p><code>try!</code>    . , <code>try!(fetch_post(post_id))</code>   <code>fetch_post</code>  <code>match</code>      <code>Ok</code>  <code>Err</code>.</p><br>
<p> <code>try!</code>   ,   Rust    :     ,        <code>?</code>. ,  <code>let post = try!(fetch_post(post_id));</code>    <code>let post = fetch_post(post_id)?;</code>.      <code>?</code>,     .</p><br>
<p> Go   .  , Result-      .  ,   ,    (combinator methods):</p><br>
<pre><code class="go">fn fetch_all_by_same_author(post_id: &amp;str) -&gt; Result&lt;Vec&lt;Post&gt;, io::Error&gt; {
    let post   = fetch_post(post_id);
    let author = post.and_then(|p| fetch_user(&amp;p.author_id));
    author.and_then(|a| fetch_posts(&amp;a.posts))
}</code></pre><br>
<p><code>and_then</code> ‚Äî    <code>Result&lt;T,E&gt;</code>.       (successful result),   ,      <code>Result&lt;U,E&gt;</code>.   ‚Äî    (error result),  <code>and_then</code>   . <code>and_then</code>      <code>then</code>   Javascript.</p><br>
<p>      ,   ?     <code>map_err</code>,      .</p><br>
<pre><code class="go">let post = fetch_post(post_id)
    .map_err(|e| io::Error::new(io::ErrorKind::NotFound, e));</code></pre><br>
<p>  ,         :  ,    ‚Äî   .  <a href="http://deviq.com/don-t-repeat-yourself/">DRY</a>   -      .   :  Rust-        .      -   (recovery code)       .</p><br>
<p><code>Result&lt;T,E&gt;</code>    ¬´  ¬ª ,   <code>Option&lt;T&gt;</code>,     enum  .    ,      Go.     Go   .  Rust      <code>T</code>  <code>E</code> (,        ),    ,    <code>Ok(value)</code>  <code>Err(err)</code>.</p><br>
<p> enum‚Äô Rust  ,    <code>Result&lt;T,E&gt;</code>  ,          .     Result-  Go? ,      Go (. .    ),        .   ,    :  Go,  ,      (   Go ‚Äî    ).      .     ,        .</p><br>
<h3 id="manipulirovanie-spiskom-nepraktichno">  </h3><br>
<p>   Go   :         ,      .  Rust      :</p><br>
<pre><code class="rust">fn map&lt;A, B, F&gt;(callback: F, xs: &amp;[A]) -&gt; Vec&lt;B&gt;
    where F: Fn(&amp;A) -&gt; B {</code></pre><br>
<p>       (input slice),    ,           .  ,    (iterator types) Rust   ,     .       .     ,  ,         .       ,        . </p><br>
<p> Go    .     ,     ,       (top-type) <code>[]interface{}</code>. :</p><br>
<pre><code class="go">func Map(callback func(x interface{}) interface{}, xs []interface{}) []interface{} {
    ys := make([]interface{}, len(xs))
    for i, x := range xs {
        ys[i] = f(x)
    }
    return ys
}</code></pre><br>
<p>       .        (, <code>[]int</code>)  (type-compatible)  <code>[]interface{}</code>.       Map   <code>[]int</code>.       <code>[]interface{}</code>,     for     <code>int</code>.   Map ,        ,      .      <code>Map</code>    ,       (runtime type assertion)    (type switch)   .</p><br>
<p>      (type-compatible)    <code>interface{}</code>.         <code>interface{}</code>,    :</p><br>
<pre><code class="go">func Map(callback interface{}, xs interface{}) interface{}</code></pre><br>
<p>          .       .     ,    API     runtime     ,     .      <a href="http://blog.burntsushi.net/type-parametric-functions-golang/">Writing type parametric functions in Go</a>.   ,         .         ,      .</p><br>
<p>         : <code>Filter</code>, <code>Take</code>, <code>Reduce</code>  . .   ,    ‚Äî    . Go      ,  <code>Map</code>,   ,        Go.   Go   <a href="http://www.cs.kent.ac.uk/people/staff/dat/miranda/whyfp90.pdf">  </a>.</p><br>
<p>,  ,  Go   .     .    Javascript, Python  Ruby    .   ,      .          .  ,  Javascript         -,    . Go    :    ,      ,      .</p><br>
<p> ‚Äî      ‚Äî   ¬´¬ª  .           ¬´     -        ¬ª.    ,    ,    ,    ,     the. (  . ‚Äî <em>. .</em>)</p><br>
<p> Go      (list abstractions).   Go:</p><br>
<pre><code class="go">//      `count`
func LatestTitles(docs []Document, count int) []string {
    var latest []string
    for _, doc := range docs {
        if len(latest) &gt;= count {
            return latest
        }
        if !doc.IsArchived {
            latest = append(latest, doc.Title)
        }
    }
    return latest
}</code></pre><br>
<p>      ,   , -    ,    .  ,   <code>filter</code>, <code>map</code>, <code>take</code>.   Rust:</p><br>
<pre><code class="rust">fn latest_titles(docs: &amp;[Document], count: usize) -&gt; Vec&lt;&amp;str&gt; {
    docs.iter()
        .filter(|doc| !doc.is_archived)
        .map(|doc| doc.title.as_str())
        .take(count)
        .collect()
}</code></pre><br>
<p>Rust    ,   .    Rust .    ,     . ,    .     .</p><br>
<p>        Go.  : ¬´, ,      ¬ª.    ,       . Rust   ¬´¬ª     (lazily-evaluated) .     <code>filter</code>, <code>map</code>, <code>take</code>             .      <code>filter</code>  <code>map</code>     .   ,  <code>take(count)</code>,      .  , <code>iter</code>, <code>filter</code>, <code>map</code>, <code>take</code>  <code>collect</code> ‚Äî  ,         .  , ,   <code>filter</code>  <code>map</code> .  ¬´ Rust¬ª     <a href="https://rust-lang.github.io/book/ch13-04-performance.html">    </a>.</p><br>
<p>,       ,   .  ,      ‚Äî      .        <code>map</code>,  , : ¬´          (mapping function)¬ª.          .         ,    <code>for</code>.</p><br>
<p>      (parallel-fetch).   Go,        :</p><br>
<pre><code class="go">func (client docClient) FetchDocuments(ids []int64) ([]models.Document, error) {
    docs := make([]models.Document, len(ids))
    var err error

    var wg sync.WaitGroup
    wg.Add(len(ids))

    for i, id := range ids {
        go func(i int, id int64) {
            doc, e := client.FetchDocument(id)
            if e != nil {
                err = e
            } else {
                docs[i] = *doc
            }
            wg.Done()
        }(i, id)
    }

    wg.Wait()

    return docs, err
}</code></pre><br>
<p> <code>WaitGroup</code>,   ,   ,     ‚Äî        ,      - .</p><br>
<p>  ,              <code>docs</code>. ,       <code>docs</code>             .     ,          .             (<code>models.Document</code>, <code>error</code>),    Go     ‚Ä¶</p><br>
<p>Rust    ,   ,      ,        (thread-unsafe)  .      ,    ,   .      ,  Rust      (concurrency)   .</p><br>
<p>  Go    Rust,   <a href="https://aturon.github.io/blog/2016/08/11/futures/">futures</a>:</p><br>
<pre><code class="rust">fn fetch_documents(ids: &amp;[i64]) -&gt; Result&lt;Vec&lt;Document&gt;, io::Error&gt; {
    let results = ids.iter()
        .map(|&amp;id| fetch_document_future(id));
    future::join_all(results).wait()
}

//  `fetch_document_future` ‚Äî   .</code></pre><br>
<p> Rust   ,   Go:     ,     .      ,        .   ,   Rust  ,         .  , Rust   ,    ,  Go     .</p><br>
<p>  :  <code>map</code>  ,           .       .</p><br>
<p> Rust ,  <code>fetch_document</code>  <code>Future</code>.  <code>future::join_all</code>   <code>Future</code>.  Future      Javascript:      .            Future,     <code>wait</code>   .     ,    Go,  ,  Future  Rust      .</p><br>
<p>Future    <code>Stream</code>           -.  ,   <code>Stream</code>       .</p><br>
<h3 id="storonnie-biblioteki--grazhdane-vtorogo-sorta">  ‚Äî   </h3><br>
<p> Go  ¬´¬ª  <code>make</code>. ,       ,     .       Go,      .      ,     ,  (map)  . <code>make</code>       ,      . ,          :</p><br>
<pre><code class="go">mySlice := make([]int, 16, 32)</code></pre><br>
<p>           .   ,        .</p><br>
<p>,       (overload) <code>make</code>,          .      .</p><br>
<p>    <code>range</code>.     ,        ,    :</p><br>
<pre><code class="go">for idx, value := range values { /* ... */ }  // `range`    
for idx := range values { /* ... */ }  //      </code></pre><br>
<p>  , <code>range</code>        .        .                   .         .<br>
     ,           <code>==</code>, <code>&gt;</code>,  . .</p><br>
<p>,       .       Go. ,           ,    (collection types)  .</p><br>
<p>Rust     .   ,       , Rust  ,   .    Rust      ,      .</p><br>
<p> , <code>make</code>  <code>range</code> ‚Äî      ,     Rust: ,       .   Rust     :              .      (trait method implementation)     ,    ,      (,   (equality trait)  ,       <code>equals</code>    )       .</p><br>
<p>    <code>make</code>  Rust:</p><br>
<pre><code class="rust">use std::sync::mpsc::{Receiver, Sender, channel};

// `trait`    
trait Make {
    fn make() -&gt; Self;
    fn make_with_capacity(capacity: usize) -&gt; Self;
}

// `impl`        .
//     `Make`    `Vec&lt;T&gt;`.
//     `Vec&lt;T&gt;`.
impl &lt;T&gt; Make for Vec&lt;T&gt; {
    fn make() -&gt; Vec&lt;T&gt; {
        Vec::new()
    }

    fn make_with_capacity(capacity: usize) -&gt; Vec&lt;T&gt; {
        Vec::with_capacity(capacity)
    }
}

// `Sender`  `Receiver` ‚Äî    (channel types) Rust.
//       /.
impl &lt;T&gt; Make for (Sender&lt;T&gt;, Receiver&lt;T&gt;) {
    //   Rust     .          // ,   (  ).    
    //   ,     impl.
    fn make() -&gt; (Sender&lt;T&gt;, Receiver&lt;T&gt;) {
        channel()
    }

    fn make_with_capacity(_: usize) -&gt; (Sender&lt;T&gt;, Receiver&lt;T&gt;) {
        Make::make()
    }
}

#[test]
fn makes_a_vec() {
    //    ,    `make`.
    //   ,   `make`  .
    let mut v: Vec&lt;&amp;str&gt; = Make::make();
    v.push("some string");
    assert_eq!("some string", v[0]);
}

#[test]
fn makes_a_sized_vec() {
    let v: Vec&lt;isize&gt; = Make::make_with_capacity(4);
    assert_eq!(4, v.capacity());
}

#[test]
fn makes_a_channel() {
    //      ,    .
    let (sender, receiver) = Make::make();
    let msg    = "hello";
    let _      = sender.send(msg);
    let result = receiver.recv().expect("a successfully received value");
    assert_eq!(msg, result);
}</code></pre><br>
<p>     .  :         (crate),     . ( ‚Äî   Rust.)     Rust     <code>make</code>,          .</p><br>
<p>   <code>make</code>  <code>make_with_capacity</code>    ,   Rust     (method overloading).  Go    .</p><br>
<h2 id="zloy"></h2><br>
<p>   Go     .  -   ,         ¬´¬ª.</p><br>
<h3 id="otsutstvie-markirovannyh-obedineniy-ogranichennoe-sopostavlenie-s-obrazcom">  ,    </h3><br>
<p>Scala     . Scala     (tagged union)      .        :       ,      .</p><br>
<p>Rust       enum:</p><br>
<pre><code class="rust">use std::sync::mpsc::{Receiver, Sender, channel};
use std::thread;

//    ,     .
//  ,        enum, 
//     .
#[derive(Clone, Copy, Debug)]
pub enum CounterInstruction {
    Increment(isize),  // `isize` ‚Äî  ,   platform word size
    Reset,
    Terminate,
}

pub type CounterResponse = isize;

use self::CounterInstruction::*;

pub fn new_counter() -&gt; (Sender&lt;CounterInstruction&gt;, Receiver&lt;CounterResponse&gt;) {
    //       /
    let (instr_tx, instr_rx) = channel::&lt;CounterInstruction&gt;();
    let (resp_tx,  resp_rx)  = channel::&lt;CounterResponse&gt;();

    //      
    thread::spawn(move || {
        let mut count: isize = 0;

        //   ,  `recv()`   `Err`
        //  `Ok`,    .
        while let Ok(instr) = instr_rx.recv() {

            //  ,     
            //     .    `enum`  (sealed),
            //      .
            //    runtime-    
            //  ,      .
            match instr {
                Increment(amount) =&gt; count += amount,
                Reset             =&gt; count = 0,
                Terminate         =&gt; return
            }

            // `send`  `Result`,      - 
            //  .        `_`,
            //   .
            let _ = resp_tx.send(count);
        };

    });

    //      
    (instr_tx, resp_rx)
}

#[test]
fn runs_a_counter() {
    let (tx, rx) = new_counter();
    let _ = tx.send(Increment(1));
    let _ = tx.send(Increment(1));
    let _ = tx.send(Terminate);

    let mut latest_count = 0;
    while let Ok(resp) = rx.recv() {
        latest_count = resp
    }

    assert_eq!(2, latest_count);
}</code></pre><br>
<p>Rust      .       <code>Drop</code>.     ,    -   (cleanup code)       .   ,     ,  <code>resp_tx</code>        .</p><br>
<p>          :</p><br>
<pre><code class="rust">match instr {
    Increment(amount) =&gt; count += amount,
    Reset             =&gt; count = 0,
    Terminate         =&gt; return
}</code></pre><br>
<p>   <code>instr</code>,   <code>CounterInstruction</code>.  CounterInstruction   ;        <code>match</code>  ,      .</p><br>
<p> Go   ,    .     Go  :</p><br>
<pre><code class="go">switch instr := &lt;-instrChan.(type) {
    case Increment:
        count += Increment.Amount
    case Reset:
        count = 0
    case Terminate:
        return
    default:
        panic("received an unexpected message!")
}</code></pre><br>
<p>     .    <strong></strong>   .  Rust        ,    ,     .    ,  ,    ,     ,     ,    .   Rust-    ,            ,        .</p><br>
<p> Go    ,      .         ,     ,   .   Go    (sealed):    ,  ,     ,  ,        .       (      )    ,      .</p><br>
<h3 id="dinamicheskaya-tipizaciya"> </h3><br>
<p> Go     .    <code>interface{}</code>,         .   ,  .         .       ,      (unchecked type casts).     ()   ,     .          ,       .</p><br>
<p>       runtime,        .     100%- :   ,          (code path)       (type error).</p><br>
<p>  ,     ,      ,      .  Rust      ,     (resolves types)    .     enum‚Äô      .      ,  enum‚Äô .       .</p><br>
<p>  :</p><br>
<ul>
<li> <code>unsafe</code>,     Rust    .        .  <code>unsafe</code>    ,     .        <code>unsafe</code>. <a href="https://alex-ozdemir.github.io/rust/unsafe/unsafe-in-rust-syntactic-patterns/"> </a>    .</li>
<li>Rust  <a href="https://doc.rust-lang.org/book/trait-objects.html">-</a>.       (resolve)    .      ,     . -        Go,   ,  -     <code>nil</code>.       ,         -,     ,       ,  ,   .</li>
</ul><br>
<h3 id="dinamicheskaya-dispetcherizaciya-izobretenie-kolesa"> ,  </h3><br>
<p>  Rust    (resolve)     .  ,  Rust        .    ,  ‚Äî  <a href="https://doc.rust-lang.org/book/trait-objects.html">-</a>,   ,      Go.    ,    Rust   -.      Rust      .         .       ¬´ Rust¬ª: <a href="https://doc.rust-lang.org/book/traits.html"></a>, <a href="https://doc.rust-lang.org/book/trait-objects.html">-</a>.</p><br>
<p> Go        .  ,          runtime (runtime reflection),    .</p><br>
<p>       Rust   .         (borrow-checking).  Haskell      10   Go.   Haskell   ,   Rust  Go. (  Rust ‚Äî     (<a href="http://learnyouahaskell.com/types-and-typeclasses">type classes</a>)  Haskell.)</p><br>
<p> Go               .  ,      (composition over inheritance)     ,          .        . ,   Go,    .</p><br>
<h3 id="otsutstvie-kortezhey-pervogo-klassa">   </h3><br>
<p>Go    .   (   Rust)        ,  ¬´¬ª.      ,        .    Go     .</p><br>
<p>         <code>Make</code>    <code>new_counter</code>.   :</p><br>
<pre><code class="go">//  
// (`isize` ‚Äî  ,  platform word size)
fn min_and_max(xs: &amp;[isize]) -&gt; (isize, isize) {
    let init = (xs[0], xs[0]);
    xs.iter()
        .fold(init, |(min, max), &amp;x| (cmp::min(min, x), cmp::max(max, x)))
}

#[test]
fn consume_tuple() {
    let xs = vec![1, 2, 3, 4, 5];
    let (min, max) = min_and_max(&amp;xs); //      
    assert_eq!(1, min);
    assert_eq!(5, max);
}</code></pre><br>
<p>-    Go         . ,     ,       :</p><br>
<pre><code class="go">// 
results := make(chan (*models.Document, error))</code></pre><br>
<p>  ,       <code>struct</code>,     <code>interface{}</code>     .                     .</p><br>
<p>      Go ‚Äî           ,       .         Go   <code>and_then</code>  Rust.</p><br>
<h3 id="nehvatka-vysokourovnevogo-parallelizma-i-sredstv-mnogopotochnogo-programmirovaniya">      </h3><br>
<p>  <a href="https://gist.github.com/kachayev/21e7fe149bc5ae0bd878">  </a>        Go.   ¬´   ¬ª    ,  Go        . </p><br>
<p> <a href="https://habrahabr.ru/users/kachayev/" class="user_link">kachayev</a> ,     .         .</p><br>
<p>         Rust,  ,     -.  <a href="https://aturon.github.io/blog/2016/08/11/futures/">futures</a>        - <a href="https://tokio.rs/">Tokio</a>.   -     .       ¬´<a href="http://chimera.labs.oreilly.com/books/1230000000929">     Haskell</a>¬ª:</p><br>
<blockquote>  ,       ( )   .  ‚Äî             ,  .<br>
<br>
 ‚Äî    ,       (multiple threads of control).     .    ,     .        ,    .              .</blockquote><p>      Go  .  Rust   ,        .</p><br>
<p>      ,      Map-Reduce.       (list abstractions).  Rust   Map-Reduce       <a href="https://github.com/nikomatsakis/rayon">Rayon</a>:</p><br>
<pre><code class="rust">//   `par_iter`   .
// `par_iter` ‚Äî   Rayon,  Rayon  
//       (standard slice types).
use rayon::prelude::*;

pub fn average_response_time(logs: &amp;[LogEntry]) -&gt; usize {
    let total = logs.par_iter()
        .map(|ref entry| entry.end_time - entry.start_time)
        .sum();
    total / logs.len()
}</code></pre><br>
<p>     <code>map</code>,       (job queues),     (worker pool).    <code>map</code>  .      ,   ,      .      ,       . , Rayon      (batches),                <code>map</code>. (    ‚Äî 5000 ,     .)  <code>sum</code> (   ‚Äî  Reduce)    Rayon.  ,           (worker threads).</p><br>
<p>             .          .        .</p><br>
<h2 id="zaklyuchenie"></h2><br>
<p>  Go 2.0    ? .         .   ,  Go      ,    nil,     .     Rust   .       (receiver-less methods). , ,         Go. </p><br>
<p>     Go   .    ,   .     ,    .   Go,       ,          .</p><br>
<p>      ,        ,   Rust:     ,   Go,    ,      ¬´¬ª.</p><br>
<p>Javascript   ,   Go,      (  ).    Flow  Typescript         Go.  ,  ,   Javascript  Flow.</p><br>
<p>Erlang  Scala   ,   Go.        .</p><br>
<p>Clojure   ,     !            . Clojure    .</p><br>
<p> Haskell  ,       .        .  Haskell      ¬´¬ª.</p><br>
<p>     ,    .  Go ‚Äî      ‚Äî     .   ,              .      ,         . ,   .</p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325046/">https://habr.com/ru/post/325046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325032/index.html">How shops lure customers: electronic price tags</a></li>
<li><a href="../325034/index.html">IL2CPP: Garbage Collector Integration</a></li>
<li><a href="../325036/index.html">Regular expression search with suffix array</a></li>
<li><a href="../325040/index.html">Good trigger, bad trigger: how we monitor hundreds of servers around the world</a></li>
<li><a href="../325042/index.html">Welcome to Go meetup April 14</a></li>
<li><a href="../325050/index.html">Digest AI Cup. Five strategies for Code Wizards 2016</a></li>
<li><a href="../325052/index.html">Technocup: results of the final round and task analysis</a></li>
<li><a href="../325054/index.html">25 interesting books for designers in the public domain</a></li>
<li><a href="../325056/index.html">‚ÄúIt is expensive for us‚Äù - retail about acquiring</a></li>
<li><a href="../325058/index.html">User Interface Cards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>