<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GitLab for Continuous Delivery project on InterSystems technology</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I would like to tell you about the organization of Continuous Integration / Continuous Delivery processes that automate the assembly, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GitLab for Continuous Delivery project on InterSystems technology</h1><div class="post__text post__text-html js-mediator-article"><p>  In this article I would like to tell you about the organization of <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BF%25D1%2580%25D0%25B5%25D1%2580%25D1%258B%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">Continuous Integration</a> / Continuous Delivery processes that automate the assembly, testing and delivery of applications on InterSystems platforms. </p><br><p>  Consider topics such as: </p><br><ul><li>  Git 101 </li><li>  Development Methodologies (Git flow) <br><ul><li>  Github flow </li><li>  Gitlab flow </li></ul></li><li>  Gitlab </li><li>  Gitlab ci <a name="habracut"></a></li></ul><br><h2 id="git-101">  Git 101 </h2><br><p>  Despite the fact that the main topic is CD, <a href="https://ru.wikipedia.org/wiki/Git">Git</a> , or rather a number of fundamental principles underlying it, had a great influence on software development processes, so we start with a brief description of the basic terms of Git. </p><br><p>  Git is a version control and management system based on ideas such as: </p><br><ul><li>  Non-linear development - despite the fact that the versions of the application come out sequentially, the development of each version is carried out in parallel by several developers who can simultaneously edit the same parts of the application. </li><li>  Distributed development - the developer is independent of the central server and can develop in his local environment without any problems. </li><li>  Merging - the implementation of the previous two points leads to the fact that there are several correct versions of the project at the same time and often you need to combine them into a single version of the truth. </li></ul><br><p>  Git was not the first version control system in which these ideas were implemented, however Git popularized these ideas and greatly simplified their practical application. </p><br><h3 id="repozitoriy-repository">  Repository (Repository) </h3><br><p>  The place where any data is stored and maintained. </p><br><ul><li>  ‚ÄúPhysically‚Äù - folder in OS </li><li>  Stores files and folders </li><li>  Keeps history of their changes. </li></ul><br><p>  Local repository - a repository located on the local computer <br>  Remote repository - a repository located on a remote server </p><br><h3 id="kommit-commit">  Commit </h3><br><p>  Recorded state of the repository. <br>  Stores the difference (Diff) from any other commit called parent. </p><br><p>  Parents can be: </p><br><ul><li>  0 - at the first commit. </li><li>  1 - as a rule it happens that way. </li><li>  2 - to merge changes. </li><li>  3+ - to merge changes (but do not do this). </li></ul><br><h3 id="vetka-branch">  Branch (Branch) </h3><br><p> Pointer to a commit. <br>  You can always look at his story before the first commit.  For example, the <code>master</code> branch: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ca3/325/809/ca3325809da0c5c8f03dfb48a12ec738.png" alt="Branch"></p><br><h4 id="derevo-kommitov">  Commit tree </h4><br><p>  Commits form trees - a graphical representation of the repository.  Consider the simplest linear option when three more commits were added to the two existing commits from the image above: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1b4/5a0/abc/1b45a0abc9af877e60e25556078d6d94.png" alt="branch"></p><br><p>  Now the tree example is more complicated: two developers work at the same time and, in order not to interfere with each other, each of them works in his own branch.  It looks like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9bf/ca6/e00/9bfca6e00370cc1b32bde44bac7d37f9.png" alt="branch"></p><br><p>  After a while, they need to merge the changes; for this, there are <strong>merge</strong> requests ‚Äî requests to merge two states of the repository into one new state.  In our case, the request to merge the <code>develop</code> branch into the <code>master</code> branch.  After the request has been reviewed and approved and the merge occurred, the repository looks like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/672/d8a/ec9/672d8aec9b5d8e54b88835d7db1c0d37.png" alt="branch"></p><br><p>  After that, the development continues: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/abc/442/d6b/abc442d6b3d67fd78922be8a5263f582.png" alt="branch"></p><br><h3 id="vyvody---git-101">  Conclusions - Git 101 </h3><br><ul><li>  Git is a version control system. </li><li>  Repository (Repository) - a place where any data is stored and maintained. </li><li>  Commit (Commit) - fixed state of the repository. </li><li>  Branch (Branch) - a pointer to commit. </li><li>  Merge request (Pull request or Merge request) - a request to merge two repository states. </li></ul><br><h2 id="metodologii-razrabotki-git-flows">  Development Methodologies (Git flows) </h2><br><p>  Git-based development methodology is a series of software development approaches using Git as the basis for development.  There are many development methodologies, consider two of them: </p><br><ul><li>  Github flow </li><li>  Gitlab flow </li></ul><br><h3 id="github-flow">  Github flow </h3><br><p>  GitHub flow is probably one of the easiest Git based development methodologies.  Here she is: </p><br><ul><li>  For each new feature we create a new branch, called the feature branch. </li><li>  Changes commited to a new thread. </li><li>  After the changes are committed, a merge request is sent </li><li>  The merge request is being discussed and finalized. </li><li>  Merge request approved </li></ul><br><p>  In addition, there are a number of rules: </p><br><ul><li>  The <code>master</code> branch is always in a healthy state. </li><li>  There is no development in the <code>master</code> branch </li><li>  Development is conducted in separate branches </li><li>  Branch <code>master</code> == industrial environment </li><li>  The industrial environment is updated with every change in the <code>master</code> branch. </li></ul><br><p>  The environment is the configured resource where your application code is executed.  It can be a server, a virtual machine, or even a container. </p><br><p>  Here's what it looks like: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e61/0e0/e4c/e610e0e4c015fd64fd16b2069cb715e9.png" alt="Github"></p><br><p>  In detail about GitHub flow on Habr√© already <a href="https://habrahabr.ru/post/346066/">written more</a> than <a href="https://habrahabr.ru/post/189046/">once</a> . </p><br><h3 id="gitlab-flow">  Gitlab flow </h3><br><p>  If you are not ready to automatically update the code on an industrial environment, GitLab flow provides a unification of GitHub flow with several environments.  Here's how it works: development is conducted in the same way as GitHub flow ‚Äî in separate branches, which also merge into <code>master</code> , but the contents of the <code>master</code> branch are deployed on a test server.  Additionally, you have branches of environments whose contents match the contents of your environments.  There are usually three environments, but they can be more or less depending on your requirements: </p><br><ul><li>  Test environment == <code>master</code> branch </li><li>  Experienced environment == <code>preprod</code> branch </li><li>  Industrial environment == <code>prod</code> branch </li></ul><br><p>  The development process looks like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c01/f51/554/c01f515545da0b93dbbb9724f47b7461.png"></p><br><p>  In detail about GitLab flow on Habr√© too <a href="https://habrahabr.ru/company/softmart/blog/316686/">wrote</a> . </p><br><h2 id="vyvody---metodologii-razrabotki-git-flows">  Conclusions - Development Methodologies (Git flows) </h2><br><p>  There are a number of development methodologies based on Git - from simple to complex.  Choose a methodology that is not over complicated on the one hand, but on the other provides an adequate level of control over the status of your project. </p><br><h2 id="gitlab-workflow">  Gitlab workflow </h2><br><p>  GitLab Workflow is a software development methodology that covers not only the development stages but the entire product life cycle from idea to user feedback.  Here is what it looks like: </p><br><ul><li>  Idea: new functionality starts with an idea. </li><li>  Task (Issue): the most effective way to discuss an idea is to create a task for it.  Other developers will help improve the idea, suggest ways to implement it. </li><li>  Plan: as soon as the discussion of the problem is completed, it is time to write the code.  But first we need to prioritize and organize our workflow.  For this there are stages, kanban board, date of execution and responsible. </li><li>  Code: now everything is ready for writing code. </li><li>  Commit: Once we are satisfied with our code, we can move it to commit.  GitLab flow has been described in detail above. </li><li>  Test: run scripts using GitLab CI to compile and test your application. </li><li>  Review: as soon as the code works, tests and assemblies are successful, you can make a review of the code. </li><li>  Trial operation: now it‚Äôs time to deploy a new version of the application in a trial environment to check if everything is working or whether more changes are needed. </li><li>  Industrial exploitation: it's time to deploy in an industrial environment </li><li>  Feedback: what else needs improvement. </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/799/f77/2ea/799f772eaa38ea940edad286036fdf5a.png"></p><br><p>  Each stage is described in detail on <a href="https://about.gitlab.com/2016/10/25/gitlab-workflow-an-overview/">the GitLab website</a> ; I will <a href="https://about.gitlab.com/2016/10/25/gitlab-workflow-an-overview/">limit</a> myself to a description of several stages. </p><br><h3 id="zadachi-i-planirovanie">  Tasks and planning </h3><br><p>  The initial stages of GitLab Workflow are focused on the task ‚Äî a new functionality, an error, or some other specific amount of work.  The task has several goals, such as: </p><br><ul><li>  Management: the task has the creation and execution dates, responsible, time costs, priority, etc., to track the solution to the problem. </li><li>  Administrative: the problem is part of the development phase, as well as kanban boards, which allows you to create a work plan and monitor its implementation. </li><li>  Development: in the task, you can discuss its solutions, commits, branches, merge requests and other tasks can also be associated with the task. </li></ul><br><p>  The planning phase allows you to group tasks according to their priority, stage, status. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/876/f26/8ec/876f268eca4ddf1d1701a76393723370.gif"></p><br><p>  We discussed the development above, follow any git development methodology.  After we developed our new functionality and merged it into the <code>master</code> branch - what next? </p><br><h2 id="continuous-delivery-nepreryvnaya-dostavka">  Continuous Delivery (Continuous Delivery) </h2><br><p>  Continuous Delivery is a software development approach in which teams develop software in short sprints, ensuring that a new version of the application can be released at any time.  This approach automates the assembly, testing and delivery of software.  This approach helps to reduce the costs and risks of making changes, allowing you to get fast incremental updates for industrial applications.  For continuous delivery, it is important to set up a simple and reproducible delivery process. </p><br><h3 id="nepreryvnaya-dostavka-v-gitlab">  Continuous Delivery to GitLab </h3><br><p>  In GitLab, continuous delivery configurations are defined separately for each repository and stored in the YAML configuration file in the repository root. </p><br><ul><li>  The continuous delivery configuration is a series of consecutive steps. </li><li>  Each stage has one or more scripts that run in parallel. </li></ul><br><h4 id="skript">  Script </h4><br><p>  Defines one action and what conditions must be met to trigger it: </p><br><ul><li>  What to do (execute the command OS, run the container)? </li><li>  When to run the script: <br><ul><li>  Trigger (for example, commit to <code>master</code> branch)? </li><li>  Does the script run if the previous steps failed (default is not)? </li><li>  Run manually or automatically? </li></ul></li><li>  In what environment to run the script? </li><li>  What artifacts are saved after execution (are they loaded from the environment into GitLab for quick access)? </li></ul><br><p>  <strong>The environment</strong> is a configured server or container in which you can run scripts. </p><br><p>  <strong>Runner</strong> is a service that runs scripts in a specific environment.  Connected to GitLab and execute scripts as needed. </p><br><p>  Runner can be deployed on a server, in a container, or even on a local development computer. </p><br><h4 id="kak-proishodit-nepreryvnaya-dostavka">  How is the continuous delivery? </h4><br><ul><li>  A new commit is loaded into the repository. </li><li>  GitLab checks the configuration of continuous delivery. </li><li>  The configuration of continuous delivery contains all possible scripts for all cases, so they are filtered to a set of scripts that must be run for this new commit (for example, the script for the <code>master</code> branch works only in the case of a commit to the <code>master</code> branch).  This set is called the pipeline. </li><li>  The launch is performed in the appropriate environment, the execution results are saved and available on GitLab. </li></ul><br><p>  Here is an example of a launch: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/8d6/bc1/f27/8d6bc1f27aab5d4d9bb75770fcdf87b3.png"></p><br><p>  It consists of four stages performed sequentially. </p><br><ul><li>  Load loads the code on the server </li><li>  Test runs unit tests. </li><li>  Package consists of two scripts executed in parallel: <br><ul><li>  Client build </li><li>  Export server code to one "xml" (mainly for informational purposes) </li></ul></li><li>  Deploy moves the assembled client to the web server directory. </li></ul><br><p>  As we see, each script was executed successfully, if one of the scripts failed, the following scripts would not be executed: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6a2/9d8/4f0/6a29d84f095d0b8dab9bce9204544d6f.png"></p><br><p>  If you open the script, you can see why it ended with an error: </p><br><div class="spoiler">  <b class="spoiler_title">Script execution log</b> <div class="spoiler_text"><pre> <code class="hljs sql">Running <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> gitlab-runner <span class="hljs-number"><span class="hljs-number">10.4</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span> (<span class="hljs-number"><span class="hljs-number">857480</span></span>b6) <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> runner (ab34a8c5) <span class="hljs-keyword"><span class="hljs-keyword">Using</span></span> Shell executor... Running <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> gitlab-test... Fetching changes... Removing diff.xml Removing full.xml Removing index.html Removing tests.html <span class="hljs-keyword"><span class="hljs-keyword">HEAD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">now</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> a5bf3e8 <span class="hljs-keyword"><span class="hljs-keyword">Merge</span></span> branch <span class="hljs-string"><span class="hljs-string">'4-versiya-1-0'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-string"><span class="hljs-string">'master'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">From</span></span> <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://gitlab.eduard.win/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/testProject * [<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> branch] <span class="hljs-number"><span class="hljs-number">5</span></span>-versiya<span class="hljs-number"><span class="hljs-number">-1</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> -&gt; origin/<span class="hljs-number"><span class="hljs-number">5</span></span>-versiya<span class="hljs-number"><span class="hljs-number">-1</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> a5bf3e8.<span class="hljs-number"><span class="hljs-number">.442</span></span>a4db <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> -&gt; origin/<span class="hljs-keyword"><span class="hljs-keyword">master</span></span> d28295a.<span class="hljs-number"><span class="hljs-number">.42</span></span>a10aa preprod -&gt; origin/preprod <span class="hljs-number"><span class="hljs-number">3</span></span>ac4b21.<span class="hljs-number"><span class="hljs-number">.7</span></span>edf7f4 prod -&gt; origin/prod Checking <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-number"><span class="hljs-number">442</span></span>a4db1 <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> master... Skipping Git submodules setup $ csession ensemble <span class="hljs-string"><span class="hljs-string">"##class(isc.git.GitLab).loadDiff()"</span></span> [<span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-06</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19.188</span></span>] Importing dir /home/gitlab-runner/builds/ab34a8c5/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/testProject/ [<span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-06</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19.188</span></span>] Loading diff <span class="hljs-keyword"><span class="hljs-keyword">between</span></span> a5bf3e8596d842c5cc3da7819409ed81e62c31e3 <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">442</span></span>a4db170aa58f2129e5889a4bb79261aa0cad0 [<span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-06</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19.192</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span> modified <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>=$lb(<span class="hljs-string"><span class="hljs-string">"MyApp/Info.cls"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> started <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> /home/gitlab-runner/builds/ab34a8c5/<span class="hljs-number"><span class="hljs-number">0</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>/testProject/MyApp/Info.cls <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> udl <span class="hljs-keyword"><span class="hljs-keyword">Load</span></span> finished successfully. [<span class="hljs-number"><span class="hljs-number">2018</span></span><span class="hljs-number"><span class="hljs-number">-03</span></span><span class="hljs-number"><span class="hljs-number">-06</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19.241</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">Variable</span></span> items <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>=<span class="hljs-string"><span class="hljs-string">"MyApp.Info.cls"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span>(<span class="hljs-string"><span class="hljs-string">"MyApp.Info.cls"</span></span>)=<span class="hljs-string"><span class="hljs-string">""</span></span> Compilation started <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-number"><span class="hljs-number">03</span></span>/<span class="hljs-number"><span class="hljs-number">06</span></span>/<span class="hljs-number"><span class="hljs-number">2018</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>:<span class="hljs-number"><span class="hljs-number">19</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> qualifiers <span class="hljs-string"><span class="hljs-string">'cuk /checkuptodate=expandedonly'</span></span> Compiling <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MyApp.Info Compiling routine MyApp.Info<span class="hljs-number"><span class="hljs-number">.1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ERROR</span></span>: MyApp.Info.cls(<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>+<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">#1003: Expected space : '}' : Offset:14 [zversion+1^MyApp.Info.1] TEXT: quit, "1.0" } Detected 1 errors during compilation in 0.010s. [2018-03-06 13:58:19.252] ERROR #5475: Error compiling routine: MyApp.Info.1. Errors: ERROR: MyApp.Info.cls(version+2) #1003: Expected space : '}' : Offset:14 [zversion+1^MyApp.Info.1] &gt; ERROR #5030: An error occurred while compiling class 'MyApp.Info' ERROR: Job failed: exit status 1</span></span></code> </pre> </div></div><br><p>  A compilation error caused the script to fail. </p><br><p>  Let's move from theory to practice. </p><br><h2 id="ustanovka-gitlab">  Install GitLab </h2><br><p>  We will install GitLab on our own server.  However, you can use GitLab.com.  There are many ways to install GitLab: from source, from a package, in a container.  Choose the one you like and follow <a href="https://about.gitlab.com/installation/">the installation instructions</a> . </p><br><p>  Requirements: </p><br><ul><li>  A separate server - GitLab is a fairly resource-intensive web application, so it‚Äôs best to keep it on a separate server (4 Gb RAM, 2 CPUs). </li><li>  OS Linux. </li><li>  (Optional but recommended) Domain - required for security and launch pages. </li></ul><br><h3 id="konfiguraciya">  Configuration </h3><br><p>  First of all, set up <a href="https://docs.gitlab.com/omnibus/settings/smtp.html">email notifications</a> . </p><br><p>  Next, I recommend installing Pages.  As mentioned above, artifacts from running scripts can be uploaded to GitLab.  Users can download them, but it is often useful to open them directly in the browser and for this you need to install the pages. </p><br><p>  Why do we need pages: </p><br><ul><li>  For a wiki or a set of static pages associated with the project. </li><li>  To view html artifacts. </li><li>  <a href="https://docs.gitlab.com/ce/user/project/pages/">And a number of other reasons</a> . </li></ul><br><p>  Since automatic redirection can be added to the HTML when the page is loaded, you can direct the user to the page with the results of unit tests. </p><br><div class="spoiler">  <b class="spoiler_title">HTML Generation Code</b> <div class="spoiler_text"><pre> <code class="hljs kotlin">ClassMethod writeTestHTML() { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> text = ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%Dictionary.XDataDefinition).IDKEYOpen($classname(), <span class="hljs-string"><span class="hljs-string">"html"</span></span>).Data.Read() <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> text = $replace(text, <span class="hljs-string"><span class="hljs-string">"!!!"</span></span>, ..getURL()) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> file = ##<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>(%Stream.FileCharacter).%New() <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> name = <span class="hljs-string"><span class="hljs-string">"tests.html"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> file.LinkToFile(name) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> file.Write(text) quit file.%Save() } ClassMethod getURL() { <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> url = <span class="hljs-string"><span class="hljs-string">"http://host:57772"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> url = url _ $system.CSP.GetDefaultApp(<span class="hljs-string"><span class="hljs-string">"%SYS"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> url = url_<span class="hljs-string"><span class="hljs-string">"/%25UnitTest.Portal.Indices.cls?Index="</span></span>_ $g(^UnitTest.Result, <span class="hljs-number"><span class="hljs-number">1</span></span>) _ <span class="hljs-string"><span class="hljs-string">"&amp;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$NAMESPACE</span></span></span><span class="hljs-string">="</span></span> _ $zconvert($namespace,<span class="hljs-string"><span class="hljs-string">"O"</span></span>,<span class="hljs-string"><span class="hljs-string">"URL"</span></span>) quit url } XData html { &lt;html lang=<span class="hljs-string"><span class="hljs-string">"en-US"</span></span>&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>/&gt; &lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"refresh"</span></span> content=<span class="hljs-string"><span class="hljs-string">"0; url=!!!"</span></span>/&gt; &lt;script type=<span class="hljs-string"><span class="hljs-string">"text/javascript"</span></span>&gt;window.location.href = <span class="hljs-string"><span class="hljs-string">"!!!"</span></span>&lt;/script&gt; &lt;/head&gt; &lt;body&gt; If you are not redirected automatically, follow <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &lt;a href=<span class="hljs-string"><span class="hljs-string">'!!!'</span></span>&gt;link to tests&lt;/a&gt;. &lt;/body&gt; &lt;/html&gt; }</code> </pre> </div></div><br><p>  By the way, I ran into a bug when using pages (Error 502 when viewing artifacts) - this is the <a href="https://gitlab.com/gitlab-com/infrastructure/issues/3064">solution</a> . </p><br><h3 id="podklyuchenie-okruzheniy-k-gitlab">  Connecting Environments to GitLab </h3><br><p>  Environments are required to run CD scripts ‚Äî configured servers to run your application.  To begin with, assume that you have a Linux server installed with the InterSystems platform (say, InterSystems IRIS, but everything will work with Cach√© or Ensemble).  To connect the environment with GitLab you need: </p><br><ol><li>  <a href="https://docs.gitlab.com/runner/">Install GitLab runner</a> . </li><li>  <a href="https://docs.gitlab.com/runner/register/index.html">Register the</a> GitLab runner with GitLab. </li><li>  Allow <code>gitlab-runner</code> user to call InterSystems IRIS. </li></ol><br><p>  Important note on installing GitLab runner - DO NOT clone the server after installing GitLab runner.  Results are unpredictable and undesirable. <br>  I'll tell you more about steps 2 and 3. </p><br><h4 id="zaregistrirovat-gitlab-runner-v-gitlab">  Register the GitLab runner with GitLab. </h4><br><p>  After running the command: <code>sudo gitlab-runner register</code> </p><br><p>  Several options will be offered to choose from, and although most of the steps are fairly simple, some of them are worth commenting on: </p><br><ul><li>  Please enter the gitlab-ci token for this runner </li></ul><br><p>  Several tokens are available: for the entire system (available in the administration settings) or for one project (available in the project settings). <br>  When you connect the runner for the CD of a specific project, you need to specify the token of this particular project. </p><br><ul><li>  Please enter the gitlab-ci tags for this runner (comma separated) </li></ul><br><p>  In the CD configuration, you can filter which scripts are executed for environments with specific tags.  Therefore, in the simplest case, specify one tag, which will be the name of the environment. </p><br><ul><li>  Please enter the executor: ssh, docker + machine, docker-ssh + machine, kubernetes, docker, parallels, virtualbox, docker-ssh, shell </li></ul><br><p>  Regardless of whether you use docker, choose a shell to run scripts. </p><br><h4 id="razreshit-polzovatelyu-gitlab-runner-vyzyvat-intersystems-iris">  Allow <code>gitlab-runner</code> user to call InterSystems IRIS. </h4><br><p>  After connecting to GitLab, you need to allow the <code>gitlab-runner</code> user to call InterSystems IRIS.  For this: </p><br><ol><li>  The <code>gitlab-runner</code> user must have rights to call <code>irissession</code> or <code>csession</code> .  To do this, add it to the <code>irisusr</code> group or <code>cacheusr</code> command: <code>usermod -a -G cacheusr gitlab-runner</code> </li><li>  In InterSystems IRIS, <a href="">create a</a> <code>gitlab-runner</code> <a href="">user</a> and grant it permissions to execute CD scripts (write to the database, etc.) </li><li>  <a href="">Enable OS authentication</a> . </li></ol><br><p>  Instead of points 2 and 3, you can use other approaches, such as transferring a user / password, but the option with OS authentication seems to me more preferable. </p><br><h2 id="konfiguraciya-cd">  CD configuration </h2><br><p>  So, let's start writing the configuration of continuous delivery.  First, we describe the environment and the plan. </p><br><h3 id="okruzheniya">  Environments </h3><br><p>  We have several environments and their corresponding branches: </p><br><table><thead><tr><th>  Environment </th><th>  Branch </th><th>  Delivery </th><th>  Who can commit </th><th>  Who can drain </th></tr></thead><tbody><tr><td>  Test </td><td>  master </td><td>  Automatic </td><td>  Developers, Owners </td><td>  Developers, Owners </td></tr><tr><td>  Experienced </td><td>  preprod </td><td>  Automatic </td><td>  No one </td><td>  Owners </td></tr><tr><td>  Industrial </td><td>  prod </td><td>  By pressing a button </td><td>  No one </td><td>  Owners </td></tr></tbody></table><br><h3 id="plan-rabot">  Work plan </h3><br><ol><li>  Task setting, development and automated testing <br><ul><li>  The owner sets the task </li><li>  The developer creates a feature-branch and commits the code to the problem solving there. </li><li>  Developer merges feature branch into master </li><li>  The new code is automatically delivered to the test environment and tested. </li></ul></li><li>  Delivery to an experienced environment <br><ul><li>  The developer creates a request to merge master code into preprod </li><li>  Owner approves of merging code from master into preprod </li><li>  New code is automatically delivered to the expert environment. </li></ul></li><li>  Delivery to the industrial environment <br><ul><li>  The developer (or owner) creates a request to merge code from preprod into prod </li><li>  Owner approves of merging preprod code into prod </li><li>  The owner clicks the "Expand" button </li><li>  The new version of the application takes place in the automatic environment. </li></ul></li></ol><br><p>  The same in graphic form: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/12b/0d8/a83/12b0d8a83cdc968c37b5fd815f5758e7.png"></p><br><h3 id="prilozhenie">  application </h3><br><p>  Our test application consists of two parts: </p><br><ul><li>  InterSystems REST API </li><li>  Client web application (HTML + JS + CSS) </li></ul><br><h3 id="etapy-stages">  Stages </h3><br><p>  From the above plan, we can distinguish the steps that we need to define in our continuous delivery configuration: </p><br><ul><li>  Load loads the code on the server </li><li>  Test runs unit tests. </li><li>  Package collects customer </li><li>  Deploy moves the assembled client to the web server directory. </li></ul><br><p>  Let's start to make a configuration in the <code>.gitlab-ci.yml</code> : </p><br><pre> <code class="hljs sql">stages: - <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> - deploy</code> </pre> <br><h3 id="skripty">  Scripts </h3><br><p>  The next part of the configuration is scripts.  <a href="https://docs.gitlab.com/ee/ci/yaml/README.html">Documentation</a> </p><br><h4 id="load">  Load </h4><br><p>  Let's start with the <code>load server</code> script that loads the server code. </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">server</span></span>: environment: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://test.hostname.com <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>: - <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> tags: - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> stage: <span class="hljs-keyword"><span class="hljs-keyword">load</span></span></code> </pre> <br><p>  What's going on here? </p><br><ul><li>  <code>load server</code> is the name of the script. </li><li>  The following describes the environment in which the script runs. </li><li>  <code>only: master</code> - runs the script only if the new commit is in the <code>master</code> branch. </li><li>  <code>tags: test</code> - sends the script to run in the runner, which has such a tag. </li><li>  <code>stage</code> - determines which stage the script belongs to. </li><li>  <code>script</code> - determines which command to execute.  In this case, the <code>load</code> method of the <code>isc.git.GitLab</code> class is <code>isc.git.GitLab</code> . </li></ul><br><p>  Now you need to create the <code>isc.git.GitLab</code> class.  All entry points to it should look like this: </p><br><pre> <code class="hljs perl">ClassMethod method() { try { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> code halt } catch ex { <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> !,$System.Status.GetErrorText(ex.AsStatus()),! <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> $system.Process.Terminate(, <span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><p>  This method can only be completed in two ways. </p><br><ul><li>  Stop the current process with the <code>halt</code> command, which is considered successful completion of the script. </li><li>  <code>$system.Process.Terminate</code> - and exiting the process with an error, which leads to an error when executing the script. </li></ul><br><p>  Here is the download code: </p><br><pre> <code class="hljs dos">/// <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> a full load /// <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##class(isc.git.GitLab).load() ClassMethod load() { try { <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> = ..getDir() <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ..log("Importing <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> " _ <span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> $system.OBJ.ImportDir(<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span>, ..getExtWildcard(), "c", .errors, <span class="hljs-number"><span class="hljs-number">1</span></span>) throw:$get(errors,<span class="hljs-number"><span class="hljs-number">0</span></span>)'=<span class="hljs-number"><span class="hljs-number">0</span></span> ##class(<span class="hljs-variable"><span class="hljs-variable">%Exception.General).%</span></span>New("Load error") halt } catch ex { write <span class="hljs-variable"><span class="hljs-variable">!,$System.Status.GetErrorText(ex.AsStatus()),!</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> $system.Process.Terminate(, <span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><p>  This method calls two other methods: </p><br><ul><li>  getExtWildcard is a method for getting the list of extensions to be downloaded. </li><li>  getDir is a method for retrieving a repository folder. </li></ul><br><p>  But how can we get a directory with a repository? </p><br><p>  When GitLab executes a script, it defines a series of <a href="https://docs.gitlab.com/ce/ci/variables/README.html">environment variables</a> .  One of them is <code>CI_PROJECT_DIR</code> - the full path to the repository root.  So you can get it in the <code>getDir</code> method: </p><br><pre> <code class="hljs mel">ClassMethod getDir() [ CodeMode = <span class="hljs-keyword"><span class="hljs-keyword">expression</span></span> ] { ##class(%File).NormalizeDirectory($system.Util.GetEnviron(<span class="hljs-string"><span class="hljs-string">"CI_PROJECT_DIR"</span></span>)) }</code> </pre> <br><h4 id="test">  Test </h4><br><p>  Here is the test run script: </p><br><pre> <code class="hljs cmake">tests: environment: name: <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> url: http://<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>.hostname.com only: - master tags: - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> stage: <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> script: csession IRIS <span class="hljs-string"><span class="hljs-string">"##class(isc.git.GitLab).test()"</span></span> artifacts: paths: - tests.html</code> </pre> <br><p>  What changed?  Of course, the name and code of the script, but still added <code>artifacts</code> .  An artifact is a collection of files and folders that are attached to a script after it has been successfully completed.  In our case, after completing the tests, we can generate an HTML page redirecting the user to the test results. </p><br><p>  Note the similarity of the test scripts and downloads.  Parts of scripts, such as environments, the same in all scripts can be separated into separate blocks.  Define the test environment: </p><br><pre> <code class="hljs cmake">.env_test: &amp;env_test environment: name: <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> url: http://<span class="hljs-keyword"><span class="hljs-keyword">test</span></span>.hostname.com only: - master tags: - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span></code> </pre> <br><p>  Now our <code>tests</code> script looks like this: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tests</span></span>: &lt;&lt;: *<span class="hljs-selector-tag"><span class="hljs-selector-tag">env_test</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">script</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">csession</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">IRIS</span></span> "#<span class="hljs-selector-id"><span class="hljs-selector-id">#class</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">isc</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.git</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.GitLab</span></span>)<span class="hljs-selector-class"><span class="hljs-selector-class">.test</span></span>()" <span class="hljs-selector-tag"><span class="hljs-selector-tag">artifacts</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">paths</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">-</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tests</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.html</span></span></code> </pre> <br><p>  Now we will write the corresponding server code that calls the <a href="">unit tests</a> (the <a href="https://habrahabr.ru/company/intersystems/blog/263677/">article on the habr</a> ): </p><br><pre> <code class="hljs haskell">/// <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(isc.git.<span class="hljs-type"><span class="hljs-type">GitLab</span></span>).test() <span class="hljs-type"><span class="hljs-type">ClassMethod</span></span> test() { try { set tests = ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(isc.git.<span class="hljs-type"><span class="hljs-type">Settings</span></span>).getSetting(<span class="hljs-string"><span class="hljs-string">"tests"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tests'=<span class="hljs-string"><span class="hljs-string">""</span></span>) { set dir = ..getDir() set ^<span class="hljs-type"><span class="hljs-type">UnitTestRoot</span></span> = dir $$$<span class="hljs-type"><span class="hljs-type">TOE</span></span>(sc, ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(%<span class="hljs-type"><span class="hljs-type">UnitTest</span></span>.<span class="hljs-type"><span class="hljs-type">Manager</span></span>).<span class="hljs-type"><span class="hljs-type">RunTest</span></span>(tests, <span class="hljs-string"><span class="hljs-string">"/nodelete"</span></span>)) $$$<span class="hljs-type"><span class="hljs-type">TOE</span></span>(sc, ..writeTestHTML()) throw:'..isLastTestOk() ##<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(%<span class="hljs-type"><span class="hljs-type">Exception</span></span>.<span class="hljs-type"><span class="hljs-type">General</span></span>).%<span class="hljs-type"><span class="hljs-type">New</span></span>(<span class="hljs-string"><span class="hljs-string">"Tests error"</span></span>) } halt } catch ex { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ..logException(ex) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> $system.<span class="hljs-type"><span class="hljs-type">Process</span></span>.<span class="hljs-type"><span class="hljs-type">Terminate</span></span>(, <span class="hljs-number"><span class="hljs-number">1</span></span>) } }</code> </pre> <br><p>  <code>tests</code> ‚Äî        .    ,    . </p><br><p>  <code>writeTestHTML</code> ( )    -   -. </p><br><h3 id="package">  Package </h3><br><p>     -,   REST API: </p><br><div class="spoiler"> <b class="spoiler_title"></b> <div class="spoiler_text"><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">initializePage</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> xhr = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> url = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"${CI_ENVIRONMENT_URL}:57772/MyApp/version"</span></span></span><span class="javascript">; xhr.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"GET"</span></span></span><span class="javascript">, url, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); xhr.send(); xhr.onloadend = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">data</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"version"</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Version: "</span></span></span><span class="javascript"> + </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.response; }; </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> xhr = </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">new</span></span></span><span class="javascript"> XMLHttpRequest(); </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">var</span></span></span><span class="javascript"> url = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"${CI_ENVIRONMENT_URL}:57772/MyApp/author"</span></span></span><span class="javascript">; xhr.open(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"GET"</span></span></span><span class="javascript">, url, </span><span class="hljs-literal"><span class="javascript"><span class="hljs-literal">true</span></span></span><span class="javascript">); xhr.send(); xhr.onloadend = </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">data</span></span></span></span><span class="javascript"><span class="hljs-function">) </span></span></span><span class="javascript">{ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.getElementById(</span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"author"</span></span></span><span class="javascript">).innerHTML = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Author: "</span></span></span><span class="javascript"> + </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">this</span></span></span><span class="javascript">.response; }; } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"initializePage()"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"version"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"author"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>      "",    <code>${CI_ENVIRONMENT_URL}</code>   .        (npm),    .  : </p><br><pre> <code class="hljs axapta">package <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>: &lt;&lt;: *env_test stage: package script: envsubst &lt; <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html &gt; <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html artifacts: paths: - <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html</code> </pre> <br><h3 id="deploy">  Deploy </h3><br><p> ,    <code>index.html</code>   -. </p><br><pre> <code class="hljs axapta">deploy <span class="hljs-keyword"><span class="hljs-keyword">client</span></span>: &lt;&lt;: *env_test stage: deploy script: cp -f <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html /var/www/html/<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html</code> </pre> <br><p>  That's all! </p><br><h3 id="neskolko-okruzheniy">   </h3><br><p>             ?      ,        .          : </p><br><pre> <code class="hljs sql">stages: - <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> .env_test: &amp;env_test environment: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://test.hostname.com <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>: - <span class="hljs-keyword"><span class="hljs-keyword">master</span></span> tags: - <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> .env_preprod: &amp;env_preprod environment: <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>: preprod <span class="hljs-keyword"><span class="hljs-keyword">url</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://preprod.hostname.com <span class="hljs-keyword"><span class="hljs-keyword">only</span></span>: - preprod tags: - preprod .script_load: &amp;script_load stage: <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> script: csession IRIS <span class="hljs-string"><span class="hljs-string">"##class(isc.git.GitLab).loadDiff()"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>: &lt;&lt;: *env_test &lt;&lt;: *script_load <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> preprod: &lt;&lt;: *env_preprod &lt;&lt;: *script_load</code> </pre> <br><p>       . </p><br><p>   CD  <a href=""></a>         ,    . </p><br><h2 id="vyvody">  findings </h2><br><p>   ‚Äî      ,         , ,          .    ,     .         ,          . </p><br><p>     InterSytems,   InterSystems IRIS Data Platform (      Cach√©  Ensemble),        ,   ,           ,   . </p><br><h2 id="ssylki">  Links </h2><br><ul><li> <a href="https://youtu.be/n9pmKz7cCHM">   </a> </li><li> <a href="https://community.intersystems.com/post/continuous-delivery-your-intersystems-solution-using-gitlab-part-vi-containers-infrastructure">   Developer Community  CD</a> </li><li> <a href="http://gitlab.eduard.win/test/testProject"> </a> </li><li> <a href="https://github.com/intersystems-ru/GitLab">   GitLab</a> </li><li> <a href="https://about.gitlab.com/2016/10/25/gitlab-workflow-an-overview/">GitLab Workflow</a> </li><li> <a href="https://about.gitlab.com/installation/">   GitLab</a> </li><li> <a href="https://docs.gitlab.com/ee/ci/yaml/README.html"> </a> </li><li> <a href="https://docs.gitlab.com/ce/ci/variables/README.html"> </a> </li><li> <a href="https://about.gitlab.com/features/gitlab-ci-cd/">  CD</a> </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/354158/">https://habr.com/ru/post/354158/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354146/index.html">Hypotesis - Details and Extras</a></li>
<li><a href="../354148/index.html">Security Week 14: RSA Conference, Holed Advertising Networks, Alliances and Confrontation</a></li>
<li><a href="../354150/index.html">How we participated in the hackathon from OpenData</a></li>
<li><a href="../354152/index.html">Mobius-2018: robo report</a></li>
<li><a href="../354154/index.html">Setting up a machine learning model: feature selection and optimization of hyper parameters</a></li>
<li><a href="../354160/index.html">Whose weather forecast is more accurate?</a></li>
<li><a href="../354162/index.html">Chances of success in the European Court of Complaints about blocking resources</a></li>
<li><a href="../354164/index.html">3CX WebMeeting update, 3CX client for iOS and the Click to Call extension for Firefox</a></li>
<li><a href="../354166/index.html">How to stop being a demiurge and entrust the creation of PowerShell entities</a></li>
<li><a href="../354168/index.html">From the routine to the pleasant process: what is the backlog of the product and how to manage it?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>