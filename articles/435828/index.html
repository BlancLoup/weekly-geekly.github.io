<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The math in Gamedev is simple. Curves and Ripples for the effect of rain in Unity</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! My name is Grisha, and I am the founder of CGDevs. We continue to talk about mathematics or something. Perhaps the main application of mathemat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The math in Gamedev is simple. Curves and Ripples for the effect of rain in Unity</h1><div class="post__text post__text-html js-mediator-article">  Hello!  My name is Grisha, and I am the founder of CGDevs.  We continue to talk about mathematics or something.  Perhaps the main application of mathematics in game development and computer graphics in general is VFX.  So let's talk about one such effect - rain, or rather, about its main part, which requires mathematics - ripples on the surface.  We will consistently write a shader for ripples on the surface, and analyze its math.  If interested - welcome under cat.  Github project is attached. <br><br><img src="https://habrastorage.org/webt/15/5m/zm/155mzmadkwqhsef6lpvb7us1kbe.png"><br><a name="habracut"></a><br>  Sometimes there comes a time in life when a programmer has to take up a tambourine and encourage rain.  In general, the theme of rain modeling itself is very deep.  There are many mathematical works on different parts of this process, from the fall of a drop and the effects associated with this to the distribution of drops in the volume.  We analyze only one aspect - the shader, which will allow us to create an effect similar to a wave from a fallen drop.  It's time to take up the tambourine! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/K5ISaIAx3-o" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Wave math</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When searching the Internet you find a lot of funny mathematical expressions for generating ripples.  Often they consist of some kind of "magic" numbers and a periodic function without justification.  But in general, the math of this effect is quite simple. <br><br>  We need only the equation of a plane wave in the one-dimensional case.  Why we will analyze flat and one-dimensional later. <br><br>  <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BB%25D0%25BE%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25B2%25D0%25BE%25D0%25BB%25D0%25BD%25D0%25B0">The equation of a plane wave</a> in our case can be written as: <br><br>  <i>Aresult = A * cos (2 * PI * (x / waveLength - t * frequency));</i> <br>  Where: <br>  <i>Aresult</i> - amplitude at point x, at time t <br>  <i>A</i> - maximum amplitude <br>  <i>wavelength</i> - wavelength <br>  <i>frequency</i> - wave frequency <br>  <i>PI</i> - number of PI = 3.14159 (float) <br><br>  <b>Shader</b> <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://media.giphy.com/media/2ywmKSvq53ptEXK60f/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Let's play with shaders.  The coordinate ‚Äú-Z‚Äù will be responsible for the ‚Äútop‚Äù.  This is more convenient in the 2D case in Unity.  If desired, the shader will not be difficult to rewrite to Y. <br><br>  The first thing we need is the equation of a circle.  The wave of our shader will be symmetrical about the center.  The equation of a circle in the 2D case is described as: <br><br>  <i>r ^ 2 = x ^ 2 + y ^ 2</i> <br><br>  we need a radius, so the equation takes the form: <br><br>  <i>r = sqrt (x ^ 2 + y ^ 2)</i> <br><br>  and this will give us symmetry with respect to the point (0, 0) in the mesh, which will reduce everything to the one-dimensional case of a plane wave. <br><br>  Now let's write a shader.  I will not disassemble every step of writing a shader, since this is not the purpose of the article, but it is based on the Standard Surface Shader from Unity, the template of which can be obtained via Create-&gt; Shader-&gt; StandardSurfaceShader. <br><br>  In addition, the properties necessary for the wave equation are <i>added</i> : <i>_Frequency</i> , <i>_WaveLength</i> and <i>_WaveHeight</i> .  Property <i>_Timer</i> (it would be possible to use time with gpu, but during development and subsequent animation it is more convenient to control it manually. <br><br>  Let's write the getHeight function to get the height (now it's the Z coordinate) by substituting the equation of a circle into the wave equation <br><br>  Writing a shader with our wave equation and the equation of a circle, we get this effect. <br><br><div class="spoiler">  <b class="spoiler_title">Shader code</b> <div class="spoiler_text"><pre><code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"CGDevs/Rain/RainRipple"</span></span> { Properties { _WaveHeight(<span class="hljs-string"><span class="hljs-string">"Wave Height"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _WaveLength(<span class="hljs-string"><span class="hljs-string">"Wave Length"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Frequency(<span class="hljs-string"><span class="hljs-string">"Frequency"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Timer(<span class="hljs-string"><span class="hljs-string">"Timer"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> _Color (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Albedo (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Glossiness (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>= <span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; }; half _Glossiness, _Metallic, _Frequency, _Timer, _WaveLength, _WaveHeight; fixed4 _Color; <span class="hljs-function"><span class="hljs-function">half </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(half x, half y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159</span></span>; half rad = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(x * x + y * y); half wavefunc = _WaveHeight * <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * PI * (_Frequency * _Timer - rad / _WaveLength)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wavefunc; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_full v)</span></span></span><span class="hljs-function"> </span></span>{ v.vertex.z -= getHeight(v.vertex.x, v.vertex.y); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutputStandard o)</span></span></span><span class="hljs-function"> </span></span>{ fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = _Color.a; } ENDCG } FallBack <span class="hljs-string"><span class="hljs-string">"Diffuse"</span></span> }</code> </pre> <br></div></div><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://media.giphy.com/media/kvPWJaw0nqhZU0v3eV/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Waves there.  But I want the animation to begin and end with a plane.  This will help us sine function.  Multiplying the amplitude by sin (_Timer * PI) we obtain a smooth appearance and disappearance of waves.  Since _Timer takes values ‚Äã‚Äãfrom 0 to 1, and the sine at zero and in PI is zero, this is exactly what is needed. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://media.giphy.com/media/5zotyAkAgtISUCoB0o/giphy.mp4" type="video/mp4"></video></div></div></div><br>  While not at all like falling drops.  The problem is that wave energy is lost evenly.  Add the _Radius property, which will be responsible for the effect range.  And multiply by the clamp amplitude (_Radius - rad, 0, 1) and we will get the effect more like the truth. <br><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://media.giphy.com/media/7i9kpPPHDJWUNJXeuV/giphy.mp4" type="video/mp4"></video></div></div></div><br>  Well, the final step.  The fact that the amplitude at each individual point reaches its maximum at the moment of time equal to 0.5 is not quite true, this function should be replaced. <br><br><img src="https://habrastorage.org/webt/bn/9h/dy/bn9hdyvxobu313uitppdz4j68ik.png"><br><br>  Then I felt a little lazy to count, and I simply multiplied the sine by (1 - _Timer) and got such a curve. <br><br><img src="https://habrastorage.org/webt/xp/nu/f2/xpnuf2rrjiqtxj7f_g_q5luq7h0.png"><br><br>  But in general, from the point of view of mathematics, it is also possible to choose the desired curve based on the logic at which point in time you want the peak and the approximate form, and then build an interpolation on these points. <br><br>  The result was such a shader and effect. <br><br><div class="spoiler">  <b class="spoiler_title">Shader code</b> <div class="spoiler_text"><pre> <code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"CGDevs/Rain/RainRipple"</span></span> { Properties { _WaveHeight(<span class="hljs-string"><span class="hljs-string">"Wave Height"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _WaveLength(<span class="hljs-string"><span class="hljs-string">"Wave Length"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Frequency(<span class="hljs-string"><span class="hljs-string">"Frequency"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Radius(<span class="hljs-string"><span class="hljs-string">"Radius"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Timer(<span class="hljs-string"><span class="hljs-string">"Timer"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> _Color (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _MainTex (<span class="hljs-string"><span class="hljs-string">"Albedo (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Glossiness (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> _Metallic (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0.0</span></span> } SubShader { Tags { <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span>= <span class="hljs-string"><span class="hljs-string">"Opaque"</span></span> } LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _MainTex; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; }; half _Glossiness, _Metallic, _Frequency, _Timer, _WaveLength, _WaveHeight, _Radius; fixed4 _Color; <span class="hljs-function"><span class="hljs-function">half </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(half x, half y)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159</span></span>; half rad = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>(x * x + y * y); half wavefunc = _WaveHeight * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(_Timer * PI) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - _Timer) * clamp(_Radius - rad, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * PI * (_Frequency * _Timer - rad / _WaveLength)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wavefunc; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_full v)</span></span></span><span class="hljs-function"> </span></span>{ v.vertex.z -= getHeight(v.vertex.x, v.vertex.y); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutputStandard o)</span></span></span><span class="hljs-function"> </span></span>{ fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * _Color; o.Albedo = c.rgb; o.Metallic = _Metallic; o.Smoothness = _Glossiness; o.Alpha = _Color.a; } ENDCG } FallBack <span class="hljs-string"><span class="hljs-string">"Diffuse"</span></span> }</code> </pre><br></div></div><br><iframe width="560" height="315" src="https://www.youtube.com/embed/https://translate" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><div class="oembed"><div><div style="left: 0; width: 100%; height: 0; position: relative; padding-bottom: 56.25%;"><video controls="" style="top: 0; left: 0; width: 100%; height: 100%; position: absolute;">  Your browser does not support HTML5 video. <source src="https://media.giphy.com/media/pOwf43ETsackhG30CA/giphy.mp4" type="video/mp4"></video></div></div></div><br>  <b>Mesh mesh is important</b> <br><br>  Returning a little to the topic of the <a href="https://habr.com/post/435374/">previous article</a> .  The waves are implemented by a vertex shader, so the mesh of the mesh plays a fairly large role.  Since the nature of the movement is known, the task is simplified, but in general the final visual depends on the shape of the grid.  The difference is not significant at high polygonality, but for productivity, the smaller the polygons, the better.  Below are pictures illustrating the difference between grids and visuals. <br><br>  <b>Right:</b> <br><br><img src="https://habrastorage.org/webt/xw/tt/r5/xwttr5ikn3utin3bk8zovtafiuk.png"><br><br>  <b>Wrong:</b> <br><br><img src="https://habrastorage.org/webt/mt/kn/jz/mtknjzazxsvlolfild-i_pspsrw.png"><br><br>  Even with twice the number of polygons, the second mesh gives the wrong visual (both meshes are generated using Triangle.Net, just for different algorithms). <br><br>  <b>Final visual</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/rb7DolTp6Hc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  A special part has been added to another version of the shader to create waves not strictly in the center, but at several points.  How this is implemented and how you can pass on such parameters I can tell in the next articles if the topic is interesting. <br><br>  Here is the shader itself: <br><br><div class="spoiler">  <b class="spoiler_title">Ripple Vertex with Pole</b> <div class="spoiler_text"><pre> <code class="cpp hljs">Shader <span class="hljs-string"><span class="hljs-string">"CGDevs/Rain/Ripple Vertex with Pole"</span></span> { Properties { _MainTex (<span class="hljs-string"><span class="hljs-string">"Albedo (RGB)"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Normal (<span class="hljs-string"><span class="hljs-string">"Bump Map"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Roughness (<span class="hljs-string"><span class="hljs-string">"Metallic"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Occlusion (<span class="hljs-string"><span class="hljs-string">"Occlusion"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _PoleTexture(<span class="hljs-string"><span class="hljs-string">"PoleTexture"</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>D) = <span class="hljs-string"><span class="hljs-string">"white"</span></span> {} _Color (<span class="hljs-string"><span class="hljs-string">"Color"</span></span>, Color) = (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) _Glossiness (<span class="hljs-string"><span class="hljs-string">"Smoothness"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> _WaveMaxHeight(<span class="hljs-string"><span class="hljs-string">"Wave Max Height"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _WaveMaxLength(<span class="hljs-string"><span class="hljs-string">"Wave Length"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Frequency(<span class="hljs-string"><span class="hljs-string">"Frequency"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> _Timer(<span class="hljs-string"><span class="hljs-string">"Timer"</span></span>, Range(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)) = <span class="hljs-number"><span class="hljs-number">0</span></span> } SubShader { Tags { <span class="hljs-string"><span class="hljs-string">"IgnoreProjector"</span></span> = <span class="hljs-string"><span class="hljs-string">"True"</span></span> <span class="hljs-string"><span class="hljs-string">"RenderType"</span></span> = <span class="hljs-string"><span class="hljs-string">"Opaque"</span></span>} LOD <span class="hljs-number"><span class="hljs-number">200</span></span> CGPROGRAM #pragma surface surf Standard fullforwardshadows vertex:vert #pragma target <span class="hljs-number"><span class="hljs-number">3.0</span></span> sampler2D _PoleTexture, _MainTex, _Normal, _Roughness, _Occlusion; half _Glossiness, _WaveMaxHeight, _Frequency, _Timer, _WaveMaxLength, _RefractionK; fixed4 _Color; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Input</span></span></span><span class="hljs-class"> {</span></span> float2 uv_MainTex; }; <span class="hljs-function"><span class="hljs-function">half </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHeight</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(half x, half y, half offetX, half offetY, half radius, half phase)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159</span></span>; half timer = _Timer + phase; half rad = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>((x - offetX) * (x - offetX) + (y - offetY) * (y - offetY)); half A = _WaveMaxHeight * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(_Timer * PI) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - _Timer) * (<span class="hljs-number"><span class="hljs-number">1</span></span> - timer) * radius; half wavefunc = <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span> * PI * (_Frequency * timer - rad / _WaveMaxLength)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> A * wavefunc; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vert</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(inout appdata_full v)</span></span></span><span class="hljs-function"> </span></span>{ float4 poleParams = tex2Dlod (_PoleTexture, float4(v.texcoord.xy, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); v.vertex.z += getHeight(v.vertex.x, v.vertex.y, (poleParams.r - <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * <span class="hljs-number"><span class="hljs-number">2</span></span>, (poleParams.g - <span class="hljs-number"><span class="hljs-number">0.5</span></span>) * <span class="hljs-number"><span class="hljs-number">2</span></span>, poleParams.b , poleParams.a); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">surf</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Input IN, inout SurfaceOutputStandard o)</span></span></span><span class="hljs-function"> </span></span>{ o.Albedo = tex2D(_MainTex, IN.uv_MainTex).rgb * _Color.rgb; o.Normal = UnpackNormal(tex2D(_Normal, IN.uv_MainTex)); o.Metallic = tex2D(_Roughness, IN.uv_MainTex).rgb; o.Occlusion = tex2D(_Occlusion, IN.uv_MainTex).rgb; o.Smoothness = _Glossiness; o.Alpha = _Color.a; } ENDCG } FallBack <span class="hljs-string"><span class="hljs-string">"Diffuse"</span></span> }</code> </pre><br></div></div><br>  The project as a whole and how it works can be found <a href="https://github.com/CGDevsCommunity/Rain">here</a> .  True, some of the resources had to be removed due to the weight restrictions of the githab (hdr skybox and machine). <br><br>  Thanks for attention!  I hope the article will be useful to someone, and it became a little clearer why you might need trigonometry, analytical geometry (everything related to curves) and other mathematical disciplines. </div><p>Source: <a href="https://habr.com/ru/post/435828/">https://habr.com/ru/post/435828/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../435814/index.html">[The Old New Thing] Can I use my stack as I like?</a></li>
<li><a href="../435816/index.html">Massachusetts Hospital and DeepMind independently opened the "black box" of AI in medicine</a></li>
<li><a href="../435822/index.html">How to manage iron in the data center using sound</a></li>
<li><a href="../435824/index.html">What you need to know before you start a career in the audio industry</a></li>
<li><a href="../435826/index.html">5 precepts of a successful negotiator and partner</a></li>
<li><a href="../435830/index.html">OMEGA - Automation of counting time at sporting events</a></li>
<li><a href="../435834/index.html">EXAM - State-of-the-art text classification method</a></li>
<li><a href="../435836/index.html">The largest Wall Street firms have agreed to launch a new exchange to compete with the Nasdaq and the NYSE.</a></li>
<li><a href="../435838/index.html">Lazy functions in javascript</a></li>
<li><a href="../435840/index.html">A small review of SIMD in .NET / C #</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>