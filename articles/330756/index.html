<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Operation ‚ÄúMigration‚Äù: if your mail is somewhere there, but you need to be here</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the last two years, my department has been closely involved in projects of migration of corporate mail from foreign services to MS Exchange based ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Operation ‚ÄúMigration‚Äù: if your mail is somewhere there, but you need to be here</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/web/371/263/e65/371263e6544f4b70921a767d4c42f5e9.jpg"></div><br>  For the last two years, my department has been closely involved in projects of migration of corporate mail from foreign services to MS Exchange based on the infrastructure of our data centers.  From cloud services like Office 365, Gmail mostly migrates because of the FZ-242, because they want mail to live on the Russian infrastructure.  This is not the only reason: after migration, some companies completely transfer the mail system to us for administration under a hard SLA, which is not always possible to obtain in mass services.  Those who had a post office on iron and who want to expand without contacting the purchase of new equipment also contact us, a modest Russian cloud provider. <br><br>  On 27 migration projects and 50 thousand transferred boxes, anything happened.  Today I want to tell you what to consider and think about if you are going to move. <a name="habracut"></a><br><br><h2>  What do you want to get out </h2><br>  Before starting the project, we agree with the provider the following points: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  <b>the functionality you</b> expect to receive from the new mail system: traffic volume, calendars, UM, shared folders, etc. </li><li>  <b>availability at the stage of migration and after.</b>  Are you ready for downtime?  If so, how much and when?  What accessibility do you expect after migration, when your users will work with the new system? </li><li>  <b>what business processes are tied to the postal organization</b> : the work of a support service, marketing mailings, etc. </li><li>  <b>what solutions to integrate with</b> (1C, Sharepoint, Skype, etc.).  There was a case when an IT manager started a mail migration from Lotus to Exchange, and halfway through it turned out that they also have a corporate portal tied to Lotus.  They did not plan to move to a new portal, so they curtailed the migration, and the imprudent manager was fired. </li><li>  <b>approximate dates of migration</b> .  Even if everything is calculated correctly, taking into account the amount of data that needs to be transferred to the new site, unforeseen technical limitations will emerge: the communication channel will be slower than expected, or limits on the export of data from the original mail system will be detected. </li></ul><br>  <i>We encountered the last one when we were transporting a client from Gmail.</i>  <i>In the process it turned out that no more than 1.5 GB of data can be exported per day.</i>  <i>Even if the box was only 2 GB, then it had to be exported for two days - 1.5 GB, then we wait for a day and download the remaining 500 MB.</i>  <i>Transferring boxes to 20 GB took almost two weeks.</i> <i><br><br></i>  <i>While everything was exported in small portions, life in the company did not stop and a new mail arrived, which also needs to be synchronized with the new site.</i>  <i>The problem was solved with the help of the <a href="https://www.cloudiway.com/">Cloudiway</a> utility: it pulled out the entire contents of the boxes with the daily limit, i.e.</i>  <i>we did not have to manually pump out the allowed 1.5 GB once a day.</i>  <i>Then she pulled out the delta of letters that fell during the time she pulled the main volume.</i>  <i>Over time, the delta became smaller and smaller, and after all the data from the source box was transferred, we switched the user to work with the target mail system.</i> <br><br>  Another ‚Äúblack hole‚Äù where a lot of project time goes is the interaction between the project participants.  Especially if there are more than two. <br><br>  <i>The client migrated from a foreign hosting, and the interaction chain looked like this: we communicated with the customer‚Äôs project manager, he forwarded our messages to the IT department, who interacted with the foreign hosting provider Exchange.</i>  <i>Somehow we needed to enable MPC-proxy (a service that provides mailbox transfer during migration) at a foreign site, and it took two weeks.</i> <br><br>  At the start, they always voice very optimistic terms.  Be realistic and feel free to multiply your initial estimate by two. <br><br><h2>  Audit of existing infrastructure </h2><br>  Everything is simple here: you need to analyze the source mail system and understand what it has with the following parameters: <br><br><ul><li>  incoming and outgoing volume of SMTP traffic; </li><li>  the number and total volume of mailboxes; </li><li>  number of end users; </li><li>  customer location: they can connect from inside the network and outside the network, from a domain or non-domain machines; </li><li>  client connection protocols and client versions (MacOS client, Outlook Anywhere, POP3, IMAP, ActiveSync); </li><li>  current mail system configuration: <br>  - the number of SMTP domains of the organization; <br>  - the number of distribution groups; <br>  - the presence of large boxes (from 20 GB); <br>  - availability of service boxes (for 1C, scanners, mailings); <br>  - bulk mailing. </li></ul><br>  Based on this information, we will think over the sizing and architecture of the new mail system. <br><br>  <i>In one of the projects, the client forgot to tell about the fact that their marketing sends out millions of letters every day.</i>  <i>As a result, the new system was designed without considering this load.</i>  <i>When the mailbox from which the mass mailings came, moved to the new system, the infrastructure of the new mail system ‚Äúlay flat‚Äù.</i>  <i>I had to do resizing the system on the go.</i>  <i>Fortunately, everything worked on virtualization and it was easy to add resources quickly.</i> <i><br></i> <br><br><h2>  Mail system architecture </h2><br>  The choice of MS Exchange architecture will depend on availability requirements.  There are two options: <br><br>  <b>Stand alone.</b>  All mailboxes are located on the same server.  This option is not about high availability, but about low cost.  At the application level, there is no reservation.  If there is no backup at other levels (for example, virtualization), then if Exchange fails, it will be unavailable. <br>  This architecture is suitable if you have a few boxes and you are satisfied with the recovery from the backup. <br><br>  <b>High Availability.</b>  All mail system roles are duplicated.  MailBox servers (MBX in the diagram) are added to the High Availability Group (Database Availability Group, DAG).  If one of the servers fails, the mail databases will move to the backup ones.  The end user will not notice anything.  This scheme can be implemented within the two data centers.  Then the mail system will not be afraid of the failure of the entire data center. <br><br>  This architecture is for those companies for which simple is not acceptable.  Most often these are big companies. <br><br><img src="https://habrastorage.org/web/9c7/f61/57b/9c7f6157b7c84ccdb89ae9c44c30d0ed.png"><br>  <i>HA schema.</i> <br><br><h2>  The choice of antispam / antivirus solutions </h2><br>  From my experience I‚Äôll say that large companies choose something like Kaspersky Mail Security.  Small projects usually use built-in antivirus and antispam solutions.  They may not be as comfortable or functional as third-party solutions, but they also perform their task well.  Nobody really complained yet). <br><br><h2>  Mail system sizing </h2><br>  The question is not, if the new system is a complete clone of the old one and we do not plan to change anything in it.  For the remaining cases will have to count resources.  MS has a tool (in fact, just an excel-label with a bunch of parameters :)), with which you can calculate the amount of resources for an Exchange installation - the <a href="https://gallery.technet.microsoft.com/office/Exchange-2013-Server-Role-f8a61780">Microsoft Exchange Sizing Calculator</a> .  I‚Äôll say right away that the tool is not intuitive and will take time to figure it out, but this is a good option if you don‚Äôt have experience with such projects. <br><br>  When calculating, we do not forget to make allowances for the fact that the mail system will be backed up, which means that the speed of the backup will also depend on the type of disks used.  If you plan to use an antivirus that will check the database online, then it is more logical to choose SAS disks, but, of course, the choice of the type of disks should be based on an analysis of the actual load on the system. <br>  Since the migration does not take place simultaneously, especially for large companies, it is necessary to foresee the possibility of scaling the infrastructure for mail (in one project, during the migration, the number of users managed to grow 2 times - it was 1000, it was 2000).  If the system uses virtual resources, then it is easier to do. <br><br><h2>  Migration method </h2><br>  The method of migration is determined by the following points: the size of the postal system, the timing, whether you can afford simple and labor costs, which you are ready to go. <br><br>  In the <b>case of cutover migration, the</b> entire postal system is transferred to the new site entirely in one iteration.  This option can be considered if you have a small mail system (up to 500 GB) and you agree to a simple one for a few hours.  The migration itself will be fast: if you successfully plan the technical window, you can move over the weekend or even faster, with minimal inconvenience for the business. <br><br>  In the <b>coexistence</b> scenario <b>, the</b> mail system is gradually transferred to the new site without downtime.  At the same time, the source and target mail systems for some time simultaneously live on two sites: some users already work in the new system, and some - in the old one.  Such migration is suitable for any volumes, but the time, labor, cost, as the data is transferred in parts and the number of approvals and other bureaucracies increase.  Technically, this is a more difficult option, we need a certain qualification of admins. <br><br><h2>  Migration plan, instructions, regulations </h2><br>  After we have decided on everything, we fix the order of actions in <b>the migration plan</b> .  We register all the technical details of the migration in it: <br><br><ul><li>  architecture of the source and end systems; </li><li>  technical windows and downtime; </li><li>  proper procedure for migration. </li></ul><br>  If there are a lot of participants in the project, then we register the <b>procedures for administrative interaction and areas of responsibility</b> .  It is not necessary that it be an official paper with a signature and stamp on each page.  You can simply agree in a letter about who is responsible for what, how interaction with third parties is built (DNS-hoster, cloud provider), etc. <br><br>  Do not forget about end users: we warn them about the date of switching to a new mail system, we are preparing an <b>instruction</b> or a whole FAQ on connecting to a new mail system and what to do if something does not work.  The same algorithm is used for technical support.  No, this is not a formality.  When a few hundred or even thousands of employees at the same time will not know what to do, and start attacking technical support, which will also not be up to date, it will not be very fun. <br><br>  <i>One of the migration projects from Office 365 to Exchange had the following situation.</i>  <i>On the original system, users had two accounts ‚Äî for logging on to the computer (AD account) and for logging in to mail, to Office 365. After the migration, there was only one account left.</i>  <i>There were about 600 users, so it was important to clearly convey to them which of the accounts to use in the new system.</i> <br><br>  That's all.  Ask questions in the comments.  And all the successful journeys. </div><p>Source: <a href="https://habr.com/ru/post/330756/">https://habr.com/ru/post/330756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330746/index.html">Principles of software testing. Personal translation from the book ‚ÄúThe Art of Testing‚Äù by G. Myers</a></li>
<li><a href="../330748/index.html">DevConf :: BackEnd already this week on June 17th on Saturday, the program is formed</a></li>
<li><a href="../330750/index.html">Junior, who on the first day of work deleted the database from production</a></li>
<li><a href="../330752/index.html">Tape Recorder Emulator for ZX-Spectrum</a></li>
<li><a href="../330754/index.html">Full immersion in virtual reality: the present and the future</a></li>
<li><a href="../330758/index.html">GIS and distributed computing</a></li>
<li><a href="../330760/index.html">Working with the server using Alamofire on Swift</a></li>
<li><a href="../330762/index.html">The cost of the error: who pays for the programmers' mistakes and how much?</a></li>
<li><a href="../330764/index.html">Virtual creatures and their habitats: the past and present TTY in Linux</a></li>
<li><a href="../330772/index.html">Apache step-by-step configuration with the choice of versions of php + Nginx as reverse proxy (with mod_pagespeed) on ubuntu 16.04</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>