<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Installing Jenkins and Bonobo Git Server under Windows for building Android applications</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. Not having time to dig into Linux Faced with gaps in information when searching online for instructions on installing and configuring a Jenk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Installing Jenkins and Bonobo Git Server under Windows for building Android applications</h1><div class="post__text post__text-html js-mediator-article">  Good day.  <s>Not having time to dig into Linux</s> Faced with gaps in information when searching online for instructions on installing and configuring a Jenkins server for Android for continuous use on Windows, the Git server and their integration decided to share information about what I did. <br><a name="habracut"></a><br><h4>  Distributions </h4><br><ul><li>  In the role of the OS we will be Windows Server 2012 R2 Standard x64 </li><li>  <a href="https://jenkins.io/content/thank-you-downloading-windows-installer">Jenkins</a> for Windows is in a separate msi </li><li>  <a href="https://bonobogitserver.com/">Bonobo Git Server</a> </li><li>  <a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK</a> </li><li>  <a href="https://www.asp.net/mvc/mvc4">ASP.NET MVC 4</a> </li><li>  <a href="https://developer.android.com/studio/index.html">Android SDK tools</a> at the very bottom of the page, not Wednesday but only the SDK </li><li>  <a href="https://git-scm.com/download/win">Git for windows x64</a> </li></ul><br><h4>  Last preparations </h4><br>  You can install JDK, Git for Windows and Android SDK Tools from the very beginning with default settings. <br><br><h4>  Bonobo Git Server </h4><br>  A simple and easy git server for itself requires the installation of IIS and ASP.MVC that includes MS SQL Server Express 2008 <br><br><h5>  IIS Server </h5><br>  There is nothing unusual here, we add the role of Web Server (IIS): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">IIS</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/daf/f67/e3c/daff67e3c336bf64b0ce809be16ff811.jpg" alt="image"><br></div></div><br>  The main thing on the following form is not to miss adding ASP.NET 4.5 to the Feature: <br><br><div class="spoiler">  <b class="spoiler_title">Feature</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/5cd/86e/c1d/5cd86ec1da789546ba21d7d653e2e7bc.png" alt="image"><br></div></div><br><h5>  ASP.NET MVC4 </h5><br>  Run the distribution: <br><br><div class="spoiler">  <b class="spoiler_title">ASP.NET MVC4 Install</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ca6/68e/737/ca668e7373df9d2d6cf591b2a4596b80.png" alt="image"><br></div></div><br>  Along the way, MS SQL Server 2008 Express will be installed and we will be asked for the password for UZ sa.  I hope without need it is no longer required: <br><br><div class="spoiler">  <b class="spoiler_title">MS SQL Server installation</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c3e/c8e/a07/c3ec8ea07b7515070ebc5233e9d9f8ef.png" alt="image"><br></div></div><br>  After installing MVC, you need to go over the settings of server roles (not features, but earlier) and add ASP.NET4.5 support to the web server.  Prior to installing ASP.NET MVC 4 of this subsection (Application Development) in the components of IIS was not! <br><br><div class="spoiler">  <b class="spoiler_title">Server Roles - IIS - Web Server - Application Development - ASP.NET 4.5</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/7f1/fd2/cc5/7f1fd2cc5a8d0fe0d9f4e7a78cca1fa3.png" alt="image"></div></div><br><h5>  Bonobo Git Server </h5><br>  Everything, now you can go directly to the deployment of the git server.  Unzip the distribution in the wwwroot of the IIS server and grant the rights of IIS_IUSERS UZ to modify the App_Data directory: <br><br><div class="spoiler">  <b class="spoiler_title">IIS wwwroot and UI IIS_IUSERS rights to the App_Data directory</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/666/251/c89/666251c898baef108578c95ec7866972.png" alt="image"><br></div></div><br>  Launch IIS Manager and convert it to BonoboGitServer application: <br><br><div class="spoiler">  <b class="spoiler_title">IIS Manager Convert to Application</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/919/0c5/dd1/9190c5dd1e52d1c9fb4e8aa63cd5cda5.png" alt="image"><br></div></div><br>  If everything went as it should to the right in IIS Manager in Action click Browse: *: 80 (http) and get (if you did not change the name and port) to localhost / BonoboGitServer: <br><br><div class="spoiler">  <b class="spoiler_title">Bonobo Git Server login page</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/7db/00a/18f/7db00a18ffb8b75951d309dcd6163e64.png" alt="image"><br></div></div><br>  Username and password for the first login admin / admin.  The server has not so many settings (in any case via the web interface), for example, you can change the interface language: <br><br><div class="spoiler">  <b class="spoiler_title">Bonobo language</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/401/ca3/fa2/401ca3fa2bcf9237ac4d9b06485184e7.png" alt="image"><br></div></div><br>  and create new users, such as developer and jenkins.  Under the first we will work ourselves, the second is needed by the future build server. <br><br><div class="spoiler">  <b class="spoiler_title">New user Bonobo Git Server</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/084/958/f84/084958f84ea4554dcbbefeedead3e249.png" alt="image"><br></div></div><br>  Let's create a new repository and give the developer and builder the rights to it (ultrasound jenkins, not on the screenshot, but it should be there if you do everything in order ...) <br><br><div class="spoiler">  <b class="spoiler_title">New repository</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/273/24b/043/27324b0437532f108a9e918f9c3c0e3f.png" alt="image"><br></div></div><br>  An example of a repository page with a cherished .git address.  Since  I logged in to the server from a browser on the same machine, I have localhost in the address, but you may have a normal DNS server name or IP. <br><br><div class="spoiler">  <b class="spoiler_title">Repository Address</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/039/ab5/442/039ab54427dc994d87d967ee346ffaec.png" alt="image"><br></div></div><br>  You can create a project in Android Studio and specify the address of our repository as a remote branch.  I‚Äôll skip all this <i>local</i> part. <br><br><div class="spoiler">  <b class="spoiler_title">Remote repository available</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/da2/a40/ddf/da2a40ddf9db5427c99fc4ceff9b6415.jpg" alt="image"><br></div></div><br><h4>  Jenkins </h4><br>  Jenkins is installed from msi and doesn‚Äôt specifically ask about anything, at the end of the installation a page with the address where we need to copy from the initialAdminPassword file and insert the password automatically opens: <br><br><div class="spoiler">  <b class="spoiler_title">Unlock jenkins</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/c2c/ca7/92f/c2cca792f163b47e0398a17105aca335.png" alt="image"><br></div></div><br>  In the future, password UZ admin can also be changed. <br><br>  It's time to install the necessary plugins and configure the server.  Go to Manage Jenkins - Manage Plugins - Avaliable and note: <br><br><ul><li>  JDK Parameter Plugin </li><li>  Git plugin </li><li>  Android Emulator Plugin </li><li>  Gradle plugin </li></ul><br><div class="spoiler">  <b class="spoiler_title">Jenkins plugins</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/b3f/050/503/b3f05050341a18f927f293fd936969c9.png" alt="image"><br></div></div><br>  After restarting Jenkins, you need to go to the Manage Jenkins - Configure System section and set the path to the Android SDK in two places: <br><br><div class="spoiler">  <b class="spoiler_title">ANDROID_HOME in Environment variables</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/64f/07f/5e2/64f07f5e2bf5998354499e2ccd496764.png" alt="image"><br></div></div><br>  And at the very bottom of the same page in the Android SDK root: <br><br><div class="spoiler">  <b class="spoiler_title">Android SDK root</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/a25/3ae/7c4/a253ae7c4d0a38ce2bd3ced8993348db.jpg" alt="image"><br></div></div><br>  If this parameter does not appear something wrong with the Android Emulator Plugin, maybe it just is not installed. <br><br>  Next, go to the Manage Jenkins - Global Tool Configuration configuration page, check and, if necessary, specify the paths to the components: <br><br><div class="spoiler">  <b class="spoiler_title">Global Tool Configuration</b> <div class="spoiler_text">  With JDK, everything is simple: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ec1/e28/a2a/ec1e28a2ab81468264151d052f34c13d.jpg" alt="image"><br>  Git can not be touched if the path variable contains the path to the git executable file and it is available on the command line, and Jenkins can use it: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7dc/81a/c77/7dc81ac77b776d6f91be274d7387d008.jpg" alt="image"><br><br>  And let Gradle download automatically.  In principle, the same trick could be done with the JDK, but when installing the Android SDK it requires a JDK registered in the system, and where Jenkins downloads the JDK I didn‚Äôt dig. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64a/88e/bf3/64a88ebf32079dedf979353517167ed0.jpg" alt="image"><br></div></div><br>  It seems everything? <br><br><h4>  Creating an automatic build task </h4><br>  In the main Jenkins sidebar, click New Item, invent a task name with the ‚ÄúFreestyle project‚Äù type and click OK, we‚Äôre in the task configuration.  Do not forget to tick Discard old builds, and then our server will soon be filled with successful builds of all versions: <br><br><div class="spoiler">  <b class="spoiler_title">General</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/cca/e45/07e/ccae4507ed8e104e7671fa2ca561dd21.jpg" alt="image"><br></div></div><br>  In the Source Code Management section, specify the URL of the git repository of our project.  Looking ahead, we do not start and do not substitute any credentials to access the repository: <br><br><div class="spoiler">  <b class="spoiler_title">Source code management</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/0c4/8f7/6f9/0c48f76f91bbda15dd081ced77111657.png" alt="image"><br></div></div><br>  We will collect the master branch.  You can also configure automatic assembly, in particular, polling the repository every minute and starting the assembly in case of new commits.  Mark Poll SCM and write * * * * * *: <br><br><div class="spoiler">  <b class="spoiler_title">Build triggers</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/2f1/3cd/685/2f13cd6853591bbc9f8b40361d0c20ad.png" alt="image"><br></div></div><br>  In the build section, click Add build step and configure the Gradle assembly.  The gradle version should be the one that we specified in the Global Tools Configurations.  We write a simple Task - ‚Äúclean build‚Äù.  These are the tasks available to us in gradlew.bat tasks at the root of the project.  You can call other tasks of the collector here, incl.  with keys. <br><br><div class="spoiler">  <b class="spoiler_title">Gradle</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/358/f61/f12/358f61f122477789ebe64fe437cb01ab.png" alt="image"><br></div></div><br>  Also we add one Post-build Action - we will save our APK-shniki - Android applications.  So we write: <br><br><pre><code class="hljs markdown"><span class="hljs-emphasis"><span class="hljs-emphasis">**\*</span></span>apk:</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Post-build action</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/4a8/343/767/4a8343767e6f0d7a5e7d7178d19d3342.jpg" alt="image"><br></div></div><br><h4>  Assembly </h4><br>  Save and run the build and see something like that, hang for 10 minutes and can't reach the repository: <br><br><pre> <code class="hljs ruby">git.exe fetch --tags --progress <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/localhost/</span></span>Hello.git +refs/heads/*<span class="hljs-symbol"><span class="hljs-symbol">:refs/remotes/origin/*</span></span></code> </pre><br>  We have not logged in to the git repository!  Adding the Login / Password pair to the Jenkins repository (where we left -none- in Source Code Management) didn't work, no matter how I tried.  We must try to look for other ways. <br><br>  The command line is launched on behalf of the KS session, Jenkins on behalf of the System and does not know anything about it, in the Credential Manager repository, it looks like it will not happen either.  Those.  This will not help: <br><br><div class="spoiler">  <b class="spoiler_title">Credential manager</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/24a/d0f/b0e/24ad0fb0e3652b5a1de20b7c39eb93b5.jpg" alt="image"><br></div></div><br>  An additional search on the network gave some tips: <br><br><ul><li>  Transferring ssh-keys from the ultrasound session to the system, which I could not find; </li><li>  The second method (git authorization), which worked. </li></ul><br><h5>  Git authorization </h5><br>  To do this, we need PsExec.exe from the <a href="https://technet.microsoft.com/ru-ru/sysinternals/pstools.aspx">PsTools</a> utility suite.  With it, we can run cmd.exe from under the System.  Run cmd.exe with elevated rights and execute: <br><br><pre> <code class="bash hljs">PsExec.exe -i -s cmd.exe</code> </pre> <br>  In the new console, all that needs to be done is to knock on the repository we need, for example, try to redo it on the command line.  credentials will be requested: <br><br><div class="spoiler">  <b class="spoiler_title">Git</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ac8/a70/7f1/ac8a707f1c66234a939702b6eccf70c7.jpg" alt="image"><br></div></div><br>  With the help of which Jenkins will be able to access this repository.  This is the same UZ that we created when setting up Bonobo Git Server along with developer.  If you later need to change these credentials have to go through the procedure again. <br><br><h5>  Lack of components and acceptance of licenses for Android SDK components </h5><br>  It may happen that the SDK will not have any modules and the console build to issue messages of a similar nature: <br><br><pre> <code class="hljs pgsql">A problem occurred configuring project <span class="hljs-string"><span class="hljs-string">':app'</span></span>. You have <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> accepted the license agreements <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">following</span></span> SDK components: [Android SDK Platform <span class="hljs-number"><span class="hljs-number">24</span></span>, Android SDK Build-Tools <span class="hljs-number"><span class="hljs-number">24.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>].</code> </pre> <br>  In this case, you need to run the SDK Manager with elevated permissions and install the missing components: <br><br><div class="spoiler">  <b class="spoiler_title">Android SDK Manager</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/bbb/e0f/db3/bbbe0fdb3ec8b1bd18c53328178e97a8.png" alt="image"><br></div></div><br>  Everything, after all shamanism, the assembly was successful! <br><br><div class="spoiler">  <b class="spoiler_title">Successful build!</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/304/e92/60f/304e9260f834156bc7e06b055a8d1680.jpg" alt="image"><br></div></div><br>  You can breed a team of Android-developers. <br><br>  <strong>PS</strong> You can even more automate the process, with the help of the corresponding plug-in, set up automatic publishing of the apk'shnik on the Google Play Store, but I will write about this another time if there are any difficulties. </div><p>Source: <a href="https://habr.com/ru/post/313564/">https://habr.com/ru/post/313564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313552/index.html">Kerio Operator 2.5 improves audio and video communications for small and medium businesses</a></li>
<li><a href="../313554/index.html">Introduction to DPI: System Composition and Connection Diagrams</a></li>
<li><a href="../313556/index.html">Introduction to DPI: System Usage Scenarios</a></li>
<li><a href="../313558/index.html">Deep Packet Inspection: Equipment and Application</a></li>
<li><a href="../313562/index.html">A little about the types of DDoS-attacks and methods of protection</a></li>
<li><a href="../313566/index.html">Automatic Relevance Determination or machine learning when there is very little data</a></li>
<li><a href="../313568/index.html">News of Mail.Ru Group online courses on Stepik</a></li>
<li><a href="../313570/index.html">Restore a domain controller from backup using Veeam</a></li>
<li><a href="../313574/index.html">October 27, Digital October will host Russian FinTech Meetup # 1</a></li>
<li><a href="../313576/index.html">On the way to a successful project: 11 tips for effective communication with the client and the team</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>