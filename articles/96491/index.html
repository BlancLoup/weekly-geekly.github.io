<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How poker bot works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Attention: 
 Do not take this article as a guide to action, remember that the use of bots is prohibited in all poker rooms and entails blocking your a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How poker bot works</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cbe/4ce/47b/cbe4ce47be5459235687ca3dc4f6b4f5.jpg" alt="image"></div><br><br>  <b>Attention:</b> <br>  <i>Do not take this article as a guide to action, remember that the use of bots is prohibited in all poker rooms and entails blocking your account with the withdrawal of all the money in the account.</i>  <i>In this article there will be no ready-to-use code, so as not to make life easier for script-kiddisam, we will consider the basic principles and algorithms of the bot.</i>  <i>A person familiar with programming, if desired, will still be able to write such a program.</i> <a name="habracut"></a><br><br>  The existence of winning poker bots has always been questioned, some poker rooms claim that their software generally prevents the use of such programs.  But anyone familiar with programming understands that it is easy to write the bot itself, and there will always be opposition to any protection.  The most difficult (and therefore most important) problem is the decision-making algorithm.  Indeed, to develop an algorithm that will bring plus is not so easy, but it is not necessary.  Now with a lot of different bonuses, rakeback and other offers from the poker rooms, it is enough for the bot to play zero or a weak minus, which is quite possible for small limits. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, the very first bot (more precisely, the program that plays <a href="http://www.pokeroff.ru/">poker</a> ) is considered ‚ÄúOrac‚Äù, which was developed in the early 80s by the famous poker player Mike Caro, the author of the book ‚ÄúSign Language‚Äù.  One of the features of the program was the ability to use timing-telzas - if the opponent thought for a long time, then his actions were more likely to be considered bluffing than if he acted quickly. <br><br>  On the Internet it is not so difficult to find a lot of ready bots.  From free elementary instances to bots with a large set of functions and the ability to play a team on several accounts at the cost of $ 200.  And it is only in publicly available sources, it is not known what can be found on any specialized private hacker forums and sites.  According to rumors a good winning bot costs from $ 1000, there are instances and $ 5000.  Such programs are probably very good at hiding themselves and imitating human behavior to the maximum, it is quite possible that they use neural networks to make decisions.  In this article we will not write a bot for $ 5k, we just try to make out the basic principles of the programs easier.  And there is no limit to further improvement. <br><br><h4>  Bot basics </h4><br>  Main modules for bot operation: <br><ul><li>  Getting information - getting information from the client, which is necessary for making a decision;  includes - our cards, opponent's bets, stack sizes, button position, etc. </li><li>  Decision making is an algorithm for deciding on a bot action, rather a logical task and a separate topic, so we will look at it in the next article in this series. </li><li>  Simulation of user actions - imitation of user pressing buttons, imitation of mouse movements. </li></ul><br>  In this article we will talk about the input / output of information - the main software modules of the poker bot. <br><br><h4>  Receiving the information </h4><br>  Here are our main sources of information: <br><ul><li>  Log files - for each client, this is individual, but often the actions (cards handed out, the actions of the players) are recorded in a log file, which you can constantly re-read from the disk and instantly receive the necessary information. </li><li>  API messages - here you can find a lot of useful information, the most interesting part is text output.  Almost all poker clients have a text element on the table, combining the functions of a chat and an information window.  If necessary, you can display all the information on the distribution (player actions, your cards, table cards, etc.).  It looks like this: <br><img src="https://habrastorage.org/storage/habraeffect/bf/34/bf34c36cd82771f1a2a88735bedd1964.jpg" alt="image"></li><li>  Hand history - when the option is enabled in the client, the history of all hands in which the player participates will be recorded in a separate file.  The problem is that this information can only be obtained after the fact, because it is recorded only after the end of the distribution itself. </li><li>  Client Screenshot - can be used to recognize both text (stakes, player nicknames) and graphic information (maps, button position). </li></ul><br>  The log file usually does not contain all the information on the distribution, for example, from the Pokerstars client log file (C: \ Program Files \ PokerStars \ PokerStars.log.0) you can find out only the cards that we were given and the dealer's position: <br><blockquote><code>MSG_TABLE_SUBSCR_ACTION <br> MSG_TABLE_SUBSCR_DEALPLAYERCARDS <br> sit0 <br> nCards=2 <br> sit1 <br> nCards=2 <br> sit2 <br> nCards=2 <br> sit3 <br> nCards=2 <br> sit4 <br> nCards=2 <br> sit5 <br> nCards=2 <br> dealerPos=3 <br> TableAnimation::dealPlayerCards <br> MSG_TABLE_PLAYERCARDS 000C0878 <br> ::: 11c <br> ::: 11d</code> </blockquote> <br>  11c, 11d are our cards (JcJd), and the dealer is in 3rd place. <br><br>  The way with API messages is quite simple to implement and often it can be used to get all the necessary information.  To implement it, you need to use the DLL injection into the poker client process.  The embedded DLL may be useful for simulating keystrokes and other information output.  The main disadvantage of the inject is that it is difficult to hide such an impact on the client if he tries to catch such attempts.  But the program cannot perceive all implementations as hacking, because these methods use quite honest programs, for example, the well-known Punto Switcher. <br><br>  There are several ways to implement a DLL: <br>  1. Implementation through the registry. <br>  2. Using traps (hooks). <br>  3. Deployment via remote stream <br>  4. Write directly to memory using WriteProcessMemory (), you can read more <a href="http://habrahabr.ru/blogs/cpp/95305/">here</a> . <br><br>  We consider the easiest and most convenient approach - the use of traps.  To do this, use the SetWindowsHookEx API function (idHook, lpfn, hMod, dwThreadId), where <br><br>  idHook - defines the type of capture procedure, for global interception, you need to use WH_CBT (for intercepting keyboard messages, for example, you can use WH_KEYBOARD); <br><br>  lpfn is a pointer to an interception procedure that will be called each time it is intercepted.  In it, we will catch the messages we need and perform the necessary actions; <br><br>  hMod is a DLL handle containing the lpfn procedure. <br><br>  dwThreadId - identifier of the thread on which the interceptor is set (0 for global interception). <br><br>  In our DLL, there must be a hook setting function and a function called when this hook is triggered: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">BOOL WINAPI SetHook() { <br> g_hook = SetWindowsHookEx(WH_CBT, (HOOKPROC) CBTProc, g_hinstDll, 0); <br> <font color="#0000ff">return</font> (g_hook != NULL); <br> } <br> <br> LRESULT WINAPI CBTProc( <font color="#0000ff">int</font> nCode, WPARAM wParam, LPARAM lParam) { <br> <br> <font color="#0000ff">if</font> (nCode &lt; 0) <br> <font color="#0000ff">return</font> CallNextHookEx(g_hHook, nCode, wParam, lParam); <br> <br> <font color="#0000ff">if</font> (nCode == HCBT_ACTIVATE) <br> { <br> <font color="#008000">//-    </font> <br> <font color="#008000">//..</font> <br> } <br> <font color="#0000ff">else</font> <font color="#0000ff">if</font> (nCode == HCBT_DESTROYWND) <br> { <br> <font color="#008000">//-    </font> <br> <font color="#008000">//..</font> <br> } <br> <font color="#0000ff">else</font> <font color="#0000ff">if</font> (nCode == HCBT_SETFOCUS) <br> { <br> <font color="#008000">//-    </font> <br> <font color="#008000">//..</font> <br> } <br> <br> <font color="#008000">//     </font> <br> <font color="#0000ff">return</font> (CallNextHookEx(g_hook, nCode, wParam, lParam)); <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  When installing a global interception, the DLL is embedded in each process in the system, so as not to consume a lot of memory because of this, the loading process can be divided into two parts.  First, a global DLL is implemented that takes up minimal memory and can only determine in which process it is loaded.  For the desired process, it uses <a href="http://msdn.microsoft.com/en-us/library/ms684175%2528VS.85%2529.aspx">LoadLibrary () to</a> load the second DLL in which the necessary functionality is implemented (map reading, logic, etc.). <br><br>  After interception, we can catch different API messages that are sent to the client.  For example, when outputting to the Rich Edit element (can be used to organize a chat), the EM_STREAMIN message is used.  And we can intercept it to get the text displayed in the chat, and with it the information on the distribution.  For each room, the element for displaying text can be individual, but the procedure is the same.  In general, it is very useful to use the Spy ++ program (most of you are familiar with it, it is included in the Visual Studio package) or an equivalent for researching API messages sent to the client.  With Spy ++ you can find out the headers of the windows we need and find out which API messages we need to intercept. <br><br>  Everything becomes complicated if the client uses some non-standard visual elements or non-standard ways of displaying information in them.  In this case, you need to use reverse engineering and look for this data in the process memory.  Because all the same, all textual information is stored somewhere in memory in the form of strings, we just need to find where. <br><br>  If it is impossible to arrange an interception (the client blocks such attempts) or we can‚Äôt find the information we need, we can use the screen capture and character recognition method.  But this method is best left to the extreme case, because it is more laborious and requires more resources at work.  Its main advantage is that this method will not be able to detect a poker client.  You can even run a poker bot on another computer (although the part responsible for pressing the keys should be on the computer with the client, but for this part it is not necessary to use the DLL injection) to which the video from the computer screen with the poker client is transmitted.  You can also run the client under the virtual machine, and the bot under the main OS.  Obvious disadvantages of the screen capture approach - the number of tables played is limited by the screen resolution and dependence on the theme of the cards and the table used in the client. <br><br><h4>  Simulation of user actions </h4><br>  When the bot presses buttons and other actions that imitate the behavior of an ordinary player, we need to achieve maximum likelihood.  In this case, you should use a random delay in the response of the bot, so as not to take all actions immediately after the start of the turn.  From <a href="http://habrahabr.ru/company/pokeroff/blog/95090/">the RNG article,</a> you can find out that the PokerStars poker room uses the user's mouse movements to generate random numbers.  At the same time, nothing prevents them from using this information to verify users (it is quite likely that other poker clients conduct such ‚Äúsurveillance‚Äù over their players).  Therefore, it is important to make random mouse movements around the screen and moving the cursor to the point where the buttons are pressed.  You can also make random clicks outside the poker client window (on the desktop, the taskbar). <br><br>  Therefore, it will be optimal to work with the mouse programmatically directly.  There is an option to find the handle of the desired buttons and send them a message using SendMessage (), but it is better to have minimal impact on the client itself, and do everything from the outside.  It turns out you need to find the local coordinates of the buttons in the window, for this you can use the same Spy ++.  If you configure it to catch mouse messages in the poker client, then when you click on the desired area, we will receive local click coordinates in the window.  Like that: <blockquote> <code>&lt;00227&gt; 00120644 P WM_LBUTTONDOWN fWKeys:MK_BUTTON xPos:840 yPos:103</code> </blockquote>  So you can find the coordinates of the rectangle inside the button, from which you randomly need to choose a point to click to simulate a person's behavior. <br><br>  To control the mouse, we will use the <a href="http://msdn.microsoft.com/en-us/library/ms646310%2528VS.85%2529.aspx">SendInput</a> API function <a href="http://msdn.microsoft.com/en-us/library/ms646310%2528VS.85%2529.aspx">(UINT nInputs, LPINPUT pInputs, int cbSize)</a> .  It is passed an array of <a href="http://msdn.microsoft.com/en-us/library/ms646270%2528v%3DVS.85%2529.aspx">INPUT</a> structures, which contains sequential actions with the mouse and keyboard.  This is how the code moves the mouse to a specific position and presses its left button: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">//   </font> <br> POINT coords; <br> coords.x = 840; <br> coords.y = 103; <br> <br> <font color="#008000">//   </font> <br> ClientToScreen(hWND, &amp;coords); <br> <br> <font color="#008000">//  </font> <br> HDC hdc = GetDC(NULL); <br> <font color="#0000ff">int</font> screenWidth = GetDeviceCaps(hdc, HORZRES); <br> <font color="#0000ff">int</font> screenHeight= GetDeviceCaps(hdc, VERTRES); <br> ReleaseDC(NULL, hdc); <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">double</font> worldCoords = 65535 * coords.x; <br> <font color="#0000ff">double</font> buttonX = worldCoords / screenWidth; <br> worldCoords = 65535 * coords.y; <br> <font color="#0000ff">double</font> buttonY = worldCoords / screenHeight; <br> <br> <font color="#008000">//    INPUT</font> <br> INPUT input[3]; <br> MOUSEINPUT mouseInput; <br> <br> <font color="#008000">//    </font> <br> input[0].type=INPUT_MOUSE; <br> mouseInput.dx = ( <font color="#0000ff">int</font> )buttonX; <br> mouseInput.dy = ( <font color="#0000ff">int</font> )buttonY; <br> mouseInput.mouseData = NULL; <br> mouseInput.dwFlags = MOUSEEVENTF_MOVE | MOUSEEVENTF_ABSOLUTE; <br> mouseInput.time = 0; <font color="#008000">//     1-2.</font> <br> mouseInput.dwExtraInfo = 1001; <br> input[0].mi = mouseInput; <br> <br> <font color="#008000">//    </font> <br> input[1].type=INPUT_MOUSE; <br> mouseInput.dx = ( <font color="#0000ff">int</font> )buttonX; <br> mouseInput.dy = ( <font color="#0000ff">int</font> )buttonY; <br> mouseInput.mouseData = NULL; <br> mouseInput.dwFlags = MOUSEEVENTF_LEFTDOWN | MOUSEEVENTF_ABSOLUTE; <br> mouseInput.time = 0; <font color="#008000">//     1-2.</font> <br> mouseInput.dwExtraInfo = 1001; <br> input[1].mi = mouseInput; <br> <br> <font color="#008000">//  ...</font> <br> input[2].type=INPUT_MOUSE; <br> mouseInput.dx = ( <font color="#0000ff">int</font> )buttonX; <br> mouseInput.dy = ( <font color="#0000ff">int</font> )buttonY; <br> mouseInput.mouseData = NULL; <br> mouseInput.dwFlags = MOUSEEVENTF_LEFTUP | MOUSEEVENTF_ABSOLUTE; <br> mouseInput.time = 0; <font color="#008000">//     1-2.</font> <br> mouseInput.dwExtraInfo = 1001; <br> input[2].mi = mouseInput; <br> <br> <font color="#0000ff">int</font> numberOfInputs = 2; <br> <br> <font color="#008000">//   INPUT</font> <br> SendInput(numberOfInputs, input, <font color="#0000ff">sizeof</font> (INPUT));</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This function can be used not only for any movement and pressing of buttons, but also for working with the keyboard.  To do this, you need to transfer a similar structure to KEYBDINPUT, although most often we will not need to use the keyboard. <br><br>  Here we have analyzed input and output information, which are the basis for all program actions of the bot.  In the next part, we will analyze the decision-making module - the basis of the bot's logic; consider the various strategies that can be applied to our program. <br><br>  Article <a href="http://www.pokeroff.ru/">Pokeroff.ru</a> specifically for Habrahabr </div><p>Source: <a href="https://habr.com/ru/post/96491/">https://habr.com/ru/post/96491/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96482/index.html">Parrot AR.Drone attacks in September, issue price: $ 300</a></li>
<li><a href="../96484/index.html">LG Display and iRiver have created a joint venture for the production of electronic books</a></li>
<li><a href="../96487/index.html">Duplication of information</a></li>
<li><a href="../96489/index.html">Fable 3 - exact release date and new video</a></li>
<li><a href="../96490/index.html">Is your phone still ringing? Then we go to you</a></li>
<li><a href="../96495/index.html">The case of the terminal QIWI</a></li>
<li><a href="../96496/index.html">Calculation of the calendar of periodic events taking into account holidays</a></li>
<li><a href="../96497/index.html">JAF Smartphone Firmware Manual</a></li>
<li><a href="../96499/index.html">Yahoo has taken over the Flicker.com domain</a></li>
<li><a href="../96500/index.html">Tt eSPORTS Challenger Pro or who put me on toys?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>