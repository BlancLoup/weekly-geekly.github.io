<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a REST service on Rust. Part 4: go to the REST API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we implemented the update database. 

 It remains to make only the REST interface. Let's do this. 

 Introduction 
 This part will be, perha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a REST service on Rust. Part 4: go to the REST API</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/post/267779/">Last time</a> we implemented the update database. <br><br>  It remains to make only the REST interface.  Let's do this. <br><br><h3>  Introduction </h3><br>  This part will be, perhaps, the most difficult - we will closely know the types of Send and Sync, as well as the subtleties of work closures and lifetimes.  In a different way, I would headline her ‚Äúbore explores why data must be cloned.‚Äù  It is useful in that it affects the thin spots of the Rust and shows the causes of some unobvious errors.  So if you want to understand thoroughly - welcome. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I also want to note: if something is incomprehensible to you regarding the above code or the explanations themselves seem not to be clear enough, feel free to write about it in the comments.  The author spent not a minute and not half an hour, trying to understand why the code works exactly in the form in which it was written, and had to go to the IRC and the forum for explanations more than once. <br><a name="habracut"></a><br><h3>  Review code in general </h3><br>  In principle, we want to add a new command that will launch a web server that provides the REST API of our phone book service.  We need to provide access points standard for <a href="https://ru.wikipedia.org/wiki/CRUD">CRUD</a> : GET records, GET records / id, POST records, PUT records / id and DELETE records / id.  To do this, we will use the <a href="http://ironframework.io/doc/router/struct.Router.html">router</a> from the <a href="http://ironframework.io/doc/iron/index.html">iron</a> framework.  Here is the code: <br><br><div class="spoiler">  <b class="spoiler_title">Command add code</b> <div class="spoiler_text"><pre><code class="rust hljs"><span class="hljs-string"><span class="hljs-string">"serve"</span></span> =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb = Arc::new(Mutex::new(db)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> router = router::Router::new(); { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.get(<span class="hljs-string"><span class="hljs-string">"/api/v1/records"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_records(sdb_.clone(), req)); } { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.get(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_record(sdb_.clone(), req)); } { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.post(<span class="hljs-string"><span class="hljs-string">"/api/v1/records"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::add_record(sdb_.clone(), req)); } { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.put(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::update_record(sdb_.clone(), req)); } { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.delete(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::delete_record(sdb_.clone(), req)); } Iron::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap(); }</code> </pre> <br></div></div><br>  This option works, but it looks pretty poor.  There are several ways to make it better, but first we will deal with what is happening here.  And rewrite it in the next section.  The implementation of the handlers will also be reviewed another time. <br><br><h3>  Wrapping database </h3><br>  In the above code, from the second line, something new: <br><br><pre> <code class="rust hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb = Arc::new(Mutex::new(db));</code> </pre><br>  db here is <a href="http://sfackler.github.io/rust-postgres/doc/v0.10.0/postgres/struct.Connection.html">postgres :: Connection</a> , i.e.  the object through which all the work with this database goes. <br>  We wrap it in a mutex, and we put the mutex in the atomic reference counter. <br><br>  What for?  For now, just remember that we want to provide synchronized access to the database from many threads - for this we use a mutex.  And in order to share the ownership of the object between several threads, we use the reference counter - the threads die at different moments, and the database will be destroyed when no one needs it anymore. <br><br>  This restriction is a consequence of the architecture of Iron.  A web server can process several requests in parallel, in several threads. <br><br><h3>  Defining API paths </h3><br>  Next, we define the path for GET requests: <br><br><pre> <code class="rust hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> router = router::Router::new(); { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.get(<span class="hljs-string"><span class="hljs-string">"/api/v1/records"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_records(sdb_.clone(), req)); }</code> </pre><br>  For this we use <a href="http://ironframework.io/doc/router/struct.Router.html">Router :: get ()</a> .  This method accepts the glob-pattern of the path (in this case, the entire path is specified rigidly, without variable components) and the request handler for this path. <br><br><h3>  Description Handler </h3><br>  A handler is any type that implements the <a href="http://ironframework.io/doc/iron/middleware/trait.Handler.html">Handler</a> type.  This type looks relatively simple: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Handler</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> + Any { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request) -&gt; IronResult&lt;Response&gt;; }</code> </pre><br>  Only one method is a handle that accepts a variable reference to the request and returns an HTTP response wrapped in IronResult. <br><br>  IronResult is a normal Result, in which errors are specialized for Iron itself: <br><br><pre> <code class="rust hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronResult</span></span></span></span>&lt;T&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Result</span></span>&lt;T, IronError&gt;; <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IronError</span></span></span></span> { ... }</code> </pre><br>  Now let's look at the definition of the type itself: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Handler</span></span></span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> + Any {</code> </pre><br>  This code we have not seen.  But only one part of the definition is new here: Send + Sync + Any. <br><br>  This record means that the implementation of the type Handler requires the implementation of the types Send, Sync and Any.  So we met with the pillar of Rust: Send and Sync.  Any time we are not interested. <br><br><h3>  Send and Sync </h3><br>  Let's start with sync. <br><br>  Values ‚Äã‚Äãthat implement <a href="https://doc.rust-lang.org/stable/std/marker/trait.Sync.html">Sync</a> can be safely changed from multiple threads simultaneously - i.e.  there is no data race. <br><br>  For example, <a href="https://doc.rust-lang.org/stable/std/sync/atomic/struct.AtomicIsize.html">std :: sync :: atomic :: AtomicIsize</a> is an atomic access integer.  This type implements Sync, so we can do <a href="https://doc.rust-lang.org/stable/core/atomic/struct.AtomicIsize.html">AtomicIsize :: fetch_add</a> from multiple threads. <br><br>  Further information about Sync is <a href="http://kgv.github.io/rust_book_ru/src/concurrency.html">here</a> . <br><br>  Please note that the possibility of synchronized access does not imply the possibility of transferring ownership of the value to another thread.  A type that implements Sync does not necessarily implement Send. <br><br>  Now more about <a href="https://doc.rust-lang.org/stable/std/marker/trait.Send.html">Send</a> .  This is a type marker implemented for types that can be safely transferred to other threads.  For example, a raw pointer cannot be passed: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T&gt; !<span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T</code> </pre><br>  ! Send here means "type is not implemented." <br><br>  Why do you need such a record?  Then, that Send is implemented for all types by default, if Send is implemented for their component parts.  The structure, all fields of which Send, is also Send (the same applies to Sync).  Types that are clearly insecure should ‚Äúunsubscribe‚Äù from the implementation of this type. <br><br>  The absence of Send (and Sync) is also distributed recursively - so if you use a type that does not implement Send inside, your default type will not implement it either. <br><br>  std :: sync :: atomic :: AtomicPtr can already be transferred to other threads: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T&gt; <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> AtomicPtr&lt;T&gt;</code> </pre><br>  At the household level, this means that the value can be given to another thread - for example, when running <a href="https://doc.rust-lang.org/stable/std/thread/fn.spawn.html">thread :: spawn</a> .  However, this does not mean that access from many threads is synchronized.  Send says only that the type must be moved to a memory accessible by another thread. <br><br>  Send and Sync often go hand in hand - types that implement one type implement the other simultaneously.  So, the above-mentioned AtomicPtr is a wrapper over atomic hardware operations, and because of this, it allows not only to transfer the value to another stream, but also to implement secure simultaneous access to the content.  AtomicPtr is synchronized - it also implements Sync. <br><br>  std :: sync :: mpsc :: Sender can also be passed to other threads: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T: <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Sender&lt;T&gt;</code> </pre><br>  However, Sender is a good example of the fact that a type can be sent to another stream, but it is not synchronized.  This is the structure that implements the sending side of the channel - there is the corresponding structure Receiver.  So, Sender can be transferred to the sending stream after creating a channel, but access to one Sender from many streams is denied. <br><br>  The &lt;T: Send&gt; record says that for data sent over the channel, the type Send should be implemented.  It is logical that in order for the data to be transmitted over the channel, they must be transferred to another stream <em>in principle</em> . <br><br>  Read more about the Send type <a href="http://kgv.github.io/rust_book_ru/src/concurrency.html">here</a> . <br><br>  Excellent, with types like sort out. <br><br><h3>  Why we wrapped the database </h3><br>  Take a look at our Arc and Mutex again: <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T&gt; <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Arc&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> + ?<span class="hljs-built_in"><span class="hljs-built_in">Sized</span></span> <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T&gt; <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Arc&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> T: <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> + ?<span class="hljs-built_in"><span class="hljs-built_in">Sized</span></span> <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T: ?<span class="hljs-built_in"><span class="hljs-built_in">Sized</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Mutex&lt;T&gt; <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span>&lt;T: ?<span class="hljs-built_in"><span class="hljs-built_in">Sized</span></span> + <span class="hljs-built_in"><span class="hljs-built_in">Send</span></span>&gt; <span class="hljs-built_in"><span class="hljs-built_in">Sync</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Mutex&lt;T&gt;</code> </pre><br>  That's why we wrapped db into a mutex: it makes the nested Send and Sync data synchronized and sent to another stream.  Only such data can be put in Arc.  Arc itself is again synchronized and can be transferred to another stream. <br><br>  ? Sized while we are unfamiliar - consider it another time. <br><br><h3>  Closures </h3><br>  Now look at our code again.  Here he is: <br><br><pre> <code class="rust hljs"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb = Arc::new(Mutex::new(db)); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> router = router::Router::new(); { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.get(<span class="hljs-string"><span class="hljs-string">"/api/v1/records"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_records(sdb_.clone(), req)); }</code> </pre><br>  The second argument .get () is a closure.  Consider it separately: <br><br><pre> <code class="rust hljs"> <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_records(sdb_.clone(), req));</code> </pre><br>  Let's start with the arguments - they are inside the vertical lines.  We take one argument req, which is a variable reference to the request.  We have such arguments, because, as you remember, Iron's Handler must have a signature <br><br><pre> <code class="rust hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request) -&gt; IronResult&lt;Response&gt;;</code> </pre><br>  The body of the closure simply makes the call to handlers :: get_records.  To this function, we pass the closure argument and a copy of our Arc &lt;Mutex&gt; as part of the environment. <br><br>  Why copy?  Now will be the most interesting. <br><br><h3>  Let's try not to clone data </h3><br>  To understand this, let's think about what would happen if we passed not a copy to the closure, but sdb_ itself.  Like this: <br><br><pre> <code class="rust hljs"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.get(<span class="hljs-string"><span class="hljs-string">"/api/v1/records"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">move</span></span> |req: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Request| handlers::get_records(sdb_, req)); }</code> </pre><br>  What does rustc say to this? <br><br><pre> main.rs:120:32: 122: 69 error: the trait `for &lt;'r,' r, 'r&gt; core :: ops :: Fn &lt;(&amp;' r mut iron :: request :: Request &lt;'r , 'r&gt;,)&gt; `not for the type of [closure@main.rs: 121: 36: 122: 68 sdb_: alloc :: arc :: Arc &lt;std :: sync :: mutex :: Mutex &lt; postgres :: Connection &gt;&gt;] `[E0277]
 main.rs:120 router.get ("/ api / v1 / records",
 main.rs:121 move | req: &amp; mut Request |
 main.rs:122 handlers :: get_records (sdb_, req));
 main.rs:120:32: 122: 69 help: run `rustc --explain E0277` to see a detailed explanation
</pre><br>  It can be seen, he is very unhappy. <br><br>  What is the essence of the error?  The type Fn (&amp; mut Request,) is not implemented for our closure.  What is this type? <br><br><h3>  Features of the implementation of closures </h3><br>  This is a type implemented for closures that can be called multiple times.  Why is it important to know how many times a closure will be caused?  Because if you move possession of something from a closure, you can only do it once.  Next time there will be no place to move ownership.  In this case, your closure implements FnOnce, but not Fn.  In our code, we move a copy of sdb_ to the handler itself ‚Äî handlers :: get_records, since  he accepts <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <code class="rust"> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <code class="rust"> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><code class="rust"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <code class="rust"> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code></code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <code class="rust"> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <code class="rust"> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <pre> <code class="hljs swift"><code class="rust"><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust"><span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&gt;  .       ,    . <br> <br>     ,     ?    <span class="hljs-type"><span class="hljs-type">Rust</span></span>      |x| x + <span class="hljs-number"><span class="hljs-number">1</span></span> -   .        - ,     .    . <br> <br>       <span class="hljs-type"><span class="hljs-type">Fn?</span></span> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-type"><span class="hljs-type">Iron'</span></span>   <span class="hljs-type"><span class="hljs-type">Fn</span></span>: <br> <br> impl&lt;<span class="hljs-type"><span class="hljs-type">F</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-type"><span class="hljs-type">F</span></span>: <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { fn handle(&amp;<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Response</span></span>&gt; { (*<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>)(req) } }</code> <br> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> -         . ,   <span class="hljs-type"><span class="hljs-type">F</span></span>,    <span class="hljs-type"><span class="hljs-type">Send</span></span> + <span class="hljs-type"><span class="hljs-type">Sync</span></span> + <span class="hljs-type"><span class="hljs-type">Any</span></span> + <span class="hljs-type"><span class="hljs-type">Fn</span></span>(&amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>) -&gt; <span class="hljs-type"><span class="hljs-type">IronResult</span></span>. <br> <br> ,  <span class="hljs-type"><span class="hljs-type">Handler</span></span>    <span class="hljs-type"><span class="hljs-type">Fn</span></span>. <span class="hljs-type"><span class="hljs-type">Iron</span></span>, ,    :    -    ,    . <br> <br>          <span class="hljs-type"><span class="hljs-type">Rust!</span></span>  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> error: closure may outlive the current function, but it borrows `sdb_`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> owned by the current function [<span class="hljs-type"><span class="hljs-type">E0373</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span> |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0373</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">58</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">62</span></span> note: `sdb_` <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> borrowed here main.rs:<span class="hljs-number"><span class="hljs-number">122</span></span> handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:<span class="hljs-number"><span class="hljs-number">121</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">122</span></span>:<span class="hljs-number"><span class="hljs-number">76</span></span> help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> shown: main.rs: move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   <span class="hljs-type"><span class="hljs-type">Iron</span></span>      .      ,       ,   ,  -   main,    . <br> <br> <span class="hljs-type"><span class="hljs-type">Rust</span></span>       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> error: use of moved value: `sdb` [<span class="hljs-type"><span class="hljs-type">E0382</span></span>] main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); ^~~ main.rs:<span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">36</span></span>: <span class="hljs-number"><span class="hljs-number">125</span></span>:<span class="hljs-number"><span class="hljs-number">39</span></span> help: run `rustc --explain <span class="hljs-type"><span class="hljs-type">E0382</span></span>` to see a detailed explanation main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">29</span></span>: <span class="hljs-number"><span class="hljs-number">119</span></span>:<span class="hljs-number"><span class="hljs-number">33</span></span> note: `sdb` moved here because it has type `alloc::arc::<span class="hljs-type"><span class="hljs-type">Arc</span></span>&lt;std::sync::mutex::<span class="hljs-type"><span class="hljs-type">Mutex</span></span>&lt;postgres::<span class="hljs-type"><span class="hljs-type">Connection</span></span>&gt;&gt;`, which <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> moved by <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> main.rs:<span class="hljs-number"><span class="hljs-number">119</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb; ^~~~ <br>     . , ,      <span class="hljs-type"><span class="hljs-type">GET</span></span>/id: <br> <br> <code class="rust"> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> sdb_ = sdb.clone(); router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"/api/v1/records/:id"</span></span>, move |req: &amp;mut <span class="hljs-type"><span class="hljs-type">Request</span></span>| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   <span class="hljs-type"><span class="hljs-type">Router'</span></span>,      <span class="hljs-type"><span class="hljs-type">URL</span></span>   ,    . <br> <br>     <span class="hljs-type"><span class="hljs-type">HTTP</span></span>-   <span class="hljs-type"><span class="hljs-type">Router'</span></span>   : <br> <br> <span class="hljs-type"><span class="hljs-type">Iron</span></span>::new(router).http(<span class="hljs-string"><span class="hljs-string">"localhost:3000"</span></span>).unwrap(); <br> <br>  <br>    ? !     ,      <em></em>     <span class="hljs-type"><span class="hljs-type">Rust</span></span>.                ,         - <span class="hljs-type"><span class="hljs-type">Mutex</span></span>  <span class="hljs-type"><span class="hljs-type">Arc</span></span>. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code></code> </pre> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> <h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </h3> <code><a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <a href="http://kgv.github.io/rust_book_ru/src/closures.html"></a> <code class="rust">Arc&lt;Mutex&gt;  .       ,    . <br> <br>     ,     ?    Rust      |x| x + 1 -   .        - ,     .    . <br> <br>       Fn? ,  Handler Iron'   Fn: <br> <br> impl&lt;F&gt; Handler for F where F: Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult&lt;Response&gt; { fn handle(&amp;self, req: &amp;mut Request) -&gt; IronResult&lt;Response&gt; { (*self)(req) } }</code> <br> where -         . ,   F,    Send + Sync + Any + Fn(&amp;mut Request) -&gt; IronResult. <br> <br> ,  Handler    Fn. Iron, ,    :    -    ,    . <br> <br>          Rust!  . <br> <br>     <br>      - move    . move ,       ,     .  move     : <br> <br> main.rs:121:36: 122:76 error: closure may outlive the current function, but it borrows `sdb_`, which is owned by the current function [E0373] main.rs:121 |req: &amp;mut Request| main.rs:122 handlers::get_records(sdb_.clone(), req)); main.rs:121:36: 122:76 help: run `rustc --explain E0373` to see a detailed explanation main.rs:122:58: 122:62 note: `sdb_` is borrowed here main.rs:122 handlers::get_records(sdb_.clone(), req)); ^~~~ main.rs:121:36: 122:76 help: to force the closure to take ownership of `sdb_` (and any other referenced variables), use the `move` keyword, as shown: main.rs: move |req: &amp;mut Request| main.rs: handlers::get_records(sdb_.clone(), req)); error: aborting due to previous error <br>    sdb_,      main -   Iron      .      ,       ,   ,  -   main,    . <br> <br> Rust       . . <br> <br>   <br>     :      sdb ? <br> <br> <code class="rust"> let sdb_ = sdb.clone();</code> <br>             : <br> <br> main.rs:125:36: 125:39 error: use of moved value: `sdb` [E0382] main.rs:125 let sdb_ = sdb.clone(); ^~~ main.rs:125:36: 125:39 help: run `rustc --explain E0382` to see a detailed explanation main.rs:119:29: 119:33 note: `sdb` moved here because it has type `alloc::arc::Arc&lt;std::sync::mutex::Mutex&lt;postgres::Connection&gt;&gt;`, which is moved by default main.rs:119 let sdb_ = sdb; ^~~~ <br>     . , ,      GET/id: <br> <br> <code class="rust"> { let sdb_ = sdb.clone(); router.get("/api/v1/records/:id", move |req: &amp;mut Request| handlers::get_record(sdb_.clone(), req)); }</code> <br>       :id,   Router',      URL   ,    . <br> <br>     HTTP-   Router'   : <br> <br> <code class="rust"> Iron::new(router).http("localhost:3000").unwrap();</code> <br> <br>  <br>    ? !     ,      <em></em>     Rust.                ,         - Mutex  Arc. <br> <br>      -      <a href="https://gitter.im/ruRust/general"></a> .</code> </div><p>Source: <a href="https://habr.com/ru/post/268617/">https://habr.com/ru/post/268617/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268607/index.html">Volker Simonis - Interiors of SAP JVM [Meeting JUG in St. Petersburg]</a></li>
<li><a href="../268609/index.html">Rust in details: we write scalable chat from scratch, part 1</a></li>
<li><a href="../268611/index.html">The digest of interesting materials for the mobile # 124 developer (October 5-11)</a></li>
<li><a href="../268613/index.html">Using hardlinks (hardlink) for Synology DSM incremental backup</a></li>
<li><a href="../268615/index.html">Programming with YII2: get down to work</a></li>
<li><a href="../268619/index.html">Ode to a good vendor: choose a platform for launching a VoIP SaaS project</a></li>
<li><a href="../268621/index.html">Server clustering of markers on the map. From theory to practice</a></li>
<li><a href="../268623/index.html">Email Privacy Notice: Not a Good Idea</a></li>
<li><a href="../268625/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ180 (October 5 - 11, 2015)</a></li>
<li><a href="../268627/index.html">CQRS Types</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>