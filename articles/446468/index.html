<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A practical guide on environment variables in Go</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to you the translation of the article A Go to Enda Phelan. 

 Environment variables are the best way to store application configur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A practical guide on environment variables in Go</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I present to you the translation of the article <a href="https://endaphelan.me/guides/golang/a-no-nonsense-guide-to-environment-variables-in-go/">A Go</a> to Enda Phelan. <br><br>  Environment variables are the best way to store application configurations, since they can be set at the system level.  This is one of the principles of the <a href="https://12factor.net/config">Twelve-Factor App</a> methodology, it allows you to separate applications from the system in which they are running (the configuration can vary significantly between deployments, the code should not differ). <br><a name="habracut"></a><br><h3>  Using environment variables </h3><br>  All that is needed to interact with environment variables is in the standard <a href="https://golang.org/pkg/os/">os</a> library.  This is how you can get the value of the PATH environment variable: <br><br><pre><code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Store the PATH environment variable in a variable path, exists := os.LookupEnv("PATH") if exists { // Print the value of the environment variable fmt.Print(path) } }</span></span></code> </pre> <br>  And so - set the value of the variable: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// Set the USERNAME environment variable to "MattDaemon" os.Setenv("USERNAME", "MattDaemon") // Get the USERNAME environment variable username := os.Getenv("USERNAME") // Prints out username environment variable fmt.Print(username) }</span></span></code> </pre><br><h3>  Loading environment variables from a .env file </h3><br>  On a developer machine, where many projects are immediately launched, it is not always convenient to store parameters in variable environments;  It would be more logical to divide them between projects using env-files.  You can do this, for example, with the help of <a href="https://github.com/joho/godotenv">godotenv</a> - this is the Ruby library <a href="https://github.com/bkeepers/dotenv">dotenv</a> ported to Go.  It allows you to set the necessary for the application environment variables from the .env file. <br><br>  To install the package, run: <br><br><pre> <code class="bash hljs">go get github.com/joho/godotenv</code> </pre> <br>  Add settings to the .env file in the project root: <br><br><pre> <code class="bash hljs">GITHUB_USERNAME=craicoverflow GITHUB_API_KEY=TCtQrZizM1xeo1v92lsVfLOHDsF7TfT5lMvwSno</code> </pre><br>  Now you can use these values ‚Äã‚Äãin the application: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/joho/godotenv"</span></span> <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"os"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">// init is invoked before main() func init() { // loads values from .env into the system if err := godotenv.Load(); err != nil { log.Print("No .env file found") } } func main() { // Get the GITHUB_USERNAME environment variable githubUsername, exists := os.LookupEnv("GITHUB_USERNAME") if exists { fmt.Println(githubUsername) } // Get the GITHUB_API_KEY environment variable githubAPIKey, exists := os.LookupEnv("GITHUB_API_KEY") if exists { fmt.Println(githubAPIKey) } }</span></span></code> </pre><br>  It is important to remember that if the value of the environment variable is set at the system level, Go will use this value instead of the one specified in the env file. <br><br><h3>  Wrapping environment variables in a configuration module </h3><br>  It is nice, of course, to have access to environment variables directly, as was shown above, but to support such a solution seems rather problematic.  The name of a variable is a string, and if it changes, then imagine a headache in which the process of updating references to a variable throughout an application will result. <br><br>  To solve this problem, create a configuration module for working with environment variables in a more centralized and supported way. <br><br>  Here is a simple <b>config</b> module that returns the configuration parameters in the <b>Config</b> structure (also set the default values ‚Äã‚Äãfor the parameters in case the environment variable does not appear in the system): <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"os"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GitHubConfig <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Username <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> APIKey <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { GitHub GitHubConfig } <span class="hljs-comment"><span class="hljs-comment">// New returns a new Config struct func New() *Config { return &amp;Config{ GitHub: GitHubConfig{ Username: getEnv("GITHUB_USERNAME", ""), APIKey: getEnv("GITHUB_API_KEY", ""), }, } } // Simple helper function to read an environment or return a default value func getEnv(key string, defaultVal string) string { if value, exists := os.LookupEnv(key); exists { return value } return defaultVal }</span></span></code> </pre><br>  Next, we add types to the <b>Config</b> structure, since the existing solution only supports string types, which is not very reasonable for large applications. <br><br>  Create handlers for bool, slice and integer types: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> config <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"os"</span></span> <span class="hljs-string"><span class="hljs-string">"strconv"</span></span> <span class="hljs-string"><span class="hljs-string">"strings"</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> GitHubConfig <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { Username <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> APIKey <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> Config <span class="hljs-keyword"><span class="hljs-keyword">struct</span></span> { GitHub GitHubConfig DebugMode <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> UserRoles []<span class="hljs-keyword"><span class="hljs-keyword">string</span></span> MaxUsers <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> } <span class="hljs-comment"><span class="hljs-comment">// New returns a new Config struct func New() *Config { return &amp;Config{ GitHub: GitHubConfig{ Username: getEnv("GITHUB_USERNAME", ""), APIKey: getEnv("GITHUB_API_KEY", ""), }, DebugMode: getEnvAsBool("DEBUG_MODE", true), UserRoles: getEnvAsSlice("USER_ROLES", []string{"admin"}, ","), MaxUsers: getEnvAsInt("MAX_USERS", 1), } } // Simple helper function to read an environment or return a default value func getEnv(key string, defaultVal string) string { if value, exists := os.LookupEnv(key); exists { return value } return defaultVal } // Simple helper function to read an environment variable into integer or return a default value func getEnvAsInt(name string, defaultVal int) int { valueStr := getEnv(name, "") if value, err := strconv.Atoi(valueStr); err == nil { return value } return defaultVal } // Helper to read an environment variable into a bool or return default value func getEnvAsBool(name string, defaultVal bool) bool { valStr := getEnv(name, "") if val, err := strconv.ParseBool(valStr); err == nil { return val } return defaultVal } // Helper to read an environment variable into a string slice or return default value func getEnvAsSlice(name string, defaultVal []string, sep string) []string { valStr := getEnv(name, "") if valStr == "" { return defaultVal } val := strings.Split(valStr, sep) return val }</span></span></code> </pre><br>  Add new environment variables to our env-file: <br><br><pre> <code class="bash hljs">GITHUB_USERNAME=craicoverflow GITHUB_API_KEY=TCtQrZizM1xeo1v92lsVfLOHDsF7TfT5lMvwSno MAX_USERS=10 USER_ROLES=admin,super_admin,guest DEBUG_MODE=<span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Now you can use them anywhere in the application: <br><br><pre> <code class="go hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> main <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ( <span class="hljs-string"><span class="hljs-string">"fmt"</span></span> <span class="hljs-string"><span class="hljs-string">"log"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/craicoverflow/go-environment-variables-example/config"</span></span> <span class="hljs-string"><span class="hljs-string">"github.com/joho/godotenv"</span></span> ) <span class="hljs-comment"><span class="hljs-comment">// init is invoked before main() func init() { // loads values from .env into the system if err := godotenv.Load(); err != nil { log.Print("No .env file found") } } func main() { conf := config.New() // Print out environment variables fmt.Println(conf.GitHub.Username) fmt.Println(conf.GitHub.APIKey) fmt.Println(conf.DebugMode) fmt.Println(conf.MaxUsers) // Print out each role for _, role := range conf.UserRoles { fmt.Println(role) } }</span></span></code> </pre><br><h3>  Done! </h3><br>  Yes, there are packages that offer a ready-made solution for configuring your application, but how necessary are they, if it is so easy to do it yourself? <br><br>  How do you manage the configuration in your application? </div><p>Source: <a href="https://habr.com/ru/post/446468/">https://habr.com/ru/post/446468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../446458/index.html">Universal DRO based on Arduino Nano - shDRO. Part 2</a></li>
<li><a href="../446460/index.html">Product Design Digest March 2019</a></li>
<li><a href="../446462/index.html">Immersion in the driver: the general principle of the reverse example of the task NeoQUEST-2019</a></li>
<li><a href="../446464/index.html">15 parrots: choose a hosting provider for VPS / VDS servers</a></li>
<li><a href="../446466/index.html">Content marketing for business: habraseminar # 6 and its main points</a></li>
<li><a href="../446470/index.html">Released the world's first propeller, created on a 3D printer</a></li>
<li><a href="../446472/index.html">Global update of the results display Lamptest.ru</a></li>
<li><a href="../446476/index.html">Plans for Angular 8.0 and Ivy</a></li>
<li><a href="../446480/index.html">Corporate insecurity</a></li>
<li><a href="../446482/index.html">Excursion to the World Seed Vault (Global Seeds Vault) or Doomsday Vault</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>