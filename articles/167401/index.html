<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>libStorageMgmt - universal storage management library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to talk about a young, but promising library, born in the Redhat company, designed to make life easier for sysadmins of large and heterogeneous...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>libStorageMgmt - universal storage management library</h1><div class="post__text post__text-html js-mediator-article">  I want to talk about a young, but promising library, born in the Redhat company, designed to make life easier for sysadmins of large and heterogeneous data centers.  The library works with data stores from different manufacturers (currently Linux, NetApp, Nexenta, EMC) using the same commands.  For example, to create a file system on any of the repositories, it is enough to run: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># LSMCLI_URI=nstor://admin@192.168.1.138/ lsmcli --create-fs=test --pool=data --size=5G</span></span></code> </pre> <br><a name="habracut"></a><br>  LSMCLI_URI is the destination address of the command.  Depending on the ‚Äúprotocol‚Äù (nstor: //), lsmcli understands with what type of storage it is necessary to communicate and download the appropriate plugin.  The plugin does all the necessary work. <br><br>  All lsm commands can be divided into 3 categories: <br><ul><li>  Work with file systems (creation, listing, deletion) </li><li>  create, delete, delete NFS exports </li><li>  work with volumes (iSCSI), assignment of rights for initiators </li></ul><br>  LibStorageMgmt is designed so that it does not store inside any states and values.  This is done because of possible actions on the repository itself bypassing the library.  Running the command performs a full cycle of necessary operations on the storage and immediately gives the result (a timeout is provided). <br><br>  At the request of Nexenta, I developed a plugin for this library.  I want to share my experience, and most importantly, to call for developing plug-ins for other repositories! 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is quite simple to do this, and is described in detail in the documentation.  I will not repeat the texts, I will give only a couple of links: <br><ul><li>  Using the <a href="http://sourceforge.net/p/libstoragemgmt/wiki/GettingStarted/">sourceforge.net/p/libstoragemgmt/wiki/GettingStarted</a> Library </li><li>  Developing <a href="http://sourceforge.net/p/libstoragemgmt/wiki/WritingPlugins/">sourceforge.net/p/libstoragemgmt/wiki/WritingPlugins</a> plugin </li></ul><br>  I will give an example of a template in Python (you can also write in C), filling in which you can get a full-fledged plugin: <br>  File number 1.  lsm / anystorage_plugin: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> lsm.anystorage <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> AnyStorage <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> lsm.pluginrunner <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PluginRunner <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: PluginRunner(AnyStorage, sys.argv).run()</code> </pre><br>  File number 2.  lsm / lsm / anystorage.py: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urllib2 <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> urlparse <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> simplejson <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64 <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> iplugin <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> INfs, IStorageAreaNetwork <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Pool, FileSystem, Snapshot, Capabilities, System, \ NfsExport, Volume, Initiator, AccessGroup <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> common <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LsmError, ErrorNumber, md5 <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AnyStorage</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(INfs, IStorageAreaNetwork)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.password = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> self.timeout = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startup</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, uri, password, timeout, flags = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.password = password <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'default_pass'</span></span> self.timeout = timeout <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pools</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, flags = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> pools = [] <span class="hljs-comment"><span class="hljs-comment"># Add pools here # ... return pools</span></span></code> </pre><br><br>  The plugin will return a list of pools.  The pools () function must return a list of pool class objects.  Next, lsm processes the list itself and displays it (for lsmcli -l POOLS).  Similar classes exist for file systems, snapshots, etc. <br><br>  Description of all other functions can be found in the declaration INfs, IStorageAreaNetwork (file lsm / lsm / iplugin.py). <br><br>  If you need to crash, you must create an exception based on the LsmError class: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> LsmError(ErrorNumber.INVALID_SS, <span class="hljs-string"><span class="hljs-string">"Cant'create snapshot %s"</span></span> % snapshot_name)</code> </pre><br><br>  Most functions must return None upon successful completion, or job_id upon long execution.  An example of a lengthy command: replication, which can take minutes and hours.  In the case of using job_id, you will need to implement a couple of functions that will allow you to monitor job'ami (job_status (), job_free ()). <br><br>  In general, the lsm library code is well documented and has a very clear structure. <br><br>  libStorageMgmt is so young that not even all the functions of working with LVM Linux are implemented.  It's only the beginning! </div><p>Source: <a href="https://habr.com/ru/post/167401/">https://habr.com/ru/post/167401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../167389/index.html">RetroArch - we play a variety of video game games on Android</a></li>
<li><a href="../167391/index.html">Interplanetary automatic station "Habr-1"</a></li>
<li><a href="../167393/index.html">On the infidelity of generalizations, or each programmer is unique</a></li>
<li><a href="../167395/index.html">Valid sturgeon freshness data</a></li>
<li><a href="../167399/index.html">‚ÄúPeople, where are you?‚Äù Or how to search for the first users of a startup</a></li>
<li><a href="../167403/index.html">How to transfer data to 54 kilometers, if there is no 220V in the closet?</a></li>
<li><a href="../167407/index.html">11 important things you need to know about DevOps - part two</a></li>
<li><a href="../167411/index.html">The $ 1M grants line has been awarded to Russian startups by the Microsoft Seed Fund</a></li>
<li><a href="../167413/index.html">Briefly about the new: Samsung Music Hub service will be available on all Android devices</a></li>
<li><a href="../167415/index.html">Blah blah blah - book and guide to action</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>