<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Theory about hiding processes by rootkits (DKOM)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will try to consider in theory one of the most serious methods of hiding information by rootkits, namely direct kernel object manip...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Theory about hiding processes by rootkits (DKOM)</h1><div class="post__text post__text-html js-mediator-article"> In this article we will try to consider in theory one of the most serious methods of hiding information by rootkits, namely direct kernel object manipulation <i>(DKOM</i> ), used to conceal processes from the operating system as a whole.  If you are a <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BA%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582-%25D0%25BA%25D0%25B8%25D0%25B4%25D0%25B4%25D0%25B8">script kiddie</a> , then read ‚Äúwe are hiding processes in Windows!‚Äù. <a name="habracut"></a>  Start over: <br>  In our case, the <i>rootkit</i> is a kernel module (in the case of <a href="http://ru.wikipedia.org/wiki/Windows">Windows</a> , a driver) used to expand the capabilities of managing the operating system (after all, <a href="http://ru.wikipedia.org/wiki/Root_(%25D1%2581%25D1%2583%25D0%25BF%25D0%25B5%25D1%2580%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C)">root</a> and kit).  We will not distinguish whether the administrator or the attacker uses it.  The rootkit runs on the zero ring (the so-called <a href="http://ru.wikipedia.org/wiki/Ring0">ring0</a> ) of the operating system.  In the case of Windows, it requires correct (not necessarily documented methods) installation in the system, which, as a rule, requires administrator rights.  Note that by <i>objects</i> we mean in-memory <i>structures</i> that describe one process in the operating system (I will shift the blame for the confusion in terms to the documentation from Microsoft).  In RAM, information about running processes is stored in a doubly linked list of these very objects. <br><br>  <b>Closer to the code</b> <br>  <i>Actually for WinXP, on the rest that are older than NT, I think the same.</i> <br>  And so, we are already in ring0 (how we got here is another story).  We are a processor based on the code of the implemented driver and we got into the function of hiding the process with one argument - pid using DKOM.  To get to the legendary doubly linked list of processes, we need to find at least one item from this list.  Search by brute force is not rational, especially when we can find a pointer to our own process.  Let's see how we do it.  In the course of the code, we encounter the PsGetCurrentProcces function.  Fortunately, we are a processor and we know that this is nothing more than <br><br> <code>mov eax, fs:0x00000124 <br> mov eax, [eax + 0x44] <br> ret</code> <br> <br>  In the fs register at offset 0x124, nothing more than the current flow <a href="http://www.nirsoft.net/kernel_struct/vista/ETHREAD.html">ETHREAD</a> structure, in which at offset 0x44 there is a pointer to the structure of the process that owns this thread.  This way we get a pointer to our process.  Then everything is simple.  In each structure there is a pointer to the previous and the next process in the process chain.  Run over the signs to the process with the required pid.  When executing a trivial manipulation of pointers, excluding the process from the doubly-connected list makes the OS forget about the existence of the process (at least while it is watching with its ordinary methods).  Ares on the hidden process, you can remember, in case we want to return it to the system. <br>  Anticipating the question, I answer: the hidden process continues to function normally because the OS allocates processor time not to processes but to threads. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Conclusions</b> <br>  In principle, the detection of this fraud is not an impossible task.  However, most antiviruses arrive in peace of mind, both when contemplating the driver itself and during its execution. <br>  This is not the only method of hiding processes by rootkits.  But DKOM stands out among them as one of the most imperceptible (probably not for long it will be), since it works directly on the processed data, and not on the means of processing it.  Also note that DKOM is relevant not only for processes. <br><br>  <b>PS</b> <br>  Everything is rather abstracted in order to bring information to the widest possible circle.  It would not be nice to load with technical details not for everyone, but for those who are interested, they can easily be naked. <br>  I thought for a long time which blog I should take, I chose between system programming and this.  But the topic of programming here is almost not disclosed, so I chose this one as information about how it happens ... <br><br>  If it will be interesting, I will tell about other popular methods. </div><p>Source: <a href="https://habr.com/ru/post/118483/">https://habr.com/ru/post/118483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../118475/index.html">How to become a system administrator - a guide for beginners (Part 1)</a></li>
<li><a href="../118478/index.html">The number of free applications in the Android Market has exceeded the number of the same in the AppStore</a></li>
<li><a href="../118479/index.html">On-Line Broadcasting with Linux InstallFest in Nizhny Novgorod</a></li>
<li><a href="../118481/index.html">50% click fraud on Yandex.Market or how to detect click fraud using standard tools</a></li>
<li><a href="../118482/index.html">Sliding screens inside the app</a></li>
<li><a href="../118485/index.html">FreeBSD 8.2, Samba 3.4, Active Directory and Cyrillic Logins</a></li>
<li><a href="../118487/index.html">Scrum Pitfalls - Motley Frames</a></li>
<li><a href="../118488/index.html">Using the SPI mechanism to create extensions</a></li>
<li><a href="../118489/index.html">Flying superhero</a></li>
<li><a href="../118491/index.html">Take a picture of the offense and put it online anonymously</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>