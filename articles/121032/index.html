<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacking Matan Captcha in C # is Easy!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic, I want to tell you about hacking a so-called. ‚ÄúMatan-Captcha‚Äù, an example of which was presented in a recent topic Matanova Captcha in ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacking Matan Captcha in C # is Easy!</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/1a5b7575/56947f50/20c06c33/dcf2e9b5.png" align="left">  In this topic, I want to tell you about hacking a so-called.  ‚ÄúMatan-Captcha‚Äù, an example of which was presented in a recent topic <a href="http://habrahabr.ru/blogs/php/120646/">Matanova Captcha in PHP - it's easy!</a>  . <br>  After reading the author's article about this wonderful captcha, I wanted to write a program for its recognition, as they say just for fun;) <br><a name="habracut"></a><br><br>  Let's start with the standard preparatory procedure, namely: the search for vulnerabilities.  Vulnerabilities marked in italics are not used in recognition. <br><br>  <b>Weak sides:</b> <br><ol><li>  Black symbols on white background. </li><li>  No noise and other artifacts (for example, lines). </li><li>  Symbols never intersect. </li><li>  Always the same font. </li><li>  <i>Under the integral is always 4 terms.</i> </li><li>  Degrees and multipliers are one digit. </li><li>  <i>Degrees and multipliers range from 2 to 5.</i> </li></ol>  <b>The strengths include:</b> <br><ol><li>  The presence of nonlinear distortion. </li><li>  Possible lack of degree or multiplier x. </li><li>  Sometimes, dx stick together in one character. </li><li>  Changing the width of the captcha. </li></ol>  <b>Let's make recognition algorithm:</b> <br><ol><li>  Get a bitmap captcha image. </li><li>  Number all characters. </li><li>  Find the coordinates of the upper and lower limits. </li><li>  Recognize the characters that make up the limits using a neural network. </li><li>  Find the first character of the integrand. </li><li>  Alternately recognizing characters, move right to the last character. </li><li>  Solve the resulting integral. </li></ol><br><h4>  Source captcha </h4><br><img src="https://habrastorage.org/storage/c40ce7b0/f41b8c61/99e5be33/d2b5cc10.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Bitmap image </h4><br>  Per unit we will consider a pixel whose brightness according to the color model HSB &lt;0.8, zero, respectively&gt; = 0.8.  After that, the captcha will take the following form: <br><img src="https://habrastorage.org/storage/5bf5b7cc/887cf6d1/5f91f762/ec7548eb.png"><br><br><h4>  Character numbering </h4><br>  In order to enumerate all the symbols, we use the simplest recursive <a href="http://en.wikipedia.org/wiki/Flood_fill">Flood fill</a> algorithm to highlight the connected regions in 8 directions. <br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FloodFill</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">[,] source, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> num, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (source[x, y] == <span class="hljs-number"><span class="hljs-number">-1</span></span>) { source[x, y] = num; FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y - <span class="hljs-number"><span class="hljs-number">1</span></span>); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x - <span class="hljs-number"><span class="hljs-number">1</span></span>, y + <span class="hljs-number"><span class="hljs-number">1</span></span>); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x, y - <span class="hljs-number"><span class="hljs-number">1</span></span>); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x, y + <span class="hljs-number"><span class="hljs-number">1</span></span>); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y - <span class="hljs-number"><span class="hljs-number">1</span></span>); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y); FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> source, num, x + <span class="hljs-number"><span class="hljs-number">1</span></span>, y + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ++num; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num; } ... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> num = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span>; x &lt; CaptchaWidth; x++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span>; y &lt; CaptchaHeight; y++) num = FloodFill(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> bit, num, x, y);</code> </pre> <br><h4>  Character Recognition </h4><br>  Considering non-linear distortions and differing character sizes, the best option for recognizing them is an artificial neural network.  To make things a little easier, I used the <a href="http://leenissen.dk/">Fast Artificial Neural Network Library</a> free library.  It is written in C ++, and is good in that it has interfaces for almost all popular programming languages, <a href="http://code.google.com/p/fanndotnetwrapper/">including C #</a> . <br><br>  All characters, before recognition, are reduced to the same size: in this case, 16px x 21px. <br>  Thus, an array of 336 elements (16 * 21) will be fed to the input of the neural network.  Each element sets the color of the corresponding pixel as an integer: 0 or 1. <br>  The middle layer consists of 130 neurons.  And at the output is an array of 14 elements with real values ‚Äã‚Äãfrom 0 to 1, corresponding to numbers from 0 to 9, the +, d, x, and stuck dx signs. <br><br>  The training took place on 3090 samples, among which there are most of all the characters ‚Äúx‚Äù and least of all ‚Äúd‚Äù.  Despite this, the learning process on my C2D e6750 took only 40 seconds. <br>  Code for learning NA: <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args</span></span></span><span class="hljs-function">)</span></span> { NeuralNet net = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NeuralNet(); <span class="hljs-comment"><span class="hljs-comment">//    uint[] layers = { 336, 130, 14 }; net.CreateStandardArray(layers); //   net.RandomizeWeights(-0.1, 0.1); net.SetLearningRate(0.7f); //     TrainingData data = new TrainingData(); data.ReadTrainFromFile("train.tr"); //  net.TrainOnData(data, 1000, 0, 0.001f); //     net.Save("skynet.ann"); }</span></span></code> </pre><br>  Structure of the text file train.tr: <br><pre> <code class="cs hljs">num_train_data num_input num_output inputdata seperated <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> space outputdata seperated <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> space ... inputdata seperated <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> space outputdata seperated <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> space</code> </pre><br>  Examples of characters passed to recognition: <br><img src="http://habrastorage.org/storage/e194cd7f/f15664fb/8cd201db/a403eddb.png"><br><br><h4>  Integral recognition </h4><br>  First we find and recognize the limits.  The top one can consist of 1-2 digits, the maximum value being 10. The bottom one is in the range from 0 to -10. <br>  We will facilitate the task of the neural network: <br><ul><li>  If the upper limit consists of two digits, then it is 10 (the lower of the three). </li><li>  Minus recognizable algorithmically by the threshold value of the height of the symbol. </li><li>  When recognizing, we will not take into account the outputs of the NA, which do not correspond to the figures. </li></ul>  Find the sign of the integral, simply moving to the right of the left border with a space from the top border at half the height of the captcha.  Everything to the right is the integrand. <br>  Knowing the number of the integral, the number of objects in the captcha, and the fact that these objects are numbered from left to right, by further sequential recognition of the characters we get about the following line "5x5 + x5-4x2 + 4x5dx".  First we simplify the work of the expression parser - we will bring it to the form "+ 5x5 + x5-4x2 + 4x5". <br>  Some patterns make it easy to obtain summary data for solving the integral: <br><ul><li>  The signs "+" and "-" separate the items. </li><li>  The numbers after the "x" - degree. </li><li>  Etc. </li></ul>  At the output we get 2 arrays with multipliers and powers of x.  Further solution of the integral of difficulties is no longer present. <br><br><h4>  Instead of conclusion </h4><br>  The recognition quality of the <b>entire captcha is</b> impressive: 93.8% on a sample of 500 pieces! <br><br><div style="text-align:center;"><img src="http://habrastorage.org/storage/f5dcff11/3f1f3245/68f7aa53/62544407.png"></div><br><br>  Download the finished program that demonstrates the solution of the integral can be <a href="http://narod.ru/disk/15606801001/MatanCrack.zip.html">here</a> .  Or together with source codes (+ a program for training a neural network and a training sample) <a href="http://narod.ru/disk/15606816001/MatanCrackSrc.zip.html">here</a> . <br>  <font color="#AAAAAA">I hope neither my server nor the grishkaa <a href="https://habrahabr.ru/users/grishkaa/" class="user_link">habrauser</a> server will fall under the habra effect;)</font> </div><p>Source: <a href="https://habr.com/ru/post/121032/">https://habr.com/ru/post/121032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121025/index.html">Dev Derby - monthly demos contest</a></li>
<li><a href="../121028/index.html">Presentation of World of Tanks at E3</a></li>
<li><a href="../121029/index.html">Kana-captcha for PHP - it's easy!</a></li>
<li><a href="../121030/index.html">IPO for dummies. Part III: the IPO process, its benefits for the company, the founders and owners, and why the company‚Äôs management has such a tortured look when opening trades</a></li>
<li><a href="../121031/index.html">NumPy, a guide for beginners. Part 1</a></li>
<li><a href="../121033/index.html">Preliminary Program Development Program / CEE-SECR 2011 Conference Published</a></li>
<li><a href="../121034/index.html">Notification of unauthorized access to the web application</a></li>
<li><a href="../121035/index.html">Angry Birds ported to real life!</a></li>
<li><a href="../121036/index.html">ZTE Skate comes out - brother of Orange San Francisco</a></li>
<li><a href="../121037/index.html">Mobile guide to Moscow shopping centers for iOS and Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>