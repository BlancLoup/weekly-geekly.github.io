<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Robot is testing SAP ERP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At AlfaStrak we use SAP ERP as a process loss settlement system. And it just so happened that we are modifying it a little bit, this inevitably leads ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Robot is testing SAP ERP</h1><div class="post__text post__text-html js-mediator-article"><p>  At AlfaStrak we use SAP ERP as a process loss settlement system.  And it just so happened that we are modifying it a little bit, this inevitably leads to errors in the code.  If errors reach a productive system, this is bad.  This should be avoided; one of the ways is regression testing.  In this article I will talk about how exactly we carry out the "regress" for SAP, because we do it (eh!) Outside the box. </p><br><p>  It all started a few years ago.  In those years, we actively used regression testing, but could not do it at SAP - the tools we used with SAP didn‚Äôt work, the testers team didn‚Äôt want to learn the tools ‚Äúsharpened‚Äù for SAP tools.  I can‚Äôt remember exactly why, but I took it as a challenge (it was before I switched to engineering) and decided to ‚Äústudy‚Äù the question. </p><br><p>  The results of the study (as well as "doing") - in this article (below), I‚Äôll briefly say this: we automatically test SAP (and its immediate environment), we do it quite effectively (in all senses), we have not spent a single ruble on licenses and learning, our approach is simple and quite reproducible.  And we do not use any SAP tools for automated testing of SAP (except in the place where we have integrated into its transport system). </p><a name="habracut"></a><br><h2 id="krupnymi-mazkami">  Large strokes </h2><br><p>  There is a danger of going into details and losing readers, I will try not to do this (as an author, I know all the details). </p><br><p>  It all began with a study, communication with SAP, our partners and Mr. Google. </p><br><p>  The result of this communication was as follows: </p><br><ul><li>  SAP has tools to automate testing (we looked at eCATT, intently SAP CBTA) </li><li>  they require substantial immersion (especially SAP CBTA) </li><li>  there may be restrictions if it is necessary to go beyond SAP (it‚Äôs not in the ‚Äúvacuum‚Äù that lives with us) </li><li>  there are third-party products (for example, HP), but we have no competence for them, just like purchased licenses </li><li>  there is a way to "control" SAP outside (this idea was suggested to me by Konvista, thanks a lot to her for it) </li></ul><br><p>  Since I personally didn‚Äôt have any knowledge of SAP, I decided to try to dig in the last direction - the management of SAP not from SAP.  Quickly enough, Google provided the document "SAP GUI Scripting API for the Windows and Java Platforms", which served as an excellent start for this initiative.  A quick test on your favorite python showed - it works. </p><br><p>  Then it was a matter of small things - to find a suitable framework for testing automation.  Since python was my favorite language, the Robot Framework quickly got into consideration.  And, actually, after I got on the list and was tried, then only he remained on the list.  I was bribed by the fact that ‚Äúit‚Äù immediately worked (running ahead - and it still works, I don‚Äôt regret my choice for a minute). </p><br><p>  A small pilot showed that SAP is perfectly "controlled" by a robot (I will call the Robot Framework such a Russian word): quickly, synchronously, predictably and reliably.  In this case - I emphasize - we use the SAP documented way of interacting with the SAP GUI (not some kind of ‚Äúcrutches‚Äù). </p><br><h2 id="arhitektura">  Architecture </h2><br><p>  (yes I will be allowed to use this word here) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/746/929/043/746929043d897bce9bb4dd994e4452bc.png" alt="image"></p><br><p>  How it all works: </p><br><ul><li>  the script runs on the server (the word "server" is used here in the sense that this computer serves our requests for testing. In this particular case, it is more correct to use the word "client" because the script controls the testing process) </li><li>  the script interacts with the server component of the robot running on the SUT (system under test) via the Remote mechanism of the robot; </li><li>  This server component calls methods of the SAP management library. </li><li>  SAP GUI handles these requests (in synchronous mode, this is important) </li><li>  the results of executing queries or simply "jingles" are returned to the script on the "server", where they are used in the testing process </li></ul><br><p>  Technically </p><br><ul><li>  "server" is a virtual machine for Ubuntu </li><li>  SUT is the workplace where the SAP workplace is installed and configured (in our case it is a Windows computer or a virtual machine) </li><li>  SAP's management library is written in python (there are a few - a couple of hundred lines) </li><li>  A "script" is a "program" in a language that the Robot Framework understands. </li><li>  the robot (as such) implies a command line, since the developers at ABAP were not used to this, I made a WEB interface that provides, in particular, a collective work (about it just below). </li></ul><br><h2 id="chto-zhe-zamechatelnogo">  What is wonderful </h2><br><p>  Actually, what did we get, besides the absence of a licensing charge? </p><br><p>  A lot of things, if briefly about the main thing: </p><br><h3 id="russkiy-yazyk">  Russian language </h3><br><p>  The script looks like this: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/023/fac/06e/023fac06e8e45b3ac3b90b78c3d38e46.png" alt="image"></p><br><p>  At the very beginning of the journey (probably, during the pilot) I thought - and what will we break the language and invent some incomprehensible-even-to-us-words?  The robot involves the creation of your own keywords (sorry for the terminology - so it is called).  So why don't we invent them right away in Russian?  I asked the testers' community (somewhere in the depths of the Internet) - I was "zashkali": it's dangerous, why, who said, etc.  I still went my own way - we have everything in Russian (variables, words, only the control structures of the robot remain, but they need to be hidden inside keywords - if you see English, then it‚Äôs time to refactor). </p><br><p>  What good is the Russian language (except for clarity without a dictionary) - the script can be shown "not to an IT person", a business person.  You can write this script directly with it (I won‚Äôt even try to go into the topic ATDD here - this is a separate and big post, I will write someday). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/9f6/bd7/4c7/9f6bd74c7e18041f1664756c92e9c46e.png" alt="image"></p><br><h3 id="polnyy-i-totalnyy-kontrol-i-rasshiryaemost">  Full and total control and extensibility </h3><br><p>  I know exactly what happens during the testing process.  There is no magic at all - everything is very clear.  I do not know how anyone, I like this. </p><br><p>  About extensibility - functionality can be developed in any direction than we actively used: </p><br><ul><li>  it turned out to come up with your own "language" of test scripts, understandable to business </li><li>  it was possible to automatically check whether the fields in the interface were filled in correctly at the end of the test (for this, in particular, they separated the robot variables into the launch parameters and interface parameters, made it possible to determine which interface element should have the trigger parameter) </li><li>  breakpoints can be added to tests; during breaks, see the values ‚Äã‚Äãof variables </li><li>  implemented a mechanism for generating file templates and putting them into the execution process - without this, testing such an animal as a PES would be impossible (and we tested it in a fully automatic mode - from the creation of the application to the statement processing) </li></ul><br><p>  Having our own web interface has added more opportunities for expansion - for example, we can afford to modify the language of the robot (we thought up our own conditional operator, for example - we and our business users didn‚Äôt like the standard "Run keyword if").  This became possible because the source code files of the tests are generated for the robot by the web application. </p><br><h3 id="legkost-vhoda">  Ease of entry </h3><br><p>  Typically, testers do not have knowledge of the SAP infrastructure and, especially, SAP programming.  To master the robot and our improvements to it for them is obtained in a couple of weeks. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/27b/077/36f/27b07736ffa129357d292ddfd30951ec.png" alt="image"></p><br><h3 id="instrukcii-polzovatelya">  User Instructions </h3><br><p>  We also stumbled upon the "William of ours ..." - for documentation.  It is not a secret for anyone - there is usually no documentation on the system, and even if there is, it becomes outdated very quickly.  Users transmit the rules of working with the system "word of mouth".  If the automatic test code is a description of how to use the system according to the author, then why not convert this into an instruction? </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/47c/8f7/9c4/47c8f79c4fe66f8ab02595de206f96e5.png" alt="image"></p><br><p>  Of course, on this fragment it‚Äôs hard to see the details, it‚Äôs important that the instructions are generated and updated in fully automatic mode, including screenshots.  The instruction is always relevant (for auto-tests always work).  In the case of SAP, the screenshots generally work well - in SAP-e you can always find an interface element - a rectangle whose coordinates will be relevant to the current place in the test code, this one (invisible to the eye) is control and is used as a parameter to the keyword "take a screenshot" (this word , of course, it works only with the appropriate test run mode - why just use electricity). </p><br><p>  We formatted the instructions through Sphinx (I am sure many have learned the color scheme), so they are available both in the online manual and in printed form. </p><br><h2 id="nemnogo-pro-robot-framework">  A little about Robot Framework </h2><br><p>  Nevertheless, it is impossible to say nothing at all about the robot - it will turn out too incomprehensible and superficial.  I will try briefly. </p><br><p>  The main idea of ‚Äã‚Äãthis framework is the ability to create your own testing language (in the robot's terminology, the executable unit is the keyword - a keyword).  The framework provides </p><br><ul><li>  program execution environment (programmers - do not be offended) in this language </li><li>  functionally rich libraries (from working with strings and lists, to ssh and selenium) </li><li>  reporting (in the process of using, there was not even a thought to write any report) </li><li>  a simple paradigm of forming a program from keywords (a bit peculiar, but you can get used to it), there are such things as variables, parameters and results of "calls" (keywords) </li><li> simple and powerful extensibility - it is very easy to create our own library in python (for example, we worked with Excel in this way), both local (that is, executable in the same place as the test code) and remote (for example, which manages the SAP GUI) </li></ul><br><p>  The process of creating a test is quite straightforward. </p><br><ul><li>  form a sequence of actions and translate it into terms of the robot (below will be specificity about interaction with the system under test) </li><li>  Repeated sequences refactor into their (new) keywords </li><li>  we start the test, we look - as works, we correct, we improve </li><li>  debugging is provided by breakpoints (with the ability to view variables ‚Äî provided by the architecture, more precisely, the use of the robot‚Äôs remote library) </li></ul><br><p>  The result is not even a program (see examples above), but rather a formalized sequence of actions, which, by the way, describes the use of the program as it was intended by the author (see ATDD above). </p><br><h2 id="vzaimodeystvie-s-testiruemoy-sistemoy">  Interaction with the system under test </h2><br><p>  In our case, we test at the user interface level (i.e., our tests interact with the SAP at the GUI level ‚Äî they press buttons, fill in text fields, etc.).  It is generally recognized that this way of writing tests is not the best.  I partly agree with this, but I am ready to listen and discuss the best way to test SAP GUI applications (like our SAP FS CM). </p><br><p>  There is such a guru - Robert Martin (he is "uncle Bob" - the author of "Clean coder", if anyone read), we talked a little about this with him.  We agreed that if it is not very difficult to do, it does not change very often (breaking tests), then it‚Äôs okay - you can also test it via the interface. </p><br><p>  For my part, I can say this: in the case of SAP GUI, there are not so many options for implementing the user interface.  If you need to add the ability, for example, to track IMEI code, you can do it in almost one way - by adding the appropriate field to one of the tabs.  So, I think that all the nuances of this ‚Äúaddition‚Äù can and should be thought out by the customer (as this field will be called in the interface, width, order of use, etc.).  And he can do it directly in the script, which will then automatically test it.  If you think up the revision to the end does not work out (as they say - well, you do it, and we will see), then it is better to not do this revision.  And to do what turns out to think.  Well, this is me again in ATDD climbed ... </p><br><p>  Returning to the interaction with the SAP GUI: we did, as I already wrote, about 200 lines in python and about 10 different interface management functions (such as "go to bookmark", "fill in the field", "press the button").  This set was formed practically in the first days and subsequently did not expand much.  To the credit of SAP, I note that everything works very quickly - the eye does not have time to keep track of how the interface is ‚Äúblinking‚Äù; in order to slow down, delays were inserted into the control cycle (in cases where visual monitoring is necessary).  Also note the advantages of synchronous work - nowhere in the code you have to wait for anything, if, for example, the button is pressed, the action corresponding to the button is completed (for example, the loss is saved). </p><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_ctrl_attr</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( self, uid, attr )</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""     (  )   (  )  exception =  (   log) """</span></span> ctrl = self._get_ctrl(uid) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: retText = getattr( ctrl, attr ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> AssertionError(<span class="hljs-string"><span class="hljs-string">"  {1}   {0}"</span></span>.decode(<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>).format(attr,uid)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> retText</code> </pre> <br><p>  Slight comments on the code </p><br><ul><li>  shows a fragment of the SAP GUI management library </li><li>  a library is an object, methods are directly accessible in tests (in keywords), for example, the above method can be called like this: "res = get ctrl attr $ {UID} text" (using robot notation) </li><li>  in case of an error, the text of the exception will be visible in the log of the robot (for this you don‚Äôt need to do anything - just to ‚Äúraise‚Äù the exception </li></ul><br><p>  The code is very simple, it pleases. </p><br><h2 id="zapusk-testov">  Running tests </h2><br><p>  Following the logic of the robot, individual tests are united in our projects.  Test or project can be run manually from the web interface.  Also, the regression testing process is integrated into the SAP transport system: </p><br><ul><li>  the owner of the product at the end of the business testing stage approves transport requests for transfer </li><li>  approved requests "move" one by one to the pre-productive environment, where, according to the settings, one or another set of tests is launched (more precisely, projects) </li><li>  if the test result is positive, the request is released and goes to the production environment </li><li>  if errors occur, an email is sent to the author of the request with reference to the testing report (generated by the robot), the request does not go any further </li></ul><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c87/6c0/170/c876c0170a54568ccd3f2be3c3af98bb.png" alt="image"></p><br><p>  Important - the web interface significantly reduces the threshold for entering the testing process: it is easy to start the test ‚Äî press the "start" button.  At the same time (due to the use of the Robot Framework) all the advantages of the test file representation (version control, command line and related automation, etc.) are retained. </p><br><h2 id="ne-sap-om-edinym">  Not a single SAP </h2><br><p>  We successfully used our development for testing not only the SAP GUI, I had a small development (a simplified interface for registering a loss) in python and django.  Since all the basic points we have already been implemented, all that was needed was to write the browser management library (the same as I had for managing the SAP GUI, only through Selenium).  And it turned out great: </p><br><ul><li>  the tests still work on the Linux virtual machine (on the same one - the SAP and not the SAP tests live in the same instance) </li><li>  the browser "flashes" at the tester's workplace (full visual control without any tricks) </li><li>  standard reports, familiar tools </li></ul><br><p>  In the tests of this system, I went further (in the direction of ATDD) - visually visible elements (tags and placeholder's) were formed initially in the tests, they were coordinated with the business and from there they "got" into the source code of the system itself (a bit of DRY was obtained) write code without first writing a test.  Cool? </p><br><p>  Of course, many tools have been developed for web applications, but I cannot say that I experienced some inconvenience in the process.  It turned out well here ... </p><br><h2 id="podytozhivaya">  Summing up </h2><br><p>  The SAP world is great and contains, it would seem, everything that is necessary for the complete happiness of developers.  But this does not mean at all that it is necessary to walk only along those paths that the SAP and its ecosystem ‚Äúpierced‚Äù.  It is useful at the beginning of the way you need to ask yourself the question: do I really want to do "like everyone else"?  We in AlfaStrakhovaniyu ask ourselves and not only in IT. </p><br><p>  And, once again, in programming everything is possible, the question is only time and money (motivation). </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/457706/">https://habr.com/ru/post/457706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457698/index.html">Experiment: use a proxy as a tool to combat DoS attacks</a></li>
<li><a href="../4577/index.html">Google strikes back. Personal search engine with Google CSE</a></li>
<li><a href="../457700/index.html">Node.js authentication guide without passport.js and third-party services</a></li>
<li><a href="../457702/index.html">Using the KOMPAS-3D API ‚Üí Lesson 16 ‚Üí Control Characters</a></li>
<li><a href="../457704/index.html">How do GPUs handle branching</a></li>
<li><a href="../457710/index.html">The amazing capabilities of neural networks in 2019</a></li>
<li><a href="../457712/index.html">How Verizon and BGP Optimizer made a big offline</a></li>
<li><a href="../457718/index.html">HyperCard, the lost link in the evolution of the Web</a></li>
<li><a href="../457722/index.html">SQL: working time task: debriefing</a></li>
<li><a href="../457724/index.html">OpenCV on STM32F7-Discovery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>