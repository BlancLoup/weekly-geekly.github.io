<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Classification of the humanities and techies by comments in VK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I want to share my experience in classifying users of a social network according to their comments into two classes according to the way the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Classification of the humanities and techies by comments in VK</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  I want to share my experience in classifying users of a social network according to their comments into two classes according to the way they think: humanitarian or technical.  This article will not use the latest achievements of deep learning, but will be analyzed the completed project on the classification of texts: from finding suitable data to predictions.  At the end there will be a web application in which you can check yourself. </p><br><p><img src="https://habrastorage.org/webt/vp/6q/uu/vp6quumatqusnz7l8zcaktaslt4.jpeg"></p><a name="habracut"></a><br><h2>  Formulation of the problem </h2><br><p>  The task in our case of a binary classification is set as follows: there is a user, there are his comments, and it is necessary to determine the class from them: humanities or techies.  To solve this problem, we apply the technique of machine learning and natural language processing.  The final result can be used, for example, for targeted advertising. </p><br><h2>  Data </h2><br><p>  There is no existing labeled sample: it is difficult to formalize these concepts, and it will be necessary for some reasons to divide users into two classes. </p><br><p>  It was decided to collect your data set based on the comments of the users of the social network ‚ÄúVKontakte‚Äù.  On public pages, people usually discuss posts or simply communicate, leaving many comments.  The public / group page should be neutral in order for the number of humanities and techies to be approximately the same.  I chose a public page dedicated to discussing the life of a particular city.  The number of subscribers is about 300 thousand, the number of publications is about 50 thousand, the average number of comments for a publication is 20. </p><br><h3>  Receiving and marking data </h3><br><p>  You can download all comments using VK Open API, with which it was received about 3 million comments from 130 thousand users.  This amount should be enough to reserve almost any model of machine learning, but there is one ‚Äúbut‚Äù: we do not have the markup of this data, we do not know who is the humanities and who is techie.  Of course, one could try to write to each of the users and ask them personally, but this is a dubious idea.  We'll have to use the knowledge that we can get from the pages of users. </p><br><p>  Only 11 thousand out of 130 people were given the faculty of education.  As a result of this filtering, only 170 thousand comments remained, which is only 6% of the initial volume.  In total, there were 160 different faculties. I divided all faculties into humanitarian, technical, and other (natural or non-scientific, for example, music or art).  These ‚Äúother‚Äù faculties were abandoned and did not participate in the experiment.  Each user was assigned a class in accordance with the faculty, which was listed in his profile. </p><br><p>  Perhaps not all who study in the humanities departments are humanities scholars, and the same can be said about technical ones, but against the general background of such users there should be a minority.  To confirm or refute this theory, I organized a poll in my department.  Of the 200 people, 62 (that is, 31%) indicated that their mentality is humanitarian despite the fact that the faculty itself is technical.  Similarly, at the Faculty of Humanities, out of 150 respondents, 14 people (only 9%) admitted that they were techies at heart.  Thus, it is more correct to call the classification according to such data a classification according to the type of higher education received. </p><br><h2>  Data analysis </h2><br><p>  An example of a table with data by comments: </p><br><p><img src="https://habrastorage.org/webt/hk/ow/jt/hkowjtaoyhb6e0fh_sxrh3rmamu.png"></p><br><p>  Before proceeding to the construction of models, it is necessary to analyze the existing sample.  This will help you understand which attributes need to be considered, how they are distributed, and which models are best to use.  It also helps to find outliers and anomalies in the data that are not typical for a given sample.  Their removal will help to build a model with a greater generalizing ability.  After the separation of users in both classes, about 4000 people turned out.  First, look at the distribution of non-text features of users. </p><br><h3>  Floor </h3><br><p>  In the sample of male users turned out to be 55%.  In society, there is a stereotype that men have a more analytical mind, and women have a humanitarian or creative mind.  According to the sample, a graph is drawn that shows the distribution of this attribute separately into two classes. </p><br><p><img src="https://habrastorage.org/webt/rw/0s/ko/rw0skogvbwq7bpywldkms2z7iy4.png"></p><br><p>  It can be seen that among the male users the ‚Äútechie‚Äù class prevails, and among the female users the ‚Äúhumanities‚Äù class prevails. </p><br><h3>  attitude to alcohol </h3><br><p>  About 1500 users from each class noted their attitude to alcohol and about 1600 - to smoking.  Of course, many do not fill this item on social networks, only 30% had it listed.  Some of them could have provided false information in order to show themselves in the best light or impress classmates.  But the general trend in the distinction between the two classes is still visible. </p><br><p><img src="https://habrastorage.org/webt/z5/40/54/z54054z8aea4qszfcy5ritbl2ze.png"></p><br><p>  On the abscissa axis are categories from "very negative" to "positive" attitude to alcohol.  For each category was considered the number of people in both classes.  The ordinate axis indicates the proportion of humanities in the group.  The vertical bar indicates the confidence interval.  The graph shows that techies often indicate in their profile a positive attitude towards alcohol.  Very negative attitudes often indicate humanities. </p><br><h3>  Attitude towards smoking </h3><br><p><img src="https://habrastorage.org/webt/zi/mo/gc/zimogcamnlqqqprqw3h1r0wt72a.png"></p><br><p>  In relation to smoking, the opposite situation is visible.  Users from the ‚Äúhumanities‚Äù class more often indicate a positive attitude towards smoking.  It can be seen that not all values ‚Äã‚Äãdiffer from statistically significant (some confidence intervals include the value of 0.5, which means that no distinction can be declared), but the trend is still interesting. </p><br><h3>  Marital status and the main thing in life </h3><br><p>  On the basis of "marital status," there is only a strong bias in two: "everything is difficult" and "actively searching."  Both of them are biased towards the humanities. </p><br><p>  On the basis of ‚Äúthe main thing in life‚Äù - there is only one significant deviation - ‚Äúbeauty and art‚Äù - and it is in the direction of the ‚Äúhumanities‚Äù class. </p><br><h3>  Activity time </h3><br><p>  We construct the distribution of user activity at different times of the day. </p><br><p><img src="https://habrastorage.org/webt/xf/dx/ca/xfdxca1ycjnh6wscvlqcyna3asm.png"></p><br><p>  The graph shows that at night (from 11 to 2) the number of comments from the techie class is much larger.  This suggests a more "night" lifestyle of users of this class.  It can also be seen that the least activity is observed at 5-6 o'clock in the morning.  Nevertheless, starting at 4 o'clock in the morning, the number of comments from users of the humanities class is much larger, which indicates an earlier rise time. </p><br><h3>  Comment Examples </h3><br><p>  Before further analysis, you can see the comments themselves.  Below are a few examples from both groups. </p><br><p>  Class "techie": " <em>Anton, have you ever stopped on the locked wheels?</em>  <em>What is the stopping distance?</em>  "," We will <em>support ours, of course) on the 21st on Labor)</em> "," <em>The first photo is very original and very beautiful!</em>  ". </p><br><p>  The class ‚Äúhumanities‚Äù: ‚Äú <em>Very cute kittens‚Äù, ‚Äú=)))</em> ‚Äù, ‚Äú <em>In my opinion, everything is being done so that the children know as much as possible about drugs.</em>  "," <em>I do not have time for the speed of your thoughts)))) I am hopeless</em> . " </p><br><p>  It is seen that the comments are written on different topics.  You can try to find differences in the topics covered.  Words will need to lead to the initial form to avoid many similar words that have the same meaning.  Perhaps even a simple selection of the words used can divide the two classes well.  Also, great attention should be paid to the smilies, emoji and punctuation used. </p><br><h2>  Data preprocessing </h2><br><p>  Initially, it is necessary to remove too long and too short comments from the sample.  They can interfere with generalizing models.  The maximum length was limited to 50 words, and the minimum - 3 words.  Next you need to get rid of spam.  First, all comments were deleted, which included links to third-party sites, they turned out to be less than 1%.  Then messages were deleted that were repeated more than 2 times, which means they were spam, also less than 1%. </p><br><p>  There were a lot of hits in the data.  In the comments you can contact a specific person through a link to his page.  When downloading via API, the names are replaced with the user's page id.  In order not to clutter the model with id information, as well as to prevent the memorization of specific individuals, all appeals were deleted. </p><br><h2>  Feature generation </h2><br><p>  After analyzing and clearing data in machine learning tasks, the stage of building and selecting features begins.  The usefulness of the final model directly depends on the quantity and quality of the features obtained. </p><br><p> Before you start working with the text, you need to tokenize it, that is, break it into words.  This can be done using <strong>stemming</strong> or <strong>lemmatization</strong> .  Stemming is a selection of the stem of the word, folding the ending.  For example, the words: ‚Äúdemocracy‚Äù, ‚Äúdemocratic‚Äù, ‚Äúdemocratization‚Äù are brought to the word ‚Äúdemocrat‚Äù.  Lemmatization is the reduction of the word to the initial form.  All three words from the previous example are given to the word ‚Äúdemocracy.‚Äù  In this task, the lemmatization performed with the <a href="https://pymorphy2.readthedocs.io/en/latest/">pyMorphy2</a> library <a href="https://pymorphy2.readthedocs.io/en/latest/">worked better</a> . </p><br><h3>  Text vectorization </h3><br><p>  Comments need to be transformed into vectors, because most machine learning models take numerical vectors as input.  The simplest approach is called a <strong>bag of words</strong> : it counts the number of entries in the text of each of the words.  Before you get vectors in this way, you need to get rid of stop words.  These are words that occur very often and do not carry a semantic load, for example, ‚Äúotherwise‚Äù, ‚Äúthis‚Äù, ‚Äúor‚Äù and so on. </p><br><p>  This approach does not take into account the word order in the sentence.  The phrases ‚Äúnon-black cat‚Äù and ‚Äúblack cat‚Äù will not be converted to the same vector, because they have the same set of words.  To solve this problem, you can use successive tokens - N-grams. </p><br><p>  The same feature vectors can be constructed at the character level.  The text is divided into N-grams of characters, where N is usually taken equal to three.  The word "forest" is divided into: "forest", "ec", "clear", "Noah".  This approach has a great advantage: it is more resistant to new words that were not in the training set. </p><br><p>  <strong>Tf-Idf was</strong> also used for text <strong>vectoring</strong> .  This is a statistical measure used to assess the importance of a word in the context of a document that is part of a collection of documents or a corpus.  Words with a high frequency within a particular document and with a low frequency of use in other documents receive great weight.  In more detail on Habr√©, for example, <a href="https://habrahabr.ru/post/252265/">here</a> . </p><br><p>  The most recently tested vectorization model is <strong>word2vec</strong> .  A vector representation is based on contextual intimacy: words occurring in a text with a single context will have close coordinates in the vector representation.  On the Internet, you can find models already trained on large buildings that match the word to its vector.  Excellent examples of the work word2vec on Habr√©. </p><br><h3>  Other signs </h3><br><p>  Other sources of signs are the general characteristics of the commentary.  They describe the commentary as a whole. </p><br><p>  <strong>Punctuation signs:</strong> </p><br><ul><li>  the presence of direct speech; </li><li>  the number of commas, question marks, exclamation marks, dots; </li><li>  number of smiles like ")", "))", "((". </li></ul><br><p>  <strong>Signs of content:</strong> </p><br><ul><li>  percentage of words written by caps lock; </li><li>  percentage of English words; </li><li>  the presence of a large letter at the beginning of a sentence. </li></ul><br><p>  <strong>Common symptoms:</strong> </p><br><ul><li>  number of words; </li><li>  number of offers; </li><li>  average word length; </li><li>  average sentence length. </li></ul><br><h2>  The process of obtaining predictions </h2><br><p>  Having received the feature vector, we proceed to the training of models.  Using an ensemble of several models instead of one is preferable, since it improves accuracy and reduces the variance of predictions.  Several models are built, then they are polled for each object that needs to be classified, and the winner is selected by a majority of votes, the principle of simple voting. </p><br><p>  The users were divided into two parts in the proportion of 80 to 20. At the first training of models was conducted, on the second - testing.  Since the classes were balanced, accuracy was taken as the metric - this is the ratio of the number of correctly classified examples to the total number of examples. </p><br><p>  The final task is to classify users, but since the classification is carried out according to text comments, the models will classify each comment separately.  To make a prediction for the user, we will issue the most frequent class predicted for his comments by an ensemble of models. <br>  Each model will be trained on its own subset of features.  Thus, the models are more resistant to outliers, their predictions become less correlated, and the generalization error is minimal. </p><br><h3>  Used models </h3><br><p>  <strong>Linear regression</strong> is a model that weights input features linearly.  Linear models are well suited for problems with a large number of sparse features, and the vector representation of the text is just that.  You can also interpret weights before signs.  For example, in the case of vectoring using a bag of words, a positive weight in front of a word means that the probability of belonging to the first class is greater. </p><br><p>  <strong>Multilayer neural network</strong> - a model that consists of several layers with neurons.  Due to the repeated use of the activation function, the neural network is a non-linear function, which allows, theoretically, to capture more complex data dependencies. </p><br><p>  <strong>A recurrent neural network</strong> is a type of neural network that was specifically created for modeling and analyzing sequences (for example, words or symbols).  With this model it turns out to take into account not only the presence of specific features, but also their order. </p><br><p>  Predictions of neural networks are much more difficult to interpret.  To get good results, you need to go through a lot of hyperparameters: the number of neurons, the number of layers, the amount of regularization and others.  For training neural networks, the <a href="https://keras.io/">Keras</a> framework was <a href="https://keras.io/">used</a> .  More details about neural networks can be found in a series of articles on <a href="https://habrahabr.ru/post/312450/">habr</a> . </p><br><p>  The three models that were listed above accept comments with different vectorization options as input: a bag of words, Tf-Idf, word2vec.  The technique of the bag of words was applied both at the level of words and at the level of symbols.  As mentioned above, the more different models, the better, so several variants of the same models with different hyperparameters were selected. </p><br><p>  The latest model is a <strong>gradient boosting of trees</strong> .  This algorithm shows good results in the case of working with quantitative and categorical features.  Unlike previous models, she studied the general characteristics of a comment (the number of commas, the average word length, and other statistics).  Used library <a href="https://github.com/dmlc/xgboost">XGBoost</a> . </p><br><p>  With the help of validation, models were selected that showed the best quality at the user level.  They entered the final ensemble.  A correlation between model predictions was also analyzed. </p><br><p><img src="https://habrastorage.org/webt/01/sc/kn/01scknojpzgj_bmjaj5zzshp0gg.png"></p><br><p>  It can be noted that the predictions of the models of gradient boosting (xgb) and the recurrent network at the character level (lstm_char) differed the most.  String prediction - the ensemble of all models. </p><br><p>  The models were chosen for the ensemble not only in terms of accuracy, but also due to the uncorrelated predictions.  If the two models have the same accuracy and are very similar, then there will be no sense in averaging them. </p><br><h2>  results </h2><br><p>  The quality of the final model depends on the minimum number of comments that will be used to classify one user.  In theory, the more comments, the better. </p><br><p><img src="https://habrastorage.org/webt/qi/se/vg/qisevg3vs1v3ivatnu4zofgv7sm.png"></p><br><p>  However, with an increase in the minimum number of comments from one person, the number of people who have this or more comments, i.e.  decreases the size of the training sample.  For example, about 4,000 people have 2 or more comments, and less than 1,000 people have 10 or more comments. This explains the decrease in the classification accuracy with an increase in the number of comments of one user to 11 or greater values. </p><br><p><img src="https://habrastorage.org/webt/vw/el/9w/vwel9wdjrrjehfxf9ezam5cr2qi.png"></p><br><p>  The best accuracy of 0.66 is achieved using 11 comments from one person.  This result is not enough to talk about the successful solution of the classification problem, but still this accuracy is superior to the quality of predictions with the help of a coin toss.  Further results can be improved by collecting more data. </p><br><p>  The most important for the gradient boosting model, which does not directly use the words of comments, are the following features: </p><br><ul><li>  average word length; </li><li>  number of words; </li><li>  share of English words in the comments; </li><li>  use of exclamation mark. </li></ul><br><p>  With the help of the <a href="http://eli5.readthedocs.io/en/latest/">eli5</a> library, <a href="http://eli5.readthedocs.io/en/latest/">we</a> visualize the predictions of a linear model that works on top of the text in the form of a bag of words: </p><br><p><img src="https://habrastorage.org/webt/8t/xl/5f/8txl5fjtlld4fwnkx9idkguvfak.png"></p><br><p><img src="https://habrastorage.org/webt/rx/0u/nv/rx0unvg0g7xc8fmw8tmyc2barru.png"></p><br><p>  At the character level: </p><br><p><img src="https://habrastorage.org/webt/g7/10/kp/g710kpzm2ia88hbt5vxluo6gwts.png"></p><br><p><img src="https://habrastorage.org/webt/-n/w7/hn/-nw7hnzcsyvhdfzhg5eje-a6hag.png"></p><br><p>  Green highlights the words and symbols that contribute the most to the predicted class, and red which contribute to the opposite class.  y = 1 means that the model predicts the humanities class, y = 0 - the techie. </p><br><h2>  Web service </h2><br><p>  To demonstrate the work, I deployed the model as a web service.  Flask was used as a backend, a simple design was made using Bootstrap, and Heroku was used for hosting.  You can try it yourself at <a href="http://www.commentsanalysis.ru/">www.commentsanalysis.ru</a> . </p><br><p>  An important limitation was the time of the formation of a single prediction.  Because of this, it was decided to leave only 5 of the best linear models for the ensemble. </p><br><p>  The site has four main blocks: a brief instruction, a field with a random comment, a field for entering a user comment, and a field with the result of the classification.  After at least 5 comments are entered, the result can be predicted. </p><br><p>  Now that the system is developed and running, you can think about its application.  For example, humanities students studying at technical faculties can be automatically transferred to more suitable faculties. </p><br><p>  Link to <a href="https://github.com/EvgenyKashin/CommentsAnalysis">github</a> . </p><br><p>  PS: thank you so much <a href="https://habrahabr.ru/users/olferuk/" class="user_link">olferuk</a> for editing the text. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/342572/">https://habr.com/ru/post/342572/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342560/index.html">Telegram conference bot (start)</a></li>
<li><a href="../342562/index.html">Vim as an esoteric text editing language</a></li>
<li><a href="../342564/index.html">CubeDB: minimalistic storage of meters with multidimensional keys</a></li>
<li><a href="../342566/index.html">How to write your swagger and not regret it</a></li>
<li><a href="../342570/index.html">Rewrite the message database VKontakte from scratch and survive</a></li>
<li><a href="../342574/index.html">We pick a cryptograph, let's call it - ‚Äúnekema‚Äù</a></li>
<li><a href="../342576/index.html">User survey Habra</a></li>
<li><a href="../342578/index.html">Jest and Puppeteer: automation of testing web interfaces</a></li>
<li><a href="../342580/index.html">ShellCheck Static Analyzer and Script Improvement for Linux and Unix</a></li>
<li><a href="../342582/index.html">Top Ten Antivirus for Linux</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>