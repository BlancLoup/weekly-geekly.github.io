<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to take control of network infrastructure. Chapter Four Automation. Templates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is the sixth in a series of articles on "How to take control of network infrastructure." The contents of all articles in the series and l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to take control of network infrastructure. Chapter Four Automation. Templates</h1><div class="post__text post__text-html js-mediator-article">  <i>This article is the sixth in a series of articles on "How to take control of network infrastructure."</i>  <i>The contents of all articles in the series and links can be found <a href="https://habr.com/ru/post/447008/">here</a></i> . <br><br>  Leaving several topics behind, I decided to start a new chapter. <br><br>  I'll be back to safety later.  Here I want to discuss one simple but effective approach, which, I am sure, in one form or another, can be useful to many.  It is rather a short story about how automation can change the life of an engineer.  It will be about the use of Templates.  At the end there is a list of my projects where you can see how everything described here works. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  DevOps for the network </h2><br>  Creating a configuration script, using GIT to control changes in the IT infrastructure, remote ‚Äúuploading‚Äù - these ideas come first of all when you are thinking about the technical implementation of the DevOps approach.  The pros are obvious.  But there are, unfortunately, and cons. <br><br>  When more than 5 years ago, our developers came to us, to networkers, with these proposals, we were not thrilled. <br><a name="habracut"></a><br>  I must say that we inherited a rather motley network consisting of equipment from about 10 different vendors.  Something was convenient to configure through our favorite cli, but somewhere we preferred to use the GUI.  In addition, long work on "live" equipment has been taught to real-time control.  I, for example, making changes, I feel much more comfortable working directly through cli.  So I can quickly see that something went wrong and roll back the changes.  All this was in some contradiction with their ideas. <br><br>  Other issues arise, for example, the interface may change slightly from version to software version.  This, in the end, will lead to the fact that your script will create the wrong "config".  It would not be desirable to use production for "running in". <br><br>  Or, how to understand that the configuration commands were applied correctly and what to do in case of an error? <br><br>  I do not want to say that all these issues are unsolvable.  Just saying ‚ÄúA‚Äù is probably reasonable to say ‚ÄúB‚Äù and, if you want to use the same processes to control changes as in development, then you need to have in addition to production also the dev and staging environments.  Then this approach looks complete.  But how much will it cost? <br><br>  But there is one situation when the minuses are practically leveled, and there are only pluses.  I'm talking about design work. <br><br><h2>  Project </h2><br>  For the last two years I have been participating in a project to build a data center for one large provider.  I am responsible in this project for F5 and Palo Alto.  From a Cisco point of view, this is the ‚Äú3rd party equipment‚Äù. <br><br>  For me personally, there are two distinct stages in this project. <br><br><h3>  First stage </h3><br>  The first year I was infinitely busy, I worked at night and on weekends.  I could not lift my head.  The pressure from the management and the customer was strong and continuous.  In a constant routine, I could not even try to optimize the process.  It was not only and not so much the configuration of the equipment, as the preparation of project documentation. <br><br>  Here the first tests began, and I would be amazed how many minor errors and inaccuracies were made.  Of course, everything worked, but the letter in the title was missed, the line in the team was missed ... The tests continued and continued, and I was already in a constant, daily struggle with errors, tests and documentation. <br><br>  So it went on for a year.  The project, as I understand it, was not easy for everyone, but gradually the client became more and more satisfied, and this made it possible to take on additional engineers who were able to take on part of the routine. <br><br>  Now you could look around a bit. <br>  And this was the beginning of the second stage. <br><br><h3>  Second stage </h3><br>  I decided to automate the process. <br><br>  What I understood from the then communication with the developers (and I must pay tribute, we had a strong team), so this is that the text format, although it seems at first glance something from the world of the DOS operating system, but has some valuable properties . <br>  For example, a text format will be useful if you want to take full advantage of the benefits of GIT and all its derivatives.  And I wanted to. <br><br>  Well, it would seem, you can simply store the configuration or the list of commands, but it is rather inconvenient to make changes.  In addition, the design is another important task.  You should have documentation describing your overall design (Low Level Design) and specific implementation (Network Implementation Plan).  And in this case, the use of templates looks like a very suitable option. <br><br>  Thus, when using YAML and Jinja2, the YAML file with configuration parameters such as IP addresses, BGP AS numbers, ... perfectly plays the role of NIP, while Jinja2 templates include design-specific syntax, that is, in fact, a reflection of LLD. <br><br>  It took two days to learn YAML and Jinja2.  To understand how this works quite a few good examples.  Then it took about two weeks to create all the templates corresponding to our design: a week for Palo Alto and another week for F5.  All this was laid out on corporate githab. <br><br>  Now the change process was as follows: <br><br><ul><li>  changed the yaml file </li><li>  created using the template (Jinja2) configuration file </li><li>  saved to remote repository </li><li>  flooded the created configuration on the equipment </li><li>  saw an error </li><li>  changed YAML file or Jinja2 template </li><li>  created using the template (Jinja2) configuration file </li><li>  ... </li></ul><br>  It is clear that at first a lot of time was spent on edits, but after a week or two it was already rather a rarity. <br><br>  A good test and opportunity to debug everything was the desire of the client to change the naming convention.  Who worked with the F5 understands the piquancy of the situation.  But for me, everything was pretty simple.  I changed the names in the YAML file, deleted the entire configuration from the hardware, generated a new one and uploaded it.  For everything, taking into account the bug fixes, it took 4 days: two days for each technology.  After that, I was ready for the next stage, namely the creation of DEV and Staging data centers. <br><br><h3>  Dev and Staging </h3><br>  Staging virtually repeats production.  Dev is a heavily trimmed copy built mostly on virtual hardware.  The ideal situation for a new approach.  If, from the general process, to isolate the time I have spent, then I think the work took no more than 2 weeks.  The main time is the waiting time of the other party, and a joint search for problems.  The implementation of the 3rd party was almost invisible to others.  There was even a time to teach something and write a couple of articles on Habr√© :) <br><br><h2>  Summarize </h2><br>  So what do I have in the bottom line? <br><br><ul><li>  All I need to do to change the configuration is to change a simple, clearly structured YAML file with configuration parameters.  I never change the python script and very rarely (only if there is an error) change Jinja2 warmer </li><li>  from the point of view of documentation, an almost ideal situation is obtained.  You change the documentation (YAML files play the role of NIP) and upload this configuration to the hardware.  So your documentation is always up to date. </li></ul><br>  All this led to the fact that <br><br><ul><li>  error rate dropped to almost 0 </li><li>  it took 90 percent of the routine </li><li>  At times increased the rate of implementation </li></ul><br><h2>  PAY, F5Y, ACY </h2><br>  I said that a few examples are enough to understand how this works. <br>  Here is a brief (and of course modified) version of what was created in the course of my work. <br><br>  <a href="https://github.com/nihole/PAY">PAY</a> = deployment <b>P</b> alo <b>A</b> lto from <b>Y</b> aml = Palo Alto from Yaml <br>  <a href="https://github.com/nihole/F5Y">F5Y</a> = deployment <b>F5</b> from <b>Y</b> aml = <b>F5</b> from <b>Y</b> aml (coming soon) <br>  <a href="https://github.com/nihole/ACY">ACY</a> = deployment <b>AC</b> i from <b>Y</b> aml = <b>F5</b> from <b>Y</b> aml <br><br>  I will add a few words about ACY (not to be confused with ACI). <br><br>  Those who worked with ACI know that this miracle (and in a good sense too) was not created by networkers exactly :).  Forget everything you know about the network - it will not come in handy! <br>  It is a little exaggerated, but it conveys approximately the feeling that I have been experiencing constantly, for 3 years now, while working with ACI. <br><br>  And in this case, ACY is not only an opportunity to build a change control process (which is especially important in the case of ACI, because it is assumed to be the central and most critical part of your data center), but also gives you a friendly interface for creating configurations. <br><br>  The engineers in this project to configure ACI instead of YAML for exactly the same purpose use Excel.  In using Excel, of course, there are pluses: <br><br><ul><li>  your NIP in one file </li><li>  beautiful signs that look nice to the client </li><li>  you can use some excel tools </li></ul><br>  But there is one drawback, and in my opinion it outweighs the advantages.  To control changes and coordinate the work of the team becomes much more difficult. <br><br>  ACY is actually using the same approaches that I used for the 3rd party to configure ACI. </div><p>Source: <a href="https://habr.com/ru/post/453920/">https://habr.com/ru/post/453920/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45390/index.html">"Investment Fund with the Tretyakov Gallery"</a></li>
<li><a href="../453906/index.html">What is the "domain model"?</a></li>
<li><a href="../453908/index.html">RTOS Neutrino in Industrial Computers</a></li>
<li><a href="../45391/index.html">Macroeconomics, our delusions, new risks and opportunities</a></li>
<li><a href="../453914/index.html">TON Test Client Installation Instructions</a></li>
<li><a href="../453926/index.html">How the car-sharing service works</a></li>
<li><a href="../453930/index.html">Comparison and selection of data migration systems</a></li>
<li><a href="../453932/index.html">A couple of words in defense of the monolith</a></li>
<li><a href="../453934/index.html">11 questions that need to be discussed before starting work</a></li>
<li><a href="../453938/index.html">Tracking a stolen bike using the NB-IoT protocol</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>