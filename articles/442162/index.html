<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>STM32 fast start. Part 1 Software, Materials, Cube MX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I increasingly come across holivars on the topic of Cube MX and HAL, as applied to STM32 controllers. 

 On the one hand, there are defender...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>STM32 fast start. Part 1 Software, Materials, Cube MX</h1><div class="post__text post__text-html js-mediator-article"> Recently, I increasingly come across holivars on the topic of Cube MX and HAL, as applied to STM32 controllers. <br><br>  On the one hand, there are defenders who like the convenience of configuration and readability of the code. <br><br>  On the other hand, adherents write everything with their hands, for which the speed of work and careful use of resources are important. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order to place all the dots above i - let's try to write ‚ÄúHello world‚Äù by the three most frequently used paths CMSIS, LL, HAL.  We estimate the costs (controller resources, the size of the executable file, and of course, the developer‚Äôs work time). <br><br>  The article will consist of several parts: <br><br>  STM32 fast start.  Part 1 Software, materials, Cube MX. <br>  STM32 fast start.  Part 2 Hello World on HAL, debugging setup in Atollic TrueSTUDIO <br>  STM32 fast start.  Part 3 Hello World on LL <br>  STM32 fast start.  Part 4 Hello World on CMSIS <br>  STM32 fast start.  Part 5 Summary, comparison of HAL, LL, CMSIS. <br><a name="habracut"></a><br>  First, let's define what we actually program, that is, we find the appropriate hardware. <br><br>  The ideal option would be a budget board on an STM32F103C8T6 microcontroller. <br><br><img src="https://habrastorage.org/webt/xg/p0/bp/xgp0bpjdzpt6mtw255uq61gkfno.jpeg" alt="image"><br><br>  This fee can be found on the well-known site for the price of 100 Russian rubles. <br><br>  Search by keywords: STM32F103C8T6 ARM STM32 Minimum <br><br>  <a href="https://ru.aliexpress.com/af/STM32F103C8T6-ARM-STM32-Minimum.html%3FSearchText%3DSTM32F103C8T6%2BARM%2BSTM32%2BMinimum%25EF%25BB%25BF">https://ru.aliexpress.com/af/STM32F103C8T6-ARM-STM32-Minimum.html?SearchText=STM32F103C8T6+ARM+STM32+Minimum</a> <br><br>  In order to fill the firmware and play with debugging - you also need a programmer <br>  For a start, and for further use, the Chinese clone of the ST-LINK V2 programmer is perfect. <br><br>  You can buy on the same site for the price of 120 Russian rubles. <br><br><img src="https://habrastorage.org/webt/uq/iz/5v/uqiz5vuija1j3usdrwljgnp76vo.jpeg" alt="image"><br><br>  Search for ST LINK Stlink ST 252dLink V2 Mini STM8 STM32 keywords: <br><br>  <a href="https://ru.aliexpress.com/af/ST-LINK-Stlink-ST%2525252dLink-V2-Mini-STM8-STM32.html%3FSearchText%3DST%2BLINK%2BStlink%2BST%25252dLink%2BV2%2BMini%2BSTM8%2BSTM32">https://ru.aliexpress.com/af/ST-LINK-Stlink-ST%25252dLink-V2-Mini-STM8-STM32.html?SearchText=ST+LINK+Stlink+ST%252dLink+V2+Mini+STM8+ STM32</a> <br><br>  For software development under STM32, you can use different IDEs. <br><br>  The most popular are IAR, Keil, Coocox (Eclipse). <br><br>  We will take the path that, recently, ST itself provides absolutely free of charge and in full. <br><br>  We will use Atollic TrueSTUDIO for STM32 or in common Tolik. <br><br>  What are the advantages of this software: absolutely free, there is no limit on the size of the code, there is a good debugger, simple installation and configuration. <br><br>  Cons: no auto add-on code. <br><br>  Versions are available under windows and linux. <br><br>  Downloading here <a href="https://atollic.com/resources/download/">https://atollic.com/resources/download/</a> <br>  With the installation of this software, there should be no problems, everything is intuitive, we choose where to put it and click ‚Äúall the time‚Äù next time. <br><br>  After installation, you can not run, because in addition to the IDE itself, something else is needed. <br><br>  If all the same run - just close. <br><br>  Since TrueSTUDIO is a development and debugging tool, I would like not to build the project with my hands (connecting the required libraries and prescribing paths), but to get some pre-configured file in which you can immediately write code without unnecessary problems. <br><br>  To do this, use the program code generator Cube MX or in common "Kalokub". <br>  This software is the first stumbling block in holivarah what to write under STM: on registers and CMSIS or on HAL. <br><br>  Defenders of the first ideology give the following arguments: Cube MX generates a huge, unnecessary amount of code, which also slows down the work of the MC. <br><br>  The defenders of the second state that the automatically generated code reduces development time, allowing the developer to switch to the device's core part (to the main logic) faster, giving the routine configuration of the periphery to the specialized software (Cube MX). <br><br>  Oddly enough, both of these ideologies are true and applicable in practice, but only each in its own terms. <br><br>  Let's look at a couple of examples: <br><br>  <b>Example No. 1:</b> It is required to develop a device that is as cheap as possible, since it is planned to manufacture in batches of 100,500 pieces each year.  Naturally, every extra ruble of the price of a device will result in hundreds of thousands of rubles of expenses on the final device.  At the same time, in the planned development there are a couple of heavy calculations and work with peripherals (ADC, SPI, UART) at maximum speeds. <br><br>  The device is a completely autonomous product, in the future minimal changes are planned for the entire period of production of this equipment.  The development period to obtain the finished sample is 1-2 years. <br><br>  <b>Example No. 2:</b> A prototype device is required that may be of interest to the customer and he will order 100 pieces of similar devices for the conversion of his object.  The first planned batch must be shipped to the customer in 2 months.  The size of the first test batch of 10 pcs. <br><br>  The exact terms of reference will be corrected in the course of working on the project, but it is known that in the future several reworkings of the hardware are planned, under which it is necessary to quickly adjust all the applied logic. <br><br>  In the first example, the ideal option would be to select the cheapest controller and write a hardware dependent, but optimal code, where work with the periphery will be organized through access to the corresponding registers (CMSIS).  The developer who is engaged in this project - must have good or excellent knowledge of the periphery of a particular family of MK.  Ideally, when you try to wake him up at night, you should immediately call the address of the desired vector from the interrupt vector table. <br><br>  In the second example, the choice of controller is determined by the available iron, as well as the time spent on writing the functionality required by the customer.  Therefore, the speed and optimization of the software itself fades into the background.  There is no time for manual initialization, as there is no time for elaboration of hardware dependencies. <br><br>  In this case, the controller is selected, which can be quickly put into production in the current region, initialization is done on it using the Cube MX, application logic is written to HAL and the prototype is transferred to the customer for testing.  Such a project can lead any average developer who has learned the skills of working with the target programming language.  The understanding of the subtleties of the work of the periphery is practically not required. <br><br>  No matter how sad it may sound - in the realities of modern device development in Russia - the example number 1 is encountered less and less, passing the baton to the example number 2. <br><br>  We will return to the discussion of examples 1 and 2 at the very end of the series of articles, and now we will continue with the preparation of the working space. <br><br>  At this stage, we will make a short pause, go to the website <a href="https://my.st.com/">my.st.com</a> and register an account on it, since the policy of ST does not allow you to download the necessary materials without registration. <br><br>  Once we have access to the site - <a href="https://www.st.com/en/development-tools/stm32cubemx.html">download the STM32 Cube MX.</a> <br><br>  At the very bottom of the page there is a version selection button, we need version 5.0.0 <br><br><img src="https://habrastorage.org/webt/uv/ty/1m/uvty1morrsz__nvbd6ruvlwlayw.png" alt="image"><br><br>  Along the way, until we left here, download two more things that will be useful later <br>  <a href="https://www.st.com/en/development-tools/stsw-link008.html">https://www.st.com/en/development-tools/stsw-link008.html</a> <br><br>  Driver ST-LINK V2 <br><br><img src="https://habrastorage.org/webt/h7/df/9a/h7df9ax4cwxty9ns0zmzze2vncs.png" alt="image"><br><br>  and <a href="https://www.st.com/en/development-tools/stm32cubeprog.html">https://www.st.com/en/development-tools/stm32cubeprog.html</a> <br>  The program flasher. <br><br><img src="https://habrastorage.org/webt/uk/sk/-2/uksk-2tupdohhxevd8b07hxgiga.png" alt="image"><br><br>  Installing the driver, flash driver and the Cub itself doesn‚Äôt cause any difficulties, just agree with everything and click further. <br><br>  After the full installation of the necessary software - we can begin to create the project. <br>  To do this, run Cube MX. <br><br>  In the window that appears, click on the button "ACCESS TO MCU SELECTOR". <br><br><img src="https://habrastorage.org/webt/xn/oo/8d/xnoo8dclry8simxu6hfyiabe-t4.png" alt="image"><br><br>  Our target board is equipped with an STM32F103C8T6 microcontroller. <br><br>  We will enter its name in the search bar and double-click on the only option found. <br><br>  In the same table you can see the main stuffing of our MK (64 kilobytes of flash, 20 kilobytes of operatives, etc.). <br><br><img src="https://habrastorage.org/webt/x0/1t/eh/x01teh2xltcmxwkwbbaojaubkdm.png" alt="image"><br><br>  Before us appeared a schematically depicted controller case with legs spread apart. <br><br>  At this stage, it is imperative to choose the debugger connection method. <br><br>  To do this, on the Pinout &amp; Configuration tab in the left menu, select the SYS item and in the drop-down list called ‚ÄúDebug‚Äù set the value to Serial Wire. <br><br>  At the same time, we notice from the corner of our eye that the program reserved two pins on the controller mnemonic for debugging purposes. <br><br><img src="https://habrastorage.org/webt/xw/2q/km/xw2qkmgzlttekf4jkz9neuo_xka.png" alt="image"><br><br>  Once again we remember that we want to flash the LED on our board. <br><br>  To do this, you must first find out which leg it is connected to. <br><br>  This will help us schematic electrical diagram: <br><br><img src="https://habrastorage.org/webt/ml/rw/sy/mlrwsy2uyqgouw1zblz5bbmo3f4.png" alt="image"><br><br>  or more colorful and easy to understand pinout boards <br><br><img src="https://habrastorage.org/webt/bb/e8/qb/bbe8qbpmqltnpz_21lz3kj2nlqg.png" alt="image"><br><br>  The desired LED is on the PC13 foot. <br><br>  Accordingly, it is necessary to configure this output to work in the output mode. <br><br>  For this: <br><br><ol><li>  Find the conclusion on the mnemonic </li><li>  Click on it with the right mouse button, from the drop-down menu, select the item "GPIO_Output" </li><li>  Go to the GPIO menu, </li><li>  In the list, select PC13 </li><li>  Fill in the PC13-TAMPER-RTC Configuration table in accordance with the screenshot, especially we are interested in the parameters GPIO mode and User Label </li></ol><br><img src="https://habrastorage.org/webt/ll/pf/er/llpferxdv6ngirxgeirj6rhimpg.png" alt="image"><br><br>  Continue setting up the project, go to the Clock Configuration tab. <br><br>  In fact, this is one of the most important tabs, which allows you to configure the peripheral clocking parameters, but for now let's not touch anything here, since the main goal at the moment is not that. <br><br><img src="https://habrastorage.org/webt/kb/6k/u7/kb6ku7fu5uue6xmeaprdetxtr90.png" alt="image"><br><br>  Go to the Project Manager tab, under the Project tab. <br><br>  Be sure to fill in the following parameters: <br><br><ol><li>  Project name (it is better to use only Latin letters) </li><li>  The directory in which the project will be created (it is also better to use only the Latin alphabet) </li><li>  IDE, which is planned to work on the project (we plan to use TrueSTUDIO) </li></ol><br><img src="https://habrastorage.org/webt/73/ch/sb/73chsbnak47ppy9tv1mx0d9zury.png" alt="image"><br><br>  We get down below, under the tab Code Generator. <br><br>  Here we must mark the option Generate peripheral initialization as pair ... <br><br>  Thus, we obtain a more structured project in which each type of periphery has its own pair of C and H files. <br><br><img src="https://habrastorage.org/webt/dp/b8/ko/dpb8ko9epztmwqvumlmufrqrnms.png" alt="image"><br><br>  Stayed last step.  Advanced Settings subtab. <br><br><ol><li>  Select the type of HAL library for all peripheral modules. </li><li>  Build project with current settings </li></ol><br><img src="https://habrastorage.org/webt/on/wu/ra/onwura7s4ev10tzjrcmj6a1ccss.png" alt="image"><br><br>  During the initial launch, you may need to download the current version of the library for the selected MK family. <br><br>  We agree to download files: <br><br><img src="https://habrastorage.org/webt/7s/-i/nt/7s-intfpg7zdfp1ypigfsc8wo68.png" alt="image"><br><br>  We are going to warm the kettle or make coffee: <br><br><img src="https://habrastorage.org/webt/bo/6m/mp/bo6mmpi-ho7vnyis61ojgqwnvaq.png" alt="image"><br><br>  After the completion of the kodo-generator, we immediately open it: <br><br><img src="https://habrastorage.org/webt/fl/jw/br/fljwbrkthypwawjgqf5lxocmus0.png" alt="image"><br><br>  Choose any folder where Atollic will store the workspace: <br><br><img src="https://habrastorage.org/webt/ed/j6/uu/edj6uub91zpp2qqwimyvxhbwwua.png" alt="image"><br><br>  If opened successfully, we will see the main Atollic TrueSTUDIO for STM window. <br><br>  The general information interests us a little, therefore we will pass at once to a tree of files. <br><br><img src="https://habrastorage.org/webt/bd/xz/bi/bdxzbidtx2wfsirdkza8e2xd2je.png" alt="image"><br><br>  Find the main.c file there and the int main (void) function: <br><br><img src="https://habrastorage.org/webt/lv/5u/az/lv5uazp5_o5vrc-votks07-v9_4.png" alt="image"><br><br>  For self-test - try to build an empty project. <br><br><ol><li>  In the menu Project -&gt; Rebuild Project </li><li>  At the bottom, select the Console tab. </li><li>  With a successful build, you should get the text Build Finished </li></ol><br><img src="https://habrastorage.org/webt/1f/oc/ih/1focihfsy8cw10popvbomqj5uaa.png" alt="image"><br><br>  Continuation - in the following part. <br><br>  PS: Previously published an article in his <a href="http://multimake.ru/stm32-fast-start-%25D1%2587%25D0%25B0%25D1%2581%25D1%2582%25D1%258C-1-%25D0%25BF%25D0%25BE-%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BB%25D1%258B-cube-mx/">personal blog</a> . </div><p>Source: <a href="https://habr.com/ru/post/442162/">https://habr.com/ru/post/442162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../442148/index.html">VS Code - Puppeteer Snippets</a></li>
<li><a href="../442150/index.html">Neurosexism: Dispelling the myth that men and women have different brains</a></li>
<li><a href="../442152/index.html">1C in Elastic Compute Service Alibaba Cloud. Alibaba's Treasure</a></li>
<li><a href="../442156/index.html">Interface for cloud services in the B2B segment: between beauty and utility</a></li>
<li><a href="../442158/index.html">Heroes III - 20 years</a></li>
<li><a href="../442164/index.html">Roskomnadzor plans to fine Facebook for non-compliance</a></li>
<li><a href="../442166/index.html">Alternative metro scheme of Minsk</a></li>
<li><a href="../442168/index.html">Habramegairing: the best articles and Habra statistics for 12 years. Part 2/2</a></li>
<li><a href="../442176/index.html">Scientists grow a universal army of T-lymphocytes to destroy cancer</a></li>
<li><a href="../442178/index.html">Mayhem - a machine that can find vulnerabilities in programs and fix them.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>