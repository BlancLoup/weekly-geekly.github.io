<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We integrate TeamCity with JIRA - without plug-ins and administrators</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We are developing a large modular UI application consisting of a large number of plug-ins with different release cycles. All code resides in one repos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We integrate TeamCity with JIRA - without plug-ins and administrators</h1><div class="post__text post__text-html js-mediator-article">  We are developing a large modular UI application consisting of a large number of plug-ins with different release cycles.  All code resides in one repository, so a QA-specialist constantly comes to the developers and asks: ‚ÄúAnd what component has changed?  What version to lay out to check the task? ".  The question turned out to be relevant not only on the UI (C #), but also on the backend (Java).  After our rash promises to write everything with pens, I suggested automatically generating the necessary list based on the changed files at the time of the merge pull-request.  In this article we will describe how we organized this by extending the functionality of assemblies on TeamCity (TC) without administrator rights on the server and installing external plug-ins. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/e_/0q/sr/e_0qsrezlhthv-kmt1cxfymzebu.png"></div><a name="habracut"></a><br><h2>  Conditions of the problem </h2><br>  First, let's define what our tool should be: <br><br><ol><li>  If the build is successful, add the build number to JIRA and specify additional information in the comments (in which branch they repaired, which components to deploy, etc.) <br></li><li>  In case of unsuccessful assembly, send a letter to specific people with a specific template and description of the problem. <br></li></ol><br>  Here is what it might look like: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/-z/iu/65/-ziu65qoccnlbihsdingrwuls_s.png"><br><br>  Now we list the implementation requirements: <br><br><ol><li>  Some nontrivial code (logic) after assembly. <br></li><li>  Using Windows and Linux agents. <br></li><li>  Nothing non-standard on agents. <br></li><li>  Easy replicability on build configurations. <br></li></ol><br><h2>  Choosing a solution </h2><br>  Because of the first item in the requirements above, there is no option using Command Line Build Step s in TC, because: <br><br><ol><li>  Difficult logic to write on this is difficult (although possible); <br></li><li>  Specialists who know bash / cmd / powershell are few; <br></li><li>  It is not versioned; <br></li><li>  The same code on Windows and Linux agents cannot be run. <br></li></ol><br>  Therefore, we decided to write a maven-plugin that would be launched by the maven-runner.  The collected version was saved in a binary storage, from where it was downloaded right during the build process.  It was possible each time to assemble it directly during the build, but this would significantly increase the build time, and in addition, create additional dependency on a separate VCS-root, which would lead to unnecessary builds. <br><br><blockquote>  Alternatively, you can make a NuGet-package with the desired exe-file, download it from a private NuGet-server and run it.  Although in our case, due to Linux servers, the option with .NET programs was not available, but in another project, this approach showed itself well. </blockquote><br>  Now about replication on a large number of build-configurations.  There are two ways: <br><br><ol><li>  Build template.  From it you can inherit our assembly, and thus change in one place the various parameters / steps / properties. <br></li><li>  Meta Runner.  Mimics under runner, does not appear in the assembly. <br></li></ol><br>  Build template in our case is not very suitable, since the assemblies in which we want to use it are inherited from their build template.  Also in this case, many irrelevant details appear in the steps / properties. <br><br>  Thus, the possible technical implementation looks like this: <br><br><ol><li>  A separate repository is created, where the code of our plugin is stored. <br></li><li>  The plugin is assembled in a separate build and laid out in the storage of binary artifacts (Nexus or Artifactory). <br></li><li>  For target assemblies in some creative way, run this plugin. <br></li><li>  All this we make out as a meta-runner. <br></li></ol><br><h2>  The simplest maven-plugin </h2><br>  Let's start by creating a simple maven-plugin called 'com.db.meteor: jira-commenter'.  To do this, inherit AbstractMojo, like this: <br><br><pre><code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Mojo</span></span>( name = <span class="hljs-string"><span class="hljs-string">"stampJira"</span></span>, requiresProject = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainMojo</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractMojo</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-meta"><span class="hljs-meta">@Parameter</span></span>( property = <span class="hljs-string"><span class="hljs-string">"jiraCommenter.branch"</span></span>)    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String branchName;    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MojoExecutionException</span></span>{        getLog().info(branchName);    } }</code> </pre> <br>  Here is an example of passing a parameter from mvn.  Also in our pom.xml we specify how to compile it using maven-plugin-plugin: <br><br><pre> <code class="xml hljs">    <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.apache.maven.plugins<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>maven-plugin-plugin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>3.2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span>           <span class="hljs-comment"><span class="hljs-comment">&lt;!-- see http://jira.codehaus.org/browse/MNG-5346 --&gt;</span></span>           <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">skipErrorNoDescriptorsFound</span></span></span><span class="hljs-tag">&lt;/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b</span></span></span><span class="hljs-tag">&gt;</span></span>&gt;true<span class="hljs-tag"><span class="hljs-tag">&lt;/&lt;</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">b</span></span></span><span class="hljs-tag">&gt;</span></span>skipErrorNoDescriptorsFound&gt;       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">configuration</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span>           <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span>               <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>mojo-descriptor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>               <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span>                   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>descriptor<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goal</span></span></span><span class="hljs-tag">&gt;</span></span>               <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">goals</span></span></span><span class="hljs-tag">&gt;</span></span>           <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">execution</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">executions</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plugin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Plugin ready.  Now we will save the changes to our VCS and form a separate assembly that will make mvn: deploy.  It's easy: you need a single build step. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ce/ca6/033/8ceca60335afefb190a4bb3fe4c4e462.png"><br><br>  Now we have a separate build that will build and upload our maven-plugin to the local nexus (or artifactory, depending on what you use for binary artifacts). <br><br><h2>  Running on TeamCity </h2><br>  Now run this plugin on TeamCity to make sure that we are going in the right direction.  To do this, we will make a separate assembly, in which we will not connect any VCS-root and add a single step - launch maven, in which we specify our plugin in the goals and pass our parameter: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ea/2b1/10a/0ea2b110a6ce119b9cf7d2322c2d46f6.png"><br><br>  So, when maven starts, it will download our plugin from the right place, put it into the local cache and launch the specified mojo (in our case, stampJira). <br><br>  In Maven 2, it was still possible to specify LATEST as a version, but from the third version you have to specify the exact version.  By running the build, make sure that our plugin is downloaded and executed: <br><br><img src="https://habrastorage.org/webt/xp/ht/mg/xphtmg502_l875zdfhslfw4jcj4.png"><br><br>  Passing parameters via maven is inconvenient, but, fortunately, there is an alternative.  TeamCity has a REST API.  The REST API itself is quite powerful and allows you to learn almost everything about assemblies, agents, etc.  I will not dwell on it in detail, there is <a href="https://confluence.jetbrains.com/display/TCD10/REST%2BAPI">excellent detailed documentation</a> for this. <br><br>  I used to get information about the current status of the build and about problems that have arisen (tests / something else / build output).  During assembly work, its status will be RUNNING or FAILING, based on this we will determine whether the build is successful or not. <br><br>  To access the API, you need a login and password.  Do not use your own, because when starting the assembly, a one-time login and password are generated, which are available through the teamcity parameter: <br><br><img src="https://habrastorage.org/webt/4g/l_/_f/4gl__f3hnbbnmrgsaooud7joa_o.png"><br><br>  You will also need the build id, which will be passed in the same way. <br><br>  Now it's worth integrating our plugin with Jira to go there and update the necessary tasks.  We will not elaborate here, since this is somewhat beyond the scope of the article.  We used the com.atlassian.jira library for this: jira-rest-java-client, on stackoverflow many examples of its use. <br><br><h2>  Extract meta-runner </h2><br>  I will show with an example how meta-runner is created.  First you need to find the rarely used menu item and come up with a name for the new meta-runner. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64a/df3/5c9/64adf35c9ffadbbb833022adada813b7.png"><br><br>  After extraction, we will be on the tab with the project meta-runners.  There you can edit and update it, if necessary: <br><br><img src="https://habrastorage.org/webt/fp/dg/7b/fpdg7b4iz1tsuudauciirqxqitu.png"><br><br>  Technically, the meta-runner is an xml description of the step (s) to be executed, and it is available just like any other build step.  I, for example, turned out this: <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-runner</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Temporary for article"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Temporary for article<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parameters</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maven.security"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%teamcity.agent.home.dir%/.m2/settings-security.xml"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">spec</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text validationMode='any' display='hidden'"</span></span></span><span class="hljs-tag"> /&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.build.branch"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"master"</span></span></span><span class="hljs-tag"> /&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parameters</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build-runners</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">runner</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Launch Jira commenter."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Maven2"</span></span></span><span class="hljs-tag">&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parameters</span></span></span><span class="hljs-tag">&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"goals"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.db.meteor.tools:jira-commenter:master-1.0.0.33:stampJira"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maven.home"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mavenSelection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mavenSelection:default"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"runnerArgs"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-DjiraCommenter.branch=%teamcity.build.branch%"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.coverage.emma.include.source"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.coverage.emma.instr.parameters"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-ix -*Test*"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.coverage.idea.includePatterns"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"*"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.coverage.jacoco.patterns"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"+:*"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"teamcity.step.mode"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"default"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userSettingsPath"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"%teamcity.agent.home.dir%/.m2/settings.xml"</span></span></span><span class="hljs-tag"> /&gt;</span></span>         <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">param</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userSettingsSelection"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"userSettingsSelection:byPath"</span></span></span><span class="hljs-tag"> /&gt;</span></span>       <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">parameters</span></span></span><span class="hljs-tag">&gt;</span></span>     <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">runner</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">build-runners</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">requirements</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">settings</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-runner</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  If you wish, you can write this XML yourself, but it is easier to get the initial one from the assembly.  You can edit it right here by changing the XML.  We, for example, change the build version this way. <br><br>  Now it is possible to add a new buildstep in any build in the current project: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee2/aff/725/ee2aff725bde83c43f488a6cb02050e0.png"><br><br>  Moreover, the parameters that were used in the test build are now available for filling in our build step, for example, teamcity.build.branch: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b34/782/7ea/b347827ea982da4bfb02a54f954bd70f.png"><br><br>  Great, now we can ask our colleagues and all those interested to add this step to our assembly and enjoy life. <br><br>  <i>Note: after extracting meta-runner-a, it does not synchronize with the project from which it was extracted.</i>  <i>So if you want to change something, change it in it.</i> <br><br><h2>  Run always? </h2><br>  So now with a successful build our code will be executed.  And if the assembly failed?  In advanced options, there is a useful option: "when to perform this step": <br><br><img src="https://habrastorage.org/getpro/habr/post_images/41a/f02/594/41af02594c4e09dd684998c6b8c446f8.png"><br><br>  Here a suitable execution condition is selected.  For the current task, we set ‚ÄúEven if some of the previous steps failed‚Äù. <br><br>  This is how we managed to make our QA-engineers happier - now after each merge request in the master or release branches, a detailed comment is written to the corresponding task in JIRA about what has changed and what to deploy for testing. </div><p>Source: <a href="https://habr.com/ru/post/347998/">https://habr.com/ru/post/347998/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../347988/index.html">Open lesson on the topic "Areas of knowledge of marketing and TV + Search"</a></li>
<li><a href="../347990/index.html">In a section: the news aggregator on Android with backend. Distributed Message Processing Systems (Spark, Storm)</a></li>
<li><a href="../347992/index.html">False alarms. New technique of catching two birds with one stone</a></li>
<li><a href="../347994/index.html">UX research and evidence strength</a></li>
<li><a href="../347996/index.html">Parsing sites or long-term construction of the Moscow region</a></li>
<li><a href="../348000/index.html">Convolutional neural network, part 1: structure, topology, activation functions and training set</a></li>
<li><a href="../348002/index.html">News from the world of OpenStreetMap ‚Ññ392 (01.16.2018-22.01.2018)</a></li>
<li><a href="../348004/index.html">Swift Package Manager</a></li>
<li><a href="../348006/index.html">Cryptocurrency Phishing</a></li>
<li><a href="../348008/index.html">We are friends of gRPC with a long-lived project, PHP and front-end</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>