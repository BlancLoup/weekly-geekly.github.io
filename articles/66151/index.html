<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Partitioning tables in mySQL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting with version 5.1, mySQL supports horizontal partitioning of tables. What it is? Partitioning is partitioning large tables into logical parts ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Partitioning tables in mySQL</h1><div class="post__text post__text-html js-mediator-article"> Starting with version 5.1, mySQL supports horizontal partitioning of tables.  What it is?  <b>Partitioning is partitioning large tables into logical parts according to selected criteria.</b>  .  At the lower level for myISAM tables, these are physically different files, 3 for each partition (table description, index file, data file).  For innoDB tables in the default configuration, there are different table spaces in the innoDB files (do not forget that innoDB allows you to customize individual storages at the database level or even specific tables). <br><br>  <b>What does this look like?</b> <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>CREATE TABLE orders_range ( <br> customer_surname VARCHAR(30), <br> store_id INT, <br> salesperson_id INT, <br> order_date DATE, <br> note VARCHAR(500) <br> ) ENGINE = MYISAM <br> PARTITION BY RANGE( YEAR(order_date) ) ( <br> PARTITION p_old VALUES LESS THAN(2008), <br> PARTITION p_2008 VALUES LESS THAN(2009), <br> PARTITION p_2009 VALUES LESS THAN(MAXVALUE) <br> );</code> <br> <br>  What do we get?  The first ‚Äútable‚Äù will store data for the ‚Äúarchival‚Äù period, until 2008, the second - for 2008, and the ‚Äúthird‚Äù - everything else. <br><br>  The most delicious thing is that you do not need to rewrite / optimize requests at all: <br><br> <code>select * from orders_range where order_date='2009-08-01';</code> <br> <br>  And this is what happens: <br><br> <code>mysql&gt; explain partitions select * from orders_range3 where order_date='2008-08-01'; <br> +----+-------------+---------------+------------+--------+---------------+------+---------+------+------+-------+ <br> | id | select_type | table | partitions | type | possible_keys | key | key_len | ref | rows | Extra | <br> +----+-------------+---------------+------------+--------+---------------+------+---------+------+------+-------+ <br> | 1 | SIMPLE | orders_range3 | p_2008 | system | NULL | NULL | NULL | NULL | 1 | | <br> +----+-------------+---------------+------------+--------+---------------+------+---------+------+------+-------+ <br> 1 row in set (0.00 sec) <br></code> <br><br>  We see that when this query is executed, the work will go exclusively with the sub-table p_2008. <br><br>  Moreover, acceleration is achieved even in the case of executing queries that affect all data in all partitions - in this case, first, the tables are initially ‚Äúprocessed‚Äù by fewer, then the data is combined and the final calculations are performed.  So just the ‚Äúfirst‚Äù stages, in this case will be much faster. <br><br>  <b>What other benefits are there?</b> <br><br>  I would call the main advantage the fact that the partition with the ‚Äúoperational‚Äù data (that is, the last for which the sampling occurs most often) has a minimum size, and as a result, they can reside in the RAM. <br><br>  If you have a log table, which is continuously recorded and the hard drives do not have time, and religion does not allow you to set up a raid, you can set up partitioning by hash function, and specify one partition per hard drive available to you.  In this case, the new data will be written evenly on all hard drives. <br><br>  <b>What are the ways to "separate" data provides mySQL?</b> <br><br>  1. RANGE <br><br>  By range of values <br><br>  PARTITION BY RANGE (store_id) ( <br>  PARTITION p0 VALUES LESS THAN (10), <br>  PARTITION p1 VALUES LESS THAN (20), <br>  PARTITION p3 VALUES LESS THAN (30) <br>  ); <br><br>  2. LIST <br><br>  According to the exact list of values <br><br>  PARTITION BY LIST (store_id) ( <br>  PARTITION pNorth VALUES IN (3,5,6,9,17), <br>  PARTITION pEast VALUES IN (1,2,10,11,19,20) <br>  ) <br><br>  Why, you ask?  It is necessary to split into partitions either on the basis of considerations of sample optimization (which is more often) or on the basis of considerations of record optimization (less often).  Accordingly, the ideal option is when you split the table into as many partitions as possible so that 90% of all samples occur within the same partition.  And if you have a complicated sampling logic (for example, objects located in the northern quarters of the city, whose IDs are disparate), then sometimes it makes sense to list them forcibly. <br><br>  3. HASH <br><br>  PARTITION BY HASH (store_id) <br>  PARTITIONS 4; <br><br>  You do not control the partition, just indicate what field to build the hash and how many "sub-tables" to create.  What for?  Sampling on the specified field is much faster.  In some cases, it allows to achieve "uniform spread" and accelerate data recording. <br><br>  4. KEY <br><br>  Almost the same as HASH, but more logically - by key. <br><br>  PARTITION BY KEY (s1) <br>  PARTITIONS 10; <br><br>  Those.  selection on the specified key field is as efficient as possible. <br><br>  But here you should also decide on the method of partitioning.  Well suited for the visitor counter, when his login is the only identifier for which it is necessary to select all other data. <br><br>  <b>What is not?</b> <br><br>  No vertical partitioning.  This is when different columns (fields) are in different "sub-tables".  Since sometimes it is useful, you can achieve it yourself, even if not so transparent: divide the table into two, connecting them by the primary key.  If you really want beauty - you can additionally create a VIEW for them, for example, in order not to overwrite the old parts of the code. <br><br>  Why do this?  For example, in a table where you basically have numbers and dates, there is one VARCHAR (255) comment field, which is used less often than the other fields.  If it is moved to another table, we will get a fixed row size (mySQL will be able to accurately calculate the position of the desired row by index in the data file).  The table will become more resilient to failures in case of emergency situations (again, due to the fixed size of the string).  Well, the size of the table itself will significantly decrease. <br><br>  And ending the article I will give an example of a more ‚Äúreal‚Äù table partitioning - monthly.  Since LIST / RANGE accept only integer values, you need to skew a bit: <br><br>  PARTITION BY RANGE (TO_DAYS (order_date)) ( <br>  PARTITION y2009m1 VALUES LESS THAN (TO_DAYS ('2009-02-01')), <br>  PARTITION y2009m2 VALUES LESS THAN (TO_DAYS ('2009-03-01')), <br>  PARTITION y2009m3 VALUES LESS THAN (TO_DAYS ('2009-04-01')) <br>  ); <br><br>  PS: In mysql, you always have to ‚Äúfake a little‚Äù, so there will never be a bore with it, and we, in turn, will never be without work :) </div><p>Source: <a href="https://habr.com/ru/post/66151/">https://habr.com/ru/post/66151/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../66142/index.html">Script to monitor the status of hosts on the network</a></li>
<li><a href="../66145/index.html">One character price per vulnerability</a></li>
<li><a href="../66146/index.html">7 zip icons</a></li>
<li><a href="../66148/index.html">Windows Mobile 6.5 - to the masses. Windows Mobile 7 - for geeks</a></li>
<li><a href="../66149/index.html">User error</a></li>
<li><a href="../66152/index.html">Stupid moblin</a></li>
<li><a href="../66154/index.html">Help! The programmer went on vacation</a></li>
<li><a href="../66155/index.html">What is the correct order of answers?</a></li>
<li><a href="../66157/index.html">dudu.ru is a simple and convenient service for creating video conferencing, video broadcasting or video chatting.</a></li>
<li><a href="../66160/index.html">Set the execution time of the console command</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>