<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Almost a web-server with your own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, there have been several posts on attracting attention to certain programming languages ‚Äã‚Äãusing the example of writing some simple ‚Äúweb-serve...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Almost a web-server with your own hands</h1><div class="post__text post__text-html js-mediator-article">  Recently, there have been several posts on attracting attention to certain programming languages ‚Äã‚Äãusing the example of writing some simple ‚Äúweb-server‚Äù.  Since <strike>this</strike> perl <strike>booze</strike> has not yet been touched, I‚Äôll add my five kopecks :) <br>  We will write a simple server application masquerading as an http-server. <br><a name="habracut"></a><br><br>  Our "server" will listen to the local port 8080 and greet all those who applied, or give the contents of the requested file if available (in the folder from which the script server was launched). <br><br>  For a start, simple and short code.  I think at this stage, especially comment does not require anything, so leave commenting for later. <br><blockquote><ol><li>  <font color="#666666">#! / usr / bin / perl</font> </li><li>  <font color="#000000">use</font> LWP <font color="#339933">::</font> <font color="#000000">Socket</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#0000ff">$ headers</font> <font color="#339933">=</font> <font color="#009966">"HTTP / 1.1 200 OK <font color="#000099">\ r</font> <font color="#000099">\ n</font> Content-Type: text / html <font color="#000099">\ r</font> <font color="#000099">\ n</font> <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">=</font> <font color="#000000">new</font> LWP <font color="#339933">::</font> <font color="#000000">Socket</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">bind</font> <font color="#009900">(</font> <font color="#009966">'127.0.0.1'</font> <font color="#339933">,</font> <font color="#009966">'8080'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">listen</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#0000ff">$ socket</font> <font color="#339933">=</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">accept</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#009966">"Hello from Habr"</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ file_name</font> <font color="#339933">;</font>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">read</font> <font color="#009900">(</font> <font color="#0000ff">\ $ file_name</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ file_name</font> <font color="#339933">= ~</font> <font color="#009966">s / GET \ / ([^] *) HTTP. + / $ 1 / s</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#000066">open</font> FILE <font color="#339933">,</font> <font color="#009966">'&lt;'</font> <font color="#339933">,</font> <font color="#0000ff">$ file_name</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#000066">join</font> <font color="#009966">""</font> <font color="#339933">,</font> <font color="#009999">&lt;FILE&gt;</font> <font color="#339933">;</font>  <font color="#000066">close</font> FILE <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">write</font> <font color="#009900">(</font> <font color="#0000ff">$ headers</font> <font color="#339933">.</font> <font color="#0000ff">$ content</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li></ol></blockquote><br>  This is an ugly code, so it‚Äôs better not to write it, this example is only to show that the required functionality, if necessary, can be implemented fairly quickly and with a small amount of code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This code should be refined and supplemented.  Let's make it a bit more readable, add a check whether it was possible to bind to the specified port (otherwise it is already busy), we will check the existence of the file before trying to open it, well, it will use the strict and warnings pragmas. <br><blockquote><ol><li>  <font color="#666666">#! / usr / bin / perl</font> </li><li></li><li>  <i><font color="#000000">use</font> strict</i> <font color="#339933">;</font> </li><li>  <i><font color="#000000">use</font> warnings</i> <font color="#339933">;</font> </li><li></li><li>  <font color="#000000">use</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ headers</font> <font color="#339933">=</font> <font color="#009966">"HTTP / 1.1 200 OK <font color="#000099">\ r</font> <font color="#000099">\ n</font> Content-Type: text / html <font color="#000099">\ r</font> <font color="#000099">\ n</font> <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ sock</font> <font color="#339933">=</font> <font color="#000000">new</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <i><font color="#000066">die</font> <font color="#009966">"Can't bind a socket"</font> <font color="#b1b100">unless</font></i> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">bind</font> <font color="#009900">(</font> <font color="#009966">'127.0.0.1'</font> <font color="#339933">,</font> <font color="#009966">'8080'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">listen</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#b1b100">my</font> <font color="#0000ff">$ socket</font> <font color="#339933">=</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">accept</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#009966">"Hello from Habr"</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ file_name</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">read</font> <font color="#009900">(</font> <font color="#0000ff">\ $ file_name</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ file_name</font> <font color="#339933">= ~</font> <font color="#009966">s / GET \ / ([^] *) HTTP. + / $ 1 / s</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <i><font color="#339933">-</font> f <font color="#0000ff">$ file_name</font> <font color="#b1b100">and</font></i> <font color="#000066">open</font> FILE <font color="#339933">,</font> <font color="#009966">'&lt;'</font> <font color="#339933">,</font> <font color="#0000ff">$ file_name</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#000066">join</font> <font color="#009966">""</font> <font color="#339933">,</font> <font color="#009999">&lt;FILE&gt;</font> <font color="#339933">;</font> </li><li>  <font color="#000066">close</font> FILE <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">write</font> <font color="#009900">(</font> <font color="#0000ff">$ headers</font> <font color="#339933">.</font> <font color="#0000ff">$ content</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br>  Just a few lines more, but the script has become a bit more cultured. <br><br>  Here we have <br><br> <i><code>use LWP::Socket;</code></i> <br>  we connect the module we need.  It is quite simple to use, so I chose it. <br><br> <i><code>my $sock = new LWP::Socket();</code></i> <br>  create a socket <br><br> <i><code>$sock-&gt;bind('127.0.0.1', '8080'); <br> $sock-&gt;listen(10);</code></i> <br>  bind the socket on the local port 8080 and set the queue length <br><br> <i><code>while ( my $socket = $sock-&gt;accept(10) ) {</code></i> <br>  waiting for connection <br>  when connected to $ socket, the new LWP :: Socket () will return <br><br> <i><code>$socket-&gt;read( \$file_name ); <br> $file_name =~ s/GET \/([^ ]*) HTTP.+/$1/s;</code></i> <br>  read everything from the socket and fetch the name of the requested file <br><br> <i><code>$socket-&gt;write( $headers . $content );</code></i> <br>  write the headers and the answer to the socket <br><br> <i><code>$socket-&gt;shutdown();</code></i> <br>  close the received ‚Äúper session‚Äù LWP :: Socket () <br><br>  This could even be finished, but we want to better disguise as an http-server, which means we need multi-threading in order to withstand the load :) <br>  To do this, we use the FCGI :: ProcManager module, as a result we will have one ‚Äúhead‚Äù process and five children.  To do this, add four lines: <br><blockquote><ol><li>  <font color="#666666"># ...</font> </li><li></li><li>  <font color="#000000">use</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#339933">;</font> </li><li>  <i><font color="#000000">use</font> FCGI <font color="#339933">::</font> <font color="#006600">ProcManager</font> <font color="#009966">qw / pm_manage pm_pre_dispatch pm_post_dispatch /</font></i> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ headers</font> <font color="#339933">=</font> <font color="#009966">"HTTP / 1.1 200 OK <font color="#000099">\ r</font> <font color="#000099">\ n</font> Content-Type: text / html <font color="#000099">\ r</font> <font color="#000099">\ n</font> <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ sock</font> <font color="#339933">=</font> <font color="#000000">new</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000066">die</font> <font color="#009966">"Can't bind a socket"</font> <font color="#b1b100">unless</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">bind</font> <font color="#009900">(</font> <font color="#009966">'127.0.0.1'</font> <font color="#339933">,</font> <font color="#009966">'8080'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">listen</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <i>pm_manage <font color="#009900">(</font> n_processes <font color="#339933">=&gt;</font> <font color="#cc66cc">5</font> <font color="#009900">)</font></i> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#b1b100">my</font> <font color="#0000ff">$ socket</font> <font color="#339933">=</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">accept</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <i>pm_pre_dispatch <font color="#009900">(</font></i> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#009966">"Hello from Habr"</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># ...</font> </li><li></li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <i>pm_post_dispatch <font color="#009900">(</font></i> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br>  And our ‚Äúserver‚Äù is ready.  You can use :).  It remains to give the complete code so that it can be copied into the file, run and make sure that everything works. <br>  This code with a few additions: <br>  - added headlines <br>  - ‚Äúgreeting‚Äù is given as an index page <br>  - as the rest - what will be asked <br>  - if the file is not found we inform the browser about this 404 error <br>  - added comments <br><blockquote><ol><li>  <font color="#666666">#! / usr / bin / perl</font> </li><li></li><li>  <font color="#000000">use</font> strict <font color="#339933">;</font> </li><li>  <font color="#000000">use</font> warnings <font color="#339933">;</font> </li><li></li><li>  <font color="#000000">use</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#339933">;</font> </li><li>  <font color="#000000">use</font> FCGI <font color="#339933">::</font> <font color="#006600">ProcManager</font> <font color="#009966">qw / pm_manage pm_pre_dispatch pm_post_dispatch /</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># Prepare headers</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ headers</font> <font color="#339933">=</font> <font color="#009966">"HTTP / 1.1% d OK <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> </li><li>  <font color="#339933">.</font>  <font color="#009966">"Server: FakeServer / 2009-09-12 <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> </li><li>  <font color="#339933">.</font>  <font color="#009966">"Content-Type: text / html <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> </li><li>  <font color="#339933">.</font>  <font color="#009966">"Content-Length:% d <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> </li><li>  <font color="#339933">.</font>  <font color="#009966">"Connection: close <font color="#000099">\ r</font> <font color="#000099">\ n</font> <font color="#000099">\ r</font> <font color="#000099">\ n</font> "</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># Prepare and open socket</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ sock</font> <font color="#339933">=</font> <font color="#000000">new</font> LWP <font color="#339933">::</font> <font color="#006600">Socket</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#000066">die</font> <font color="#009966">"Can't bind a socket"</font> <font color="#b1b100">unless</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">bind</font> <font color="#009900">(</font> <font color="#009966">'127.0.0.1'</font> <font color="#339933">,</font> <font color="#009966">'8080'</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">listen</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># Create 5 childs</font> </li><li>  pm_manage <font color="#009900">(</font> n_processes <font color="#339933">=&gt;</font> <font color="#cc66cc">5</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># Accepts a new connection</font> </li><li>  <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#b1b100">my</font> <font color="#0000ff">$ socket</font> <font color="#339933">=</font> <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">accept</font> <font color="#009900">(</font> <font color="#cc66cc">10</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666"># Passing direction to child</font> </li><li>  pm_pre_dispatch <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#666666"># Default content</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#009966">"&lt;html&gt; &lt;body&gt; &lt;h1&gt; Hello from Habr &lt;/ h1&gt; &lt;/ body&gt; &lt;/ html&gt;"</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ stat</font> <font color="#339933">=</font> <font color="#cc66cc">200</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">my</font> <font color="#0000ff">$ file_name</font> <font color="#339933">;</font> </li><li>  <font color="#666666"># Read from socket</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">read</font> <font color="#009900">(</font> <font color="#0000ff">\ $ file_name</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#666666"># Get wanted file name</font> </li><li>  <font color="#0000ff">$ file_name</font> <font color="#339933">= ~</font> <font color="#009966">s / GET \ / ([^] *) HTTP. + / $ 1 / s</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ file_name</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#339933">-</font> f <font color="#0000ff">$ file_name</font> <font color="#b1b100">and</font> <font color="#000066">open</font> FILE <font color="#339933">,</font> <font color="#009966">'&lt;'</font> <font color="#339933">,</font> <font color="#0000ff">$ file_name</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666"># Read from file</font> </li><li>  <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#000066">join</font> <font color="#009966">""</font> <font color="#339933">,</font> <font color="#009999">&lt;FILE&gt;</font> <font color="#339933">;</font> </li><li>  <font color="#000066">close</font> FILE <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">else</font> <font color="#009900">{</font> </li><li>  <font color="#0000ff">$ content</font> <font color="#339933">=</font> <font color="#009966">"File not found"</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ stat</font> <font color="#339933">=</font> <font color="#cc66cc">404</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#666666"># Puts headers and content into the socket</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">write</font> <font color="#009900">(</font> <font color="#000066">sprintf</font> <font color="#009900">(</font> <font color="#0000ff">$ headers</font> <font color="#339933">,</font> <font color="#0000ff">$ stat</font> <font color="#339933">,</font> <font color="#000066">length</font> <font color="#0000ff">$ content</font> <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">write</font> <font color="#009900">(</font> <font color="#0000ff">$ content</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#0000ff">$ socket</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666"># Child's work complete</font> </li><li>  pm_post_dispatch <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666"># Close socket</font> </li><li>  <font color="#0000ff">$ sock</font> <font color="#339933">-&gt;</font> <font color="#006600">shutdown</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li></ol></blockquote><br><br>  Instructions for use: <br>  - copy code and paste into file <br>  - run (perl file.pl) <br>  - in the browser open https: //127.0.0.1: 8080 / <br><br>  I hope the last option will not scare anyone :) <br><br>  PS If anyone is interested, then this case with 10 children ate 15 meters of RAM, while testing with requests in 30 threads, it managed to process about 2000 requests per second (10 threads requested existing files).  Launched on the local machine, on the test, both cores were loaded to the ceiling. <br><br>  <font color="999999">---------</font> <font color="999999"><br></font>  <font color="999999">Backlight <a href="http://highlight.hohli.com/">from here</a></font> </div><p>Source: <a href="https://habr.com/ru/post/69411/">https://habr.com/ru/post/69411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../69404/index.html">Divorce on the verge of robbery</a></li>
<li><a href="../69405/index.html">Zend 5.5 + Windows 7</a></li>
<li><a href="../69406/index.html">Top 5 Web Trends 2009: # 3 Personalization</a></li>
<li><a href="../69409/index.html">SoftKey began to accept pre-order for Windows 7</a></li>
<li><a href="../69410/index.html">UK apologizes for the death of Alan Turing</a></li>
<li><a href="../69416/index.html">Online wedding</a></li>
<li><a href="../69417/index.html">Text at any cost: DOCX and ODT</a></li>
<li><a href="../69419/index.html">ADO.NET Data Services - what awaits us in the future</a></li>
<li><a href="../69424/index.html">dual-pivot quicksort</a></li>
<li><a href="../69426/index.html">Proposal for improving the login interface to Habr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>