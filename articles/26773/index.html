<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fox Plugins Live</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last night I could not sleep, and I decided to do something useful (for once, for all). Because you can only benefit others by benefiting yourself, I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fox Plugins Live</h1><div class="post__text post__text-html js-mediator-article">  Last night I could not sleep, and I decided to do something useful (for once, for all).  Because you can only benefit others by benefiting yourself, I tried to make my life easier: create a plugin that monitors the change of some numbers on one page (something like ‚Äúnumber of unread comments in topics you follow‚Äù and ‚Äúnumber of letters‚Äù, if more than zero - An excuse to go and read these new comments. These numbers are displayed on two well-known collective blogs at the top of the page, but you can learn about their changes in their state only by updating this page - there is no mechanism for mail-rss-etc.  Renault. Well, I hope, clearly explained).  After an hour and a half, a more or less stable version of the plugin was ready, and I will be happy to tell you how to repeat my feat at any time of the year. <br><br>  So on the agenda: <strong>Create plugins for FireFox quickly and cleanly.</strong> <br><a name="habracut"></a><br>  I just want to warn you: I‚Äôm not a pro and not a guru in this business, before my plug-in experiences were scripts for GreaseMonkey (well, you all saw my <a href="http://habrahabr.ru/blog/i_am_clever/36748.html">HabraHacker</a> - a gizmo for easy editing comments).  However, the plugin seems to be written, and it even works;) <br><br>  I needed: <br><ol><li>  <strong>Firefox</strong> .  I, for example, have a 3rd minefield version. </li><li>  <strong>Firefox Portable</strong> .  Maybe, of course, it is not needed, but I put it: for an easy and quick run of the plug-in in the second version. </li><li>  <strong>Editor</strong>  I choose Notepad ++.  I recommend it to you - it is very fast, easy, convenient, and with a huge number of functions, and it also highlights everything.  Well, if you do not like it - take any, it is desirable that he was able to highlight JavaScript and XML. </li><li>  <strong>JavaScript knowledge</strong> .  Oddly enough, they will also be needed. </li><li>  <strong>A little wit and imagination</strong> .  I do not know why. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I began to think about how, in fact, to begin.  Looking for tutorials in Google, I found a couple, but somehow I didn‚Äôt like them - probably, at 3 o'clock in the morning, I don‚Äôt have time to read such opus;) Looking around my interface, I found <strong><a href="http://habrahabr.ru/blog/ilhh/4740.html">Habragolik</a></strong> very similar to the intended plugin.  He also prints numbers - isn't that what he needs?  ;) <br>  Without special moral barriers, I downloaded its <a href="">distribution kit</a> to a hard disk and, bearing in mind that <strong>all the plugins in the XPI format are nothing more than ZIP archives with a bunch of different files</strong> , I changed the extension to it: <strong>habraholic-0.2.zip</strong> .  Having unzipped it somewhere and applying item 5 of inventory, I made an inventory of things: <br><pre>  + chrome
    + content
      - panel.xul // the body of our plugin.  XUL * description of the panel
      - script.js // and this is already a soul.  Well, more precisely the mind ... instincts.  in short, the entire javascript executable code
      - prefs.xul // describes the settings window
      - habr.ico // strange picture with a large letter H. probably symbolizes habrabra
  + defaults
    + preferences
      - defaults.js // there - default values ‚Äã‚Äãof variables that the plugin stores in the browser forever.  there are usually settings
  - install.rdf // strange XML file describing the plugin
  - chrome.manifest // apparently, tells the browser about which XUL file to connect when loading the browser
</pre><br>  * Is an XML-based language describing interfaces.  Supports JS, similar to XHTML - well, everything.  The plugin will be written on it. <br><br>  I started with the <strong>install.rdf file</strong> .  Opening it, I ran through the lines in thought: <br><blockquote><pre>  &lt;em: id&gt; habraholic@vladislav.semenov &lt;/ em: id&gt; </pre></blockquote>  I still do not understand what I mean, and I did not try: I just put the name of the plug-in in front of the dog in Latin letters, and after the dog I gave my name and surname. <br><blockquote><pre>  &lt;em: version&gt; 0.2 &lt;/ em: version&gt; </pre></blockquote>  Version.  Just in case, put 0.1 <br><blockquote><pre>  &lt;em: type&gt; 2 &lt;/ em: type&gt; </pre></blockquote>  I only found out later what it is (type: skin, plugin or something else. Well, something like that), but then I decided not to touch it.  my plugin is unlikely to be much different - well, I will not change. <br><blockquote><pre>  &lt;em: optionsURL&gt; chrome: //habraholic/content/prefs.xul &lt;/ em: optionsURL&gt; </pre></blockquote>  chrome: // it‚Äôs like a link to the directory with all the contents of the / chrome / directories from the plugins.  This will point to the /chrome/contents/prefs.xul file.  My plugin had no settings, so I commented out this line () <br><blockquote><pre>  &lt;em: targetApplication&gt;
       &lt;Description&gt;
         &lt;em: id&gt; {ec8030f7-c20a-464f-9b0e-13a3a9e97384} &lt;/ em: id&gt;
         &lt;em: minVersion&gt; 1.5 &lt;/ em: minVersion&gt;
         &lt;em: maxVersion&gt; 2.0.0. * &lt;/ em: maxVersion&gt;
       &lt;/ Description&gt;
     &lt;/ em: targetApplication&gt; </pre></blockquote>  Experimentally (well, looking at the help;) I found out that the ID is the application ID: Firefox, for example, {ec8030f7-c20a-464f-9b0e-13a3a9e97384}, and it‚Äôs not worth changing.  The maximum version was set to 3.1a1pre (from the same place, from the help, I learned). <br><blockquote><pre>  &lt;em: name&gt; Habragolik &lt;/ em: name&gt; and others </pre></blockquote>  Well, everything is clear with them.  Changed, saved and closed the file. <br><br>  Next in line was the chrome.manifest <strong>file</strong> .  In it, I changed only the path to the panel.xul <strong>file</strong> : I replaced <strong>habraholic</strong> with my name. <br><br>  Looking in <strong>/defaults/preferences/defaults.js</strong> , I found that there are only user configurable variables.  I commented out them (//). <br><br>  Then I deleted the file <strong>/chrome/content/prefs.xul</strong> as useless (we don‚Äôt have any more settings, right?) And replaced <strong>/chrome/content/habr.ico with</strong> my icon. <br><br>  It is time for design and layout: <strong>/chrome/content/panel.xul</strong> .  The first thing I did was change all the element IDs and labels: I replaced ‚Äúhabraholic‚Äù and ‚ÄúKarma‚Äù with various other words.  Removed the setting item and the separator (Menuseparator) from the menu (described inside the element) and the word ‚Äúkarma‚Äù from the text of the first item.  I changed the paths to the icon and the script (and &lt;script ...&gt;) and renamed the called javascript functions to onclick = '' and oncommand = ''. <br><br>  Here you can play a little: add a couple more icons, a couple of labels and other elements.  But you can always play around, but I will go to the code part of the program: <strong>/chrome/content/script.js</strong> . <br><br>  I started by renaming all functions (removed habraholic from names, and so on).  Then he looked at them all: <br><ul><li>  <strong>just the code</strong> is executed as usual, as soon as it appears.  Here he only assigned an event handler to the browser load - so I left it as it is, changing the name of the handler. </li><li>  <strong>habraholicLoad</strong> is just this handler.  It starts a function that will update the karma every 5 minutes.  The handler did not change, changed the name of the function being run. </li><li>  <strong>habraholicLeftClick</strong> - handles click.  If the username is filled in the settings, it causes the update karma.  If not, it calls the function that opens the settings.  I removed the entire IF, leaving the first branch: now only updated. </li><li>  <strong>habraholicUpdateKarma</strong> is the updater itself.  If the settings are configured - creates XMLHttpRequest to habra-api.  If not configured, change the contents of the label so that the user understands that it is time to adjust everything.  I left only the creation of the object, removing all the checks, and changed the URL that is being accessed. </li><li>  <strong>habraholicUpdateKarmaRepeatedly</strong> is the same function called by habraholicLoad and every 10 minutes calling habraholicUpdateKarma ().  I changed the time interval (it is in milliseconds) and proper names (function names). </li><li>  <strong>habraholicSetKarma</strong> - callback from that XMLHttpRequest.  It works like this: it creates variables with default values, then in try {} it tries to isolate the values ‚Äã‚Äãof karma and habrasils from the server response and replace those variables with them.  Since I didn‚Äôt see any XML, I simply pulled the entire HTML code of the resulting page into a variable and ran through it regularly: <pre>  var html = httpRequest.responseText;
 mythings = / &lt;li id ‚Äã‚Äã= "things"&gt; &lt;a href="\/my\/"&gt; &lt;span&gt; &lt;em&gt; my things (. +?) &lt;\ / em&gt; /. exec (html);
 if (mythings) mythings = mythings [1];
 else mythings = "'; </pre></li><li>  <strong>habraholicShowPrefs</strong> - shows the settings window.  Removed. </li><li>  <strong>habraholicGetUsername, habraholicIsRatingPositionHidden</strong> - get permanently saved settings.  Removed. </li><li>  <strong>habraholicLoadProfile</strong> - opens a user profile.  Modified for their own purposes. </li><li>  <strong>habraholicLoadPage</strong> - <strong>awesome</strong> useful thing: opens a page (tab) with the address we need.  Excellent friends with a click wheel ("open in a new tab").  Renamed and did not touch anymore. </li></ul><br><br>  Oh.  It seems written.  Now I packed all the files into plugin.zip and renamed it to plugin.xpi, then dragged it to the browser.  He offered to install it, and I am glad - I press the button, and then restart the browser. <br><br>  The browser did not fall and even showed a panel.  The panel, of course, did not show everything as it should, but after some debugging (the alert function worked fine) and I thought everything led to a normal view (for this, I re-pack the plugin each time, rename it and drag it to the browser window - doubtful entertainment;).  Hooray! <br><br>  It was a small matter: I changed the version in <strong>/chrome/content/prefs.xul</strong> to proud 0.2 and went to upload to <a href="http://addons.mozilla.org/">addons.mozilla.org</a> .  There I had to enter a lot of things, but in the end I received my own plugin page there, of course, without delay, to publish a link to it in places where supposed users gather.  After a long correction of quickly found errors, I became the happy author of a good and working plug-in.  And you, habrachelovek? </div><p>Source: <a href="https://habr.com/ru/post/26773/">https://habr.com/ru/post/26773/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267721/index.html">Apache vs Nginx: a practical look</a></li>
<li><a href="../267723/index.html">Bots in the city of Innopolis</a></li>
<li><a href="../267725/index.html">Card Design: How and Why</a></li>
<li><a href="../267727/index.html">PHP: programming culture</a></li>
<li><a href="../267729/index.html">Game client download tracking system. Part 2</a></li>
<li><a href="../267731/index.html">13 basic principles of game design. Direction and behavior</a></li>
<li><a href="../267733/index.html">Greenplum db</a></li>
<li><a href="../267735/index.html">Android Data Binding in RecyclerView</a></li>
<li><a href="../267737/index.html">ICQuery is a fictional program that communicates with the user and performs tasks described in the natural language of communication.</a></li>
<li><a href="../267743/index.html">Planning resources for Veeam Backup & Replication 8.0: calculating the required place in the repository</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>