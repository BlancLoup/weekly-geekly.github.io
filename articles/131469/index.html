<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The method of detection and dynamic protection from DDoS type SYN-flood</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habrasoobschestvo. 

 About the relevance of DDoS attacks in our time will not tell. Just look at the statistics . I encounter attacks by the natu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The method of detection and dynamic protection from DDoS type SYN-flood</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habrasoobschestvo. <br><br>  About the relevance of DDoS attacks in our time will not tell.  Just look at the <a href="http://asert.arbornetworks.com/2010/12/the-internet-goes-to-war/">statistics</a> .  I encounter attacks by the nature of my activity quite often, the idea of ‚Äã‚Äãdynamic protection from a SYN-flood DDoS on the Linux and FreeBSD severs arose.  Also proposed implementation of monitoring SYN-flood on SNMP. <br><br>  About this all under the cut. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  TCP options </h4><br>  Operating systems provide the ability to fine-tune the settings for working in a network using TCP.  On UNIX, this is done by changing the values ‚Äã‚Äãof the kernel parameters.  The parameters that affect the processing of the SYN queue are described below.  In parentheses are the default values: <br><ul><li>  <i>net.core.somaxconn</i> - maximum value of the connection queue (128) </li><li>  <i>tcp_syn_retries</i> - the number of attempts to transmit a SYN to successfully establish a connection (5) </li><li>  <i>tcp_synack_retries</i> - the number of attempts to send a SYN, ACK response to a SYN request (5) </li><li>  <i>tcp_keepalive_intvl</i> - how long to wait for the answer of each sample keepalive (75 seconds) </li><li>  <i>tcp_keepalive_probes</i> - the number of TCP keepalive samples that must be passed before deciding that a connection is lost (9) </li><li>  <i>tcp_keepalive_time</i> - frequency with which TCP keepalive packets need to be sent to keep the connection active if it is not currently in use (7200 seconds) </li></ul>  Similar options for FreeBSD are presented on the <a href="http://synflood-defender.net/blog/synflood-defender_freebsd_kernel_parameters">blog</a> . <br><br>  We see that the values ‚Äã‚Äãof retransmission attempts and the intervals between them are very large.  The idea is to reduce them, not new.  But is it worth it to do statically at boot time?  Today, the number of mobile Internet subscribers is rapidly increasing, but in the CIS countries, most of them have access via EDGE (and even GPRS).  Therefore, for such site visitors, you should not set hard values ‚Äã‚Äãin the core - they can only be denied service because of this, even in the absence of an attack.  The ideal option is when the values ‚Äã‚Äãare close to default when there is no attack (they contribute to the successful establishment of the connection), and when they are reduced (except for the queue length) under attack conditions. <br><br>  Once I was visited by the mentioned idea with the dynamic change of parameters.  There are doubts whether this is really useful and whether statically it is not possible to expose the values ‚Äã‚Äãat the stage of system loading.  I described this problem in a <a href="http://synflood-defender.net/blog/plans_for_synflood-defender_testing._how_to_test">blog</a> .  I will be glad to hear the views of readers on this issue. <br><br><h4>  Separately about the queue of SYN requests </h4><br>  The value of queue 128 by default is very small for a loaded system, especially if it is attackable, so naturally it should be increased.  But there is a limit that limits this increase. <br>  First, each entry into the queue takes 600 bytes of RAM. <br>  Secondly, a separate queue with a net.core.somaxconn length is assigned to each service that listens to the TCP port. <br>  Based on these considerations, the value of net.core.somaxconn can be calculated by the formula: <br>  somaxconn = (MEMfree - MEMres) / 600 * N, where <br>  MEMfree - current free RAM <br>  MEMres - memory that we reserve for system operation and other programs. <br>  600 bytes - takes every entry in the queue <br>  N is the number of services listening to TCP ports <br><br><h4>  Implementation as an extension for SNMP </h4><br>  This idea is implemented in the form of a script.  A configuration file is also attached to it, in which you can customize the work for your system until you add / remove changing kernel parameters at your discretion.  I use this script as an extension for SNMP.  There are versions for Linux and FreeBSD. <br><br>  Question: Why pull the script via SNMP if you can by crown? <br>  Answer: this allows you not only to change the kernel parameters on the fly, but also to integrate with any monitoring system that works via SNMP ‚Äî to configure alerts and so on.  Personally, I use the front-end for RRD Cacti and get the SYN queue loading graphs.  Templates for Cacti are available for download on the site.  This question is not critical, the functions of protection and SNMP extensions can be posted to different scripts. <br><br><h4>  Security testing </h4><br>  The system was tested on the desktop and laptop, connected to the same 100Mb L2 switch.  Tested with hping. <br><br>  Results on a real-time Cacti chart: <br><br><img src="https://habrastorage.org/storage1/a188e7e3/f77abe4f/0a92b224/b736baa6.png" alt="Cacti Graph"><br><br>  In dynamic protection mode, characteristic peaks are observed.  They arise due to the fact that the attack is monitored by a threshold value - threshold.  In the future I plan to monitor the frequency of filling and reduce these peaks. <br>  When peaks are seen on the graph, you can manually set the forced protection, when the kernel parameters are set to hard values ‚Äã‚Äãand do not change depending on the queue length.  On the graph we see that the queue value is close to almost 0. <br><br><h4>  Remarks </h4><br>  1. On loaded servers, the value of the queue 0 is almost non-existent.  It ranges from 0 to ~ 40 in the normal mode, so the threshold must be selected. <br>  2. The queue of SYN-requests will certainly increase with the HTTP flood, so detecting an attack on the threshold value of the queue is not entirely correct.  Although the interference is not even useful. <br><br><h4>  Site </h4><br>  For ease of reference and setting up a site <a href="http://synflood-defender.net/">synflood-defender.net</a> .  It presents existing and planned features, a download link, step-by-step instructions for setting up, and a blog in which useful DDoS entries will periodically appear. <br>  Recently, the script helped to protect the server of one friend from Brazil.  In a token of gratitude, he published a <a href="http://synflood-defender.net/blog/installation_and_configuration_how-to_pt-br">Portuguese translation of the</a> page <a href="http://synflood-defender.net/docs">How to use</a> .  So those harabrachiteli who are more comfortable to read in Portuguese, will not feel discomfort;) </div><p>Source: <a href="https://habr.com/ru/post/131469/">https://habr.com/ru/post/131469/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131460/index.html">The first event on 3D printing in the Netherlands</a></li>
<li><a href="../131463/index.html">Apple still received a patent for a screen unlock gesture</a></li>
<li><a href="../131464/index.html">YouTube is about to launch 100 premium channels.</a></li>
<li><a href="../131466/index.html">OpenStreetMap to help cyclists</a></li>
<li><a href="../131467/index.html">Google+ merged with Google Apps</a></li>
<li><a href="../131471/index.html">Ajenti 0.6</a></li>
<li><a href="../131472/index.html">Simple Qt / C ++ Server</a></li>
<li><a href="../131474/index.html">Recovery of documents after shredder (prize $ 50,000)</a></li>
<li><a href="../131475/index.html">Chanterelle-Firefox Costume [Pics]</a></li>
<li><a href="../131476/index.html">Browser PDF Rendering Plugin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>