<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>60 million fields and 27 crops. How we made a map of all fields in Europe and the USA</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago, we launched the world's first free interactive map with which you can view information about any field in the United States and Euro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>60 million fields and 27 crops. How we made a map of all fields in Europe and the USA</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/dq/bf/0b/dqbf0bvkm5hrtuknni-rm60ot9g.jpeg"><br><br>  A few months ago, we launched the world's first <a href="http://map.onesoil.ai/">free interactive map</a> with which you can view information about any field in the United States and Europe.  Dozens of publications have written about the map, and on Product Hunt, she collected 1,500 likes, unprecedented for the product from the agricultural sector (and eventually became AI &amp; Machine Learning Product of the Year 2018).  We designed the card for two months - that's how it was. <br><a name="habracut"></a><br>  The interactive map is based on machine learning algorithms and satellite imagery.  It contains information on 60 million fields and 27 cultures in 44 countries in Europe and the USA.  Data - for three years.  We recognized all the fields using ML from satellite images.  Using the map, one can track trends at the level of countries and regions, as well as monitor the development of a specific field.  For example, you can find out how much land was occupied by corn in the USA in 2016 (49.1 million hectares) or in which region of Belgium there are the most wheat fields (Wallonia). <br><br><img src="https://habrastorage.org/webt/ot/an/yq/otanyq1ez-dmw0m4xvkpckq5rn4.png"><br>  <i>Europe at minimum zoom</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the help of the map, you can also find out information by a separate field: its size, culture, development schedule, and a comprehensive Field Score.  It is calculated by the NDVI index, climatic indicators and relative field yield.  At any time you can see how the beets are developing on your field or what area under the legumes was taken by your neighbor last year.  Among other things, it is beautiful.  We made the button ‚Äúrandom beautiful fields‚Äù: it moves you to 35+ places around the world, each of which looks like a piece of abstract art. <br><br>  The idea of ‚Äã‚Äãcreating such a card appeared in July last year.  We lacked a tool that would allow us to visually demonstrate all our technological capabilities.  In August, the whole team began to develop closely. <br><br><h2>  Data: collect, process, compress </h2><br>  In developing the map, we used pictures of the European Union's Copernicus Sentinel-2 satellite.  In total, about 250 terabytes of information were processed for Europe and the USA.  At the first stage, we did preprocessing of images: we cleaned the clouds, shadows, snow, compressed the data.  Then, on the resulting 50 terabytes, we started the process of searching for field boundaries and classifying cultures on our machine learning models.  At the output, we received about 250 gigabytes of vector maps containing field and culture geometries. <br><br>  We used the PostgreSQL and PostGIS database to process data and calculate statistics.  After exporting the initial vector data, we obtained a base in which there were about 180 million records about the geometry of the fields, as well as more than a billion records of additional attribute information about the fields themselves for three years.  On this amount of data, we calculated statistics, ratings, determined the popularity of different cultures in regions of the world - everything that is displayed on the map in the left column and interactive prompts. <br><br><img src="https://habrastorage.org/webt/h3/hx/ea/h3hxeagfxn1qbfp_qh9pj5f3csm.jpeg"><br>  <i>Fields of croatia</i> <br><br>  We wanted to quickly calculate and display agronomic indicators across the field, as well as visualize the schedule of plant development for the season.  To do this, we used our own approach to caching and compression of satellite data.  This made it possible to reduce the size of the data warehouse by 100‚Äì200 times, and reduce the speed of obtaining information on the field to 1 second. <br><br>  We also added a comprehensive Field Score indicator to this version of the map, which allows you to quickly evaluate the field rating.  Field Score is the first step towards yield forecasting, which our team is currently working on.  The map was made in a short time, so I had to invent a lot of original solutions on the go.  But all the new developments we use in the work on our main product. <br><br><h2>  Map: select format and prepare data </h2><br>  In order to visualize the data, we used Mapbox.  There are two approaches to creating a map, we tried both.  The first involves the creation of a raster map.  In this case, we divide the map into squares, which we render into pictures and store on the server.  The browser loads several images and moves them when the user moves around the map.  This approach allows you to display all fields, no need to filter anything.  This is beautiful, the disadvantage is that the map is static, plus raster images weigh a lot. <br><br>  The second approach is to create a vector map.  The browser loads vector data and already on the client side animates it.  This is how modern Google and Yandex maps work.  Data weighs less than pictures, and allows you to change the design of any element.  This map allows you to make Mapbox service, in particular, their Mapbox GL library is an open source tool for displaying maps on the web.  Among other things, Mapbox provides paid map data storage service.  You can manually upload your data to their servers, and Mapbox will quickly distribute information, ensuring accurate map operation.  This is a significant part of the work, and due to the fact that Mapbox takes it upon itself, the task of the team has become much simpler. <br><br><img src="https://habrastorage.org/webt/u_/wo/fv/u_wofvjmemc-piwnprp5pwtmrra.png"><br>  <i>Emilia-Romagna, Italy</i> <br><br>  When working with vector data there is a conditional constraint: the more information you want to display on the map, the slower everything will work.  To solve this problem, we used a utility from Mapbox called Tippecanoe.  Based on the algorithms we chose, she determined in which zoom certain fields would be visible and which would not, and invisible vector objects would remove from the layer.  In total, Tippecanoe has more than 20 filtering algorithms, we tried everything and selected a couple of basic ones.  We compressed the data prepared in this way using Mapbox mbtiles technology to 50 gigabytes, and then uploaded to the company's servers. <br><br>  The use of the Next JS framework, which performs server-side rendering of the page, allowed us to further accelerate the work of the map.  Most applications in the modern world are rendered entirely on the client side: when opening a window in the browser, an empty hmtl page and a script that loads all the information is displayed.  The Next JS framework renders everything on the server, and this makes the download of the application fast for the client. <br><br><h2>  Map: set up a visual and come up with a "magic button" the night before release </h2><br>  Mapbox was a pleasant discovery for our designer.  The service simplified his task, because he was able to visualize the data without involving a front-end developer.  From the side it may seem that it is easy to paint the fields in the finished interface, but there are many nuances.  We have 27 cultures, and choosing colors for them was not easy.  For popular cultures, contrasting colors are needed, for less popular ones, less contrasting ones are needed, and all of them should be clearly visible in different zooms.  There are a lot of nestings and interactive hints in the map, because the most difficult was to think about the logic of transitions at different levels. <br><br>  The night before the release, we realized that it‚Äôs interesting to watch the map and the numbers, but I don‚Äôt want to share this on social networks.  Therefore, we decided to add a button ‚Äúrandom beautiful fields‚Äù, which throws users between different places of the planet.  With the whole office, we were looking for beautiful places, in an hour we drew a button and finished everything.  In the morning they tested it and launched it.  It seems that it was this function that gave us such a large coverage.  Otherwise, no one would have noticed that the fields are similar to abstract paintings.  Don't underestimate the power of last-minute decisions. <br><br><img src="https://habrastorage.org/webt/5d/xb/rn/5dxbrnwzr6i-iezjv2qxfz9ef3i.jpeg"><br>  <i>Fields of France</i> <br><br>  We added another function to the map after launch.  We knew that sometimes we recognized the fields and cultures on the map is not entirely accurate, and the feedback from the users allows us to improve our algorithms.  After the release, farmers began to send messages about inaccuracies in the recognition of crops: ‚ÄúI grow sunflower on the field, and you have specified corn.‚Äù  To resolve this issue, we added a button to the field card that sends us error notifications.  We use the information we collect to improve the accuracy of our crop recognition models. <br><br><h2>  Eventually </h2><br>  During its development, the concept of the map has become many times more complicated.  If at first we planned to make simple visualization of fields and cultures around the world, then the final product turned out to be much more complex.  But the card was worth the effort.  After the release, hundreds of investors, funds and scientific researchers wrote to us.  We will use some technological solutions, for example, the Next JS framework and the Tippecanoe utility, to work on our free web platform for precision farming <a href="https://onesoil.ai/">OneSoil</a> . <br><br>  We were the first to map all the fields of the USA and Europe in three years.  The data we received is unique.  Already we know about the field more than any company or state.  And the statistics we get using machine learning algorithms is often more accurate than the one that was compiled manually.  We have taken the first step towards automatically recognizing fields throughout the world ‚Äî this is our plan for the near future. </div><p>Source: <a href="https://habr.com/ru/post/450070/">https://habr.com/ru/post/450070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45006/index.html">Yandex banned Google?</a></li>
<li><a href="../450060/index.html">As I learned that my visa is not ready, the message in Slack</a></li>
<li><a href="../450062/index.html">Restoration of circulation in the brain a few hours after death</a></li>
<li><a href="../450064/index.html">Microsoft Build 2019 - live broadcast in Russian</a></li>
<li><a href="../450066/index.html">Test: How do you comply with the requirements for the processing of personal data?</a></li>
<li><a href="../450072/index.html">Choosing a TV for yourself, your beloved, from the perspective of science, not advertising</a></li>
<li><a href="../450076/index.html">We specify the description of system functions using the Sequence diagram.</a></li>
<li><a href="../450078/index.html">Hertz customer filed a lawsuit against Accenture integrator, demanding $ 32 + million for a "defective" site upgrade</a></li>
<li><a href="../45008/index.html">I'm not a spammer and not a flooder! I have a question! Is it possible to promote your interests on habrahabr.ru?</a></li>
<li><a href="../450080/index.html">Indigenous microbes and digestive features</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>