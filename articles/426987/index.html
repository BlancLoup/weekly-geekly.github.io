<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn OpenGL. Lesson 6.3 - Image Based Lighting. Diffuse irradiation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Image-based lighting or IBL ( Image Based Lighting ) is a category of lighting methods that are not based on analytical light sources (discussed in th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn OpenGL. Lesson 6.3 - Image Based Lighting. Diffuse irradiation</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="Ogl3" align="left" width="300">  Image-based lighting or <i>IBL</i> ( <i>Image Based Lighting</i> ) is a category of lighting methods that are not based on analytical light sources (discussed in the <a href="https://habr.com/post/424453">previous lesson</a> ), but consider the entire environment of the illuminated objects as one continuous light source.  In general, the technical basis of such methods lies in processing a cubic environment map (prepared in the real world or based on a three-dimensional scene) so that the data stored in the map can be directly used in lighting calculations: virtually every texel of a cubic map is considered as a source of light. .  In general, this allows you to capture the effect of global illumination in the scene, which is an important component that conveys the overall ‚Äútone‚Äù of the current scene and helps the illuminated objects to be better ‚Äúembedded‚Äù in it. <br><br>  Since IBL algorithms take into account the lighting from some kind of ‚Äúglobal‚Äù environment, their result is considered to be a more accurate imitation of background lighting or even a very rough approximation of global lighting.  This aspect makes IBL methods interesting in terms of inclusion in the PBR model, since the use of ambient lighting in the lighting model allows objects to look much more physically correct. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Part 1. Start <br><br><ol><li>  <a href="https://habrahabr.ru/post/310790/">Opengl</a> </li><li>  <a href="https://habrahabr.ru/post/311198/">Creating a window</a> </li><li>  <a href="https://habrahabr.ru/post/311234/">Hello window</a> </li><li>  <a href="https://habrahabr.ru/post/311808/">Hello triangle</a> </li><li>  <a href="https://habrahabr.ru/post/313380/">Shaders</a> </li><li>  <a href="https://habrahabr.ru/post/315294/">Textures</a> </li><li>  <a href="https://habrahabr.ru/post/319144/">Transformations</a> </li><li>  <a href="https://habrahabr.ru/post/324968/">Coordinate systems</a> </li><li>  <a href="https://habrahabr.ru/post/327604/">Camera</a> </li></ol><br>  Part 2. Basic lighting 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/329592/">Colors</a> </li><li>  <a href="https://habrahabr.ru/post/333932/">Lighting Basics</a> </li><li>  <a href="https://habrahabr.ru/post/336166/">Materials</a> </li><li>  <a href="https://habrahabr.ru/post/337550/">Texture Cards</a> </li><li>  <a href="https://habrahabr.ru/post/337642/">Sources of light</a> </li><li>  <a href="https://habrahabr.ru/post/338254/">Multiple light sources</a> </li></ol><br>  Part 3. Loading 3D Models <br><br><ol><li>  <a href="https://habrahabr.ru/post/338436/">Assimp library</a> </li><li>  <a href="https://habrahabr.ru/post/338436/">Mesh mesh class</a> </li><li>  <a href="https://habrahabr.ru/post/338998/">3D model class</a> </li></ol><br>  Part 4. OpenGL advanced features <br><br><ol><li>  <a href="https://habrahabr.ru/post/342610/">Depth test</a> </li><li>  <a href="https://habrahabr.ru/post/344238/">Stencil test</a> </li><li>  <a href="https://habrahabr.ru/post/343096/">Mixing colors</a> </li><li>  <a href="https://habrahabr.ru/post/346964/">Face clipping</a> </li><li>  <a href="https://habrahabr.ru/post/347354/">Frame buffer</a> </li><li>  <a href="https://habrahabr.ru/post/347750/">Cubic cards</a> </li><li>  <a href="https://habrahabr.ru/post/350008/">Advanced data handling</a> </li><li>  <a href="https://habrahabr.ru/post/350156/">Advanced GLSL</a> </li><li>  <a href="https://habrahabr.ru/post/350782/">Geometric shader</a> </li><li>  <a href="https://habrahabr.ru/post/352962/">Instancing</a> </li><li>  <a href="https://habrahabr.ru/post/351706/">Smoothing</a> </li></ol><br>  Part 5. Advanced Lighting <br><br><ol><li>  <a href="https://habrahabr.ru/post/353054/">Advanced lighting.</a>  <a href="https://habrahabr.ru/post/353054/">Model Blinna-Phong.</a> </li><li>  <a href="https://habrahabr.ru/post/353632/">Gamma Correction</a> </li><li>  <a href="https://habrahabr.ru/post/353956/">Shadow maps</a> </li><li>  <a href="https://habr.com/post/354208/">Omnidirectional shadow maps</a> </li><li>  <a href="https://habr.com/post/415579/">Normal mapping</a> </li><li>  <a href="https://habr.com/post/416163/">Parallax mapping</a> </li><li>  <a href="https://habr.com/post/420409/">Hdr</a> </li><li>  <a href="https://habr.com/post/420375/">Bloom</a> </li><li>  <a href="https://habr.com/post/420565/">Deferred rendering</a> </li><li>  <a href="https://habr.com/post/421385/">SSAO</a> </li></ol><br>  Part 6. PBR <br><br><ol><li>  <a href="https://habr.com/post/426123/">Theory</a> </li><li>  <a href="https://habr.com/post/424453/">Analytical light sources</a> </li><li>  <b>IBL.</b>  <b>Diffuse irradiation.</b> </li></ol><br></div></div><br>  To incorporate the influence of IBL into the already described PBR system, let‚Äôs return to the familiar reflectivity equation: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>c</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mo stretchy=&quot;false&quot;>)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="133.846ex" height="2.78ex" viewBox="0 -832 57628 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="16413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="16963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="17415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="17944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="18378" y="0"></use><g transform="translate(18811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2B" x="20132" y="0"></use><g transform="translate(21133,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="22337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="22887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="23339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="23868" y="0"></use><g transform="translate(24302,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(26666,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="13946" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="41002" y="0"></use><g transform="translate(41392,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="42417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="42807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="43310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="44006" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="44491" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="45370" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="45836" y="0"></use><g transform="translate(46317,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="47190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="47580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="48430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="48864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="49387" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="49873" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="50484" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="50970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="51848" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="52315" y="0"></use><g transform="translate(52795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="53669" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="54443" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="54928" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="55807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="56273" y="0"></use><g transform="translate(56754,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_d \ frac {c} {\ pi} + k_s \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n )}) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br>  As previously described, the main goal is to calculate the integral for all incoming radiation directions. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> w_i </script>  over the hemisphere <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ Omega </script>  .  In the <a href="https://habr.com/post/424453">last lesson, the</a> calculation of the integral was not burdensome, because we knew in advance the number of light sources, and, therefore, all those several directions of incidence of light that correspond to them.  At the same time, the integral from the swoop does not solve: <u>any</u> falling vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4"> w_i </script>  from the environment can carry with them a non-zero energy brightness.  As a result, for the practical applicability of the method, the following requirements must be met: <br><ul><li>  You need to think of a way to get the energy brightness of the scene for an arbitrary direction vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-5"> w_i </script>  ; </li><li>  It is necessary that the solution of the integral can occur in real time. </li></ul><br>  Well, the first point is resolved by itself.  Here, a hint of a solution has already passed: one of the methods for representing the irradiance of a scene or environment is a cubic map that has undergone special processing.  Each texel in such a map can be considered as a separate radiating source.  By sampling from such a map on an arbitrary vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6"> w_i </script>  we easily get the energy brightness of the scene in that direction. <br><br>  So, we get the energy brightness of the scene for an arbitrary vector. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-7"> w_i </script>  : <br><br><pre><code class="hljs vbscript">vec3 radiance = texture(_cubemapEnvironment, w_i).<span class="hljs-built_in"><span class="hljs-built_in">rgb</span></span>;</code> </pre> <br>  Remarkably, however, the solution of the integral requires us to take samples from the environment map not from one direction, but from all possible ones in the hemisphere.  And so - for each shaded fragment.  Obviously, for real-time tasks this is practically impracticable.  A more effective method would be to calculate part of integrands in advance, still outside our application.  But for this you have to roll up your sleeves and plunge deeper into the essence of the expression of reflectivity: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>c</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mo stretchy=&quot;false&quot;>)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="133.846ex" height="2.78ex" viewBox="0 -832 57628 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="16413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="16963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="17415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="17944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="18378" y="0"></use><g transform="translate(18811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2B" x="20132" y="0"></use><g transform="translate(21133,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="22337" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="22887" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="23339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="23868" y="0"></use><g transform="translate(24302,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(26666,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="13946" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="41002" y="0"></use><g transform="translate(41392,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="42417" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="42807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="43310" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="44006" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="44491" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="45370" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="45836" y="0"></use><g transform="translate(46317,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="47190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="47580" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="48430" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="48864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="49387" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="49873" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="50484" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="50970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="51848" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="52315" y="0"></use><g transform="translate(52795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="53669" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="54443" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="54928" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="55807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="56273" y="0"></use><g transform="translate(56754,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_d \ frac {c} {\ pi} + k_s \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n )}) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br><br>  It is seen that the parts of the expression associated with the scattered <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mi>d</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.303ex" height="2.419ex" viewBox="0 -780.1 991.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-9"> k_d </script>  and mirror <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mi>s</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.215ex" height="2.419ex" viewBox="0 -780.1 953.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="737" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-10"> k_s </script>  BRDF components are independent.  You can divide the integral into two parts: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>c</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></mrow><mo stretchy=&quot;false&quot;>)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mo stretchy=&quot;false&quot;>)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="189.766ex" height="2.78ex" viewBox="0 -832 81704.5 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="16413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="16963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="17415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="17944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="18378" y="0"></use><g transform="translate(18811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="19910" y="0"></use><g transform="translate(20300,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="21325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="21715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="22218" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="22914" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="23399" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="24278" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="24744" y="0"></use><g transform="translate(25225,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="26098" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="26488" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="27338" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="27772" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="28295" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="28781" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="29392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="29878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="30756" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="31223" y="0"></use><g transform="translate(31703,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="32577" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="33351" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="33836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="34715" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="35181" y="0"></use><g transform="translate(35662,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2B" x="36758" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="38008" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="38354" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="38954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6C" x="39566" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="39864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="40210" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="41088" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="41434" y="0"></use><g transform="translate(41795,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="44820" y="0"></use><g transform="translate(45210,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="46413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="46964" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="47415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="47945" y="0"></use><g transform="translate(48378,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(50743,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="13946" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="65079" y="0"></use><g transform="translate(65468,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="66494" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="66883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="67387" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="68082" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="68568" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="69446" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="69913" y="0"></use><g transform="translate(70393,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="71267" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="71656" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="72507" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="72940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="73464" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="73949" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="74561" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="75046" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="75925" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="76391" y="0"></use><g transform="translate(76872,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="77746" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="78519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="79005" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="79883" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="80350" y="0"></use><g transform="translate(80830,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></mrow><mo stretchy="false">)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo>+</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>k</mi><mi>s</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_d \ frac {c} {\ pi}) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i + \ int \ limits_ { \ Omega} (k_s \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n)}) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br><br>  Such a division into parts will allow us to deal with each of them separately, and in this lesson we will deal with the part responsible for the ambient lighting. <br><br>  After analyzing the form of the integral over the diffuse component, we can conclude that the diffuse component of Lambert is essentially a constant (color <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.645ex" height="2.057ex" viewBox="0 -780.1 2000 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="1062" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-68" x="1423" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mi>i</mi><mi>t</mi><mi>h</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> with </script>  refractive index <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>k</mi><mi>d</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.303ex" height="2.419ex" viewBox="0 -780.1 991.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-13"> k_d </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.553ex" height="2.298ex" viewBox="0 -728.2 1099 989.6" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="753" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-14"> \ pi </script>  are constant in the conditions of the integrand) and does not depend on other variables.  Taking this fact into account, we can take the constants for the integral sign: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>c</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></mrow><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="83.049ex" height="2.78ex" viewBox="0 -832 35757 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="6664" y="0"></use><g transform="translate(7720,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-66" x="8961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-72" x="9512" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="9963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="10493" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="10926" y="0"></use><g transform="translate(11360,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="12709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="13054" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="13655" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6C" x="14266" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="14565" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="14910" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="15789" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="16134" y="0"></use><g transform="translate(16496,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2942" y="0"></use></g></g><g transform="translate(19521,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="20546" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="20936" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="21439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="22135" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="22620" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="23499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="23965" y="0"></use><g transform="translate(24446,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="25319" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="25709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="26559" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="26993" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="27516" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-74" x="28002" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="28613" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="29099" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="29977" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="30444" y="0"></use><g transform="translate(30924,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="31798" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="32572" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="33057" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="33936" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="34402" y="0"></use><g transform="translate(34883,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></mrow><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-15"> L_o (p, \ omega_o) = k_d \ frac {c} {\ pi} \ int \ limits _ {\ Omega} L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br><br>  So we get an integral depending only on <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-16"> w_i </script>  (it is assumed that <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-17"> p </script>  corresponds to the center of the cubic environment map).  Based on this formula, you can calculate or, even better, pre-calculate a new cubic map that stores the result of calculating the integral of the diffuse component for each direction of the sample (or texel map) <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-18"> w_o </script>  using convolution operation. <br><br>  Convolution is the operation of applying some calculation to each element in the data set, taking into account the data of all the other elements of the set.  In this case, such data is the energy brightness of the scene or the environment map.  Thus, to calculate a single value in each direction of the sample in a cubic map, we will have to take into account the values ‚Äã‚Äãtaken from all other possible directions of the sample on a hemisphere lying around the sample point. <br><br>  To convolve the environment map, one needs to solve the integral for each resulting direction of sampling. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-19"> w_o </script>  by implementing multiple discrete samples along directions <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-20"> w_i </script>  owned hemisphere <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-21"> \ Omega </script>  and averaging the total energy brightness.  The hemisphere on the basis of which the sampling directions are taken <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-22"> w_i </script>  oriented along vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-23"> w_o </script>  representing the target direction for which the convolution is currently being calculated.  Look at the picture for a better understanding: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pr/yl/ql/prylqltlmqjlvfhpaswbes8bmg8.png"></div><br><br>  Such a pre-calculated cubic map that stores the result of integration for each direction of the sample <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-24"> w_o </script>  , can also be considered as storing the result of summing up all indirect diffuse illumination in a scene falling on some surface oriented along the direction <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-25"> w_o </script>  .  In other words, such cubic maps are called irradiance maps (irradiance maps), since a cubic environment map subjected to preliminary convolution allows one to directly sample the magnitude of the scene irradiance coming from an arbitrary direction. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-26"> w_o </script>  , without additional calculations. <br><blockquote>  The expression that determines the energy brightness also depends on the position of the sampling point. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-27"> p </script>  which we took lying in the center of the irradiance map.  This assumption imposes a limitation in the sense that the source of all indirect diffuse illumination will also be the only environmental map.  In scenes of different lighting, this can destroy the illusion of reality (especially in indoor scenes).  Modern rendering engines solve this issue by placing special auxiliary objects in the scene - <i>reflection probes</i> .  Each such object deals with one task: it forms its own irradiance map for its immediate environment.  With such a technique, irradiance (and energy brightness) at an arbitrary point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-28"> p </script>  will be determined by a simple interpolation between the nearest reflection samples.  But for the current tasks, we agree that the selection of the environment map is conducted from its very center, and we shall analyze the reflection samples in further lessons. </blockquote>  Below is an example of a cubic environment map and an irradiance map obtained on its basis (authored by the <a href="http://www.indiedb.com/features/using-image-based-lighting-ibl">wave engine</a> ), averaging the energy brightness of the environment for each output direction. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-29"> w_o </script>  . <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8c/qz/yg/8cqzygcmwfdkdcadui_iqrtj4rw.png"></div><br>  So, this map stores the result of convolution in each texel (corresponding to the direction <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-30"> w_o </script>  ), and externally, such a map looks like it stores the averaged color of the environment map.  A sample in any direction from such a map will return the value of irradiance coming from this direction. <br><br><h2>  PBR and HDR </h2><br>  In the <a href="https://habr.com/post/424453">previous lesson</a> , it was already briefly noted that for the correct operation of the PBR lighting model, taking into account the HDR range of the brightness of the present light sources is extremely important.  Since the PBR model at the input accepts parameters in one way or another based on quite specific physical quantities and characteristics, it is logical to require compliance of the energy brightness of the light sources with their real prototypes.  It does not matter how we justify a specific amount of radiation flux for each source: if we make a rough engineering estimate or turn to <a href="https://en.wikipedia.org/wiki/Lumen_(unit)">physical quantities</a> , the difference in characteristics between the room lamp and the sun will be huge in any case.  Without using the <a href="https://habr.com/post/420409">HDR</a> range, it will simply be impossible to accurately determine the relative brightness of various light sources. <br><br>  So PBR and HDR are friends forever, this is understandable, just how does this fact relate to image-based lighting methods?  In the last lesson, it was shown that transferring PBR to the HDR rendering range is simple.  One thing remains ‚Äúbut‚Äù: since the indirect illumination from the environment is based on a cubic environment map, a way is needed to preserve the HDR characteristics of this background lighting in the environment map. <br><br>  Up to this point, we used environment maps created in the LDR format (such as <a href="https://habrahabr.ru/post/347750">skyboxes</a> ).  We used a selection of colors from them in the rendering as is, and this is quite acceptable for direct object shading.  And it is completely unsuitable when using environment maps as sources of physically reliable measurements. <br><br><h4>  RGBE - image format in the HDR range </h4><br>  Get to know the RGBE image file format.  Files with the extension " <i>.hdr</i> " are used to store images with a wide dynamic range, allocating one byte for each element of the color triad and another byte for the total exponent.  Including the format, it allows storing environment cubic maps with a range of color intensity beyond the LDR range [0., 1.].  This means that light sources can retain their real intensity, being represented by such an environment map. <br><br>  The network has enough free environment maps in the RGBE format, taken in various real world conditions.  For example, an example from the <a href="http://www.hdrlabs.com/sibl/archive.html">sIBL archive</a> site: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fa/ua/aq/fauaaqkw63r9dnghjofu83o-h2i.png"></div><br>  You may be surprised at what you see: after all, this distorted image is not at all like an ordinary cubic map with its pronounced breakdown into 6 faces.  The explanation is simple: this environment map was projected from a sphere onto a plane - an <i>equal-right scan was</i> applied.  This is done to allow storage in a format that does not support the storage mode of cubic cards as is.  Of course, this projection method carries with it drawbacks: the horizontal resolution is much higher than the vertical.  In most cases, the use in rendering is a valid ratio, since usually interesting details of the environment and lighting are located exactly in the horizontal plane, and not in the vertical.  Well, plus to everything, we need the conversion code back to the cubic map. <br><br><h4>  RGBE format support in stb_image.h </h4><br>  Downloading this image format on your own requires knowledge of <a href="http://radsite.lbl.gov/radiance/refer/Notes/picture_format.html">the format specification</a> , which is not difficult, but it is still time consuming.  Fortunately, the image loading library <a href="">stb_image.h</a> , implemented in a single header file, supports loading of RGBE files, returning an array of floating point numbers - this is what we need for our purposes!  Having added a library to your project, loading of these images is implemented extremely simply: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"stb_image.h"</span></span></span><span class="hljs-meta"> [...] stbi_set_flip_vertically_on_load(true); int width, height, nrComponents; float *data = stbi_loadf(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"newport_loft.hdr"</span></span></span><span class="hljs-meta">, &amp;width, &amp;height, &amp;nrComponents, 0); unsigned int hdrTexture; </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (data) { glGenTextures(1, &amp;hdrTexture); glBindTexture(GL_TEXTURE_2D, hdrTexture); glTexImage2D(GL_TEXTURE_2D, 0, GL_RGB16F, width, height, 0, GL_RGB, GL_FLOAT, data); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR); stbi_image_free(data); } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { std::cout &lt;&lt; </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"Failed to load HDR image."</span></span></span><span class="hljs-meta"> &lt;&lt; std::endl; }</span></span></code> </pre> <br>  The library automatically converts values ‚Äã‚Äãfrom the internal HDR format to ordinary real 32-bit numbers, by default with three color channels.  It is quite enough to save the original HDR image data in a regular 2D floating point texture. <br><br><h4>  Conversion of an equal-right scan of an image into a cubic map </h4><br>  An even-right scan can be used for direct sampling from the environment map, but this would require costly mathematical operations, while a sample from a normal cube map would be practically free of performance.  It is for these reasons in this lesson that we will be engaged in converting an equal-rectangular image into a cubic map, which will be used further.  However, the method of direct sampling from an equal-right map using a three-dimensional vector will also be shown here so that you can choose the method of work that is right for you. <br><br>  To convert, you need to draw a cube of a single size, watching it from the inside, project an equal-rectangular map on its face, and then extract six images from the faces as faces of a cube map.  The vertex shader of this stage is quite simple: it simply processes the vertices of the cube as it is, and also transfers their non-transformed positions to a fragment shader for use as a three-dimensional vector of the sample: <br><br><pre> <code class="hljs mel">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core <span class="hljs-keyword"><span class="hljs-keyword">layout</span></span> (location = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 aPos; out vec3 localPos; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> mat4 projection; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> mat4 view; void main() { localPos = aPos; gl_Position = projection * view * vec4(localPos, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); }</code> </pre> <br>  In the fragment shader, we shade each face of the cube as if we tried to carefully wrap the cube with a sheet with an equal-right card.  To do this, the sampling direction transferred to the fragment shader is taken, processed by special trigonometric magic, and, ultimately, a sample is taken from the equal-right map as if it were actually a cube map.  The result of the selection is directly saved as a fragment color of the face of the cube: <br><br><pre> <code class="hljs kotlin">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> vec4 FragColor; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 localPos; uniform sampler2D equirectangularMap; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> vec2 invAtan = vec2(<span class="hljs-number"><span class="hljs-number">0.1591</span></span>, <span class="hljs-number"><span class="hljs-number">0.3183</span></span>); vec2 SampleSphericalMap(vec3 v) { vec2 uv = vec2(atan(vz, vx), asin(vy)); uv *= invAtan; uv += <span class="hljs-number"><span class="hljs-number">0.5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uv; } void main() { <span class="hljs-comment"><span class="hljs-comment">// localPos   vec2 uv = SampleSphericalMap(normalize(localPos)); vec3 color = texture(equirectangularMap, uv).rgb; FragColor = vec4(color, 1.0); }</span></span></code> </pre> <br>  If you actually draw a cube with this shader and an associated HDR environment map, you get something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/wi/xl/u2/wixlu2m9jwpr9d6oakhw7_nqcqa.png"></div><br>  Those.  it can be seen that in fact we projected a rectangular texture onto a cube.  That's great, but how will this help us in forming a real cube map?  To finish this task, it is necessary to render the same cube 6 times with a camera looking at each of the faces, while recording the output into a separate <a href="https://habrahabr.ru/post/347354">frame buffer</a> object: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> captureFBO, captureRBO; glGenFramebuffers(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;captureFBO); glGenRenderbuffers(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;captureRBO); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, <span class="hljs-number"><span class="hljs-number">512</span></span>, <span class="hljs-number"><span class="hljs-number">512</span></span>); glFramebufferRenderbuffer(GL_FRAMEBUFFER, GL_DEPTH_ATTACHMENT, GL_RENDERBUFFER, captureRBO);</code> </pre> <br>  Of course, let's not forget to organize the memory for storing each of the six faces of the future cube map: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> envCubemap; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;envCubemap); glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i) { <span class="hljs-comment"><span class="hljs-comment">//  ,     // 16     glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, 0, GL_RGB16F, 512, 512, 0, GL_RGB, GL_FLOAT, nullptr); } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span></span></code> </pre><br>  After this preparation, it will only be necessary to directly transfer parts of the equal-right map to the verge of the cube map. <br><br>  We will not go into much detail, especially since the code repeats much seen in the lessons on the <a href="https://habrahabr.ru/post/347354">frame buffer</a> and <a href="https://habr.com/post/354208">omnidirectional shadows</a> .  In principle, it all comes down to preparing six separate species matrices that orient the camera strictly to each of the faces of the cube, as well as a special projection matrix with a 90 ¬∞ angle of view to capture the entire face of the cube.  Then, the render is simply performed six times, and the result is saved to the floating-point framebuffer: <br><br><pre> <code class="cpp hljs">glm::mat4 captureProjection = glm::perspective(glm::radians(<span class="hljs-number"><span class="hljs-number">90.0f</span></span>), <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.1f</span></span>, <span class="hljs-number"><span class="hljs-number">10.0f</span></span>); glm::mat4 captureViews[] = { glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">1.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)), glm::lookAt(glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>), glm::vec3( <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>), glm::vec3(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>, <span class="hljs-number"><span class="hljs-number">-1.0f</span></span>, <span class="hljs-number"><span class="hljs-number">0.0f</span></span>)) }; <span class="hljs-comment"><span class="hljs-comment">//  HDR        equirectangularToCubemapShader.use(); equirectangularToCubemapShader.setInt("equirectangularMap", 0); equirectangularToCubemapShader.setMat4("projection", captureProjection); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_2D, hdrTexture); //         glViewport(0, 0, 512, 512); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); for (unsigned int i = 0; i &lt; 6; ++i) { equirectangularToCubemapShader.setMat4("view", captureViews[i]); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, envCubemap, 0); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); renderCube(); //    } glBindFramebuffer(GL_FRAMEBUFFER, 0);</span></span></code> </pre><br>  It uses the attachment of the framebuffer color, and alternately changing the connected face of the cube map, which leads to the direct rendering of the render to one of the faces of the environment map.  This code needs to be executed only once, after which we will have on hand a full-fledged <i>envCubemap</i> environment map containing the result of the conversion of the original equal-rectangular version of the HDR environment map. <br><br>  Let's test the resulting cubic map by sketching a simple skybox shader: <br><br><pre> <code class="hljs mel">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core <span class="hljs-keyword"><span class="hljs-keyword">layout</span></span> (location = <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 aPos; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> mat4 projection; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> mat4 view; out vec3 localPos; void main() { localPos = aPos; <span class="hljs-comment"><span class="hljs-comment">//         mat4 rotView = mat4(mat3(view)); vec4 clipPos = projection * rotView * vec4(localPos, 1.0); gl_Position = clipPos.xyww; }</span></span></code> </pre><br>  Pay attention to the trick with the components of the vector <i>clipPos</i> : we use the tetrad <i>xyww</i> when writing the transformed vertex coordinates to ensure that all skybox fragments have a maximum depth of 1.0 (the approach has already been used in the <a href="https://habrahabr.ru/post/347750">relevant lesson</a> ).  Do not forget to change the comparison function to <i>GL_LEQUAL</i> : <br><br><pre> <code class="cpp hljs">glDepthFunc(GL_LEQUAL);</code> </pre> <br>  The fragment shader simply selects from the cube map: <br><br><pre> <code class="hljs mel">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core out vec4 FragColor; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 localPos; <span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> samplerCube environmentMap; void main() { vec3 envColor = texture(environmentMap, localPos).rgb; envColor = envColor / (envColor + vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>)); envColor = <span class="hljs-keyword"><span class="hljs-keyword">pow</span></span>(envColor, vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">2.2</span></span>)); FragColor = vec4(envColor, <span class="hljs-number"><span class="hljs-number">1.0</span></span>); }</code> </pre> <br>  The sample from the map is based on the interpolated local coordinates of the cube vertices, which is the correct direction of the sample in this case (again, discussed in the skybox lesson, <i>approx. Lane</i> ).  Since the transfer components in the view matrix were ignored, the skybox render will not depend on the observer's position, creating the illusion of an infinitely distant background.  Since here we directly output data from the HDR card to the default framebuffer, which is an LDR receiver, it is necessary to recall the tone mapping.  And lastly: almost all HDR cards are stored in a linear space, which means that you need to apply <a href="https://habrahabr.ru/post/353632">gamma correction</a> as the final processing chord. <br><br>  So, when you output the received skybox, along with the already familiar array of spheres, you get something like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/s8/-3/vx/s8-3vxu5dhzhrwm1adtb5uwffga.png"></div><br>  Well, a lot of effort has been spent, but in the end we successfully mastered reading the HDR environment map, converting it from a right-angled to a cubic map, and outputting the HDR cubic map as a skybox to the scene.  Moreover, the conversion code into a cubic map by means of a six-sided rendering of a cubic map is useful to us and further - in the task of <i>convolving the environment map</i> .  The code for the entire conversion process is <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/2.1.1.ibl_irradiance_conversion/ibl_irradiance_conversion.cpp">here</a> . <br><br><h2>  Cubic card convolution </h2><br>  As stated at the beginning of the lesson, our main goal is to solve the integral for all possible directions of indirect diffuse illumination, taking into account the given irradiance of the scene in the form of a cubic map of the environment.  It is known that we can get the value of the energy brightness of the scene <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.059ex" height="2.66ex" viewBox="0 -832 3470 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1071" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="1574" y="0"></use><g transform="translate(2019,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="3080" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>w</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-31"> L (p, w_i) </script>  for any direction <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-32"> w_i </script>  by sampling from HDR a cubic environment map in this direction.  To solve the integral, it will be necessary to sample the energy brightness of the scene from all possible directions in the hemisphere. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-33"> \ Omega </script>  each considered fragment. <br>  Obviously, the task of sampling the lighting from the environment from all possible directions in the hemisphere <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-34"> \ Omega </script>  is computationally impracticable - there are an infinite number of such directions.  However, it is possible to apply approximation by taking a finite number of directions chosen randomly or evenly spaced inside the hemisphere.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This will make it possible to obtain a fairly good approximation to the true irradiance, in effect solving the integral of interest to us in the form of a finite sum. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But for real-time tasks, even this approach is still incredibly superimposed, because the samples are made for each fragment, and the number of samples must be high enough for an acceptable result. </font><font style="vertical-align: inherit;">So it would be nice to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prepare in advance the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> data for this step, outside the rendering process. </font><font style="vertical-align: inherit;">Since the orientation of the hemisphere determines from which region of space we imprint the irradiance, it is possible to calculate in advance the irradiance for each possible orientation of the hemisphere based on all possible outgoing directions</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>o</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.694ex" height="1.817ex" viewBox="0 -520.7 1159.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>o</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-35">w_o</script>  : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03C9;</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>&amp;#x03C0;</mi></mfrac><munder><mo>&amp;#x222B;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi mathvariant=&quot;normal&quot;>&amp;#x03A9;</mi></mrow></munder><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03C9;</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mo>&amp;#x22C5;</mo><msub><mi>&amp;#x03C9;</mi><mi>i</mi></msub><mi>d</mi><msub><mi>&amp;#x03C9;</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="37.06ex" height="7.359ex" viewBox="0 -1454.5 15956.2 3168.3" role="img" focusable="false" style="vertical-align: -3.981ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><g transform="translate(2462,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C9" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="880" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="3528" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="4196" y="0"></use><g transform="translate(5252,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><g transform="translate(6243,0)"><g transform="translate(120,0)"><rect stroke="none" width="693" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="130" y="676"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="60" y="-686"></use></g></g><g transform="translate(7344,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJSZ2-222B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3A9" x="-51" y="-2162"></use></g><g transform="translate(8455,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="9481" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="9870" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="10374" y="0"></use><g transform="translate(10819,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C9" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="880" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="11786" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="12175" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-22C5" x="12998" y="0"></use><g transform="translate(13499,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C9" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="880" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="14465" y="0"></use><g transform="translate(14989,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C9" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="880" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œâ</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>œÄ</mi></mfrac><munder><mo>‚à´</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">Œ©</mi></mrow></munder><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œâ</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mo>‚ãÖ</mo><msub><mi>œâ</mi><mi>i</mi></msub><mi>d</mi><msub><mi>œâ</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-36">L_o(p,\omega_o) = k_d\frac{c}{\pi} \int\limits_{\Omega} L_i(p,\omega_i) n \cdot \omega_i d\omega_i</script></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As a result, for a given arbitrary vector </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , we will be able to sample from a pre-calculated irradiance map in order to obtain a diffuse irradiance value in this direction. </font><font style="vertical-align: inherit;">To determine the amount of indirect diffuse radiation at the point of the current fragment, we take the total irradiance from a hemisphere oriented along the normal to the fragment surface. </font><font style="vertical-align: inherit;">In other words, getting the irradiance of a scene comes down to a simple sample:</font></font><span class="MathJax_SVG" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-37">w_i</script><font style="vertical-align: inherit;"></font><br><br><pre> <code class="hljs lisp"> vec3 irradiance = texture(<span class="hljs-name"><span class="hljs-name">irradianceMap</span></span>, N)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Further, to create an irradiance map, it is necessary to perform a convolution of the environment map converted to a cubic map. </font><font style="vertical-align: inherit;">We know that for each fragment its hemisphere is considered oriented along the normal to the surface.</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-38"> N </script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this case, the convolution of the cubic map is reduced to the calculation of the average sum of the energy brightness from all directions </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> inside hemisphere</font></font><span class="MathJax_SVG" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-39">w_i</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> oriented along the normal</font></font><span class="MathJax_SVG" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi mathvariant=&quot;normal&quot;>&amp;#x03A9;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.678ex" height="2.057ex" viewBox="0 -780.1 722.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3A9" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Œ©</mi></math></span></span><script type="math/tex" id="MathJax-Element-40">\Omega</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-41"> N </script>  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yc/ip/a2/ycipa25cnkcvhxdqcvrfbqqozvg.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fortunately, the time-consuming preliminary work that we did at the beginning of the lesson will now allow you to quite simply convert the environment map as a cubic card in a special fragment shader, the output of which will be used to form a new cubic map. </font><font style="vertical-align: inherit;">For this, the same piece of code that was used to translate the equal-right environment map into a cubic map comes in handy. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It only remains to take another processing shader:</font></font><br><br><pre> <code class="hljs kotlin">#version <span class="hljs-number"><span class="hljs-number">330</span></span> core <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> vec4 FragColor; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> vec3 localPos; uniform samplerCube environmentMap; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> float PI = <span class="hljs-number"><span class="hljs-number">3.14159265359</span></span>; void main() { <span class="hljs-comment"><span class="hljs-comment">//       vec3 normal = normalize(localPos); vec3 irradiance = vec3(0.0); [...] //   FragColor = vec4(irradiance, 1.0); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">environmentMap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sampler </font><font style="vertical-align: inherit;">is an HDR cubic environment map, previously derived from a rectangular one. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are many ways to perform a convolution of the environment map; in this case, for each texel of a cubic map, we will create several sample vectors from a hemisphere</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , oriented along the direction of the sample, and average results. </font><font style="vertical-align: inherit;">The number of sampling vectors will be fixed, and the vectors themselves will be evenly distributed inside the hemisphere. </font><font style="vertical-align: inherit;">I note that the integrand is a continuous function, and the discrete estimate of this function will be only an approximation. </font><font style="vertical-align: inherit;">And the more sample vectors we take, the closer we will be to the analytical solution of the integral. </font><font style="vertical-align: inherit;">Integral part of the expression for reflectivity depends on the solid angle</font></font><span class="MathJax_SVG" id="MathJax-Element-42-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi mathvariant=&quot;normal&quot;>&amp;#x03A9;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.678ex" height="2.057ex" viewBox="0 -780.1 722.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3A9" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Œ©</mi></math></span></span><script type="math/tex" id="MathJax-Element-42">\Omega</script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - values ‚Äã‚Äãwith which it is not very convenient to work. </font><font style="vertical-align: inherit;">Instead of integrating over the solid angle</font></font><span class="MathJax_SVG" id="MathJax-Element-43-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.88ex" height="2.057ex" viewBox="0 -780.1 1240 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="523" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-43">dw</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we change the expression, resulting in integration over spherical coordinates</font></font><span class="MathJax_SVG" id="MathJax-Element-44-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>d</mi><mi>w</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.88ex" height="2.057ex" viewBox="0 -780.1 1240 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-77" x="523" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>d</mi><mi>w</mi></math></span></span><script type="math/tex" id="MathJax-Element-44">dw</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-45-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B8;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.057ex" viewBox="0 -780.1 469.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Œ∏</mi></math></span></span><script type="math/tex" id="MathJax-Element-45">\theta</script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-46-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03D5;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.385ex" height="2.419ex" viewBox="0 -780.1 596.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>œï</mi></math></span></span><script type="math/tex" id="MathJax-Element-46">\phi</script>  : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vx/8c/_r/vx8c_rphv4hhjo4xwhbduqhoslu.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Phi angle will represent the azimuth in the plane of the base of the hemisphere, varying from 0 to </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-47-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>2</mn><mi>&amp;#x03C0;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.494ex" height="1.937ex" viewBox="0 -728.2 1074 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="500" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mi>œÄ</mi></math></span></span><script type="math/tex" id="MathJax-Element-47">2\pi</script>  .  Angle <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> will represent the elevation angle, varying from 0 to</font></font><span class="MathJax_SVG" id="MathJax-Element-48-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B8;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.057ex" viewBox="0 -780.1 469.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Œ∏</mi></math></span></span><script type="math/tex" id="MathJax-Element-48">\theta</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-49-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>&amp;#x03C0;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.99ex" height="3.262ex" viewBox="0 -935.7 1287.4 1404.6" role="img" focusable="false" style="vertical-align: -1.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(120,0)"><rect stroke="none" width="473" height="60" x="0" y="220"></rect><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="84" y="576"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="84" y="-536"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="713" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>œÄ</mi></math></span></span><script type="math/tex" id="MathJax-Element-49">\frac{1}{2}\pi</script>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The modified expression for reflectivity in such terms is as follows: </font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03D5;</mi><mi>o</mi></msub><mo>,</mo><msub><mi>&amp;#x03B8;</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>&amp;#x03C0;</mi></mfrac><msubsup><mo>&amp;#x222B;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03D5;</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>2</mn><mi>&amp;#x03C0;</mi></mrow></msubsup><msubsup><mo>&amp;#x222B;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>&amp;#x03C0;</mi></mrow></msubsup><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03D5;</mi><mi>i</mi></msub><mo>,</mo><msub><mi>&amp;#x03B8;</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>cos</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mi>sin</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mi>d</mi><mi>&amp;#x03D5;</mi><mi>d</mi><mi>&amp;#x03B8;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="59.538ex" height="6.877ex" viewBox="0 -1817.6 25634.4 2960.8" role="img" focusable="false" style="vertical-align: -2.655ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><g transform="translate(2462,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="843" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="3502" y="0"></use><g transform="translate(3947,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="5528" y="0"></use><g transform="translate(6584,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><g transform="translate(7575,0)"><g transform="translate(120,0)"><rect stroke="none" width="693" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="130" y="676"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="60" y="-686"></use></g></g><g transform="translate(8676,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJSZ2-222B" x="0" y="0"></use><g transform="translate(1060,1089)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="500" y="0"></use></g><g transform="translate(556,-898)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="596" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-30" x="1375" y="0"></use></g></g><g transform="translate(10825,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJSZ2-222B" x="0" y="0"></use><g transform="translate(1060,1089)"><g transform="translate(120,0)"><rect stroke="none" width="370" height="60" x="0" y="146"></rect><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="119" y="669"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="119" y="-628"></use></g><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="863" y="0"></use></g><g transform="translate(556,-898)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="469" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-30" x="1248" y="0"></use></g></g><g transform="translate(13168,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="14194" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="14584" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="15087" y="0"></use><g transform="translate(15532,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="843" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="16473" y="0"></use><g transform="translate(16918,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="17732" y="0"></use><g transform="translate(18288,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-63"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-6F" x="444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-73" x="945" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="19628" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="20017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="20487" y="0"></use><g transform="translate(21043,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-6E" x="673" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="22272" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="22662" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="23131" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="23521" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="24044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="24641" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="25164" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œï</mi><mi>o</mi></msub><mo>,</mo><msub><mi>Œ∏</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>œÄ</mi></mfrac><msubsup><mo>‚à´</mo><mrow class="MJX-TeXAtom-ORD"><mi>œï</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mn>2</mn><mi>œÄ</mi></mrow></msubsup><msubsup><mo>‚à´</mo><mrow class="MJX-TeXAtom-ORD"><mi>Œ∏</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>œÄ</mi></mrow></msubsup><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œï</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Œ∏</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo><mi>d</mi><mi>œï</mi><mi>d</mi><mi>Œ∏</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-50">L_o(p,\phi_o, \theta_o) = k_d\frac{c}{\pi} \int_{\phi = 0}^{2\pi} \int_{\theta = 0}^{\frac{1}{2}\pi} L_i(p,\phi_i, \theta_i) \cos(\theta) \sin(\theta) d\phi d\theta</script></p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The solution of such an integral will require taking a finite number of samples in the hemisphere </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and averaging results. </font><font style="vertical-align: inherit;">Knowing the number of samples</font></font><span class="MathJax_SVG" id="MathJax-Element-51-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi mathvariant=&quot;normal&quot;>&amp;#x03A9;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.678ex" height="2.057ex" viewBox="0 -780.1 722.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3A9" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Œ©</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">\Omega</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-52-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.557ex" height="1.937ex" viewBox="0 -728.2 1101 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="600" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-52">n1</script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for each of the spherical coordinates, we can translate the integral to the</font><a href="https://en.wikipedia.org/wiki/Riemann_sum"><font style="vertical-align: inherit;">Riemannian sum</font></a><font style="vertical-align: inherit;">:</font></font><span class="MathJax_SVG" id="MathJax-Element-53-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mn>2</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.557ex" height="1.937ex" viewBox="0 -728.2 1101 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="600" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mn>2</mn></math></span></span><script type="math/tex" id="MathJax-Element-53">n2</script><font style="vertical-align: inherit;"></font><a href="https://en.wikipedia.org/wiki/Riemann_sum"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03D5;</mi><mi>o</mi></msub><mo>,</mo><msub><mi>&amp;#x03B8;</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>&amp;#x03C0;</mi></mfrac><mfrac><mn>1</mn><mrow><mi>n</mi><mn>1</mn><mi>n</mi><mn>2</mn></mrow></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03D5;</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mn>1</mn></mrow></munderover><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>&amp;#x03B8;</mi><mo>=</mo><mn>0</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mn>2</mn></mrow></munderover><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><msub><mi>&amp;#x03D5;</mi><mi>i</mi></msub><mo>,</mo><msub><mi>&amp;#x03B8;</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>cos</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mi>sin</mi><mo>&amp;#x2061;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>&amp;#x03B8;</mi><mo stretchy=&quot;false&quot;>)</mo><mi>d</mi><mi>&amp;#x03D5;</mi><mi>d</mi><mi>&amp;#x03B8;</mi></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="62.538ex" height="7.6ex" viewBox="0 -1817.6 26926 3272.1" role="img" focusable="false" style="vertical-align: -3.378ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="2017" y="0"></use><g transform="translate(2462,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="843" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="3502" y="0"></use><g transform="translate(3947,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6F" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="4860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="5528" y="0"></use><g transform="translate(6584,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="737" y="-213"></use></g><g transform="translate(7575,0)"><g transform="translate(120,0)"><rect stroke="none" width="693" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-63" x="130" y="676"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3C0" x="60" y="-686"></use></g></g><g transform="translate(8509,0)"><g transform="translate(120,0)"><rect stroke="none" width="2322" height="60" x="0" y="220"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="910" y="676"></use><g transform="translate(60,-686)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="600" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="1101" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="1701" y="0"></use></g></g></g><g transform="translate(11238,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJSZ2-2211" x="0" y="0"></use><g transform="translate(59,-1110)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="596" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-30" x="1375" y="0"></use></g><g transform="translate(332,1151)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-31" x="600" y="0"></use></g></g><g transform="translate(12849,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJSZ2-2211" x="0" y="0"></use><g transform="translate(104,-1117)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-3D" x="469" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-30" x="1248" y="0"></use></g><g transform="translate(332,1151)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-32" x="600" y="0"></use></g></g><g transform="translate(14460,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="15486" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-70" x="15875" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="16379" y="0"></use><g transform="translate(16824,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="843" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-2C" x="17765" y="0"></use><g transform="translate(18210,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="663" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="19024" y="0"></use><g transform="translate(19580,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-63"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-6F" x="444" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-73" x="945" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="20919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="21309" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="21778" y="0"></use><g transform="translate(22335,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-73"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-69" x="394" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-6E" x="673" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-28" x="23564" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="23954" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMAIN-29" x="24423" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="24813" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3D5" x="25336" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-64" x="25933" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="26456" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œï</mi><mi>o</mi></msub><mo>,</mo><msub><mi>Œ∏</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><msub><mi>k</mi><mi>d</mi></msub><mfrac><mi>c</mi><mi>œÄ</mi></mfrac><mfrac><mn>1</mn><mrow><mi>n</mi><mn>1</mn><mi>n</mi><mn>2</mn></mrow></mfrac><munderover><mo>‚àë</mo><mrow class="MJX-TeXAtom-ORD"><mi>œï</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mn>1</mn></mrow></munderover><munderover><mo>‚àë</mo><mrow class="MJX-TeXAtom-ORD"><mi>Œ∏</mi><mo>=</mo><mn>0</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mn>2</mn></mrow></munderover><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><msub><mi>œï</mi><mi>i</mi></msub><mo>,</mo><msub><mi>Œ∏</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>cos</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo><mi>sin</mi><mo>‚Å°</mo><mo stretchy="false">(</mo><mi>Œ∏</mi><mo stretchy="false">)</mo><mi>d</mi><mi>œï</mi><mi>d</mi><mi>Œ∏</mi></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-54">L_o(p,\phi_o, \theta_o) = k_d\frac{c}{\pi} \frac{1}{n1 n2} \sum_{\phi = 0}^{n1} \sum_{\theta = 0}^{n2} L_i(p,\phi_i, \theta_i) \cos(\theta) \sin(\theta) d\phi d\theta</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since both spherical coordinates change discretely, at each moment the sample is taken from a certain averaged area over the hemisphere, as can be seen in the figure above. </font><font style="vertical-align: inherit;">Due to the nature of the spherical surface, the size of the area of ‚Äã‚Äãa discrete sample inevitably decreases with increasing elevation</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and approaching the zenith. </font><font style="vertical-align: inherit;">To compensate for this effect of reducing the area, we added a weighting factor to the expression.</font></font><span class="MathJax_SVG" id="MathJax-Element-55-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B8;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="2.057ex" viewBox="0 -780.1 469.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Œ∏</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">\theta</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-56-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>s</mi><mi>i</mi><mi>n</mi><mi>&amp;#x03B8;</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="4.378ex" height="2.057ex" viewBox="0 -780.1 1885 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-69" x="469" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-6E" x="815" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-3B8" x="1415" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mi>i</mi><mi>n</mi><mi>Œ∏</mi></math></span></span><script type="math/tex" id="MathJax-Element-56">sin\theta</script>  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As a result, the implementation of discrete sampling in a hemisphere based on spherical coordinates for each fragment in the form of a code looks like this: </font></font><br><br><pre> <code class="hljs pgsql">vec3 irradiance = vec3(<span class="hljs-number"><span class="hljs-number">0.0</span></span>); vec3 up = vec3(<span class="hljs-number"><span class="hljs-number">0.0</span></span>, <span class="hljs-number"><span class="hljs-number">1.0</span></span>, <span class="hljs-number"><span class="hljs-number">0.0</span></span>); vec3 right = <span class="hljs-keyword"><span class="hljs-keyword">cross</span></span>(up, normal); up = <span class="hljs-keyword"><span class="hljs-keyword">cross</span></span>(normal, right); <span class="hljs-type"><span class="hljs-type">float</span></span> sampleDelta = <span class="hljs-number"><span class="hljs-number">0.025</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> nrSamples = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">float</span></span> phi = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; phi &lt; <span class="hljs-number"><span class="hljs-number">2.0</span></span> * PI; phi += sampleDelta) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-type"><span class="hljs-type">float</span></span> theta = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; theta &lt; <span class="hljs-number"><span class="hljs-number">0.5</span></span> * PI; theta += sampleDelta) { //   .   (  -) vec3 tangentSample = vec3(sin(theta) * cos(phi), sin(theta) * sin(phi), cos(theta)); //      vec3 sampleVec = tangentSample.x * right + tangentSample.y * up + tangentSample.z * N; irradiance += texture(environmentMap, sampleVec).rgb * cos(theta) * sin(theta); nrSamples++; } } irradiance = PI * irradiance * (<span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-type"><span class="hljs-type">float</span></span>(nrSamples));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The variable </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sampleDelta</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> determines the size of the discrete step over the surface of the hemisphere. By changing this value, it is possible to increase or decrease the accuracy of the result. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inside both cycles, the usual 3-dimensional vector of the sample is formed from spherical coordinates, transferred from the tangent to world space, and then used to select the cubic environment map from HDR. The result of the samples is accumulated in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">irradiance</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> variable </font><font style="vertical-align: inherit;">, which in the final processing will be divided by the number of samples taken in order to obtain the average value of irradiance. Note that the result of sampling from a texture is modulated by two values: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cos (theta)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - to take into account the attenuation of light at large angles, and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">sin (theta)</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- to compensate for the reduction of the sample area when approaching the zenith. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It remains only to deal with the code that renders and captures the results of the convolution of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">envCubemap</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> environment </font><i><font style="vertical-align: inherit;">map</font></i><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">First, create a cubic map to store the irradiance (you will need to perform it once, before entering the main render cycle):</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> irradianceMap; glGenTextures(<span class="hljs-number"><span class="hljs-number">1</span></span>, &amp;irradianceMap); glBindTexture(GL_TEXTURE_CUBE_MAP, irradianceMap); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">6</span></span>; ++i) { glTexImage2D(GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB16F, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, GL_RGB, GL_FLOAT, <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>); } glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_S, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_T, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_WRAP_R, GL_CLAMP_TO_EDGE); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MIN_FILTER, GL_LINEAR); glTexParameteri(GL_TEXTURE_CUBE_MAP, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the irradiance map is obtained on the basis of averaging evenly distributed samples of the energy brightness of the environment map, it almost does not contain high-frequency parts and elements ‚Äî a rather small resolution texture (here 32x32) and linear filtering will be enough to store it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Next, configure the capture framebuffer for this resolution:</font></font><br><br><pre> <code class="cpp hljs">glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); glBindRenderbuffer(GL_RENDERBUFFER, captureRBO); glRenderbufferStorage(GL_RENDERBUFFER, GL_DEPTH_COMPONENT24, <span class="hljs-number"><span class="hljs-number">32</span></span>, <span class="hljs-number"><span class="hljs-number">32</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The code for capturing the results of a convolution is similar to the code for converting an environment map from equilateral to cubic, only using the convolution shader: </font></font><br><br><pre> <code class="cpp hljs">irradianceShader.use(); irradianceShader.setInt(<span class="hljs-string"><span class="hljs-string">"environmentMap"</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); irradianceShader.setMat4(<span class="hljs-string"><span class="hljs-string">"projection"</span></span>, captureProjection); glActiveTexture(GL_TEXTURE0); glBindTexture(GL_TEXTURE_CUBE_MAP, envCubemap); <span class="hljs-comment"><span class="hljs-comment">//        glViewport(0, 0, 32, 32); glBindFramebuffer(GL_FRAMEBUFFER, captureFBO); for (unsigned int i = 0; i &lt; 6; ++i) { irradianceShader.setMat4("view", captureViews[i]); glFramebufferTexture2D(GL_FRAMEBUFFER, GL_COLOR_ATTACHMENT0, GL_TEXTURE_CUBE_MAP_POSITIVE_X + i, irradianceMap, 0); glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT); renderCube(); } glBindFramebuffer(GL_FRAMEBUFFER, 0);</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After completing this stage, we will have a pre-calculated irradiance map on our hands, which can be directly used to calculate indirect diffuse illumination. </font><font style="vertical-align: inherit;">To check how the convolution took place, try replacing the skybox texture from the environment map with the irradiance map:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mt/gc/cs/mtgccsxl0h80cdo1gg8wgl3tp9m.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If as a result you saw something resembling a strongly blurred map of the environment, then, most likely, the convolution was successful. </font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> PBR and indirect illumination </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The resulting irradiance map is used in the diffuse part of the divided expression of reflectivity and represents the accumulated contribution from all possible directions of indirect illumination. </font><font style="vertical-align: inherit;">Since in this case the light does not come from specific sources, but from the environment as a whole, we consider diffuse and specular indirect illumination as </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ambient</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , replacing the previously used constant value. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For a start, let's not forget to add a new sampler with an irradiance map:</font></font><br><br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">uniform</span></span> samplerCube irradianceMap;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Having an irradiance map that stores all the information about the indirect diffuse radiation of a scene, and the normal to the surface, it‚Äôs as easy to get data on the irradiance of a particular fragment as to make one sample from the texture: </font></font><br><br><pre> <code class="hljs objectivec"><span class="hljs-comment"><span class="hljs-comment">// vec3 ambient = vec3(0.03); vec3 ambient = texture(irradianceMap, N).rgb;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, since indirect radiation contains data for both the diffuse and specular components (as we saw in the component-specific version of the reflectivity expression), we will need to modulate the diffuse component in a special way. </font><font style="vertical-align: inherit;">Just as in the previous lesson, we use the Fresnel expression to determine the degree of reflection of light for a given surface, from which we obtain the degree of refraction of light or the diffuse coefficient:</font></font><br><br><pre> <code class="hljs lisp">vec3 kS = fresnelSchlick(<span class="hljs-name"><span class="hljs-name">max</span></span>(<span class="hljs-name"><span class="hljs-name">dot</span></span>(<span class="hljs-name"><span class="hljs-name">N</span></span>, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), F0)<span class="hljs-comment"><span class="hljs-comment">; vec3 kD = 1.0 - kS; vec3 irradiance = texture(irradianceMap, N).rgb; vec3 diffuse = irradiance * albedo; vec3 ambient = (kD * diffuse) * ao;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Because background lighting falls from all directions in a hemisphere based on surface normals </font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it is impossible to determine a single median (</font><i><font style="vertical-align: inherit;">halfway</font></i></font><span class="MathJax_SVG" id="MathJax-Element-57-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>N</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.064ex" height="2.057ex" viewBox="0 -780.1 888.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/426987/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhiJBBg2xCd8IA4cYb9ayoeUBSv7cw#MJMATHI-4E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-57"> N </script><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) vector to calculate the fresnel coefficient. In order to imitate the Fresnel effect in such conditions, we have to calculate the coefficient based on the angle between the normal and the vector of observation. However, previously, as a parameter, we used the median vector, derived from the model of microsurfaces and depending on the surface roughness, to calculate the Fresnel coefficient. Since in this case the roughness is not included in the calculation parameters, the degree of reflection of light by the surface will always be overestimated. Indirect lighting as a whole should behave in the same way as direct lighting, i.e. From rough surfaces, we expect a lesser degree of reflection at the edges. But since the roughness is not taken into account,then the degree of mirror Fresnel for indirect illumination looks unrealistic on rough non-metallic surfaces (in the image below, the described effect is exaggerated for greater clarity):</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/q2/oc/ly/q2oclypt9x6lcg5yyaqr4d8hu9i.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To get around this trouble, you can add roughness to the Fremen-Schlick expression, a process described by </font></font><a href="https://seblagarde.wordpress.com/2011/08/17/hello-world/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S√©bastien Lagarde</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="hljs mel">vec3 fresnelSchlickRoughness(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cosTheta, vec3 F0, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> F0 + (<span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - roughness), F0) - F0) * <span class="hljs-keyword"><span class="hljs-keyword">pow</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - cosTheta, <span class="hljs-number"><span class="hljs-number">5.0</span></span>); }</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Taking into account the surface roughness in calculating the Fresnel kit, the code for calculating the background component takes the following form: </font></font><br><br><pre> <code class="hljs lisp">vec3 kS = fresnelSchlickRoughness(<span class="hljs-name"><span class="hljs-name">max</span></span>(<span class="hljs-name"><span class="hljs-name">dot</span></span>(<span class="hljs-name"><span class="hljs-name">N</span></span>, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), F0, roughness)<span class="hljs-comment"><span class="hljs-comment">; vec3 kD = 1.0 - kS; vec3 irradiance = texture(irradianceMap, N).rgb; vec3 diffuse = irradiance * albedo; vec3 ambient = (kD * diffuse) * ao;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As it turned out, the use of illumination based on the image is inherently reduced to a single sample from the cube map. </font><font style="vertical-align: inherit;">All the difficulties are mainly related to the preliminary preparation and transfer of the environment map to the irradiance map. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Taking a familiar scene from a lesson about </font></font><a href="https://habr.com/post/424453"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">analytic</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> light </font><a href="https://habr.com/post/424453"><font style="vertical-align: inherit;">sources</font></a><font style="vertical-align: inherit;"> containing an array of spheres with varying metallicity and roughness, and adding diffuse background lighting from the surroundings, you get something like this:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/vd/b1/y1/vdb1y1xddczspcyl-7exei76lxw.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It still looks strange, because materials with a high degree of metallicity still </font></font><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">require</font></font></u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> reflections in order to really look like, hmm, metal (metals do not reflect diffuse lighting). </font><font style="vertical-align: inherit;">And in this case, the only reflections obtained from point analytical light sources. </font><font style="vertical-align: inherit;">And yet, we can already say that the spheres look more immersed in the environment (especially noticeable when switching environment maps), since the surfaces now correctly respond to the background lighting from the surroundings of the scene. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The complete lesson source code is </font></font><a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/2.1.2.ibl_irradiance/ibl_irradiance.cpp"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">here.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In the next lesson we will finally deal with the second half of the expression of reflectivity, which is responsible for indirect mirror lighting. </font><font style="vertical-align: inherit;">After this step, you will truly feel the power of the PBR approach to lighting.</font></font><br><br><h2>  Additional materials </h2><br><ul><li> <a href="http://www.codinglabs.net/article_physically_based_rendering.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Coding Labs: Physically based rendering</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : an introduction to the PBR model, along with an explanation of how to construct and what the irradiance map is for.</font></font></li><li> <a href="http://www.scratchapixel.com/lessons/mathematics-physics-for-computer-graphics/mathematics-of-shading"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Mathematics of Shading</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : ScratchAPixel's brief overview of some of the mathematical techniques used in this lesson, in particular, about polar coordinates and integrals.</font></font></li></ul><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : We have a </font></font><a href="https://t.me/joinchat/Cpb05A46UPpMWdNVVCb4Vg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">telegram-konf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> to coordinate transfers. </font><font style="vertical-align: inherit;">If there is a serious desire to help with the translation, then you are welcome!</font></font></div><p>Source: <a href="https://habr.com/ru/post/426987/">https://habr.com/ru/post/426987/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../426977/index.html">LibreOffice: a bad dream accountant</a></li>
<li><a href="../426979/index.html">How to learn English for free: 3 banal tools and detailed instructions for each</a></li>
<li><a href="../426981/index.html">10 tricks for advanced dashboarding in Splunk. Part 1</a></li>
<li><a href="../426983/index.html">New in SObjectizer 5.5.23: wish fulfillment or Pandora's box?</a></li>
<li><a href="../426985/index.html">kubebox and other console shells for Kubernetes</a></li>
<li><a href="../426991/index.html">Startup Digest: 10 nearest IT events in Moscow</a></li>
<li><a href="../426993/index.html">Do I need to learn C to understand how a computer works?</a></li>
<li><a href="../426995/index.html">Recycling harms both products and employees</a></li>
<li><a href="../426997/index.html">How to create custom shapes with MaterialShapeDrawable</a></li>
<li><a href="../426999/index.html">In the wake of trends, or moving towards RxJava and LiveData</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>