<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Early bury java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Much has been said about the "beauty" of Java code, but in my opinion, the main thing is not a tool, but the ability to use it. Under the cut an attem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Early bury java</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6eb/74f/1de/6eb74f1dec93ea6ee5ed107522455204.jpg" alt="image"><br><br>  Much has been said about the "beauty" of Java code, but in my opinion, the main thing is not a tool, but the ability to use it.  Under the cut an attempt to write a declarative DSL for layout for Android without even inventing a <a href="https://kotlinlang.org/">new programming language</a> ! <br><a name="habracut"></a><br>  Java layout has always been associated with pain. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dp = getResources().getDisplayMetrics().density; FrameLayout root = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); root.setBackgroundColor(RED); root.setLayoutParams( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewGroup.LayoutParams( MATCH_PARENT, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">100f</span></span>*dp))); FrameLayout child = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); child.setBackgroundColor(GREEN); FrameLayout.LayoutParams childParams = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FrameLayout.LayoutParams( (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">50f</span></span>*dp), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(<span class="hljs-number"><span class="hljs-number">50f</span></span>*dp)); childParams.gravity = CENTER; child.setLayoutParams(childParams); root.addView(child);</code> </pre> <br>  Result: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/web/0b1/627/586/0b1627586feb4632a283b661cba0d5fc.png"><br><br>  And the point is not that the code looks scary (and it is scary as hell).  The main problem is that it is impossible not to be mistaken.  I passed this code 3 times here, for the first and second times naively believing that I could write everything correctly at once, and carefully rechecking everything only for the third.  You will say that the matter of my carelessness will be right, but if even in such a simple layout you can mess up, then what can we say about something more complicated? <br><br>  But why is everything so sad with the Java layout?  In my opinion, the main reason is the ability to typeset in xml and the lack of a tool for Java layout. <br><br><h3>  Cons xml </h3><br>  For me there are 3 of them. <br><br>  The first is an overhead projector. <br>  Why waste the resources of already not very powerful Android devices for operations such as inflate and findViewById?  A lot of time and effort was spent on optimization of these operations, but they did not become free from this. <br><br>  The second is cumbersome. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#f00"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100dp"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:background</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"#0f0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_gravity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"center"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"50dp"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FrameLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  It depresses the need to duplicate tags, write before each attribute "android:", and then work out partial blindness to read this code. <br><br>  The third is the limitations of the language. <br>  Suppose I want to make a signature to the avtar 10dp more than the avatar itself. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ImageView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/avatarSide"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/avatarSide"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@dimen/avatarSide + 10dp"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wrap_content"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br><br>  But this can not be done because xml does not support expressions. <br><br><h3>  Why not Anko? </h3><br>  Anko is a DSL with which you can declaratively describe markup on Kotlin. <br><br><pre> <code class="hljs nginx"><span class="hljs-section"><span class="hljs-section">frameLayout</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">backgroundColor</span></span> = RED frameLayout { <span class="hljs-attribute"><span class="hljs-attribute">backgroundColor</span></span> = GREEN }.lparams(dip(<span class="hljs-number"><span class="hljs-number">50</span></span>), dip(<span class="hljs-number"><span class="hljs-number">50</span></span>)) { <span class="hljs-attribute"><span class="hljs-attribute">gravity</span></span> = CENTER } }.lparams(matchParent, dip(<span class="hljs-number"><span class="hljs-number">100</span></span>))</code> </pre> <br>  We get all the features of a full-fledged programming language, better performance and do not even suffer from the layout of the interface in Java! <br><br>  Everything is fine, but, in my opinion, it is indecent to pull a whole runtime of the language behind while developing libraries.  500 kb is not so much for the final application, but for the library it‚Äôs obviously overkill. <br><br><h3>  Janko </h3><br>  As it turned out, there is enough Java capability to declare it. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> frameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ width = MATCH_PARENT; height = dip(<span class="hljs-number"><span class="hljs-number">100</span></span>); }}._(); backgroundColor = RED; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> frameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ width = dip(<span class="hljs-number"><span class="hljs-number">50</span></span>); height = dip(<span class="hljs-number"><span class="hljs-number">50</span></span>); gravity = CENTER; }}._(); backgroundColor = GREEN; }}._(); }}._();</code> </pre> <br>  The language supports unnamed code blocks.  They are executed before the class constructor immediately after the parent class constructor. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// block { // some code } }</span></span></code> </pre> <br>  I used this Java opportunity not to write the name of the variable in which the widget lies to change each of its properties. <br><br>  Example with avatar and signature. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imageView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ width = dimen(R.dimen.avatarSide); height = dimen(R.dimen.avatarSide); }}._(); }}._(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> textView(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) {{ width = dimen(R.dimen.avatarSide) + dip(<span class="hljs-number"><span class="hljs-number">10</span></span>); height = WRAP_CONTENT; }}._(); }}._();</code> </pre> <br>  Looks a little weird. <br><br><img src="https://habrastorage.org/web/279/93d/f6c/27993df6cf404077968f523d792398bc.png"><br><br>  It looks like a man in a monocle and an operator on scala.  But for the proof of concept - enough. <br><br><h3>  Results </h3><br>  0).  On Kotlin, the code looks like this: <br><br><pre> <code class="java hljs">object : frameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { init { object : lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { init { width = MATCH_PARENT height = dip(<span class="hljs-number"><span class="hljs-number">100f</span></span>) } }.`_`() backgroundColor = RED object : frameLayout(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { init { object : lparams(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) { init { width = dip(<span class="hljs-number"><span class="hljs-number">50f</span></span>) height = dip(<span class="hljs-number"><span class="hljs-number">50f</span></span>) gravity = CENTER } }.`_`() backgroundColor = GREEN } }.`_`() } }.`_`()</code> </pre> <br>  1) aar weight is 12kb <br>  2) Idea does not knock formatting <br>  3) Java code can sometimes be made unexpected for Java <br><br>  <a href="https://github.com/a-dminator/janko">Repository with library and examples</a> <br>  <a href="https://github.com/a-dminator/anko_benchmark">Benchmark</a> <br><br>  Usually a little faster than Anko, which is funny. <br><br>  I expected my mini-library to become the last refuge of this monster, but even from there I sawed it in favor of <a href="https://fblitho.com/">Litho</a> , which performs measurment and layout in another thread.  Thank you <a href="https://habrahabr.ru/users/eirnym/" class="user_link">eirnym</a> for the link. </div><p>Source: <a href="https://habr.com/ru/post/331790/">https://habr.com/ru/post/331790/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331778/index.html">As we wrote a strategic clicker on the hackathon ReactRiot</a></li>
<li><a href="../331780/index.html">It's time to throw! Migration Experience from Objective-C to Swift</a></li>
<li><a href="../331784/index.html">Million WebSocket and Go</a></li>
<li><a href="../331786/index.html">The problem of continuous protection of web applications. View from the side of researchers and operators</a></li>
<li><a href="../331788/index.html">Petya.A, Petya.C, PetrWrap or PetyaCry? New virus threat for companies in Russia and Ukraine</a></li>
<li><a href="../331792/index.html">IT & City Android hackathon in Nizhny Novgorod</a></li>
<li><a href="../331794/index.html">"Now he counted you" or Data Science from Scratch</a></li>
<li><a href="../331796/index.html">Leaflet 1.xx vs Openlayers 4.xx Part 1. Source Code</a></li>
<li><a href="../331800/index.html">Interesting Factorio Study: Plant Simulator</a></li>
<li><a href="../331802/index.html">About Gaudi, a nineteenth-century developer who achieved all that a developer can accomplish</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>