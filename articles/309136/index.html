<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ADM interface - what is ‚ÄúTetrad‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The ADM interface is an internal standard of the Instrumental Systems company. It defines the rules for connecting the ADM submodules and base modules...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ADM interface - what is ‚ÄúTetrad‚Äù</h1><div class="post__text post__text-html js-mediator-article">  The ADM interface is an internal standard of the Instrumental Systems company.  It defines the rules for connecting the ADM submodules and base modules.  The key element of the interface is the ADM FPGA.  Initially used FPGA series FLEX10K and Acex 1K company Altera.  In 2003, the transition to the Xilinx FPGA began.  Almost all FPGA series from Spartan 2E to Kintex Ultrascale are used.  The basic element of the FPGA project is the ‚Äútetrad‚Äù.  This article is about that. <br><a name="habracut"></a><br>  The basic version of the ADM interface on the basis of Altera FPGA is called ‚ÄúADM Interface.  Classic implementation.  Its feature is the presence in the FPGA block of sixteen registers.  Part of the registers served the FIFO, part of the registers was assigned to service the submodule.  With the increasing complexity of the products of sixteen registers was not enough to organize management.  The situation is complicated by the fact that on many basic modules only five or six address lines are connected to the FPGA, for more simply there are not enough legs.  In such a situation, the logical solution is the organization of indirect addressing, but it requires that you leave quick access to the FIFO registers.  As a result, a new implementation appeared, which was called the ‚ÄúADM Interface.  Progressive implementation. <br><br><h2>  Logical implementation </h2><br>  The main element is the tetrad.  A tetrad is a logical entity that has four directly addressable registers and 1024 indirectly addressable registers. <br><br>  The logical organization of the tetrad is shown in the figure: <br><img src="https://habrastorage.org/files/3f1/21b/3f4/3f121b3f4c2c40218ab654f12b666d42.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Direct registers: <br><br><ul><li>  STATUS - FIFO status register, contains FIFO flags </li><li>  DATA - FIFO data register </li><li>  IND_ADR - indirect address register </li><li>  IND_DATA - indirect data register </li></ul><br>  Indirectly addressed registers are divided into three groups. <br><br><ul><li>  Group 1 - command registers, addresses from 0x000 to 0x0FF </li><li>  Group 2 - constants, addresses from 0x100 to 0x1FF </li><li>  Group 3 - immediate registers, addresses from 0x200 to 0x3FF </li></ul><br>  The main feature of the command registers is that they can change their state either in the reset process or in the process of writing to the register.  This allows the use of shadow RAM for reading from registers.  And the use of shadow RAM allows sharply reducing FPGA resources to organize reverse reading from registers.  Because of the shadow RAM, we had to enter a certain procedure for resetting the tetrad, it is required to form a reset signal and set the value 0 to all command registers. <br><br>  The constant group stores the most important information about the tetrad.  First of all, it is the tetrade identifier, the version number and the presence and direction of the FIFO.  The tetrad identifier uniquely identifies the set of registers. <br><br>  Direct registers allow registers to be implemented with any behavior, including additional status registers.  It should be remembered that the implementation of the registers for reading will require the implementation of a multiplexer, which is a FPGA resource eater.  It is recommended that the largest number of registers be placed in the command group and, by minimum, in the immediate group. <br><br>  Currently, to organize the shadow RAM of all tetrads, only one FPGA memory block is used.  This allows organizing 32 command registers and 32 constants in each tetrad.  At any moment this quantity can be increased, but so far it has not been required. <br><br>  In the FPGA firmware can be sixteen tetrads.  Each tetrad controls its own complete part of the interface. <br><br>  For example, the composition of the tetrads is given for the firmware of the FMC107P module and the submodule FM216x250MDA <br><br><ul><li>  TRD_MAIN - share management </li><li>  BPI_FLASH - access to bootable flash </li><li>  TRD_DDS9956 - control synthesizer </li><li>  PIOX_STD - digital port management </li><li>  TRD_FM216x250MDA_ADC - control ADC on submodule </li><li>  TRD_DDR3x - DDR memory management </li><li>  TRD_FM216x250MDA_DAC - DAC control on the submodule </li></ul><br><h2>  Implementation on VHDL </h2><br>  The FPGA project is written in the VHDL language.  To connect the tetrad, special data types are used, which dramatically reduces the amount of text.  Currently, there are three types of connections.  First of all, they differ in the width of the data bus, and in the second - in the type of connection signals. <br><br>  Type 1 - 64-bit data bus width.  Used with signal processors and PCI Express v1.1 x8 interface <br>  Type 2 - 128-bit data bus width.  Used with interface PCI Express v2.0 x8 <br>  Type 3 - data bus width 512 bits.  Used with PCI Express v3.0 x16 interface <br><br>  In all cases, the bus clock speeds up to 266 MHz.  If you do not need maximum speed, it is recommended to reduce the clock frequency to facilitate tracing FPGA. <br><br>  The base data type is bl_cmd <br><br><div class="spoiler">  <b class="spoiler_title">Type bl_cmd</b> <div class="spoiler_text"><pre><code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> bl_cmd <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> data_we : <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- 1 -    DATA cmd_data_we : std_logic; -- 1 -    CMD_DATA status_cs : std_logic; -- 0 -    STATUS data_cs : std_logic; -- 0 -    DATA cmd_data_cs : std_logic; -- 0 -    CMD_DATA cmd_adr_we : std_logic; -- 1 -      adr : std_logic_vector( 9 downto 0 ); --   data_oe : std_logic; -- 0 -    DATA end record;</span></span></code> </pre> <br></div></div><br>  There is a separate type to describe the DMA request signal. <br><br><div class="spoiler">  <b class="spoiler_title">Type bl_drq</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> bl_drq <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> en : <span class="hljs-built_in"><span class="hljs-built_in">std_logic</span></span>; <span class="hljs-comment"><span class="hljs-comment">-- 1 -   DMA req : std_logic; -- 1 -     DMA ack : std_logic; -- 1 -   DMA end record;</span></span></code> </pre><br></div></div><br>  The description of the type 1 tetrad looks like this: <br><br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">component</span></span> trd_user1 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> ( <span class="hljs-comment"><span class="hljs-comment">-- GLOBAL reset : in std_logic; -- 0 -  clk : in std_logic; --   cmd_data_in : in std_logic_vector( 15 downto 0 ); --    CMD_DATA cmd : in bl_cmd; --    data_out : out std_logic_vector( 63 downto 0 ); --  DATA cmd_data_out : out std_logic_vector( 15 downto 0 ); --   bx_irq : out std_logic; -- 1 -    bx_drq : out bl_drq; --  DMA ‚Ä¶. (   ) end component;</span></span></code> </pre><br>  With the exception of clock and reset signals, six signals are used. <br>  For a tetrad of type 2, the number of signals decreased to two. <br><br><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">component</span></span> trd_user2 <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">port</span></span> ( <span class="hljs-comment"><span class="hljs-comment">-- GLOBAL reset : in std_logic; -- 0 -  clk : in std_logic; --   host2trd : in type_host2trd; --    trd2host : out type_trd2host --    ‚Ä¶. (   ) end component;</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Type Definitions</b> <div class="spoiler_text"><pre> <code class="vhdl hljs"><span class="hljs-keyword"><span class="hljs-keyword">type</span></span> type_trd2host <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">record</span></span> status : <span class="hljs-built_in"><span class="hljs-built_in">std_logic_vector</span></span>( <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">downto</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> ); <span class="hljs-comment"><span class="hljs-comment">--!  STATUS cmd_data : std_logic_vector( 15 downto 0 ); --!   data : std_logic_vector( 127 downto 0 ); --!   DATA drq : bl_drq; --!  DMA irq : std_logic; --!   fifo_rstp : std_logic; --! 1 -  FIFO end record; type type_host2trd is record cmd : bl_cmd; --!    cmd_data : std_logic_vector( 15 downto 0 ); --      data : std_logic_vector( 127 downto 0 ); --  128      DATA end record;</span></span></code> </pre><br></div></div><br>  As the FPGA grows in size, it becomes more difficult to place tetrad components inside the FPGA.  This is due to the high clock frequency and long connections. <br><br>  In this case, a high clock frequency is needed only for data transmission.  To access registers enough 100 MHz.  Connection types 1 and 2 use only one clock signal.  Type 3 uses two clock frequencies and an additional component repack.  The repack component is installed between the notebook and the bus connection.  It has the parameter STAGE, which determines the number of additional triggers on the data bus.  In addition, it is possible to implement several modifications for connecting type 1 and 2 notebooks. The figure shows the configuration in which the type 2 tetrad is connected through the REPACK_128 component and the type 3 tetrad is connected through the REPACK_512 component, using the parameter STAGE = 4 which allows you to set the tetrad in any location PLIS Virtex 7. <br><br><img src="https://habrastorage.org/files/f48/0e9/eef/f480e9eefe914411a071483d1f53d9e3.png" alt="image"><br>  In conclusion, I would like to note that the tetrads turned out to be very convenient for modular construction of FPGA firmware and modular construction of software.  The concept of tetrad is actively used for more than 12 years.  The tetrads have experienced an increase in FPGAs and a change in series from Spartan 2E to Virtex 7 and are being introduced into the Ultrascale series.  Input speed has risen from 200 MB / s to 11 GB / s.  Supported by a large number of submodules.  There was a transition from the internal standard ADM to the international standard FMC. <br><br>  A more detailed description of the tetrads is given in the document: ‚ÄúDCR0340 - ADM Interface.  Progressive implementation.  In accordance with the rules of Habrahabr, I can not give a link to the document. </div><p>Source: <a href="https://habr.com/ru/post/309136/">https://habr.com/ru/post/309136/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309124/index.html">LXC in QoS service (replace ifb with veth)</a></li>
<li><a href="../309126/index.html">How to work with MS Access in Linux</a></li>
<li><a href="../309128/index.html">Automating the maintenance of correspondence between the names of layers in the editor and code using CodeDom</a></li>
<li><a href="../309130/index.html">Communication Arrangements</a></li>
<li><a href="../309132/index.html">Once again about the benefits of backups or the story of my failure</a></li>
<li><a href="../309138/index.html">Learning OpenGL ES2 for Android Lesson ‚Ññ4. Textures</a></li>
<li><a href="../309142/index.html">Private unstructured types and type reuse</a></li>
<li><a href="../309144/index.html">About alignment of memory on ARM processors on a simple example</a></li>
<li><a href="../309150/index.html">Constants do not change: a small excursion into the depths of dotNet</a></li>
<li><a href="../309152/index.html">Review of computer vision problems in medicine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>