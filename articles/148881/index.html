<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to speed up the scheduling algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear habravchane! 
 Surely, many of you have come across in your work with the need to solve a planning problem in the field of scheduling theo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to speed up the scheduling algorithm</h1><div class="post__text post__text-html js-mediator-article">  Hello, dear habravchane! <br>  Surely, many of you have come across in your work with the need to solve a planning problem in the field of scheduling theory.  I would like to tell you how you can speed up the work of such a program without affecting the algorithm itself. <br><a name="habracut"></a><br>  There is a huge number of approaches to solving these problems, implemented by using and combining various heuristic, approximate algorithms and brute force reduction algorithms.  In life, all of their implementation is very dependent on the specifics of the enterprise, therefore, without going into a separate solution, consider the general steps to reduce the time to build a result. <br>  Let's take a very vital task ‚ÄúDistribution of works by posts‚Äù.  And also a user who makes up a set of work and sends it for planning.  And he must withdraw not one or two options, but all possible intervals for the day.  Those.  to say whether it is possible to stick this set of work at 8.00?  And at 8.30?  And so on all day. <br><br><h5>  Data structure </h5><br>  Each post is characterized by the type of work that can be performed on it.  At each post, working intervals are known (i.e., time periods that are not occupied by breaks or other work).  Each planned work is characterized by a standard of time and type. <br><br>  Information about free intervals from my server is dragged into such a label: <br><img src="https://habrastorage.org/storage2/a5e/ba5/790/a5eba5790eeab32add1280c8d800eb21.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Jobs are stored in a list of the following structures: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">JobTypes</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JobTypes</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> jId, TimeSpan time, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> job_code = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"0"</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.JobId = jId; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.JobRuntime = time; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.JobType = type; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.JobCode = job_code; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> JobId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TimeSpan JobRuntime { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> JobType { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> JobCode { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><br>  When performing several works in succession of the same type, transferring them to different posts is an undesirable situation and costs some time resources.  When planning, it makes sense to introduce the concept of ‚Äúweight of the path‚Äù, which will determine the quality of the calculated schedule.  Each transition between posts should increase the weight, each execution on a post of an unsuitable type should make the weight of the overall schedule even more heavy.  Also, the weight between the time of completion of work and the reference one, the workload of the selected posts and a lot of factors at the request of the customer can influence the weight. <br>  If the user just needs to show any possible schedule, we will use quick approximate methods and do it.  But if you need to display the schedule, which had the least weight, you will have to implement the method of your search method.  The duration of this method will grow exponentially depending on the amount of work.  Accordingly, if the speed of building a schedule with one or two jobs will vary within hundredths of a second, with four or five within tenths, then calculating the schedule with more than twenty minor jobs may well come out in a few minutes.  Of course, all figures are approximate and highly dependent on the situation, but the general principle is clear. <br><br><h5>  Verify build capability </h5><br>  The first step in which you can reduce the time of the program is to check the resource of the workshop before the start of the calculation.  The types of planned work and the time of each work are known, the schedule and composition of the workshop is known.  Therefore, you need to take the total free time for each type of posts, without specifying where and when it is free and impose it on the total duration of the work of the respective types.  If there is not enough time, then it is clear that the schedule cannot be built for the selected time, we will send a message to the user that there are not enough resources in the workshop and we will offer to choose another day. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CheckPeriodsAvailable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">SchData sch_data</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> jTime = <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sch_data.jobs <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> s <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { jType = s.JobType } <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> g <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { g.Key.jType, qty = g.Sum(s =&gt; s.JobRuntime.TotalMinutes) }; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pTime = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">from</span></span></span><span class="hljs-function"> s </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">sch_data.BasicData.Tables[</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"MonthFree"</span></span></span></span><span class="hljs-function"><span class="hljs-params">]</span></span></span><span class="hljs-function">).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AsEnumerable</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">group</span></span></span><span class="hljs-function"> s </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">by</span></span></span><span class="hljs-function"> new</span></span> { jType = s.Field&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;(<span class="hljs-string"><span class="hljs-string">"JobType"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> g <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> { g.Key.jType, qty = g.Sum(s =&gt; (s.Field&lt;DateTime&gt;(<span class="hljs-string"><span class="hljs-string">"FinTime"</span></span>) - s.Field&lt;DateTime&gt;(<span class="hljs-string"><span class="hljs-string">"StartTime"</span></span>)).TotalMinutes) }).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> j <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> jTime) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> p = pTime.Find(item =&gt; item.jType.Equals(j.jType)).qty; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (j.qty &gt; p) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre><br><br>  If the resources are still found, then move on to the second step - reducing brute force.  It is clear that a solution with a minimum weight is such a solution in which work of each type was performed only on one post without interruption.  In life, this is expressed in the fact that the car in the service center will be processed at one post, and will not be dragged throughout the workshop.  It is likely that work will have to start later, but here you have to compare the weight of the delay with the weight of the transfer of the machine and choose the lesser of two evils. <br><br><h5>  Reducing the number of iterations </h5><br>  Before the start of the planning process, all the works are combined into single blocks, grouped by type, in the order of work performed.  If the problem statement does not say about the dependence of tasks (i.e., that the work of i + 2 cannot be completed before i + 1 is finished), then we will sort the works by type.  The duration of each block is considered to be equal to the total duration of all works included in the block. <br>  Thus, in the simplest case, the planning will be sent not only 20 small works, but one long one.  About the difference in execution time was mentioned above.  All scanned paths for combined work are worth saving into some decision tree.  With a negative result, you need to gradually reduce the density of the group and delete from the search area those paths that have already been added to the tree. <br>  As soon as the path with the minimum desired weight is found, we will stop the search process and divide the group back into separate jobs, in order to provide information about what work will be done at what time. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> List&lt;PeriodElems&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SeparateSch</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">List&lt;PeriodElems&gt; resultList, List&lt;JobTypes&gt; jobs, DataTable PostsData</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (j &lt; resultList.Count) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((j) &lt; jobs.Count) &amp;&amp; (resultList[j].time &gt; jobs[j].JobRuntime) &amp;&amp; (resultList[j].type == jobs[j].JobType)) { PeriodElems ins_elem = resultList[j].Clone(); <span class="hljs-comment"><span class="hljs-comment">// ,         var periods = from item in (PostsData).AsEnumerable() where item.Field&lt;int&gt;("PostId") == resultList[j].post_id &amp;&amp; ( (item.Field&lt;DateTime&gt;("StartTime") &lt;= resultList[j].start &amp;&amp; item.Field&lt;DateTime&gt;("FinTime") &gt; resultList[j].start) || (item.Field&lt;DateTime&gt;("StartTime") &gt; resultList[j].start &amp;&amp; item.Field&lt;DateTime&gt;("FinTime") &lt; resultList[j].fin) || (item.Field&lt;DateTime&gt;("StartTime") &lt; resultList[j].fin &amp;&amp; item.Field&lt;DateTime&gt;("FinTime") &gt;= resultList[j].fin) ) select item; DataView OldMonthRows = periods.AsDataView&lt;DataRow&gt;(); if (OldMonthRows.Count == 0) { return null; } //    -  ok,  ,   . TimeSpan shift_time = OldMonthRows.Count == 1 ? jobs[j].JobRuntime : GetShiftTime(jobs[j].JobRuntime, OldMonthRows, DateTime.Parse(OldMonthRows[0]["FinTime"].ToString()) - resultList[j].start); //           -    TimeSpan delta = DateTime.Parse(OldMonthRows[0]["StartTime"].ToString()) - ins_elem.start; if (delta &gt; TimeSpan.Zero) { resultList[j].start += delta; resultList[j].fin += delta; } ins_elem.start = resultList[j].fin = resultList[j].start + shift_time; if (!ins_elem.start.Equals(ins_elem.fin)) resultList.Insert(j + 1, ins_elem); } j++; } return resultList; }</span></span></code> </pre><br><br>  The difficulty lies in the fact that breaks are possible in the workshop, which must be taken into account when backing up the work.  In the above case, you need to make sure that the start of work does not fall into a break, and when the end of work gets into it, it will be autofocus for the next working period. <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> TimeSpan </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetShiftTime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">TimeSpan jTime, DataView OldMonthRows, TimeSpan fndTime</span></span></span><span class="hljs-function">)</span></span> { TimeSpan sftTime = jTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OldMonthRows.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//,     . if (fndTime &lt; sftTime) { sftTime = fndTime + TimeSpan.FromMinutes(Convert.ToInt32(OldMonthRows[0]["TimeToNext"])); for (int per_numb_s = 1; per_numb_s &lt; OldMonthRows.Count - 1; per_numb_s++) { if (fndTime &gt;= jTime) break; fndTime += Convert.ToDateTime(OldMonthRows[per_numb_s]["FinTime"]) - Convert.ToDateTime(OldMonthRows[per_numb_s]["StartTime"]); sftTime += Convert.ToDateTime(OldMonthRows[per_numb_s]["FinTime"]) - Convert.ToDateTime(OldMonthRows[per_numb_s]["StartTime"]) + TimeSpan.FromMinutes(Convert.ToInt32(OldMonthRows[per_numb_s]["TimeToNext"])); } sftTime += jTime - fndTime; } } return sftTime; }</span></span></code> </pre><br><br>  When using the above approach, one should understand that there is always a chance of failure, then the set of work will still need to be driven according to the standard scheme through planning, but in total time will be spent more.  In my case, the customer decided that it was better to suffer once out of ten than all ten by a little and the green light was given to the method. <br>  Even for purely visual acceleration, it is worth taking the whole calculation into a separate thread and pulling an event in it for each calculated time interval.  The client should sign up for the event and give the user results before the full completion of the calculation.  It will also be useful to display the progress bar so that the person behind the computer understands that everything is working, nothing is hanging and less nervous.  And if he works with a client (for example, when writing a car to a service center), then he has already voiced the first sentences for recording in the morning. <br>  I sincerely hope that the things described in my article will come in handy once.  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/148881/">https://habr.com/ru/post/148881/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148874/index.html">12 more ‚ÄúMySQL recipes‚Äù in Bitrix24</a></li>
<li><a href="../148875/index.html">Display of dependent data on the example of cascading drop-down lists</a></li>
<li><a href="../148876/index.html">Developing a social network on MODx Revolution</a></li>
<li><a href="../148879/index.html">‚ÄúSimple Business‚Äù - Organization management complex. Version 1.6.6.0</a></li>
<li><a href="../148880/index.html">Moving Google Chrome profile to another folder, nuances</a></li>
<li><a href="../148882/index.html">ASCII StreetView</a></li>
<li><a href="../148883/index.html">How to cheat the Corporation of Good or buy Nexus 7 in Russia without Google Play Store</a></li>
<li><a href="../148884/index.html">Embedding Code Inspections in the Development Process</a></li>
<li><a href="../148885/index.html">Reading the latest news feed on the news site that you visit daily, is it fundamentally for you to have the time of its publication next to the news headline?</a></li>
<li><a href="../148886/index.html">Class for playing audio from iOS apps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>