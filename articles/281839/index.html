<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The experience of automating difficult correspondence (Part 1. Incoming)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The experience of automating difficult correspondence (Part 1. Incoming) 
 I work as the head of the information technology department in the project ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The experience of automating difficult correspondence (Part 1. Incoming)</h1><div class="post__text post__text-html js-mediator-article">  The experience of automating difficult correspondence (Part 1. Incoming) <br>  I work as the head of the information technology department in the project organization in Tyumen.  A little more than a year ago, I was given the task to improve the process of managing official correspondence working at elma at that time. <br><img src="https://habrastorage.org/files/412/8a3/974/4128a3974bba4e198d05edd72d9c5294.png"><br>  Instead, elma was chosen easla.com system.  Under the cut a lot of text and code. <br><a name="habracut"></a><br>  First of all, a few general phrases about the process itself.  To the uninitiated, it seems simple and even unworthy of automation.  Actually, initially I thought the same.  However, when I listened to the groans of a paperworker - the main participant in the process, I listened to the demands of the chief engineer - the main consumer of the process, I realized that everything is not as simple as it seems.  It turned out that the timely sent letter can bring the organization six, and sometimes seven-figure profit! <br>  At one time, the process was automated using the elma system, but within one year of operation, it became clear that the system needed to be changed to something more flexible and responsive. <br>  So, the requirements for the new process were as follows (short list): <br><ul><li>  Registration of incoming and outgoing official letters </li><li>  Sending outgoing emails  mail </li><li>  Notification of interested parties about sending outgoing emails </li><li>  The ability to save versions of letters and collaborative development </li><li>  Tracking the process of preparing a response to an incoming letter </li></ul><br>  When thinking about the process, it became clear that by itself it could not exist.  It will take several related processes that will become suppliers of additional information: <br>  <b>Customers</b> - the process of managing contractors and contacts.  All letters are attached to the relevant counterparties and contacts. <br>  <b>Contracts</b> - the process of managing contracts.  All letters, in most cases, are tied to a specific contract or even to several. <br>  <b>Tasks</b> - the process of managing orders (tasks), allows you to track the execution of orders for each document.  Very serious process, it is better to tell about it separately.  He took over the tracking of the preparation of the response to the incoming letter. <br>  At that time I was already registered in the <a href="http://easla.com/">easla.com</a> system and successfully used it to manage other, less significant processes of the organization.  Therefore, without inventing anything special, I created a new process in the system.  He called it "Correspondence", afterwards in the process created the object "Incoming Document" and proceeded to fill it with attributes. <br><br><h4>  Attributes </h4><br>  The ‚ÄúIncoming Document‚Äù object has a whole bunch of attributes, each one needs to be told separately. <br><br><h5>  Recipient's registration number </h5><br>  The usual sequence number of the incoming document.  Numbering starts anew each year.  It was not possible to use a simple numerator to assign a sequence number, it is not able to reset the value every year, so the function was declared in the script ‚ÄúBefore the object was initialized‚Äù: <br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDocumentRegNum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $year = date_format(currentDateTime(), <span class="hljs-string"><span class="hljs-string">'Y'</span></span>); $num = selectAggregateAll( <span class="hljs-string"><span class="hljs-string">'max'</span></span>, <span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'crs_management_incoming'</span></span>, <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'between'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-01-01'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-12-31'</span></span>),) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $num + <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br>  The updateDocumentRegNum function is called from the ‚ÄúAt Initialization‚Äù attribute script: <br><pre> <code class="php hljs">cattributeref()-&gt;value = cobjectref()-&gt;updateDocumentRegNum();</code> </pre><br>  ‚ÄúWhen an attribute is changed‚Äù, the function updateDocumentFileName is called, which is responsible for updating the file name of the cover letter (not applications), but about it later. <br><pre> <code class="php hljs">cobjectref()-&gt;updateDocumentFileName();</code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Type of shipment </h5><br>  Classifier that determines the method of sending the incoming document to our address.  It can take the following values: <br><ul><li>  Al.  letter </li><li>  Paper letter </li><li>  Facsimile </li><li>  Submitted personally </li></ul><br>  In <a href="http://easla.com/">easla.com it</a> is possible to store constants in hierarchically ordered classifiers.  Very convenient, avoids the need to store arrays or constants in the code describing an object or attribute. <br>  The ‚ÄúAt Initialization‚Äù attribute script returns a list of nested classifiers, processes them and assigns a list of valid attribute values: <br><pre> <code class="php hljs">$src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'crs_method'</span></span>); $end_classificators = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) $end_classificators += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$c[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($end_classificators) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_method'</span></span>)-&gt;values=$end_classificators; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_method'</span></span>)-&gt;value = key($end_classificators); }</code> </pre><br>  Personally, I liked that the list of acceptable values ‚Äã‚Äãcan be formed so simply.  For example, in elma, this was much more difficult. <br><br><h5>  Counterparty </h5><br>  Link to the ‚ÄúCounterparty‚Äù object from the ‚ÄúCustomers‚Äù process.  In order to obtain a list of available counterparties, the auxiliary function prepareIncomingContragents was declared in the ‚ÄúBefore object initialization‚Äù object script: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareIncomingContragents</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $src_contragents = selectAll( <span class="hljs-string"><span class="hljs-string">'crm_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'crm_management_contragent'</span></span> ); $end_contragents = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_contragents <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $s) $end_contragents += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($s[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; $s[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); asort($end_contragents); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $end_contragents; }</code> </pre><br>  The selectAll function selects all the objects ‚Äúcrm_management_contragent‚Äù from the process ‚Äúcrm_management‚Äù without any conditions, processes and returns as the result of the function. <br>  Attribute initialization occurs in the ‚ÄúAfter object initialization‚Äù object script: <br><pre> <code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;values = prepareIncomingContragents();</code> </pre><br>  I pay attention that not in the attribute itself, but in the object.  So, too, can be.  Sometimes just such a decision can make a big difference. <br>  The choice of the counterparty by the user should lead to a change in the list of available contacts and contracts.  The list of available contacts and contracts is formed in the ‚ÄúAt Change‚Äù attribute script: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cattributeref()-&gt;value)) { $contacts = cobjectref()-&gt;prepareIncomingContacts(cattributeref()-&gt;value); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contact'</span></span>)-&gt;values = $contacts; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_performers'</span></span>)-&gt;values = $contacts; $contracts = cobjectref()-&gt;prepareContracts(cattributeref()-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($contracts)) $contracts = cobjectref()-&gt;prepareContracts(); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contract'</span></span>)-&gt;values = $contracts; }</code> </pre><br>  The auxiliary functions declared in the ‚ÄúAt Initialization‚Äù object script are used: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareIncomingContacts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($contragent = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($contragent)) $src_contacts = selectAll( <span class="hljs-string"><span class="hljs-string">'crm_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'crm_management_contact'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'crm_management_contact_contragent.description'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> <span class="hljs-comment"><span class="hljs-comment">// array('with'=&gt;'title') ); else $src_contacts = selectAll( 'crm_management', 'crm_management_contact', array('crm_management_contact_contragent.description'), array('crm_management_contact_contragent'=&gt;$contragent) ); $end_contacts = array(); $processed_contact = array(); $processed_description = array(); foreach ($src_contacts as $s) { $e = array_search($s['description'], $processed_description); if($e === false) { $processed_contact += array($s['id'] =&gt; $s); $processed_description += array($s['id'] =&gt; $s['description']); $end_contacts += array($s['id'] =&gt; $s['description']); } else { $end_contacts[$e] = $processed_contact[$e]['description'].' ['.trim($processed_contact[$e]['crm_management_contact_contragent.description']).']'; $end_contacts += array($s['id'] =&gt; $s['description'].' ['.trim($s['crm_management_contact_contragent.description']).']'); } } unset($processed_contact,$processed_description); asort($end_contacts); return $end_contacts; }</span></span></code> </pre><br>  The function is a good example of why a script description of behavior is better than a ‚Äúclicked‚Äù mouse.  In this case, the trick is that the list of contacts can meet full namesake, i.e.  surname, name and patronymic can be completely matched.  To distinguish one from another in the generated list will be unrealistic.  Therefore, the function scans the entire list of contacts, finds the same and assigns to them the names of the organizations in which they work.  Of course, theoretically, in the same organization, full namesakes can also work, but so far this situation has never arisen. <br>  In addition, an auxiliary function is used to generate a list of contracts: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareContracts</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($contragent = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($contragent)) $src_contracts = selectAll( <span class="hljs-string"><span class="hljs-string">'agr_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'agr_management_contract'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $src_contracts = selectAll( <span class="hljs-string"><span class="hljs-string">'agr_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'agr_management_contract'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'agr_management_contract_contragent'</span></span>=&gt;$contragent) ); $end_contracts = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_contracts <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $s) $end_contracts += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($s[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; $s[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); asort($end_contracts); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $end_contracts; }</code> </pre><br>  There is only one trick in it, in order not to limit the user in choosing contracts, unless the counterparty is specified in the letter, all contracts are available, otherwise, only contracts with the specified counterparty.  This solution reduces the probability of error to almost zero. <br><br><h5>  Contact </h5><br>  Reference to the object "Contact" in the process "Customers".  All the auxiliary functions necessary for the initialization of attribute values ‚Äã‚Äãare described above, therefore, it remains only to add that the attribute is initialized in the ‚ÄúAfter object initialization‚Äù object script (following the initialization of the list of contractors): <br><pre> <code class="php hljs">$contacts = prepareIncomingContacts(); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contact'</span></span>)-&gt;values = $contacts;</code> </pre><br>  By the way, the user, when filling in the form of an incoming letter, may not indicate the counterparty, but immediately indicate the desired contact.  The system will determine its counterparty and substitute the value.  It was possible to implement such a trick in the ‚ÄúAt Change‚Äù attribute script: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contact'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;value)) { $contact = select(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contact'</span></span>)-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($contact)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; $contragent_id = $contact-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crm_management_contact_contragent'</span></span>)-&gt;value; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;value = $contragent_id; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_performers'</span></span>)-&gt;values = cobjectref()-&gt;prepareIncomingContacts($contragent_id); $contracts = cobjectref()-&gt;prepareContracts($contragent_id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($contracts)) $contracts = cobjectref()-&gt;prepareContracts(); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contract'</span></span>)-&gt;values = $contracts; }</code> </pre><br>  In addition to the definition of the counterparty, the list of available contracts is updated. <br><br><h5>  Performers </h5><br>  Reference to the object "Contact" in the process "Customers".  Designed to store information about who exactly developed the letter on the side of the customer.  This is such a short postscript at the end of the letter, they say he performed such and such.  By the way, there are several performers, so the attribute is multiple.  Allows you to save not one, but a whole list of performers.  The attribute is also initialized in the ‚ÄúAfter object initialization‚Äù object script: <br><pre> <code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_performers'</span></span>)-&gt;values = $contacts;</code> </pre><br><br><h5>  departure date </h5><br>  Actually, it stores the date of departure of the incoming letter, which the clerk takes from the document.  It is important to know when the letter was sent and when it was received.  Often these dates are the same in our fast 21st century, so for ease of filling, the attribute is assigned the current date and time in the ‚ÄúAt Initialization‚Äù script: <br><pre> <code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_date'</span></span>)-&gt;value = currentDateTime();</code> </pre><br><br><h5>  Sender's registration number </h5><br>  As the name of the attribute suggests, it is intended to store the registration number of the input.  letters assigned by the sender.  An important attribute, because  Both parties are often guided when searching for a letter by this particular registration number, and not by the recipient's registration number described above.  However, it also happens that reg.  the sender's number is missing altogether, so initially the attribute is assigned ‚Äúb / n‚Äù in the ‚ÄúAt Initialization‚Äù script: <br><pre> <code class="php hljs">cattributeref()-&gt;value = <span class="hljs-string"><span class="hljs-string">'/'</span></span>;</code> </pre><br><br><h5>  date of receiving </h5><br>  Obviously, stores the date of receipt of the incoming letter.  As well as the date of departure, the current date and time in the "At Initialization" script is assigned: <br><pre> <code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>)-&gt;value = currentDateTime();</code> </pre><br>  But ‚ÄúWhen changing‚Äù the attribute value, the file name is updated using the updateDocumentFileName function: <br><pre> <code class="php hljs">cobjectref()-&gt;updateDocumentFileName();</code> </pre><br><br><h5>  Date of receipt of the original </h5><br>  The next date is often left blank.  The attribute is intended to store the date of receipt of the original letter, which was received in advance in another way. <br><br><h5>  Notify the receipt of the original </h5><br>  At the initial development of the object of this attribute was not.  He appeared a few weeks after the start of operation.  The meaning of its existence is to know whether it is necessary to notify interested parties about the arrival of the original incoming letter or not.  In addition, if the alert was sent, the attribute changes the value to Notified. <br>  In <a href="http://easla.com/">easla.com, a</a> list of predefined attribute values ‚Äã‚Äãcan be formed even by a simple array.  Just like that, I added a list with three possible values ‚Äã‚Äãin the ‚ÄúAt Initialization‚Äù attribute script: <br><pre> <code class="php hljs">cattributeref()-&gt;values = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cattributeref()-&gt;value)) cattributeref()-&gt;value = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br><br><h5>  Theme </h5><br>  Actually, the subject of the letter.  With it, everything is clear, the usual text field in which the clerk writes the subject of the letter taken from the document.  Attribute has no special behavior, only indicated that it can be multi-line. <br><br><h5>  Type of Content </h5><br>  Classifier, allowing to determine the type of content of the letter.  The list of possible values ‚Äã‚Äãis stored as well as the type of shipment.  In total, we use about 25 types of content, here are some of them: <br><ul><li>  Responses to comments </li><li>  Source Data Request </li><li>  The issuance of source data </li><li>  Regulation </li><li>  Confirmation of technical capability </li><li>  Coordination within the framework of architectural supervision, etc. </li></ul><br>  The list of acceptable values ‚Äã‚Äãis formed similarly to the ‚ÄúType of shipment‚Äù attribute: <br><pre> <code class="php hljs">$src_classificators = classificatorChilds(<span class="hljs-string"><span class="hljs-string">'crs_content'</span></span>); $end_classificators = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_classificators <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $c) { $end_classificators += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$c[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($c[<span class="hljs-string"><span class="hljs-string">'code'</span></span>] == <span class="hljs-string"><span class="hljs-string">'crs_content_other'</span></span>) $default = $c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($end_classificators) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_content'</span></span>)-&gt;values=$end_classificators; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_content'</span></span>)-&gt;value = <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($default) ? $default : $c[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }</code> </pre><br><br><h5>  To whom </h5><br>  User (employee) of the organization to which the official letter is sent.  In our case, the letters come only to senior management and chief project engineers (GUIs).  Thus, I needed to limit the list of available users.  The values ‚Äã‚Äãare initialized again in the ‚ÄúAt Initialization‚Äù attribute script: <br><pre> <code class="php hljs">$src_users = corganization()-&gt;allUsersByGroups(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'group_general_manager'</span></span>, <span class="hljs-string"><span class="hljs-string">'group_general_engineer'</span></span>, <span class="hljs-string"><span class="hljs-string">'group_general_manager_operations'</span></span>, <span class="hljs-string"><span class="hljs-string">'group_gip'</span></span>, <span class="hljs-string"><span class="hljs-string">'group_general_manager_economics'</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); $end_users = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($u[<span class="hljs-string"><span class="hljs-string">'islocked'</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>) $end_users += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$u[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); asort($end_users); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_to'</span></span>)-&gt;values = $end_users;</code> </pre><br>  The clever function allUsersByGroups can return an array of users belonging to specified groups.  She is able to exclude users from an array.  In general, in my case, without complex filters, I got all the necessary users, processed and assigned attribute values. <br>  A letter may be forwarded to another employee, but just in case, the ‚ÄúWhen a Change‚Äù script initially installs the same employee: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;value)) { cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;value = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_to'</span></span>)-&gt;value; }</code> </pre><br><br><h5>  Redirect </h5><br>  Probably, in half of the cases, the letter addressed to the general director should actually be sent for consideration not to him, but to his deputy or chief engineer, since  carry a purely technical content.  Therefore, the incoming letter at registration is sent to the employee responsible for solving the issues described in the letter. <br>  The list of available users is formed in the ‚ÄúAt Initialization‚Äù attribute script: <br><pre> <code class="php hljs">$src_users = corganization()-&gt;allUsers(); $end_users = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($src_users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $u) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($u[<span class="hljs-string"><span class="hljs-string">'islocked'</span></span>] == <span class="hljs-number"><span class="hljs-number">0</span></span>) $end_users += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]=&gt;$u[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); asort($end_users); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;values = $end_users;</code> </pre><br><br><a name="incoming1"></a><h5>  In response to the outgoing </h5><br>  Link to the outgoing document of the same process.  A very important attribute, because  allows you to chain all incoming and outgoing letters and track it if necessary.  In the script ‚ÄúBefore the object is initialized,‚Äù the auxiliary function prepareOutgoings is written, which generates a list of all outgoing emails: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareOutgoings</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $src_documents = selectAll( <span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>, <span class="hljs-string"><span class="hljs-string">'crs_management_outgoing'</span></span> ); $end_documents = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($src_documents <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $d) $end_documents += <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($d[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] =&gt; $d[<span class="hljs-string"><span class="hljs-string">'description'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $end_documents; }</code> </pre><br>  It is called ‚ÄúAt initialization‚Äù attribute: <br><pre> <code class="php hljs">$outgoings = cobjectref()-&gt;prepareOutgoings(); $outgoings = array_reverse($outgoings, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); asort($outgoings); cattributeref()-&gt;values = $outgoings;</code> </pre><br>  The attribute is multiple, so an incoming letter can be registered as a reply to several of our letters at once. <br><br><a name="incoming2"></a><h5>  Contract </h5><br>  Reference to the object "Contract" in the process "Contracts".  Another important attribute that allows to classify letters under contracts, which simplifies the search and formation of reports in the future.  The attribute is multiple, which makes it possible to attribute an incoming letter to several contracts at once.  This happens quite often. <br>  Auxiliary functions for initializing attribute values ‚Äã‚Äãhave been described above, so I will only indicate that its values ‚Äã‚Äãare formed in the ‚ÄúAfter an object is initialized‚Äù script, following the initialization of executors: <br><pre> <code class="php hljs">cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contract'</span></span>)-&gt;values = prepareContracts();</code> </pre><br><br><h5>  Document </h5><br>  It is in this attribute that the file of the incoming document is stored.  The attribute is <u>not</u> multiple, which forces you to store only one file in it, and in no case, not several. <br>  After uploading the file to the form, it is automatically renamed using the ‚ÄúWhen Modified‚Äù attribute script: <br>  cobjectref () -&gt; updateDocumentFileName (); <br>  Renaming uses the helper function updateDocumentFileName described in the ‚ÄúBefore an object is initialized‚Äù script: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateDocumentFileName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $desc = calcIncomingDesc(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($desc)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; $files = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_document'</span></span>)-&gt;availableFiles(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($files <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $f) { $nowname = sprintf( <span class="hljs-string"><span class="hljs-string">'%s.%s'</span></span>, $desc, pathinfo($f-&gt;nowname, PATHINFO_EXTENSION) ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strcmp($nowname, $f-&gt;nowname) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; $f-&gt;nowname = $nowname; $f-&gt;save(); } }</code> </pre><br>  The new file name is formed from the object description, which, in turn, is formed using the calcIncomingDesc function (about it later). <br><br><h5>  Applications </h5><br>  Along with the official incoming letter, application files can also be received.  There may be many of them and they may be of various formats, therefore the attribute is multiple and does not limit the format of the downloaded files. <br>  By the way, I will mention that the ability to store files in different attributes independently became one of the main reasons for using <a href="http://easla.com/">easla.com</a> to manage correspondence.  I have not yet encountered such a system that would handle files as well as ordinary attributes. <br><br><h5>  The sender is notified of the transfer letter </h5><br>  An interesting attribute that reflects the fact of sending a notification to the sender that his letter was submitted for consideration.  It was added at the request of the clerk who complained that she regularly had to answer calls from the customer with a request to indicate whether the letter reached the addressee or not.  As a result, the attribute and automatic sending of the corresponding notification to the sender appeared. <br>  An attribute can take one of three values ‚Äã‚Äãand initially it is, of course, equal to "No": <br><pre> <code class="php hljs">cattributeref()-&gt;values = <span class="hljs-keyword"><span class="hljs-keyword">arraY</span></span>(<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>,<span class="hljs-string"><span class="hljs-string">''</span></span>); cattributeref()-&gt;value = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  In that case, if the send notification failed, for example, no email was specified.  contact address, then after the transfer of ix.  the letter of consideration attribute will take the value "Impossible".  But this is rare.  In most cases, the notification is successfully sent and the attribute is set to "Yes". <br>  I remember the reaction of some customers to the appearance of such a notice.  They were just thrilled.  I did not even think that such a trifle could cause such a violent positive reaction! <br><br><h4>  An object </h4><br>  One of the interesting requirements was to ‚Äúcolor‚Äù the status of incoming letters to increase visibility. <br><img src="https://habrastorage.org/files/368/c4c/508/368c4c5082f84adcbb1035270d6f9dc3.png"><br><br>  In <a href="http://easla.com/">easla.com, it is</a> enough to add this to the ‚ÄúAfter object initialization‚Äù script, this code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (cobjectref()-&gt;status-&gt;code) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_created'</span></span>: cobjectref()-&gt;status-&gt;state = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_handed'</span></span>: cobjectref()-&gt;status-&gt;state = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_exec'</span></span>: cobjectref()-&gt;status-&gt;state = <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_ok'</span></span>: cobjectref()-&gt;status-&gt;state = <span class="hljs-number"><span class="hljs-number">4</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; }</code> </pre><br>  You can assign up to 9 colors.  All colors of the rainbow are from 1 to 7. White - 8. Black - 9. <br>  By the way, in order for an object to receive a description (initially it is empty), an auxiliary function was written in the script ‚ÄúBefore an object is initialized‚Äù: <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcIncomingDesc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; $d = date_create(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>)-&gt;value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sprintf( <span class="hljs-string"><span class="hljs-string">'%s  %s'</span></span>, cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>)-&gt;value, localeFormatDate($d) ); }</code> </pre><br>  Which was called in the ‚ÄúBefore saving an object‚Äù script: <br><pre> <code class="php hljs">cobjectref()-&gt;description = calcIncomingDesc();</code> </pre><br>  In addition, before saving the object, the status is changed and the registration number assigned at the time of creation is changed.  I really missed this opportunity in elma, it first saves the object, and then ... then it's too late! <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;status-&gt;code == <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_create'</span></span>) { cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_created'</span></span>; cobjectref()-&gt;flags = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cobjectref()-&gt;flags = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;isNewRecord &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>)-&gt;value) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;value)) { $year = date_format(date_create(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'Y'</span></span>); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>=&gt;cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>)-&gt;value, <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_date'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'between'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-01-01'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-12-31'</span></span>), ); $exist = selectCountAll(<span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'crs_management_incoming'</span></span>,$conditions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($exist) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'  , ..     .  '</span></span>.cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_regnum'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">'   '</span></span>.$year.<span class="hljs-string"><span class="hljs-string">' !'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;isNewRecord &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)-&gt;value) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_date'</span></span>)-&gt;value) &amp;&amp; cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)-&gt;value != <span class="hljs-string"><span class="hljs-string">'/'</span></span>) { $year = date_format(date_create(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_date'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'Y'</span></span>); $conditions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'strict'</span></span>,cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span>,cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent'</span></span>)-&gt;value), <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_date'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'between'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-01-01'</span></span>, $year.<span class="hljs-string"><span class="hljs-string">'-12-31'</span></span>), ); $exist = selectCountAll(<span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'crs_management_incoming'</span></span>,$conditions); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($exist) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'  , ..     .   '</span></span>.cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">'   '</span></span>.$year.<span class="hljs-string"><span class="hljs-string">' !'</span></span>); }</code> </pre><br>  In the end, this is the form of the incoming document: <br><img src="https://habrastorage.org/files/16e/502/597/16e50259708d47e1ae55318ddc0baeaf.png"><br><br><h4>  Statuses </h4><br>  Having dealt with the object and its attributes, I was puzzled by statuses.  In <a href="http://easla.com/">easla.com</a> there are three types of statuses: initial, normal and final.  The initial object is assigned at the time of creation, i.e.  when the object has not yet been saved and the form for creating the object is open.  The final one blocks any attempts to change the object, although it can be circumvented by using actions. <br>  After a short discussion, it came together on the following statuses of the incoming document: <br>  <b>Registration</b> - initial status <br>  <b>Registered</b> - assigned immediately after registration <br>  <b>Sent to addressee</b> - assigned after sending a "forwarding" letter demanding to consider the document <br>  <b>Considered</b> - assigned after assigning tasks to prepare an answer (tasks are executed in the adjacent ‚ÄúTasks‚Äù process) <br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Canceled</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - assigned if the letter needs to be canceled. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this stage it was already possible to breathe easier. </font><font style="vertical-align: inherit;">It was necessary to show the form to the clerk, as </font><font style="vertical-align: inherit;">she was the one who had to work with her most of the time. </font><font style="vertical-align: inherit;">We created one object with it. </font><font style="vertical-align: inherit;">Have a look what happened. </font><font style="vertical-align: inherit;">In general, I received from her a positive response and a bunch of wishes.</font></font><br><br><h4>  Actions </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><a href="http://easla.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easla.com,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> an object </font><a href="http://easla.com/"><font style="vertical-align: inherit;">can</font></a><font style="vertical-align: inherit;"> be transferred from one status to another only by action. </font><font style="vertical-align: inherit;">An action is a button below the object form that executes the script in the context of the object.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For consideration </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Translates the object from the ‚ÄúRegistered‚Äù status to ‚ÄúTransferred to the addressee‚Äù and sends a letter to the ‚Äúredirector‚Äù with a request to consider the incoming document. </font><font style="vertical-align: inherit;">The action script turned out simple:</font></font><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">"  !"</span></span>); $forwardto = corganization()-&gt;user(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;value); $groups = $forwardto-&gt;groups(); $isgip = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($groups <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $group) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (strncmp($group[<span class="hljs-string"><span class="hljs-string">'data_one'</span></span>],<span class="hljs-string"><span class="hljs-string">'09.'</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $isgip = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isgip) $to = $group-&gt;users(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $to = $forwardto; cobjectref()-&gt;description = cobjectref()-&gt;calcIncomingDesc(); cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_handed'</span></span>; sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'from'</span></span>=&gt;cuser(), <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;$to, <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;description.<span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' !    .'</span></span>, <span class="hljs-string"><span class="hljs-string">'objects'</span></span>=&gt;cobjectref(), <span class="hljs-string"><span class="hljs-string">'roles'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'crs_management_all'</span></span>, ));</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The peculiarity of the action is sending not one, but several letters in the event that the incoming document is redirected to the ISU. </font><font style="vertical-align: inherit;">GIPs themselves asked to send a copy of the letter to the address of their assistant, because </font><font style="vertical-align: inherit;">they may be engaged in other work or are on a business trip and the letter will ‚Äúhang‚Äù indefinitely. </font><font style="vertical-align: inherit;">Of course, it was clear that the GUIs are cunning, they could easily deal with the letter even remotely, but it‚Äôs pointless to enter into an argument with them. </font><font style="vertical-align: inherit;">Therefore, after coordinating the decision with the top management, I implemented sending a copy of the letter to the GIP assistant (we call them ‚Äúhypits‚Äù).</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add task </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The service team allows you to create a task with an incoming letter at the base for opening. </font></font><br><pre> <code class="php hljs">$subj = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_subj'</span></span>)-&gt;value)) $subj = $subj.(strlen($subj) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-string"><span class="hljs-string">' '</span></span> : <span class="hljs-string"><span class="hljs-string">''</span></span>).cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_subj'</span></span>)-&gt;value; $new_task = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_task-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'tsk_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'tsk_task'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contract'</span></span>)-&gt;value)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_contract'</span></span>)-&gt;value = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contract'</span></span>)-&gt;value[<span class="hljs-number"><span class="hljs-number">0</span></span>]; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_subj'</span></span>)-&gt;value = $subj; $category = classificator(<span class="hljs-string"><span class="hljs-string">'task_category_answer'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($category)) $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_category'</span></span>)-&gt;value = $category-&gt;id; $new_task-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'tsk_task_base_open'</span></span>)-&gt;value = cobjectref()-&gt;id; caction()-&gt;redirect = urlNewObjectref($new_task);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is useful when the incoming solution has already been considered, but someone forgot to set a task for someone. </font><font style="vertical-align: inherit;">It is most convenient to create it with the help of this command.</font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Reviewed by </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is used in the case when the incoming document does not require the creation of tasks and should only change the status. </font><font style="vertical-align: inherit;">Easier you can think of:</font></font><br><pre> <code class="php hljs">cobjectref()-&gt;status = <span class="hljs-string"><span class="hljs-string">'crs_management_incoming_ok'</span></span>;</code> </pre><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add contact... </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In </font></font><a href="http://easla.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">easla.com, it</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is possible to bind actions to object attributes. </font><font style="vertical-align: inherit;">Such actions differ from the usual ones in that they are displayed not at the bottom of the object form, but next to the specified attribute. </font><font style="vertical-align: inherit;">And I, as an administrator, can choose which side to place the button: top, bottom, left, right. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The point of entry for correspondence is a clerical specialist, so she regularly faces the need to register new contractors and contacts. </font><font style="vertical-align: inherit;">Sometimes it is found that the missing contact is not in the list, and the form with the incoming document is almost full. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, I created a service function for it, which opens a new tab in the browser and allows you to add a new contact with just four lines of code:</font></font><br><pre> <code class="php hljs">$new_contact = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_contact-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'crm_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'crm_management_contact'</span></span>)); caction()-&gt;target = <span class="hljs-string"><span class="hljs-string">'_blank'</span></span>; caction()-&gt;redirect = urlNewObjectref($new_contact);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Of course, the action is tied to the attribute "Contact". </font></font><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add business partner ... </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> By analogy, created an action for creating a new counterparty and tied it to the "Counterparty" attribute. </font></font><br><pre> <code class="php hljs">$new_contact = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_contact-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'crm_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'crm_management_contragent'</span></span>)); caction()-&gt;target = <span class="hljs-string"><span class="hljs-string">'_blank'</span></span>; caction()-&gt;redirect = urlNewObjectref($new_contact);</code> </pre><br><br><h5>  Reply </h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestly, I somehow did not immediately think of this action, although the need for it was felt immediately. </font><font style="vertical-align: inherit;">Indeed, in every mailer there is a button ‚ÄúAnswer‚Äù, which creates an outgoing letter and fills in two fields: to whom and the subject. </font><font style="vertical-align: inherit;">But it's good when only 2 fields need to be filled out, you can also create outgoing without a service team, and when we have 19 attributes and almost everything needs to be filled in to send an outgoing letter, the action is simply irreplaceable! </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It seemed to me that I would face difficulties, but everything turned out to be simpler than I thought:</font></font><br><pre> <code class="php hljs">$new_outgoing = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Objectref(); $new_outgoing-&gt;prepare(objectDef(<span class="hljs-string"><span class="hljs-string">'crs_management'</span></span>,<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing'</span></span>)); $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_contragent'</span></span>)-&gt;value = cobjectref()-&gt;crs_management_incoming_contragent; $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_contact'</span></span>)-&gt;value = cobjectref()-&gt;crs_management_incoming_contact; $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_recipients'</span></span>)-&gt;value = cobjectref()-&gt;crs_management_incoming_performers; $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_responsibleuser'</span></span>)-&gt;value = cobjectref()-&gt;crs_management_incoming_forwardto; $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_incomingdocs'</span></span>)-&gt;value = cobjectref()-&gt;id; $new_outgoing-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_outgoing_contract'</span></span>)-&gt;value = cobjectref()-&gt;crs_management_incoming_contract; caction()-&gt;redirect = urlNewObjectref($new_outgoing);</code> </pre><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Notify the receipt of the original </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remember the attribute "notify the receipt of the original"? </font><font style="vertical-align: inherit;">That's it for this action, he was added. </font><font style="vertical-align: inherit;">When a clerk gets the original document, it causes this action and all!</font></font><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_original_date'</span></span>)-&gt;value)) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'    !'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_original_flag'</span></span>)-&gt;value != <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'      '</span></span>); $forwardto = cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_forwardto'</span></span>)-&gt;value; sendEmail(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'from'</span></span>=&gt;cuser(), <span class="hljs-string"><span class="hljs-string">'to'</span></span>=&gt;corganization()-&gt;user($forwardto), <span class="hljs-string"><span class="hljs-string">'subj'</span></span>=&gt;cobjectref()-&gt;description.<span class="hljs-string"><span class="hljs-string">'  '</span></span>, <span class="hljs-string"><span class="hljs-string">'body'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">' !     '</span></span>.cobjectref()-&gt;viewLink().<span class="hljs-string"><span class="hljs-string">' ['</span></span>.cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_contragent_regnum'</span></span>)-&gt;value.<span class="hljs-string"><span class="hljs-string">']'</span></span> )); cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_receive_original_flag'</span></span>)-&gt;value = <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br><h5><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Roles </font></font></h5><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, it was at this stage that I remembered that I needed to decide on roles and access rights! </font><font style="vertical-align: inherit;">There is such a bad trait in me, to do everything first, and then only to think who should not be given what has been done. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There was a very stormy dialogue with the CEO, and then with the chief engineer, from which I took the need to create the following roles:</font></font><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> All employees </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Top management </font></font></li><li>  Accounting </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Chief Project Engineers </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Clerk </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Project Office </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This is how the access rights to the incoming document were distributed. </font></font><br><img src="https://habrastorage.org/files/554/a42/32f/554a4232f78d49ffbef6232474c3b537.png"><br>  But that's not all.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Our incoming documents need to be very selectively assigned access rights in accordance with the value of the "Content Type" attribute. </font><font style="vertical-align: inherit;">In general, in the ‚ÄúAfter saving an object‚Äù script, added the assignment of rights to the newly saved object:</font></font><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_content'</span></span>)-&gt;value)) { $c = classificator(cobjectref()-&gt;attributeref(<span class="hljs-string"><span class="hljs-string">'crs_management_incoming_content'</span></span>)-&gt;value); <span class="hljs-comment"><span class="hljs-comment">// if ($c-&gt;code == 'crs_content_claim') { cobjectref()-&gt;addRolesPermissions(array( 'crs_management_tops', 'crs_management_buh', 'crs_management_gip', 'crs_management_dp', 'crs_management_pmo', )); } // //, ,  elseif (in_array($c-&gt;code, array('crs_content_ruling','crs_content_review','crs_content_decision'))) { cobjectref()-&gt;addRolesPermissions(array( 'crs_management_tops', 'crs_management_buh', 'crs_management_dp', 'crs_management_gip', )); } }</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As can be seen from the code, the number of roles is even redundant, but I did not reduce their number just in case. </font><font style="vertical-align: inherit;">Suddenly, they will ask for unique rights for some particular type of content tomorrow.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bye all </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">About setting up the object "Outgoing object" in the </font></font><a href="https://habrahabr.ru/company/easla/blog/281999/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">next part</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Thanks to everyone who read to this place. </font><font style="vertical-align: inherit;">I hope everyone found something useful for themselves. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS The ‚ÄúIncoming Document‚Äù object described above is fully implemented in the process published for all </font></font><a href="https://easla.com/ru/process/infoAlone/process_id/159"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Correspondence</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">Borrowing the process you can not lose time writing the same amount, albeit simple, code.</font></font></div><p>Source: <a href="https://habr.com/ru/post/281839/">https://habr.com/ru/post/281839/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281825/index.html">Cloud - the future you have created</a></li>
<li><a href="../281827/index.html">Laravel Timestamp Validator</a></li>
<li><a href="../281829/index.html">IL2CPP: Tips on debugging generated code</a></li>
<li><a href="../281835/index.html">RUVDS will provide the VDS server to the participants of the annual exchange competition "Algorithmus"</a></li>
<li><a href="../281837/index.html">Local positioning technology. Part I</a></li>
<li><a href="../281841/index.html">Tarantool vs. Microsoft Azure Comparison</a></li>
<li><a href="../281845/index.html">Stack Overflow Habit</a></li>
<li><a href="../281847/index.html">How I suffered, raising LTSP with a third-party TFTP server</a></li>
<li><a href="../281849/index.html">Open Server-status in the Electronic Government of Kazakhstan or how to get a database of citizens</a></li>
<li><a href="../281851/index.html">Make a UI plug-in in IntelliJ Idea "like a maven'a"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>