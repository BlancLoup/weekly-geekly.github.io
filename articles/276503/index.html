<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to catch a virus in the password-protected archive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having read the rattlersnake article . Does your antivirus catch password-protected archives? I went from unbelief to doubt to disappointment and back...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to catch a virus in the password-protected archive</h1><div class="post__text post__text-html js-mediator-article">  Having read the <a href="https://habrahabr.ru/users/rattlersnake/" class="user_link">rattlersnake</a> article <a href="https://habrahabr.ru/users/rattlersnake/" class="user_link">.</a> <a href="https://habrahabr.ru/post/276347/">Does your antivirus catch password-protected archives?</a>  I went from unbelief to doubt to disappointment and back to understanding. <br><br><img src="https://habrastorage.org/files/8bc/7f4/149/8bc7f4149e2a402992b41f36fe6e65b2.jpg"><br><br>  As is quite correctly noted in the comments, retrieving the contents of a password-protected archive without knowing the password is impossible, therefore, verification is also impossible.  But does this mean that virus detection is impossible?  As it seems to me, I figured out why this is possible and why this method has the right to life. <br><a name="habracut"></a><br>  The desire to check the correctness of the situation described in the article and find out how this is possible led me to conduct a small experiment. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The checked info.exe file was found from a <a href="https://www.virustotal.com/en/file/27dd9d1f6f8fc50d8dd21528170bb38111b3f27cdbf58469d8a9fa6f8a078a44/analysis/1443592913/">hash with VirusTotal</a> and packed with WinRar archiver in three archives: zip, rar and rar version 5. <br><br>  A complex password was set on all archives in order to exclude its selection by the antivirus or the use of standard passwords.  To my surprise, the Fortinet antivirus worked on <a href="https://www.virustotal.com/en/file/81dbbfe4eb69381e177adbaa3a23a635d0ffcc759765ae1119af081d0d3580f9/analysis/">zip</a> and <a href="https://www.virustotal.com/en/file/830b70acd0936cdbdb5906a14ab0c4bf45b2f7b19e48757aa508c2086d35669a/analysis/">rar</a> archives, but did not work on <a href="https://www.virustotal.com/en/file/7b8d8e0a39328f312ed5d2e43062b05c0a26629a51f70dd89e4c89630ef57321/analysis/">rar5</a> ! <br><br><img src="https://habrastorage.org/files/dba/6ff/158/dba6ff15800046c3b0f19ae38f13f2df.png"><br><br>  In the comments to the article there was a version that this is ‚Äúfalse positive, false positive‚Äù.  But this version is implausible, since this false positive produces the same detector as the unpacked virus.  Moreover, when using different passwords, the resulting archive should be significantly different.  Some other mechanism should work here, but which one? <br><br>  Trying to understand what affects the operation of the antivirus, I changed one byte in the file and again packed it into the archives with a password.  After checking, another surprise was waiting for me - although the virus detection in the archive disappeared <a href="https://www.virustotal.com/en/file/c1b7f63cb6a601a064b1b38b6056855de8fe530632f9ae271c9dba32ad6bd25c/analysis/">(0/53)</a> , the detection by this antivirus and the unpacked file disappeared, although most other antiviruses continued to see it <a href="https://www.virustotal.com/en/file/1ca1728c0cdc1cfe17ae3d05e3e0087fd10c59f0a9898f6de7b25fe3a59589f7/analysis/">(35/52)</a> ! <br><br>  And then a great idea came to my mind: <br><br><ul><li>  We look at what properties of the file are available in the archive - and see the CRC32 checksum: <br><br><img src="https://habrastorage.org/files/20a/044/fb6/20a044fb6ffe4b0d80baf3351085e5ab.png"><br><br></li><li>  Create an empty file of the same size, for example, using the fsutil file command createnew info.exe 450362 </li><li>  We customize its CRC32 to the value of the original file (for example, py.exe <a href="http://www.nayuki.io/page/forcing-a-files-crc-to-any-value">forcecrc32.py</a> info.exe 0 76718968) or simply setting the value of the first four bytes to 67 EE C6 57: <br><br><img src="https://habrastorage.org/files/61e/997/9ab/61e9979ab5824939b2609e1885ca8b23.png"><br><br></li><li>  We pack it in archive with the password and we check CRC32 - matches </li><li>  Checking the resulting archive on VirusTotal </li></ul><br>  Bingo!  Fortinet now believes that a virus is in the archive <a href="https://www.virustotal.com/en/file/c5485e4dc36c8d54ef80abd1c21fe3efb6fc312e815d308ba93f2ee8d67ae8df/analysis/">(1/52)</a> . <br><br><img src="https://habrastorage.org/files/a55/f9f/6ba/a55f9f6baa9e4c11a2e80aa1667c2fe4.png"><br><br>  We check just in case the resulting exe file - and see a strange <a href="https://www.virustotal.com/en/file/250a37d1b2a3bb962dc91b1ecda70112347c02add21b6bfef5b2d7f7a7b73ea6/analysis/">result</a> - Fortinet continues to find a virus in the file.  It looks like he detects it exclusively on CRC32! <br><br><img src="https://habrastorage.org/files/4df/c8d/d99/4dfc8dd994144f7d9eb585c650416ef9.png"><br><br>  Yes, it seems that miracles do not happen and the real virus detection in the password-protected archive is impossible. <br><br>  On the other hand, given that Fortinet is engaged in software and hardware systems for network security, and the goal is not to miss a letter with a malicious attachment, then this approach has the right to life. <br><br>  If we know the CRC32 of a malicious file, it will not be superfluous to warn the user when such a file is found in the archive with a password. </div><p>Source: <a href="https://habr.com/ru/post/276503/">https://habr.com/ru/post/276503/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../276493/index.html"># Little good news</a></li>
<li><a href="../276495/index.html">Import dictionary in Lingualeo.com</a></li>
<li><a href="../276497/index.html">Winter School "Internet of Things on the Intel Edison Platform." Nizhny Novgorod, February 8-13</a></li>
<li><a href="../276499/index.html">Simplify Backup and Restore with HPE StoreOnce RMC</a></li>
<li><a href="../276501/index.html">Cybercriminals use Amazon server to manage Win32 / Bayrob malware</a></li>
<li><a href="../276505/index.html">We are not carpenters, not carpenters ... And we are programmers-workers, yes. And install applications on servers of several environments</a></li>
<li><a href="../276509/index.html">Selection of useful utilities SCSS</a></li>
<li><a href="../276517/index.html">C #, PVS-Studio, ReSharper</a></li>
<li><a href="../276519/index.html">SVG-files from the inside and the output of vector images on the canvas "manually" (Part 1)</a></li>
<li><a href="../276523/index.html">The most basic need: how did we implement DNS hosting at Mail.Ru for business?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>