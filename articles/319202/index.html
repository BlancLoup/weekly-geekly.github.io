<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pure Python Architecture: A Walkthrough. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Content 

- Part 1 
- Part 2 
- Part 3 
- Part 4 
- Part 5 

 Domain Models 
 Git tag: Step02 

 Let's start with a simple definition of the StorageRo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pure Python Architecture: A Walkthrough. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f0d/27b/5d0/f0d27b5d0e7444cda590606ae0b88869.png"><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text"><ul><li>  <a href="https://habrahabr.ru/post/319126/">Part 1</a> </li><li>  <em>Part 2</em> </li><li>  <a href="https://habrahabr.ru/post/319898/">Part 3</a> </li><li>  <a href="https://habrahabr.ru/post/320662/">Part 4</a> </li><li>  <a href="https://habrahabr.ru/post/320928/">Part 5</a> </li></ul><br></div></div><br><h3>  Domain Models </h3><br>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step02">Step02</a> <br><br>  Let's start with a simple definition of the <code><font color="#900">StorageRoom</font></code> model.  As mentioned earlier, models in pure architecture are very light, at least easier than their ORM counterparts in frameworks. <br><br>  Once we follow the TDD methodology, the first thing we write is tests.  Create the file <code><font color="#900">tests/domain/test_storageroom.py</font></code> and place this code inside it: <br><a name="habracut"></a><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> uuid <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.domain.storageroom <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StorageRoom <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_model_init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> code = uuid.uuid4() storageroom = StorageRoom(code, size=<span class="hljs-number"><span class="hljs-number">200</span></span>, price=<span class="hljs-number"><span class="hljs-number">10</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'-0.09998975'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.75436293'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.code == code <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.size == <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.price == <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.longitude == <span class="hljs-number"><span class="hljs-number">-0.09998975</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.latitude == <span class="hljs-number"><span class="hljs-number">51.75436293</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_model_from_dict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> code = uuid.uuid4() storageroom = StorageRoom.from_dict( { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: code, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'longitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'-0.09998975'</span></span>, <span class="hljs-string"><span class="hljs-string">'latitude'</span></span>: <span class="hljs-string"><span class="hljs-string">'51.75436293'</span></span> } ) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.code == code <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.size == <span class="hljs-number"><span class="hljs-number">200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.price == <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.longitude == <span class="hljs-number"><span class="hljs-number">-0.09998975</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> storageroom.latitude == <span class="hljs-number"><span class="hljs-number">51.75436293</span></span></code> </pre><br>  These two tests ensure that our model can be initialized with the correct values ‚Äã‚Äãpassed to it or using a dictionary.  In the first case, you must specify all the parameters of the model.  Later it will be possible to make some of them optional by pre-writing the necessary tests. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the meantime, let's write the <code><font color="#900">StorageRoom</font></code> class by placing it in the <code><font color="#900">rentomatic/domain/storageroom.py</font></code> .  Do not forget to create a file <code><font color="#900">__init__.py</font></code> in each subdirectory of the project, which Python should perceive as modules. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared.domain_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DomainModel <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoom</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, code, size, price, latitude, longitude)</span></span></span><span class="hljs-function">:</span></span> self.code = code self.size = size self.price = price self.latitude = float(latitude) self.longitude = float(longitude) @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_dict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, adict)</span></span></span><span class="hljs-function">:</span></span> room = StorageRoom( code=adict[<span class="hljs-string"><span class="hljs-string">'code'</span></span>], size=adict[<span class="hljs-string"><span class="hljs-string">'size'</span></span>], price=adict[<span class="hljs-string"><span class="hljs-string">'price'</span></span>], latitude=adict[<span class="hljs-string"><span class="hljs-string">'latitude'</span></span>], longitude=adict[<span class="hljs-string"><span class="hljs-string">'longitude'</span></span>], ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> room DomainModel.register(StorageRoom)</code> </pre><br>  The model is very simple and requires no explanation.  One of the advantages of clean architecture is that each layer contains small pieces of code that, when isolated, should perform simple tasks.  In our case, the model provides an API for initializing and storing information within the class. <br><br>  The <code><font color="#900">from_dict</font></code> method <code><font color="#900">from_dict</font></code> useful when creating a model from data coming from another layer (such as a database layer or from a query string in a REST layer). <br><br>  It may be tempting to try to simplify the <code><font color="#900">from_dict</font></code> function by abstracting and presenting it as a method of the <em>Model</em> class.  And considering that a certain level of abstraction and generalization is possible and necessary, and the initialization of models can interact with various other scenarios, it is better to implement it directly in the class itself. <br><br>  <em>The</em> <code><font color="#900">DomainModel</font></code> <em>abstract base class</em> is an easy way to classify a model for future scenarios, such as checking for class membership of a model in a system.  For more information on using <em>Abstract Base Classes</em> in Python, I advise you to read <a href="http://blog.thedigitalcatonline.com/blog/2016/04/03/abstract-base-classes-in-python/">this post</a> . <br><br><h3>  Serializers </h3><br>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step03">Step03</a> <br><br>  If we want to return our model as a result of an API call, then it will need to be serialized.  The typical serialization format is JSON, since it is a widespread standard used for web APIs.  Serializer is not part of the model.  This is an external special class that receives an instance of the model and translates its structure and values ‚Äã‚Äãinto some representation. <br><br>  To test the JSON serialization of our <code><font color="#900">StorageRoom</font></code> class <code><font color="#900">StorageRoom</font></code> place the following code in the <code><font color="#900">tests/serializers/test_storageroom_serializer.py</font></code> file <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.serializers <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> storageroom_serializer <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> srs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.domain.storageroom <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StorageRoom <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_serialize_domain_storageroom</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> room = StorageRoom(<span class="hljs-string"><span class="hljs-string">'f853578c-fc0f-4e65-81b8-566c5dffa35a'</span></span>, size=<span class="hljs-number"><span class="hljs-number">200</span></span>, price=<span class="hljs-number"><span class="hljs-number">10</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'-0.09998975'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.75436293'</span></span>) expected_json = <span class="hljs-string"><span class="hljs-string">""" { "code": "f853578c-fc0f-4e65-81b8-566c5dffa35a", "size": 200, "price": 10, "longitude": -0.09998975, "latitude": 51.75436293 } """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> json.loads(json.dumps(room, cls=srs.StorageRoomEncoder)) == json.loads(expected_json) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_serialize_domain_storageruum_wrong_type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> pytest.raises(TypeError): json.dumps(datetime.datetime.now(), cls=srs.StorageRoomEncoder)</code> </pre><br>  Place the code that passes the test in the <code><font color="#900">rentomatic/serializers/storageroom_serializer.py</font></code> file: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoomEncoder</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(json.JSONEncoder)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">default</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, o)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: to_serialize = { <span class="hljs-string"><span class="hljs-string">'code'</span></span>: o.code, <span class="hljs-string"><span class="hljs-string">'size'</span></span>: o.size, <span class="hljs-string"><span class="hljs-string">'price'</span></span>: o.price, <span class="hljs-string"><span class="hljs-string">"latitude"</span></span>: o.latitude, <span class="hljs-string"><span class="hljs-string">"longitude"</span></span>: o.longitude, } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> to_serialize <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> AttributeError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> super().default(o)</code> </pre><br>  Providing a class inherited from <code><font color="#900">JSON.JSONEncoder</font></code> , we use <code><font color="#900">json.dumps(room, cls = StorageRoomEncoder)</font></code> to serialize the model. <br><br>  We may notice some repetition in the code.  This is a minus of pure architecture, which is annoying.  Since we want to isolate the layers as much as possible and create lightweight classes, we end up repeating some actions.  For example, the serialization code that assigns the attributes from <code><font color="#900">StorageRoom</font></code> to JSON attributes is similar to what we use to create an object from a dictionary.  Not the same, but the similarity of these two functions is present. <br><br><h3>  Scripts (part 1) </h3><br>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step04">Step04</a> <br><br>  It's time to implement the real business logic of our application, which will be accessible from the outside.  <abbr title="Use Cases">Scenarios</abbr> are the place where we implement the classes that request the repository, apply business rules, logic, transform the data as we please, and return the result. <br><br>  Given these requirements, let's begin to consistently build the <em>script</em> .  The simplest <em>scenario</em> we can create is one that retrieves all storage space from the storage and returns it.  Please note that we have not yet implemented the storage layer, so in our tests we will be wet (replace with fiction). <br><br>  Here is the basis for a simple test <em>script</em> that lists all storage spaces.  Place this code in the <code><font color="#900">tests/use_cases/test_storageroom_list_use_case.py</font></code> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pytest <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> unittest <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> mock <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.domain.storageroom <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> StorageRoom <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.use_cases <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> storageroom_use_cases <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> uc @pytest.fixture <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">domain_storagerooms</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> storageroom_1 = StorageRoom( code=<span class="hljs-string"><span class="hljs-string">'f853578c-fc0f-4e65-81b8-566c5dffa35a'</span></span>, size=<span class="hljs-number"><span class="hljs-number">215</span></span>, price=<span class="hljs-number"><span class="hljs-number">39</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'-0.09998975'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.75436293'</span></span>, ) storageroom_2 = StorageRoom( code=<span class="hljs-string"><span class="hljs-string">'fe2c3195-aeff-487a-a08f-e0bdc0ec6e9a'</span></span>, size=<span class="hljs-number"><span class="hljs-number">405</span></span>, price=<span class="hljs-number"><span class="hljs-number">66</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'0.18228006'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.74640997'</span></span>, ) storageroom_3 = StorageRoom( code=<span class="hljs-string"><span class="hljs-string">'913694c6-435a-4366-ba0d-da5334a611b2'</span></span>, size=<span class="hljs-number"><span class="hljs-number">56</span></span>, price=<span class="hljs-number"><span class="hljs-number">60</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'0.27891577'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.45994069'</span></span>, ) storageroom_4 = StorageRoom( code=<span class="hljs-string"><span class="hljs-string">'eed76e77-55c1-41ce-985d-ca49bf6c0585'</span></span>, size=<span class="hljs-number"><span class="hljs-number">93</span></span>, price=<span class="hljs-number"><span class="hljs-number">48</span></span>, longitude=<span class="hljs-string"><span class="hljs-string">'0.33894476'</span></span>, latitude=<span class="hljs-string"><span class="hljs-string">'51.39916678'</span></span>, ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [storageroom_1, storageroom_2, storageroom_3, storageroom_4] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_storageroom_list_without_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(domain_storagerooms)</span></span></span><span class="hljs-function">:</span></span> repo = mock.Mock() repo.list.return_value = domain_storagerooms storageroom_list_use_case = uc.StorageRoomListUseCase(repo) result = storageroom_list_use_case.execute() repo.list.assert_called_with() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> result == domain_storagerooms</code> </pre><br>  The test is simple.  First, we changed the repository to provide the <code><font color="#900">list()</font></code> method, which returns a list of the models previously created above.  Then we initialize the <em>script</em> with the repository and execute it, memorizing the result.  The first thing we check is that the storage method was called without any parameter, and the second is the correctness of the result. <br><br>  But the implementation of the <em>script</em> that passes the test.  Place the code in the file <code><font color="#900">rentomatic/use_cases/storageroom_use_case.py</font></code> <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoomListUseCase</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, repo)</span></span></span><span class="hljs-function">:</span></span> self.repo = repo <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.repo.list()</code> </pre><br>  However, with such an implementation of the <em>scenario,</em> we will soon encounter a problem.  Firstly, we do not have a standard way to transfer call parameters, which means that we do not have a standard way to check their correctness.  The next problem is that we are missing the standard way of returning the results of a call, and therefore we cannot find out if the call was successful or not, and if not, for what reason.  The same problem with the wrong parameters discussed in the previous paragraph. <br><br>  Thus, we want to introduce some structures to wrap the input and output of our <em>scripts</em> .  These structures are called <em>request and response objects</em> . <br><br><h3>  Requests and Answers </h3><br>  <b>Git tag:</b> <a href="http://github.com/lgiordani/rentomatic/tree/step05">Step05</a> <br><br>  <abbr title="request and response objects">Requests and responses</abbr> are an important part of pure architecture.  They move the call parameters, input data and call results between the <em>script</em> layer and the external environment. <br><br>  <em>Requests</em> are created based on incoming API calls, so that they will encounter such things as incorrect values, missing parameters, incorrect format, etc.  <em>Answers</em> , on the other hand, must contain the results of the API calls, including those that must submit errors and give detailed information about what happened. <br><br>  You have the right to use any implementation of <em>requests and responses</em> , pure architecture says nothing about it.  The decision on how to pack and present the data rests entirely with you. <br><br>  In the meantime, we just need a <code><font color="#900">StorageRoomListRequestObject</font></code> , which can be initialized without parameters, so let's create the file <code><font color="#900">tests/use_cases/test_storageroom_list_request_objects.py</font></code> and put a test for this object in it. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.use_cases <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request_objects <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ro <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_build_storageroom_list_request_object_without_parameters</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> req = ro.StorageRoomListRequestObject() <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(req) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_build_file_list_request_object_from_empty_dict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> req = ro.StorageRoomListRequestObject.from_dict({}) <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(req) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  At the moment, <em>the request object is</em> empty, but it will come in handy to us as soon as we have the parameters for the <em>script</em> that produces the list of objects.  The code for the <code><font color="#900">StorageRoomListRequestObject</font></code> class is in the <code><font color="#900">rentomatic/use_cases/request_objects.py</font></code> file and looks like this: <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StorageRoomListRequestObject</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from_dict</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, adict)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> StorageRoomListRequestObject() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__nonzero__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  <em>The request</em> is also quite simple, since at the moment we need only a successful answer.  Unlike the <em>query</em> , the <em>answer is</em> not associated with any particular <em>scenario</em> , so the test file can be called <code><font color="#900">tests/shared/test_response_object.py</font></code> <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> rentomatic.shared <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> response_object <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ro <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_response_success_is_true</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span> bool(ro.ResponseSuccess()) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre><br>  and the actual <em>response object</em> is in the <code><font color="#900">rentomatic/shared/response_object.py</font></code> file <br><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ResponseSuccess</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, value=None)</span></span></span><span class="hljs-function">:</span></span> self.value = value <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__nonzero__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> __bool__ = __nonzero__</code> </pre><br><p>  To be continued in <a href="https://habrahabr.ru/post/319898/">Part 3</a> . </p></div><p>Source: <a href="https://habr.com/ru/post/319202/">https://habr.com/ru/post/319202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319190/index.html">Atlassian buys Trello for $ 425 million</a></li>
<li><a href="../319194/index.html">Increase code performance: think first about data</a></li>
<li><a href="../319196/index.html">How does the language support service for 1237 Russian IT engineers work, and how does this differ from conventional translation?</a></li>
<li><a href="../319198/index.html">The history of the development of Tower Defense for VK and Android</a></li>
<li><a href="../319200/index.html">Python: collections, part 2/4: indexing, slicing, sorting</a></li>
<li><a href="../319204/index.html">VulnHub: Parse the shortest quest DC416 Fortress</a></li>
<li><a href="../319208/index.html">Learn ActionBlock: or a short story about otherwise deadlock</a></li>
<li><a href="../319210/index.html">Bitrix Start Performance on Proxmox and Virtuozzo 7 & Virtuozzo Storage</a></li>
<li><a href="../319212/index.html">"IT infrastructure": Where we go with the "cloud" in 2017</a></li>
<li><a href="../319214/index.html">Cheap Ways to Heat Up Storage with an SSD</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>