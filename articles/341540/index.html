<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create your own physical 2D engine: parts 2-4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Table of contents 
 Part 2: engine core 



- Integration 
- Time stamps 
- Modular architecture Bodies Forms Forces Materials 
- Bodies 
- Forms 
- F...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create your own physical 2D engine: parts 2-4</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/e3e/dd6/98fe3edd6e8e2638333e020656891dd6.png" alt="image"></div><br><br><h4>  Table of contents </h4><br>  Part 2: engine core <br><br><ul><li>  Integration </li><li>  Time stamps </li><li>  Modular architecture <ul><li>  Bodies </li><li>  Forms </li><li>  Forces </li><li>  Materials </li></ul></li><li>  Wide phase <ul><li>  Clipping duplicate contact pairs </li><li>  Layer system </li></ul></li><li>  Checking the intersection of half spaces </li></ul><br>  Part 3: Friction, Scene and Transition Table 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Friction </li><li>  Scene </li><li>  Collision transition table </li></ul><br>  Part 4: Oriented Solids <br><br><ul><li>  Rotation Math </li><li>  Oriented Forms </li><li>  Collision detection </li><li>  Collision resolution </li></ul><br><a name="habracut"></a><hr><br><h2>  Part 2: engine core </h2><br>  In this part of the article we will add other functions to the resolution of force impulses.  In particular, we consider integration, time stamps, use of modular architecture in code, and collision detection in a wide phase. <br><br><hr><br><h2>  Introduction </h2><br>  In the previous post I reviewed the topic of <a href="https://habrahabr.ru/post/336908/">impulse resolution</a> .  Read it first if you have not done it yet! <br><br>  Let's delve into the topics covered in this article.  All these topics are necessary for any more or less decent physics engine, so it is time to create new functions on top of the foundation laid in the previous post. <br><br><ul><li>  Integration </li><li>  Time stamps </li><li>  Modular architecture <ul><li>  Bodies </li><li>  Forms </li><li>  Forces </li><li>  Materials </li></ul></li><li>  Wide phase <ul><li>  Clipping duplicate contact pairs </li><li>  Layer system </li></ul></li><li>  Checking the intersection of half spaces </li></ul><br><cut></cut><hr><br><h2>  Integration </h2><br>  Integration is very simple to implement, and there is a lot of information about iterative integration on the Internet.  In this section, I will mainly look at the function of correct integration, and tell you the places where you can find more detailed information if you are interested. <br><br>  First, you need to figure out what acceleration is.  <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD%25D1%258B_%25D0%259D%25D1%258C%25D1%258E%25D1%2582%25D0%25BE%25D0%25BD%25D0%25B0">Newton's second law</a> states: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-1"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-2">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-3">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-9">n</span><span class="MJXp-mspace" id="MJXp-Span-10" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-11">1</span><span class="MJXp-mo" id="MJXp-Span-12" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-13" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-14">F</span><span class="MJXp-mo" id="MJXp-Span-15" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-16">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17">a</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="93.735ex" height="5.07ex" viewBox="0 -780.1 40358 2182.7" role="img" focusable="false" style="vertical-align: -3.258ex; max-width: 778px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(17479,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-45" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-71" x="764" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-75" x="1225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="1797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-74" x="2327" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-69" x="2688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6F" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="3519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-31" x="4342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3A" x="5120" y="0"></use></g><g transform="translate(18433,-1307)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3D" x="1027" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6D" x="2083" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="2962" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> Equation \: 1: \\ F = ma </script></p><br>  He argues that the sum of all forces acting on an object is equal to the mass of this object <code>m</code> multiplied by the acceleration <code>a</code> .  <code>m</code> indicated in kilograms, <code>a</code> in meters / s, and <code>F</code> in newtons. <br><br>  Slightly transform the equation to calculate <code>a</code> and get: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-18"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-20">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-21">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-23">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-24">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-26">n</span><span class="MJXp-mspace" id="MJXp-Span-27" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-28">2</span><span class="MJXp-mo" id="MJXp-Span-29" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-30" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-31">a</span><span class="MJXp-mo" id="MJXp-Span-32" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mtext" id="MJXp-Span-33">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-34">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-35">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-37">c</span><span class="MJXp-mrow" id="MJXp-Span-38"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-39">F</span></span><span class="MJXp-mrow" id="MJXp-Span-40"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-41">m</span></span><span class="MJXp-mspace" id="MJXp-Span-42" style="width: 0em; height: 0em;"></span><span class="MJXp-mtext" id="MJXp-Span-43">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-44">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45">h</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-48">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-50">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52">e</span><span class="MJXp-mspace" id="MJXp-Span-53" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-54">a</span><span class="MJXp-mo" id="MJXp-Span-55" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-56">F</span><span class="MJXp-mo" id="MJXp-Span-57" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mtext" id="MJXp-Span-58">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-59">f</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-61">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-62">c</span><span class="MJXp-mrow" id="MJXp-Span-63"><span class="MJXp-mn" id="MJXp-Span-64">1</span></span><span class="MJXp-mrow" id="MJXp-Span-65"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-66">m</span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="93.735ex" height="11.817ex" viewBox="0 -780.1 40358 5087.6" role="img" focusable="false" style="vertical-align: -10.005ex; max-width: 778px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(17479,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-45" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-71" x="764" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-75" x="1225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="1797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-74" x="2327" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-69" x="2688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6F" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="3519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-32" x="4342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3A" x="5120" y="0"></use></g><g transform="translate(17325,-1332)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3D" x="807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-66" x="2113" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-72" x="2664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="3115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-63" x="3645" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-46" x="4078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6D" x="4828" y="0"></use></g><g transform="translate(17915,-2675)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-74" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-68" x="611" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-65" x="1188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-72" x="1654" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-65" x="2106" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-66" x="2572" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6F" x="3123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-72" x="3608" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-65" x="4060" y="0"></use></g><g transform="translate(16602,-4017)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3D" x="807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-46" x="1863" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-2217" x="2835" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-66" x="3808" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-72" x="4358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="4810" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-63" x="5339" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-31" x="5773" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6D" x="6273" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> Equation \: 2: \\ a = \ frac {F} {m} \\ \ therefore \\ a = F * \ frac {1} {m} </script></p><br>  The next step involves accelerating to move an object from one place to another.  Since the game is displayed in discrete separate frames that create the illusion of animation, it is necessary to calculate the places of each of the positions of these discrete steps.  For a more detailed analysis of these equations, see the <a href="https://code.google.com/p/box2d/downloads/detail%3Fname%3DGDC2009_ErinCatto.zip%26amp%3Bcan%3D2%26amp%3Bq%3D">Erin Kutto integration demo with GDC 2009</a> and the <a href="http://www.niksula.hut.fi/~hkankaan/Homepages/gravity.html">Hannu supplement to the Euler symplectic method to improve stability in low FPS environments</a> . <br><br>  The integration with the explicit Euler method is shown in the following code snippet, where <code>x</code> is the position and <code>v</code> is the speed.  It is worth noting that, as explained above, <code>1/m * F</code> is the acceleration: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    x += v * dt v += (1/m * F) * dt</span></span></code> </pre> <br>  <code>dt</code> here denotes the delta (increment) of time.  Œî is a delta symbol, and can literally be read as a ‚Äúchange in magnitude,‚Äù or written as Œî <code>t</code> .  So when you see <code>dt</code> , it can be read as a ‚Äútime change‚Äù.  <code>dv</code> is ‚Äúspeed change‚Äù. <br><br>  This system will work and is usually used as a starting point.  However, it has numerical inaccuracies that can be eliminated without unnecessary trouble.  Here is an algorithm called Euler's symplectic method: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    v += (1/m * F) * dt x += v * dt</span></span></code> </pre> <br>  Notice that I just converted the order of two lines of code ‚Äî see <a href="http://www.niksula.hut.fi/~hkankaan/Homepages/gravity.html">Hannu, the above article</a> . <br><br>  This post explains the numerical inaccuracies of Euler‚Äôs explicit method, but keep in mind that Hannu is starting to consider RK4, which I personally do not recommend: <a href="http://gafferongames.com/game-physics/integration-basics/">gafferongames.com: inaccuracy of Euler‚Äôs method</a> . <br><br>  These simple equations are enough to move all objects with linear velocity and acceleration. <br><br><hr><br><h2>  Time stamps </h2><br>  Since games are displayed at discrete time intervals, we need a method of controlled time manipulation between these steps.  Have you ever seen a game that runs on different computers at different speeds?  This is an example of a game that runs at a speed that depends on the power of the computer. <br><br>  We need a way to ensure that the physics engine is executed only after a certain amount of time has passed.  Thus, the <code>dt</code> used in the calculations will always remain the same number.  If everywhere in the code we use the exact constant value <code>dt</code> , then our physics engine will turn into <em>deterministic</em> , and this property of it will be known as a <em>constant time stamp</em> .  This is a very handy thing. <br><br>  A deterministic physics engine is one that, with the same input, will always do the same thing.  This is necessary in many types of games in which the gameplay must be clearly tied to the behavior of the physics engine.  In addition, it is necessary to debug our engine, because to detect errors in the behavior of the engine, it must be constant. <br><br>  First, let's look at a simple version of the permanent time stamp.  Here is an example: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fps = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt = <span class="hljs-number"><span class="hljs-number">1</span></span> / fps <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accumulator = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//   -  float frameStart = GetCurrentTime( ) //   while(true) const float currentTime = GetCurrentTime( ) //  ,      accumulator += currentTime - frameStart( ) //     frameStart = currentTime while(accumulator &gt; dt) UpdatePhysics( dt ) accumulator -= dt RenderGame( )</span></span></code> </pre> <br>  This code waits and renders the game until enough time has passed to update the physics.  Elapsed time is recorded, and discrete blocks of time the size of <code>dt</code> are taken from the accumulator and processed by physics.  This ensures that under any conditions the same value is transmitted to physics, and that the value transferred to physics is an exact representation of the actual time passed in real life.  The <code>dt</code> blocks are removed from the <code>accumulator</code> until the <code>accumulator</code> becomes smaller than the <code>dt</code> block. <br><br>  Here we can fix a couple of problems.  The first is related to how long it takes to update the physics: what happens if the physics update takes too much time and with each game cycle <code>accumulator</code> will be more and more?  This is called the "death spiral."  If this problem is not solved, the engine will quickly come to a complete stop if the calculation of physics is not fast enough. <br><br>  To solve the problem, the engine needs fewer physics updates if the <code>accumulator</code> becomes too large.  One of the easiest ways to do this is to limit the <code>accumulator</code> so that it cannot be greater than any arbitrary value. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fps = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt = <span class="hljs-number"><span class="hljs-number">1</span></span> / fps <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accumulator = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//   -  float frameStart = GetCurrentTime( ) //   while(true) const float currentTime = GetCurrentTime( ) //  ,      accumulator += currentTime - frameStart( ) //     frameStart = currentTime //       dt,   //    UpdatePhysics  //   . if(accumulator &gt; 0.2f) accumulator = 0.2f while(accumulator &gt; dt) UpdatePhysics( dt ) accumulator -= dt RenderGame( )</span></span></code> </pre> <br>  Now, if the game performing this cycle finds it simple for some reason, then physics will not drag itself into the death spiral.  The game will simply run a little slower, as it should. <br><br>  The next problem is much smaller than the death spiral.  This cycle receives <code>dt</code> blocks from <code>accumulator</code> , until <code>accumulator</code> becomes less than <code>dt</code> .  This is great, but in <code>accumulator</code> is still some time left.  That is the problem. <br><br>  Assume that in the <code>accumulator</code> each frame remains 1/5 of the <code>dt</code> block.  On the sixth frame in <code>accumulator</code> will be enough time remaining to perform one more physics update for all other frames.  This will result in a slightly larger discrete jump in time, approximately at one frame per second, or so, and this can be very noticeable in the game. <br><br>  To solve this problem, you must use <em>linear interpolation</em> .  It sounds scary, but do not be afraid - I will show the implementation.  If you want to understand how to implement it, then there are many resources on the Internet devoted to linear interpolation. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    a  0  1 //  t1  t2 t1 * a + t2(1.0f - a)</span></span></code> </pre> <br>  With this code we can interpolate (approximate) the place in which we can be between two different time intervals.  This position can be used to render the game state between two physics updates. <br><br>  Using linear interpolation, you can render the engine at a speed different from the execution of the physical engine.  This allows you to elegantly handle the remainder of the <code>accumulator</code> of physics updates. <br><br>  Here is a complete example: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> fps = <span class="hljs-number"><span class="hljs-number">100</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> dt = <span class="hljs-number"><span class="hljs-number">1</span></span> / fps <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> accumulator = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">//   -  float frameStart = GetCurrentTime( ) //   while(true) const float currentTime = GetCurrentTime( ) //  ,      accumulator += currentTime - frameStart( ) //     frameStart = currentTime //       dt,   //    UpdatePhysics  //   . if(accumulator &gt; 0.2f) accumulator = 0.2f while(accumulator &gt; dt) UpdatePhysics( dt ) accumulator -= dt const float alpha = accumulator / dt; RenderGame( alpha ) void RenderGame( float alpha ) for shape in game do //      Transform i = shape.previous * alpha + shape.current * (1.0f - alpha) shape.previous = shape.current shape.Render( i )</span></span></code> </pre> <br>  Thus, all objects in the game can be drawn at variable moments between the discrete time stamps of physics.  This allows you to elegantly handle all errors and the accumulation of time.  In fact, the rendering will be performed a little later than the computed physics, but when you watch the game, the whole movement is remarkably smoothed by interpolation. <br><br>  The player will never guess that rendering is constantly lagging behind physics, because he will know only what he sees, and he will see perfectly smooth transitions from one frame to another. <br><br>  You may ask yourself: why do we not interpolate from the current position to the next?  I tried to do so and it turned out that this requires that the rendering "guessed" where the objects will be in the future.  Objects in a physics engine can often suddenly change their motion, for example, during collisions, and when such drastic changes occur, objects are teleported to another place due to inaccurate interpolations for the future. <br><br><hr><br><h2>  Modular architecture </h2><br>  Each physical object requires several properties.  However, the parameters for each specific object may differ slightly.  We need a smart way to organize all of this data, and we will assume that for such ordering it is desirable to write as little code as possible.  In this case, we have a modular architecture. <br><br>  The phrase "modular architecture" may sound pathetic and pereuslozhenno, but in fact it is quite logical and quite simple.  In this context, ‚Äúmodular architecture‚Äù simply means that we can break up physical objects into separate parts so that they can be connected and separated in a convenient way. <br><br><h3>  Bodies </h3><br>  A physical body is an object containing all the information about a particular physical object.  It will store the form (or forms) that make up the object, data on mass, transformation (position, turn), speed, torque, etc.  Here is what the body will look like: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">body</span></span></span><span class="hljs-class"> {</span></span> Shape *shape; Transform tx; Material material; MassData mass_data; Vec2 velocity; Vec2 force; real gravityScale; };</code> </pre> <br>  This is a great starting point for creating the structure of the physical body.  Here logical decisions are made to create a good code structure. <br><br>  First, it is worth noting that the form is placed in the body with a pointer.  This creates a weak connection between the body and its form.  The body can contain any shape, and the shape of the body can be arbitrarily changed.  In fact, a body can be represented by several forms, and such a body will be called ‚Äúcomposite‚Äù, because it consists of several forms.  (In this tutorial, I will not consider composite bodies.) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2d4/f60/d07/2d4f60d07eb8c3363697bcf42cbf9a7a.png"><br>  <i>Interface body and shape.</i> <br><br>  The <code>shape</code> itself is responsible for calculating the boundary shapes, calculating the mass based on density, and rendering. <br><br>  <code>mass_data</code> is a small data structure for storing mass-related information: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MassData</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> mass; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> inv_mass; <span class="hljs-comment"><span class="hljs-comment">//   (  ) float inertia; float inverse_inertia; };</span></span></code> </pre> <br>  It is very convenient to store in a single structure all values ‚Äã‚Äãrelated to mass and inertia.  Mass should never be set manually - the mass must always be calculated from the form itself.  Mass is a rather unintuitive type of value, and manually setting it will take a long time to fine-tune.  It is defined as follows: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68">E</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-69">q</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-70">u</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-73">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-74">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75">n</span><span class="MJXp-mn" id="MJXp-Span-76">3</span><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-78" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-79"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-80"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-83" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">d </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-85"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-86"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-88"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-89"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">y </font></font></span><span class="MJXp-mo" id="MJXp-Span-91" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">* </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-92"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">v </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-93"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">l </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">u </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-96"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processed"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="93.735ex" height="5.551ex" viewBox="0 -780.1 40358 2390.2" role="img" focusable="false" style="vertical-align: -3.74ex; max-width: 778px;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g transform="translate(17590,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-45" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-71" x="764" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-75" x="1225" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="1797" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-74" x="2327" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-69" x="2688" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6F" x="3034" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="3519" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-33" x="4120" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3A" x="4898" y="0"></use></g><g transform="translate(14640,-1322)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6D" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-61" x="878" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-73" x="1408" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-73" x="1877" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-3D" x="2624" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-64" x="3681" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-65" x="4204" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="4671" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-73" x="5271" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-69" x="5741" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-74" x="6086" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-79" x="6448" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-2217" x="7167" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-76" x="7890" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6F" x="8376" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6C" x="8861" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-75" x="9160" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6D" x="9732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-65" x="10611" y="0"></use></g></g></svg></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> Equation 3: \\ mass = density * volume </script></p><br>  When a designer needs a form to be more ‚Äúmassive‚Äù or ‚Äúheavy‚Äù, then he should change the density of the form.  This density can be used to calculate the mass of a form using its volume.  This is the right way to act in such a situation, because the density is not affected by the volume and it never changes during the execution of the game (unless provided with a special code). <br><br>  Some of the examples of shapes, such as AABB and circles, can be found in the <a href="https://habrahabr.ru/post/336908/">previous part of the tutorial</a> . <br><br><h3>  Materials </h3><br>  All this talk about mass and density leads us to the question: where is the density value stored?  It is in the <code>Material</code> structure: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Material</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> density; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> restitution; };</code> </pre> <br>  After setting the material values, this material can be transferred to the shape of the body so that the body can calculate the mass. <br><br>  The last thing worth mentioning is <code>gravity_scale</code> .  Scaling gravity for different objects is very often useful when fine-tuning the gameplay, so each body should add this value specifically for this task. <br><br>  Useful settings for the most common materials can be used to create the enumeration value of the <code>Material</code> object: <br><br><pre> <code class="cpp hljs">Rock Density : <span class="hljs-number"><span class="hljs-number">0.6</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.1</span></span> Wood Density : <span class="hljs-number"><span class="hljs-number">0.3</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.2</span></span> Metal Density : <span class="hljs-number"><span class="hljs-number">1.2</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.05</span></span> BouncyBall Density : <span class="hljs-number"><span class="hljs-number">0.3</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.8</span></span> SuperBall Density : <span class="hljs-number"><span class="hljs-number">0.3</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.95</span></span> Pillow Density : <span class="hljs-number"><span class="hljs-number">0.1</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.2</span></span> Static Density : <span class="hljs-number"><span class="hljs-number">0.0</span></span> Restitution : <span class="hljs-number"><span class="hljs-number">0.4</span></span></code> </pre> <br><h3>  Forces </h3><br>  We need to discuss another aspect in the <code>body</code> structure.  This is a data item called <code>force</code> .  At the beginning of each physics update, this value is zero.  Other effects of the physics engine (for example, gravity) add to this data element <code>force</code> <code>Vec2</code> vectors.  Immediately before integration, all these forces are used to calculate the acceleration of the body and are applied at the integration stage.  After integration, this <code>force</code> data item is set to zero. <br><br>  This allows an object to act on any number of forces, and to apply new types of forces to objects, no new code should be written. <br><br>  Let's take an example.  Suppose we have a small circle, which is a very heavy object.  This small circle flies around the game world, and it is so heavy that it constantly slightly attracts other objects.  Here is a rough pseudocode to demonstrate this: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">HeavyObject object </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">for</span></span></span><span class="hljs-function"> body in game </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">do</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(object.CloseEnoughTo( body ) object.ApplyForcePullOn( body )</span></span></span></span></code> </pre> <br>  The <code>ApplyForcePullOn()</code> function can refer to a small force that attracts a <code>body</code> to a <code>HeavyObject</code> only if the <code>body</code> is close enough. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cd8/182/42d/cd818242d421cd805393309b8e619ef9.png"></div><br>  <i>Two objects drawn to a larger object moving past them.</i>  <i>The forces of attraction depend on the distance to a large rectangle.</i> <br><br>  It does not matter how much force is applied to the <code>force</code> body, because they are summed up into a single common vector of this body.  This means that two forces acting on one body can potentially balance each other. <br><br><hr><br><h2>  Wide phase </h2><br>  In the previous article in the series, we introduced collision recognition procedures.  These procedures are in fact independent of what is called the ‚Äúnarrow phase‚Äù.  The differences between the wide and narrow phases can be quite easily found on Google. <br><br>  (In short: we use the wide collision recognition phase to determine which pairs of objects <em>can</em> collide, and then the narrow collision recognition phase to check if they <i>really</i> collide.) <br><br>  I want to give an example of code with an explanation of how to implement a wide phase of computing pairs of the algorithm with time complexity <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-100" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-101"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-103" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-104" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.032ex" height="2.901ex" viewBox="0 -935.7 2596.9 1249" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-28" x="763" y="0"></use><g transform="translate(1153,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-32" x="849" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-29" x="2207" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> O (n ^ 2) </script>  . <br><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O </font></font></span><span class="MJXp-mo" id="MJXp-Span-107" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-108"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mn MJXp-script" id="MJXp-Span-110" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-111" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> )</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.032ex" height="2.901ex" viewBox="0 -935.7 2596.9 1249" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-4F" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-28" x="763" y="0"></use><g transform="translate(1153,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMATHI-6E" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-32" x="849" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/341540/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhjLsuAT1GYbUUxXG3x_QuoN1dCAFw#MJMAIN-29" x="2207" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> O (n ^ 2) </script>  means that the time spent checking each pair of potential collisions depends on the square of the number of objects.  Here, the <a href="https://ru.wikipedia.org/wiki/%25C2%25ABO%25C2%25BB_%25D0%25B1%25D0%25BE%25D0%25BB%25D1%258C%25D1%2588%25D0%25BE%25D0%25B5_%25D0%25B8_%25C2%25ABo%25C2%25BB_%25D0%25BC%25D0%25B0%25D0%25BB%25D0%25BE%25D0%25B5">‚ÄúO‚Äù notation is large</a> . <br><br>  Since we work with pairs of objects, it will be useful to create a similar structure: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pair</span></span></span><span class="hljs-class"> {</span></span> body *A; body *B; };</code> </pre> <br>  The wide phase should collect a group of possible collisions and save them all in the structures of the <code>Pair</code> .  These pairs can then be transferred to another part of the engine (narrow phase) for later resolution. <br><br>  Example of a wide phase: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   . //        . void BroadPhase::GeneratePairs( void ) { pairs.clear( ) //    AABB,    //       AABB A_aabb AABB B_aabb for(i = bodies.begin( ); i != bodies.end( ); i = i-&gt;next) { for(j = bodies.begin( ); j != bodies.end( ); j = j-&gt;next) { Body *A = &amp;i-&gt;GetData( ) Body *B = &amp;j-&gt;GetData( ) //      if(A == B) continue A-&gt;ComputeAABB( &amp;A_aabb ) B-&gt;ComputeAABB( &amp;B_aabb ) if(AABBtoAABB( A_aabb, B_aabb )) pairs.push_back( A, B ) } } }</span></span></code> </pre> <br>  The code above is quite simple: we check every body with every other body, and skip checking for collisions with ourselves. <br><br><h3>  Duplicate clipping </h3><br>  In the last section there is one problem: many duplicate pairs will be returned!  These duplicates must be removed from the results.  If you do not have a sorting library at hand, this will require familiarity with sorting algorithms.  If you are writing in C ++, then you are lucky: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      sort( pairs, pairs.end( ), SortPairs ); //       { int i = 0; while(i &lt; pairs.size( )) { Pair *pair = pairs.begin( ) + i; uniquePairs.push_front( pair ); ++i; //  ,  ,      while(i &lt; pairs.size( )) { Pair *potential_dup = pairs + i; if(pair-&gt;A != potential_dup-&gt;B || pair-&gt;B != potential_dup-&gt;A) break; ++i; } } }</span></span></code> </pre> <br>  After sorting all pairs in a certain order, we can assume that all pairs in the container have a duplicate in the neighborhood.  Place all unique pairs in the new <code>uniquePairs</code> container, and the work on duplicating duplicates is completed. <br><br>  The last thing worth mentioning is the predicate <code>SortPairs()</code> .  This <code>SortPairs()</code> function is used for sorting.  It might look like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SortPairs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Pair lhs, Pair rhs )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lhs.A &lt; rhs.A) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(lhs.A == rhs.A) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.B &lt; rhs.B; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  The <code>lhs</code> and <code>rhs</code> members can be decoded as the ‚Äúleft hand side‚Äù (left side) and the ‚Äúright hand side‚Äù (right side).  These terms are usually used to work with parameters of functions, in which elements can be logically considered as the left and right sides of an equation or algorithm. <br><br><h3>  Layer system </h3><br>  <em>The layer system is</em> needed so that different objects never collide with each other.  It is necessary that bullets flying from certain objects do not affect other specific objects.  For example, players of one team with missiles must deal damage to enemies, but not to each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b0/a69/ce6/5b0a69ce6c5ce842ddd558cb407fa7eb.png"></div><br>  <i>Explanation of the system of layers: some objects collide with each other, others do not.</i> <br><br>  The layer system is best implemented using <em>bitmasks</em> .  To learn how bitmasks are used in engines, see for a <a href="http://stu.mp/2004/06/a-quick-bitmask-howto-for-programmers.html">brief introduction to bitmasks for programmers</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2581%25D0%25BA%25D0%25B0">the Wikipedia page</a> and the Filtering section in <a href="http://www.box2d.org/manual.html">the Box2D tutorial</a> . <br><br>  The layer system is implemented in a wide phase.  Here I will simply insert a ready-made example of a wide phase: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   . //        . void BroadPhase::GeneratePairs( void ) { pairs.clear( ) //    AABB,    //       AABB A_aabb AABB B_aabb for(i = bodies.begin( ); i != bodies.end( ); i = i-&gt;next) { for(j = bodies.begin( ); j != bodies.end( ); j = j-&gt;next) { Body *A = &amp;i-&gt;GetData( ) Body *B = &amp;j-&gt;GetData( ) //      if(A == B) continue //     if(!(A-&gt;layers &amp; B-&gt;layers)) continue; A-&gt;ComputeAABB( &amp;A_aabb ) B-&gt;ComputeAABB( &amp;B_aabb ) if(AABBtoAABB( A_aabb, B_aabb )) pairs.push_back( A, B ) } } }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The layer system is highly efficient and very simple. </font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Intersection of half spaces </font></font></h2><br> <em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A half-space</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be viewed in 2D as one side of a straight line. </font><font style="vertical-align: inherit;">Determining whether a point is on one or the other side of the line is a fairly common task, and when implementing your own physics engine you need to understand it well. </font><font style="vertical-align: inherit;">It is very bad that this topic, as it seems to me, is not disclosed anywhere on the Internet in detail, and we will fix it! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The general equation of a straight line in 2D has the following form:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-112"><span class="MJXp-mrow" id="MJXp-Span-113"><span class="MJXp-mo" id="MJXp-Span-114" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-115"><span class="MJXp-mo" id="MJXp-Span-116" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-117"><span class="MJXp-mo" id="MJXp-Span-118" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-119"><span class="MJXp-mo" id="MJXp-Span-120" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-121"><span class="MJXp-mo" id="MJXp-Span-122" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-123"><span class="MJXp-mo" id="MJXp-Span-124" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-125"><span class="MJXp-mo" id="MJXp-Span-126" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-127"><span class="MJXp-mo" id="MJXp-Span-128" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-129"><span class="MJXp-mo" id="MJXp-Span-130" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-131" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-132">4</span><span class="MJXp-mo" id="MJXp-Span-133" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-134" style="width: 0em; height: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-135"><span class="MJXp-mo" id="MJXp-Span-136" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-137"><span class="MJXp-mo" id="MJXp-Span-138" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-139"><span class="MJXp-mo" id="MJXp-Span-140" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-141"><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-143"><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-145" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-146"><span class="MJXp-mo" id="MJXp-Span-147" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-148"><span class="MJXp-mo" id="MJXp-Span-149" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-150"><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-152"><span class="MJXp-mo" id="MJXp-Span-153" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-154"><span class="MJXp-mo" id="MJXp-Span-155" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mo" id="MJXp-Span-156" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-157">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-158">x</span><span class="MJXp-mo" id="MJXp-Span-159" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-160">b</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-161">y</span><span class="MJXp-mo" id="MJXp-Span-162" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-163">c</span><span class="MJXp-mo" id="MJXp-Span-164" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mn" id="MJXp-Span-165">0</span><span class="MJXp-mspace" id="MJXp-Span-166" style="width: 0em; height: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-167"><span class="MJXp-mo" id="MJXp-Span-168" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-169"><span class="MJXp-mo" id="MJXp-Span-170" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-171"><span class="MJXp-mo" id="MJXp-Span-172" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-173"><span class="MJXp-mo" id="MJXp-Span-174" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-175"><span class="MJXp-mo" id="MJXp-Span-176" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-177"><span class="MJXp-mo" id="MJXp-Span-178" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-179"><span class="MJXp-mo" id="MJXp-Span-180" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-181" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-182"><span class="MJXp-mo" id="MJXp-Span-183" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-184" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mrow" id="MJXp-Span-185"><span class="MJXp-mo" id="MJXp-Span-186" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-187"><span class="MJXp-mo" id="MJXp-Span-188" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-189"><span class="MJXp-mo" id="MJXp-Span-190" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-191"><span class="MJXp-mo" id="MJXp-Span-192" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-193"><span class="MJXp-mo" id="MJXp-Span-194" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-195"><span class="MJXp-mo" id="MJXp-Span-196" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mo" id="MJXp-Span-197" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mrow" id="MJXp-Span-198"><span class="MJXp-mo" id="MJXp-Span-199" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.528em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3.111em; margin-left: -0.13em;">[</span></span><span class="MJXp-mtable" id="MJXp-Span-200"><span><span class="MJXp-mtr" id="MJXp-Span-201" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-202" style="text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">a</span></span></span><span class="MJXp-mtr" id="MJXp-Span-204" style="vertical-align: baseline;"><span class="MJXp-mtd" id="MJXp-Span-205" style="padding-top: 0.4em; text-align: center;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-206">b</span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-207" style="margin-left: 0em; margin-right: 0em; vertical-align: -0.528em;"><span class="MJXp-right MJXp-scale5" style="font-size: 3.111em; margin-left: -0.13em;">]</span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> \: 4:\\  \: : ax + by + c = 0\\  \:  \: : \begin{bmatrix} a \\ b \\ \end{bmatrix}</script></p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/470/d94/22c/470d9422c9dfd2cc6dd2c7ffb1391a08.png"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note that despite its name, the normal vector is not always necessarily normalized (that is, it does not necessarily have a length of 1). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To determine whether a point is on a certain side of a line, all we need to do is substitute a point into variables </font></font><code>x</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>y</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">equations and check the sign of the result. </font><font style="vertical-align: inherit;">A result of 0 will mean that the point is on a straight line, and a positive / negative value means different sides of a straight line. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And that is all! </font><font style="vertical-align: inherit;">Knowing this, from point to line is the result of a previous check. </font><font style="vertical-align: inherit;">If the normal vector is not normalized, then the result is scaled by the magnitude of the normal vector.</font></font><br><br><hr><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To this stage you can create a complete, albeit very simple physics engine from scratch. </font><font style="vertical-align: inherit;">In the following sections, we will look at more complex topics: friction: orientation, and the dynamic tree AABB.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Part 3: Friction, Scene and Transition Table </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In this part of the article we will cover the following topics: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Friction </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Scene </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Collision transition table </font></font></li></ul><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Video demo </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here is a brief demo of what we will work on in this part: </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AHGcs-m-vhI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Friction </font></font></h2><br>  ‚Äî     .     ,   ,  ,   . <br><br>     ‚Äî                .          : ¬´      ¬ª,  ,        ,          . <br><br>        : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/bjmbh_0FzZ0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The interactions between the bodies are quite interesting, and the repulsion in case of collisions looks realistic. </font><font style="vertical-align: inherit;">However, when objects land on a fixed platform, they all seem to repel and slide off the edges of the screen. </font><font style="vertical-align: inherit;">So it turns out because of the lack of friction simulation.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Impulses of power, again? </font></font></h3><br>      <a href="http://gamedev.tutsplus.com/tutorials/implementation/create-custom-2d-physics-engine-aabb-circle-impulse-resolution/">  </a> ,          <code>j</code> ,     .      <code>jnormal</code>  <code>jN</code> ,          . <br><br>         ,   <code>jtangent</code>  <code>jT</code> .      .           , ,  ,   .         ,   3D    . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Friction is quite simple, and we can again use our previous equation for </font></font><code>j</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, just replace all the normals </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with a tangent vector </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-208"><span class="MJXp-mrow" id="MJXp-Span-209"><span class="MJXp-mo" id="MJXp-Span-210" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-211"><span class="MJXp-mo" id="MJXp-Span-212" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">district </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-213"><span class="MJXp-mo" id="MJXp-Span-214" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-215"><span class="MJXp-mo" id="MJXp-Span-216" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-217"><span class="MJXp-mo" id="MJXp-Span-218" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-219"><span class="MJXp-mo" id="MJXp-Span-220" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-221"><span class="MJXp-mo" id="MJXp-Span-222" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-223"><span class="MJXp-mo" id="MJXp-Span-224" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-225"><span class="MJXp-mo" id="MJXp-Span-226" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-227" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-228"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-229" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></span><span class="MJXp-mspace" id="MJXp-Span-230" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">j </font></font></span><span class="MJXp-mo" id="MJXp-Span-232" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mfrac" id="MJXp-Span-233" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mo" id="MJXp-Span-234" style="margin-left: 0em; margin-right: 0.111em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- </font></font></span><span class="MJXp-mo" id="MJXp-Span-235" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mn" id="MJXp-Span-236"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-237" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">+ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-238"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mo" id="MJXp-Span-239" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-240" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-241"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-242" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-243" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-245" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-246"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-248" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-250" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ) </font></font></span><span class="MJXp-mo" id="MJXp-Span-251" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚ãÖ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-253" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mfrac" id="MJXp-Span-254" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-255"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">one</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-256"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-257"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-259"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-260" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-261" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-262" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> +</font></font></span><span class="MJXp-mfrac" id="MJXp-Span-263" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-264"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1</font></font></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-266"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-267"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-268"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-269" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-270" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></span></span></span></span></span></span></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> \: 1:\\ j = \frac{-(1 + e)(V^{B}-V^{A})\cdot n)} {\frac{1}{mass^A} + \frac{1}{mass^B}}</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Replace </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with </font></font><code>t</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-271"><span class="MJXp-mrow" id="MJXp-Span-272"><span class="MJXp-mo" id="MJXp-Span-273" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-274"><span class="MJXp-mo" id="MJXp-Span-275" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">district </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-276"><span class="MJXp-mo" id="MJXp-Span-277" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-278"><span class="MJXp-mo" id="MJXp-Span-279" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-280"><span class="MJXp-mo" id="MJXp-Span-281" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-282"><span class="MJXp-mo" id="MJXp-Span-283" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-284"><span class="MJXp-mo" id="MJXp-Span-285" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-286"><span class="MJXp-mo" id="MJXp-Span-287" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-288"><span class="MJXp-mo" id="MJXp-Span-289" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-290" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-291"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mo" id="MJXp-Span-292" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></span><span class="MJXp-mspace" id="MJXp-Span-293" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-294">j</span><span class="MJXp-mo" id="MJXp-Span-295" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-296" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mo" id="MJXp-Span-297" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mo" id="MJXp-Span-298" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-299">1</span><span class="MJXp-mo" id="MJXp-Span-300" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-301">e</span><span class="MJXp-mo" id="MJXp-Span-302" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-303" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-304" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-305"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-306" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-307" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-308">B</span></span></span><span class="MJXp-mo" id="MJXp-Span-309" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-310"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-311" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-312" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-313">A</span></span></span><span class="MJXp-mo" id="MJXp-Span-314" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-315" style="margin-left: 0.267em; margin-right: 0.267em;">‚ãÖ</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-316">t</span><span class="MJXp-mo" id="MJXp-Span-317" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mfrac" id="MJXp-Span-318" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-319">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-320">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-321">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-322">s</span><span class="MJXp-msubsup" id="MJXp-Span-323"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-324" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-325" style="vertical-align: 0.5em;">A</span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-326" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-327" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-328">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-329">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-330">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-331">s</span><span class="MJXp-msubsup" id="MJXp-Span-332"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-333" style="margin-right: 0.05em;">s</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-334" style="vertical-align: 0.5em;">B</span></span></span></span></span></span></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-8"> \:2:\\ j = \frac{-(1 + e)((V^{B}-V^{A})\cdot t)} {\frac{1}{mass^A} + \frac{1}{mass^B}}</script></p><br>      <code>t</code>     <code>n</code> ,         ,      2. <br><br>   ,    <code>t</code> .   ‚Äî  ,   ,     .      ‚Äî  ,    ! <br><br>    ,     .        .  ,   ¬´¬ª   .       ,  ¬´¬ª   . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2da/863/0ac/2da8630ac62eafce3052c27bbf5c4b7a.png"></div><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Different types of vectors in the time frame of a collision of solids. </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As was briefly described above, friction will be a vector directed in the opposite direction from the tangent vector. </font><font style="vertical-align: inherit;">This means that the direction in which we apply friction can be calculated directly, because the normal vector is in the recognition of collisions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we know this, then the tangent vector is (where </font></font><code>n</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is the normal to the collision):</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-335"><span class="MJXp-msubsup" id="MJXp-Span-336"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-337" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-338" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-339" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> = </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-340"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-341" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-342" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-343"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">B</font></font></span></span></span><span class="MJXp-mo" id="MJXp-Span-344" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-345"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-346" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-347" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-348"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A</font></font></span></span></span><span class="MJXp-mspace" id="MJXp-Span-349" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-350"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">t </font></font></span><span class="MJXp-mo" id="MJXp-Span-351" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-352"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-353" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-354" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-355" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - </font></font></span><span class="MJXp-mo" id="MJXp-Span-356" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-357"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-358" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-359" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-360" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ‚ãÖ </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-361"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span><span class="MJXp-mo" id="MJXp-Span-362" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><span class="MJXp-mo" id="MJXp-Span-363" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚àó </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-364"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-9">V^R = V^{B}-V^{A} \\ t = V^R - (V^R \cdot n) * n </script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To determine the amount of friction </font></font><code>jt</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we need only directly calculate the value of the above equations. </font><font style="vertical-align: inherit;">Soon we will look at other tricks after calculating this value, so this is not the only thing needed for our resolution of collisions:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      //   (    ,     //      ) Vec2 rv = VB - VA //    Vec2 tangent = rv - Dot( rv, normal ) * normal tangent.Normalize( ) //  ,     float jt = -Dot( rv, t ) jt = jt / (1 / MassA + 1 / MassB)</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The above code directly corresponds to Equation 2. Again, it is important to understand that the friction vector points in the direction opposite to the tangent vector. </font><font style="vertical-align: inherit;">Therefore, we must add a minus sign when the scalar product of relative velocity is tangential to calculate the relative velocity along the tangent vector. </font><font style="vertical-align: inherit;">The minus sign reverses the tangential velocity and suddenly points in the direction in which the friction should be approximated.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Amonton-Coulomb Law </font></font></h3><br> <a href="https://ru.wikipedia.org/wiki/%25D0%2597%25D0%25B0%25D0%25BA%25D0%25BE%25D0%25BD_%25D0%2590%25D0%25BC%25D0%25BE%25D0%25BD%25D1%2582%25D0%25BE%25D0%25BD%25D0%25B0_%25E2%2580%2594_%25D0%259A%25D1%2583%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25B0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Amonton-Coulomb Law</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is that part of the friction simulation in which most programmers have difficulty. </font><font style="vertical-align: inherit;">I myself had to study it long enough to find the right way to model it. </font><font style="vertical-align: inherit;">The trick is that the Amonton-Coulomb law is an inequality. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It reads:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-365"><span class="MJXp-mrow" id="MJXp-Span-366"><span class="MJXp-mo" id="MJXp-Span-367" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-368"><span class="MJXp-mo" id="MJXp-Span-369" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">district </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-370"><span class="MJXp-mo" id="MJXp-Span-371" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-372"><span class="MJXp-mo" id="MJXp-Span-373" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-374"><span class="MJXp-mo" id="MJXp-Span-375" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-376"><span class="MJXp-mo" id="MJXp-Span-377" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-378"><span class="MJXp-mo" id="MJXp-Span-379" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-380"><span class="MJXp-mo" id="MJXp-Span-381" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-382"><span class="MJXp-mo" id="MJXp-Span-383" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-384" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-385"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 </font></font></span><span class="MJXp-mo" id="MJXp-Span-386" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></span><span class="MJXp-mspace" id="MJXp-Span-387" style="width: 0em; height: 0em;"></span><span class="MJXp-msubsup" id="MJXp-Span-388"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-389" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-390" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">f</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-391" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> &lt; </font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-392"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œº </font></font></span><span class="MJXp-msubsup" id="MJXp-Span-393"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-394" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-395" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n</font></font></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-10"> \:3: \\ F_f <= \mu F_n</script></p><br>  ,        ,     <code>Œº</code> (     ). <br><br>   ‚Äî      <code>j</code> ,    .     <code>jt</code> (   )     <code>Œº</code> ,       <code>jt</code>   .   ,       ,   <code>Œº</code> .   ¬´¬ª    -  ,     ,   <code>Œº</code> . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The whole point of Amonton-Coulomb's law is to follow this restriction procedure. Such a restriction turns out to be the most difficult part of the friction simulation for resolution on the basis of impulses of force ‚Äî there is nowhere to find documentation on it, but now we will fix it! In most of the articles I have found on this topic, friction is either completely discarded, or is mentioned briefly, and the restriction procedures are implemented incorrectly (or do not exist at all). I hope you now realize that a correct understanding of this part is very important. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before explaining something, let's fully implement the constraint. The code block below is the previous example with the finished limiting procedure and the application of a friction force pulse:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//      //   (    ,     //      ) Vec2 rv = VB - VA //    Vec2 tangent = rv - Dot( rv, normal ) * normal tangent.Normalize( ) //  ,     float jt = -Dot( rv, t ) jt = jt / (1 / MassA + 1 / MassB) // PythagoreanSolve = A^2 + B^2 = C^2,  C   A  B //           float mu = PythagoreanSolve( A-&gt;staticFriction, B-&gt;staticFriction ) //         Vec2 frictionImpulse if(abs( jt ) &lt; j * mu) frictionImpulse = jt * t else { dynamicFriction = PythagoreanSolve( A-&gt;dynamicFriction, B-&gt;dynamicFriction ) frictionImpulse = -j * t * dynamicFriction } //  A-&gt;velocity -= (1 / A-&gt;mass) * frictionImpulse B-&gt;velocity += (1 / B-&gt;mass) * frictionImpulse</span></span></code> </pre> <br>                  : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-396"><span class="MJXp-mrow" id="MJXp-Span-397"><span class="MJXp-mo" id="MJXp-Span-398" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-399"><span class="MJXp-mo" id="MJXp-Span-400" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-401"><span class="MJXp-mo" id="MJXp-Span-402" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-403"><span class="MJXp-mo" id="MJXp-Span-404" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-405"><span class="MJXp-mo" id="MJXp-Span-406" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-407"><span class="MJXp-mo" id="MJXp-Span-408" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-409"><span class="MJXp-mo" id="MJXp-Span-410" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-411"><span class="MJXp-mo" id="MJXp-Span-412" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-413"><span class="MJXp-mo" id="MJXp-Span-414" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-415" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-416">4</span><span class="MJXp-mo" id="MJXp-Span-417" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-418" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-419">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-420">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-421">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-422">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-423">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-424">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-425">o</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-426">n</span><span class="MJXp-mo" id="MJXp-Span-427" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-msqrt" id="MJXp-Span-428"><span class="MJXp-surd"><span class="MJXp-right MJXp-scale8" style="font-size: 201%; margin-top: 0.07em; margin-left: -0.109em;">‚àö</span></span><span class="MJXp-root"><span class="MJXp-rule" style="border-top: 0.089em solid;"></span><span class="MJXp-box"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-429">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-430">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-431">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-432">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-433">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-434">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-435">o</span><span class="MJXp-msubsup" id="MJXp-Span-436"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-437" style="margin-right: 0.05em;">n</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-439">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-438">A</span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-440" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-441">F</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-442">r</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-443">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-444">c</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-445">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-446">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-447">o</span><span class="MJXp-msubsup" id="MJXp-Span-448"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-449" style="margin-right: 0.05em;">n</span><span class="MJXp-script-box" style="height: 1.86em; vertical-align: -0.64em;"><span class=" MJXp-script"><span><span style="margin-bottom: -0.25em;"><span class="MJXp-mn" id="MJXp-Span-451">2</span></span></span></span><span class=" MJXp-script"><span><span style="margin-top: -0.85em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-450">B</span></span></span></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-11"> \:4: \\ Friction = \sqrt[]{Friction^2_A + Friction^2_B}</script></p><br>      ,  -      ,    .      ,      .         ,    .   :    ,         . <br><br>  ,       <code>jt</code> ,      ¬´¬ª  - .  <code>j</code>  ,   ,           . <br><br><h3>     </h3><br>      -       .              . <br><br>    - :        ,   ¬´ ¬ª.          ,    ,        .        ,         . <br><br>   -      .     : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/177/c82/774/177c82774d44b39d0acb6c488a4fbd33.png"></div><br> <i>      .</i> <br><br>   ,     ,  ,     .      ,       ,  .      ,       . <br><br>        .    :        ‚Äî   ,   . <br><br>       <code>jt</code> .     <code>jt</code>     (  ),    ,     ,    ,     <code>jt</code>    . <br><br>   ,    <code>jt</code>   ,   ,     ¬´ ¬ª,         ,            . <br><br><hr><br><h2>  </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you carefully read the section "Friction", then congratulations! You have completed the most difficult (in my opinion) part of the whole tutorial. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The class is </font></font><code>Scene</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">used as a container for everything related to the physical simulation scenario. It causes and uses the results of all broad phases, contains all solids, performs collision checks and causes their resolution. It also combines all active objects. The scene also interacts with the user (for example, a programmer using a physics engine). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is an example of how the scene structure might look like:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Scene</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Scene( Vec2 gravity, real dt ); ~Scene( ); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetGravity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Vec2 gravity )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetDT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( real dt )</span></span></span><span class="hljs-function"> Body *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateBody</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( ShapeInterface *shape, BodyDef def )</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">//        ( ). void InsertBody( Body *body ) //     void RemoveBody( Body *body ) //      void Step( void ) float GetDT( void ) LinkedList *GetBodyList( void ) Vec2 GetGravity( void ) void QueryAABB( CallBackQuery cb, const AABB&amp; aabb ) void QueryPoint( CallBackQuery cb, const Point2&amp; point ) private: float dt //     float inv_dt // ,      LinkedList body_list uint32 body_count Vec2 gravity bool debug_draw BroadPhase broadphase };</span></span></span></span></code> </pre> <br>   <code>Scene</code>    .    ,         . <code>BodyDef</code> ‚Äî  ,      ,         -   . <br><br>      <code>Step()</code> .       ,   .       ,     . <br><br>     AABB   ,          AABB.        ,     . <br><br><hr><br><h2>   </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We need a simple way to select the called collision function depending on the type of two different objects. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In C ++, I know two main ways: double dispatch and a two-dimensional transition table. In my tests, I found out that the two-dimensional table is more optimal, so I will consider its implementation in detail. If you plan on using non-C and non-C ++, then I‚Äôm sure that, like a function pointer table, you can create an array of functions or functional objects (and this is another reason for choosing transition tables, and not other options that are specific to C ++).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The transition table in C or C ++ is a table of function pointers. </font><font style="vertical-align: inherit;">Indices, which are arbitrary names or constants, are used as a table index and to call a specific function. </font><font style="vertical-align: inherit;">Using a one-dimensional conversion table might look like this:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> Animal { Rabbit Duck Lion }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*talk)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function">[] </span></span>= { RabbitTalk, DuckTalk, LionTalk, }; <span class="hljs-comment"><span class="hljs-comment">//         talk[Rabbit]( ) //   RabbitTalk</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The above code actually simulates what the C ++ language itself implements through </font></font><code>    </code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, in C ++ only one-dimensional calls to virtual functions are implemented. </font><font style="vertical-align: inherit;">A two-dimensional table can be built manually. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is the pseudocode for a two-dimensional transition table for calling collision procedures:</font></font><br><br><pre> <code class="cpp hljs">collisionCallbackArray = { AABBvsAABB AABBvsCircle CirclevsAABB CirclevsCircle } <span class="hljs-comment"><span class="hljs-comment">//        //   A and B,       //    AABB   collisionCallbackArray[A-&gt;type][B-&gt;type]( A, B )</span></span></code> </pre> <br>    !                  . <br><br>   ,  <code>AABBvsCircle</code>  <code>CirclevsAABB</code>  .   !        ,       .           . <br><br><hr><br><h2>  Conclusion </h2><br>     ,          !     ,    .   ,           . <br><br>           :   .       ,     ,     . <br><br>     ,     . <br><br><h2>  4:    </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, we have considered the </font></font><a href="https://habrahabr.ru/post/336908/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">resolution of impulses of force</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the architecture of the core and friction. </font><font style="vertical-align: inherit;">In this last part of the tutorial, I will cover a very interesting topic: orientation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this part we will talk about the following topics:</font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Rotation Math </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Oriented Forms </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Collision detection </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Collision resolution </font></font></li></ul><br><hr><br><h2>  Code example </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I created a small example of the C ++ engine, and I recommend that you study the source code while reading the article, because many implementation details did not fit into the article itself. </font></font><br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/AzA_owsZU04" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br> <a href="https://github.com/tutsplus/ImpulseEngine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This GitHub repository</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> contains an example engine itself along with a Visual Studio 2010 project. For convenience, GitHub allows you to view the code without having to download it. </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other related articles</font></font></strong> <br><ul><li> <a href="http://magnos.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Philip Difenderfer</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> forks the repository to create a </font></font><a href="https://github.com/ClickerMonkey/ImpulseEngine"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java version of the</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> engine!</font></font></li></ul><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Orientation Math </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mathematics related to rotations in 2D is quite simple, however, to create everything valuable in a physics engine, knowledge of the subject is required. </font><font style="vertical-align: inherit;">Newton's second law states:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-452"><span class="MJXp-mrow" id="MJXp-Span-453"><span class="MJXp-mo" id="MJXp-Span-454" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-455"><span class="MJXp-mo" id="MJXp-Span-456" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">district </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-457"><span class="MJXp-mo" id="MJXp-Span-458" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-459"><span class="MJXp-mo" id="MJXp-Span-460" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-461"><span class="MJXp-mo" id="MJXp-Span-462" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-463"><span class="MJXp-mo" id="MJXp-Span-464" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-465"><span class="MJXp-mo" id="MJXp-Span-466" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-467"><span class="MJXp-mo" id="MJXp-Span-468" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-469"><span class="MJXp-mo" id="MJXp-Span-470" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-471" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-472"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span><span class="MJXp-mo" id="MJXp-Span-473" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></span><span class="MJXp-mspace" id="MJXp-Span-474" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-475"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">F </font></font></span><span class="MJXp-mo" id="MJXp-Span-476" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-477"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-478"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-12"> \: 1:\\ F = ma</script></p><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is a similar equation relating specifically to rotational force and angular acceleration. </font><font style="vertical-align: inherit;">However, before getting acquainted with these equations, it is worthwhile to briefly describe the vector product in two-dimensional space.</font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Vector product </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vector artwork in 3D is a </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%2592%25D0%25B5%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B8%25D0%25B7%25D0%25B2%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">well-known operation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . However, a vector product in 2D can be quite confusing, because it actually does not have a convenient geometric interpretation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A vector product in 2D, as opposed to a version in 3D, does not return a vector, but a scalar. This scalar product actually determines the magnitude of the orthogonal vector along the Z axis, as if the vector product is performed in 3D. In a sense, a vector product in 2D is a simplified version of a vector product in 3D, because it is an extension of three-dimensional vector mathematics.</font></font><br><br>    ,  :          .    ,    ,  ,    : <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-479"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-480">a</span><span class="MJXp-mtext" id="MJXp-Span-481">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-482">t</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-483">i</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-484">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-485">e</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-486">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-487">b</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> a \ times b </script> ‚Äî      ,  <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-488"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-489">b</span><span class="MJXp-mo" id="MJXp-Span-490" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-491">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14">b \times a</script>  .               . <br><br>   , <em></em>     2D   .      ,   ,    .    : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       float CrossProduct( const Vec2&amp; a, const Vec2&amp; b ) { return ax * by - ay * bx; } //   ( )    //   a   s,    Vec2 CrossProduct( const Vec2&amp; a, float s ) { return Vec2( s * ay, -s * ax ); } Vec2 CrossProduct( float s, const Vec2&amp; a ) { return Vec2( -s * ay, s * ax ); }</span></span></code> </pre> <br><h3>      </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we know from the previous parts, this equation denotes the relationship between the force acting on the body, with the mass and the acceleration of this body. </font><font style="vertical-align: inherit;">He has an analogue for rotation:</font></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-492"><span class="MJXp-mrow" id="MJXp-Span-493"><span class="MJXp-mo" id="MJXp-Span-494" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-495"><span class="MJXp-mo" id="MJXp-Span-496" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">district </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-497"><span class="MJXp-mo" id="MJXp-Span-498" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-499"><span class="MJXp-mo" id="MJXp-Span-500" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in the </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-501"><span class="MJXp-mo" id="MJXp-Span-502" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-503"><span class="MJXp-mo" id="MJXp-Span-504" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-505"><span class="MJXp-mo" id="MJXp-Span-506" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">n </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-507"><span class="MJXp-mo" id="MJXp-Span-508" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-509"><span class="MJXp-mo" id="MJXp-Span-510" style="margin-left: 0.278em; margin-right: 0.278em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e</font></font></span></span><span class="MJXp-mspace" id="MJXp-Span-511" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-512"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span><span class="MJXp-mo" id="MJXp-Span-513" style="margin-left: 0.111em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:</font></font></span><span class="MJXp-mspace" id="MJXp-Span-514" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-515"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T </font></font></span><span class="MJXp-mo" id="MJXp-Span-516" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-517"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span><span class="MJXp-mspace" id="MJXp-Span-518" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-519" style="margin-left: 0.267em; margin-right: 0.267em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">√ó</font></font></span><span class="MJXp-mspace" id="MJXp-Span-520" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-521"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œâ</font></font></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-15"> \: 2:\\ T = r \: \times \: \omega</script></p><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-522"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-523"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">T</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> stands for</font><em><font style="vertical-align: inherit;">torque</font></em><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">Torque is the force of rotation.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> T </script><font style="vertical-align: inherit;"></font><em><font style="vertical-align: inherit;"></font></em><font style="vertical-align: inherit;"></font><br><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-524"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-525"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is a vector from the center of mass (CM) to a specific point of the object.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> r </script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-526"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-527"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be considered the "radius" from the CM to the point. </font><font style="vertical-align: inherit;">Each unique point of the object needs its own value.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> r </script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-528"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-529"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for substitution in Equation 2.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> r </script><font style="vertical-align: inherit;"></font><br><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-530"><span class="MJXp-mtext" id="MJXp-Span-531">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-532"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">o </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-533"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-534"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">e </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-535"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-536"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is called ‚Äúomega‚Äù and means rotation speed. This ratio will be used to integrate the angular velocity of the solid body.</font><font style="vertical-align: inherit;">It is important to understand that linear velocity is the speed of the CM of a solid body. In the previous part, all objects did not have rotation components, therefore the linear velocity of the CM was the same as the speed of all points of the body. When an orientation is added, points remote from the CM rotate faster than those closest to the CM. This means that we need a new equation to find the velocity of the point of the body, because the bodies can now rotate and move simultaneously.</font><font style="vertical-align: inherit;">Use the following equation to understand the relationship between the point of the body and the speed of this point:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-20"> \ omega </script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-537"><span class="MJXp-mrow" id="MJXp-Span-538"><span class="MJXp-mo" id="MJXp-Span-539" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-540"><span class="MJXp-mo" id="MJXp-Span-541" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-542"><span class="MJXp-mo" id="MJXp-Span-543" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-544"><span class="MJXp-mo" id="MJXp-Span-545" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-546"><span class="MJXp-mo" id="MJXp-Span-547" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-548"><span class="MJXp-mo" id="MJXp-Span-549" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-550"><span class="MJXp-mo" id="MJXp-Span-551" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-552"><span class="MJXp-mo" id="MJXp-Span-553" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-554"><span class="MJXp-mo" id="MJXp-Span-555" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-556" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-557">3</span><span class="MJXp-mo" id="MJXp-Span-558" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-559" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-560">œâ</span><span class="MJXp-mo" id="MJXp-Span-561" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-562">r</span><span class="MJXp-mspace" id="MJXp-Span-563" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-564" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-565">v</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-21"> \: 3:\\ \omega = r \: \times v</script></p><br><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-566"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-567">v</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> v </script>   .      ,      <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-568"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-569">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> r </script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-570"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-571">v</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> v </script>  . <br><br>       3   : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-572"><span class="MJXp-mrow" id="MJXp-Span-573"><span class="MJXp-mo" id="MJXp-Span-574" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-575"><span class="MJXp-mo" id="MJXp-Span-576" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-577"><span class="MJXp-mo" id="MJXp-Span-578" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-579"><span class="MJXp-mo" id="MJXp-Span-580" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-581"><span class="MJXp-mo" id="MJXp-Span-582" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-583"><span class="MJXp-mo" id="MJXp-Span-584" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-585"><span class="MJXp-mo" id="MJXp-Span-586" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-587"><span class="MJXp-mo" id="MJXp-Span-588" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-589"><span class="MJXp-mo" id="MJXp-Span-590" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-591" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-592">4</span><span class="MJXp-mo" id="MJXp-Span-593" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-594" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-595">v</span><span class="MJXp-mo" id="MJXp-Span-596" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-597">œâ</span><span class="MJXp-mspace" id="MJXp-Span-598" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mo" id="MJXp-Span-599" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-600">r</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-25"> \: 4:\\ v = \omega \: \times r</script></p><br>     ,       .     ,       ,  .  ,  ,   ,    ,     <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-601"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-602">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> r </script>   . <br><br><h3>  </h3><br>         Z.          ,       .   ,     ,  ,  .   ¬´ ¬ª      . <br><br>  - ,  ‚Äî    .     ,      . <br><br>  ,           ,   .      ,   ,         . .           . <br><br><h3>  </h3><br>            .    ,   : <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RigidBody</span></span></span><span class="hljs-class"> {</span></span> Shape *shape <span class="hljs-comment"><span class="hljs-comment">//   Vec2 position Vec2 velocity float acceleration //   float orientation //  float angularVelocity float torque };</span></span></code> </pre> <br>             .        (     ): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> Vec2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gravity</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">-10.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> velocity +</span></span>= force * (<span class="hljs-number"><span class="hljs-number">1.0f</span></span> / mass + gravity) * dt angularVelocity += torque * (<span class="hljs-number"><span class="hljs-number">1.0f</span></span> / momentOfInertia) * dt position += velocity * dt orient += angularVelocity * dt</code> </pre> <br>     ,    ,          .          , ,    ,     ,     ,    . <br><br><h3> <code>Mat22</code> </h3> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As shown above, the orientation should be stored as one value in radians, however, it is often more convenient for some figures to store a small rotation matrix. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A good example of this is the oriented boundary rectangle (Oriented Bounding Box, OBB). OBB consists of width and height, which can be represented as vectors. These two dimension vectors can be rotated using a two-by-two rotation matrix representing the OBB axes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I recommend adding a matrix class to your math library </font></font><code>Mat22</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. I myself use my own small math library, which is in the open source demo. Here is an example of what an object might look like:</font></font><br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mat22</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m00, m01 <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> m10, m11; }; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> {</span></span> Vec2 xCol; Vec2 yCol; }; }; };</code> </pre> <br>     :   ,    , ,   <code>Vec2</code> ,    <code>Mat22</code> ,   . <br><br>         <code>x</code>  <code>y</code> .     : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">Mat22 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">m</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( PI / </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">2.0f</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span></span>; Vec2 r = m.ColX( ); <span class="hljs-comment"><span class="hljs-comment">//    x</span></span></code> </pre> <br>          : <code>x</code>  <code>y</code> .  ,           ,         .          ,             . <br><br>      : <br><br><pre> <code class="cpp hljs">Mat22::Mat22( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec2&amp; x, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec2&amp; y ) { m00 = xx; m01 = xy; m01 = yx; m11 = yy; } <span class="hljs-comment"><span class="hljs-comment">//  Mat22::Mat22( const Vec2&amp; x, const Vec2&amp; y ) { xCol = x; yCol = y; }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since the most important operation of the rotation matrix is ‚Äã‚Äãto perform turns based on the angle, it is important to have possible to create a matrix from the angle and multiply the vector by this matrix (to rotate the vector counterclockwise by the angle the matrix was created with): </font></font><br><br><pre> <code class="cpp hljs">Mat2( real radians ) { real c = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>( radians ); real s = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>( radians ); m00 = c; m01 = -s; m10 = s; m11 = c; } <span class="hljs-comment"><span class="hljs-comment">//   const Vec2 operator*( const Vec2&amp; rhs ) const { return Vec2( m00 * rhs.x + m01 * rhs.y, m10 * rhs.x + m11 * rhs.y ); }</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For the sake of brevity, I will not deduce why the anti-clockwise rotation matrix has the following form: </font></font><br><br><pre> <code class="cpp hljs">a = angle <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>( a ), -<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>( a ) <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>( a ), <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>( a )</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, it is important to at least know that this is the kind of rotation matrix. </font><font style="vertical-align: inherit;">More information about the rotation matrix can be found on the </font></font><a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0_%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25BE%25D1%2580%25D0%25BE%25D1%2582%25D0%25B0"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">page in Wikipedia</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other related articles</font></font></strong> <br><ul><li> <a href="https://habrahabr.ru/post/334580/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create your own software 3D engine</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , part 2: linear transformations</font></font></li></ul><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Transformation to base </font></font></h2><br>        .   ‚Äî   ,    .       ,         . <br><br>      ,     .     ,         .       (   ),     .     <code>Mat22</code> .       <code>u</code> . <br><br>             . <br><br>      ,             .        .         ! <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/98f/e3e/dd6/98fe3edd6e8e2638333e020656891dd6.png"></div><br> <i>  ( )        .</i> <br><br>     ,        ,    ,          AABB  OBB,          . <br><br>                  ,    .      ,   ,       . <br><br><hr><br><h2>      </h2><br>           .     .    . <br><br><h3>    </h3><br>            .         (  )    <a href="http://gamedev.tutsplus.com/tutorials/implementation/collision-detection-with-the-separating-axis-theorem/">   </a> (Separating Axis Theorem, SAT). <br><br>               ,  <a href="http://gdcvault.com/play/1017646/Physics-for-Game-Programmers-The">     GDC 2013</a> (  <a href="https://code.google.com/p/box2d/downloads/detail%3Fname%3DDGregorius_GDC2013.zip%26amp%3Bcan%3D2%26amp%3Bq%3D"> </a> ). <br><br> ,    ‚Äî    . <br><br><h3>   </h3><br>    ‚Äî  ,     .         ,      . <br><br>                .   ,       : <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//       Vec2 GetSupport( const Vec2&amp; dir ) { real bestProjection = -FLT_MAX; Vec2 bestVertex; for(uint32 i = 0; i &lt; m_vertexCount; ++i) { Vec2 v = m_vertices[i]; real projection = Dot( v, dir ); if(projection &gt; bestProjection) { bestVertex = v; bestProjection = projection; } } return bestVertex; }</span></span></code> </pre> <br>      .          ,          .           . <br><br><h3>    </h3><br>             ( A   B).      ,         A         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c27/f70/288/c27f702887f5e3e32fdbda224d463f85.png"></div><br><br>        ,     .                  . ,       ,     . <br><br>             .   ,     . <br><br>      ,          <code>GetSupport</code> : <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">real </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FindAxisLeastPenetration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( uint32 *faceIndex, PolygonShape *A, PolygonShape *B )</span></span></span><span class="hljs-function"> </span></span>{ real bestDistance = -FLT_MAX; uint32 bestIndex; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(uint32 i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; A-&gt;m_vertexCount; ++i) { <span class="hljs-comment"><span class="hljs-comment">//      A Vec2 n = A-&gt;m_normals[i]; //     B  -n Vec2 s = B-&gt;GetSupport( -n ); //      A,   //   B Vec2 v = A-&gt;m_vertices[i]; //     (   B) real d = Dot( n, s - v ); //    if(d &gt; bestDistance) { bestDistance = d; bestIndex = i; } } *faceIndex = bestIndex; return bestDistance; }</span></span></code> </pre> <br>       ,    ,   ,      (  ,    ). <br><br>     ,       A  B. <br><br><h3>       </h3><br>          ,          .    ,    ( Box2D   ,  Blizzard)  <a href="https://code.google.com/p/box2d/downloads/list"> ,    </a> . <br><br>       .          . <br><br>  ,      ,         . <br><br><h3>    </h3><br>       ,       .    ,        ,       :               . <br><br>        ,      ,      . <br><br>            .       ,  <em> </em> .   : <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1f0/fbe/e2f/1f0fbee2f9adacae61f267a9da25e119.png"></div><br> <i>    .</i> <br><br>  ,     ,    ,      . ,         .  ,          ,           . <br><br>      ,             .       . <br><br>  ,       ,       .    ,       ,    90  ,    .         . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e1e/56c/c0a/e1e56cc0af1257a9a1016c25ae15a190.png"></div><br> <i>         .</i> <br><br>   90   ,    .             90 ,            .     ,                  ,   ,    ,  . <br><br>  ,         .    ,    90 ,  ,  . <br><br><hr><br><h2>   </h2><br>     :          .           ,        ,          . <br><br>         .      . <br><br>       ,          : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-603"><span class="MJXp-mrow" id="MJXp-Span-604"><span class="MJXp-mo" id="MJXp-Span-605" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-606"><span class="MJXp-mo" id="MJXp-Span-607" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-608"><span class="MJXp-mo" id="MJXp-Span-609" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-610"><span class="MJXp-mo" id="MJXp-Span-611" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-612"><span class="MJXp-mo" id="MJXp-Span-613" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-614"><span class="MJXp-mo" id="MJXp-Span-615" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-616"><span class="MJXp-mo" id="MJXp-Span-617" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-618"><span class="MJXp-mo" id="MJXp-Span-619" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-620"><span class="MJXp-mo" id="MJXp-Span-621" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-622" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-623">5</span><span class="MJXp-mo" id="MJXp-Span-624" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-625" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-626">j</span><span class="MJXp-mo" id="MJXp-Span-627" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-628" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mo" id="MJXp-Span-629" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mo" id="MJXp-Span-630" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-631">1</span><span class="MJXp-mo" id="MJXp-Span-632" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-633">e</span><span class="MJXp-mo" id="MJXp-Span-634" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-635" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-636" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-637"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-638" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-639" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-640">A</span></span></span><span class="MJXp-mo" id="MJXp-Span-641" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-642"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-643" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-644" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-645">B</span></span></span><span class="MJXp-mo" id="MJXp-Span-646" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-647" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-648">t</span><span class="MJXp-mo" id="MJXp-Span-649" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mfrac" id="MJXp-Span-650" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-651">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-652">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-653">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-654">s</span><span class="MJXp-msubsup" id="MJXp-Span-655"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-656" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-657" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-658">A</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-659" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-660" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-661">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-662">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-663">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-664">s</span><span class="MJXp-msubsup" id="MJXp-Span-665"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-666" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-667" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-668">B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-27"> \: 5: \\ j = \frac{-(1 + e)((V^{A} - V^{B}) * t)}{\frac{1}{mass^{A}} + \frac{1}{mass^{B}}}</script></p><br>     ,      : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-669"><span class="MJXp-mrow" id="MJXp-Span-670"><span class="MJXp-mo" id="MJXp-Span-671" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-672"><span class="MJXp-mo" id="MJXp-Span-673" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-674"><span class="MJXp-mo" id="MJXp-Span-675" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-676"><span class="MJXp-mo" id="MJXp-Span-677" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-678"><span class="MJXp-mo" id="MJXp-Span-679" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-680"><span class="MJXp-mo" id="MJXp-Span-681" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-682"><span class="MJXp-mo" id="MJXp-Span-683" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-684"><span class="MJXp-mo" id="MJXp-Span-685" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-686"><span class="MJXp-mo" id="MJXp-Span-687" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-688" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-689">6</span><span class="MJXp-mo" id="MJXp-Span-690" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-691" style="width: 0em; height: 0em;"></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-692">j</span><span class="MJXp-mo" id="MJXp-Span-693" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mfrac" id="MJXp-Span-694" style="vertical-align: 0.25em;"><span class="MJXp-box"><span class="MJXp-mo" id="MJXp-Span-695" style="margin-left: 0em; margin-right: 0.111em;">‚àí</span><span class="MJXp-mo" id="MJXp-Span-696" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mn" id="MJXp-Span-697">1</span><span class="MJXp-mo" id="MJXp-Span-698" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-699">e</span><span class="MJXp-mo" id="MJXp-Span-700" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-701" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mo" id="MJXp-Span-702" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msubsup" id="MJXp-Span-703"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-704" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-705" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-706">A</span></span></span><span class="MJXp-mo" id="MJXp-Span-707" style="margin-left: 0.267em; margin-right: 0.267em;">‚àí</span><span class="MJXp-msubsup" id="MJXp-Span-708"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-709" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-710" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-711">B</span></span></span><span class="MJXp-mo" id="MJXp-Span-712" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-713" style="margin-left: 0.267em; margin-right: 0.267em;">‚àó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-714">t</span><span class="MJXp-mo" id="MJXp-Span-715" style="margin-left: 0em; margin-right: 0em;">)</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box"><span class="MJXp-mfrac" id="MJXp-Span-716" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-717">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-718">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-719">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-720">s</span><span class="MJXp-msubsup" id="MJXp-Span-721"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-722" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-723" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-724">A</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-725" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-726" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mn" id="MJXp-Span-727">1</span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-728">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-729">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-730">s</span><span class="MJXp-msubsup" id="MJXp-Span-731"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-732" style="margin-right: 0.05em;">s</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-733" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-734">B</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-735" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-736" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mo" id="MJXp-Span-737">(</span><span class="MJXp-msubsup" id="MJXp-Span-738"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-739" style="margin-right: 0.05em;">r</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-740" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-741">A</span></span></span><span class="MJXp-mo" id="MJXp-Span-742">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-743">t</span><span class="MJXp-msubsup" id="MJXp-Span-744"><span class="MJXp-mo" id="MJXp-Span-745" style="margin-right: 0.05em;">)</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-746" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-747">2</span></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-748"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-749" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-750" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-751">A</span></span></span></span></span></span></span></span><span class="MJXp-mo" id="MJXp-Span-752" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mfrac" id="MJXp-Span-753" style="vertical-align: 0.25em;"><span class="MJXp-box MJXp-script"><span class="MJXp-mo" id="MJXp-Span-754">(</span><span class="MJXp-msubsup" id="MJXp-Span-755"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-756" style="margin-right: 0.05em;">r</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-757" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-758">B</span></span></span><span class="MJXp-mo" id="MJXp-Span-759">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-760">t</span><span class="MJXp-msubsup" id="MJXp-Span-761"><span class="MJXp-mo" id="MJXp-Span-762" style="margin-right: 0.05em;">)</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-763" style="vertical-align: 0.5em;"><span class="MJXp-mn" id="MJXp-Span-764">2</span></span></span></span><span class="MJXp-box" style="margin-top: -0.9em;"><span class="MJXp-denom"><span><span class="MJXp-rule" style="height: 1em; border-top: none; border-bottom: 1px solid; margin: 0.1em 0px;"></span></span><span><span class="MJXp-box MJXp-script"><span class="MJXp-msubsup" id="MJXp-Span-765"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-766" style="margin-right: 0.05em;">I</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-767" style="vertical-align: 0.5em;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-768">B</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-28"> \: 6: \\ j = \frac{-(1 + e)((V^{A} - V^{B}) * t)}{\frac{1}{mass^{A}} + \frac{1}{mass^{B}} + \frac{(r^{A} \times t)^{2}}{I^{A}} + \frac{(r^{B} \times t)^{2}}{I^{B}}}</script></p><br>     <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-769"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-770">r</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> r </script> ‚Äî   ¬´¬ª,         .      <a href="http://chrishecker.com/images/e/e7/Gdmphys3.pdf">  </a> . <br><br>  ,      : <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-771"><span class="MJXp-mrow" id="MJXp-Span-772"><span class="MJXp-mo" id="MJXp-Span-773" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-774"><span class="MJXp-mo" id="MJXp-Span-775" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-776"><span class="MJXp-mo" id="MJXp-Span-777" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-778"><span class="MJXp-mo" id="MJXp-Span-779" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-780"><span class="MJXp-mo" id="MJXp-Span-781" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-782"><span class="MJXp-mo" id="MJXp-Span-783" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-784"><span class="MJXp-mo" id="MJXp-Span-785" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-786"><span class="MJXp-mo" id="MJXp-Span-787" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mrow" id="MJXp-Span-788"><span class="MJXp-mo" id="MJXp-Span-789" style="margin-left: 0.278em; margin-right: 0.278em;"></span></span><span class="MJXp-mspace" id="MJXp-Span-790" style="width: 0.222em; height: 0em;"></span><span class="MJXp-mn" id="MJXp-Span-791">7</span><span class="MJXp-mo" id="MJXp-Span-792" style="margin-left: 0.111em; margin-right: 0.167em;">:</span><span class="MJXp-mspace" id="MJXp-Span-793" style="width: 0em; height: 0em;"></span><span class="MJXp-msup" id="MJXp-Span-794"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-795" style="margin-right: 0.05em;">V</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-796" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mo" id="MJXp-Span-797" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-798">V</span><span class="MJXp-mo" id="MJXp-Span-799" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-800">œâ</span><span class="MJXp-mo" id="MJXp-Span-801" style="margin-left: 0.267em; margin-right: 0.267em;">√ó</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-802">r</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-30"> \: 7: \\ V' = V + \omega \times r</script></p><br>         : <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Body::ApplyImpulse( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec2&amp; impulse, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Vec2&amp; contactVector ) { velocity += <span class="hljs-number"><span class="hljs-number">1.0f</span></span> / mass * impulse; angularVelocity += <span class="hljs-number"><span class="hljs-number">1.0f</span></span> / inertia * Cross( contactVector, impulse ); }</code> </pre> <br><hr><br><h2>  Conclusion </h2><br>      .      ,    ,  ,      . <br><br>     ,    !      ‚Äî     ,    . </div><p>Source: <a href="https://habr.com/ru/post/341540/">https://habr.com/ru/post/341540/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../341528/index.html">Implementing a CA PPM Project Management System in Mars</a></li>
<li><a href="../341530/index.html">SOC for beginners. SOC tasks: security control</a></li>
<li><a href="../341532/index.html">uSpeech - the story of a startup</a></li>
<li><a href="../341536/index.html">ITMO University Digest: our developments in 2017. Part 2</a></li>
<li><a href="../341538/index.html">Crossbrowser layout</a></li>
<li><a href="../341542/index.html">How to make friends with UIKit</a></li>
<li><a href="../341544/index.html">Fiztekh launches online courses in higher mathematics to prepare for admission to the magistracy</a></li>
<li><a href="../341546/index.html">How to start young mobile game developers from Russia [Part 4]</a></li>
<li><a href="../341548/index.html">Google MAPs API in android or how to work with maps faster</a></li>
<li><a href="../341550/index.html">Autumn Postgres at Raiffeisenbank</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>