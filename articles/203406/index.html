<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Stack Overflow Works - Iron</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to say that Stack Overflow is a large-scale project, but it is not. I mean, we have achieved a lot, but I cannot call our project ‚Äúbig‚Äù, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Stack Overflow Works - Iron</h1><div class="post__text post__text-html js-mediator-article">  I would like to say that <a href="http://stackoverflow.com/">Stack Overflow</a> is a large-scale project, but it is not.  I mean, we have achieved a lot, but I cannot call our project ‚Äúbig‚Äù, it is still early.  Let me give you an example of some numbers - how much we are dealing with right now.  Statistics slice for 24 hours from November 12, 2013.  This is a normal weekday.  I note that information is presented here only on our own computing power, without a CDN. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/698/7e4/647/6987e4647dac106784e1f1a175bc4050.jpg"><br><a name="habracut"></a><br><h4>  Statistics </h4><br><ul><li>  148,084,883 HTTP requests to our load balancer </li><li>  36,095,312 of them are real page loads </li><li>  833,992,982,627 bytes (776 GB) HTTP traffic sent </li><li>  286,574,644,032 bytes (267 GB) of traffic received </li><li>  1,125,992,557,312 bytes (1,048 GB) of traffic sent </li><li>  334,572,103 SQL requests for HTTP requests </li><li>  412,865,051 request to Redis servers </li><li>  3,603,418 requests to tag handler (separate service) </li><li>  558,224,585 ms (155 hours) was spent on processing SQL queries </li><li>  99,346,916 ms (27 hours) took to wait for a response from the Redis servers </li><li>  132,384,059 ms (36 hours) passed to process requests by tags </li><li>  2,728,177,045 ms (757 hours) ASP.Net scripts worked </li></ul><br><br>  I will definitely need to write a post about how we get these numbers, but these statistics (except for traffic) are calculated only thanks to HTTP logs.  How did it happen so many hours per day?  We call it magic.  Most people call this ‚Äúmultiple servers with multi-core processors,‚Äù but we write off everything as magic.  Stack Exchange runs on the following hardware: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  4 MS SQL servers </li><li>  11 IIS Web Servers </li><li>  2 <a href="http://redis.io/">Redis</a> servers </li><li>  3 servers processing tags (absolutely everything related to tags, for example, query <a href="http://stackoverflow.com/questions/tagged/c%2B%2B">/ questions / tagged / c ++</a> ) </li><li>  3 <a href="http://www.elasticsearch.org/">ElasticSearch</a> servers </li><li>  2 load balancers (implementation of <a href="http://haproxy.1wt.eu/">HAProxy</a> ) </li><li>  2 switches (each based on <a href="http://www.cisco.com/en/US/prod/collateral/switches/ps9441/ps9670/data_sheet_c78-618603.html">Nexus 5596</a> + <a href="http://www.cisco.com/en/US/prod/collateral/switches/ps9441/ps10110/data_sheet_c78-507093.html">Fabric Extenders</a> ) </li><li>  2 <a href="http://www.cisco.com/en/US/prod/collateral/vpndevc/ps6032/ps6094/ps6120/data-sheet-c78-729807.html">Cisco 5525-X ASAs Firewall</a> </li><li>  2 <a href="http://www.cisco.com/en/US/products/ps10541/">Cisco 3945</a> Router </li></ul><br><br>  How all this beauty looks can be seen in the first photo (above). <br><br>  We are not just hosting our sites.  The nearest desk is a server for virtualization (vmware) and supporting infrastructure that does not directly affect the service, for example, deployment machines, domain controllers, monitoring, an additional database for administrators, and so on.  2 SQL servers from the list above were backup servers until recently - now they are used for read-only queries, so that we can continue to scale without thinking about the load on the database for a long time.  2 web servers from that list are intended for development and peripheral tasks; therefore, they consume little traffic. <br><br><h4>  About equipment </h4><br>  If we imagine at the moment that something happened and all the redundancy of the infrastructure disappeared, then the whole Stack Exchange can work on the following equipment without loss of performance: <br><br><ul><li>  2 SQL servers (Stack Overflow on one machine, everything else on another, although we are sure that they can work on one server) </li><li>  2 Web servers (maybe three, but I believe that two will suffice) </li><li>  1 Redis server </li><li>  1 tag server </li><li>  1 ElasticSearch server </li><li>  1 load balancer </li><li>  1 switch </li><li>  1 ASA firewall </li><li>  1 router </li></ul><br><br>  We will need to try to disable some of the servers specifically to test it out.  :) <br><br>  Below is the average hardware configuration: <br><br><ul><li>  SQL servers run 384 GB of RAM with 1.8TB file storage (SSD) </li><li>  Redis servers run on machines with 96 GB of RAM </li><li>  ElasticSearch Servers - 196 GB of RAM </li><li>  Tag processing servers require the fastest processors we can get. </li><li>  Switches - 10 Gbps for each port. </li><li>  The web server is nothing special - 32 GB of RAM, 2 quad-core processors and 300 GB SSD storage for each. </li><li>  Servers that do not have a 2x10 Gbit / s network (for example, SQL) are connected by four connections of 1 Gbit / s each. </li></ul><br><br>  It seems that 20Gbps is too much?  Yes, for example, SQL servers do not load the network more than 100‚Äì200 Mbit / s at peak, but do not forget about backup, rebuilding the topology - this can be needed at any time and then the network will be fully utilized.  Such amount of memory and SSD will be able to download this channel completely. <br><br><h4>  Storage </h4><br>  We currently have about 2 TB of data in SQL (1.06 / 1.16 TB on the first cluster of 18 SSDs and 0.889 / 1.45 TB on the second, consisting of 4 SSDs).  Perhaps it would be worth thinking about the clouds, but now we use SSD and the recording time in the database is literally 0 milliseconds.  With a database in memory and two cache levels in front of it, Stack Overflow has a read-to-write ratio of 40 to 60. Yes, that's right, she writes 60% of the database time. <br>  Web servers use 320 GB SSDs in RAID1. <br>  ElasticSearch servers are also equipped with 300 GB SSD disks.  This is important, as there is often rewriting and indexing. <br><br>  We also did not mention the SAN.  This is a <a href="http://www.dell.com/us/business/p/equallogic-ps6110x/pd">DELL Equal Logic PS6110X</a> with 24 SAS 10K disks and a 2x10 Gbps connection.  It is used as storage for virtual servers VmWare as a cloud and is not associated with the site itself.  If this server crashes, sites will not even know about it for a while. <br><br><h4>  What's next? </h4><br>  What are we going to do about it?  We want more performance - this is very important for us.  On November 12, the page loaded an average of 28 milliseconds.  We try to keep the download speed no longer than 50 milliseconds.  Here are the average statistics for downloading popular pages on this day: <br><br><ul><li>  Question pages with answers - 28 milliseconds (29.7 million requests) </li><li>  User Profiles - 39 milliseconds (1.7 mil. Requests) </li><li>  The list of questions - 78 milliseconds (1.1 million queries) </li><li>  The home page is 65 milliseconds (1 million requests), which is very slow.  We will fix it soon. </li></ul><br><br>  We monitor download speeds by recording timings.  Due to this, we can make a very visual schedule: <br><img src="https://habrastorage.org/getpro/habr/post_images/2f6/885/b45/2f6885b455406085e9211ce79fb6fd70.png"><br><br><h4>  Scalability in the future </h4><br>  Obviously, all services are now running at low load.  Web servers consume an average of 5-15% of the processor, 15.5 GB of RAM, and 20-40 MB / s of network bandwidth.  The average processor load of the database server is 5-10%, 365 GB of RAM and 100-200 Mbit / s of network bandwidth.  Due to this, we can fully develop and, which is very important, we are insured against a fall in case of an increase in load - an error in the code or any other failure. <br><br>  Here is a screenshot of the Opserver: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/710/6c9/e33/7106c9e33393a16e63c8db87a6224a31.png"><br><br>  The main reason that the load is so low is the efficiency of the code.  Let the post and is devoted to another, but the effective code - a critical place to scale your hardware in the future.  Everything that you did, but did not have to do, will cost you more than if you did not do it at all - a similar rule applies to inefficient code.  Cost is understood as the following: power consumption, hardware cost (because you need more servers, or they need to be more powerful), developers who are trying to grasp more complex code (although, to be honest, optimized code doesn't necessarily become easier) and most likely a slow render pages - which is expressed in the reaction of the user who will not wait for the download of another page ... or even no longer go to you.  The price of an ineffective code can be much higher than you think. <br><br>  So, today we met with the way Stack Overflow works on the current hardware.  Next time we will find out why we are not in a hurry to move to the clouds. </div><p>Source: <a href="https://habr.com/ru/post/203406/">https://habr.com/ru/post/203406/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../203394/index.html">Achiver: what's what</a></li>
<li><a href="../203396/index.html">Preparing video for sound design. Which codec to choose</a></li>
<li><a href="../203398/index.html">There is an error in almost all implementations of binary search and merge sort</a></li>
<li><a href="../203400/index.html">The digest of interesting materials from the world of web development and IT for the last week No. 84 (November 16 - 23, 2013)</a></li>
<li><a href="../203402/index.html">ThL W8s - a powerful smartphone with glass protection Gorilla Glass 3</a></li>
<li><a href="../203408/index.html">From idea to App Store: 24 hours, 2 applications</a></li>
<li><a href="../203410/index.html">US police caught a "gift"</a></li>
<li><a href="../203418/index.html">The Internet and the credibility of people. Prepayment, implementation details</a></li>
<li><a href="../203422/index.html">Motorola will use 3D printing to produce a Project Ara modular phone.</a></li>
<li><a href="../203424/index.html">Microsoft sold 1 million Xbox One in less than a day</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>