<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hidden Markov chains, Bauma-Welch algorithm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hidden models / Markov chains are one of the approaches to data presentation. I really liked how many of these approaches are summarized in this artic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hidden Markov chains, Bauma-Welch algorithm</h1><div class="post__text post__text-html js-mediator-article">  Hidden models / Markov chains are one of the approaches to data presentation.  I really liked how many of these approaches are summarized in <a href="http://habrahabr.ru/company/surfingbird/blog/177889/">this article</a> . <br><br>  In continuation of my <a href="http://habrahabr.ru/post/180109/">previous article, the</a> description of hidden Markov models, let us ask ourselves a question: where can we get a good model?  The answer is quite standard, take a good model and make it a good one. <br><br>  Let me remind an example: we need to implement a lie detector, which, by trembling of human hands, determines whether it speaks the truth or not.  Suppose when a person lies, his hands are shaking a little more, but we do not know how much.  Take a model at random, run the Viterbi algorithm from the previous article and get some rather strange results: <br><img src="https://habrastorage.org/storage2/e4c/622/5f1/e4c6225f162e1efd9387f0191c1e2b86.png"><br><a name="habracut"></a><br>  There is no point in the resulting splitting;  rather, there is, but not the one that I would like to see.  The first question is how to estimate the likelihood of an available sample in the selected model.  And the second question is how to find such a model in which the available sample would be the most plausible, that is, how to evaluate the quality and how to organize the adaptability to the new data.  The forward-backward procedure and the Baum-Welch reestimation procedure are exactly what they answer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The forward-backward procedure allows you to estimate the likelihood that a sample of observed values ‚Äã‚Äãwill appear in this HMM model <img src="https://habrastorage.org/getpro/habr/post_images/36b/656/2a8/36b6562a88c03a8fac4b242f1b324f9e.png" alt="O = (o_1, \ ldots, o_ {T_m})">  (Designations are taken from the previous article).  Denote the estimated function as <img src="https://habrastorage.org/getpro/habr/post_images/2b0/bd8/821/2b0bd8821cfba0ca0973a23f06ee3882.png" alt="P (O | HMM)">  .  And we introduce two additional functions: <br><br><pre><code class="hljs matlab">AlphaFunc&lt;-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S,I,T,P,O,Tm)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">la</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Es</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(P,O[1])</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(la)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t in 2:Tm)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">la</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">((la*Es(P,O[t])</span></span></span><span class="hljs-function">)%*%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(alpha,la)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(alpha)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BetaFunc</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S,I,T,P,O,Tm)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lb</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1,length(S)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beta</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lb)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t in Tm:2)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lb</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">as</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vector</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T%*%(Es(P,O[t])</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lb</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beta</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lb, beta)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(beta)</span></span></span><span class="hljs-function"> }</span></span></code> </pre> <br>  Functions <img src="http://habrastorage.org/getpro/habr/post_images/120/241/fe4/120241fe47b639bdfc2972c5f20b35bf.png" alt="\ alpha_t (s)">  , <img src="http://habrastorage.org/getpro/habr/post_images/417/07d/007/41707d0075722e7faebd372015105e94.png" alt="\ beta_t (s)">  have the following interesting properties: <br><br><img src="http://habrastorage.org/getpro/habr/post_images/5ad/210/975/5ad210975f48774a6e7cf05905bec343.png" alt="\ sum_ {s \ in S} \ beta_1 (s) \ pi_s f_s (o_1) = \ sum_ {s \ in S} \ alpha_ {T_m} (s) = P (O | HMM) = \ sum_ {s \ in S} \ alpha_t (s) \ beta_t (s), \ forall t \ in \ overline {1, T_m}."><br>  So, we can already estimate the appearance of the O sample in the HMM model and find the sequence of hidden states <img src="http://habrastorage.org/getpro/habr/post_images/8a2/b60/ebf/8a2b60ebfacb96a0f5706e9203496976.png" alt="Q ^ *">  .  It remains an open question how to find a model in which the probability of the appearance of an existing sample will be maximum, that is, <img src="http://habrastorage.org/getpro/habr/post_images/87c/29f/339/87c29f339efbd8e4dbcdeea69c6e7a69.png" alt="P (O | HMM ^ ‚Äã‚Äã*) = \ max \ limits_ {HMM \ in \ Omega} P (O | HMM)">  where <img src="http://habrastorage.org/getpro/habr/post_images/26e/1ba/d5a/26e1bad5aa12d05a634e00702403776e.png" alt="\ Omega">  some set of valid models.  As stated, there is no formal algorithm for finding the optimum, but often you can at least a little closer to ‚Äúperfection‚Äù, due to some modification of the model.  This is exactly how iterative <a href="http://ru.wikipedia.org/wiki/EM-%25E0%25EB%25E3%25EE%25F0%25E8%25F2%25EC">EM algorithms work</a> . <br><br>  So let's have an initial model. <img src="http://habrastorage.org/getpro/habr/post_images/fd6/b43/898/fd6b4389832a0e5f709efe6c0f7bb46a.png" alt="HMM ^ ‚Äã‚Äãk">  need to find such a model <img src="http://habrastorage.org/getpro/habr/post_images/36b/745/9a8/36b7459a8e508df22d3aa8af1eacc778.png" alt="HMM ^ ‚Äã‚Äã{k + 1}">  , what <img src="http://habrastorage.org/getpro/habr/post_images/750/117/d31/750117d31106be143d7f87b079b3980b.png" alt="P (O | HMM ^ ‚Äã‚Äã{k + 1}) \ geq P (O | HMM ^ ‚Äã‚Äã{k})">  .  Let's get started <br><br>  We introduce two more auxiliary functions: <br><br><pre> <code class="hljs matlab">xiGamma&lt;-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,alpha,beta,S,T,P,O)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xi</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">matrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(0,nrow=length(S)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ncol</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">denom</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[,t]</span></span></span><span class="hljs-function">%*%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[,t]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sin in S)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sout in S)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nom</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alpha</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sin,t]</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sin,sout]</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Es</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(P,O[t+1])</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sout]</span></span></span><span class="hljs-function">*</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beta</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sout,t+1]</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xi</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[sin,sout]</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">nom</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">denom</span></span></span><span class="hljs-function"> } } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list(xi=xi,g=rowSums(xi)</span></span></span><span class="hljs-function">)) } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XiGammas</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tm,alpha,beta,S,T,P,O)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xis</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gs</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t in 1:(Tm-1)</span></span></span><span class="hljs-function">) { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xiGamma</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t,alpha,beta,S,T,P,O)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xis</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xis,as.vector(xg$xi)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gs</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cbind</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(gs,as.vector(xg$g)</span></span></span><span class="hljs-function">) } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list(xi=xis,g=gs)</span></span></span><span class="hljs-function">) }</span></span></code> </pre><br><img src="http://habrastorage.org/getpro/habr/post_images/67d/c25/dd4/67dc25dd4c0c20055f44bdc1a9cf7ea4.png" alt="\ xi (s, s')">  interpreted as the fraction of transitions from state s to state s' at time t, and <img src="http://habrastorage.org/getpro/habr/post_images/cb1/2e9/4b3/cb12e94b3d6f4dd224a89c1505a15aab.png" alt="\ gamma_t (s)">  - as the total share of transitions from the state s at the moment of time t. <br><br>  Modified model parameters <img src="http://habrastorage.org/getpro/habr/post_images/757/251/016/757251016f7c7a0e009d3d478f9fb789.png" alt="HMM ^ ‚Äã‚Äã{k + 1} = \ langle M ^ {k + 1}, S ^ {k + 1}, I ^ {k + 1}, T ^ {k + 1}, E ^ {k + 1} \ rangle">  will have the following form: <br><br><pre> <code class="hljs matlab">BaumWelshFunc&lt;-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S,I,T,P,O,Tm)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">alphaLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S,I,T,P,O,Tm)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">b</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">betaLog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S,I,T,P,O,Tm)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xg</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">XiGammas</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tm, a,b, S,T,P,O)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xi</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rowSums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xg$xi)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xi)</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(length(S)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rowSums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xi)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_I</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sum</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(g)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">small_t</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(g,length(S)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dim</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(small_t)</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(length(S)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">length</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(S)</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_T</span></span></span><span class="hljs-function"> &lt;- </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xi</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">small_t</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">norm_params</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NormalReestimation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(xg$g,O[1:(Tm-1)</span></span></span><span class="hljs-function">],</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">S</span></span></span><span class="hljs-function">) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_P</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s in S)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new_P</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(new_P,Curry("dnorm",mean=norm_params$mu[s], sd=sqrt(norm_params$sigma2[s])</span></span></span><span class="hljs-function">)) } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list(S=S,I=new_I,T=new_T,P=new_P,N=norm_params)</span></span></span><span class="hljs-function">) }</span></span></code> </pre><br>  Reconfigure <img src="http://habrastorage.org/getpro/habr/post_images/1e4/83c/c5d/1e483cc5dd367c0055b9d9c8de914deb.png" alt="f_s (o)">  (NormalReestimation in our case) depends on the specific situation.  The classical implementation of the algorithm assumes that the observations are described by finite discrete distributions, which does not suit us.  It is proposed to use the following method for estimating parameters for observed values: <br><br><pre> <code class="hljs matlab">NormalReestimation&lt;-<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(g,O,S)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">denom</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rowSums</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(g)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mu</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-function">%*%</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">O</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">denom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma2</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(s in S)</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">s2</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">g</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[s,]</span></span></span><span class="hljs-function">%*%</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(O-mu[s])</span></span></span><span class="hljs-function">^2 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma2</span></span></span><span class="hljs-function">&lt;-</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">c</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sigma2,s2)</span></span></span><span class="hljs-function"> } </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">return</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(list(mu=as.vector(mu)</span></span></span><span class="hljs-function">,</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma2</span></span></span><span class="hljs-function">=</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sigma2</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">denom</span></span></span><span class="hljs-function">)) }</span></span></code> </pre><br>  Consider the problem of a lie detector in a more general version.  We have a general model of how our lie detector reacts to the lies and sincerity of the subjects and there is a specific individual who sometimes lies sometimes telling the truth.  We want to customize our model to work with this, a specific individual. <br><br>  Given: <br><br><ul><li>  Model.  There are two hidden states when a spherical person is telling the truth and when lying.  In either case, the twitching of the arms can be thought of as white noise, but the dispersion </li><li>  A sample of 10,000 consecutive observations of our individual. </li></ul><br><br>  It is necessary: <br><br><ol><li>  Estimate the variance of shaking hands in the case of sincerity / falsehood of this individual. </li><li>  Determine the moments of the change of these states for him. </li></ol><br><br>  Decision: <br><br><ol><li>  Let's set our top five: <br><br><ol><li>  Number of states <img src="http://habrastorage.org/getpro/habr/post_images/69f/d82/e61/69fd82e61c861fd32742038b16e7db21.png" alt="M \ leftarrow 2">  ; </li><li>  States <img src="http://habrastorage.org/getpro/habr/post_images/ed8/ea6/a94/ed8ea6a944c0b542bad0960ab16881d9.png" alt="S \ leftarrow \ {0,1 \}">  ; </li><li>  Initial distribution <img src="http://habrastorage.org/getpro/habr/post_images/d9a/207/e51/d9a207e5196877c249f59cac599b6f98.png" alt="I \ leftarrow (1 / 2,1 / 2)">  ; </li><li>  By default, we assume that the states are equal and, say, a change occurs on average, every 999 ticks of time: <br><img src="http://habrastorage.org/getpro/habr/post_images/97b/c3f/c65/97bc3fc658d404cf4b2a2a2672e9a812.png" alt="T \ leftarrow \ left (\ begin {matrix} 0.999 &amp; 0.001 \ 0.001 &amp; 0.999 \ end {matrix} \ right)">  ; </li><li><img src="http://habrastorage.org/getpro/habr/post_images/9ce/490/747/9ce490747f8d1b5d8f091d0d7c1b8419.png" alt="E = (N (0,1 / 2 \ cdot \ sigma ^ 2), N (0,2 \ cdot \ sigma ^ 2))">  where <img src="http://habrastorage.org/getpro/habr/post_images/e4d/efe/2d4/e4defe2d4b733f962204a7e16174c4d7.png" alt="\ sigma ^ 2 = var (X)">  . <br>  I will explain that <img src="http://habrastorage.org/getpro/habr/post_images/c60/398/7ea/c603987eafb6ba3a939c3642f2887bba.png" alt="var (x)">  - this is the sample variance for the entire sample.  Initial evaluation functions for <img src="http://habrastorage.org/getpro/habr/post_images/475/be5/4e6/475be54e6435fd900c9766fbf59b4990.png" alt="E_1, E_2">  are chosen in such a way that the first state corresponds to smaller values ‚Äã‚Äãof the variance, and the second one to larger ones.  Essentially, they are different. </li></ol></li><li>  We will reconfigure the parameters using the Baum-Welsh algorithm until the value of the evaluation function stabilizes. </li><li>  We find the most plausible hidden states for each point in time using the Viterbi algorithm. </li></ol><br><br>  We will illustrate the answer on the data from the first picture: on top of the state, as they were set in the simulation, on the bottom, which were selected using the Markov hidden chains method. <br><br><img src="http://habrastorage.org/storage2/f67/7e3/a88/f677e3a88a7e702bfade2e921691e402.png"><br>  On the graph below, we give the logarithm of the estimated function depending on the number of iterations of the Baum-Welch algorithm.  The green mark is the score corresponding to the simulation parameters. <br><br><img src="http://habrastorage.org/storage2/f99/654/96d/f9965496dd86cb496f94929d4b8bf506.png"><br>  The error in estimating hidden states is relatively small, but only when the initial approximation is not much different from what we want to find.  It is necessary to understand that the Baum-Welsh algorithm is just a step in the search for a local optimum, which means it may never reach a global extremum. <br><br>  Formulas are converted into pictures using <a href="http://mathurl.com/">mathurl.com</a> .  I hope someday, here it will be possible to insert formulas in a more simple and pleasing way and, by the way, there is a lack of syntax highlighting for <a href="http://r-project.org/">R.</a> </div><p>Source: <a href="https://habr.com/ru/post/188244/">https://habr.com/ru/post/188244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188232/index.html">New kind of mozilla vlc plugin</a></li>
<li><a href="../188236/index.html">SIM-cards of passengers of the Moscow metro will be subjected to contactless reading</a></li>
<li><a href="../188238/index.html">Recover Apache Derby without backup</a></li>
<li><a href="../188240/index.html">AWS: Cloudwatch + SNS</a></li>
<li><a href="../188242/index.html">Search through sphinx in django 1.6 admin</a></li>
<li><a href="../188246/index.html">Sample Exam at the Faculty of Computer Science at TU Dresden</a></li>
<li><a href="../188248/index.html">Editing Configs in Python</a></li>
<li><a href="../188252/index.html">OpenGL ES 3.0 in Android 4.3 - ETC2 texture compression</a></li>
<li><a href="../188254/index.html">JS Library Performance Comparison</a></li>
<li><a href="../188258/index.html">The Old Reader is no longer public</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>