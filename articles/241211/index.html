<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Step-by-step guide to creating a trading robot in Python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The topic of online trading (whether it is forex, stocks, minerals) is usually of interest. But at the same time, many people think: ‚ÄúI don‚Äôt understa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Step-by-step guide to creating a trading robot in Python</h1><div class="post__text post__text-html js-mediator-article">  The topic of online trading (whether it is forex, stocks, minerals) is usually of interest.  But at the same time, many people think: ‚ÄúI don‚Äôt understand this, specials for me.  terminology unknown.  And it is not clear how to start. ‚Äù  Here we will work on it!  By the end of the article you will have enough knowledge and examples to start playing in the financial markets. <br><br>  We cover the following points: <br><ul><li>  The essence of the exchange game; </li><li>  Brokers; </li><li>  API for trading / Example of a robot; </li><li>  Deployment online; </li><li>  Final thoughts. </li></ul><br><a name="habracut"></a><br><h4>  The essence of the stock game </h4><br>  There are many theories and explanations.  But we come to the question from the point of view of the software and the concept of levels of abstraction.  It is very simple (but true at the same time) the essence of the game is as follows: there is a graph of some (pseudo?) Random variable (price).  Her story is known for quite a long period.  The task is to predict the movement (up or down).  Everything.  Realistically.  What traders do is predict whether the price will go up or down and bet on it (open trades): buy (buy / long) a certain amount of "product" (instrument) in the hope of going up, or sell (sell / short) in the hope that will go down. <br>  After some time (if the price has changed significantly), open trades close and receive as a result to arrive (guess with a move) or loss (did not guess). <br><br>  The deal can be closed with your hands, and you can automatically (order): you can declare in advance - if the price reaches such a level, then close the trade. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Access to the market for transactions is provided by a broker.  And for this he charges for each transaction. <br><br>  Being grounded by the theory, we can again return to the region far from finance and say: hey!  we are just looking for a signal in the noise!  Now we will quickly decompose the Fourier series, determine the frequencies and get rich! <br><br>  That's right, so it is.  The game has begun. <br><br><h4>  Brokers </h4><br>  There are many brokers who specialize in private individuals.  They are distinguished by a set of tools available for bidding, service prices, reliability, the ability to create robots. <br><br>  I will not give a comparative analysis.  Immediately give the best - Oanda.  Why Oanda: <br><br><ul><li>  Reputation; </li><li>  The ability to open a deal of 1 dollar and no requirements for the size of the trade (some brokers oblige to make it a multiple of large values); </li><li>  Low transaction price (narrow spread); </li><li>  A huge number of instruments: currencies, precious metals and oil, indices; </li><li>  The ability to trade through the API; </li><li>  Depositing money is possible through PayPal. </li></ul><br><br>  In order to trade, you need to create an account on Oanda.  To begin with - training (fxtrade practice).  In the ‚ÄúManage API Access‚Äù menu, you need to indicate that trading via the API is possible on your account.  After that, you will generate a secret token for use in RESTful calls. <br><br><h4>  API for trading </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/95b/1d6/6c5/95b1d66c5f2bd76d676c787ae05c6865.jpg" alt="image"><br><br>  <a href="http://developer.oanda.com/docs/">developer.oanda.com/docs</a> - RESTful <br>  Examples: <a href="http://developer.oanda.com/docs/v1/code-samples/">developer.oanda.com/docs/v1/code-samples</a> <br><br>  I will use Python 2.7 and the <a href="http://docs.python-requests.org/en/latest/">requests</a> library. <br><br>  In order to trade, we need: <br><br><h5>  Receive price information.  The robot must know what is going on. </h5><br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect_to_stream</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: s = requests.Session() url = <span class="hljs-string"><span class="hljs-string">"https://stream-fxpractice.oanda.com/v1/prices"</span></span> headers = {<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span> : <span class="hljs-string"><span class="hljs-string">'Bearer '</span></span> + <span class="hljs-string"><span class="hljs-string">"YOUR TOKEN"</span></span>, <span class="hljs-comment"><span class="hljs-comment">#'X-Accept-Datetime-Format' : 'unix' } params = {'instruments' : "EUR_USD,AUD_JPY", 'accountId' : "YOUR ACC ID"} req = requests.Request('GET', url, headers = headers, params = params) pre = req.prepare() resp = s.send(pre, stream = True, verify = False, timeout=20) return resp except Exception as e: s.close() print "Caught exception when connecting to stream\n" + str(e)</span></span></code> </pre> <br><br>  This feature will allow you to connect to the price stream for EUR / USD and AUD / JPY. <br><br>  Now we can read them: <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-comment"><span class="hljs-comment">#infinite loop on receiving events about price. on each tick Strategy function is called for line in response.iter_lines(1): if line: msg = json.loads(line) if msg.has_key("instrument") or msg.has_key("tick"): strategy(msg['tick']['instrument'], msg['tick']['time'], msg['tick']['ask']) except Exception as e: print "something gone bad " +str(e) return</span></span></code> </pre><br><br><h5>  Now we need a brain.  Making decisions </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/512/175/0fb/5121750fbe6f6ee3684319d20fbc1132.jpg" alt="image"><br><br>  As you can see, information on the name of the instrument, price and time is transferred to the strategy function. <br>  We can decide in the <b>strategy</b> function: what should we do with this new info?  Ignore?  Or maybe open a new deal? <br><br>  Here it is useful that you are a programmer.  Invent!  There is a number series - you are looking for patterns, analyze, yes, whatever. <br><br>  Let's say the robot thought and said: exactly the price will go up!  Feel my shiny metal ass! <br><br><h5>  Then we need the opportunity to make a deal </h5><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">order</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(instr, take_profit, stop_loss)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: url = <span class="hljs-string"><span class="hljs-string">"https://"</span></span> + <span class="hljs-string"><span class="hljs-string">"api-fxpractice.oanda.com"</span></span> + <span class="hljs-string"><span class="hljs-string">"/v1/accounts/"</span></span>+<span class="hljs-string"><span class="hljs-string">"YOUR ACC"</span></span>+<span class="hljs-string"><span class="hljs-string">"/orders"</span></span> headers = {<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span> : <span class="hljs-string"><span class="hljs-string">'Bearer '</span></span> + <span class="hljs-string"><span class="hljs-string">"YOUR TOKEN"</span></span>, <span class="hljs-comment"><span class="hljs-comment">#'X-Accept-Datetime-Format' : 'unix' "Content-Type" : "application/x-www-form-urlencoded" } params = urllib.urlencode({ "instrument" : instr, # ,     "units" : 10, #    "type" : 'market', #   ! "side" : "buy", # ,     ("sell"    ) "takeProfit" : take_profit #     ,    ,     .    "stopLoss" : stop_loss #    ,      " ?!!    .  .     " }) req =requests.post(url, data=params, headers=headers) for line in req.iter_lines(1): print "order responce: ", line except Exception as e: print "Caught exception when connecting to orders\n" + str(e)</span></span></code> </pre><br><br>  Here, in general, that's all.  We learned to get information about the price and, on this basis, to open transactions with fixed goals. <br><br><h4>  Deployment online </h4><br>  Discovered the presence of vps at bargain prices.  For example, ftpit.com.  He took the one for $ 2 a month. <br>  This host without any problems keeps on itself 3 of my robots, which day and night are trying to beat the fat cats from Wall Street.  Plus, it has its own SMTP server and a small website. <br><br><h4>  Final thoughts </h4><br>  Trading in financial markets can be a wonderful hobby that not only makes it possible to program, but also to join a huge online game in which every day there is a lot of news, opinions, events, fear, greed and hope! <br><br>  If you have questions, I will answer with joy and to the best of my ability. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/829/dea/8e2/829dea8e259fd18c232e19a17274b84a.gif" alt="image"><br><br><h4>  UPDATE </h4><br>  I highly recommend to stay in the practice account for at least 1 year. <br>  do not rush to enter real money <br>  if you see that you are straightforward and everything turns out, then simply monitor the account right here - <a href="http://www.forexfactory.com/trades.php">forexfactory.com</a> <br>  if there is a stable result even on a demo account - investors themselves will look for you and offer money to manage <br><br><h4>  UPDATE 2 </h4><br>  He remembered who else loved to play in the financial markets - <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BC%25D0%25BF%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F_%25D0%25AE%25D0%25B6%25D0%25BD%25D1%258B%25D1%2585_%25D0%25BC%25D0%25BE%25D1%2580%25D0%25B5%25D0%25B9">Sir Isaac Newton (the same :))</a> </div><p>Source: <a href="https://habr.com/ru/post/241211/">https://habr.com/ru/post/241211/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../241199/index.html">Another unnecessary extension for Google Chrome?</a></li>
<li><a href="../241201/index.html">Five dead-end conversations between the manager and the manager</a></li>
<li><a href="../241203/index.html">The final program of the Mobile Developers Conference was published #MBLTDev</a></li>
<li><a href="../241205/index.html">How vGate helps in investigating security incidents in a virtual infrastructure</a></li>
<li><a href="../241209/index.html">Features of working with the Google Drive API</a></li>
<li><a href="../241213/index.html">Google's Lollipop OS, new Nexus and a list of billions of companies in the mobile market - and other news of the week for a mobile developer</a></li>
<li><a href="../241215/index.html">GLPI and the latest time zone updates in Windows</a></li>
<li><a href="../241217/index.html">Localization of applications for OS X</a></li>
<li><a href="../241219/index.html">Apple obliges developers to create 64-bit applications</a></li>
<li><a href="../241221/index.html">Cryptographic solutions. From crypto providers to browser plug-ins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>