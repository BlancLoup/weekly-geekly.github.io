<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Properties framework for Qt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Problem 
 In Qt, there is a wonderful thing - Q_PROPERTY, which allows you to add the necessary property to any QObject class. But in some cases it is...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Properties framework for Qt</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/6ec/eab/92e/6eceab92ec49c71c2409f4a9fd1b6ba5.png"><br><br><h5>  Problem </h5><br>  In Qt, there is a wonderful thing - Q_PROPERTY, which allows you to add the necessary property to any QObject class.  But in some cases it is inconvenient to use them. <br><br>  For example, you have an application in which many different objects exist and (or can be created) that need to be customized (display a dialog with the properties of the selected object).  An example of such applications can be almost any engineering program, vector graphics editor, Visual Studio after all. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, there are many objects that the user can "customize."  It is logical to have some kind of universal mechanism for this, because otherwise you have to implement your own customization dialog for each object.  Q_PROPERTY for this is not quite suitable.  Firstly, there is no standard Q_PROPERTY widget.  Secondly, even if you use a third-party widget for this purpose, along with your properties, standard ones (at least objectName) will be displayed.  Further, Q_PROPERTY does not support hierarchies (it is sometimes useful to group related properties);  no description (text string explaining this property);  There are no tools to customize the appearance of Q_PROPERTY in the GUI (to improve usability). <br><br>  For a programmer, it is sometimes convenient to work with properties as with a separate object, independent of the owner object.  They can then be transferred somewhere without transferring the entire owner object, or even transfer a separate subgroup of properties. <br><br><h5>  Decision </h5><br>  Trying to make convenient properties, I created a <a href="https://github.com/lexxmark/QtnProperty">QtnProperty</a> project.  Next, I will tell you how good this project is and how to use this library. <br>  First of all, the library consists of several parts: <br><ul><li>  <b>QtnPropertyCore</b> - library with non-GUI classes </li><li>  <b>QtnPropertyWidget</b> - widgets for editing properties, plus delegates for customizing the look and editing of various properties </li><li>  <b>QtnPEG</b> is an application (similar to the moc generator) that creates the C ++ property property class PropertySet from a * .pef file (this is a simpler way of describing properties, similar in syntax to QML) </li><li>  <b>QtnPropertyTests</b> - tests for the <b>QtnPropertyCore</b> library </li><li>  <b>QtnPropertyDemo</b> is a demo application where you can edit properties using <b>QtnPropertyWidget</b> , as well as from a script and setting the text as "SuperProperty.SubProperty = value" strings </li></ul><br><h5>  QtnPropertyCore </h5><br>  First of all, the library defines two main classes, <i>QtnProperty</i> and <i>QtnPropertySet</i> .  The first is the base for all types of properties (for example, <i>QtnPropertyBool</i> or <i>QtnPropertyFloat</i> ), and the second is a group of properties.  Both <i>QtnProperty</i> and <i>QtnPropertySet</i> have a common parent, <i>QtnPropertyBase</i> , which, in turn, is a descendant of QObject.  In the <i>QtnPropertyBase</i> class, everything that is common between <i>QtnProperty</i> and <i>QtnPropertySet is defined</i> : <br><ol><li>  QString <b>name</b> - the name of the property or propertyset (same as objectName) </li><li>  QString <b>description</b> - a text description that can be displayed in the bottom panel of <i>QtnPropertyWidget</i> </li><li>  qint32 <b>id</b> - unique property ID among others in the group (used when saving in binary form) </li><li>  QtnPropertyState <b>state</b> - the state of the property (for example, QtnPropertyStateImmutable is a non-editable property or QtnPropertyStateInvisible is invisible) </li><li>  <b>load / save</b> - save / load via QDataStream </li><li>  <b>fromStr / toStr</b> - converting property value from / to QString </li><li>  <b>fromVariant / toVariant</b> - converting property value from / to QVariant </li><li>  <b>propertyWillChange</b> - a signal that is triggered before a property changes (when changing not only the value but also other attributes - name, description, id, state, etc.) </li><li>  <b>propertyDidChange</b> - a signal that triggers after a property change (symmetric propertyWillChange) </li></ol><br>  <i>The QtnPropertySet</i> class contains another list of child properties and methods for working with them.  For each property type (for example, integer), there are two classes ( <i>QtnPropertyInt</i> and <i>QtnPropertyIntCallback</i> ).  The first stores the value in the class, and the second calls some function to get or save the value. <br>  Here is a list of properties that is implemented directly in the <b>QtnPropertyCore</b> module: <br><ol><li>  <i>QtnPropertyBool</i> - represents a boolean value. </li><li>  <i>QtnPropertyInt</i> - represents a signed integer value. </li><li>  <i>QtnPropertyUInt</i> - represents an unsigned integer value. </li><li>  <i>QtnPropertyFloat</i> - represents a floating point value. </li><li>  <i>QtnPropertyDouble</i> - represents the real value of double precision. </li><li>  <i>QtnPropertyEnum</i> - represents the value from the enumeration. </li><li>  <i>QtnPropertyEnumFlags</i> - represents a combination of values ‚Äã‚Äãfrom an enumeration. </li><li>  <i>QtnPropertyQString</i> - represents a string value. </li><li>  <i>QtnPropertyQPoint</i> - represents a QPoint value. </li><li>  <i>QtnPropertyQSize</i> - represents the value of QSize. </li><li>  <i>QtnPropertyQRect</i> - represents the value of QRect. </li><li>  <i>QtnPropertyQFont</i> - represents the value of a QFont. </li><li>  <i>QtnPropertyQColor</i> - represents the value of QColor. </li></ol><br>  All numerical properties ( <i>QtnPropertyInt</i> , <i>QtnPropertyUInt</i> , <i>QtnPropertyFloat</i> , <i>QtnPropertyDouble</i> ) have three additional methods: <br><ol><li>  minValue is the minimum allowed value. </li><li>  maxValue is the maximum allowed value. </li><li>  stepValue - the step of changing the value. </li></ol><br><h5>  QtnPropertyWidget </h5><br>  This module contains two widgets and property delegates. <br>  The <i>QtnPropertyView</i> class implements a tree widget for a set of properties. <br>  The <i>QtnPropertyWidget</i> class is composite and contains <i>QtnPropertyView</i> and QLabel as the bottom panel. <br><img src="https://habrastorage.org/getpro/habr/post_images/9b7/b72/7ef/9b7b727ef4c041bf50f487d12bf392ea.png"><br>  To change the appearance or behavior of a particular property, delegates were introduced.  For example, for <i>QtnPropertyBool,</i> there are two delegates: <i>QtnPropertyDelegateBoolCheck</i> and <i>QtnPropertyDelegateBoolCombobox</i> .  The first displays a checkbox, and the second displays a combobox with two custom values ‚Äã‚Äã(for true and false values).  You can create your delegates and set them as default, then all properties of this type will be displayed using the new delegate.  It is sometimes easier and more convenient to create a new delegate type than a new property type.  For example, the property for storing the file path is implemented through a special <i>QtnPropertyDelegateQStringFile</i> delegate for <i>QtnPropertyQString</i> . <br><br><h5>  How to use </h5><br>  For example, consider a small set of properties for a text editor. <br>  This is what we want to show the user. <br><img src="https://habrastorage.org/getpro/habr/post_images/58a/acc/bc5/58aaccbc51ad1cf6ad54a50a38732b5d.png"><br>  But what a programmer needs to do to get such a property set: <br><pre><code class="cpp hljs">QtnPropertySet* textProperties = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertySet(owner); QtnPropertyBool* enableWrapping = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertyBool(textProperties); enableWrapping-&gt;setName(tr(<span class="hljs-string"><span class="hljs-string">"enableWrapping"</span></span>)); enableWrapping-&gt;setDescription(tr(<span class="hljs-string"><span class="hljs-string">"Enable/disable text wrapping"</span></span>)); enableWrapping-&gt;setValue(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); QtnPropertyQColor* textColor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertyQColor(textProperties); textColor-&gt;setName(tr(<span class="hljs-string"><span class="hljs-string">"textColor"</span></span>)); textColor-&gt;setDescription(tr(<span class="hljs-string"><span class="hljs-string">"Foreground text color"</span></span>)); textColor-&gt;setValue(QColor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)); QtnPropertySet* Tabulation = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertySet(textProperties) Tabulation-&gt;setName(tr(<span class="hljs-string"><span class="hljs-string">"Tabulation"</span></span>)); Tabulation-&gt;setDescription(tr(<span class="hljs-string"><span class="hljs-string">"Tabulation settings"</span></span>)); QtnPropertyBool* replaceWithSpaces = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertyBool(Tabulation); replaceWithSpaces-&gt;setName(tr(<span class="hljs-string"><span class="hljs-string">"replaceWithSpaces"</span></span>); replaceWithSpaces-&gt;setDescription(tr(<span class="hljs-string"><span class="hljs-string">"Automatically replace tabs with spaces"</span></span>)); replaceWithSpaces-&gt;setValue(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); QtnPropertyUInt* tabSize = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QtnPropertyUInt(Tabulation); tabSize-&gt;setName(tr(<span class="hljs-string"><span class="hljs-string">"tabSize"</span></span>)); tabSize-&gt;setDescription(tr(<span class="hljs-string"><span class="hljs-string">"Number of spaces to be placed."</span></span>)); tabSize-&gt;setState(QtnPropertyStateImmutable); tabSize-&gt;setValue(<span class="hljs-number"><span class="hljs-number">4</span></span>); tabSize-&gt;setMinValue(<span class="hljs-number"><span class="hljs-number">1</span></span>); tabSize-&gt;setMaxValue(<span class="hljs-number"><span class="hljs-number">10</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    propertyDidChange auto lambda = [tabSize, replaceWithSpaces](const QtnPropertyBase* changedProperty, const QtnPropertyBase* firedProperty, QtnPropertyChangeReason reason) { //    if (reason &amp; QtnPropertyChangeReasonValue) { if (*replaceWithSpaces) //  tabSize  tabSize-&gt;removeState(QtnPropertyStateImmutable); else //  tabSize   tabSize-&gt;addState(QtnPropertyStateImmutable); }; QObject::connect(replaceWithSpaces, &amp;QtnProperty::propertyDidChange, lambda); //       replaceWithSpaces ...</span></span></code> </pre> <br>  To make life easier for programmers (or even to allow non-programmers to describe properties), a small <b>QtnPEG</b> code generator was <b>developed</b> . <br>  Here is the description of our example in the Text.pef file: <br><pre> <code class="cpp hljs">property_set Text { Bool enableWrapping { description = <span class="hljs-string"><span class="hljs-string">"Enable/disable text wrapping"</span></span>; value = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } QColor textColor { description = <span class="hljs-string"><span class="hljs-string">"Foreground text color"</span></span>; value = QColor(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } property_set Tabs Tabulation { description = <span class="hljs-string"><span class="hljs-string">"Tabulation settings"</span></span>; Bool replaceWithSpaces { description = <span class="hljs-string"><span class="hljs-string">"Automatically replace tabs with spaces"</span></span>; value = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    delegate ComboBox { //     true labelTrue = "On"; //     false labelFalse = "Off"; } //      replaceWithSpaces.propertyDidChange slot propertyDidChange { tabSize.switchState(QtnPropertyStateImmutable, !replaceWithSpaces); } } UInt tabSize { description = "Number of spaces to be placed."; state = QtnPropertyStateImmutable; value = 4; } } }</span></span></code> </pre><br>  Simple enough and succinctly.  <b>QtnPEG</b> creates two files: Text.peg.h and Text.peg.cpp, where there are two classes.  <i>QtnPropertySetText</i> and <i>QtnPropertySetTabs</i> are the classes derived from <i>QtnPropertySet</i> . <br>  In the generated classes, you can see the following <i>sub-properties</i> declaration, for example for <i>QtnPropertySetText</i> : <br><pre> <code class="cpp hljs"> <span class="hljs-comment"><span class="hljs-comment">// start children declarations QtnPropertyBool&amp; enableWrapping; QtnPropertyQColor&amp; textColor; QtnPropertySetTabs&amp; Tabulation; // end children declarations</span></span></code> </pre><br>  Thus, a programmer in C ++ code can work with this class as with a field structure.  For example: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> QtnPropertySetText&amp; textParams, QString&amp; text)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (textParams.Tabulation.replaceWithSpaces) { <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">spaces</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(QChar::Space, textParams.Tabulation.tabSize)</span></span></span></span>; text.replace(QChar::Tabulation, spaces); } }</code> </pre><br><h5>  Total </h5><br>  I hope I could give some insight into my project. <br>  I would be glad if it is useful to someone, especially where there are a lot of settings and developing a GUI for everything and everything is expensive.  If, in your opinion, for the full use of <a href="https://github.com/lexxmark/QtnProperty"><b>QtnProperty</b></a> some functionality is missing, please comment. </div><p>Source: <a href="https://habr.com/ru/post/217203/">https://habr.com/ru/post/217203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217187/index.html">Results of the past months: Seed, Oriense-1, OrPI, OrCC, StartupCup, Technopark</a></li>
<li><a href="../217189/index.html">Incorrect use of atoms and the elusive bug in VCL</a></li>
<li><a href="../217193/index.html">3d terrain on 3d printer</a></li>
<li><a href="../217195/index.html">IBM provides developers with free access to Power Systems servers in the cloud</a></li>
<li><a href="../217201/index.html">Debug Mail - an easy to use smtp server for developers</a></li>
<li><a href="../217205/index.html">The logic of thinking. Subtotal</a></li>
<li><a href="../217207/index.html">Invitation to Frontend Developer Conf by Artem Zakharchenko</a></li>
<li><a href="../217209/index.html">Google Cloud Platform Live: a mix of IaaS and PaaS. Moore's Law for the Clouds</a></li>
<li><a href="../217211/index.html">Spectrophotometer PHOTON RT or spectral characteristics of glasses Gunnar and Polaroid</a></li>
<li><a href="../217213/index.html">TYPO3 CMS cluster in Jelastic cloud</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>