<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Drupal Forms API. Part 2 - for Drupal 7</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The second part of the article contains the differences inherent in the Drupal Forms API for version 7. This part of the article is published as an op...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Drupal Forms API. Part 2 - for Drupal 7</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/827cc438/d97541d8/26144cda/a691fb8d.png"><br>  The second part of the article contains the differences inherent in the Drupal Forms API for version 7. This part of the article is published as an open topic, visible not only to Drupal blog subscribers.  But I will publish my further articles (on creating themes) as closed blog articles, so as not to disturb those who are not interested in Drupal. <br><br>  In the <a href="http://habrahabr.ru/blogs/drupal/111264/">last article</a> , we disassembled the functionality of a simple module that returned the entered name to the form using AJAX (referred to in Drupal 6 as ‚ÄúAHAH‚Äù).  Now the turn of version 7. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  1. The most interesting changes in the API Drupal 7 </h4><br><ul><li>  In Drupal 7, <b>info</b> files have changed.  Now, any files with <b>php</b> code included in the module ( <b>inc</b> and <b>test</b> files), you need to declare an <b>info</b> file.  In our case, there are none. </li><li>  Changed way to handle AJAX.  Now it is not necessary to set the path for handling via <b>hook_menu</b> , you can immediately specify the callback function. </li><li>  Request processing path is now system - <i>/ system / ajax</i> . </li><li>  Changed processing forms.  Now, the callback function receives two variables - an array of the form and a pointer to the state of the form. </li></ul><br><br><h4>  2. Changes in the form code </h4><br>  Changes in the form code are minor.  The principles of the Drupal Forms API remain the same. <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* FC Form */</span></span> <span class="hljs-comment"><span class="hljs-comment">//         (    , ,    ) function fc_form($form, &amp;$form_state) { $form = array(); $form['name'] = array( '#type' =&gt; 'textfield', '#description' =&gt; 'Your name', '#size' =&gt; '15', ); $form['submit'] = array( '#type' =&gt; 'submit', '#value' =&gt; 'Submit', //    ajax '#ajax' =&gt; array( //     callback- 'callback' =&gt; 'fastcontact_ajax', 'wrapper' =&gt; 'fc-form', ), ); return $form; }</span></span></code> </pre> <br><br><h4>  2. Changes in the request processing code </h4><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//  callback-   .        function fastcontact_ajax($form, &amp;$form_state) { //    name   values  form_state $name=$form_state['values']['name']; //       markup   . $form['result'] = array( '#markup' =&gt; '   &lt;b&gt;'.$name.'&lt;/b&gt;', ); return $form; }</span></span></code> </pre><br><br>  The value of the <b>$ form_state array</b> is quite large.  It stores <a href="http://randyfay.com/node/66">all the data on the form and its condition</a> .  From there we take the value of our <b>name</b> field. <br><br>  If in Drupal 6 we sent the text that was displayed in case of success, via <b>drupal_json ()</b> , then in Drupal 7 we reassemble the form and add the <b>markup</b> element to it.  Markup is used to output html markup to a form.  This element existed in version 6 of Drupal - but in version 7 <a href="http://api.drupal.org/api/drupal/developer--topics--forms_api_reference.html">its syntax has changed</a> . <br><br>  Now we have to display the form.  We can make it a standard code from the previous article. <br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">render_fc_form</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $out = <span class="hljs-string"><span class="hljs-string">'&lt;div id="fc-form-wrapper"&gt;'</span></span>; $out .= drupal_render(drupal_get_form(<span class="hljs-string"><span class="hljs-string">'fc_form'</span></span>)); $out .= <span class="hljs-string"><span class="hljs-string">'&lt;/div&gt;&lt;!-- /.fc-form--&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $out; }</code> </pre><br><br>  Please note that there are many more API changes in Drupal 7.  Here is a <a href="http://drupal.org/update/modules/6/7">list of changes</a> made to the Drupal API after version 6 concerning writing modules (for topics, a separate list). <br><br>  <a href="">Download the archive with the whole module</a> </div><p>Source: <a href="https://habr.com/ru/post/111359/">https://habr.com/ru/post/111359/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111351/index.html">Free digital signature for open drivers</a></li>
<li><a href="../111354/index.html">Experience the first application for Windows Phone 7 Series using Silverlight</a></li>
<li><a href="../111356/index.html">Some subtleties of IT outsourcing</a></li>
<li><a href="../111357/index.html">Multiplexed I / O</a></li>
<li><a href="../111358/index.html">Designing power subsystem electronic meter</a></li>
<li><a href="../11136/index.html">What import open counters do you use on your websites?</a></li>
<li><a href="../111360/index.html">testcreator - automate student testing</a></li>
<li><a href="../111361/index.html">Dijkstra's algorithm. Search for optimal routes on the graph</a></li>
<li><a href="../111362/index.html">Microsoft Touch Mouse</a></li>
<li><a href="../111363/index.html">My approach to website design</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>