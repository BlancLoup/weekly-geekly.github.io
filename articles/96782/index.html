<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>WordPress and Zend FrameWork Integration</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Yes, yes, it happens. 
 Suppose you work in a distributed team. The designer sits somewhere in a distant mysterious country, and all that can be obtai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>WordPress and Zend FrameWork Integration</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage1/96e10e48/59b7256b/a5cb9d15/8cca213c.jpg" height="100" align="left">  Yes, yes, it happens. <br>  Suppose you work in a distributed team.  The designer sits somewhere in a distant mysterious country, and all that can be obtained from it is templates made for WordPress.  And you need to add to the site far from trivial functionality.  Touch the core WordPress you can not, and the possibilities of plug-ins do not suit you at all (maybe you lack the standard set of hooks, or maybe you just don‚Äôt like this engine, anything can happen). <br>  The first impulse is to take a suitable engine or framework (for example, ZF), transfer the design to it and work in peace.  But here is a snag, you will make a new functionality and leave the project, but the designer and support will remain.  And they are not able and do not want to be able to do anything at ZF. <br><br>  If you are interested in how to get out in a similar situation, I invite you under the cat. <br><a name="habracut"></a><br><br>  Concept such.  All non-standard functionality performs ZF, and WP only displays the result, as well as for example the content of a separate page or post.  So  the designer can change the frame (header, footer, etc.) for any pages, the new frame will also apply to pages from ZF.  The support will, as if nothing had happened, edit static pages and news, inserting where you need links to the functionality of ZF, 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The first step is to force WP to ask content from ZF for requests of a certain type, for example / do / account / signup / <br>  Of course, we use the plugin system.  Only here there is no hook, which will make it possible not to pull the post from wordPressa, but to call the contents through some function.  If someone finds it, then tell me, please :) Therefore, we will be treacherous to use the hook that is and is called before the content is prepared. <br><br>  Fortunately, http requests are parsed by the WP_Query class and the page content is prepared by the same class.  WP uses one global object of this class.  Without any remorse, we replace this object with our fake instance of the heir to the class WP_Query.  Feel what am I leading to?  Correctly, the get_posts () function will be redefined. <br>  Personally, I first call the standard method, it will fill all global objects with standard data, pull the default page out of the database for display, in general, it's good, it would be difficult for me without it. <br>  Then I replace the content of the default page with the result coming from ZF. <br><br> <b><code>define('ZF_MARKER', 'do'); <br> <br> add_action('parse_request', 'zf_query_controller'); <br> <br> function zf_query_controller() { <br> parse_str($_SERVER['QUERY_STRING'], $params); <br> <br> if(isset($params[ZF_MARKER])) { <br> <br> global $wp_the_query; <br> $q = new ZF_Query(); <br> $q-&gt;copyFrom($wp_the_query); <br> $zf_uri = trim($params[ ZF_MARKER ], "/ "); <br> $q-&gt;req_uri_zf = empty($zf_uri)? '/' : '/' . $zf_uri . '/'; <br> $wp_the_query = $q; <br> } <br> } <br> <br> class ZF_Query extends WP_Query <br> { <br> public $req_uri_original = ''; <br> public $req_uri_zf = ''; <br> <br> function copyFrom(WP_Query $wp_query) { <br> $vars = get_object_vars($wp_query); <br> foreach($vars as $name =&gt; $value) { <br> $this-&gt;$name = $value; <br> } <br> } <br> <br> function &amp;get_posts() { <br> parent::get_posts(); <br> <br> $post_zf = array( <br> "ID" =&gt; 1, <br> "post_author" =&gt; 1, <br> "post_date" =&gt; '', <br> "post_date_gmt" =&gt; '', <br> "post_content" =&gt; '', <br> "post_title" =&gt; '', <br> "post_excerpt" =&gt; "", <br> "post_status" =&gt; "publish", <br> "comment_status"=&gt; "open", <br> "ping_status" =&gt; "open", <br> "post_password" =&gt; "", <br> "post_name" =&gt; "", <br> "to_ping" =&gt; "", <br> "pinged" =&gt; "", <br> "post_modified" =&gt; "", <br> "post_modified_gmt"=&gt; "", <br> "post_content_filtered"=&gt; "", <br> "post_parent" =&gt; 0, <br> "guid" =&gt; "", <br> "menu_order" =&gt; 1, <br> "post_type" =&gt; ZF_MARKER, <br> "post_mime_type"=&gt; "", <br> "comment_count" =&gt; "0", <br> "ancestors" =&gt; array(), <br> "filter" =&gt; "", <br> ); <br> <br> $tmp = $_SERVER['REQUEST_URI']; <br> $_SERVER['REQUEST_URI'] = $this-&gt;req_uri_zf; <br> $post_zf['post_content'] = require_once ABSPATH . 'zf-app/public/index.php'; <br> $_SERVER['REQUEST_URI'] = $tmp; <br> <br> global $post; <br> $post = (object)$post_zf; <br> $this-&gt;posts = array($post); <br> $this-&gt;post = $post; <br> $this-&gt;post_count = count($this-&gt;posts); <br> $this-&gt;current_post = 0; <br> <br> $this-&gt;is_single = 1; <br> $this-&gt;is_page = 0; <br> $this-&gt;is_404 = 0; <br> $this-&gt;is_archive = 0; <br> $this-&gt;is_home = 0; <br> <br> //  2  ,  wordPress (   3.x)  ,      . <br> global $wp_filter; <br> unset($wp_filter['template_redirect']); <br> <br> return $this-&gt;posts; <br> } <br> } <br></code> <br></b> <br>  And of course the rule for .haccess is: <br> <b><code>RewriteRule /?do/(.*) /index.php?do=$1 [L] <br></code></b> <br>  It is possible without it, then the URLs for the ZF functional will be of the form /? Do = account / signup / <br><br><br>  Also, it is necessary to change the ZF, it should not withdraw its respons, but return it. <br><br> <b><code>$controller-&gt;returnResponse(true); <br> $resp = $application-&gt;bootstrap()-&gt;getBootstrap()-&gt;run(); <br> return $resp-&gt;getBody(); <br></code></b> <br><br>  The returned HTML is needed without the &lt;html&gt; and &lt;body&gt; tags. So disable the layout or make it primitive, such as <br> <b><code>&lt;?php echo $this-&gt;layout()-&gt;content ?&gt; <br></code></b> <br><br>  Here, in general, that's all. <br><br><hr><br><br>  PS: One more thing.  if you need to teach WP how to handle content from ZF especially, then you can go to the Single.php template of the theme you are using and set it in the right place. <br> <b><code>&lt;?php the_post(); if (ZF_MARKER == $post-&gt;post_type) : ?&gt; <br> &lt;?php echo $post-&gt;post_content;?&gt; <br> &lt;?php else:?&gt; <br> ... <br> &lt;?php endif; ?&gt; <br></code></b> <br><br>  This was what the lines were for: <br> <code>$this-&gt;is_single = 1; <br> $this-&gt;is_page = 0; <br> $this-&gt;is_404 = 0; <br> $this-&gt;is_archive = 0; <br> $this-&gt;is_home = 0; <br></code> </div><p>Source: <a href="https://habr.com/ru/post/96782/">https://habr.com/ru/post/96782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96768/index.html">WordPress 3.0 ‚ÄúThelonious‚Äù Released</a></li>
<li><a href="../96769/index.html">Augmented Reality & Annual Report</a></li>
<li><a href="../96774/index.html">ASP.NET Chart Control or not straining to draw graphics on the Web</a></li>
<li><a href="../96775/index.html">To the author of the article "Experiment: What can be squeezed out of a Pentium 166 megahertz?"</a></li>
<li><a href="../96777/index.html">Local and remote prevention of DDoS class attacks: features, advantages, disadvantages, monitoring</a></li>
<li><a href="../96788/index.html">Brink release postponed to 2011</a></li>
<li><a href="../96789/index.html">Black humor NeverDead</a></li>
<li><a href="../96790/index.html">New Mortal Kombat Shows True Face</a></li>
<li><a href="../96791/index.html">Metal Gear Solid: Rising - MGS4 prequel</a></li>
<li><a href="../96792/index.html">The next introduction of Linux School in Nizhny Novgorod</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>