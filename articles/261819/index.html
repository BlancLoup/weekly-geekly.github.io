<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unpleasant aspects of working with Images.xcassets: size and memory</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, dear habrozhiteli! 

 Images.xcassets gives a lot of nice things, especially I like Slicing and the ability to add a separate image fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unpleasant aspects of working with Images.xcassets: size and memory</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, dear habrozhiteli! <br><br>  Images.xcassets gives a lot of nice things, especially I like Slicing and the ability to add a separate image for each type of device.  Therefore, starting a new project, I, without even thinking about it, create Images.xcassets, add icons and splash there, and then throw all new resources there too.  Today I learned a couple of unpleasant things about xcassets, it made me give up on it and spend a couple of hours reworking the project.  Not the most pleasant and rewarding.  If you want to learn from the mistakes of others, please under the cat. <br><a name="habracut"></a><br><h5>  <b>A little background</b> </h5>  With a group of enthusiasts I decided to make fairy tales for children on iPad.  I understand in advance that this will not get rich, our goal is a good application that works on all devices with iOS 8. I also wanted to avoid a painfully familiar situation - you downloaded the application, launch it and find out that in order to work it needs to download more&gt; 100MB .  So, the application immediately wanted to add at least one book so that after installation the application could be used.  The book is an illustration in jpeg format, and without compression the smallest book weighs 82Mb, the remaining 100 + Mb.  So, if we want to leave the opportunity to download it by 3g, we have 18Mb left for the application.  This sounds impracticable, as it is a children's application, and there are a lot of pictures in it, and most of them are with ornaments and patterns, so that they are neither stung nor cut.  It was with such initial data that I created a xcode project. <br><br><h5>  <b>First battle for memory</b> </h5>  When I started the project, I only had iPad Air from the test devices.  Everything flies on it, which is already there to confess - a bad choice for testing.  Therefore, closer to the end of the project, I purchased an iPad mini 1 gen - a device without a retina and with an A5 processor, but has iOS 8, and then also iOS 9. When debugging an application, I occasionally received memory warning.  Not order, so it should not be.  I open the ‚ÄúDebug‚Äù tab and I see that the application has eaten 100 Mb.  And this is despite the fact that I didn‚Äôt do anything special, just opened the application and had only 3 controllers in the navigation stack.  I open the profiler and see that 70Mb is occupied by pictures.  100 Mb on iPad mini is obviously overkill.  So I had to go and add a large number of pictures with 1x scale (I hadn‚Äôt added them before, knowing that iOS would prepare them for the nonretina iOS), this is not a big blow to the size of the application, but the amount of memory used will be sharply reduced.  In the end, I got 47Mb.  In my opinion, it is still unjustified, but memory warnings stopped flying. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  <b>Fight for size</b> </h5>  And yesterday I finished developing the application.  Of course, there are some TODOs, and the guys will test it and, probably, they will find something, but the first phase is over.  I rolled out the build to the rest of the team members, at the same time complained that it weighs 142MB, which means that the book, which is sewn into the application, will need to be reduced by 2 times in volume, very unpleasant and noticeable for the eye downgrade of the quality of illustrations.  That is why today I decided to take up the size of the application and reduce it by hook or by crook so that the quality does not suffer so much. <br><br><h6>  <b>Step 1 - see what takes up so much space.</b> </h6>  I take build.ipa, rename it to build.zip, unzip it, and look at the contents of build.app.  I find the Assets.car file, which weighs 53Mb.  In principle, the size of the application is explainable - 80 + 53 + in detail.  I understand that it‚Äôs just not to reveal it, I decided to see the Images.xcassets in the project itself.  It weighs only 38Mb.  What is it that turns out?  They put something on 16Mb there, and they apparently forgot to tell me about it. <br><br><h6>  <b>Step 2 - what did they add there?</b> </h6>  A quick search through the expanses of the network gives me a <a href="https://github.com/steventroughtonsmith/cartool">cartool</a> , to view Assets.car.  I do everything according to the instructions - I collect the project, take the assembled cartool and run on my Assets.car.  I look at what I got as a result - 130 files with a total size of 41.5Mb and, if I can write 3.5Mb to pngcrush, then where did 11.5Mb go? <br>  I repeat a quick search on the network.  I find similar problems, for example, <a href="http://stackoverflow.com/questions/22463935/assets-car-is-6-times-larger-than-actual-images-xcassets-folder-when-archived">here</a> .  And that I am crying because of some 29%, there is generally a 6-fold increase in size.  But this is not my case - I have all the png pictures, since almost all the images have sections of a transparent background.  I no longer found any hope of correcting this situation.  I check the <a href="https://developer.apple.com/library/ios/recipes/xcode_help-image_catalog-1.0/Recipe.html">Apple documentation</a> again - they made a binary file to speed up the download of the application.  As for me, download speed directly depends on the size.  Therefore, I decided to remove all the images from Images.xcassets and add them to the project in the old manner.  I had to do slicing in code in several places using <br><pre><code class="hljs objectivec">- (<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)resizableImageWithCapInsets:(<span class="hljs-built_in"><span class="hljs-built_in">UIEdgeInsets</span></span>)capInsets</code> </pre> <br>  With such frauds, I was able to reduce the size of the installment from 142Mb to 131Mb.  I definitely will continue to optimize resources in the application, but 10Mb for refusing Images.xcassets is not bad. <br><br><h6>  <b>Step 3 - what happened to the memory?</b> </h6>  Launched on iPad mini - 23Mb vs. 47Mb.  On iPad Air 66Mb vs. 100Mb. <br><br><h6>  <b>Conclusion</b> </h6>  It may seem that the difference between 142Mb and 131Mb is small.  But this is a very significant indicator without degrading the quality of pictures and other tricks.  This is a significant step towards the threshold of 100Mb and the availability of the application on 3G networks.  And the reduction of memory when using the application is a very nice bonus. <br>  I did not notice much difference when starting the application.  On the contrary, I‚Äôve already inserted a delay so that the user can admire our logo longer.  And subsequently, problems with the speed of work were not observed, since the application has a lot of slow animations and it‚Äôs impossible to notice subsidence in performance. <br><br><h5>  <b>PS</b> </h5>  I know that with iOS 9 everything should <a href="https://developer.apple.com/library/prerelease/ios/documentation/IDEs/Conceptual/AppDistributionGuide/AppThinning/AppThinning.html">change</a> and apple will provide only the content needed for this device.  But even when I deleted all 1x images, the build size was 135. At the same time, I sacrificed memory on nonretin devices and image quality, which is noticeable to the naked eye on some interface elements. <br><br><h5>  <b>Pss</b> </h5>  Since here we are talking about memory, I would like to share one more interesting fact.  I always create images with <br><pre> <code class="hljs lisp">+ (<span class="hljs-name"><span class="hljs-name">UIImage</span></span> *)imageNamed:(NSString *)name<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br>  Fast and convenient way to have side effects.  When the user sends the application to the background, the system can quite throw the picture out of memory (and on the iPad mini, it always does), she knows for sure that this image is taken from the Bundle, and it is probably still in place.  When the application returns to the foreground, the system will load them as soon as they are needed.  It sounds quite logical and expedient.  However, it can cause lags when opening an application from the background, which was not even with a cold start of the application.  In my case, it was a carousel, and she lagged only when the application was raised from the background. <br><br>  Have a good weekend and fewer such unpleasant surprises. </div><p>Source: <a href="https://habr.com/ru/post/261819/">https://habr.com/ru/post/261819/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261803/index.html">Magic of tensor algebra: Part 4 - Dynamics of a point in a tensor statement</a></li>
<li><a href="../261807/index.html">STM32, C ++ and FreeRTOS. Development from scratch. Part 1</a></li>
<li><a href="../261811/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ167 (June 29 - July 4, 2015)</a></li>
<li><a href="../261813/index.html">Ford recalls almost 500 thousand cars because of a bug in software</a></li>
<li><a href="../261817/index.html">Creating a Worker from another domain</a></li>
<li><a href="../261823/index.html">STM32, C ++ and FreeRTOS. Development from scratch. Part 2</a></li>
<li><a href="../261827/index.html">DIY Robot Vacuum Cleaner</a></li>
<li><a href="../261829/index.html">Cackle Reviews full text search feedback system</a></li>
<li><a href="../261831/index.html">How to mount an image fsa</a></li>
<li><a href="../261833/index.html">The digest of interesting materials for the mobile # 110 developer (June 29-July 5)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>