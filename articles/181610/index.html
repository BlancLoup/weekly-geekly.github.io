<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the client for your favorite site on phoneGap</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It happens that there is a site, but using it from a mobile phone is not very convenient and it would be great to have a separate application for it. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the client for your favorite site on phoneGap</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/cb6/de1/e0c/cb6de1e0c10b7a825b8f0892a84e1643.png" align="left">  It happens that there is a site, but using it from a mobile phone is not very convenient and it would be great to have a separate application for it.  Fans of web development can easily do this using phoneGap.  Under the cat, we will discuss the mail tracking service, which I often use and a demo client written for it with basic functionality: authorization, getting a list of tracks and descriptions to them and the ability to add a new track.  I have not contacted the developer about this, and I really hope that he will not be offended by me for impudence, for digging into JavaScript code and for the fact that the application will not show ads.  I also ask you to forgive you for the code‚Äôs crutchiness and cyclicality, take it as an example. <br><a name="habracut"></a><br>  The article implies that you yourself can figure out how the site works, the information from which will be displayed in the application. <br>  Those who have read the <a href="http://habrahabr.ru/post/181007/">previous article on authorization</a> through some sites already know that phoneGap has a great thing inAppBrowser, which not only opens the site inside the application, but also allows you to inject your JavaScript code into it and change styles that is useful for authorization forms. <br>  On its basis, in the image and similarity of authorization, the following code was written on Habr√©: <br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> plugin_www_post_tracker_ru = { <span class="hljs-attr"><span class="hljs-attr">wwwref</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">authOk</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">auth</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">force</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.localStorage.getItem(<span class="hljs-string"><span class="hljs-string">"plugin_www_post_tracker_ru_PHPSESSID"</span></span>) || force) { <span class="hljs-comment"><span class="hljs-comment">//        var authURL="http://post-tracker.ru/login.php"; this.wwwref = window.open(encodeURI(authURL), '_blank', 'location=no'); //     this.wwwref.addEventListener('loadstop', this.auth_jsinjection); //        } else { plugin_www_post_tracker_ru.authOk=true; } }, auth_event_url: function (url) { var tmp=url_parser.get_args_cookie(url); //     if (tmp['PHPSESSID'] &amp;&amp; tmp['userid'] &amp;&amp; tmp['securehash']) { //     ,    plugin_www_post_tracker_ru.wwwref.close(); //       window.localStorage.setItem("plugin_www_post_tracker_ru_PHPSESSID", tmp['PHPSESSID']); window.localStorage.setItem("plugin_www_post_tracker_ru_userid", tmp['userid']); window.localStorage.setItem("plugin_www_post_tracker_ru_securehash", tmp['securehash']); plugin_www_post_tracker_ru.authOk=true;      } }, auth_cssinjection: function(){ plugin_www_post_tracker_ru.wwwref.insertCSS({code:".topline {display:none} .top {display:none} .logo {display:none} .menu {display:none} .counters {display:none} .bottom {display:none} .links {display:none} @-viewport {width: device-width; zoom: 1;"},function(){}); }, auth_jsinjection: function () { plugin_www_post_tracker_ru.auth_cssinjection(); //  CSS    ,     plugin_www_post_tracker_ru.wwwref.executeScript({ // JS     code: "document.cookie;" }, function(arg) { plugin_www_post_tracker_ru.auth_event_url(arg); }); } }</span></span></code> </pre> <br><br>  To get the content, we will use a small AJAX library capable of making POST and GET requests, which can insert a cookie and give the result to the callback function (the base is taken from <a href="http://code.google.com/p/miniajax/">miniajax</a> ): <br><div class="spoiler">  <b class="spoiler_title">AJAX</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ajax = { <span class="hljs-attr"><span class="hljs-attr">init</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); }, <span class="hljs-attr"><span class="hljs-attr">send</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url,method,args,cookies,async,_callback</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> q=ajax.init(); q.open(method,url,<span class="hljs-keyword"><span class="hljs-keyword">async</span></span>); q.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.readyState==<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.status==<span class="hljs-number"><span class="hljs-number">200</span></span>) { _callback(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.responseText); } }; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cookies) { q.setRequestHeader(<span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>,cookies); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(method==<span class="hljs-string"><span class="hljs-string">'POST'</span></span>) { q.setRequestHeader(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>,<span class="hljs-string"><span class="hljs-string">'application/x-www-form-urlencoded'</span></span>); q.send(args); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { q.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); } } }</code> </pre></div></div><br>  To get the content, make a GET request for a post-tracker.ru/my/ page, if in the response in one of the blocks we meet the line <code><a href="https://habr.com/login.php"></a> <a href="https://habr.com/register.php"></a>   </code>  <code><a href="https://habr.com/login.php"></a> <a href="https://habr.com/register.php"></a>   </code> , we are clearly logged out and you will have to go through the procedure again: <br><pre> <code class="javascript hljs"> get_content: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">async</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//        var cookies="PHPSESSID="+window.localStorage.getItem("plugin_www_post_tracker_ru_PHPSESSID")+"; userid="+window.localStorage.getItem("plugin_www_post_tracker_ru_userid")+"; securehash="+window.localStorage.getItem("plugin_www_post_tracker_ru_securehash"); //  cookie plugin_www_post_tracker_ru.dataReady=false; ajax.send("http://post-tracker.ru/my/",'GET',null,cookies,async,this._parse_content); //  ajax        }, _parse_content: function (data) { var wrapper=document.createElement('div'); //  html   ,      wrapper.innerHTML=data; plugin_www_post_tracker_ru._get_inside_data(wrapper,'trackcode,date,status,comment'); //        ,   ,     }, _get_inside_data: function (wrapper,types) { var tmp=wrapper.getElementsByClassName('login')[0].innerHTML; //      div  login if (tmp=='&lt;a href="/login.php"&gt;&lt;/a&gt;  &lt;a href="/register.php"&gt;&lt;/a&gt;') { //   ,    plugin_www_post_tracker_ru.auth(true); } else { //    plugin_www_post_tracker_ru.default_folder=wrapper.getElementsByTagName('input')[0].value; //  ID    ,           var types=types.split(","); for (var typeid in types) { //  html-      var tmp=wrapper.getElementsByClassName(types[typeid]); var id=0; for (var i in tmp) { if (tmp[i].innerHTML) { if (!plugin_www_post_tracker_ru.postdata[id]) plugin_www_post_tracker_ru.postdata[id]=new Array(); plugin_www_post_tracker_ru.postdata[id][(types[typeid])]=tmp[i].innerHTML.replace(/(\r\n|\n|\r)/gm,"").replace(/&lt;\/?[^&gt;]+&gt;/gmi,"").replace(/^\s+|\s+$/gm,""); //       , html       id++; } } } plugin_www_post_tracker_ru.dataReady=true; show_list(); //       } }, get_list: function () { //     show_list()  ""  var tmp=new Array(); for (var i in plugin_www_post_tracker_ru.postdata) { tmp[i]="&lt;b&gt;"+plugin_www_post_tracker_ru.postdata[i]['trackcode']+"&lt;/b&gt; "+plugin_www_post_tracker_ru.postdata[i]['comment']+"&lt;br/&gt;"+plugin_www_post_tracker_ru.postdata[i]['date']+" "+plugin_www_post_tracker_ru.postdata[i]['status']; } return tmp; }</span></span></code> </pre><br><br>  <code>show_list()</code> in this code will add blocks with a prepared html-inside of the div with the scroller (by the way, I recommend <a href="http://filamentgroup.github.io/Overthrow/">Overthrow</a> and highly recommend <a href="http://cubiq.org/iscroll-4">iscroll-4</a> because of the terrible speed). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is time to add the ability to send new codes for tracking, but first add the action to the MENU button of your Android smartphone.  This is done using the <a href="http://docs.phonegap.com/en/2.7.0/cordova_events_events.md.html">menubutton event</a> .  To which we will link the appearance of the block with the button "Add track code", which, when pressed, will begin the process. <br><pre> <code class="javascript hljs"> put_trackCode: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         "  " var trackCode = prompt("  "); //      if (trackCode) { this._put_trackCode_getPath(trackCode); //        (    ),        if (plugin_www_post_tracker_ru.default_path) { //   ,   var comment = prompt(""); if (comment) { this._put_trackCode(trackCode,comment); //       } } else { alert("   "); } } else { menuButtonHide(); //     ,        } }, _put_trackCode_getPath: function (trackCode) { //   var cookies="PHPSESSID="+window.localStorage.getItem("plugin_www_post_tracker_ru_PHPSESSID")+"; userid="+window.localStorage.getItem("plugin_www_post_tracker_ru_userid")+"; securehash="+window.localStorage.getItem("plugin_www_post_tracker_ru_securehash"); var data="act=getPathForm&amp;trackcode="+encodeURIComponent(trackCode); ajax.send("http://post-tracker.ru/ajax/userTrackcodes.php",'POST',data,cookies,false,this._put_trackCode_getPath_result); }, _put_trackCode_getPath_result: function (data){ var wrapper=document.createElement('div'); //  ,   html wrapper.innerHTML=data; var tmp=wrapper.getElementsByTagName('input'); //      input if (tmp.length&gt;0) { plugin_www_post_tracker_ru.default_path=tmp[0].value; //  ,        }else{ plugin_www_post_tracker_ru.default_path=false; } }, _put_trackCode: function (trackCode,comment){ //       ,    var cookies="PHPSESSID="+window.localStorage.getItem("plugin_www_post_tracker_ru_PHPSESSID")+"; userid="+window.localStorage.getItem("plugin_www_post_tracker_ru_userid")+"; securehash="+window.localStorage.getItem("plugin_www_post_tracker_ru_securehash"); var data="act=addTrackcodeAction&amp;folderid="+plugin_www_post_tracker_ru.default_folder+"&amp;trackcode="+encodeURIComponent(trackCode)+"&amp;path="+plugin_www_post_tracker_ru.default_path+"&amp;comment="+encodeURIComponent(comment); ajax.send("http://post-tracker.ru/ajax/userTrackcodes.php",'POST',data,cookies,false,this._put_trackCode_result); }, _put_trackCode_result: function(data){ //   menuButtonHide(); //   plugin_www_post_tracker_ru.get_content(true); //         }</span></span></code> folderid =" + plugin_www_post_tracker_ru.default_folder + "&amp; trackcode =" + encodeURIComponent (trackCode) + "&amp; path =" + plugin_www_post_tracker_ru.default_path + "&amp; comment =" + encodeURIComponent (comment); <code class="javascript hljs"> put_trackCode: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//         "  " var trackCode = prompt("  "); //      if (trackCode) { this._put_trackCode_getPath(trackCode); //        (    ),        if (plugin_www_post_tracker_ru.default_path) { //   ,   var comment = prompt(""); if (comment) { this._put_trackCode(trackCode,comment); //       } } else { alert("   "); } } else { menuButtonHide(); //     ,        } }, _put_trackCode_getPath: function (trackCode) { //   var cookies="PHPSESSID="+window.localStorage.getItem("plugin_www_post_tracker_ru_PHPSESSID")+"; userid="+window.localStorage.getItem("plugin_www_post_tracker_ru_userid")+"; securehash="+window.localStorage.getItem("plugin_www_post_tracker_ru_securehash"); var data="act=getPathForm&amp;trackcode="+encodeURIComponent(trackCode); ajax.send("http://post-tracker.ru/ajax/userTrackcodes.php",'POST',data,cookies,false,this._put_trackCode_getPath_result); }, _put_trackCode_getPath_result: function (data){ var wrapper=document.createElement('div'); //  ,   html wrapper.innerHTML=data; var tmp=wrapper.getElementsByTagName('input'); //      input if (tmp.length&gt;0) { plugin_www_post_tracker_ru.default_path=tmp[0].value; //  ,        }else{ plugin_www_post_tracker_ru.default_path=false; } }, _put_trackCode: function (trackCode,comment){ //       ,    var cookies="PHPSESSID="+window.localStorage.getItem("plugin_www_post_tracker_ru_PHPSESSID")+"; userid="+window.localStorage.getItem("plugin_www_post_tracker_ru_userid")+"; securehash="+window.localStorage.getItem("plugin_www_post_tracker_ru_securehash"); var data="act=addTrackcodeAction&amp;folderid="+plugin_www_post_tracker_ru.default_folder+"&amp;trackcode="+encodeURIComponent(trackCode)+"&amp;path="+plugin_www_post_tracker_ru.default_path+"&amp;comment="+encodeURIComponent(comment); ajax.send("http://post-tracker.ru/ajax/userTrackcodes.php",'POST',data,cookies,false,this._put_trackCode_result); }, _put_trackCode_result: function(data){ //   menuButtonHide(); //   plugin_www_post_tracker_ru.get_content(true); //         }</span></span></code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ee9/eec/c32/ee9eecc32a499b68b747f3b986fe547e.png" align="right">  What else could be added to the application to practice with phoneGap?  First of all, <a href="http://docs.phonegap.com/en/2.7.0/cordova_globalization_globalization.md.html">localization</a> does not hurt, so that the text is not stored in the code and only the Russian language is not displayed for different countries.  It also does not hurt to work out <a href="http://docs.phonegap.com/en/2.7.0/cordova_events_events.md.html">some states</a> , for example, the loss of an Internet connection or <a href="http://docs.phonegap.com/en/2.7.0/cordova_events_events.md.html">clicking on the ‚Äúback‚Äù button</a> . <br>  In terms of the tracking service itself, it would be worthwhile to add an advertisement containing a resource, as well as to increase the functionality by adding folder creation, automatic checking with <a href="http://docs.phonegap.com/en/2.7.0/cordova_notification_notification.md.html">alerts</a> and a <s>whistle</s> <a href="http://docs.phonegap.com/en/2.7.0/cordova_media_media.md.html">sound effects</a> . <br><br>  <a href="http://nekaka.com/d/yZ0X3Tu42H">The source code of the project</a> and the <a href="http://nekaka.com/d/4Z55Vw1UpI">assembled application</a> for tests and experiments of interested parties.  As well as a githab for less dull forks <a href="">github.com/SovGVD/PhoneGap-post-tracker.ru</a> </div><p>Source: <a href="https://habr.com/ru/post/181610/">https://habr.com/ru/post/181610/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181598/index.html">XBMC 12.3 DSPlayer + SmoothVideo Project = dreams come true</a></li>
<li><a href="../181600/index.html">Many-to-many relationship, OLAP and MS SQL Server Analysis Services</a></li>
<li><a href="../181604/index.html">Visualization of lists in the Visual Studio debugger or a new word from ‚ÄúBugAid For Visual Studio‚Äù</a></li>
<li><a href="../181606/index.html">Three fifteen</a></li>
<li><a href="../181608/index.html">Curiosity talked about radiation in space</a></li>
<li><a href="../181614/index.html">SaaS Site Builders. Google sites</a></li>
<li><a href="../181616/index.html">Generate 3D grids with predefined surface regions using NetGen</a></li>
<li><a href="../181618/index.html">Popularity of Javascript Framework</a></li>
<li><a href="../181624/index.html">Three new Evernote security features</a></li>
<li><a href="../181626/index.html">How to run a program without an operating system: part 4. Parallel computing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>