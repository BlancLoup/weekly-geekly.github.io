<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript Compression and Combination Issues</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the publication of a series of notes on the subject of compression and combination of JavaScirpt-files, it is worth highlighting the most typica...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript Compression and Combination Issues</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://www.webogroup.com/home/site-speedup/"><img src="http://speedingupwebsite.com/wp-content/uploads/2010/01/005-150x150.png" alt="text file compression" title="text file compression" align="right"></a>  After the publication of a series of notes on the subject of <a href="http://webo.in/articles/habrahabr/11-minifing-javascript/">compression</a> and <a href="http://webo.in/articles/habrahabr/70-ant-optimization-automation/">combination of JavaScirpt-files,</a> it is worth highlighting the most typical problems of this very compression and combination. <br><br>  Let's start with a simple one: how JS compression can spoil our mood.  And how to raise it back :) <br><br>  <strong>UPD</strong> <a href="http://www.webogroup.com/home/offers/speed/">launched a site acceleration contest</a> .  In prizes: monitor, webcam, mouse.  Everything is hyper fast. <br><a name="habracut"></a><br><h3>  Javascript compression </h3><br>  In general, it is worth mentioning at once that compressing JavaScript files will give us only a 5-7% reduction in size relative to regular gzip, which can be used <strong>everywhere</strong> (no, really, everywhere - from <a href="http://code.google.com/p/web-optimizator/wiki/IntegrationWithWebsite" rel="nofollow">the Apache configuration through .htaccess</a> to <a href="http://webo.in/articles/habrahabr/07-gzip-all/">static compression through mod_rewrite + mod_mime</a> and <a href="http://webo.in/articles/habrahabr/58-nginx-reverse-proxy/">the nginx</a> (or LightSpeed) <a href="http://webo.in/articles/habrahabr/58-nginx-reverse-proxy/">configuration</a> . But back to the topic topic: we want to minimize the JavaScript files, what is the best way to do this? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Two years ago, a <a href="http://webo.in/articles/habrahabr/11-minifing-javascript/">review of current tools</a> was made, during which time the situation has not changed much (except for the <a href="http://code.google.com/closure/compiler/" rel="nofollow">Google Compiler</a> ).  But all in order. <br><br><ul><li> Let's start with the simple.  <a href="http://www.crockford.com/javascript/jsmin.html" rel="nofollow">JSMin</a> (or its clone, <a href="http://crisp.tweakblogs.net/blog/cat/716" rel="nofollow">JSMin +</a> ).  It works very universally (according to the principle of <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D0%25B5%25D1%2587%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D0%25B2%25D1%2582%25D0%25BE%25D0%25BC%25D0%25B0%25D1%2582" rel="nofollow">finite automata</a> ).  Almost always, the minimized file is even executed.  Additional gain (hereinafter relatively simple gzip) - up to 7% in the case of the advanced version, i.e.  very little.  The processor eats moderately (advanced version, JSMin + is stronger, and the memory is significant), but does not analyze the scope of variables, and therefore can not reduce their length.  In principle, it can be used for almost all scripts, but sometimes nuances are possible.  For example, conditional comments are deleted (it is treated) or various constructions are recognized incorrectly (for example, <code>+ +</code> converted to <code>++</code> , it breaks the logic), it is also treated, but more difficult. </li><li>  <a href="http://developer.yahoo.com/yui/compressor/" rel="nofollow">YUI Compressor</a> .  The most famous (until recently also the most powerful) tool for compressing scripts.  It is based on the Rhino engine (as far as we know, the engine roots are somewhere near the Dojo framework, that is, very, very long time ago).  Compresses scripts perfectly, works on the scope (can reduce the length of variables).  The compression ratio is up to 8% over gzip, however, the processor eats if you are healthy (due to the use of the Java virtual machine), so you should be careful when using online.  Also, due to the decrease in the lengths of variables, various problems are possible (and there are even potentially more of them than for JSMin). </li><li>  <a href="http://code.google.com/closure/compiler/" rel="nofollow">Google Closure Compiler has</a> appeared recently, but has already won public trust.  It is based on the same Rhino engine (aha, there is nothing new under the moon), but it uses more advanced algorithms for reducing the size of the source code ( <a href="http://javascript.ru/optimize/google-closure-compiler" rel="nofollow">an excellent overview in all details</a> ), up to 12% relative to gzip.  But here it is worth being triple cautious: a very substantial part of logic can be cut out, especially with aggressive transformations.  However, <a href="http://stackoverflow.com/questions/1691861/jquery-compiled-with-google-closure-compiler" rel="nofollow">jQuery already uses this tool</a> .  In terms of processor overhead, it seems to be even heavier than YUI (this fact has not been verified). </li><li>  and <a href="http://dean.edwards.name/packer/" rel="nofollow">Packer</a> .  This tool is already a thing of the past due to the development of communication channels and the lag of processor power: for the compression in it (an algorithm similar to gzip) is done by a JavaScript engine.  This provides a very significant (up to 55% without gzip) reduction in the size of the code, but additional costs up to 500-1000 ms for unpacking the archive.  Naturally, this becomes irrelevant if the processor power is limited (hi, IE), and the connection speed is very high (+ gzip is used and supported almost everywhere).  Additionally, this optimization method is most prone to various bugs after minimization. </li></ul><br>  Summary here: check JavaScript not only on the server where it is developed, but also after optimization.  Best of all - on the same unit-tests.  You will learn many new things about the described tools :) If this is not critical, then use just gzip (preferably static with the maximum compression ratio) to serve JavaScript. <br><br><h3>  Problems merging javascript files </h3><br>  After we dealt with the compression of JavaScript files, it would be good to touch on the topic of combining them.  The average site has 5-10 javascript files + several inline pieces of code that can somehow call plug-in libraries.  As a result, there are 10-15 pieces of code that can be combined together (the benefits of this sea are from the download speed on the user‚Äôs side to the server failover under DDoS ‚Äî every connection will be on the account, even a static one). <br><br>  But back to the sheep.  Now we will talk about some automation of the combination of "third-party" scripts.  If you have full access to them (and you are good at web development), then it is not a big deal to fix the problems (or exclude a number of problematic scripts from the association).  Otherwise (when a set of scripts does not want to unite without errors) the following approach is just for you. <br><br>  So, we have 10-15 pieces of code (some of them are in the form of embedded code, some are in the form of external libraries, which we can also ‚Äúmerge‚Äù together).  We need to guarantee their independent performance.  What is it? <br><br>  If we have a JavaScript error in the file, the browser stops executing this file in error (some of the most ancient ones also stop executing all JavaScript files on the page in this case, but we don‚Äôt really talk about it).  Accordingly, if the very first library that we want to merge into a common file gives an error, then in all browsers our client logic will collapse after merging.  It's sad. <br><br>  Additionally, it is worth noting that the built-in (inline) code is hard enough to debug.  It can either be excluded from the merge (for example, by placing a call to the merged file before or after the code), or, in case of its use, the merging of files can be canceled altogether. <br><br><h3>  backward compatibility </h3><br>  What can we do about it?  The easiest way is to exclude problem files (in this case, errors can occur only at the merge stage, while individual files can be worked out with a bang) from the merge logic.  To do this, you will need to keep track of where the error occurs, and assemble a configuration for combining for each such case. <br><br>  But you can do a little easier.  For JavaScript, we can use the <code>try-catch</code> construct.  Yeah, thought caught?  Not yet?  We can enclose all the contents of the files that we merge into <code>try {}</code> , and in <code>catch(e) {}</code> connect the external file in the following way: <br><blockquote><pre>  try {
	 ... the contents of the javascript library ...
 } catch (e) {
	 document.write ('initial javascript file call');
 // or console.log ('you need to exclude a JavaScript file from the union');
 } </pre></blockquote><br>  In this case, the user will download a single file if no problems have occurred.  If there were errors, then all external problem files will be connected in the same order.  This will ensure backward compatibility. <br><br><h3>  Performance issues </h3><br>  Obviously, this approach is not ‚Äúthe most correct‚Äù.  It would be most logical to identify JavaScript errors, fix them, and upload one file for all users.  But it is not always possible.  It is also worth considering that the <code>try-catch</code> design is rather heavy for execution in browsers (adds 10-25% to the initialization time), it is worth being careful with it. <br><br>  But the described approach can be wonderfully used for debugging specifically combining JavaScript files: after all, it allows you to determine exactly which files are ‚Äúgetting lost‚Äù (if there are several dozen files, this is very, very useful). <br><br><h3>  Small summary </h3><br>  After additional minimization of JavaScript files, be sure to check their functionality.  And debugging the correctness of combining JavaScript files can be easily automated, or even set up backward compatibility if it is impossible to debug specific scripts. </div><p>Source: <a href="https://habr.com/ru/post/86443/">https://habr.com/ru/post/86443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../86435/index.html">The authors of the letter to Medvedev found new enemies of copyright holders</a></li>
<li><a href="../86437/index.html">UbuntuTV: The Simplest Dock / Launcher</a></li>
<li><a href="../86439/index.html">Trading Systems for Dummies</a></li>
<li><a href="../86441/index.html">Atomic plugin - assistant when filling out forms</a></li>
<li><a href="../86442/index.html">Cheap planar position sensor based on PS / 2 Mouse, MatLab + MBED + PS / 2 Mouse</a></li>
<li><a href="../86444/index.html">Worms - alternative games. Part 1</a></li>
<li><a href="../86446/index.html">PDF Shuffler: Juggle PDF Files</a></li>
<li><a href="../86449/index.html">SmsPod.ru - mobile groups</a></li>
<li><a href="../86450/index.html">Where to get electronic components</a></li>
<li><a href="../86451/index.html">Caliber program. Library management and universal e-book converter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>