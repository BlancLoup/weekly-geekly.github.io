<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building a distributed VPN network based on Check Point. Several typical scenarios</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will consider options for building distributed networks using Check Point. I will try to describe the main features of Site-to-Sit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building a distributed VPN network based on Check Point. Several typical scenarios</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/i0/ll/tf/i0lltfmypmlglfufqawdkrksjk0.jpeg"><br><br>  In this article, we will consider options for building distributed networks using Check Point.  I will try to describe the main features of Site-to-Site VPN from Check Point, consider several typical scenarios, describe the pros and cons of each of them, and try to tell you how to save when planning a distributed VPN network. <br><br><h3>  Check Point uses standard IPSec </h3><br>  This is the first thing you need to know about Check Point Site-to-Site VPN.  And this thesis answers one of the most frequent questions regarding Check Point VPN: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote>  - Is it possible to ‚Äúmake friends‚Äù with other devices? <br>  - Yes, you can! </blockquote><br>  The so-called 3rd party VPN.  Since standard IPSec is used, VPNs can be built with any device that supports IPSec.  Personally, I tried to build VPNs with Cisco ASA, Cisco Router, D-Link, Mikrotik, StoneGate.  Everything works, although there are some features.  The main thing is to set all the parameters for the first and second phases.  Supported parameters for IPSec connections: <a name="habracut"></a><br><br>  <b>Encryption Method: IKEv1, IKEv2</b> <br><br>  <b>IKE Security Association (Phase 1)</b> <br>  - Encryption Algorithm: AES-128, AES-256, DES, 3DES, CAST <br>  - Data Integrity: SHA1, SHA256, SHA384, MD5, AES-XCBC <br>  - Diffie-Hellman group: Group 1, Group 2, Group 5, Group 14, Group 19, Group 20 <br><br>  <b>IKE Security Association (Phase 2)</b> <br>  - Encryption Algorithm: AES-128, AES-256, AES-GCM-128, AES-GCM-256, DES, 3DES, DES-40CP, CAST, CAST-40, NULL <br>  - Data Integrity: SHA1, SHA256, SHA384, MD5, AES-XCBC <br><br>  <b>Extra options:</b> <br>  - Use aggressive mode (Phase 1) <br>  - Use Perfect Forward Secrecy (Phase 2) <br>  - Support IP Compression (Phase 2) <br><br>  Since  VPN can be built not only with Check Point, then the question immediately arises, what is ‚Äúset‚Äù in the branches? <br><br><h3>  What equipment to use for affiliates? </h3><br>  There are only two options.  Consider them and try to describe the pros and cons of each of them. <br><br><h4>  1. Check Point at the branch </h4><br>  This is the easiest option.  Check Point is installed in the central office (HQ) and in the branches (Branch). <br><br>  <b>Pros</b>  The main plus is the convenience of management.  You manage security policies from one place (Security Management Server).  All logs are stored in one place.  It is possible to generate reports and see the big picture.  The administration of a distributed network is greatly simplified.  You may not even need a monitoring system, some of the functions are performed by the central server by default.  Configuring VPN is accelerating, there is no need for endless editing of access-lists.  In a rough approximation, this can be compared with DMVPN from Cisco (more on that later). <br><br>  <b>Cons</b> .  The only negative - financial costs.  Of course, the question ‚Äúexpensive or inexpensive‚Äù is a bit philosophical and I will not discuss this topic.  But even the smallest branch (even an ATM) will require the installation of a Check Point gateway.  We will discuss specific models for such tasks a little later. <br><br>  <b>Who uses a similar option (Check Point in the branch)?</b>  In fact, almost all business segments: banks, retail, industry, health care, oil and gas companies. <br><br><img src="https://habrastorage.org/webt/tu/7k/cl/tu7kclil7c3iyzlho9ryuwxurbc.png"><br>  <i>Fig.</i>  <i>1. Check Point SmartConsole with the display of all branch office gateways</i> <br><br><h4>  2. NOT Check Point at the branch </h4><br>  Also quite common option.  Check Point is in the center (HQ), and in Branch (Branch) - any other device that supports IPSec VPN. <br><br>  <b>Pros</b>  Perhaps the only plus is the minimum financial costs.  You can put the cheapest Mikrotik or D-Link, VPN to the central office will work fine. <br><br>  <b>Cons</b> .  Cons much more.  In fact, you lose all the advantages described in the previous version.  We'll have to "handles" to edit the settings on each of the branches.  If there are 2 - 3, then perhaps this is not such a big problem.  But if there are more than 5-10, then there will be a serious question of further scaling.  Configuration management, access policies, monitoring, all this will have to be organized on the basis of third-party solutions (possibly open source).  Another big disadvantage is that it is impossible to organize a backup of the VPN channel. <br>  <b>Who uses a similar option (NOT Check Point at the branch)?</b>  Typically, this is a small business with a small number of branches. <br><br><h3>  Type of Internet access for affiliates.  Independent or centralized? </h3><br>  The choice of device for the branch depends on the type of Internet access.  Here, too, two options, and each has its own pros and cons. <br><br><h4>  1. Independent access to the Internet </h4><br>  Used most often.  The VPN channel is used exclusively for accessing the resources of the central office (where Check Point is located). <br><br>  <b>Pros</b>  Internet access does not depend on the VPN channel and equipment in the central office.  Those.  if there is everything ‚Äúfallen‚Äù in the central office, the branch will maintain access to the Internet, it will simply lose access to some corporate resources. <br><br>  <b>Cons</b> .  Significantly complicates the management of security policies.  In fact, if you have the task of securing branches, then you should apply such protective measures as IPS, streaming antivirus, URL filtering, etc.  This results in a lot of problems with the management and monitoring of information security. <br><br>  <b>Recommendations</b> .  With this option, of course, it is better to use Check Points on branches.  You can manage all this ‚Äúfarming‚Äù centrally.  You can create one typical Internet access policy and ‚Äúroll it out‚Äù to all branches.  Monitoring is also greatly simplified.  You will see all security incidents in one place with the possibility of correlation of events. <br><br><h4>  2. Centralized Internet access </h4><br>  This option is used much less frequently.  VPN is built to the central office (where Check Point is located) and absolutely all traffic of the branches is wrapped there.  Internet access is possible only through the central office. <br><br>  <b>Pros</b>  In this case, you basically do not care what is in the branch, the main thing is to build a VPN to the center.  There should not be big problems with the config either, since  in fact, there will be only one rule - ‚Äúall traffic in vpn‚Äù.  All security policies and access lists you will configure only in the central office.  As you understand, with this option, you significantly save on the purchase of Check Point. <br><br>  <b>Cons</b> .  There is still a problem with scalability, management and monitoring (although not as critical as with independent access to the Internet).  Plus, the work of branches depends entirely on the central office.  In the event of a contingency situation, the entire network will fall.  Branches will remain without the Internet. <br><br>  <b>Recommendations</b> .  This option is great for a small number of branches (2-4).  Of course, if you are satisfied with the risks voiced (dependence on the center).  When choosing a Check Point device for the central office, it is worth considering the traffic of the branches and carefully calculate the desired performance.  In essence, you will receive centralized management of branch traffic with minimal financial costs.  However, with a large number of branches (and ‚Äúserious‚Äù traffic), such a scheme is highly discouraged.  Too big consequences in case of failure.  Troubling will be complicated, and the central office will require very powerful hardware, which may eventually become more expensive than if the branches had their own Check Point gateways. <br><br><h3>  Possible savings on licenses </h3><br>  If you decide to use Check Point in branches and you only need a VPN (for example, with a centralized Internet connection), then you can significantly save on licenses.  Blade IPSec VPN is not licensed.  By purchasing a device, you always get the functionality of Firewall and VPN.  You do not need to buy extension services for this, everything will work anyway. <br><br>  The only thing you have to buy is the technical support service so that you can contact the support and replace the device in case of a breakdown.  However, there <b>is an option to save</b> (although I do not recommend it).  If you are confident in your knowledge and that you do not have to contact support, you can not buy an extension of technical support. <br><br>  You can purchase one or two devices in the spare parts kit and if a breakdown occurs in one of the branches, then simply change this device.  With a large number of branches, it may be more cost-effective to buy a pair of spare devices than to buy support for all the rest.  I repeat that I do not recommend this option. <br><br><h3>  Check Point Models for Branch (SMB) </h3><br>  There is an opinion that Check Point is a vendor exclusively for large companies.  However, in the model range there are quite a few options for devices for the SMB sector.  Especially if this ‚Äúpiece of hardware‚Äù will be used for branches, being under the control of the central Management Server in the head office. <br><br><img src="https://habrastorage.org/webt/n8/59/mr/n859mrzmakb2sa6unnclf8omcoq.png"><br>  <i>Fig.</i>  <i>2. Check Point Lineup</i> <br><br>  We have already published a <a href="https://habr.com/company/tssolution/blog/336298/">separate article on SMB solutions</a> , so I will simply list the models that are most often used for branches: <br><br><ol><li>  5000th series (5100, 5200) for large branches (150-200 people); </li><li>  3000th series (3100, 3200) for medium-sized branches (100-150 people); </li><li>  1400th series (1430, 1450, 1470, 1490) for small branches (less than 100 people). </li></ol><br>  Data on the number of people exclusively our subjective opinion based on experience.  We highly recommend to pay attention to the 1400 series. These are relatively new models based on ARM processors.  They have some technological limitations compared to older models (because another OS is used - Gaia Embedded), however, if there is a Management Server, these limitations are insignificant, especially for branch networks. <br><br><h3>  VPN topology (Start, Mesh) </h3><br>  Let's talk about more ‚Äútechnical‚Äù things and start with VPN topologies (VPN Community in Check Point terminology).  Like other vendors, Check Point has two types: <br><br><ol><li>  <b>Star</b> .  The name speaks for itself.  VPN channels from all branches converge to the center.  With this topology, even if the branches need to communicate with each other, the traffic will go through the center.  Sometimes it is not very convenient and practical.  Although in practice, this topology is most often used. </li><li>  <b>Mesh</b> .  Each with each topology.  There is no center here.  All gateways placed in the same Mesh VPN Community can build tunnels with each other. </li></ol><br><img src="https://habrastorage.org/webt/ee/l5/cd/eel5cdud1eklwbn6muyvbsnhw_e.png"><br><br>  It should be noted that in this case no one bothers you to combine these two topologies.  For example, to connect two Start Community through one Mesh: <br><br><img src="https://habrastorage.org/webt/ca/yv/bu/cayvbuhzu3h3c6ckn-hpgrukxxg.png"><br>  <i>Fig.</i>  <i>3. Star + Mesh</i> <br><br><h3>  Two types of tunnels </h3><br>  Finally, we reached a point where we can discuss what a Check Point VPN is really convenient for, provided that the branches also have Check Point.  When building a VPN tunnel, we have a choice of two types: <br><br><h4>  1. Domain Based VPN </h4><br>  The meaning is pretty simple.  In the properties of the branch gateway (and the center too) you specify the networks that are behind Check Point, i.e.  local networks of branches. <br><br><img src="https://habrastorage.org/webt/kb/s2/od/kbs2odikif0xen3pb65cvqoylrw.png"><br>  <i>Fig.</i>  <i>4. VPN Domain Definition</i> <br><br>  Since all gateways are managed by a single server management, this information is ‚Äúfumbled‚Äù between all members of the VPN Community (whether it is Star or Mesh).  Thus, there is no need to edit the VPN settings on each of the gateways, they will already know where, which network and with which IPSec parameters to build the VPN.  No prescription of peers or access lists.  Setup is quick and quite simple.  In my opinion it is even more convenient than DMVPN.  Domain based VPN is the most commonly used practice. <br><br><h4>  2. Route Based </h4><br>  This type of VPN will seem very familiar to Cisco fans.  On the gateways, a VTI (Virtual Tunnel Interface) is created and a VPN channel with tunnel addresses is raised.  The traffic that is rounded up in the tunnel is encrypted.  In this case, the routes can be both static and dynamic.  For example, you can raise such a VPN with all branches and run OSPF.  Thus, all gateways will know about all available networks and automatically ‚Äúwrap‚Äù the necessary traffic into the desired tunnel.  I think this can be compared with GRE tunnels. <br><br><h4>  Recommendations </h4><br>  Route based VPN is used much less frequently.  in most cases, there is enough Domain Based VPN, which is easier to understand and faster to set up.  In this case, Domain Based VPN can be used in the case of third-party equipment (NOT Check Point) in the branches.  Again, based on personal experience, I can recommend using Domain Based VPN.  There will be much less problems.  Route Based is better not to use at all (a lot of limitations, degradation in performance).  Although of course it all depends on your tasks and each case must be considered separately. <br><br><h3>  VPN on certificates or Pre-shared key </h3><br>  Like any device with IPSec support, Check Point can build VPNs based on a Pre-shared key and based on certificates.  I will not explain the advantages of the VPN channel on certificates.  Just to say that another advantage of building a distributed network on Check Point solutions is the presence of an integrated certificate authority (CA).  This CA is always present on the Management Server by default and automatically generates certificates for all Check Point gateways that are under its control.  No need to ‚Äúsuffer‚Äù with a third-party certification authority (although it can also be ‚Äúscrewed‚Äù to Check Point). <br><br><h3>  VPN fault tolerance </h3><br>  Quite often they forget about this opportunity.  And she is.  In the branch and central office there can be two Internet channels.  If the branch also has Check Point, then we can configure a fault tolerant VPN (Domain Based).  Do not neglect this Check Point feature, especially since it is configured in just a few clicks. <br><br><h3>  Licensing Management Server </h3><br>  Another important point that is forgotten when planning a distributed network.  Security Management Server is licensed by the number of gateways it can manage.  There are licenses to manage 5 gateways, 10, 25, 50, 150 and more.  The prices are very different.  A cluster counts as two gateways!  Be careful when planning your budget. <br><br><h3>  Additional benefits of Check Point VPN </h3><br>  From a technical point of view, Check Point VPN has many more advantages.  It would be possible to tell about wire mode, the ability to constantly keep the tunnel even if there is no traffic, the ability to create different rules for encrypted and normal traffic, the ability to exclude a certain type of traffic from the tunnel, etc.  But I would not like to go into such technical details in order not to tire anyone.  If you are interested in something specific, then ask in the comments.  I tried to go more on architectural features. <br><br>  <b>PS</b> Thanks to <b>Ilya Gorelkin</b> (Check Point company) for help in preparing the material. </div><p>Source: <a href="https://habr.com/ru/post/428461/">https://habr.com/ru/post/428461/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428449/index.html">Java Challengers # 2: String Comparison</a></li>
<li><a href="../428451/index.html">KubeDirector - an easy way to run complex stateful applications in Kubernetes</a></li>
<li><a href="../428453/index.html">How programmers saved their homeland</a></li>
<li><a href="../428455/index.html">Relocation to Nizhny Novgorod</a></li>
<li><a href="../428457/index.html">Bypassing labels: SoundCloud launched direct deals with musicians - conditions were criticized</a></li>
<li><a href="../428465/index.html">Instructions for Business Impact Analysis</a></li>
<li><a href="../428467/index.html">Everything's under control. Why do we need monitoring systems of engineering infrastructure of data processing centers</a></li>
<li><a href="../428469/index.html">Single Core Windows</a></li>
<li><a href="../428471/index.html">Copyright law just got a little better in terms of video game history.</a></li>
<li><a href="../428475/index.html">How designers are deceiving themselves</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>