<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How does A / B testing in Avito</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. My name is Daniel, I work in a team that develops the analytical infrastructure in Avito. A / B testing is central to this infrastructure. 


 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How does A / B testing in Avito</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello.  My name is Daniel, I work in a team that develops the analytical infrastructure in Avito.  A / B testing is central to this infrastructure. </p><br><p>  A / B experiments are a key decision-making tool in Avito.  In our product development cycle, the A / B test is a mandatory step.  We test every hypothesis and roll out only positive changes. </p><br><p>  We collect hundreds of metrics and are able to drill them down to business sections: verticals, regions, authorized users, etc. We do this automatically using a single platform for experiments.  In the article I will describe in some detail how the platform is arranged and we will dive into some interesting technical details. </p><br><p><img src="https://habrastorage.org/webt/ts/r_/qw/tsr_qwh3l7qfw2kob14z0lsaiya.png"></p><a name="habracut"></a><br><p>  The main functions of the platform A / B we formulate as follows. </p><br><ol><li>  Helps to quickly run experiments. </li><li>  Controls unwanted intersection experiments </li><li>  Counts metrics, stat.  tests, visualizes the results </li></ol><br><p>  In other words, the platform helps to make quick and accurate decisions. </p><br><p>  If you leave out the process of developing features that are sent to testing, the full cycle of the experiment looks like this: </p><br><p><img src="https://habrastorage.org/webt/ve/wd/by/vewdbye97eexzetbj3riubs-i1w.png"></p><br><ul><li>  The customer (analyst or product manager) configures the experiment parameters through the admin panel. </li><li>  Split service, according to these parameters, distributes the required A / B group to the client device. </li><li>  User actions are collected in raw logs that go through aggregation and turn into metrics. </li><li>  Metrics are ‚Äúrun‚Äù through statistical tests. </li><li>  Results are visualized on the internal portal on the day after launch. </li></ul><br><p>  All data transport in a cycle takes one day.  Experiments usually last a week, but the customer receives an increment of results every day. </p><br><p>  Now let's dive into the details. </p><br><h1 id="upravlenie-eksperimentom">  Experiment Management </h1><br><p>  In the admin to configure the experiments using the YAML format. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/lb/ko/k_/lbkok_pnexw8kzvdlkoq1jteuzy.png"></a> </p><br><p>  This is a convenient solution for a small team: the refinement of the capabilities of the config goes without a front.  The use of text configurations simplifies the work for the user: you need to make fewer mouse clicks.  A similar solution is used by the <a href="https://medium.com/airbnb-engineering/experiment-reporting-framework-4e3fcd29e6c0">Airbnb A / B framework</a> ). </p><br><p>  To divide traffic into groups, we use the common salt hashing technique. </p><br><p><img src="https://habrastorage.org/webt/fs/ar/r_/fsarr_kezrgckfiuvf1w1uyuqfs.png"></p><br><p>  To eliminate the effect of the ‚Äúmemory‚Äù of users, when starting a new experiment, we do additional mixing with the second salt: </p><br><p><img src="https://habrastorage.org/webt/va/io/2z/vaio2zpxowsnz8nbs9bkv8r3d90.png"></p><br><p>  The same principle is described in the <a href="https://habr.com/ru/company/yandex/blog/342704/">presentation of Yandex</a> . </p><br><p>  In order to avoid potentially dangerous intersections of experiments, we use logic <a href="https://ai.google/research/pubs/pub36500">similar to ‚Äúlayers‚Äù in Google</a> . </p><br><h1 id="sbor-metrik">  Metrics collection </h1><br><p>  We lay out raw logs in Vertica and aggregate into spreadsheets with the structure: </p><br><p><img src="https://habrastorage.org/webt/v6/tw/bv/v6twbvgj-togpdbylpqq21gfbz0.png"></p><br><p>  Observations are, as a rule, simple event counters.  Observations are used as components in a metric formula. </p><br><p>  The formula for calculating any metric is a fraction, the numerator and denominator of which is the sum of observations: </p><br><p><img src="https://habrastorage.org/webt/me/sb/or/mesbordzixv0yrcl4oo5nho5aa4.png"></p><br><p>  In one of the <a href="https://youtu.be/vIdwgJFz5Mk%3Ft%3D787">reports of Yandex,</a> metrics were divided into two types: by users and Ratio.  There is a business sense in this, but in the infrastructure it is more convenient to consider all metrics uniformly in the form of Ratio.  This generalization is valid because the ‚Äúpointer‚Äù metric is obviously representable as a fraction: </p><br><p><img src="https://habrastorage.org/webt/d_/ih/l5/d_ihl5vdcvdguaohaytz5xkfepy.png"></p><br><p>  We summarize the observations in the numerator and denominator of the metric in two ways. <br>  Simple: </p><br><p><img src="https://habrastorage.org/webt/q9/fk/vc/q9fkvc6qsmj6dzwqknqnqwpgrts.png"></p><br><p>  This is the usual sum of any set of observations: the number of searches, clicks on ads, etc. <br>  And more difficult: </p><br><p><img src="https://habrastorage.org/webt/iu/_s/ru/iu_srukdm2pyxrvoizc68butlx8.png"></p><br><p>  A unique number of keys, grouped by which the sum of observations is greater than the specified threshold. </p><br><p>  Such formulas are easily defined using the YAML-config: </p><br><p><img src="https://habrastorage.org/webt/ga/i3/qj/gai3qjape-xmwg2pyfg0snj6lao.png"></p><br><p>  The groupby and threshold parameters are optional.  Just they determine the second method of summation. </p><br><p>  The described standards allow you to configure almost any online metric that you can think of.  At the same time, simple logic is preserved, which does not impose an excessive load on the infrastructure. </p><br><h1 id="statisticheskiy-kriteriy">  Statistical criterion </h1><br><p>  We measure the significance of deviations by metrics using classical methods: <a href="https://en.wikipedia.org/wiki/Welch%2527s_t-test">T-test</a> , <a href="https://en.wikipedia.org/wiki/Mann%25E2%2580%2593Whitney_U_test">Mann-Whitney U-test</a> .  The main prerequisite for applying these criteria is that the observations in the sample should not depend on each other.  In almost all of our experiments, we believe that users (Uid) satisfy this condition. </p><br><p><img src="https://habrastorage.org/webt/v-/ya/nz/v-yanzyx8c--fqqgnzkhlkg4j0c.png"></p><br><p>  Now the question arises: how to conduct T-test and MW-test for Ratio-metrics?  For T-test, you need to be able to consider the variance of the sample, and for MW, the sample must be ‚Äúby the switch‚Äù. </p><br><p><img src="https://habrastorage.org/webt/d-/7j/p2/d-7jp2xfsktkjajzki-wrp8sugw.png"></p><br><p>  Answer: you need to decompose the <a href="http://www.stat.cmu.edu/~hseltman/files/ratio.pdf">Ratio in a Taylor series to the first order at the point</a> <math> <a href="http://www.stat.cmu.edu/~hseltman/files/ratio.pdf"></a></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo stretchy=&quot;false&quot;>(</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>E</mi></mrow><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy=&quot;false&quot;>[</mo><mi>X</mi><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy=&quot;false&quot;>]</mo><mo>,</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>E</mi></mrow><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy=&quot;false&quot;>[</mo><mi>Y</mi><mtext>&amp;#xA0;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy=&quot;false&quot;>]</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="33.139ex" height="2.66ex" viewBox="0 -832 14268.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-28" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-45" x="389" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-6C" x="1404" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-65" x="1702" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-66" x="2169" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-74" x="2719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-5B" x="3081" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-58" x="3359" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-72" x="4462" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-69" x="4913" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-67" x="5259" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-68" x="5739" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-74" x="6316" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-5D" x="6677" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-2C" x="6956" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-45" x="7401" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-6C" x="8415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-65" x="8714" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-66" x="9180" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-74" x="9731" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-5B" x="10092" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-59" x="10371" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-72" x="11384" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-69" x="11836" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-67" x="12181" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-68" x="12662" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMATHI-74" x="13238" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-5D" x="13600" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/avito/blog/454164/&amp;xid=17259,15700023,15700186,15700191,15700256,15700259&amp;usg=ALkJrhgAlFgBAEX_eixg1pKueaKvQYqigA#MJMAIN-29" x="13878" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow><mtext>&nbsp;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">[</mo><mi>X</mi><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">]</mo><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow><mtext>&nbsp;</mtext><mi>l</mi><mi>e</mi><mi>f</mi><mi>t</mi><mo stretchy="false">[</mo><mi>Y</mi><mtext>&nbsp;</mtext><mi>r</mi><mi>i</mi><mi>g</mi><mi>h</mi><mi>t</mi><mo stretchy="false">]</mo><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-1"> ({E} \ left [X \ right], {E} \ left [Y \ right]) </script>   : </p><br><p><img src="https://habrastorage.org/webt/ky/im/td/kyimtdhnynvygcu_r867uzeoubu.png"></p><br><p>  This formula converts two samples (numerator and denominator) into one, keeping the mean and variance (asymptotically), which allows the use of the classic stat.  tests. </p><br><p><img src="https://habrastorage.org/webt/il/h3/ac/ilh3acbdbdjnszyjezba85ee4ku.png"></p><br><p>  A similar idea colleagues from Yandex called the method of linearization Ratio (performances <a href="https://youtu.be/vIdwgJFz5Mk%3Ft%3D1062">one</a> and <a href="https://youtu.be/PE29k3CP72U%3Ft%3D1209">two</a> ). </p><br><h1 id="proizvoditelnost-pri-masshtabirovanii">  Scale performance </h1><br><p>  Use of CPU quick stats.  criteria makes it possible to spend millions of iterations (comparisons treatment vs. control) in minutes on a completely normal server with 56 cores.  But in the case of large amounts of data, performance rests primarily on storage and read time from disk. </p><br><p>  The calculation of Uid metrics daily generates samples with a total size of hundreds of billions of values ‚Äã‚Äã(due to the large number of simultaneous experiments, hundreds of metrics and cumulative accumulation).  Every day it‚Äôs too difficult to remove such volumes from the disk (despite the large cluster of the Vertica column base).  Therefore, we are forced to reduce the cardinality of the data.  But we do it almost without losing information about the dispersion using a technique that we call ‚ÄúBuckets‚Äù. </p><br><p>  The idea is simple: we hash Uids and, based on the remainder of the division, ‚Äúscatter‚Äù them into a number of buckets (we denote their number by B): </p><br><p><img src="https://habrastorage.org/webt/cd/1h/x-/cd1hx-k8rgilkmwxafotz3-tgok.png"></p><br><p>  Now go to the new experimental unit - bakt.  Observations in the bake summarize (numerator and denominator independently): </p><br><p><img src="https://habrastorage.org/webt/yv/jq/bz/yvjqbz34yd8yswtoff50zpgj3g0.png"></p><br><p>  With such a transformation, the condition on the independence of the observations is fulfilled, the value of the metric does not change, and it is easy to check that the variance of the metric (the average for the sample of observations) is preserved: </p><br><p><img src="https://habrastorage.org/webt/df/ku/6p/dfku6pb74plagc0doxg62blhdly.png"></p><br><p>  The more buckets, the less information is lost, and the less error in equality.  In Avito, we take B = 200. </p><br><p>  The density of distribution of the metric after the bake conversion always becomes similar to normal. </p><br><p><img src="https://habrastorage.org/webt/fk/sa/rf/fksarfomowkwdzzhwveb10vbtr0.png"></p><br><p>  Arbitrarily large samples can be reduced to a fixed size.  Growth in the amount of stored data in this case depends only linearly on the number of experiments and metrics. </p><br><h1 id="vizualizaciya-rezultatov">  Results visualization </h1><br><p>  As a visualization tool, we use Tableau and a web view on the Tableau Server.  Every Avito employee has access there.  It should be noted that Tableau handles the task well.  Implementing a similar solution using a full-fledged back-front development would be a far more resource-intensive task. </p><br><p>  The results of each experiment are a sheet of several thousand numbers.  Visualization should be such as to minimize the wrong conclusions in the case of the implementation of <a href="https://en.wikipedia.org/wiki/Type_I_and_type_II_errors">errors of the I and II kind</a> , and not to ‚Äúoverlook‚Äù changes in important metrics and sections. </p><br><p>  First, we monitor the ‚Äúhealth" metrics of the experiments.  That is, we answer the questions: "Is the number of participants" equal "poured" into each of the groups? "," Is there an equal number of authorized or new users? ". </p><br><p> <a href=""><img src="https://habrastorage.org/webt/k1/-r/-x/k1-r-xrjn1gyeg8-o6-9eolq-qe.png"></a> </p><br><p> In the case of statistically significant deviations, the corresponding cells are highlighted.  Hovering over any number displays cumulative daily dynamics. </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ju/ke/z0/jukez0yfvsmoyu_gmpy384rsmzc.png" width="600"></a> </p><br><p>  The main dashboard with metrics looks like this: </p><br><p> <a href=""><img src="https://habrastorage.org/webt/ng/mb/ju/ngmbjufio9wsbf0mnpld0ldqajq.png"></a> </p><br><p>  Each line is a comparison of groups on a specific metric in a specific section.  On the right is a panel with filters for experiments and metrics.  Below - a panel of filters on the cuts. </p><br><p>  Each metric comparison consists of several indicators.  Let us analyze their values ‚Äã‚Äãfrom left to right: </p><br><p>  <strong>1. MDE.</strong>  <strong>Minimum Detectable Effect</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/sy/xw/gk/syxwgkaimg-pgsqtnrriv8ybf5e.png"></a> </p><br><p>  And Œ≤ are preselected probabilities of errors of types I and II.  MDE is very important if the change is not statistically significant.  When making a decision, the customer should remember that the absence of a stat.  significance is not equivalent to the absence of effect.  Sure enough, we can only say that the possible effect is no more than MDE. </p><br><p>  <strong>2. MW |</strong>  <strong>T. Results Mann-Whitney U- and T-test</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/za/vs/j8/zavsj8pnzmrazz-maz_lucwjrti.png"></a> </p><br><p>  The panel displays the value of z-and t-statistics (for MW and T, respectively).  In tooltip - p-value dynamics.  If the change is significant, the cell is highlighted in red or green depending on the sign of the difference between the groups.  In this case, we say that the metric is ‚Äúpainted over‚Äù. </p><br><p>  <strong>3. Lift.</strong>  <strong>Percentage difference between groups</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/cr/db/fk/crdbfkcytwrjdzez3l-v1gu1c8e.png"></a> </p><br><p>  <strong>4. Mean |</strong>  <strong>Num |</strong>  <strong>Den.</strong>  <strong>The value of the metric, as well as the numerator and denominator separately</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/8d/kc/wp/8dkcwpugkmf6f6qqdrmnksp-rda.png"></a> </p><br><p>  We apply another T-test to the numerator and denominator, which helps to understand whose contribution is decisive. </p><br><p>  <strong>5. Std.</strong>  <strong>Selective Standard Deviation</strong> <br>  <strong>6. Hist.</strong>  <strong>Shapiro-Wilk test for normal "bake" distribution.</strong> </p><br><p> <a href=""><img src="https://habrastorage.org/webt/0d/dh/h6/0ddhh68_mdhgjpb6dyufnucnmfc.png"></a> </p><br><p>  If the indicator is red, then there may be outliers or an abnormally long tail in the sample.  In this case, the result for this metric should be taken carefully, or not taken at all.  Clicking on the indicator opens the histograms of the metric by groups.  By the histogram, anomalies are clearly visible - it is easier to draw conclusions. </p><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  The advent of the A / B platform in Avito is a turning point when our product began to grow faster.  Every day we accept green experiments that charge the team;  and "red", which provide useful food for thought. </p><br><p>  We managed to build an effective A / B testing system and metrics.  Often we solved complicated problems with simple methods.  Due to this simplicity, the infrastructure has a good margin of safety. </p><br><p>  I‚Äôm sure those who are going to build an A / B platform in their company have found some interesting insights in the article.  I am pleased to share with you our experience. </p><br><p>  Write questions and comments - we will try to answer them. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/454164/">https://habr.com/ru/post/454164/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../454144/index.html">In Java 13, they want to add "blocks of text"</a></li>
<li><a href="../454148/index.html">SOC performance review</a></li>
<li><a href="../454154/index.html">Branches of Hell: Cloud Control of Illegal Dumps and Dangerous Polygons</a></li>
<li><a href="../454156/index.html">Tires and protocols in industrial automation: how it all works</a></li>
<li><a href="../454160/index.html">Using PowerShell to elevate local account privileges</a></li>
<li><a href="../454166/index.html">June 6 - VeeamON Forum in Moscow</a></li>
<li><a href="../454168/index.html">The main arena of the country. How were updated "Luzhniki" before the World Cup</a></li>
<li><a href="../45417/index.html">Project documentation or Mom told me ...</a></li>
<li><a href="../454170/index.html">Welcome to DroidHeads Meetup June 8</a></li>
<li><a href="../454172/index.html">Sending statistics from a DataFrame to BigQuery using the example of Yandex Yandex Statistics</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>