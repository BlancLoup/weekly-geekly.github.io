<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FLProg - combining Arduino boards into an information ring</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting from version 1.10.5, FLProg allows you to combine several Arduino boards into a ring UART network. First, consider how this happens. The boar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FLProg - combining Arduino boards into an information ring</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/3a5/1f2/9cc/3a51f29ccc5049a5a4ab47a96141f675.png"><br><br>  Starting from version 1.10.5, FLProg allows you to combine several Arduino boards into a ring UART network.  First, consider how this happens.  The boards are interconnected in accordance with the scheme shown in the title illustration.  Suppose that card 1 sends through UART a data packet containing the card identifiers, variable, as well as the value of the variable.  Card 2 accepts this packet and if it does not need data from this variable, then simply sends this packet further.  If, in accordance with the program, the value of this variable is needed by the controller, then the value from the packet is copied into the internal variable, and the packet is also sent further along the ring. <br>  When in this way the package, having passed the entire ring, returns to the board that sent it, the transmission of the package will stop. <br>  Thus, the data from the package is available to any board connected to the ring, and any of the boards can also be the initiator of sending a packet. <br><a name="habracut"></a><br>  The scheme of the test stand: <br><br><img src="https://habrastorage.org/files/fda/b35/082/fdab35082e3f46c9904e0f1401c857f6.PNG">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The logic of work is as follows: <br><ul><li>  Arduino ‚Ññ1 receives data on temperature and humidity c sensors. </li><li>  Arduino ‚Ññ2 displays the temperature from the sensor DS18B20. </li><li>  Arduino ‚Ññ3 displays temperature and humidity from a DHT-22 sensor. </li></ul><br>  To avoid angry comments that such logic is not needed and is nonsense, I‚Äôll clarify that this project is purely educational and is intended to explain the principles of data transmission through the information ring.  To do this, make a little more nonsense in the logic of work. <br><ul><li>  The digital temperature value from the DS18B20 sensor catches the Arduino # 3, then converts it into a string and sends it to the ring.  This line catches Arduino ‚Ññ2 and displays on the display. </li><li>  The digital temperature value from the DHT-22 sensor catches the Arduino # 2, then converts it into a string and sends it to the ring.  This line catches Arduino number 3 and displays on the display. </li><li>  The digital humidity value from the DHT-22 sensor catches the Arduino # 3, then converts it into a string and displays it on the display. </li></ul><br>  So, let's begin. <br>  Open the FLProg program and create a project for the Arduino # 1.  We throw the OneWire bus scanner on the first board (library of elements, ‚ÄúMiscellaneous‚Äù folder).  This block, on the leading edge at the input En, scans the OneWire bus and, when the sensors are located on them, adds the detected addresses to the associated arrays.  To parameterize a block, call the block editor (double click on the block). <br><br><img src="https://habrastorage.org/files/7fc/fca/96c/7fcfca96c6c04b70bb499b56fde394b7.PNG"><br><br><ol><li>  First, create a new OneWire bus. <br><img src="https://habrastorage.org/files/845/fa2/649/845fa26496594bb3a63bb41e27ddd91a.png"></li><li>  Then create an array.  Since the sensor on our bus is planned alone, we create one array. <br><img src="https://habrastorage.org/files/9c0/ee5/295/9c0ee5295da94ee7aadcca350a90eb47.png"></li></ol><br>  Now we will organize the scheme of starting this block once at the start of the program.  To do this, we collect such a scheme. <br><br><img src="https://habrastorage.org/files/1aa/430/4d8/1aa4304d8d7d48b1964b79769f29acf5.PNG"><br><br>  R - The trigger is located in the Triggers folder of the element library.  It serves to highlight the leading edge of the pulse fed to the input.  At its output there will be an impulse lasting one cycle of the program when the input level goes from low to high. <br>  Then we create a new board and drag the DS18x2x temperature sensor (component library, ‚ÄúSensors‚Äù folder) onto it.  Call the block editor and parameterize the sensor. <br><br><img src="https://habrastorage.org/files/fac/98a/6e3/fac98a6e39da4acd86f52448c57a6445.PNG"><br><br><ol><li>  From the drop-down list, select the previously created OneWire bus on pin 4 </li><li>  Select the mode of setting the address "Array" </li><li>  Select the previously created array "Sensor" </li><li>  We set a periodic polling mode of the sensor, with a frequency of polling every 1 sec. </li></ol><br><br>  Now the value obtained from the sensor must be sent to the ring. <br>  In FLProg, you can connect a controller to the ring in two ways.  In this project for Arduino # 1, we will consider the first method - through the blocks of sending a variable to a ring. <br>  Let's pull out the ‚ÄúSend variable to ring‚Äù block (library of elements, UART folder) on the board, and call the block editor for it. <br><br><img src="https://habrastorage.org/files/3fb/fae/a4b/3fbfaea4b20e4543840360df2199de67.PNG"><br><br><ol><li>  First add the controller to the ring. <br><img src="https://habrastorage.org/files/390/834/8e8/3908348e852046a09e853869d59d130a.PNG"><br>  In the window that opens, you must select the port to connect to the ring, the port speed, and set the device name in the ring.  Also for the convenience of working with the project, it is desirable to create a file of the list of ring variables through which all controllers participating in it will be synchronized. <br></li><li>  Then create a variable that will be passed to the ring. <br><img src="https://habrastorage.org/files/569/d40/ed6/569d40ed63974de785e9827eeefeaa83.PNG"><br>  In the create variable window, you must specify the name of the variable and its type. <br></li><li>  After that we set the periodic mode of sending a variable, with a period of 1 second. </li></ol><br><br>  After parameterizing the block, we connect the sensor and send blocks to each other and set the constant constant to the input En of the send block for the variable. <br><br><img src="https://habrastorage.org/files/d7c/e20/23d/d7ce2023d30940d7bb081a7ab4f9f6d9.PNG"><br><br>  We create a new board and drag the DHT-22 sensor onto it (the library of elements, the ‚ÄúSensors‚Äù folder).  Call the block editor and parameterize the sensor. <br><br><img src="https://habrastorage.org/files/7be/e75/1eb/7bee751eb3ec46d588302ab3cb00afea.PNG"><br><br><ol><li>  Choose a pin to connect the sensor </li><li>  Select the type of sensor </li><li> Set the availability of temperature and humidity outputs </li><li>  Set the periodic method of polling the sensor with a periodicity of 1 second </li></ol><br><br>  Then, drag and drop two blocks of sending a variable to the ring onto the third board, select the existing ring in the block settings, and create each variable in each of them. <br><br><img src="https://habrastorage.org/files/2cf/632/16b/2cf63216bc62405f8528d3e464002a46.PNG"><br><br><img src="https://habrastorage.org/files/b57/638/84c/b5763884c4a8416c946122756b1517ab.PNG"><br><br>  Let us connect the blocks together, and set true constants on the inputs En of the sending variable blocks. <br><br><img src="https://habrastorage.org/files/584/c4e/364/584c4e364da54dc0ba1a0a0f31dd479e.PNG"><br><br>  With the project for Arduino # 1 finished.  You should get this scheme: <br><br><img src="https://habrastorage.org/files/db1/f24/6b3/db1f246b356d419ca3ca27c2906c1ca6.PNG"><br><br>  Now we are creating a new project for Arduino # 2. <br>  Immediately connect the board to the ring.  Here we will use the second method, through the project tree.  We open the tree to the ‚ÄúCommunications‚Äù branch inclusively and right-click on the ‚ÄúRings‚Äù item.  In the context menu that appears, select the item "Add ring". <br><br><img src="https://habrastorage.org/files/67f/ffe/6d4/67fffe6d4afb480b950739d2f3b47cfd.png"><br><br>  The already known window of ring parameters opens.  We again need to enter the device name in the ring and select the port through which the device is connected to the ring.  But now we do not create a variable ring file, but select the previously created one.  This automatically synchronizes variables between projects. <br><br><img src="https://habrastorage.org/files/260/57e/9bf/26057e9bf0294c66aaa8ea5561e0bb60.PNG"><br><br><img src="https://habrastorage.org/files/378/ac7/e1c/378ac7e1c3b14f478b7c63d6dc6b58dd.PNG"><br><br>  All ring parameters can be changed through the project tree by calling the context menu on the corresponding branches. <br>  According to the algorithm, the Arduino # 2 catches a variable about the temperature from the DHT-22 sensor, turns its value into a string and sends it to a ring.  To do this, drag the ‚ÄúGet a variable out of the ring‚Äù block (library of elements, ‚ÄúUART‚Äù folder) onto the schematic and call the editor for it. <br><br><img src="https://habrastorage.org/files/c5c/a14/e46/c5ca14e468694acea500d4ab4959b854.PNG"><br><br>  In the editor, select the ring and the corresponding variable. <br>  Then drag the "String conversion" block (element library, "Type Conversion" folder) to the scheme and connect the input of this block with the output of the "Get variable from ring" block <br><br><img src="https://habrastorage.org/files/51f/831/2cb/51f8312cb5f44b6aaa04249d66057170.PNG"><br><br>  Then we call the editor for the block "String conversion". <br><img src="https://habrastorage.org/files/685/9b1/a79/6859b1a790c6411db7b9d1e9fcac5549.PNG"><br><br>  Since the input of this block is a value of type Float, we have the opportunity to set the number of decimal places when converting to a string.  I think one decimal place is enough for us. <br>  Then we pull out the block ‚ÄúSending a variable to a ring‚Äù (the library of elements, UART folder) on the scheme, and using the editor, select the ring, and create a new variable that will be sent to the ring.  We also set a periodic send mode, with a period of 1 sec. <br><br><img src="https://habrastorage.org/files/acc/f45/0ac/accf450ac582496fa14bcf4ba4afebf3.PNG"><br><br><img src="https://habrastorage.org/files/aae/cd0/720/aaecd072009d4608a2588590e8d862b5.PNG"><br><br>  Then we connect the blocks to each other and set the constant true at the input En of the sending variable block. <br><br><img src="https://habrastorage.org/files/8bd/67c/eec/8bd67ceec79e42048bc3875e324e30fa.PNG"><br><br>  Let's create a new board and drag the ‚ÄúGet a variable out of the ring‚Äù block onto it (library of elements, ‚ÄúUART‚Äù folder) and call the editor for it.  In the editor, select the connected ring.  Since, in accordance with the algorithm, the Arduino # 3 prepares the value for display on the display, we will create a new variable, which this controller will send to us. <br><br><img src="https://habrastorage.org/files/036/dfd/6af/036dfd6af1b54c81a4a5c9dbf92f7103.PNG"><br><br>  Now let's drag the ‚ÄúDisplay on HD44780 chip‚Äù block (elements library, ‚ÄúDisplays‚Äù folder) onto the scheme, and call the editor for it and parameterize it. <br><br><img src="https://habrastorage.org/files/7c5/856/98c/7c585698cf7348768b9eb87f8b5938a9.PNG"><br><br><ol><li>  Create a new display </li><li>  Let's set connection according to the scheme </li><li>  Set the display parameters </li><li>  Configure the display of data from the input block </li><li>  Set the display to the center of the first row. </li></ol><br><br>  After that, we connect the blocks and set the constant true on the input En of the display block. <br><br><img src="https://habrastorage.org/files/b1c/b21/e49/b1cb21e495c241b8ad6142475183670c.PNG"><br><br>  With the project for Arduino number 2 finished.  You should get this scheme: <br><br><img src="https://habrastorage.org/files/27a/3c1/82a/27a3c182a3484ef0b95c067c1e0e115f.PNG"><br><br>  Create a project for Arduino # 3. <br>  Connect the controller to the ring by any of the above methods.  When connecting, select the previously created variable ring file. <br><br><img src="https://habrastorage.org/files/1b1/74c/4b0/1b174c4b026a427087a23450943eb2c1.PNG"><br><br>  According to the algorithm, the Arduino controller number 3 catches the temperature value from the DS18B20 sensor from the Arduino No. 1 and converts it into a string and sends this string to the ring for the Arduino No. 2.  All the necessary variables for this we already exist.  Therefore, similar to Arduino # 2.  Drag and drop blocks ‚ÄúGetting a variable out of a ring‚Äù (element library, ‚ÄúUART‚Äù folder), ‚ÄúString conversion‚Äù blocks (element library, ‚ÄúType Conversion‚Äù folder) and ‚ÄúSending variable to ring‚Äù block (element library, UART folder) onto the schema.  Then we parameterize them. <br>  "Getting a variable from the ring" <br><br><img src="https://habrastorage.org/files/425/ac1/248/425ac124816d4ead9bb5e4ad2438b1cf.PNG"><br><br>  "String Conversion" <br><br><img src="https://habrastorage.org/files/d7f/e22/fd2/d7fe22fd23f34c35ad0b90cc730d3ae3.PNG"><br><br>  "Sending a variable to the ring" <br><br><img src="https://habrastorage.org/files/aa0/8c9/743/aa08c974349541dd84af0570e38aa438.PNG"><br><br>  After that we collect them in the scheme <br><br><img src="https://habrastorage.org/files/f04/f45/18e/f04f4518e22f4f1d908c95842e8a5837.PNG"><br><br>  Create a new board to display the temperature from the DHT-22 sensor.  Similarly, Arduino # 2 is dragged "Getting a variable out of the ring" (library of elements, folder "UART") and "Display on an HD44780 chip" (library of elements, folder "Displays").  We parameterize them. <br>  "Getting a variable from the ring" <br><br><img src="https://habrastorage.org/files/710/f69/4ca/710f694ca74342b5adef06dd2c98e764.PNG"><br><br>  "Display on the HD44780 chip" <br><br><img src="https://habrastorage.org/files/62a/972/528/62a9725286784bcdbff6d1c30ae915d7.PNG"><br><br>  We connect with each other. <br><br><img src="https://habrastorage.org/files/f79/683/bc3/f79683bc39904acbbd0a5860166d8e91.PNG"><br><br>  Create a new board to display humidity. <br>  We also drag and drop the ‚ÄúGetting a variable out of the ring‚Äù block (library of elements, ‚ÄúUART‚Äù folder) onto the board and parameterize it. <br><br><img src="https://habrastorage.org/files/3f3/cf6/4bd/3f3cf64bdc5845138200ccba36ebc039.PNG"><br><br>  Then we drag the "String conversion" block (library of elements, the "Type Conversion" folder), connect it with the "Get the variable from the ring" block and parameterize it. <br><br><img src="https://habrastorage.org/files/bfb/2a0/170/bfb2a017047046deb103392c313896f0.PNG"><br><br><img src="https://habrastorage.org/files/0cd/337/c47/0cd337c474fa413791b94a43647cd206.PNG"><br><br>  Well and in the last turn we drag the block ‚ÄúDisplay on the HD44780 chip‚Äù (library of elements, folder ‚ÄúDisplays‚Äù).  When the unit is parameterized, we select an already existing display and output the moisture value in the center of the second line. <br><br><img src="https://habrastorage.org/files/641/c4f/f6c/641c4ff6ce1d488aa434c0fd7e9b53d2.PNG"><br><br>  We connect the blocks together. <br><br><img src="https://habrastorage.org/files/8e1/909/9f9/8e19099f999847948e7f9021cfd458d3.PNG"><br><br>  Creating a program for Arduino number 3 is completed. <br>  Final result. <br><br><img src="https://habrastorage.org/files/f42/196/a9b/f42196a9bd5e4b9d92fe89af4576f4e4.PNG"><br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/391365/">https://habr.com/ru/post/391365/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../391355/index.html">A long-term study showed that chocolate improves brain function.</a></li>
<li><a href="../391357/index.html">Amazon (and not only) openly sells clocks for students</a></li>
<li><a href="../391359/index.html">Biological supercomputer can eat the same food as a person</a></li>
<li><a href="../391361/index.html">Educational electronic toys for children</a></li>
<li><a href="../391363/index.html">Artificial fingers have been taught to recognize surface irregularities.</a></li>
<li><a href="../391367/index.html">The history of flash memory</a></li>
<li><a href="../391369/index.html">Jacob DeWitte, the Oklo project is about building a nuclear reactor that people need</a></li>
<li><a href="../391371/index.html">Seagate introduced the fastest PCI Express SSD in the world with a capacity of 10 GB / s</a></li>
<li><a href="../391373/index.html">The U8 Nucleus smart watch sends encrypted data to an unknown Chinese IP address</a></li>
<li><a href="../391375/index.html">Personal experience: gaming peripherals</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>