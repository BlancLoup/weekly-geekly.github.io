<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to patch find under FreeBSD?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Teaching FreeBSD to look for files by extended attributes. 
 Annotation: the FreeBSD OS has a file system-level control mechanism for extended file at...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to patch find under FreeBSD?</h1><div class="post__text post__text-html js-mediator-article"><h3>  Teaching FreeBSD to look for files by extended attributes. </h3><br>  <i>Annotation:</i> the FreeBSD OS has a file system-level control mechanism for extended file attributes (extattr).  Using the standard commands setextattr, getextattr and rmextattr you can create, read and delete comments, keywords and other file metadata.  But searching for files by extended attributes is not yet possible.  In addition, extended attributes are lost when copying a file.  In two articles, I will offer my patches for the find and cp commands that eliminate these shortcomings.  However, I am not a professional programmer and did patches for my tasks, so the proposed solution should be considered solely as a proof of concept and modifying with a file. <br><a name="habracut"></a><br>  Inherited from ancient times, we got monstrous and awkward <i>hierarchical</i> file systems.  But along with the rapid increase in the amount of information, their main drawback is manifested more and more clearly - the limited possibilities of classification.  There are actually two such possibilities: to assign meaningful file names and sort these files into directories with meaningful names.  It worked well when the most common photographic film contained only 36 frames.  They were spent slowly, sometimes for several months, carefully choosing the objects to be photographed.  Then 36 photos could be scanned and placed in the folders ‚ÄúDacha‚Äù, ‚ÄúVacation‚Äù and ‚ÄúCats‚Äù.  But now, when hundreds of pictures can be taken on a smartphone‚Äôs camera in a day, and a couple of hundreds of PDF instructions can be downloaded from the Internet in an hour, this approach becomes too time consuming.  The increased volume of information is no longer able to be classified hierarchically - the human brain is simply confused in such a hierarchy.  Therefore, over time, the ‚ÄúNew Folder (2)‚Äù, ‚ÄúAll Pictures‚Äù and ‚ÄúDisassemble‚Äù directories appear on the computer. <br><br>  In response to the limitations that have arisen, the concept of a <i>semantic</i> file system has appeared.  In such a file, some metadata is assigned to the files, which are then used for classification and search.  The directory hierarchy is no longer relevant here, just like the file name.  A striking example is cloud object storage, in which all objects are located in a flat address space and are provided with metadata describing them.  Here they are only intended to work at the API level, and not at the user level.  Object stores have not reached desktop systems yet. <br><br>  And I wanted to assign keywords to all my files and store them on the same level on my local machine right now.  I have many interests, but since I don‚Äôt remember everything, I constantly have to write down notes, recipes, techniques, instructions and photos.  To shove it all into folders - there is no longer any strength or time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Fortunately, desktop FS are catching up with the trend.  In many of them, it has long been possible to set keywords for some file types (in Windows, as far as I know, for Word documents and images).  However, in most cases, this metadata is stored in the file itself, and not at the file system level (hence the limitation on file type - not everyone supports EXIF ‚Äã‚Äãand IPTC).  But my favorite FreeBSD provides a mechanism for managing the extended attributes of a file of any type at the file system level.  As I understand it, somewhere in the depths of the FS, a meta-file is created that is tightly associated with the main file, and all the metadata is written to it.  To work with extended attributes, FreeBSD has a family of commands, setextattr, getextattr, and rmextattr. <br><br>  A simple example: <br><br><pre><code class="hljs pgsql">$ setextattr <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> cats cat.jpg $ getextattr <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> cat.jpg cat.jpg cats</code> </pre> <br>  In principle, this is something you can do.  If it were not for one ‚Äúbut‚Äù: there is no mechanism for searching files by extended attributes in the fryashechka.  What is the use of tagging files if I still can‚Äôt find them by tags? <br><br>  But if the mountain does not go to Mohammed ... In general, I decided to teach the fryashechka himself to look for my documents by keywords.  But I‚Äôm a chemical analyst, not a programmer, and I studied coding myself on Google.  Therefore, first of all, I turned to Google.  Suddenly everything was thought up long before me, and I don‚Äôt have to painfully remember the peculiarities of working with pointers in C?  It turned out - yes, it was invented.  I found <a href="https://bz-attachments.freebsd.org/attachment.cgi%3Fid%3D73772">one patch</a> for the find command.  That's just bad luck - the patch taught the find command to check whether a specific attribute is set on the file.  And that's all.  And look for the contents of this attribute - dismiss. <br><br>  It was necessary, nevertheless, to suffer with pointers and memory in C.  A couple of sleepless nights, three liters of green tea and a black belt for googling - and I got <a href="https://gist.github.com/scifinder/7e3f9c0c42f8e264252b47f2dfdeb3d5">such a patch (for FreeBSD 11.2.0-RELEASE)</a> . <br><br>  You can apply it as follows (the source code must be installed on FreeBSD): <br><br><pre> <code class="hljs dos"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/src/usr.bin/<span class="hljs-built_in"><span class="hljs-built_in">find</span></span> patch &lt; /patch-<span class="hljs-built_in"><span class="hljs-built_in">find</span></span>.diff make make install clean</code> </pre> <br>  And use this: <br><br><pre> <code class="hljs matlab"><span class="hljs-built_in"><span class="hljs-built_in">find</span></span> . -userattr comment=cats ./<span class="hljs-built_in"><span class="hljs-built_in">cat</span></span>.jpg</code> </pre> <br>  This command will find all files whose comment attribute contains the substring cats. <br><br>  Of course, it‚Äôs a bit early to talk about some working solution - in my code there are practically no checks of the input parameter, and the buffer sizes are taken from the bald (I read somewhere that the limit on the size of the extended attribute is 1024 bytes, but then I could not find this information).  I invite everyone to participate in bringing the project to readiness and <a href="https://github.com/scifinder/find">post the complete find utility code</a> , honestly copied from the official FreeBSD repository, with my changes. <br><br>  ... So, now I could somehow search for files by keywords.  But a new attack arose: when copying a file, all associated extended attributes were lost ... The problem was in the cp command, but about that <a href="https://habr.com/post/425795/">next time</a> . </div><p>Source: <a href="https://habr.com/ru/post/425797/">https://habr.com/ru/post/425797/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../425785/index.html">Microsoft began testing Azure-based xCloud cloud gaming service, but not everything is so smooth with it</a></li>
<li><a href="../425787/index.html">Meet people who have legacy computers in working order.</a></li>
<li><a href="../425791/index.html">Conference DEFCON 20. How to fuck the bad guys (and the mafia) using a JavaScript botnet. Part 2</a></li>
<li><a href="../425793/index.html">Alice will pay more than a million rubles by the end of the year. New competition and Yandex recommendations for developers skills</a></li>
<li><a href="../425795/index.html">How to patch cp under FreeBSD?</a></li>
<li><a href="../425799/index.html">How easy it is to take and view .NET assemblies in SQL Server using ICSharpCode.Decompiler</a></li>
<li><a href="../425801/index.html">Space imagery, aviation, coffee delivery - how to combine the love of the sky with IT</a></li>
<li><a href="../425803/index.html">Fight for resources, part 3: Memory is not enough</a></li>
<li><a href="../425805/index.html">DevOops 2018: free live webcast, party and more</a></li>
<li><a href="../425807/index.html">The complexity of the systems and methods of "struggle" with it</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>