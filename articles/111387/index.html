<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GIMP Script-fu: Quickly learning and writing simple scripts on Scheme (+ batch processing for free)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The article will tell you how to quickly get acquainted with the basics of scripting in GIMP in the Scheme language and proceed directl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GIMP Script-fu: Quickly learning and writing simple scripts on Scheme (+ batch processing for free)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/a23916b1/c3925001/45fac6ac/f835bc57.png" align="left"><h4>  <b>Introduction</b> </h4><br>  The article will tell you how to quickly get acquainted with the basics of scripting in GIMP in the <a href="http://ru.wikipedia.org/wiki/Scheme">Scheme language</a> and proceed directly to solving simple practical problems.  This material is intended only for those who are going to automate routine processing here and now, not much going into subtleties and not sacrificing precious time.  Also, the <b>article is not recommended for use as a manual on Scheme</b> separately from Script-fu.  This is due to the simplified programming style in this material and the lack of coverage of other important facts that we are now concerned about much less than the speed of development. <br><br>  <b>Content:</b> <br><ol><li>  What do we need? </li><li>  Syntax briefly </li><li>  Variables </li><li>  Functions </li><li>  Lists </li><li>  Register the script in GIMP </li><li>  Code writing </li><li>  Conclusion </li></ol><a name="habracut"></a><br><h4>  <b>What do we need?</b> </h4><br>  <b>English interface</b> : to do this, it is enough to create the ‚ÄúLANG‚Äù environment variable with the value ‚Äúen‚Äù.  Why do you need it?  First, it will be easier to look for matching procedures to interface objects.  Secondly, I do not have to bring commands in two languages.  Thirdly, in English on the Internet the most information. <br>  <b>Script-fu console</b> : Filters ‚Üí Script-fu ‚Üí Console.  Here we will be able to test small pieces of code, - that is necessary when mastering the language. <br>  Procedure Browser: Help ‚Üí Procedure Browser.  Here you can easily find the function that performs the required action and read its full description (everything is well documented). <br>  <b>Code editor with highlighting and / or paired brace counting</b> .  I will leave for your taste.  Notepad ++ was enough for me.  But remember, there will be a lot of brackets! <br><br>  The next few sections contain excerpts from the first four pages of the <a href="http://docs.gimp.org/en/gimp-using-script-fu-tutorial.html">Script-fu documentation</a> and some ad-lib.  It is strongly recommended to try running the examples below in the console. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>Syntax briefly</b> </h4><ul><li>  All expressions in Scheme must be surrounded by brackets. </li><li>  The name of the function always comes first in brackets, and then its parameters. </li><li>  Mathematical operators are also functions. </li></ul>  It's time to give an example: <br><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">*</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">sqrt</span></span> (<span class="hljs-name"><span class="hljs-name">-</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>)) <span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre> <br>  The last will be calculated multiplication result.  As can be seen, three arguments are passed to the multiplication function: the result of addition, the result of extracting the root from the difference, and the number.  Pay attention to the number of brackets: they are required everywhere.  This may interfere, but it is always clear what is being calculated. <ul><li>  The function and each of the arguments must be separated from each other by spaces. </li></ul>  Example: ‚Äú <code>(+ 1 2)</code> ‚Äù is the correct code, ‚Äú <code>(+1 2)</code> ‚Äù is not one. <ul><li>  Anything that follows the symbol ‚Äú <code>;</code>  , Is a comment and is ignored. </li></ul><br><h4>  <b>Variables</b> </h4><br>  Variables in Scheme are defined using the <code>let*</code> construct.  General form: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( ( ) ... ( ) ) () ... () )</code> </pre> <br>  When compared with imperative languages, it is something like a local variable declaration.  In other words, after the bracket closing the <code>let*</code> construction, variables cease to exist. <br>  Example: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">a</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">b</span></span> (<span class="hljs-name"><span class="hljs-name">+</span></span> a <span class="hljs-number"><span class="hljs-number">2</span></span>)) ) (<span class="hljs-name"><span class="hljs-name">+</span></span> ab) )</code> </pre> <br>  Another example: <pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">x</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>) ) (<span class="hljs-name"><span class="hljs-name">sqrt</span></span> x) )</code> </pre> <br>  Please note that even in the case when we define only one variable, the external brackets for the list of variables are <b>not omitted</b> ! <br><br>  The new value of the variable can be assigned using the <code>set!</code>  : <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">set!</span></span>  )</code> </pre> <br>  Example: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">a</span></span> <span class="hljs-number"><span class="hljs-number">42</span></span>) (<span class="hljs-name"><span class="hljs-name">b</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span>) (<span class="hljs-name"><span class="hljs-name">x</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">set!</span></span> x (<span class="hljs-name"><span class="hljs-name">/</span></span> ab)) )</code> </pre> <br><h4>  <b>Functions</b> </h4><br>  You can define your functions using the <code>define</code> construct: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (_ ) _)</code> </pre> <br>  The value of the function is the result of the last command in the function code. <br>  Implement the function of calculating the difference of the modules ( <img src="https://habrastorage.org/storage/8f84b663/4b0b3353/483423c7/db38fb45.gif">  ).  This can be done with <code>abs</code> , but we will make it a little harder: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">difference</span></span> xy) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> x <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">set!</span></span> x (<span class="hljs-name"><span class="hljs-name">-</span></span> x))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&lt;</span></span> y <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">set!</span></span> y (<span class="hljs-name"><span class="hljs-name">-</span></span> y))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">&gt;</span></span> xy) (<span class="hljs-name"><span class="hljs-name">-</span></span> xy) (<span class="hljs-name"><span class="hljs-name">-</span></span> yx)) )</code> </pre> <br>  Here we used the <code>if</code> construct, which checks the truth of its first argument and, depending on this, it performs either the second or the third argument (and the last one, as you can see, is optional). <br>  Note that a function can treat its arguments as variables, but it only changes copies of them.  This can be seen as follows: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ((<span class="hljs-name"><span class="hljs-name">a</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-name"><span class="hljs-name">b</span></span> <span class="hljs-number"><span class="hljs-number">-4</span></span>)) (<span class="hljs-name"><span class="hljs-name">list</span></span> (<span class="hljs-name"><span class="hljs-name">difference</span></span> ab) ab))</code> </pre> <br>  (The <code>list</code> function is used here to display several results ‚Äî the value of the function, the variable <code>a</code> and the variable <code>b</code> ‚Äî and we‚Äôll discuss more about the lists below).  Run in the console and check that the values ‚Äã‚Äãof the variables have not changed. <br><br><h4>  <b>Lists</b> </h4><br>  To define a list, just write (no commas): <br><pre> <code class="lisp hljs">'(<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">13</span></span>)</code> </pre> <br>  An empty list can be specified either through " <code>'()</code> " or through " <code>()</code> ".  Lists can contain both atomic values ‚Äã‚Äãand other lists: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">x</span></span> '(<span class="hljs-string"><span class="hljs-string">"GIMP"</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) (<span class="hljs-string"><span class="hljs-string">"is"</span></span> (<span class="hljs-string"><span class="hljs-string">"great"</span></span> () ) ) ) ) ) x )</code> </pre> <br>  Since we have already written one apostrophe, it is not necessary to preface them with internal lists. <br>  To add one more element to the top of the list, you need to use the <code>cons</code> function concatenation: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">cons</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> '(<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) )</code> </pre> <br>  It works equally well with empty lists (‚Äú <code>(cons 1 () )</code> ‚Äù gives a list of one element). <br>  To create a list containing the values ‚Äã‚Äãof previously declared variables, you need the <code>list</code> function: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">a</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">b</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>) (<span class="hljs-name"><span class="hljs-name">c</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>) ) (<span class="hljs-name"><span class="hljs-name">list</span></span> abc <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) )</code> </pre> <br>  To understand the difference with the definition of a list through an apostrophe, replace " <code>(list abc 4 5)</code> " with " <code>'(abc 4 5)</code> " and compare the output. <br>  It's all good, but how to get the contents of the list?  There are two functions for this.  The first, <code>car</code> , returns the head of the list, that is, the first item.  The second, <code>cdr</code> , returns the tail of the list, that is, a list containing all elements except the first.  Both functions assume the list is non-empty.  Examples: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">car</span></span> '(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) )</code> </pre> <pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">cdr</span></span> '(<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>) )</code> </pre> <pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">car</span></span> '(<span class="hljs-number"><span class="hljs-number">1</span></span>) )</code> </pre> <pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">cdr</span></span> '(<span class="hljs-number"><span class="hljs-number">1</span></span>) )</code> </pre> <br>  Instead of calling <code>car</code> and <code>cdr</code> succession, it is useful to use functions like <code>caadr</code> , <code>cddr</code> , etc.  For example, to get the second list item, write the following: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">cadr</span></span> '(<span class="hljs-string"><span class="hljs-string">"first"</span></span> <span class="hljs-string"><span class="hljs-string">"second"</span></span>) )</code> </pre>  which is equivalent to <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">cdr</span></span> '(<span class="hljs-string"><span class="hljs-string">"first"</span></span> <span class="hljs-string"><span class="hljs-string">"second"</span></span>) ) )</code> </pre> <br>  In the following example, try to get to element 3 using only two calls of such functions: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">let*</span></span> ( ( <span class="hljs-name"><span class="hljs-name">x</span></span> '( (<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> (<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-number"><span class="hljs-number">6</span></span>) <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> (<span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>) ) ) ) <span class="hljs-comment"><span class="hljs-comment">;    )</span></span></code> </pre> <br>  If you succeed, then you are almost ready to write your first script. <br><br><h4>  <b>Register the script in GIMP</b> </h4><br>  Before we sit down to write code, we will ensure convenient conditions for this. <br><br>  For user scripts, GIMP creates a <code>.gimp-2.6/scripts</code> folder in its home directory.  In order for the script to pick up, it is enough to place an scm file into it and select Filters ‚Üí Script-fu ‚Üí Refresh Scripts in the GIMP menu (this is if GIMP is already running, otherwise it will load everything at startup). <br><br>  In the file, obviously, you need to put the functions we wrote.  It can contain as many functions as you like, but it would be nice to split logically different functions across different files and name the files after the contents.  Another recommendation, even an agreement: the functions we create should be referred to as <code>script-fu-functionname</code> . <br><br>  By and large, this is already enough so that we can call our functions from the console. <br>  But if we want the script to have its own menu, and when it is called, a window with parameter settings opens, then we need to add two functions responsible for registration.  And there is nothing difficult, just look at the example. <br><br>  Suppose we want to write a function that improves the quality of the text in the picture with uneven illumination (in fact, I have already written it, but this does not prevent us from doing it again).  Here is its definition: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">script-fu-readability</span></span> inImage inLayer inRadius inHigh-input))</code> </pre> <br>  I know, I know, here is just a function declaration, and it does nothing.  Useful code will be later.  This is quite enough for us now.  Registration takes place like this: <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">script-fu-register</span></span> <span class="hljs-string"><span class="hljs-string">"script-fu-readability"</span></span> <span class="hljs-string"><span class="hljs-string">"Readability"</span></span> <span class="hljs-string"><span class="hljs-string">"Improves text readability on the photos. It's needed only when there is a non-uniform illumination"</span></span> <span class="hljs-string"><span class="hljs-string">"Dragonizer"</span></span> <span class="hljs-string"><span class="hljs-string">"Copyleft, use it at your own sweet will"</span></span> <span class="hljs-string"><span class="hljs-string">"January 7, 2011"</span></span> <span class="hljs-string"><span class="hljs-string">"RGB* GRAY* INDEXED*"</span></span> SF-IMAGE <span class="hljs-string"><span class="hljs-string">"The image"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> SF-DRAWABLE <span class="hljs-string"><span class="hljs-string">"The layer"</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> SF-ADJUSTMENT <span class="hljs-string"><span class="hljs-string">"Median blur: radius"</span></span> '(<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> SF-SLIDER) SF-ADJUSTMENT <span class="hljs-string"><span class="hljs-string">"Levels: intensity of highest input"</span></span> '(<span class="hljs-number"><span class="hljs-number">235</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> SF-SPINNER) ) (<span class="hljs-name"><span class="hljs-name">script-fu-menu-register</span></span> <span class="hljs-string"><span class="hljs-string">"script-fu-readability"</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;Image&gt;/Filters/User's scripts"</span></span>)</code> </pre> <br>  The following function is passed to the first function.  The first argument is the name of our function, the second is the display name, the third is the description, the fourth is the author, the fifth is copyright information, the sixth is the date of creation.  Seventh - types of supported images (RGB, RGBA, GRAY, GRAYA, INDEXED, INDEXEDA). <br><br>  Subsequent arguments are optional.  They (except for <code>SF-IMAGE</code> and <code>SF-DRAWABLE</code> ) allow you to create widgets in the script window, such as stitches, daws, sliders, spinners, color choices, fonts, and more, to convey the user's choice to a function.  The mentioned <code>SF-IMAGE</code> will give us a link to the current open image, and the <code>SF-DRAWABLE</code> to the selected layer.  I will not describe all these <code>SF-*</code> , their parameters you can see in the tables <a href="http://docs.gimp.org/en/gimp-using-script-fu-tutorial-first-script.html">here</a> (the rest is not necessary to read, for it is summarized in this article).  And I also advise you to have a look at <a href="">this picture</a> in order to understand what you need from this (taken <a href="http://pingus.seul.org/~grumbel/gimp/script-fu/script-fu-tut.html">from here</a> ). <br><br>  The window is ready, it remains to add its call to the GIMP menu, which is what the second function of the code above does.  Two arguments: again, the function name and the menu path.  The path starts with <code>&lt;Image&gt;</code> , if some branches did not exist before, GIMP will add them. <br><img src="https://habrastorage.org/storage/2ef5c783/b8d9f829/8dfdb64c/af8c771b.png" align="right"><br>  Another example: if we wanted to write a script that <u>creates an</u> image with the specified properties, we would remove the <code>SF-IMAGE</code> and <code>SF-DRAWABLE</code> from the first function, instead of <code>"RGB* GRAY* INDEXED*"</code> use the empty string <code>""</code> (we don‚Äôt you need an open image, we will create it), and in the second function would change the path to something like <code>"&lt;Image&gt;/File/Create/Something"</code> . <br><br>  To admire the result, let's save our creativity in ‚Äú <code>script-fu-readability.scm</code> ‚Äù and update the scripts.  Now open / create some image and select our script from the menu. <br><br><h4>  <b>Code writing</b> </h4><br>  Here it is, the desired moment!  But I hasten to upset: there is nothing complicated here.  Totally.  Functions you already know how to write.  And everything that you may need from the editor is easy to find in the procedure browser.  Need some kind of operation with layers?  Search for ‚Äú <code>layer</code> ‚Äù.  Invert image?  You need something that contains " <code>invert</code> ".  And so on. <br><br>  I will only make two comments: <ul><li>  It would be nice to conclude all actions performed by the script between the functions <code>gimp-image-undo-group-start</code> and <code>gimp-image-undo-group-end</code> , as is done below, so that the user does not have to cancel each action separately. </li><li>  All GIMP functions return lists, regardless of the amount of data in the result.  It is easy to pierce, waiting, for example, <code>layer</code> , and receiving <code>(layer)</code> .  So do not forget to do <code>car</code> in such cases. </li></ul>  And now an example of a working code.  I borrowed the algorithm from <a href="http://habrahabr.ru/blogs/algorithm/96432/">here</a> (thanks to <a href="https://habrahabr.ru/users/killy/" class="user_link">Killy</a> ). <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">script-fu-readability</span></span> inImage inLayer inRadius inHigh-input) (<span class="hljs-name"><span class="hljs-name">let*</span></span> ( (<span class="hljs-name"><span class="hljs-name">layer2</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) ) (<span class="hljs-name"><span class="hljs-name">gimp-image-undo-group-start</span></span> inImage) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">not</span></span> (<span class="hljs-name"><span class="hljs-name">=</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-image-base-type</span></span> inImage)) GRAY)) (<span class="hljs-name"><span class="hljs-name">gimp-image-convert-grayscale</span></span> inImage)) (<span class="hljs-name"><span class="hljs-name">set!</span></span> layer2 (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-layer-copy</span></span> inLayer FALSE))) (<span class="hljs-name"><span class="hljs-name">gimp-image-add-layer</span></span> inImage layer2 <span class="hljs-number"><span class="hljs-number">-1</span></span>) (<span class="hljs-name"><span class="hljs-name">plug-in-despeckle</span></span> RUN-NONINTERACTIVE inImage layer2 inRadius <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-number"><span class="hljs-number">256</span></span>) (<span class="hljs-name"><span class="hljs-name">gimp-layer-set-mode</span></span> layer2 DIFFERENCE-MODE) (<span class="hljs-name"><span class="hljs-name">set!</span></span> inLayer (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-image-flatten</span></span> inImage))) (<span class="hljs-name"><span class="hljs-name">gimp-invert</span></span> inLayer) (<span class="hljs-name"><span class="hljs-name">gimp-levels</span></span> inLayer HISTOGRAM-VALUE <span class="hljs-number"><span class="hljs-number">0</span></span> inHigh-input <span class="hljs-number"><span class="hljs-number">0.1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">255</span></span>) (<span class="hljs-name"><span class="hljs-name">gimp-image-undo-group-end</span></span> inImage) ) )</code> </pre> <br>  Having a browser of procedures at hand, it's easy to find out if it's interesting. <br><br><img src="https://habrastorage.org/storage/d00343f5/676417a9/760b0e00/8e0ad3fa.png" align="left"><h4>  <b>Batch processing</b> </h4><br>  Where where?  That's not all.  Do you think we have done so much to write some unfortunate scriptwriter processing one picture?  Yes, it would be faster hands!  So let's make GIMP open all files from a given folder, process it, and save it to another folder. <br><br>  The most pleasant thing is to adapt the code below to do something else, it is enough to replace the function it calls with the necessary one, everything else will not change (well, unless you want to save the file to another extension). <br><br>  The code is partially borrowed from <a href="http://habrahabr.ru/blogs/programming/25911/">this topic</a> (thanks to <a href="https://habrahabr.ru/users/apostol/" class="user_link">Apostol</a> ), but there it saves files, overwriting the original ones.  The <code>morph-filename</code> function is taken <a href="http://stackoverflow.com/questions/1386293/how-to-parse-out-base-file-name-using-script-fu">from here</a> . <br><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">morph-filename</span></span> orig-name new-extension) (<span class="hljs-name"><span class="hljs-name">let*</span></span> ((<span class="hljs-name"><span class="hljs-name">buffer</span></span> (<span class="hljs-name"><span class="hljs-name">vector</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>))) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">re-match</span></span> <span class="hljs-string"><span class="hljs-string">"^(.*)[.]([^.]+)$"</span></span> orig-name buffer) (<span class="hljs-name"><span class="hljs-name">string-append</span></span> (<span class="hljs-name"><span class="hljs-name">substring</span></span> orig-name <span class="hljs-number"><span class="hljs-number">0</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">vector-ref</span></span> buffer <span class="hljs-number"><span class="hljs-number">2</span></span>))) new-extension) ) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> (<span class="hljs-name"><span class="hljs-name">script-fu-batch-readability</span></span> inInFolder inOutFolder inRadius inHigh-input) (<span class="hljs-name"><span class="hljs-name">let*</span></span> ((<span class="hljs-name"><span class="hljs-name">filelist</span></span> (<span class="hljs-name"><span class="hljs-name">cadr</span></span> (<span class="hljs-name"><span class="hljs-name">file-glob</span></span> (<span class="hljs-name"><span class="hljs-name">string-append</span></span> inInFolder DIR-SEPARATOR <span class="hljs-string"><span class="hljs-string">"*"</span></span>) <span class="hljs-number"><span class="hljs-number">1</span></span>)))) (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">not</span></span> (<span class="hljs-name"><span class="hljs-name">null</span></span>? filelist)) (<span class="hljs-name"><span class="hljs-name">let*</span></span> ((<span class="hljs-name"><span class="hljs-name">filename</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> filelist)) (<span class="hljs-name"><span class="hljs-name">image</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-file-load</span></span> RUN-NONINTERACTIVE filename filename))) (<span class="hljs-name"><span class="hljs-name">layer</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-image-get-active-layer</span></span> image))) ) (<span class="hljs-name"><span class="hljs-name">script-fu-readability</span></span> image layer inRadius inHigh-input) (<span class="hljs-name"><span class="hljs-name">set!</span></span> layer (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-image-get-active-layer</span></span> image))) (<span class="hljs-name"><span class="hljs-name">set!</span></span> filename (<span class="hljs-name"><span class="hljs-name">string-append</span></span> inOutFolder DIR-SEPARATOR (<span class="hljs-name"><span class="hljs-name">morph-filename</span></span> (<span class="hljs-name"><span class="hljs-name">car</span></span> (<span class="hljs-name"><span class="hljs-name">gimp-image-get-name</span></span> image)) <span class="hljs-string"><span class="hljs-string">"png"</span></span>))) (<span class="hljs-name"><span class="hljs-name">file-png-save2</span></span> RUN-NONINTERACTIVE image layer filename filename <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>) (<span class="hljs-name"><span class="hljs-name">gimp-image-delete</span></span> image) ) (<span class="hljs-name"><span class="hljs-name">set!</span></span> filelist (<span class="hljs-name"><span class="hljs-name">cdr</span></span> filelist)) ) ) )</code> </pre> <br><br><h4>  <b>Conclusion</b> </h4><br>  <i>Readability script with the batch version can be downloaded <a href="">here</a> ( <a href="http://pastebin.com/keEjM2xv">mirror</a> ).</i>  <i>The code is commented, even somewhat unnecessarily.</i> <br><br>  Let me remind you once again that the article does not pretend to be complete in a broad sense and is intended only so that the reader can sit down, read thoughtfully, practice at the same time, and start creating scripts that solve his tasks.  So that it does not take as much time as is required for more or less high-quality language learning. <br><br>  If you read the article to the end, now you can Script-fu as good as me. </div><p>Source: <a href="https://habr.com/ru/post/111387/">https://habr.com/ru/post/111387/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111380/index.html">Ideal company?</a></li>
<li><a href="../111382/index.html">Introducing Kohana 3.0 - Part 2</a></li>
<li><a href="../111384/index.html">This insane, insane, insane appStore</a></li>
<li><a href="../111385/index.html">HTML5 CANVAS step by step: Images</a></li>
<li><a href="../111386/index.html">What is the situation with the overtime of IT employees in your company?</a></li>
<li><a href="../111388/index.html">Evernote is now available in the Mac App Store</a></li>
<li><a href="../111389/index.html">PlayStation Phone fell into the hands of Chinese bloggers</a></li>
<li><a href="../111390/index.html">EDM 2010.2 One KDE4 DVD Released - Alternate Build by Edumandriva Team</a></li>
<li><a href="../111391/index.html">ECoupled company offers chargers for mobile devices and electric vehicles.</a></li>
<li><a href="../111392/index.html">Canobuvosti. The most anticipated games of 2011</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>