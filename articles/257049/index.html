<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extend Selenium WebDriver. Writing a robot for the RSDN, not thinking about the context</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I would like to tell you how you can make your PageObject pattern based on Selenium. Yes, I know that they have their own PageObject, but what k...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extend Selenium WebDriver. Writing a robot for the RSDN, not thinking about the context</h1><div class="post__text post__text-html js-mediator-article">  Today I would like to tell you how you can make your PageObject pattern based on Selenium.  Yes, I know that they have their own PageObject, but what kind of programmer does not want to write his bike with blackjack and women of easy virtue. <br><br>  In general, it is very difficult to write automatic tests for the UI - constant problems, something was not loaded there, then the request did not reach and fell on timeout.  Who wrote at least a hundred tests - he will understand me.  Now imagine that your pages are not just simple HTML, but also contain many different frames and pop-up windows.  If you know Selenium well, then you know what that means.  Selenium can work simultaneously in the context of a single document, be it a frame, iframe, or a separate modal window. <br><a name="habracut"></a><br>  Once I got the task to write automated tests for a similar project, in which there are a lot of javascript, everything is generated dynamically, a lot of iframes and ajax requests.  Having studied Selenium, I began to write tests.  After the third dozen tests, I realized that it was not at all easy, as I thought at first.  To sculpt the constant SwitchTo () in the test code was simply impossible and the code turned into solid pasta.  The logic of the test was completely lost in constant changes of context.  In general, I decided to write a small framework for automatic context switching when working with different frames. <br><br>  All code is written in C #, using NUnit, Autofac, and of course Selenium. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Suppose we need to test some actions of an authorized user on the site, and the login form is in the iframe.  How this test will look like: <br><br><pre><code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SimpleTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> driver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FirefoxDriver(); <span class="hljs-comment"><span class="hljs-comment">//     driver.SwitchTo().Frame("frmName"); driver.FindElement(By.CssSelector("input.login")).SendKeys("my_login"); driver.FindElement(By.CssSelector("input.pass")).SendKeys("my_pass"); driver.SwitchTo().DefaultContent(); //     // ............. //    driver.SwitchTo().Frame("frmName"); driver.FindElement(By.CssSelector("a.logout")).Click(); driver.SwitchTo().DefaultContent(); //  . // ............. driver.Close(); }</span></span></code> </pre> <br>  The constant SwitchTo () in each test is lazy, so I, like a true lazy programmer, made sure that our tests looked like this: <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">//    var page = _factory.CreatePage&lt;IVacuumPage&gt;(_driver); //    page.Header.Login("my_login", "my_pass"); //  </span></span></code> </pre><br><br>  In my opinion, the benefit is obvious, we separate the grain from the chaff and get clean and most importantly readable tests that the average programmer will understand. <br><br>  Let's see what is behind this simplicity. <br><br><div class="spoiler">  <b class="spoiler_title">Project structure</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/761/775/29f/76177529ff004456bd50886753a66d94.png"><br></div></div><br>  Yes, the code in the end turned out not so much.  The main thing here is the DomContainer class - this will be the base class for the elements on the logically merged page.  In my opinion, <a href="http://rsdn.ru/">rsdn.ru</a> is a very good example where you can easily demonstrate all the advantages of our framework.  How PageObject for the site will look like RSDN: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRsdnPage</span></span> : <span class="hljs-title"><span class="hljs-title">IDomContainer</span></span> { IRsdnMenuFrame Menu { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IRsdnHeaderFrame Header { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IRsdnContentFrame Content { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">RsdnPage</span></span> : <span class="hljs-title"><span class="hljs-title">DomContainer</span></span>, <span class="hljs-title"><span class="hljs-title">IRsdnPage</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IRsdnMenuFrame Menu { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IRsdnHeaderFrame Header { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> IRsdnContentFrame Content { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RsdnPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IComponentContext context</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">context</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-comment"><span class="hljs-comment">//     protected override void Init() { base.Init(); Header = _factory.CreateIframeItem&lt;IRsdnHeaderFrame&gt;(this, Driver.FindElement(By.CssSelector("frame[name='frmTop']"))); Menu = _factory.CreateIframeItem&lt;IRsdnMenuFrame&gt;(this, Driver.FindElement(By.CssSelector("frame[name='frmTree']"))); Content = _factory.CreateIframeItem&lt;IRsdnContentFrame&gt;(this, Driver.FindElement(By.CssSelector("frame[name='frmMain']"))); } }</span></span></code> </pre><br>  We create the structure of the page so that later we don‚Äôt think about which element in which frame is located.  Once you specify _factory.CreateIframeItem (), then, referring to any element of this object, the framework will automatically switch the context of the driver to the desired frame. <br><br>  Now let's look at how the login form interface for the RSDN site will look like: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRsdnHeaderFrameLoggedOutState</span></span> : <span class="hljs-title"><span class="hljs-title">IDomContainer</span></span> { IWebElementWrapper UserName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IWebElementWrapper Password { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } IWebElementWrapper LoginButton { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Login</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> login, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> password</span></span></span><span class="hljs-function">)</span></span>; }</code> </pre><br>  Here, the key is the IWebElementWrapper interface, which repeats the IWebElement interface and adds a bit of the very magic that replaces the context automatically.  The prerequisite is that only IWebElementWrapper, and not IWebElement, must be exposed to the outside in order for the whole mechanism to work correctly. <br><br>  The mechanism itself works very simply and is based on the IInterceptor interface included in the Castle.DynamicProxy assembly.  With Autofac, we register the type as follows: <br><br><pre> <code class="cs hljs">builder.RegisterType&lt;WebElementWrapper&gt;().As&lt;IWebElementWrapper&gt;() .EnableInterfaceInterceptors().InterceptedBy(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(ContextInterceptor));</code> </pre><br>  Thus, with such a call pattern: <br>  page.Header.LoggedOutState.LoginButton.Click (); <br>  Our interceptor intercepts the Click () call, goes up the object tree to Header, replaces the context with the required frame, clicks the element in the context of this frame-a, and returns the context back.  But in the test code, we will not see this, as it happens automatically.  Our goal has been achieved and now all we need to do is to write wrappers for all the necessary elements of the page and use them in our tests, without thinking about the context in which we are located. <br><br><div class="spoiler">  <b class="spoiler_title">Wrappers for a site RSDN</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ee0/81d/63a/ee081d63a3e04de3a82a7ac1477f6adb.png"><br></div></div><br>  Now I will give an example of a test for the RSDN site, which the following actions do: <br><ol><li>  Opens the main page </li><li>  Log in to your account </li><li>  Go to the search page </li><li>  We perform a search on the site </li><li>  Go to the forums page </li></ol><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FirstTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//    var page = _factory.CreatePage&lt;IRsdnPage&gt;(_driver); //    page.Header.Login("***", "***"); //     page.Header.GoToSearch(); page.Content.Reload(); //       Selenium page.Content.Search("Selenium"); //     page.Menu.GoToForums(); }</span></span></code> </pre><br>  In my opinion, simply and concisely.  You can create a kind of DSL using Fluent interface for flexibility, and then use the existing pieces in other tests. <br><br>  To prove that the framework works on large projects, I show a screenshot of our Continuous build: <br><br><img src="https://habrastorage.org/files/69c/b72/ee6/69cb72ee65724321a65094e40a05c90c.png"><br>  Here are 310 tests. <br><br>  For those who are interested to see how it works inside, I laid out the project on the <a href="https://github.com/slsniffer/selenium.incontextable">githaba</a> . <br><br>  If you have any questions, ask them in the comments, I will try to answer. </div><p>Source: <a href="https://habr.com/ru/post/257049/">https://habr.com/ru/post/257049/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257037/index.html">The Assistant Robot Ashmanov on the Russian-language Turing test. Technology Infa</a></li>
<li><a href="../257039/index.html">What the designer needs to know about SVG: Pros and Cons</a></li>
<li><a href="../257041/index.html">Implementation of the NEC IR protocol on ATmega</a></li>
<li><a href="../257043/index.html">Yandex vs fraudulent mobile redirects and subscriptions</a></li>
<li><a href="../257047/index.html">How we participated in the opening of the world's largest store of children's toys</a></li>
<li><a href="../257051/index.html">Html-maker - convenient and easy generation of html using coffeescript</a></li>
<li><a href="../257053/index.html">The progress of the heavy task in PHP</a></li>
<li><a href="../257055/index.html">SMART Life (cont.)</a></li>
<li><a href="../257057/index.html">Implementing the ws2812b protocol on ATmega</a></li>
<li><a href="../257063/index.html">How Aviasales Material Design Switched</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>