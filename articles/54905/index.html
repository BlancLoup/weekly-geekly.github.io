<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL injection panacea - queries with parameters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 This topic is the beginning of a small cycle about panaceas for various web application vulnerabilities. 

 As it happens, a large numb...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL injection panacea - queries with parameters</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  This topic is the beginning of a small cycle about panaceas for various web application vulnerabilities. <br><br>  As it happens, a large number of Web applications suffer from SQL injections.  And how many articles are not written, how many bug reports are not published - it‚Äôs all the same, programmers forget that the user can substitute whatever they want with the application parameters. <br><br><a name="habracut"></a>  I suggest them, and indeed all use the so-called <i>prepared-statements</i> .  They are also called <i>parameterized queries</i> . <br>  The idea is simple as all ingenious - to separate the request from the user data. <br>  You probably ask: what does it mean to <i>"separate"</i> ?  It means: to separate them from making a request. <br>  After all, your website should process user data, and not create SQL queries based on them (although who knows?).  The latter even sounds silly, but precisely because of this we have a similar situation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation </h4><br>  Implementation is not more difficult than the idea.  For example, let's take a request to get a blog post: <br> <code><font color="#0000ff">SELECT</font> ` <font color="#0000ff">date</font> `,`title`,`text`,`tags` <font color="#0000ff">FROM</font> `posts` <font color="#0000ff">WHERE</font> `url_title`= <font color="#A31515">'bla-bla-bla'</font> &lt;br/&gt;</code> <br> <br>  In PHP code, it will look something like this: <br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <font color="#cc6633">&lt;?php</font> &lt;br/&gt; <font color="#696969">//...</font> &lt;br/&gt; <font color="#cc6633">$sql</font> = <font color="#008000">'SELECT `date`,`title`,`text`,`tags` FROM `posts` WHERE `url_title`=\''</font> . <font color="#cc6633">$_GET</font> [ <font color="#008000">'url_title'</font> ]. <font color="#008000">'\''</font> ;&lt;br/&gt;    DB::exec( <font color="#cc6633">$sql</font> );&lt;br/&gt;    //... &lt;br/&gt;</code> <br> <br>  The security problem is visible to the naked eye - the url_title parameter of the address bar is not filtered. <br>  This fact is usually found when one of the visitors has already found it.  B then the code is transformed into a more horrible look: <br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <font color="#cc6633">&lt;?php</font> &lt;br/&gt; <font color="#696969">//...</font> &lt;br/&gt; <font color="#cc6633">$sql</font> = <font color="#008000">'SELECT `date`,`title`,`text`,`tags` FROM `posts` WHERE `url_title`=\''</font> .mysql_real_escape_string( <font color="#cc6633">$_GET</font> [ <font color="#008000">'url_title'</font> ]). <font color="#008000">'\''</font> ;&lt;br/&gt;    DB::exec( <font color="#cc6633">$sql</font> );&lt;br/&gt;    //... &lt;br/&gt;</code> <br> <br>  Some queries look especially awful: <br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <font color="#cc6633">&lt;?php</font> &lt;br/&gt; <font color="#696969">//...</font> &lt;br/&gt; <font color="#cc6633">$sql</font> = <font color="#008000">'SELECT `firstname`,`lastname`,`nickname`,`avatar` FROM `users` WHERE `login`=\''</font> .mysql_real_escape_string( <font color="#cc6633">$_GET</font> [ <font color="#008000">'username'</font> ]). <font color="#008000">'\' AND `password`=\''</font> .mysql_real_escape_string( <font color="#cc6633">$_GET</font> [ <font color="#008000">'password'</font> ]). <font color="#008000">'\''</font> ;&lt;br/&gt;    DB::exec( <font color="#cc6633">$sql</font> );&lt;br/&gt;    //... &lt;br/&gt;</code> <br> <br>  Even when I printed this safe example, I made a mistake and made a syntax error somewhere in the area of ‚Äã‚Äãquotes and escape slashes. <br>  The larger the request, the more confusion.  In the eyes dazzled and completely unreadable. <br><br>  We now turn both queries into parameterized ones. <br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <font color="#cc6633">&lt;?php</font> &lt;br/&gt; <font color="#696969">//...</font> &lt;br/&gt; <font color="#cc6633">$sql</font> = <font color="#008000">'SELECT `date`,`title`,`text`,`tags` FROM `posts` WHERE `url_title`=:1'</font> ;&lt;br/&gt;    DB::exec( <font color="#cc6633">$sql</font> , <font color="#cc6633">$_GET</font> [ <font color="#008000">'url_title'</font> ]);&lt;br/&gt;    //... &lt;br/&gt;</code> <br> <br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <font color="#cc6633">&lt;?php</font> &lt;br/&gt; <font color="#696969">//...</font> &lt;br/&gt; <font color="#cc6633">$sql</font> = <font color="#008000">'SELECT `firstname`,`lastname`,`nickname`,`avatar` FROM `users` WHERE `login`=:1 AND `password`=:2'</font> ;&lt;br/&gt;    DB::exec( <font color="#cc6633">$sql</font> , <font color="#cc6633">$_GET</font> [ <font color="#008000">'username'</font> ], <font color="#cc6633">$_GET</font> [ <font color="#008000">'password'</font> ]);&lt;br/&gt;    //... &lt;br/&gt;</code> <br> <br>  In my opinion, very convenient.  Instead of constructions <b>: N is</b> substituted for the corresponding argument.  They, of course, can be duplicated and all that. <br>  And what happens behind the scenes (the code is taken from one project <s>, where I came up with [although the idea is not mine, but I didn‚Äôt know about it] that</s> )? <br><br> <code><a href="http://www.php.net/manual/en/function.exec.php"></a> <a href="http://www.php.net/manual/en/function.func-num-args.php"></a> <a href="http://www.php.net/manual/en/function.func-get-args.php"></a> <a href="http://www.php.net/manual/en/function.create-function.php"></a> <font color="#0000ff">public static function</font> exec( <font color="#cc6633">$query</font> ) {&lt;br/&gt; <font color="#0000ff">global</font> <font color="#cc6633">$args</font> ;&lt;br/&gt; <font color="#0000ff">if</font> (func_num_args() &gt; <font color="#008000">1</font> ) {&lt;br/&gt; <font color="#cc6633">$args</font> = func_get_args();&lt;br/&gt; <font color="#cc6633">$query</font> = preg_replace_callback(&lt;br/&gt; <font color="#008000">'/:([0-9]+)/'</font> ,&lt;br/&gt;            create_function(&lt;br/&gt; <font color="#008000">'$matches'</font> ,&lt;br/&gt; <font color="#008000">'global $args; return "\'".str_replace("\'", "\\\\\'", @$args[$matches[1]])."\'";'</font> &lt;br/&gt;            ),&lt;br/&gt; <font color="#cc6633">$query</font> &lt;br/&gt;        );&lt;br/&gt;    }&lt;br/&gt;    self:: <font color="#cc6633">$result</font> = sqlite_query( <font color="#cc6633">$query</font> , self:: <font color="#cc6633">$handle</font> );&lt;br/&gt; <font color="#0000ff">return</font> self:: <font color="#cc6633">$result</font> ;&lt;br/&gt;} &lt;br/&gt;</code> <br> <br>  Of course, regular expressions are not the best choice in terms of performance, but it suits me.  You can attach a sample from a global context of the type <b>: glob: varname</b> (for example <b>,: glob: _GET [id]</b> ), but for this you need a parser more intelligently - for my purposes, creating one is not listed.  Or a separate assignment of parameters as in <a href="">Yii</a> .  However, this is a matter of taste.  In my opinion, what is done Yii does not solve the issue of readability, on the contrary: <br> <code><font color="#cc6633">$username</font> = mysql_real_escape_string( <font color="#cc6633">$username</font> ); &lt;br/&gt;</code> <br>  more convenient than <br> <code>$command-&gt;bindParam( <font color="#008000">":username"</font> , <font color="#cc6633">$username</font> , <font color="#cc6633">PDO</font> ::PARAM_STR); &lt;br/&gt;</code> <br> <br><h4>  Virtues </h4><ul><li>  Readability increases </li><li>  No separate filtering function required. </li><li>  If you accept such an appeal to the database for style, then you can forget about the SQL injection. </li></ul><br><h4>  disadvantages </h4><ul><li>  In the beginning you will have to suffer in order to switch to the use of such requests. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/54905/">https://habr.com/ru/post/54905/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../54894/index.html">Have you ever paid for web services?</a></li>
<li><a href="../54897/index.html">Sensors in the automotive industry, year 1982</a></li>
<li><a href="../54899/index.html">Habraotchet # 2 with MIX 09 from Las Vegas about what is happening in the corridors of the conference</a></li>
<li><a href="../54901/index.html">Stunning photographs of Earth and space with a camera for ¬£ 56</a></li>
<li><a href="../54902/index.html">Pencil case in a laptop (small improvement)</a></li>
<li><a href="../54907/index.html">Professional e-mail</a></li>
<li><a href="../54908/index.html">Transition Terrafugia is sent, please fasten your seat belts.</a></li>
<li><a href="../54911/index.html">Where are we going?</a></li>
<li><a href="../54912/index.html">Google to picasa started translating comments</a></li>
<li><a href="../54913/index.html">Bubuki.ru: How much is your laptop worth?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>