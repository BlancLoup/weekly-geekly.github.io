<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DD-WRT and SSL certificates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 In this publication I will talk about some unobvious points when using DD-WRT on your router. Probably the DD-WRT regulars here will be all ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DD-WRT and SSL certificates</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  In this publication I will talk about some unobvious points when using DD-WRT on your router.  Probably the DD-WRT regulars here will be all obvious, but for those who put for the first time there will be many useful things. <br><br>  In order to implement all of the above, we need a router that is supported by DD-WRT, a Linux computer with any more or less modern distribution (I have Debian Wheezy) and a thirst for new knowledge. <br><a name="habracut"></a><br>  So, finally I got my hands to hoist my rather old LinkSys E4200 firmware from DD-WRT.  The old original firmware from LinkSys had a lot of complaints.  In particular: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) Worked not with all USB Mass Storage; <br>  2) The terrible, wild brakes WebUI when entering through HTTPS; <br>  3) Constant abuse of browsers for the SSL certificate, which seems to be generated every new session.  Therefore, adding exceptions did not work; <br>  4) Otstutstvie local DNS; <br>  5) Well, many other glitches. <br><br>  In general, one Sunday evening, I decided to fill in DD-WRT.  I did everything as described in the Wiki on my router, that is, I first uploaded the mini version, then upgraded it to mega.  The builds themselves were taken from the Router Database page, that is, build 21061. <br><br>  Found the following jambs: <br><br>  1) Chrome 39 refused to visit the router via HTTPS; <br>  2) Firefox 33 also had some strange problems with HTTPS; <br>  3) New IE refused to make an exception for the self-signed certificate; <br>  4) Chromium 38 also refused to visit the router via HTTPS; <br>  5) SSH did not work.  When I tried to log in I received the response ‚ÄúConnection was closed by 192.168.1.1‚Äù <br><br>  In general, a successful visit to the router using HTTPS was only possible with the help of Konqueror. <br><br>  Further tinkering revealed the following problem: the web server of the router was unable to TLS1.  And in new versions of browsers, due to the SSL3 POODLE vulnerability discovered some time ago, SSL3 seems to be completely disabled.  On Linux Chromium, I banned it myself. <br><br>  In addition, the use of HTTPS out of the box DD-WRT is very strange, since <b>the key itself is stored in the firmware in the clear</b> (later we will see it with our own eyes), which, in general, negates the whole need of HTTPS. <br><br>  So, the first thing you need to know when using DD-WRT: <b>spit on the version of the firmware that the Router Database offers you</b> .  Instead, find a more recent build for your router <a href="http://dd-wrt.com/site/support/other-downloads%3Fpath%3Dothers%252Feko%252FBrainSlayer-V24-preSP2%252F">here</a> . <br><br>  Updating the version to the latest, I solved two problems at once: <br><br>  1) SSH earned.  It turns out he was broken in the original build; <br>  2) The web server of the router began to support TLS 1.2, which allowed it to be accessed by all browsers except Firefox 33 (although it was cured in 34) and IE and Chrome under Windows, although this is treated by configuring the Windows policies, namely disabling the ban to ignore the problems of certificate sites. <br><br>  There is only one problem unsafe certificate in the firmware.  To cure it, we will have to disassemble the firmware by file, replace the certificate and key in it, and assemble the firmware back into one file.  <b>We will not compile the firmware from source.</b> <br><br>  For our purposes there is an excellent utility called the Firmware Modification Kit, you can download its source <a href="https://code.google.com/p/firmware-mod-kit/">here</a> .  The utility needs to be assembled with a standard sequence of commands: <br><blockquote>  $ ./configure <br>  $ make <br></blockquote><br><br>  Further in the directory with the firmware-mod-kit there are two scripts: extract-firmware.sh and build-firmware.sh.  Run: <br>  $ ./extract-firmware.sh ~ / Downloads / dd-wrt.v24-25408_NEWD-2_K2.6_mega-nv60k.bin <br>  It is clear that your firmware file is indicated here.  It unpacks the firmware in the fmk directory. <br><br>  Next, go to the fmk / rootfs / etc directory and see the cert.pem certificate, which presents the router when accessing via HTTPS and the key from it, key.pem, which is stored in clear form.  There is a privkey.pem file - this is the same key.pem encrypted with the password ‚Äúpass: password‚Äù.  And it is available to anyone who downloads this firmware. <br><br>  So, our task is to generate our own key and certificate.  I did this: I generated my own Certificate Authority (CA) - I still need it when setting up OpenVPN on the same router.  Next, I generated a key / certificate request pair for the router's Web server and signed it with my CA, I received the certificate and key in the specified firmware location.  And I added my Certificate Authority as trusted on all my computers. <br><br>  In order not to write twice how to do this, I refer to a wonderful <a href="http://habrahabr.ru/post/192446/">article</a> on Habr√© regarding activities with CA and certificates.  I will note only two important points: <br>  1) in the comments to this article there is a description of how to generate a certificate for several domains or IP addresses.  I generated a certificate for the address 192.168.1.1, for the amber.loc domain (this is the name of the router inside the LAN), to the external IP address (if you have one), and to the external DNS name (you can take a dynamic DNS name) . <br>  2) the generated key must be done without a password.  <b>* Paranoid mode ON *</b> After creating and uploading the firmware, destroy both the key and the firmware file itself.  <b>* Paranoid mode OFF *</b> .  The password-protected privkey.pem key lying in the firmware is not used at all. <br><br>  After you replace the specified files in the firmware, run the script: <br>  $ ./build-firmware.sh fmk / <br>  and we get in the fmk directory a new firmware new-firmware.bin, which we upload to the router. <br><br>  That's all. </div><p>Source: <a href="https://habr.com/ru/post/244105/">https://habr.com/ru/post/244105/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244095/index.html">How does decompilation in .Net or Java using the example .Net</a></li>
<li><a href="../244097/index.html">Miranda NG Project Receives Wild Signs Award (Part One)</a></li>
<li><a href="../244099/index.html">Byrobot: quadrocopter for Chuck Norris and 6d thinking</a></li>
<li><a href="../244101/index.html">WUD 2014 - World Usability Day</a></li>
<li><a href="../244103/index.html">A revolution in computer simulation of the human body in motion</a></li>
<li><a href="../244107/index.html">PIN code when paying by card - dots above i</a></li>
<li><a href="../244109/index.html">A few thoughts about analyzing other people's opinions</a></li>
<li><a href="../244111/index.html">Setting up a server with Chef (Quick and easy)</a></li>
<li><a href="../244113/index.html">PHPixie Amalgama - Internationalization in PHPixie</a></li>
<li><a href="../244115/index.html">Attackers use CVE-2014-6332</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>