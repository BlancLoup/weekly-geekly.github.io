<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Yii: Dynamic change of validation rules (scripts)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this little topic, I would like to tell you about one very simple recipe (which is probably familiar to many of you) in the context of the Yii fram...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Yii: Dynamic change of validation rules (scripts)</h1><div class="post__text post__text-html js-mediator-article">  In this little topic, I would like to tell you about one very simple recipe (which is probably familiar to many of you) in the context of the Yii framework.  This is a dynamic change to the form validation rules ‚Äî when the validation rules change depending on the user‚Äôs choice of your application, for example, by choosing a value from a list or a check box. <br><a name="habracut"></a><br>  I was prompted to use this solution by a practical need when writing one simple Contact Center with a web interface.  So as not to invent examples, I will briefly explain the use of this recipe on the example of the same KC.  As is known, the main activity of CC operators is in receiving calls from customers and outgoing calls to customers.  According to the results of the call, the operator must enter certain data into the system - the result of the conversation with the client, on the basis of which the status of the ticket and the subsequent logic of working with it (assigning a repeated call, any other procedure, closing the ticket, etc.) are determined.  The problem is that some form fields (read, model attributes) must be filled in or unfilled depending on the ‚Äúparent‚Äù status.  For example, it is obvious that the ‚ÄúResult of the conversation with the customer‚Äù field does not make sense to fill in if the technical status of the call is ‚ÄúUnder Call / Wrong Number‚Äù (the operator must give the technical status, not the system, since the call may occur, but not a client - an error in the room, etc.).  At the same time, if the technical status ‚ÄúSuccessful dialing‚Äù is set, the field ‚ÄúThe result of the conversation with the customer‚Äù must be filled.  Again: depending on the outcome of the conversation, it may be necessary to fill in additional fields - for example, the fields ‚ÄúDate of repeated call‚Äù with the status of ‚ÄúRetry Call‚Äù. <br><br>  Naturally, I would like the rules of validation for the entire form to change depending on the value of a specific form field.  In practice, this task is very easy to use, but very useful in cases like mine. <br><br>  So: <br>  1. Create several scenarios for vadidatsii call form. <br>  First, create rules for those fields that are required in all scenarios: <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rules</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-comment"><span class="hljs-comment">//... array('call_status', 'required', 'on'=&gt;'callSubmit, invalidNumberSubmit, validCallSubmit, successCallSubmit...' //... 'message'=&gt;' "{attribute}"    .'), }</span></span></code> </pre> <br>  I think the first rule does not cause questions - the technical status of the call is the value of the top level in the form - it is necessary in any scenario. <br>  Continue to go from the general to the particular: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//.. Inside rules() method array('talk_status', 'required', 'on'=&gt;'successCallSubmit, secondCall,...') /*   ,        */</span></span></code> </pre><br>  Next, we define the rules for more specific cases: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//.. Inside rules() method array('new_call_date', 'required', 'on'=&gt;'secondCall') /*     " "*/</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thus, we can go through all the necessary validation rules - both in general cases and in each particular case.  The matter remains for small: to make the validation rules vary depending on the selected values ‚Äã‚Äãin the form.  As you have probably guessed, for this we will use CActiveForm, since this widget out of the box allows you to simply and clearly perform ajax-validation. <br>  For example, let's create a simple form: <br><br><pre> <code class="php hljs"> <span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $form=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;beginWidget(<span class="hljs-string"><span class="hljs-string">'CActiveForm'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'call-submit-form'</span></span>, <span class="hljs-string"><span class="hljs-string">'enableAjaxValidation'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'clientOptions'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'validateOnChange'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'validateOnSubmit'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">true</span></span> ), <span class="hljs-comment"><span class="hljs-comment">//   )); </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre><br><br>  Of the interesting options we need to note these: 'enableAjaxValidation', 'validateOnChange', 'validateOnSubmit'.  I think the purpose of these options does not cause questions and is clear from their names.  We continue: <br><br><pre> <code class="php hljs">&lt;div <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">='</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class">'&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">labelEx</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call_status</span></span></span><span class="hljs-class">'); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dropDownList</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call_status</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CHtml</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">listData</span></span></span><span class="hljs-class">( </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CallStatuses</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">()-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findAll</span></span></span><span class="hljs-class">(),'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">','</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">' ) ); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">labelEx</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">talk_status</span></span></span><span class="hljs-class">'); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">dropDownList</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">talk_status</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CHtml</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">listData</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TalkStatuses</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">()-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">findAll</span></span></span><span class="hljs-class">(),'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">','</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">title</span></span></span><span class="hljs-class">' ), )); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">call_status</span></span></span><span class="hljs-class">'); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">talk_status</span></span></span><span class="hljs-class">'); ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">='</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">control</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">group</span></span></span><span class="hljs-class">'&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">echo</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">form</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">label</span></span></span><span class="hljs-class">($</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">,'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new_call_date</span></span></span><span class="hljs-class">'); ?&gt; &lt;?</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">php</span></span></span><span class="hljs-class"> //     $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">-&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">widget</span></span></span><span class="hljs-class">('</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">zii</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">widgets</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">jui</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CJuiDatePicker</span></span></span><span class="hljs-class">', </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">array</span></span></span><span class="hljs-class">( '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">attribute</span></span></span><span class="hljs-class">'=&gt;'</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">new_call_date</span></span></span><span class="hljs-class">', '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">'=&gt;$</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">, //... ), )); ?&gt; &lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">div</span></span></span><span class="hljs-class">&gt;</span></span></code> </pre><br><br>  I will not bore you with a large number of fields, I think three is enough for an example.  All that is left for us to do is actually implement the functionality for dynamically changing the validation rules (read the script). <br><br>  In fact, this functionality is based on the simplest logic: you need to compare each field value with a script that the form will validate upon selecting this value (in this case, when choosing a value from the list created by the CActiveForm :: dropDownList () method).  This is a very simple solution, and I will not dwell on the details and create implementation in the OOP-style, because the main thing is to convey the idea. <br><br>  Instead, for simplicity, I will put the appropriate code directly into the controller's class performAjaxValidation () method.  Below is a slightly modified code for the standard performAjaxValidation () method and a method that takes the form: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//Inside controller public function actionSaveCall(){ /*     'callSubmit',       - 'call_status' -   . */ $model=new Calls('callSubmit'); $this-&gt;performCallAjaxValidation($model); if( isset($_POST['Calls']) ) { $model-&gt;attributes = $_POST['Calls']; if( $model-&gt;save() ) $this-&gt;redirect( Yii::app()-&gt;user-&gt;returnUrl ); } } protected function performAjaxValidation($model) { if(isset($_POST['ajax']) &amp;&amp; $_POST['ajax']==='calls-form') { $callStatusesScenarios = array( Calls::CALL_FAIL=&gt;'validCallSubmit', Calls::SUCCESS_CALL=&gt;'successCallSubmit', Calls::WRONG_NUMBER=&gt;'invalidNumberSubmit'); if( !empty($_POST['Calls']['call_status']) &amp;&amp; !empty( $callStatusesScenarios[ $_POST['Calls']['call_status'] ] ) ){ $model-&gt;setScenario ( $callStatusesScenarios[ $_POST['Calls']['call_status'] ] ); } echo CActiveForm::validate($model); Yii::app()-&gt;end(); } }</span></span></code> </pre><br><br>  As you can see from the code, all I do is simply change the script depending on the incoming value of the 'call_status' field.  Now, if the operator chooses the ‚ÄúSuccessful dialing‚Äù status on the form, the model script will change to 'successCallSubmit', which now expects the form to have a call status, and as a result, by selecting ‚ÄúSuccessful dialing‚Äù, the operator will not be able to send the form, until the "Result of the conversation" field is filled.  At the same time, if the status of the dialer is ‚ÄúWrong number‚Äù, the form will be added without any additional fields.  By the same principle, it is possible to act further - with the status of conversations and their additional fields, etc. <br><br>  The application of this approach will be useful in such situations, when the number and types of fields required for filling will vary depending on the user's choice.  I apologize for a little puns, and success to you in developing on the wonderful framework Yii. </div><p>Source: <a href="https://habr.com/ru/post/146589/">https://habr.com/ru/post/146589/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146581/index.html">Access to images in isolated storage</a></li>
<li><a href="../146582/index.html">Habravstrecha in St. Petersburg!</a></li>
<li><a href="../146583/index.html">Thoughts before bed: fractal mixing algorithm</a></li>
<li><a href="../146587/index.html">Scripts on the knee - tame klipper Part 1</a></li>
<li><a href="../146588/index.html">One Time Secret - burn after reading</a></li>
<li><a href="../146590/index.html">Overview of Android applications for creating panoramic images</a></li>
<li><a href="../146591/index.html">Storing passwords in Ozon.ru</a></li>
<li><a href="../146592/index.html">MySQL is a million times faster than MemSQL</a></li>
<li><a href="../146593/index.html">Atlassian Office in San Francisco</a></li>
<li><a href="../146594/index.html">Indicators of key information on sites for Firefox in a hurry</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>