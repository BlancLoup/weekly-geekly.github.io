<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>graphql - pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably there is no perfect technology. Not an exception and graphql. If you have not yet had experience with this technology, then you need to be we...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>graphql - pitfalls</h1><div class="post__text post__text-html js-mediator-article">  Probably there is no perfect technology.  Not an exception and graphql.  If you have not yet had experience with this technology, then you need to be well aware of what problems you may have and prepare in advance for them. <br><a name="habracut"></a><br>  To begin with, I‚Äôll say that I‚Äôm rather a supporter than an adversary, using graphql terms and conditions whenever possible.  And I am absolutely not going to dissuade anyone from the expediency of using this technology.  And that is why I raise questions that relate to outstanding issues within the graphql technology. <br><br>  For example, it may be unexpected for someone that each object in graphql will have to be described at least twice: once as the return type of the object, and once more as the input type of the object (see <a href="https://graphql.org/graphql-js/mutations-and-input-types/">graphql.org/graphql-js/mutations- and-input-types</a> ).  However, I told this to begin with and do not even consider it a significant drawback.  Today we will discuss such issues, which, as a rule, have to be solved when developing an application using graphql technology: <br><br><ol><li>  Separate access for users and user groups. </li><li>  Error processing. </li><li>  SELECT N + 1 Problem </li></ol><br><h3>  Separate access for users and user groups </h3><br>  graphql knows nothing about sharing access for users and groups.  Thus, all work on sharing access to the responsibility of the application developer.  In the resolver function, the third parameter is the application context object.  Therefore, if you, for example, work with the graphql JavaScript + express implementation, then in the context parameter you will be able to get the current user from the request express.js object.  But further work on access control should be carried out directly in each resolver: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">root, {id}, ctx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> DB.Lists.get(id) .then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">list</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(list.owner_id &amp;&amp; list.owner_id != ctx.userId){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">"Not authorized to see this list"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } }); }</code> </pre> <br>  Naturally, this approach complicates the control of access rights, since  there is no possibility to set access rights in a declarative manner and control of rights is dispersed among dozens (for some large systems by thousands) of resolver functions.  Therefore, there are a number of libraries that solve this problem.  Some of them are quite popular (judging by the number of stars on github.com), for example <a href="https://github.com/maticzav/graphql-shield">github.com/maticzav/graphql-shield</a> . <br><br><h3>  Error processing </h3><br>  If your frontend requires input validation and the formation of detailed messages for each field that has not passed validation, then error handling in graphql will most likely seem to you not flexible enough.  For example, if the input parameter was described as a string, and a numeric value arrived, then an error message would not be suitable for this: <br><br><pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"errors"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"message"</span></span>: <span class="hljs-string"><span class="hljs-string">"Expected type String, found 1."</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locations"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"line"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">"column"</span></span>: <span class="hljs-number"><span class="hljs-number">15</span></span> } ] } ] }</code> </pre><br>  If there is a gross error in the type of the input parameter, then an error message will be generated automatically and there is no possibility to control this process.  If validation on the input parameter type is successful, then there is an opportunity to send a custom error message to the client, throwing out the <code>new Error ('custom message ...')</code> object.  Add custom fields to the error object will not work (error customization is implemented in the apollo-server-express and apollo-errors libraries when used together).  Of course, there is always the possibility of serializing an object into the <code>message</code> string on the server and deserializing on the client.  But is it necessary to do so? <br><br><h3>  SELECT N + 1 Problem </h3><br>  <a href="https://habr.com/ru/post/412847/">This problem was discussed in detail in the message</a> . <br><br>  graphql is built on resolver functions.  This means that fetching data from a database can cause a problem called SELECT N + 1.  Suppose that in the resolver function a list of objects was obtained, in which the data associated with this object is represented by identifiers (foreign keys).  For each such identifier, its own resolver function will be called, in which (in each) a database query will be additionally made.  Thus, instead of a single database query (with SQL JOIN), many queries will be executed, which overloads the database with queries. <br><br>  To solve this problem, facebook has developed the <a href="https://github.com/graphql/dataloader">github.com/graphql/dataloader</a> library, which uses a pending query strategy.  Instead of executing the query directly in the resolver function, it is proposed to accumulate identifiers (secondary keys) in the array, and then receive them immediately in one query. <br><br>  apapacy@gmail.com <br>  May 13, 2019 </div><p>Source: <a href="https://habr.com/ru/post/451466/">https://habr.com/ru/post/451466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../451442/index.html">Terraform it: a review of terragenesis</a></li>
<li><a href="../451448/index.html">Why Do-Not-Track Can Be Mandatory</a></li>
<li><a href="../451454/index.html">Change the contents of the iOS app notification</a></li>
<li><a href="../451456/index.html">Russian storage AERODISK: load testing. Squeeze the IOPS</a></li>
<li><a href="../451462/index.html">We write less duplicate code using Binding in Laravel</a></li>
<li><a href="../451468/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ 364 (May 6 - 12, 2019)</a></li>
<li><a href="../45147/index.html">Down with the language barrier!</a></li>
<li><a href="../451480/index.html">Why does the Ministry of Industry and Trade prohibit the storage of data on foreign equipment?</a></li>
<li><a href="../451488/index.html">Calculation of cannibalization based on the classic A / B test and the bootstrap method</a></li>
<li><a href="../45149/index.html">666</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>