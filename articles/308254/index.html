<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Choosing an html-parser for Apache.JMeter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The average quality of the work of parsers (for seven sites) 

 I suggest: 



- calculate the average quality of completeness of extracting links to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Choosing an html-parser for Apache.JMeter</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/4d7/459/697/4d7459697efd415ba19296fa678c331f.PNG" alt="The average quality of completeness of extracting links to embedded resources of Apache.JMeter html parsers"><br>  <font color="#999999"><i>The average quality of the work of parsers (for seven sites)</i></font> <br><br>  I suggest: <br><br><ul><li>  calculate the average quality of completeness of extracting links to embedded resources by <b>Apache.JMeter</b> html parsers; </li><li>  check if links extraction in <b>Apache.JMeter</b> 3.0 is <b>true</b> has become more complete; </li><li>  try out the <a href="https://habrahabr.ru/post/308098/">CsvLogWriter</a> plugin. </li></ul><br>  As popular wisdom says: Believe believe, but ... <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  Project Description </h1><br>  When <b>Apache.JMeter</b> 3.0 came out, I was still in development, my colleagues and I tested it and started using it in my work.  The first in combat testing was a new version of Artem <a href="https://habrahabr.ru/users/zetsigemon/" class="user_link">Zetsigemon</a> for one of the new services, <a href="https://pgu.mos.ru/">pgu.mos.ru</a> , where using <b>Apache.JMeter</b> 3.0, the quality of parsing of embedded resources was significantly improved compared to the previous version. <br>  And then the question arose, what is the quality, how to measure it for different sites, what it was and how it became? <br><br>  Materials and research results are reflected in the current article. <br><br><h2>  Test object </h2><br>  HtmlParser-s for <strong>Apache.JMeter 2.13</strong> and <strong>Apache.JMeter 3.0 are tested</strong> . <br><br>  <strong>Apache.JMeter 2.13</strong> parsers: <br><br><ul><li>  LagartoBasedHtmlParser; </li><li>  HtmlParserHTMLParser; </li><li>  JTidyHTMLParser; </li><li>  RegexpHTMLParser; </li><li>  JsoupBasedHtmlParser. </li></ul><br>  Parses <strong>Apache.JMeter 3.0</strong> : <br><br><ul><li>  LagartoBasedHtmlParser; </li><li>  JTidyHTMLParser; </li><li>  RegexpHTMLParser; </li><li>  JsoupBasedHtmlParser. </li></ul><br>  Parsers parse the start pages of various websites: <br><br><ul><li>  stackoverflow.com; </li><li>  habrahabr.ru; </li><li>  yandex.ru; </li><li>  mos.ru; </li><li>  jmeter.apache.org; </li><li>  google.ru; </li><li>  linkedin.com; </li><li>  github.com. </li></ul><br><h2>  The basis of testing </h2><br>  The basis was the changes in <strong>Apache.JMeter 3.0</strong> , see <a href="http://jmeter.apache.org/changes.html">http://jmeter.apache.org/changes.html</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Excerpts from the list of changes:</b> <div class="spoiler_text"><blockquote><h4>  Core improvements </h4><br><h5>  Dependencies refresh </h5><br>  Deprecated Libraries dropped to date: <br><ul><li>  htmllexer, htmlparser removed </li><li>  jdom removed </li></ul><br><blockquote>  <i>Removed parser <strong>htmlparser</strong> and more unused library <strong>jdom</strong> .</i> </blockquote><br><h4>  Protocols and Load Testing improvements </h4><br><h5>  Parallel downloads are much better: </h5><br><ul><li>  Parsing of CSS imported files (through <a href="https://habrahabr.ru/users/import/" class="user_link">import</a> ) or embedded resources (background, images, ...) </li></ul><br><blockquote>  <i>A new parser for CSS files has been added, links to other CSS files (via <a href="https://habrahabr.ru/users/import/" class="user_link">import</a> ) and links to resources specified in CSS files will be extracted: background images, images, ...</i> </blockquote><br><h4>  Incompatible changes </h4><br><ul><li>  Since it was a version of the parser for the embedded resources (replaced since 2.10 by the Lagarto based implementation), it has been updated with the htmlparser library (HtmlParserHTMLParser). </li><li>  The following jars have been removed: <ul><li>  htmllexer-2.1.jar (see <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59037">Bug 59037</a> ) </li><li>  htmlparser-2.1.jar (see <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59037">Bug 59037</a> ) </li><li>  jdom-1.1.3.jar (see <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59156">Bug 59156</a> ) </li></ul></li></ul><br><blockquote>  <i>Removed parser <strong>htmlparser</strong> and more unused libraries <strong>htmllexer</strong> and <strong>jdom</strong> .</i> </blockquote><br><h4>  Improvements </h4><br><h5>  HTTP Samplers and Test Script Recorder </h5><br><ul><li>  <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59036">Bug 59036</a> - FormCharSetFinder: Use JSoup instead of deprecated HTMLParser </li><li>  <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59033">Bug 59033</a> - Parallel Download plug-in parser for each mime types </li><li>  <a href="http://bz.apache.org/bugzilla/show_bug.cgi%3Fid%3D59140">Bug 59140</a> - Parallel Download: Add CSS Parsing to extract links from CSS files </li></ul><br><blockquote> <i>To search for the <code>accept-charset</code> attribute in <code>form</code> tags, <strong>JSoup</strong> is now used instead of remote <strong>HTMLParser</strong> [Bug 59036].</i>  <i>Implemented CSS parser [Bug 59140] and this parser is used by default [Bug 59033].</i> <br></blockquote></blockquote></div></div><br><h2>  Test objectives </h2><br>  Compare the work of all available parsers.  In particular, compare parsers versions 2.13 and 3.0 to each other, make sure that the load of embedded resources has become more realistic and better. <br><br><h2>  Strategy </h2><br>  Stage 1: <br><br><ol><li>  <strong>Download the</strong> starting pages of the list of sites using all 5 <strong>Apache.JMeter</strong> 2.13 parsers and write logs. </li><li>  <strong>Download the</strong> starting pages of the list of sites using all 4 <strong>Apache.JMeter</strong> 3.0 parsers and write logs. </li><li>  Analyze the <strong>Apache.JMeter</strong> logs and compare them with each other.  Evaluate whether the load on embedded resources has become better, whether the list of downloaded embedded resources has expanded. </li></ol><br>  Stage 2: <br><br><ol><li>  Download the starting pages of the list of popular sites using <strong>Google Chrome</strong> and <strong>webpagetest.org</strong> service. </li><li>  Analyze the reports from <strong>webpagetest.org</strong> and compare them with the results of the analysis of <strong>Apache.JMeter</strong> logs.  Rate, realistic loading of embedded resources. </li></ol><br><h2>  Testing approach </h2><br>  To accurately determine how many requests are sent during the opening of a page from <strong>Apache.JMeter,</strong> all requests are logged: <br><br><ul><li>  <strong>View Results Tree</strong> - standard logger, logging to XML format with subquery logging, XML log will be used to find out the details of queries / answers / errors; </li><li>  <strong>CsvLogWriter</strong> - custom logger <a href="https://github.com/pflb/Jmeter.Plugin.CsvLogWriter">https://github.com/pflb/Jmeter.Plugin.CsvLogWriter</a> , logging in CSV format with logging subqueries, CSV log will be used for software calculation of statistics on the work of different parsers; </li><li>  only quantitative evaluation is performed, the addresses of subqueries are not compared by list. </li></ul><br>  In order to be able to group requests by <strong>Apache.JMeter</strong> versions, parsers and sites, additional variables for each request will be logged: <br><br><ul><li>  <strong>siteKey</strong> - the tested site; </li><li>  <strong>jmeterVersion</strong> - <strong>Apache.JMeter</strong> version; </li><li>  <strong>htmlParser</strong> is the name of the currently used html parser. </li></ul><br><h1>  results </h1><br><h2>  Evaluation of the improvement of parsers for version 3.0 compared to version 2.13 </h2><br>  There are no dramatic improvements in the completeness of parsing html-pages, there are worsening. <br><br>  The essential difference is that in the Apache.JMeter 3.0 parsers there is a recursive loading of the Yandex Browser browser promotional materials page.  This is manifested when downloading <a href="https://yandex.ru/">https://yandex.ru/</a> . <br><br><h3>  Sites with a small amount of content - a good result </h3><br>  On simple sites such as jmeter.apache.org, all parsers work the same way.  By creating the same number of subqueries that the browser creates.  The quality of the parsers for <em>jmeter.apache.org</em> is perfect, 100%. <br><br><h3>  Sites with a lot of content - bad result </h3><br>  But on a site like mos.ru, the parsers will find an average of 22 links to embedded resources, while a full page load with the browser loading all embedded resources - 144 requests.  The quality is low. <br><br>  Similarly, on the site <em>habrahabr.ru</em> , the <strong>Lagardo</strong> parser from <strong>Apache.JMeter</strong> 3.0 will find 55 links, while the browser will make 117 subqueries.  The quality is 47.01%.  Satisfactory quality of completeness of extracting links to embedded resources. <br><br><h2>  Number of subqueries using different parsers </h2><br>  Table on Google Docs: <a href="https://docs.google.com/spreadsheets/d/16l32BFuUdrJmexTgF155HMAGW7EBaBT-rRjuuLc524c/edit%3Fusp%3Dsharing">JMeter.HtmlParser.Compare (top table)</a> . <br><br> <a href=""><img src="https://habrastorage.org/files/e83/ca3/df8/e83ca3df89d44bbaa3b47f7e87a77938.PNG" alt="Summary table comparing the work of various Apache.JMeter html parsers with the results of Google Chrome"></a> <br>  <font color="#999999"><i>Apache.JMeter statistics on versions and html parsers and its comparison with Google Chrome</i></font> <br><br>  Column description: <br><br><ul><li>  <strong>Before Start Render</strong> - the number of subqueries made by the browser, before the start of displaying the contents of the page.  These are html markup, main js and css-files, main images. <br><br></li><li>  <strong>Document Complete</strong> - the number of subqueries made by the browser at the time of the complete loading of the document.  All page resources have already been loaded here. <br><br></li><li>  <strong>Fully Loaded</strong> - the number of subqueries made by the browser at the time when the javascript worked, when everything was loaded. </li></ul><br>  The good result of the parsers will be if the subqueries are as many as the <strong>Google Chrome browser</strong> does at the time of <strong>Document Complete</strong> , and excellent at the time of <strong>Fully Loaded</strong> .  The measure of the realism of <strong>Apache.JMeter</strong> when using a particular parser is the proximity of the number of subqueries to the number of subqueries executed by the browser at the time of <strong>Fully Loaded</strong> . <br><br>  If we exclude the results of testing site yandex.ru, where: <br><br><ul><li>  The parsing goes into recursion by doing requests again and again to yandex.ru until the depth of the recursion reaches the maximum level and ends with an error: <br><br>  &gt; <code>java.lang.Exception: Maximum frame/iframe nesting depth exceeded</code> . </li></ul><br>  And as a measure of the quality of the work of parsers to accept the number of subqueries at the time of <strong>Fully Loaded</strong> , we get such a table of the average quality of work of the parsers. <br><br><h2>  The average quality of the parsers </h2><br>  Table on Google Docs: <a href="https://docs.google.com/spreadsheets/d/16l32BFuUdrJmexTgF155HMAGW7EBaBT-rRjuuLc524c/edit%3Fusp%3Dsharing">JMeter.HtmlParser.Compare (lower table)</a> . <br><br> <a href=""><img src="https://habrastorage.org/files/475/1fb/276/4751fb2762834a49a6cbbdba0917f74f.PNG" alt="The average quality of the parsers"></a> <br>  <font color="#999999"><i>The average quality of the work of parsers (for seven sites, without yandex.ru)</i></font> <br><br>  The most accurate <strong>HTML Parser</strong> parser in <strong>Apache.JMeter</strong> 2.13.  In <strong>Apache.JMeter</strong> 3.0, the <strong>Jsoup</strong> and <strong>JTidy parsers</strong> showed the same quality.  Parser <strong>Lagarto</strong> behind the leaders.  The parsing completeness for the <strong>Lagarto</strong> parser in <strong>Apache.JMeter</strong> 3.0 has decreased in comparison with <strong>Apache.JMeter</strong> 2.13. <br><br>  The quality of the <strong>Lagarto</strong> parser on the current version of <strong>Apache.JMeter</strong> 3.0 was 32.73%, only a third of all the subqueries were sent, two thirds of the load on the static was not submitted. <br><br><h3>  Detailed analysis of missing links when working Apache.JMeter 3.0 site habrahabr.ru </h3><br>  <a href="https://docs.google.com/spreadsheets/d/1FqgnkRm4gYrWUN9bBCEPvVo0mdi5lQl_a3mv1wY7tko/edit%3Fusp%3Dsharing">Spreadsheet</a> on Google Docs: <a href="https://docs.google.com/spreadsheets/d/1FqgnkRm4gYrWUN9bBCEPvVo0mdi5lQl_a3mv1wY7tko/edit%3Fusp%3Dsharing">Missed default Apache.JMeter 3.0 parser links to habrahabr.ru</a> <br><img src="https://habrastorage.org/files/9ce/b00/9a8/9ceb009a84d144f880b62cd5317c6d29.PNG" alt="Missing Link Summary"><br>  <font color="#999999"><i>Missed <b>Apache.JMeter</b> 3.0 links when parsing <b>habrahabr.ru</b></i></font> <br><br>  Missing a lot of promotional materials and statistics.  And this is good. <br>  Above I have already made a reservation that I will evaluate only quantitative characteristics.  By numbers, it turns out that the quality of extracting links to embedded resources is low.  Detailed analysis can show exactly what was missing.  It may turn out that this is advertising and content from third-party resources, which need not be loaded as part of the load testing of a specific site. <br><br><h1>  Logs and their processing </h1><br><h2>  Initial data </h2><br>  All logs are available at the link: <a href="https://drive.google.com/drive/folders/0B5nKzHDZ1RIiVkN4dDlFWDR1ZGM" title="jmeter.htmlParser.compare.logs">https://drive.google.com/drive/folders/0B5nKzHDZ1RIiVkN4dDlFWDR1ZGM</a> . <br><br><h2>  WebPageTest.org reports </h2><br><table><tbody><tr><th>  sytekey </th><th>  webpagetest.org </th><th>  Raw page data (.csv) </th><th>  Raw object data (.csv) </th><th>  HTTP Archive (.har) </th></tr><tr><td>  github.com </td><td>  <a href="https://www.webpagetest.org/result/160819_VF_FM8/">160819_VF_FM8</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiblRnUzNUVFM3SUk">github.com.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIieGFaaWFXTU9MWlE">github.com.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIidGNQRzJYUXprVzQ">github.com.har</a> </td></tr><tr><td>  google.ru </td><td>  <a href="https://www.webpagetest.org/result/160819_C9_FQD/">160819_C9_FQD</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiczE1OVdCaUs5Mkk">google.com.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiTUNjRk1mOHJIMEk">google.com.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiYm9EejNNdHBUWnM">google.ru.har</a> </td></tr><tr><td>  habrahabr.ru </td><td>  <a href="https://www.webpagetest.org/result/160819_8N_FRB/">160819_8N_FRB</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiM2FsMnVLLTMwb2M">habrahabr.ru.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiaFZjZ2paTlUzaUE">habrahabr.ru.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiMG1wZkVub0NRUlU">habrahabr.ru.har</a> </td></tr><tr><td>  jmeter.apache.org </td><td>  <a href="https://www.webpagetest.org/result/160819_CG_FSM/">160819_CG_FSM</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiVzlua0tlTnNXd28">jmeter.apache.org.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIieGk0TjVvZlJVd1U">jmeter.apache.org.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIieWdLSGFOeEdZMEE">jmeter.apache.org.har</a> </td></tr><tr><td>  linkedin.com </td><td>  <a href="https://www.webpagetest.org/result/160819_K2_FY1/">160819_K2_FY1</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiV19IMjhCUThhTVE">linkedin.com.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiUmdHcWxTc1hGcVk">linkedin.com.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiWHVfRU1zNE84ODg">linkedin.com.har</a> </td></tr><tr><td>  mos.ru </td><td>  <a href="https://www.webpagetest.org/result/160819_91_G0F/">160819_91_G0F</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIibFJqU0hzX1IxbmM">mos.ru.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIibzRGNWVXNVRoQW8">mos.ru.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiSUczcXFSXzMzb0E">mos.ru.har</a> </td></tr><tr><td>  stackoverflow.com </td><td>  <a href="https://www.webpagetest.org/result/160819_S0_G18/">160819_S0_G18</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIidlFMbXRObkFyVzA">stackoverflow.com.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiYm0wSUV4YWZzWEk">stackoverflow.com.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiWW1nck4tU0tvb2c">stackoverflow.com.har</a> </td></tr><tr><td>  yandex.ru </td><td>  <a href="https://www.webpagetest.org/result/160819_MR_G1R/">160819_MR_G1R</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiUW5PSXBWMlU4Skk">yandex.ru.summary.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiWml6R3NNQ0J4bk0">yandex.ru.details.csv</a> </td><td>  <a href="https://drive.google.com/open%3Fid%3D0B5nKzHDZ1RIiQTNkaWFFN0NhOFU">yandex.ru.har</a> </td></tr></tbody></table><br><div class="spoiler">  <b class="spoiler_title">Report Images</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/758/1f5/01b/7581f501bf614a5c9b69aba154b4e4d7.PNG"><br><img src="https://habrastorage.org/files/cf6/9c9/ec1/cf69c9ec116c426ebf4e9b5d981d57ce.PNG"><br><img src="https://habrastorage.org/files/d9b/99b/ccb/d9b99bccb2354f5ebf44c91acd5543d7.PNG"><br><img src="https://habrastorage.org/files/9d5/28f/063/9d528f0637934a7998b716a8b87084d7.PNG"><br><img src="https://habrastorage.org/files/113/79b/9d6/11379b9d6d7e427fbe287d6ce430ace9.PNG"><br><img src="https://habrastorage.org/files/6f5/1c2/895/6f51c28958d7498db2ecf28d10dfcf44.PNG"><br><img src="https://habrastorage.org/files/fdb/732/ce1/fdb732ce19ed4763a6b01de8f713743c.PNG"><br><img src="https://habrastorage.org/files/bec/410/658/bec4106587dd4e84b14a28a2a46184fc.PNG"><br>  <font color="#999999"><i>The caps of the webpagetest.org reports from which <b>Document Complete</b> and <b>Fully Loaded</b> data were extracted</i></font> <br></div></div><br>  From the values ‚Äã‚Äãof the columns <b>Document Complete</b> and <b>Fully Loaded,</b> you need to exclude one query (root) to get the number of subqueries. <br><br><h2>  Logs Apache.JMeter </h2><br>  For processing, csv-logs are used, formed by the <strong>CsvLogWriter</strong> plugin: <br><br><ul><li>  project: <a href="https://github.com/pflb/Jmeter.Plugin.CsvLogWriter" title="Jmeter.Plugin.CsvLogWriter">https://github.com/pflb/Jmeter.Plugin.CsvLogWriter</a> ; </li><li>  description on habrahabr.ru: <a href="https://habrahabr.ru/post/308098/">CsvLogWriter plugin for JMeter</a> . </li></ul><br>  The third-party plugin is used to request requests for embedded resources in the csv-log. <br><br>  As a result of CsvLogWriter operation, a log is generated, the list of columns of which includes: <br><br><ul><li>  <strong><em>timeStamp</em></strong> - time; </li><li>  <strong><em>URL</em></strong> - address of the request; </li><li>  <strong><em>elapsed</em></strong> - the duration of the response to the request; </li><li>  <strong><em>bytes</em></strong> - the size of the response; </li><li>  <strong><em>siteKey</em></strong> - used site; </li><li>  <strong><em>htmlParser</em></strong> - the name used; </li><li>  <strong><em>jmeterVersion</em></strong> - used version of Apache.JMeter; </li><li>  <strong><em>i</em></strong> is the iteration number of testing. </li></ul><br><br><h2>  Log Processing Automation </h2><br>  Aggregation of Aps.JMeter csv logs <strong>is</strong> done using <strong>pandas</strong> with this <strong>python</strong> code: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> codecs <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> listdir <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> numpy <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> np <span class="hljs-comment"><span class="hljs-comment">#  -       . dirPath = "D:/project/jmeter.htmlParser.3.0.vs.2.13/logs" read_csv_param = dict( index_col=['timeStamp'], low_memory=False, sep = ";", na_values=[' ','','null']) #   csv-    . files = filter(lambda a: '.csv' in a, listdir(dirPath)) #    csv-  DataFrame dfs. csvfile = dirPath + "/" + files[0] print(files[0]) dfs = pd.read_csv(csvfile,**read_csv_param) for csvfile in files[1:]: print(csvfile) tempDfs = pd.read_csv(dirPath + "/" + csvfile, **read_csv_param) dfs = dfs.append(tempDfs) #dfs.to_excel(dirPath + "/total.xlsx") #     JSR223,      ,   HTTP Request Sampler. #  JSR223 URL ,  HTTP- URL . dfs = dfs[(pd.isnull(dfs.URL) == False)] #     ,   report.subrequests.html -   . #      ,    . #    -   ,   . pd.pivot_table(dfs, index=['siteKey', "jmeterVersion", "htmlParser"], values="URL", columns=["i"], aggfunc=lambda url: url.count()-1).to_html(dirPath + "/report.subrequest.count.html")</span></span></code> </pre><br><h1>  Recursive download on yandex.ru </h1><br> <a href=""><img src="https://habrastorage.org/files/3b8/6f1/eae/3b86f1eae9fc4863bfd8b79ea2c3f71f.PNG" alt="Apache.JMeter goes into recursion"></a> <br>  <font color="#999999"><i>Recursive loading of embedded resources for the current version of Apache.JMeter 3.0 with default settings (html-parser Lagarto) on the website yandex.ru</i></font> <br><br>  As seen: <br><br><ol><li>  Apache.JMeter finds and follows the link <code>https://yandex.ru/clck/redir/dtype=stred....7004fcb3793e79bb1ac9e&amp;keyno=12</code> </li><li>  Then it finds a new unique link <code>https://yandex.ru/clck/redir/dtype=stred....cd1c46cad58fbfe2f61&amp;keyno=12</code> </li><li>  And so on, goes into recursion. </li></ol><br>  In this case, this is the picture inside the link to download Yandex Browser: <br><br> <a href=""><img src="https://habrastorage.org/files/713/0b7/b24/7130b7b24eef4ac98ce766fc03a8d859.PNG" alt="Markup fragment when working with which the recursion step occurs in Apache.JMeter"></a> <br>  <font color="#999999"><i>Fragment of the html-code of the site yandex.ru processing of which adds a new recursion step, links and a picture for downloading Yandex Browser</i></font> <br><br>  The parser finds the picture.  JMeter tries to download it, gets a html page in response, there is again a link to the picture and other links.  And everything repeats.  <strong>Apache.JMeter</strong> behavior <strong>is</strong> correct. <br><br>  And in <strong>Apache.JMeter</strong> 2.13, the recursion occurs only on the <b>HtmlParser</b> parser, why does not guess why it happens to others: <br><br><ul><li>  there is a restriction on the length of references, and due to the cutting off of the unique end of the reference, recursion does not occur; </li><li>  or in <strong>Apache.JMeter</strong> 2.13, something is not working properly in parsers; </li><li>  or in <strong>Apache.JMeter</strong> 2.13, something works the other way around correctly - cookies, something else, and the Yandex server itself responds to it so that it does not go into recursion, for example, it responds with a picture to a picture request, and not a new html page. </li></ul><br><br>  I will not guess.  Seems a hopeless situation.  But such situations do not happen.  There is always a solution. <br><br>  For example, you can try to specify Yandex Browser as <strong>User-Agent</strong> .  Then the server probably will not show a picture for downloading the browser, or the picture will respond to the picture request, and there will be no recursion.  This is a guess, did not check it. <br><br>  Now the <strong>User-Agent</strong> for Google Chrome was specified in the script for synchronization with the work of webpagetest.org, and seeing the server not seeing your browser, apparently, suggests a link to your own. <br><br><h1>  The composition of the project </h1><br><ul><li>  <strong>jmeter.testfile.jmx</strong> - test script for <strong>Apache.JMeter 2.13</strong> and <strong>Apache.JMeter 3.0</strong> accepting input parameters: <br><br><ul><li>  <code>URL</code> - the address of the tested site, for example, <a href="https://yandex.ru/">https://yandex.ru/</a> ; </li><li>  <code>siteKey</code> - the string by which the grouping of records in the logs will be performed, for example, yandex.ru; </li><li>  <code>loopCount</code> - the number of test iterations, several iterations are used due to the fact that the work of websites may be unstable; </li><li>  <code>htmlParser.className</code> - a parser for extracting links to embedded resources; </li><li>  For the script to work, you need to download and install the additional <a href="https://github.com/pflb/Jmeter.Plugin.CsvLogWriter/releases">CsvLogWriter</a> plugin. </li></ul><br><br></li><li>  <strong>jmeter.3.0.bat</strong> is the test command batch file for <strong>Apache.JMeter 3.0</strong> , here you <strong>specify the</strong> path to the folder <code>/bin/</code> <strong>Apache.JMeter 3.0</strong> , the path to the test script <strong>jmeter.testfile.jmx</strong> , the test launch options, and the htmlParser check list whose work is performed; <br><br></li><li>  <strong>jmeter.2.13.bat</strong> is the test command command file for <strong>Apache.JMeter 2.13</strong> , here you set the path to the folder <code>/bin/</code> <strong>Apache.JMeter 2.13</strong> , the path to the test script <strong>jmeter.testfile.jmx</strong> , the test launch options, and the htmlParser check list whose work is performed; <br><br></li><li>  <strong>test.bat</strong> - batch test run file on two versions of <strong>Apache.JMeter</strong> , 2.13 and 3.0, the file contains the number of test iterations and the addresses of the sites under test.  The file calls <strong>jmeter.2.13.bat</strong> and <strong>jmeter.3.0.bat</strong> ; <br><br></li><li>  <strong>jmeter.3.0.vs.jmeter.2.13.ipynb</strong> - notepad for <strong>jupyter</strong> for analyzing the <strong>Apache.JMeter</strong> logs; <br><br></li><li>  <strong>statistics.xlsx</strong> - a table with statistics on the work of parsers, the result of the study. </li></ul><br>  The test is easy to change for yourself, specify your sites and the desired number of iterations.  All settings are specified in the <strong>test.bat</strong> file. <br><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://stackoverflow.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> stackoverflow.com <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://habrahabr.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> habrahabr.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://yandex.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> yandex.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://www.mos.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> mos.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://jmeter.apache.org/ <span class="hljs-number"><span class="hljs-number">5</span></span> jmeter.apache.org <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://www.google.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> google.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://www.linkedin.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> linkedin.com <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.2</span></span><span class="hljs-number"><span class="hljs-number">.13</span></span>.bat https://github.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> github.com <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://stackoverflow.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> stackoverflow.com <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://habrahabr.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> habrahabr.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://yandex.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> yandex.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://www.mos.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> mos.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat <span class="hljs-keyword"><span class="hljs-keyword">http</span></span>://jmeter.apache.org/ <span class="hljs-number"><span class="hljs-number">5</span></span> jmeter.apache.org <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://www.google.ru/ <span class="hljs-number"><span class="hljs-number">5</span></span> google.ru <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://www.linkedin.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> linkedin.com <span class="hljs-keyword"><span class="hljs-keyword">CALL</span></span> jmeter<span class="hljs-number"><span class="hljs-number">.3</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span>.bat https://github.com/ <span class="hljs-number"><span class="hljs-number">5</span></span> github.com</code> </pre><br>  You can then insert the results from an Excel file with customized formulas and get a descriptive table of results. <br>  You can try to refine the parsers, and follow a similar method to track the improvement in the quality of parsing embedded resources. <br><br><h1>  findings </h1><br>  There is no special practical value in the article.  But some useful conclusions can be made: <br><br><ul><li>  the parser on average retrieves references to only a third of the resources; </li><li>  parsers work almost the same, which means you can use any; </li><li>  parsers are designed to work with simple sites, such as jmeter.apache.org; </li><li>  on sites with a lot of content, the parsers work much worse than the real browser; </li><li>  the completeness of the load of embedded resources in the new version of JMeter slightly decreased, and not increased (on selected sites); </li><li>  demonstrated the use of the <strong>CsvLogWriter</strong> plugin, which logs requests for embedded resources in the csv-log, which was done by my colleague Alexander <a href="https://habrahabr.ru/users/sanchez92/" class="user_link">Sanchez92</a> ; </li><li>  using bat-files, transferring <strong>JMeter</strong> parameters via the command line, logging variables and processing csv-logs with <strong>pandas,</strong> you can test the testing tool itself, the technique has been worked out, see the project on github: <br><ul><li>  <a href="">https://github.com/pflb/jmeter.htmlParser.3.0.vs.2.13</a> . </li></ul></li></ul></div><p>Source: <a href="https://habr.com/ru/post/308254/">https://habr.com/ru/post/308254/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308236/index.html">Linux Vulnerability Audit with Vulners.com</a></li>
<li><a href="../308240/index.html">Arrays in PHP 7: Hash Tables</a></li>
<li><a href="../308242/index.html">We break garbage collection and deserialization in PHP</a></li>
<li><a href="../308246/index.html">OpenStreetView launch</a></li>
<li><a href="../308248/index.html">Trello Clone on Phoenix and React. Parts 6-7</a></li>
<li><a href="../308256/index.html">The creation of the game "Words from the Word"</a></li>
<li><a href="../308258/index.html">Why do you need SSL security certificates in 3CX Phone System</a></li>
<li><a href="../308260/index.html">Data backup in virtualization systems for small and medium-sized companies</a></li>
<li><a href="../308264/index.html">Symmetric difference in Swift and Objective-C capabilities</a></li>
<li><a href="../308266/index.html">What are the clouds and myths about them in the heads of ITshnikov: opinions, stereotypes and life in the "clouds"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>