<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Development of a payment system for the site using CyberSource Secure Acceptance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often, web developers are faced with the task of integrating a payment system into an already finished project. How to quickly and accurately co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Development of a payment system for the site using CyberSource Secure Acceptance</h1><div class="post__text post__text-html js-mediator-article">  Quite often, web developers are faced with the task of integrating a payment system into an already finished project.  How to quickly and accurately cope with this task?  Of course, today there are a large number of payment systems that provide tools for organizing credit card transaction processing.  And about one of such systems I want to tell.  Meet - <a href="https://www.cybersource.com/ru-RU/">CyberSource</a> . <br><a name="habracut"></a><br><h4>  How it works </h4><br>  CyberSource is a company that provides payment management services.  The company was founded in 1994.  In 2010, CyberSource was acquired by Visa Inc.  and is now its subsidiary.  Several solutions are offered for system integration: <br><br><ul><li>  Using API (Simple Order API, SOAP Toolkit API) </li><li>  Secure Acceptance (Web / Mobile, Silent Order POST) </li></ul><br>  Which of the integration options you would not choose, the general principle of operation is the same.  In order for a user to be able to carry out payment transactions on your website, he first of all needs to ‚Äútie‚Äù his credit card, that is, register it in CyberSource.  After successful registration, the user receives a unique identifier payment_token, the presence of which is mandatory in all subsequent transactions (card operations).  And today I want to talk about technology Secure Acceptance.  This integration method allows you to quickly create forms for making purchases on your website.  In addition, it requires writing a minimum of code, which makes the integration process easy and understandable even for those who are just taking the first steps in programming. <br><br><h4>  Work with CyberSource Secure Acceptance </h4><br>  To work with the CyberSource system, you first need to register and create a test account.  The test account will be used only at the stage of development and testing, and in the future it should be replaced with a full-fledged worker.  After registration, we enter the test business center.  This will be mainly our working tool.  Here the user can create profiles for Secure Acceptance, check the results of transactions, write letters to the support service.  Just want to note the presence of the Russian language for the cabinet interface.  You can switch to it in the ‚ÄúMy User Settings‚Äù menu.  In general, working with Secure Acceptance is quite simple, and I only had difficulties at the stage of creating profiles and setting them up.  But here the help desk always came to the rescue. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Answers to all my questions came pretty quickly.  The truth is that this service is organized quite specifically - through eTickets.  In order to ask a question, go to the ‚ÄúSupport Center‚Äù.  The support page will open.  In the My eTickets section, your calls to the service will be displayed.  To ask a question just create a new eTicket.  Below is a table with questions that users ask most often.  Therefore, first check to see if your answer is already contained in it.  If not, then feel free to create your eTicket, and CyberSource experts will be happy to provide you with all the necessary information.  They will post their answer in the same eTicket. <br><br>  To be able to use Cybersource Secure Acceptance on your site, you must create an appropriate profile.  This can be done by selecting ‚ÄúTools &amp; Settings‚Äù and going to the ‚ÄúSecure Acceptance‚Äù section of the ‚ÄúProfiles‚Äù menu.  By default, Secure Acceptance is disabled, so immediately after registration in the menu of your business center this item will not be.  To activate it, you need to contact support.  Immediately I advise you to ask to activate the Payment Tokenization service so that in the future there will be no error <i>"Recurring Billing or Secure Storage"</i> . <br>  We are waiting until the section "Secure Acceptance" appears in the settings menu and proceed to create a profile. <br><br><h4>  Secure Acceptance Web / Mobile and Secure Acceptance Silent Order POST profiles </h4><br>  Cybersource Secure Acceptance offers two methods for site integration: <br><br><ol><li>  Secure Acceptance Web / Mobile </li><li>  Secure Acceptance Silent Order POST </li></ol><br>  There is practically no difference between these two methods.  Secure Acceptance Web / Mobile offers ready-made forms for collecting and displaying information, whereas in Secure Acceptance Silent Order POST, the developer creates all forms on his own.  For example, to link a credit card to Web / Mobile, it is enough to place a button on the site, by clicking which, the user enters the registration data entry form developed by CyberSource.  It is impossible to change this form (although you can change the style a bit in the profile settings).  If the transaction is successful, then the receipt form is displayed (also from CyberSource).  In Silent Order POST, the developer himself creates all the forms he needs.  That's all the difference.  And then the principles of the work of both methods are the same.  After the server has processed the request, the user is automatically redirected to the page specified in the profile settings.  In addition, if the settings specified email address or page, then where will be sent a receipt with the results of the transaction. <br><br>  You can create any number of profiles of various types (Web / Mobile or Silent Order POST).  But only one of them can be active.  Be careful.  If you activate the Web / Mobile profile, and send requests to Silent Order POST, this will cause an error at the authorization stage of the request in the system.  After all, each profile has a unique identifier and keys, on the basis of which the authorization takes place. <br><br>  Here is a list of the main groups of settings: <br><br>  <b>Are common</b> <br><ul><li>  General Settings - profile name, type, profile ID </li><li>  Payment Settings - settings for credit card types, currency </li><li>  Security - creating keys for authorization </li><li>  Notifications - choose where the receipt with the results of the transaction will be sent </li><li>  Customer Response Pages - page settings for various server responses </li></ul><br>  <b>Only for Web / Mobile</b> <br><ul><li>  Appearance and Branding - add your own brand on the form </li><li>  Localization - list of supported languages </li><li>  Payment Form - setting the form fields </li></ul><br>  After filling in all the required fields, activate the profile.  If necessary, make changes - first we do deactivation.  A list of all available profiles can be seen by clicking the " <b>&lt;All Profiles</b> " button at the top of the page. <br><br><h4>  Practical implementation </h4><br>  The official documentation has very good examples of working with Secure Acceptance, written in various programming languages.  Implementation in PHP is quite simple, and makes it easy to integrate the system into the site.  But I did not like the fact that the form in the hidden fields contains information for authorizing transactions (profile identifier, keys, identifier and date of the transaction).  Therefore, I decided to complicate my life and make sure that all these fields are filled immediately before being sent to the server.  In addition, without accessing the server is not enough.  And that's why.  Before sending data, the CyberSource server needs to generate a signature.  The signature is generated based on the required form fields (the names of these fields are in the signed_field_names field) and recorded in the signature field.  The same signature is generated on the server and serves to verify the integrity of the data received. <br><br>  Therefore, all the scripts from my example can be divided into 3 groups: <br><br>  The <i>get_default.php</i> script returns a data set to fill in the form fields (depending on the type of transaction and the type of system).  This script uses three classes that I created to work with Cybersource Secure Acceptance <br><br><ul><li>  Base class <b>Cybersource</b> - contains fields and methods common to Web / Mobile and Silent Order POST </li><li>  <b>SecureAcceptanceWM</b> class - for working with Web / Mobile </li><li>  Class <b>SecureAcceptanceSOP</b> - to work with Silent Order POST </li></ul><br>  Data is returned in JSON format and recorded in the appropriate fields of the form, after which it is submitted (submit). <br><br>  Script <i>get_response</i> - here the server response is sent with a receipt of the transaction results.  The address of this script must be specified in the settings of the ‚ÄúNotifications‚Äù profile.  The answer comes in the form of an array, which is located in $ _POST.  The result of the transaction is in the field reason_code.  The transaction is successful if the reason_code is 100. A full list of response fields, as well as error codes, can be found in the documentation.  The task of this script is to write to the database the payment_token field if the transaction was successful. <br><br>  Script <i>get_users</i> - used to get a list of users or create a new one.  This script uses the class <b>User</b> . <br><br>  In addition, the <b>DbAdapter</b> class is used in all scripts.  This class is designed to work with the mySQL database. <br><br>  Since the server‚Äôs response comes to a separate address, the logical question is how to track which particular user the token was created for?  I did not find a standard solution and therefore did so.  Before sending the form to the CiberSource server, I write down the identifier of this transaction to the user for whom I bind a credit card.  When the answer comes, it also contains this identifier.  Therefore, I can unequivocally find the user for whom the transaction was launched and save payment_token for him. <br><br>  And another question that may arise - is it possible to use Secure Acceptance without web forms?  Let's say you have a huge number of users, and every month they have to pay a certain amount.  We will not force them to constantly go to the site, open and fill out a form of payment.  It is necessary to automate this process somehow.  I tried to do this using CURL and Silent Order POST.  The support service wrote that they did not guarantee the correct operation of such a bundle.  But the result was positive and requests are sent normally.  You just need to remember to check the result of the curl_exec () function execution, to verify that the transaction is authorized, to issue a message in case of failure.  However, I would not advise using CURL for such purposes.  Although it works, it is not as convenient as the CyberSorce API. <br><br>  My example, which you can download <a href="http://my-files.ru/kzf9ax">here</a> , works with a test version of the account.  When switching to production, you must: <br><br><ol><li>  Register in the system (create a working account, not a test account) </li><li>  Register new profile parameters in classes </li><li>  Change addresses for submitting forms (change endpoints) </li></ol><br>  A list of required form fields, endpoints and all additional information can be found in the official documentation of <a href="http://apps.cybersource.com/library/documentation/dev_guides/Secure_Acceptance_WM/html/wwhelp/wwhimpl/js/html/wwhelp.htm">Secure Acceptance Web / Mobile</a> and <a href="http://apps.cybersource.com/library/documentation/dev_guides/Secure_Acceptance_SOP/html/wwhelp/wwhimpl/js/html/wwhelp.htm">Secure Acceptance Silent Order POST</a> </div><p>Source: <a href="https://habr.com/ru/post/229947/">https://habr.com/ru/post/229947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229937/index.html">Looking for a melody by fragment</a></li>
<li><a href="../229939/index.html">How to make friends with a hedgehog and a man: the experience of using PowerShell in web applications</a></li>
<li><a href="../229941/index.html">Facebook XHP. Object Templates</a></li>
<li><a href="../229943/index.html">The notorious programmer: Informal stories and frank conversations about the IT-industry</a></li>
<li><a href="../229945/index.html">WebCamp Special Rapporteur: Mobile Day - Andrian Budantsov, co-founder of Readdle</a></li>
<li><a href="../229949/index.html">Implementation and testing of facial recognition algorithm</a></li>
<li><a href="../229953/index.html">Webinar "Using public clouds in retail"</a></li>
<li><a href="../229955/index.html">Spring and @Autowired for ENUM types. Optional</a></li>
<li><a href="../229957/index.html">How to discuss money with management or why sometimes careers stop?</a></li>
<li><a href="../229959/index.html">Lorentz's dynamic system and computational experiment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>