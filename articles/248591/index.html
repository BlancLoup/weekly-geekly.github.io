<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the DSP coprocessor DM8168 using the C6Accel framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we will look at the DM816x / C6A816x / AM389x debugging card and the C6Accel framework (also known as C6EZAccel), and also consider h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the DSP coprocessor DM8168 using the C6Accel framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/925/c68/7f5/925c687f57554086a9993a409b9a021d.jpg"><br><br>  In this article, we will look at the DM816x / C6A816x / AM389x debugging card and the C6Accel framework (also known as C6EZAccel), and also consider how to set up the system for running embedded test applications. <br><br>  It all started with an interesting idea to use the algorithms of the now very popular computer vision library OpenCV on a microprocessor.  However, having studied a little topic, the idea was clarified.  Why not implement the algorithms not just on the ARM core, but on a specialized core for digital DSP signal processing?  Thus, we will unload the ARM core, speed up the execution of algorithms, and, you see, the most cumbersome application will work in real time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, what to use to solve the problem?  It turned out a bit of options ... <br><a name="habracut"></a><br>  Consider everything logically and consistently.  Let's start with the fact that it allows you to work with a DSP processor - this is the C6Accel framework.  Well, it supports OpenCV (and 2.x) only in the latest version - 2.01.00.11.  In turn, this framework is written under C6A81xx / DM81xx microprocessors.  By the title of the article, you have already guessed that we got the hand of DM8168, which requires the TI EZSDK software interface (the latest version is 05/05/02/00). <br><br>  For those who want more details, there are useful links at the end of the article. <br><br><h4>  1. Description of the DM816x / C6A816x / AM389x debug board </h4><br><br><img src="https://habrastorage.org/files/3b5/fa6/f73/3b5fa6f736dd481ba6ab48a96b01d6df.png"><br><br>  Computing module DM816x / C6A816x / AM389x, developed by Texas Instruments together with Spectrum Digital, enables development of a DM816x DaVinci MPU (DM8168, DM8167, DM8166, DM8165), C6A816x C6-Integra DSP + ARM processors (C6A8168, C6A816x, C6-Integra DSP + ARM processors (C6A8168, C6A816x); AM389x Sitara ARM MPUs (AM3894, AM3892). <br><br>  This miracle of technology is intended for a wide range of solutions, such as video recorders (DVRs) for surveillance, video conferencing systems, television broadcasting systems, media servers, single-board computers, computing gateway machines, routers, servers, industrial automation, user-machine interfaces (HMIs ), service point terminals for data collection, machine vision, applications for testing, measuring, tracking, monitoring, etc. <br><br><img src="https://habrastorage.org/files/3fe/a1d/a78/3fea1da78d44466ab45cf3907ac7856c.jpg"><br><br>  Now look at the object itself.  It consists of two blocks of printed circuit boards: <br><ul><li>  computing module 8168 (above); </li><li>  daughter board expansion I / O (bottom). </li></ul><br>  Due to the large number of components, we turn our attention only to especially important ones. <br><br><img src="https://habrastorage.org/files/94f/1cf/90b/94f1cf90b28e445abcff8859f3bc357b.jpg"><br><br>  The figure above shows the computing module 8168 with the following components indicated: <br>  <b>1.</b> and <b>2.</b> are the switches ‚Ññ3 (SW3) and ‚Ññ4 (SW4), respectively. <br><br><img src="https://habrastorage.org/files/fa1/9d2/82c/fa19d282c1ef448ca94503e2df8a5560.png"><br><br>  Standardly, the board is loaded from NAND flash memory (however, there are many other modes, for example, booting from an SD card), therefore switches No. 3 and No. 4 were set to the desired position: SW3 [9: 0] = ‚Äù0000010010‚Äù and SW4 [1: 0] = ‚Äù10‚Äù [NAND / SPI]. <br><br>  <b>3.</b> Serial port (COM port). <br>  <b>4.</b> HDMI port. <br>  <b>5.</b> Ethernet port. <br>  <b>6.</b> USB port. <br>  <b>7.</b> Component video connector. <br>  <b>8.</b> Slot for SD card. <br>  <b>9.</b> Power socket. <br>  <b>10.</b> Power switch. <br>  <b>11.</b> Microprocessor DM8168 (emulates AM3894 and C6A816). <br><br>  Functional diagram: <br><br><img src="https://habrastorage.org/files/67f/6fa/862/67f6fa8625a448d09ea660e19f68bd59.png"><br><br>  Characteristics: <br>  ‚Ä¢ VLIW-processor C674x DSP (up to 1 GHz, command type - with fixed and floating point). <br>  ‚Ä¢ ARM Cortex-A8 RISC processor (up to 1.2 GHz). <br>  ‚Ä¢ SGX530 3D Graphics Crusher. <br>  ‚Ä¢ High-definition video processing subsystem (HDVPSS). <br>  ‚Ä¢ 3 programmable high-definition video processing coprocessor (HDVICP2) responsible for capturing, encoding, decoding and analyzing multiple video streams, as well as supporting the standards H.264, MPEG4, H263, VC1 / RTV, AVS, RV10, ON2, JPEG, MPEG2, Divx. <br>  ‚Ä¢ Wide range of peripheral modules: <br>  - 2 Gigabit Ethernet channels; <br>  - 2 PCI Express channels; <br>  - 2 SATA channels with integrated physical layer; <br>  - 2 USB 2.0 channels with an integrated physical layer; <br>  - interfaces DDR3, MMC / SD, HDMI and DVI. <br><br>  For further work, we connected to components 3, 5, 9 and set up switches 1, 2, 10. <br><br><h4>  2. Description of the C6Accel framework </h4><br>  C6Accel is a completely free software development tool from Texas Instruments (TI).  It is designed to simplify the development of DSP code on TI's dual-core heterogeneous SoC processors, namely for ARM + DSP devices that run Linux on ARM and contain a DSP from the C6000 family. <br><br><h5>  2.1.  What does C6Accel consist of? </h5><br>  C6EZAccel consists of digital signal processing algorithms that follow the interface of algorithms called <a href="http://processors.wiki.ti.com/index.php/Category:XDAIS">XDAIS</a> (eXpressDsp Algorithm Interoperability Standard).  TI also provides a framework called the <a href="http://processors.wiki.ti.com/index.php/Category:Codec_Engine">Codec Engine</a> , which allows you to efficiently execute algorithms written using the XDAIS interface.  TI supplies all of its codecs as part of its SoC software and recommends using the Codec Engine.  C6EZAccel also consists of a library on the ARM side, which is an add-on to the Codec Engine, which provides APIs (application programming interfaces).  And they, in turn, allow the application code on the ARM side to trigger the execution of XDAIS algorithms on the DSP.  This library contains cache management, address translation, parameter passing and error handling from an application running on ARM. <br><br><h5>  2.2.  How does C6Accel work? </h5><br>  The ARM application code (or middleware that uses it) calls C6Accel.  It uses a library of APIs and / or Codec Engine, compatible with iUniversal APIs, which, like VISA APIs, are used to call Audio / Video / Speech codecs.  Then these APIs scan the Codec Engine interface and invoke the C6Accel algorithm on the DSP, which identifies the function call and enables the corresponding functionality on the DSP using the parameters passed from the application. <br><br><img src="https://habrastorage.org/files/cfb/6fa/a58/cfb6faa58b024ef198577d470e22cfe8.jpg"><br><br><h4>  3. Using EZSDK and C6Accel </h4><br>  Enough theory, let's get down to practice.  EZSDK 05.05.02.00 is supported only in <a href="">Ubuntu 10.04 LTS 32-bit</a> or <a href="">Ubuntu 11.10 32-bit</a> .  Therefore, those who do not have one of these operating systems installed (of course, we worked under a newer version) will have to use a virtual machine, for example, VirtualBox.  Instructions for installing and configuring it are available <a href="http://processors.wiki.ti.com/index.php/How_to_Build_a_Ubuntu_Linux_host_under_VirtualBox">here</a> . <br><br>  Further, the following notation is used: <br><ul><li>  host $ - command to execute on the host; </li><li>  target # - a command to execute on the target OS. </li></ul><br><h5>  3.1.  Installation and assembly of EZSDK </h5><br>  Before you start working with EZSDK, download and install the <a href="">CodeSourcerychain 2009q-203</a> C compiler.  Just unpack the archive into your home directory. <br><br>  Download <a href="http://software-dl.ti.com/dsps/dsps_public_sw/ezsdk/latest/index_FDS.html">EZSDK 05.05.02.00</a> and execute: <br><pre><code class="bash hljs">host $ sudo ./ezsdk_dm816x-evm_5_05_02_00_setuplinux</code> </pre> <br>  The installer will start.  Specify the location of the CodeSourcery Toolchain, i.e. / home /% username% / arm-2009q1 / bin, and the path to install the EZSDK is / home /% username% / ezsdk. <br><br>  The developers of this software took care of us and made an interactive script (one of the reasons for strict binding to the OC version): <br><pre> <code class="bash hljs">host $ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> EZSDK=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${HOME}</span></span></span><span class="hljs-string">/ezsdk"</span></span> host $ sudo <span class="hljs-variable"><span class="hljs-variable">${EZSDK}</span></span>/setup.sh</code> </pre><br>  The script will install the necessary packages and ask for clarification: <br><ul><li>  The installation path of the target file system is / home /% username% / targetfs; </li><li>  tftp root directory path is / tftpboot; </li><li>  the serial port path is / dev / ttyUSB0 (for connecting via USB) or / dev / ttyS0 (for connecting via COM-port); </li><li>  ip-address of the host machine - each has its own (for example, we have 10.54.4.44); </li><li>  the location of the Linux kernel is the 1st of the suggested list, i.e. TFTP; </li><li>  location of the root file system - the 1st of the proposed list, i.e. NFS; </li><li>  The name of the kernel image loaded from TFTP is uImage-dm816x-evm.bin; </li><li>  whether to create a script for minicom - agree; </li><li>  whether to run the created script now - refuse. </li></ul><br>  Correct this script: open it in a text editor and replace the text "mem = 364M @ 0x80000000 mem = 320M @ 0x9FC00000" with "mem = 364M", since in the future it will be impossible to load the necessary kernel modules. <br><br>  Next, to perform any operations on the board, you need to run minicom with the settings specified in the script with the command <br><pre> <code class="bash hljs">host $ minicom -S setup_uimage-tftp_fs-nfs.minicom</code> </pre><br>  Next you need to restart the board. <br><br>  Now when assembling EZSDK there is a problem due to the absence of some component.  You can fix it by unpacking the <a href="">8272.pcie.tar.gz</a> archive to the / home /% username% / ezsdk / example-applications directory. <br><br>  Finally we will build EZSDK teams. <br><pre> <code class="bash hljs">host $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/ezsdk host $ sudo make all host $ sudo make install</code> </pre><br><h5>  3.2.  Installation and assembly of C6Accel </h5><br>  Download <a href="http://software-dl.ti.com/dsps/dsps_public_sw/c6000/web/c6accel/latest/index_FDS.html">C6Accel 2.01.00.11</a> and follow: <br><pre> <code class="bash hljs">host $ sudo ./c6accel_2_01_00_11_Linux-x86_Setup.bin</code> </pre><br>  Specify the installation path / home /% username% / c6accel. <br><br>  The SYS / BIOS real-time operating system is part of the EZSDK, but versions later than 6.32.02.09 do not support Real Time Data eXchange (RTDX), which is required when building C6Accel.  Therefore, we will install <a href="http://downloads.ti.com/dsps/dsps_public_sw/sdo_sb/targetcontent/bios/sysbios/6_32_02_39/index_FDS.html">SYS / BIOS 6.32.02.09</a> specifically for C6Accel: <br><pre> <code class="bash hljs">host $ sudo ./bios_setuplinux_6_32_02_39.bin</code> </pre><br>  Specify the installation path / home /% username% / c6accel / bios_6_32_02_39. <br><br>  Fix the paths in the Rules.make file in / home /% username% / c6accel to the following: <br><pre> <code class="bash hljs">DVSDK_INSTALL_DIR=$(HOME)/ezsdk TARGETFS_INSTALL_DIR = $(HOME)/targetfs C6ACCEL_INSTALL_DIR=$(HOME)/c6accel BIOS_INSTALL_DIR = $(HOME)/c6accel/bios_6_32_02_39 DSPDEVKIT_INSTALL_DIR= $(DVSDK_INSTALL_DIR)/dsp-devkit LINUXDEVKIT_INSTALL_DIR = $(DVSDK_INSTALL_DIR)/linux-devkit PLATFORM = dm816x-evm</code> </pre><br>  And, in the end, we will assemble the C6Accel teams: <br><pre> <code class="bash hljs">host $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/c6accel host $ sudo make all host $ sudo make install</code> </pre><br><h5>  3.3.  DSP Test Execution </h5><br>  It's nice that C6Accel contains an example to test the execution of code on a DSP processor.  Run the script to load the cmem and dsplink modules (these are the ARM and DSP bundle libraries with which CodecEngine is loaded) and run the testing application. <br><pre> <code class="bash hljs">target <span class="hljs-comment"><span class="hljs-comment"># cd /opt/c6accel_app/c6accel_dsplib_testapp target # ./loadmodules_ti8168_c6accel.sh target # ./c6accel_dsplib_testapp</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Hooray!</b>  <b class="spoiler_title">The messages in the console show that everything is in order and nothing is broken.</b> <div class="spoiler_text">  ************************************************** **************************** <br>  Sample application for testing kernels in C6Accel started. <br>  ************************************************** **************************** <br>  CERuntime complete <br>  C6Accel handle created <br>  - <br>  Test for Vision / Analytics functions in C6Accel: <br>  - <br><br><br>  Testing the function: VLIB_histogram_1D_dU8 ... <br>  VLIB_histogram_1D_U8 passed the test! <br><br><br>  Testing the function: VLIB_histogram_1D_U16 ... <br>  VLIB_histogram_1D_U16 passed the test! <br><br><br>  Testing the function: VLIB_histogram_nD_U16 ... <br>  VLIB_histogram_nD_U16 passed the test! <br><br><br>  Testing the function: VLIB_weightedHistogram_1D_U8 ... <br>  VLIB_weightedHistogram_1D_U8 passed the test! <br><br><br>  Testing the function: VLIB_weightedHistogram_nD_U16 ... <br>  VLIB_weightedHistogram_nD_U16 failed the test! <br>  VLIB_unpackMask32 passed the test! <br>  VLIB_packMask32 passed the test! <br>  VLIB_subtractBackGroundS16 passed the test! <br>  VLIB_subtractBackGroundS32 passed the test! <br><br><br>  Testing the function: VLIB_extractLumaFromUYUV ... <br>  C6accel test for VLIB_extractLumaFromUYUV passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYsemipl_to_YUVpl ... <br>  VLIB_convertUYVYsemipl_to_YUVpl passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYpl_to_YUVint ... <br>  VLIB_convertUYVYpl_to_YUVint passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYint_to_YUVpl ... <br>  VLIB_convertUYVYint_to_YUVpl passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYint_to_RGBpl ... <br>  VLIB_convertUYVYint_to_RGBpl passed the test! <br><br><br>  Testing the function: VLIB_ConvertUYVYint_to_YUV420pl ... <br>  VLIB_ConvertUYVYint_to_YUV420pl passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYint_to_LABpl ... <br>  VLIB_convertUYVYint_to_LABpl passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYint_to_HSLpl ... <br>  VLIB_convertUYVYint_to_HSLpl passed the test! <br><br><br>  Testing the function: VLIB_convertUYVYint_to_LABpl_LUT ... <br><br><br>  Completed initialization. <br>  VLIB_convertUYVYint_to_LABpl2 passed the test! <br>  Testing VLIB_harrisScore_7x7 ... <br>  VLIB_harrisScore_7x7 passed the test! <br><br><br>  Initializing Legendre Polynomial <br><br>  Computing Legendre Moments <br><br><br>  Testing the function: VLIB_legendreMoments ... <br>  VLIB_legendreMoments passed the test! <br><br><br>  Testing the function: VLIB_normalFlow_16 ... <br>  VLIB_normalFlow_16 passed the test! <br><br><br>  Testing the function: VLIB_kalmanFilter_4x6 functions ... <br>  VLIB_kalmanFilter_ VLIB_recursiveFilterHoriz1stOrderS16 ... <br>  VLIB_recursiveFilterHoriz1stOrderS16 passed the test! <br><br>  Testing VLIB_recursiveFilterVert1stOrader.der ... <br>  VLIB_recursiveFilterVert1stOrder passed the test! <br><br>  Testing VLIB_recursiveFilterVert1stOrderS16 ... <br>  VLIB_recursiveFilterVert1stOrderS16 passed the test! <br><br><br>  Testing the function: VLIB_bhattacharyaDistance_U32 ... <br>  VLIB_bhattacharyaDistance_U32 passed the test! <br><br><br>  Testing the function: VLIB_L1DistanceS16 ... <br>  VLIB_L1DistanceS16 functions passed the test <br>  VLIB_dilate_bin_mask passed the test! <br>  VLIB_dilate_bin_square passed the test! <br>  VLIB_dilate_bin_cross passed the test! <br>  VLIB_erode_bin_mask passed the test! <br>  VLIB_erode_bin_square passed the test! <br>  VLIB_erode_bin_cross passed the test! <br>  Testing VLIB_trackFeaturesLucasKanade_7x7 ... <br>  VLIB_trackFeaturesLucasKanade_7x7 passed the test! <br>  VLIB Canny functions Test results: <br>  IMG_conv_7x7: passed the test! <br>  VLIB_xyGradient: passed the test! <br>  VLIB_nonMaximumSuppressionCanny: passed the test! <br>  VLIB_doublethresholding: passed the test! <br>  VLIB_edgeRelaxation: passed the test! <br><br>  Calling Chained Canny API: <br>  Chained Canny edge detection function failed the test! <br><br><br>  Testing the function: VLIB_integralImage8 ... <br>  VLIB_integralImage8 passed the test! <br><br><br>  Testing the function: VLIB_integralImage16 ... <br>  VLIB_integralImage16 passed the test! <br><br><br>  Testing the function: VLIB_imagePyramid8 ... <br>  VLIB_imagePyramid8 passed the test! <br><br><br>  Testing the function: VLIB_imagePyramid16 ... <br>  VLIB_imagePyramid16 passed the test! <br><br><br>  Testing the function: VLIB_gauss5x5PyramidKernel_8 ... <br>  VLIB_gauss5x5PyramidKernel_8 passed the test! <br><br><br>  Testing the function: VLIB_gauss5x5PyramidKernel_16 ... <br>  VLIB_gauss5x5PyramidKernel_16 passed the test! <br><br><br>  Testing the function: VLIB_gradientH5x5PyramidKernel_8 ... <br>  VLIB_gradientH5x5PyramidKernel_8 passed the test! <br><br><br>  Testing the function: VLIB_gradientV5x5PyramidKernel_8 ... <br>  VLIB_gradientV5x5PyramidKernel_8 passed the test! <br><br>  VLIB_initMeanWithLumaS16 passed the test! <br>  VLIB_updateEWRMeanS16 passed the test! <br>  VLIB_initMeanWithLumaS32 passed the test! <br>  VLIB_updateEWRMeanS32 passed the test! <br>  VLIB_initVarWithConstS32 passed the test! <br>  VLIB_updateEWRVarianceS32 passed the test! <br>  VLIB_initVarWithConstS16 passed the test! <br>  VLIB_updateEWRVarianceS16 passed the test! <br>  VLIB_updateUWRMeanS16 passed the test! <br>  VLIB_updateUWRVarianceS16 passed the test! <br>  - <br>  Test for Image processing functions in C6Accel: <br>  - <br>  Tests for Histogram functions successful <br>  Test for Median Filtering functions successful <br>  Tests for Convolution functions successful <br>  Tests for Correlation functions successful <br>  Tests for Sobel Filter successful <br>  Test for Image multiplication functions successful <br>  Tests for image addition functions successful <br>  Tests for Image substraction functions successful <br>  Tests for Color Space Conversion functions successful <br>  C6accel_IMG_ycbcr422pl_to_ycbcr422sp () successful <br>  C6accel_IMG_ycbcr422sp_to_ycbcr422ile () successful <br>  C6accel_IMG_ycbcr422sp_to_ycbcr420pl successful <br>  - <br>  C6Accel Test for Fixed Point <br>  - <br>  Tests for FFT functions successful <br>  Tests for Invers FFT functions successful <br>  Test for Auto Correlation function successful <br>  Tests for DoT <br>  Tests for Matrix multiplication successful <br>  Tests for FIR Filtering functions successful <br>  Test for IIR Filter successful <br>  - <br>  Test for Fixed point Math functions in C6Accel <br>  - <br>  Test for Arithmetic functions <br>  Tests for Conversion RTS functions successful <br>  Tests for IQmath Conversion functions successful <br>  Tests for Mathematical IQmath functions successful <br>  Tests for Arithmetic IQmath functions successful <br>  Tests for Trignometric IQmath functions successful <br>  - <br>  Test for Floating Point Math Functions in C6Accel <br>  - <br>  Test for Arithmetic functions <br>  Tests for Conversion RTS functions successful <br>  Tests for Floating point <br>  Tests for Floating Point RTS <br>  - <br>  Test for Floating Point Signal processing Functions in C6accel <br>  - <br>  Test for Floating point DSP FFT function successful <br>  Test for Floating point DSP vector multiplication successful <br>  Test for Floating point DSP vector reciprocal function successful <br>  Test for Floating point DSP vector reciprocal function successful <br>  Test for Floating point DSP vector weighted sum function successful <br>  Test for float point <br>  Tests for Floating point <br>  Tests for Floating point DSP Matrix Multiplication functions successful <br>  Test for Floating point DSP matrix transpose function successful <br>  Tests for Floating point DSP autocorrelation functions successful <br>  Tests for Floating point <br>  Test for Floating point DSP FIR filter successful <br>  Test for Floating point DSP Inverse FFT function successful <br>  Test for Floating point DSP BIQUAD Filter successful <br>  Test for Floating point to Double precision successful <br>  Test for complex <br>  -&gt; Asynchronous Calls <br>  Tests for FFT functions successful <br>  Tests for Sobel Filter successful <br>  Test for Arithmetic functions <br>  ************************************************** **************************** <br>  All tests done. <br>  ************************************************** **************************** <br></div></div><br><br><h4>  4. Comparison test of OpenCV functions on ARM and DSP </h4><br>  OpenCV (Open Source Computer Vision Library) is a library of computer vision, image processing and general-purpose numerical algorithms with an open source code.  The library is written in C and C ++, but it is supported by Java, Python, etc. It works under Linux, Windows and Mac OS X. <br><br>  OpenCV is an easy-to-use library of computer vision with over 500 functions that can work in real time.  They cover many areas, such as quality control in manufacturing, security systems, image processing in medicine, user interfaces, stereoscopic vision and robotics. <br><br>  Since the OpenCV library is portable software, it can be compiled on most systems with a C / C ++ compiler.  OpenCV is successfully used on ARM, MIPS, Xscale and other processors. <br><br>  It is worth noting that in C6Accel 2.01.00.11 there are not all OpenCV functions, but only 50. <br><br><h5>  4.1.  Installing and building OpenCV </h5><br>  Follow the <a href="http://processors.wiki.ti.com/index.php/Building_OpenCV_for_ARM_Cortex-A8">instructions</a> to build <a href="http://opencv.org/downloads.html">OpenCV 2.2.0</a> under the ARM platform.  When executing them, remember that CodeSourcery Toolchain is already installed. <br><br>  Copy the shared libraries of OpenCV to the target file system. <br><pre> <code class="bash hljs">host $ cp <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/build/lib/* <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/targetfs/usr/lib</code> </pre><br><h5>  4.2.  Build and run the test </h5><br>  The first problem encountered was an error when loading images.  For some reason, they do not like pictures with the png extension, the error is localized in the cvCreateImage function.  Ok, change to another extension, for example, bmp.  This can be done like this: <br><pre> <code class="bash hljs">host $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/c6accel/soc/app/c6accel_opencv_testapp/opencv_images host $ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fname <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> *.png; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> convert <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$fname</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$fname</span></span></span><span class="hljs-string">.bmp"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br>  And of course, let's not forget to change the extensions in the source code.  In the appMain.c and c6accel_opencv_testfxns.c files located in the / home /% username% / c6accel / soc / app / c6accel_opencv_testapp directory, replace all occurrences of the ‚Äú.png‚Äù line with ‚Äú.png.bmp‚Äù, the text editor gedit is convenient for this purpose Ctrl + H. <br><br>  The second problem turned out to be an error when executing the C6Accel_test_Matchshapes function and the cvFindCornerSubPix function failure (due to the known bug <a href="http://code.opencv.org/issues/963">http://code.opencv.org/issues/963</a> ). <br><br>  In the appMain.c file, comment out the line with the function C6Accel_test_Matchshapes.  And in the file c6accel_opencv_testfxns.c we comment out the text from the line <br><pre> <code class="bash hljs">//cvFindCorner SubPix issue to be resolved</code> </pre>  and inclusive up to the line <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"Called ARM FindCornerSubPix function (time: %f ms)\n"</span></span>, t_algo / 1000.0 / n);</code> </pre><br>  Finally, build and run the test application. <br><pre> <code class="bash hljs">host $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">${HOME}</span></span>/c6accel host $ sudo make opencv_app host $ sudo make opencv_app_install target <span class="hljs-comment"><span class="hljs-comment"># cd /opt/c6accel_app/c6accel_opencv_testapp target # ./loadmodules_ti8168_c6accel.sh target # ./c6accel_opencv_testapp</span></span></code> </pre><br>  Hooray!  After much suffering, everything worked. <br><br><div class="spoiler">  <b class="spoiler_title">The result of the application is summarized in the table.</b> <div class="spoiler_text"><table><tbody><tr><td><p>  <b>OpenCV function</b> </p><br></td><td><p>  <b>Average time</b> <b><br></b>  <b>fulfillment</b> <b><br></b>  <b>on ARM, ms</b> </p><br></td><td><p>  <b>Average time</b> <b><br></b>  <b>fulfillment</b> <b><br></b>  <b>on DSP, ms</b> </p><br></td><td><p>  <b>Mark about</b> <b><br></b>  <b>choosing</b> <b><br></b>  <b>DSP</b> </p><br></td><td><p>  <b>The difference between the performance results</b> <b><br></b>  <b>on ARM and DSP (distance in space</b> <b><br></b>  <b>L2, unless otherwise noted)</b> </p><br></td></tr><tr><td><p>  cvCanny </p><br></td><td><p>  43.218000 </p><br></td><td><p>  42.804000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  get Affine transform matrix </p><br></td><td><p>  0.557000 </p><br></td><td><p>  0.411000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Affine transform </p><br></td><td><p>  46.325000 </p><br></td><td><p>  36.554000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  7926.342031 </p><br></td></tr><tr><td><p>  2D Rotation Matrix </p><br></td><td><p>  0.314000 </p><br></td><td><p>  0.378000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Rotation using Affine </p><br></td><td><p>  55.380000 </p><br></td><td><p>  40.985000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  774.451419 </p><br></td></tr><tr><td><p>  cvIntegral </p><br></td><td><p>  6.537000 </p><br></td><td><p>  8.232000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvMinMaxLoc </p><br></td><td><p>  3.083000 </p><br></td><td><p>  1.660000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  The results are the same. </p><br></td></tr><tr><td><p>  cvNorm </p><br></td><td><p>  1.881000 </p><br></td><td><p>  1.336000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Adds </p><br></td><td><p>  9.573000 </p><br></td><td><p>  12.434000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Absdiff </p><br></td><td><p>  9.036000 </p><br></td><td><p>  14.349000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Absdiffs </p><br></td><td><p>  10.555000 </p><br></td><td><p>  12.670000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  Add </p><br></td><td><p>  8.931000 </p><br></td><td><p>  15.852000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvDilate </p><br></td><td><p>  3.182000 </p><br></td><td><p>  1.282000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvErode </p><br></td><td><p>  3.093000 </p><br></td><td><p>  1.281000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvLaplace </p><br></td><td><p>  180.171000 </p><br></td><td><p>  11.968000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvPyrDown </p><br></td><td><p>  4.265000 </p><br></td><td><p>  4,917,000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvFilter2D </p><br></td><td><p>  519.593000 </p><br></td><td><p>  21.259000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  3651.030129 </p><br></td></tr><tr><td><p>  cvFindContours </p><br></td><td><p>  11.915000 </p><br></td><td><p>  17.753000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  The results are the same. </p><br></td></tr><tr><td><p>  Equalizehist </p><br></td><td><p>  5.809000 </p><br></td><td><p>  8.921000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  SetZero </p><br></td><td><p>  0.634000 </p><br></td><td><p>  3.871000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td rowspan="3"><p>  132898.252336 </p><br></td></tr><tr><td><p>  Rectangle </p><br></td><td><p>  5.847000 </p><br></td><td><p>  1,307,000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  Circle </p><br></td><td><p>  3.652000 </p><br></td><td><p>  3.323000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  Flip </p><br></td><td><p>  12.372000 </p><br></td><td><p>  12.071000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td rowspan="2"><p>  0.000000 </p><br></td></tr><tr><td><p>  Copy </p><br></td><td><p>  2.479000 </p><br></td><td><p>  6.072000 </p><br></td><td><p>  <strong>-</strong> </p><br></td></tr><tr><td><p>  Sobel </p><br></td><td><p>  5.463000 </p><br></td><td><p>  7.197000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td rowspan="2"><p>  0.000000 </p><br></td></tr><tr><td><p>  Convertscale </p><br></td><td><p>  5,139,000 </p><br></td><td><p>  6.044000 </p><br></td><td><p>  <strong>-</strong> </p><br></td></tr><tr><td><p>  Adaptive threshold </p><br></td><td><p>  89.986000 </p><br></td><td><p>  33.231000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvMulSpectrums </p><br></td><td><p>  91.865000 </p><br></td><td><p>  15.221000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td rowspan="3"><p>  0.086427 </p><br></td></tr><tr><td><p>  cvDFT </p><br></td><td><p>  597.131000 </p><br></td><td><p>  99.666000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  cvNormalize </p><br></td><td><p>  57.318000 </p><br></td><td><p>  13.576000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  cvSmooth </p><br></td><td><p>  109.345000 </p><br></td><td><p>  57.467000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  1771.619316 </p><br></td></tr><tr><td><p>  HoughLines2D </p><br></td><td><p>  2314.028000 </p><br></td><td><p>  634.262000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  46306.904723 </p><br></td></tr><tr><td><p>  cvCornerHarris </p><br></td><td><p>  653.550000 </p><br></td><td><p>  168.213000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  0.136828 </p><br></td></tr><tr><td><p>  cvCornerEigenValsAndVecs </p><br></td><td><p>  3430.892000 </p><br></td><td><p>  870.525000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  350.751214 </p><br></td></tr><tr><td><p>  cvCornerMinEigenVal </p><br></td><td><p>  1384.182000 </p><br></td><td><p>  1.155000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  - </p><br></td></tr><tr><td><p>  cvMulSpectrums </p><br></td><td><p>  91.711000 </p><br></td><td><p>  15.323000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td rowspan="3"><p>  0.086427 </p><br></td></tr><tr><td><p>  cvDFT </p><br></td><td><p>  597.707000 </p><br></td><td><p>  99.412000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  cvNormalize </p><br></td><td><p>  58.782000 </p><br></td><td><p>  13.751000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  GoodFeaturesToTrack </p><br></td><td><p>  1259.277000 </p><br></td><td><p>  279.508000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td rowspan="2"><p>  - </p><br></td></tr><tr><td><p>  FindCornerSubPix </p><br></td><td><p>  - </p><br></td><td><p>  449.029000 </p><br></td><td><p></p><br></td></tr><tr><td><p>  cvMatchTemplate </p><br></td><td><p>  1576.569000 </p><br></td><td><p>  221.753000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  3.741657 </p><br></td></tr><tr><td><p>  cvThreshold </p><br></td><td><p>  2.182000 </p><br></td><td><p>  4.442000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td><p>  0.000000 </p><br></td></tr><tr><td><p>  cvBoundingRect </p><br></td><td><p>  0.036000 </p><br></td><td><p>  0.302000 </p><br></td><td><p>  <strong>-</strong> </p><br></td><td rowspan="4"><p>  The difference between the resulting areas - 0.000000 </p><br></td></tr><tr><td><p>  cvDrawContour </p><br></td><td><p>  0.030000 </p><br></td><td><p>  0.989000 </p><br></td><td><p>  <strong>-</strong> </p><br></td></tr><tr><td><p>  cvContourArea </p><br></td><td><p>  0.049000 </p><br></td><td><p>  0.231000 </p><br></td><td><p>  <strong>-</strong> </p><br></td></tr><tr><td><p>  Plotting </p><br></td><td><p>  - </p><br></td><td><p>  183.243000 </p><br></td><td><p></p><br></td></tr><tr><td><p>  Cvtcolor </p><br></td><td><p>  16.283000 </p><br></td><td><p>  13.804000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td rowspan="2"><p>  0.000000 </p><br></td></tr><tr><td><p>  Resize </p><br></td><td><p>  18.357000 </p><br></td><td><p>  17.617000 </p><br></td><td><p>  <strong>+</strong> </p><br></td></tr><tr><td><p>  cvCalcOpticalFlowPyrLK </p><br></td><td><p>  2472.993000 </p><br></td><td><p>  146.874000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  Both results consist of 445 features. </p><br></td></tr><tr><td><p>  HaarDetectObjects </p><br></td><td><p>  2522.499000 </p><br></td><td><p>  460.350000 </p><br></td><td><p>  <strong>+</strong> </p><br></td><td><p>  Both results consist of 5 elements. </p><br><p>  ARM: </p><br><p>  0: 46, 48 (42x42) </p><br><p>  1: 174, 48 (37x37) </p><br><p>  2: 240, 51 (38x38) </p><br><p>  3: 110, 48 (40x40) </p><br><p>  4: 92, 37 (131x131) </p><br><p>  DSP: </p><br><p>  0 47, 49 (40x40) </p><br><p>  1: 175, 49 (35x35) </p><br><p>  2: 240, 52 (37x37) </p><br><p>  3:17, 198 (34x34) </p><br><p>  4: 110, 48 (38x38) </p><br></td></tr></tbody></table><br></div></div><br>  Based on the results, conclusions can be drawn: <br><ul><li>  Some functions have a difference between the results of execution.  The architecture of signal processors, as compared with general-purpose microprocessors, has some peculiarities associated with the desire to speed up the execution of typical DSP tasks.  DSPs are focused, first of all, on the multiple execution of multiplication with the calculation on the fly of addresses of the multiplied elements of the arrays.  An algorithm implemented in various basic operations can produce different results. </li><li>  Not all functions work faster on DSP than on ARM.  One can notice a pattern: these are functions of basic operations on matrices or functions that consist mainly of them.  Such ‚Äúbad‚Äù functions can be performed on the ARM, while others are carried on the DSP.  In the event of an overload of the ARM processor, the use of some ‚Äúbad‚Äù functions on the DSP can be tolerated. </li><li>  When using the "good" function on the DSP, you can achieve improvements by several times and even more than an order of magnitude.  These are usually the most time consuming functions. </li></ul><br>  Thus, balancing between speed, processor load and execution results can significantly optimize application performance. <br><br>  Useful links: <br><ol><li>  <a href="http://www.ti.com/tool/tmdxevm8168">DM816x / C6A816x / AM389x board</a> </li><li>  <a href="http://processors.wiki.ti.com/index.php/DM816x_AM389x_PSP_U-Boot">Download DM816x</a> </li><li>  <a href="http://downloads.ti.com/dsps/dsps_public_sw/ezsdk/latest/exports/DM816x_EZ_Software_Developers_Guide.pdf">EZSDK User Guide</a> </li><li>  <a href="http://processors.wiki.ti.com/index.php/C6EZAccel">C6Accel framework</a> </li><li>  <a href="http://www.cs.haifa.ac.il/~dkeren/ip/OReilly-LearningOpenCV.pdf">A good book on OpenCV</a> + <a href="http://locv.ru/">partial translation into Russian</a> </li><li>  <a href="http://www.ti.com/lit/wp/spry175/spry175.pdf">Article on the use of OpenCV on ARM and DSP processors</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/248591/">https://habr.com/ru/post/248591/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248581/index.html">(Kiev) On January 28-30, the course ‚ÄúIntroduction to OpenStack. Basics</a></li>
<li><a href="../248583/index.html">(Kiev) February 16-17, the course "Infrastructure Management through HP OneView"</a></li>
<li><a href="../248585/index.html">Simple container</a></li>
<li><a href="../248587/index.html">Reports for NORD POS. Part 2</a></li>
<li><a href="../248589/index.html">The first step on the path to daily planning, or where does the meat grinder?</a></li>
<li><a href="../248593/index.html">Opensource lifeguard for cats, dogs and other animals in PHP</a></li>
<li><a href="../248597/index.html">Parsing the Microsoft Office localization file format</a></li>
<li><a href="../248599/index.html">"Durov, return the wall" or "Habrahabr + Geektimes + Megamind" in one tape</a></li>
<li><a href="../248601/index.html">Lovers of Ruby and Coffeescript - another bike?</a></li>
<li><a href="../248605/index.html">Piloting cloud-based MongoDB via VanillaJS or how to make a private todo list for 15 minutes for free</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>