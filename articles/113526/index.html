<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interactive map of the Arduino or in the footsteps of the "Admin Traffic Light"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a system administrator working for an Internet provider, very often there is the task of monitoring a large number of active equipment. Of course,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interactive map of the Arduino or in the footsteps of the "Admin Traffic Light"</h1><div class="post__text post__text-html js-mediator-article">  For a system administrator working for an Internet provider, very often there is the task of monitoring a large number of active equipment.  Of course, nagios, cacti, zabbix and similar monitoring tools can be used for these purposes.  But they all have one major drawback - you must use the browser as a means of displaying the status of monitored network nodes. <br>  Acquainted with the <a href="http://robocraft.ru/blog/239.html">"admin traffic light"</a> the idea of ‚Äã‚Äãcreating an interactive map of the city, with LEDs located on it: red - the node is unavailable, green - available.  But if you use the described method of ignition of LEDs, you will need 2 xn, where n is the number of controlled nodes.  Thus, to control 10 nodes, 20 pins will be needed.  It is clear that this method for solving the problem, in the case of controlling more than 5 nodes, is not suitable. <br><a name="habracut"></a><br>  So, how can you reduce the number of outputs used?  From the go to the head comes the use of the decoder.  The method is good, but you need to invent your cipher, in which you need to take into account all possible combinations of the work of controlled nodes.  The method is good, but not very scalable. <br>  More successful is the method of converting a serial signal into a parallel one.  That is, a serial signal goes from the arduino board, and the LED control is already implemented in the additional circuit.  Go this way and go. <br>  And so we need: <br><ul><li>  develop a scheme for converting a serial signal into a parallel one; </li><li>  create an output stage with LEDs to display the status; </li><li>  develop an algorithm for recording the necessary information in the scheme; </li><li>  implement a network node polling algorithm. </li></ul><br><br><h5>  Circuit design </h5><br>  To convert a serial signal, we will use a shift register.  At hand was a couple of 74ALS164, so we use them.  First of all, we stamp on the manufacturer's website and download the <a href="http://www.datasheetcatalog.com/datasheets_pdf/7/4/A/L/74ALS164.shtml">datasheet</a> .  This register has: <br><ul><li>  CLR reset input; </li><li>  CLK clock input; </li><li>  2 signal inputs A and B; </li><li>  8 outputs. </li></ul><br>  The truth table shows that a reset occurs when the value of the input CLR is zero.  Data is written to the register at the front of the CLK signal.  The input signal is generated from signals A and B through a logical multiplication (I).  Thus, one of the signal inputs, for example B, can be safely brought to the logic level 1. During operation, the presence of a logic unit level at the CLR input is necessary.  By controlling the input A you can enter the necessary information in the register.  Gating at the CLK input will allow for unambiguous input and output data. <br>  But if we use only 1 microcircuit, then we have only 8 outputs.  Yes, not a lot.  But then cascading comes to the rescue.  That is, if we connect the eighth output of the first register with the input A of the second, then the data will be entered into the second register with a delay of 8 cycles. <br><br><h5>  Output stage </h5><br>  To control the LEDs, you can use 2 outputs per node, that is, light a red LED or green.  But in this case there will be a doubling of the number of registers needed.  To avoid this we will use the inclusion of LEDs according to the scheme: <br><img src="https://habrastorage.org/storage/habraeffect/d7/65/d765e636bba4b87cacf354149a8143ae.png" alt="image"><br>  In this case, it will be necessary to select the resistance values ‚Äã‚Äãof the resistors for a suitable LED glow in cases of red and green LEDs. <br>  After distributing and soldering the following has turned out: <br><img src="https://habrastorage.org/storage/habraeffect/aa/80/aa807687c8aae9ceace9ae78dc61c38d.jpg" alt="image"><br>  There are 2 shift registers and 10 pairs of LEDs on the debug board.  Unfortunately, 4 yellow LEDs in the center of the board are off, very similar to broken register outputs, but enough for debugging. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Write algorithm development </h5><br>  So we have a control circuit for burning LEDs.  It is necessary to organize the switching of burning from red to green and back, in any order of registers.  An array of bits will be used for this, each bit corresponds to one node and two LEDs: 1 is green and 0 is red.  By feeding this sequence of bits to the output of the arduino and clocking each bit with the output CLK, we will write to the registers.  To ensure uniqueness, we will reset the registers before each recording of the information by applying a logical zero to the CLR input. <br><br><h5>  Development of the polling node algorithm </h5><br>  The basis of the code from the "admin traffic light", but does not measure the connection time, but only the fact that it is installed or not installed.  A two-dimensional array of node addresses and an array of output data will be used, which will be entered into registers.  For ease of debugging, we will check only 5 nodes. <br><br>  The code is quite simple and with comments: <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//   #define SIG 7 //  #define CLK 6 //  #define RST 5 //  //    #include &lt;SPI.h&gt; #include &lt;Ethernet.h&gt; //  ethernet shield byte mac[] = {0xDE, 0xAD, 0xBE, 0xEF, 0xFE, 0xED}; //   byte ip[] = {192,168,2,177}; // ip  //     byte pingAddr[][4] = { {172,2,0,5}, {172,2,0,6}, {172,2,0,7}, {172,2,0,8}, {172,2,0,9} }; //    bool out[] = {0,0,0,0,0}; //    byte gateway[] = {192,168,2,1}; byte subnet[] = {255,255,255,0}; //    char buffer[256]; //     void checkHost(int i) { Client client(pingAddr[i], 80); //     if(!client.connect()) { //     sprintf(buffer, "Connection failed for %d.%d.%d.%d", pingAddr[i][0],pingAddr[i][1],pingAddr[i][2],pingAddr[i][3]); Serial.println(buffer); //     ,     if(out[i] == 1) { out[i] = 0; //      setMap(); } //    } else { //   ,    if(out[i] == 0) { out[i] = 1; setMap(); } } client.stop(); } //     void setMap() { //    digitalWrite(RST, LOW); delay(5); digitalWrite(RST, HIGH); int i; //    for(i=0;i&lt;5;i++) { //  0    if(out[i]==0) digitalWrite(SIG, LOW); //  1   else digitalWrite(SIG, HIGH); //      delay(1); //    digitalWrite(CLK, HIGH); delay(1); digitalWrite(CLK, LOW); //       digitalWrite(SIG, LOW); } } void setup() { //  ethernet shield Ethernet.begin(mac, ip, gateway, subnet); //   Serial.begin(9600); //   / pinMode(SIG, OUTPUT); // signal pinMode(CLK, OUTPUT); // CLK pinMode(RST, OUTPUT); // reset //    digitalWrite(CLK, LOW); digitalWrite(SIG, LOW); digitalWrite(RST, HIGH); } //   void loop() { int i; //      for(i=0;i&lt;5;i++){ //   checkHost(i); delay(1000); } //  5 ,    delay(5000); }</span></span></code> </pre> <br><br>  That's all. <br>  Now it remains to find the right size map of the city, attach the LEDs in the right places and monitor the availability of nodes in real time and not getting up. </div><p>Source: <a href="https://habr.com/ru/post/113526/">https://habr.com/ru/post/113526/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113520/index.html">What happened to Opera Mini?</a></li>
<li><a href="../113521/index.html">Not exactly a facebook phone</a></li>
<li><a href="../113523/index.html">Oracle Essbase 9 - installation and configuration</a></li>
<li><a href="../113524/index.html">Easter egg, konami code and arkanoid</a></li>
<li><a href="../113525/index.html">OMON in IT companies in Ukraine. Today came to Global Logic</a></li>
<li><a href="../113530/index.html">Internet Explorer 9 RC released</a></li>
<li><a href="../113531/index.html">Monitoring consultants in the online store</a></li>
<li><a href="../113532/index.html">Dollar Rate Expansion - Triple Dollar Rate</a></li>
<li><a href="../113534/index.html">New York is stuffed with sensors</a></li>
<li><a href="../113535/index.html">Introduction to Renderscript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>