<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are friends with C # and OpenOffice.org</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Do not judge strictly, this is my first article 

 We set the task at work - to write a budget version for my program (previously MS Office was used f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are friends with C # and OpenOffice.org</h1><div class="post__text post__text-html js-mediator-article">  Do not judge strictly, this is my first article <br><br>  We set the task at work - to write a budget version for my program (previously MS Office was used for reports).  He was very puzzled due to the lack of materials on this topic, since all the materials are scattered across different blogs, and they are mostly in English.  Today I decided to share my, albeit a little experience in this issue. <br><a name="habracut"></a><br>  The first thing we need to ‚Äúreunite‚Äù C # and OOo3 are the ‚ÄúCLI _ *. Dll‚Äù libraries for our program to work with OpenOffice.org.  In OpenOffice.org 2, they are shipped and installed together by the office, in the 3rd distribution, they are not installed.  So we take and pull them out (all CLI _ *. Dll libraries) with pens from the [openofficeorg1.cab] OOo3 archive (during installation, all the archives are extracted to the location you choose), add them to your project's References.  When adding it is important to note the values ‚Äã‚Äãfor each Copy Local and Specific Version library to false! <br>  Also on this ‚Äútorment‚Äù with OOo3 does not end.  Next, some OOo3-specific code: <br>  List of namespaces: <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">using</font> System; <br> <font color="#0000ff">using</font> System.Collections. <font color="#2B91AF">Generic</font> ; <br> <font color="#0000ff">using</font> System.Text; <br> <font color="#0000ff">using</font> System.Drawing; <br> <font color="#0000ff">using</font> System.IO; <br> <br> <font color="#008000">//OOo 3</font> <br> <font color="#0000ff">using</font> unoidl.com.sun.star.lang; <br> <font color="#0000ff">using</font> UNO = unoidl.com.sun.star.uno; <br> <font color="#0000ff">using</font> unoidl.com.sun.star.bridge; <br> <font color="#0000ff">using</font> unoidl.com.sun.star.frame; <br> <font color="#0000ff">using</font> OOo = unoidl.com.sun.star; <br> <br> <font color="#0000ff">using</font> Microsoft.Win32; <br> <font color="#0000ff">using</font> System.Runtime.InteropServices;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> InitOO3Env() <br> { <br> <font color="#0000ff">string</font> baseKey = <font color="#A31515">""</font> ; <br> <br> <font color="#0000ff">if</font> (Marshal.SizeOf( <font color="#0000ff">typeof</font> ( <font color="#2B91AF">IntPtr</font> )) == 8) baseKey = <font color="#A31515">@"SOFTWARE\Wow6432Node\OpenOffice.org\"</font> ; <br> <font color="#0000ff">else</font> <br> baseKey = <font color="#A31515">@"SOFTWARE\OpenOffice.org\"</font> ; <br> <br> <font color="#008000">// Get the URE directory</font> <br> <font color="#0000ff">string</font> key = baseKey + <font color="#A31515">@"Layers\URE\1"</font> ; <br> RegistryKey reg = Registry.CurrentUser.OpenSubKey(key); <br> <font color="#0000ff">if</font> (reg == <font color="#0000ff">null</font> ) reg = Registry.LocalMachine.OpenSubKey(key); <br> <font color="#0000ff">string</font> urePath = reg.GetValue( <font color="#A31515">"UREINSTALLLOCATION"</font> ) <font color="#0000ff">as</font> <font color="#0000ff">string</font> ; <br> reg.Close(); <br> urePath = Path.Combine(urePath, <font color="#A31515">"bin"</font> ); <br> <br> <font color="#008000">// Get the UNO Path</font> <br> key = baseKey + <font color="#A31515">@"UNO\InstallPath"</font> ; <br> reg = Registry.CurrentUser.OpenSubKey(key); <br> <font color="#0000ff">if</font> (reg == <font color="#0000ff">null</font> ) reg = Registry.LocalMachine.OpenSubKey(key); <br> <font color="#0000ff">string</font> unoPath = reg.GetValue( <font color="#0000ff">null</font> ) <font color="#0000ff">as</font> <font color="#0000ff">string</font> ; <br> reg.Close(); <br> <br> <font color="#0000ff">string</font> path; <br> <br> <font color="#0000ff">string</font> sysPath = System.Environment.GetEnvironmentVariable( <font color="#A31515">"PATH"</font> ); <br> path = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0};{1}"</font> , System.Environment.GetEnvironmentVariable( <font color="#A31515">"PATH"</font> ), urePath); <br> System.Environment.SetEnvironmentVariable( <font color="#A31515">"PATH"</font> , path); <br> System.Environment.SetEnvironmentVariable( <font color="#A31515">"UNO_PATH"</font> , unoPath); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  The code above performs the so-called ‚Äúinitialization‚Äù of OOo3 (sets the environment variables for OOo3).  ‚ÄúInitialization‚Äù should be performed every time the program is started, since the PATH variable is not saved. <br><br>  Now it is possible to work with OOo (for version 2 and higher [Versions haven‚Äôt been tried before simply]): <br><blockquote> <code><font color="black"><font color="#008000">//  ?</font> <br> <font color="#0000ff">private</font> <font color="#0000ff">bool</font> isOOoInstalled() <br> { <br> <font color="#0000ff">string</font> baseKey; <br> <font color="#008000">//  64  </font> <br> <font color="#0000ff">if</font> (Marshal.SizeOf( <font color="#0000ff">typeof</font> ( <font color="#2B91AF">IntPtr</font> )) == 8) baseKey = <font color="#A31515">@"SOFTWARE\Wow6432Node\OpenOffice.org\"</font> ; <br> <font color="#0000ff">else</font> <br> baseKey = <font color="#A31515">@"SOFTWARE\OpenOffice.org\"</font> ; <br> <font color="#0000ff">string</font> key = baseKey + <font color="#A31515">@"Layers\URE\1"</font> ; <br> RegistryKey reg = Registry.CurrentUser.OpenSubKey(key); <br> <font color="#0000ff">if</font> (reg == <font color="#0000ff">null</font> ) reg = Registry.LocalMachine.OpenSubKey(key); <br> <font color="#0000ff">string</font> urePath = reg.GetValue( <font color="#A31515">"UREINSTALLLOCATION"</font> ) <font color="#0000ff">as</font> <font color="#0000ff">string</font> ; <br> reg.Close(); <br> <font color="#0000ff">if</font> (urePath != <font color="#0000ff">null</font> ) <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">false</font> ; <br> } <br> <font color="#008000">//   (  \  )</font> <br> <font color="#0000ff">private</font> OOo.lang.XMultiServiceFactory uno_connect( <font color="#2B91AF">String</font> [] args) <br> { <br> InitOO3Env(); <br> unoidl.com.sun.star.uno.XComponentContext m_xContext m_xContext = uno.util.Bootstrap.bootstrap(); <br> <font color="#0000ff">if</font> (m_xContext != <font color="#0000ff">null</font> ) <br> <font color="#0000ff">return</font> (OOo.lang.XMultiServiceFactory)m_xContext.getServiceManager(); <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> <font color="#0000ff">null</font> ; <br> } <br> <font color="#008000">// \   Calc</font></font> <br> <font color="#0000ff">private</font> unoidl.com.sun.star.sheet.XSpreadsheetDocument OOo3_initCalcDocument( <font color="#0000ff">string</font> filePath, <font color="#0000ff">bool</font> newDoc) <br> { <br> <br> XComponentLoader aLoader; <br> XComponent xComponent = <font color="#0000ff">null</font> ; <br> <font color="#0000ff">string</font> url = newDoc ? <font color="#A31515">"private:factory/scalc"</font> : <font color="#A31515">@"file:///"</font> + filePath.Replace( <font color="#A31515">@"\"</font> , <font color="#A31515">@"/"</font> ); <br> <font color="#0000ff">try</font> <br> { <br> aLoader = (XComponentLoader) <br> mxMSFactory.createInstance( <font color="#A31515">"com.sun.star.frame.Desktop"</font> ); <br> <br> xComponent = aLoader.loadComponentFromURL( <br> <font color="#008000">/*"private:factory/scalc"*/</font> url, <font color="#A31515">"_blank"</font> , 0, <br> <font color="#0000ff">new</font> unoidl.com.sun.star.beans.PropertyValue[0]); <br> } <br> <font color="#0000ff">catch</font> (Exception ex) <br> { <br> MessageBox.Show(ex.Message); <br> } <br> <font color="#0000ff">return</font> (OOo.sheet.XSpreadsheetDocument)xComponent; <br> <br> } <br> <br> <font color="#008000">// \   Writer</font></code> <br>  <font color="#0000ff">private</font> OOo.text.XTextDocument OOo3_initWriterDocument ( <font color="#0000ff">string</font> filePath, <font color="#0000ff">bool</font> newDoc) <br>  { <br><br>  XComponentLoader aLoader; <br>  XComponent xComponent = <font color="#0000ff">null</font> ; <br>  <font color="#0000ff">string</font> url = newDoc?  <font color="#A31515">"Private: factory / swriter"</font> : <font color="#A31515">@ "file: ///"</font> + filePath.Replace ( <font color="#A31515">@ "\"</font> , <font color="#A31515">@ "/"</font> ); <br>  <font color="#0000ff">try</font> <br>  { <br>  aLoader = (XComponentLoader) <br>  mxMSFactory.createInstance ( <font color="#A31515">"com.sun.star.frame.Desktop"</font> ); <br><br>  xComponent = aLoader.loadComponentFromURL ( <br>  url, <font color="#A31515">"_blank"</font> , 0, <br>  <font color="#0000ff">new</font> unoidl.com.sun.star.beans.PropertyValue [0]); <br>  } <br>  <font color="#0000ff">catch</font> (Exception ex) <br>  { <br>  MessageBox.Show (ex.Message); <br>  } <br>  <font color="#0000ff">return</font> (OOo.text.XTextDocument) xComponent; <br>  } </blockquote><br><br>  <font color="gray">* This source code was highlighted with <a href="http://virtser.net/blog/post/source-code-highlighter.aspx"><font color="gray">Source Code Highlighter</font></a> .</font> <br><br>  That's all! </div><p>Source: <a href="https://habr.com/ru/post/49373/">https://habr.com/ru/post/49373/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49359/index.html">Holidays are over, surprises continue ...</a></li>
<li><a href="../49360/index.html">Bottom-up development and database.</a></li>
<li><a href="../49361/index.html">The simplest drawing using PIL</a></li>
<li><a href="../49365/index.html">Design patterns for humans.</a></li>
<li><a href="../49372/index.html">Asus A6R and Ubuntu 8.10</a></li>
<li><a href="../49375/index.html">Goodbye IE6</a></li>
<li><a href="../49376/index.html">Woo, jquery, woo!</a></li>
<li><a href="../49378/index.html">Shorty Awards - Oscar Twitter</a></li>
<li><a href="../49380/index.html">MyOpera - two million users!</a></li>
<li><a href="../49381/index.html">About the blog or "hello everyone!"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>