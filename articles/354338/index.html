<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Miners will not pass</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, or at least stumble. 

 Since the beginning of 2017, our Information Security Monitoring Center sees attempts to mine cryptocurrency on corporat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Miners will not pass</h1><div class="post__text post__text-html js-mediator-article">  Well, or at least stumble. <br><br>  Since the beginning of 2017, our Information Security Monitoring Center sees attempts to mine cryptocurrency on corporate IT resources connected to monitoring.  Well, he sees and sees, why do you want a cue ball, or what? <br><br>  Indeed, and what harm do miners in the corporate network?  What are the threats to the business?  Let's try to figure out and understand how to look for miners and deal with them (if, of course, we decide to do it). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/xv/yr/lp/xvyrlps7t9put8l4urtpbg46ixg.jpeg" alt="image"><br>  <i>Marco Krohn, Creative Commons Attribution-Share Alike 4.0 International</i> <a name="habracut"></a><br><br><h2>  Is it necessary to even catch them </h2><br>  Mining is a strange threat to IB.  At first glance, it is not even clear why he is a threat.  Miner clients do not touch your data, and malicious miners, as a rule, are also not really needed. <br><br>  To analyze the damage done by the miners, I suggest using the <a href="https://en.wikipedia.org/wiki/McCumber_cube">McCumber Cube model</a> .  Since autumn 2017, John McCamber <a href="https://www.isc2.org/News-and-Events/Press-Room/Posts/2017/09/25/ISC2-Names-John-McCumber-Director-of-Cybersecurity-Advocacy">is responsible for the promotion of information security in North America</a> in (ISC) ¬≤ (they are certified on CISSP, SSCP, CCSP, CSSLP and other incomprehensible abbreviations).  Before that, John worked in the USAF and Gartner. <br><br>  McCamber proposed a model that reflects the three main areas of information security. <br><img src="https://habrastorage.org/webt/c0/ag/en/c0agenma9i7vpsiwtk1i7rew320.jpeg" alt="image"><br><br>  <b>Safety goals (Desired goals)</b> <br><br><ul><li>  Confidentiality </li><li>  Integrity </li><li>  Availability </li></ul><br>  <b>Information states</b> <br><br><ul><li>  Broadcast </li><li>  Storage </li><li>  Treatment </li></ul><br>  <b>Safeguards or protective measures (Safeguards)</b> <br><br><ul><li>  Human factor </li><li>  Policies and practices </li><li>  Technology </li></ul><br>  Let's go over the edges of the cube and see how mining affects each. <br><table><tbody><tr><th width="200">  <b>Direction</b> </th><th>  <b>Mining effect</b> </th></tr><tr><td>  Confidentiality </td><td>  Does not break. <br></td></tr><tr><td>  Integrity </td><td>  Does not break. <br></td></tr><tr><td>  Availability </td><td>  Violates, can slow down, but not stop access to information (in this paragraph, the opinions of the reviewers are divided). <br></td></tr><tr><td>  Storage </td><td>  Does not break. </td></tr><tr><td>  Broadcast </td><td>  Network interaction of software with mining pools (or C &amp; C servers in the case of malware operation) loads the channel, and traffic can be expensive (for legal entities sometimes several times more expensive than for individuals) or limited. </td></tr><tr><td>  Treatment </td><td>  If the miner completely utilizes the resources of the hardware (and this is an alarm and suspicious), users will observe delays when working with data.  A typical situation is ‚ÄúWhy are you so stupid, huh ?!‚Äù </td></tr><tr><td>  Policies and practices </td><td>  First, someone enriched at the expense of the company or institution.  For the extraction of the crypt need electricity, which has to pay the company.  Secondly, IT and IS staff are distracted from other tasks, they have to investigate these incidents and respond to them.  Thirdly, there are legal risks for the company, since the legal status of cryptocurrency and its production in Russia <a href="http://sozd.parlament.gov.ru/bill/419059-7">has not yet been determined</a> (on March 20, 2018, the Federal Law Project On Digital Financial Assets was submitted to the State Duma). </td></tr><tr><td>  Human factor </td><td>  If not all employees of a department or team in collusion, then questions arise who put the miner?  Who "laid" a colleague?  They will be followed by claims in the style of ‚ÄúVasya Pupkin constantly monitors exchange rates in order to extract the most profitable, and is not engaged in basic work.  Do I have to rake this pile of applications alone? ‚ÄùBesides, the game of curiosity and greed works well during periods of the peak of the cryptocurrency rate and information noise, so people are more susceptible to attacks by social engineers and phishing. </td></tr><tr><td>  Technology </td><td>  At McCumber, this item is devoted to the assessment of the work of remedies.  Therefore, if we found a miner, then we need to understand how he got into our infrastructure?  Which of the SZI allowed?  What else could get to us in the same way?  This clearly indicates that there are problems or vulnerabilities that you have to deal with.  But I would not call it ‚Äúdamage.‚Äù  Rather, the argument for control. </td></tr></tbody></table><br>  Somehow too many potential problems so that you can simply ignore the mining on your infrastructure.  So, we still catch. <br><br><h2>  How to search </h2><br><h4>  On hosts </h4><br>  Usually, user suspicions appear when the computer suddenly starts to slow down.  First of all, let's check what we have with the processes. <br><br>  For Windows, this can be done using Task Manager (Ctrl + Alt + Del or Ctrl + Shift + Esc), for Mac - <a href="https://support.apple.com/en-us/HT201464">Activity monitor</a> , for "UNIX, Unix-like and other POSIX-compatible operating systems" - <a href="https://ru.wikipedia.org/wiki/Ps">ps</a> . <br><br><img src="https://habrastorage.org/webt/ew/u6/hi/ewu6hifr7_rhreyracdwbd0clha.png" alt="image"><br>  <i>Real DZ, after which the idea to write an article appeared.</i>  <i>But then it turned out, it turned out that several resource-intensive legitimate processes were launched simultaneously.</i> <br><br>  The problem is that some miners have learned how to track the launch of Task Manager.  They stop working while the DZ is open, and then restart themselves.  Alternatively, try <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25B8%25D1%2581%25D0%25BF%25D0%25B5%25D1%2582%25D1%2587%25D0%25B5%25D1%2580_%25D0%25B7%25D0%25B0%25D0%25B4%25D0%25B0%25D1%2587_Windows">alternatives</a> : <br><br><ul><li>  System explorer </li><li>  Process hacker </li><li>  Process lasso </li><li>  Process Explorer ( <a href="https://twitter.com/markrussinovich">hello, Mark</a> !) </li><li>  Process Monitor </li></ul><br>  If we see an unfamiliar or suspicious process, google the name.  If this is something bad, there will almost certainly be instructions on how to remove it, and what to do so that it does not happen again. <br><br>  In this difficult task, oddly enough, the creators of miners themselves can help.  Since for them the main goal is computer computing resources, they do not want to compete for them with other miners.  At the very end of March, security consultant Xavier Mertens ( <a href="https://habr.com/users/xme/" class="user_link">xme</a> ) <a href="https://isc.sans.edu/forums/diary/The%2BCrypto%2BMiners%2BFight%2BFor%2BCPU%2BCycles/23407">discovered code</a> that ‚Äúdampens‚Äù competing mining processes and non-critical OS processes to free up resources for themselves.  The code contains the names of the miner processes: <br><table><tbody><tr><td>  Silence </td><td>  vshell </td><td>  taskhots </td></tr><tr><td>  Carbon </td><td>  winlogan </td><td>  svchostx </td></tr><tr><td>  xmrig32 </td><td>  winlogo </td><td>  xmr86 </td></tr><tr><td>  nscpucnminer64 </td><td>  logon </td><td>  xmrig </td></tr><tr><td>  mrservicehost </td><td>  win1nit </td><td>  xmr </td></tr><tr><td>  servisce </td><td>  wininits </td><td>  win1ogin </td></tr><tr><td>  svchosts3 </td><td>  winlnlts </td><td>  win1ogins </td></tr><tr><td>  svhosts </td><td>  taskngr </td><td>  ccsvchst </td></tr><tr><td>  system64 </td><td>  tasksvr </td><td>  nscpucnminer64 </td></tr><tr><td>  systemiissec </td><td>  mscl </td><td>  update_windows </td></tr><tr><td>  taskhost </td><td>  cpuminer </td><td></td></tr><tr><td>  vrmserver </td><td>  sql31 </td><td></td></tr></tbody></table><br>  If any of these processes are running on the machine, congratulations!  Most likely, you mine for someone.  This is how the creator of the Malvari did part of the research work for us. <br><br><img src="https://habrastorage.org/webt/ye/nj/ul/yenjul7cncbkmpo9ap4vj-gb6fy.jpeg" alt="image"><br><br>  Do not forget about endpoint security systems.  Good antiviruses have learned to catch miners.  The main thing is not to forget in the Settings to tell the antivirus that they should be blocked.  This is not always enabled by default, because the user can consciously download, install and run this software. <br><br>  We go to the site of the anti-virus vendor, download the recovery disk image, write to the media, load from it and check the system.  Long, but not particularly difficult. <br><br>  Everything that was written above refers to the case when the user does not want to have a miner program on his PC.  He is conscious, noticed and informed.  But what if the user wants to mine himself and is not going to tell anyone about this? <br><br><h4>  Online </h4><br>  Of course, there is something to catch and on the net!  I <a href="https://abuse.ch/blog/cybercriminals-taking-advantage-of-cryptocurrency-boom/">came</a> across such an amusing picture: <br><br><img src="https://habrastorage.org/webt/ng/vq/gs/ngvqgs6ova0ajqh1omr3rit3cvo.png" alt="image"><br><br>  Network monitoring is a way to find "irresponsible" users and malicious mining software. <br><br>  What should alert us: <br><br><ul><li>  Visiting sites, forums, board pro mining.  The analysts of our Monitoring Center and colleagues sitting next to me are already looking askance at me). </li><li>  Downloading software for mining, and with the latest news about multiple forks of popular products on a githaba followed by embedding droppers there - in general, any software.  Either forcefully check everything that has flown in (there are commercial solutions that do not send scanned files to the cloud), or ask users to send software distributions, attachments or executable files to Virustotal. </li><li>  Networking nodes with pools to exchange information about the received blocks and hashes. </li></ul><br>  Unfortunately, the latter method works only for well-known miners, domains and IP addresses, provided that the firewalls and network IDS / IPS are correctly configured and timely updated.  Port blocking is a so-called method, because there can be legal activity on these ports. <br><br>  The question arises: where to get the data for detection?  A couple of years ago, I did a large internal research on Threat Intelligence and one of the types of sources called the Community Open Source Threat Exchange (COSTE).  The table below shows their list, the links at the time of this writing were working.  I also removed anti-spam, phishing, and publicly available vulnerability databases from this list. <br><table><tbody><tr><th>  COSTE </th><th>  A country </th></tr><tr><td>  <a href="https://www.abuse.ch/%3Fpage_id%3D3283">Abuse.ch</a> </td><td>  Switzerland </td></tr><tr><td>  <a href="https://www.alienvault.com/open-threat-exchange">AlienVault Open Threat Exchange</a> </td><td>  USA, Spain </td></tr><tr><td>  <a href="http://www.blocklist.de/en/index.html">Blocklist.de</a> </td><td>  Germany </td></tr><tr><td>  <a href="https://github.com/ZeroDot1/CoinBlockerLists">CoinBlockerLists</a> </td><td></td></tr><tr><td>  <a href="http://csirtgadgets.org/collective-intelligence-framework/">Collective Intelligence Framework</a> </td><td>  USA </td></tr><tr><td>  <a href="https://rules.emergingthreats.net/open/snort-2.9.0/rules/emerging-policy.rules">ET-open</a> </td><td></td></tr><tr><td>  <a href="https://github.com/ForensicArtifacts/artifacts">ForensicArtifacts</a> </td><td></td></tr><tr><td>  <a href="https://www.iocbucket.com/">Iocbucket.com</a> </td><td>  USA </td></tr><tr><td>  <a href="http://www.malwaredomains.com/">Malwaredomains</a> </td><td></td></tr><tr><td>  <a href="https://github.com/keraf/NoCoin">NoCoin browser extension blocklist</a> </td><td></td></tr><tr><td>  <a href="https://www.shadowserver.org/wiki/pmwiki.php/Shadowserver/Mission">Shadowserver</a> </td><td></td></tr><tr><td>  <a href="https://www.team-cymru.com/community-services.html">Team cymru</a> </td><td>  USA </td></tr></tbody></table><br>  If you have something to add, write in the comments or in a personal. <br><br>  OK, we: <br><br><ul><li>  found suspicious in traffic; </li><li>  came to a specific site and made sure that the miner works; </li><li>  removed it, using recommendations for a particular VPO; </li><li>  <a href="http://www.forbes.ru/tehnologii/357001-hishchenie-ili-biznes-mozhno-li-uvolit-sotrudnika-za-mayning-kriptovalyut-na">dismissed the</a> <a href="http://www.forbes.ru/tehnologii/354613-pogoreli-na-kripte-kak-nakazyvayut-za-mayning-na-rabochem-meste">employee</a> who mine on our servers; </li><li> and even sent a sample of malware and a traffic dump for analysis to Virustotal or to your favorite vendor. </li></ul><br>  But most often the presence of a miner in the infrastructure says that the problem is not in the miner.  The problem is wider - in people, in managing vulnerabilities, in setting up equipment and GIS.  Removing software, we solve only a specific problem with this instance of software.  And what to do so that the situation does not repeat? <br><br><h2>  How to defend? </h2><br>  <b>Backup and upgrade!</b> <br><br>  All the data below recommendations will work only if the nodes are updated regularly.  Otherwise, all efforts will be similar to the picture from one of <a href="https://habrahabr.ru/company/pm/blog/353112/">our previous articles</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7bd/294/fd0/7bd294fd0b7dca7729dfb86fb31db27f.jpg" alt="image"><br><br><h3>  Network </h3><br>  Thanks to network security tools, we will find traces of mining software in our infrastructure.  Even if these tools work in the detection mode, we will get enough information for further investigation. <br><br>  Many IT and IB administrators do not like to include network protection in blocking mode, for which they have good and understandable reasons related to the availability of services.  Therefore, it would not be possible to recommend blocking by reputation lists at once.  Miner, as a rule, does not threaten your data right at the moment of detection, there is time to figure it out. <br><br>  As another preventive measure, you can segment the network to prevent the ‚Äúhorizontal‚Äù distribution of malware. <br><br><h3>  IaaS </h3><br>  Who has a lot of computing power?  Do cloud providers!  Who will pay for virtualochka?  Provider's customer!  Here is the exciting <a href="https://geektimes.ru/post/247794/">story of almost $ 12,000</a> on a friendly site. <br><br>  To avoid problems: <br><br><ol><li>  Use complex and unique passwords. </li><li>  Configure 2-FA. </li><li>  Reduce to the required minimum the number of admins uchetok. </li><li>  If you pay for the actual consumption of resources, constantly monitor the activity and set up alerts for everyone. </li></ol><br><h4>  Sites </h4><br>  Most likely, you yourself will not suffer from the fact that your site will be placed malicious code, forcing the visitors' machines to extract cryptocurrency for attackers.  Anyway, some time.  Then there is the risk of getting it. <br><br><img src="https://habrastorage.org/webt/mn/tc/5m/mntc5mwcbuws8ounls8aq9l-gai.png" alt="image"><br><br>  and pessimization in search results and reduced attendance. <br><br>  For every popular CMS and platform there <a href="http://lmgtfy.com/%3Fs%3Dd%26q%3Dyour%2BCMS%2Bsecurity%2Bbest%2Bpractices">are security guides</a> .  It would be good to follow them, if possible. <br><br>  Also it is worth checking whether your sites are already infected.  It would be inappropriate to recommend any particular antivirus, read reviews and tips.  I found topics on both the Toaster and Stackoverflow. <br><br>  There is a good article <a href="https://www.zscaler.com/blogs/research/cryptomining-here-stay-enterprise">about mining on machines visitors sites</a> . <br><br><h4>  Custom AWP </h4><br>  As usual, humans are the biggest problem.  To be honest, I don‚Äôt know how to reliably catch a sysadmin or a security guard if he wants (well, he really wants to, decisively!) To mine at work.  All methods resemble crutches. <br><br><ul><li>  <i>Why do we have more electricity bills?</i>  <i>- Well, spring, air conditioners included.</i> </li><li>  <i>And what is this new box in the rack?</i>  <i>- Special equipment for compliance.</i>  <i>Don't ask such silly questions anymore.</i> </li><li>  <i>Let's keep logs of all admin actions!</i>  <i>- Will the same administrators view them?</i> </li></ul><br>  But a few recommendations can still be given. <br><br>  First, it‚Äôs worth explaining the damage to mining for the company.  As a cheat sheet, you can use the section about the McCumber Cube. <br><br>  Secondly, in the employment contract it is necessary to prescribe a ban on the use of corporate IT resources for personal purposes.  There will be at least some argument in a dispute with a careless employee. <br><br>  Thirdly, if the fact of mining was confirmed, one should understand the motives of the person.  Money is tight?  Did not know what can punish?  Was it just interesting to try?  This may not solve the peacefully specific situation, but it will show what you should pay attention to in the future. <br><br>  And you can just decide that mining is quite a business and start mining crypt on an industrial scale.  You can not fight - lead! <br><br>  And finally, keep mayndkart about everything written. <br><br><img src="https://habrastorage.org/webt/af/ct/qp/afctqpkmjcvomyb-b4tkccqpsq0.png" alt="image"><br>  <a href="">Original size</a> . <br><br><h2>  Bonus </h2><br>  Colleagues told another absolutely non-technical way to identify miners-employees - "The server room suddenly became clean."  Admins for quite a long time "cool" belonged to the order in the server, and suddenly she began to shine clean.  There was no apparent reason for such a sharp change of mood.  And the monitoring of several servers showed a flat, almost one hundred percent load. </div><p>Source: <a href="https://habr.com/ru/post/354338/">https://habr.com/ru/post/354338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354326/index.html">Using the MVC pattern when designing the tableview</a></li>
<li><a href="../354328/index.html">HOPE X. Conference "Breaking the elevator: from the basement to the penthouse." Part 1. "Elevator equipment"</a></li>
<li><a href="../354332/index.html">Edimax Office1-2-3 and what it is eaten with</a></li>
<li><a href="../354334/index.html">How we build DevOps in a team of 125 developers</a></li>
<li><a href="../354336/index.html">Technical diary: the second half year of the development of a new mobile PvP</a></li>
<li><a href="../354340/index.html">We increase the disk mass without steroids. Overview of the Western Digital Ultrastar Data102 102 Disk Shelf and Storage Configuration</a></li>
<li><a href="../354342/index.html">Internship for atypical programmers</a></li>
<li><a href="../354344/index.html">Quest to eliminate heart arrhythmia</a></li>
<li><a href="../354346/index.html">HR Meetup. How to survive the explosive growth of the IT team</a></li>
<li><a href="../354348/index.html">Development of load scripts for browser / mobile games. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>