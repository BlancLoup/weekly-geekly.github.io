<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>KnockoutJS: a tale about how to easily accept or reject changes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Quite often in the user interface there are buttons "Save" and "Cancel". Especially often these buttons are used in forms. Despite the fact that in th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>KnockoutJS: a tale about how to easily accept or reject changes</h1><div class="post__text post__text-html js-mediator-article">  Quite often in the user interface there are buttons "Save" and "Cancel".  Especially often these buttons are used in forms.  Despite the fact that in the modern world everything is going to simplify the interface, there is still a demand for these buttons. <br><br>  Today, I propose to understand how to use KnockoutJS to accept and roll back changes for individual observables as well as whole view models. <br><br>  Those familiar with KnockoutJS can immediately give two links to the best blog about the subject <br><ul><li>  <a href="http://www.knockmeout.net/2011/05/creating-smart-dirty-flag-in-knockoutjs.html">Creating smart dirty flag in KnockoutKS</a> </li><li>  <a href="http://www.knockmeout.net/2011/03/guard-your-model-accept-or-cancel-edits.html">Guard your model accept or cancel edits</a> </li></ul><br>  These methods have both advantages and quite significant shortcomings, from which it is necessary to get rid of.  Disadvantages from a functional point of view <br><ul><li>  Dirty flag - does not allow saving changes, but only resetting them to the initial state. </li><li>  protectedObservable - no one sees observable changes until commit occurs.  This restriction is very depressing when using dependent observables, for example. </li></ul><br>  Well, besides, they are aimed at individual observables, and I would like to work with several fields at once. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Under the cut we will examine in detail the process of creating a simple mechanism that will make the work with the acceptance and cancellation of changes simple and transparent. <br><br><a name="habracut"></a><br><br>  The first thing that comes to my mind when it comes to making or canceling changes is transactions and their implementation in a DBMS.  Before the change, begin transaction, and then commit or rollback.  Everything is simple and clear. <br><br>  Nothing prevents us from making an analogue of these methods from observables.  You can simply do and invent your <code>ko.transactionableObservable</code> by analogy with examples from the beginning of the article. <br><br><pre> <code class="hljs actionscript">ko.transactionableObservable = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(initialValue)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> result = ko.observable(initialValue); result.beginTransaction = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }; result.commit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }; result.rollback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = ko.transactionableObservable(<span class="hljs-string"><span class="hljs-string">'habrauser'</span></span>);</code> </pre><br><br>  But I absolutely do not like this approach.  As you can see, the result will be the usual observable.  And how should we be if we want to accept / cancel observableArray or writeable dependentObservable changes? <br><br>  We are come to the aid of <a href="http://knockoutjs.com/documentation/extenders.html">extenders</a> , which appeared in the second version of the Knockout. <br><br>  The extender allows you to change or add to the behavior of any kind of observables in a very elegant way.  Our code should look like this: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> name = ko.observable(<span class="hljs-string"><span class="hljs-string">'habrauser'</span></span>).extend({editable: <span class="hljs-literal"><span class="hljs-literal">true</span></span>});</code> </pre><br><br>  Implementing extenders to disgrace is simple: <br> <code>ko.extenders['myExtender'] = function(observavle, params){}</code> <br> <br>  The idea seems worthwhile to me, so let's make a simple implementation of our extender. <br><br><pre> <code class="hljs lua">ko.extenders[<span class="hljs-string"><span class="hljs-string">'editable'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target)</span></span></span></span> { var oldValue; var inTransaction = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; target.beginEdit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var currentValue = target(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentValue instanceof Array) { currentValue = currentValue.slice(); // make copy } oldValue = currentValue; inTransaction = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }; target.commit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { inTransaction = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }; target.rollback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inTransaction) { target(oldValue); inTransaction = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target; };</code> </pre><br><br>  I think that there is no sense to translate the code into Russian.  The only caveat is working with arrays. <br>  If there is an array inside the observable, we cannot simply ‚Äúremember‚Äù this value.  Since this is a reference data type, we need to remember a copy of the array, not a reference to it.  And yes, only observables containing non-reference data types make sense to expand.  We will deal with this problem later. <br><br>  Example of use: <br><pre> <code class="hljs pgsql">var <span class="hljs-type"><span class="hljs-type">name</span></span> = ko.observable().extend({editable: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>}); var nameLength = ko.dependentObservable(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>() ? <span class="hljs-type"><span class="hljs-type">name</span></span>().length : <span class="hljs-number"><span class="hljs-number">0</span></span>; }); <span class="hljs-type"><span class="hljs-type">name</span></span>(<span class="hljs-string"><span class="hljs-string">'user'</span></span>); // <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'user'</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>.beginEdit(); // <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> transaciton <span class="hljs-type"><span class="hljs-type">name</span></span>(<span class="hljs-string"><span class="hljs-string">'me'</span></span>); // <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'me'</span></span>, nameLength was recalculated nameLength(); // gives us <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>(); // <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> commited; <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> are unchanged since last edit; we could <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> another one <span class="hljs-type"><span class="hljs-type">name</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span>(); // <span class="hljs-keyword"><span class="hljs-keyword">nothing</span></span> happens since transation <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> commited <span class="hljs-type"><span class="hljs-type">name</span></span>.beginEdit(); // <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> another <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>(<span class="hljs-string"><span class="hljs-string">'someone'</span></span>); // <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-string"><span class="hljs-string">'someone'</span></span>, nameLength was recalculated <span class="hljs-type"><span class="hljs-type">name</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span>(); // <span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span> <span class="hljs-keyword"><span class="hljs-keyword">transaction</span></span>; <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> initial <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-string"><span class="hljs-string">'me'</span></span>, nameLength recalculated <span class="hljs-type"><span class="hljs-type">name</span></span>(); // <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-string"><span class="hljs-string">'me'</span></span></code> </pre><br><br>  It would also be great to have a flag having a change.  The principle is simple: <br><pre> <code class="hljs actionscript">target.hasChanges = ko.dependedObservable(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hasChanges = inTransaction &amp;&amp; oldValue != target(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasChanges; });</code> </pre><br><br>  The output should receive true only when there is an open transaction and the current knowledge is different from the initial one at the time the transaction starts.  We recall that knockout recalculates the value dependentObservable when changing any of the observables that it uses. <br><br>  In the current implementation, the return will always be false.  And the reason for this is very simple: during the first execution (that is, immediately after the declaration) inTransaction == false, which means the second check of the AND operator will not even be executed.  This means that dependendObservable will never be recalculated.  Fix it easy enough.  Make the variable <code>inTransaction</code> "observable." <br><br>  Thus, the value will be recalculated when entering / exiting the transaction and changing the original observable.  This is what you need! <br><br><pre> <code class="hljs lua">ko.extenders[<span class="hljs-string"><span class="hljs-string">'editable'</span></span>] = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(target)</span></span></span></span> { var oldValue; var inTransaction = ko.observable(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); target.beginEdit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var currentValue = target(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentValue instanceof Array) { currentValue = currentValue.slice(); // make copy } oldValue = currentValue; inTransaction(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); }; target.commit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { inTransaction(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }; target.rollback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inTransaction()) { target(oldValue); } }; target.hasChanges = deferredDependentObservable(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { var hasChanges = inTransaction() &amp;&amp; oldValue != target(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hasChanges; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> target; };</code> </pre><br><br>  As for me, we received quite a good implementation for one field.  But what about when we have a dozen fields.  Before editing each field must be done beginEdit (), and then commit / rollback.  You can hang yourself. <br><br>  Due to the fact that we use extenders in our implementation, we can expand the required fields after they are declared and not worry that our dependentObservables from these fields will break.  And this means that we can do it quite automatically. <br>  I will express my thought more down to earth: <br><br><pre> <code class="hljs pgsql">var <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = { firstName : ko.observable(<span class="hljs-string"><span class="hljs-string">'habrauser'</span></span>), lastName: ko.observable(<span class="hljs-string"><span class="hljs-string">'sapiens'</span></span>) }; <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.fullName = ko.dependentObservable(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.firstName() + <span class="hljs-string"><span class="hljs-string">' '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.lastName(); }); ko.editable(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.beginEdit(); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.firstName(<span class="hljs-string"><span class="hljs-string">'homo'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.fullName(); // <span class="hljs-string"><span class="hljs-string">'homo sapiens'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.hasChanges(); // <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>();</code> </pre><br><br>  If at the beginning of the article, we made a specific observable transactional, then now we make an arbitrary object transactional.  By and large, it is implemented quite simply: <br><pre> <code class="hljs actionscript">ko.editable = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(viewModel, autoInit)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> editables = ko.observableArray(); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">makeEditable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(rootObject)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> propertyName <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> rootObject) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> property = rootObject[propertyName]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ko.isWriteableObservable(property)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> observable = property; observable.extend({ editable: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }); editables.push(observable); } property = ko.utils.unwrapObservable(property); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (property) == <span class="hljs-string"><span class="hljs-string">'object'</span></span>) { makeEditable(property); } } })(viewModel); viewModel.beginEdit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ko.utils.arrayForEach(editables(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj)</span></span></span><span class="hljs-function"> </span></span>{ obj.beginEdit(); }); }; viewModel.commit = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ko.utils.arrayForEach(editables(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj)</span></span></span><span class="hljs-function"> </span></span>{ obj.commit(); }); }; viewModel.rollback = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ko.utils.arrayForEach(editables(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(obj)</span></span></span><span class="hljs-function"> </span></span>{ obj.rollback(); }); }; viewModel.addEditable = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(editable)</span></span></span><span class="hljs-function"> </span></span>{ editables.push(editable.extend({ editable: <span class="hljs-literal"><span class="hljs-literal">true</span></span> })); }; viewModel.hasChanges = deferredDependentObservable(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> editableWithChanges = ko.utils.arrayFirst(editables(), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(editable)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> editable.hasChanges(); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> editableWithChanges != <span class="hljs-literal"><span class="hljs-literal">null</span></span>; }); };</code> </pre><br><br>  Only the beginning deserves attention.  We bypass all the properties of the object, if the property is writeableObservable (and only such can be transactional, if you think about it), then we extend it with the help of our extender.  Further along the code, if there is an object in the field (and the array is also an object), then we go through its fields too. <br><br>  And a simple example of use: <br><br><pre> <code class="hljs pgsql">var <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> = { FirstName: ko.observable(<span class="hljs-string"><span class="hljs-string">'Some'</span></span>), LastName: ko.observable(<span class="hljs-string"><span class="hljs-string">'Person'</span></span>), Address: { Country: ko.observable(<span class="hljs-string"><span class="hljs-string">'USA'</span></span>), City: ko.observable(<span class="hljs-string"><span class="hljs-string">'Washington'</span></span>) } }; ko.editable(<span class="hljs-keyword"><span class="hljs-keyword">user</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.beginEdit(); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.FirstName(<span class="hljs-string"><span class="hljs-string">'MyName'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.hasChanges(); // <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> `<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">commit</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.hasChanges(); // <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> `<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.Address.Country(<span class="hljs-string"><span class="hljs-string">'Ukraine'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.hasChanges(); // <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> `<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>` <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">rollback</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>.Address.Country(); // <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> <span class="hljs-string"><span class="hljs-string">'USA'</span></span></code> </pre><br><br>  As a result of our research, we got quite ready for production use the code I posted on GitHub and called ko.editables: <a href="https://github.com/romanych/ko.editables">github.com/romanych/ko.editables</a> <br><br>  There are also examples of <a href="http://romanych.github.com/ko.editables/basic-sample.html">simple</a> use and a <a href="http://romanych.github.com/ko.editables/advanced-sample.html">little more complicated</a> . <br><br>  Thanks to everyone who read to the end.  I hope the code is useful. </div><p>Source: <a href="https://habr.com/ru/post/136782/">https://habr.com/ru/post/136782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136774/index.html">Font Verdana spoiled the film "Mission Impossible"</a></li>
<li><a href="../136778/index.html">HD-video on your computer: CPU, DXVA, Hi10P, players</a></li>
<li><a href="../136779/index.html">History with the transfer of the environment variable. Different versions of msvcrt, UAC</a></li>
<li><a href="../136780/index.html">AMD Radeon HD6850 graphics card, monitor + TV, tearing effect</a></li>
<li><a href="../136781/index.html">Filesonic.com suspended file sharing</a></li>
<li><a href="../136783/index.html">OTA suspension of Nexus S to Android 4 updates: problems and extreme power consumption</a></li>
<li><a href="../136784/index.html">Class-based views - why and how to use</a></li>
<li><a href="../136785/index.html">Data backup in simple language</a></li>
<li><a href="../136786/index.html">Yevgeny Savin: How to improve the Russian innovation ecosystem?</a></li>
<li><a href="../136787/index.html">Theory and Practice of Searching for a Job in Canada (Part 2) - The first step is the hardest</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>