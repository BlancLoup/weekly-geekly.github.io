<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple image editor on VueJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I had the opportunity to write a service for an online store that would help place an order for printing my photos. 

 The service assumed t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple image editor on VueJS</h1><div class="post__text post__text-html js-mediator-article">  Recently, I had the opportunity to write a service for an online store that would help place an order for printing my photos. <br><br>  The service assumed the presence of a ‚Äúsimple‚Äù image editor, the creation of which I would like to share.  And all because among the abundance of all sorts of plug-ins, I did not find the right functionality, and besides, the nuances of CSS transformations, suddenly became a very nontrivial task for me. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/884/ce8/2b3/884ce82b3d7a7c04c28705fd678fa6aa.jpg" alt="image"><br><a name="habracut"></a><br><h3>  Main tasks: </h3><br><ol><li>  The ability to download images from the device, Google Drive and Instagram. </li><li>  Image editing: moving, rotating, flashing horizontally and vertically, zooming, auto-aligning the image to fill the crop area. </li></ol><br>  If the topic turns out to be interesting, in the next post I will describe in detail the integration with Google Drive and Instagram in the backend-part of the application, where the popular bundle NodeJS + Express was used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For the organization of the frontend-a, I chose a wonderful framework Vue.  Just because he inspires me after heavy Angular and annoying React.  I think it makes no sense to describe the architecture, routes and other components, let's go straight to the editor. <br><br>  By the way, you can poke the editor's demo <a href="https://rawgit.com/ihormihal/vue-image-editor/master/public/index.html">here</a> . <br><br>  We need two components: <br><br>  <b>Edit</b> - will contain the main logic and controls <br>  <b>Preview</b> - will be responsible for displaying pictures <br><br><div class="spoiler">  <b class="spoiler_title">Edit component template:</b> <div class="spoiler_text"><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Edit</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Preview</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-if</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ref</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"preview"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:matrix</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"matrix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:image</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"image"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:transform</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transform"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">resized</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"areaResized"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loaded</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageLoaded"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">moved</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"imageMoved"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"range"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:min</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"minZoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:max</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"maxZoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">step</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"any"</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">change</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"onZoomEnd"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">v-model.number</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"transform.zoom"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotateMinus"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Rotate left<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"rotatePlus"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Rotate right<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flipY"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Flip horizontal<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag"> @</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">click</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"flipX"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">:disabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"!imageReady"</span></span></span><span class="hljs-tag">&gt;</span></span>Flip vertical<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">button</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Edit</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br></div></div><br>  The Preview component can trigger 3 events: <br><br>  <i>loaded</i> - image load event <br>  <i>resized</i> - window <i>resizing</i> event <br>  <i>moved</i> - picture move event <br><br>  Options: <br><br>  <i>image</i> - <i>image</i> link <br>  <i>matrix</i> - transformation matrix for CSS transform properties <br>  <i>transform</i> - an object that describes the transformation <br><br>  In order to better control the position of the image, img has absolute positioning, and the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin">transform-origin</a> property, the <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-origin">transformation</a> reference point, is set to the initial value ‚Äú0 0‚Äù, which corresponds to the origin in the upper left corner of the original (before transformation!) Image. <br><br>  The main problem I encountered is that you need to ensure that the transform-origin point is always in the center of the editing area, otherwise, during transformations, the selected part of the image will shift.  This task can be solved using <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/transform-function/matrix">the transformation matrix</a> . <br><br><h3>  Component Edit </h3><br><div class="spoiler">  <b class="spoiler_title">Properties of the Edit Component:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> { <span class="hljs-attr"><span class="hljs-attr">components</span></span>: { Preview }, data () { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">image</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-attr"><span class="hljs-attr">imageReady</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">imageRect</span></span>: {}, <span class="hljs-comment"><span class="hljs-comment">//   areaRect: {}, //   minZoom: 1, //   maxZoom: 1, //   //   transform: { center: { x: 0, y: 0, }, zoom: 1, rotate: 0, flip: false, flop: false, x: 0, y: 0 } } }, computed: { matrix() { let scaleX = this.transform.flop ? -this.transform.zoom : this.transform.zoom; let scaleY = this.transform.flip ? -this.transform.zoom : this.transform.zoom; let tx = this.transform.x; let ty = this.transform.y; const cos = Math.cos(this.transform.rotate * Math.PI / 180); const sin = Math.sin(this.transform.rotate * Math.PI / 180); let a = Math.round(cos)*scaleX; let b = Math.round(sin)*scaleX; let c = -Math.round(sin)*scaleY; let d = Math.round(cos)*scaleY; return { a, b, c, d, tx, ty }; } }, ... }</span></span></code> </pre><br></div></div><br>  The imageRect and areaRect values ‚Äã‚Äãare passed to the Preview component by calling the imageLoaded and areaResized methods, respectively, the objects have the structure: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">size</span></span>: { <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }, <span class="hljs-attr"><span class="hljs-attr">center</span></span>: { <span class="hljs-attr"><span class="hljs-attr">x</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span> } }</code> </pre><br>  The center values ‚Äã‚Äãcould be calculated each time, but it is easier to write them once. <br><br>  The calculated matrix property is the very coefficients of the transformation matrix. <br><br>  The first task that needs to be solved is to center an image with an arbitrary aspect ratio in the cropping area, while the image must be able to fit completely, blank areas (only) above and below, or (only) left and right are valid.  For any transformation, this condition must be maintained. <br><br>  First, we limit the values ‚Äã‚Äãfor zooming, for this we will check the aspect ratio, taking into account the orientation of the image. <br><br><div class="spoiler">  <b class="spoiler_title">Component methods:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> _setMinZoom(){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rotate = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c !== <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> horizontal = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.height &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.width; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> areaSize = (horizontal &amp;&amp; !rotate || !horizontal &amp;&amp; rotate) ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.width : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.height; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> imageSize = horizontal ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.width : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.imageRect.size.height; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom = areaSize/imageSize; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minZoom; }, _setMaxZoom(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.areaRect.size.width/config.image.minResolution; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.zoom = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.maxZoom; },</code> </pre><br></div></div><br>  We now turn to transformations.  First, let's describe the reflections, because they do not displace the visible area of ‚Äã‚Äãthe image. <br><br><div class="spoiler">  <b class="spoiler_title">Component methods:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">flipX(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.b == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop; }, flipY(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.b == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix.c == <span class="hljs-number"><span class="hljs-number">0</span></span> ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flop : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip = !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.flip; },</code> </pre><br></div></div><br>  Transformations of zooming, rotation, and offset already require a transform-origin adjustment. <br><br><div class="spoiler">  <b class="spoiler_title">Component methods:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">onZoomEnd(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, rotatePlus(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.rotate += <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setMinZoom(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, rotateMinus(){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.rotate -= <span class="hljs-number"><span class="hljs-number">90</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._setMinZoom(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); }, imageMoved(translate){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._translate(); },</code> </pre><br></div></div><br>  It is the <b>_translate</b> method <b>that</b> is responsible for all the subtleties of transformations.  It is necessary to present two reference systems.  The first one, let's call it zero, begins in the upper left corner of the image, when multiplying the coordinates by the transformation matrix, we move to another system of coordinates, let's call it local.  In this case, the inverse transition, from local to zero, we can accomplish by finding the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0">inverse</a> transformation <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BC%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D0%25B0">matrix</a> . <br><br>  So we need two functions. <br><br>  The first is to go from zero to the local system; the browser performs the same transformation when we specify the transform css property. <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">img</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">matrix</span></span>(a, b, c, d, tx, ty); }</code> </pre><br>  The second is for finding the original coordinates of the image, having already transformed coordinates. <br><br>  The most convenient way is to write these functions using methods of a separate class. <br><br><div class="spoiler">  <b class="spoiler_title">Transform class:</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Transform</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(center, matrix){ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.init(center, matrix); } init(center, matrix){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(center) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({},center); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(matrix) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix = <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({},matrix); } getOrigins(current){ <span class="hljs-comment"><span class="hljs-comment">//     let tr = {x: current.x - this.center.x, y: current.y - this.center.y}; //         const det = 1/(this.matrix.a*this.matrix.d - this.matrix.c*this.matrix.b); const x = ( this.matrix.d*(tr.x - this.matrix.tx) - this.matrix.c*(tr.y - this.matrix.ty) ) * det + this.center.x; const y = (-this.matrix.b*(tr.x - this.matrix.tx) + this.matrix.a*(tr.y - this.matrix.ty) ) * det + this.center.y; return {x, y}; } translate(current){ //     const origin = {x: current.x - this.center.x, y: current.y - this.center.y}; //        let x = this.matrix.a*origin.x + this.matrix.c*origin.y + this.matrix.tx + this.center.x; let y = this.matrix.b*origin.x + this.matrix.d*origin.y + this.matrix.ty + this.center.y; return {x, y}; } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">The _translate method with detailed comments:</b> <div class="spoiler_text"><pre> <code class="javascript hljs">_translate(checkAlign = <span class="hljs-literal"><span class="hljs-literal">true</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> tr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Transform(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transform.center, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.matrix); <span class="hljs-comment"><span class="hljs-comment">// , ,  ,       const newCenter = tr.getOrigins(this.areaRect.center); this.transform.center = newCenter; //      this.transform.x = this.areaRect.center.x - newCenter.x; this.transform.y = this.areaRect.center.y - newCenter.y; //   tr.init(this.transform.center, this.matrix); //        ,      let x0y0 = tr.translate({x: 0, y: 0}); let x1y1 = tr.translate({x: this.imageRect.size.width, y: this.imageRect.size.height}); //  (  )       let result = { left: x1y1.x - x0y0.x &gt; 0 ? x0y0.x : x1y1.x, top: x1y1.y - x0y0.y &gt; 0 ? x0y0.y : x1y1.y, width: Math.abs(x1y1.x - x0y0.x), height: Math.abs(x1y1.y - x0y0.y) }; //       ,   "" let rightOffset = this.areaRect.size.width - (result.left + result.width); let bottomOffset = this.areaRect.size.height - (result.top + result.height); let alignedCenter; //   if(this.areaRect.size.width - result.width &gt; 1){ //align center X alignedCenter = tr.getOrigins({x: result.left + result.width/2, y: this.areaRect.center.y}); }else{ //align left if(result.left &gt; 0){ alignedCenter = tr.getOrigins({x: result.left + this.areaRect.center.x, y: this.areaRect.center.y}); //align right }else if(rightOffset &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x - rightOffset, y: this.areaRect.center.y}); } } if(alignedCenter){ this.transform.center = alignedCenter; this.transform.x = this.areaRect.center.x - alignedCenter.x; this.transform.y = this.areaRect.center.y - alignedCenter.y; tr.init(this.transform.center, this.matrix); } //   if(this.areaRect.size.height - result.height &gt; 1){ //align center Y alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: result.top + result.height/2}); }else{ //align top if(result.top &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: result.top + this.areaRect.center.y}); //align bottom }else if(bottomOffset &gt; 0){ alignedCenter = tr.getOrigins({x: this.areaRect.center.x, y: this.areaRect.center.y - bottomOffset}); } } if(alignedCenter){ this.transform.center = alignedCenter; this.transform.x = this.areaRect.center.x - alignedCenter.x; this.transform.y = this.areaRect.center.y - alignedCenter.y; tr.init(this.transform.center, this.matrix); } },</span></span></code> </pre><br></div></div><br>  Alignment creates the effect of "sticking" the image to the edges of the cropping area, avoiding empty fields. <br><br><h3>  Component Preview </h3><br>  The main task of this component is to display a picture, apply transformations and react to the movement of a mouse button clamped over an image.  By calculating the offset, we update the <b>transform.x</b> and <b>transform.y</b> parameters; when the movement is completed, we trigger the <b>moved</b> event, telling the Edit component that we need to re-calculate the position of the transformation center and correct the transform.x and transform.y. <br><br><div class="spoiler">  <b class="spoiler_title">Preview component template:</b> <div class="spoiler_text">  &lt;div ref = "area" class = "edit-zone" <br>  @ mousedown = "onMoveStart" <br>  @ touchstart = "onMoveStart" <br>  <a href="https://habr.com/users/mouseup/" class="user_link">mouseup</a> = "onMoveEnd" <br>  @ touchend = "onMoveEnd" <br>  @ mousemove = "onMove" <br>  @ touchmove = "onMove"&gt; <br>  &lt;img <br>  v-if = "image" <br>  ref = "image" <br>  <a href="https://habr.com/users/load/" class="user_link">load</a> = "imageLoaded" <br>  : src = "image" <br>  : style = "{'transform': transformStyle, 'transform-origin': transformOrigin}"&gt; <br></div></div><br>  The functionality of the editor is neatly separated from the main project and lies <a href="https://github.com/ihormihal/vue-image-editor">here</a> . <br><br>  I hope this material will be useful for you.  Thank! </div><p>Source: <a href="https://habr.com/ru/post/417697/">https://habr.com/ru/post/417697/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../417683/index.html">Outdated Code - Third Party Code</a></li>
<li><a href="../417685/index.html">Friday webinars from Skillbox: we continue to study for free</a></li>
<li><a href="../417687/index.html">Life asymmetry</a></li>
<li><a href="../417689/index.html">Mobio Talks with CEO Appnext about the CPI market and trends in the mobile applications industry</a></li>
<li><a href="../417691/index.html">Our bookshelf C # programmer. What about you?</a></li>
<li><a href="../417699/index.html">Western Digital closes another HDD plant due to lower demand</a></li>
<li><a href="../417701/index.html">From simple scripts to a client-server application on WCF with my own hands: why I like working in CM</a></li>
<li><a href="../417703/index.html">Age of Empires network code: 1500 archers on a 28.8 kbit / s modem</a></li>
<li><a href="../417705/index.html">How a video card manufacturer affects GPU mining profitability</a></li>
<li><a href="../417707/index.html">CSS-in-JS - myths and reality (for example, styled-components)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>