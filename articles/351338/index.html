<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RxJS: Do not unsubscribe</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to you the translation of the article " RxJS: Don't Unsubscribe " by Ben Lesh. 

 Well ... well, just do not refuse subscriptions....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RxJS: Do not unsubscribe</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I present to you the translation of the article " <a href="https://medium.com/%40benlesh/rxjs-dont-unsubscribe-6753ed4fda87">RxJS: Don't Unsubscribe</a> " by Ben Lesh. <br><br>  Well ... well, just do not refuse subscriptions. <br><br>  I often help someone debug problems with their RxJS code, including structuring applications that carry a lot of asynchronous code.  At the same time, I always see the same thing, as people keep handlers on tons of subscriptions.  The developer makes 3 HTTP requests with Observable, saving 3 subscription objects that will be called when an event occurs. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I know why this is happening.  People used to use `addEventListener` N times, and then when they are no longer needed, call` removeEventListener` N times.  It will be natural to do the same with subscription objects, and for the most part you will be right.  But there are better ways.  Saving too many subscription objects is a sign that you are managing your subscriptions imperatively and not taking advantage of Rx. <br><a name="habracut"></a><br><h4>  What does imperative subscription management look like </h4><br>  Take, for example, this fictional component (this is not specifically React or Angular, but just a general example): <br><br><pre><code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyGenericComponent</span></span></span><span class="hljs-class"> extends </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomeFrameworkComponent</span></span></span><span class="hljs-class"> { updateData(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">) { // -     } onMount() { this.dataSub = this.getData() .subscribe(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">this</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateData</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">data</span></span></span><span class="hljs-class">)); const cancelBtn = this.element.querySelector('.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cancel</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">button'</span></span></span><span class="hljs-class">); const rangeSelector = this.element.querySelector('.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rangeSelector'</span></span></span><span class="hljs-class">); this.cancelSub = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">.fromEvent(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">cancelBtn</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">click'</span></span></span><span class="hljs-class">) .subscribe(() =&gt; { this.dataSub.unsubscribe(); }); this.rangeSub = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Observable</span></span></span><span class="hljs-class">.fromEvent(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">rangeSelector</span></span></span><span class="hljs-class">, '</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">change'</span></span></span><span class="hljs-class">) .map(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class"> =&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">e</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">target</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">) .subscribe((</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">) =&gt; { if (+</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> &gt; 500) { this.dataSub.unsubscribe(); } }); } onUnmount() { this.dataSub.unsubscribe(); this.cancelSub.unsubscribe(); this.rangeSub.unsubscribe(); } }</span></span></code> </pre> <br>  In the example above, you can see that I manually call `unsubscribe` on three subscription objects in the` onUnmount () `method.  I also call `this.dataSub.unsubscribe ()` when the user clicks the cancel button on lines 15 and 22, or when he sets the range selector above 500, which is a certain threshold on which I want to stop the data flow.  (I do not know why, this is just a strange component). <br><br>  The disadvantage of this approach is that I manually manage subscription cancellation in several places in this rather trivial example. <br><br>  The only real advantage to using this approach is performance.  Since you use less abstractions to do your work, this is likely to be a little better.  However, this is unlikely to have a noticeable effect in most web applications, and I do not think that this is worth worrying about. <br><br>  In addition, you can always combine several subscriptions into one, creating a parent subscription and adding all the others as children.  But in essence, you will do the same. <br><br><h4>  Compose subscription management with takeUntil </h4><br>  Now let's do the same example, but using the `takeUntil` statement from RxJS: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MyGenericComponent extends SomeFrameworkComponent { updateData(data) { // <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> something framework-specific <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> your component here. } onMount() { const data$ = this.getData(); const cancelBtn = this.element.querySelector(<span class="hljs-string"><span class="hljs-string">'.cancel-button'</span></span>); const rangeSelector = this.element.querySelector(<span class="hljs-string"><span class="hljs-string">'.rangeSelector'</span></span>); const cancel$ = Observable.fromEvent(cancelBtn, <span class="hljs-string"><span class="hljs-string">'click'</span></span>); const range$ = Observable.fromEvent(rangeSelector, <span class="hljs-string"><span class="hljs-string">'change'</span></span>) .map(e =&gt; e.target.<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>); const stop$ = Observable.merge(cancel$, range$.<span class="hljs-keyword"><span class="hljs-keyword">filter</span></span>(x =&gt; x &gt; <span class="hljs-number"><span class="hljs-number">500</span></span>)) this.<span class="hljs-keyword"><span class="hljs-keyword">subscription</span></span> = data$.takeUntil(stop$) .subscribe(data =&gt; this.updateData(data)); } onUnmount() { this.<span class="hljs-keyword"><span class="hljs-keyword">subscription</span></span>.unsubscribe(); } }</code> </pre><br>  The first thing you notice is a smaller amount of code.  But this is only one advantage.  Another thing that happened here is that I put events that stop the data flow into the `stop $` stream.  This means that as soon as I decide that I want to add another condition to stop the flow, for example by timer, I can simply add a new watched object to `stop $`.  The next obvious thing is that I have only one subscription object, which I manage imperatively.  You can‚Äôt change it, because here functional programming intersects with the object-oriented world.  Javascript is an imperative language and we have to accept the rest of the world in some sense half. <br><br>  Another advantage of this approach is that it actually completes the observed object.  This means that a termination event will occur that can be processed at any time.  If you simply call unsubscribe on the returned subscription object, you will not be notified that the subscription has been canceled.  However, if you use `takeUntil` (or other operators listed below), you will be informed through the completion handler that the observable object has stopped. <br><br>  The last advantage I‚Äôm talking about is that you actually ‚Äúplug everything in‚Äù, causing a subscription in one place, which is good, because with discipline it becomes much easier to find where you start a subscription in your code.  Remember that observable objects do nothing until you subscribe to them, so the subscription point is an important part of the code. <br><br>  True, there is one drawback in terms of the semantics of RxJS, but it is hardly worth worrying about other advantages.  The semantic flaw is that the completion of the observed object is a sign that the producer wants to tell the consumer that the job is done, while unsubscribing is the consumer telling the manufacturer that he no longer needs the data. <br><br>  There will also be a very small performance difference between this and the simple imperative call of `unsubscribe`.  However, it is unlikely that it will be noticeable in most applications. <br><br><h4>  Other operators </h4><br>  There are many other ways to stop the flow in ‚ÄúRx-way‚Äù.  I would recommend looking at the following operators at a minimum: <br><br>  take (n): takes N values ‚Äã‚Äãbefore stopping the observed. <br>  takeWhile (predicate): checks the values ‚Äã‚Äãpassed through itself on the predicate; if it returns false, the stream will be terminated. <br>  first (): skips the first value and exits. <br>  first (predicate): checks each value for a predicate function; if it returns true, the thread skips the value and ends. <br><br><h4>  Summary: Use takeUntil, takeWhile, etc. </h4><br>  You should probably use operators such as `takeUntil` to manage subscriptions in RxJS.  As a rule, if you see that there are two or more subscriptions in one component, you should ask yourself if you can define them better: <br><br><ul><li>  first, so advanced </li><li>  triggers a completion event when you kill your thread </li><li>  usually this is less code </li><li>  it becomes easier to manage </li><li>  fewer actual subscription points (because fewer calls to `subscribe`) </li></ul><br>  Want to know more about RxJS from the author?  Come on rxworkshop.com! </div><p>Source: <a href="https://habr.com/ru/post/351338/">https://habr.com/ru/post/351338/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351326/index.html">Information security of bank non-cash payments. Part 4 - Overview of Threat Modeling Standards</a></li>
<li><a href="../351328/index.html">Uncompetitive wrestling: how crossover tournaments have changed in their first year</a></li>
<li><a href="../351332/index.html">What is PAT? Lab at Packet Tracer</a></li>
<li><a href="../351334/index.html">What drives IT in business: jumps and obstacles</a></li>
<li><a href="../351336/index.html">About the ‚Äúshelf life‚Äù of the employee</a></li>
<li><a href="../351340/index.html">Seminar "Development vs Operation. Why neither Agile nor DevOps is a magic pill ‚Äù, March 22, Moscow</a></li>
<li><a href="../351342/index.html">Coinbase cryptocurrency wallet owners are faced with double write-offs of fees due to the nature of Visa</a></li>
<li><a href="../351344/index.html">Conference DEFCON 16. "Games with bar codes." Felix Lindner, head of Recurity Labs</a></li>
<li><a href="../351350/index.html">Uploading messages using the Telegram API. Where to begin</a></li>
<li><a href="../351352/index.html">Online implementation of localStorage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>