<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Transport of St. Petersburg, iOS application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When on March 6th we published information about the Transport Portal of St. Petersburg , I immediately undertook to study their website. Less than a ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Transport of St. Petersburg, iOS application</h1><div class="post__text post__text-html js-mediator-article">  When on March 6th we published information about the <a href="http://transport.orgp.spb.ru/Portal/">Transport Portal of St. Petersburg</a> , I immediately undertook to study their website.  Less than a day later, the first version of the application was already based on a hastily collected html page, of course, I wasn‚Äôt released in the app store, although everything worked quite quickly. <br><br> <a href="http://itunes.apple.com/ru/app/busradarspb/id514892491%3Fl%3Dru"><img src="https://habrastorage.org/getpro/habr/post_images/f54/ff2/947/f54ff29473581b7a9a52709aec3e69b1.png" alt="image"><br></a> <br><br>  Under the cut, I'll tell you what <a href="http://itunes.apple.com/ru/app/busradarspb/id514892491%3Fl%3Dru">happened</a> from all this. <br><img src="https://habrastorage.org/getpro/habr/post_images/fde/914/202/fde914202453989304d69428d646dcc1.jpg" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/572/885/984/5728859847da799779cbc5783f2e52c8.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Choosing a framework </h4><br>  Google prohibits the use of its cards for such paid applications, so the native map-kit was rejected.  html-based applications with creak are being tested, apple advises to rewrite everything to html5, but right there maps with a standard framework.  And in general it is clear that we must look for "native" ways. <br><br>  As a result, with the help of the same Google, I stopped at the route-me framework, or rather its fork from Alpstein.  Google also gives a strange answer to the question about layers: it is proposed to sculpt the entire map one on top of another and synchronize touch events.  A good, good sandwich should be made. <br><br>  I had to rewrite the framework to support the layers, the sources are still published in the form of a patch, they don‚Äôt reach their hands.  Alpstein's people for some reason do not want to drag changes to themselves, although in my opinion, this is about basic functionality.  The essence of the modification is that in UIScrollView not a view with a map is added, as in the original code, but a view container.  In the container there are views with maps.  A couple of methods to add new tileSources and insert them at a given index, and that's it. <br><br><h4>  Portal </h4><br>  There have already been articles about both the android version and html, but for some reason the functionality of these applications is reduced only to the display of layers with transport.  Therefore, I still say a few words about how to do more. <br><br>  The main tools here are browser, wget and some sniffer to choose from: ngrep, tcpdump, tcpflow, for the lazy there is also a graphical HTTPScoop.  Crawling on the portal and studying the requests, we managed to find out that almost everything is built on json, and the tables on datatables.  I formed my requests to datatables, just in case pulling out information in chunks of 25 pages, as is done on the portal itself.  This way you can get a list of routes, a forecast for stops, maybe something else. <br><br>  The next moment is a thoughtful study of the portal pages.  There were hidden unused, but very useful methods for me.  Layers with routes on the portal are implemented via WFS, I did not find support for this type of map in route-me.  But inside the javascript, there were functions that display layers in the standard WMS format, i.e.  pictures. <br><br>  With the browser and sniffer, it also turned out to be easy to figure out how to get a list of stops for a route or in a specific area.  It is worth noting that two adjacent stops may have identical coordinates (especially after converting to a Google projection), but different IDs.  I haven‚Äôt solved this problem yet, there are no standard methods in route-me, it‚Äôs necessary to handle the situation of marker overlapping separately. <br><br><h4>  Organizational issues </h4><br>  Government structures and companies working with them are a nightmare.  It is very difficult to explain to the secretaries' secretaries about which portal we are talking about.  Not easy to go to the developers.  It is impossible to agree on anything with the developers: they constantly change the settings of the site, sometimes in such a way that the program stops working.  Apple publishes new versions for about a week ... <br><br>  By the way, I went to the developers a couple of times in the office, talked to the security men there: the secretaries raised a boom there, deciding that ‚Äúsome hacker had hacked the portal‚Äù.  I looked at the modules glonass, even pledged.  In principle, no one was against my program, but this does not help in any way to solve problems arising after the next security update. <br><br><h4>  Sales </h4><br>  Sales, of course, are ridiculous, for about two months about 50 applications have been bought.  It is curious that with the release of the English version, the amount of sales in foreign stores sometimes exceeds sales in Russian.  There is an unpleasant feeling that the work turned out on the table and the development will not pay off.  Well, are there many people in St. Petersburg with an iPhone who use public transport and are ready to spend a whole dollar?  In a way, of course, rhetorical. <br><br><h4>  What else to please you? </h4><br><br>  FXL4M7RJ4XHE <br>  NN9NW7HJHHL3 <br>  JXN7FLEYLY7W <br>  TJXW94JH763F <br>  A7M9XMJ94YTK </div><p>Source: <a href="https://habr.com/ru/post/144086/">https://habr.com/ru/post/144086/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144080/index.html">How to get rid of perspective distortion. The usefulness of the function Crop Perspective in Adobe Photoshop</a></li>
<li><a href="../144081/index.html">9 floors</a></li>
<li><a href="../144083/index.html">Startup time to market</a></li>
<li><a href="../144084/index.html">How to find a girl in 250 microseconds</a></li>
<li><a href="../144085/index.html">The Chinese broke into the mini-computer market</a></li>
<li><a href="../144088/index.html">Facebook Credits are becoming increasingly popular.</a></li>
<li><a href="../144089/index.html">Charisma Phone: Sony Xperia P Review</a></li>
<li><a href="../144090/index.html">PressAbout.us will work with the press for you.</a></li>
<li><a href="../144091/index.html">VIA Technologies will launch its own mini PCs for sale</a></li>
<li><a href="../144093/index.html">Report on participation in Seedcamp Berlin</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>