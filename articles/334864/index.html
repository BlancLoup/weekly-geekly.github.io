<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I downloaded the source of my own site</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In September 2009, an article was published about the subversion version control system vulnerability, which allows to download source codes of sites ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I downloaded the source of my own site</h1><div class="post__text post__text-html js-mediator-article"> In September 2009, an <a href="https://habrahabr.ru/post/70330/">article</a> was published about the subversion version control system vulnerability, which allows to download source codes of sites using SVN.  From time to time there was nothing to do, my brain wanted me to write a grabber and check the relevance of this threat at the moment, but it was somehow lazy.  However, I was haunted by the <a href="https://habrahabr.ru/post/70330/">comment of</a> habrayuzer <a href="https://habrahabr.ru/users/semenov/" class="user_link">Semenov</a> <br><br><img src="https://habrastorage.org/web/9f6/f5e/5ea/9f6f5e5eacef433c8a34f5b1737e5bcd.png"><br><br>  It is clear that every schoolchild has already tried to download% sitename% via .svn, because I refused this idea right away, but I tried to <i>git clone% sitename% /. Git / my</i> hands. <br><a name="habracut"></a><br>  For starters, I turned off 404 on .git * on my own site and created a git repository in a public directory ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>$ git init &amp;&amp; git add . &amp;&amp; git commit -m 'Test' <br> Initialized empty Git repository in /home/ilyaplot/data/www/web/.git/ <br> [master (root-commit) d3dcdf3] Test <br> 15 files changed, 713 insertions(+) <br> ..................... <br></code> <br>  Now you can try to get the newly created repository. <br><br> <code>$ git clone http://******.com/.git/ <br> Cloning into '******.com'... <br> fatal: http://'******..com/.git/info/refs not found: did you run git update-server-info on the server? <br></code> <br>  As it turned out, not everything is so simple.  In order for the repository to be cloned in this way, you need to run <i>git update-server-info</i> in the folder with the project, which for obvious reasons I can‚Äôt do. <br>  It turns out that for the implementation of the planned need only one file .git / info / refs, containing a hash commit for HEAD. <br>  Since  the commit hash can be obtained from .git / refs / heads / master, then you can simply make a proxy script that will give up what git expects to receive.  I have a very simple PHP script.  I just created a controller in my Yii2 project as follows: <br><br><pre> <code class="php hljs">header(<span class="hljs-string"><span class="hljs-string">"Content-Type: application/octet-stream"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preg_match(<span class="hljs-string"><span class="hljs-string">"/^(?P&lt;host&gt;[\w\-\.]+)\/(?P&lt;url&gt;.+)/isu"</span></span>, $host, $matches)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($matches[<span class="hljs-string"><span class="hljs-string">'url'</span></span>] == <span class="hljs-string"><span class="hljs-string">'info/refs'</span></span>) { $ref = file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://'</span></span> . $matches[<span class="hljs-string"><span class="hljs-string">'host'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/.git/refs/heads/master'</span></span>); $ref = trim($ref); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"{$ref}\trefs/heads/master {$ref}\trefs/remotes/origin/HEAD {$ref}\trefs/remotes/origin/master "</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> file_get_contents(<span class="hljs-string"><span class="hljs-string">'http://'</span></span> . $matches[<span class="hljs-string"><span class="hljs-string">'host'</span></span>] . <span class="hljs-string"><span class="hljs-string">'/.git/'</span></span> . $matches[<span class="hljs-string"><span class="hljs-string">'url'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); }</code> </pre><br>  And added rule to urlManager <br><br><pre> <code class="php hljs">[ <span class="hljs-string"><span class="hljs-string">'pattern'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'git/&lt;host[\w\-\.\/]+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'route'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'git/index'</span></span>, <span class="hljs-string"><span class="hljs-string">'suffix'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, ],</code> </pre> <br>  Now I can try to clone my own site using my own site.  <s>There should be a joke about the monitor</s> <br><br>  We try <br> <code>$ git clone http://******.com/git/******.com <br> Cloning into '******.com'... <br> $ ls ******.com/ <br> assets css favicon.ico images js robots.txt sitemaps <br></code> <br>  Happened!  After that, I checked this method on the sites - giants, got what was expected.  Nothing.  Then I took a list of the million most visited sites on the Internet and went through it all.  I expected to get a lot of source code, but only 1 download from 1 milionion of downloads. I got .git / refs / heads / master with a hash of a commit from 126 sites, but the repository could not be cloned because the routing system of these sites betrayed 404. <br><br>  I was expecting more, of course, so I decided to check how many more or fewer sites can be downloaded via .svn.  I found a grabber on a python, set up the same list of a million sites and launched it.  Several hundred sites downloaded. <br><br>  And in conclusion I will give some tips. <br><br><ol><li>  Now check the availability of /.git/index on your site through a regular browser. <br>  If you have not received 403 or 404, then the following points are for you. </li><li>  Set up your server so that it returns 404 to .svn and .git. </li><li>  Bring the source code of the site, which should not be received by the client outside the public directory. </li><li>  It may be worth changing the passwords that are used in the configs, access to the admin panel url, remove the service scripts from the public directory. </li></ol><br>  For obvious reasons, I cannot say exactly which sites managed to be cloned, but I can say for sure that the owners of these sites have already received a letter in which I pointed out a flaw. <br><br>  UPD: <br>  <a href="https://habrahabr.ru/users/kaimi_ru/" class="user_link">kaimi_ru</a> shared a link to scripts for 5 version control systems <a href="https://github.com/kost/dvcs-ripper">github.com/kost/dvcs-ripper</a> </div><p>Source: <a href="https://habr.com/ru/post/334864/">https://habr.com/ru/post/334864/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334850/index.html">When localization is needed: why is it so hard to find a good translator</a></li>
<li><a href="../334852/index.html">Reflections on Tokens</a></li>
<li><a href="../334856/index.html">Is the end of the CSRF close?</a></li>
<li><a href="../334858/index.html">Javascript like a holiday</a></li>
<li><a href="../334860/index.html">How to use Kanban for convenient work of not only managers, but also programmers</a></li>
<li><a href="../334866/index.html">Using FlyWay for databases on the example of Maven</a></li>
<li><a href="../334868/index.html">Ubershadery in the emulator GameCube / Wii: a delightful solution to the unsolvable problem</a></li>
<li><a href="../334870/index.html">Dismiss, hire, improve - the culture of your company. Radish anatomy</a></li>
<li><a href="../334874/index.html">How Doom Guns were Made</a></li>
<li><a href="../334876/index.html">Graphics evolution in games</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>