<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How not to overpay for Smart Home. Flood protection (anti-leakage)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article presents a pragmatic approach to creating one of the elements of the Smart Home - economical flood protection (anti-leakage) based on a un...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How not to overpay for Smart Home. Flood protection (anti-leakage)</h1><div class="post__text post__text-html js-mediator-article">  The article presents a pragmatic approach to creating one of the elements of the Smart Home - economical flood protection (anti-leakage) based on a universal home automation controller. <br><br>  The main differences from the solutions of this task presented earlier in Habr√© are the ease of implementation, it is relatively cheap + you don‚Äôt have to be a programmer to repeat.  True, you still have to solder, but only 2 times. <br><br><div style="text-align:center;"><img width="900" src="https://habrastorage.org/files/1a8/f81/250/1a8f812503894dba83fc981946b80810.jpg"></div><br><a name="habracut"></a><br><h1>  Introduction </h1><br>  On Habr√©, as a resource of technically active people, to which the afflicted go for advice and problem solving, there are many articles on the topic of Smart Home. <br>  And often in the comments there are regrets that they say no one has yet given birth at the same time a powerful, easy-to-learn and economical way of implementing the Smart Home for the average man.  It is necessary to solder, then code, and often in different languages: for the microcontroller, and for the web, and so on. <br>  And so I took it, I bought spare parts-cubes for cheap and I personally launched it - this is rarely found. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So I decided to insert my 5 kopecks, as it seems I just got one of the options for implementing the Smart Home, which can be suitable for many pragmatically inclined consumers. <br><br>  I will tell on the example of the implementation of flood protection, although already, on the same controller, I have an alarm system, temperature recording and automatic shutdown of the necessary sockets when leaving home. <br><br>  So, according to my "pyramid of Maslow's needs for the Smart Home" (c) - the importance of signaling and preventing a flood is at the same level as the importance of signaling an intrusion or the appearance of smoke. <br><br>  <b>Maslow's Pyramid of Needs for a Smart Home</b> <br><br><div style="text-align:center;"><img width="800" src="https://habrastorage.org/files/b8e/366/1cb/b8e3661cb8e042a3a02e37c40049e982.png"></div><br><br>  For the scale of the tragedy can be terrifying: <br><blockquote><img src="https://habrastorage.org/files/abf/2e0/f43/abf2e0f4338f4a658e6960a58881ed8d.png"><br></blockquote><br>  In view of the fact that I recently acquired a <a href="http://1-m.biz/">universal controller of a smart home</a> and have already implemented more important functionality, I decided that it was time to ‚Äúlay beds‚Äù. <br><br><h1>  Problem </h1><br>  So, if I wanted to see a water leak, I wanted to receive an alert (sms and / or email) and to automatically shut off the water supply to the apartment.  And also be able to open and shut off the water "manually", including remotely via the Internet. <br><br><h1>  Decision </h1><br>  There are a number of ready-made kits for complete or partial solution of this task, but, firstly, they are, to put it mildly, a little expensive, and secondly, having a universal smart home control controller in hand, you can do it all yourself and be no worse, and even better that everything will be integrated into a single system and will interact exactly as I want, and not as the manufacturer of the system decided.  And considering that the most expensive part of the system is already there (the controller), then we get rid of duplication and redundancy. <br><br>  The current structure of my system is Smart Home.  Red highlights components directly involved in the Anti-leakage system. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3de/0ca/b6b/3de0cab6bd8c41e5968703334226fb1d.png"></div><br><br>  The desktop layout of the applied part of the anti-leak system looked like this: <br><br><div style="text-align:center;"><img width="700" src="https://habrastorage.org/files/d67/7b8/a28/d677b8a28f4e4a46bce49a3b1ed130d1.jpg"></div><br><br>  I now get hot water by heating in a cold water boiler.  Therefore, you need to block only one pipe. <br><br>  If necessary, it will be possible to simply build up the system and make the overlap of the second pipe simply by adding another valve and connecting it in parallel to the radio relay. <br><br><h2>  Leakage sensor </h2><br>  The most difficult moment in the entire system. <br>  The trouble is that if questions on the control of intrusion and the appearance of smoke or gas are simply solved by standard sensors, then with the control of water leakage everything is a little different.  There is no water leakage sensor in the <a href="http://1-m.biz/index.php/sovmestimost">list of compatible sensors of</a> my universal controller.  At least it was not ... <br><br>  The search on Habr quickly showed the <a href="http://habrahabr.ru/post/210830/">path of least resistance</a> : take a standard wireless reed sensor and, instead of a reed switch, or rather parallel to it, pull the wires with the contacts and close them with water. <br><br>  This approach has several disadvantages: one of the main ones is the oxidation of non-gilded contacts with time. <br><br><img width="200" align="right" src="https://habrastorage.org/files/721/002/6db/7210026dbc2646dd969a0dc180721fe1.jpg">  Previously, I read on the Internet that there are other ways to detect water leaks, for example, contactless, but low cost, efficiency, and elementary implementation of the above-described variant interrupted the flight of engineering to innovative approaches. <br><br>  The basis was taken Chinese wireless magnetic contact (reed) sensor MD-209R.  In my case, a relatively cheap sensor clone compatible with the PowerCode transmission protocol (from Visonic) was chosen, since this is one of the wireless protocols supported by my controller. <br><br>  In parallel to the built-in reed switch, I soldered 2 wires, the closure of which actually lead to the sensor triggering. <br><br>  So, after some simple manipulations with a soldering iron, it turned out this: <br><br><img src="https://habrastorage.org/files/94b/552/27a/94b55227a5ea4080a04046931d0d404a.png"><br><br><h2>  Motorized valve </h2><br><img width="200" align="right" src="https://habrastorage.org/files/3cb/25a/c92/3cb25ac92e0e45c69724cec2f46ccdeb.png">  As a valve that blocks the water, you can use any valve that has an electric actuator and the appropriate size of the connection to the pipe. <br><br>  I tried my model on a Chinese <a href="http://ru.aliexpress.com/item/1pcs-motorized-ball-valve-DN15-2-way-electrical-valve/708796917.html">electric valve with a 1/2 inch pipe</a> . <br><br><img width="300" align="left" src="https://habrastorage.org/files/9fd/301/cc8/9fd301cc87cd426fb345a57af94e536a.png"><br><br>  The design of the valve actuator automatically turns off the power to the coil after opening or closing.  Thus, there is no need for commands from the controller to relieve voltage through the radio relay after the operation is performed. <br><br><h2>  Radio relay </h2><br>  To supply power to the drive, I purchased a two-channel radio relay from a list compatible with the controller on ebay.  Type YKT-02XX-433 <br><br><img width="300" align="right" src="https://habrastorage.org/files/2c6/3c5/4f6/2c63c54f658e435fb01f489b64f580b7.jpg"><br><br>  Inside, the chip coder-1527, so beloved by Chinese manufacturers, is installed. <br><br>  It has 10-amp relays, so, in principle, they can switch almost any household load up to 250V.  Limit 2 kW. <br><br>  To control the electric drive, this is more than enough, since the valve drive is powered by 12 V and consumes only 4 W on the passport, and only during the change of the valve state. <br><br>  This radio relay can operate in several modes, one of which we just need: interlocking channels.  In this mode, when the relay of one channel is turned on, the relay of another channel automatically turns off.  Thus, we are ‚Äúalmost in hardware‚Äù defending ourselves from simultaneously applying voltage to the ‚Äúopening‚Äù and ‚Äúclosing‚Äù of the valve actuator solenoid due to any glitches. <br><br>  Connection diagram of the valve receiver: <br><br><img src="https://habrastorage.org/files/253/f44/e53/253f44e530cc442da411553f2d3f37af.png"><br><br><h2>  Control </h2><br><img width="250" align="right" src="https://habrastorage.org/files/b5e/997/e39/b5e997e39e804069997834363e8119f8.png"><br>  As a ‚Äúbrain‚Äù of the system, I applied the NS1000 Nanoserver, the universal controller of the domestic manufacturer of the <a href="http://1-m.biz/">1-M Smart Home</a> . <br><br>  Controller features that are somehow used in this project: <br>  ‚Ä¢ Supports extra-budgetary wireless sensors and radio relay. <br>  ‚Ä¢ Run scripts offline (even without internet). <br>  ‚Ä¢ Notification of events via SMS and e-mail. <br>  ‚Ä¢ Elementary compilation of "scripts" of the system without writing code. <br>  ‚Ä¢ Ability to control devices from a smartphone (Android). <br>  ‚Ä¢ Management through WEB. <br>  ‚Ä¢ Keeping "logs". <br><br><h3>  Scenarios </h3><br>  In the process of configuring the controller, you need to consider the following nuance: <br>  The reed switch sends a trigger message when it is open, but we need to close it.  Accordingly, in the launch condition of the script, you need to specify not the activation of the sensor, but the deactivation.  And not by state, but by change.  To alert not repeated cyclically. <br><br><blockquote>  Scenario 1 trigger condition: If the Leakage Sensor Channel is turned off. <br>  Script steps: <br>  .  Alert "Master, we have a flood!" <br>  .  Enable the channel "Valve water close" <br></blockquote><br>  And the script to open the valve on a team with a keychain or from a smartphone: <br><blockquote>  Scenario 2 launch condition: If the Channel ‚ÄúYou can open the water valve‚Äù is turned on. <br>  Script steps: <br>  .  Enable the channel "Water valve open" <br></blockquote><br><br>  In the WEB interface of the cloud service it looks like this: <br><br><img src="https://habrastorage.org/files/7ce/b9f/561/7ceb9f5617cd455da579eb33d1234764.png"><br><br>  You do not need to ‚Äúprogram‚Äù anything for manual control of devices - after adding them to the system, each device control is automatically available from the Personal Account via the WEB interface and from the Android application. <br><br>  View of the WEB-control panel of the Smart Home via the Internet: <br><br><img src="https://habrastorage.org/files/706/ce6/fad/706ce6fad9d24527926c2e7885bb395e.png"><br><br>  Appearance of Android application <br><br><img width="200" align="left" src="https://habrastorage.org/files/ca7/c6d/f5b/ca7c6df5bbd84846945f3b70dd36c750.png"><br><br><h1>  What is the result? </h1><br>  The goal is achieved.  When a leakage sensor is triggered, I receive an SMS alert like "Owner, we have a flood!" And the valve automatically closes in less than 30 seconds. <br>  Also, I have the opportunity not to automatically open and close the valve, by pressing buttons on the key fob, from a smartphone or from a browser via the Internet. <br>  The operation of each sensor and device is logged in the log. <br><br>  At the same time, it was not necessary to write code and self-repetition of this solution is quite accessible for the majority (of course, not counting the installation of valves on the pipes). <br><br>  Setting up the system, knowing what you want, takes on the strength of 10 minutes.  Including sensor and radio relay activation, creation of all scenarios. <br><br>  It is clear that in the form as it is presented in the photographs, in reality it cannot work for a long time and reliably. <br>  The valve drive power supply unit, the radio relay, and the sensor itself must also be placed in plastic boxes with at least some degree of protection. <br><br>  Plus, different thoughts are already emerging on the development of the system, for example, duplication of alerts to light signals, periodic ‚Äútraining‚Äù of the valve so that it ‚Äúdoes not stagnate‚Äù and so on.  By the way, personally, I have serious doubts about the need for the backup power function of an electro-valve, which some ‚Äúpurchased‚Äù anti-leakage kits so boast about. <br><br>  In other words - the appetite comes with eating. <br><br>  The good thing is that in order to build up the functionality, you do not need to call "certified" specialists so that they tweak something in the system.  All this can be done most easily, thanks to the simplicity of the principles of setting up a universal controller. <br><br><h1>  A little about prices: </h1><br>  NS-1000 Nanserver - $ 44 <br>  The sensor magnetocontact MD-209R - $ 13 <br>  Radio relay - $ 10 <br>  Valve- $ 15 <br><br>  Total (excluding delivery) = $ 82 <br><br>  Not so cheap.  But this is if you do not take into account that the nanserver is used not only for the anti-leakage function.  After all, it implements a security and fire alarm system and other features ... <br><br><hr><br><img width="200" align="right" src="https://habrastorage.org/files/88b/94e/f66/88b94ef66cb742fcb321eef2128038e1.png"><h1>  PS </h1><br>  In the process of implementation, having already bought a valve, I discovered that there are <a href="http://ru.aliexpress.com/item/Quick-response-Manipulator-Electric-Valve-Arm-for-Gas-Detector/1242746028.html%3FrecommendVersion%3D2">electric drives</a> that are installed on conventional ball-cranes with manual control. <br>  An additional and important bonus of this approach - in which case, in a few minutes you can return the manual control valve. <br>  I immediately got sick of cutting in additional stop valves into the water supply system and I ordered such a drive.  I am waiting. <br><br>  Update 2: <br>  While the salt matter, the controller manufacturer announced a leakage sensor. <br><br><div style="text-align:center;"><img width="900" src="https://habrastorage.org/files/ec7/70d/816/ec770d8166ee403fb474c0221f113c1d.png"></div><br><img width="400" align="right" src="https://habrastorage.org/files/21d/3b6/89e/21d3b689e1fc40f9b4950bc1aa22dab0.png"><br><br>  According to the <a href="http://1-m.biz/blog">information</a> , the sensor uses the contactless principle of determining the appearance of water, which in itself is quite unusual.  It is also interesting because it is not ‚Äúsharpened‚Äù under the ‚Äúbrand‚Äù and can be used not only with the 1M Smart House system, but also with any system operating under the PowerCode protocol.  In fact, it transmits a parcel similar to the MD-209R sensor, which I used for my anti-leakage. <br>  The price also seems to be comparable - $ 9.9. <br><br>  Let's see ... </div><p>Source: <a href="https://habr.com/ru/post/376023/">https://habr.com/ru/post/376023/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../376011/index.html">Carbon Flyer: carbon fiber powered smartphone</a></li>
<li><a href="../376013/index.html">Tesla Model S will be faster due to software update</a></li>
<li><a href="../376017/index.html">Luna mattress to turn an ordinary bed into a "smart"</a></li>
<li><a href="../376019/index.html">iPod from the 80s. Review of popular audio devices of the past</a></li>
<li><a href="../376021/index.html">Today's Google Doodle - ‚ÄúToreadors from Vasyukovka‚Äù</a></li>
<li><a href="../376025/index.html">EBay company stops working with service users in Crimea</a></li>
<li><a href="../376027/index.html">Steam users earned more than $ 57 million selling virtual hats and cards</a></li>
<li><a href="../376029/index.html">Published the latest ranking of the safest cities for life</a></li>
<li><a href="../376031/index.html">The light is twisted into M√∂bius strip</a></li>
<li><a href="../376033/index.html">Big-eyed flies or choose a quadrocopter with a camera for $ 40</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>