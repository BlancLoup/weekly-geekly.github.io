<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Program, aport!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="- Kinect for Windows SDK. Part 1. Sensor 
- Kinect for Windows SDK. Part 2. Data Flows 
- Kinect for Windows SDK. Part 3. Functionalities 
- Playing c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Program, aport!</h1><div class="post__text post__text-html js-mediator-article"><ul><li>  <a href="http://habrahabr.ru/post/150955/">Kinect for Windows SDK.</a>  <a href="http://habrahabr.ru/post/150955/">Part 1. Sensor</a> </li><li>  <a href="http://habrahabr.ru/post/151131/">Kinect for Windows SDK.</a>  <a href="http://habrahabr.ru/post/151131/">Part 2. Data Flows</a> </li><li>  <a href="http://habrahabr.ru/post/151296/">Kinect for Windows SDK.</a>  <a href="http://habrahabr.ru/post/151296/">Part 3. Functionalities</a> </li><li>  <a href="http://habrahabr.ru/post/142236/">Playing cubes with Kinect</a> </li><li>  [Program, aport!] </li></ul><br>  In the <a href="http://habrahabr.ru/post/142236">last article</a> I touched upon the topic of working with Microsoft Kinect for Windows and demonstrated the sensor capabilities using the example of the game of cubes.  Let me remind you that tracking a human figure <i>(skeleton tracking) is</i> not the only possibility of a sensor, and today I would like to talk about speech recognition. <br><a name="habracut"></a><br>  To learn about the Microsoft Speech Platform, we will write a simple application in which an arbitrary object (for example, a tank) will move along a plane.  I did not add voice commands to the previous example for two reasons.  First, chronologically, this example appeared earlier.  And, secondly, I wanted to concentrate in each example on a separate functionality (such code is easier to learn). <br><br>  Determine which packages will be useful to us: <br><ul><li>  <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D27226">Microsoft Speech Platform - SDK</a> .  Required package.  This is a platform and toolkit for getting started with speech recognition. </li><li>  <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D27224">Microsoft Speech Platform - Runtime Languages</a> .  Optional package.  By default, the SDK includes only a library for recognizing English speech.  You can download additional libraries to work with other languages. </li><li>  <a href="http://www.microsoft.com/en-us/kinectforwindows/develop/overview.aspx">Microsoft Kinect for Windows - SDK</a> .  Optional package. </li></ul><br>  I will reveal a terrible secret, the presence of a sensor is not a prerequisite for the possibility of speech recognition.  Speech Platform develops independently of Kinect, but at the same time in the Kinect SDK you will definitely find examples of speech recognition.  Our example will work with both a sensor and a conventional microphone. <br><br>  First of all, you need to understand what to program.  The sequence of actions is extremely simple: <br><ol><li>  select a recognition <i>engine (engine)</i> from those available in the system for the required language; </li><li>  create a command dictionary and pass it to the received handler; </li><li>  set the audio source for the handler.  It can be Kinect, microphone, audio file; </li><li>  give the handler a command to start recognition. </li></ol><br>  Now in Visual Studio we will create a new WPF Application project.  I will write in C #. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To begin with, we will try to find a connected sensor.  The <a href="http://msdn.microsoft.com/en-us/library/microsoft.kinect.kinectsensor.aspx">KinectSensor</a> class provides this feature using the <a href="http://msdn.microsoft.com/en-us/library/microsoft.kinect.kinectsensor.kinectsensors.aspx">KinectSensors</a> property: <br><br><pre><code class="cs hljs">KinectSensor kinect = KinectSensor.KinectSensors .Where(s =&gt; s.Status == KinectStatus.Connected) .FirstOrDefault();</code> </pre> <br>  Speech recognition engine - class <a href="http://msdn.microsoft.com/en-us/library/ms587635.aspx">SpeechRecognitionEngine</a> , its static method <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognitionengine.installedrecognizers.aspx">InstalledRecognizers ()</a> helps to get information about all installed handlers in the system. <br><br><pre> <code class="cs hljs">RecognizerInfo info = SpeechRecognitionEngine.InstalledRecognizers() .Where(ri =&gt; <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Equals(ri.Culture.Name, <span class="hljs-string"><span class="hljs-string">"en-US"</span></span>, StringComparison.InvariantCultureIgnoreCase)) .FirstOrDefault();</code> </pre><br>  It is easy to guess that in this way we get information about the processor of recognition of English speech recognition ( <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.recognizerinfo.aspx">RecognizerInfo</a> ), if there is such a processor.  The InstalledRecognizers method does not return instances of handlers, but information about them.  Therefore, the next step is to create an instance of the handler.  Just pass the handler ID to the constructor: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sre = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SpeechRecognitionEngine(info.Id);</code> </pre><br>  Now let's think about this.  We need to control the object on the plane.  Which teams will come up for this?  I think that 4 commands are enough: UP (up), DOWN (down), LEFT (left), RIGHT (right).  And for variety, you can add the fifth EXIT command (exit).  I note that I wrote the code for recognizing commands in English, but you can choose any of the <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D27224">54x available</a> .  Create a command dictionary and load it into the recognition handler. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> commands = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Choices(); commands.Add(<span class="hljs-string"><span class="hljs-string">"up"</span></span>); commands.Add(<span class="hljs-string"><span class="hljs-string">"down"</span></span>); commands.Add(<span class="hljs-string"><span class="hljs-string">"left"</span></span>); commands.Add(<span class="hljs-string"><span class="hljs-string">"right"</span></span>); commands.Add(<span class="hljs-string"><span class="hljs-string">"exit"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GrammarBuilder(commands) { Culture = info.Culture }; sre.LoadGrammar(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Grammar(gb));</code> </pre><br>  A list of words (commands) for recognition is created in the <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.choices.aspx">Choices</a> object.  The next step is to create a grammar object associated with the command culture, and then the grammar is loaded into the recognition processor. <br><br>  Each word you say, the handler compares with the word patterns in the grammar, to determine if you have spoken any command.  But remember that each attempt at recognition is accompanied by a certain probability of error; a little further you will see this with an example. <br><br>  You can now define handlers for speech recognition events.  It is important for us to handle the <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognitionengine.speechrecognized.aspx">SpeechRecognized</a> event <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognitionengine.speechrecognized.aspx">that</a> occurs when the recognition handler finds a match for the spoken command in the dictionary.  In the SpeechRecognizedEventArgs object, we have the <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.recognitioneventargs.result.aspx">Result</a> property available in which we can find: a <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.recognizedphrase.text.aspx">recognized word</a> , the <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.recognizedphrase.confidence.aspx">magnitude of the probability</a> that the word is recognized correctly, and much <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.recognitionresult.aspx">more</a> .  Two other events, <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognitionengine.speechhypothesized.aspx">SpeechHypothesized</a> and <a href="http://msdn.microsoft.com/en-us/library/system.speech.recognition.speechrecognitionengine.speechrecognitionrejected.aspx">SpeechRecognitionRejected,</a> are of interest for debugging rather than actual use.  The first event occurs when the recognition handler makes a recognition assumption.  The second is when the recognition handler can define a word only with a small degree of probability. <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Sre_SpeechRecognized</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, SpeechRecognizedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     70% if (e.Result.Confidence &gt;= 0.7) { Action handler = null; switch (e.Result.Text.ToUpperInvariant()) { case "UP": case "DOWN": case "LEFT": case "RIGHT": handler = () =&gt; { /* some actions */ }; break; case "EXIT": handler = () =&gt; { this.Close(); }; break; default: break; } if (handler != null) { //   ,      UI     Dispatcher.BeginInvoke(handler, DispatcherPriority.Normal); } } }</span></span></code> </pre><br>  It remains for us to set the source of the audio signal and start recognition.  Here I would like to note the feature of Kinect.  The audio stream is ready for operation approximately 4 seconds after initialization.  This should be taken into account and, for example, create a timer to start recognition with a 4-second delay. <br><br>  Remember, I said at the beginning that our code will work both with Kinect and with a regular microphone?  In order to realize this, it is sufficient to correctly set the source of the audio signal. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (kinect != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> audioSource = kinect.AudioSource; audioSource.BeamAngleMode = BeamAngleMode.Adaptive; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> kinectStream = audioSource.Start(); <span class="hljs-comment"><span class="hljs-comment">//    Kinect sre.SetInputToAudioStream(kinectStream, new SpeechAudioFormatInfo(EncodingFormat.Pcm, 16000, 16, 1, 32000, 2, null)); } else { //         sre.SetInputToDefaultAudioDevice(); } //  .          . sre.RecognizeAsync(RecognizeMode.Multiple);</span></span></code> </pre><br>  As for the UI, everything is simple.  We draw an object of any shape (it can even be a picture), I drew a tank. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e47/6e7/0b5/e476e70b54a2bf1aced349fdf2ecdff4.png" alt="tank"><br><br>  And add animation to move.  Of course, in order not to create comical situations when the tank is moving sideways, I also added animation to turn in the right direction.  An example of an animation for executing a LEFT command (left): <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Key</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"LEFT"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DoubleAnimationUsingKeyFrames</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(UIElement.RenderTransform).(TransformGroup.Children)[2].(RotateTransform.Angle)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PART_Tank"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">EasingDoubleKeyFrame</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">KeyTime</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0:0:0.5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-90"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DoubleAnimationUsingKeyFrames</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DoubleAnimation</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetProperty</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"(Canvas.Left)"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Storyboard.TargetName</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PART_Tank"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Duration</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0:0:1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">By</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-30"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Storyboard</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Recognition in action: <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/aaj_IOEbZfE%3Ffeature%3Doembed&amp;xid=25657,15700021,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhgv-Zd78I6uhWbUDdpLyv1GbpJBSQ" frameborder="0" allowfullscreen=""></iframe><br><br>  You will find the source code files and the compiled version at the end of the article.  Please note that if you run the compiled example without the Speech SDK installed, you need to install the <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D27225">Microsoft Speech Platform Runtime</a> and the English recognition <a href="http://www.microsoft.com/download/en/details.aspx%3Fid%3D27224">engine MSSpeech_SR_en-US_TELE.msi</a> <br><br>  Summing up, I will say that Microsoft Speech Platform is really a big and interesting product, I touched only a small part of it.  I would advise interested people to see examples of working with this platform in the Kinect SDK, I think this is a good starting point. <br><br>  In conclusion, I would like to thank VIAcode for providing the sensor for the experiments. <br><br>  <a href="">Build an example without Kinect</a> <br>  <a href="">Build the Kinect Example</a> <br>  <a href="">Sample source code</a> </div><p>Source: <a href="https://habr.com/ru/post/142677/">https://habr.com/ru/post/142677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142667/index.html">Cheat Sheet on Perl Mock Objects</a></li>
<li><a href="../142668/index.html">Real Unfair Competitive Advantage</a></li>
<li><a href="../142671/index.html">Published prices for "cloudy" Photoshop</a></li>
<li><a href="../142672/index.html">ASP.NET MVC 3 server on Synology NAS - solution</a></li>
<li><a href="../142676/index.html">About approaches to comparing file versions</a></li>
<li><a href="../142680/index.html">Participation in Google Summer of Code 2012. Part One: Proposal Submission</a></li>
<li><a href="../142684/index.html">[Poll] Photoshop and Linux. Usage patterns</a></li>
<li><a href="../142685/index.html">Automatic staircase lighting with Arduino</a></li>
<li><a href="../142688/index.html">The Habrahabr ribbon is now provided with the ‚ÄúAll‚Äù tab, and this tab contains not only blog entries, but also questions</a></li>
<li><a href="../142689/index.html">Knee monitoring</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>