<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Algorithm seam carving for image resizing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Seam carving is an algorithm for resizing an image that preserves important content and removes less significant content. It was described in an artic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Algorithm seam carving for image resizing</h1><div class="post__text post__text-html js-mediator-article">  Seam carving is an algorithm for resizing an image that preserves important content and removes less significant content.  It was described in an article by <a href="http://www.win.tue.nl/~wstahw/2IV05/seamcarving.pdf">S. Avidan &amp; A. Shamir</a> .  It gives a better result than the usual stretching of the image in view of the fact that it does not change the proportions of the significant elements of the image.  The two photos below demonstrate the operation of the algorithm - the original image has a size of 332x480, while the modified seam carving is 272x400. <br><img src="https://habrastorage.org/storage2/d7e/95c/c9a/d7e95cc9a4a5f1f571ef1f3b3521ede4.jpg"><br><img src="https://habrastorage.org/storage2/034/8c0/173/0348c0173df59552e274387ff9616d95.jpg"><br>  In this article I will describe the operation of the algorithm using pseudocode and Matlab code.  The original article written by me in English is available <a href="http://kirilllykov.github.io/blog/2013/06/06/seam-carving-algorithm/">here</a> , the source code on <a href="">githabe</a> . <br><a name="habracut"></a><br><h5>  Energy image </h5><br>  In order to simplify the presentation, I will describe only the case of reducing the size of the image.  Enlarging a picture is a similar process. <br>  The idea of ‚Äã‚Äãthe algorithm is to remove content that has less value for the user (contains less information).  We will call the measure of this information "energy."  As such a function, we can use an image gradient in the space l1: <img src="https://habrastorage.org/getpro/habr/post_images/ee7/3af/2e2/ee73af2e2802ba331424b8a05440f828.gif"><br>  If the picture has 3 channels, then as the gradient of the entire image we use the sum of the gradients of each channel.  The Matlab code below demonstrates this approach: <br><pre><code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">res</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pixelels</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function"> = |</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dI</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dx</span></span></span><span class="hljs-function">| + |</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dI</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dy</span></span></span><span class="hljs-function">| </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">res</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyGrey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I(:, :, 1)</span></span></span><span class="hljs-function">) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyGrey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I(:, :, 2)</span></span></span><span class="hljs-function">) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyGrey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I(:, :, 3)</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">res</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyGrey</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(I)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">all</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pixelels</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">e</span></span></span><span class="hljs-function"> = |</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dI</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dx</span></span></span><span class="hljs-function">| + |</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dI</span></span></span><span class="hljs-function">/</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dy</span></span></span><span class="hljs-function">| </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">res</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imfilter(I, [-1,0,1], 'replicate')</span></span></span><span class="hljs-function">) + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">abs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imfilter(I, [-1;0;1], 'replicate')</span></span></span><span class="hljs-function">); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  And this is the result of applying the energy function to the image used: <br><img src="https://habrastorage.org/storage2/a4c/e1b/33b/a4ce1b33bab1980e49231f2ad9fb45e7.jpg"><br><br><h5>  Seam </h5><br>  If we remove the pixels with the minimum energy, but an arbitrary position, then the image will be damaged.  If we remove the columns / columns with minimal energy, unwanted artifacts will appear.  Here, under the column, I mean {(i, j) |  j is fixed}, and under the column {(i, j) |  i fixed}.  The solution to the dilemma is to introduce a generalization of the notion of a column / column. <br>  Formally, let I be the nxm image, then we call it vertical seam <img src="https://habrastorage.org/getpro/habr/post_images/6ce/fdd/a0c/6cefdda0cce2ec3c30f35cf54fd4b3c0.gif">  , <br>  where x: [1, .., n] -&gt; [1, .., m].  That is, the vertical seam is a path from the top of the image to the bottom such that the length is the width of the image, and for each element (i, j) belonging to the seam, the next element can only be (i + 1, j-1), (i +1, j), (i + 1, j +1).  Similarly, we can enter a horizontal seam.  Examples of vertical and horizontal seams are shown below: <br><img src="https://habrastorage.org/storage2/6f6/e0d/8ee/6f6e0d8ee7b7dac9b4867452dfb68dff.jpg"><br><br>  We are interested in seams with minimal energy. <img src="https://habrastorage.org/getpro/habr/post_images/b75/7f2/766/b757f2766d79cc5d5b249ba09e77e0b8.gif"><br>  To find such a seam, we use dynamic programming: <br><ol><li>  Finding the matrix M of the minimum energy for all possible seams for each (i, j): <br><ul><li>  Fill the first line M with values ‚Äã‚Äãfrom the energy matrix e </li><li>  For all lines, starting with the second: <br>  M [i, j] = e [i, j] + min (M [i - 1, j], M [i, j], M [i +1, j]); </li></ul><br></li><li>  Find the minimum value in the last row of the matrix M and build a path from this pixel to the first row, choosing at each step a piekel with minimum energy (similarly, for (i, j) consider the values ‚Äã‚Äãof M in the positions [i - 1, j], [i , j], [i + 1, j]). </li></ol><br>  For efficiency, in the Matlab code, I represent seam using the nxm bit matrix.  If the pixel belongs to seam, it is marked 0, otherwise 1. <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergy]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finds</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seam</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mask</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pixel</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seam</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seams</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function">` </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padarray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy, [0 1], realmax('double')</span></span></span><span class="hljs-function">); % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">avoid</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handling</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">elements</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sz(2)</span></span></span><span class="hljs-function"> - 1) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[M(i - 1, j - 1) M(i - 1, j) M(i - 1, j + 1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(neighbors)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[val, indJ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M(sz(1)</span></span></span><span class="hljs-function">, :)); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">val</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(energy)</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uint8</span></span></span><span class="hljs-function">'); %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">go</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backward</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> : -1 : 2 %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> - 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, indJ - 1)</span></span></span><span class="hljs-function"> = 1; % -1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">because</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[M(i - 1, indJ - 1) M(i - 1, indJ) M(i - 1, indJ + 1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[val, indIncr]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(neighbors)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">val</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> + </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indIncr - 2)</span></span></span><span class="hljs-function">; % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x - 2)</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1,2]</span></span></span><span class="hljs-function">-&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[-1,1]</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, indJ - 1)</span></span></span><span class="hljs-function"> = 1; % -1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">because</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function"> = ~</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  To find the horizontal seam, simply pass the transposed energy matrix to the findOptSeam function. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Finding the optimal order of removal seams </h5><br>  So, now we can find the minimum seam and using the code below we can remove it from the image: <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergy]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finds</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seam</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mask</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">with</span></span></span><span class="hljs-function"> 0 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pixel</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seam</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seams</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vertical</span></span></span><span class="hljs-function"> - </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">I</span></span></span><span class="hljs-function">` </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padarray</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy, [0 1], realmax('double')</span></span></span><span class="hljs-function">); % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">avoid</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handling</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">border</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">elements</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sz(2)</span></span></span><span class="hljs-function"> - 1) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[M(i - 1, j - 1) M(i - 1, j) M(i - 1, j + 1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">M</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(neighbors)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">last</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raw</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[val, indJ]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(M(sz(1)</span></span></span><span class="hljs-function">, :)); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">val</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(energy)</span></span></span><span class="hljs-function">, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uint8</span></span></span><span class="hljs-function">'); %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">go</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backward</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sz</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1)</span></span></span><span class="hljs-function"> : -1 : 2 %</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> - 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, indJ - 1)</span></span></span><span class="hljs-function"> = 1; % -1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">because</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[M(i - 1, indJ - 1) M(i - 1, indJ) M(i - 1, indJ + 1)]</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[val, indIncr]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(neighbors)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergy</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">val</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indJ</span></span></span><span class="hljs-function"> + </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(indIncr - 2)</span></span></span><span class="hljs-function">; % </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(x - 2)</span></span></span><span class="hljs-function">: </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[1,2]</span></span></span><span class="hljs-function">-&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[-1,1]</span></span></span><span class="hljs-function">] </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, indJ - 1)</span></span></span><span class="hljs-function"> = 1; % -1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">because</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">padding</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> 1 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">element</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function"> = ~</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optSeamMask</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  This set of operations is already enough to change the image size in width or height, keeping important details - just remove as much as you need horizontal and vertical seams. <br>  But what if we need to simultaneously reduce the size of the image vertically and horizontally?  How to understand at each iteration what is better in terms of energy minimization - to remove the vertical seam or horizontal? <br>  This problem can again be solved by dynamic programming.  Let n 'and m' be the desired image size (n '&lt;n, m' &lt;m).  We introduce the matrix T, which determines for each n 'x m' the cost of the optimal sequence of removal of the vertical and horizontal seams.  For convenience, we introduce r = n - n ', m = m - m', which describe the number of vertical and horizontal deletions.  In addition to T, we introduce the TBM matrix of size rxc, which for each T (i, j) stores 0 or 1, depending on whether we came to T (i, j) by removing the vertical (1) or horizontal (0) seam.  The pseudocode is shown below: <br><ol><li>  T (0, 0) = 0; </li><li>  Initialize the values ‚Äã‚Äãof T on the border: <br>  for all j { <br>  T (0, j) = T (0, j - 1) + E (seamVertical); <br>  } <br>  for all i { <br>  T (i, 0) = T (j - 1, 0) + E (seamHorizontal); <br>  } <br></li><li>  Initialize the TBM values ‚Äã‚Äãon the border: <br>  for all j {T (0, j) = 1;  } <br>  for all i {T (0, i) = 0;  } <br></li><li>  Fill T and TBM: <br>  for i = 2 to r { <br>  imageWithoutRow = image; <br>  for j = 2 to c { <br>  energy = computeEnergy (imageWithoutRow); <br><br>  horizontalSeamEnergy = findHorizontalSeamEnergy (energy); <br>  verticalSeamEnergy = findVerticalSeamEnergy (energy); <br>  tVertical = T (i - 1, j) + verticalSeamEnergy; <br>  tHorizontal = T (i, j - 1) _ horizontalSeamEnergy; <br>  if (tVertical &lt;tHorizontal) { <br>  T (i, j) = tVertical; <br>  transBitMask (i, j) = 1 <br>  } else { <br>  T (i, j) = tHorizontal; <br>  transBitMask (i, j) = 0 <br>  } <br>  // move from left to right - delete vertical seam <br>  imageWithoutRow = removeVerticalSeam (energy); <br>  } <br><br>  energy = computeEnergy (image); <br>  image = removeHorizontalSeam (energy); <br>  } <br></li><li>  Finding a path from T (r, c) to T (1, 1), deleting a row or column depending on the TBM value (i, j). </li></ol><br>  And the implementation on Matlab: <br><pre> <code class="matlab hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[T, transBitMask]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findTransportMatrix</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sizeReduction, image)</span></span></span><span class="hljs-function"> % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">optimal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">order</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">of</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removing</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">raws</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">columns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zeros</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sizeReduction(1)</span></span></span><span class="hljs-function"> + 1, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sizeReduction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(2)</span></span></span><span class="hljs-function"> + 1, '</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">double</span></span></span><span class="hljs-function">'); </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transBitMask</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ones</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size(T)</span></span></span><span class="hljs-function">) * -1; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">borders</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoRow</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T, 1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageNoRow)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergyRow]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoRow</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageNoRow, optSeamMask, 0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transBitMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, 1)</span></span></span><span class="hljs-function"> = 0; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, 1)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i - 1, 1)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergyRow</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoColumn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T, 2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageNoColumn)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergyColumn]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoColumn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageNoColumn, optSeamMask, 1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transBitMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, j)</span></span></span><span class="hljs-function"> = 1; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(1, j - 1)</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">seamEnergyColumn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">borders</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">just</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">one</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">column</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">and</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">one</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">row</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">before</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceeding</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergyRow]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image, optSeamMask, 0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMask, seamEnergyColumn]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image, optSeamMask, 1)</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fill</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">internal</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">part</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">i</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T, 1)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageWithoutRow</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">copy</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleting</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">columns</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">for</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">j</span></span></span><span class="hljs-function"> = 2 : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">size</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(T, 2)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageWithoutRow)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMaskRow, seamEnergyRow]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy')</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoRow</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageWithoutRow, optSeamMaskRow, 0)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMaskColumn, seamEnergyColumn]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoColumn</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(imageWithoutRow, optSeamMaskColumn, 1)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">neighbors</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[(T(i - 1, j) + seamEnergyRow) (T(i, j - 1) + seamEnergyColumn)]</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[val, ind]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(neighbors)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">T</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">val</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transBitMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(i, j)</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ind</span></span></span><span class="hljs-function"> - 1; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">left</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">right</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageWithoutRow</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageNoColumn</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energy</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">energyRGB</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image)</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[optSeamMaskRow, seamEnergyRow]</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOptSeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(energy')</span></span></span><span class="hljs-function">; % </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">move</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">from</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">top</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bottom</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">image</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reduceImageByMask</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(image, optSeamMaskRow, 0)</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span><span class="hljs-function">; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">end</span></span></span></span></code> </pre><br><br><h5>  Conclusion </h5><br>  The algorithm works well on landscape images, see the gif demonstrating the dynamics of the algorithm (thanks to <a href="http://habrahabr.ru/users/shara/" class="user_link">shara</a> ): <br><img src="https://habrastorage.org/storage2/e81/659/f98/e81659f982f59585e3c6bfa50fe6bba8.gif" alt="image"><br>  But as is, it is poorly suited for portraits or images full of detail.  On landscape images, the sky or the sea contains little information, and the image is usually reduced by them.  If you take an image containing many small details, the algorithm will not give the best result (an example is taken from the article Avidan &amp; A. Shamir): <br><img src="https://habrastorage.org/storage2/42c/a93/a41/42ca93a414904c41ffb6675741097177.png"><br>  Without user input, seam carving should not be applied to portrait photographs, since a meaningful object for us - a person - contains less information in terms of seam carving: <br><img src="https://habrastorage.org/storage2/a00/692/650/a00692650b52291729212e2e462500ca.png"><br>  The algorithm can be applied to remove tagged objects from an image (an example is taken from the Avidan &amp; A. Shamir article): <br><img src="https://habrastorage.org/storage2/5e3/57a/944/5e357a944b60a675651bee489c94e8fc.png"></div><p>Source: <a href="https://habr.com/ru/post/183638/">https://habr.com/ru/post/183638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../183626/index.html">Convenient torrentokachalkal managed through the web and android for a dedicated server</a></li>
<li><a href="../183628/index.html">Clouds are even cheaper</a></li>
<li><a href="../183630/index.html">HTML 5 Notifications API</a></li>
<li><a href="../183634/index.html">New design admin WordPress.com</a></li>
<li><a href="../183636/index.html">Study of the ‚Äúworking‚Äù diaphragm numbers of the lens on the example of Canon EF 1.8 / 50 II</a></li>
<li><a href="../183642/index.html">The digest of interesting news and materials from the world of PHP over the last two weeks, No. 19 (06/03/2013 - 06/17/2013)</a></li>
<li><a href="../183646/index.html">Commit Naming Style</a></li>
<li><a href="../183648/index.html">Excursion to the new Supermicro plant</a></li>
<li><a href="../183650/index.html">Another way to get custom data in iOS</a></li>
<li><a href="../183654/index.html">Parsing command line arguments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>