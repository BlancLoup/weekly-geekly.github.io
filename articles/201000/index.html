<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wireless sound. Part 1. Dissect Bluetooth</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes, it happens, you come across some kind of bug for the first time, write off everything to circumstances and forget about it. Then it repeats...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wireless sound. Part 1. Dissect Bluetooth</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/4a3/702/ad0/4a3702ad083c8b43d30582d6d1126820.jpg">  Sometimes, it happens, you come across some kind of bug for the first time, write off everything to circumstances and forget about it.  Then it repeats over and over again, forcing you to start looking for problems and, if possible, to fix them.  And when you find yourself in deep night for analyzing dumping / debugging / reading_manuals, it becomes clear that you can‚Äôt leave it halfway through and the matter of principle is to bring it to the end. <br><br>  Such a story happened to me at the moment of review with a colleague of <a href="https://habrahabr.ru/users/r3s/" class="user_link">r3s</a> consumer wireless Bluetooth <a href="https://habrahabr.ru/users/r3s/" class="user_link">speakers</a> Klipsch KMC 3. I was faced with a situation where the ‚Äúwireless‚Äù audio stream began to shamelessly interrupt, it was enough for me to place the sound source behind me.  Food for thought was given to me by another Bluetooth audio system, which behaved much better under the same conditions.  Such a simple problem degenerated into a dive headlong into the interior of the Bluetooth protocol and the details of transmitting audio with it. <br><br>  Under the cut of the first part of a series of articles, we‚Äôll easily get acquainted with the main protocols of the Bluetooth stack, dig into the dump of the source and receiver connections, find out the causes of the Bluetooth and Wi-Fi conflict, and find the root of my problem - intermittent sound. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img align="left" src="https://habrastorage.org/getpro/habr/post_images/50a/d2d/1e6/50ad2d1e6424f45af3ea98b6fda11284.png">  Let us leave behind the scenes (or move to comments) the controversy on the topic ‚Äúwhy do we need wireless transmission of audio if we can get along with Orthodox wired solutions, saving a lot of money and winning in quality‚Äù.  We agree that wireless streaming audio from any device, both portable and not so interesting to us, because with it we can: <br><br><ol><li>  Play audio from mobile devices (Google Music + iTunes Match = all media library in the cloud and is accessible from any device) to wireless audio systems and receivers.  Let's not forget that the phones are now winning the palm among the users' music tracks carriers; <br></li><li>  Sound spaces in which the installation of wired solutions is difficult for several reasons (kitchen, terraces, balconies, outdoor areas of your country estate); <br></li><li>  Allow guests to ‚Äúput on their CD‚Äù; <br></li><li>  Forget about cradles, because  Parting with the phone for many becomes a painful process. <br></li></ol><br><br>  Thus, at the time of reading this article, we forget about the wired vs wireless holivar and plunge into the world of wireless technologies, in which, as it turned out, there are many interesting details, one has only to dig deeper. <br><br>  <b>King bluetooth</b> <br><img align="left" src="https://habrastorage.org/getpro/habr/post_images/7d7/3ab/412/7d73ab41258cc5f2d5f1812be3bd9462.jpg">  The culprit of the celebration is the <a href="http://www.bluetooth.com/">Bluetooth</a> technology, which received its life thanks to the initiative of Ericsson back in 1994, then standardized by IEEE (802.15-1) and still being developed by the entire interest group of the <a href="https://www.bluetooth.org/">Bluetooth Special Interest Group (SIG)</a> .  Currently, the Bluetooth SIG alliance has about 18,000 companies, among which, of course, there are those who produce audio components that can receive a stereo signal wirelessly. <br><br>  Recently, I got one of these devices.  The Klipsch KMC 3 system, a <a href="http://habrahabr.ru/post/193310/">review of which is on Habr√©</a> , satisfied everyone except one: under certain conditions, it began to reproduce sound, terribly interrupted.  Yuzkeis was as follows: Macbook Air 2012 acted as the source of the audio signal, and it was worthwhile to position it behind your own body 4 meters from the system (read ‚Äúsit back to the column with a laptop on your lap) as the sound began to be interrupted.  The second participant of the Bluetooth contest (review of which is waiting for you at the end of the post) - Edifier Spinnaker E30, also suffered from signal fading, but at the same time to a much lesser extent.  The question arose, what could be the reason for the so different behavior of the two systems under the same conditions? <br><br>  There is a problem with the propagation of the signal, but it was necessary in the same conditions to use a mobile phone to play audio, as the problem became much less noticeable.  So it was decided to understand the causes and consequences, which led me to the very sources - reading the <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/v4.aspx">Bluetooth Core Specification</a> , analyzing network connection dumps and modifying values ‚Äã‚Äãthat are important for audio codecs.  To begin with, however, it was necessary to eliminate the possibility of interference between Bluetooth and Wi-Fi. <br><br>  <b>One kitchen and several cooks</b> <br>  It's no secret that both Bluetooth and Wi-Fi (and many more systems) work in the same frequency range - the <a href="http://en.wikipedia.org/wiki/ISM_band">ISM band</a> - within the limits of <a href="http://en.wikipedia.org/wiki/IEEE_802.11">2.400 GHz - 2.4835 GHz</a> .  Using the same frequency range to transmit information from different systems will inevitably lead to signal <a href="http://ru.wikipedia.org/wiki/%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D1%2584%25D0%25B5%25D1%2580%25D0%25B5%25D0%25BD%25D1%2586%25D0%25B8%25D1%258F">interference</a> , which means data loss.  It was to the interference of Wi-Fi and Bluetooth signals that I initially sinned. <br><br>  <b>Modulation</b> <br>  To effectively transmit a signal (digital, analog) via radio, it is necessary to undergo a <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">modulation</a> procedure.  Let us allow ourselves to lower the subtleties of various processes of modulation of signals and concentrate on the facts that will help present a picture of the spectrum in the average home of the user of our days. <br><br>  The <a href="http://en.wikipedia.org/wiki/IEEE_802.11">802.11n standard</a> (and I believe that 90% of Habr's users will have it deployed at home, although the following is true for 11g) implies the use of <a href="http://en.wikipedia.org/wiki/Orthogonal_frequency-division_multiplexing">OFDM</a> signal <a href="http://en.wikipedia.org/wiki/Orthogonal_frequency-division_multiplexing">modulation</a> with the organization of <a href="http://en.wikipedia.org/wiki/List_of_WLAN_channels">13 channels</a> 20 MHz wide. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ccf/7c3/cd9/ccf7c3cd9495d0cab6e3de46174071fc.png"></div><br>  At the same time, the standard 802.11b / g / n provides for the use of one channel throughout the operation time, if its state is considered satisfactory (read ‚Äúno channel interleaving‚Äù). <br><br>  Bluetooth uses a different approach: the ISM spectrum organizes 79 channels 1 MHz wide, and then, using the Frequency-hopping Spread Spectrum ( <a href="http://en.wikipedia.org/wiki/Frequency-hopping_spread_spectrum">FHSS</a> ) spread spectrum technology, the radio receiver and radio transmitter synchronously change the carrier frequency according to a certain pattern at a frequency of 1600 times per second.  This is done just to reduce the likelihood of signal overlap in the tiny ISM range. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d85/9d5/f2c/d859d5f2c04c4254906df2224b7fc850.jpg"></div><br>  If you had a spectral analyzer at home, the process of changing the carrier over the entire 2.4 GHz range would look like this: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/994/fcf/93e/994fcf93e44efbdd7c653668e2e075cc.png"></div><br>  Randomly scattered red dots - this is the Bluetooth signal that constantly changes the frequency.  Green areas are the three active Wi-Fi channels. <br><br>  <b>Anti-interference</b> <br>  However, the high-speed carrier shift technique does not eliminate interference, but only reduces the likelihood of its occurrence.  The chances of a Bluetooth signal getting into the 20 MHz Wi-Fi channel band are still non-zero: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f1b/e76/e9a/f1be76e9a24a70f08a80c68878735103.jpg"></div><br>  Therefore, in the arsenal of the Bluetooth stack there is an adaptive frequency shift technology - Adaptive Frequency Hopping ( <a href="http://www.design-reuse.com/articles/5715/adaptive-frequency-hopping-for-reduced-interference-between-bluetooth-and-wireless-lan.html">AFH</a> ).  The principle of operation of AFH is as follows: out of 79 available 1 MHz channels, channels falling within the range occupied by the Wi-Fi signal are excluded: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3e3/0e7/212/3e30e721209cb7e432084d37bdd7828f.jpg"></div><br>  The figure above shows how the AFH algorithm corrected the map of channels available for ‚Äújumping‚Äù, excluding those that were in channel 6 already occupied by Wi-Fi. <br><br>  But I was not lucky, it was not a matter of signal interference, since  I moved the WLAN to the ‚Äúsafe‚Äù Bluetooth band of 5 GHz (which, by the way, is the most effective method for eliminating possible problems), and the audio interruptions have not disappeared anywhere.  I had to dig deeper. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4d3/1c0/3ee/4d31c03ee9ab715a60118e9bf19ce87d.jpg"></div><br><br>  <b>Parsing Bluetooth dump</b> <br>  Since the problem was not interfering with Wi-Fi, it took a deeper immersion in the materiel.  Let me remind you that in terms of analysis, it was interesting that under the same conditions, the two Bluetooth audio systems (Klipsch KMC 3 and Edifier Spinnaker) behaved differently.  Klipsch was choking earlier, and to achieve the effect, it was necessary to simply block the body with a straight path to the column at a distance of several meters.  Edifier could grunt a couple of times, but after that he continued to confidently reproduce the sound, occasionally interrupting. <br><br>  Symptoms indirectly hinted at auto-tuning of certain parameters on the part of Edifair and Klipsch‚Äôs lack of it due to degradation of the signal quality.  To test this theory, it was decided to remove the dump connection of two devices in order to find the source of the problem. <br><br>  For the purity of the experiment, I turned off the Bluetooth module, deleted Klipsch from the list of paired devices, turned on the ‚Äúblue tooth‚Äù, and, pressing the dump record button, went from searching the device and connecting to it before sending the audio. <br><br>  <b>Device initialization</b> <br>  After activating the Bluetooth module, the dump is filled with HCI message records, which for the most part make the module understand what its name is, what MAC address it has, what class of devices it belongs to and includes the radio module itself. <br>  This happens in the form of the HCI Command -&gt; HCI Event dialog. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/234/479/090/234479090e943e574ec644228b1cec08.png"></div><br>  The stack of bluetooth only indirectly resembles the usual TCP / IP, so seeing the dump without first reading the specification was not successful. <br>  To the credit of the Bluetooth SIG group, I note that the documentation for the root specification and all sorts of profiles is freely available on <a href="https://developer.bluetooth.org/">the developer portal</a> , and is written in simple and understandable language. <br><br>  <b>Bluetooth architecture</b> <br><img align="right" src="https://habrastorage.org/getpro/habr/post_images/6d0/baa/544/6d0baa544476b537e527216846e54c66.png">  So my reference book for a certain amount of time was the <a href="https://www.bluetooth.org/docman/handlers/downloaddoc.ashx%3Fdoc_id%3D229737">Bluetooth Core Specification</a> .  The 13 megabyte pdf of six volumes only seems immense at first, but a few chapters will suffice to understand the basic operations and interaction principles of the subsystems. <br><br>  <b>Core system</b> <br>  In the process of searching for the source of the problems, I went from top to bottom: when I encountered high-level protocols in the dump, I tried to understand the logic of their work and the purpose of the transmitted parameters. <br>  Certainly, the Orthodox way is from the bottom up: from the basics of establishing the physical and logical control channels of Bluetooth to high-level protocols based on them.  This way I will try to guide you. <br><br>  The core of the bluetooth - the <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/v4.aspx">Bluetooth Core System Specification</a> - describes the four basic lower levels of the architecture and the corresponding protocols, with the three lower levels, as a rule, distinguished into a separate subsystem - the Bluetooth Controller, and everything that is above refers to the Bluetooth Host. <br><br>  The block diagram of the Bluetooth Core System architecture shows the location of the main architecture blocks at the model levels, denotes user-plane and control-plane traffic between the blocks and, most importantly, gives an idea of ‚Äã‚Äãthe stack hierarchy. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/491/cd4/953/491cd495382bbfe9991fcc46c56b61f0.jpg"></div><br>  The diagram does not focus on a very important part of the architecture - the Host to Controller Interface (HCI), which ensures the interaction of the Host software subsystem with the Controller iron subsystem.  All interaction of the upper levels of the Bluetooth system with its hardware occurs through the HCI commands initiated by the driver.  These teams in the dump will meet us all the time. <br><br>  Let's walk through the main blocks of architecture in order to understand their main purpose: <br><br>  <b>RF</b> <br>  The <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/Radio.aspx">Radio</a> unit (PHY), as befits a resident of the physical layer, is engaged in the conversion of a bit sequence into radio signals.  The issues of modulation, spectral characteristics and physics of the bit rate providing processes are all solved at the lower level of the model. <br><br>  <b>Baseband Layer = Link Controller + Baseband Manager + Device Manager</b> <br>  The <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/Baseband.aspx">baseband</a> level is represented in the form of three blocks, the joint task of which is to manage the physical channels (Phy channels), on top of which the physical links (Phy links) are established.  Bluetooth addressing, synchronizing device generators, managing access codes to physical channels, searching for devices and establishing a physical channel between them are all tasks of the Baseband level. <br><br>  <b>Link manager</b> <br>  After the two lower levels provided us with a physical connection between the master-slave devices, the matter becomes the organization of logical channels, which later become the basis for transmitting application traffic.  <a href="https://developer.bluetooth.org/TechnologyOverview/Pages/LMP.aspx">Link Manager</a> is responsible for establishing, modifying and releasing logical connections between devices, as well as updating the parameters of physical connections.  Link Manager uses the Link Management Protocol (LMP) for this purpose. <br><br>  <b>L2CAP Layer = Channel Manager + L2CAP Resource Manager</b> <br>  We transfer to the high-level Bluetooth Host block occupied by the L2CAP level.  Logical Link Control and Adaptation Protocol (L2CAP) is a protocol that works on top of the established logical connections, which provides encapsulation, segmentation, and recovery of packet data from all higher-lying applications. <br><br>  <b>Transport Architecture</b> <br>  In the process of exploring the architecture blocks, you could already have a picture of the overall Bluetooth transport architecture, which is a three-tier model: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ae/32b/8a5/1ae32b8a5013b9e981aaba5b48f3ecfa.png"></div><br>  In the following text, I will use the word ‚Äúchannels‚Äù to refer to Channels and ‚Äúconnections‚Äù for Links. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cc4/0a5/b69/cc40a5b69816b532a5d94e527252bf48.png"></div>  The picture above shows the path of the unicast asynchronous traffic along the transport architecture.  This type of traffic is typical for the transmission of ‚Äúpacket‚Äù audio. <br><br>  <b>SCO vs ACL</b> <br>  If you look closely at the previous figure, then at the levels Logical Links and Logical Transports the most common abbreviations are ACL and (e) SCO.  These are two global types of logical connections between Bluetooth devices that are used to transmit various kinds of traffic from higher-level applications. <br><br>  The ACL (Asynchronous Connection-Oriented Links) sends asynchronous packet traffic to the connections with the ability to resubmit in case of loss during delivery, segmentation and flow control. <br><br>  SCO connections, in turn, are essentially organized according to the principle of switching channels with a constant bandwidth of 64 kbit / s and synchronous data transfer in time slots.  SCO channels, for example, are used by the Headset profile to stream the subscriber‚Äôs voice from the phone to the headset. <br>  According to the Host Controller Interface architecture, each of its commands (HCI command) must be accompanied by a response event (HCI Event).  The response always returns the status of the command (Success or error code), as well as, optionally, the values ‚Äã‚Äãrequested by the command. <br><br>  Below are three HCI commands at the stage of module self-initialization and event-responses to them. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/09e/ae8/c5e/09eae8c5eda9179f3b883a2f67e4014c.png"></div><br>  <b>Device discovery and discovery</b> <br>  After Bluetooth gathered the ‚Äúabout me‚Äù information, I started searching for devices.  When you hold the button down to a flashing indicator, the device is switched to the listening channel of the detection channel (Inquiry Channel).  When the device hears the access code ‚Äúanswer all‚Äù on this channel, it will send information about its presence. <br><br>  Like any process of accessing the upper levels to the iron part of Bluetooth, everything starts with the command from HCI: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c3a/63d/e45/c3a63de45f8ef0e84519ec14c94b7033.png"></div><br>  Here the LAP field is of interest.  In fact, this is nothing more than the analogue of a multicast address (general access code), having seen that on the detection channel, Bluetooth devices will surely notify you of their presence with a response message. <br><br>  As a result, all devices that received general access code on their physical channel for detection respond with Inquiry Response messages in which: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/51f/c15/ca1/51fc15ca164bc150300d937c71ae8023.png"></div><br>  specified MAC address of the device, its main and secondary classes (Major Class and Minor Class), as well as supported services. <br><br>  I singled out two parameters: the first, Sink, indicates that the device can act as an audio signal receiver, and the second, Advanced Audio Distribution, that the device supports the A2DP profile. <br><br>  <b>Connection</b> <br>  After the search procedure, the picture of the world for a Bluetooth device becomes clear, it's time to move on to the connection phase, or, as this process is called in the specification, Paging. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/652/ded/5e8/652ded5e8b54ca248de85c697ef9e090.png"></div><br>  A separate physical channel is also allocated for connecting the equipment.  It is important to note that the physical Bluetooth channels operate in duplex transmission mode (duplex).  The use of one physical channel for bidirectional transmission is carried out according to the <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D1%2583%25D0%25BB%25D1%258C%25D1%2582%25D0%25B8%25D0%25BF%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D1%2581_%25D1%2580%25D0%25B0%25D0%25B7%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5%25D0%25BC_%25D0%25BF%25D0%25BE_%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B8">time division division</a> (TDM) principle.  With this approach, the transmitter and receiver must have synchronized clock generators to transmit and receive information at the right time. <br><br>  Since each Bluetooth device is equipped with its own generator, then of course there is no talk of any initial synchronization between them.  Synchronization achieves Link Controller in the process of establishing a connection. <br>  This happens as follows: in the course of the search, the master device receives from the responders, among other parameters, also their clock value.  Then, at the connection establishment stage, the master device transmits the estimated clock offset value for the slave device (the Clock Offset parameter in the screenshot above), thereby speeding up the synchronization process of the two generators. <br><br>  The most important field of the Create Connection command to connect is the remote device identifier - its Bluetooth address (BD_ADDR).  Following the command to the controller to establish a connection, the LMP protocol enters the battle, which completely controls the process of organizing logical connections, over which our traffic will later walk: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/550/511/c52/550511c527ea8c3b70a3e8f4c04b0413.png"></div><br>  If you remember, at the beginning of the article I talked about the Adaptive Frequency Hopping method, which allows you to avoid interference at frequencies already occupied?  So, the map of the frequencies used is transmitted in the LMP message Set AFH.  In the course of work, I noticed new occurrences of these packets with a different frequency map, which indicates a gradual monitoring of the ether for channels suffering from interference. <br><br>  The result of the process of establishing a connection will be the assignment of the connection of two Bluetooth devices to the Connection Handle identifier. <br><br>  <b>Pairing</b> <br>  OK, we have established a physical connection with the device, synchronized the device generators and are ready to transfer service and user information in time slots, what is missing?  Mating  Our devices do not trust each other yet, which means that no user traffic is allowed to transmit. <br><br>  Since  Both devices support the Bluetooth 3.0 specification version, then the <a href="http://en.wikipedia.org/wiki/Bluetooth">Secure Simple Pairing</a> authentication method (and its Just Works submethod) is available for them, allowing them to authenticate and authorize devices without entering any PIN codes. <br><br>  <b>L2CAP in action</b> <br>  In the chapter on transport architecture, a diagram of the hierarchy of channels and connections is depicted, on top of which is the L2CAP protocol.  It is his turn that comes right after the device authentication processes. <br><br>  The structural diagram of the architectural blocks of the L2CAP-level tells about its capabilities for segmentation, resubmission, flow and resource management: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64c/21f/9a1/64c21f9a197e6e41daf825d1c44b48db.png"></div><br>  It is important to understand that asynchronous data from any applications will be fed to the L2CAP protocol, which will prepare the data for sending to the lower levels of the stack. <br><br>  In order to transfer from the procedure of pairing devices to a direct information exchange, it would be good to know which profiles are supported by the paired device, can it play audio or organize file sharing?  These questions are answered by the Service Discovery Protocol (SDP).  Since this is a top-level protocol, it cannot do without the services of the L2CAP protocol, which will create a channel specifically for this.  Let's see how this happens. <br><br>  In my example, after successfully pairing devices, the first L2CAP packet appeared, containing the following fields: <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/36b/134/808/36b13480892db52f78bc52c26e2bf0ed.png"></div><br>  The Connection Request command, as suggested by the CO, initiates the creation of a connection with the L2CAP level of the slave device, while the packet structure contains fields of interest to us. <br><br>  The L2CAP protocol uses the concept of channels, the end points of such a channel in a master-slave pair are identified using a 2-byte CID (Channel Identification).  CID 0x0001 is the reserved channel identifier for terminating the L2CAP protocol signaling traffic, which is logical, because the Connection Request command (Channel ID: 0x0001 at the bottom of the screenshot) belongs to the signaling messages. <br><br>  The next important field is PSM (Protocol / Service Multiplexer).  The <a href="https://www.bluetooth.org/en-us/specification/assigned-numbers/logical-link-control">PSM</a> value indicates which protocol or service we are organizing for the L2CAP channel and, as you can see, we are talking about the channel for the Service Discovery Protocol. <br><br>  <b>Service Discovery</b> <br>  L2CAP did a good job and set up a data channel for the SDP top-level protocol, which, as we found out, will help you find out which services are supported on the remote device. <br><br>  This happens in the form of the following dialog: <br>  - Do you know how to "any service_"? <br>  - yes, I can, and here are its characteristics (otherwise, the answer is ‚Äúno, I don‚Äôt know, ask further‚Äù). <br><br>  I received a negative response to requests for all services except Audio Sink and AV Remote Controller, which means the column is logical, it can only play audio and give control signals to the master device (for example, when you press the pause button on the column, playback at the source is set to pause) ). <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After SDP learned about the interlocutor everything that could, it's time to go to the direct transfer of audio, which is responsible for ... </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio / Video Distribution Transport Protocol</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This guy is responsible for organizing and managing audio / video streams. And in my case, it was possible to understand the logic of his work without even plunging into the 160-page </font></font><a href="https://www.bluetooth.org/docman/handlers/DownloadDoc.ashx%3Fdoc_id%3D260860%26amp%3BvId%3D290084"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">specification</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The </font></font><a href="https://developer.bluetooth.org/TechnologyOverview/Pages/AVDTP.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AVDTP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> operation </font><a href="https://developer.bluetooth.org/TechnologyOverview/Pages/AVDTP.aspx"><font style="vertical-align: inherit;">diagram is</font></a><font style="vertical-align: inherit;"> pretty </font><a href="https://developer.bluetooth.org/TechnologyOverview/Pages/AVDTP.aspx"><font style="vertical-align: inherit;">straightforward</font></a><font style="vertical-align: inherit;"> . To start a stream, you need to open two channels: one control (signaling) and one, directly, for the transmitted audio / video data.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5a/1a6/531/a5a1a65310367185d265ba158a4dcc77.png"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we already know, there is no escape from L2CAP, it is through its channels that the traffic of the AVDTP protocol will go. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this case, the L2CAP channel opens with a new PSM value corresponding to the AVDTP protocol. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">One L2CAP channel opened for signaling messages, the second for AVDTP data, and the third for the </font></font><a href="https://developer.bluetooth.org/TechnologyOverview/Pages/AVCTP.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Audio / Video Control Transport Protocol</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (for transmitting signals from the speaker to the sound source) initiated the speaker.</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d4a/762/6e1/d4a7626e1c4b8bb3ec53026ddf9cd65e.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pay attention to the Source CID / Destination CID pairs, these are entry points for L2CAP channels. </font><font style="vertical-align: inherit;">A pair of Src / Dst CID uniquely identifies the L2CAP channel. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After establishing the necessary L2CAP channels, the process of exchanging service messages between AVDTP protocols on both sides of the connection started. </font><font style="vertical-align: inherit;">Among the service messages worth noting:</font></font><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/32f/386/e2f/32f386e2f87c854483853c8c6d7ea594.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The Discover team allows you to find out from a remote device, and, in fact, what exactly it can offer as part of an audio / video transmission. </font><font style="vertical-align: inherit;">In response, a description of the possibilities should come in the form of a list of Service Endpoints. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At first glance, it is not clear why the speaker has two points in the role of ‚Äúaudio receiver‚Äù. </font><font style="vertical-align: inherit;">The following pair of messages answers this question:</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f69/c17/cea/f69c17ceaa28f8fb8239e11d42f7ebec.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Pay attention to a couple of Min Bitpool and Max Bitpool values, they will soon play an important role. </font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/365/340/1fa/3653401fadf90f936f4e15c329bcf573.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since Klipsch KMC3 can understand two codecs - an SBC codec that is required for an A2DP device and an optional, proprietary </font></font><a href="http://www.csr.com/products/60/aptx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AptX</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> codec - then we see two AVDTP service points, they differ only in the type of codec supported, nothing more. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AptX vs SBC</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After receiving information about the capabilities of the service points of the AVDTP protocol, the message Set Config selects the work with the AptX codec. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So it was with Klipsch, but Edifier Spinnaker does not support the AptX codec, so its list of service points consisted of exactly one piece with the obligatory SBC (Low Complexity Subband Coding) codec. As a result, the dumps taken when installed to the two systems differed only in the selected codec of the transmitted audio!</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Okay, but AptX is so heaped up, paid, closed and fueled by CeBITs, why does he, the dog, start to ‚Äúfreeze‚Äù in certain conditions, and can you somehow get the Klipsch column to work with the SBC codec to make sure that the problem is in that? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To test, I connected to Edifier, repeated the experience with the location of the laptop behind my body while recording the dump, and this is what I saw. Below is a fragment of the AVDTP protocol, which contains the SBC encoded fragment of the transmitted audio.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ea/6db/8f8/4ea6db8f8946ce756be3cc450a474dbf.png"></div><br>  Since<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the SBC codec is open, then in the dump you can see the related information related to the transmitted audio data. The </font></font><a href="http://developer.bluetooth.org/TechnologyOverview/Documents/A2DP_SPEC.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A2DP</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> specification describes in detail the operation of the SBC codec, where you can find out that one of the key parameters that ultimately affect the quality of coding is the bitpool value. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the dump, it is clear that the bitpool value for this portion of traffic is 48, but as soon as I close the path from the laptop to the column, the bitpool value began to decline, accompanied by interruptions and clicks. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the bitpool value had settled at level 30, the clicks were gone, the audio playback was again continuous. Everything indicated that the codec performed auto-tuning, noting the degradation of the signal quality.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But have I really introduced such a significant attenuation with my mortal body? </font><font style="vertical-align: inherit;">Well, time to look at the graph showing the power level of the received signal:</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eb6/fb6/7a8/eb6fb67a824a846b8b3f7c698214aac9.png"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A good body, qualitatively introduces attenuation, which codecs stumble upon. </font><font style="vertical-align: inherit;">The only thing is that the SBC codec has been adjusted to these conditions, reducing the quality of coding, and thus the necessary bandwidth, but AptX, apparently, not. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to make sure that AptX is guilty, I turned off its support in Mac OS X and started harassing again to Klipsch. </font><font style="vertical-align: inherit;">Now the SBC codec between the macbook and the column has been agreed, since </font><font style="vertical-align: inherit;">AptX'a laptop was forcibly deprived. </font><font style="vertical-align: inherit;">Needless to say, with the SBC-codec, Klipsch has stopped stuttering so much in the face of a drop in the signal power level?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">How long is it short, but the problem is diagnosed, and because of the closedness of AptX, I had no chance to affect the codec's performance (as can be done with SBC, setting the bitpool values ‚Äã‚Äãin OS X). Therefore, it remains only not to loom with the bodies on the way of the visible signal or use the trick with disabling the AptX codec in Macosi. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In any case, you can be content with the fact that thanks to this problem I learned something about the work of Bluetooth. I hope that after reading this article, and you can say the same thing. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS1</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, it is not for nothing that AptX asks for money; the transfer of audio through it through Bluetooth is indeed better than with standard SBC. It was possible to feel this by turning off AptX on a laptop and listening to the same tracks on the same acoustics. Subjectively - the difference between SBC and AptX - something like between 192 kbps MP3 and 320 kbps - is noticeable if you listen carefully. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">AptX is still supported by </font></font><a href="http://en.wikipedia.org/wiki/AptX"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">only a narrow circle of devices</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , among which there are glands under OS X and top-end smartphones Samsung Galaxy, HTC One. Accordingly, the iPhone and iPad in my environment, precisely because of the lack of AptX, behaved better than the MacBook, since the use of the SBC codec was agreed with them, and the MacBook was crawled with AptX. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS2</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Next AirPlay preparation. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS3</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And finally, a review of Edifier Spinnaker, with which the whole epic of a month‚Äôs length began. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As I wrote in the introduction, this post initially was not supposed to contain a single screenshot, not a line about the protocols, but something went wrong ...</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e45/329/c51/e45329c518dd02b0297c14988df6d584.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the comments to my previous </font></font><a href="http://habrahabr.ru/post/193310/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">review, Klipsch KMC 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> rightly noted that $ 400 for a plastic monoblock column is a bit much. </font><font style="vertical-align: inherit;">To argue with this is meaningless, since it is worthwhile to hang a wireless label on the column, as the price tag immediately grows to a good hundred or two dollars. </font><font style="vertical-align: inherit;">But maybe you should not lay out $ 400 for a monoblock from Klipsch, in which the brand itself, look, added $ 50-100, and turn to the products of </font></font><a href="http://www.edifier.ru/speakers/bluetooth/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">less famous companies</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ? </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So when a colleague asked to help him bring Bluetooth speakers he liked from the USA, I agreed without hesitation. </font><font style="vertical-align: inherit;">So, as a contender for the recommended wireless audio system up to $ 300, we happened to consider the product from the company Edifier - </font><a href="http://www.edifier.ru/speakers/bluetooth/bluetooth_82.html"><font style="vertical-align: inherit;">Spinnaker E30</font></a><font style="vertical-align: inherit;"> wireless stereo system</font></font><a href="http://www.edifier.ru/speakers/bluetooth/bluetooth_82.html"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c0f/cca/2b3/c0fcca2b32072056762d9d5dad55278b.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Spinnaker began to share a niche of wireless solutions with products such as </font></font><a href="http://www.amazon.com/Klipsch-Center-KMC-Portable-Speaker/dp/B00BAQJ94Q/ref%3Dsr_1_1%3Fie%3DUTF8%26amp%3Bqid%3D1383463306%26amp%3Bsr%3D8-1%26amp%3Bkeywords%3Dklipsch%2Bkmc%2B3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Klipsch KMC 3</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.amazon.com/Creative-ZiiSound-Bluetooth-Wireless-Speaker/dp/B005E8MVV4/ref%3Dsr_1_1%3Fie%3DUTF8%26amp%3Bqid%3D1383463216%26amp%3Bsr%3D8-1%26amp%3Bkeywords%3Dcreative%2Bziisound%2Bd3x"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Creative ZiiSound</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.amazon.com/Bose%25C2%25AE-SoundLink%25C2%25AE-Bluetooth-Mobile-Speaker/dp/B0090Z3SPU/ref%3Dsr_1_2%3Fie%3DUTF8%26amp%3Bqid%3D1383463250%26amp%3Bsr%3D8-2%26amp%3Bkeywords%3Dbose%2Bsoundlink"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bose SoundLink</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.amazon.com/Jawbone-JAMBOX-Wireless-Bluetooth-Speaker/dp/B004E10KI8/ref%3Dsr_1_1%3Fie%3DUTF8%26amp%3Bqid%3D1383463285%26amp%3Bsr%3D8-1%26amp%3Bkeywords%3Djawbone%2Bjambox"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Jawbone Jambox</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.amazon.com/Samsung-DA-E670-Channel-40-Watt-Audio/dp/B0083BCCVI/ref%3Dsr_1_4%3Fie%3DUTF8%26amp%3Bqid%3D1383463344%26amp%3Bsr%3D8-4%26amp%3Bkeywords%3Dsamsung%2Bbluetooth%2Bspeaker"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Samsung DA-E670</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and many others. </font></font><img align="left" src="https://habrastorage.org/getpro/habr/post_images/4b5/a12/7c2/4b5a127c2fa6f60532e86e342837403a.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At the same time, despite the presence of famous brands in the list of competitors, no one of us experienced any prejudices about Asian roots Edifier. Still, the equal sign between "made in China" and "g #% but" has long been crossed out with good products in the wired field. Moreover, at first glance it becomes clear that with the build quality everything is pretty good here.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/54b/6c0/537/54b6c0537328c36e877adbc430ee76b3.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">No burning sensation in the pelvic region, even when we put the spinnakers near the ‚Äúreference‚Äù B &amp; W Zeppelin Air, everything was collected soundly and conscientiously. </font><font style="vertical-align: inherit;">And to collect, as you can see, there was something - the design of the columns is at least unusual.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5b9/747/51c/5b974751c9e295925d756334c2d0cc1a.jpg"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tusks, fangs, horns - no matter what kind of associations the guests have, but sea wolves know that the spinnaker is, in fact, one of the sails of the yacht. </font><font style="vertical-align: inherit;">Forty-centimeter speakers, covered with black silk fabric, definitely look aggressive, and a pair of Spinnakers should fit into the modern interior as well as possible.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/313/410/83c/31341083c21f3a6caeab579298a6501d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's pay tribute to fashion, a few words about the configuration. After opening numerous packages and boxes on the table, there was a decent pile of wires, because they come with: a connecting cord for communication between speakers, an optical audio cable, a 3.5 mm mini-jack, an RCA cable and a remote control with standard microUSB-USB lanyard. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Honestly, such an abundance of wires for seemingly ‚Äúwireless‚Äù speakers at first is discouraging, but in fact, only two cables are enough - the power supply and the 6-pin connecting cord between the speakers. The rest of the cables you get in the appendage and unnecessary in the economy certainly will not.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/eee/74c/4e9/eee74c4e938580a3eac0e0a472beb67c.jpg"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The presence of a mini-jack and optical cables already indicates that the speakers can be connected to the playback source in the old-fashioned wired way, for which the Aux IN / Opt IN port is allocated on the connector part of the right speaker. </font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7b/058/9b7/f7b0589b72ae0e489138e4e436cfa8cc.jpg"></div><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Attentive reader will pay attention to the port Sub (Line) Out, designed to connect an external subwoofer, which, frankly, would be very useful for a pair of Spinnaker sails. </font><font style="vertical-align: inherit;">But the ‚Äúwired‚Äù connection is rather a pleasant bonus than the main purpose, which lies in the wireless plane.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/696/c93/c74/696c93c7417585e45de8de90cfb3dd8d.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Bluetooth pairing is absolutely standard: we wait for the blue diode to flash at the peak of the right speaker and wait a couple of seconds until the Secure Simple Pairing procedure connects two devices without entering any PIN codes. </font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/790/77a/75e/79077a75e235ffaad294af8144f3e0b3.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> As soon as the sound transmission to the external device is activated, the volume will be adjustable using the included remote control, whose button on the upper end plays the role of the Play / Pause switcher, and a long tap switches the input source (bluetooth-line_in). </font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83c/01d/814/83c01d8142ef98151227cae54fbe89ec.jpg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The console is equipped with a non-slip base cover and lights to help detect it in low light conditions. </font><font style="vertical-align: inherit;">Unfortunately, the backlighting by its brightness level only reflects the charge level of the internal battery, but does not allow us to understand in which sound source mode (Bluetooth or Line In) the audio system is.</font></font><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3d4/13a/c47/3d413ac47688f48516e2c69fd6dabe19.jpg"></div><br>  But whatever the ergonomics and behavior of the console, the most important thing in the speakers is sound.  From this point of view, Spinnaker can be viewed as the owner of the three emitters in each dynamics included in the tri-amp scheme! .. But this is written in a <a href="http://www.edifier.ru/speakers/bluetooth/bluetooth_82.html%3Ftab%3D5">press release</a> (quite filled with technical details, by the way), we will describe the subjective perception of playback quality, because it is doubtful to describe high audiophile matters in a system made of plastic, and even in an ‚Äúart‚Äù format. <br><br>  The overall impression of listening to songs of various musical directions can be estimated on a ten-point scale by 7 points.  Perhaps not for nothing, 3 pairs of emitters in the speakers are equipped with their own channels from the amplifier.  On the other hand, ‚Äúsounding‚Äù, as they say in the press release, we would not stigmatize this sound. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/548/5f2/1dc/5485f21dc56a25986cf3eee0985cb293.png"></div><br>  The Spinnaker E30 may not boast a record volume margin, but at the volume level up to 90% the sound was not broken in a rattle, and the tracks were played without audible distortion. <br><br>  The lack of deep bass, such as, for example, KMC 3 and Zeppelin Air, we write off to the absence of a large-sized diffuser, which simply did not have enough space, sacrificed to the god of design.  The largest speaker, responsible for low frequencies, is directed downwards and is located at the base of the speakers.  Thus, the ‚Äúsabs‚Äù already two, but their small size does not make your floor vibrate. <br>  However, if you have an old sub from any other system, then try to connect it to the spinnakers, this symbiosis should satisfy both you and your neighbors. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/14c/812/f65/14c812f65851b1e02fa420d6ed418669.jpg"></div><br>  The strong side of the spinnakers is, of course, in the ‚Äúnot crushed‚Äù middle frequencies and the general sound balance.  If the same Klipsch KMC 3 has a crystal sound of high frequencies can even be attributed to shortcomings, then here the top is clearly audible without an annoying protrusion. <div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b4f/c3a/937/b4fc3a937ccdd9da0f7a35d3cef88eb5.jpg"></div><br>  Let's not forget about the possibility of exploding a stereo pair.  Still, the stereo sound of the speakers living in the same package is monaural at a certain distance from them.  Having installed a pair of speakers on different sides of the table, we got a very voluminous sound picture, not tolerating the feeling of sound coming from one point. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a4b/a1f/e4d/a4ba1fe4d33eebd9303645a60860ca4b.jpg"></div><br>  The bottom line is an aggressive and memorable design, an unusual remote and a decent sound with the ability to explode a stereo base.  I think that in the economy all this is definitely useful.  In addition, the connector for connecting an external subwoofer will smooth the lack of bass for those who have built-in woofers will be sorely missed. <br><br>  There are a couple of questions on the ergonomics of the console and the device of the lodgement for cables in the aluminum base of the speakers, but it is enough to choose the most comfortable location for them once to forget about the trouble with wires. <br><br>  The answer to the question ‚ÄúCan the Spinnaker E30 be recommended in the price segment up to $ 300?‚Äù Would be ‚Äúyes‚Äù if the above described disadvantages are not critical for you.  This system cost a friend Amazon $ 279.99 + <a href="http://hellt.ru/blog/fastbox-economy-via-russian-post/">$ 55</a> for delivery, in Russia the retail price for Spinnaker E30 ranges from 11-12 tr. <br><br>  Speaking about the closest competitors, we can note the Creative ZiiSound D3x + DSx kit, which wins in the lower ranks due to the presence of a full-fledged subwoofer, but in the upper and middle parts there is a drawdown.  Top-shelf Bluetooth-acoustics, of course, cost more, and sometimes much more expensive, so is it worth overpaying for the brand, when you can get a decent sound quality and a memorable appearance now? <br><br>  <b>PS4</b> And, of course, nothing prevents us from talking <a href="http://news.cnet.com/8301-13645_3-57553309-47/before-you-buy-an-expensive-bluetooth-airplay-or-docking-speaker-read-this/">about</a> ‚Äúwireless plastic crafts in the oven, 1) buy Airport Express, 2) shelf acoustics 3) Profit.‚Äù </div><p>Source: <a href="https://habr.com/ru/post/201000/">https://habr.com/ru/post/201000/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200986/index.html">A simple way to get the left subdomain to your project, or "fable about what happens if you do not read the license agreement"</a></li>
<li><a href="../200990/index.html">YouTube Center</a></li>
<li><a href="../200992/index.html">Retouching old photos in Corel PaintShop Photo Pro</a></li>
<li><a href="../200994/index.html">Autumn Sale 2013 on Steam</a></li>
<li><a href="../200996/index.html">PaintShop Photo Pro Lessons: Restore an Old Photo I</a></li>
<li><a href="../201002/index.html">MS warns about the use of CVE-2013-3906 in-the-wild</a></li>
<li><a href="../201004/index.html">Autonomy first</a></li>
<li><a href="../201008/index.html">ScienceHub # 03: Synthetic Microbiology</a></li>
<li><a href="../201010/index.html">FileAPI 2.0: Uploading files to the server a year later</a></li>
<li><a href="../201012/index.html">R: choir map of Russia with a larger European part</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>