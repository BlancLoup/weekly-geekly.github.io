<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Io Language: Message System</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will continue the series of articles begun by the honorable semka. Let's talk about messages. 

 There are no function calls in Io, but there...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Io Language: Message System</h1><div class="post__text post__text-html js-mediator-article">  Today we will continue the series of articles <a href="http://habrahabr.ru/blog/crazydev/45584.html">begun by the</a> honorable semka.  Let's talk about messages. <br><br>  There are no function calls in Io, but there is a message sending.  A message may have arguments (almost like function arguments), but message arguments are not executed before being sent. <br><a name="habracut"></a><br><br><h1>  How messages are sent </h1> Sending a message looks like ‚Äúobject‚Äù, ‚Äúspace‚Äù, ‚Äúmessage‚Äù: <br> <code>Database connect <br></code> <br>  The message may contain arguments: <br> <code>Database findByName("Oleg") <br></code> <br>  The result of sending a message can also be sent a message: <br> <code>Database findByName("Oleg") lastName # ,  "Andreev" <br></code> <br>  In other words, the <code>abcd</code> construction is equivalent to <code>a().b().c().d()</code> in some java-like syntax. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h1>  How messages are performed </h1>  First, remember that message arguments are not executed.  If <code>Database connect(blah-blah)</code> was written, then blah-blah will not be executed before sending connect, but will be transmitted as part of the "connect (blah-blah)" message (yes, in words). <br><br>  When an object receives a message, it searches for a slot with the name of this message (in our example <code>connect</code> ).  If the slot is not found (as it usually happens), its search is performed recursively in all object prototypes and their prototypes.  If the required slot is not found anywhere, then the search for the slot <code>forward</code> started (analogous to <code>method_missing</code> in Ruby).  As soon as any suitable slot is found, its value is <em>activated</em> (activation).  (Note: the object in which the found slot lies in will tell you the Object contextWithSlot (slotName).) <br><br><h2>  Activation </h2>  For normal values, activation does nothing, just returns that value.  Thus, the activation of regular slots that store numbers, strings, or many other objects is no different from getting a value via getSlot ( <em>slotName</em> ).  But those objects that are marked as <em>activatable</em> , call the <em>activate</em> method.  By default, only two objects are activated: Block (blocks and methods) and CFunction (links to syshny functions).  All other objects can be made activated with setIsActivatable (true). <br><br>  Slot activation does not occur when the getSlot (slotName) method is called (of course, the ‚ÄúgetSlot‚Äù slot itself is activated, but the <em>slotName</em> is no longer).  Therefore, if you want to get a method or an as-is block without calling it, use getSlot (methodName). <br><br>  With activation is associated with one pitfall, which will be discussed at the end of the article. <br><br><h1>  Uh  And when are the arguments executed? </h1>  Message sent, slot found and activated.  But when and in what context will the message arguments be calculated? <br><br>  Consider an example: <br> <code>withoutArgs := method() #   nil <br> withoutArgs("Hello!" println) <br></code> <br>  This code will not output anything because the argument "Hello!" Println was not executed. <br> <code>withArgs := method(a, b, c, list(a,b,c)) #     <br> withArgs("Hello!" println) #  list("Hello!", nil, nil) <br></code> <br>  This code will execute the first argument and display Hello !.  Missing arguments will be nil. <br><br>  One more example: <br> <code>withTwoArgs := method(a, b, nil) <br> withTwoArgs(1 print, 2 print, 3 print, 4 print) <br></code> <br>  This code will print 12, but not 1234. <br><br>  The most shrewd already understood that only the declared arguments are executed.  The funny thing is how they are executed, where and where you can run your dirty hands.  And why all this is necessary. <br><br><h1>  Introspection method call </h1>  Do you still remember that in Io there are only objects, prototypes, slots and messages?  There are no global and local variables in this list. <br><br>  When Io activates a slot (that is, calls a method), it creates a special Locals object.  This is a pretty fun object with a number of important features.  First, the prototype of this object is self, i.e.  pointer to the object to which the message was sent.  Thus, we can create local slots (aka local variables) without interfering with the recipient object, as well as get access to all slots of this object.  Secondly, there are at least three slots in this object: self (points to the recipient object), call (contains a lot of information about the call), and updateSlot.  The latter is different from the usual updateSlot in that it updates the slot not in the locals, but in the receiving object.  This is done solely for the sake of convenience, to write a = b instead of self a = b. <br><br>  The most remarkable thing about the call object is a few slots: <br><ul><li>  call sender - the object (locals) in which the message was sent. <br>  call target - the object to which the message was sent (== self). <br>  A call message is actually a message containing a name and arguments. <br>  call evalArgAt (argNumber) and evalArgs executes some or all of the arguments in the context of a call sender.  But no one bothers to do something like this: <br> <code>Object do := method(call message arguments first doInContext(self) ) <br> "string" do( <br> type println <br> size println <br> encoding println <br> ) <br></code> <br>  On the screen we will see: <br> <code>Sequence <br> 6 <br> ascii <br></code> <br><br>  In other words, we can manipulate the code as we like: transfer, store, execute in arbitrary contexts.  You can see the code of the object already created: Coroutine getSlot ("yield") code will return the yield method code as a string: <br> <code>method( <br> if(yieldingCoros isEmpty, return ) <br> yieldingCoros append(self) <br> next := yieldingCoros removeFirst <br> if(next == self, return ) <br> if(next, next resume) <br> ) <br></code> <br><br>  By the way, about the prototype locals I lied.  If you still remember, besides the methods in Io there are blocks (closures).  Their only difference from the methods is that the Locals prototype for blocks is not a pointer to the recipient of the message, but a pointer to scope, i.e.  the object in which the block was created (and to which it is closed).  So that you finally leave the roof, I will add that the slot of the scope block is exactly equal to the call sender at the time of calling the block method. <br><br><h1>  Back to local variables </h1>  Possessing such a powerful weapon as call sender and call message, we can describe the method call and the execution of arguments in Io language.  Indeed, by saying method (a, b, nil), we inform that we want to create slots ‚Äúa‚Äù and ‚Äúb‚Äù in locals and fill them with values ‚Äã‚Äãthat are obtained after executing the corresponding arguments in the context of a call sender.  Homework: write the method method2, which creates the methods as well as the built-in method and performs all the necessary manipulations with doInContext for the declared and passed arguments. <br><br><h1>  Promised trick with activation </h1>  In java-like syntax, access to a function and its call are as follows: obj.func and obj.func ().  In Io, retrieving a value without activation is possible via obj getSlot ("slot"), when an obj slot necessarily activates a slot value. <br><br>  Suppose you are writing a method that can take another method as an argument: <br> <code>method(func, ...) <br></code> <br>  If you write func inside the body of a method, you will inevitably <em>call the</em> passed method.  If you just need to get its value, then you will have to access it every time via getSlot (‚Äúfunc‚Äù). <br><br><h1>  Constructing messages </h1>  The message method returns its first argument as a failed message: <br> <code>msg := message(something(arg1, arg2, arg3) nextMessage(arg1, arg2) more) <br> msg name # =&gt; "something" <br> msg next # =&gt; message(nextMessage(arg1, arg2) more) <br> msg next next # =&gt; message(more) <br> msg next name # =&gt; "nextMessage" <br> msg arguments # =&gt; list(message(arg1), message(arg2), message(arg3)) <br></code> <br><br><h1>  Summary </h1>  Now you know how messages are sent, methods are called, and arguments are executed.  I hope you understand the constructions like list (1,2,3), foreach (print) (print is sent to each element of the list) or list (1,2,3) map (* 2) (* (2) is sent to each element when creating copies of the list). <br><br><h1>  Bonus track: call sites </h1>  One and a half diggers who read to the end of the article can be rewarded with particularly delightful information.  In the concept of Io, it is possible to reach the so-called "call point".  This is not a trickle, not the context of aka "call sender", but the point of the code at which the call occurred.  The thing is that the call message always returns the same object if it is not generated on the fly, but is described in the code (well, or generated once and all the time is sent).  What does this give?  Since one method can process various messages (in different places of the program), it becomes possible to cache something useful in relevant places. <br><br>  The simplest thing is: Message setCachedResult (res) sets the computed message value to be returned when trying to send this message to somewhere.  A more complicated option: cache a special logic adapted for a specific message at a given call point. <br><br>  For example, the List map method has three implementations: with one, two, and three arguments.  In the current implementation, the check of the number of arguments occurs on each call, although it is possible to cache the desired method variant in a call message. <br>  Based on this functionality, it is possible to build more complex optimization schemes. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/29375/">https://habr.com/ru/post/29375/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../293740/index.html">Domestic telecom operators can save billions of rubles for the construction of towers</a></li>
<li><a href="../293742/index.html">Operation "secret buyer" in 50 leading web studios Runet</a></li>
<li><a href="../293744/index.html">Site testing: measure 7 times, cut once</a></li>
<li><a href="../293746/index.html">I will give the Internet in good hands: ICANN's independence day is postponed for another year</a></li>
<li><a href="../293748/index.html">Fear and hate in redesign</a></li>
<li><a href="../293750/index.html">7 signs stupid recruiter</a></li>
<li><a href="../293752/index.html">Is the patient more alive than dead? Health Survey Software Project</a></li>
<li><a href="../293754/index.html">Using multilending to raise positions and reduce prices in Yandex.Direct</a></li>
<li><a href="../293756/index.html">Interviews with suppliers: prices on request, RRP, joint procurement</a></li>
<li><a href="../29376/index.html">JFStorage: Cookies Alternative</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>