<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hosting on the edge of the world 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first article about my small hosting was published in 2010. 
 Since that time, almost 2 years have passed, servers have been added and changed, th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hosting on the edge of the world 2</h1><div class="post__text post__text-html js-mediator-article">  The first <a href="http://habrahabr.ru/post/94633/">article</a> about my small hosting was published in 2010. <br>  Since that time, almost 2 years have passed, servers have been added and changed, the structure has changed, technologies have changed.  At the moment I am preparing for the move to Novosibirsk and decided to reveal the cards and tricks of my small hosting. <br>  The article will be of interest to specialists in our vast territories, where there is still no normal ‚Äúexternal‚Äù Internet, for those who want to build a hosting with load sharing on relatively inexpensive equipment. <br><a name="habracut"></a><br>  Mainly, hosting ‚ÄúRomashka‚Äù is distinguished by a kind of implementation of the Bind and Nginx DNS server bundles. <br><img src="https://habrastorage.org/storage2/5c6/8d6/8c7/5c68d68c711bc05298e9b78d29efd501.png" alt="image"><br><h5>  Bind </h5><br>  Bind uses a wonderful thing, like view.  It allows different pre-designated recipients to report certain DNS records.  For example, if the request came from the 1.2.3.0/24 zone, then somehost.host would give the address 1.2.3.4.  If from zone 2.3.4.0/24, then the address is 2.3.4.5. <br>  Yakutsk is divided into two main areas: Backbon (group of providers) and Peering (Rostelecom).  Between them the traffic is 7 kopecks per 1 Mb.  Therefore, if the server is located in one zone, then it will be paid for clients from the second zone.  Local hosters struggled with 7 kopecks by introducing www2.some.host and other crutches.  This method is transparent to the user. <br>  An example of the named.conf.local config: <br><br>  acl rtk { <br>  1.2.3.0/24; <br>  }; <br>  acl bbn { <br>  2.3.4.0/24; <br>  }; <br><br>  view "bbn" { <br>  match-clients {bbn;  }; 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      zone "host.net" { <br>  type master; <br>  file "/etc/bind/bbn/db.host.net";  }; <br><br>  include "/etc/bind/named.conf.default-zones"; <br>  }; <br><br>  view "rtk" { <br>  match-clients {rtk;  }; <br><br>  zone "host.net" { <br>  type master; <br>  file "/etc/bind/rtk/db.host.net";  }; <br><br>  include "/etc/bind/named.conf.default-zones"; <br>  }; <br>  view "any" { <br>  match-clients {any;  }; <br><br>  zone "host.net" { <br>  type master; <br>  file "/etc/bind/any/db.host.net";  }; <br><br>  include "/etc/bind/named.conf.default-zones"; <br>  }; <br><br>  Zone files are standard, but separated into different directories. <br>  One of the downsides is manually editing the files.  I have not seen sane admin to control the view. <br>  This trick can be used to display certain structures of the left address instead of our current one.  But I did not tell you that;) <br><br><h5>  Nginx </h5><br>  At first Nginx with us stood as a frontend to heavy Apache.  Then the idea of ‚Äã‚ÄãNginx was born to put it on separate servers.  The proxy server caches static media content (mp3, avi, flv, jpg, png, etc.), and sends other requests (php, css, etc.) to Apache. <br>  At the moment, the main servers with files and databases are stored in an unknown to almost anyone.  Between them and the frontend, Hamachi raised VPN tunnels.  Why so hard? <br>  Now our little hosting is independent of providers.  We changed the communication channel, updated DNS records, reconfigured VPNs, and now even blocking by IP address is not a problem for us.  Profit!  ;) <br>  Sample config sites-enabled / host.name: <br><br>  server { <br>  listen 80; <br>  server_name <br>  <a href="http://www.host.net/">www.host.net</a> host.net; <br>  access_log /var/log/nginx/host.net.access.log; <br>  error_log /var/log/nginx/host.net.error.log; <br><br>  location / { <br>  proxy_pass <a href="http://5.6.7.8/">5.6.7.8</a> : 80 /; <br>  proxy_set_header Host $ host; <br>  proxy_set_header X-Real-IP $ remote_addr; <br>  proxy_set_header X-Forwarded-For $ proxy_add_x_forwarded_for; <br>  #proxy_redirect off; <br>  } <br><br>  location ~ *. (jpg | png | gif | jpeg | mp3 | mp4 | wav | mov | avi) $ { <br>  proxy_cache_valid 200 20000m; <br>  expires 30d; <br>  proxy_pass <a href="http://5.6.7.8/">5.6.7.8</a> : 80; <br><br>  proxy_set_header Host $ host; <br>  proxy_set_header X-Real-IP $ remote_addr; <br>  proxy_cache pagecache; <br>  } <br><br>  Do not forget to enable rpath on Apache. <br><br><h5>  Total </h5><br>  The system sometimes fails due to clumsy hands (I forgot to update the serial in all files, I made a mistake with the address in the config, etc.).  But it works and is pleased with several projects. <br>  UPD Proxy0 may not be.  From the edge frontend, requests can go directly to the root servers, which are generally located behind NAT. </div><p>Source: <a href="https://habr.com/ru/post/148288/">https://habr.com/ru/post/148288/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148283/index.html">Genetic algorithm for generating faces</a></li>
<li><a href="../148284/index.html">How to define HTTP_REFERER flash</a></li>
<li><a href="../148285/index.html">Copyright World in Miniature</a></li>
<li><a href="../148286/index.html">The largest DNS hoster Zerigo attacked</a></li>
<li><a href="../148287/index.html">XML serialization for deploying initial data in Cach√©. Part I</a></li>
<li><a href="../148289/index.html">Sergey Belousov: We invest in those who want to solve some problem, and not to make money</a></li>
<li><a href="../148290/index.html">Single space to work with accounts in Dropbox, Google Drive and Box</a></li>
<li><a href="../148291/index.html">Taming the 14th Fox again: the correct default settings</a></li>
<li><a href="../148292/index.html">How to make a group of input convenient</a></li>
<li><a href="../148294/index.html">Japan supports copyright</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>