<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Parsing formats: 3d models from the inside</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Another article about the parsing of formats, for a summer Sunday evening, is small and entertaining. This time it will be about 3d-models. The princi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Parsing formats: 3d models from the inside</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c1b/231/632/c1b23163201affff6c1d926365be6246.jpg" alt="image"><br><br>  Another article about the parsing of formats, for a summer Sunday evening, is small and entertaining.  This time it will be about 3d-models.  The principles of data storage for any model are the same, but the file formats are very diverse.  Even in the conditions of the same engine, developers strive to modify everything and cram something of their own, because in commercial versions they have the opportunity to change the engine code, and they usually use it. <br><a name="habracut"></a><br>  The main volume of any model file is made up of several large tables with data about vertices, how they are connected and how textures are stretched on them.  Let's start from the top.  A simple list with x, y, z coordinates might look like this: <br><br><img src="https://habrastorage.org/files/039/4fd/1f9/0394fd1f9c854757866492541f2ac93b.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since the coordinates most often lie in the form of 32-bit floating numbers, they are easy to recognize inside the file by repeating 4 byte digits in the 40-45 range, or for negative numbers C0-C5.  Of course there are other bytes, but these are most often.  This is because the coordinate range of the 3d model is small in terms of order, and the order is just stored in the high byte. <br><br>  Further, we need a table, where it is indicated in which order the vertices are connected in triangles.  Most often, it looks like this: <br><br><img src="https://habrastorage.org/files/f50/dc7/dce/f50dc7dce8904d21a30e22f82437167d.png"><br><br>  These are 16-bit vertex numbers, in groups of three.  Since the models usually have no more than a few hundred vertices, these numbers are small, and such a table is also easily visible visually.  In this example, one of the triangles is selected, consisting of vertices with numbers 50,51 and 52. <br><br>  And the third is a table of textural coordinates to bind the vertices to a flat texture that you want to pull on them. <br><br><img src="https://habrastorage.org/files/c50/fec/0f3/c50fec0f363a4c7d99f80a755e8ccf2b.png"><br><br>  The x and y coordinates within the texture are reduced to a range from 0 to 1, and if the texture has a size of 2048x2048 or 4096x4096, there is no point in high accuracy.  Therefore, they are most often stored as floating <a href="https://ru.wikipedia.org/wiki/%25D0%25A7%25D0%25B8%25D1%2581%25D0%25BB%25D0%25BE_%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B2%25D0%25B8%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B9_%25D1%2582%25D0%25BE%25D1%2587%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">numbers with half precision</a> , 16 bit.  The high byte they get is slightly more than 0x30, occasionally reaching 0x40 or slightly more.  Here the texture coordinates are highlighted in red and orange, the coordinates in the light map are highlighted in green and light green. <br><br>  After these tables are found, you can count the number of elements, find where this number is stored and how the entire structure is described.  But in addition to these tables in the file there are surely many small incomprehensible numbers that do not know what they mean and what they mean.  For example, in the middle of a file with a human model there are three floating units (highlighted in green): <br><br><img src="https://habrastorage.org/files/afb/edd/254/afbedd25429344008d3cca3a70a41efe.png"><br><br>  How to find out what they mean?  Yes, just change them and see what happens.  We will write 1.5 instead and run the game. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/gb7gjYWX9i0%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhieH9bEaaCfrDzhuh04Blj-z0YjUg" frameborder="0" allowfullscreen=""></iframe><br><br>  Well, of course, this is the scale.  An interesting effect is obtained from the fact that the animation is recorded in other files separately, and it is tied to the coordinates in the models, which is why there are such bizarre freaks.  A man in the square on the shoulders of a child sitting.  Now he was inside his chest.  The man in front of the barrier, making strange movements, in fact applauds. <br><br>  Now we will try to determine where the width is and where the height is.  Let's change only one number, the first: we will reduce it by 10 times. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/46MCPQIkA78%3Ffeature%3Doembed&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhi4dMXKg21IZET6MwsSeBQdSWK9aA" frameborder="0" allowfullscreen=""></iframe><br><br>  Thus, experimenting, you can determine the value of the remaining numbers.  If, however, if some of them change, nothing happens, just leave them alone.  Maybe we will never know why they are needed.  And if suddenly one day they make themselves known, then we will understand. <br><br>  Here is one of the examples when analyzing a file format is analytically easier and faster than studying an exe-file where you can get lost in the wilds of code that feeds all this information to a video subsystem. </div><p>Source: <a href="https://habr.com/ru/post/263009/">https://habr.com/ru/post/263009/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262995/index.html">Pussies: Refactoring</a></li>
<li><a href="../262997/index.html">Google Chrome has introduced additional security features for Flash Player.</a></li>
<li><a href="../263001/index.html">Overview of Docker Engine from 1.0 to 1.7. Introduction to Docker Compose</a></li>
<li><a href="../263005/index.html">How can Python and Jinja make life easier for a FPGA developer?</a></li>
<li><a href="../263007/index.html">The digest of interesting materials from the world of web development and IT for the last two weeks ‚Ññ168 (July 5 - 19, 2015)</a></li>
<li><a href="../263011/index.html">Some potential buyers need to know about Bitrix</a></li>
<li><a href="../263015/index.html">Wolfram Language (Mathematica) is just a toy</a></li>
<li><a href="../263017/index.html">Conference C ++ Siberia in Novosibirsk</a></li>
<li><a href="../263019/index.html">Web application for generating photo mosaic with lightweight threads on Go</a></li>
<li><a href="../263021/index.html">Reflection in Cach√©</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>