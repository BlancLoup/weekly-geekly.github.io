<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cluster? Easy!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day habravchane, by the nature of its activities often have to work with cluster solutions of various software products. But it would not be so i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cluster? Easy!</h1><div class="post__text post__text-html js-mediator-article"><img src="http://im4-tub-ru.yandex.net/i?id=342175130-19-72" alt="image" align="left">  Good day habravchane, by the nature of its activities often have to work with cluster solutions of various software products.  But it would not be so informative to talk about the settings of any software product, so having searched, and stumbled upon <a href="http://cluster.linux-ekb.info/">Yuri's</a> website (for which I thank him so much), I decided to develop this topic a little bit and see a performance example when calculating the Pi number in a cluster version . <br><a name="habracut"></a><br>  So, we have 4 HP servers, of which 3 servers will be merged into a cluster, and one will be the management console.  Linux SLES 10 SP2 and openMPI will be deployed on all servers, and SSH password-free access between the console and servers will also be organized. <br><br>  Let's start: <br><br>  Installing Linux with minimal system settings, the necessary packages can be delivered later.  Note that the architecture of the components of all the nodes in the cluster must be identical. <br>  <a href="http://www.open-mpi.org/">We load the openMPI</a> package on the cluster nodes, <a href="http://www.open-mpi.org/">build</a> and install them. <br>  <b>./configure</b> <b><br></b>  <b>make</b> <b><br></b>  <b>make install</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After installing openMPI, the next step in our work will be to compile the program for calculating the number Pi on each node of the cluster.  To do this, we need the <i>libopencdk</i> package, which is present in YAST, and the source code of the program for calculating the number Pi ( <a href="">flops.f</a> ).  After the package is installed, and the program is placed in the directory that will be the same on all nodes of the cluster and the management node (console), we proceed to compile the program: <br>  <b>mpif77 flops.f -o flops</b> <br><br>  Installing passwordless ssh access, everything is simple: <br><br>  1) Go to the cluster console and generate the rsa-key with the command: <br>  <b>ssh-keygen -t rsa</b> <br>  2) Copy the public console key (root / .ssh / id_rsa.pub) to all nodes of the cluster, in my case: <br>  <b>scp /root/.ssh/id_rsa.pub server1: /root/.ssh</b> <br>  3) On each cluster node we create an access file: <br>  <b>cat id_rsa.pub &gt;&gt; authorized_keys</b> <br>  Passwordless access is ready. <br><br>  The next step is to create a file with a list of nodes of all our clusters, let's call it <b>openmpi.host</b> and put it in the folder with our test program for calculating the number Pi.  Nodes in the file can be specified, either by name or simply by address.  For example: <br>  <i>192.168.0.1</i> <i><br></i>  <i>192.168.0.2</i> <i><br></i>  <i>192.168.0.3</i> <i><br></i>  <i>Servv1</i> <i><br></i>  <i>Servv2</i> <i><br></i>  <i>Servv3</i> <br><br>  So, the configuration of the console and cluster nodes is complete, go to the testing stage: <br><br>  Run the program on 1 server, for this, on the control node, run the command: <br>  <b>mpirun -hostfile /var/mpi/openmpi.host -np 1 var / mpi / flops</b> <br><br>  <i>Where:</i> <i><br></i>  <i>‚ÄìNp number of cluster nodes used in calculations.</i> <i><br></i>  <i>Calculation time (s) - time to calculate operations.</i> <i><br></i>  <i>Cluster speed (MFLOPS) - the number of floating point operations per second.</i> <i><br></i> <br><br>  We get the following result: <br><br>  Calculation time = 4.3 <br>  Cluster speed = 418 MFLOPS <br><br>  Add another server to the cluster: <br>  <b>mpirun -hostfile /var/mpi/openmpi.host -np 2 var / mpi / flops</b> <br><br>  We get the following result: <br>  Calculation time = 1.82 <br>  Cluster speed = 987 MFLOPS <br><br>  Add the last 3 server to the cluster: <br>  <b>mpirun -hostfile /var/mpi/openmpi.host -np 3 var / mpi / flops</b> <br><br>  We get the following result: <br>  Calculation time = 1.18 <br>  Cluster speed = 1530 MFLOPS <br><br>  Calculation time of operations (seconds): <br><br><img src="https://habrastorage.org/storage2/a51/b52/67b/a51b5267b086cc247ef38b4bc5518b6b.jpg"><br><br>  Number of floating point operations per second (MFLOPS): <br><br><img src="https://habrastorage.org/storage2/45c/c12/aac/45cc12aac3ebf0da0b3c774b31fa46d5.jpg"><br><br>  After analyzing the data, we can conclude that when a new node is added to the cluster, the performance of the entire system increases by (1 / N) * 100%. <br><br>  I did not set myself the goal in this article to analyze the solutions to specific applied problems on cluster solutions.  My goal was to show the efficiency of cluster systems.  As well as an example to demonstrate the architecture of building a cluster element in the network structure. <br><br>  <b>UPD:</b> <i>Thanks for the constructive criticism of <a href="http://habrahabr.ru/users/umg/" class="user_link">uMg</a> and <a href="http://habrahabr.ru/users/80x86/" class="user_link">80x86</a> , the corresponding changes were made to the article.</i> </div><p>Source: <a href="https://habr.com/ru/post/142218/">https://habr.com/ru/post/142218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142211/index.html">Minesweeper on DCPU-16</a></li>
<li><a href="../142212/index.html">Using Grab: Spider for parsing sites</a></li>
<li><a href="../142213/index.html">Open Source Photo Realism on GPU: Cycles Render</a></li>
<li><a href="../142215/index.html">Personal account for the wholesale company. Is it really that hard?</a></li>
<li><a href="../142217/index.html">Google-sponsored research struggles with fake reviews</a></li>
<li><a href="../142219/index.html">The relevance of SMBRelay attacks in modern Windows networks</a></li>
<li><a href="../142221/index.html">Duplication of an object when trying to get data from a table with the DateTime key</a></li>
<li><a href="../142222/index.html">Yandex.Money takes to the streets!</a></li>
<li><a href="../142225/index.html">The launch of Google Drive will take place in a week. All for 5 GB for free</a></li>
<li><a href="../142226/index.html">ASUS U24E Ultraportable Notebook Review</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>