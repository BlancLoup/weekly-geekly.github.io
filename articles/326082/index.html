<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Huawei HyperMetro - tested and implemented</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The main features of the third generation DSS Huawei Oceanstor at Habr√© have already been told , but there is little information about the access func...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Huawei HyperMetro - tested and implemented</h1><div class="post__text post__text-html js-mediator-article">  The main features of the third generation DSS Huawei Oceanstor at Habr√© <a href="https://habrahabr.ru/post/254593/">have already been told</a> , but there is little information about the access function to that ‚Äústretched‚Äù between sites.  We will try to close this omission.  This material was prepared as a result of the implementation of one of our customers in the banking environment. <br><br><h2>  Detailed description </h2><br>  The main purpose of HyperMetro is protection against data center failure, and only then storage system, disk shelf, etc.  The feature became available with the V300R003C00SPC100 firmware in December 2015. <br><br>  In fact, this is the provision of one-time read and write access to a logical volume that has two independent copies on the storage system, which are located on different technological sites.  The topology of the HyperMetro solution is shown below. <br><a name="habracut"></a><br>  <b>Figure 1. HyperMetro Topology</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/92b/6ef/b7b/92b6efb7b0704c479fda5897f52c9f9c.png"></div><br>  For arbitration in case of failures, Quorum is used, which is installed on the third site, has access to both arrays via Ethernet and is an application for Linux (SUSE / RHEL / Ubuntu).  Reading and writing to a distributed volume is possible from any of the sites to any of the two storage systems by exchanging locks between arrays by using a data change log (DCL), which protects against the possibility of writing from different hosts to one block.  It should also be noted that the cache entry of both storage systems runs in parallel, rather than sequentially.  The following is the writing process in HyperMetro. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Figure 2. The order of operations when writing to a distributed volume</b> <br><div style="text-align:center;"><img src="https://habrastorage.org/files/53b/1e1/7e9/53b1e17e99e74c10b989d1602ea0763d.png"></div><br>  MPIO Huawei Ultrapath (bundled with Oceanstor V3) is responsible for prioritizing local read / write to avoid cross-site traffic.  Performance balancing between sites is allowed.  It is possible to use not only FC, but also iSCSI - both for access to hosts and for replication. <br><br>  After creating the HyperMetro relationship, both volumes are considered symmetrical and equivalent.  However, in the event of a quorum failure and communication between the storage systems, a priority side is set for each of the HyperMetro relationships in order to avoid the ‚Äúsplit brain‚Äù situation.  It is possible to use consistency groups to merge several pairs of volumes.  In case of failure of one of the copies in the overwhelming majority of cases, there is no loss of access to the data. <br><br>  In the absence of a third site, HyperMetro can be used in a static mode (Static Priority Mode).  This mode provides for automatic decision-making in case of failures in favor of storage systems with a high priority (preferred site).  In case of failure of the main storage, the non-preferred array will have to start access manually, changing the priority of the HyperMetro relationship for each volume pair or consistency group.  Also, the arrays go into unqualified mode if the quorum or all access paths to it fail.  If you place a quorum on one of the sites, then if it falls, access to data on the other site will not be provided - manual switching will be required. <br><br><h3>  Pros: </h3><br><ul><li>  HyperMetro is licensed for each storage system, not for mirrored volume; </li><li>  in connection with the general third generation firmware code in the third generation Oceanstor storage system, this feature is available from 2600v3 to the 18800v3 Hi-End array; </li><li>  works not only on FC, but also on IP between two main sites; </li><li>  Replication, tiered storage, virtualization, snapshots, and other storage features on HyperMetro-protected volumes are available. </li></ul><br><h3>  Minuses: </h3><br><ul><li>  requires a separate Ethernet card to connect to the arbiter (you cannot use dedicated ports to control storage for these purposes); </li><li>  Requires installing the MPIO Ultrapath driver on the hosts. </li></ul><br><h2>  Competitive decisions </h2><br>  Due to the fact that the volume distributed between sites is technologically based on normal synchronous replication, then most of the major manufacturers already have similar solutions: HPE 3Par Peer Persistence, IBM HyperSwap, HDS Global Active Device, Fujitsu Storage Cluster, Dell Compellent Live Volume.  And apart, you can highlight data protection solutions between sites, which appeared much earlier than the above and are based on unique solutions: IBM SVC Stretched Cluster, EMC VPLEX Metro, and Netapp MetroCluster. <br><br>  In this material we did not pursue the goal to compare products from different manufacturers.  However, in the comments we will try to answer your questions regarding the comparison of any specific points in the architecture of solutions. <br><br><h2>  Implementation </h2><br>  Since HyperMetro was a new and untested function, we decided to first test together with the customer on the basis of the equipment from the demofound.  The testing used two customer server platforms connected via DWDM.  United SAN network based on two Brocade factories.  Each site has one Huawei OceanStor 5500 V3 storage system with SAS 10k rpm disks and SSD, x86 blade server farm with VMware. <br><br>  On two storage systems, LUNs are consistently created, consistency groups, and the HyperMetro relationship is configured.  After this, volumes from both storage systems are addressed to the required hosts.  Test virtual machines running IOmeter were running on the servers.  When simulating the failure of one of the storage systems, a significant drop in performance (&gt; 10%) was not observed.  When loading CPU controllers less than 50%. <br><br>  After a full setup, even hard switching off the array (pulling out the power cables from the controllers) did not lead to loss of access.  After the connection between the arrays is restored, the volumes are synchronized manually (you can configure the automatic mode in the settings of each HyperMetro relationship - Recovery Policy).  If necessary, the synchronization process can be paused, deployed, or restarted to fully resynchronize volumes.  It should be noted that access switching via another storage system does not occur if the array is manually rebooted via the graphic menu or via the command interface. <br><br>  In the process, we worked out a simulation of various failures (see table below).  The behavior of the system is fully consistent with that described in this table and in the documentation of the manufacturer. <br><table border="1"><tbody><tr><td rowspan="2" width="30" align="center">  # </td><td colspan="3" width="200" align="center">  Equipment operability </td><td colspan="3" width="200" align="center">  Connection efficiency </td><td rowspan="2" width="300" align="center">  Result </td></tr><tr><td align="center">  SHD ‚Ññ1 </td><td align="center">  Storage number 2 </td><td align="center">  Quorum </td><td align="center">  ‚Ññ1 &lt;-&gt; Q </td><td align="center">  ‚Ññ2 &lt;-&gt; Q </td><td align="center">  ‚Ññ1 &lt;-&gt; ‚Ññ2 </td></tr><tr><td align="center">  one. </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  Everything works as usual </td></tr><tr><td align="center">  2 </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td rowspan="4" align="center">  Access to this goes through a working storage system. </td></tr><tr><td align="center">  3 </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td></tr><tr><td align="center">  four. </td><td align="center">  - * </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  - </td></tr><tr><td align="center">  five. </td><td align="center">  + </td><td align="center">  - * </td><td align="center">  + * </td><td align="center">  + </td><td align="center">  - </td><td align="center">  - </td></tr><tr><td align="center">  6 </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  - </td><td align="center">  - </td><td align="center">  + </td><td rowspan="2">  Access to that goes through both storage systems.  They are for 20 sec.  go to unqualified priority mode </td></tr><tr><td align="center">  7 </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td></tr><tr><td align="center">  8.1. </td><td align="center">  + </td><td align="center">  - * </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  Access to this goes through the Priority storage system.  If Priority broke, then manual activation of access with Non-Priority storage is necessary. </td></tr><tr><td align="center">  8.2. </td><td align="center">  + </td><td align="center">  - * </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  Access to this is stopped, you need to manually enable access to the storage system </td></tr><tr><td align="center">  9. </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td rowspan="2">  Access to that goes through both storage systems. </td></tr><tr><td align="center"></td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td></tr><tr><td align="center">  eleven. </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  Arbitration occurs.  Access to this goes through the Priority storage system. </td></tr><tr><td align="center">  12. </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  - </td><td align="center">  Access to that goes through the storage system number 2. </td></tr><tr><td align="center">  13. </td><td align="center">  - </td><td align="center">  + </td><td align="center">  + </td><td align="center">  + </td><td align="center">  - </td><td align="center">  + </td><td align="center">  Access stopped.  Manual activation of access with storage No. 2 is required </td></tr></tbody></table><br>  * 4 Fall of the site with storage without quorum <br>  * 5 Fall of the storage area with quorum <br>  * 8.1 A storage breakdown occurred more than 20 seconds after item 7 <br>  * 8.2 A storage breakdown occurred less than 20 seconds after step 7 <br><br>  After successful testing, the customer has approved the target configuration.  Implementation of the solution after such testing was carried out promptly and without problems.  The system works like a clock for 5 months already.  Technical support in 24 * 7 mode is provided by our Service Center (‚ÄúJet‚Äù is the highest-level service partner of Huawei - Certified Service Partner 5-stars).  Without false modesty, we note that the customer is completely satisfied with the capabilities of HyperMetro and the performance of the solution based on OceanStor.  He plans to further increase the amount of protected data. <br><br>  The material was prepared by Dmitry Kostryukov, Senior Storage Design Engineer, Jet Infosystems. </div><p>Source: <a href="https://habr.com/ru/post/326082/">https://habr.com/ru/post/326082/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326072/index.html">Integration of 3CX with Bitrix24 - free CRM plugin</a></li>
<li><a href="../326074/index.html">Async / await: 6 reasons to forget about promises</a></li>
<li><a href="../326076/index.html">Mikrotik 6to4 automation with dynamic IPv4</a></li>
<li><a href="../326078/index.html">MASM, TASM, FASM, NASM for Windows and Linux</a></li>
<li><a href="../326080/index.html">Future API</a></li>
<li><a href="../326084/index.html">Audit of current vulnerabilities without registration and SMS</a></li>
<li><a href="../326086/index.html">Cisco CSR 1000v: Features Overview. Part 1</a></li>
<li><a href="../326088/index.html">Message based integration. Advantages and differences from other approaches</a></li>
<li><a href="../326090/index.html">Creating npm package of React components based on create-react-app</a></li>
<li><a href="../326094/index.html">Introduction to the Storage Performance Development Kit (SPDK)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>