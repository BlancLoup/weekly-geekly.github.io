<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cartesian trees by implicit key + space compression</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Before reading this article, you need to understand what a Cartesian tree is by an implicit key (this is not the topic of one article, so it‚Äôs better ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cartesian trees by implicit key + space compression</h1><div class="post__text post__text-html js-mediator-article">  Before reading this article, you need to understand what a Cartesian tree is by an implicit key (this is not the topic of one article, so it‚Äôs better to read about it <a href="http://habrahabr.ru/post/102364/">here</a> ).  Space compression is a method used to compress on a piece of data.  For example, instead of storing the set {1, 1, 1, 2, 2, 2, 3, 1, 1} we will store {1 x 3, 2 x 3, 3 x 1, 1 x 2}. <br>  Now we will try to compress space using this method and be able to perform online operations with any segment. <br><a name="habracut"></a><br>  Immediately give my implementation of such trees <br><pre><code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">treap_node</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> x, y; treap_node *l, *r, *p; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> width; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> val; <span class="hljs-comment"><span class="hljs-comment">//    void push() { //       } //  ,     void update() { x = width; if (l) x += l -&gt; x; if (r) x += r -&gt; x; if (l) l -&gt; p = this; if (r) r -&gt; p = this; //   ,    ,      } treap_node(int _width, int _val) { //   // val -  , width -    y = (rand() &lt;&lt; 16) + rand(); l = r = p = NULL; width = _width; val = _val; update(); } }; //  2  treap_node* merge(treap_node *l, treap_node *r) { if (l == NULL) return r; if (r == NULL) return l; if (l -&gt; y &gt;= r -&gt; y) { l -&gt; push(); l -&gt; r = merge(l -&gt; r, r); l -&gt; update(); return l; } else { r -&gt; push(); r -&gt; l = merge(l, r -&gt; l); r -&gt; update(); return r; } } //  1   2 void split(treap_node *t, int x, treap_node *&amp;l, treap_node *&amp;r) { if (t == NULL) { l = r = NULL; return; } t -&gt; push(); if ((t -&gt; l == NULL ? 0 : t -&gt; l -&gt; x) &gt;= x) { split(t -&gt; l, x, l, t -&gt; l); if (l != NULL) l -&gt; p = NULL; t -&gt; update(); r = t; return; } else if ((t -&gt; l == NULL ? 0 : t -&gt; l -&gt; x) + t -&gt; width &lt;= x) { split(t -&gt; r, x - (t -&gt; l == NULL ? 0 : t -&gt; l -&gt; x) - t -&gt; width, t -&gt; r, r); if (r != NULL) r -&gt; p = NULL; t -&gt; update(); l = t; return; } else { //   .       ,      treap_node *t1 = new treap_node(x - (t -&gt; l == NULL ? 0 : t -&gt; l -&gt; x), t -&gt; val); treap_node *t2 = new treap_node(t -&gt; width - t1 -&gt; width, t -&gt; val); l = merge(t -&gt; l, t1); r = merge(t2, t -&gt; r); l -&gt; p = NULL; r -&gt; p = NULL; delete(t); } }</span></span></code> </pre> <br><br>  Note that, compared with ordinary Cartesian trees, we have the width property in the structure ‚Äî the width of the segment stored at our current vertex.  And val is the value itself. <br>  Another major change is the split function. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-comment"><span class="hljs-comment">//   .       ,      treap_node *t1 = new treap_node(x - (t -&gt; l == NULL ? 0 : t -&gt; l -&gt; x), t -&gt; val); treap_node *t2 = new treap_node(t -&gt; width - t1 -&gt; width, t -&gt; val); l = merge(t -&gt; l, t1); r = merge(t2, t -&gt; r); l -&gt; p = NULL; r -&gt; p = NULL; delete(t); }</span></span></code> </pre><br>  Here another part appeared if.  Which refers to the division of the segment into 2 subsegments.  And then gluing in the left and right side. <br><br>  We will not change the merge function, since in the task for which I use it, this does not affect the asymptotics.  By this, I solve the problem of space compression, and I can respond to inquiries online.  In principle, if anyone needs it, you can rewrite the function mergege to merge two segments.  Instead of reading all possible data, setting fixed segments, and then searching for the necessary segment numbers with a binpoisk, and making the necessary changes in the segment tree, I‚Äôm doing a little if for tighter asymptotics.  Truth has to use Cartesian trees.  For me, writing is much more convenient and faster.  Maybe it will be useful to somebody. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/161093/">https://habr.com/ru/post/161093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161079/index.html">Sandy victims will be able to find their lost photos online</a></li>
<li><a href="../161081/index.html">Android in every TV: ASUS and Netgear prepare Google TV devices, according to FCC</a></li>
<li><a href="../161083/index.html">TouchDevelop - creating applications on touch devices directly from the browser</a></li>
<li><a href="../161085/index.html">About components and interfaces. Java</a></li>
<li><a href="../161089/index.html">Week Express School Imagine Cup</a></li>
<li><a href="../161095/index.html">New in Reflection for .NET 4.5</a></li>
<li><a href="../161097/index.html">Watch out for the BlackBerry Native SDK</a></li>
<li><a href="../161099/index.html">Vint Cerf: we will keep the Internet free and open!</a></li>
<li><a href="../161101/index.html">And nerds do business</a></li>
<li><a href="../161103/index.html">WSS 3.0 Update -> Sharepoint 2010 Foundation, or the right path to Disaster Recovery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>