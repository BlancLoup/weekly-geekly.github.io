<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Understand the decorators in Python'e, step by step. Step 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And again, good day to all readers! 
 Thank you for your interest in the first part of the translation, I hope the second will not disappoint you eith...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Understand the decorators in Python'e, step by step. Step 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/609/950/769/60995076914b95857da80a95ef30b98e.png"><br><h6>  And again, good day to all readers! <br>  Thank you for your interest in the first part of the translation, I hope the second will not disappoint you either. </h6><br><br>  So, in the first part of this article we made a basic acquaintance with the decorators, the principles of their work, and even wrote our own hand. <br>  However, all the decorators that we had previously considered did not have one very important functional - passing the arguments of the function being decorated. <br>  Well, correct this misunderstanding! <br><a name="habracut"></a><br><br><h4>  Passing ("forwarding") arguments to the function being decorated </h4><br>  No black magic, all we need is to actually pass the arguments on! <br><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a_decorator_passing_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function_to_decorate)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a_wrapper_accepting_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(arg1, arg2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#    print ",   :", arg1, arg2 function_to_decorate(arg1, arg2) return a_wrapper_accepting_arguments # ,    ,   , #    "",         #      @a_decorator_passing_arguments def print_full_name(first_name, last_name): print " ", first_name, last_name print_full_name("", "") # : # ,   :   #     # *</span></span></code> </pre> <br>  <i><font color="#D0D0D0">* - Approx.</font></i>  <i><font color="#D0D0D0">translator: Peter Venkman - the name of one of the Ghostbusters, the main character of <a href="http://ru.wikipedia.org/wiki/%25D0%259E%25D1%2585%25D0%25BE%25D1%2582%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B8_%25D0%25B7%25D0%25B0_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25B2%25D0%25B8%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%25D0%25BC%25D0%25B8">the cult film of the same name</a> .</font></i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Decorating methods </h4><br>  One of the important facts to be understood is that the functions and methods in Python are almost the same, except that the methods always expect the object to be a reference to the object ( <i>self</i> ) as the first parameter.  This means that we can create decorators for methods as well as for functions, just remembering about <i>self</i> . <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method_friendly_decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(method_to_decorate)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, lie)</span></span></span><span class="hljs-function">:</span></span> lie = lie - <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-comment"><span class="hljs-comment"># ,  -     :-) return method_to_decorate(self, lie) return wrapper class Lucy(object): def __init__(self): self.age = 32 @method_friendly_decorator def sayYourAge(self, lie): print " %s,     ?" % (self.age + lie) l = Lucy() l.sayYourAge(-3) # :  26,     ?</span></span></code> </pre> <br>  Of course, if we create the most general decorator and we want it to be applied to any function or method, then you should use the fact that <i>* args</i> unpacks the list of <i>args</i> , and <i>** kwargs</i> unpacks the <i>kwargs</i> dictionary: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">a_decorator_passing_arbitrary_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function_to_decorate)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#  ""    def a_wrapper_accepting_arbitrary_arguments(*args, **kwargs): print "   -?:" print args print kwargs #    *args  **kwargs #        ,    : # http://www.saltycrane.com/blog/2008/01/how-to-use-args-and-kwargs-in-python/ function_to_decorate(*args, **kwargs) return a_wrapper_accepting_arbitrary_arguments @a_decorator_passing_arbitrary_arguments def function_with_no_argument(): print "Python is cool, no argument here." #   ,   :) function_with_no_argument() # : #    -?: # () # {} # Python is cool, no argument here. @a_decorator_passing_arbitrary_arguments def function_with_arguments(a, b, c): print a, b, c function_with_arguments(1,2,3) # : #    -?: # (1, 2, 3) # {} # 1 2 3 @a_decorator_passing_arbitrary_arguments def function_with_named_arguments(a, b, c, platypus=" ?"): print "  %s, %s  %s ? %s" %\ (a, b, c, platypus) function_with_named_arguments("", "", "", platypus="!") # : #    -?: # ('', '', '') # {'platypus': '!'} #   ,    ? ! class Mary(object): def __init__(self): self.age = 31 @a_decorator_passing_arbitrary_arguments def sayYourAge(self, lie=-3): #        print " %s,     ?" % (self.age + lie) m = Mary() m.sayYourAge() # : #    -?: # (&lt;__main__ .Mary object at 0xb7d303ac&gt;,) # {} #  28,     ?</span></span></code> </pre> <br><br><h4>  Calling a decorator with various arguments </h4><br>  Great, we figured it out.  What do you say now about trying to call decorators with different arguments? <br><br>  This is not as simple as it seems, since the decorator must take a function as an argument, and we cannot just pass it on to something else. <br>  So, before showing you the solution, I would like to refresh what we already know: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  -    def my_decorator(func): print "  " def wrapper(): print " - ,  " func() return wrapper #  ,    ,   "@"-: def lazy_function(): print "zzzzzzzz" decorated_function = my_decorator(lazy_function) # :    #    "  ",     ,   : #  .   @my_decorator def lazy_function(): print "zzzzzzzz" # :   </span></span></code> </pre> <br>  As we can see, these are two similar actions.  When we write <pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@my_decorator</span></span></code> </pre>  - we simply say to the interpreter "to call a function called <i>my_decorator</i> ".  This is an important point, because this name can either lead us directly to the decorator ... and no! <br>  Let's do something scary :) <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator_maker</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"  !     : "</span></span>+\ <span class="hljs-string"><span class="hljs-string">"      ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">" - !     :    ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapped</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">" -    . "</span></span> <span class="hljs-string"><span class="hljs-string">"         . "</span></span> <span class="hljs-string"><span class="hljs-string">"     ."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> func() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"   ."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapped <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"  ."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> my_decorator <span class="hljs-comment"><span class="hljs-comment">#    .        new_decorator = decorator_maker() # : #   !     :       . #   . #    def decorated_function(): print " -  ." decorated_function = new_decorator(decorated_function) # : #  - !     :    . #    . #    : decorated_function() # : #  -    .          . #      . #  -  .</span></span></code> </pre> <br>  Long  Long  Rewrite this code without using intermediate variables: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated_function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">" -  ."</span></span> decorated_function = decorator_maker()(decorated_function) <span class="hljs-comment"><span class="hljs-comment"># : #   !     :       . #   . #  - !     :    . #    . # : decorated_function() # : #  -    .          . #      . #  -  .</span></span></code> </pre> <br>  And now again, even shorter: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@decorator_maker() def decorated_function(): print "I am the decorated function." # : #   !     :       . #   . #  - !     :    . #    . #  : decorated_function() # : #  -    .          . #      . #  -  .</span></span></code> </pre> <br>  Did you notice that we called the function after the "@" sign? :) <br><br>  Let's return, finally, to the arguments of the decorators, because if we use the function to create decorators on the fly, we can pass any arguments to it, right? <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator_maker_with_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(decorator_arg1, decorator_arg2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"  !     :"</span></span>, decorator_arg1, decorator_arg2 <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_decorator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">" - .         :"</span></span>, decorator_arg1, decorator_arg2 <span class="hljs-comment"><span class="hljs-comment">#       ! def wrapped(function_arg1, function_arg2) : print (" -    .\n" "      : \n" "\t-  : {0} {1}\n" "\t-  : {2} {3}\n" "      " .format(decorator_arg1, decorator_arg2, function_arg1, function_arg2)) return func(function_arg1, function_arg2) return wrapped return my_decorator @decorator_maker_with_arguments("", "") def decorated_function_with_arguments(function_arg1, function_arg2): print (" -         : {0}" " {1}".format(function_arg1, function_arg2)) decorated_function_with_arguments("", "") # : #   !     :   #  - .         :   #  -    . #       : # -  :   # -  :   #        #  -         :  </span></span></code> </pre> <br>  <i><font color="#D0D0D0">* - Approx.</font></i>  <i><font color="#D0D0D0">translator: in this example, the author mentions the names of the main characters of the popular series <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D0%25B1%25D0%25BE%25D0%25BB%25D1%258C%25D1%2588%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25B2%25D0%25B7%25D1%2580%25D1%258B%25D0%25B2%25D0%25B0_(%25D1%2582%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2581%25D0%25B5%25D1%2580%25D0%25B8%25D0%25B0%25D0%25BB)">‚ÄúThe Big Bang Theory‚Äù</a> .</font></i> <br>  Here it is, the desired decorator, which can pass arbitrary arguments. <br>  Of course, any variables can be arguments: <br><pre> <code class="python hljs">c1 = <span class="hljs-string"><span class="hljs-string">""</span></span> c2 = <span class="hljs-string"><span class="hljs-string">""</span></span> @decorator_maker_with_arguments(<span class="hljs-string"><span class="hljs-string">""</span></span>, c1) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorated_function_with_arguments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function_arg1, function_arg2)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">" -         : {0}"</span></span> <span class="hljs-string"><span class="hljs-string">" {1}"</span></span>.format(function_arg1, function_arg2)) decorated_function_with_arguments(c2, <span class="hljs-string"><span class="hljs-string">""</span></span>) <span class="hljs-comment"><span class="hljs-comment"># : #   !     :   #  - .         :   #  -    . #       : # -  :   # -  :   #        #  -         :  </span></span></code> </pre> <br>  Thus, we can pass any arguments to the decorator as a normal function.  We can use and unpack via <i>* args</i> and <i>** kwargs</i> if necessary. <br>  But you must always keep in mind that the decorator is called <b>exactly once</b> .  Exactly at the moment when Python imports your script.  After that, we can no longer change the arguments with which. <br>  When we write " <i>import x</i> " all functions from <i>x are</i> <b>decorated immediately</b> , and we can no longer change anything. <br><br><h4>  A little practice: write decorator decorator </h4><br>  If you read up to this point and still in the ranks - here is a bonus from me. <br>  This small trick will allow you to turn any ordinary decorator into a decorator who takes arguments. <br>  Initially, to get the decorator to take arguments, we created it using another function. <br>  We wrapped our decorator. <br>  Do we have something to wrap the function? <br>  Exactly, decorators! <br><br>  Let's have a little fun and write a decorator for decorators: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decorator_with_args</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(decorator_to_enhance)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""        .     ,    .    .        ,       ,    ,  ,    . """</span></span> <span class="hljs-comment"><span class="hljs-comment">#     ,      : def decorator_maker(*args, **kwargs): #    ,      # ,    ,   "" def decorator_wrapper(func): #   ,     , ,    #   ( ). #    ,        # decorator(func, *args, **kwargs) # ,     return decorator_to_enhance(func, *args, **kwargs) return decorator_wrapper return decorator_maker</span></span></code> </pre> <br>  It can be used like this: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,         :-) #   ,      "decorator(func, *args, **kwargs)" @decorator_with_args def decorated_decorator(func, *args, **kwargs): def wrapper(function_arg1, function_arg2): print "  ...:", args, kwargs return func(function_arg1, function_arg2) return wrapper #       ,   : @decorated_decorator(42, 404, 1024) def decorated_function(function_arg1, function_arg2): print "", function_arg1, function_arg2 decorated_function(" ", " ") # : #   ...: (42, 404, 1024) {} #      # !</span></span></code> </pre> <br>  I think I know how you feel right now. <br>  The last time you experienced this feeling was listening to how they say to you: ‚ÄúTo understand recursion, you must first understand recursion.‚Äù <br>  But now you are glad that you have dealt with this?;) <br><br><h4>  Recommendations for working with decorators </h4><br><ul><li>  Decorators were introduced in Python 2.4, so find out what your code will run on. </li><li>  Decorators slow down the function call somewhat, do not forget about it. </li><li>  You cannot ‚Äúuncover‚Äù a function.  Of course, there are tricks to create a decorator that can be detached from the function, but this is a bad practice.  It will be more correct to remember that if the function is decorated, it will not be canceled. </li><li>  Decorators wrap features that can make debugging difficult. </li></ul><br>  The last problem was partially solved in Python 2.5, adding a <i>functools</i> module to the standard library, which includes <i>functools.wraps</i> , which copies all the information about the function being wrapped (its name, from which <s>district it</s> is, its docstrings, etc.) to the wrapper function . <br>  The fun fact is that <i>functools.wraps</i> is in itself a decorator. <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   ,     __name__ . def foo(): print "foo" print foo.__name__ # : foo # ,     : def bar(func): def wrapper(): print "bar" return func() return wrapper @bar def foo(): print "foo" print foo.__name__ # : wrapper # "functools"      import functools def bar(func): #  "wrapper"  "func" #   : @functools.wraps(func) def wrapper(): print "bar" return func() return wrapper @bar def foo(): print "foo" print foo.__name__ # : foo</span></span></code> </pre> <br><h4>  How can decorators be used? </h4><br>  And finally, I would like to answer the question that I often hear: why do we need decorators?  How can they be used? <br>  Decorators can be used to extend the functionality of functions from third-party libraries (the code of which we cannot change), or to simplify debugging (we don‚Äôt want to change the code that has not yet been settled). <br>  It is also useful to use decorators to extend various functions with the same code, without rewriting it again each time, for example: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">benchmark</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" ,  ,     . """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> time <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> t = time.clock() res = func(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> func.__name__, time.clock() - t <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logging</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" ,   . (,    ,      !) """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> res = func(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> func.__name__, args, kwargs <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">counter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(func)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" ,       . """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wrapper</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> wrapper.count += <span class="hljs-number"><span class="hljs-number">1</span></span> res = func(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"{0}  : {1}x"</span></span>.format(func.__name__, wrapper.count) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res wrapper.count = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> wrapper @benchmark @logging @counter <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reverse_string</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(string)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str(reversed(string)) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> reverse_string(<span class="hljs-string"><span class="hljs-string">"     "</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> reverse_string(<span class="hljs-string"><span class="hljs-string">"A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!"</span></span>) <span class="hljs-comment"><span class="hljs-comment"># : # reverse_string ('     ',) {} # wrapper 0.0 # reverse_string  : 1x #       # reverse_string ('A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!',) {} # wrapper 0.0 # reverse_string  : 2x # !amanaP :lanac a ,noep a ,stah eros ,raj a ,hsac ,oloR a ,tur a ,mapS ,snip ,eperc a ,)lemac a ro( niaga gab ananab a ,gat a ,nat a ,gab ananab a ,gag a ,inoracam ,elacrep ,epins ,spam ,arutaroloc a ,shajar ,soreh ,atsap ,eonac a ,nalp a ,nam A</span></span></code> </pre> <br>  Thus, decorators can be applied to any function by expanding its functionality and without rewriting a single line of code! <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> httplib @benchmark @logging @counter <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_random_futurama_quote</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> conn = httplib.HTTPConnection(<span class="hljs-string"><span class="hljs-string">"slashdot.org:80"</span></span>) conn.request(<span class="hljs-string"><span class="hljs-string">"HEAD"</span></span>, <span class="hljs-string"><span class="hljs-string">"/index.html"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key, value <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> conn.getresponse().getheaders(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> key.startswith(<span class="hljs-string"><span class="hljs-string">"xb"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> key.startswith(<span class="hljs-string"><span class="hljs-string">"xf"</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">", ...  !"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> get_random_futurama_quote() <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> get_random_futurama_quote() <span class="hljs-comment"><span class="hljs-comment">#outputs: #get_random_futurama_quote () {} #wrapper 0.02 #get_random_futurama_quote  : 1x #The laws of science be a harsh mistress. #get_random_futurama_quote () {} #wrapper 0.01 #get_random_futurama_quote  : 2x #Curse you, merciful Poseidon!</span></span></code> </pre> <br>  Python includes such decorators as <i>property, staticmethod</i> , etc. <br>  In Django, decorators are used to control caching, control access rights and define address handlers.  In Twisted, to create fake asynchronous inline calls. <br>  Decorators open the widest scope for experiments!  And I hope that this article will help you in its development! <br>  Thanks for attention! <br><br>  Content: <br><ul><li>  <a href="http://habrahabr.ru/post/141411/">Step 1. Basic understanding of decorators</a> </li><li>  <a href="http://habrahabr.ru/post/141501/">Step 2. Advanced use of decorators</a> <i>(you have now read this article)</i> </li></ul><br>  <i>Note</i>  <i>translator:</i> <i><br></i>  <i>I would be grateful for any comments on the translation and design.</i>  <i>I hope the second part of the article will seem to you more obscure and useful than the first.</i> </div><p>Source: <a href="https://habr.com/ru/post/141501/">https://habr.com/ru/post/141501/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141494/index.html">Go for IT. Part two</a></li>
<li><a href="../141497/index.html">20 trends in the mobile gaming industry</a></li>
<li><a href="../141498/index.html">A new version of the package manager NuGet 1.7 has been released.</a></li>
<li><a href="../141499/index.html">Electronics MK-85 and information security - the continuation of the story</a></li>
<li><a href="../141500/index.html">Let's Talk About Control</a></li>
<li><a href="../141503/index.html">State machines. We write DKA</a></li>
<li><a href="../141504/index.html">Android application architecture. Part IV - integration level</a></li>
<li><a href="../141505/index.html">The program for cutting bread</a></li>
<li><a href="../141506/index.html">Freedom is worse than non-freedom</a></li>
<li><a href="../141507/index.html">Implementing exceptions on plain C</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>