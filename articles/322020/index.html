<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Derandomization of the ASLR on any modern processor using JavaScript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recording cache accesses by the memory management unit (MMU) in the processor as pages are called up using a special pattern designed to detect differ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Derandomization of the ASLR on any modern processor using JavaScript</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/31b/585/95d/31b58595d257452e96cc243f05124855.png"><br>  <i>Recording cache accesses by the memory management unit (MMU) in the processor as pages are called up using a special pattern designed to detect differences between different levels of the table hierarchy.</i>  <i>For example, the ‚Äúladder‚Äù pattern (on the left) indicates the first level of the hierarchy, that is, PTL1, when calling up 32K pages.</i>  <i>For other levels of the hierarchy, there are also methods for identifying</i> <br><br>  Five researchers from the Free University of Amsterdam (Netherlands) proved the fundamental vulnerability of the ASLR memory protection technique on modern processors.  They posted the <a href="https://github.com/vusec/revanc">source code</a> and a detailed description of <a href="https://www.vusec.net/projects/anc/">the AnC attack</a> (ASLR‚äïCache), which affects almost all processors. <br><br>  The researchers checked AnC on 22 processors of different architectures - and did not find one that would be protected from such an attack on a third-party channel.  This is understandable, because in all processors a dynamic translation buffer is used to cache memory addresses, which are translated into virtual addresses.  You can protect yourself from this attack only by disabling the processor cache. <br><a name="habracut"></a><br>  Address Space Placement Randomization (ASLR) is a technology used in operating systems that randomly changes the location of important data structures in the process address space, namely, executable file images, loadable libraries, heaps, and stacks.  The technology was created to complicate the exploitation of several types of vulnerabilities.  It is supposed that it should protect memory from exploits with buffer overflow - ostensibly ASLR will not allow an attacker to know at what specific address data structures are placed after overflow, where you can write the shellcode. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the past, researchers have shown several times that ASLR protection can be circumvented in some cases.  For example, if an attacker has full rights in the system, he can break the ASLR at the kernel level of the OS.  But in typical conditions - against attack through a browser - ASLR was considered to be quite reliable protection.  Now there is no. <br><br>  In 2016, the same group of Dutch experts showed how to bypass JavaScript ASLR protection in the Microsoft Edge browser using JavaScript, using a third-party memory deduplication channel.  Microsoft quickly turned off memory deduplication to protect its users.  But this did not solve the ASLR problem at a fundamental level, related to the operation of the memory management unit (MMU) itself in processors. <br><br>  In modern processors, the MMU module uses cache hierarchy to improve the performance of traversing hierarchical page tables in memory.  This is an essential feature of modern processors.  The root of the problem is that the L3 cache is available for any third-party applications, including JavaScript scripts from the browser. <br><br><img src="https://habrastorage.org/files/a85/c5f/b31/a85c5fb31dc94e5bac75b657e0be2924.png"><br>  <i>Memory organization in a modern Intel processor</i> <br><br>  Hackers managed to determine by JavaScript means which pages in the page tables most often refer to the MMU module.  The accuracy of the determination is quite sufficient for bypassing the ASLR even with an entropy of 36 bits. <br><br><h1>  Principle of attack </h1><br>  The principle of attack ASLR‚äïCache is based on the fact that as a result of the passage of the MMU on the page tables, they are written to the processor cache.  This operation is also carried out during the translation of a virtual address into the corresponding physical address in memory.  Thus, a dynamic translation buffer (TLB) in each processor always stores the most recent address translation. <br><br>  If there is a miss past the TLB cache, then the MMU module will have to go through all the tables of the pages of a particular process (also stored in the main memory) in order to perform the translation.  To improve MMU performance in this situation, page tables are cached in the fast cache of the L3 processor to speed up access to them. <br><br>  It turns out that when using the ASLR security mechanism, the page tables themselves become the keeper of secret information: the initial number of the page table entry (in offset) at each level contains a part of the secret virtual address that was used during the translation. <br><br><img src="https://habrastorage.org/files/25f/4cd/c3a/25f4cdc3a6ac42eba3018cf024b61725.png"><br>  <i>MMU pass through the page table for translation of the address 0x644b321f4000 to the corresponding memory page on the x86_64 architecture</i> <br><br>  Hackers developed a special memory scanning technique (they needed better timers than browsers) to determine the cache sets (specific lines in the direct display sectional cache) that the MMU accesses after targeting the page tables when data pointer dereferencing or execution instruction code.  Since only certain addresses can correspond to specific sets of caches, obtaining information about these sets gives the initial record numbers of the necessary page table entries at each level of the hierarchy ‚Äî and thus derandomizes ASLR. <br><br>  Researchers tested the exploit in Chrome and Firefox on 22 modern processors and showed its successful work. <br><br><img src="https://habrastorage.org/files/23d/757/70a/23d75770a4a641db83f1f51953a440eb.png"><br>  <i>The success of the attack in Chrome and Firefox and the percentage of false positives</i> <br><br>  Even built-in protection mechanisms like intentional breakdowns by browser developers of accurate JavaScript timer <code>performance.now()</code> do not help. <br><br><img src="https://habrastorage.org/files/c68/1b7/7af/c681b77aff06493e904eee90bb00a496.png"><br>  <i>Broken timer performance.now () in Chrome and Firefox</i> <br><br>  The authors of the exploit wrote their own timer. <br><br>  <b>Firefox Attack Show</b> <br><iframe width="560" height="315" src="https://www.youtube.com/embed/qGuZjOoArRw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  The attack is tested on the following processors: <br><br><table><tbody><tr><td>  <strong>Processor model</strong> </td><td>  <strong>Microarchitecture</strong> </td><td>  <strong>Year</strong> </td></tr><tr><td>  Intel Xeon E3-1240 v5 </td><td>  Skylake </td><td>  2015 </td></tr><tr><td>  Intel Core i7-6700K </td><td>  Skylake </td><td>  2015 </td></tr><tr><td>  Intel Celeron N2840 </td><td>  Silvermont </td><td>  2014 </td></tr><tr><td>  Intel Xeon E5-2658 v2 </td><td>  Ivy bridge ep </td><td>  2013 </td></tr><tr><td>  Intel Atom C2750 </td><td>  Silvermont </td><td>  2013 </td></tr><tr><td>  Intel Core i7-4500U </td><td>  Haswell </td><td>  2013 </td></tr><tr><td>  Intel Core i7-3632QM </td><td>  Ivy bridge </td><td>  2012 </td></tr><tr><td>  Intel Core i7-2620QM </td><td>  Sandy bridge </td><td>  2011 </td></tr><tr><td>  Intel Core i5 M480 </td><td>  Westmere </td><td>  2010 </td></tr><tr><td>  Intel Core i7 920 </td><td>  Nehalem </td><td>  2008 </td></tr><tr><td>  AMD FX-8350 8-Core </td><td>  Piledriver </td><td>  2012 </td></tr><tr><td>  AMD FX-8320 8-Core </td><td>  Piledriver </td><td>  2012 </td></tr><tr><td>  AMD FX-8120 8-Core </td><td>  Bulldozer </td><td>  2011 </td></tr><tr><td>  AMD Athlon II 640 X4 </td><td>  K10 </td><td>  2010 </td></tr><tr><td>  AMD E-350 </td><td>  Bobcat </td><td>  2010 </td></tr><tr><td>  AMD Phenom 9550 4-Core </td><td>  K10 </td><td>  2008 </td></tr><tr><td>  Allwinner A64 </td><td>  ARM Cortex A53 </td><td>  2016 </td></tr><tr><td>  Samsung Exynos 5800 </td><td>  ARM Cortex A15 </td><td>  2014 </td></tr><tr><td>  Samsung Exynos 5800 </td><td>  ARM Cortex A7 </td><td>  2014 </td></tr><tr><td>  Nvidia Tegra K1 CD580M-A1 </td><td>  ARM Cortex A15 </td><td>  2014 </td></tr><tr><td>  Nvidia Tegra K1 CD570M-A1 </td><td>  ARM Cortex A15;  LPAE </td><td>  2014 </td></tr></tbody></table>  Unfortunately, the description of this technology in the public domain can again make effective the old methods of attacking the cache, from which, it seems, have long been protected. <br><br>  At the moment, the AnC attack is documented in four security bulletins: <br><br><ul><li>  CVE-2017-5925 - for Intel processors; </li><li>  CVE-2017-5926 - for AMD processors; </li><li>  CVE-2017-5927 - for ARM processors; </li><li>  CVE-2017-5928 - for javascript-tayer in different browsers. </li></ul><br>  According to the authors, the only way to protect the user is to use programs like NoScript, which blocks the execution of third-party JavaScript scripts in the browser. </div><p>Source: <a href="https://habr.com/ru/post/322020/">https://habr.com/ru/post/322020/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322008/index.html">Create a development application using Android Studio</a></li>
<li><a href="../322010/index.html">RDPPatcher sells access to your computer at a low price.</a></li>
<li><a href="../322012/index.html">Public data management: preparation and delivery</a></li>
<li><a href="../322016/index.html">My is an idea, yours is a program, or three real stories about how the author of the idea and the developer shared a startup in court.</a></li>
<li><a href="../322018/index.html">Convenient memo and 8 references to documentation in accordance with GOST 34 (automated systems)</a></li>
<li><a href="../322022/index.html">Science on guard of interfaces: how to make buttons in the application really comfortable</a></li>
<li><a href="../322024/index.html">VectorDrawable - Part Three</a></li>
<li><a href="../322026/index.html">Kotlin compiler message types to use in Suppress</a></li>
<li><a href="../322028/index.html">Friday format: myths about the ideal workplace</a></li>
<li><a href="../322030/index.html">How I got a job at the Stack Exchange</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>