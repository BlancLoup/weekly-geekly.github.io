<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a PDF book from a web comic with C # using the example of xkcd</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Looking at the new xkcd release, I looked at my newly acquired Sony PRS-650 electric book, and immediately thought - I want to watch comics on it! Xkc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a PDF book from a web comic with C # using the example of xkcd</h1><div class="post__text post__text-html js-mediator-article"><img align="left" alt="Sony PRS-650 and xkcd" src="https://habrastorage.org/getpro/habr/post_images/7be/bda/e7b/7bebdae7b6f86d987a07e0f344acf2f5.jpg">  Looking at the new <a href="http://xkcd.com/">xkcd</a> release, I looked at my newly acquired Sony PRS-650 electric book, and immediately thought - I want to watch comics on it!  Xkcd is just black and white and usually small in size.  Slightly googling, I found only a collection of pictures on TPB, and a script for bash, which should make PDF.  I decided to poke around a little bit in programming and make a comic book grabber on my favorite C #. <br><br>  It would be possible to do with the console application, but, for clarity, I made a simple interface on WPF. <br><br><a name="habracut"></a><br>  A complete code review will be redundant, so I will explain the main points.  I recommend immediately open / download the full application code with <a href="http://code.google.com/p/webcomic-grabber/">Google Code</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <br><br><br><br><h2>  1. Get pictures, titles and alt-text from the site </h2><br>  On xkcd comics are conveniently located at addresses like <a href="http://xkcd.com/n/">xkcd.com/n</a> , where n = 1 ... <br>  The first thought was to rip out the necessary from the page code, but it turned out that you can get all the information in JSON at <a href="http://xkcd.com/">xkcd.com</a> {0} / info.0.json <br><br>  For JSON in .NET there is a DataContractJsonSerializer <br>  Create the appropriate DataContract: <br><br><pre><code class="hljs vbscript">[DataContract] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> XkcdComic { #region <span class="hljs-keyword"><span class="hljs-keyword">Public</span></span> properties <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> indexers [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> img { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-built_in"><span class="hljs-built_in">month</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> num { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> link { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-built_in"><span class="hljs-built_in">year</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> news { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> safe_title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> transcript { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> <span class="hljs-built_in"><span class="hljs-built_in">day</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [DataMember] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> alt { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } #endregion }</code> </pre> <br><br>  ... and use: <br><pre> <code class="hljs cs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> XkcdComic </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetComic</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> url</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebClient().OpenRead(url); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (stream == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serializer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataContractJsonSerializer(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> (XkcdComic)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serializer.ReadObject(stream) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> XkcdComic; }</code> </pre><br><br>  At <a href="">xkcd.com/info.0.json,</a> you can get the latest comic, and by taking its number from the num field, find out their total number. <br>  It remains to deflate the picture itself, everything is simple: <br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imageBytes = <span class="hljs-type"><span class="hljs-type">WebRequest</span></span>.<span class="hljs-type"><span class="hljs-type">Create</span></span>(comicInfo.img).<span class="hljs-type"><span class="hljs-type">GetResponse</span></span>().<span class="hljs-type"><span class="hljs-type">GetResponseStream</span></span>().<span class="hljs-type"><span class="hljs-type">ToBytes</span></span>();</code> </pre><br>  ... where comicInfo is our data from JSON, and ToBytes () is a simple extension-method that reads data from a stream into an array. <br><br>  The comic class is used to represent a comic strip (comic strip, or how to correctly name it in the singular?).  To validate the received bytes of the picture (we could download something wrong, the server could return an error, etc.) the class constructor was made private, and the factory Create method was added, which returns null in case of a decoding error.  BitmapImage is used for decoding, which, if successful, will be used as a thumbnail to preview the result: <br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static Comic <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(byte[] imageBytes) { try { // <span class="hljs-keyword"><span class="hljs-keyword">Validate</span></span> image bytes <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> trying <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> a Thumbnail. <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Comic {ImageBytes = imageBytes}; } catch { // Failure, cannot decode bytes <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } } <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> byte[] ImageBytes { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _imageBytes; } private <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _imageBytes = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; var bmp = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> BitmapImage(); bmp.BeginInit(); bmp.DecodePixelHeight = <span class="hljs-number"><span class="hljs-number">100</span></span>; // <span class="hljs-keyword"><span class="hljs-keyword">Do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> store whole picture bmp.StreamSource = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MemoryStream(_imageBytes); bmp.EndInit(); bmp.<span class="hljs-keyword"><span class="hljs-keyword">Freeze</span></span>(); Thumbnail = bmp; } }</code> </pre><br><br>  Putting it all together, we get a method for downloading a comic strip by its number: <br><pre> <code class="hljs pgsql"> protected override Comic GetComicByIndex(<span class="hljs-type"><span class="hljs-type">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">index</span></span>) { // Download comic <span class="hljs-type"><span class="hljs-type">JSON</span></span> var comicInfo = GetComic(string.Format(UrlFormatString, <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comicInfo == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; // Download picture var imageStream = WebRequest.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(comicInfo.img).GetResponse().GetResponseStream().ToMemoryStream(); var comic = Comic.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(imageStream.GetBuffer()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (comic == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; comic.Description = comicInfo.alt; comic.Url = comicInfo.link; comic.<span class="hljs-keyword"><span class="hljs-keyword">Index</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">index</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>; comic.Title = comicInfo.title; // Auto-rotate <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> best fit var t = comic.Thumbnail; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t.Width &gt; t.Height) { comic.RotationDegrees = <span class="hljs-number"><span class="hljs-number">90</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> comic; }</code> </pre><br><br>  Thus, we have the number of comics and the method to get a strip by index. <br><br><h3>  Parallel downloads </h3><br>  I will use the <a href="http://msdn.microsoft.com/en-us/library/dd460717.aspx">Task Parallel Library</a> , since I was going to try it for a long time, but there was no reason.  At first glance, everything is simple, instead of a direct call to GetComicByIndex (i), everything is done in a var task = Task.Factory.StartNew (() =&gt; GetComicByIndex (i)).  We write all the running tasks into the tasks array and do Task.WaitAll (tasks), after which we get the results of each task from task.Result.  But this approach will not allow us to track progress and show already loaded strips to the user.  To solve this problem, we will use WaitAny and yield return to return the result of each task immediately upon completion: <br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> IEnumerable&lt;Comic&gt; GetComics() { var count = GetCount(); var tasks = Enumerable.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>, count).<span class="hljs-keyword"><span class="hljs-keyword">Select</span></span>(GetTask).ToList(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (tasks.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) // Iterate <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> tasks complete { var task = tasks.WaitAnyAndPop(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.Result != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) yield <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task.Result; } }</code> </pre><br><br>  Here, the GetTask method returns the GetComicByIndex (i) task, plus error handling and caching (this is beyond the scope of this article).  The WaitAnyAndPop - extension method, which waits for the completion of one of the tasks, removes it from the list and returns: <br><pre> <code class="hljs php">WaitAnyAndPop ‚Äî extension ,      ,      : <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Task&lt;T&gt; WaitAnyAndPop&lt;T&gt;(this <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>&lt;Task&lt;T&gt;&gt; taskList) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> = taskList.ToArray(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> task = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>[Task.WaitAny(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>)]; taskList.Remove(task); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> task; }</code> </pre><br><br>  Now in the ViewModel code (I do not consider architectural issues in this article, but MVVM (Model-View-ViewModel) is the de facto standard for WPF applications, and the code for pumping, exporting and other things, of course, is broken down into the corresponding classes) we can iterate over the result of the GetComics method in the background thread and show the user the strips as they arrive: <br><pre> <code class="hljs javascript"> private readonly Dispatcher _dispatcher; private readonly ObservableCollection&lt;Comic&gt; _comics = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObservableCollection&lt;Comic&gt;<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">private</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StartGrabbing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_dispatcher</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Dispatcher</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">CurrentDispatcher</span></span></span><span class="hljs-function">; // </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ObservableCollection</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">modifications</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">should</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">be</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">performed</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">on</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">the</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">UI</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">thread</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ThreadPool</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">QueueUserWorkItem</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">o =&gt; DoGrabbing(</span></span></span><span class="hljs-function">)); } </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">private</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">DoGrabbing</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">grabber</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">new</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">XkcdGrabber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">foreach</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> comic </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> grabber.GetComics(</span></span></span><span class="hljs-function">)) { </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">var</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">comic</span></span></span><span class="hljs-function">; </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">_dispatcher</span></span></span><span class="hljs-function">.</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Invoke</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Action</span></span></span><span class="hljs-function">) (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span></span><span class="hljs-function">) =&gt;</span></span> Comics.Add( c )), DispatcherPriority.ApplicationIdle); } }</code> </pre><br><br><h2>  2. Display comics in WPF </h2><br>  In the XAML code, all we have to do is bind to our ObservableCollection, and prepare the corresponding DataTemplate to observe the loading process and the comics themselves, with the alt text in the Tooltip: <br><pre> <code class="hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ItemsSource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Comics}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ScrollViewer.VerticalScrollBarVisibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Disabled"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">x:Name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"list"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5,0,5,0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ScrollViewer.HorizontalScrollBarVisibility</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Visible"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Grid.Row</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsControl.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Border</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderBrush</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Gray"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">CornerRadius</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Padding</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">BorderThickness</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Vertical"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Index}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontWeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bold"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TextBlock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Title}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">FontWeight</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Bold"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Margin</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10,0,0,0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Image</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Source</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Thumbnail}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ToolTip</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Description}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Thumbnail.PixelHeight}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{Binding Thumbnail.PixelWidth}"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Border</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">DataTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsControl.ItemTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsControl.ItemsPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsPanelTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">StackPanel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Horizontal"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsPanelTemplate</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemsControl.ItemsPanel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ListView</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br><h2>  3. Create a PDF book </h2><br>  PDF is chosen because of its popularity and good support in Sony electric books.  To work with PDF in .NET there is a convenient open source library <a href="http://sourceforge.net/projects/itextsharp/">iTextSharp</a> (you will need to download it separately to build the project).  Everything is pretty simple-minded.  Omitting exception handling, adjusting the size of the image and fonts, we get the following: <br><pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> <span class="hljs-built_in"><span class="hljs-built_in">document</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Document(PageSize.LETTER); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wri = PdfWriter.GetInstance(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileStream(fileName, FileMode.Create)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Open(); foreach (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> comic <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> comics.OrderBy(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">c</span></span></span><span class="hljs-function"> =&gt;</span></span> c.Index).ToList()) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> image = Image.GetInstance(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemoryStream(comic.ImageBytes)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paragraph(comic.Index + <span class="hljs-string"><span class="hljs-string">". "</span></span> + comic.Title, titleFont); title.SetAlignment(<span class="hljs-string"><span class="hljs-string">"Center"</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Add(title); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Add(image); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Phrase(comic.Description, altFont)); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Add(Chunk.NEXTPAGE); } <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.Close();</code> </pre><br><br><h2>  results </h2><br>  It turned out here is an application that, in addition to exporting to PDF, makes it quite convenient to view comics: <br><br><img alt="Webcomic Grabber Screenshot" src="https://habrastorage.org/getpro/habr/post_images/e6f/7ca/039/e6f7ca039659067ae09f2858cb0bf7c5.png"><br><br>  How the result looks like on the book can be seen on the first picture of the article. <br><br><h3>  What remains beyond the scope of the article </h3><br>  Cache the loaded data between application launches (done using IsolatedStorage). <br>  Support for other webcomixes (For this purpose, I pre-allocated the IGrabber interface, and brought some of the functionality to TaskParallelGrabber. While writing the article, I added grabbers for WhatTheDuck and Cyanide &amp; Happiness). <br><br><h3>  Links </h3><br>  Application Code (C #): <a href="http://code.google.com/p/webcomic-grabber/">Google Code</a> <br>  Working with PDF on .NET: <a href="http://sourceforge.net/projects/itextsharp/">iTextSharp</a> <br>  Comics: <a href="http://xkcd.com/">xkcd</a> <br><br>  <b>UPD:</b> <br>  Thanks to <a href="https://habrahabr.ru/users/xhunter/" class="user_link">XHunter for uploading the</a> <a href="http://ge.tt/5h7Gj4S">resulting PDF</a> and <a href="http://ge.tt/2dvHj6c">compiled program</a> ! <br><br>  <b>UPD2:</b> <br>  I will simply leave here a link to a good ‚Äúresponse‚Äù article, which reveals in detail the topic of pumping out comics using WCF: <a href="http://darren-brown.com/%3Fp%3D37">http://darren-brown.com/?p=37</a> </div><p>Source: <a href="https://habr.com/ru/post/112965/">https://habr.com/ru/post/112965/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112960/index.html">Using Deferred Objects in jQuery 1.5</a></li>
<li><a href="../112961/index.html">Microsoft Data Center Security</a></li>
<li><a href="../112962/index.html">Prefixes for Microsoft business critical applications</a></li>
<li><a href="../112963/index.html">Google launched a website with painting</a></li>
<li><a href="../112964/index.html">Is the trademark owner always right?</a></li>
<li><a href="../112966/index.html">Rewrite project from Zend Framework to Rails</a></li>
<li><a href="../112968/index.html">Moving from SVN to Mercurial: personal experience</a></li>
<li><a href="../112969/index.html">So we put a factory into your algorithm or how not to consider factorials</a></li>
<li><a href="../112973/index.html">33needs allows you to become a startup investor</a></li>
<li><a href="../112974/index.html">ACM ICPC World Programming Championship Final moved</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>