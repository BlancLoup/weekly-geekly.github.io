<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Php template engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I don‚Äôt know how to write at all, usually only the code comes out, but I will try :) 
 I haven‚Äôt got used to the ability to use someone else‚Äôs ready-m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Php template engine</h1><div class="post__text post__text-html js-mediator-article"> I don‚Äôt know how to write at all, usually only the code comes out, but I will try :) <br>  I haven‚Äôt got used to the ability to use someone else‚Äôs ready-made solutions when developing websites and therefore I‚Äôm writing a lot myself, perhaps by analogy, but with full understanding and hope that in the future I can figure out this code.  Somehow I got a question saying why are you writing your engine if you have a bunch of ready-made ones, take them and upgrade them for your purpose: connect the modules, tune and clog the database.  As a matter of fact, I couldn‚Äôt answer, but I gave the idea - I like the code, and generally understand the new one. <br>  Well, actually what I mean.  In the next alteration of my engine I decided to write something like a template engine.  There used to be an option, but not so convenient that you had to rule a lot, watch over many. <br><br>  I read articles on this topic and somehow did not find anything new, except for one implementation. <br><a name="habracut"></a><br>  The bottom line was that the template was a text file of the form <br> <code><code>[*IF(blabla):*]  present[*ELSE:*]   [*ENDIF*] <br> ............. <br> <br>    php,   [*  &lt;?  *]  ?&gt; <br>      str_replace(array('[*','*]'), array('&lt;?','?&gt;'))</code> <br>      php   .             <br> <code>ob_start(); <br> error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING); <br> include($templateCache); <br> error_reporting(E_ALL); <br> $text = ob_get_contents(); <br> ob_end_clean(); <br></code> <br> <br>          ,   <br> <code>ob_start(); <br> error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING); <br> eval('?&gt;'.$codeFromTemplate.'&lt;?'); <br> error_reporting(E_ALL); <br> $text = ob_get_contents(); <br> ob_end_clean(); <br></code> <br> <br>  -      ,  ,         :) -  ,     . <br> ,       "" ,      . <br>      ,    . <br>            ,   ‚Äî  .        <br> <code>foreach($templateVars as $k=&gt;$v) <br> $$k = $v; <br></code> <br> <br>   ,           <a href="http://www.smarty.net/">Smarty</a> .    ,  ,      . <br> ,  demo,       ... <br>    [* *]      .   { } <br>            <br> <code>{include 'last.tpl'} <br> {include ('last.tpl', '  ')} <br></code> <br>    ,         . <br>  RegexBuddy(      )       include <br>        <br> <code>{\s*include\s*\({0,1}(\'{0,1}[$A-Za-z.0-9_\-]+\'{0,1})(?:(,{0,1}\s*\'{0,1}[$A-Za-z.0-9_\-]+\'{0,1})|\s*)\){0,1}\s*} <br></code> <br>        ,             :) <br>     preg_replace <br>   a    ,  <i>&lt;?php w_include(${1}${2}); ?&gt;</i>   . <br> <br> w_include        ,     . <br> <br>     ,    (     )  <br> <code>{if }{else} {/if} <br>  <br> {if }{/if} <br></code> <br>             ,         . <br>    <br> <code>{if $a} <br> {if $b} <br> 1 <br> {/if} <br> 2 <br> {/if} <br></code> <br>    ,    <br> <code>&lt;? if($a){ ?&gt; <br> {if $b} <br> 1 <br> &lt;? } ?&gt; <br> 2 <br> {/if} <br></code> <br>     ,      preg_replace     .     Smarty    .       . <br>    ,        <br> <code>&lt;? if($a): ?&gt; <br> ... <br> &lt;? endif; ?&gt; <br></code> <br>          <br> <code>'/{\s*if\s*(.*?)\s*}/' =&gt; '&lt;?php if(${1}): ?&gt;' <br> '/{\s*else\s*}/' =&gt; '&lt;?php else: ?&gt;' <br> '/{\s*\/if\s*}/' =&gt; '&lt;?php endif; ?&gt;'</code> <br> <br>     :) <br>   ,        . <br> <br> <code>class t_wls_templater{ <br> protected $dirTemplate = ''; <br> protected $templateVars = array(); <br> protected $templateFile, $templateCache; <br> // ---------------- preg <br> protected $wls_templater_preg = array( <br> <br> // {include ('tpl', 'f')} {include 'tpl', 't'} { include 'tpl' } etc... <br> '/{\s*include\s*\({0,1}(\'{0,1}[$A-Za-z.0-9_\-]+\'{0,1})(?:(,{0,1}\s*\'{0,1}[$A-Za-z.0-9_\-]+\'{0,1})|\s*)\){0,1}\s*}/' =&gt; '&lt;?php $this-&gt;w_include(${1}${2}); ?&gt;', <br> // {if true } exit(); else {foo();} {/if} <br> '/{\s*if\s*(.*?)\s*}/' =&gt; '&lt;?php if(${1}): ?&gt;', <br> '/{\s*else\s*}/' =&gt; '&lt;?php else: ?&gt;', <br> // {for ($i=0;$i&lt;$num;$i++)}echo $foo;{/endfor} <br> '/{\s*for\s*\((.*?);(.*?);(.*?)\)}/' =&gt; '&lt;? for(${1}; ${2}; ${3}): ?&gt;', <br> '/{\s*\/(for|if)\s*}/' =&gt; '&lt;?php end${1}; ?&gt;', <br> // { all text } <br> '/{(.*?)}/' =&gt; '&lt;?${1}?&gt;' <br> ); <br> // ---------------- end preg <br> public function __construct($dir=''){ <br> $this-&gt;dirTemplate = empty($dir)?.'./templates/':$dir; <br> } <br> <br> public function assign($name,$value){ <br> $this-&gt;templateVars[$name] = $value; <br> } <br> <br> public function parse($filename,$innerTemplateName=''){ <br> // create vars what's used in templates <br> $THIS_TEMPLATE_NAME = $innerTemplateName; <br> $THIS_TEMPLATE_FILE = $filename; <br> $THIS_TEMPLATE_DIR = $this-&gt;dirTemplate; <br> foreach($this-&gt;templateVars as $k=&gt;$v){ <br> $$k = $v; <br> } <br> // end create <br> if(!is_file($this-&gt;dirTemplate.$filename)){ <br> return false; <br> } <br> $this-&gt;templateFile = $this-&gt;dirTemplate.$filename; <br> $this-&gt;templateCache = './templates_cache/_'.$_tmp['name'].'_'.$filename.'.php'; <br> <br> $orig_time = filemtime($this-&gt;templateFile); <br> <br> if(is_file($this-&gt;templateCache)){ <br> $cash_time = filemtime($this-&gt;templateCache); <br> if($cash_time&gt;$orig_time){ <br> $this-&gt;_deb-&gt;addEvent('info', 'Use cache for template <b>'.$filename.'</b> '); <br> ob_start(); <br> error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING); <br> include($this-&gt;templateCache); <br> error_reporting(E_ALL); <br> $text = ob_get_contents(); <br> ob_end_clean(); <br> return $text; <br> } <br> } <br> <br> $text = file_get_contents($this-&gt;templateFile); <br> foreach($this-&gt;wls_templater_preg as $preg=&gt;$replace){ <br> $text = preg_replace($preg, $replace, $text); <br> } <br> $f = fopen($this-&gt;templateCache,'w'); <br> fwrite($f,$text); <br> fclose($f); <br> ob_start(); <br> error_reporting(E_ALL ^ E_NOTICE ^ E_WARNING); <br> eval('?&gt;'.$text.'&lt;?'); <br> error_reporting(E_ALL); <br> $text = ob_get_contents(); <br> ob_end_clean(); <br> return $text; <br> } <br> protected function w_include($fname, $innerTemplateName = ''){ <br> $_tmp = $this-&gt;parse($fname, $innerTemplateName); <br> echo $_tmp; <br> } <br> } <br></code></code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/24826/">https://habr.com/ru/post/24826/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248249/index.html">Ubuntu Make - a developer to help</a></li>
<li><a href="../248251/index.html">15 most popular IoT gadgets in 2014</a></li>
<li><a href="../248253/index.html">C ++ in 2015</a></li>
<li><a href="../248255/index.html">‚ÄúLove and Hate‚Äù on the map of Russia, winter 2014-2015: fourth study of the emotional state of 35 million social media users</a></li>
<li><a href="../248257/index.html">Categories big and small</a></li>
<li><a href="../248261/index.html">Right now there is a live broadcast of the seminar: ‚ÄúAdministration of the Data Domain system‚Äù</a></li>
<li><a href="../248263/index.html">Quick voice dialing on Asterisk</a></li>
<li><a href="../248267/index.html">Equivalent transformations of Maxwell equations</a></li>
<li><a href="../248269/index.html">We build a backdoor in the RSA public key</a></li>
<li><a href="../248271/index.html">Electronic signature on Russian regulations: practical use in enterprises</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>