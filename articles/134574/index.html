<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a visual image library with HTML5 Canvas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This morning, after opening the mail, I received another newsletter from the Code Project , which described an interesting way of creating an image ga...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a visual image library with HTML5 Canvas</h1><div class="post__text post__text-html js-mediator-article">  This morning, after opening the mail, I received another newsletter from the <a href="http://www.codeproject.com/">Code Project</a> , which described an <a href="http://www.codeproject.com/KB/solution-center/Library-Images-Canvas.aspx">interesting way of</a> creating an image gallery using the Canvas element.  The article seemed quite interesting and I decided to publish its translation. <a name="habracut"></a><br><br>  <i>Note</i>  <i>from the translator: Some of the sentences that advertised IE and some obviously obvious things were removed from the article.</i>  <i>I myself am not a supporter of the IE browser and not all the methods described below are ideal.</i>  <i>But as an overview of the features of HTML5 and attempts at a new use of Canvas, the article is quite interesting.</i> <i><br></i>  <i><a href="http://www.codeproject.com/KB/solution-center/Library-Images-Canvas.aspx">Link to the article on the code project</a></i> <i><br></i>  <i><a href="http://blogs.msdn.com/b/eternalcoding/archive/2011/07/25/feedback-of-a-graphic-development-using-html5-amp-javascript.aspx">Link to the original</a></i> <br><br>  As a fan of user interfaces, I could not miss the opportunity to develop something with HTML5 Canvas.  This tool provides a great many new ways to display images and data on the web.  In this article we will go through one of them. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Application Overview </li><li>  Instruments </li><li>  HTML5 page </li><li>  Data retrieval </li><li>  Card loading &amp; cache handling </li><li>  Map display </li><li>  Mouse control </li><li>  State saving </li><li>  Animation </li><li>  Work with different devices </li><li>  Conclusion </li></ul><br><br><h4>  Application Overview </h4><br><br>  We will make an application that will allow us to display the <a href="http://www.wizards.com/Magic">Magic the Gathering ¬©</a> card collection.  Users will be able to scroll and zoom when using the mouse (for example, as in Bing Maps). <br><br><img src="https://habrastorage.org/storage1/f4fbf634/963dec1d/1a909166/fb4bed4a.png"><br><br>  The finished application can be viewed here: <a href="http://bolaslenses.catuhe.com/">bolaslenses.catuhe.com</a> <br>  Sources can be downloaded here: <a href="">www.catuhe.com/msdn/bolaslenses.zip</a> <br><br>  Maps are stored in <b>Windows Azure Storage</b> and use the Azure Content Distribution Network ( <a href="http://www.microsoft.com/windowsazure/cdn/">CDN</a> : a service that provides / deploys data near end users) for maximum performance.  ASP.NET service is used to return a list of maps (using <b>JSON</b> format). <br><br><img src="https://habrastorage.org/storage1/fcebdf85/84130811/b8750d95/101a6046.png"><br><br><h4>  Instruments </h4><br><br>  To write our application, we will use Visual Studio 2010 SP1 with <a href="http://visualstudiogallery.msdn.microsoft.com/a15c3ce9-f58f-42b7-8668-53f6cdc2cd83">Web Standards Update</a> .  This extension adds IntelliSense support for HTML5 pages (this is a really important thing). <br>  Our solution will contain an HTML5 page along with .js files.  Debugging Pro: Visual Studio allows you to set breakpoints and work with them right in your environment. <br><br><img src="https://habrastorage.org/storage1/d9f42d25/1bb60743/de6e257f/b21c2a61.png"><br>  <i>Debugging in Visual Studio 2010</i> <br><br>  And so we have a modern development environment with IntelliSense and debugging support.  Therefore, we are ready to start and we will write an HTML5 page to get started <br><br><img src="https://habrastorage.org/storage1/793e9af5/6f49886c/3e127cf0/d1d62bca.png"><br><br><h4>  HTML5 page </h4><br>  Our page will be built around HTML5 canvas, which we will use to draw maps: <a href="http://paste.pocoo.org/show/520615/">code</a> <br><br>  If we look at our page, we can notice that it is divided into 2 parts: <br><ul><li>  Title with logo, name and special links. </li><li>  The main part containing the canvas element and tooltips that will display the status of the application.  And a hidden image (backImage) used as a source for maps not yet loaded. </li></ul><br>  We also added the style file <i>full.css</i> : <a href="http://paste.pocoo.org/show/520617/">a style file</a> .  So we got the following page: <br><br><img src="https://habrastorage.org/storage1/afb72e01/8928a05e/5717bfd9/6f41fa87.png"><br><br>  Styles are a powerful tool that allows you to create an infinite number of mappings. <br><br>  Our interface is now ready and we can see how to get data about maps for display. <br><br><h4>  Data retrieval </h4><br>  The server provides a list of maps using the JSON format at the following link: <br>  <a href="http://bolaslenses.catuhe.com/Home/ListOfCards/%3FcolorString%3D0">bolaslenses.catuhe.com/Home/ListOfCards/?colorString=0</a> <br>  The URL takes one parameter (colorString) to select the desired color (0 = all). <br>  When developing with JavaScript, it would be nice to see what we already have today (this is true for other programming languages, but it is very important for JavaScript): you have to ask yourself if it wasn‚Äôt what we are going to develop, already created in existing frameworks? <br>  Indeed, there are many open source JavaScript projects in the world.  One of them is <b>jQuery</b> , which provides an abundance of convenient features. <br>  Thus, in our case, to connect to the URL of our server and get a list of maps, we can use <i>XmlHttpRequest</i> and have fun with the parsing of the returned JSON.  Or we can use jQuery. <br>  We will use the getJSON function to take care of everything for us: <br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getListOfCards</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> url = <span class="hljs-string"><span class="hljs-string">"http://bolaslenses.catuhe.com/Home/ListOfCards/?jsoncallback=?"</span></span>; $.getJSON(url, { <span class="hljs-attr"><span class="hljs-attr">colorString</span></span>: <span class="hljs-string"><span class="hljs-string">"0"</span></span> }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ listOfCards = data; $(<span class="hljs-string"><span class="hljs-string">"#cardsCount"</span></span>).text(listOfCards.length + <span class="hljs-string"><span class="hljs-string">" cards displayed"</span></span>); $(<span class="hljs-string"><span class="hljs-string">"#waitText"</span></span>).slideToggle(<span class="hljs-string"><span class="hljs-string">"fast"</span></span>); }); }</code> </pre> <br><br>  As we can see, our function saves the list of maps to the <i>listOfCards</i> variable and calls 2 jQuery functions: <br><ul><li>  <i>text</i> - changes the text of the tag </li><li>  <i>slideToggle</i> - hides / shows tag animation of its height </li></ul><br>  The listOfCards list contains objects in the format: <br><ul><li>  <i>ID</i> : Card ID </li><li>  <i>Path</i> : relative map path (no extension) </li></ul><br>  It should be noted that the server URL is invoked with the ‚Äú? Jsoncallback =?‚Äù Suffix.  Ajax calls are limited to connecting to the same address as the script being called.  However, there is a solution called <a href="http://en.wikipedia.org/wiki/JSONP">JSONP</a> that will allow us to make joint calls to the server.  And fortunately, jQuery can handle everything alone, you only need to add the correct suffix. <br>  As soon as we receive our list of cards, we can customize the loading and caching of images. <br><br><h4>  Loading Cards &amp; Processing Cache </h4><br>  The main trick of our application is to draw only maps that are visible on the screen.  The display window is determined by the zoom level and indent (x, y) of the entire system. <br><br> <code>var visuControl = { zoom : 0.25, offsetX : 0, offsetY : 0 };</code> <br> <br><img src="https://habrastorage.org/storage1/30f7042c/aa36b65c/1803b88b/8c37a113.png"><br><br>  The entire system is defined by <b>14,819</b> maps, which cover more than <b>200</b> columns and <b>75</b> lines. <br>  We should also know that each card is available in three versions: <br><ul><li>  High resolution: <b>480x680</b> without compression (.jpg suffix) </li><li>  Medium resolution: <b>240x340</b> with standard compression (.50.jpg suffix) </li><li>  Low resolution: <b>120x170</b> with strong compression (.25.jpg suffix) </li></ul><br>  Thus, depending on the zoom level, we will download the correct version to optimize network performance. <br>  To do this, we will develop a function that will give the desired image for the card.  In addition, the function will refer to the image quality below, if the map for the desired level has not yet been uploaded to the server: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">imageCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">substr, replacementCache</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> extension = substr; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backImage = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"backImage"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.load = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">card</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localCache = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[card.ID] != <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Image(); localCache[card.ID] = { <span class="hljs-attr"><span class="hljs-attr">image</span></span>: img, <span class="hljs-attr"><span class="hljs-attr">isLoaded</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span> }; currentDownloads++; img.onload = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ localCache[card.ID].isLoaded = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; currentDownloads--; }; img.onerror = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ currentDownloads--; }; img.src = <span class="hljs-string"><span class="hljs-string">"http://az30809.vo.msecnd.net/"</span></span> + card.Path + extension; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getReplacementFromLowerCache = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">card</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (replacementCache == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> backImage; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> replacementCache.getImageForCard(card); }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getImageForCard = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">card</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[card.ID] == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.load(card); img = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getReplacementFromLowerCache(card); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[card.ID].isLoaded) img = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>[card.ID].image; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> img = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.getReplacementFromLowerCache(card); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> img; }; }</code> </pre><br>  <i>ImageCache</i> gives the suffix and the desired cache. <br>  Here are 2 important features: <br><ul><li>  <i>load</i> : this function will load the desired image and will save it to the cache ( <i>msecnd.net</i> url is the address of the map in Azure CDN) </li><li>  <i>getImageForCard</i> : this function returns a picture from the cache if it has already been loaded before or loads it in a new way, puts it into the cache </li></ul><br>  To handle 3 cache levels, we will declare 3 variables: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imagesCache25 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imageCache(<span class="hljs-string"><span class="hljs-string">".25.jpg"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imagesCache50 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imageCache(<span class="hljs-string"><span class="hljs-string">".50.jpg"</span></span>, imagesCache25); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> imagesCacheFull = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imageCache(<span class="hljs-string"><span class="hljs-string">".jpg"</span></span>, imagesCache50);</code> </pre><br><br>  Choosing the right cache depends on the zoom: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCorrectImageCache</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visuControl.zoom &lt;= <span class="hljs-number"><span class="hljs-number">0.25</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imagesCache25; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visuControl.zoom &lt;= <span class="hljs-number"><span class="hljs-number">0.8</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imagesCache50; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imagesCacheFull; }</code> </pre><br><br>  For user feedback, we will add a timer that will control the tooltip that displays the number of pictures already loaded: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateStats</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stats = $(<span class="hljs-string"><span class="hljs-string">"#stats"</span></span>); stats.html(currentDownloads + <span class="hljs-string"><span class="hljs-string">" card(s) currently downloaded."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentDownloads == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; statsVisible) { statsVisible = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; stats.slideToggle(<span class="hljs-string"><span class="hljs-string">"fast"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentDownloads &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; !statsVisible) { statsVisible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; stats.slideToggle(<span class="hljs-string"><span class="hljs-string">"fast"</span></span>); } } setInterval(updateStats, <span class="hljs-number"><span class="hljs-number">200</span></span>);</code> </pre><br><br>  Note: it is better to use jQuery to simplify animation. <br>  And now we proceed to talk about the display of maps. <br><br><h4>  Map display </h4><br>  To draw our maps, we need to fill the canvas element using its 2D context (which exists only if the browser supports HTML5 canvas): <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mainCanvas = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"mainCanvas"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> drawingContext = mainCanvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>);</code> </pre><br><br>  The drawing will be done by the <i>processListOfCards</i> function (called 60 times per second): <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processListOfCards</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (listOfCards == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) { drawWaitMessage(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } mainCanvas.width = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"center"</span></span>).clientWidth; mainCanvas.height = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(<span class="hljs-string"><span class="hljs-string">"center"</span></span>).clientHeight; totalCards = listOfCards.length; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localCardWidth = cardWidth * visuControl.zoom; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> localCardHeight = cardHeight * visuControl.zoom; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> effectiveTotalCardsInWidth = colsCount * localCardWidth; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rowsCount = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.ceil(totalCards / colsCount); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> effectiveTotalCardsInHeight = rowsCount * localCardHeight; initialX = (mainCanvas.width - effectiveTotalCardsInWidth) / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - localCardWidth / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; initialY = (mainCanvas.height - effectiveTotalCardsInHeight) / <span class="hljs-number"><span class="hljs-number">2.0</span></span> - localCardHeight / <span class="hljs-number"><span class="hljs-number">2.0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Clear clearCanvas(); // Computing of the viewing area var initialOffsetX = initialX + visuControl.offsetX * visuControl.zoom; var initialOffsetY = initialY + visuControl.offsetY * visuControl.zoom; var startX = Math.max(Math.floor(-initialOffsetX / localCardWidth) - 1, 0); var startY = Math.max(Math.floor(-initialOffsetY / localCardHeight) - 1, 0); var endX = Math.min(startX + Math.floor((mainCanvas.width - initialOffsetX - startX * localCardWidth) / localCardWidth) + 1, colsCount); var endY = Math.min(startY + Math.floor((mainCanvas.height - initialOffsetY - startY * localCardHeight) / localCardHeight) + 1, rowsCount); // Getting current cache var imageCache = getCorrectImageCache(); // Render for (var y = startY; y &lt; endY; y++) { for (var x = startX; x &lt; endX; x++) { var localX = x * localCardWidth + initialOffsetX; var localY = y * localCardHeight + initialOffsetY; // Clip if (localX &gt; mainCanvas.width) continue; if (localY &gt; mainCanvas.height) continue; if (localX + localCardWidth &lt; 0) continue; if (localY + localCardHeight &lt; 0) continue; var card = listOfCards[x + y * colsCount]; if (card == undefined) continue; // Get from cache var img = imageCache.getImageForCard(card); // Render try { if (img != undefined) drawingContext.drawImage(img, localX, localY, localCardWidth, localCardHeight); } catch (e) { $.grep(listOfCards, function (item) { return item.image != img; }); } } }; // Scroll bars drawScrollBars(effectiveTotalCardsInWidth, effectiveTotalCardsInHeight, initialOffsetX, initialOffsetY); // FPS computeFPS(); }</span></span></code> </pre><br><br>  This feature is built around several key points: <br><ul><li>  If the list of maps has not yet been uploaded, we display a hint indicating that the download is still in progress: </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> pointCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawWaitMessage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ pointCount++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pointCount &gt; <span class="hljs-number"><span class="hljs-number">200</span></span>) pointCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> points = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> index = <span class="hljs-number"><span class="hljs-number">0</span></span>; index &lt; pointCount / <span class="hljs-number"><span class="hljs-number">10</span></span>; index++) points += <span class="hljs-string"><span class="hljs-string">"."</span></span>; $(<span class="hljs-string"><span class="hljs-string">"#waitText"</span></span>).html(<span class="hljs-string"><span class="hljs-string">"Loading...Please wait&lt;br&gt;"</span></span> + points); }</code> </pre><br><ul><li>  Subsequently, we determine the position of the display window (in terms of maps and coordinates), then we clear the canvas: </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">clearCanvas</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ mainCanvas.width = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.clientWidth - <span class="hljs-number"><span class="hljs-number">50</span></span>; mainCanvas.height = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.clientHeight - <span class="hljs-number"><span class="hljs-number">140</span></span>; drawingContext.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgb(0, 0, 0)"</span></span>; drawingContext.fillRect(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, mainCanvas.width, mainCanvas.height); }</code> </pre><br><br><ul><li>  Then we display a list of maps and call the canvas function of the context drawImage.  Specific image provided by active cache (depends on zoom): </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">// Get from cache var img = imageCache.getImageForCard(card); // Render try { if (img != undefined) drawingContext.drawImage(img, localX, localY, localCardWidth, localCardHeight); } catch (e) { $.grep(listOfCards, function (item) { return item.image != img; });</span></span></code> </pre><br><ul><li>  We also need to draw a scroll bar using the <i>RoundedRectangle</i> function, which uses quadratic curves: </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">roundedRectangle</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, width, height, radius</span></span></span><span class="hljs-function">) </span></span>{ drawingContext.beginPath(); drawingContext.moveTo(x + radius, y); drawingContext.lineTo(x + width - radius, y); drawingContext.quadraticCurveTo(x + width, y, x + width, y + radius); drawingContext.lineTo(x + width, y + height - radius); drawingContext.quadraticCurveTo(x + width, y + height, x + width - radius, y + height); drawingContext.lineTo(x + radius, y + height); drawingContext.quadraticCurveTo(x, y + height, x, y + height - radius); drawingContext.lineTo(x, y + radius); drawingContext.quadraticCurveTo(x, y, x + radius, y); drawingContext.closePath(); drawingContext.stroke(); drawingContext.fill(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">drawScrollBars</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">effectiveTotalCardsInWidth, effectiveTotalCardsInHeight, initialOffsetX, initialOffsetY</span></span></span><span class="hljs-function">) </span></span>{ drawingContext.fillStyle = <span class="hljs-string"><span class="hljs-string">"rgba(255, 255, 255, 0.6)"</span></span>; drawingContext.lineWidth = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Vertical var totalScrollHeight = effectiveTotalCardsInHeight + mainCanvas.height; var scaleHeight = mainCanvas.height - 20; var scrollHeight = mainCanvas.height / totalScrollHeight; var scrollStartY = (-initialOffsetY + mainCanvas.height * 0.5) / totalScrollHeight; roundedRectangle(mainCanvas.width - 8, scrollStartY * scaleHeight + 10, 5, scrollHeight * scaleHeight, 4); // Horizontal var totalScrollWidth = effectiveTotalCardsInWidth + mainCanvas.width; var scaleWidth = mainCanvas.width - 20; var scrollWidth = mainCanvas.width / totalScrollWidth; var scrollStartX = (-initialOffsetX + mainCanvas.width * 0.5) / totalScrollWidth; roundedRectangle(scrollStartX * scaleWidth + 10, mainCanvas.height - 8, scrollWidth * scaleWidth, 5, 4); }</span></span></code> </pre><br><ul><li>  Finally, we need to calculate the number of frames per second: </li></ul><br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">computeFPS</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previous.length &gt; <span class="hljs-number"><span class="hljs-number">60</span></span>) { previous.splice(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> start = (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>).getTime(); previous.push(start); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> id = <span class="hljs-number"><span class="hljs-number">0</span></span>; id &lt; previous.length - <span class="hljs-number"><span class="hljs-number">1</span></span>; id++) { sum += previous[id + <span class="hljs-number"><span class="hljs-number">1</span></span>] - previous[id]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> diff = <span class="hljs-number"><span class="hljs-number">1000.0</span></span> / (sum / previous.length); $(<span class="hljs-string"><span class="hljs-string">"#cardsCount"</span></span>).text(diff.toFixed() + <span class="hljs-string"><span class="hljs-string">" fps. "</span></span> + listOfCards.length + <span class="hljs-string"><span class="hljs-string">" cards displayed"</span></span>); }</code> </pre><br><br>  Map rendering is mainly based on the ability of the browser to speed up the rendering of the canvas element.  For example, this is performance on my machine with a minimum zoom level (0.05): <br><br><img src="http://habrastorage.org/storage1/9984150a/3d3b263b/d2d4ed18/ff257035.png"><br><br><table cellpadding="2"><tbody><tr><td width="350" align="center">  <b>Browser</b> <br></td><td width="350" align="center">  <b>FPS</b> <br></td></tr><tr><td width="350">  Internet Explorer 9 </td><td width="350">  thirty </td></tr><tr><td width="350">  Firefox 5 </td><td width="350">  thirty </td></tr><tr><td width="350">  Chrome 12 </td><td width="350">  17 </td></tr><tr><td width="350">  iPad (at a zoom level of 0.8) </td><td width="350">  7 </td></tr><tr><td width="350">  Windows Phone Mango (at a zoom level of 0.8) </td><td width="350">  20 (!!) </td></tr></tbody></table><br><br>  The site even works on mobile phones and tablets if they support HTML5. <br><br>  Here we can see the inner strength of HTML5 browsers that can handle full screen maps more than 30 times per second.  This is possible with hardware acceleration. <br><br><h5>  Mouse control </h5><br>  For normal viewing of the collection of our maps we need to be able to control the mouse (including the wheel). <br>  To scroll, we simply handle the onmouvemove, onmouseup and onmousedown events. <br><br>  Onmouseup and onmousedown events will be used to track mouse clicks: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mouseDown = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.onmousedown = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ mouseDown = <span class="hljs-number"><span class="hljs-number">1</span></span>; getMousePosition(e); previousX = posx; previousY = posy; }; <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body.onmouseup = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ mouseDown = <span class="hljs-number"><span class="hljs-number">0</span></span>; };</code> </pre><br><br>  The onmousemove event is connected to the canvas element and is used to move the view: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousX = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previousY = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posx = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> posy = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMousePosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">eventArgs</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!eventArgs) e = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.event; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { e = eventArgs; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.offsetX || e.offsetY) { posx = e.offsetX; posy = e.offsetY; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.clientX || e.clientY) { posx = e.clientX; posy = e.clientY; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onMouseMove</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!mouseDown) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; getMousePosition(e); mouseMoveFunc(posx, posy, previousX, previousY); previousX = posx; previousY = posy; }</code> </pre><br><br>  This function (onMouseMove) calculates the current position and provides the previous value in case of a shift of the display window: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Move</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">posx, posy, previousX, previousY</span></span></span><span class="hljs-function">) </span></span>{ currentAddX = (posx - previousX) / visuControl.zoom; currentAddY = (posy - previousY) / visuControl.zoom; } MouseHelper.registerMouseMove(mainCanvas, Move);</code> </pre><br><br>  As a reminder, jQuery also provides tools for managing mouse events. <br>  To control the wheel you will have to adjust to each browser individually, since they all work differently in this case: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">wheel</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delta = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.wheelDelta) { delta = event.wheelDelta / <span class="hljs-number"><span class="hljs-number">120</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.opera) delta = -delta; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.detail) { <span class="hljs-comment"><span class="hljs-comment">/** Mozilla case. */</span></span> delta = -event.detail / <span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delta) { wheelFunc(delta); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.preventDefault) event.preventDefault(); event.returnValue = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><br>  Event registration function: <br><pre> <code class="javascript hljs"> MouseHelper.registerWheel = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">func</span></span></span><span class="hljs-function">) </span></span>{ wheelFunc = func; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener) <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'DOMMouseScroll'</span></span>, wheel, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.onmousewheel = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.onmousewheel = wheel; }; <span class="hljs-comment"><span class="hljs-comment">//  MouseHelper.registerWheel(function (delta) { currentAddZoom += delta / 500.0; });</span></span></code> </pre><br><br>  Finally, we add a little inertia while moving the mouse (or during zoom) to give a feeling of smoothness: <br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//  var inertia = 0.92; var currentAddX = 0; var currentAddY = 0; var currentAddZoom = 0; function doInertia() { visuControl.offsetX += currentAddX; visuControl.offsetY += currentAddY; visuControl.zoom += currentAddZoom; var effectiveTotalCardsInWidth = colsCount * cardWidth; var rowsCount = Math.ceil(totalCards / colsCount); var effectiveTotalCardsInHeight = rowsCount * cardHeight var maxOffsetX = effectiveTotalCardsInWidth / 2.0; var maxOffsetY = effectiveTotalCardsInHeight / 2.0; if (visuControl.offsetX &lt; -maxOffsetX + cardWidth) visuControl.offsetX = -maxOffsetX + cardWidth; else if (visuControl.offsetX &gt; maxOffsetX) visuControl.offsetX = maxOffsetX; if (visuControl.offsetY &lt; -maxOffsetY + cardHeight) visuControl.offsetY = -maxOffsetY + cardHeight; else if (visuControl.offsetY &gt; maxOffsetY) visuControl.offsetY = maxOffsetY; if (visuControl.zoom &lt; 0.05) visuControl.zoom = 0.05; else if (visuControl.zoom &gt; 1) visuControl.zoom = 1; processListOfCards(); currentAddX *= inertia; currentAddY *= inertia; currentAddZoom *= inertia; // Epsilon if (Math.abs(currentAddX) &lt; 0.001) currentAddX = 0; if (Math.abs(currentAddY) &lt; 0.001) currentAddY = 0; }</span></span></code> </pre><br><br>  Such a small function is easy to implement, but it will improve the quality of work with the user. <br><br><h4>  State saving </h4><br><br>  Also, in order to make viewing more convenient, we will save the position of the display window and zoom.  To do this, we use the <a href="http://dev.w3.org/html5/webstorage/">localStorage</a> service, which saves key / value pairs for a long time (data is saved after the browser is closed) and is only available to the current window object: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saveConfig</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.localStorage == <span class="hljs-literal"><span class="hljs-literal">undefined</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Zoom window.localStorage["zoom"] = visuControl.zoom; // Offsets window.localStorage["offsetX"] = visuControl.offsetX; window.localStorage["offsetY"] = visuControl.offsetY; } // Restore data if (window.localStorage != undefined) { var storedZoom = window.localStorage["zoom"]; if (storedZoom != undefined) visuControl.zoom = parseFloat(storedZoom); var storedoffsetX = window.localStorage["offsetX"]; if (storedoffsetX != undefined) visuControl.offsetX = parseFloat(storedoffsetX); var storedoffsetY = window.localStorage["offsetY"]; if (storedoffsetY != undefined) visuControl.offsetY = parseFloat(storedoffsetY); }</span></span></code> </pre><br><br><h4>  Animation </h4><br>  To add more dynamism to our application, we allow our users to double-click on the map for zooming and focusing on it. <br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/D7lNJ4_YaIo%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253,15700256,15700259&amp;usg=ALkJrhh_xcCCWm3QN_H_XjzkYiR6fDpSjg" frameborder="0" allowfullscreen=""></iframe><br>  Our system should animate 3 values: two indents (offsets (X, Y)) and zoom.  To do this, we use a function that will be responsible for animating a variable from the source to the final value with a given duration: <br><pre> <code class="javascript hljs"> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> AnimationHelper = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">root, name</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> paramName = name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.animate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">current, to, duration</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = (to - current); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ticks = <span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor(duration / <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offsetPart = offset / ticks; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ticksCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> intervalID = setInterval(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ current += offsetPart; root[paramName] = current; ticksCount++; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ticksCount == ticks) { clearInterval(intervalID); root[paramName] = to; } }, <span class="hljs-number"><span class="hljs-number">16</span></span>); }; };</code> </pre><br><br>  Using function: <br><pre> <code class="javascript hljs"> <span class="hljs-comment"><span class="hljs-comment">//    var zoomAnimationHelper = new AnimationHelper(visuControl, "zoom"); var offsetXAnimationHelper = new AnimationHelper(visuControl, "offsetX"); var offsetYAnimationHelper = new AnimationHelper(visuControl, "offsetY"); var speed = 1.1 - visuControl.zoom; zoomAnimationHelper.animate(visuControl.zoom, 1.0, 1000 * speed); offsetXAnimationHelper.animate(visuControl.offsetX, targetOffsetX, 1000 * speed); offsetYAnimationHelper.animate(visuControl.offsetY, targetOffsetY, 1000 * speed);</span></span></code> </pre><br>  The advantage of <i>AnimationHelper</i> is that it is able to animate many parameters as you wish. <br><br><h4>  Work with different devices </h4><br><br>  Finally, we will make sure that our page can also be viewed on tablets, PCs, and even phones. <br>  To do this, we use the property CSS 3: <a href="http://www.w3.org/TR/css3-mediaqueries/">The media-queries.</a>  With this technology, we can apply styles according to some requests, such as a specific screen size: <br><pre> <code class="html hljs xml"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content/full.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content/mobile.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen and (max-width: 480px)"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Content/mobile.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">media</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"screen and (max-device-width: 480px)"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br><br>  Here we see that if the screen width is less than <b>480</b> pixels, the following style will be added: <br><pre> <code class="css hljs"> <span class="hljs-selector-id"><span class="hljs-selector-id">#legal</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">8px</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#title</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">30px</span></span> <span class="hljs-meta"><span class="hljs-meta">!important</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#waitText</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">12px</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#bolasLogo</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">48px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">48px</span></span>; } <span class="hljs-selector-id"><span class="hljs-selector-id">#pictureCell</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">48px</span></span>; }</code> </pre><br><br>  This style will reduce the size of the header and will keep the site visible even if the browser width is less than 480 pixels (for example, on Windows Phone): <br><br><img src="http://habrastorage.org/storage1/2318b54b/fe31c273/56c142e1/35b88165.png"><br><h4>  Conclusion </h4><br>  <b>HTML5 / CSS 3 / JavaScript</b> and <b>Visual Studio 2010</b> allow you to develop portable and efficient solutions (within a browser that supports HTML5) with some excellent features, such as hardware accelerated rendering. <br>  This type of development is simplified using frameworks such as jQuery. <br><br>  In conclusion, I will say that in order to be convinced of something - you need to try it! </div><p>Source: <a href="https://habr.com/ru/post/134574/">https://habr.com/ru/post/134574/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134569/index.html">Channel.me ‚Üí co-viewing sites</a></li>
<li><a href="../134570/index.html">Google has bought a developer virtual assistant for smartphones</a></li>
<li><a href="../134571/index.html">How to reduce the likelihood of errors at the stage of writing code. Note N4</a></li>
<li><a href="../134572/index.html">Homemade game controller for Nokia N900</a></li>
<li><a href="../134573/index.html">Combined Forms and Defaults</a></li>
<li><a href="../134578/index.html">Games for CANVAS / WebGL (part two)</a></li>
<li><a href="../134580/index.html">CANVAS / WebGL Games</a></li>
<li><a href="../134583/index.html">Skype 2.6 for Android: file transfer in chat</a></li>
<li><a href="../134584/index.html">New version of NuGet 1.6 package manager released</a></li>
<li><a href="../134586/index.html">Megaplanes Megaplan in the new year</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>