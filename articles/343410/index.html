<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparison of Firebird, MySQL and PostgreSQL code quality</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today‚Äôs article is somewhat unusual. At least for the reason that instead of analyzing one project, we will look for errors in three at once, and also...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparison of Firebird, MySQL and PostgreSQL code quality</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d99/28e/f3d/d9928ef3d7038b3b6d126b6952ad4502.png"></div><br>  Today‚Äôs article is somewhat unusual.  At least for the reason that instead of analyzing one project, we will look for errors in three at once, and also see where the most interesting bugs are.  And the most interesting is that we will find out who the young man is and write the highest quality code.  So, on the agenda - analysis of errors in the code of projects Firebird, MySQL and PostgreSQL. <br><a name="habracut"></a><br><h2>  In a nutshell about projects </h2><br><h3>  Firebird </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d7e/1a2/9ee/d7e1a29eeb033215289cc8045a9b3b84.png" alt="Picture 12"></p><br><br>  Firebird (FirebirdSQL) is a cross-platform database management system (DBMS) running on Mac OS X, Linux, Microsoft Windows and a variety of Unix platforms. <br><br>  Firebird has been used in various industrial systems (warehouse and business, financial, and public sectors) since 2001. This is a commercially independent project of C and C ++ programmers, technical advisors. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Additional information:</b> <br><br><ul><li>  <a href="https://firebirdsql.org/">official website</a> ; </li><li>  <a href="https://github.com/FirebirdSQL/firebird">GitHub repository</a> </li><li>  the number of stars on GitHub is 133; </li><li>  the number of forks on GitHub is 51. </li></ul><br><h3>  Mysql </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b4d/063/68d/b4d06368d0c883c09a3d3a4b3be4a7db.png" alt="Picture 1"></p><br><br>  MySQL is a free relational database management system.  Typically, MySQL is used as a server that is accessed by local or remote clients, but the distribution package includes an internal server library that allows you to include MySQL in standalone programs. <br><br>  The flexibility of MySQL DBMS is supported by the support of a large number of table types: users can select both MyISAM type tables that support full-text search and InnoDB tables that support transactions at the level of individual records.  Moreover, MySQL DBMS comes with a special type of table EXAMPLE, demonstrating the principles of creating new types of tables.  Due to the open architecture and GPL-licensing, new types of tables are constantly appearing in MySQL. <br><br>  <b>Additional information</b> : <br><br><ul><li>  <a href="https://www.mysql.com/">official website</a> ; </li><li>  <a href="https://github.com/mysql/mysql-server">GitHub repository</a> </li><li>  the number of stars on GitHub is 2179; </li><li>  The number of forks on GitHub is 907. </li></ul><br><h3>  PostgreSQL </h3><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a9f/3fc/0ac/a9f3fc0acc602904f57f8be0e49f5f3c.png" alt="Picture 10"></p><br><br>  PostgreSQL is a free object-relational database management system (DBMS). <br><br>  There are implementations for many UNIX-like platforms, including AIX, various BSD systems, HP-UX, IRIX, Linux, macOS, Solaris / OpenSolaris, Tru64, QNX, and also for Microsoft Windows.  It can handle various volumes of data, ranging from small personal applications to large Internet applications (data warehouses) with many concurrent users. <br><br>  PostgreSQL is based on Postgres, a non-profit DBMS developed as an open-source project at the University of California at Berkeley. <br><br>  <b>Additional information</b> : <br><br><ul><li>  <a href="https://www.postgresql.org/">official website</a> ; </li><li>  <a href="https://github.com/postgres/postgres">"Mirror" repository on GitHub</a> ; </li><li>  the number of stars on GitHub is 3260; </li><li>  the number of forks on GitHub is 1107. </li></ul><br><h2>  PVS-Studio </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4f7/ed1/254/4f7ed12543bf73f403b70a681cea15bb.png" alt="Picture 4"></p><br><br>  The <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static code analyzer was used as an error search tool.  PVS-Studio is a source code analyzer for programming languages ‚Äã‚ÄãC, C ++, C #, which helps reduce the cost of software development by early detection of errors, defects and potential vulnerabilities in the program code.  Works in Windows and Linux environments. <br><br>  Download links: <br><br><ul><li>  <a href="https://www.viva64.com/ru/pvs-studio-download/">Windows version</a> . </li><li>  <a href="https://www.viva64.com/ru/pvs-studio-download-linux/">Linux version</a> . </li></ul><br>  Due to the fact that all 3 projects are simply collected and contain .sln files (immediately, or after generation via CMake), the task of the analysis itself becomes quite trivial - it is enough to run the test through the PVS-Studio plugin interface embedded in IDE Visual Studio. <br><br><h2>  Comparison criteria </h2><br>  Before looking at what interesting was found in the projects, it is necessary to determine one of the main issues of the article - by what criteria to perform the comparison. <br><br><h3>  Why is the 'direct' comparison not the best idea? </h3><br>  Comparing head-on by the number of warnings issued by the analyzer (or rather, by the number of warnings to the number of lines of code) is not the best idea, even though this is the least labor-intensive way.  Why?  Take for example the PostgreSQL project, where the number of GA warnings with a high confidence level is 611. If you set filtering by the diagnostic rule code ( <a href="https://www.viva64.com/ru/w/v547/">V547</a> ) and message parts ( <i>ret &lt;0</i> ) in the PVS-Studio window, you can see that there are 419 such warnings!  Too much ... This immediately suggests that somewhere there is a source of these warnings, for example, a macro, or the code is automatically generated.  Comments at the beginning of the files containing these warnings confirm the correctness of the theory: <br><br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* This file was generated automatically by the Snowball to ANSI C compiler */</span></span></code> </pre> <br>  Now, knowing that the code was automatically generated, there are 2 ways: <br><br><ul><li>  Suppress all warnings because the auto-generated code is not interesting.  Thus, the number of warnings (GA, Lvl1) is immediately reduced by 69%! </li><li>  Accept that errors even in auto-generated code are still errors, and try to do something about it (fix the code generation script, for example).  In this case, the number of warnings remains relevant. </li></ul><br>  Another pitfall is errors in third-party components used in projects.  Yet again: <br><ul><li>  We can say that such errors are not your headache.  Would users agree with this statement? </li><li>  Take responsibility. </li></ul><br>  These are just a couple of examples that can put forward the problem of choice, the solution of which can change (sometimes significantly) the number of actual warnings. <br><br><h3>  Another way </h3><br>  We will immediately agree that we will not consider warnings of the 3rd confidence level (low certainty).  These are not the things you should pay attention to first.  Undoubtedly, there may be something useful, but when writing articles and when starting to use static analysis, it makes sense to ignore level 3 warnings. <br><br>  I will not perform a full-scale comparison, as this work is very laborious for many reasons.  To take at least a preliminary adjustment of the analyzer for each project, viewing and analyzing hundreds of warnings - all this is very long, and what will be the efficiency - an open question. <br><br>  Therefore, we proceed in another way.  I will look at the logs of all three projects, try to find some of the most interesting errors and analyze them, looking at the same time if there is something similar in other projects. <br><br>  In addition, relatively recently, we began to glance towards the search for security issues.  Even the article was on this topic - " <a href="https://www.viva64.com/ru/b/0514/">How can PVS-Studio help in finding vulnerabilities?</a> ".  Given that one of the participants in this review, MySQL, got into the article mentioned above, I was interested to check whether it would be possible to find a similar move.  No tricks - just further see the PVS-Studio warnings, similar to those in the article about vulnerabilities. <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/712/c49/4b3/712c494b39d8b614cd8c7a46f3f3056e.png" alt="Picture 13"></p><br><br>  Summarizing the above, I will evaluate the quality of the code according to the following criteria: <br><br><ul><li>  I will take the analyzer warning numbers from the aforementioned vulnerability article and will look for similar warnings in all three projects.  I think this approach is understandable - since we know that such code may be a vulnerability (although not always), you should pay special attention to it. </li><li>  I look at the GA warnings of the analyzer of the first two confidence levels, select the ones that seem most interesting, and then check to see if there is something similar in other projects. </li></ul><br>  According to the results of these checks, we will record penalty points in the piggy bank project.  Accordingly, whoever scores less points has the best code in relation to the approaches described above.  Of course, there are nuances, but I will describe them as we analyze and at the time of summing up. <br><br>  Well, let's get started! <br><br><h2>  Debriefing </h2><br><h3>  General analysis results </h3><br>  The table below shows the general results of the analysis of projects taken ‚Äúas is‚Äù - without suppressing false warnings, filtering by directories, etc.  Please note that these are only general purpose warnings (General analysis). <br><table><tbody><tr><td>  Project <br></td><td>  High certainty <br></td><td>  Medium Certainty <br></td><td>  Low certainty <br></td><td>  Total <br></td></tr><tr><td>  Firebird <br></td><td>  156 <br></td><td>  680 <br></td><td>  1045 <br></td><td>  1881 <br></td></tr><tr><td>  Mysql <br></td><td>  902 <br></td><td>  1448 <br></td><td>  2925 <br></td><td>  5275 <br></td></tr><tr><td>  PostgreSQL <br></td><td>  611 <br></td><td>  1432 <br></td><td>  1576 <br></td><td>  3619 <br></td></tr></tbody></table><br>  However, one should not judge the quality of the code on this table.  I mentioned reasons above, I repeat: <br><br><ul><li>  lack of preliminary setup of the analyzer; </li><li>  false positives are not suppressed; </li><li>  different size of the code base; </li><li>  during the writing of the article, changes were made to the analyzer, so that at the time of the beginning and end of the writing of the article, the results in this table may differ. </li></ul><br>  As for the density of warnings (not errors!), Taken without first setting up the analyzer, that is, the ratio of the number of warnings to LOC - it is approximately equal to Firebird and PostgreSQL, and slightly higher at MySQL.  But let's not make hasty conclusions, because, as you know, the devil is in the details. <br><br><h3>  Problems mashing private data </h3><br>  The <a href="https://www.viva64.com/ru/w/v597/">V597</a> warning signals the presence of such a call to the <i>memset</i> function that performs data <a href="https://www.viva64.com/ru/w/v597/">cleansing</a> , which can be removed by the compiler during optimization.  Because of this, private data may remain uncleaned.  The problem is described in more detail in the <a href="https://www.viva64.com/ru/w/v597/">documentation for the diagnostic rule</a> . <br><br>  Neither Firebird nor PostgreSQL showed any such warning, which cannot be said about MySQL.  Look at the suspicious code of this project. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">my_crypt_genhash</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *ctbuffer, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ctbufflen, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *plaintext, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> plaintext_len, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *switchsalt, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **params)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> salt_len; <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *salt; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> A[DIGEST_LEN]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> B[DIGEST_LEN]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> DP[DIGEST_LEN]; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> DS[DIGEST_LEN]; .... (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(A, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (A)); (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(B, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (B)); (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(DP, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (DP)); (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(DS, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span> (DS)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (ctbuffer); }</code> </pre> <br>  <b>PVS-Studio warnings</b> : <br><br><ul><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'A' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  crypt_genhash_impl.cc 420 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'B' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  crypt_genhash_impl.cc 421 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'DP' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  crypt_genhash_impl.cc 422 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'DS' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  crypt_genhash_impl.cc 423 </li></ul><br>  The analyzer immediately found 4 buffers in one function (!) For which forced data cleansing should be performed, and which, at the same time, may not occur.  Then nullable (in theory) data will remain in memory in the form of ‚Äúas is‚Äù.  The lack of further use of buffers <i>A</i> , <i>B</i> , <i>DP</i> , <i>DS</i> allows the compiler to remove the <i>memset</i> function call, since such a change does not affect the behavior of the program from the point of view of C / C ++.  This problem is described in more detail in the article " <a href="https://www.viva64.com/ru/b/0388/">Safe cleaning of private data</a> ". <br><br>  Other warnings are similar, so I will not analyze them.  I will give them a list: <br><br><ul><li>  V597 The compiler could delete the memset function call, which is used to flush the table_list object.  The RtlSecureZeroMemory () function should be used to erase the private data.  sql_show.cc 630 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'W' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  sha.cpp 413 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'W' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  sha.cpp 490 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'T' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  sha.cpp 491 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'W' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  sha.cpp 597 </li><li>  V597 The compiler couldn‚Äôt delete the memset function call, which is used to flush 'T' buffer.  The RtlSecureZeroMemory () function should be used to erase the private data.  sha.cpp 598 </li></ul><br>  But a slightly more interesting case. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">win32_dealloc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct event_base *_base, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32op</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32op</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">;</span></span> .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(win32op, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(win32op)); <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(win32op); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v597/">warning</a> : <a href="https://www.viva64.com/ru/w/v597/">V597</a> The compiler could delete the memset function call, which is used to flush the win32op object.  The RtlSecureZeroMemory () function should be used to erase the private data.  win32.c 442 <br><br>  Here the situation is similar, but after resetting the data in memory, the corresponding pointer is passed to the <i>free</i> function.  Despite this, the compiler can still remove the <i>memset</i> call, leaving only the call to the function to free the memory block ( <i>free</i> ).  As a result, the data that should be reset can remain in memory.  More information can be found in the above mentioned article. <br><br>  <b>Scoring.</b>  Quite a serious mistake, there is more, not found in a single copy.  3 MySQL penalty points. <br><br><h3>  Failure to check the validity of the pointer returned by malloc and similar functions. </h3><br>  <a href="https://www.viva64.com/ru/w/v769/">V769</a> warnings were issued for all three projects. <br><br><ul><li>  Firebird: high certainty - 0;  medium certainty - 0;  low certainty - 9; </li><li>  MySQL: high certainty - 0;  medium certainty - 13;  low certainty - 103; </li><li>  PostgreSQL: high certainty - 1 medium certainty - 2;  low certainty - 24. </li></ul><br>  Since we agreed not to consider the third level, Firebird is immediately eliminated (in a good way) from comparison.  All 3 warnings on PostgreSQL code also turned out to be irrelevant.  But with MySQL, everything is not so clear.  There were false positives there as well, but some warnings are quite interesting. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> Gcs_message_stage_lz4::apply(Gcs_packet &amp;packet) { .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *new_buffer = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(new_capacity); <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *new_payload_ptr = new_buffer + fixed_header_len + hd_len; <span class="hljs-comment"><span class="hljs-comment">// compress payload compressed_len= LZ4_compress_default((const char*)packet.get_payload(), (char*)new_payload_ptr, static_cast&lt;int&gt;(old_payload_len), compress_bound); .... }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v769/">warning</a> : <a href="https://www.viva64.com/ru/w/v769/">V769</a> The 'new_buffer' pointer in the 'new_buffer + fixed_header_len' expression could be nullptr.  In such a case, it will not be used.  Check lines: 74, 73. gcs_message_stage_lz4.cc 74 <br><br>  The <i>malloc</i> function, if it failed to return the requested memory block, returns a null pointer, which can be written to the variable <i>new_buffer</i> .  Further, when initializing the value of the variable <i>new_payload_ptr</i> , the value of the pointer <i>new_buffer is</i> summed with the values ‚Äã‚Äãof the variables <i>fixed_header_len</i> and <i>hd_len</i> .  That's all, the point of no return for the pointer <i>new_payload_ptr</i> : if somewhere further (for example, in another function) we want to check the pointer's validity by comparing it with <i>NULL</i> , such a test will not help.  You can judge the consequences yourself.  Therefore, before initializing <i>new_payload_ptr,</i> you should check that <i>new_buffer</i> is not a null pointer. <br><br>  Someone may argue - why check the return value of <i>malloc</i> to <i>NULL</i> if we could not get the necessary block of memory?  All the same, further normal work is impossible, therefore, let the application fall when further working with this pointer, for example. <br><br>  Due to the fact that some developers adhere to this position, it has a right to exist, but how correct is this approach?  After all, you can try to somehow handle this situation in order, for example, not to lose data, or to 'fall more gently'.  In addition, such code becomes potentially vulnerable, since  if the operation does not occur directly with a null pointer, but with another block of memory ( <i>null pointer + value</i> ), the application may well damage some data.  Moreover, all this is another way to add vulnerability to the application.  Do you need it?  Pros, cons and final decision, I think everyone will make for himself. <br><br>  I advise you to stick with the second approach, and the <a href="https://www.viva64.com/ru/w/v769/">V769</a> diagnostic rule will help you in detecting such situations. <br><br>  If you decide that such functions can never return <i>NULL</i> , you can inform the analyzer of this in order not to receive the corresponding warnings.  For information on how to do this, see the article " <a href="https://www.viva64.com/ru/m/0040/">Advanced diagnostics</a> ". <br><br>  <b>Scoring.</b>  Given the above, MySQL gets 1 penalty point. <br><br><h3>  Using a potentially null pointer </h3><br>  <a href="https://www.viva64.com/ru/w/v575/">V575</a> warnings were issued for all 3 projects. <br><br>  An example of an error from the Firebird project (medium certainty): <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">write_log</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> log_action, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buff)</span></span></span><span class="hljs-function"> </span></span>{ .... log_info* tmp = <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;log_info*&gt;(<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(log_info))); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(tmp, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(log_info)); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The potential null pointer is passed to 'memset' function.  Inspect the first argument.  Check lines: 1106, 1105. iscguard.cpp 1106 <br><br>  The problem is similar to the one mentioned above - the return value of the <i>malloc</i> function is not checked.  If the requested amount of memory could not be allocated, <i>malloc</i> will return a null pointer, which will then be passed to the <i>memset</i> function. <br><br>  Similar code from the MySQL project: <br><br><pre> <code class="cpp hljs">Xcom_member_state::Xcom_member_state(....) { .... m_data_size= data_size; m_data= <span class="hljs-keyword"><span class="hljs-keyword">static_cast</span></span>&lt;uchar *&gt;(<span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uchar) * m_data_size)); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(m_data, data, m_data_size); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The potential null pointer is passed into 'memcpy' function.  Inspect the first argument.  Check lines: 43, 42. gcs_xcom_state_exchange.cc 43 <br><br>  The error is similar to the problem described above from Firebird.  Just in case, I remind you that there are places where the return value of <i>malloc is</i> checked for <i>NULL</i> inequality.  But this does not apply to them. <br><br>  Similar code was also found in PostgreSQL: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ecpg_filter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *sourcefile, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *outfile)</span></span></span><span class="hljs-function"> </span></span>{ .... n = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *) <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(plen); StrNCpy(n, p + <span class="hljs-number"><span class="hljs-number">1</span></span>, plen); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The potential null pointer is passed into the 'strncpy' function.  Inspect the first argument.  Check lines: 66, 65. pg_regress_ecpg.c 66 <br><br>  There were, however, more interesting high-certainty level warnings on MySQL and PostgreSQL projects. <br><br>  MySQL snippet: <br><br><pre> <code class="cpp hljs">View_change_event::View_change_event(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* raw_view_id) : Binary_log_event(VIEW_CHANGE_EVENT), view_id(), seq_number(<span class="hljs-number"><span class="hljs-number">0</span></span>), certification_info() { <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(view_id, raw_view_id, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(raw_view_id)); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The 'memcpy' function doesn't copy the whole string.  Use 'strcpy / strcpy_s' function to preserve terminal null.  control_events.cpp 830 <br><br>  Using the <i>memcpy</i> function, copy the string from <i>raw_view_id</i> to <i>view_id</i> , the number of bytes copied is calculated using the <i>strlen</i> function.  The caveat is that <i>strlen</i> returns the length of the string without taking into account the terminal zero, therefore, it will not be copied.  It should be borne in mind that now, if you don‚Äôt add the terminal zero yourself, the functions of working with strings will incorrectly work with <i>view_id</i> .  To copy strings correctly, you would use the <i>strcpy</i> / <i>strcpy_s functions</i> . <br><br>  It would seem that similar code from PostgreSQL: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PerformRadiusTransaction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *server, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *secret, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *portstr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *identifier, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *user_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *passwd)</span></span></span><span class="hljs-function"> </span></span>{ .... uint8 *cryptvector; .... cryptvector = palloc(<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(secret) + RADIUS_VECTOR_LENGTH); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(cryptvector, secret, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(secret)); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The 'memcpy' function doesn‚Äôt copy the whole string.  Use 'strcpy / strcpy_s' function to preserve terminal null.  auth.c 2956 <br><br>  There is an interesting difference from the previous case.  The type of variable <i>cryptvector</i> is <i>uint8 *</i> .  Despite the fact that <i>uint8</i> is a pseudonym for the <i>unsigned char</i> , it seems to me that the explicit intention is to show that it will not work with data as with a string.  Therefore, in this context, such an operation is permissible and not alarming as the previous one. <br><br>  I met, however, and the code that seemed less secure. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">intoasc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(interval * i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *str)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *tmp; errno = <span class="hljs-number"><span class="hljs-number">0</span></span>; tmp = PGTYPESinterval_to_asc(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tmp) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -errno; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(str, tmp, <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(tmp)); <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(tmp); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v575/">warning</a> : <a href="https://www.viva64.com/ru/w/v575/">V575</a> The 'memcpy' function doesn‚Äôt copy the whole string.  Use 'strcpy / strcpy_s' function to preserve terminal null.  informix.c 677 <br><br>  The situation is similar to that described above, but closer to the code from MySQL ‚Äî strings are used, the contents of which (with the exception of terminal zero) are copied into memory used somewhere outside ... <br><br>  <b>Scoring.</b>  Firebird - 1 penalty point, PostgreSQL and MySQL - 3 penalty points, (1 - warnings of medium confidence level, 2 - for high confidence level). <br><br><h3>  Potentially dangerous use of formatting functions </h3><br>  <a href="https://www.viva64.com/ru/w/v618/">V618</a> warnings were issued only to the code in the Firebird project. <br><br>  Consider an example: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> USAGE_COMP = <span class="hljs-string"><span class="hljs-string">" USAGE IS COMP"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">gen_based</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> act* action)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">fprintf</span></span>(gpreGlob.out_file, USAGE_COMP); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v618/">warning</a> : <a href="https://www.viva64.com/ru/w/v618/">V618</a> It‚Äôs dangerous to call the format.  The example of the safe code: printf ("% s", str);  cob.cpp 1020 <br><br>  The analyzer was alarmed by the fact that the formatted output function ( <i>fprintf</i> ) is used, but the string is printed directly, without using the format string with the corresponding specifiers.  This can be dangerous, and even cause a vulnerability (see <a href="https://cve.mitre.org/cgi-bin/cvename.cgi%3Fname%3DCVE-2013-4258">CVE-2013-4258</a> ) in cases where the format specifiers are found in the printed line.  Here, the <i>USAGE_COMP</i> string <i>is</i> explicitly defined in the source code and does not contain format specifiers, so such use can be considered valid. <br><br>  In other places the situation is similar: the printed lines were hard-coded and did not contain format specifiers. <br><br>  <b>Scoring.</b>  Due to the fact that it is written above, I decided not to ‚Äúfine‚Äù Firebird. <br><br><h3>  Other warnings from the vulnerability article </h3><br>  There were no warnings for <a href="https://www.viva64.com/ru/w/v642/">V642</a> and <a href="https://www.viva64.com/ru/w/v640/">V640</a> projects - all great. <br><br><h3>  Suspicious use of enumeration items </h3><br>  Sample code from MySQL. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> wkbType { wkb_invalid_type= <span class="hljs-number"><span class="hljs-number">0</span></span>, wkb_first= <span class="hljs-number"><span class="hljs-number">1</span></span>, wkb_point= <span class="hljs-number"><span class="hljs-number">1</span></span>, wkb_linestring= <span class="hljs-number"><span class="hljs-number">2</span></span>, wkb_polygon= <span class="hljs-number"><span class="hljs-number">3</span></span>, wkb_multipoint= <span class="hljs-number"><span class="hljs-number">4</span></span>, wkb_multilinestring= <span class="hljs-number"><span class="hljs-number">5</span></span>, wkb_multipolygon= <span class="hljs-number"><span class="hljs-number">6</span></span>, wkb_geometrycollection= <span class="hljs-number"><span class="hljs-number">7</span></span>, wkb_polygon_inner_rings= <span class="hljs-number"><span class="hljs-number">31</span></span>, wkb_last=<span class="hljs-number"><span class="hljs-number">31</span></span> }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append_geometry</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header.wkb_type == Geometry::wkb_multipoint) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (header.wkb_type == Geometry::wkb_multipolygon) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Geometry::wkb_multilinestring) .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> DBUG_ASSERT(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v768/">warning</a> : <a href="https://www.viva64.com/ru/w/v768/">V768</a> The enumeration constant 'wkb_multilinestring' is used as a variable of a Boolean-type.  item_geofunc.cc 1887 <br><br>  In principle, the warning text speaks for itself.  If you look at conditional expressions, you can see that two are comparisons of <i>header.wkb_type</i> with elements of the <i>Geomerty</i> enumeration, and the third conditional expression is the element of the enumeration.  Since <i>Geometry :: wkb_multilinestring</i> is set to <i>5</i> , the body of this conditional statement will always be executed when the two previous checks fail.  Thus, the <i>else</i> branch containing the <i>DBUG_ASSERT</i> macro will never be executed.  Obviously, the correct form of the third conditional expression is the following: <br><br><pre> <code class="cpp hljs">header.wkb_type == Geometry::wkb_multilinestring</code> </pre> <br>  What about the other projects?  In PostgreSQL, there were no such warnings, but in Firebird - as many as 9. True, these warnings are already at a lower level (medium certainty), and the pattern detected is also different. <br><br>  The search patterns for errors detected by diagnostic rule <a href="https://www.viva64.com/ru/w/v768/">V768</a> are as follows: <br><br><ul><li>  High certainty: use enumeration members as logical type expressions. </li><li>  Medium certainty: use of variables that have an enumeration type, as boolean expressions. </li></ul><br>  Consequently, if in the first case it does not work out, then you can somehow argue with the warnings of the analyzer at the second level of reliability. <br><br>  For example, most cases are something like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> att_type { att_end = <span class="hljs-number"><span class="hljs-number">0</span></span>, .... }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fix_exception</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., att_type&amp; failed_attrib, ....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!failed_attrib) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v768/">warning</a> : <a href="https://www.viva64.com/ru/w/v768/">V768</a> The variable 'failed_attrib' is of enum type.  It is odd that it is used as a variable of a Boolean-type.  restore.cpp 8580 <br><br>  The analyzer considered a suspicious code, which thus checks that the variable <i>failed_attrib</i> is <i>att_type :: att_end</i> .  I would, for example, prefer an explicit comparison with an enumeration item.  However, I cannot say that this code is wrong.  Yes, I do not like this style (and the analyzer, too), but the code is valid. <br><br>  But there are 2 places that look more suspicious.  The pattern is the same, so consider only one case. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> EDS { .... <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> TraScope {traAutonomous = <span class="hljs-number"><span class="hljs-number">1</span></span>, traCommon, traTwoPhase}; .... } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ExecStatementNode</span></span></span><span class="hljs-class"> :</span></span> .... { .... EDS::TraScope traScope; .... }; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ExecStatementNode::genBlr(DsqlCompilerScratch* dsqlScratch) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (traScope) .... .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v768/">warning</a> : <a href="https://www.viva64.com/ru/w/v768/">V768</a> The variable 'traScope' is of enum type.  It is odd that it is used as a variable of a Boolean-type.  stmtnodes.cpp 3448 <br><br>  The code is similar to the previous one - they also wanted to check that the <i>traScope</i> variable contains the value of the enumeration element with the actual non-zero value.  But here, unlike the previous example, there are no enumeration elements with the actual value '0'.  So this code looks more suspicious than the previous one. <br><br>         ,  ,   MySQL    ‚Äî 10 . <br><br> <b> .</b> Firebird  1  , MySQL ‚Äî 2. <br><br><h3>      </h3><br> ,      . ,      ,        . <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32op</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fd_setsz; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win_fd_set</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readset_in</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win_fd_set</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">writeset_in</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win_fd_set</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">readset_out</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win_fd_set</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">writeset_out</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win_fd_set</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exset_out</span></span></span><span class="hljs-class">;</span></span> RB_HEAD(event_map, event_entry) event_root; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> signals_are_broken : <span class="hljs-number"><span class="hljs-number">1</span></span>; }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">win32_dealloc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(struct event_base *_base, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32op</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">win32op</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">arg</span></span></span><span class="hljs-class">;</span></span> .... <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(win32op, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(win32op)); <span class="hljs-built_in"><span class="hljs-built_in">free</span></span>(win32op); }</code> </pre> <br> <b> PVS-Studio</b> : <a href="https://www.viva64.com/ru/w/v579/">V579</a> The memset function receives the pointer and its size as arguments.  It is possibly a mistake.  Inspect the third argument. win32.c 442 <br><br>         <i>memset</i> .  <i>sizeof</i>      ,       , ,  <i>sizeof</i>   ,    . <br><br> - ,   ,    <i>memset</i>   , ''     . <br><br>  ‚Äî        ,   .      ,        .     ,        <a href="https://www.viva64.com/ru/w/v501/">V501</a>  <a href="https://www.viva64.com/ru/examples/v501/">C/C++ </a>  <a href="https://www.viva64.com/ru/w/v3001/">V3001</a>  <a href="https://www.viva64.com/ru/examples/v3001/">C# </a> . <br><br>     <a href="https://www.viva64.com/ru/w/v579/">V579</a>  . <br><br> <b> .</b> 2    MySQL. <br><br>    .   MySQL. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> Error_message_buf[<span class="hljs-number"><span class="hljs-number">1024</span></span>]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_last_error_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Error_message_buf buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> error= GetLastError(); buf[<span class="hljs-number"><span class="hljs-number">0</span></span>]= <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; FormatMessage(FORMAT_MESSAGE_FROM_SYSTEM, <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, error, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(buf), <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> buf; }</code> </pre> <br> <b> PVS-Studio</b> : <a href="https://www.viva64.com/ru/w/v511/">V511</a> The sizeof() operator returns size of the pointer, and not of the array, in 'sizeof (buf)' expression. common.cc 507 <br><br> <i>Error_message_buf</i> ‚Äî      1024   <i>char</i> .       ‚Äî        <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_last_error_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> buf[</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1024</span></span></span></span><span class="hljs-function"><span class="hljs-params">])</span></span></span></span></code> </pre> <br> <i>buf</i> ‚Äî  ,    ,    ‚Äî     . ,        <i>sizeof(buf)</i>    ,    .          ‚Äî 4  8  1024. <br><br>  Firebird  PostgreSQL     . <br><br> <b> .</b> 2    MySQL. <br><br><h3>    throw </h3><br>    ,    ‚Ä¶   MySQL.    ,    . <br><br><pre> <code class="cpp hljs">mysqlx::<span class="hljs-function"><span class="hljs-function">XProtocol* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">active</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!active_connection) <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::runtime_error(<span class="hljs-string"><span class="hljs-string">"no active session"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> active_connection.get(); }</code> </pre> <br> <b> PVS-Studio</b> : <a href="https://www.viva64.com/ru/w/v596/">V596</a> The object was created but it is not being used. The 'throw' keyword could be missing: throw runtime_error(FOO); mysqlxtest.cc 509 <br><br>    <i>std::runtime_error</i> ,    . ,    ,       <i>throw</i> .   ‚Äî   ( <i>active_connection == nullptr</i> )    . <br><br>   Firebird,   PostgreSQL    . <br><br> <b> .</b> 2    MySQL. <br><br><h3>      </h3><br>       Firebird. <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Message</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createBuffer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Firebird::IMessageMetadata* aMeta)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> l = aMeta-&gt;getMessageLength(&amp;statusWrapper); check(&amp;statusWrapper); buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>[l]; } .... ~Message() { <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> buffer; .... } ..... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* buffer; .... };</code> </pre> <br> <b> PVS-Studio</b> : <a href="https://www.viva64.com/ru/w/v611/">V611</a> The memory was allocated using 'new T[]' operator but was released using the 'delete' operator. Consider inspecting this code. It's probably better to use 'delete [] buffer;'. Check lines: 101, 237. message.h 101 <br><br>    (    <i>buffer</i> ‚Äî   <i>Message</i> )     ‚Äî <i>createBuffer</i> , ,   ,     <i>new[]</i> .          <i>delete</i>  <i>delete[]</i> . <br><br>  MySQL  PostgreSQL    . <br><br> <b> .</b> 2    Firebird. <br><br><h2>  Summing up </h2><br>   ,   : <br><br><ul><li> Firebird: 1 + 1 + 2 = 4 . </li><li> MySQL: 3 + 1 + 2 + 2 + 2 + 2 = 12 . </li><li> PostgreSQL: 3 . </li></ul><br> ,    ,  .    (   )   ‚Ä¶ MySQL!      ,       ‚Äî  ,    ! <br><br>  Firebird  PostgreSQL  .    ‚Äî     ‚Äî   ,   ‚Äî    ,  ,      <a href="https://www.viva64.com/ru/w/v768/">V768</a>   ‚Ä¶    ‚Äî  PostgreSQL    ,    4     ‚Ä¶ <br><br>  ,     'i',  Firebird  PostgreSQL,     ,  , ,   ,       .  , -         ,      ‚Ä¶ <br><br> ,    : <br><br><ul><li> 1  ‚Äî Firebird  PostgreSQL. </li><li> 2  ‚Äî MySQL. </li></ul><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a39/4b1/bfd/a394b1bfd3919b813ddfcfa202d5097a.png"></div><br><br>     ,     ,     ,    ‚Äî  ,   -        ( , ,  Firebird  PostgreSQL,   MySQL). <br><br>     ? ,           .  ,   -     ?   <a href="https://www.viva64.com/ru/pvs-studio-download/"> PVS-Studio</a> !    ?     ;) <br><br><div style="text-align:center;"> <a href="https://www.viva64.com/en/b/0542/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>        ,      : Sergey Vasiliev. <a href="https://www.viva64.com/en/b/0542/">Code Quality Comparison of Firebird, MySQL, and PostgreSQL</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="https://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/343410/">https://habr.com/ru/post/343410/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343394/index.html">The educational system of the future is not far off?</a></li>
<li><a href="../343396/index.html">Here is a new twist? From pedagogy to andragogyka, from andragogy to hivtogogike</a></li>
<li><a href="../343402/index.html">Formulate it: how we rewrote the text of the vacancy and slipped to the solution of mathematical inequality</a></li>
<li><a href="../343404/index.html">Code reuse - as it happens in practice</a></li>
<li><a href="../343406/index.html">Embed multiple growth in team DNA</a></li>
<li><a href="../343414/index.html">How Discord changes the size of 150 million images every day with Go and C ++</a></li>
<li><a href="../343416/index.html">Nontrivial cases of working with servers</a></li>
<li><a href="../343418/index.html">We invite you to the exhibition-conference on the gaming industry on December 9 at VSBI</a></li>
<li><a href="../343420/index.html">Analysis of Cisco CDR and Microsoft Exchange Server Logs with Splunk</a></li>
<li><a href="../343430/index.html">To box or not to box? That is the question</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>