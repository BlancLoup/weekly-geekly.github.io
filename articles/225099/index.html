<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to deploy MS SQL Server 2012 failover cluster on Windows Server 2012R2 for beginners</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This topic will be interesting to beginners. Seasoned gurus and everyone who is already familiar with this issue are unlikely to find something new an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to deploy MS SQL Server 2012 failover cluster on Windows Server 2012R2 for beginners</h1><div class="post__text post__text-html js-mediator-article">  This topic will be interesting to beginners.  Seasoned gurus and everyone who is already familiar with this issue are unlikely to find something new and useful.  All the rest you are welcome under the cat. <br><br>  The task that we face is to ensure uninterrupted operation and high availability of the database in a client-server deployment option. <br>  Configuration type is active / passive. <br><br>  PS The issues of redundancy of nodes not related to MSSQL are not considered. <br><a name="habracut"></a><br><h4>  Stage 1 - Preparation </h4><br>  Basic hardware and software requirements: <br><ul><li>  Availability of at least 2 nodes (physical / virtual), storage system </li><li>  MS Windows Server, MS SQL ServerSD </li><li>  Storage system <br><ol><li>  Available iSCSI disk for databases </li><li>  Available iSCSI disk for MSDTC </li><li>  Quorum disk </li></ol><br></li></ul><br>  Test bench: <br><ul><li>  Windows Server 2012R2 with AD DS, DNS, DHCP roles (WS2012R2AD) </li><li>  ISCSI Storage * </li><li>  2xWindows Server 2012R2 (for WS2012R2C1 and WS2012R2C2 cluster) </li><li>  Windows Server 2012R2 with elevated 1C server service (WS2012R2AC) </li></ul><br>  * as an option, you can use the Storage role on Windows Server 2012R2, a software solution from StarWind or a real iSCSI network device 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Technically, you can get by with 3 servers having combined all the necessary roles on the domain controller, but in the field it is not recommended to do this. <br><br>  First, we enter into the domain the servers WS2012R2C1 and WS2012R2C2;  on each of them we establish the role ‚ÄúFailover Clustering‚Äù. <br>  After installing the role, launch the Failover Cluster Manager snap-in and go to the Cluster Creation Wizard, where we configure our failover cluster: create Quorum (shared resource) and MSDTC (iSCSI). <br><br><h4>  Stage 2 - Installing MS SQL Server </h4><br>  Important: all actions must be performed on behalf of the user with the right to place new machines in the domain.  (Thanks to <a href="http://habrahabr.ru/users/minamoto/" class="user_link">minamoto</a> for the addition) <br>  For installation, we need the MS SQL Server installation distribution.  Run the installation wizard and select the option to install the new cluster instance: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8cc/549/565/8cc54956558a848f128eb6359f81cc7c.jpg"><br><br>  Next, enter your license key data: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf0/b7a/931/bf0b7a931eedb38b59ba0016a7352067.jpg"><br><br>  Carefully read and accept the license agreement: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/64c/227/e15/64c227e15d88e0f3ed06993d4263ebe9.jpg"><br><br>  We get the available updates: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c3b/3de/baf/c3b3debaf0a5c949ca2a3ce51837cfbd.jpg"><br><br>  Pass the configuration check (we skip the warning MSCS): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fac/cf9/e27/faccf9e27675bdff07905f85fa3f6792.jpg"><br><br>  Select the target installation option: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f25/238/555/f2523855520fc20c5633cc5c6eb61701.jpg"><br><br>  Select the components that we need (for the task, the main ones are sufficient): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bee/e02/b8f/beee02b8fe41acd24334182755650d27.jpg"><br><br>  Another check for installation configuration: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4e4/0f8/b2c/4e40f8b2caf17f766766808f6d69f6bf.jpg"><br><br>  Next - an important step, the choice of the network name for the cluster MSSQL (instance ID - leave): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/971/3c2/03c/9713c203c742451ae1848c8700af5d8b.jpg"><br><br>  Check available space: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/57d/4e5/d21/57d4e5d2104db802576fc87de0179a98.jpg"><br><br>  After that - the list of available storages, data (configured at the preparation stage): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed7/af2/ee9/ed7af2ee98bf0a9f4cb53bd5e9a444de.jpg"><br><br>  Select the drive for the cluster database location: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4eb/27f/63a/4eb27f63a146ef63089b62bdacf757fd.jpg"><br><br>  The configuration of the cluster network interface is recommended to specify the address manually: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/75f/c94/0cf/75fc940cf5be767dabd1b729c0209630.jpg"><br><br>  Specify the administrator's data (you can create a separate user for MSSQL): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb2/aec/ba1/bb2aecba1a0abd3baea66172fbdb435b.jpg"><br><br>  Another important step is the choice of sorting order (Collation).  After installation, changing is extremely problematic: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/89b/f1a/e97/89bf1ae9708fbd82f260f76690b8836d.jpg"><br><br>  Authentication parameters on the server (in our case, the mixed option is chosen, although it is safer to use only domain authentication): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/178/220/4ed/1782204ed1f239befd037103fb48fdb2.jpg"><br><br>  The choice of directories for storing shared cluster files (in versions of MS SQL Server 2012 and older, TempDB can be stored on each node and not placed in shared storage): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eec/a0c/2d9/eeca0c2d9d3d6162ee1c59033d91c568.jpg"><br><br>  Just a couple of checks: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e62/773/439/e6277343966ee41ca7beba949c6aba96.jpg"><br><img src="https://habrastorage.org/getpro/habr/post_images/e0d/665/c5e/e0d665c5ed62ccc63393237114c8f688.jpg"><br><br>  Finally proceed to the installation (the process may take a long time): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/731/270/5c27312704cb0fa6373568651a788f86.jpg"><br><br>  Setup and installation of the base node is completed, as reported by the "green" report <br><br><img src="https://habrastorage.org/getpro/habr/post_images/482/149/50f/48214950feed4dc44e00fec41480a841.jpg"><br><br><h4>  Stage 3 - adding a second node to the MSSQL cluster </h4><br>  Next you need to add the second node to the cluster, since  without it, there is no need to talk about fault tolerance. <br>  Setup and installation is much easier.  On the second server (VM), run the MS SQL Server installation wizard: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab8/e96/173/ab8e961734c8a6fa0aca1d9ecb7cd73f.jpg"><br><br><ul><li>  We pass the starting test </li><li>  Enter the license key: </li><li>  We read and accept the license agreement: </li><li>  We get updates: </li><li>  We pass tests to meet the requirements for the installation of the node (MSCS warning - skip): </li></ul><br><br>  Choose: in which cluster to add the node: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e1a/0ae/d99/e1a0aed996b58b7d8bdf3a82f3be6334.jpg"><br><br>  View and accept network settings of the cluster instance: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/277/a8e/f7c/277a8ef7c2d5d8b523affb84c5478a81.jpg"><br><br>  Specify the user and password (the same as in the first stage): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e0f/64b/277/e0f64b2778fa29aaa0d173bd437e48bc.jpg"><br><br>  Again the tests and installation process: <br><br>  Upon completion, we should get the following picture: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/838/512/d19/838512d191c5f8a9367e6ef8a8b7e7b0.jpg"><br><br>  Congratulations, the installation is complete. <br><br><h4>  Stage 4 - Health Check </h4><br>  Make sure everything works as it should.  To do this, go to the Failover Cluster Manager snap-in: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/28f/7cd/5eb/28f7cd5eb13788fdcbce5e569a6998ac.jpg"><br><br>  At the moment we are using the second node (WS2012R2C2) in case of failure, it will switch to the first node (WS2012R2C1). <br>  Let's try to connect directly to the MSSQL server cluster, for this we need any computer in the domain network with the MSSQL Management Studio installed.  When starting, we specify the name of our cluster and user (or leave the domain authorization). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/01f/355/4e1/01f3554e1792379253734f20d1024466.jpg"><br><br>  After connecting, we see the bases that are spinning in the cluster (in the screenshot there is a separately added base, after the installation, only the system ones are present). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6a4/a27/4ce/6a4a274cee22f300c59686599035882c.jpg"><br><br>  This copy of the failover cluster is fully ready for use with any databases, for example, 1C (for us the task was to deploy such a configuration to work exactly 1C-ki).  Working with him is no different from the usual, but the main feature is the reliability of such a solution. <br><br>  For test purposes, I recommend to play with the disconnection of the nodes and see how the base is migrated between them;  check the important parameters for you, for example, how long the switching will take. <br>  If one of the nodes fails, we break the connection with the base and switch to the second one (recovery time: up to a minute). <br>  In the field, to ensure the reliability of the entire infrastructure, it is necessary to handle the points of failure: DSS, AD and DNS. <br><br>  PS Good luck in building fault-tolerant solutions. </div><p>Source: <a href="https://habr.com/ru/post/225099/">https://habr.com/ru/post/225099/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../225089/index.html">Swift - innovations</a></li>
<li><a href="../225091/index.html">Back / Forward Cache - browser caching mechanism</a></li>
<li><a href="../225093/index.html">About common sense and company management</a></li>
<li><a href="../225095/index.html">What do neural networks hide?</a></li>
<li><a href="../225097/index.html">Floating password</a></li>
<li><a href="../225101/index.html">My experience developing Android games and a few words about monetization</a></li>
<li><a href="../225103/index.html">Sending Zabbix notifications to Skype (Skype calls are a bonus)</a></li>
<li><a href="../225109/index.html">Informal Club Outreach Event DCExpedition for Data Center Managers</a></li>
<li><a href="../225111/index.html">DIY Bending Resistor</a></li>
<li><a href="../225113/index.html">Mail Improvement: Solutions to the Russian Design Cup 2013 Challenge</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>