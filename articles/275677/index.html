<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ABAP: Beautiful</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This publication is intended for ABAP developers in SAP ERP and all of them sympathetic. 

 Few people know that you can include HTML headers in fulls...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ABAP: Beautiful</h1><div class="post__text post__text-html js-mediator-article">  <b>This publication is intended for ABAP developers in SAP ERP and all of them sympathetic.</b> <br><br>  Few people know that you can include HTML headers in fullscreen ALV.  They don‚Äôt even know that you can make a beautiful standard drop-down list, it‚Äôs a select-box, only for such a standard feature, you need a lot of your Z-code. <br><br>  It looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/edf/268/06c/edf26806c1154902b05c6c7152c5874a.png"><br><br>  Welcome under cat. <br><a name="habracut"></a><br>  Go!  Define global variables: <br><br>  - The output table of our report, let it be based on the well-known MARA table; <br>  - A variable in which we will store the current value selected in the select box; <br>  - constant with subroutine for HTML header; <br>  - the handler class that will be triggered when the data is selected, and the handler object. <br><br><pre><code class="html hljs xml">*----------------------------------------------------------------------* *    *----------------------------------------------------------------------* TYPE-POOLS: slis. TABLES: mara. DATA: gt_data TYPE TABLE OF mara WITH HEADER LINE, gv_matnr TYPE mara-matnr. CONSTANTS: gc_form_top TYPE slis_formname VALUE 'DO_HTML_TOP_OF_PAGE'. *----------------------------------------------------------------------* * CLASS cl_my_event_handler DEFINITION *----------------------------------------------------------------------* CLASS cl_my_event_handler DEFINITION. PUBLIC SECTION. METHODS: handle_selections FOR EVENT selected OF cl_dd_select_element IMPORTING sender. ENDCLASS. DATA: go_hand1 TYPE REF TO cl_my_event_handler.</code> </pre> <br>  Let's write the main program of the report and the subroutine on initialization, data acquisition and report output.  Here I‚Äôll especially note that you need to create a handler object and connect the HTML header: i_callback_html_top_of_page = gc_form_top. <br><br><pre> <code class="html hljs xml">*----------------------------------------------------------------------* *  *----------------------------------------------------------------------* SELECT-OPTIONS: so_matnr FOR mara-matnr. INITIALIZATION. PERFORM init. START-OF-SELECTION. PERFORM get_data. END-OF-SELECTION. PERFORM reuse_alv. *&amp;---------------------------------------------------------------------* *&amp; Form init *&amp;---------------------------------------------------------------------* FORM init. " -------------------------------------------------- " "    " -------------------------------------------------- " CREATE OBJECT go_hand1. ENDFORM. *&amp;---------------------------------------------------------------------* *&amp; Form get_data *&amp;---------------------------------------------------------------------* FORM get_data. " -------------------------------------------------- " "   " -------------------------------------------------- " SELECT * FROM mara INTO TABLE gt_data WHERE matnr IN so_matnr. CHECK: sy-subrc IS INITIAL. SORT: gt_data BY matnr. ENDFORM. "get_data *&amp;---------------------------------------------------------------------* *&amp; Form reuse_alv *&amp;---------------------------------------------------------------------* FORM reuse_alv. DATA: lt_fieldcat TYPE TABLE OF lvc_s_fcat. CHECK gt_data[] IS NOT INITIAL. " -------------------------------------------------- " "  ALV " -------------------------------------------------- " CALL FUNCTION 'LVC_FIELDCATALOG_MERGE' EXPORTING i_structure_name = 'MARA' CHANGING ct_fieldcat = lt_fieldcat[] EXCEPTIONS inconsistent_interface = 1 program_error = 2 OTHERS = 3. CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY_LVC' EXPORTING i_callback_program = sy-repid i_callback_html_top_of_page = gc_form_top it_fieldcat_lvc = lt_fieldcat[] i_save = 'A' TABLES t_outtab = gt_data[]. ENDFORM. "reuse_alv</code> </pre><br>  For an HTML header, we create a subroutine with the name specified in the global constant.  Let's call from it a subroutine that will create our beauty: <br><br><pre> <code class="html hljs xml">*&amp;---------------------------------------------------------------------* *&amp; Form do_html_top_of_page *&amp;---------------------------------------------------------------------* FORM do_html_top_of_page USING p_doc TYPE REF TO cl_dd_document. DATA: lo_form TYPE REF TO cl_dd_form_area, lo_sele TYPE REF TO cl_dd_select_element. " -------------------------------------------------- " "   " -------------------------------------------------- " CALL METHOD p_doc-&gt;add_form IMPORTING formarea = lo_form. " -------------------------------------------------- " "  - " -------------------------------------------------- " PERFORM add_casebox TABLES gt_data CHANGING gv_matnr lo_form lo_sele. ENDFORM. "do_html_top_of_page</code> </pre><br>  Let's look at the sub-box for creating select boxes.  Here I‚Äôll note that if there was a command in the report, remove the filters, clean up our global variable (gv_matnr) with a value.  Then we create a line to which we add the filter header, call a subroutine that will fill in the values ‚Äã‚Äãin it, and the filter itself on the form, close the line: <br><br><pre> <code class="html hljs xml">*&amp;---------------------------------------------------------------------* *&amp; Form add_casebox *&amp;---------------------------------------------------------------------* FORM add_casebox *&amp;---------------------------------------------------------------------* TABLES it_data STRUCTURE mara CHANGING iv_matnr TYPE mara-matnr lo_form TYPE REF TO cl_dd_form_area lo_selec TYPE REF TO cl_dd_select_element. *&amp;---------------------------------------------------------------------* DATA: lt_opt_tab TYPE sdydo_option_tab, lv_text TYPE sdydo_text_element. *----------------------------------------------------------------------* DO. CASE sy-index. WHEN 1. " -------------------------------------------------- " "   " -------------------------------------------------- " CHECK sy-ucomm EQ '&amp;ILD'. CLEAR: iv_matnr. WHEN 2. " -------------------------------------------------- " "   " -------------------------------------------------- " CALL METHOD lo_form-&gt;line_with_layout EXPORTING start = 'X'. WHEN 3. " -------------------------------------------------- " "  - " -------------------------------------------------- " lv_text = ':'. CALL METHOD lo_form-&gt;add_text EXPORTING text = lv_text. WHEN 4. " -------------------------------------------------- " "  " -------------------------------------------------- " CALL METHOD lo_form-&gt;add_gap EXPORTING width = 2. WHEN 5. " -------------------------------------------------- " "    " -------------------------------------------------- " PERFORM fill_mat_tab TABLES it_data CHANGING iv_matnr lt_opt_tab. WHEN 6. " -------------------------------------------------- " "   - " -------------------------------------------------- " CALL METHOD lo_form-&gt;add_select_element EXPORTING OPTIONS = lt_opt_tab value = 'P' IMPORTING select_element = lo_selec. WHEN 7. " -------------------------------------------------- " "   " -------------------------------------------------- " SET HANDLER go_hand1-&gt;handle_selections FOR lo_selec. WHEN 8. " -------------------------------------------------- " "   " -------------------------------------------------- " CALL METHOD lo_form-&gt;line_with_layout EXPORTING end = 'X'. WHEN OTHERS. EXIT. ENDCASE. ENDDO. ENDFORM.</code> </pre><br>  In the filter filling program, first add the value that is currently selected so that it is first in the list.  Then we add the value All, if we have more than one value in the table.  And then all the records from the table: <br><br><pre> <code class="html hljs xml">*&amp;---------------------------------------------------------------------* *&amp; Form fill_mat_tab *&amp;---------------------------------------------------------------------* FORM fill_mat_tab *&amp;---------------------------------------------------------------------* TABLES it_data STRUCTURE mara CHANGING iv_matnr TYPE matnr it_optab TYPE sdydo_option_tab. *&amp;---------------------------------------------------------------------* DATA: ls_opt TYPE sdydo_option. REFRESH: it_optab. *----------------------------------------------------------------------* DO. CASE sy-index. WHEN 1. " -------------------------------------------------- " "      " -------------------------------------------------- " CHECK iv_matnr IS NOT INITIAL. ls_opt-value = iv_matnr. ls_opt-text = iv_matnr. APPEND ls_opt TO it_optab. WHEN 2. " -------------------------------------------------- " "    ,   -  " -------------------------------------------------- " READ TABLE it_data INDEX 1. LOOP AT it_data TRANSPORTING NO FIELDS WHERE matnr NE it_data-matnr. ls_opt-value = '*'. ls_opt-text = ''. APPEND ls_opt TO it_optab. EXIT. ENDLOOP. WHEN 3. " -------------------------------------------------- " "    " -------------------------------------------------- " LOOP AT it_data WHERE matnr IS NOT INITIAL. ls_opt-value = it_data-matnr. ls_opt-text = it_data-matnr. COLLECT ls_opt INTO it_optab. ENDLOOP. WHEN OTHERS. EXIT. ENDCASE. ENDDO. ENDFORM.</code> </pre><br>  Introduce our handler.  Here in sender-&gt; value is the value selected by the user.  We write it immediately in our global variable gv_matnr.  In the set_filter routine for processing standard filtering: <br><br>  1) Get a global grid into a local object; <br>  2) We will get the already set filtering parameters, and remove the already installed filter by the field that we are filtering through the select box; <br>  3) Add new filtering options; <br>  4) Save the filter; <br>  5) Update the report. <br><br><pre> <code class="html hljs xml">*----------------------------------------------------------------------* * CLASS cl_my_event_handler IMPLEMENTATION *----------------------------------------------------------------------* CLASS cl_my_event_handler IMPLEMENTATION. METHOD handle_selections. DATA text_buff TYPE sdydo_text_element. text_buff = sender-&gt;value. gv_matnr = text_buff. " -------------------------------------------------- " "     " -------------------------------------------------- " PERFORM set_filter TABLES gt_data USING gv_matnr . ENDMETHOD. "handle_selections ENDCLASS. "cl_my_event_handler IMPLEMENTATION *&amp;---------------------------------------------------------------------* *&amp; Form set_filter *&amp;---------------------------------------------------------------------* FORM set_filter *&amp;---------------------------------------------------------------------* TABLES it_data STRUCTURE mara USING iv_value TYPE mara-matnr. *&amp;---------------------------------------------------------------------* DATA: lo_ref1 TYPE REF TO cl_gui_alv_grid, lt_filtered TYPE lvc_t_filt, lv_field TYPE char10 VALUE 'MATNR', ls_filter LIKE LINE OF lt_filtered. *----------------------------------------------------------------------* DO. CASE sy-index. WHEN 1. " -------------------------------------------------- " "   ALV " -------------------------------------------------- " CALL FUNCTION 'GET_GLOBALS_FROM_SLVC_FULLSCR' IMPORTING e_grid = lo_ref1. WHEN 2. " -------------------------------------------------- " "      .    " -------------------------------------------------- " CALL METHOD lo_ref1-&gt;get_filter_criteria IMPORTING et_filter = lt_filtered. DELETE lt_filtered WHERE fieldname = lv_field. WHEN 3. " -------------------------------------------------- " "    " -------------------------------------------------- " CHECK iv_value NE '' AND iv_value NE '*'. ls_filter-fieldname = lv_field. ls_filter-sign = 'I'. ls_filter-option = 'EQ'. ls_filter-low = iv_value. APPEND ls_filter TO lt_filtered. WHEN 4. " -------------------------------------------------- " "   " -------------------------------------------------- " CALL METHOD lo_ref1-&gt;set_filter_criteria EXPORTING it_filter = lt_filtered EXCEPTIONS no_fieldcatalog_available = 1 OTHERS = 2. IF sy-subrc <span class="hljs-tag"><span class="hljs-tag">&lt;&gt;</span></span> 0. MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4. ENDIF. WHEN 5. " -------------------------------------------------- " "  ALV " -------------------------------------------------- " lo_ref1-&gt;refresh_table_display( ). WHEN OTHERS. EXIT. ENDCASE. ENDDO. ENDFORM.</code> </pre><br>  Run!  We admire the result of suffering: <br><br><img src="https://habrastorage.org/files/03d/407/1a2/03d4071a27ed4624b412766ae70a7aa7.png"><br><br><img src="https://habrastorage.org/files/55f/b79/1ac/55fb791ac1bb48778d1d124de52c6c95.png"><br><br>  UPDATE: can be brought to: <br><img src="https://habrastorage.org/files/c41/090/db7/c41090db72524e18b15aac3b48079921.png"><br>  It seems to be a simple thing, but in SAP you need to try again.  Thanks to all. </div><p>Source: <a href="https://habr.com/ru/post/275677/">https://habr.com/ru/post/275677/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275667/index.html">Analyzing Web Server Logs with GoAccess</a></li>
<li><a href="../275669/index.html">Kickstarter exit: how we failed</a></li>
<li><a href="../275671/index.html">High-performance long polling chat</a></li>
<li><a href="../275673/index.html">Compilation: Over 800 resources for front-end developers</a></li>
<li><a href="../275675/index.html">QA: Conference invites speakers</a></li>
<li><a href="../275679/index.html">Can I make a game without an artist in 2 days? Devstory of my game Neobug Rush 2 Players</a></li>
<li><a href="../275685/index.html">Tips on how to write in C in 2016</a></li>
<li><a href="../275687/index.html">FT Clustering - everRun by Stratus Technologies</a></li>
<li><a href="../275691/index.html">How to block my app on Google Play</a></li>
<li><a href="../275693/index.html">Security Week 03 or patch week: Linux, OpenSSH, Cisco, Yahoo Mail, Apple</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>