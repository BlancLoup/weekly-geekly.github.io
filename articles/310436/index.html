<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Your blog on vibe-d, part 1: a simple web application using encryption</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! If you have long wanted to make a website for yourself, a neighbor or her dog, but have not done it yet, then this article is for you!...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Your blog on vibe-d, part 1: a simple web application using encryption</h1><div class="post__text post__text-html js-mediator-article"><p>  Good day, Habr!  If you have long wanted to make a website for yourself, a neighbor or her dog, but have not done it yet, then this article is for you!  In this series of articles, I will show the basics of working with vibe to create websites on the example of a simple blog. <br>  In the first part, we will analyze the basic moments and add encryption to the resulting application. </p><a name="habracut"></a><br><h4>  0. Let's start from the beginning. </h4><br><ol><li>  install <a href="http://dlang.org/download.html">dmd</a> </li><li>  set the <a href="https://code.dlang.org/download">dub</a> </li><li> create a project that uses vibe with the following commands <br> <code>mkdir yourblogname</code> <br> <code>cd yourblogname</code> <br> <code>dub init -t vibe.d</code> <br>  then go to the dub questions about the application being created.  Most fields will have default values, but I advise you to choose the sdl format, since it is more readable and simpler than json, and the possibilities are the same. </li></ol><br><h4>  1. Simple web application </h4><br><p>  So, we already have a stock from <a href="https://github.com/s-ludwig">Ludwig</a> and we need to expand it.  The first thing we will do is create our application class and add a couple of pages. </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vibe.d; shared static this() { auto settings = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> HTTPServerSettings; settings.port = <span class="hljs-number"><span class="hljs-number">8080</span></span>; settings.bindAddresses = ["::1", "127.0.0.1"]; auto router = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> URLRouter; //       router.registerWebInterface(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> MyBlog); //    router.rebuild(); //     =) listenHTTP(settings, router); //      } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> MyBlog { @path("/") <span class="hljs-type"><span class="hljs-type">void</span></span> getHome(scope HTTPServerRequest req, scope HTTPServerResponse res) { res.writeBody("Hello, World! &lt;a href='/page2'&gt;go to page2&lt;/a&gt;", "text/html; charset=UTF-8"); } <span class="hljs-type"><span class="hljs-type">void</span></span> getPage2(scope HTTPServerRequest req, scope HTTPServerResponse res) { res.writeBody("Page2 &lt;a href='/'&gt;go to index&lt;/a&gt;", "text/html; charset=UTF-8"); } }</code> </pre> <br><p>  As you can see, the <code>getHome</code> method has a <a href="https://dlang.org/spec/attribute.html">UDA</a> <code>@path("/")</code> , which indicates that this is the root page.  UDA - user defined attributes - the attributes declared by the user.  In fact, these are any objects of the language: enums, structures, simple data types.  Using the essence that has the UDA, we can check the <a href="https://dlang.org/phobos/std_traits.html">presence of the</a> attribute, its <a href="https://dlang.org/phobos/std_traits.html">value</a> , as well as get all the fields and methods in the class / structure <a href="https://dlang.org/phobos/std_traits.html">marked</a> with some UDA.  vibe, in this case, uses this to build the routing code.  The <code>getPage2</code> method uses the <a href="http://vibed.org/api/vibe.web.web/registerWebInterface">naming convention</a> and will work on the get request on the path <code>http://127.0.0.1:8080/page2</code> .  <code>@property</code> methods will behave in the same way.  Now the methods of their signature does not differ from the <code>hello</code> function in the template and we write the body of the pages by hand.  Not comme il faut, add views to the <code>views</code> folder and immediately mind. </p><br><p>  Create several files: </p><br><div class="spoiler">  <b class="spoiler_title">views / layout.dt</b> <div class="spoiler_text"><p>  Template for all pages of the site </p><br><pre> <code class="hljs ruby">doctype html html head /<span class="hljs-regexp"><span class="hljs-regexp">/   head block head /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    title   ,      head title </span><span class="hljs-subst"><span class="hljs-regexp"><span class="hljs-subst">#{title}</span></span></span><span class="hljs-regexp"> body header /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/      div,    '&lt;div class="mrow"&gt;' .mrow /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/    views/header</span></span>.dt <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> header main .mrow /<span class="hljs-regexp"><span class="hljs-regexp">/   main block main footer .mrow /</span></span><span class="hljs-regexp"><span class="hljs-regexp">/  views/footer</span></span>.dt <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> footer</code> </pre> <br><p>  Comment indents must match the indentation of blocks.  Comments fall into the resulting html if you do not want to use <code>// -</code> (with a minus sign). </p></div></div><br><div class="spoiler">  <b class="spoiler_title">views / header.dt</b> <div class="spoiler_text"><p>  There will be a site header </p><br><pre> <code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">div</span></span>  </code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">views / footer.dt</b> <div class="spoiler_text"><p>  There will be a basement site </p><br><pre> <code class="hljs axapta"><span class="hljs-keyword"><span class="hljs-keyword">div</span></span> ,   </code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">views / index.dt</b> <div class="spoiler_text"><p>  The main page, the first line we indicate which template we want to expand (without the path, because in the same folder and without the <code>.dt</code> extension) </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">extends</span></span> layout block head //       ,       //    ,  D ,              - auto title = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">block</span></span> main //     - html,     div  a(href=<span class="hljs-string"><span class="hljs-string">"/page2"</span></span>)   </code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">views / page2.dt</b> <div class="spoiler_text"><p>  The second page is similar to the main </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">extends</span></span> layout block head - auto title = <span class="hljs-string"><span class="hljs-string">" "</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">block</span></span> main div   <span class="hljs-number"><span class="hljs-number">2</span></span> a(href=<span class="hljs-string"><span class="hljs-string">"/"</span></span>)  </code> </pre> </div></div><br><p>  And correct the code of our blog </p><br><pre> <code class="hljs java"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBlog</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@path</span></span>(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHome</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render!(<span class="hljs-string"><span class="hljs-string">"index.dt"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPage2</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ render!(<span class="hljs-string"><span class="hljs-string">"page2.dt"</span></span>); } }</code> </pre> <br><p>  It has become more concise, we do not need to directly write the response body now.  Add style! </p><br><div class="spoiler">  <b class="spoiler_title">public / style.css</b> <div class="spoiler_text"><pre> <code class="hljs css">* { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">13px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: center; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; } <span class="hljs-selector-class"><span class="hljs-selector-class">.mrow</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> auto; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">1170px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">text-align</span></span>: left; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">60px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#e2e2e2</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-top</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">border-right</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">border-left</span></span>: none; <span class="hljs-attribute"><span class="hljs-attribute">border-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">1px</span></span> solid; <span class="hljs-attribute"><span class="hljs-attribute">border-radius</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">border-color</span></span>: <span class="hljs-number"><span class="hljs-number">#aaa</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">margin-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">font-size</span></span>: <span class="hljs-number"><span class="hljs-number">24px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">header</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">main</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">footer</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">height</span></span>: <span class="hljs-number"><span class="hljs-number">60px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">width</span></span>: <span class="hljs-number"><span class="hljs-number">100%</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">background</span></span>: <span class="hljs-number"><span class="hljs-number">#333</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: <span class="hljs-number"><span class="hljs-number">#bbb</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">position</span></span>: absolute; <span class="hljs-attribute"><span class="hljs-attribute">margin-top</span></span>: <span class="hljs-number"><span class="hljs-number">20px</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">padding</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-attribute"><span class="hljs-attribute">bottom</span></span>: inherit; <span class="hljs-attribute"><span class="hljs-attribute">border-top</span></span>: <span class="hljs-number"><span class="hljs-number">2px</span></span> solid <span class="hljs-number"><span class="hljs-number">#888</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">footer</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">div</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">padding-top</span></span>: <span class="hljs-number"><span class="hljs-number">10px</span></span>; }</code> </pre> </div></div><br><p>  It is necessary to enable the distribution of static files in our application. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">shared </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... router.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(<span class="hljs-string"><span class="hljs-string">"*"</span></span>, serveStaticFiles(<span class="hljs-string"><span class="hljs-string">"public/"</span></span>)); ... }</code> </pre> <br><p>  And finally, add a style to the head of our <code>layout.dt</code> </p><br><pre> <code class="hljs perl">... html head <span class="hljs-keyword"><span class="hljs-keyword">link</span></span>(rel=<span class="hljs-string"><span class="hljs-string">"stylesheet"</span></span>, href=<span class="hljs-string"><span class="hljs-string">"style.css"</span></span>) ...</code> </pre> <br><p>  After assembly and launch should look something like this: </p><br><img src="https://habrastorage.org/files/f02/5cd/2be/f025cd2beea44f06ada28f746817bcd5.png"><br><p><br>  Not really, but I hope that the <a href="">eyes do not fall out</a> and it will be more pleasant to work with it) </p><br><h4>  2. Secure </h4><br><p>  We have some kind of basis, now it's time to think about further development.  And before adding any functionality, we will take care of security: we will add encryption.  About creating certificates you can find a lot of information, <a href="https://habrahabr.ru/post/192446/">for example</a> .  Here are the main steps without a description: </p><br><h6>  Root key </h6><br><p> <code>openssl genrsa -out rootCA.key 2048</code> </p> <br><h6>  Root certificate </h6><br><p> <code>openssl req -x509 -new -key rootCA.key -days 9999 -out rootCA.crt</code> <br>  Answers to questions are not important, we will make our browser trust him) </p><br><h6>  Another key </h6><br><p> <code>openssl genrsa -out server.key 2048</code> </p> <br><h6>  Certificate request (it is important to specify the domain name) </h6><br><p> <code>openssl req -new -key server.key -out server.csr</code> </p> <br><h6>  Sign a new certificate </h6><br><p> <code>openssl x509 -req -in server.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial -out server.crt -days 9998</code> <br>  <code>rootCA.crt</code> to the browser <code>rootCA.crt</code> , <code>rootCA.key</code> kept secret. </p><br><p>  Now enable encryption in our application. </p><br><pre> <code class="hljs axapta">shared <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>() { ... settings.tlsContext = createTLSContext(TLSContextKind.<span class="hljs-keyword"><span class="hljs-keyword">server</span></span>); settings.tlsContext.useCertificateChainFile(<span class="hljs-string"><span class="hljs-string">"server.crt"</span></span>); settings.tlsContext.usePrivateKeyFile(<span class="hljs-string"><span class="hljs-string">"server.key"</span></span>); ... }</code> </pre> <br><p>  Now, if you did everything correctly, the site will no longer be accessible via <code>http</code> and will become accessible without questions about <code>https</code> . </p><br><h4>  3. The simplest authorization </h4><br><p>  To begin, create a session in our application. </p><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-function">shared </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">this</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { ... settings.sessionStore = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MemorySessionStore; ... }</code> </pre> <br><p>  Add some code.  Outside of our class there will be a session variable type. </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserSettings</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> loggedIn = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> email; }</code> </pre> <br><p>  For inseparable perception, it would probably be better to show the whole new class. </p><br><pre> <code class="hljs lua">class MyBlog { mixin PrivateAccessProxy; private SessionVar!(UserSettings, <span class="hljs-string"><span class="hljs-string">"settings"</span></span>) userSettings; //   //   _error        @<span class="hljs-built_in"><span class="hljs-built_in">path</span></span>(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) void getHome(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> _error) { auto <span class="hljs-built_in"><span class="hljs-built_in">error</span></span> = _error; auto settings = userSettings; render!(<span class="hljs-string"><span class="hljs-string">"index.dt"</span></span>, settings, <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>); } /+ @errorDisplay ,         msg   getHome,    _error,           @auth  ,    ,     ,   ,   auth, ,  ,      ,   ,     email  +/ @auth @errorDisplay!getHome void getWritepost(<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> _email) { auto email = _email; render!(<span class="hljs-string"><span class="hljs-string">"writepost.dt"</span></span>, email); } // ValidEmail     <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>,      @errorDisplay!getHome void postLogin(ValidEmail email, <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> pass) { enforce(pass == <span class="hljs-string"><span class="hljs-string">"secret"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>); //       userSettings = UserSettings(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, email); //            redirect(<span class="hljs-string"><span class="hljs-string">"./"</span></span>); } void postLogout(scope HTTPServerResponse res) { userSettings = UserSettings.init; res.terminateSession(); redirect(<span class="hljs-string"><span class="hljs-string">"./"</span></span>); } private: /+       ensureAuth,        ensureAuth   _email   +/ enum auth = before!ensureAuth(<span class="hljs-string"><span class="hljs-string">"_email"</span></span>); /+      ,    ,  email  +/ <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> ensureAuth(scope HTTPServerRequest req, scope HTTPServerResponse res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!userSettings.loggedIn) redirect(<span class="hljs-string"><span class="hljs-string">"/"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> userSettings.email; } }</code> </pre> <br><p>  All public class methods are <code>ensureAuth</code> , so <code>ensureAuth</code> created as <code>private</code> .  At the same time, the vibe needs to know about this method to call it before the methods marked with <code>@auth</code> , so you need to use the <code>mixin PrivateAccessProxy</code> .  The <code>@auth</code> attribute is created using the <code>before</code> template, acting as a hook, calls the specified function before the one marked and passes the result of the hook function as an argument.  There is also an <code>@after</code> that will force the function to execute after and requires the hook function to accept the result flagged as an argument.  Unfortunately, I did not find the documentation on the vibe site, but there is documentation on these points in the code.  We also renamed (deleted) the method page2.  In its place stood getWritepost, which will return the page to create a new post. </p><br><p>  You should also slightly modify the remaining files. </p><br><ul><li><p>  Insert a block into <code>views/layout.dt</code> , which will contain a <code>block error</code> display (it will be inserted into the layout from other files) </p><br></li><li><p>  In <code>views/index.dt</code> add an error display block, it may look like this </p><br><pre> <code class="hljs vbscript">... block <span class="hljs-keyword"><span class="hljs-keyword">error</span></span> - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>.length) div#<span class="hljs-keyword"><span class="hljs-keyword">error</span></span> #{<span class="hljs-keyword"><span class="hljs-keyword">error</span></span>} ...</code> </pre> <br><p>  As you most likely understood, the code on D should follow the '-' sign, and <code>#{value}</code> escapes and inserts the value variable in html. </p><br></li><li><p>  Create a <code>views/logindesk.dt</code> file where to add a form for a login </p><br><pre> <code class="hljs pgsql">div form#loginform(action="/login", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>="POST") div <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>="form-control",<span class="hljs-type"><span class="hljs-type">name</span></span>="email",placeholder="Email",<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="email",required) div <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>="form-control",<span class="hljs-type"><span class="hljs-type">name</span></span>="pass",placeholder="",<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="password",required) div button(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="submit") </code> </pre> <br><p>  It is necessary to carefully treat the indents, they work as in python (and here the formatting sometimes eats spaces). </p><br></li><li><p>  In the file <code>views/index.dt</code> change the main block </p><br><pre> <code class="hljs axapta">... block main - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!settings.loggedIn) include logindesk - <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">div</span></span> </code> </pre> <br><p>  The variables <code>settings</code> and <code>error</code> are passed to the template by the function <code>render!("index.dt", settings, error);</code>  in the <code>getHome</code> method.  Each presentation template takes its own set of variables. </p><br></li><li>  In the <code>views/writepost.dt</code> write a form that so far will not do anything </li></ul><br><pre> <code class="hljs pgsql">extends layout block head - auto title = " "; block main div    #{email} form#postform(action="/posts", <span class="hljs-keyword"><span class="hljs-keyword">method</span></span>="POST") div  <span class="hljs-keyword"><span class="hljs-keyword">input</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>="from-control", <span class="hljs-type"><span class="hljs-type">name</span></span>="title") div  textarea(<span class="hljs-keyword"><span class="hljs-keyword">class</span></span>="form-contorl", <span class="hljs-type"><span class="hljs-type">name</span></span>="text") div button(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="submit") </code> </pre> <br><ul><li>  Create a link to "New Post" and "Home" on your own. </li><li>  Make out the styles of all this at your own discretion (I'll post my code in the final form at the end) </li></ul><br><p>  Now we have a site where you can log in and there is a page on the site (writepost) that you cannot go to if you are not logged in. </p><br><h4>  4. Simplest blog entries </h4><br><p>  The article turned out to be quite voluminous, but I want to bring it to some logical comma) <br>  Add a record of new articles in the usual class field, and the field type will be an array of structures </p><br><pre> <code class="hljs cpp"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> author; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> title; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> text; }</code> </pre> <br><p>  Add this array to our class, pass it in parameters to the <code>render</code> function of the <code>getHome</code> method, and add a method that writes these posts to the array. </p><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyBlog</span></span> { ... <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: Post[] posts; @path(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getHome</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> _error</span></span></span><span class="hljs-function">)</span></span> { ... render!(<span class="hljs-string"><span class="hljs-string">"index.dt"</span></span>, posts, settings, error); } ... <span class="hljs-comment"><span class="hljs-comment">//        getWritepost @auth @errorDisplay!getWritepost void postPosts(string title, string text, string _email) { posts ~= Post(_email, title, text); redirect("./"); } ... }</span></span></code> </pre> <br><p>  Be careful - the names of the parameters of the methods must coincide with the names of the form fields!  It remains a major change that will allow us to see the posts.  In the file <code>views/index.dt</code> replace the entry "Content" to the code </p><br><pre> <code class="hljs delphi"> ... - <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!settings.loggedIn) include logindesk - <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> - foreach(post; posts) <span class="hljs-keyword"><span class="hljs-keyword">div</span></span>.post <span class="hljs-keyword"><span class="hljs-keyword">div</span></span>.title #<span class="hljs-comment"><span class="hljs-comment">{post.title}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">div</span></span>.text #<span class="hljs-comment"><span class="hljs-comment">{post.text}</span></span> <span class="hljs-keyword"><span class="hljs-keyword">div</span></span>.author #<span class="hljs-comment"><span class="hljs-comment">{post.author}</span></span></code> </pre> <br><p>  By this time you should have already created an application in which there is: </p><br><ul><li>  the simplest form of authorization </li><li>  traffic encryption </li><li>  authorization check </li><li>  add and display posts </li></ul><br><p>  I did this: </p><br><img src="https://habrastorage.org/files/839/123/9b9/8391239b94a045a08d7595d152518ef8.png"><br><p><br>  The source of this part is <a href="https://github.com/deviator/blogexample/tree/part1">here</a> . </p><br><p>  In the following parts, I will tell you how to use mongo, make pages for posts (url will contain an index or name of the post) and commenting, show more adequate authorization and some more trivia. </p><br><p>  Write in the comments that it was not completely clear, I will be glad to modify this part. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310436/">https://habr.com/ru/post/310436/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310420/index.html">WD My Cloud Mirror - inaccessibility from under networks of the range 172.16.0.0/12</a></li>
<li><a href="../310422/index.html">Zone.js or how Dart saved Angular</a></li>
<li><a href="../310428/index.html">Taming Yota with Zyxel</a></li>
<li><a href="../310432/index.html">Application on Elm in seconds</a></li>
<li><a href="../310434/index.html">As we wrote freelance exchange for Telegram</a></li>
<li><a href="../310438/index.html">First steps in Java: how to start developing without installing anything</a></li>
<li><a href="../310442/index.html">USB killer type-c</a></li>
<li><a href="../310446/index.html">Writing Hello World for HoloLens</a></li>
<li><a href="../310448/index.html">How do American fintech startups replace banking freelancers</a></li>
<li><a href="../310450/index.html">Development of an electronic document management system from the inside: How we prepare SED TEZIS for release</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>