<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to shuffle songs?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We here in Spotify take seriously the feedback from users. Some time ago, we noticed that users complained that when random playlist shuffle is on, th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to shuffle songs?</h1><div class="post__text post__text-html js-mediator-article">  We here in Spotify take seriously the feedback from users.  Some time ago, we noticed that users complained that when random playlist shuffle is on, the order of songs is actually not random - for example, several songs by the same artist can be played one after another, despite the fact that playlist many songs of different artists.  Users asked, are we really not able to do such a simple thing as a random order of playing tracks?  We replied, "He is true-true by chance!"  We checked! " <br><br>  So who was right, we or the users?  As it turned out - we and they.  Well, in general, the situation was much more serious than it seemed at first glance. <br><br><h2>  Our point of view </h2><br>  Even in the very first release of our player, it had the function of randomly shuffling the playlist.  We used the <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B0%25D1%2581%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25A4%25D0%25B8%25D1%2588%25D0%25B5%25D1%2580%25D0%25B0_%25E2%2580%2594_%25D0%2599%25D0%25B5%25D1%2582%25D1%2581%25D0%25B0">Fisher-Yates</a> algorithm for this ‚Äî and it gave perfect random mixing.  But what is ‚Äúperfectly random‚Äù?  This means, for example, that we can get one of the following two orders of songs with the same probability (different colors mean tracks by different artists): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/c9f/833/54f/c9f83354f0d640128ec9b99f0bb1e601.png" alt="image"><br><a name="habracut"></a><br>  By the way, personal opinion: the Fisher-Yates algorithm is one of the most elegant algorithms known to me.  It is simply amazing how such a difficult task can be solved in 3 lines of code, to give the correct result and to perform the minimum number of operations. <br><br><h2>  Misconception player </h2><br>  At first, we did not understand what the users were trying to say to us with their complaints about ‚Äúnot an accident‚Äù.  But after a thoughtful reading of the comments, we realized that people do not like the situation when several songs of the same artist play in a row.  And not even just ‚Äúin a row‚Äù, but when, for example, in 5 songs played 3 belong to one author (even if other songs were played between them).  People considered this a clear violation of chance. <br><br>  It is well known that people sometimes make serious mistakes in the intuitive perception of probabilities.  Imagine that every day at work you throw up a coin to decide whether you will eat lunch today - Thai food or Indian.  In the first 4 days, the coin chose Thai.  And on Friday you are thinking ‚Äúso, 4 days the coin chose the same thing, well, today there will definitely be Indian food!‚Äù.  And Thai falls again.  The fact is that the coin has no memory, she ‚Äúdoes not know‚Äù that she chose yesterday and does not take it into account at all in today's ‚Äúdecision‚Äù.  Millionth throw has the same chances of falling out of an eagle or tails, like the first - 50%. <br><br>  Or another example: people think that if they played a lot of times in the lottery and did not win, then next time they have a greater chance of winning something.  This phenomenon is called a player's delusion, and it is applicable to the lottery, and to the above described case with a coin and a choice of food. <br><br>  Let's go back to our users, who are also people, which means no less than the others are subject to the player's delusions.  If you have just listened to a song of a singer, and there are other of his songs in your playlist, then these songs, if the playlist is randomly mixed, have every right to get to the next position in the playlist.  They are no worse than other songs. <br><br>  But as they say - "the client is always right."  And we decided to think about how to change our mixing algorithm so that its ‚Äúrandomness‚Äù would be good enough not from a mathematical, but from a psychological point of view.  Since the ideal mathematical randomness does not look sufficiently random for people. <br><br><h2>  Algorithm </h2><br>  The task looked like something that should have already been solved by someone earlier.  And indeed, we found the article ‚ÄúThe <a href="http://keyj.emphy.de/balanced-shuffle/">Art of Mixing Music,</a> ‚Äù written by Martin Fiedler and about the same problem being solved.  However, the algorithm described in it was overcomplicated and sometimes worked too slowly, so we modified it according to our tasks: <br><br>  The main idea is similar to ‚Äúshaking‚Äù.  Imagine that we have a picture drawn in shades of gray (there are several hundreds): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f3/d66/9e8/8f3d669e80413d087719bca7b3d5a91e.png" alt="image"><br><br>  We want to simplify the image by converting it to a black and white spectrum (use only pure black and pure white pixels).  This can be done as follows: if the gray pixel is more than 80% black, it gets a chance to become pure black by 80% and become pure white by 20%.  We process the pixels one by one and for each we define a new color according to the above rule.  The result, of course, will somewhat resemble the original, but still it is impossible to say that it turned out well: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e9f/fcd/5c4/e9ffcd5c41cd22700f2ebb5a777470ef.png" alt="image"><br><br>  As you can see, black pixels are clustered together, plus large white gaps between them have formed.  It would be better if the groups of black and white pixels were smaller and more evenly distributed.  To do this, you can use another algorithm, for example, <a href="http://en.wikipedia.org/wiki/Floyd%25E2%2580%2593Steinberg_dithering">Floyd-Steinberg</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/add/933/a89/add933a89a9344499410f1926b3f3a1d.png" alt="image"><br><br>  The clusters, well visible in the previous picture, are gone.  We can use the ideas of this algorithm in our task of mixing songs.  This will allow us to avoid knocking down songs of one artist into clusters - we will try to distribute them throughout the playlist.  Let's imagine that we have a playlist consisting of songs by artists such as The White Stripes (red in the picture), The xx (black), Bonobo (green), Britney Spears (pink) and Jaga Jazzist (orange).  We will take the songs of each of the performers and try to "smear" them on the playlist.  A picture is better than a thousand words: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c2/e31/3b5/5c2e313b50546b28d8bffd1c09da380c.png" alt="image"><br><br>  As you can see, the songs of each artist are distributed far enough from each other, and this order of the playlist looks ideally random to the human eye (although it is not).  Let's take a closer look at how the algorithm works. <br><br>  Suppose we have 4 songs by The White Stripes (as in the picture above).  This means that each of the songs should fall approximately every 25% of the total duration of the playlist.  We distribute 4 songs at a distance of 20% to 30% from each other (this is how it looks "random").  See, the distances between the red circles on the line are not the same.  At the beginning we add a random indent, otherwise the first songs of each artist will fall into point 0 on the line.  You may notice that Britney Spears and Jaga Jazzist have only one song in total, but a random starting bias puts them in a random place in the playlist.  We also shuffle the songs of one performer relative to each other (here the old Fisher-Yates algorithm also comes together, although we can recursively apply our new algorithm if we, for example, want to distribute songs from different albums as evenly as we distribute songs of different artists). <br><br><h2>  Conclusion </h2><br>  Now the algorithm is already used by our players on all platforms.  Thanks to all users who are well described their problems concerning the randomness of playlists. <br><br><h2>  What else can you read on this topic </h2><br><ol><li>  <a href="http://www.empiricalzeal.com/2012/12/21/what-does-randomness-look-like/">What does randomness look like?</a> </li><li>  <a href="http://en.wikipedia.org/wiki/Clustering_illusion">Clustering illusion on Wikipedia</a> </li><li>  <a href="http://www.radiolab.org/2009/jun/15/a-very-lucky-wind/">A very lucky wind</a> </li><li>  <a href="http://en.wikipedia.org/wiki/Dither">Dither on wikipedia</a> </li><li>  <a href="http://www.scientificamerican.com/article/how-randomness-rules-our-world/">How We Cannot See It</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/343482/">https://habr.com/ru/post/343482/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343470/index.html">Hack bikes with Quora</a></li>
<li><a href="../343474/index.html">PhpStorm 2017.3 Available</a></li>
<li><a href="../343476/index.html">Xamarin, native iOS / Android and hybrid development tools</a></li>
<li><a href="../343478/index.html">‚ÄúONLYOFFICE Documents‚Äù for iOS: how the application has changed over the year</a></li>
<li><a href="../343480/index.html">NFC in the world of sports - 5 examples</a></li>
<li><a href="../343484/index.html">Performance as Perception: Time Perception</a></li>
<li><a href="../343486/index.html">Impressions of developers and designers from the iPhone X - and from the cutout</a></li>
<li><a href="../343488/index.html">PostgreSQL Indexes - 8</a></li>
<li><a href="../343490/index.html">Opensource helps us to build and live: an interview with Yii Framework developer Alexander Makarov</a></li>
<li><a href="../343492/index.html">How is the Hamster Marketplace token different from other project tokens?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>