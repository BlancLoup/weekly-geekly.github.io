<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mutation Testing: Testing Tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Writing tests should instill in us confidence in the correct operation of the code. Often we operate with a degree of code coverage, and when we reach...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mutation Testing: Testing Tests</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/wp/2n/bi/wp2nbixsaf3isigus8ufndpvgdc.jpeg"></div><br>  Writing tests should instill in us confidence in the correct operation of the code.  Often we operate with a degree of code coverage, and when we reach 100%, we can say that the solution is correct.  Are you sure about this?  Perhaps there is a tool that will give more accurate feedback? <br><a name="habracut"></a><br><h2>  Mutation Testing </h2><br>  This term describes a situation where we modify small pieces of code and see how it affects tests.  If, after the changes, tests are performed correctly, it means that there are not enough tests for these code fragments.  Of course, everything depends on what exactly we are changing, because we do not need to test all the smallest changes, for example, indents or variable names, because after them the tests must also complete correctly.  Therefore, in mutational tests we use the so-called mutators (modifier methods), which replace some code fragments with others, but in a way that makes sense.  We will talk about this in more detail below.  Sometimes we carry out such tests ourselves, checking if the tests break down if we change something in the code.  If we refactor the ‚Äúhalf of the system‚Äù and the tests are still green, then we can immediately say that they are bad.  And if someone did this and the tests turned out to be good, then my congratulations! <br><br><h2>  Infectious Framework </h2><br>  In PHP today, the most popular mutation testing framework is <a href="https://github.com/infection/infection">Infection</a> .  It supports PHPUnit and PHPSpec, and requires PHP 7.1+ and Xdebug or phpdbg to work with it. <br><br><h3>  First run and configure </h3><br>  When you first start, we see an interactive framework configurator, which creates a special file with settings - infection.json.dist.  It looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="php hljs">{ <span class="hljs-string"><span class="hljs-string">"timeout"</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">"source"</span></span>: { <span class="hljs-string"><span class="hljs-string">"directories"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"src"</span></span> }, <span class="hljs-string"><span class="hljs-string">"logs"</span></span>: { <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"infection.log"</span></span>, <span class="hljs-string"><span class="hljs-string">"perMutator"</span></span>: <span class="hljs-string"><span class="hljs-string">"per-mutator.md"</span></span> }, <span class="hljs-string"><span class="hljs-string">"mutators"</span></span>: { <span class="hljs-string"><span class="hljs-string">"@default"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> }</code> </pre> <br>  <code>Timeout</code> - option, the value of which should be equal to the maximum duration of the execution of one test.  In <code>source</code> we specify the directories from which we will mutate the code, we can set exceptions.  In <code>logs</code> there is a <code>text</code> option, which we set to collect statistics for only erroneous tests, which is the most interesting for us.  The <code>perMutator</code> option allows you to save used mutators.  Read more about this in the documentation. <br><br><h3>  Example </h3><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Calculator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a + $b; } }</code> </pre> <br>  Suppose we have the above class.  Let's write a test in PHPUnit: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CalculatorTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> Calculator */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $calculator; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calculator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Calculator(); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@dataProvider</span></span></span><span class="hljs-comment"> additionProvider */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testAdd</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b, int $expected)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($expected, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calculator-&gt;add($a, $b)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">additionProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>], [<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>], [<span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>], [<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>] ]; } }</code> </pre> <br>  Of course, this test needs to be written before we implement the <code>add()</code> method.  When executing <code>./vendor/bin/phpunit</code> we get: <br><br><pre> <code class="php hljs">PHPUnit <span class="hljs-number"><span class="hljs-number">8.2</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> by Sebastian Bergmann <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> contributors. .... <span class="hljs-number"><span class="hljs-number">4</span></span> / <span class="hljs-number"><span class="hljs-number">4</span></span> (<span class="hljs-number"><span class="hljs-number">100</span></span>%) Time: <span class="hljs-number"><span class="hljs-number">39</span></span> ms, Memory: <span class="hljs-number"><span class="hljs-number">4.00</span></span> MB OK (<span class="hljs-number"><span class="hljs-number">4</span></span> tests, <span class="hljs-number"><span class="hljs-number">4</span></span> assertions)</code> </pre> <br>  Now run <code>./vendor/bin/infection</code> : <br><br><pre> <code class="php hljs">You are running Infection with Xdebug enabled. ____ ____ __ _ / _/___ / __/__ _____/ /_(_)___ ____ / <span class="hljs-comment"><span class="hljs-comment">// __ \/ /_/ _ \/ ___/ __/ / __ \/ __ \ _/ // / / / __/ __/ /__/ /_/ / /_/ / / / / /___/_/ /_/_/ \___/\___/\__/_/\____/_/ /_/ Running initial test suite... PHPUnit version: 8.2.2 9 [============================] 1 sec Generate mutants... Processing source code files: 1/1Creating mutated files and processes: 0/2 Creating mutated files and processes: 2/2 .: killed, M: escaped, S: uncovered, E: fatal error, T: timed out .. (2 / 2) 2 mutations were generated: 2 mutants were killed 0 mutants were not covered by tests 0 covered mutants were not detected 0 errors were encountered 0 time outs were encountered Metrics: Mutation Score Indicator (MSI): 100% Mutation Code Coverage: 100% Covered Code MSI: 100% Please note that some mutants will inevitably be harmless (ie false positives). Time: 1s. Memory: 10.00MB</span></span></code> </pre> <br>  According to Infection, our tests are accurate.  In the <i>per-mutator.md</i> file <i>,</i> we can see which mutations were used: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># Effects per Mutator | Mutator | Mutations | Killed | Escaped | Errors | Timed Out | MSI | Covered MSI | | ------- | --------- | ------ | ------- |------- | --------- | --- | ----------- | | Plus | 1 | 1 | 0 | 0 | 0 | 100| 100| | PublicVisibility | 1 | 1 | 0 | 0 | 0 | 100| 100|</span></span></code> </pre> <br>  Mutator Plus - a simple sign change from plus to minus, which should break the tests.  And the <code>PublicVisibility</code> mutator changes the access modifier of this method, which should also break tests, and in this case it works. <br><br>  Now add a more complicated method. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int[] $numbers */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findGreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $numbers, int $threshold)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \array_values(\array_filter($numbers, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $number)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($threshold)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number &gt; $threshold; })); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@dataProvider</span></span></span><span class="hljs-comment"> findGreaterThanProvider */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testFindGreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $numbers, int $threshold, array $expected)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($expected, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;calculator-&gt;findGreaterThan($numbers, $threshold)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findGreaterThanProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">-1</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]], [[<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-4</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, []] ]; }</code> </pre> <br>  After execution, we will see the following result: <br><br><pre> <code class="php hljs">You are running Infection with Xdebug enabled. ____ ____ __ _ / _/___ / __/__ _____/ /_(_)___ ____ / <span class="hljs-comment"><span class="hljs-comment">// __ \/ /_/ _ \/ ___/ __/ / __ \/ __ \ _/ // / / / __/ __/ /__/ /_/ / /_/ / / / / /___/_/ /_/_/ \___/\___/\__/_/\____/_/ /_/ Running initial test suite... PHPUnit version: 8.2.2 11 [============================] &lt; 1 sec Generate mutants... Processing source code files: 1/1Creating mutated files and processes: 0/7 Creating mutated files and processes: 7/7 .: killed, M: escaped, S: uncovered, E: fatal error, T: timed out ..M..M. (7 / 7) 7 mutations were generated: 5 mutants were killed 0 mutants were not covered by tests 2 covered mutants were not detected 0 errors were encountered 0 time outs were encountered Metrics: Mutation Score Indicator (MSI): 71% Mutation Code Coverage: 100% Covered Code MSI: 71% Please note that some mutants will inevitably be harmless (ie false positives). Time: 1s. Memory: 10.00MB</span></span></code> </pre> <br>  Our tests are not all right.  First check the infection.log file: <br><br><pre> <code class="php hljs">Escaped mutants: ================ <span class="hljs-number"><span class="hljs-number">1</span></span>) /home/sarven/projects/infection-playground/infection-playground/src/Calculator.php:<span class="hljs-number"><span class="hljs-number">19</span></span> [M] UnwrapArrayValues --- Original +++ <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> @@ @@ */ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findGreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $numbers, int $threshold)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \array_values(\array_filter($numbers, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $number)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($threshold)</span></span></span><span class="hljs-function"> </span></span>{ + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \array_filter($numbers, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $number)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($threshold)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number &gt; $threshold; - })); + }); } <span class="hljs-number"><span class="hljs-number">2</span></span>) /home/sarven/projects/infection-playground/infection-playground/src/Calculator.php:<span class="hljs-number"><span class="hljs-number">20</span></span> [M] GreaterThan --- Original +++ <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> @@ @@ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findGreaterThan</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $numbers, int $threshold)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> \array_values(\array_filter($numbers, <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $number)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($threshold)</span></span></span><span class="hljs-function"> </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number &gt; $threshold; + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number &gt;= $threshold; })); } Timed Out mutants: ================== Not Covered mutants: ====================</code> </pre> <br>  The first <code>array_values</code> problem is the use of the <code>array_values</code> function.  It is used to reset keys, because <code>array_filter</code> returns values ‚Äã‚Äãwith keys from the previous array.  In addition, in our tests there is no case when you need to use <code>array_values</code> , since otherwise an array is returned with the same values ‚Äã‚Äãbut different keys. <br><br>  The second problem is related to borderline cases.  In comparison, we used the <code>&gt;</code> sign, but we do not test any borderline cases, so replacing with <code>&gt;=</code> does not break tests.  You need to add only one test: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findGreaterThanProvider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">array</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ [[<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">-1</span></span>, [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>]], [[<span class="hljs-number"><span class="hljs-number">-2</span></span>, <span class="hljs-number"><span class="hljs-number">-3</span></span>, <span class="hljs-number"><span class="hljs-number">-4</span></span>], <span class="hljs-number"><span class="hljs-number">0</span></span>, []], [[<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span>, [<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">6</span></span>]] ]; }</code> </pre> <br>  And now Infection is pleased with everything: <br><br><pre> <code class="php hljs">You are running Infection with Xdebug enabled. ____ ____ __ _ / _/___ / __/__ _____/ /_(_)___ ____ / <span class="hljs-comment"><span class="hljs-comment">// __ \/ /_/ _ \/ ___/ __/ / __ \/ __ \ _/ // / / / __/ __/ /__/ /_/ / /_/ / / / / /___/_/ /_/_/ \___/\___/\__/_/\____/_/ /_/ Running initial test suite... PHPUnit version: 8.2.2 12 [============================] &lt; 1 sec Generate mutants... Processing source code files: 1/1Creating mutated files and processes: 0/7 Creating mutated files and processes: 7/7 .: killed, M: escaped, S: uncovered, E: fatal error, T: timed out ....... (7 / 7) 7 mutations were generated: 7 mutants were killed 0 mutants were not covered by tests 0 covered mutants were not detected 0 errors were encountered 0 time outs were encountered Metrics: Mutation Score Indicator (MSI): 100% Mutation Code Coverage: 100% Covered Code MSI: 100% Please note that some mutants will inevitably be harmless (ie false positives). Time: 1s. Memory: 10.00MB</span></span></code> </pre> <br>  Add the <code>subtract</code> method to the <code>Calculator</code> class, but without a separate test in PHPUnit: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subtract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a - $b; }</code> </pre> <br>  And after doing Infection we see: <br><br><pre> <code class="php hljs">You are running Infection with Xdebug enabled. ____ ____ __ _ / _/___ / __/__ _____/ /_(_)___ ____ / <span class="hljs-comment"><span class="hljs-comment">// __ \/ /_/ _ \/ ___/ __/ / __ \/ __ \ _/ // / / / __/ __/ /__/ /_/ / /_/ / / / / /___/_/ /_/_/ \___/\___/\__/_/\____/_/ /_/ Running initial test suite... PHPUnit version: 8.2.2 11 [============================] &lt; 1 sec Generate mutants... Processing source code files: 1/1Creating mutated files and processes: 0/9 Creating mutated files and processes: 9/9 .: killed, M: escaped, S: uncovered, E: fatal error, T: timed out .......SS (9 / 9) 9 mutations were generated: 7 mutants were killed 2 mutants were not covered by tests 0 covered mutants were not detected 0 errors were encountered 0 time outs were encountered Metrics: Mutation Score Indicator (MSI): 77% Mutation Code Coverage: 77% Covered Code MSI: 100% Please note that some mutants will inevitably be harmless (ie false positives). Time: 1s. Memory: 10.00MB</span></span></code> </pre> <br>  This time the instrument returned two uncovered mutations. <br><br><pre> <code class="php hljs">Escaped mutants: ================ Timed Out mutants: ================== Not Covered mutants: ==================== <span class="hljs-number"><span class="hljs-number">1</span></span>) /home/sarven/projects/infection-playground/infection-playground/src/Calculator.php:<span class="hljs-number"><span class="hljs-number">24</span></span> [M] PublicVisibility --- Original +++ <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> @@ @@ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $number &gt; $threshold; })); } - <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subtract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> + </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subtract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a - $b; } <span class="hljs-number"><span class="hljs-number">2</span></span>) /home/sarven/projects/infection-playground/infection-playground/src/Calculator.php:<span class="hljs-number"><span class="hljs-number">26</span></span> [M] Minus --- Original +++ <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> @@ @@ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">subtract</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a, int $b)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a - $b; + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a + $b; }</code> </pre><br><h3>  Metrics </h3><br>  After each execution, the tool returns three metrics: <br><br><pre> <code class="php hljs">Metrics: Mutation Score Indicator (MSI): <span class="hljs-number"><span class="hljs-number">47</span></span>% Mutation Code Coverage: <span class="hljs-number"><span class="hljs-number">67</span></span>% Covered Code MSI: <span class="hljs-number"><span class="hljs-number">70</span></span>%</code> </pre><br>  <code>Mutation Score Indicator</code> - the proportion of mutations detected by the tests. <br><br>  The metric is calculated as follows: <br><br><pre> <code class="php hljs">TotalDefeatedMutants = KilledCount + TimedOutCount + ErrorCount; MSI = (TotalDefeatedMutants / TotalMutantsCount) * <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br>  <code>Mutation Code Coverage</code> - the proportion of code covered by mutations. <br><br>  The metric is calculated as follows: <br><br><pre> <code class="php hljs">TotalCoveredByTestsMutants = TotalMutantsCount - NotCoveredByTestsCount; CoveredRate = (TotalCoveredByTestsMutants / TotalMutantsCount) * <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br>  <code>Covered Code Mutation Score Indicator</code> - determines the effectiveness of tests only for code that is covered by tests. <br><br>  The metric is calculated as follows: <br><br><pre> <code class="php hljs">TotalCoveredByTestsMutants = TotalMutantsCount - NotCoveredByTestsCount; TotalDefeatedMutants = KilledCount + TimedOutCount + ErrorCount; CoveredCodeMSI = (TotalDefeatedMutants / TotalCoveredByTestsMutants) * <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br><h3>  Use in more complex projects </h3><br>  In the example above, there is only one class, so we performed Infection without parameters.  But in everyday work on ordinary projects, it will be useful to use the <code>‚Äìfilter</code> parameter, which allows you to specify a set of files to which we want to apply mutations. <br><br><pre> <code class="php hljs">./vendor/bin/infection --filter=Calculator.php</code> </pre><br><h3>  False Positive Responses </h3><br>  Some mutations do not affect the operation of the code, and Infection returns MSI below 100%.  But we cannot always do something about it, so we have to put up with such situations.  Something similar is shown in this example: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a / <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRatio(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatio</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; }</code> </pre> <br>  Of course, here the <code>getRatio</code> method <code>getRatio</code> not make sense, in a normal project there probably would have been some sort of calculation instead.  But the result could be <code>1</code> .  Infection returns: <br><br><pre> <code class="php hljs">Escaped mutants: ================ <span class="hljs-number"><span class="hljs-number">1</span></span>) /home/sarven/projects/infection-playground/infection-playground/src/Calculator.php:<span class="hljs-number"><span class="hljs-number">26</span></span> [M] Division --- Original +++ <span class="hljs-keyword"><span class="hljs-keyword">New</span></span> @@ @@ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">calcNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(int $a)</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span><span class="hljs-function"> </span></span>{ - <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a / <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRatio(); + <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a * <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRatio(); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRatio</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">int</span></span></span></span></code> </pre> <br>  As we know, multiplying and dividing by 1 returns the same result, equal to the original number.  So this mutation should not break down the tests, and despite Infection‚Äôs dissatisfaction with the accuracy of our tests, everything is fine. <br><br><h3>  Optimization for large projects </h3><br>  In cases with large projects, the implementation of Infection can take a very long time.  You can optimize execution during CI, if you only process modified files. For more information, see the documentation: <a href="https://infection.github.io/guide/how-to.html">https://infection.github.io/guide/how-to.html</a> <br><br>  In addition, you can run tests in parallel on the modified code.  However, this is only possible if all tests are independent.  Namely, these should be good tests.  To enable this option, use the <code>‚Äìthreads</code> parameter: <br><br><pre> <code class="php hljs">./vendor/bin/infection --threads=<span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre> <br><h2>  How it works? </h2><br>  The Infection framework uses AST (an abstract syntax tree), which represents code in the form of an abstract data structure.  To do this, use a parser written by one of the creators of PHP ( <a href="https://github.com/nikic/PHP-Parser">php-parser</a> ). <br><br>  Simplified operation of the tool can be represented as follows: <br><br><ol><li>  Generate AST based on code. <br></li><li>  The use of suitable mutations (the full list is <a href="https://infection.github.io/guide/mutators.html">here</a> ). <br></li><li>  Creating an AST based on the modified code. <br></li><li>  Run tests in relation to the modified code. <br></li></ol><br>  For example, you can check the substitution minus-plus mutator: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span>(strict_types=<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Infection</span></span>\<span class="hljs-title"><span class="hljs-title">Mutator</span></span>\<span class="hljs-title"><span class="hljs-title">Arithmetic</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Infection</span></span>\<span class="hljs-title"><span class="hljs-title">Mutator</span></span>\<span class="hljs-title"><span class="hljs-title">Util</span></span>\<span class="hljs-title"><span class="hljs-title">Mutator</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PhpParser</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">PhpParser</span></span>\<span class="hljs-title"><span class="hljs-title">Node</span></span>\<span class="hljs-title"><span class="hljs-title">Expr</span></span>\<span class="hljs-title"><span class="hljs-title">Array_</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@internal</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Plus</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Mutator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Replaces "+" with "-" * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> Node&amp;Node\Expr\BinaryOp\Plus $node * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Node\Expr\BinaryOp\Minus */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node $node)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Node\Expr\BinaryOp\Minus($node-&gt;left, $node-&gt;right, $node-&gt;getAttributes()); } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mutatesNode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Node $node)</span></span></span><span class="hljs-function">: </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bool</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!($node <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Node\Expr\BinaryOp\Plus)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($node-&gt;left <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Array_ || $node-&gt;right <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Array_) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> <br>  The <code>mutate()</code> method creates a new element that is replaced by a plus.  The <code>Node</code> class is taken from the php-parser package, it is used for operations with AST and modification of PHP code.  However, this change cannot be applied anywhere, so the <code>mutatesNode()</code> method contains additional conditions.  If to the left of the plus or to the right of the minus is an array, then the change is invalid.  This condition is used because of this code: <br><br><pre> <code class="php hljs">$tab = [<span class="hljs-number"><span class="hljs-number">0</span></span>] + [<span class="hljs-number"><span class="hljs-number">1</span></span>]; is correct, but the following one isn<span class="hljs-string"><span class="hljs-string">'t correct. $tab = [0] - [1];</span></span></code> </pre> <br><h2>  Total </h2><br>  Mutation testing is a great tool that complements the CI process and allows you to evaluate the quality of tests.  Green highlighting of tests does not give us confidence that everything is written well.  You can improve the accuracy of tests using mutation testing - or testing tests - which increases our confidence in the performance of the solution.  Of course, it is not necessary to strive for 100% metrics, because it is not always possible.  It is necessary to analyze the logs and adjust tests accordingly. </div><p>Source: <a href="https://habr.com/ru/post/457888/">https://habr.com/ru/post/457888/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../457872/index.html">How to manage time and stop procrastinating?</a></li>
<li><a href="../457874/index.html">Why are employees coming back? Stories left and returned</a></li>
<li><a href="../457876/index.html">Translation: IEEE 802.15.4z Standard. What awaits us in the future?</a></li>
<li><a href="../457884/index.html">Sovereign Online - Clarifying Orders</a></li>
<li><a href="../457886/index.html">Two-factor authentication on the site using a USB token. Now for Linux</a></li>
<li><a href="../457892/index.html">Professor who beat roulette</a></li>
<li><a href="../457894/index.html">Work with Proxmox Cluster: Installation, Network Configuration, ZFS, Common Problem Solving</a></li>
<li><a href="../457896/index.html">Zimbra and server overload protection</a></li>
<li><a href="../4579/index.html">Digital TV: investments set the stage for growth</a></li>
<li><a href="../45790/index.html">Create your own magnetic prototype</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>