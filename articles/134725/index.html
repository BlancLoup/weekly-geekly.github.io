<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We connect Rutoken EDS to OpenSSL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPDATE. Ready solution for electronic signature in the browser - Ruken Plugin 

 As you know, OpenSSL version 1.0.0 and later supports the Russian GOS...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We connect Rutoken EDS to OpenSSL</h1><div class="post__text post__text-html js-mediator-article">  UPDATE.  Ready solution for electronic signature in the browser - <a href="http://www.rutoken.ru/products/all/rutoken-plugin/">Ruken Plugin</a> <br><br>  As you know, OpenSSL version 1.0.0 and later supports the Russian GOST cryptographic algorithms, and the support for these algorithms is fully functional: the signature and encryption in the PKCS # 7, CMS, S / MIME formats are implemented in accordance with Russian standards and RFC;  TLS protocol with support for Russian ciphers, etc. <br><br>  Thus, OpenSSL is fully compatible with proprietary means of cryptographic protection of Russian manufacturers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To support GOSTs, a special ‚Äúplugin‚Äù has been added to it - engine gost.  However, there are cryptographic USB tokens with hardware implementation of Russian cryptoalgorithms on the ‚Äúboard‚Äù.  An example of such a token is Rutoken EDS, which, by the way, is certified as SKZI in class KS2.  Rutoken EDS can be connected to OpenSSL in such a way that cryptographic operations will be performed on the ‚Äúboard‚Äù of the token. <br><br>  For Rutoken EDS, there is a special cross-platform plug-in for OpenSSL - engine pkcs11_gost, which allows the use of hardware release of GOSTs through the standard OpenSSL interface. <br><br><a name="habracut"></a>  Here I will describe how it is done on win32. <br><br>  1. OpenSSL can be taken from here <a href="http://www.slproweb.com/products/Win32OpenSSL.html">www.slproweb.com/products/Win32OpenSSL.html</a> .  When installing, select the ‚ÄúThe OpenSSL‚Äù binaries (/ bin) directory in the ‚ÄúSelect Additional Tasks‚Äù dialog. <br><br>  2. The plugin and the libraries it needs can be downloaded at <a href="">www.rutoken.ru/download/software/forum/pkcs11-gost-win32-4.2.0.zip</a> . <br><br>  3. The contents of the archive should be copied to the installation folder OpenSSL / bin.  At the same time openssl config.  cfg should be replaced, since the archive contains a config sharpened to use the engine pkcs11_gost. <br><br>  4. Then run cmd.exe (well, or someone like that) and specify in the environment variables our config SET OPENSSL_CONF = full path to the openssl.cfg configuration file. <br><br>  5. Now you need to install the Rutoken driver, connect the Rutoken EDS to the computer and format it through the Control Panel-&gt; Rutoken Control Panel. <habracut><br><br>  Using the openssl.exe utility, we will follow the path that will allow us to sign the file.  At the same time, cryptographic operations (here the key generation and electronic signature are used) will be carried out ‚Äúon board‚Äù Rutoken EDS. <br><br>  1. Generate the signature key GOST R 34.10-2001: <br><br> <code>openssl genpkey -engine pkcs11_gost -algorithm GOST2001 -pkeyopt slot_key_id:50 -pkeyopt paramset:A -pkeyopt pin:12345678</code> <br> <br>  2. Create an application for a certificate in the PKCS # 10 format for the generated key: <br><br> <code>openssl req -engine pkcs11_gost -new -key 50 -keyform engine -out req.csr</code> <br> <br>  3. Create a self-signed root certificate in order to issue a user certificate for the application.  To begin, generate the CA key inside the token: <br><br> <code>openssl genpkey -engine pkcs11_gost -algorithm GOST2001 -pkeyopt slot_key_id:100 -pkeyopt paramset:A -pkeyopt pin:12345678</code> <br> <br>  Then we will issue ourselves the root certificate for this key: <br><br> <code>openssl req -engine pkcs11_gost -x509 -new -key 100 -keyform engine -out ca.crt</code> <br> <br>  4. Issue the certificate according to the application received in step 2. To do this, in the OpenSSL / bin installation folder, create a demoCA folder, in which we will create the newcerts folder.  In the demoCA folder, we will create an empty index.txt file and a serial file in which we will write 01. This will allow us to keep records of the issued certificates.  Certificate issuing team: <br><br> <code>openssl ca -engine pkcs11_gost -keyfile 100 -keyform engine -cert ca.crt -in req.csr -out tester.crt</code> <br> <br>  5. Let's sign an arbitrary file with an ‚Äúattached‚Äù signature in the S / MIME format: <br><br> <code>openssl smime -engine pkcs11_gost -sign -in [ ] -out [ ] -nodetach -binary -signer tester.crt -inkey 50 -keyform engine</code> <br> <br>  in PKCS format # 7: <br><br> <code>openssl smime -engine pkcs11_gost -sign -in [ ] -out [ ] -nodetach -binary -signer tester.crt -inkey 50 -keyform engine -outform PEM</code> <br> <br>  in CMS format: <br><br> <code>openssl cms -engine pkcs11_gost -sign -in [ ] -out [ ] -nodetach -binary -signer tester.crt -inkey 50 -keyform engine -outform PEM</code> <br> <br>  A more detailed description of the use of OpenSSL with Rutoken EDS can be found on page <a href="http://forum.rutoken.ru/topic/1639/">forum.rutoken.ru/topic/1639</a> . </habracut></div><p>Source: <a href="https://habr.com/ru/post/134725/">https://habr.com/ru/post/134725/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134717/index.html">Testing the speed of encryption algorithms in PHP</a></li>
<li><a href="../134719/index.html">Evaluation of labor costs of a software development project: practice in the Ukrainian reality</a></li>
<li><a href="../134720/index.html">Rating based on history</a></li>
<li><a href="../134721/index.html">Asus Transformer Prime video review</a></li>
<li><a href="../134722/index.html">pyxs - library for xenstore on python</a></li>
<li><a href="../134726/index.html">ASUS N55Sf Review with Matte Display and External Subwoofer</a></li>
<li><a href="../134727/index.html">Canobuvosti, 122nd edition</a></li>
<li><a href="../134728/index.html">Technology "reball" at home</a></li>
<li><a href="../134729/index.html">Plesk for Russia? Working together</a></li>
<li><a href="../134730/index.html">Sale NOOK Simple Touch ‚Ñ¢ 16.12 and 17.12</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>