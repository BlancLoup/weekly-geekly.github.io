<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How botnets are closed</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, much has been said about botnets in runet. This is mainly due to DDoS attacks on known and visited resources. Below we will discuss the expe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How botnets are closed</h1><div class="post__text post__text-html js-mediator-article">  Recently, much has been said about botnets in runet.  This is mainly due to DDoS attacks on known and visited resources.  Below we will discuss the experience of large companies in the field of combating this scourge. <br><img src="https://habrastorage.org/storage1/f324a67a/4cfb2338/2108d313/17faf0bb.jpg"><br><a name="habracut"></a><br><br><h3>  What is a botnet? </h3><br>  A botnet is a collection of systems infected with malicious code and managed centrally.  Moreover, it is arranged in such a way that the destruction or shutdown of a sufficiently large number of nodes should not affect its performance in general.  Botnets can be used for such purposes as spamming, phishing, DDoS, attacks on other systems, infecting new PCs and turning them into botnet nodes.  It is worth noting that at the moment the cybercrime industry is quite segmented by specialization and focus of crimes.  That means everyone does their own thing.  As a result, the botnet creator sells botnet resources or services to other attackers specializing in various types of crimes (you can look at the illustrations for a typical business structure).  It is worth noting that the management interface of the botnet is quite simple.  A person with even very low qualifications can cope with it.  In accordance with cloud trends, Malware as a Service has recently appeared.  If someone cannot create and distribute their malicious code, there will always be a provider who can do it for a certain amount of money.  However, to create a botnet today is also not God knows what a difficult task.  There are many ready-made botnet kits on the market, such as Zbot (Zeus), Spyeye, Mariposa, Black Energy, ButterFly, Reptile.  This means that modern bot owners may not even have any special technological skills.  However, if we talk about large botnets, then their creators are, of course, capable, talented people, to fight with which it is quite difficult.  As part of this material, I would like to talk about the practices that are used by large companies to combat cybercrime and, in particular, botnets.  This, in particular, will focus on the activity of Microsoft, in which I work. <br><img src="https://habrastorage.org/storage1/769f4b65/9b4646a1/8d959d2c/717d8d13.jpg"><br><h4>  Standard botnet management approach </h4><br><br><h3>  Microsoft vs.  Botnet </h3><br>  Perhaps this will make someone smile, but Microsoft has been working hard over the past few years to improve the security of products and services.  Methodologies for developing a secure SDL code have emerged and began to be applied, which has a key impact on the number of recent vulnerabilities (especially those that can be exploited).  But today it‚Äôs not about preventive measures that can prevent future threats, but about dealing with problems that are relevant today.  A large number of infected machines running under the Windows operating system - just such a problem. <br>  Inside the company was created a number of divisions to combat cybercrime.  The latter have different names - Digital Crime Unit, Microsoft Security Response Center, Trust worth Computing, - but each one‚Äôs tasks somehow overlap with the problem of cybercrime.  Together with law enforcement agencies and research organizations, Microsoft began operations to destroy the largest botnets.  Sounds loud?  Perhaps, but during the year botnets were destroyed such as: <br><ul><li>  Rustock, which sent 80% of world spam. </li><li>  Coreflood, which served as a tool for crimes that brought more than $ 100 million in damages. </li><li>  Waledac, whose bots sent 1.5 billion spam messages daily. </li></ul><br><h3>  Fighting botnets: common practices </h3><br>  In order to understand the typical methods of destroying a botnet, it is necessary to understand its architecture and weak points.  Most often, one or several command (often central) servers, called Command &amp; Control, or C &amp; C, are used to control the botnet.  They interact with the botnet end nodes using different protocols.  Most often IRC is used as a control protocol.  However, the use of P2P protocols as a more sustainable, albeit technologically complex alternative has recently increased dramatically.  Recently, the use of file-sharing networks for managing a botnet and the transfer of control commands in the body of photos published on Facebook has become an interesting exotic.  Anyway, several specific actions can be taken to combat a botnet: <br><ul><li>  Capture or disable C &amp; C nodes. </li><li>  DDoS on C &amp; C nodes. </li><li>  Complaints to a provider where C &amp; C nodes are hosted. </li><li>  Capture DNS names used by C &amp; C. </li><li>  Block IP addresses. </li><li>  Arrest botnet owner. </li><li>  Legal action </li></ul>  Unfortunately, not all of these methods are effective, and some are completely illegal.  Meanwhile, some of them we successfully managed to apply.  So, the Rustock and Coreflood botnets were destroyed rather trivially.  This was accomplished by law enforcement agencies taking over the C &amp; C servers (according to a preliminary court decision), after which the malware command, which was provided by the botnet developer, was transferred to all the infected machines included in the botnet.  The work of closing another botnet, Waledac, turned out to be even more interesting, and I would like to dwell on this point. <br><img src="https://habrastorage.org/storage1/61f8b27b/00cbe58e/4a4b560b/2f885cb2.jpg"><br><h4>  Waledac multi-layer management architecture </h4>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Waledac: device </h3><br>  The challenge of dealing with Waledac was the botnet‚Äôs decentralized pattern of operation.  For his work, as many as 277 domain names have been reserved.  This means that it was necessary to capture servers at the same time in several data centers, from different hosting providers.  In addition, the P2P mechanism was successfully used to control the botnet.  If you look at the botnet scheme, the layering of the control servers immediately catches the eye.  In the process of infecting the system with Waledac, the malicious code determines what role the new node will play.  It becomes either a simple spamming node, if it is behind NAT and does not accept incoming connections on port 80, or a node that repeats (retransmits) commands from the center, that is, a kind of repeater.  Repeaters are used to manage the botnet.  In addition to sending control commands to spammers, each repeater also supports a list of ‚Äúneighbors‚Äù consisting of 100 nodes that also act as a repeater, to which it can connect using the P2P protocol.  Over time, any repeater will register its domain name with fast flux DNS.  This is done in order to allow spammers nodes to contact themselves if the closest to them repeater suddenly fails and becomes unavailable.  Thus, botnet nodes can always find the nearest relay node and receive commands and executable code updates from it.  The botnet is designed so that over time the role of the nodes may change.  If a system used as a repeater, for example, enters the corporate network and loses the ability to accept connections to port 80, it automatically receives the role of spammer.  At the same time, it is not so easy to analyze the topology of a botnet, because another task of the repeater is to counteract the research of the botnet topology.  It serves as a kind of proxy and does not allow spammer nodes to know anything about C &amp; C control nodes. <br><img src="https://habrastorage.org/storage1/c70ea519/966b2da6/6ceff45d/f448743d.jpg"><br><h4>  Each repeater maintains a neighbor list. </h4><br><br><h3>  Waledac: destruction </h3><br>  After analyzing the botnet architecture, we worked out a plan for attacking a botnet with the following specific steps: <br><ol><li>  Violation of peer-to-peer control exchange mechanisms. </li><li>  Violation of the exchange of DNS / HTTP-commands. </li><li>  Violation of the two upper layers of C &amp; C-servers. </li></ol>  The first thing was to interrupt the operation of the P2P mechanism.  Due to the fact that the function of finding the nearest repeater inside the botnet was unstable, it was possible that the node had to search through up to 20 addresses on its list of "neighbors" to find a working neighboring repeater.  Thanks to this, we were able to create fake repeaters, include them in the botnet and start distributing fake updates to the list of repeaters, thereby breaking the connectivity of the P2P control system.  This allowed sending commands to spammer nodes from specially created Microsoft command servers. <br>  If the P2P mechanism fails, the botnet nodes start searching for each other using the fast flux DNS mechanism.  Therefore, it was necessary to destroy this method of control so that the attacker could not regain control of the botnet.  This is an interesting point, because here we used a legal mechanism.  A typical procedure for revoking a DNS name through ICANN using a procedure with the scary name ‚ÄúUniform Domain-Name Dispute-Resolution Policy‚Äù can take quite a long time.  This would allow attackers to have time to realize that they are attacking and take steps to register new DNS names, to which control of the botnet will later be transferred.  Therefore, instead of the standard ICANN procedure, we used the ‚ÄúTRO (temporary restraining order)‚Äù procedure - the ability to temporarily suspend domains for 28 days by decision of the US federal court.  At this stage, another complication was that part of the DNS names were registered in China. <br>  In order for attackers to compete with Microsoft in court, if they have a desire to declare their rights to the botnet, a statement of claim was published on the site.  Also in national newspapers on the territory of the countries from which the suspects controlled the botnet, notices of summons were published.  As expected, no one dared to appear in court and declare their rights to the botnet.  Thus, Microsoft won the trial in the United States and China.  More information about the legal intricacies and peripetia of the struggle for a botnet can be found <a href="http://bit.ly/rlDUDA">in a special section of the Microsoft site</a> . <br>  As a result of these legal actions, DNS rights were transferred to Microsoft.  Currently, DNS names are connected to Microsoft servers.  If an infected node is connected to these servers from a botnet, a command is issued to it, ordering the removal of the malicious code of the Waledac bot. <br><img src="https://habrastorage.org/storage1/af332f40/0750d332/876d6b82/b342e5fd.jpg"><br><h4>  Domain Name Registration </h4><br><img src="https://habrastorage.org/storage1/6a9ceea1/c4569883/474e8ad8/92c63333.jpg"><br><h4>  Connecting Microsoft servers to Waledac </h4><br><h3>  Conclusion </h3><br>  In this way, we hope to gradually clean the Internet from the last remnants of the Waldac botnet.  To prevent intruders from creating botnets in the future, Microsoft continues to investigate and collect evidence.  To this end, we offered a reward of $ 250,000 to those who would provide information that would contribute to the arrest of the criminal group behind <a href="http://bit.ly/oR7x88">Rustock</a> .  In our experience, such an approach might work.  In conclusion, I would like to say that Microsoft intends to actively fight cybercrime in the future, pursuing the intruders with all means available to it. <br><br><hr><h4>  Not like everyone else </h4>  It is rash to assume that botnets consist only of Windows machines.  There are botnets on Linux / Unix - Psyb0t, Chuck Norris, with hundreds of thousands of devices.  Basically, these botnets are created from home routers, switches and low-end NAS.  Destroying such a botnet is extremely difficult, as the home user in most cases does not have Linux knowledge and skills to update the device firmware.  The device manufacturer is interested in the rapid obsolescence of the device and often not only does not intend to eliminate the shortcomings, but also has no mechanisms for centralized updating of its products.  According to a study from 2009, on the Internet at any time you can find several million home devices with outdated firmware and default passwords. <hr><br><img src="https://habrastorage.org/getpro/habr/post_images/326/f6d/f22/326f6df2229852382b11e55edddf9acc.jpg" alt="image"><br>  <i>Journal Hacker, <a href="http://www.xakep.ru/articles/magazine/default.asp">October (10) 153</a></i> <i><br></i>  <i>Andrey Beshkov</i> . <br><br>  Subscribe to "Hacker" <br><ul><li>  <a href="http://bit.ly/habr_subscribe_paper">1 999 .</a>  <a href="http://bit.ly/habr_subscribe_paper">for 12 numbers of paper version</a> </li><li>  <a href="http://bit.ly/digital_xakep">1249r.</a>  <a href="http://bit.ly/digital_xakep">for an annual subscription to iOS / iPad (Android'a release soon!)</a> </li><li>  <a href="http://bit.ly/habr_android">"Hacker" on Android</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/130680/">https://habr.com/ru/post/130680/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130674/index.html">Droider Chart. Issue 74, personnel</a></li>
<li><a href="../130675/index.html">Where do you keep your cash savings?</a></li>
<li><a href="../130676/index.html">Ubiquiti AirCam IP Camera</a></li>
<li><a href="../130678/index.html">"For showing patience" ... RIM compensates for the failure in its system</a></li>
<li><a href="../130679/index.html">‚ÄúSimple Business‚Äù, version 1.5.6.0 - cases for employees and many other convenient functions for the effective management of the organization</a></li>
<li><a href="../130681/index.html">Glitter and poverty GWT (or why I do not believe in Dart part 2)</a></li>
<li><a href="../130682/index.html">Measuring speech intelligibility: a modulation approach</a></li>
<li><a href="../130683/index.html">Stages of selection for the GSP-SNU scholarship program to study in the master's program of South Korea</a></li>
<li><a href="../130685/index.html">Search Engine Torrtilla.ru - a report for a year and a half</a></li>
<li><a href="../130686/index.html">QIWI Wallet for Bada</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>