<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to become the Mayor of Krasnodar</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As you may have guessed, the article will focus on Foursquare. 

 Foursquare statistics are impressive. Only in Russia a million people use this socia...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to become the Mayor of Krasnodar</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/9d8/956/0e2/9d89560e22fe3eaba82bc7fd3f95e0bf.png"><br><br>  As you may have guessed, the article will focus on Foursquare. <br><br>  Foursquare <a href="http://habrahabr.ru/company/e-Legion/blog/183308/">statistics are</a> impressive.  Only in Russia a million people use this social network.  You can find out if your neighbors use 4sq here on this <a href="https://foursquare.com/infographics/500million">chekin map</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      One of the main "chips" 4sq are badges - special achievements that you get for visiting various places. <br>  There are a lot of badges in total. <br><br><img src="https://habrastorage.org/storage2/783/896/c7d/783896c7d1a625a9d53e546ac7eedf46.png"><br><br>  But we are interested in a very specific badge - the badge of the Mayor. <br><a name="habracut"></a><br>  The badge of the Mayor is issued to a user who has the maximum number of regular checks in one place. <br>  Two things make it valuable: <br><br>  1. Avatar of the Mayor is displayed on the page of the place (if the place is popular, then it makes you unrealistically cool!); <br>  2. For the Mayor, there are often various discounts and promotions. <br><br><img src="https://habrastorage.org/storage2/66e/556/38a/66e55638a872d52a7af6c455fa7cc715.png"><br><br><h4>  To need to become a Mayor (except for membership in the EP)? </h4><br><ul><li>  the largest number of check-ins in the last 60 days; </li><li>  Only 1 check is counted per day. </li></ul><br>  In addition, 4sq has protection against check flooding: <br><ul><li>  no more than 3 checks in 15 minutes; </li><li>  no more than 6 chekinov per hour; </li><li>  no more than 30 different chekinov in 24 hours; </li><li>  ‚ÄúReset‚Äù the daily counter at 16:00 (Moscow). </li></ul><br><br>  As in real life, there are several ways to become Mayor, bypassing the "classic" options.  About this and let's talk further. <br><br><h4>  Method one.  Fake GPS coordinates. </h4><br>  In order for your checkin to be ‚Äúcounted‚Äù for Merstvo, you must be located directly with the required geoobject.  It is easiest to do this by running the utility that emulates the work of GPS on your phone. <br><br><img src="https://habrastorage.org/storage2/9b2/5f2/ddb/9b25f2ddb06016afb6650b1b2f67b9aa.png"><br><br>  The advantages of this method are 100% guarantee of the correct check.  Cons - 100% handmade. <br><br><h4>  The second way.  Developer api. </h4><br>  Why mock the phone if you can send commands directly to the server via <a href="https://developer.foursquare.com/docs/">4sq developer api</a> ! <br><br><img src="https://habrastorage.org/storage2/fdc/5e6/2c6/fdc5e62c6a7736b108c944fa33c8e1b1.png"><br><br>  Unfortunately, in the course of working with DevAPI, a number of significant shortcomings have surfaced: User -Agent curve in POST requests, some undocumented parameters are missing, and, most importantly, check-makers that are transmitted in this way are not counted for the Merstvo (apparently there is a filter for the same User- Agent). <br><br><h4>  The third way and the last.  Spufim smartphone. </h4><br>  Unlike <a href="http://habrahabr.ru/post/166773/">Instagram</a> , 4sq uses a secure https connection to work.  So all the traffic between the device and the server is encrypted. <br>  To intercept https traffic from the phone, we need: <br><ul><li>  <a href="http://portswigger.net/burp/">Burp suite</a> (enough free version) on the PC; </li><li>  ProxyDroid (Android) on the phone (or equivalent); </li><li>  Burp suite root CA certificate on the phone. </li></ul><br>  Add PortSwigger CA to the user‚Äôs certificate store on the phone (then don‚Äôt forget to remove it from there), enable the proxy mode in the Burp Suite on the PC, specify the proxy settings in ProxyDroid on the phone and wrap all traffic through our proxy. <br><br>  In this scheme, Burp Suite performs a MITM attack on the https connection, and the trusted certificate Burp CA in the certificate store does not allow the phone to detect it. <br><br>  As a result, we have https traffic between the phone and the 4sq server in the clear: <br><br><img src="https://habrastorage.org/storage2/58a/05c/4b7/58a05c4b736ee2bf8f15b1f6156a31b3.png"><br><br>  What immediately catches the eye is the presence of a heap of undocumented DeveloperAPI parameters: metrics, CheckinComposeActivity, VenueActivity, etc.  I did not understand why they are needed ... <br>  With the help of Burp'ov request generator, you can make sure that a repeated packet will lead to a repeated checkin =&gt; We are one step away from the cherished position! <br><br><h4>  We start avtochekinku </h4><br>  To automate the checkin process, I decided to use my home router with linux firmware and cron. <br>  The final bash-script for the chekin in the Administration of the Krasnodar Territory looks like this: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/bash curl -k -X POST \ "https://api.foursquare.com/v2/checkins/add" \ -H "Accept-Language: en-US" \ -H "Accept-Encoding: gzip" \ -H "Connection: Keep-Alive" \ -H "Content-Type: application/x-www-form-urlencoded" \ -H "Host: api.foursquare.com" \ --user-agent "com.foursquare.android:2013040200:20130402:4.2.2:GT-I9100:release" \ --data "ll=45.0247440%2C38.9695560&amp;llAcc=27.0&amp;venueId=4bc4419874a9a593308fd5f6&amp;shout=&amp;broadcast=public&amp;oauth_token=&lt;bla-bla-bla&gt;&amp;v=20130402"</span></span></code> </pre> <br>  Here ll is the latitude and longitude of the geo-object (you can find out through google maps), Acc is the GPS accuracy in meters, venueId is the identifier of the geo-object (which you can find out by looking at the address bar of <a href="https://foursquare.com/v/%25D0%25B0%25D0%25B4%25D0%25BC%25D0%25B8%25D0%25BD%25D0%25B8%25D1%2581%25D1%2582%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F-%25D0%25BA%25D1%2580%25D0%25B0%25D1%2581%25D0%25BD%25D0%25BE%25D0%25B4%25D0%25B0%25D1%2580%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B3%25D0%25BE-%25D0%25BA%25D1%2580%25D0%25B0%25D1%258F/4bc4419874a9a593308fd5f6">any object</a> on the 4sq website), oauth_token is your secret key , which can be found either through a package dump using the Burp suite, or through the DeveloperAPI (log in and send some test request using the Try it out! button). <br>  The last parameter is the date the Oauth_token server generated.  As you can see, my April token is still alive. <br><br>  After I started cron with several bash scripts, I already managed to forget about foursquare.  Therefore, it was especially pleasant one day in May to wake up at the same time as the Mayor of the Administration of the city and the region: <br><br><img src="https://habrastorage.org/storage2/c3b/a53/2e7/c3ba532e76bc5abd4ece519b1b5b9c20.jpg"></div><p>Source: <a href="https://habr.com/ru/post/187130/">https://habr.com/ru/post/187130/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../187118/index.html">Than your memory is clogged or analyze the contents of the XCache cache</a></li>
<li><a href="../187120/index.html">Just5 Brick - phone-brick from Artemy Lebedev (+ video)</a></li>
<li><a href="../187122/index.html">Android users are offered to make money on advertising on the smartphone lockbox</a></li>
<li><a href="../187124/index.html">Detailed description of the actions of the IT department - a basic set of documentation</a></li>
<li><a href="../187126/index.html">Google, Apple and Facebook want to disclose NSA requests</a></li>
<li><a href="../187136/index.html">G.fast may be adopted in 2014</a></li>
<li><a href="../187138/index.html">Highscreen Omega Q - Budget Quad</a></li>
<li><a href="../187142/index.html">Development of IntelliJ IDEA plugin. Part 2</a></li>
<li><a href="../187146/index.html">RThrust - automatic testing system for BC motors</a></li>
<li><a href="../187148/index.html">Comparison of two GPS Data Loggers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>