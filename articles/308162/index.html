<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A little about the movie or how to do interactive visualization in python</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 In this post I want to talk about how you can quite easily build interactive charts in Jupyter Notebook'e using the plotly library. M...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A little about the movie or how to do interactive visualization in python</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/b3e/7dd/cff/b3e7ddcffc2d4606aad2fe71eaf31526.png"></p><br><h2>  Introduction </h2><br><p> In this post I want to talk about how you can quite easily build interactive charts in Jupyter Notebook'e using the <code>plotly</code> library.  Moreover, to build them you do not need to raise your server and write code in javascript.  Another big plus of the proposed approach is that visualizations will work in <a href="http://nbviewer.jupyter.org/">NBViewer</a> , i.e.  It will be easy to share your results with colleagues.  Here, for example, <a href="http://nbviewer.jupyter.org/github/miptgirl/kinopoisk_data/blob/master/movies_analysis.ipynb">my code</a> for this note. </p><br><p>  For examples, I took the data about the films downloaded in April (year of release, ratings on KinoPoisk and IMDb, genres, etc.).  I downloaded the data for all films that had at least 100 ratings - only 36417 films.  About how to download and parse data KinoPoisk, I told in a <a href="https://habrahabr.ru/post/280238/">previous post</a> . </p><br><a name="habracut"></a><br><h2>  Python and plotly visualization </h2><br><p>  In python, there are many libraries for visualization: <code>matplotlib</code> , <code>seaborn</code> , ported from R <code>ggplot</code> and others (you can read more about the tools <a href="https://blog.modeanalytics.com/python-data-visualization-libraries/">here</a> or <a href="http://pbpython.com/visualization-tools-1.html">here</a> ).  Among them are those that allow you to build interactive graphics, for example, <code>bokeh</code> , <code>pygal</code> and <code>plotly</code> , which is actually discussed. </p><br><p>  <code>Plotly</code> positioned as an online platform where you can create and publish your graphics.  However, this library can also be used in <code>Jupyter Notebook'e</code> .  In addition, the library has offline-mode, which allows it to be used without registering and publishing data and graphs on the <code>plotly</code> server ( <a href="https://plot.ly/python/offline/">documentation</a> ). </p><br><p>  In general, I liked the library very much: there are detailed documentation with <a href="https://plot.ly/python/">examples</a> , different types of graphs are supported (scatter plots, box plots, 3D graphics, bar charts, heatmaps, dendrograms, etc.) and the graphics are quite nice. </p><br><h2>  Examples </h2><br><p>  Now it's time to go directly to the examples.  As I said above, all code and interactive graphics are available in <a href="http://nbviewer.jupyter.org/github/miptgirl/kinopoisk_data/blob/master/movies_analysis.ipynb">NBViewer</a> . </p><br><p>  The library is easy to install using the command: <code>pip install plotly</code> . </p><br><p>  First of all, it is necessary to make imports, call the <code>init_notebook_mode</code> command to initialize <code>plot.ly</code> and load the data with which we will work into <code>pandas.DataFrame</code> . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> plotly.offline <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> download_plotlyjs, init_notebook_mode, plot, iplot <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> plotly.graph_objs <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> go init_notebook_mode(connected=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) df = pd.read_csv(<span class="hljs-string"><span class="hljs-string">'kp_all_movies.csv'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   df.head()</span></span></code> </pre> <br><p><img src="https://habrastorage.org/files/615/3fe/183/6153fe183eed4817a1051527ec8fd91b.png"></p><br><h3>  How many films came out in different years? </h3><br><p>  To begin with, we will build a simple bar chart showing the distribution of films by release year. </p><br><pre> <code class="python hljs">count_year_df = df.groupby(<span class="hljs-string"><span class="hljs-string">'movie_year'</span></span>, as_index = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>).movie_id.count() trace = go.Bar( x = count_year_df.movie_year, y = count_year_df.movie_id ) layout = go.Layout( title=<span class="hljs-string"><span class="hljs-string">'  '</span></span>, ) fig = go.Figure(data = [trace], layout = layout) iplot(fig)</code> </pre> <br><p>  As a result, we get an interactive graph that shows the value when you hover for a year and the rather expected conclusion that over the years, films have become more. <br><img src="https://habrastorage.org/files/eaf/759/269/eaf7592695304e6ebc0e886a05ba4730.png"></p><br><h3>  Have you started making better movies over the years? </h3><br><p>  To answer this question, we construct a graph of the average rating for KinoPoisk and IMDb depending on the year of production. </p><br><pre> <code class="python hljs">rating_year_df = df.groupby(<span class="hljs-string"><span class="hljs-string">'movie_year'</span></span>, as_index = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)[[<span class="hljs-string"><span class="hljs-string">'kp_rating'</span></span>, <span class="hljs-string"><span class="hljs-string">'imdb_rating'</span></span>]].mean() trace_kp = go.Scatter( x = rating_year_df.movie_year, y = rating_year_df.kp_rating, mode = <span class="hljs-string"><span class="hljs-string">'lines'</span></span>, name = <span class="hljs-string"><span class="hljs-string">u''</span></span> ) trace_imdb = go.Scatter( x = rating_year_df.movie_year, y = rating_year_df.imdb_rating, mode = <span class="hljs-string"><span class="hljs-string">'lines'</span></span>, name = <span class="hljs-string"><span class="hljs-string">'IMDb'</span></span> ) layout = go.Layout( title=<span class="hljs-string"><span class="hljs-string">' '</span></span>, ) fig = go.Figure(data = [trace_kp, trace_imdb], layout = layout) iplot(fig)</code> </pre> <br><p>  The Kinopodisk and IMDb estimates show a trend towards a decrease in the average rating depending on the year of production.  But, in fact, it is impossible to draw an unequivocal conclusion from this that earlier better films were shot.  The fact is that if people watch old films and evaluate them at KinoPoisk, they choose cult cinema with obviously higher ratings (I think few people watch passing films released in 1940, at least I don‚Äôt watch). <br><img src="https://habrastorage.org/files/d65/36e/3c9/d6536e3c9b7a492db5789edb772ed722.png"></p><br><h3>  Are there any differences in ratings depending on the genre of the film? </h3><br><p>  To compare the estimates depending on the genre, we construct box plot.  It is worth remembering that each film may belong to several genres, so the films will be counted in several groups. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#     genres  data frame       def parse_list(lst_str): return filter(lambda y: y != '', map(lambda x: x.strip(), re.sub(r'[\[\]]', '', lst_str).split(','))) df['genres'] = df['genres'].fillna('[]') genres_data = [] for record in df.to_dict(orient = 'records'): genres_lst = parse_list(record['genres']) for genre in genres_lst: copy = record.copy() copy['genre'] = genre copy['weight'] = 1./len(genres_lst) genres_data.append(copy) genres_df = pd.DataFrame.from_dict(genres_data) #  -10  top_genres = genres_df.groupby('genre')[['movie_id']].count()\ .sort_values('movie_id', ascending = False)\ .head(10).index.values.tolist() N = float(len(top_genres)) # c    c = ['hsl('+str(h)+',50%'+',50%)' for h in np.linspace(0, 360, N)] data = [{ 'y': genres_df[genres_df.genre == top_genres[i]].kp_rating, 'type':'box', 'marker':{'color': c[i]}, 'name': top_genres[i] } for i in range(len(top_genres))] layout = go.Layout( title=' ', yaxis = {'title': ' '} ) fig = go.Figure(data = data, layout = layout) iplot(fig)</span></span></code> </pre> </div></div><br><p>  The graph shows that the most notable are low marks for horror films. <br><img src="https://habrastorage.org/files/686/8eb/40e/6868eb40e3ba466da70328212b8e5b08.png"></p><br><h3>  What genres are most often side by side? </h3><br><p>  As I said above, one film most often refers to several genres at once.  In order to look at which genres are more often found together, let's build a heatmap. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs">genres_coincidents = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> df.genres: parsed_genres = parse_list(item) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> genre1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parsed_genres: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> genre1 <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> genres_coincidents: genres_coincidents[genre1] = defaultdict(int) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> genre2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parsed_genres: genres_coincidents[genre1][genre2] += <span class="hljs-number"><span class="hljs-number">1</span></span> genres_coincidents_df = pd.DataFrame.from_dict(genres_coincidents).fillna(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">#        genres_coincidents_df_norm = genres_coincidents_df\ .apply(lambda x: x/genres_df.groupby('genre').movie_id.count(), axis = 1) heatmap = go.Heatmap( z = genres_coincidents_df_norm.values, x = genres_coincidents_df_norm.index.values, y = genres_coincidents_df_norm.columns ) layout = go.Layout( title = ' ' ) fig = go.Figure(data = [heatmap], layout = layout) iplot(fig)</span></span></code> </pre> </div></div><br><p>  Read the schedule as follows: 74.7% of historical films also have a <em>drama</em> tag. <br><img src="https://habrastorage.org/files/fdf/89e/fb4/fdf89efb4cba49308299746c778dfeb4.png"></p><br><h3>  How did the ratings of films change depending on the genre? </h3><br><p>  Let us return once more to the example in which we looked at the dependence of the average grade on the year of production and construct such graphs for various genres.  At the same time <code>plotly</code> get acquainted with one more <code>plotly</code> chip: you can configure the drop-down menu and change the schedule depending on the selected option. </p><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre> <code class="python hljs">genre_rating_year_df = genres_df.groupby([<span class="hljs-string"><span class="hljs-string">'movie_year'</span></span>, <span class="hljs-string"><span class="hljs-string">'genre'</span></span>], as_index = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)[[<span class="hljs-string"><span class="hljs-string">'kp_rating'</span></span>, <span class="hljs-string"><span class="hljs-string">'imdb_rating'</span></span>]].mean() N = len(top_genres) data = [] drop_menus = [] <span class="hljs-comment"><span class="hljs-comment">#      for i in range(N): genre = top_genres[i] genre_df = genre_rating_year_df[genre_rating_year_df.genre == genre] trace_kp = go.Scatter( x = genre_df.movie_year, y = genre_df.kp_rating, mode = 'lines', name = genre + ' ', visible = (i == 0) ) trace_imdb = go.Scatter( x = genre_df.movie_year, y = genre_df.imdb_rating, mode = 'lines', name = genre + ' IMDb', visible = (i == 0) ) data.append(trace_kp) data.append(trace_imdb) #    for i in range(N): drop_menus.append( dict( args=['visible', [False]*2*i + [True]*2 + [False]*2*(N-1-i)], label= top_genres[i], method='restyle' ) ) layout = go.Layout( title='  ', updatemenus=list([ dict( x = -0.1, y = 1, yanchor = 'top', buttons = drop_menus ) ]), ) fig = go.Figure(data = data, layout = layout) iplot(fig)</span></span></code> </pre> </div></div><br><p><img src="https://habrastorage.org/files/df6/eab/173/df6eab173b684223a396174ff950f46d.png"></p><br><h2>  As a conclusion </h2><br><p>  In this post, we met using the <code>plotly</code> library to build various interactive graphs in python.  I think this is a very useful tool for analytical work, because it allows you to make interactive visualizations and easily share them with your colleagues. </p><br><p>  Interested advise to look at <a href="https://plot.ly/python/">other examples of the use of plot.ly.</a> </p><br><p>  All code and data live on <a href="https://github.com/miptgirl/kinopoisk_data">github</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/308162/">https://habr.com/ru/post/308162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308150/index.html">Documents Snowden confirm the accuracy of the data Shadow Brokers</a></li>
<li><a href="../308152/index.html">Using the Android support percent library using the example of PercentRelativeLayout</a></li>
<li><a href="../308154/index.html">Javascript: where we are and where to go</a></li>
<li><a href="../308158/index.html">Microsoft is changing the model of updating Windows 7 and 8.1</a></li>
<li><a href="../308160/index.html">ReactOS 0.4.2 release and launch in VirtualBox</a></li>
<li><a href="../308166/index.html">Do not use Illuminate Support</a></li>
<li><a href="../308168/index.html">Overview of Mathematica 11 and Wolfram Language Features</a></li>
<li><a href="../308170/index.html">BMW Music Light</a></li>
<li><a href="../308174/index.html">‚ÄúGreen‚Äù data centers: what do the giants of the industry use to reduce the energy consumption of their DCs?</a></li>
<li><a href="../308178/index.html">The digest of interesting materials for the mobile # 167 developer (August 15-21)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>