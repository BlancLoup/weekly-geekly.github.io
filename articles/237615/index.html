<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing testable javascript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="[Approx. transl.]: I bring to your attention a translation of an article by Ben Cherry, a Twitter developer in the past. In this article, he gives som...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing testable javascript</h1><div class="post__text post__text-html js-mediator-article">  <i>[Approx.</i>  <i>transl.]: I bring to your attention a translation of an article by Ben Cherry, a Twitter developer in the past.</i>  <i>In this article, he gives some tips on writing javascript code suitable for testing.</i> <br><br>  The development culture on Twitter requires writing tests.  I had no experience testing javascript before working on Twitter, so I had to learn a lot.  In particular, some programming patterns that I used to use, which I wrote about and called for their use, turned out to be unsuitable for testing.  So I thought that it was worth sharing some of the most important principles that I developed for writing testable Javascript code.  The examples I give are based on <a href="http://docs.jquery.com/QUnit">QUnit</a> , but can be applied to any Javascript testing framework. <br><br><h4>  Avoid singletons </h4><br>  One of my most popular posts was how to use the javascript <a href="http://www.adequatelygood.com/2010/3/JavaScript-Module-Pattern-In-Depth">Module template</a> to create singletones in your application.  This approach can be simple and useful, but it creates problems for testing for one simple reason: Singleton pollutes the state of an object between tests.  Instead of a singleton as a module, you should create it as a constructed object and assign it to a global-level instance during initialization of your application. <br><a name="habracut"></a><br>  For example, consider the following singleton module (an example, of course, made-up): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataStore = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = []; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">push</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ data.push(item); }, <span class="hljs-attr"><span class="hljs-attr">pop</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.pop(); }, <span class="hljs-attr"><span class="hljs-attr">length</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.length; } }; }());</code> </pre> <br>  In this module, we may want to test some methods.  Here is an example of a simple QUnit test: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>(<span class="hljs-string"><span class="hljs-string">"dataStore"</span></span>); test(<span class="hljs-string"><span class="hljs-string">"pop"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dataStore.push(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); dataStore.push(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>) equal(dataStore.pop(), <span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"popping returns the most-recently pushed item"</span></span>); }); test(<span class="hljs-string"><span class="hljs-string">"length"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ dataStore.push(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); equal(dataStore.length(), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"adding 1 item makes the length 1"</span></span>); });</code> </pre><br>  During the execution of this test suite, the test of the ‚Äúlength‚Äù method will fail, but looking at it, it is not clear why.  The problem is that the state of the dataStore object is preserved after the previous test.  Simply reordering the tests will make both tests pass the test, which is an obvious sign that something has been done wrong.  We can fix this by returning the state of the dataStore object before each test, but this means that we will have to constantly maintain a template for testing if we make changes to the module.  It is better to use a different approach: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newDataStore</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = []; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">push</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function">) </span></span>{ data.push(item); }, <span class="hljs-attr"><span class="hljs-attr">pop</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.pop(); }, <span class="hljs-attr"><span class="hljs-attr">length</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> data.length; } }; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataStore = newDataStore();</code> </pre><br>  Now the test suite looks like this: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>(<span class="hljs-string"><span class="hljs-string">"dataStore"</span></span>); test(<span class="hljs-string"><span class="hljs-string">"pop"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataStore = newDataStore(); dataStore.push(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); dataStore.push(<span class="hljs-string"><span class="hljs-string">"bar"</span></span>) equal(dataStore.pop(), <span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"popping returns the most-recently pushed item"</span></span>); }); test(<span class="hljs-string"><span class="hljs-string">"length"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataStore = newDataStore(); dataStore.push(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>); equal(dataStore.length(), <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"adding 1 item makes the length 1"</span></span>); });</code> </pre><br>  This approach allows our global object to behave, just as it did before, and the tests will not clog each other.  Each test has its own copy of the dataStore object, which will be destroyed by the garbage collector after the test is completed. <br><br><h5>  Avoid creating private properties with closures. </h5><br>  Another pattern promoted by me is the creation of truly private properties in Javascript.  The advantage of this method is that you can keep the global namespace free from unnecessary references to hidden implementation details.  However, the misuse of this programming pattern can lead to unsuitable code for testing.  The reason for this phenomenon is that your test suite does not have access to private functions hidden in closures, and therefore cannot test them.  Consider an example: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Templater</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supplant</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params) { str.split(<span class="hljs-string"><span class="hljs-string">"{"</span></span> + prop +<span class="hljs-string"><span class="hljs-string">"}"</span></span>).join(params[prop]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templates = {}; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.defineTemplate = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, template</span></span></span><span class="hljs-function">) </span></span>{ templates[name] = template; }; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.render = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> templates[name] !== <span class="hljs-string"><span class="hljs-string">"string"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"Template "</span></span> + name + <span class="hljs-string"><span class="hljs-string">" not found!"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> supplant(templates[name], params); }; }</code> </pre><br>  The key method in the Templater object is ‚Äúsupplant‚Äù, but we don‚Äôt have access to it outside the function closure.  Thus, we cannot verify whether it works as planned.  In addition, we cannot check if our defineTemplate method does anything without invoking the render method.  We can add the ‚ÄúgetTemplate ()‚Äù method, but then it turns out that we added a method to the public interface solely for testing purposes, which is not a good approach.  In this situation, the construction of complex objects with important private methods will lead to the fact that you have to rely on untested code, which is quite dangerous.  The following is an example of a testable version of this object: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Templater</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._templates = {}; } Templater.prototype = { <span class="hljs-attr"><span class="hljs-attr">_supplant</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> prop <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params) { str.split(<span class="hljs-string"><span class="hljs-string">"{"</span></span> + prop +<span class="hljs-string"><span class="hljs-string">"}"</span></span>).join(params[prop]); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; }, <span class="hljs-attr"><span class="hljs-attr">render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, params</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._templates[name] !== <span class="hljs-string"><span class="hljs-string">"string"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-string"><span class="hljs-string">"Template "</span></span> + name + <span class="hljs-string"><span class="hljs-string">" not found!"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._supplant(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._templates[name], params); }, <span class="hljs-attr"><span class="hljs-attr">defineTemplate</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name, template</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._templates[name] = template; } };</code> </pre><br>  Here is the QUnit test suite for it: <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">module</span></span>(<span class="hljs-string"><span class="hljs-string">"Templater"</span></span>); test(<span class="hljs-string"><span class="hljs-string">"_supplant"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templater = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Templater(); equal(templater._supplant(<span class="hljs-string"><span class="hljs-string">"{foo}"</span></span>, {<span class="hljs-attr"><span class="hljs-attr">foo</span></span>: <span class="hljs-string"><span class="hljs-string">"bar"</span></span>}), <span class="hljs-string"><span class="hljs-string">"bar"</span></span>)) equal(templater._supplant(<span class="hljs-string"><span class="hljs-string">"foo {bar}"</span></span>, {<span class="hljs-attr"><span class="hljs-attr">bar</span></span>: <span class="hljs-string"><span class="hljs-string">"baz"</span></span>}), <span class="hljs-string"><span class="hljs-string">"foo baz"</span></span>)); }); test(<span class="hljs-string"><span class="hljs-string">"defineTemplate"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templater = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Templater(); templater.defineTemplate(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-string"><span class="hljs-string">"{foo}"</span></span>); equal(template._templates.foo, <span class="hljs-string"><span class="hljs-string">"{foo}"</span></span>); }); test(<span class="hljs-string"><span class="hljs-string">"render"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> templater = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Templater(); templater.defineTemplate(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, <span class="hljs-string"><span class="hljs-string">"hello {world}!"</span></span>); equal(templater.render(<span class="hljs-string"><span class="hljs-string">"hello"</span></span>, {<span class="hljs-attr"><span class="hljs-attr">world</span></span>: <span class="hljs-string"><span class="hljs-string">"internet"</span></span>}), <span class="hljs-string"><span class="hljs-string">"hello internet!"</span></span>); });</code> </pre><br>  Please note that our test for the ‚Äúrender‚Äù method is only intended to make sure that the methods ‚ÄúdefineTemplate‚Äù and ‚Äúsupplant‚Äù complement each other correctly.  We have already tested them separately from each other, and this will allow us to easily understand which of the components is not working correctly if the test is not successful. <br><br><h5>  Write related functions </h5><br>  Related functions are important in any language, but Javascript has its own reasons for this.  Much of what you do with Javascript uses global objects provided by the environment that your test suites rely on.  For example, testing a function that changes a URL will be difficult, since all methods will be associated with window.location.  Instead, you must break your system into logical components that will decide what to do next, and then write short functions that will do this.  You can test logical functions on different incoming and outgoing data, and leave a function that modifies window.location untested.  Provided that you have designed your system correctly, this approach will be safe. <br><br>  Here is an example of a non-valid code: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirectTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>) === <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.hash = url; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>) === <span class="hljs-string"><span class="hljs-string">"/"</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.pathname = url; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location.href = url; } }</code> </pre><br>  The logic in this example is quite simple, but we can imagine a more complex situation.  With increasing complexity, we will not be able to test this method without redirecting the browser window. <br><br>  And here is a good version: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getRedirectPart</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>) === <span class="hljs-string"><span class="hljs-string">"#"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"hash"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (url.charAt(<span class="hljs-number"><span class="hljs-number">0</span></span>) === <span class="hljs-string"><span class="hljs-string">"/"</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"pathname"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"href"</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">redirectTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">url</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.location[_getRedirectPart(url)] = url; }</code> </pre><br>  And now we can write a simple test suite for "_getRedirectPart": <br><br><pre> <code class="javascript hljs">test(<span class="hljs-string"><span class="hljs-string">"_getRedirectPart"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ equal(_getRedirectPart(<span class="hljs-string"><span class="hljs-string">"#foo"</span></span>), <span class="hljs-string"><span class="hljs-string">"hash"</span></span>); equal(_getRedirectPart(<span class="hljs-string"><span class="hljs-string">"/foo"</span></span>), <span class="hljs-string"><span class="hljs-string">"pathname"</span></span>); equal(_getRedirectPart(<span class="hljs-string"><span class="hljs-string">"http://foo.com"</span></span>), <span class="hljs-string"><span class="hljs-string">"href"</span></span>); });</code> </pre><br>  In this case, the main part of the ‚ÄúredirectTo‚Äù method will be tested, and we can not worry about random redirects. <br><br><h5>  Write a lot of tests </h5><br>  This is no easy task, but it is very important to always remember this.  Many programmers write too few tests, because writing them is a time-consuming exercise and takes a lot of time.  I am constantly suffering from this problem, and so I wrote a small helper for QUnit, which will make writing tests a little easier.  This is the ‚ÄútestCases ()‚Äù function, which you can call within the tested block, passing it a function, execution context and input / output data array for comparison.  With it, you can easily create a test suite. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testCases</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">fn, context, tests</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tests.length; i++) { same(fn.apply(context, tests[i][<span class="hljs-number"><span class="hljs-number">0</span></span>]), tests[i][<span class="hljs-number"><span class="hljs-number">1</span></span>], tests[i][<span class="hljs-number"><span class="hljs-number">2</span></span>] || <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(tests[i])); } }</code> </pre><br>  Usage example: <br><br><pre> <code class="javascript hljs">test(<span class="hljs-string"><span class="hljs-string">"foo"</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ testCases(foo, <span class="hljs-literal"><span class="hljs-literal">null</span></span>, [ [[<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"baz"</span></span>], <span class="hljs-string"><span class="hljs-string">"barbaz"</span></span>], [[<span class="hljs-string"><span class="hljs-string">"bar"</span></span>, <span class="hljs-string"><span class="hljs-string">"bar"</span></span>], <span class="hljs-string"><span class="hljs-string">"barbar"</span></span>, <span class="hljs-string"><span class="hljs-string">"a passing test"</span></span>] ]); });</code> </pre><br><br><h5>  findings </h5><br>  You can still write a lot about testing Javascript, and I am sure there are many good books on this topic, but I hope that I have given a good overview of the practical examples that I encounter in my daily work.  I am not an expert in testing, so let me know if I made some mistake or give bad advice. </div><p>Source: <a href="https://habr.com/ru/post/237615/">https://habr.com/ru/post/237615/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237603/index.html">The digest of interesting news and materials from the world of PHP No. 48 (September 7 - 21, 2014)</a></li>
<li><a href="../237605/index.html">Competition Apps4Russia 2014. Open data and "clarity" of language, money and rules</a></li>
<li><a href="../237607/index.html">The most massive misconception around Moore's law</a></li>
<li><a href="../237609/index.html">Retirement IT-specialist (survey)</a></li>
<li><a href="../237613/index.html">Javascript transducers. Part one</a></li>
<li><a href="../237617/index.html">RailsClub'Moscow 2014: Interview with Ravil Bayramgalin</a></li>
<li><a href="../237619/index.html">Tables - Emacs and org-mode</a></li>
<li><a href="../237621/index.html">Steering behavior. Types of changing the direction of movement of the character on the go</a></li>
<li><a href="../237625/index.html">10 performance indicators that every online store owner should follow</a></li>
<li><a href="../237627/index.html">Infrastructure for load testing in the cloud - with Visual Studio 2013 and only when necessary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>