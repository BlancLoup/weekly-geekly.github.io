<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>DualBut Windows 7 and Debian Squeeze on a UEFI computer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I believe many have heard of the (U) EFI interface, which is increasingly being found on PCs with Intel processors. Despite the fact that Intel likes ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>DualBut Windows 7 and Debian Squeeze on a UEFI computer</h1><div class="post__text post__text-html js-mediator-article">  I believe many have heard of the (U) EFI interface, which is increasingly being found on PCs with Intel processors.  Despite the fact that Intel likes to paint the benefits, booting through EFI has a significant drawback - installing some operating systems, including most Linux distributions (of which I know EFI out of the box has recently started to support only Ubuntu and its fork).  In this post I will try to explain the ‚Äúpitfalls‚Äù and their solution. <br><a name="habracut"></a><br><br><h2>  The essence of the problem </h2><br>  Actually, the subject: <b>Sony VAIO SV-E14A1S1R</b> ( <a href="http://www.sony.ru/product/vaio-serii-e/sve14a1s1r">specifications</a> ) <br><br>  Shortly before the acquisition, there was a desire to try some other distribution other than Xubuntu and the choice fell on Debian;  in case of problems with the Internet, the repository was additionally downloaded (8 DVD). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, there is a laptop, there are disks, we start ... And then the first problem arises: until I saw the boot option switch from EFI to the traditional ‚ÄúLegacy BIOS‚Äù in the BIOS settings, the installation menu did not appear and immediately loaded Windows. <br><br>  However, after the installation was completed, I was greeted by the message ‚ÄúOperating system not found‚Äù (if you did not remove the distribution disk from the drive and select ‚ÄúBoot from the first boot disk,‚Äù the system would boot, but who would like to occupy the drive?), And with EFI only the vents were loaded. <br><br><h2>  Decision </h2><br>  After several unsuccessful install-reinstall cycles with different parameters, I stumbled upon a similar problem in one of the ENT themes, which the author of the topic, he said, <b>partially</b> solved, <b>having collected GRUB on a virtual machine</b> with EFI enabled (it is possible that you can do without a virtual machine and get to Debian, but I did not check). <br><br>  Suppose that you already have an EFI partition on your hard disk, then we will need: <br><ul><li>  Actually, a machine with a 64-bit Linux distribution and EFI (I used Ubuntu, launched from VirtualBox) </li><li>  GRUB2 sources (I took <a href="">these</a> , with the versions below, I simply did not intend the bootloader) </li><li>  <b>make</b> , <b>gcc</b> , <b>bison</b> and <b>flex</b> </li></ul><br><br><h2>  Putting the EFI image of GRUB </h2><br><ul><li>  First we extract the source code: <br><pre><code class="bash hljs">$ wget ftp://alpha.gnu.org/gnu/grub/grub-1.99~rc2.tar.gz $ tar -xvf grub-1.99~rc2.tar.gz $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./grub-1.99~rc2</code> </pre> <br></li><li>  Compile bootloader: <br><pre> <code class="bash hljs">$ ./configure --with-platform=efi --target=x86_64 $ make</code> </pre><br>  After that, the directory will look something <a href="">like this.</a> <br></li><li>  Create an EFI image: <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./grub-core $ ../grub-mkimage -d . -o bootx64.efi -O x86_64-efi -p /efi/grub `find *.mod | xargs | sed -e <span class="hljs-string"><span class="hljs-string">'s/.mod//g'</span></span>`</code> </pre><br>  The first command is to go to the directory with the GRUB modules, the second one is to assemble the image, connecting all the modules in the directory to it. <br></li><li>  Moving the file to the EFI partition of the target computer (N is the index number of the partition) <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mount /dev/sdaN /mnt # mv &lt;  bootx64.efi&gt; /mnt/EFI/Boot/bootx64.efi</span></span></code> </pre><br></li><li>  Transfer the module files (*. Mod), configuration file (grub.cfg), fonts (unicode.pf2) and, if necessary, language files and background image to the directory specified when building the image (in this case, / efi / grub) <br>  Most likely, the grub.cfg generated during the installation will not work (it is unlikely that there will be instructions from the main disks like (hd0, gptN)), and it will be easier to take UUIDs from it and write a new one from the template.  At the end of the article - an excerpt of my grub.cfg, which will help to understand. <br></li></ul><br><br>  If something went wrong, you can <b>remove grub.cfg from the EFI partition</b> - GRUB will launch its command shell and you can try to load the OS from there and find the source of the problem. <br><br>  If all is well, go on! <br><h2>  Finishing Touches: Adding Windows 7 to the Boot Menu </h2><br>  There is nothing difficult - we only need to know the UUID of the Windows disk and the path to the bootloader from Microsoft bootmgfw.efi (I had it located in the / EFI / Microsoft / Boot / directory) <br><br>  And by analogy with the menu items for loading Linux, we create the corresponding item for loading Windows: <br><br><pre> <code class="bash hljs">menuentry <span class="hljs-string"><span class="hljs-string">"Windows 7"</span></span> { search --fs-uuid --no-floppy --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>=root 48EC-30CC <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> root=<span class="hljs-string"><span class="hljs-string">'(hd0,gpt3)'</span></span> chainloader (<span class="hljs-variable"><span class="hljs-variable">$root</span></span>)/efi/microsoft/boot/bootmgfw.efi boot }</code> </pre><br><br><h2>  Conclusion </h2><br>  I believe that this post will be useful to someone, since computers with EFI are becoming more and more, and I hardly found any information in RuNet. <br>  Below I present a excerpt of grub.cfg and links to materials without which I would hardly have solved this problem: <br><br><div class="spoiler">  <b class="spoiler_title">Part of grub.cfg</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">set</span></span> root=<span class="hljs-string"><span class="hljs-string">'(hd0,gpt3)'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> locale_dir=/EFI/Boot/grub/locale <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> lang=en insmod gettext loadfont (<span class="hljs-variable"><span class="hljs-variable">$root</span></span>)/EFI/grub/unicode.pf2 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> timeout=10 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> default=0 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> gfxmode=640x480 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> gfxpayload=keep terminal_output gfxterm insmod part_gpt insmod png background_image -m normal (<span class="hljs-variable"><span class="hljs-variable">$root</span></span>)/EFI/grub/spacefun-grub.png <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> color_normal=light-gray/black <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> color_highlight=white/black insmod part_gpt insmod ext2 search --no-floppy --fs-uuid --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>=root 510c2ef3-0412-4d42-ba6b-15d1f680e150 menuentry <span class="hljs-string"><span class="hljs-string">'Debian GNU/Linux, with Linux 3.5.3'</span></span> --class debian --class gnu-linux --class gnu --class os { insmod part_gpt insmod ext2 <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> root=<span class="hljs-string"><span class="hljs-string">'(hd0,gpt7)'</span></span> search --no-floppy --fs-uuid --<span class="hljs-built_in"><span class="hljs-built_in">set</span></span>=root 510c2ef3-0412-4d42-ba6b-15d1f680e150 <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Loading Linux 3.5.3 ...'</span></span> linux /boot/vmlinuz-3.5.3 root=UUID=510c2ef3-0412-4d42-ba6b-15d1f680e150 ro quiet <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'Loading initial ramdisk ...'</span></span> initrd /boot/initrd.img-3.5.3 }</code> </pre><br></div></div><br>  <a href="http://www.linux.org.ru/forum/linux-install/7379175">LOR theme</a> <br>  <a href="http://wiki.osdev.org/GRUB">grub-efi article section</a> <br><br>  <b>UPD:</b> Thank you very much for the comments and ‚Äúeasier options‚Äù!  If there is more ‚îÄ do not hesitate and write: perhaps, make life easier for those who face my problem and do not want such red eyes. </div><p>Source: <a href="https://habr.com/ru/post/154071/">https://habr.com/ru/post/154071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../154053/index.html">LibreOffice in the corporate sector - ready to start</a></li>
<li><a href="../154055/index.html">Notes on contextual advertising on Facebook</a></li>
<li><a href="../154061/index.html">All Kiev is planning to cover the free Wi-Fi network</a></li>
<li><a href="../154063/index.html">Samsung Galaxy S III crash:</a></li>
<li><a href="../154065/index.html">The Dude. Sending SMS notifications</a></li>
<li><a href="../154073/index.html">Prime Factor Diagrams</a></li>
<li><a href="../154077/index.html">Last year, Apple and Google spent more on patents than on R & D of new products.</a></li>
<li><a href="../154079/index.html">Kindle Paperwhite Review</a></li>
<li><a href="../154081/index.html">Paradigm programming processors in MODx Revolution</a></li>
<li><a href="../154083/index.html">Web series: do they have a future?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>