<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Extension methods for .NET standard library types</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, almost every .NET-developer has come across cases where, for convenience of coding routine actions and reducing boilerplate code when workin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Extension methods for .NET standard library types</h1><div class="post__text post__text-html js-mediator-article"><p>  Probably, almost every .NET-developer has come across cases where, for convenience of coding routine actions and reducing boilerplate code when working with standard data types, the capabilities of the standard library are not enough. </p><br><p>  And practically in every project there appear assemblies and namespaces of the Common type, ProjectName.Common, etc., containing additions for working with standard data types: Enums enumerations, Nullable structures, strings and collections ‚Äî IEnumerable &lt;T&gt; enums, arrays, lists and collections. </p><br><p>  As a rule, these add-ons are implemented using the extension methods mechanism.  One can often observe the existence of monad implementations, also built on the mechanism of extension methods. </p><br><p>  (Looking ahead, we will consider issues that arise unexpectedly, and which can be overlooked when your own extensions for IEnumerable &lt;T&gt; are created, and work is being done with IQueryable &lt;T&gt;). </p><br><p>  The writing of this article is inspired by the reading of a long-standing article translation of the <a href="https://habrahabr.ru/post/97464/">Check for empty transfers</a> and the ensuing discussion to it. </p><br><p>  The article is old, but the topic is still relevant, especially since the code, similar to the example from the article, had to be met in real work from project to project. </p><a name="habracut"></a><br><p>  In the original article, a question was raised, which in its essence concerns, in general, Common-libraries added to work projects. </p><br><p>  The problem is that similar extensions in product projects are added hastily, because  developers are engaged in the creation of new features, and the creation and design and debugging of basic infrastructure of time and resources is not allocated. </p><br><p>  In addition, as a rule, the developer, adding the Common-Supplement he needs, creates it in such a way that this addition is tailored to the cases of its feature, and it does not occur that once this addition is of a general nature, then it should be as abstract as possible from the subject logic and have a universal character - as is done in standard libraries of platforms. </p><br><p>  As a result, in numerous Common-subfolders of projects, there are deposits of the code given in the <a href="https://habrahabr.ru/post/97464/">original article</a> : </p><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Foo&lt;T&gt;(IEnumerable&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || items.Count() == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//     } }</span></span></code> </pre> <br><p>  The author pointed out a problem with the Count () method and proposed to create such an extension method: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNullOrEmpty&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IEnumerable&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !items.Any(); }</code> </pre> <br><p>  But the presence of such a method does not solve all the problems: </p><br><ul><li>  In the comments there was a discussion on the topic that the Any () method does one iteration, which can lead to a problem when the next iteration of the collection (which is supposed after checking IsNullOrEmpty) is performed not from the first but from the second element, and the subject logic about this will not know. </li><li>  To which an objection was received that the Any () method for checking creates a separate iterator (note, these are certain overhead costs). </li></ul><br><p>  Now, note that all standard .NET collections, except the ‚Äúinfinite‚Äù IEnumerable &lt;T&gt; sequence itself ‚Äî arrays, lists, and the collections themselves ‚Äî implement the standard IReadOnlyCollection &lt;T&gt; interface, which provides the Count property ‚Äî and no iterators with overheads are needed expenses. </p><br><p>  Thus, it is advisable to create two extension methods: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNullOrEmpty&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IReadOnlyCollection&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || items.Count == <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNullOrEmpty&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IEnumerable&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !items.Any(); }</code> </pre> <br><p>  In this case, when calling IsNullOrEmpty &lt;T&gt;, the appropriate method will be selected by the compiler, depending on the type of object for which the extension is being called.  The challenge itself in both cases will look the same. </p><br><p>  However, later in the discussion one of the commentators pointed out that, probably, for IQueryable &lt;T&gt; (the interface of the "infinite" sequence for working with queries to the database, inheriting from IEnumerable &lt;T&gt;) the most optimal would be just a call to the Count () method. </p><br><p>  This version requires verification, including testing of work with different ORM - EF, EFCore, Linq2Sql, and, if so, then there is a need to create a third method. </p><br><p>  In fact, for IQueryable &lt;T&gt; there are own extension-implementations Any (), Count () and other methods of working with collections (the System.Linq.Queryable class), which are designed to work with ORM, unlike similar implementations for IEnumerable &lt;T&gt; (System.Linq.Enumerable class). </p><br><p>  In this case, the Queryable version of Any () probably works even more optimally than the Queryable check <em>Count () == 0</em> . </p><br><p>  To call the required Queryable versions of Any () or Count (), if we want to call our IsNullOrEmpty check, we need a new method with an IQueryable &lt;T&gt; input parameter. </p><br><p>  Thus, you need to create a third method: </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNullOrEmpty&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IQueryable&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || items.Count() == <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br><p>  or </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> IsNullOrEmpty&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IQueryable&lt;T&gt; items) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> items == <span class="hljs-literal"><span class="hljs-literal">null</span></span> || !items.Any(); }</code> </pre> <br><p>  As a result, in order to implement the correct for all cases (for all?) Simple null-safe checking of collections for "emptiness", we had to do a little research and implement three extension methods. </p><br><p>  And if at the initial stage you create only a part of the methods, for example, only the first two (these methods are not needed; you need to make food features), then you might get this: </p><br><ul><li>  As soon as these methods appeared, they begin to be used in the grocery code. </li><li>  At some point, calls to Enumerable versions of IsNullOrEmpty will penetrate the code for working with ORM, and these calls will definitely not work optimally. </li><li>  What to do next?  Add Queryable versions of methods and rebuild a project?  (We add only new extension methods, do not touch the product code - after reassembly, switching to the necessary methods will occur automatically.) This will lead to the need for regression testing of the entire product. </li></ul><br><p>  For the same reason, all these methods should be implemented in one assembly and one namespace (possible in different classes, for example, EnumerableExtensions and QueryableExtensions), so that if you accidentally disable the namespace or assembly, we do not return to the situation when IQueryable &lt;T&gt; -collections work using ordinary Enumerable extensions. </p><br><p>  In my opinion, the abundance of such extensions in almost every project indicates a lack of development of the standard library and the platform model as a whole. </p><br><p>  Part of the problems would be automatically eliminated if there was support for Not Nullability in the platform, the other part was the presence in the standard library of a larger number of extensions taking into account a wider range of cases for working with standard data types. </p><br><p>  Moreover, they are implemented in a modern way - in the form of extensions using generalizations (Generics). </p><br><p>  Additionally we will talk about this in the next article. </p><br><p>  PS What is interesting, if you look at Kotlin and its standard library, during the development of which the experience of other languages ‚Äã‚Äãwas clearly studied, first of all, in my opinion - Java, C # and Ruby, then you can easily find out these things - Not Nullability and abundance of extensions, in the presence of which there is no need to add your own ‚Äúbicycle‚Äù microblib implementation for working with standard types. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/349852/">https://habr.com/ru/post/349852/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349836/index.html">Understanding Dependencies</a></li>
<li><a href="../349838/index.html">The story of the internet in Germany and the undocumented features of Juniper SRX</a></li>
<li><a href="../349840/index.html">iPaaS - cloud ESB ... or not?</a></li>
<li><a href="../349842/index.html">Check Point Technical Support (TAC). Quick Start Guide</a></li>
<li><a href="../349844/index.html">Microsatellites for Earth Remote Sensing</a></li>
<li><a href="../349854/index.html">Migrate API and what it eat. On the example of the migration of the forum Drupal 7. Part 1</a></li>
<li><a href="../349858/index.html">How JS Works: Service Workers</a></li>
<li><a href="../349860/index.html">Regular expressions in Python from simple to complex. Details, examples, pictures, exercises</a></li>
<li><a href="../349862/index.html">Application Release Automation: Release Management Automation "Goes to the Cloud"</a></li>
<li><a href="../349864/index.html">Natasha - a library for extracting structured information from texts in Russian</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>