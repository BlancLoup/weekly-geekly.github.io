<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Failover DHCP. Unsuccessful test history</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings, habrozhiteli. 

 After my favorite old ‚Äúserver‚Äù burned down the power supply, which led to idle time in half a day, I once again thought ab...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Failover DHCP. Unsuccessful test history</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/cea/158/c1d/cea158c1d25a562cccac72c11b3789ac.jpg" alt="image"><br><br>  Greetings, habrozhiteli. <br><br>  After my favorite old ‚Äúserver‚Äù burned down the power supply, which led to idle time in half a day, I once again thought about fault-tolerant DHCP. <br>  Of course, many now say that the cluster taxis.  I even agree with the fact that now the cluster organization is simpler, because  there is no need for a SAN or the purchase of an external hard drive, it is quite suitable for us, built, for example, on FreeNAS with a configured iSCSI connector ... But: <br>  1. I do not have a platform for us (as well as the need for it). <br>  2. I have no desire to raise the cluster exclusively for DHCP, but for the other needs I do not need a cluster yet. <br><a name="habracut"></a><br>  Having glanced in MSDN (where without it), I saw that the second way offered by small for the organization of a fail-safe configuration, setup of 2 servers by the principle 80/20, i.e.  the first server will serve 80% of the workspace, the second the remaining 20%.  It is tempting, but (I like to list everything point by point): <br>  1. Such an organization will not allow the full use of DHCP functionality (for example, restricting access to a proxy server by IP). <br>  2. It is necessary to maintain 2 servers, which requires more man-hours. <br>  3. In networks with a high range utilization rate, the remaining 20% ‚Äã‚Äãmay simply not be enough to meet the needs of all customers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, and we, after all, are ‚Äúnot made with a finger,‚Äù savvy for what? <br><br>  So I thought to myself and gave birth to a ‚Äúbrilliant‚Äù thought.  And what if you create a DFS resource, connect 2 servers to it and host the DHCP configuration storage on it.  No sooner said than done. <br>  2 servers are raised on a virtual platform, a domain is configured, replication is configured, a resource is created and loop replication is started between 2 linked servers.  DHCP is raised and rebuilt to the appropriate resource.  Hurray, the first server is running.  It's time to test. <br>  We stop the first server, almost instantly there is a replication of data between resources, go to the second one, start the service and experience the first surge of enthusiasm - it works! <br>  Half done.  We stop the backup, start the first one, create a new reservation and brutally shut down the main server.  Moving on to the second, we are launching the service, and the first feeling of happiness is replaced by a bewilderment, if not to say ‚Äústronger‚Äù ... <br>  Yes, DHCP does not start, is turned off and in every way swears at the log files and the database (it was necessary to read MSDN more carefully, this problem is described in the section on clusters). <br>  <b>The result</b> - a backup "server", near which you need to run half a day to start it to work.  Moreover, it will be completely absent any changes that occurred after stopping the service. <br><br>  But the idle mind does not stop there. <br>  As you know, the server on timeout produces backup of the entire database (by default, every 60 minutes), therefore you can move only the backup folder to DFS and ‚ÄúI will be happy‚Äù. <br>  Reconfiguration took 10 minutes.  Testing - an extra half day. <br>  The result is again pitiable.  Backups are made and DFS honestly transfers the available files to the backup server, but the system continues to hold their configuration file, without which backups lose all meaning. <br>  <b>The result</b> is a working DHCP, which can be started after the ‚Äúcrash‚Äù of the Wizard, but which lacks all the changes.  Those.  performance slightly above 0. <br><br>  The output of course was found.  Banal, as always. <br>  Hourly, the script exports a DHCP dump to a text file: <br><br> <code>netsh dhcp server 192.168.0.1 dump &gt; C:\Dhcp\Dhcpcfg.dmp</code> <br> <br>  The file rests on the DFS-ball (somewhere without it, somehow I already intermarried with it after everything I experienced together), which is successfully replicated between both servers. <br>  At one hour on the second server, a dump is simply imported: <br><br> <code>netsh exec dhcpcfg.dmp</code> <br> <br>  and the server is ready to go. <br>  The only negative - different class names on systems with different languages.  But, it is simply ‚Äúcured‚Äù by the usual replacement in the file.  Besides, I have systems with the same languages, so the problem has bypassed me. <br><br>  Why am I all this ... <br>  Yes, just so that someone read and immediately decided for himself all without tests. <br>  Someone understood some things that did not understand before. <br>  Someone reread MSDN more attentively. <br>  And we all decided that a negative result is also a result, because  contains invaluable experience. <br><br>  <a href="http://technet.microsoft.com/ru-ru/library/cc778572%2528WS.10%2529.aspx">Actually, MSDN.</a> </div><p>Source: <a href="https://habr.com/ru/post/122411/">https://habr.com/ru/post/122411/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122397/index.html">Formula parser using recursive descent method</a></li>
<li><a href="../122400/index.html">Agile camp of strict regime or impressions of AgileCamp 2011 in Samara</a></li>
<li><a href="../122401/index.html">Quick access to 2D flash array</a></li>
<li><a href="../122404/index.html">Domen.RUS will unite the Russian-speaking population of the planet</a></li>
<li><a href="../122408/index.html">How to make friends with SQLite android with a language other than English</a></li>
<li><a href="../122412/index.html">Cloud services "Cloud hosting". Interviews with service providers</a></li>
<li><a href="../122414/index.html">Personal experience of creating a reference information center based on Kiosk (or terminal) with a touch panel</a></li>
<li><a href="../122416/index.html">In England, arrested a 19-year-old suspect in the LulzSec case</a></li>
<li><a href="../122418/index.html">The world's largest directory of sites Open Directory Project (dmoz) moved to Creative Commons Attribution</a></li>
<li><a href="../122419/index.html">Adobe added iPhone and iPad support in Flash Builder and Flex framework</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>