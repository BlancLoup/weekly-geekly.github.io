<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automatic vectorization of satellite images: one model - the first two places</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 


 In this article I want to share with you the story of how the same model architecture brought two victories in machine learning competition...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automatic vectorization of satellite images: one model - the first two places</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/lk/pc/eh/lkpceht--pzfrbydqqsgc3ocauq.png" alt="image"></p><br><p>  Hello! </p><br><p>  In this article I want to share with you the story of how the same model architecture brought two victories in machine learning competitions on the topcoder platform at once with a month interval. </p><br><p>  The following competitions will be discussed: </p><br><ul><li>  <a href="https://goo.gl/hnV1JJ">Urban 3d mapper</a> - search houses on satellite imagery.  The competition lasted 2 months, there were 54 participants and five prizes. </li><li>  <a href="https://goo.gl/MmTkcz">Spacenet: road detection challenge</a> - search for a graph of roads.  The decision was also given 2 months, including 33 participants and five prize positions. </li></ul><br><p>  The article describes the general approaches to solving such problems and the peculiarities of implementation for specific contests. </p><br><p>  For comfortable reading of the article, it is desirable to have a basic knowledge of convolutional neural networks and their training. </p><a name="habracut"></a><br><p>  <strong>A little background</strong> </p><br><p>  Last year, after watching several machine-training sessions, I had the idea to participate in competitions.  My first contest ended with an unexpectedly high result for me, which added even more confidence and motivation.  So, I quickly became interested in competitive machine learning, especially image processing tasks. </p><br><p>  The first for me was a competition for counting sea lions in the Aleutian Islands.  At that time, my knowledge was only enough to take other people's decisions as a basis, to understand them and try to improve them.  This is how I recommend doing to anyone who wants to learn something and / or enter the competition.  Reading books until blue spots without the practical use of knowledge is a bad idea.  Thus, I trained the detector, which worked very well, and brought me the 13th place out of 385 participants, to which I was incredibly pleased.  You can read more about the task <a href="https://habrahabr.ru/company/ods/blog/337548/">in the next post by Artem</a> . </p><br><p>  The next was a competition for the classical classification of satellite images, in which I became acquainted with classical machine learning and many different architectures of neural networks.  This time we worked in a team and finished in 7 positions out of 900 teams.  <a href="https://habrahabr.ru/post/335786/">Article based on the competition</a> . </p><br><p>  After that, I was ready to dig deeper and engage in more serious research, which played a role in my first victory in the machine learning competition - Carvana image segmentation challenge.  You can read more about the decision <a href="http://blog.kaggle.com/2017/12/22/carvana-image-masking-first-place-interview/">in our interview in a blog post on kaggle</a> .  (And there is also a link to the source code) </p><br><p>  <strong>A few words about sites and competitive machine learning</strong> </p><br><p>  The leader among the platforms for the competition for machine learning is kaggle.  But there are other platforms on which equally interesting contests take place with good prizes.  In my case, both competitions were held on the topcoder platform.  The differences between the platforms can be the subject of a long discussion, but now I want to focus your attention on some entertaining features that deserve special attention. </p><br><ul><li><p>  First, the time constraints on learning patterns and prediction.  For Urban 3d - 7 days for training at p2.xlarge and 8 hours for prediction on the same instance.  For Spacenet: road detection, a decent car with a 4 titan xp was allocated to the training, but there were similar limitations for the prediction.  In my opinion, these are great limitations that allow you to apply the solutions to problems in real conditions, unlike many solutions that are on the top of kaggle.  For example, to reproduce our solution in the competition Carvana image segmentation, you need either 20 GPUs and a week of time, as we did, or one Titan X and 90 days.  Of course, it is impossible to apply in practice.  Even the Carpathians <a href="https://twitter.com/karpathy/status/913619934575390720">agree with me</a> . </p><br></li><li>  Secondly, at the end of the competition, to verify the decision, the organizers ask all of the top 10 public leaders to arrange the code in a docker container and hand over the containers.  This is a controversial point, since the best and simplest solution can not get into the top places, but leave the competition customer.  However, this completely eliminates cheating, which means better models come to victory more often. </li></ul><br><p>  Due to the fact that the topcoder platform is not so well-known and convenient, and also because of these restrictions, the number of participants in the competition is not very large, but there are motivated professionals with whom you can compete for one place. </p><br><p>  <strong>Setting goals</strong> </p><br><p>  The task of <strong>Urban 3d</strong> was to segment roofs of houses, at first glance, the classical task of semantic segmentation.  But in fact, the task was for instance segmentation, that is, houses standing nearby should be defined as separate elements.  And the metric was heavily penalized for "sticky houses".  The metric was as follows: </p><br><p>  We take all the found connected components and for each of them we look for in the markup the component with which the largest Jacquard index (intersection over union, the ratio of the intersection to the union), and if <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>I</mi><mi>O</mi><mi>U</mi><mo>&amp;gt;</mo><mn>0.45</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="11.96ex" height="2.057ex" viewBox="0 -780.1 5149.6 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-49" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-4F" x="504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-55" x="1268" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-3E" x="2313" y="0"></use><g transform="translate(3369,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-34" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-35" x="1279" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>I</mi><mi>O</mi><mi>U</mi><mo>&gt;</mo><mn>0.45</mn></math></span></span><script type="math/tex" id="MathJax-Element-1"> IOU> 0.45 </script>  , the component is written to <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.806ex" height="2.419ex" viewBox="0 -780.1 1208 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-70" x="704" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> Tp </script>  (true positive).  All components for which no matching is found are written to <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mi>P</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.486ex" height="2.057ex" viewBox="0 -780.1 1501 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="749" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> FP </script>  .  All components in the markup for which no components were found in the prediction are written in <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.135ex" height="2.057ex" viewBox="0 -780.1 1350 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="749" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> Fn </script>  . </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>T</mi><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mo stretchy=&quot;false&quot;>(</mo><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="29.262ex" height="2.66ex" viewBox="0 -832 12599 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="751" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="1203" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="1669" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="2103" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="2448" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="2918" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="3263" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="3749" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-3D" x="4627" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="5683" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="6388" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2F" x="7139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-28" x="7640" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="8029" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="8734" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="9707" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="10708" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="11458" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-29" x="12209" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>=</mo><mi>T</mi><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>P</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-5"> Precision = TP / (TP + FP) </script></p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo>=</mo><mi>T</mi><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mo stretchy=&quot;false&quot;>(</mo><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="25.949ex" height="2.66ex" viewBox="0 -832 11172.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="1226" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-61" x="1659" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="2189" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="2487" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-3D" x="3063" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="4120" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="4824" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2F" x="5576" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-28" x="6076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="6466" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="7170" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="8144" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="9145" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-4E" x="9894" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-29" x="10783" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo>=</mo><mi>T</mi><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mi>T</mi><mi>P</mi><mo>+</mo><mi>F</mi><mi>N</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> Recall = TP / (TP + FN) </script></p><br><p>  And the final metric is: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>F</mi><msub><mtext>&amp;#xA0;</mtext><mi>s</mi></msub><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>=</mo><mn>2</mn><mo>&amp;#x2217;</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>&amp;#x2217;</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><mo stretchy=&quot;false&quot;>(</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="55.2ex" height="2.66ex" viewBox="0 -832 23766.4 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="0" y="0"></use><g transform="translate(749,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="1431" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="1864" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="2350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="2801" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-3D" x="3546" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-32" x="4602" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2217" x="5325" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="6047" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="6799" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="7250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="7717" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="8150" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="8496" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="8965" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="9311" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="9796" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2217" x="10619" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-52" x="11342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="12101" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="12568" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-61" x="13001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="13531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="13829" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2F" x="14128" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-28" x="14628" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="15018" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="15769" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="16221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="16687" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="17121" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="17466" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="17936" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="18281" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="18767" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="19590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-52" x="20590" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="21350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="21816" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-61" x="22250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="22779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6C" x="23078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-29" x="23376" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>F</mi><msub><mtext>&nbsp;</mtext><mi>s</mi></msub><mi>c</mi><mi>o</mi><mi>r</mi><mi>e</mi><mo>=</mo><mn>2</mn><mo>‚àó</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>‚àó</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mi>P</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>i</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>+</mo><mi>R</mi><mi>e</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>l</mi><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-7"> F \ _score = 2 * Precision * Recall / (Precision + Recall) </script></p><br><p>  It turns out that for each stuck together building we get <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mo>+</mo><mn>2</mn><mi>F</mi><mi>N</mi><mo>+</mo><mn>1</mn><mi>F</mi><mi>P</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="14.264ex" height="2.178ex" viewBox="0 -780.1 6141.4 937.7" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-32" x="778" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="1279" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-4E" x="2028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="3139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-31" x="4139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="4640" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="5389" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo><mn>2</mn><mi>F</mi><mi>N</mi><mo>+</mo><mn>1</mn><mi>F</mi><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-8"> + 2 FN +1 FP </script>  if this building in markup consists of two components and we are not lucky to exceed the threshold of 0.45 for none of them.  (hereinafter in the picture in blue <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.135ex" height="2.057ex" viewBox="0 -780.1 1350 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="749" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-9"> Fn </script>  white <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>T</mi><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.806ex" height="2.419ex" viewBox="0 -780.1 1208 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-54" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-70" x="704" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>T</mi><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-10"> Tp </script>  yellow <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi><mi>P</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.486ex" height="2.057ex" viewBox="0 -780.1 1501 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-46" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-50" x="749" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi><mi>P</mi></math></span></span><script type="math/tex" id="MathJax-Element-11"> FP </script>  ) </p><br><p><img src="https://habrastorage.org/webt/75/7a/dn/757adnhitowllhkymfxuouz_uh0.png" alt="image"></p><br><p> The task of <strong>Spacenet: road detection</strong> looked much more interesting.  Customers came up with a metric that takes into account the connectivity of the resulting graph of roads, implemented it in java and python, described in detail in medium.  [ <a href="https://medium.com/the-downlinq/introducing-the-spacenet-road-detection-and-routing-challenge-and-dataset-7604de39b779">1</a> ], [ <a href="https://medium.com/the-downlinq/spacenet-road-detection-and-routing-challenge-part-i-d4f59d55bfce">2</a> ], [ <a href="https://medium.com/the-downlinq/spacenet-road-detection-and-routing-challenge-part-ii-apls-implementation-92acd86f4094">3</a> ].  This metric was intrigued, I wanted to apply not only the skills of learning networks, but also classical computer vision and graph theory. </p><br><p><img src="https://habrastorage.org/webt/xt/wa/h8/xtwah8kk4rkzbkrxg_r--zzjeso.png" alt="image"></p><br><p>  As a result, it turned out that it is very unstable and sensitive to errors. </p><br><p>  <strong>Urban 3d - house recognition on satellite imagery</strong> </p><br><p>  First, a few words about markup, which could cause resentment.  It was made poorly - often at home in the markup were where they actually did not appear.  But this was soon reported to the organizers, and they promised to correct the mistakes in the final test.  In fact, the problem markup is found in many tasks, so I didn‚Äôt fight it in the training set, the network should cope on its own.  However, if there is an opportunity to correct something, it is better to do it. </p><br><p><img src="https://habrastorage.org/webt/gm/ds/qv/gmdsqvkig21me2v_cpsnbynyjoy.png" alt="image"></p><br><p>  We now turn to the input data of the problem: </p><br><ul><li>  RGB images; </li><li>  DTM (digital terrain model); </li><li>  DSM (digital surface model). </li></ul><br><p>  If everything is clear with RGB, then DTM / DSM is something new.  Roughly speaking, DSM is the elevation map of all objects on earth, and DTM is the elevation map without objects.  From satellite images, they are obtained in very poor resolution, but the data is new and correlates with RGB (standard three-color image) rather weakly, so they had to be used.  Therefore, the fourth channel in the network included (DSM-DTM) / 9.  Subtract them to get the height of the objects and remove the height where the land is.  Kostantu can be obtained in different ways, for example, take the 98th percentile (although I just took the average maximum).  It is needed to bring the input in the same order as the RGB (nominated in the interval 0-1), so that not one of the channels dominates in the first convolution. </p><br><p>  The first convolution deserves special attention.  The fact is that in the past mainly self-made Unet-like architectures were used, which do not use pre-trained encoders.  Read more about them <a href="https://habrahabr.ru/company/avito/blog/325632/">here</a> and <a href="https://habrahabr.ru/company/ods/blog/325096/">here</a> .  But after the Carvana competition, everything changed.  The architectures, in which the encoder is a network pretended for imagenet, appeared on the scene, you can read about it in <a href="https://arxiv.org/abs/1801.05746">detail</a> in <a href="https://arxiv.org/abs/1801.05746">ternausnet</a> .  Also after this competition, the <a href="https://arxiv.org/abs/1707.03718">Linknet</a> network with various resnet-like encoders became popular.  That Linknet was refined and taken as the basis for solving the problem. </p><br><p>  Encoder made resnet34, as it has great expressiveness and speed, and also requires a bit of video memory.  I tried other encoders, but with resnet34 convergence was better.  A review of neural network architectures is beyond the scope of this article, but you can read about them in the following <a href="https://habrahabr.ru/company/mailru/blog/311706/">good review</a> . </p><br><p>  A sequence of blocks was used as a decoder: 3x3 convolution, upsampling, 3x3 convolution.  Hereinafter, ‚Äúconvolution 3x3‚Äù is a convolution operation with a 3x3 yard, pitch (stride) 1 and padding 1. Experiments have shown that upsampling works no worse than transposed convolution (which also <a href="https://distill.pub/2016/deconv-checkerboard/">generate unwanted artifacts</a> ), but needs in a decreasing or incremental convolution of 1x1, which was on linknet, there is none at all, since the learning speed suited me.  At the 3x3 convolution input, the signs from the corresponding resnet layer come through a skip connection, connected via the depth channel to the output of the previous layer.  All this can be replaced with a simple operation +, since the inputs have the same dimension, sometimes I do. </p><br><p>  The final network diagram (after all convolutions, except the first and last - relu): </p><br><p><img src="https://habrastorage.org/webt/xd/3f/ud/xd3fudkt7vskszstemval7ej8ha.png" alt="image"></p><br><p>  Let's return to the first convolution.  Only 4 channels, but with the pre-encoder encoder, the input dimension along the channel axis is 3. It was possible to go along several paths.  Someone proposed to initialize with zeros, someone chose to rescale the available weights.  I chose a different way. </p><br><p>  To begin with, I taught 5 eras without 4 channels, as if warming up the weights of all the other layers.  Then he completely reinitialized the first layer and started feeding 4 channels to the input.  I did not change the learning rate and did not freeze the weight.  Of course, it was worth freezing the weights of all layers, except the first.  But this was a good convergence, and there was not enough time for additional experiments. </p><br><p>  As a loss function (loss), a well-proven bundle was chosen: <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>w</mi><mn>1</mn><mo>&amp;#x2217;</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>r</mi><mi>y</mi><msub><mtext>&amp;#xA0;</mtext><mi>c</mi></msub><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><msub><mtext>&amp;#xA0;</mtext><mi>e</mi></msub><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>y</mi><mo>+</mo><mi>w</mi><mn>2</mn><mo>&amp;#x2217;</mo><mo stretchy=&quot;false&quot;>(</mo><mn>1</mn><mo>&amp;#x2212;</mo><mi>d</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.629ex" height="2.66ex" viewBox="0 -832 18784.7 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-77" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-31" x="716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2217" x="1439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-62" x="2161" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="2591" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="2936" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-61" x="3537" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="4066" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-79" x="4518" y="0"></use><g transform="translate(5015,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="5672" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="6123" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="6609" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-73" x="7078" y="0"></use><g transform="translate(7548,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6E" x="8228" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-74" x="8828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-72" x="9190" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-6F" x="9641" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-70" x="10127" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-79" x="10630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2B" x="11350" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-77" x="12351" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-32" x="13067" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2217" x="13790" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-28" x="14513" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-31" x="14902" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-2212" x="15625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-64" x="16626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-69" x="17149" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-63" x="17495" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMATHI-65" x="17928" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/348756/&amp;xid=25657,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgiZrfW6DrGzR_jPrjn2uqgQ7lhSA#MJMAIN-29" x="18395" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>w</mi><mn>1</mn><mo>‚àó</mo><mi>b</mi><mi>i</mi><mi>n</mi><mi>a</mi><mi>r</mi><mi>y</mi><msub><mtext>&nbsp;</mtext><mi>c</mi></msub><mi>r</mi><mi>o</mi><mi>s</mi><mi>s</mi><msub><mtext>&nbsp;</mtext><mi>e</mi></msub><mi>n</mi><mi>t</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>y</mi><mo>+</mo><mi>w</mi><mn>2</mn><mo>‚àó</mo><mo stretchy="false">(</mo><mn>1</mn><mo>‚àí</mo><mi>d</mi><mi>i</mi><mi>c</mi><mi>e</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-12"> w1 * binary \ _cross \ _entropy + w2 * (1-dice) </script>  .  In this competition, the weights were 0.5 / 0.5, but in the last two epochs, slightly more weight was given in bce.  Visually, this slightly improved the result and the separability of the houses, about which the narration will continue.  Usually, the dice coefficient tries to sharpen edges and give more confident predictions, and binary cross entropy holds it back. </p><br><p>  Now let us recall that we are solving the problem of instance segmentation, and when binarizing along the threshold most of the houses will merge.  Usually, where there is a lack of network abilities, tricks from classical computer vision are used, which was eventually used in this task.  It was noticed that the network almost always predicts closer to the center of the house with a very high probability, and closer to the border its confidence falls. </p><br><p><img src="https://habrastorage.org/webt/1w/dg/ym/1wdgymnqg6jw-qutna8g1it_hpc.png" alt="image"></p><br><p>  But binarization on a high threshold will not give the desired result - at home they lose the effective area, and the metric is not very happy about it.  Therefore, binarization was carried out on two thresholds, with the support in the form of the <a href="https://docs.opencv.org/3.1.0/d3/db4/tutorial_py_watershed.html">watershed</a> algorithm.  The algorithm, as it were, pours out water from the seeds, which is distributed over the levels of the same values.  And where water from different seeds is found, a dividing line appears.  Pixels obtained by binarization on a higher threshold were the watershed sided, and on the lower threshold the separation space.  As a result, the area of ‚Äã‚Äãhouses was taken from a low threshold, and the separation - from a high.  All houses less than 100 pixels (about 3 by 3 meters) were also removed, since on average they had a not very high intersection with marking. </p><br><p>  <strong>As a result:</strong> one network for 4 folds (for correct validation on out of fold predictions), a resten34 pretreated encoder and an almost classical Unet-like decoder.  Easy post-processing of the result by the watershed algorithm, learning tricks and some luck. </p><br><p>  I came to the second position on the public leaderboard to the finish line, which was fine with me because of the uniform distribution of prizes (11-9-7).  On a private was a new city, and I was transferred to 1 place. </p><br><p>  <strong>Spacenet: road detection challenge - Road recognition and graph construction</strong> </p><br><p>  By tradition, let's start with markup and data.  Unfortunately, it was not without difficulties. <br>  The organizers promised quality markup, but still there were serious flaws that greatly influenced the metric.  For example, in the picture below, the highway lanes are not connected at the junction points, which immediately led to a 30% drop in the score, although in general the graph looks good.  Here and further, blue is the markup, yellow is the predicted graph. </p><br><p><img src="https://habrastorage.org/webt/gg/fe/y4/ggfey4bwocbj8je-nkyzx-qken4.png" alt="image"></p><br><p>  Now let's look at the data, which was very much in terms of volume, but not much in terms of meaning.  The fact is that the organizers laid out everything that they have - MUL, MUL-PAN, PAN, RGB-PAN.  I visually examined the data and decided to train only on RGB, because I did not find useful additional information in other channels.  After all, the simpler the data from the point of variance, the easier it is to teach the model to generalize to them.  RGB I normalized to mean min / max.  To build the masks, the organizers suggested rendering the roads from geojson to the images; nothing had to be changed here.  There were ideas on what to do with different widths of the road, depending on the type, but everything worked and so. </p><br><p>  All the data I fed my past network, without changing anything in the architecture.  At the basic postprocessing (about which later), the day after the start of participation in the competition, I received 610 / 620k (~ 6-8 places at the end of the competition).  As usual, having banished training with different hyper parameters several times - it increased the number of training epochs and set weights 0.8 / 0.2 for loss.  This gave the second base mark of 640k, only post-processing gave further improvements. </p><br><p>  Building a graph from a pixel probability map is a nontrivial task.  Fortunately, on the Internet, the very first link to google found the sknw package, which I managed to adapt to my needs.  He receives a skeleton at the input, and at the output produces a multigraph - very convenient.  It only remained to add vertices to where the road changes its direction, for which the Douglas-Pecker algorithm was used, or rather its implementation on opencv.  Also, roads along the edges of the picture had a strong influence on skor.  The fact is that if there is a part of the road on the edge of the picture, the algorithm will consider it expensive, but there may not be a road if the width of the real road is more than 2 times. </p><br><p><img src="https://habrastorage.org/webt/cu/oi/td/cuoitdzl8rgvf3brwqz_ylc2n70.png" alt="image"></p><br><p>  It would be correct to use neighboring tiles for this, but this created certain difficulties, since it was not clear whether they would be available at the testing stage.  Plus, my lead in LB was already huge, so I took the path of least resistance and just left cutting off all the roads that are less than 2 pixels, which on average worked well.  In addition, there were small improvements of the graph - remove short terminal edges, connect the edges, which lie almost in the same straight line and are close to each other, but all this did not give a significant increase in the metric. </p><br><p>  <strong>Total:</strong> only RGB data (the most common in the world, that is, the solution should be easily scaled to other sources), the same network, the same tricks, only serious post-processing was added, which involved building a skeleton using a binary mask, transforming the skeleton into a graph, projecting the graph in segments, working with borders and some not very useful tricks. </p><br><p>  <strong>About validation</strong> </p><br><p>  In all competitions, it is very important to validate correctly so that in the end there is no insult.  The fact is that simply achieving the highest possible result on a leaderboard is not always enough - it is also necessary that the solution be stable and work well not only on data from the public leaderboard, but also on others - which are hidden from the developer and even get the metric value on them does not seem possible.  For validation, I use the standard k-fold cross validation technique.  It lies in the fact that the training data set is divided into k parts (I have k = 4) and k models are trained as follows: each model learns on k-1 folds, and the remaining fold goes into validation, that is, we predict on those data that the model did not see.  As a result, we get k sets of predictions that cover the entire set of training data, but none of these data has been seen by any model.  These predictions are called OOF (out of fold predictions), you can select thresholds and experiment on them.  In addition, they often leave a small part of the data in order to carry out a final check on them.  But in the competition will be enough and LB. </p><br><p>  <strong>Instead of conclusion</strong> </p><br><p>  And now a little action and personal experiences.  6 hours before the end of the Spacenet: road detection challenge competition, the participant from 3-4 places, the gap from which was very large and the last days giveaways did not bring success, was able to rise to the second place.  After another three hours, he was the first. </p><br><p>  In addition, at the end of the competition, colleagues from neighboring sites reported a bug in the data set, which consisted in the fact that the multispectral data was slightly incomplete, and as a result, those who studied at RGB received undeservedly better results on the leaderboard, in the test such promised to fix it.  Therefore, I expected to fall to several places below.  With the announcement of the results, it was strongly delayed, since the models were retrained for a long time, it took the organizers more than a month.  Now you imagine that joy and surprise when I discovered my name in the first line of LB. </p><br><p>  In the end, I would like to express my gratitude to my colleagues in the competition (especially <a href="https://www.kaggle.com/selimsef">Selim</a> and <a href="https://www.kaggle.com/victorsd">Viktor</a> ) for sound competition and good advice, as well as to all those who helped me edit the text. </p><br><p>  Thanks to all who read, and good luck in the competition! </p><br><p>  PS: spacenet organizers have posted the <a href="https://github.com/SpaceNetChallenge/RoadDetector/tree/master/albu-solution">code</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/348756/">https://habr.com/ru/post/348756/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348746/index.html">Issue # 10: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../348748/index.html">Programming Training: Finger Painting and Killing Zombies</a></li>
<li><a href="../348750/index.html">Open lesson on the topic ‚ÄúAudit of advertising campaigns in Yandex. Direct ¬ª</a></li>
<li><a href="../348752/index.html">How the virtual infrastructure will develop: 4 main trends</a></li>
<li><a href="../348754/index.html">Backblaze statistics, a scientific approach to analyzing drive reliability</a></li>
<li><a href="../348758/index.html">When the experience of the 25k + team is included in the lecture: how EPAM collaborates with universities in Belarus</a></li>
<li><a href="../348760/index.html">Shadow ban and what it eats</a></li>
<li><a href="../348766/index.html">Gesturizer: 3D-touch and gestures in iOS apps</a></li>
<li><a href="../348770/index.html">Richard Hamming: Chapter 1. Orientation</a></li>
<li><a href="../348772/index.html">Kivy is a small fruit with a great future.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>