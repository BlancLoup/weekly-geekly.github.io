<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Isolate the demons with systemd or ‚Äúyou don't need a docker for this!‚Äù</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I see how a fairly large number of people use container virtualization only to lock a potentially unsafe application inside the container. A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Isolate the demons with systemd or ‚Äúyou don't need a docker for this!‚Äù</h1><div class="post__text post__text-html js-mediator-article">  Recently, I see how a fairly large number of people use container virtualization only to lock a potentially unsafe application inside the container.  As a rule, Docker is used for this because of its prevalence, and they know nothing better.  Indeed, many demons initially run as root, and then either lower their privileges, or the master process spawns processing processes with lower privileges.  And there are those who work exclusively as root.  If a demon is found to have a vulnerability that allows you to access with maximum privileges, it will not be very pleasant to find intruders who have already downloaded all the data and left viruses. <br>  Containerization provided by Docker and other similar software really saves this problem, but also introduces new ones: you need to create a container for each daemon, take care of the integrity of changed files, update the base image, and the containers themselves are often based on different operating systems stored on disk, although you, in general, are not really needed.  What if you don‚Äôt need containers as such, in the Docker Hub the application is not built the way you want, and the version is outdated, SELinux and AppArmor seem too complicated, and you would like to run it in your environment, but using the same Is the isolation Docker uses? <br><br><h3>  Capabilities </h3> What is the difference between a regular user and root?  Why can root manage the network, load kernel modules, mount file systems, kill processes of any users, and the average user is deprived of such features?  It's all about the <a href="http://man7.org/linux/man-pages/man7/capabilities.7.html">capabilities</a> - a tool for managing privileges.  All these privileges are given to the user with UID 0 (i.e. root) by default, while the regular user does not have any of them.  Privileges can be both given and taken away.  For example, the usual ping command requires the creation of a RAW socket, which is impossible to do on behalf of a regular user.  Historically, a pid was set for the SUID flag, which simply ran the program on behalf of the superuser, but now all modern distributions set CAP_NET_RAW capability, which allows you to run ping from under any account. <br>  You can get a list of the file's installed capabilities using the <code>getcap</code> command from libcap. <pre> <code class="hljs dos">% getcap $(which <span class="hljs-built_in"><span class="hljs-built_in">ping</span></span>) /usr/bin/<span class="hljs-built_in"><span class="hljs-built_in">ping</span></span> = cap_net_raw+ep</code> </pre><br>  The <b>p</b> flag here means the <i>limit</i> , i.e.  the application has the ability to use the specified capability, <b>e</b> means <i>effective</i> - the application will use it, and there is also the <b>i</b> - <i>inheritable</i> flag, which makes it possible to save the list of capabilities when calling the <code>execve()</code> function. <br>  Capabilities can be set at the FS level, or just at a separate program flow.  It is impossible to receive a capability that was not available since launch, i.e.  privileges can only be lowered, but not increased. <br>  There are also security bits (Secure Bits), there are three of them: KEEP_CAPS allows you to save the capability when you call setuid, NO_SETUID_FIXUP disables the ability to reconfigure when you call setuid, and NOROOT prohibits issuing additional privileges when running suid programs. <a name="habracut"></a><br><br><h3>  Namespaces </h3>  The ability to put an application in your namespaces (namespaces) is another feature of the Linux kernel.  Separate namespaces can be set for: <br><ul><li>  File system </li><li>  UTS (hostname) </li><li>  System V IPC (interprocess communication) </li><li>  Network </li><li>  PID </li><li>  Of users </li></ul><br>  If we place the application, for example, in a separate network space, it will not be able to see our network adapters, which are visible from the host.  The same can be done with the file system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  systemd </h3>  Fortunately, systemd supports everything you need to isolate applications and differentiate rights. <br>  We will use these features, but first we will think a little about what rights our application needs. <br>  So, what are the demons?  There are those who do not need superuser rights in general, and they use them only to listen to a port below 1024. Such programs need only issue a CAP_NET_BIND_SERVICE capability that will allow them to listen to any ports without restrictions, and immediately launch them from an unprivileged user.  Set capability on a file is possible with the <code>setcap</code> command.  As an experimental ‚Äúservice‚Äù, we will have ncat from nmap, which will give out shell access to anyone who wants it ‚Äî you can‚Äôt think of anything worse: <br><pre> <code class="hljs bash">% sudo <span class="hljs-built_in"><span class="hljs-built_in">setcap</span></span> CAP_NET_BIND_SERVICE=ep /usr/bin/ncat % <span class="hljs-built_in"><span class="hljs-built_in">getcap</span></span> /usr/bin/ncat /usr/bin/ncat = cap_net_bind_service+ep</code> </pre><br>  Now we write the simplest systemd unit, which will run ncat with the necessary parameters on port 81 on behalf of the user nobody: <br><pre> <code class="hljs pgsql">[Unit] Description=Vuln [Service] <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=nobody ExecStart=/usr/bin/ncat <span class="hljs-comment"><span class="hljs-comment">--exec /bin/bash -l 81 --keep-open --allow ::1</span></span></code> </pre><br>  Save it in <code>/etc/systemd/system/vuln.service</code> and run the usual <b>sudo systemctl start vuln</b> . <br>  Connect to it: <br><pre> <code class="hljs matlab"><span class="hljs-comment"><span class="hljs-comment">% ncat ::1 81 whoami nobody</span></span></code> </pre><br>  Works great! <br>  It is time to protect our service, for this systemd has the following directives: <br><ul><li>  <b>CapabilityBoundingSet =</b> - manages capabilities.  Sets only those that were passed in this parameter, or vice versa, takes the transferred ones, if the first character is a tilde "~". </li><li>  <b>SecureBits =</b> - sets the security bits. </li><li>  <b>Capabilities =</b> - also manages the capabilities, but in such a way that the advantages that are specified in the file at the FS level, so practically useless, have an advantage. </li><li>  <b>ReadWriteDirectories =, ReadOnlyDirectories =, InaccessibleDirectories =</b> - control the file system namespace.  Remount filesystems inside the daemon namespace so that the specified directories are readable and writeable, read only, or inaccessible (become empty). </li><li>  <b>PrivateTmp =</b> - <b>remounts</b> / tmp and / var / tmp to its own tmpfs inside the namespace. </li><li>  <b>PrivateDevices =</b> - selects access to devices from / dev, leaving access only to standard devices, such as / dev / null, / dev / zero, / dev / random and others. </li><li>  <b>PrivateNetwork =</b> - creates an empty network namespace with a single lo interface. </li><li>  <b>ProtectSystem =</b> - mounts / usr and / boot in read-only mode, and when passing the argument ‚Äúfull‚Äù, does the same with / etc. </li><li>  <b>ProtectHome =</b> - makes the / home, / root and / run / user directories unavailable, or reminds them to read-only mode with the ‚Äúread-only‚Äù parameter </li><li>  <b>NoNewPrivileges =</b> - allows you to make sure that the application does not receive additional privileges.  According to the authors, more powerful than the corresponding capability. </li><li>  <b>SystemCallFilter =</b> - filters system calls using seccomp technology.  More on this later. </li></ul><br>  Let's rewrite our unit file using these options: <br><pre> <code class="hljs ruby">[Unit] Description=Vuln [Service] User=nobody ExecStart=<span class="hljs-regexp"><span class="hljs-regexp">/usr/bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ncat --exec /bin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/bash -l 81 --keep-open --allow ::1 CapabilityBoundingSet=CAP_NET_BIND_SERVICE InaccessibleDirectories=/sys</span></span> PrivateTmp=<span class="hljs-literal"><span class="hljs-literal">true</span></span> PrivateDevices=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ProtectHome=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ProtectSystem=full</code> </pre><br>  So, we gave our application one CAP_NET_BIND_SERVICE capability, created separate / tmp and / var / tmp, selected access to devices and home directories, remounted / usr, / boot and / etc to read-only mode, and blocked / sys, t .to.  a typical demon is unlikely to go in there, and all this is done on behalf of the user. <br>  It should be noted that CapabilityBoundingSet does not provide additional capabilities for even suid applications like su or sudo, so we cannot access on behalf of another user or root, even knowing their passwords, since  the kernel will not allow setuid and setgid calls: <br><pre> <code class="hljs mel">% ncat ::<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">81</span></span> <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> -c <span class="hljs-string"><span class="hljs-string">'import pty; pty.spawn("/bin/bash")'</span></span> #   pty,      sudo  su [nobody@valaptop /]$ sudo -i #  setuid()  setgid() sudo: unable to change to root gid: Operation not permitted sudo: unable to initialize policy plugin [nobody@valaptop /]$ ping #   capability cap_net_raw bash: /usr/sbin/ping: Operation not permitted [nobody@valaptop /]$ cd /home bash: cd: /home: Permission denied [nobody@valaptop /]$ <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> -lad /home d--------- <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">40</span></span> Nov <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-number"><span class="hljs-number">46</span></span> /home [nobody@valaptop tmp]$ <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span> -la /tmp total <span class="hljs-number"><span class="hljs-number">4</span></span> drwxrwxrwt <span class="hljs-number"><span class="hljs-number">2</span></span> root root <span class="hljs-number"><span class="hljs-number">40</span></span> Nov <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">00</span></span>:<span class="hljs-number"><span class="hljs-number">31</span></span> . drwxr-xr-x <span class="hljs-number"><span class="hljs-number">19</span></span> root root <span class="hljs-number"><span class="hljs-number">4096</span></span> Nov <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>:<span class="hljs-number"><span class="hljs-number">28</span></span> ..</code> </pre><br>  Consider the second type of daemons, those that run as root and lower their privileges.  This approach is used for many purposes: reading confidential files that are accessible only from the superuser (for example, a private key for using TLS by the web server), maintaining logs that will not be available if the non-root fork is compromised, and just applications that are arbitrary change UID (ssh-servers, ftp-servers).  If such programs are not isolated, then the worst thing that can happen is that the attacker will get full access on behalf of the superuser.  Although the lack of capabilities inherent in root make it almost an ordinary unprivileged user, root still remains root with a bunch of files belonging to it that it can read, so we need to additionally make sure that certain directories where the keys and Configuration files that should not be read: <br><pre> <code class="hljs objectivec">[Unit] Description=Vuln [Service] ExecStart=/usr/bin/ncat --exec /bin/bash -l <span class="hljs-number"><span class="hljs-number">81</span></span> --keep-open --allow ::<span class="hljs-number"><span class="hljs-number">1</span></span> CapabilityBoundingSet=<span class="hljs-built_in"><span class="hljs-built_in">CAP_NET_BIND_SERVICE</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CAP_SETUID</span></span> <span class="hljs-built_in"><span class="hljs-built_in">CAP_SETGID</span></span> NoNewPrivileges=yes InaccessibleDirectories=/sys InaccessibleDirectories=/etc/openvpn InaccessibleDirectories=/etc/strongswan InaccessibleDirectories=/etc/nginx ReadOnlyDirectories=/proc PrivateTmp=<span class="hljs-literal"><span class="hljs-literal">true</span></span> PrivateDevices=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ProtectHome=<span class="hljs-literal"><span class="hljs-literal">true</span></span> ProtectSystem=full</code> </pre><br>  Here we added the CAP_SETUID capability and CAP_SETGID to allow our daemon to lower privileges, use NoNewPrivileges so that it cannot improve its capabilities, block access to directories that it should not read, and allow access to / proc only for reading so that could not use sysctl.  You can also mount the entire root in read-only at once, and write permissions should be given only to the directories used by the program. <br>  You should separately verify the permissions of the <b>/ etc / shadow</b> file.  In modern distributions, it is not readable even by root, and the capability CAP_DAC_OVERRIDE is used to work with it, which allows you to ignore access rights. <br><pre> <code class="hljs pgsql">% ls -la /etc/shadow <span class="hljs-comment"><span class="hljs-comment">---------- 1 root root 1214  3 19:57 /etc/shadow</span></span></code> </pre><br>  Check our settings! <br><pre> <code class="hljs scala">python -c <span class="hljs-symbol"><span class="hljs-symbol">'import</span></span> pty; pty.spawn(<span class="hljs-string"><span class="hljs-string">"/bin/bash"</span></span>)' #   pty [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# whoami root [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# ping #   capability cap_net_raw bash: /usr/sbin/ping: <span class="hljs-type"><span class="hljs-type">Operation</span></span> not permitted [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# cat /etc/shadow #  <span class="hljs-type"><span class="hljs-type">CAP_DAC_OVERRIDE</span></span> cat: /etc/shadow: <span class="hljs-type"><span class="hljs-type">Permission</span></span> denied [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# cd /etc/openvpn bash: cd: /etc/openvpn: <span class="hljs-type"><span class="hljs-type">Permission</span></span> denied [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# /suid # <span class="hljs-type"><span class="hljs-type">SUID</span></span> shell [root<span class="hljs-meta"><span class="hljs-meta">@valaptop</span></span> /]# cat /etc/shadow #  -  shell,    cat: /etc/shadow: <span class="hljs-type"><span class="hljs-type">Permission</span></span> denied</code> </pre><br>  Unfortunately, systemd (so far) does not know how to work with the PID namespace, so our root daemon can kill other programs that run as root. <br>  In general, this can be done, the capabilities and namespace settings do a good job of isolating applications, but there is one more thing that would be great to configure. <br><br><h3>  seccomp </h3>  The seccomp technology prohibits the program from making certain system calls, immediately killing it when trying to do it.  Although seccomp appeared a long time ago, in 2005, it began to be really used relatively recently, with the release of Chrome 20, vsftpd 3.0 and OpenSSH 6.0. <br>  There are two approaches to using seccomp: blacklist and whitelist.  Making a blacklist of potentially dangerous calls is noticeably simpler than white, so this approach is used more often.  The <a href="https://l3net.wordpress.com/projects/firejail/">firejail</a> project by default prohibits programs from running the following syscalls (the tilde includes the blacklist mode): <br><pre> <code class="hljs tex">SystemCallFilter=~mount umount2 ptrace kexec_load open_by_handle_at init_module <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>finit_module delete_module iopl ioperm swapon swapoff <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>syslog process_vm_readv process_vm_writev <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>sysfs_sysctl adjtimex clock_adjtime lookup_dcookie <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>perf_event_open fanotify_init kcmp add_key request_key <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>keyctl uselib acct modify_ldt pivot_root io_setup <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>io_destroy io_getevents io_submit io_cancel <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>remap_file_pages mbind get_mempolicy set_mempolicy <span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>migrate_pages move_pages vmsplice perf_event_open</code> </pre><br>  In systemd up to version 227 inclusive, there is a bug that requires setting NoNewPrivileges = true to use seccomp. <br>  The white list can be made as follows: <br><ol><li>  Run the required program under strace: <br><pre> <code class="hljs matlab"><span class="hljs-comment"><span class="hljs-comment">% strace -qcf nginx</span></span></code> </pre> <br>  We get a large table of syscalls: <br><pre> <code class="hljs perl"> <span class="hljs-keyword"><span class="hljs-keyword">time</span></span> seconds usecs/call calls errors <span class="hljs-keyword"><span class="hljs-keyword">syscall</span></span> ------ ----------- ----------- --------- --------- ---------------- <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">27</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-keyword"><span class="hljs-keyword">close</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">stat</span></span> ‚Ä¶ <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> set_tid_address <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span> epoll_ctl <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> set_robust_list <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">00</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>.<span class="hljs-number"><span class="hljs-number">000000</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> eventfd2</code> </pre> <br></li><li>  Rewrite them all, set as <b>SystemCallFilter</b> .  Most likely, your application will fall, because  strace did not find all the challenges.  We look, during the execution of which call the application ended, in the audit daemon logs: <br><pre> <code class="hljs scala"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">=SECCOMP</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">msg=audit</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">1446730375.597:7943724</span></span></span><span class="hljs-class">)</span></span>: auid=<span class="hljs-number"><span class="hljs-number">4294967295</span></span> uid=<span class="hljs-number"><span class="hljs-number">0</span></span> gid=<span class="hljs-number"><span class="hljs-number">0</span></span> ses=<span class="hljs-number"><span class="hljs-number">4294967295</span></span> pid=<span class="hljs-number"><span class="hljs-number">11915</span></span> comm=<span class="hljs-string"><span class="hljs-string">"(nginx)"</span></span> exe=<span class="hljs-string"><span class="hljs-string">"/usr/lib/systemd/systemd"</span></span> sig=<span class="hljs-number"><span class="hljs-number">31</span></span> arch=<span class="hljs-number"><span class="hljs-number">40000003</span></span> syscall=<span class="hljs-number"><span class="hljs-number">191</span></span> compat=<span class="hljs-number"><span class="hljs-number">0</span></span> ip=<span class="hljs-number"><span class="hljs-number">0xb75e5be8</span></span> code=<span class="hljs-number"><span class="hljs-number">0x0</span></span></code> </pre>  The syscall number we need is 191. Open the <a href="https://filippo.io/linux-syscall-table/">call table</a> and look for the name of this call by number. </li><li>  We add it to the allowed calls.  In case of a fall, we return to step 2. </li></ol><br><h3>  Tips &amp; Tricks </h3>  You can check the current privileges and the possibility of their enhancement with the <b>captest</b> command. <br>  <b>filecap</b> will give you a list of files with installed capabilities. <br>  With the help of <b>netcap,</b> you can get a list of running network programs that have at least one socket and one capability, and <b>pscap</b> will display not only network running software. <br>  It is not necessary to completely edit the systemd unit and track its changes during the update, but rather add the necessary directives through <b>systemctl edit</b> . </div><p>Source: <a href="https://habr.com/ru/post/270165/">https://habr.com/ru/post/270165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270153/index.html">XVB - Virtual PBX: Customization</a></li>
<li><a href="../270155/index.html">We write the simplest plugin for ReSharper</a></li>
<li><a href="../270159/index.html">Significance of SPF</a></li>
<li><a href="../270161/index.html">Plugin for gulp - collect files in pieces</a></li>
<li><a href="../270163/index.html">As we for the first time in Ukraine held a security event on a grand scale</a></li>
<li><a href="../270167/index.html">Overview of the first elastic data warehouse Snowflake Elastic Data Warehouse</a></li>
<li><a href="../270169/index.html">Data ONTAP 8.3 ADP: FlashPool StoragePools</a></li>
<li><a href="../270171/index.html">Product Design Digest October 2015</a></li>
<li><a href="../270173/index.html">AST analysis using patterns</a></li>
<li><a href="../270175/index.html">Microsoft will refuse to support digital certificates based on SHA-1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>