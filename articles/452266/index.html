<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Serverless racks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Serverless is not about the physical absence of servers. This is not a "killer" of containers and not a passing trend. This is a new approach to build...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Serverless racks</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/jb/40/f2/jb40f22sdsdaapg5pvd_wlcj81w.png"></div><br>  Serverless is not about the physical absence of servers.  This is not a "killer" of containers and not a passing trend.  This is a new approach to building systems in the cloud.  In today's article we will touch on the architecture of Serverless applications, let's see what role the Serverless services provider and open-source projects play.  In the end we will talk about the use of Serverless. <br><a name="habracut"></a><br>  I want to write the server part of the application (but at least an online store).  This can be a chat, and a service for publishing content, and a load balancer.  In any case, there will be a lot of headaches: you will have to prepare the infrastructure, determine the dependencies of the application, think about the host operating system.  Then you need to update the small components that do not affect the work of the rest of the monolith.  Well, let's not forget about scaling under load. <br><br>  But what if we take ephemeral containers in which the required dependencies are already preinstalled, and the containers themselves are isolated from each other and from the host OS?  We divide the monolith into microservices, each of which can be updated and scaled independently of the others.  By placing the code in such a container, I can run it on any infrastructure.  Already better. <br><br>  And if you do not want to customize the containers?  I do not want to think about scaling the application.  I do not want to pay for simple running containers, when the load on the service is minimal.  I want to write code.  Focus on business logic and bring products to market at the speed of light. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Such thoughts led me to serverless calculations.  Serverless in this case does <em>not</em> mean the <em>physical absence of servers, but the absence of a headache for infrastructure management.</em> <br><br>  The idea is that the application logic is broken down into independent functions.  They have an event structure.  Each of the functions performs one ‚Äúmicrotask‚Äù.  All that is required from the developer is to load the functions into the console provided by the cloud provider and correlate them with the event sources.  The code will be executed on request in an automatically prepared container, and I will pay only during the execution time. <br><br>  Let's see what the application development process will look like now. <br><br><h2>  From the developer‚Äôs side </h2><br>  Earlier we started talking about the application for the online store.  In the traditional approach, the main logic of the system is executed by a monolithic application.  And the server with the application is running constantly, even if there is no load. <br><br>  <strong>To go to serverless, we divide the application into microtasks.</strong>  Under each of them we write our own function.  Functions are independent of each other and do not store stateless information.  They can even be written in different languages.  If one of them "falls", the application will not stop entirely.  The architecture of the application will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/pm/1_/yj/pm1_yj5fd2s0f99zcirrpofsura.png" title="Serverless application architecture. From the diagram it is clear that additional resources will need to be connected (here it is the databases and the authentication server)"></div><br>  The division into functions in Serverless is similar to working with microservices.  But microservice can perform several tasks, and a function should ideally perform one.  Imagine that the task is to collect statistics and display at the user's request.  In the microservice approach, the task is performed by one service with two entry points: for writing and for reading.  In serverless calculations, these will be two different functions that are not related to each other.  The developer saves computational resources, if, for example, statistics are updated more often than unloaded. <br><br>  Serverless functions must be performed within a short timeout (timeout), which is determined by the service provider.  For example, for AWS timeout is 15 minutes.  This means that the long-lived functions (long-lived) will have to be changed to meet the requirements - this is how Serverless differs from other technologies that are popular today (containers and Platform as a Service). <br><br>  <strong>We assign an event to each function.</strong>  An event is a trigger for an action: <br><div class="scrollable-table"><table><tbody><tr><td>  <strong>Event</strong> </td><td>  <strong>The action that the function performs</strong> </td></tr><tr><td>  In the repository uploaded a picture of the goods. </td><td>  Compress image and upload to directory </td></tr><tr><td>  The database has updated the address of the physical store </td><td>  Load new location in maps </td></tr><tr><td>  Customer pays for goods </td><td>  Start Payment Processing </td></tr></tbody></table></div>  Events can be HTTP requests, streaming data, message queues, and so on.  Sources of events - is the change or the appearance of data.  In addition, the functions can be run on a timer. <br><br>  The architecture worked, and the application almost became serverless.  Next we go to the service provider. <br><br><h2>  From the provider </h2><br>  Cloudless computing is usually offered by cloud providers.  Different names are called: Azure Functions, AWS Lambda, Google Cloud Functions, IBM Cloud Functions. <br><br>  We will use the service through the console or personal account of the provider.  Function codes can be downloaded in one of the following ways: <br><br><ul><li>  write code in the embedded editors via the web console, </li><li>  Download the archive with the code </li><li>  work with public or private git-repositories. </li></ul><br>  Here we set up the events that call the function.  Different providers may have different event sets. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/iv/qc/f2/ivqcf25p7y6nha_iduzvjursray.png" title="Google Cloud Platform Console interface"></div><br><br>  The provider built and automated Function as a Service (FaaS) system on its infrastructure: <br><br><ol><li>  The code of functions gets to storage on the side of the provider. </li><li>  When an event occurs, containers with a prepared environment are automatically deployed on the server.  Each function instance has its own isolated container. </li><li>  From the storage function is sent to the container, calculated, gives the result. </li><li>  The number of parallel events is growing - the number of containers is growing.  The system automatically scales.  If users do not access the feature, it will be inactive. </li><li>  The provider sets the idle time of the containers - if during this time the functions do not appear in the container, it is destroyed. </li></ol><br>  This way we get Serverless out of the box.  We will pay for the service according to the pay-as-you-go model and only for the functions that are used, and only for the time when they were used. <br><br>  To familiarize developers with the service, providers offer up to 12 months of free testing, but limit the total computing time, the number of requests per month, money or consumed power. <br><br>  The main advantage of working with the provider is the ability to not worry about the infrastructure (servers, virtual machines, containers).  For its part, the provider can implement FaaS both on its own developments, and using open-source tools.  We will talk about them further. <br><br><h2>  From the open source side </h2><br>  For the past couple of years, the open-source community has been actively working on Serverless tools.  Including the contribution of the largest market players to the development of serverless platforms: <br><br><ul><li>  <strong>Google</strong> offers its own open-source tool to <a href="https://cloud.google.com/knative/" rel="nofollow noopener noreferrer">developers</a> - <a href="https://cloud.google.com/knative/" rel="nofollow noopener noreferrer">Knative</a> .  IBM, RedHat, Pivotal and SAP participated in its development; </li><li>  <strong>IBM</strong> worked on the OpenWhisk Serverless platform, which then became the Apache Foundation project; </li><li>  <strong>Microsoft</strong> partially opened the <a href="https://azure.microsoft.com/en-us/services/functions/" rel="nofollow noopener noreferrer">Azure Functions</a> platform code. </li></ul><br>  Developments are underway in the direction of serverless frameworks.  <a href="https://kubeless.io/" rel="nofollow noopener noreferrer">Kubeless</a> and <a href="https://fission.io/" rel="nofollow noopener noreferrer">Fission are</a> deployed inside pre-prepared Kubernetes clusters, <a href="https://www.openfaas.com/" rel="nofollow noopener noreferrer">OpenFaaS</a> works with both Kubernetes and Docker Swarm.  The framework acts as a kind of controller - it prepares a runtime environment inside the cluster upon request, then starts the function there. <br><br>  The frameworks leave room for the configuration of the tool to fit your needs.  So, in Kubeless, the developer can configure the timeout of the function execution (the default value is 180 seconds).  Fission, in an attempt to solve the cold start problem, offers some of the containers to keep running all the time (although this entails the cost of idle resources).  And OpenFaaS offers a set of triggers for every taste and color: HTTP, Kafka, Redis, MQTT, Cron, AWS SQS, NATs and others. <br><br>  Getting started instructions can be found in the official framework documentation.  Working with them means having a bit more skills than working with the provider - at least the ability to run the Kubernetes cluster through the CLI.  At the maximum, include other open-source tools (for example, the queue manager Kafka). <br><br>  Regardless of whether we work with Serverless through a provider or using open-source, we will get a number of advantages and disadvantages of a Serverless approach. <br><br><h2>  In terms of advantages and disadvantages </h2><br>  Serverless develops ideas of container infrastructure and microservice approach, in which teams can work in a multilingual mode, without being tied to a single platform.  The construction of the system is simplified, and it becomes easier to correct errors.  Microservice architecture allows you to add new functionality to the system much faster than in the case of a monolithic application. <br><br>  <strong>Serverless cuts development time even further,</strong> allowing the developer to focus exclusively on the business logic of the application and writing code.  As a result, time to market development is reduced. <br><br>  <strong>Bonus we get automatic scaling under load,</strong> and pay only for the resources used and only at the time when they are used. <br><br>  Like any technology, Serverless has flaws. <br><br>  <em>For example, such a disadvantage can be a cold start time (on average up to 1 second for languages ‚Äã‚Äãsuch as JavaScript, Python, Go, Java, Ruby).</em> <br><br>  On the one hand, in fact, the time of a cold start depends on many variables: the language in which the function is written, the number of libraries, the amount of code, communication with additional resources (the same databases or authentication servers).  Since the developer controls these variables, he can reduce the start time.  But on the other hand, the developer cannot control the launch time of the container - it all depends on the provider. <br><br>  A cold start can turn warm when the function re-uses the container launched by the previous event.  This situation will arise in three cases: <br><br><ul><li>  if customers often use the service and the number of calls to the function grows; </li><li>  if the provider, platform or framework allows you to keep some containers running all the time; </li><li>  if the developer starts functions on a timer (say, every 3 minutes). </li></ul><br>  For many applications, a cold start is not a problem.  Here you need to build on the type and objectives of the service.  Delaying a start for a second is not always critical for a business application, but may become critical for medical services.  Probably, in this case the serverless approach will no longer work. <br><br>  <em>The next disadvantage of Serverless is the short lifetime of the function (timeout, for which the function should be executed).</em> <br><br>  But, if you have to work with long-lived tasks, you can use a hybrid architecture - to combine Serverless with another technology. <br><br>  <em>Not all systems will be able to work on a serverless scheme.</em> <br><br>  Some applications will still store data and status at run time.  Some architectures will remain monolithic, and some functions will be long-lived.  However (as was once cloud technology, and then containers), Serverless is a technology with a great future. <br><br>  In this vein, I would like to smoothly move on to the issue of using the Serverless approach. <br><br><h2>  Application side </h2><br>  For 2018, the percentage of use of Serverless has <a href="https://media.flexera.com/documents/rightscale-2019-state-of-the-cloud-report-from-flexera.pdf" rel="nofollow noopener noreferrer">increased by half</a> .  Among the companies that have already implemented technology in their services are the market giants like Twitter, PayPal, Netflix, T-Mobile, Coca-Cola.  At the same time, you need to understand that Serverless is not a panacea, but a tool for solving a certain range of tasks: <br><br><ul><li>  <strong>Cut down on simple resources.</strong>  No need to constantly keep a virtual machine for services to which there are few calls. </li><li>  <strong>On the fly process the data.</strong>  Compress pictures, cut out the background, change the video encoding, work with IoT sensors, perform mathematical operations. <br></li><li>  <strong>"Glue" among themselves other services.</strong>  Git-repository with internal programs, chat bot in Slack with Jira and with a calendar. </li><li>  <strong>Balance the load.</strong>  Here we will stop in more detail. </li></ul><br>  Suppose there is a service that comes to 50 people.  Under it is a virtual machine with a weak iron.  Periodically, the load on the service increases significantly.  Then weak iron fails. <br><br>  You can include a balancer in the system, which will distribute the load, say, to three virtual machines.  At this stage, we can not accurately predict the load, so we keep some amount of resources running ‚Äúin reserve‚Äù.  And overpay for idle time. <br><br>  In such a situation, we can optimize the system through a hybrid approach: after the load balancer, we leave one virtual machine and link to the Serverless Endpoint with functions.  If the load exceeds the threshold - the balancer starts instances of functions that take over part of the query processing. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/r6/xv/ew/r6xvewex6fwzcnjiaciro92xeuy.png" title="Hybrid Load Balancer Architecture"></div><br>  Thus, Serverless can be used where it is necessary not to frequently, but intensively process a large number of requests.  In this case, it is more advantageous to run several functions for 15 minutes than to keep a virtual machine or server all the time. <br><br>  With all the advantages of serverless computing, before implementation, it is first of all necessary to evaluate the application logic and understand what tasks Serverless can solve in a particular case. <br><br><h2>  Serverless and Selectel </h2><br>  At Selectel, we have already <a href="https://kb.selectel.ru/42078178.html%3Futm_source%3Dhabr.com%26amp%3Butm_medium%3Dreferral%26amp%3Butm_campaign%3DFunctions_Serverless_Article_170519" rel="noopener noreferrer">simplified working with Kubernetes</a> in a <a href="https://selectel.ru/services/cloud/vpc/%3Futm_source%3Dhabr.com%26utm_medium%3Dreferral%26utm_campaign%3DFunctions_Serverless_Article_170519" rel="noopener noreferrer">virtual private cloud</a> through our control panel.  Now we are building our own FaaS platform.  We want developers to solve their problems using Serverless through a convenient, flexible interface. <br><br>  If you have ideas about what an ideal FaaS platform should be and how you want to use Serverless in your projects, share them in the comments.  We will take into account your wishes when developing the platform. <br><br>  Materials used in the article: <br><br><ul><li>  <a href="https://www.rightscale.com/lp/state-of-the-cloud" rel="nofollow noopener noreferrer">Percentage of using Serverless has increased by a factor of one and a half (full report RightScale)</a> </li><li>  <a href="https://mikhail.io/serverless/coldstarts/aws/" rel="nofollow noopener noreferrer">How cold start time depends on the application language</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/452266/">https://habr.com/ru/post/452266/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45225/index.html">Sorry, but Gmail themes with Opera don't work for me?</a></li>
<li><a href="../452252/index.html">Security with a taste of Google</a></li>
<li><a href="../452258/index.html">Corda - open source blockchain for business</a></li>
<li><a href="../452262/index.html">Angular: library creation and publishing</a></li>
<li><a href="../452264/index.html">How we made the site for the Mascots auto award</a></li>
<li><a href="../452272/index.html">Girl under the waterfall</a></li>
<li><a href="../452276/index.html">Reverse engineering client Dropbox</a></li>
<li><a href="../452278/index.html">Bluetooth LE is not so scary, or How to improve user experience effortlessly</a></li>
<li><a href="../452280/index.html">PostgreSQL 11: The Evolution of Partitioning from Postgres 9.6 to Postgres 11</a></li>
<li><a href="../452282/index.html">Elementary, Watson: you integrate with Voximplant</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>