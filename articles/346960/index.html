<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to start developing universal applications with the Next.js library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We don't need no traffic building, 
 We don't need no SEO, 
 No link exchanges in your network, 
 Spammers! leave us all alone. 

 Anna Filina 
 A bit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to start developing universal applications with the Next.js library</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>We don't need no traffic building,</i> <i><br></i>  <i>We don't need no SEO,</i> <i><br></i>  <i>No link exchanges in your network,</i> <i><br></i>  <i>Spammers!</i>  <i>leave us all alone.</i> <i><br><br></i>  <i>Anna Filina</i> </blockquote><br><h2>  A bit of history </h2><br>  Back in 2013, Spike Brehm from Airbnb published a programmatic <a href="https://venturebeat.com/2013/11/08/the-future-of-web-apps-is-ready-isomorphic-javascript">article</a> in which he analyzed the disadvantages of SPA-applications (Single Page Application), and alternatively proposed a model of isomorphic web applications.  The term universal web application is now more often used (see <a href="https://github.com/facebook/react/pull/4041">discussion</a> ). <br><br>  In a universal web application, each page can be configured both by a web server and by means of JavaScript on the side of a web browser.  At the same time, the source code of the programs that are executed by the web server and the web browser must be uniform (universal) in order to eliminate inconsistency and increased development costs. <br><a name="habracut"></a><br>  The story of the author of the idea, Spike Brehm from Airbnb, has now ended with a complete victory, and recently, on December 7, 2017, <a href="https://twitter.com/spikebrehm/status/938507939492581377">on his Twitter account,</a> he announced that the Airbnb website had switched to server-side rendering of SPA applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Criticism SPA-applications </h2><br>  What is wrong with SPA applications?  And what problems arise when developing universal applications? <br><br>  SPA-applications are criticized, first of all, for the low ranking in search engines (SEO), speed, accessibility.  (This refers to accessibility as understood in <a href="https://www.w3.org/Translations/WCAG20-ru/">https://www.w3.org/Translations/WCAG20-ru</a> . There is <a href="https://github.com/facebook/react/issues/9549/">evidence</a> that React applications may not be available for screen readers.) <br><br>  Partially the issue with SEO SPA-applications is solved by Prerender - a server with a ‚Äúheadless‚Äù web browser, which is implemented using chrome-remote-interface (previously used phantomjs).  You can deploy your own server with Prerender or access a <a href="https://prerender.io/">public service</a> .  In the latter case, access will be free with a limit on the number of pages.  The process of page generation by means of Prerender is time-consuming - usually more than 3 seconds, which means that search engines will consider such a service not optimized for speed, and its rating will still be low. <br><br>  Performance problems may not manifest themselves during the development process and become noticeable when working with low-speed Internet or on a low-power mobile device (for example, a phone or tablet with 1GB of RAM parameters and a 1.2GHz processor frequency).  In this case, a page that ‚Äúflies‚Äù may load unexpectedly long.  For example, one minute.  The reasons for such a slow boot are more than usually indicated.  To begin, let's see how the application loads JavaScript.  If there are a lot of scripts (which was typical when using require.js and amd-modules), then the load time increased due to the overhead of connecting to the server for each of the requested files.  The solution was obvious: connect all the modules into one file (using rjs, webpack or another linker).  This caused a new problem: for a web application with a rich interface and logic, when loading the first page, all the JavaScript code loaded in a single file was loaded.  Therefore, the current trend is <a href="https://webpack.js.org/guides/code-splitting/">code spliting</a> .  We will return to this issue when we consider the necessary functionality for building universal web applications.  The question is not that it is impossible or difficult to do.  The question is that it is desirable to have the tools that do it optimally and without additional efforts on the part of the developer.  And finally, when all the JavaScript code has been loaded and interpreted, the construction of the DOM document begins and ... finally, the loading of pictures begins. <br><br><h2>  Libraries for creating universal applications </h2><br>  On github.com now you can find a large number of projects that implement the idea of ‚Äã‚Äãuniversally web applications.  However, all these projects have common drawbacks: <br><br><ol><li>  small number of project contributors </li><li>  These are projects for quick start, not a library </li><li>  projects were not updated when new versions of react.js were released </li><li>  Only a part of the functionality necessary for developing a universal application is implemented in projects. </li></ol><br>  The first successful solution was the Next.js library, which, as of January 14, 2018, has 338 contributors and 21,137 ‚Äústars‚Äù on github.com.  To evaluate the benefits of this library, consider what kind of functionality you need to provide for the operation of a universal web application. <br><br><h3>  Server rendering </h3><br>  Libraries such as react.js, vue.js, angular.js, riot.js, and others - support server-side rendering.  Server rendering works, as a rule, synchronously.  This means that asynchronous API requests in life cycle events will be launched for execution, but their result will be lost.  (Limited support for asynchronous server rendering is provided by riot.js) <br><br><h3>  Asynchronous data loading </h3><br>  In order for the results of asynchronous requests to be received prior to the server rendering, Next.js implements a special type of the page component, which has an asynchronous <i>static async getInitialProps ({req})</i> life cycle event. <br><br><h3>  Passing server component state to client </h3><br>  As a result of server-side rendering of the component, an HTML document is sent to the client, but the state of the component is lost.  To transfer the status of a component, usually the web server generates a script for the web browser that writes the state of the server component to a global JavaScript variable. <br><br><h3>  Creating a component on the side of a web browser and linking it to an HTML document </h3><br>  The HTML document that is obtained as a result of server-side rendering of the component contains text and does not contain components (JavaScript objects).  Components must be recreated in a web browser and ‚Äúlinked‚Äù to the document without being rendered.  In react.js, the hydrate () method is executed for this.  A method similar in function is in the library vue.js. <br><br><h3>  Routing </h3><br>  Routing on the server and on the client should also be universal.  That is, the same definition of routing should work for both server and client code. <br><br><h3>  Code splitting </h3><br>  For each page, only the necessary JavaScript code should be loaded, not the entire application.  When moving to the next page, the missing code should be reloaded - without reloading the same modules, and without unnecessary modules. <br><br>  All these tasks are successfully solved by the Next.js library.  This library is based on a very simple idea.  It is proposed to introduce a new type of component - ‚Äúpage‚Äù, in which there is the async static method async getInitialProps ({req}).  The ‚Äúpage‚Äù component is a normal React component.  This type of component can be thought of as a new type in the series: ‚Äúcomponent‚Äù, ‚Äúcontainer‚Äù, ‚Äúpage‚Äù. <br><br><h2>  Working example </h2><br>  For work we need node.js and the package manager npm.  If they are not already installed - the easiest way to do this is using nvm (Node Version Manager), which is installed from the command line and does not require sudo access: <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">curl</span></span> -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash</code> </pre> <br>  After installation, be sure to close and reopen the terminal in order to set the PATH environment variable.  The list of all available versions displays the command: <br><br><pre> <code class="hljs mel">nvm <span class="hljs-keyword"><span class="hljs-keyword">ls</span></span>-remote</code> </pre> <br>  Download the required version of node.js and the compatible version of the npm package manager with the command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">nvm</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> 8<span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span></code> </pre> <br>  Create a new directory (folder) and execute the command in it: <br><br><pre> <code class="hljs swift">npm <span class="hljs-keyword"><span class="hljs-keyword">init</span></span></code> </pre> <br>  As a result, the <i>package.json</i> file will be generated. <br>  Download and add the necessary packages for the project dependencies: <br><br><pre> <code class="hljs sql">npm <span class="hljs-keyword"><span class="hljs-keyword">install</span></span> <span class="hljs-comment"><span class="hljs-comment">--save axios next next-redux-wrapper react react-dom react-redux redux redux-logger</span></span></code> </pre> <br>  In the project root directory, create the <i>pages</i> directory.  This directory will contain components of the ‚Äúpage‚Äù type.  The path to the files inside the <i>pages</i> directory corresponds to the <i>url</i> by which these components will be available.  As usual, the ‚Äúmagic name‚Äù <i>index.js is</i> mapped to <i>url</i> <i>/ index</i> and <i>/</i> .  More complex rules for <i>url</i> with wildcard are also realizable. <br><br>  Create the <i>pages / index.js file</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> getInitialProps({ req }) { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> userAgent = req ? req.headers[<span class="hljs-string"><span class="hljs-string">'user-agent'</span></span>] : navigator.userAgent <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { userAgent } } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> Hello World {this.props.userAgent} </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } }</code> </pre><br>  This simple component uses the main features of Next.js: <br><br><ul><li>  The es7 syntax (import, export, async, class) is available out of the box. </li><li>  Hot-reloading also works out of the box. </li><li>  The <i>static async getInitialProps ({req})</i> function will be asynchronously executed before the component is rendered on the server or on the client ‚Äî and only once.  If the component is rendered on the server, the <i>req</i> parameter is passed to it.  The function is called only on components of the ‚Äúpage‚Äù type and is not called on nested components. </li></ul><br>  In the <i>package.json</i> file, add three commands to the ‚Äúscripts‚Äù attribute: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">"scripts"</span></span>: { <span class="hljs-string"><span class="hljs-string">"dev"</span></span>: <span class="hljs-string"><span class="hljs-string">"next"</span></span>, <span class="hljs-string"><span class="hljs-string">"build"</span></span>: <span class="hljs-string"><span class="hljs-string">"next build"</span></span>, <span class="hljs-string"><span class="hljs-string">"start"</span></span>: <span class="hljs-string"><span class="hljs-string">"next start"</span></span> }</code> </pre><br>  Start the developer server with the command: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">npm</span></span> run dev</code> </pre> <br>  To implement a transition to another page without loading the page from the server, the links are wrapped in a special <i>Link</i> component.  Add a dependency to <i>page / index.js</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Link <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'next/link'</span></span></code> </pre> <br>  and Link component: <br><br><pre> <code class="javascript hljs">&lt;Link href=<span class="hljs-string"><span class="hljs-string">"/time"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Click me</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/Link&gt;</span></span></code> </pre><br>  When clicking on a link, a page with 404 errors will be displayed. <br><br>  Copy the <i>pages / index.js</i> file to the <i>pages / time.js file</i> .  In the new component <i>time.js,</i> we will display the current time received asynchronously from the server.  In the meantime, change the link in this component so that it leads to the main page: <br><br><pre> <code class="javascript hljs">&lt;Link href=<span class="hljs-string"><span class="hljs-string">"/"</span></span>&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Back</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;<span class="hljs-regexp"><span class="hljs-regexp">/Link&gt;</span></span></code> </pre><br>  Try several times to reload each of the pages from the server, and then go from one page to another and go back.  In all cases, the download from the server will take place with the server rendering, and all subsequent transitions - by means of rendering on the side of the web browser. <br><br>  On the <i>pages / time.js</i> page <i>we</i> place a timer that shows the current time received from the server.  This will allow you to get acquainted with asynchronous data loading during server rendering - something that benefits Next.js from other libraries. <br><br>  To store data in the <i>store</i> , <i>we</i> use <i>redux</i> .  Asynchronous actions in <i>redux</i> are performed using middleware <i>redux-thunk</i> .  Usually (but not always), one asynchronous action has three states: <i>START, SUCCESS FAILURE</i> .  Therefore, the code for defining asynchronous actions often looks (at least for me) complicated.  In one issue of the <i>redux-thunk</i> library, a simplified version of middleware was discussed, which allows defining all three states on a single line.  Unfortunately, this option has not been designed in the library, so we will include it in our project as a module. <br><br>  Create a new directory <i>redux</i> in the root directory of the application, and in it - the file <i>redux / promisedMiddlewate.js</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> (...args) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{ dispatch, getState }</span></span></span><span class="hljs-function">) =&gt;</span></span> (next) =&gt; <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { promise, promised, types, ...rest } = action; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!promised) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> next(action); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> promise !== <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'In promised middleware you mast not use "action"."promise"'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> promised !== <span class="hljs-string"><span class="hljs-string">'function'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">'In promised middleware type of "action"."promised" must be "function"'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [REQUEST, SUCCESS, FAILURE] = types; next({ ...rest, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: REQUEST }); action.promise = promised() .then( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function"> =&gt;</span></span> next({ ...rest, data, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: SUCCESS }), ).catch( <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function"> =&gt;</span></span> next({ ...rest, error, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: FAILURE }) ); };</code> </pre><br>  A few explanations for this feature.  The midleware function in <i>redux</i> has a signature <i>(store) =&gt; (next) =&gt; (action)</i> .  An indicator of the fact that an asynchronous action should be handled by this function is the <i>promised</i> property.  If this property is not defined, then processing is completed and control is passed to the following middleware: <i>return next (action)</i> .  The <i>action.promise</i> property retains a reference to the <i>Promise</i> object, which allows you to ‚Äúhold‚Äù the asynchronous <i>static async getInitialProps ({req, store})</i> function until the asynchronous action is completed. <br><br>  All that is connected with the data storage we put in the file <i>redux / store.js</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { createStore, applyMiddleware } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logger <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux-logger'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> axios <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'axios'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> promisedMiddleware <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./promisedMiddleware'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> promised = promisedMiddleware(axios); <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> initStore = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">initialState = {}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> store = createStore(reducer, {...initialState}, applyMiddleware(promised, logger)); store.dispatchPromised = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">action</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.dispatch(action); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> action.promise; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> store; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTime</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">promised</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> axios.get(<span class="hljs-string"><span class="hljs-string">'http://time.jsontest.com/'</span></span>), <span class="hljs-attr"><span class="hljs-attr">types</span></span>: [<span class="hljs-string"><span class="hljs-string">'START'</span></span>, <span class="hljs-string"><span class="hljs-string">'SUCCESS'</span></span>, <span class="hljs-string"><span class="hljs-string">'FAILURE'</span></span>], }; } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> reducer = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state = {}, action</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (action.type) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'START'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'SUCCESS'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> {...state, ...action.data.data} <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'FAILURE'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign({}, state, {<span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>} ) <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state } }</code> </pre><br>  The <i>getTime ()</i> action will be processed <i>promisedMiddleware ()</i> .  To do this, the <i>promised</i> property has a function that returns <i>Promise</i> , and the <i>types</i> property has an array of three elements containing the constants <i>'START', 'SUCCESS', and 'FAILURE'</i> .  The values ‚Äã‚Äãof the constants can be arbitrary, their order in the list is important. <br><br>  It now remains to apply these actions in the <i>pages / time.js component</i> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> {bindActionCreators} <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'redux'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Link <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'next/link'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { initStore, getTime } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../redux/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> withRedux <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'next-redux-wrapper'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapStateToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">state</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> state; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapDispatchToProps</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">dispatch</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">getTime</span></span>: bindActionCreators(getTime, dispatch), }; } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Page</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">React</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">async</span></span> getInitialProps({ req, store }) { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> store.dispatchPromised(getTime()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } componentDidMount() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalHandle = setInterval(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.props.getTime(), <span class="hljs-number"><span class="hljs-number">3000</span></span>); } componentWillUnmount() { clearInterval(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.intervalHandle); } render() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ( <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">{this.props.time}</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Link</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Return</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">Link</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">div</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> ) } } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> withRedux(initStore, mapStateToProps, mapDispatchToProps)(Page);</code> </pre><br>  I pay attention that, here the method <i>withRedux ()</i> from the library <i>next-redux-wrapper is used</i> .  All other libraries are common to react.js and do not require adaptation to Next.js. <br><br>  When I first got acquainted with the Next.js library, it didn‚Äôt impress me very much due to the rather primitive out-of-the-box routing.  It seemed to me that the applicability of this library is not above business cards.  Now I don‚Äôt think so, and planned in the same article to talk about the <i>next-routes</i> library, which significantly expands the possibilities of routing.  But now I understand that this material is better to put in a separate post.  And there are plans to talk about the <i>react-i18next library</i> , which is attention!  - has no direct relation to Next.js, but it is very well suited for sharing. <br><br>  <i>apapacy@gmail.com</i> <i><br></i>  <i>January 14, 2018</i> </div><p>Source: <a href="https://habr.com/ru/post/346960/">https://habr.com/ru/post/346960/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346950/index.html">Face control for pets</a></li>
<li><a href="../346952/index.html">Amazon MTurk and Emotion Miner: Crowdsourcing, Big Data, Emotional Technologies</a></li>
<li><a href="../346954/index.html">Inventory (business *) processes through updating job descriptions in the interests of information security</a></li>
<li><a href="../346956/index.html">How to speed up site loading: 7 optimization tips for beginners</a></li>
<li><a href="../346958/index.html">Using Intel Movidius for Neural Networks</a></li>
<li><a href="../346962/index.html">Available AI for any company: Cloud AutoML</a></li>
<li><a href="../346964/index.html">Learn OpenGL. Lesson 4.4 - Clipping of faces</a></li>
<li><a href="../346966/index.html">(Non) security monitoring systems: NagiosXI</a></li>
<li><a href="../346968/index.html">‚ÄúKnowledge Day‚Äù for AI: published by the TOP30 of the most impressive machine learning projects over the past year (v.2018)</a></li>
<li><a href="../346970/index.html">Automatic update and backup 1C using powershell</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>