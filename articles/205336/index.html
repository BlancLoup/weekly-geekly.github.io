<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dynamic access control: working with centralized rules and access policies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Such technology as dynamic access control has been considered in my articles for quite a long time, but, honestly, I haven‚Äôt even gotten to half of al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dynamic access control: working with centralized rules and access policies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8ca/ada/de7/8caadade77db4e4a5be93f57e9d1d921.jpg" align="left">  Such technology as dynamic access control has been considered in my articles for quite a long time, but, honestly, I haven‚Äôt even gotten to half of all topics that I would like to consider.  But, nevertheless, this article will allow you to much better master this technology and learn about the next brick that is attached to the entire foundation of dynamic access control.  Figuratively speaking, this block of dynamic access control can be attributed to nothing but the centralized access itself.  Central access, in its essence, allows you to implement a centralized mechanism of appropriate authorization policies, thanks to which you can automate the ‚Äúsmart‚Äù distribution of rights in your company.  After all, if you properly generate your assertions, plan and create all the resource property objects that have been sharpened for your business, configure the required property property lists and implement a beautiful and correct classification, but make unintended banal errors when working with centralized rules or access policies, all your work can fly to hell. <br>  It is for this reason that it is extremely important to pay due attention to creating your own unique centralized rules and access policies and to spend as much time on it as it will be necessary in order to fully anticipate all possible situations that may occur after you implement the dynamic control technology. access to your production environment.  It is very important for you to carry out all the tests initially in the laboratory and, if possible, with the pilot group, otherwise the outcome may be the most unpredictable.  In principle, we will return to planning of dynamic access control in one of the last articles of this cycle, therefore, it is simply meaningless to dwell at this stage in more detail on this topic. <br>  Today will be considered such moments as the appointment of the centralized access rules themselves and centralized access policies.  You will learn how to create, edit and delete such rules and policies.  Moreover, in this article you will learn about the very distribution and application of centralized access policies.  It turns out, as in the case of the fourth article of this cycle, there will be quite a lot of material in this article, for this reason we will move on to the first section. <br><a name="habracut"></a><br><h2>  Centralized Access Rules </h2><br>  Before we start creating centralized access rules, we should determine what this is and what these objects are for.  By definition, the <b>Centralized Access Rule</b> is an expression of authorization rules that can include one or more conditions affecting user groups, user and device requirements, and resource properties.  It turns out that the generated centralized access rule determines who will be granted access to a specific area of ‚Äã‚Äãresources.  Like all objects of the dynamic access control technology, such rules must include unique names and, of course, optional, clear descriptions.  Moreover, as I have already indicated before, these rules also include certain expressions, which are conditional expressions of the SDDL (Security Descriptor Definition Language) language. <br>  You can also note that several centralized access rules can be combined into a centralized access policy.  In general, if one or more centralized access rules are defined for a domain, file resource administrators can easily match certain rules with specific resources and business requirements. <br>  In principle, according to the theoretical part regarding the centralized access rules, there is already nothing to say, so we move on to the more interesting part: the practical one.  Next, I will talk about creating, editing, and removing centralized access rules.  We will naturally begin with <br><h3>  Create a centralized access rule </h3><br>  First of all, you should be aware that by default no centralized rule is created on the servers.  Therefore, in order to further use centralized access rules, and even more so centralized access policies, you will need to create those yourself.  The creation of unique centralized access rules in itself is not a difficult task.  This process can remind you of creating all the objects that we talked about during all the previous articles in this series, since you can accomplish this task using the Active Directory Administrative Center and tools from Windows PowerShell.  We will begin, naturally, from the console of the Central Administration of Active Directory.  This whole process is as follows: <br><ol><li>  On the domain controller, you need to open the <b>Active Directory Administration Center</b> console, where in the area of ‚Äã‚Äãtransition nodes you need to select the <b>Dynamic Access Control</b> node and then select <b>Central Access Rules</b> ( <b>Dynamic Access Control&gt; Central Access Rules</b> ).  You can also go to this node by selecting the option number 3 - <b>‚ÄúCreate a centralized access rule‚Äù</b> on the dynamic access control tile on the initial screen of this console; </li><li>  In the second step of this procedure, you need either from the context menu of the details pane, or from the <b>Tasks area to</b> successively select <b>the Create</b> options and also the <b>New&gt; Central Access Rule</b> , as seen in the following illustration. : <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/360/190/159/360190159f1e359b4417264ecde5a13b.png"></a> <br>  <b>Fig.</b>  <b>1. Creating a new centralized access rule</b> </li><li>  As you can see in the illustration under number 2, in the dialog box that appears, you should define the values ‚Äã‚Äãof the required controls in three different groups, and to create a new rule, you even have to fill out only the first control of the upper group.  But first things first: <br><ul><li>  Group <b>"General"</b> ( <b>General</b> ).  This group has almost a standard set of parameters for most of the objects created by dynamic access control technology.  In this group you are allowed to define the following three main parameters, namely: <br><ul><li>  <b>Name</b>  Everything is clear here: to identify each such rule, you must specify its name.  Names must be unique, in alphanumeric format, and filling in this parameter is considered a prerequisite for creating an access rule.  By the way, even while planning your centralized access rules, be sure to note that the maximum number of characters allowed for the name of your rule is 64 characters.  That is, you need not to exceed this limit.  For example, in this example, let the rule be called ‚Äú <b>Allowing the reading of the resources of the branches to marketing specialists central.</b>  <b>office</b> "; </li><li> <b>Description (Description)</b> .  An optional text field, but a description can help you if you have generated dozens, if not more, of centralized access rules.  As with the name, the number of characters in this field is also limited.  You must fit the description of your rule to a maximum of 1024 characters, otherwise you simply cannot create such a rule.  In the description we will write ‚Äú <b>Allows the marketing specialists of the main office to get access to reading to the target resource of the company's branches</b> ‚Äù; </li><li>  <b>Protection from accidental deletion (Protect from accidental deletion)</b> .  The standard check box for Active Directory central administration objects that prohibits everyone except the rule creator from deleting the current rule, even considering that only administrators in the security groups of domain administrators and enterprise administrators can create, modify or delete such rules. </li></ul></li><li>  Group <b>"Target Resources"</b> ( <b>Target Resources</b> ).  The second group of this dialog box is used to define the so-called scope of the centralized access rule.  Such an action area is created by defining resource property objects created earlier as so-called conditional expressions.  Thus, for the rules you create, you can define almost any possible scope.  Although it is common practice to apply centralized access rules exclusively to small groups of the same disk space, you can leave the default value, so the rule will apply to all possible target resources.  You can group such conditional expressions with standard <b>AND</b> or <b>OR</b> operators.  Moreover, to create more complex scenarios, you can simultaneously group together several conditional expressions, combining the scope of such results.  In other words, if you want to change the default scope of your rule, click on <b>the Edit</b> button. </li><li>  The <b>Permissions group</b> .  Thanks to this final group of parameters, you can predetermine the permissions for the rule you create with two different functionalities, namely: <br><ul><li>  <b>‚ÄúUse the following permissions as proposed‚Äù (Use following permissions as proposed permissions)</b> .  According to the official definition, this parameter allows you to audit the results of requests for access to target objects, without affecting the operation of the system.  In other words, by selecting this option, you will be able to add permission entries from the corresponding list to the list of proposed permission entries for the centralized access rule you create.  A list of proposed permissions can be combined with an audit file system to model the effective access that users will receive to a resource, without changing permissions per se in the list of current permissions.  The proposed permissions generate a special audit event that can be detected in the event log, where you can already take a closer look at all access attempts performed by your users; </li><li>  <b>"Use the following permissions as current" (Use the following permissions as current permission</b> s <b>)</b> .  By selecting this option, you will be able to provide access to target resources after the publication of a centralized access policy, where such a rule will appear.  In other words, the current list of permissions represents additional permissions that the Windows operating system will read when deploying a centralized access rule on a file server.  As I said before, centralized access rules do not replace existing security settings, and when deciding on authorization, Windows will necessarily evaluate the permissions records of the centralized access rule, the current list of NTFS permissions, and the share permissions lists. </li></ul><br>  In this case, you should stop at the second option and after clicking on the <b>‚ÄúEdit‚Äù</b> button in the already familiar many advanced security settings dialog box add the required group, for example, ‚Äú <b>Los Angeles Marketers</b> ‚Äù, which will be assigned the <b>‚ÄúRead and Execute‚Äù</b> rights , as well as the usual <b>"Reading"</b> . <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fc8/d3c/86c/fc8d3c86cfc387420d5dc273d53dd5f6.png"></a> <br>  <b>Fig.</b>  <b>2. Dialog box for creating a new centralized access rule</b> </li></ul></li><li>  After all the settings are defined, you can safely save your access rule. </li></ol><br>  As you can see, there is nothing complicated.  Now, perhaps, we will consider such a moment as the creation of centralized access rules by a somewhat different method, or more precisely, with the help of such a powerful administrative tool as Windows PowerShell.  If you fully summarize the PowerShell cmdlets responsible for managing such policies, then, as is the case with <a href="http://habrahabr.ru/post/204212/">managing property resource lists</a> that were discussed in the previous article of this series, you can select three different cmdlets, namely: <b>New-ADCentralAccessRule</b> , due to which You can create new centralized access policies, <b>Set-ADCentralAccessRule</b> , which allows you to edit existing rules, as well as <b>Remove-ADCentralAccessRule</b> , which, respectively, is responsible for removing the latter.  Since editing and deleting existing access rules using PowerShell is quite simple, these operations will be simply omitted in the current article.  And now let's create a new centralized access policy. <br>  For example, you now need to create a policy that will be called ‚Äú <b>Marketing Access in Los Angeles to Marketing Resources</b> ‚Äù with the description ‚Äú <b>Policy allowing marketing specialists to access all resources classified for the Marketing Division</b> ‚Äù, which allows the relevant group to access all resources with the correct by classification.  In this case, the PowerShell team will look like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <code>New-ADCentralAccessRule -CurrentAcl:"O:SYG:SYD:AR(A;;FA;;;S-1-5-21-3046794806-2660339953-3139999740-1107)" -description:",       ,    Marketing" -Name:"  -   " -ProposedAcl:$null -ProtectedFromAccidentalDeletion:$true -ResourceCondition:"(@RESOURCE.Department_MS == `"Marketing`")" -Server:"DC.biopharmaceutic.local" <br></code> <br>  Where: <br><ul><li>  The <b>Name</b> parameter is responsible for the name of the object being created.  The purpose and limitations of this parameter are identical to the capabilities of the central administration console; </li><li>  The <b>Description</b> parameter is used to specify the description of the rule you are creating; </li><li>  The <b>CurrentACL</b> parameter allows <b>you</b> to define the current list of permissions for the access rule you are creating.  The most difficult thing in the meaning of this parameter is that you need to specify all your permissions in a short form written in SDDL.  With this parameter, the most important thing is a thorough study of the <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa374928(v%3Dvs.85).aspx">ACE Strings</a> and <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa379602(v%3Dvs.85).aspx">SID Strings</a> documents.  In general, always double-check the correctness of the indication of this parameter, since errors associated with this parameter may be decisive; </li><li>  The <b>ProposedAcl</b> parameter defines the proposed permissions, which are specified in the same format as the previous parameter, and which we will discuss in more detail in the next subsection of this article; </li><li>  The <b>ProtectedFromAccidentalDeletion</b> parameter is a standard parameter of the general group of the dialog box for creating centralized access rules responsible for protecting against accidental deletion; </li><li>  The <b>ResourceCondition</b> parameter is a parameter whose value should be the condition of this rule.  In this example ( <b>@ RESOURCE.Department_MS == `" Marketing` "</b> ), everything is exactly the same as pronounced out loud, that is, the unit‚Äôs (@RESOURCE) resource (Department_MS) equals (==) the Marketing value (` "Marketing` ").  It takes a lot of practice to learn how to make such conditions correctly, and, if you wish, you can periodically after creating rules manually study the Windows PowerShell log; </li><li>  The <b>Server</b> parameter is simply the name of the server on which such a rule should be created.  Since in this particular case the server name is DC domain diopharmaceutic.local, we get the corresponding value of this parameter. </li></ul><br>  The output of this command is very simple: if you did not see the error, everything is fine and you have created a centralized access rule.  An example of the output of this command can be seen below: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/9aa/46f/c82/9aa46fc828b371f3c12236cf2d3da9ae.png"></a> <br>  <b>Fig.</b>  <b>3. Creating a Centralized Access Rule Using Windows PowerShell</b> <br><h3>  Modify an existing centralized access rule </h3><br>  There are always situations when, after creating a new object, it becomes necessary to change it.  Perhaps, during the creation a mistake was made, maybe you just forgot to add the required resolution, maybe the specified condition was not sufficiently exhaustive ... There may be many options.  But the most important thing is that in case of lack of the required information, the created object must be modified.  Of course, centralized access rules normally apply to such a situation, and to change an existing object, no supernatural actions are required of you.  Roughly speaking, you go to the same node where the rule itself was created ( <b>Dynamic Access Control&gt; Central Access Rules</b> ), find such a rule in the list of the details pane, and then either from the context menu of such an object or from the taskbar select the option <b>‚Äú Properties</b> ( <b>Properties</b> ). <br>  In the displayed dialog box for changing the rules you created, you are provided with practically the same possibilities as when creating such a rule, with the exception of three points: <br><ul><li>  First, you cannot change the name of your rule.  You do not have such an opportunity and all; </li><li>  Secondly, in addition to editing the current permissions, you are also given the opportunity to customize the <b>proposed permissions</b> , which I mentioned in passing when creating a centralized access rule using Windows PowerShell.  What are these proposed permissions?  First of all, it is necessary to understand the difference between <b>current</b> and <b>proposed</b> permissions.  <b>The current</b> list of permissions is the records that define access to resources for your centralized access rule.  These permissions will take effect after you deploy your centralized access rule using a centralized access policy, which you will learn further from this article.  In turn, the <b>proposed</b> permissions can only be detected if you want to view the properties or modify your existing access rule.  In the list of proposed permissions, you can view all possible changes in permissions between current security principals with a list of proposed permissions.  But despite this, you should pay attention to the fact that such a list of proposed permissions will not affect the current user permissions.  Also, be sure to pay attention to the fact that if you want to be able to view and analyze such intermediate permissions, you need to activate the <b>‚Äú</b> <b>Enable permission staging configuration</b> <b>‚Äù</b> checkbox.  Moreover, when working with the proposed permissions, be sure to pay attention to the following features: <br><ul><li>  The <b>"Edit" option</b> .  As is obvious, this button brings up an advanced security settings dialog box, allowing you to change or add permissions to the group of proposed permissions; </li><li>  <b>‚ÄúApply Proposed‚Äù</b> <b>option</b> ( <b>Apply Proposed</b> ).  This option allows you to replace the current permissions with the permissions that you defined in the group of proposed permissions; </li><li>  The option <b>"Copy from Current"</b> ( <b>Copy from Current</b> ).  In turn, this parameter allows you to perform the reverse action, that is, this action simply replaces the permissions in the list of proposed permissions with the permissions from the current list of permissions. </li></ul></li><li>  Third, after you once change the permissions that were initially set, each time you open the properties dialog box of the centralized access rule that you changed, you will have the opportunity of another group ‚Äî the <b>‚ÄúPrevious Permissions‚Äù</b> group.  What happens after you change your rule?  After changing the permissions of the centralized access rule, the operating system copies the original current permissions to the list of the <b>Previous Permissions</b> group, and then saves the list of current permissions, as well as the list of previous permissions, updated from the proposed permissions.  The main thing to remember is that this list includes only one copy of previous permission entries.  In other words, the Active Directory Administration Center functionality does not support the complete history of all your changes in permissions of the current list of permissions. </li></ul><br>  You can look at the properties dialog box of a modified centralized access rule in the following illustration: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/717/768/976/717768976fc2d3e92546aefdaa3017e9.png"></a> <br>  <b>Fig.</b>  <b>4. Properties dialog box of a modified centralized access rule</b> <br><br><h3>  Remove existing centralized access rule </h3><br>  Operations to remove existing centralized access rules are most likely the simplest operations that can be performed.  To do this, you should select the unnecessary more access rule in the <b>Dynamic Access Control&gt; Central Access Rules</b> node of the Active Directory Administrative Center, and then select the <b>‚ÄúRemove‚Äù</b> command from the context menu or from the taskbar.  In the delete confirmation dialog box that appears, you will need to click on the <b>‚ÄúYes‚Äù</b> button, which means that you have definitely made your choice.  And everything, the rule will be instantly deleted. <br>  In the event that a dialog box appears in front of you indicating a lack of rights, open the properties dialog box of the rule you are deleting, and then uncheck the box next to <b>Protect from accidental deletion</b> .  After this, repeat the steps to delete the rule. <br><br><h2>  Managing Centralized Access Policies </h2><br>  We have already dealt with the centralized access rules, so it is worthwhile to proceed to the next topic of this article, which is dedicated to centralized access policies.  <b>Centralized access</b> policies are authorization policies that first appeared in the Windows Server 2012 server operating system and include conditional expressions.  In principle, such policies are collections of objects of centralized access rules.  You can create such policies using Active Directory Administrative Center, and after that you can distribute them using <a href="http://dimanb.wordpress.com/category/%25D0%25B3%25D1%2580%25D1%2583%25D0%25BF%25D0%25BF%25D0%25BE%25D0%25B2%25D1%258B%25D0%25B5-%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B8%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B8/">Group Policy</a> functionality.  For example, if an organization's business requirements include restricting access to personal information of files by the file owner and members of a department, say, the personnel department, who are allowed to view personal information, then this is a general organization policy applicable to personal information files, no matter which file servers of the organization they are not located.  As I said, centralized access policies can include one or more centralized access rules, and centralized access rules, in turn, can be members of several different centralized access policies. <br>  Here, as I mentioned earlier, you should definitely pay attention to the fact that centralized access policies <b>increase the security of access to files and folders that are located on dedicated file servers</b> , but do not replace any local access policies or selective management tables. Access (DACL) that already applies to the same files or folders.  In other words, they work harmoniously and together.  Take this simplest example: the centralized access policy clearly states that a user can use a specific document hosted on a file server, but it is determined in the DACL that access to the file is denied.  Thus, the user will not be able to access such a document.  Such a restriction can be encountered for the reason that the prohibition rules will always prevail over the permitting rules, regardless of the technology with which you have prohibited or allowed access to the file or folder itself. <br>  We have dealt with the appointment of centralized access policies, but it is also advisable to know more about some prerequisites that must be met before you begin to implement centralized access policies in your organization.  These requirements include the fact that: <br><ol><li>  You must create assertions that will be connected to the objects of user accounts or computers using the appropriate attributes; </li><li>  You will also need to create file property definitions; </li><li>  You must create one or more centralized access rules, of course, depending on your business requirements; </li><li>  At least one central access policy object should be created and, as a result, its parameters should be defined; </li><li>  Using Group Policy functionality, you should extend these policies to file servers.  Thus, your file servers running Windows Server 2012/2012 R2 operating systems will already be aware of the existence of dynamic access control and that centralized access policies have been created in your organization; </li><li>  After all, on the end servers, you need to apply these policies to the public folders you choose. </li></ol><br>         ,    , ,         ,         ,        Active Directory,    Windows PowerShell. <br><h3>     </h3><br> ,      ,    ,      .          ,         . ,    ,    : <br><ol><li>     Active Directory        ¬´ <b>   &gt; Central Access Policies</b> ¬ª ( <b>Dynamic Access Control &gt; Central Access Policies</b> ),       4,   <b>¬´   ¬ª</b>          .    ,             <b>¬´¬ª</b>  <b>¬´  ¬ª</b> ( <b>New</b> &gt; <b>Central Access Policy</b> ),     : <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/282/5cd/1f0/2825cd1f0c7da4cabd73a9b7c4d3b52f.png"></a> <br>  <b>Fig.</b> <b>5.    </b> </li><li>  ,     <b>¬´   ¬ª</b> ( <b>Create Central Access Policy</b> ),          .           ,            ,  : <br><ul><li>  <b>¬´¬ª</b> ( <b>General</b> ).     ,   ,      .           : <br><ul><li> <b> (Name)</b> .        .        ¬´ <b> -</b> ¬ª; </li><li> <b> (Description)</b> .        .      ¬´ <b>      -</b> ¬ª; </li><li> <b>    (Protect from accidental deletion)</b> . ,          .      ,          . </li></ul></li><li>  <b>¬´¬ª</b> ( <b>Member</b> ).             ,     .     <b>¬´¬ª</b> ( <b>Add</b> )         ,         (.  )      .  ,       ,        ,         .  ,          (,  )     . </li></ul><br> ,      ,   <b>¬´ ¬ª</b> ( <b>Permission State</b> )         ,      .     ,         ¬´ <b></b> ¬ª,   ¬´ <b></b> ¬ª ( <b>Proposed, Current</b> ). <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/ca4/b02/87f/ca4b0287f3af985adfa6747efaf435d4.png"></a> <br>  <b>Fig.</b> <b>6.      </b> </li><li>    <b>¬´¬ª</b> ,       . </li></ol><br>  GUI-  ,      ,         Windows PowerShell.  , ,        -         Windows PowerShell.       ,    ,         .        ,              . <br> ,            Windows PowerShell: <b>New-ADCentralAccessPolicy</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with which you create the central access policy object itself; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Set-ADCentralAccessPolicy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , responsible for changing the existing policy; </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove-ADCentralAccessPolicy</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , thanks to which, in fact, you remove unnecessary access policies, as well as the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add-ADCentralAccessPolicyMember</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Remove-ADCentralAccessPolicyMember cmdlets</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , which are designed to add centralized access rules to selected policies or to delete them. In the following example, only two cmdlets will be considered, which allow you to add a new centralized access policy and add one access rule for it. So, first you need to use the following cmdlet:</font></font><br><br> <code>New-ADCentralAccessPolicy -description:"Just another CAP" -Name:"Test CAP" -Server:"DC.biopharmaceutic.local" -ProtectedFromAccidentalDeletion:$true <br></code> <br>  ,         .   <b>Name</b>    , <b>Description</b> ‚Äì   ,    <b>Server</b>        ,     <b>ProtectedFromAccidentalDeletion</b> ‚Äì       . <br>             .          ,      .      : <br><br> <code>Add-ADCentralAccessPolicyMember -Identity:"CN=Test CAP,CN=Central Access Policies,CN=Claims Configuration,CN=Services,CN=Configuration,DC=biopharmaceutic,DC=local" -Members:"CN=  -   ,CN=Central Access Rules,CN=Claims Configuration,CN=Services,CN=Configuration,DC=biopharmaceutic,DC=local" -Server:"DC.biopharmaceutic.local" <br></code> <br>     ,  :  <b>Identity</b> ,     ,    <b>Members</b> ,            .  ,         , ,    .      : <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/a76/6cd/4ca/a766cd4ca3d777584b95522de05eeb6c.png"></a> <br>  <b>Fig.</b> <b>7.      Windows PowerShell</b> <br><br><h3>        </h3><br>       ,  ,           .       ,       ,           -    .     ,      Active Directory    <b>Dynamic Access Control &gt; Central Access Policies</b> ,    ,      ,    <b>¬´¬ª</b> ( <b>Tasks</b> )   <b>¬´¬ª</b> ( <b>Properties</b> ). <br>  ,            ,           <b>¬´   ¬ª</b> ( <b>Add Central Access Rule</b> ).           ,            . <br>              - .       <b>Central Access Policies</b>   ,     <b>¬´¬ª</b> ( <b>Delete</b> )   . <br><br><h2>     </h2><br> ,         .         ,     .           Windows      .            ,     ,    .   -   ,      , ‚Äì ,      <a href="http://dimanb.wordpress.com/category/%25D1%2581%25D0%25BE%25D0%25B2%25D0%25B5%25D1%2582-%25D0%25BD%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B8/"> </a> .     ‚Äì     CSE <a href="http://dimanb.wordpress.com/%3Fs%3D%25D0%25A3%25D1%2581%25D1%2582%25D0%25B0%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0%2B%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25BD%25D0%25BE%25D0%25B3%25D0%25BE%2B%25D0%25BE%25D0%25B1%25D0%25B5%25D1%2581%25D0%25BF%25D0%25B5%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2B%25D1%2581%25D1%2580%25D0%25B5%25D0%25B4%25D1%2581%25D1%2582%25D0%25B2%25D0%25B0%25D0%25BC%25D0%25B8%2B%25D0%25B3%25D1%2580%25D1%2583%25D0%25BF%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9%2B%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B8%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B8">GPSI</a> ,   ,   ,      , ,      ,   Windows  IPSEC ‚Äì    <a href="http://dimanb.wordpress.com/category/%25D0%25BB%25D0%25BE%25D0%25BA%25D0%25B0%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B0%25D1%258F-%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B8%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0-%25D0%25B1%25D0%25B5%25D0%25B7%25D0%25BE%25D0%25BF%25D0%25B0%25D1%2581%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8/"> </a>   <b>¬´ Windows¬ª</b> .       -   , ,        ,     <a href="http://dimanb.wordpress.com/category/msoffice-2010/"> </a> .           ,     <a href="http://dimanb.wordpress.com/category/%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25BF%25D0%25BE%25D1%2587%25D1%2582%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F-%25D0%25B3%25D1%2580%25D1%2583%25D0%25BF%25D0%25BF%25D0%25BE%25D0%25B2%25D0%25BE%25D0%25B9-%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25B8%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B8/">  </a> ,        ,      . <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And such a technology as </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Dynamic Access Control</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , of course, did not go without its expansion of the client side for group policy. Since all the rules and policies you create are stored in Active Directory Domain Services, by and large, all that remains is to remove such objects from the required containers, and then distribute the parameters specified in them to specific machines. In words, it sounds very simple, but let's see what this procedure is in practice. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, to distribute your previously created centralized access policies to file servers, you will need to perform the following steps:</font></font><br><ol><li>      <b>¬´  ¬ª</b> ( <b>Group Policy Management</b> ),             ,  ¬´ <b>Dynamic Access Control 01</b> ¬ª,          ; </li><li>      CSE     .       <b> \\ Windows\ \ </b> ( <b>Computer Configuration</b> \ <b>Policies\Windows Settings</b> \ <b>Security Settings\File System</b> ).          Microsoft,              ,    ,         ¬´ <a href="http://dimanb.wordpress.com/2010/05/10/secgpo-06/">  .  6:    ,  ,    </a> ¬ª.  ,   Windows Server 2012,         ,   ¬´ <b>  </b> ¬ª ( <b>Central Access Policy</b> )            .    ,      ,  ,     ,      ¬´ <b>   </b> ¬ª ( <b>Manage Central Access Policies‚Ä¶</b> ): <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/6ae/775/50d/6ae77550d964f1e2b63623059d70529d.png"></a> <br>  <b>Fig.</b> <b>8.      GPME</b> </li><li>     ¬´ <b>   </b> ¬ª ( <b>Central Access Policies Configuration</b> ),               .  ,    ,    ¬´ <b>   </b> ¬ª ( <b>Available Central Access Policies</b> )      (  ,     CTRL    ),  ,     ¬´ <b></b> ¬ª ( <b>Add</b> ),     ¬´ <b>   </b> ¬ª ( <b>Applicable Central Access Policies</b> ): <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/105/605/542/10560554220f4b96e05e0d0778eca95c.png"></a> <br>  <b>Fig.</b> <b>9.    </b> </li><li>            ,               . </li></ol><br>  ,            ,     ,       -     SYSVOL    ,    . ,     ,         <b><i>C:\Windows\SYSVOL\domain\Policies\{6DF180BA-22E3-4D52-A34F-158633E56956}\Machine\Microsoft\Windows NT\Cap</i></b> ,  <b>C:\Windows\SYSVOL\domain\Policies</b>             , <b>{6DF180BA-22E3-4D52-A34F-158633E56956}</b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- this is the GUID of the GPO itself, which has just been created and configured (you can find it out by calling the properties dialog for the topmost node directly from the Group Policy Management Editor), and </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Machine \ Microsoft \ Windows NT \ Cap</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> is already the path to the folder where the file is located, in which the policy settings you specified will be defined. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In this directory you can find a single .inf file called cap.inf (short for Central Access Policy). This file is not encrypted, and if you wish, you can view its contents. For example, in my case, such a file will include the following lines: </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[Version] </font></font></i> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Signature = "$ Windows NT $" </font></font></i> <br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">[CAPS]</font></font></i> <br> <i>¬´CN=Test CAP,CN=Central Access Policies,CN=Claims Configuration,CN=Services,CN=Configuration,DC=biopharmaceutic,DC=local¬ª</i> <br> <i>¬´CN= -,CN=Central Access Policies,CN=Claims Configuration,CN=Services,CN=Configuration,DC=biopharmaceutic,DC=local¬ª</i> <br><br> ,              .  ,   ,     ,        ,     Active Directory. <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It turns out that in this .inf file you can find only the name of the policy and its location. That is, if after receiving such a file, no action is taken at all, then the client will simply not know what these policies are, not to mention the rules. It is for this reason that the operating system needs to take some action and implement mechanisms that allow ‚Äúto understand what these policies are for and what can be done with them‚Äù. Fortunately, in Windows Server 2012/2012 R2 everything is already implemented out of the box. After updating the Group Policy settings, the system library auditcse.dll reads the required information about centralized access policies from the .inf file,and then, through LDAP queries, all the necessary system data will be obtained from the domain services due to the expansion of the client side and recorded in the system registry of the target computer.</font></font><br>          ,       ,    regerdit,    HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\CentralizedAccessPolicies.     ,    CAPEs     ,    CAPs   ,     . ,   ,         <b>Name</b>  <b>Description</b> ,  , ,      .     ,       ,             : <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/0d1/239/c0e/0d1239c0ecf5e5abd4beba40d4c3046d.png"></a> <br>  <b>Fig.</b> <b>10.          </b> <br>  ,              ,             . <br><br><h2>     </h2><br>  ,       ,        ,          ,           ,      ,            ,    .                   . <br>     ,      : <br><ol><li>   Windows    ,        .         ¬´ <b></b> ¬ª ( <b>Properties</b> ); </li><li>           <b>¬´¬ª</b> ( <b>Security</b> ),   ,    ,    <b>¬´¬ª</b> ( <b>Advanced</b> ); </li><li>         ,    <b>¬´¬ª</b> , <b>¬´¬ª</b>  <b>¬´  ¬ª</b> ( <b>Permissions, Auditing, Effective Access</b> )     <b>¬´ ¬ª</b> ( <b>Central Policy</b> ),       .               . <br>       ,       .        ,      . ,       ¬´ -¬ª,      ,       .          ,    , ,       Active Directory    .     ,           .             : <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/f90/8b2/7d7/f908b27d7e7bee81fb57c515fbd23e5d.png"></a> <br>  <b>Fig.</b> <b>11.      </b> </li><li>     ,         .                ,     ,            SACL  .     ,          S-1-17,        ,      ,           . </li></ol><br><h2>  Conclusion </h2><br> ,           .    ,            ,        Active Directory,     Windows PowerShell.  ,           ,         .     ,     .            ,   , ,       ,                   . <br>                         ,    ¬´¬ª     ,      ,            . </div><p>Source: <a href="https://habr.com/ru/post/205336/">https://habr.com/ru/post/205336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205324/index.html">Snake on the PLC. Our answer to Siemens</a></li>
<li><a href="../205326/index.html">Antivirus scan access to Samba</a></li>
<li><a href="../205328/index.html">Tuning mooedit</a></li>
<li><a href="../205332/index.html">Dell VRTX - IT small business infrastructure in one box</a></li>
<li><a href="../205334/index.html">IBM PureData for Hadoop: how can this system help me?</a></li>
<li><a href="../205338/index.html">New research: how else is SEO and social cues related?</a></li>
<li><a href="../205340/index.html">Microsoft and Adobe released a set of updates, December 2013</a></li>
<li><a href="../205342/index.html">What is quality code and why measure it</a></li>
<li><a href="../205344/index.html">Zombie phone society</a></li>
<li><a href="../205348/index.html">Call-to-action in e-mail newsletter</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>