<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to install Nutanix CE under VMware ESXi</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After launching our Nutanix Community Edition, the free, ‚Äúsoft‚Äù version of Nutanix, which can be installed on an arbitrary, user-defined hardware, I o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to install Nutanix CE under VMware ESXi</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/943/753/580/943753580cd340e893215b5029e2ae5c.jpg"><br><br>  After launching our Nutanix Community Edition, the free, ‚Äúsoft‚Äù version of Nutanix, which can be installed on an arbitrary, user-defined hardware, I often had to answer the questions: ‚ÄúWhat if we don‚Äôt have a suitable physical server?  Can I put it as a ‚Äúvirtual applause‚Äù, inside the hypervisor, on a virtual machine? ‚Äù <br><br>  In the summer, the developers compiled a version that learned to work in nested virtualization mode, that is, a CVM virtual machine running in the KVM hypervisor, which, in turn, works in the VMware ESXi hypervisor, and this latter emulates the right hardware for our hypervisor. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here's how to do it: <br><a name="habracut"></a><br>  First, you need a server under the ESXi hypervisor and enough memory.  The CVM of each node will take 16GB, and you will need to leave some more for your VMs themselves in a Nutanix CE environment. <br>  The minimum number of nodes in CE is one (and, of course, there will be no fault tolerance), the maximum is four.  Two is not supported, respectively, three options: one (without fault tolerance), three and four. <br><br>  <s>Since the free VMware Hypervisor only holds 16GB of RAM, it will not work for you</s> .  But ESXi trial works well. <br><br>  Here is an example of a server on which the described method was tested: <br><br>  2 x 8 core Intel Xeon E5-2680 <br>  384GB RAM <br>  500GB SSD <br>  1024GB HDD <br>  VMWare ESXi 5.5 U2 <br><br>  Remember, however, that, in any case, you will need SSDs in the server.  Yes, there is a way to ‚Äúfool‚Äù, and make ESXi and Nutanix consider the HDD slipped by you as an SSD, but nothing good will come of it, believe me, so only an SSD.  It does not have to be an Intel S3700 / S3610 server, as we use, but it must be a disk of sufficient size and with good speed, otherwise you will not see performance. <br><br>  Prepare the boot disk.  You downloaded an installation disk image from the Nutanix CE forum that looks something like this: <b>ce-2015.06.08-beta.img</b> . <br>  Now rename it to a file with the name: <b>ce-flat.vmdk</b> . <br>  Create a disk descriptor file: <b>ce.vmdk</b> <br><br>  The contents of the disk descriptor file (for version ce-2015.06.08-beta) you can use this: <br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment"># Disk DescriptorFile version=4 encoding="UTF-8" CID=a63adc2a parentCID=ffffffff isNativeSnapshot="no" createType="vmfs" # Extent description RW 14540800 VMFS "ce-flat.vmdk" # The Disk Data Base #DDB ddb.adapterType = "lsilogic" ddb.geometry.cylinders = "905" ddb.geometry.heads = "255" ddb.geometry.sectors = "63" ddb.longContentID = "2e046b033cecaa929776efb0a63adc2a" ddb.uuid = "60 00 C2 9b 69 2f c9 76-74 c4 07 9e 10 87 3b f9" ddb.virtualHWVersion = "10"</span></span></code> </pre> <br><br>  Now create a virtual machine. <br><br>  Create a new VM, select <b>CentOS 4/5/6/7 (64bit)</b> as the type. <br>  Let's set the number of vCPU - <b>12</b> (minimum - 4, but not recommended). <br>  Set the amount of RAM - <b>128GB</b> (minimum - 16). <br>  Set HDD volume to <b>900GB</b> , mapping on <b>SCSI0: 0</b> (minimum - 500GB) <br>  Set the amount of SSD to <b>350GB</b> , mapping on <b>SCSI0: 1</b> (minimum - 200GB) <br>  Choose an Intel E1000 NIC. <br><br>  Now you can go to the datastor for SCP, and fill in our <b>ce-flat.vmdk</b> and <b>ce.vmdk</b> <br><br>  Edit the VM settings.  Install VM settings - <b>CPU -&gt; Hardware virtualization -&gt; Expose hardware assisted virtualization to the guest OS.</b> <br><br><img src="https://habrastorage.org/files/18b/e7a/527/18be7a52709b4ecba82018f889a94439.jpg"><br><br>  Add a new SATA controller. <br>  We mount our vmdk on this controller. <br><br>  Now you can start the VM and install CE. <br><br>  We start VM, and we enter its BIOS, having pressed when loading F2. <br>  Install as a boot device SATA-controller. <br>  Loading. <br><br>  As you already know, CE uses CentOS-based KVM as the hypervisor.  Other options on CE we do not.  But, with the KVM Management Tool, available in the GUI, it is quite convenient to work in KVM. <br><br>  After downloading and prior to installation, you can make several optional settings: <br>  Edit the file /home/install/phx_iso/phoenix/sysUtil.py, specifying (changing) the lines there: "SSD_rdIOPS_thresh = 5000" and "SSD_wrIOPS_thresh = 5000", this will help if you have a not quite suitable SSD. <br><br>  Edit the size of memory allocated for the needs of the CVM. <br>  There, in the /home/install/phx_iso/phoenix/sysUtil.py file, edit the line ‚ÄúSVM_GB_RAM = 16‚Äù (this is the amount of memory that will be allocated to the CVM in gigabytes). <br><br>  Remember, however, that memory for CVM is urgently needed, and reducing its volume can significantly reduce speed. <br>  Login to the console: root, password: nutanix / 4u (10 characters, all small, the eighth - slash). <br><br>  We start the installation by logging in as the <b>install</b> user. <br><br>  Promiscous Mode should be enabled on the vSwitch switch to which VMs with Nutanix CE are connected, otherwise CVM will not be seen. <br><br>  Is done.  For example, using such a nested install, we managed to put Nutanix CE under ESXi 5.5U2 on an HP ProLiant server, which is not suitable for installing CE equipment. <br><br>  However, remember that the performance of such a solution may be far from what it can show "on hardware", however, to "see" or learn how, you can use this option. </div><p>Source: <a href="https://habr.com/ru/post/268823/">https://habr.com/ru/post/268823/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268813/index.html">Engineering infrastructure as the basis of the information system</a></li>
<li><a href="../268815/index.html">Not all widgets are equally useful.</a></li>
<li><a href="../268817/index.html">Jii: Scalable comets server and client</a></li>
<li><a href="../268819/index.html">Adobe has updated its products</a></li>
<li><a href="../268821/index.html">CISCO 7942G and 7940 phones in conjunction with Asterisk 11</a></li>
<li><a href="../268825/index.html">Angular XSLT module</a></li>
<li><a href="../268827/index.html">How to do without WDS server when installing Windows from WIM images over a network</a></li>
<li><a href="../268829/index.html">Microsoft fixed Windows kernel vulnerabilities</a></li>
<li><a href="../268833/index.html">Restoring the window size upon restart, a lot of fixes in Vivaldi 1.0.298.15. Plus movie</a></li>
<li><a href="../268837/index.html">Visual Studio Code - the evolution of the cross-platform code editor on the example of the version for OS X</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>