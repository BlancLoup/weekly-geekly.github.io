<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zabbix. Sending a trigger with a comment</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings 
 I decided to share a small scratch (slightly modified original) by sending notifications in Zabbix with user comments. 
 The essence of th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zabbix. Sending a trigger with a comment</h1><div class="post__text post__text-html js-mediator-article">  Greetings <br>  I decided to share a small scratch (slightly modified original) by sending notifications in Zabbix with user comments. <br>  The essence of the problem: at work, Zabbix is ‚Äã‚Äãused mainly for monitoring remote networks (availability, some quality).  In the absence of communication with the remote network, we must notify certain departments of this by job descriptions.  It was not difficult to set up a regular mail dispatch, but with such dispatch, the departments lacked clarity - for what reason the ‚Äúnetwork‚Äù was disconnected, how long it would not be.  Therefore, I set out to insert a comment in the dashboard that was sent to the dashboard when the trigger was confirmed. <a name="habracut"></a><br>  In essence, this is the same script that lies in the official Zabbix documentation with one small insert: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/bash to=$1 #  subject=$2 #  body=$3 #  status="$(echo $body | cut -d\; -f3)" # ,   if text0='   ,  : ' text1='   30 .' text2=':' text3=':' text4=':' text5='    :' text6='        : ' text7='Original event ID:' text8='  :' text9='    :' ack=`echo "select message FROM acknowledges WHERE eventid='$(echo $body | cut -d\; -f1)'" | mysql -uuser -ppassword -Dzabbix` #     if [[ $status = "PROBLEM" ]]; then #if- ,               cat &lt;&lt;EOF | mail -s "$subject" "$to" $text0 $(echo $body | cut -d\; -f2) $text1 $text2 $(echo $body | cut -d\; -f3) $text3 $(echo $body | cut -d\; -f4) $text4 $text5 $(echo $body | cut -d\; -f5) $(echo $body | cut -d\; -f6) $text6 $text8 $ack $text7 $(echo $body | cut -d\; -f1) EOF else cat &lt;&lt;EOF | mail -s "$subject" "$to" $text0 $(echo $body | cut -d\; -f2) $text1 $text2 $(echo $body | cut -d\; -f3) $text3 $(echo $body | cut -d\; -f4) $text4 $text9 $(echo $body | cut -d\; -f5) $(echo $body | cut -d\; -f6) $text6 $text8 $ack $text7 $(echo $body | cut -d\; -f1) EOF fi</span></span></code> </pre> <br><br>  Now about setting up actions: <br><img src="//habrastorage.org/files/e71/403/0e2/e714030e26bd4eaf8068d93683953086.jpg"><br><img src="//habrastorage.org/files/685/088/05f/68508805f11341499bcf8ad3f14a663a.jpg"><br><img src="//habrastorage.org/files/c47/04e/18f/c4704e18f4ab495cb0377a4fd938ebfb.jpg"><br><img src="//habrastorage.org/files/ec4/c40/7e1/ec4c407e15294736b1db1b5384063811.jpg"><br>  In my case, sending a message occurs 30 minutes later, after a trigger occurs, due to the fact that it takes time to clarify information about the causes of network unavailability and its elimination.  After 30 minutes, if the problem is not resolved, users who are in the notification group will be notified. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Script flaws: <br>  1) The script does not understand multi-line comments.  In this case, it sends the text in an attachment.  Who knows how to fix - share the thought. <br>  2) Since  I can say the only one who interacts with the zabbiks front end ‚Äî I did not insert the author of the comment.  But it is in principle feasible: <br><pre> <code class="bash hljs">userid=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"select userid FROM acknowledges WHERE eventid='</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(echo $body | cut -d\; -f1)</span></span></span><span class="hljs-string">'"</span></span> | mysql -uuser -ppassword -Dzabbix` user=`<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"select alias [   name  surname -     ] FROM users WHERE userid=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$userid</span></span></span><span class="hljs-string">"</span></span> | mysql -uuser -ppassword -Dzabbix`</code> </pre> <br>  3) Made through standard mail, you can redo it through mutt to add html and make everything beautiful. <br><br>  Now about the features.  The location of the host is taken from ‚ÄúInventory data‚Äù - ‚ÄúLocation‚Äù <br>  Separator - ";" <br>  Text written in action: <br><blockquote>  {EVENT.ID}; {INVENTORY.LOCATION1}; {TRIGGER.STATUS}; {TRIGGER.SEVERITY}; {EVENT.DATE}; {EVENT.TIME} </blockquote><br><br>  In principle, you can change anything, the main thing is to find the corresponding macro, which can be viewed <a href="https://www.zabbix.com/documentation/ru/2.0/manual/appendix/macros/supported_by_location">here.</a> <br><br>  I understand that this is too small a fix, but maybe someone will come in handy. <br><br>  <b>UPD:</b> Here on the forum, a week later it was suggested that I invented the bicycle, and it was enough to add <b>{EVENT.ACK.HISTORY}</b> to the standard output method. </div><p>Source: <a href="https://habr.com/ru/post/223279/">https://habr.com/ru/post/223279/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223257/index.html">Simple Science - Digest of Experiences # 32</a></li>
<li><a href="../223259/index.html">Udemy programming courses for $ 10 instead of $ 100</a></li>
<li><a href="../223263/index.html">Similar goals. New search tool for like minded people</a></li>
<li><a href="../223267/index.html">OTTO: Raspberry Pi camera with customization capability</a></li>
<li><a href="../223273/index.html">Gypsum on a 3D printer and other ideas from Tolstoy Camp teams, and also - do you need it?</a></li>
<li><a href="../223283/index.html">Service to find music again found guilty of piracy</a></li>
<li><a href="../223287/index.html">Interview with the creator of the game River Raid, Carol Shaw</a></li>
<li><a href="../223289/index.html">New lambda features in C ++ 14</a></li>
<li><a href="../223291/index.html">Thingiverse Service - Universe for 3d printing</a></li>
<li><a href="../223293/index.html">WavPlayer - we are not looking for easy ways, we are laying them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>