<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SonataAdminBundle: Creating an Object from a List View (Part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Formulation of the problem 
 In the first part of the article, we created a button in the List View line of letters that takes us to the form for crea...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SonataAdminBundle: Creating an Object from a List View (Part 2)</h1><div class="post__text post__text-html js-mediator-article"><h2>  Formulation of the problem </h2><br>  In the <a href="https://habrahabr.ru/post/278987/">first part of the</a> article, we created a button in the List View line of letters that takes us to the form for creating an answer.  However, at least two important questions remained unresolved: <br><ol><li>  automatic linking of the response to the letter </li><li>  checking the user's rights to create a response </li></ol><br><a name="habracut"></a><br><h2>  Automatic linking of the response to the letter </h2><br>  There are at least three ways to automatically link a response to a letter at the SonataAdminBundle level: <br>  1) <b>After</b> creating the form before saving the response entity to the database (for this, you can use the prePersist method of the Admin object).  The main feature of this method is the ‚Äúopacity‚Äù of attaching one entity to another for a user working with a form, which can serve both as a strength and a disadvantage depending on the goals. <br>  2) <b>While</b> creating the form by setting the value of the required field using formBuilder.  This approach can lead to undesirable cluttering of the admin class with a code that implements the logic for generating the default field value. <br>  3) <b>Before</b> creating the form.  To do this, you can use the approach proposed, for example, in <a href="https://habr.com/ru/post/279203/">[1]</a> , which is to override the parent method of the getNewInstance Admin class.  An alternative to this solution may be inheritance from a CRUD controller (the inheritance process is described in detail in <a href="https://habr.com/ru/post/279203/">[2]</a> ) and the definition of a hook operation <a href="https://habr.com/ru/post/279203/">[3]</a> preCreate in it.  One of the advantages of such an alternative is the ‚Äúfull-time‚Äù ability to return a full-featured \ Symfony \ Component \ HttpFoundation \ Response () object if necessary. <br>  Which method to use depends on the problem to be solved, we consider the third one using inheritance from a CRUD controller, since, in our opinion, it is the least obvious from the point of view of implementation and the most flexible from the point of view of architecture. <br>  First of all, add the third argument to the admin.getRouteGenerator.generateUrl () function.  This should be an array of request parameters and we will add to it the letter identifier, from the line of which we create the answer.  To do this, use the admin.getUrlsafeIdentifier () function. <br><br><pre><code class="html hljs xml">{# src/AppBundle/Resources/views/CRUD/list__action_create_other_admin.html.twig #} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ admin.getRouteGenerator.generateUrl(template_variables.otherAdmin, 'create', {'incoming_id': admin.getUrlsafeIdentifier(object)}) }}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-sm btn-default edit_link"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-plus"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Thus, clicking on a link will allow you to access the createAction of the CRUD controller, passing the message identifier of the message you need as the query parameter incoming_id_.  Now the task is reduced to receiving the letter object by identifier and attaching an answer to it.  We will solve it by defining the default default preCreate method, which can return an \ Symfony \ Component \ HttpFoundation \ Response () object or return nothing just by modifying $ object. <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Application</span></span>\<span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Response</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">CRUDController</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseController</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">Request</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CRUDController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Request $request, $object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  Response -   ,    \Symfony\Component\HttpFoundation\Response() if ($object instanceof Response) { //     if ($incomingId = $request-&gt;get('incoming_id')) { //       if($incoming = $this-&gt;getDoctrine()-&gt;getRepository('AppBundle:Incoming')-&gt;find($incomingId)) { //     $object-&gt;setIncoming($incoming); //    ,     $incoming-&gt;setResponse($object); } } } } }</span></span></code> </pre><br>  The main task set at the beginning of the article, namely: the creation of the essence of the answer from the ListView of letters is solved.  Consider the question of checking the user's rights to create a response 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Checking user rights to create a response </h2><br>  The direct question of setting the user's rights to create an answer lies outside the topic of this article and can be solved on the basis of the detailed information set out in <a href="https://habr.com/ru/post/279203/">[4]</a> .  We will consider the question of showing or hiding the ‚ÄúAdd Answer‚Äù button in the ListView of LETTERs, depending on whether the user has or does not have permission to create an ANSWER.  To do this, we will again have to make changes to the list__action_create_other_admin.html.twig file. <br><br><pre> <code class="html hljs xml">{# src/AppBundle/Resources/views/CRUD/list__action_create_other_admin.html.twig #} {% if template_variables.otherAdmin.securityHandler.isGranted(template_variables.otherAdmin, 'CREATE', template_variables.otherAdmin) and template_variables.otherAdmin.hasRoute('create') %} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{{ admin.getRouteGenerator.generateUrl(template_variables.otherAdmin, 'create', {'incoming_id': admin.getUrlsafeIdentifier(object)}) }}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"btn btn-sm btn-default edit_link"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">" "</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"fa fa-plus"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">i</span></span></span><span class="hljs-tag">&gt;</span></span>   <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> {% endif %}</code> </pre><br>  At the same time, we check the possibility of creating a response not only at the level of the security system, but also at the level of the routing system. <br><br><h2>  Summary </h2><br>  The article presents a solution to the problem of creating in SonataAdminBundle some entity from the ListView of the second entity associated with the first one, taking into account whether the user has or does not have the appropriate rights. <br><a name="sources"></a><br><h2>  Links to used resources </h2><br><ol><li>  <a href="http://blog.webdevilopers.net/populate-resp-set-default-values-on-form-resp-object-or-instance-in-sonataadminbundle/">Populate resp.</a>  <a href="http://blog.webdevilopers.net/populate-resp-set-default-values-on-form-resp-object-or-instance-in-sonataadminbundle/">set default values ‚Äã‚Äãon form resp.</a>  <a href="http://blog.webdevilopers.net/populate-resp-set-default-values-on-form-resp-object-or-instance-in-sonataadminbundle/">object or instance in SonataAdminBundle</a> </li><li>  <a href="https://sonata-project.org/bundles/admin/master/doc/cookbook/recipe_custom_action.html">CREATING A CUSTOM ADMIN ACTION</a> </li><li>  <a href="http://www.codelab.ru/task/221">Hook operations</a> </li><li>  <a href="https://sonata-project.org/bundles/admin/master/doc/reference/security.html">Security</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/279203/">https://habr.com/ru/post/279203/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279193/index.html">What to read about promising programming languages</a></li>
<li><a href="../279195/index.html">How easy and natural to write a game in 2 years</a></li>
<li><a href="../279197/index.html">GF (256) final field and some magic</a></li>
<li><a href="../279199/index.html">Jigsaw puzzle with regular expressions from LinkedIn</a></li>
<li><a href="../279201/index.html">Alternative Website Localization: CDN Mutating Content</a></li>
<li><a href="../279205/index.html">Militiamen took up whatsapp</a></li>
<li><a href="../279207/index.html">Installing applications in Cach√© using projections</a></li>
<li><a href="../279209/index.html">Big survey on algorithms</a></li>
<li><a href="../279211/index.html">9 secrets of online payments. Part 3: Payment Method Selection Page</a></li>
<li><a href="../279213/index.html">Pandasql vs Pandas for solving data analysis tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>