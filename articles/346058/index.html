<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Outputting tabular data to the console, file or MS Excel in the style of C ++ threads</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The note suggests a set of C ++ classes (performance tested in VS2008 and VS 2013; only C ++ 03 and STL is used) for outputting tabled formatting data...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Outputting tabular data to the console, file or MS Excel in the style of C ++ threads</h1><div class="post__text post__text-html js-mediator-article">  The note suggests a set of C ++ classes (performance tested in VS2008 and VS 2013; only C ++ 03 and STL is used) for outputting tabled formatting data to the std :: ostream stream.  As is distributed. <br><br><pre><code class="hljs matlab">st &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Property"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Value"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; enum {nr = <span class="hljs-number"><span class="hljs-number">10</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; nr; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { st &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Prop"</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; }</code> </pre> <br>  The result will look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yb/sv/lr/ybsvlr4ea9x_6fxztmc5q6ppnm4.png"></div><br><a name="habracut"></a><br>  Already in the process of preparing the notes, I found a similar project <a href="https://github.com/dattanchu/bprinter/wiki">bprinter</a> (I didn‚Äôt make a detailed comparison; there is a dependency on Boost :: Spirit, which is not always convenient), which is the equivalent of my file 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">StreamTable.h</b> <div class="spoiler_text"><pre> <code class="hljs lua">#ifndef __STREAM_TABLE_H #define __STREAM_TABLE_H #undef <span class="hljs-built_in"><span class="hljs-built_in">max</span></span> #undef <span class="hljs-built_in"><span class="hljs-built_in">min</span></span> #include &lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; #include &lt;vector&gt; #include &lt;algorithm&gt; #include &lt;iostream&gt; //    #define CRLF <span class="hljs-string"><span class="hljs-string">"\n"</span></span> //    //#define CRLF std::endl /** *        *     C++ */ class StreamTable { public: std::ostream &amp;os_; StreamTable(std::ostream &amp;<span class="hljs-built_in"><span class="hljs-built_in">os</span></span> = std::cout, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimRow = <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimCol = <span class="hljs-string"><span class="hljs-string">' '</span></span>) : borderExtOn_(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), delimRowOn_(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), delimRow_(delimRow), delimColOn_(<span class="hljs-literal"><span class="hljs-literal">true</span></span>), delimCol_(delimCol), os_(<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>), colIndex_(<span class="hljs-number"><span class="hljs-number">0</span></span>), firstCell_(<span class="hljs-number"><span class="hljs-number">1</span></span>) {} virtual ~StreamTable() {} virtual std::ostream &amp;<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>() const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> os_; } //  ? void MakeBorderExt(bool on) { borderExtOn_ = on; } //   void SetDelimRow(bool delimOn, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimRow = <span class="hljs-string"><span class="hljs-string">' '</span></span>) { delimRowOn_ = delimOn; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delimRowOn_) delimRow_ = delimRow; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!delimColOn_) MakeBorderExt(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } //   void SetDelimCol(bool delimOn, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimCol = <span class="hljs-string"><span class="hljs-string">' '</span></span>) { delimColOn_ = delimOn; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delimColOn_) delimCol_ = delimCol; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!delimRowOn_) MakeBorderExt(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); } int AddCol(int colWidth, bool visible = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) { colWidth_.push_back(colWidth); visible_.push_back(visible); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> colWidth_.back(); } void SetVisible(int col, bool flg) { visible_[col - <span class="hljs-number"><span class="hljs-number">1</span></span>] = flg; } void SetCols(int colCount, int colWidth = <span class="hljs-number"><span class="hljs-number">0</span></span>) { Clear(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int ic = <span class="hljs-number"><span class="hljs-number">0</span></span>; ic &lt; colCount; ic++) { AddCol(colWidth); } } virtual void Clear() { colWidth_.clear(); visible_.clear(); colIndex_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; firstCell_ = <span class="hljs-number"><span class="hljs-number">1</span></span>; } void AddEmptyRow() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int ic = <span class="hljs-number"><span class="hljs-number">0</span></span>; ic &lt; (int)colWidth_.size(); ic++) { *this &lt;&lt; <span class="hljs-string"><span class="hljs-string">""</span></span>; } } template &lt;typename T&gt; StreamTable &amp;operator &lt;&lt; (const T &amp;obj) { Push(obj); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *this; } StreamTable &amp;operator &lt;&lt; (const std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;s) { colWidth_[colIndex_] = std::<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(colWidth_[colIndex_], (int)s.size() + <span class="hljs-number"><span class="hljs-number">1</span></span>); Push(s); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *this; } StreamTable &amp;operator &lt;&lt; (const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *s) { colWidth_[colIndex_] = std::<span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(colWidth_[colIndex_], (int)strlen(s) + <span class="hljs-number"><span class="hljs-number">1</span></span>); Push(s); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *this; } protected: int colIndex_; private: bool borderExtOn_; bool delimRowOn_; <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimRow_; bool delimColOn_; <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> delimCol_; std::vector&lt;int&gt; colWidth_; bool firstCell_; std::vector&lt;int&gt; visible_; template &lt;typename T&gt; void Push(const T &amp;obj) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (firstCell_) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (borderExtOn_) MakeRowBorder(); firstCell_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visible_[colIndex_]) { DelimCol(); os_.width(colWidth_[colIndex_]); os_.fill(<span class="hljs-string"><span class="hljs-string">' '</span></span>); os_ &lt;&lt; /*std::setiosflags(std::ios::left) &lt;&lt; */obj; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (++colIndex_ == (int)colWidth_.size()) { DelimCol(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delimRowOn_) MakeRowBorder(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> os_ &lt;&lt; CRLF; colIndex_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } void MakeRowBorder() { os_ &lt;&lt; CRLF; DelimCol(); int ic; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ic = <span class="hljs-number"><span class="hljs-number">0</span></span>; ic &lt; (int)colWidth_.size(); ic++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (visible_[ic]) { os_.width(colWidth_[ic] + <span class="hljs-number"><span class="hljs-number">1</span></span>); os_.fill(delimRow_); DelimCol(); } } os_ &lt;&lt; CRLF; } void DelimCol() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (delimColOn_ &amp;&amp; (borderExtOn_ || colIndex_)) os_ &lt;&lt; delimCol_; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> os_ &lt;&lt; <span class="hljs-string"><span class="hljs-string">' '</span></span>; } //   StreamTable &amp;operator = (const StreamTable &amp;); }; #endif // __STREAM_TABLE_H</code> </pre><br></div></div><br>  The StreamTable class allows displaying table data line by line in the C ++ stream format.  It accepts a link to std :: ostream in the constructor, so besides std :: cout (by default) you can write to the file by passing std :: ofstream &amp;.  It is useful when forming a log file with the results of the calculation. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;sstream&gt; #include "StreamTable.h" void TestStreamTable1() { StreamTable st(std::cout); st.AddCol(5); st.AddCol(15); st.AddCol(10); st.AddCol(10); //,      //st.Clear(); //st.SetCols(4, 10); //st.SetVisible(1, false);//   st.MakeBorderExt(true); st.SetDelimRow(true, '-');//st.SetDelimRow(false);// -  st.SetDelimCol(true, '|');//st.SetDelimCol(false);// -  //     st &lt;&lt; "#" &lt;&lt; "Property" &lt;&lt; "Value" &lt;&lt; "Unit"; enum {nr = 10}; for (int i = 0; i &lt; nr; i++) { st &lt;&lt; i + 1 &lt;&lt; "Prop" &lt;&lt; i &lt;&lt; "Unit"; } }</span></span></span></span></code> </pre><br>  To enable the use of StreamTable for uploading to MS Excel, a special excelstream stream and an auxiliary class for working with MS Excel were implemented: <br><br><div class="spoiler">  <b class="spoiler_title">MSExcel.h file</b> <div class="spoiler_text"><pre> <code class="hljs lua">#pragma once #include &lt;sstream&gt; #import <span class="hljs-string"><span class="hljs-string">"C:\Program Files (x86)\Common Files\Microsoft Shared\Office12\MSO.DLL"</span></span> \ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"RGB"</span></span>,<span class="hljs-string"><span class="hljs-string">"_RGB"</span></span>)\ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"DocumentProperties"</span></span>, <span class="hljs-string"><span class="hljs-string">"_DocumentProperties"</span></span>)\ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"SearchPath"</span></span>,<span class="hljs-string"><span class="hljs-string">"_SearchPath"</span></span>) #import <span class="hljs-string"><span class="hljs-string">"C:\Program Files (x86)\Common Files\Microsoft Shared\VBA\VBA6\VBE6EXT.OLB"</span></span> #import <span class="hljs-string"><span class="hljs-string">"C:\Program Files (x86)\Microsoft Office\Office12\EXCEL.EXE"</span></span> \ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"DialogBox"</span></span>,<span class="hljs-string"><span class="hljs-string">"_DialogBox"</span></span>) \ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"RGB"</span></span>,<span class="hljs-string"><span class="hljs-string">"_RGB"</span></span>) \ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"CopyFile"</span></span>, <span class="hljs-string"><span class="hljs-string">"_CopyFile"</span></span>) \ <span class="hljs-built_in"><span class="hljs-built_in">rename</span></span>(<span class="hljs-string"><span class="hljs-string">"ReplaceText"</span></span>, <span class="hljs-string"><span class="hljs-string">"_ReplaceText"</span></span>) \ no_auto_exclude #define THROW(msg) throw std::exception(msg); /** * */ class ExcelLoader { public: virtual ~ExcelLoader() { Close(); } Excel::_ApplicationPtr excel_; Excel::_WorksheetPtr sheet_; Excel::RangePtr range_; //  Excel,         void Detach() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!excel_) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; range_.Detach(); range_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; sheet_.Detach(); sheet_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; excel_.Detach(); excel_ = <span class="hljs-number"><span class="hljs-number">0</span></span>; ::CoUninitialize(); } //       LoadExcel void Close() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!excel_) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; try { excel_-&gt;DisplayAlerts[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; excel_-&gt;Quit(); excel_-&gt;DisplayAlerts[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; Detach(); //todo:  MS Excel <span class="hljs-number"><span class="hljs-number">2010</span></span> ,  CoUninitialize     std::system(<span class="hljs-string"><span class="hljs-string">"taskkill /F /IM Excel.exe"</span></span>); //   EXCEL <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (FindWindow(<span class="hljs-string"><span class="hljs-string">"XLMAIN"</span></span>, NULL)) {}; } catch (_com_error &amp;er) { THROW(er.ErrorMessage()); } } //     LoadExcel void Save() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!excel_) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; excel_-&gt;DisplayAlerts[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; try { excel_-&gt;Save(); } catch (_com_error &amp;er) { THROW(er.ErrorMessage()); } excel_-&gt;DisplayAlerts[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } // Excel      ws_index (&gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>)   fname void LoadExcel(const std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;fname, int ws_index) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(::CoInitialize(NULL))) THROW(<span class="hljs-string"><span class="hljs-string">"CoInitialize failure"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (FAILED(excel_.CreateInstance(<span class="hljs-string"><span class="hljs-string">"Excel.Application"</span></span>))) { std::stringstream ss; ss &lt;&lt; <span class="hljs-string"><span class="hljs-string">"CreateInstance failed: "</span></span> &lt;&lt; GetLastError(); std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> msg = ss.str(); THROW(msg.c_str()); } excel_-&gt;Visible[<span class="hljs-number"><span class="hljs-number">0</span></span>] = TRUE; Excel::_WorkbookPtr book = excel_-&gt;Workbooks-&gt;Open(fname.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!book) THROW(std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>(<span class="hljs-string"><span class="hljs-string">"Can't open "</span></span>).append(fname).append(<span class="hljs-string"><span class="hljs-string">": Workbooks-&gt;Open method failed"</span></span>).c_str()); sheet_ = excel_-&gt;ActiveSheet; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ws_index &lt; <span class="hljs-number"><span class="hljs-number">1</span></span> || excel_-&gt;Sheets-&gt;Count &lt; ws_index) THROW(<span class="hljs-string"><span class="hljs-string">"ws_index_ must be in [1, Sheets.Count]"</span></span>); sheet_ = excel_-&gt;Sheets-&gt;Item[ws_index]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!sheet_) THROW(<span class="hljs-string"><span class="hljs-string">"Failed to get a pointer to the active sheet"</span></span>); range_ = sheet_-&gt;Cells; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!range_) THROW(<span class="hljs-string"><span class="hljs-string">"Failed to get a pointer to the cells on the active sheet"</span></span>); } };</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ExcelStream.h file</b> <div class="spoiler_text"><pre> <code class="hljs lua">#pragma once #include &lt;sstream&gt; #include <span class="hljs-string"><span class="hljs-string">"MSExcel.h"</span></span> typedef <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> CharT; typedef std::char_traits&lt;CharT&gt; TraitsT; class excel_stringbuf : public std::basic_stringbuf&lt;CharT, TraitsT&gt; { public: static const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> colDelim = <span class="hljs-string"><span class="hljs-string">'\t'</span></span>; static const <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> rowDelim = <span class="hljs-string"><span class="hljs-string">'\n'</span></span>; virtual ~excel_stringbuf() { sync(); } void SetRange(Excel::RangePtr pRange, int irow_offset, int icol_offset) { rng_ = pRange; //        irow_ = irow_offset; icol_offset_ = icol_offset; icol_ = icol_offset; } Excel::RangePtr GetRange() const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rng_; } int &amp;CurRow() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> irow_; } int &amp;CurCol() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> icol_; } int sync() { output_string(str().c_str()); str(std::basic_string&lt;CharT&gt;());//   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } protected: Excel::RangePtr rng_; int irow_; int icol_offset_; int icol_; //    isspace       bool IsSpace(<span class="hljs-built_in"><span class="hljs-built_in">char</span></span> c) const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (c == colDelim) || (c == rowDelim) || (c == <span class="hljs-string"><span class="hljs-string">'\r'</span></span>); } /** *   s   Excel. *          <span class="hljs-string"><span class="hljs-string">'\t'</span></span>, *     - <span class="hljs-string"><span class="hljs-string">'\n'</span></span>. * :   <span class="hljs-string"><span class="hljs-string">"1\t2\n3\t4 5"</span></span>     * (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> * (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-number"><span class="hljs-number">2</span></span> * (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-number"><span class="hljs-number">3</span></span> * (<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) = <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span>, *  (i,j) -   * todo:     / */ void output_string(const std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;s); }; void excel_stringbuf::output_string(const std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;s) { //    ,    (\n \t) std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator be = s.begin(); std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator en = s.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>::const_iterator it = be; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (it != en) { bool <span class="hljs-built_in"><span class="hljs-built_in">dump</span></span> = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; bool isTab = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; bool isEnd = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; //       , //       (iRow, iCol) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*it == colDelim) { isTab = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">dump</span></span> = !IsSpace(*be); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*it == rowDelim) { isEnd = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">dump</span></span> = !IsSpace(*be); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { //     ,    be <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IsSpace(*be)) be = it; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it + <span class="hljs-number"><span class="hljs-number">1</span></span> == en) { //       <span class="hljs-built_in"><span class="hljs-built_in">dump</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; //    ,  //it     it = en; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">dump</span></span>) { //        [be, it) const std::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> &amp;item = s.substr(be - s.begin(), it - be); rng_-&gt;Item[irow_][icol_] = _variant_t(item.c_str()); } //       <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isTab) { icol_++; be = it; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isEnd) { irow_++; icol_ = icol_offset_; be = it; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it == en) { //   <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> it++; } } /** *     Excel     STL  */ class excelstream : public std::basic_ostream&lt;CharT, TraitsT&gt; { public: excelstream(Excel::RangePtr &amp;rng, int irow_offset = <span class="hljs-number"><span class="hljs-number">1</span></span>, int icol_offset = <span class="hljs-number"><span class="hljs-number">1</span></span>) : std::basic_ostream&lt;CharT, TraitsT&gt;(&amp;buf_) { buf_.SetRange(rng, irow_offset, icol_offset); } virtual ~excelstream() { <span class="hljs-built_in"><span class="hljs-built_in">flush</span></span>(); } private: excel_stringbuf buf_; };</code> </pre><br></div></div><br>  Attention, since in MSExcel.h is used #import, then for compilation it is necessary to register the actual paths to MSO.DLL, VBE6EXT.OLB, EXCEL.EXE in accordance with the installed version of MS Office. <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;sstream&gt; #include "StreamTable.h" #include "ExcelStream.h" void TestStreamTable2() { // ExcelLoader xls; xls.LoadExcel("C:/log.xlsx", 1); excelstream os(xls.range_, 1, 1);//    StreamTable st(os); st.SetCols(4);//todo:   Excel-    st.MakeBorderExt(false);//,      st.SetDelimRow(false);//,      st.SetDelimCol(true, excel_stringbuf::colDelim);//, .. excel_stringbuf       colDelim //  st &lt;&lt; "#" &lt;&lt; "Property" &lt;&lt; "Value" &lt;&lt; "Unit"; enum { nr = 10 }; for (int i = 0; i &lt; nr; i++) { st &lt;&lt; i + 1 &lt;&lt; "Prop" &lt;&lt; i &lt;&lt; "Unit"; } os.flush(); xls.Detach();// Detach  os  st  }</span></span></span></span></code> </pre><br>  The excelstream stream in the StreamTable works in such a way that its buffer parses the unloading string, in which the character '\ t' is interpreted as a transition to a column to the right, and '\ n' - as a character of transition to the next line.  The example below is similar to TestStreamTable2 in result and shows the principle of forming such a string. <br><br><pre> <code class="hljs lua">#include &lt;sstream&gt; #include <span class="hljs-string"><span class="hljs-string">"ExcelStream.h"</span></span> void TestStreamTable3() { ExcelLoader xls; xls.LoadExcel(<span class="hljs-string"><span class="hljs-string">"C:/log.xlsx"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); excelstream <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>(xls.range_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">os</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#\tProperty\tValue\tUnit\n"</span></span>; std::stringstream ss; enum { nr = <span class="hljs-number"><span class="hljs-number">10</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nr; i++) { <span class="hljs-built_in"><span class="hljs-built_in">os</span></span> &lt;&lt; i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\tProp\t"</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\tUnit\n"</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">flush</span></span>(); xls.Detach();// Detach  <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>  st  }</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">File with all examples of main.cpp</b> <div class="spoiler_text"><pre> <code class="hljs lua">#include &lt;sstream&gt; #include <span class="hljs-string"><span class="hljs-string">"StreamTable.h"</span></span> #include <span class="hljs-string"><span class="hljs-string">"ExcelStream.h"</span></span> void TestStreamTable1() { StreamTable st(std::cout); st.AddCol(<span class="hljs-number"><span class="hljs-number">5</span></span>); st.AddCol(<span class="hljs-number"><span class="hljs-number">15</span></span>); st.AddCol(<span class="hljs-number"><span class="hljs-number">10</span></span>); st.AddCol(<span class="hljs-number"><span class="hljs-number">10</span></span>); //,      //st.Clear(); //st.SetCols(<span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">10</span></span>); //st.SetVisible(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>);//   st.MakeBorderExt(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); st.SetDelimRow(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">'-'</span></span>);//st.SetDelimRow(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);// -  st.SetDelimCol(<span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">'|'</span></span>);//st.SetDelimCol(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);// -  //     st &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Property"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Value"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; enum {nr = <span class="hljs-number"><span class="hljs-number">10</span></span>}; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nr; i++) { st &lt;&lt; i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Prop"</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; } } void TestStreamTable2() { // ExcelLoader xls; xls.LoadExcel(<span class="hljs-string"><span class="hljs-string">"C:/log.xlsx"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); excelstream <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>(xls.range_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>);//    StreamTable st(<span class="hljs-built_in"><span class="hljs-built_in">os</span></span>); st.SetCols(<span class="hljs-number"><span class="hljs-number">4</span></span>);//todo:   Excel-    st.MakeBorderExt(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);//,      st.SetDelimRow(<span class="hljs-literal"><span class="hljs-literal">false</span></span>);//,      st.SetDelimCol(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, excel_stringbuf::colDelim);//, .. excel_stringbuf       colDelim //  st &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Property"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Value"</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; enum { nr = <span class="hljs-number"><span class="hljs-number">10</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nr; i++) { st &lt;&lt; i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Prop"</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">"Unit"</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">flush</span></span>(); xls.Detach();// Detach  <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>  st  } void TestStreamTable3() { ExcelLoader xls; xls.LoadExcel(<span class="hljs-string"><span class="hljs-string">"C:/log.xlsx"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); excelstream <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>(xls.range_, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">os</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"#\tProperty\tValue\tUnit\n"</span></span>; std::stringstream ss; enum { nr = <span class="hljs-number"><span class="hljs-number">10</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; nr; i++) { <span class="hljs-built_in"><span class="hljs-built_in">os</span></span> &lt;&lt; i + <span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\tProp\t"</span></span> &lt;&lt; i &lt;&lt; <span class="hljs-string"><span class="hljs-string">"\tUnit\n"</span></span>; } <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">flush</span></span>(); xls.Detach();// Detach  <span class="hljs-built_in"><span class="hljs-built_in">os</span></span>  st  } void main() { try { TestStreamTable1(); TestStreamTable2(); TestStreamTable3(); } catch(std::exception &amp;ex) { std::cout &lt;&lt; ex.what(); } }</code> </pre><br></div></div><br><br>  In conclusion, I note that with regard to excelstream, his work was not checked as a polymorphic pointer to std :: ostream, so in this part the class should be refined. </div><p>Source: <a href="https://habr.com/ru/post/346058/">https://habr.com/ru/post/346058/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../346042/index.html">5-minute guide to esoteric programming languages: why they are needed</a></li>
<li><a href="../346048/index.html">[Translation] IOHIDeous - New Year's zero-day vulnerability from macOS</a></li>
<li><a href="../346050/index.html">Wake up, and your application is on the main in the App Store</a></li>
<li><a href="../346052/index.html">MikroTik and blocking unwanted sites (for example, youtube and facebook)</a></li>
<li><a href="../346054/index.html">Performance consoles and shells</a></li>
<li><a href="../346062/index.html">IaaS for non-IT companies: 10 answers to director's questions</a></li>
<li><a href="../346064/index.html">How to build a community. Translation of the book "Social Architecture": Preface. Crowd wisdom</a></li>
<li><a href="../346066/index.html">Github flow</a></li>
<li><a href="../346068/index.html">‚ÄúNot again, but again‚Äù: Sea-Me-We 3 submarine cable failed for the second time in a year</a></li>
<li><a href="../346070/index.html">Who "leaves the clouds": Western IT startups who abandoned the virtual infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>