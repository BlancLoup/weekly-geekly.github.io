<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Generating numbers for lucky tickets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of a small test task, it was necessary to implement the old and well-known task with the search for the number of lucky tickets (user-specifie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Generating numbers for lucky tickets</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ac6/a50/97d/ac6a5097dda0bb178d2d4238864be371.jpg" alt="Happy ticket" align="right"><br>  As part of a small test task, it was necessary to implement the old and well-known task with the search for the number of <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2587%25D0%25B0%25D1%2581%25D1%2582%25D0%25BB%25D0%25B8%25D0%25B2%25D1%258B%25D0%25B9_%25D0%25B1%25D0%25B8%25D0%25BB%25D0%25B5%25D1%2582">lucky tickets</a> (user-specified digit capacity).  Strangely enough, with a large number of sources with a <a href="http://www.ega-math.narod.ru/Quant/Tickets.htm">mathematical description of the algorithm</a> , there were few real examples of the implementation of the optimized version (without iteration), but still this part of the task was not a big problem. <br><br>  In the second part, it was necessary to display the numbers themselves, and here a quick search in the network did not give the expected result.  However, the problem is solved, and I would like to share implementations with the habrasoobshchestvo for the sake of obtaining critical opinions and disseminating information for those who may need similar or similar algorithms. <br><a name="habracut"></a><br><h5>  Pro search for the number of lucky tickets </h5><br>  For a start, a few words about the search for the number of lucky numbers (a happy number is understood if the sum of digits on the left side of the number is equal to the sum of digits on the right side of the number (‚Äúin Leningrad‚Äù)). <br><br>  Direct search of all possible options could solve the problem if the number of digits in the number was small (4, 6 or 8).  However, within the framework of the task, the bit length is set by the user and there are no special restrictions on the number (except logical ones - the number must be even and positive). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The optimized algorithm based on mathematics has been <a href="http://www.ega-math.narod.ru/Quant/Tickets.htm">described</a> many times, including on <a href="http://habrahabr.ru/post/13235/">habrahabr</a> , therefore I will not bring it fully verbally.  The implementation will be shown in the code as two functions.  The code is written in PHP. <br><pre><code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** *           * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $iNumber * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int[][] */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">numberCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($iNumber)</span></span></span><span class="hljs-function"> </span></span>{ $iHalf = (int)($iNumber / <span class="hljs-number"><span class="hljs-number">2</span></span>); $aData = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt;= $iHalf; $i++) { $iLength = $i * <span class="hljs-number"><span class="hljs-number">9</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($i == <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($j = <span class="hljs-number"><span class="hljs-number">0</span></span>; $j &lt; $iLength; $j++) $aData[$i][$j] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $iSum = <span class="hljs-number"><span class="hljs-number">0</span></span>; $k = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $k &lt;= $iLength / <span class="hljs-number"><span class="hljs-number">2</span></span>; $k++) { $iSum += $aData[$i - <span class="hljs-number"><span class="hljs-number">1</span></span>][$k]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($k &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span>) $iSum -= $aData[$i - <span class="hljs-number"><span class="hljs-number">1</span></span>][$k - <span class="hljs-number"><span class="hljs-number">10</span></span>]; $aData[$i][$k] = $iSum; } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; $k &lt; $iLength; $k++) { $aData[$i][$k] = $aData[$i][$iLength - <span class="hljs-number"><span class="hljs-number">1</span></span> - $k]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $aData; }</code> </pre> <br>  The first function takes as a parameter the digit capacity of the number and returns an array similar to the one shown <a href="http://www.ega-math.narod.ru/Quant/Tickets.htm">here</a> .  In the second function, we run through the array and sum up the squares of the sum of the variants of the combinations: <br><pre> <code class="hljs markdown">/<span class="hljs-emphasis"><span class="hljs-emphasis">** *</span></span>          <span class="hljs-bullet"><span class="hljs-bullet">* @param int $iNumber *</span></span> @return int|string <span class="hljs-emphasis"><span class="hljs-emphasis">*/ function countLuckyTicketFast($iNumber) { $iHalf = (int)($iNumber / 2); $aData = numberCount($iNumber); $iCount = 0; for ($i = 0; $i &lt;= $iHalf *</span></span> 9; $i++) { $iCount = function_exists('bcadd') ? bcadd($iCount, bcmul($aData[<span class="hljs-string"><span class="hljs-string">$iHalf</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">$i</span></span>], $aData[<span class="hljs-string"><span class="hljs-string">$iHalf</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">$i</span></span>])) : ($iCount + $aData[<span class="hljs-string"><span class="hljs-string">$iHalf</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">$i</span></span>] * $aData[<span class="hljs-string"><span class="hljs-string">$iHalf</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">$i</span></span>]); } return $iCount; }</code> </pre><br>  If the <a href="http://php.net/manual/ru/book.bc.php">BCMath</a> library is installed on the server with PHP, <a href="http://php.net/manual/ru/book.bc.php">we</a> use its functions for working with large numbers so that there are no problems with accuracy.  Otherwise, if the number is large, the result may be undefined (in practice, with the missing library, it was possible to calculate a maximum for a number with a length of 310 characters). <br>  At the output of the second function, we get the desired result: the number of lucky tickets for the specified number length. <br><br><h5>  A simple way to generate ticket numbers </h5><br>  Now let's try to display the entire list of the lucky numbers themselves. <br>  First of all, let's look at the simplest algorithm that makes it brute force. <br><pre> <code class="hljs perl">/** *     ,    * @param <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> $iNumber   * @param <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> $iLimit    * @param <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> $iStart  ,       * @return array *<span class="hljs-regexp"><span class="hljs-regexp">/ function generateSortedLuckyTicketList($iNumber, $iLimit, $iStart) { $iHalf = (int) ($iNumber /</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>); $i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $aNumbersCount = numberCount($iNumber); $iDelimiter = pow(<span class="hljs-number"><span class="hljs-number">10</span></span>, $iHalf); $iLeft = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) ($iStart / $iDelimiter); $iRight = $iStart - $iLeft * $iDelimiter; $aData = array(); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      $iLeftCount = <span class="hljs-number"><span class="hljs-number">0</span></span>; $iLeftSum = array_sum(str_split((string)$iLeft)); <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      $iRightSum = array_sum(str_split((string)$iRight)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($iLeftSum == $iRightSum) { $iValue = $iLeft * $iDelimiter + $iRight; $iLength = strlen((string)$iValue); $aData[] = (string)($iLength == $iNumber ? $iValue : (implode(<span class="hljs-string"><span class="hljs-string">''</span></span>, array_fill(<span class="hljs-number"><span class="hljs-number">0</span></span>, ($iNumber - $iLength), <span class="hljs-string"><span class="hljs-string">'0'</span></span>)) . $iValue)); $i++; $iLeftCount++; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>               -        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($iLeftCount &gt;= $aNumbersCount[$iHalf][$iLeftSum]) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } $iRight++; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($i &lt; $iLimit &amp;&amp; $iRight &lt; $iDelimiter); $iRight = <span class="hljs-number"><span class="hljs-number">1</span></span>; $iLeft++; } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($i &lt; $iLimit &amp;&amp; $iLeft &lt; $iDelimiter); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $aData; }</code> </pre><br>  As part of the function, a small optimization has been implemented, with checking the number of found numbers for the amount on the left of the number, which allows reducing the number of iterations in some specific cases. <br>  The algorithm given in this function does a good job when working with numbers up to 8 characters (with paginated output of happy variants of 50 pieces), however, it completely discredits itself on longer numbers, as the number of iterations grows exponentially. <br><br><h5>  Difficult but fast way to generate ticket numbers </h5><br>  As you can see, from the point of view of mathematics, combinatorics can be used to search for lucky numbers.  In search of a suitable algorithm (all the same, in the mathematics itself, knowledge is not so deep as to invent something of its own), after several unsuccessful attempts and constant stumbles on examples with simple enumeration for standard six-digit numbers, it was possible to find an algorithm for generating on the basis of binary logic and decomposition <a href="http://www.tusur.ru/ru/faculties/fsu/mathematics/chief.html">Kruchinina V.V.</a>  The existing <a href="http://window.edu.ru/resource/295/37295/files/2005_1_39-44.pdf">publication</a> on the topic describes quite well all the mathematics, however, it contains a number of omissions in the description of the implementation algorithm and several annoying errors in the given pseudocode (because of which I had to sit a lot on debugging the implementation). <br><br>  We describe briefly the main idea.  The list of all options consists of the sum of options, in which the digits in one of the parts of the number in the total take values ‚Äã‚Äãfrom 0 to n * 9 (where n is the number of characters in half the number).  Thus, each variant of a lucky combination of numbers has its own sequence number both within the list of numbers having the same amount, and within the entire list for the selected bit length.  As a result, you can choose any lucky option from the entire list by its ordinal number ranging from 1 to k (where k is the total number of lucky tickets for the specified number length).  However, it is worth clarifying that, within the framework of this algorithm, tickets selected from 1 to k will not be placed in <a href="http://ru.wikipedia.org/wiki/%25D0%259B%25D0%25B5%25D0%25BA%25D1%2581%25D0%25B8%25D0%25BA%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25BF%25D0%25BE%25D1%2580%25D1%258F%25D0%25B4%25D0%25BE%25D0%25BA">lexicographical</a> order.  If you are interested in the details of the search engine combination search by serial number on the basis of a binary tree, I advise you to carefully read the <a href="http://window.edu.ru/resource/295/37295/files/2005_1_39-44.pdf">original source</a> . <br><br>  So, I have divided the entire implementation into several functions, a couple of which are official for optimizing calculations.  It is worth mentioning that the above approach allows you to calculate the number of lucky numbers, however, by itself, it works more slowly than the existing mechanism already described. <br><br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** *       *   CDecomposition   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $j * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $m * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompositionCount</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($j, $n, $m)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($m == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ($n &lt;= <span class="hljs-number"><span class="hljs-number">9</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($m == $n) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($j &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $iRight = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;decompositionCountProxy($j - <span class="hljs-number"><span class="hljs-number">1</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m) + <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;decompositionCountProxy(<span class="hljs-number"><span class="hljs-number">9</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $iRight; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $iLeft = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;decompositionCountProxy(<span class="hljs-number"><span class="hljs-number">9</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $iLeft; } }</code> </pre><br>  Since this function is called many times with the same parameters, a proxy function was added that caches the result: <br><br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> int[]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $cacheCount = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** * -          * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $j * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $m * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> int */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decompositionCountProxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($j, $n, $m)</span></span></span><span class="hljs-function"> </span></span>{ $sKey = $j . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $n . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $m; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheCount[$sKey])) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheCount[$sKey] = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;decompositionCount($j, $n, $m); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheCount[$sKey]; }</code> </pre><br>  The following function generates a combination by its ordinal number: <br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** *         * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int[] $v -         * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $num -    * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $j * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $m */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDecomposition</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$v, $num, $j, $n, $m)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($m == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($n &gt; <span class="hljs-number"><span class="hljs-number">9</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt;= $n; $i++) $v[] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($m == $n) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">1</span></span>; $i &lt;= $n; $i++) $v[] = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $b = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;decompositionCountProxy($j - <span class="hljs-number"><span class="hljs-number">1</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($num &lt;= $b &amp;&amp; $j &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $v[] = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateDecomposition($v, $num, $j - <span class="hljs-number"><span class="hljs-number">1</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $v[] = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($j == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateDecomposition($v, $num, $j, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateDecomposition($v, $num - $b, <span class="hljs-number"><span class="hljs-number">9</span></span>, $n - <span class="hljs-number"><span class="hljs-number">1</span></span>, $m - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } } }</code> </pre><br>  As in the case with the decompostionCount function, I added a method for caching results and assembling from the resulting array with binary tree traversal data into a combination in decimal form: <br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string[]    */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $cacheValue = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-comment"><span class="hljs-comment">/** * -            * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $num   * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $j * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $n * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $m * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateDecompositionProxy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($num, $j, $n, $m)</span></span></span><span class="hljs-function"> </span></span>{ $sKey = $num . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $j . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $n . <span class="hljs-string"><span class="hljs-string">'_'</span></span> . $m; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheValue[$sKey])) { $v = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateDecomposition($v, $num, $j, $n, $m); $r = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $s = <span class="hljs-number"><span class="hljs-number">0</span></span>; $c = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (array_reverse($v) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($i == <span class="hljs-number"><span class="hljs-number">0</span></span>) { $c++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $r[] = $c; $c = <span class="hljs-number"><span class="hljs-number">0</span></span>; $s++; } } $r[] = $c; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheValue[$sKey] = implode(<span class="hljs-string"><span class="hljs-string">''</span></span>, $r); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cacheValue[$sKey]; }</code> </pre><br>  It remains to make on the basis of this base a method for generating the entire lucky number by its common sequence number: <br><pre> <code class="hljs perl">/** *         * @param <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> $iNumber -   * @param <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> $iNum -   * @return string *<span class="hljs-regexp"><span class="hljs-regexp">/ public function generateLuckyTicket($iNumber, $iNum) { $iHalf = (int)($iNumber /</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>); $iLength = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)($iHalf * <span class="hljs-number"><span class="hljs-number">9</span></span>); $b = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>              <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt;= $iLength; $i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($i &lt;= ($iLength / <span class="hljs-number"><span class="hljs-number">2</span></span>)) { $b = $this-&gt;decompositionCountProxy(<span class="hljs-number"><span class="hljs-number">9</span></span>, $i + $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>, $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $b = $this-&gt;decompositionCountProxy(<span class="hljs-number"><span class="hljs-number">9</span></span>, $iLength - $i + $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>, $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (($iNum - pow($b, <span class="hljs-number"><span class="hljs-number">2</span></span>)) &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; $iNum -= pow($b, <span class="hljs-number"><span class="hljs-number">2</span></span>); } $iNumLeft = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)($iNum / $b); $iNumRight = $iNum % $b; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>            $sLeft = $this-&gt;generateDecompositionProxy($iNumLeft + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, $i + $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>, $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>); $sRight = $this-&gt;generateDecompositionProxy($iNumRight + <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">9</span></span>, $i + $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>, $iHalf - <span class="hljs-number"><span class="hljs-number">1</span></span>); $iLeftLength = strlen($sLeft); $iRightLength = strlen($sRight); $sLeft = ($iLeftLength == $iHalf) ? $sLeft : (array_fill(<span class="hljs-number"><span class="hljs-number">0</span></span>, $iHalf - $iLeftLength, <span class="hljs-string"><span class="hljs-string">'0'</span></span>)); $sRight = ($iRightLength == $iHalf) ? $sRight : (array_fill(<span class="hljs-number"><span class="hljs-number">0</span></span>, $iHalf - $iRightLength, <span class="hljs-string"><span class="hljs-string">'0'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $sLeft . $sRight; }</code> </pre><br>  Well, in the end, already a simple method to get a list of lucky tickets: <br><pre> <code class="hljs php"><span class="hljs-comment"><span class="hljs-comment">/** *        * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $iNumber * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $iPage * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> int $iLimit * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string[] */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generateLuckyTicketList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($iNumber, $iPage, $iLimit)</span></span></span><span class="hljs-function"> </span></span>{ $iMax = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;countLuckyTicket($iNumber); $iOffset = $iLimit * ($iPage - <span class="hljs-number"><span class="hljs-number">1</span></span>); $aData = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = $iOffset; $i &lt; min($iMax, $iOffset + $iLimit); $i++) { $iValue = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateLuckyTicket($iNumber, $i); $aData[] = $iValue; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $aData; }</code> </pre><br><h5>  As a conclusion </h5><br>  The result of all the research can be found here: <a href="http://tasks.web-cake.ru/number">http://tasks.web-cake.ru/number</a> <br>  For those interested, the entire code based on the Zend Framework is laid out on the github: <a href="https://github.com/ShishkinAR/LuckyNumbers">https://github.com/ShishkinAR/LuckyNumbers</a> <br>  In particular, all the basic algorithms are placed in the <a href="https://github.com/ShishkinAR/LuckyNumbers/blob/master/application/modules/number/models/Numbers.php">model</a> .  According to the <a href="https://github.com/ShishkinAR/LuckyNumbers/blob/master/application/modules/number/controllers/ApiController.php">controller,</a> it is worthwhile to clarify further: the length of the number that the code can handle depends on the server settings.  With the presence of the library, the BCMath is mentioned above.  In addition, if xdebug is present, it is more careful with the xdebug.max_nesting_level parameter ‚Äî its default value is 100, which limits recursive passage through the tree and, accordingly, the number of digits in the ticket number.  When the server was set up, it was possible to work with numbers over 1000 characters in length.  Unfortunately, on the main server, the link above is still limited to 310 characters. <br><br>  Thanks for attention!  I hope the information will be useful and will not be lost in the open spaces of the network and will be available for search to those who may need it. <br><br>  Comments and criticism are welcome! <br><br>  Maybe someone has a variant of implementation of the optimized algorithm with getting a list of lucky numbers in their normal lexicographical order? </div><p>Source: <a href="https://habr.com/ru/post/189982/">https://habr.com/ru/post/189982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189964/index.html">Hell with accounts - why in one company of users was 3 times more, than employees</a></li>
<li><a href="../189966/index.html">How I introduced the DNS Extreme M-1 mouse to Xubuntu 12.04.2 LTS</a></li>
<li><a href="../189972/index.html">Python inside. Introduction</a></li>
<li><a href="../189974/index.html">How do spam traps help fight spam?</a></li>
<li><a href="../189980/index.html">Calculate keyed input using python</a></li>
<li><a href="../189984/index.html">BLIND GAMES - an exam for a game developer</a></li>
<li><a href="../189986/index.html">Python inside. Objects Head</a></li>
<li><a href="../189990/index.html">EFF dissatisfied with the ban on servers at Internet providers</a></li>
<li><a href="../189992/index.html">The Kleene Fixed Point Theorem: Quine</a></li>
<li><a href="../189994/index.html">Some interesting and useful things for web developer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>