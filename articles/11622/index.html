<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comments on the article "Painstaking optimization of PHP-applications"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, 

 It is strange that Habrahabr does not allow this message as a comment on the topic of mocksoul about PHP optimization: www.habrahabr.ru/blog...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comments on the article "Painstaking optimization of PHP-applications"</h1><div class="post__text post__text-html js-mediator-article">  Hello, <br><br>  It is strange that Habrahabr does not allow this message as a comment on the topic of mocksoul about PHP optimization: <a href="http://www.habrahabr.ru/blog/webdev/19129.html">www.habrahabr.ru/blog/webdev/19129.html</a> .  Probably too long.  :) <br><br><a name="habracut"></a><br>  " <br>  All that I wanted was written to you by letter, but I think that the community may also be interesting and useful, and I will find some mistakes for myself and fill in the gaps in knowledge that are sure to exist. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. ‚ÄúIn general, when I was doing a new project, there was a goal ‚Äî at least 50 requests per second on a run-down Celeron 2.6GHz.‚Äù A serious programmer should hide such goals from employers far, far away.  :) The goal is to implement business requirements.  The number of requests per second is a matter of system requirements, but not the most important one.  It is much easier for companies to spend 5-10 thousand dollars for a couple of servers than (for a long time) to search, (with something) to keep and overpay 1-2 thousand every month to a programmer who is capable of such miracles.  :) Unfortunately. <br><br>  2. ‚ÄúLigHTTPd.  Under Linux.  With sys-epoll on. ‚ÄùThe epoll has serious flaws in front of kqueue.  This and the lack of process, AIO and timer watching, and support only atomic events.  As I understand it, Linux was chosen based on the fact that "it happened"? <br><br>  3. "PHP5.  Via FastCGI. ‚ÄùUnfortunately, PHP is not fully FCGI-compatible, and if all the fcgi processes are busy all at once and the backlog ends, and there is no additional pool launch manager layer on top of it, then it will simply shut up - until a hard restart.  You can check it by running ab -n 100000 -c (PHP_FCGI_CHILDREN + 1) <a href="http://localhost/">localhost</a> .  I admit that there are implementations that do not suffer from the like.  If you know, I will be grateful. <br><br>  4. "'--with-gdbm'".  Against the background of others --without the inclusion of gdbm looks more like an error than an idea.  Or use?  This is a very good solution for storing data that has become obsolete in shm. <br><br>  5. "'--without-mysqli'".  &gt;: o And what about prepared statements, multiquery? <br><br>  6. "PHP_FCGI_CHILDREN" =&gt; "32" I had a long experience with the legacy system, where the code was so terrible that a rather expensive server was formed on 10 parallel clients.  Saved the quick purchase of additional memory plank :) and an increase in PHP_FCGI_CHILDREN to the maximum that could be allowed there - 256. Later, the system was redesigned, rewritten, and the pool was reduced to 32. <br><br>  7. ‚Äúwe ask to kill the stream and create a new one through a certain number of requests‚Äù - this value is quite easy to calculate  If we take into account that affinity takes place for FCGI (at polling), then the most successful option would be to fully serve one client within its keep-alive, and then restart.  We take the number of hits by php, divide by the number of hosts and get the average value of php starts / visit, increase it to the "magic" number of times - I take 1.618 to absorb the first deviation.  Usually it turns out something about 600-1100. <br><br>  8. "We write and twist in my head thoughts about how to do something more reasonable and fast right away." No, no, no!  We write, check what works, then run through APD / Xdebug and treat only what needs treatment!  Similarly, indexes in tables, caching, etc. are assigned. <br><br>  9. ‚ÄúYou probably almost will not need to use require and include.  Basically - require_once and include_once. "They are about 3-11 times slower.  The best option is a well-documented connection map.  Later, of course, opcode-caster collects all the files in one, but for the first run is not bad. <br><br>  10. ‚Äúlearn to use array_ * functions in php.  Especially lambda functions. Cons of lambda functions: deterioration of readability, storing each instance in a global namespace (your example is exactly the moment when the count ($ arr) instances are created), the impossibility of catching errors on a compile-time, etc.  This is already enough. <br><br>  11. "foreach ($ arr as $ key =&gt; &amp; $ val) {...}".  This is no longer relevant.  You can verify this by inserting memory_get_usage () into each iteration. <br><br>  12. "is_null () - invented by an idiot."  And <a href="http://www.php.net/manual/en/types.comparisons.php">www.php.net/manual/en/types.comparisons.php was</a> invented by PHP developers. <br><br>  13. ‚ÄúIt's simple - if you own a server - use persistent connections!‚Äù And do you use ignore_user_abort () / register_shutdown_function ()?  Permanent connections are very, very dangerous!  Very easy to get lockout.  Instead, it is better to use either SQL Relay / pgpoll, or some other third-party connection pool manager. <br><br>  14. "The script is absolutely unstable and sharpened for one project." Once I tried to implement a build manager who pulled out all dependencies, knocked everything down into a single file based on a switch, immediately passed it through the encoder and saved it in production.  It was fun.  Thank you for suggesting to use it again.  :) <br><br>  15. "In my.cnf, we write query_cache_size = 100M".  Yes, we read docks.  Especially <a href="http://www.mysqlperformanceblog.com/2007/03/23/beware-large-query_cache-sizes/">www.mysqlperformanceblog.com/2007/03/23/beware-large-query_cache-sizes</a> .  In principle, in 100M with an average load will be a relatively normal trimming, but reducing to 32-48M, you can reduce the final overhead and save memory for more important settings. <br><br>  16. "Keep everything in it that is possible."  Yes, we kept the time () for interest there with ttl 1 second - when the density of requests is more than 600 per second, the gain is obtained.  :) <br><br>  17. "Do not use IO in the file system for this - better memory." Quite often, the limit of the system is just memory.  When everything that is already optimized is optimized, the code simply starts to rest on the number of processes.  Then you start to struggle for memory, and a good NAS can save the situation - this is ~ 2000 Mbps (250M per second), which, of course, is incomparable with memory, but not bad, but memory is usually needed right here and right now. <br><br>  18. ‚ÄúNevertheless, many other functions of array_ * in php are generally difficult to implement with foreach skills without dexterity.  Sorting, for example. ‚ÄùThere are precedents for overtaking the speed of the built-in sort () - a function written in PHP!  :) Just sort () implements quicksort as the most common solution, and for particular cases there are faster sorts.  For example, if you want to sort the numbers, or natural case. <br><br>  I hope for an interesting answer. <br>  Thank you for the article!  :) <br>  " <br></div><p>Source: <a href="https://habr.com/ru/post/11622/">https://habr.com/ru/post/11622/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116212/index.html">Second shift</a></li>
<li><a href="../116214/index.html">SSH tunnel home without having to leave the home PC on</a></li>
<li><a href="../116216/index.html">March update for Windows Phone 7</a></li>
<li><a href="../116217/index.html">How to choose VPS hosting</a></li>
<li><a href="../116218/index.html">Yahoo! presented an analogue of Google instant</a></li>
<li><a href="../116220/index.html">And one more wireless charger</a></li>
<li><a href="../116222/index.html">Recognition of some modern captcha</a></li>
<li><a href="../116224/index.html">SMF - Service Management on Solaris</a></li>
<li><a href="../116225/index.html">Good old electronic portable games</a></li>
<li><a href="../116227/index.html">Work with FLA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>