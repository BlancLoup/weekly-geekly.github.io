<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Logical but illegal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I believe that many who came to the glorious world of .NET from the glorious world of C ++ remember very well how they had to literally dig into the s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Logical but illegal</h1><div class="post__text post__text-html js-mediator-article">  I believe that many who came to the glorious world of .NET from the glorious world of C ++ remember very well how they had to literally dig into the standard to figure out why a language behaves this way and not otherwise.  Many things that seemed completely obvious to them, on closer examination, turned out to be not something that was not obvious - but just the opposite of common sense, which we all used to rely on. <br><br>  However, most likely, this is a problem in many programming languages.  Many, I think, remember the well-known <a href="https://www.destroyallsoftware.com/talks/wat">WAT</a> video on the problems of some of the "obvious" languages ‚Äã‚Äãof JavaScript and Ruby.  The logic of the familiar world comes out to smoke when border areas appear - those in which normal people do not climb. <br><br>  However, I suggest a little distraction from these lofty matters and a look at C # language from a slightly different side.  Namely, to look at some constructions that, on the one hand, are completely understandable and easily described in terms of a language, and on the other, completely refuse to compile. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I'm not even going to argue with whether they should compile and work.  Once again, I‚Äôll just remind you once again that everything that is "logical and understandable" for us can actually be completely illogical and incomprehensible. <br><br>  And yes, I will not once again whimp at the topic of what I would like to return from the function stupid without using cumbersome structures and get the name of a variable using a simple operator.  This is not here - this is to Microsoft in feature requests.  We have five minutes of humor.  So, all that you want to write every day, but do not write, because you know - it will not compile.  Go! <br><a name="habracut"></a><br>  Let's start with the simplest. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><br>  What do i hear  How "what does this code do"?  Get out of the profession!  Such an intellectual majority has no place in our egghead club.  This code does nothing - the compiler will throw it out when optimizing and will be completely right.  But the meaning of this record is clear even to the mentally retarded - we define a variable with the name i and assign a value of 0 to it. <br><br>  Let us turn to a more complex example. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = i;</code> </pre><br><br>  Another half of the room left our coven, unable to understand the amazing complexity of the examples.  Do not close the tab - I theatrically aggravate the situation before the climax. <br><br>  Let's try this <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, j = <span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre><br>  So <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>, j = i;</code> </pre><br>  No problem at all. <br><br>  But as soon as we want to go some math, the compiler immediately appears from non-existence and gives us a meter-long rump.  Do not dare, they say, clutter up my code with equations! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// error CS0103: The name `j' does not exist in the current context</span></span></code> </pre><br><br>  But the Russians do not give up! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// error CS1525: Unexpected symbol `j', expecting `.'</span></span></code> </pre><br><br>  Now, when the weak in spirit have left our circle "Skilful hands", it is possible to somewhat diversify the discussion with the help of a ternary operator! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br>  We write such code every day.  But not everyone knows (especially those who never wrote in C ++, however, as well as those who consider the semantics of this language several times more powerful than C # and have no idea that many operations are done there in a similar way), can be done like this. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? (j = <span class="hljs-number"><span class="hljs-number">1</span></span>) : <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br>  I doubt that there are people for whom this record is a mystery.  It means a simple thing - if whatever, then assign j to one and assign the result of the assignment (that is, the value j) to variable i.  Otherwise, assign it to her 2. Armed with this incredible power, shoot from the hip! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? <span class="hljs-number"><span class="hljs-number">2</span></span> * (j = <span class="hljs-number"><span class="hljs-number">1</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br>  But one always wants a strange one ‚Äî for example, to solve the bicubic equation in the ternary operator.  Or just do something left. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? { j = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>; } : <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// error CS8025: Parsing error</span></span></code> </pre><br><br>  Alas, the human mind is a fiasco in the face of a bloodthirsty machine.  He is trying to find a workaround ... <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? ( () =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> )() : <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// error CS0119: Expression denotes a `anonymous method', where a `method group' was expected</span></span></code> </pre><br><br>  So I hear the compiler scream: <br>  <i>- Yes, I will make you a delegate, I will, you just tell me what type?</i> <i><br></i>  <i>- Anyone!</i> <i><br></i>  <i>- What?</i> <i><br></i>  <i>- Anyone.</i>  <i>Anyone.</i>  <i>Anyone!</i> <i><br></i>  <i>- System.MulticastDelegate.</i> <i><br></i>  <i>- No, well, not any of course ...</i> <br><br>  (by the way, who will help you find this video on YouTube - I will be very grateful) <br><br>  And finds it! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;( () =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> )() : <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br>  Although, alas, it is not as beautiful as the original idea. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = whatever ? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> System.Func&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt;( () =&gt; { j = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> + j; } )() : <span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre><br><br>  But on bezrybe, as they say, and a boot - a sardine. <br><br>  Now, when half of the remaining people are already snoring, you can go to the complex instructions - blocks. <br><br>  We all wrote cycles. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++);</code> </pre><br><br>  And we know that in fact this record is similar to the following: <br><br><pre> <code class="cs hljs">{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) i++; }</code> </pre><br><br>  Well, such <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++)</code> </pre><br><br>  Similar to this code <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) i++;</code> </pre><br><br>  In general, it is great to declare variables for control instructions directly in the instructions themselves, and not to allocate a special block for this.  Otherwise many compact things would have to be written much more complicated.  Especially it concerns the block using <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span>(IDisposable data = GetSomeData()) { }</code> </pre><br><br>  Which unfolds into something like that <br><br><pre> <code class="cs hljs">{ IDisposable data = <span class="hljs-literal"><span class="hljs-literal">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { data = GetSomeData(); } <span class="hljs-keyword"><span class="hljs-keyword">finally</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(data != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) data.Dispose(); } }</code> </pre><br><br>  Now imagine that we want to write the following expression in abbreviated form <br><br><pre> <code class="cs hljs">{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) i = <span class="hljs-number"><span class="hljs-number">7</span></span>; }</code> </pre><br><br>  It would be logical to declare a variable in a control instruction.  Victory? <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">5</span></span>) &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>) <span class="hljs-comment"><span class="hljs-comment">// error CS1525: Unexpected symbol `i', expecting `)' or `.' i = 7;</span></span></code> </pre><br><br>  So close ... <br><br>  Okay, but C # is object oriented.  Let's play with objects! <br><br>  Recall how we simply and efficiently called the parent constructor from the constructor of the derived class.  What an elegant and clear syntax was there - a sight for sore eyes! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeOtherClass</span></span> : <span class="hljs-title"><span class="hljs-title">SomeClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeOtherClass</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span> { } }</code> </pre><br><br>  And I immediately want a strange one. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">)</span></span> { } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">SomeOtherClass</span></span> : <span class="hljs-title"><span class="hljs-title">SomeClass</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SomeMethod</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">)</span></span> { } <span class="hljs-comment"><span class="hljs-comment">// Unexpected symbol `:' in class, struct, or interface member declaration }</span></span></code> </pre><br><br>  The last time I tried to convince the compiler that my record form made sense, it broke two of my ribs.  Be careful with experiments! <br><br>  And now, when only one person reads me (yes, it is you - please don't leave - I'm afraid of loneliness) we'll see another example, which is not something that you want, but not it can, but just so strange that it baffles even me. <br><br>  Unlike the others, it, by the way, is compiled in all variants. <br><br>  We will do everything that we do every day, but in a somewhat unusual way.  Of the sub-sub, so to speak. <br><br>  We will have a hierarchy of two classes that implement one interface.  And we will make the following calls and look at the results. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooA().Foo(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooB().Foo(); ((IFoo) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooA()).Foo(); ((IFoo) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooB()).Foo(); ((FooA) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooB()).Foo(); ((IFoo)(FooA) <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooB()).Foo();</code> </pre><br><br>  Because here we are so funny. <br><br>  Let's start with the simplest - virtual methods.  Like a book. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooA</span></span> : <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooB</span></span> : <span class="hljs-title"><span class="hljs-title">FooA</span></span>, <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"B"</span></span>); } }</code> </pre><br><br>  The result is obvious! <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooA().Foo(); <span class="hljs-comment"><span class="hljs-comment">// A new FooB().Foo(); // B ((IFoo) new FooA()).Foo(); // A ((IFoo) new FooB()).Foo(); // B ((FooA) new FooB()).Foo(); // B ((IFoo)(FooA) new FooB()).Foo(); // B</span></span></code> </pre><br><br>  But we are smart.  Why do we need virtual methods?  We have an interface. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooA</span></span> : <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooB</span></span> : <span class="hljs-title"><span class="hljs-title">FooA</span></span>, <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"B"</span></span>); } }</code> </pre><br><br>  Of course we will get a warning <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// warning CS0108: `FooB.Foo()' hides inherited member `FooA.Foo()'. Use the new keyword if hiding was intended</span></span></code> </pre><br><br>  But do not pay attention - the problem is not in it, and the new keyword does not affect the experiment at all. <br><br>  The result is staggering. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooA().Foo(); <span class="hljs-comment"><span class="hljs-comment">// A new FooB().Foo(); // B ((IFoo) new FooA()).Foo(); // A ((IFoo) new FooB()).Foo(); // B ((FooA) new FooB()).Foo(); // A ((IFoo)(FooA) new FooB()).Foo(); // B</span></span></code> </pre><br><br>  The most monstrous here is the difference between the method call through the cast to the base class and the method call through the cast to the base class, and then to the interface.  Because the method behaves as a virtual method would behave with the exception of one case - reduction to the base class. <br><br>  Let's try to emulate it without interfaces.  Assume that the interface will always call the first class method in the hierarchy. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"A (I)"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooA</span></span> : <span class="hljs-title"><span class="hljs-title">IFoo</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"A"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FooB</span></span> : <span class="hljs-title"><span class="hljs-title">FooA</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Foo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { System.Console.WriteLine(<span class="hljs-string"><span class="hljs-string">"B"</span></span>); } }</code> </pre><br><br>  Alas, a fiasco - the behavior is absolutely not what we want. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FooA().Foo(); <span class="hljs-comment"><span class="hljs-comment">// A new FooB().Foo(); // B ((IFoo) new FooA()).Foo(); // A (I) ((IFoo) new FooB()).Foo(); // A (I) ((FooA) new FooB()).Foo(); // A ((IFoo)(FooA) new FooB()).Foo(); // A (I)</span></span></code> </pre><br><br>  If it calls the last method in the hierarchy, the behavior is also drastically different from what we have with the interface. <br><br>  No logic can comprehend exactly this behavior.  Unless paragraph 3 of subparagraph 14 of paragraph 1 of chapter 7 of part 3 of volume 2 of the standard of 2005 revision 4, adopted in 1 reading of the 2nd meeting in the third week of the fourth month. <br><br>  Unfortunately, I have to leave reflections on the reasons for this for self-reflection - my compiler, unfortunately, was too vigorous about Friday and they are now snoring in the kitchen with the standard.  Perhaps I will do the same.  Have a nice dream and a good weekend! </div><p>Source: <a href="https://habr.com/ru/post/151964/">https://habr.com/ru/post/151964/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../151959/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ23 (September 15 - 21, 2012)</a></li>
<li><a href="../151960/index.html">Apple lost in the German trial of Motorola and Samsung</a></li>
<li><a href="../151961/index.html">"Heroes of Mat and Fur" ported to javascript</a></li>
<li><a href="../151962/index.html">Remembering the past</a></li>
<li><a href="../151963/index.html">Android UI. Making Twitter-style buttons Bootstrap</a></li>
<li><a href="../151965/index.html">Respect for the teacher or ‚ÄúProfessor, and where is your repository on GitHub?‚Äù</a></li>
<li><a href="../151966/index.html">How I study undergraduate in Canada</a></li>
<li><a href="../151972/index.html">iPhone 5: problems with the screen. Video</a></li>
<li><a href="../151974/index.html">Facebook has disabled face recognition in Europe (for new users)</a></li>
<li><a href="../151975/index.html">Internet access policy. Or why all these difficulties?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>