<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Email from your server: pitfalls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, for several reasons, we decided to abandon the third-party service for email newsletters and send them from our server. I would like to poin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Email from your server: pitfalls</h1><div class="post__text post__text-html js-mediator-article">  Recently, for several reasons, we decided to abandon the third-party service for email newsletters and send them from our server.  I would like to point out a number of difficulties that we encountered in the process, and ways to solve them.  This article almost doesn‚Äôt touch on the layout directly, but I didn‚Äôt find a more suitable hub. <br><br>  Of course, if you have been in the subject for a long time, such tips may seem trivial and obvious, but a certain set of tricks and tips will be useful for novice mailers. <br><a name="habracut"></a><br><br><h2>  Answering machine </h2><br>  Be prepared for the fact that people do not understand why an answering machine is needed.  Hundreds of very important auto-answers will be sprinkled on you: ‚ÄúThank you!‚Äù, ‚ÄúI received your letter, I will answer as soon as I can‚Äù (why should I?), Or even simply ‚Äúadylopryd‚Äù.  Are they forced to fill in the auto-answer field ?!  And the majority of autoresponders have a box on mail.ru (I hardly refrain from commenting on this). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Considering that in our helpdesk we form tickets from the responses to the mailing lists, we don‚Äôt want to overwhelm the support with hundreds of useless tickets after each mailing. <br><br>  How to deal with them?  It would seem that we open the <a href="https://tools.ietf.org/html/rfc3834">RFC</a> , read that we need to parse the <b>Auto-Submitted</b> header <b>:</b> for its presence and the inequality of the word <b>no</b> , we get a profit.  So?  Nope  The key word there is <b>SHOULD</b> .  And if, for example, gmail, yandex and yahoo took this as a guide to action, then mail.ru (again you?) Is too proud to listen to someone's advice.  Thank you at least for the <b>X-AutoReply title</b> .  The rambler also goes there with its <b>X-Autogenerated</b> .  It is terrible to imagine that even more irresponsible servers like i.ua were invented on this score (they are still being discussed), but so far no auto-responses have been received from them.  Maybe they just do not have such a function at all? <br><br><h2>  Server name </h2><br>  Remember that in the <a href="http://www.postfix.org/BASIC_CONFIGURATION_README.html">postfix</a> myhostname parameter the FQDN must be specified.  And if you don‚Äôt have example.com standing there, but just an example, you may have problems with the delivery of the letter.  Again, Gmail, Yandex, and even MailRu are slaughtered for it, but the very ill-fated i.ua (as well as ukr.net) just spins letters without commenting on it. <br><br><h2>  Greylisting </h2><br>  Another trick from ukr.net.  On this subject, they have only <a href="http://www.ukr.net/mta/std3.html">such a</a> silly FAQ.  The bottom line is that if your server is not known to ukrnet, then it will not immediately deliver letters.  To get on his white list, you must send the same letter after a certain period of time.  Fortunately, postfix supports this option by default, so you just have to wait a few hours after the first letter. <br><br><h2>  Quarantine </h2><br>  We are once again <a href="http://mail.i.ua/quarantine/">pleased with</a> i.ua.  For some reason known only to him, he decided to put part of our letters in quarantine.  To get them out of this quarantine, you must enter the code sent in the letter, or follow the link in the same letter.  Then I gave up - to write a separate parser of service letters to satisfy the whims of paranoid-minded administrators was not part of my plans. <br><br><h2>  Layout </h2><br>  About the very layout of letters on Habr√© already had a bunch of articles, I‚Äôd hardly add something new to them.  I will speak a little from a different position: what to do when there is already an imposed page on the site, and it should be sent by letter.  We, for example, have a newsletter, which is partly composed of materials on the site.  Do not overturn it specifically for the letter?  And if there are almost 200 such pages?  And they are periodically edited? <br><br>  Therefore, I found for myself a <a href="https://github.com/premailer/premailer">library</a> that allows you to make the correct email version from a ready-made ‚Äúwebsite‚Äù html, with inline styles, absolute paths to pictures, styles corrected for email clients, etc.  It does not always work out perfectly for her, but when it is necessary to send letters, it is still necessary, and the deadline is yesterday, the library helps a lot. <br><br>  The plans here still have to embed it in the site workflow, so that it automatically creates an email version when the content changes. <br><br><h2>  cancel subscription </h2><br>  About the heading <b>List-Unsubscribe</b> on the same Habr√© wrote back <a href="http://geektimes.ru/post/101440/">in 2010</a> .  The main thing to remember here is that in the same Gmail, that the "Unsubscribe" button appears in the letter, it is necessary that Google consider you to be a bona fide sender.  In practice, you need to properly configure DKIM, including the next item.  Also, at a minimum, Google does not require that the title of the <b>List-Unsubscribe</b> be exactly <b>mailto:</b> link, it is enough to link to the site with the unsubscribe page. <br><br><h2>  DKIM: Body hash did not verify </h2><br>  I came across such a phrase in the letter headers when I noticed that GMail does not place the ‚ÄúUnsubscribe‚Äù button in the part of the letters sent.  In fact, everything is simple here - the letter body was changed after signing, so the hashes do not match. <br><br>  Find out the reason for this was not so easy.  But having rummaged, I found out that, according to RFC2822, the length of the message body string should not exceed 998 characters.  For some reason, postfix (as I understand it) puts the hyphenation after the letter is signed, so it is better to submit a letter with the correctly arranged hyphenation to the postfix. <br><br>  That's all for now.  Together we can supplement this post with useful tips from our practice.  And at the end of a small survey: </div><p>Source: <a href="https://habr.com/ru/post/275047/">https://habr.com/ru/post/275047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../275035/index.html">DLP do-it-yourself system</a></li>
<li><a href="../275037/index.html">Analyze this or about software quality.</a></li>
<li><a href="../275039/index.html">We read the container of the private key CryptoPro by means of OpenSSL</a></li>
<li><a href="../275043/index.html">Shazam: music recognition algorithms, signatures, data processing</a></li>
<li><a href="../275045/index.html">Iosevka - another font for coding</a></li>
<li><a href="../275053/index.html">Cross-platform IDE for .NET / C # from JetBrains</a></li>
<li><a href="../275063/index.html">Where the Pixie Unicorn lives. Indie storytelling</a></li>
<li><a href="../275065/index.html">Yii 1.1.17</a></li>
<li><a href="../275069/index.html">What is faster: 0 or NULL?</a></li>
<li><a href="../275071/index.html">How students become advanced programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>