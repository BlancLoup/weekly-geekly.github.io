<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>200 million checks per month or architecture and statistics of the CloudStats.me service</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 This is the first post on behalf of our company on Habr√© and in it we want to tell you a little about the architecture of our cloud monitori...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>200 million checks per month or architecture and statistics of the CloudStats.me service</h1><div class="post__text post__text-html js-mediator-article">  Hello! <br><br>  This is the first post on behalf of our company on Habr√© and in it we want to tell you a little about the architecture of our cloud monitoring service of servers and web sites <a href="http://cloudstats.me/">CloudStats.me</a> , with which we are currently <a href="http://cloudstats.me/">undergoing</a> acceleration in IIDF in Moscow.  We also want to share with you our current statistics and talk about plans for the near future, but first and foremost. <br><br>  <b>1. System architecture</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Our platform is aimed at system administrators who do not want to mess around with setting up Nagios or Zabbix for a long time, but just need to keep track of the main parameters of the servers without spending a lot of time and resources on monitoring.  We try not to overload the system interface with a number of settings, so everything is built on the KISS principle (keep it simple stupid). <br><br>  Almost the entire system is written in Ruby on Rails (with the exception of the python agent, which we will soon also replace with the agent on Ruby), using <a href="http://www.ractivejs.org/">RactiveJS</a> .  Front-end works on Tomcat, the load on which is distributed using Haproxy.  As a CDN, we use CloudFlare, through which only static JS, CSS, PNG, etc. files pass.  Nevertheless, even for such a rather simple and not very large service so far, we already have to apply load balancing on all parts of the platform to avoid overloads. <br><br>  Service architecture at the end of June: <br><br><img src="https://habrastorage.org/files/f8b/979/b3c/f8b979b3c54d46bdaf8b92bb4e081782.png"><br><br>  ( <a href="">big picture</a> ) <br><br>  As you can see in the picture, tasks are created by a separate Scheduler node and processed by several Worker nodes, which in turn are connected via API with the Ping / Port / URL check servers located in 3 zones - France, UK, USA.  If one of the verification servers returns ‚ÄúPing Failed‚Äù status for any IP, then additional checks are performed in the other two zones in order to exclude false positives.  In the future, we plan to bring all this to the front-end so that you can see from which locations your IP is unavailable (for example, in a situation with DDoS or routing issues). <br><a name="habracut"></a><br>  As we <a href="http://habrahabr.ru/post/260125/">wrote earlier</a> , we use the master-master replication cluster of Galera MariaDB and Haproxy in front of it.  Haproxy installed on all parts of our architecture, which allows us to both roll out new versions of the product without affecting users, and update the backend system without degrading the service.  In the future, we plan to start using partitioning. <br><br>  <b>2. Infrastructure</b> <br><br><img src="https://habrastorage.org/files/8d2/c5f/1bd/8d2c5f1bdd294485b5a4b1b9ca8354e8.jpg"><br><br>  From data centers, our choice fell on 3 fairly common DCs, which allow us to keep infrastructure costs under control, and the level of service at the proper level. <br><br>  We use Online.net for our servers in France, where the main front-end system is located.  The choice fell on Online.net, because  there is a convenient server control panel that allows you to quickly transfer IP addresses from one server to another, the presence of a remote console iDRAC, as well as the absence of traffic restrictions and protection against DDoS attacks.  In Online.net we used about 11 Tb of traffic for June and for this there were no overpayments, which is convenient. <br><br>  Additional servers producing URL, Ping, and Ports checks are located in OVH Canada and Redstation UK, which gives us the necessary geographical coverage.  However, in July we will complete the move to the Microsoft Azure platform, which will give us access to 15 data centers around the world.  This will increase the number of locations from which we will perform checks on servers and sites, as well as increase the resiliency of the platform as a whole (we will write about this separately). <br><br>  At the moment, we already produce about 200 million checks per month, which includes pings of all servers (1352 servers x 2 pings per minute x 60 minutes x 24 hours x 31 days = ~ 120 million ‚Äúping jobs‚Äù per month), URL checking, as well as port checking, collecting and processing statistics on servers, etc. <br><br>  <b>3. Some statistics:</b> <br><br>  At the moment, 1352 servers have been added to our system, on which our agent is installed and which send us their statistics every 4 minutes.  In addition, we check each added server using an external ping 2 times per minute. <br><br>  The servers added to the system on the peak day of June 10, 2015 generated up to 1.6 Terabits of traffic per second.  (Tb / s).  This includes both inbound and outbound traffic.  Outgoing traffic is slightly larger than incoming traffic, but this is quite predictable. <br><br>  Channel use by day for June 2015.  The peak day is June 10th. <br><br><img src="https://habrastorage.org/files/ad6/a73/84d/ad6a7384de2b4ffd85e6661a2de0f846.png"><br><br>  The average channel utilization of all servers in the system is around 500 gigabits per second. <br><br>  With a small recalculation, these ‚Äúaverage‚Äù 500 Gigabit of traffic per second result in approximately 5,273 Terabytes of transmitted data per day.  And this is the amount of data transmitted only ~ 1300 servers in our system! <br><br><img src="https://habrastorage.org/files/22b/b5a/a43/22bb5aa43c864ebcb9b4fb90530146c2.png"><br><br>  Of course, we are still a young monitoring service, but we are making every effort to create a convenient and simple platform that can be used both within the company, and to show customers and give them access. <br><br>  However, we do not follow the model of competitors and do not create a ‚Äúdomestic New Relic‚Äù.  On the contrary, we want to create a platform in which there will be not only monitoring of servers, but also security elements - scanning servers and sites for vulnerabilities;  ability to manage servers from one platform, as well as backing up data (backups) to cloud storage. <br><br>  Stay tuned! </div><p>Source: <a href="https://habr.com/ru/post/261497/">https://habr.com/ru/post/261497/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261483/index.html">Tame JMeter</a></li>
<li><a href="../261487/index.html">Big data and big questions</a></li>
<li><a href="../261489/index.html">New courses on Hexlet: React, Ansible and others</a></li>
<li><a href="../261491/index.html">Kingpin: schoolchildren translate a book about hackers</a></li>
<li><a href="../261493/index.html">Controversial, but relevant design principles</a></li>
<li><a href="../261507/index.html">"Pumping" notepad.exe</a></li>
<li><a href="../261509/index.html">Creating a scalable distributed application from scratch</a></li>
<li><a href="../261511/index.html">PSD parser or how to parse a Photoshop file in Java</a></li>
<li><a href="../261515/index.html">AllJoyn and Windows 10 - we make our devices speak the same language</a></li>
<li><a href="../261517/index.html">Does XMPP suck?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>