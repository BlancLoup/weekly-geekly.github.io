<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of the voice menu on perl via usb modem Huawei e1550</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most recently, I wrote a post in which I gave a bit of theory, and described the practical implementation of a script that generates voice calls (noti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of the voice menu on perl via usb modem Huawei e1550</h1><div class="post__text post__text-html js-mediator-article">  Most recently, I wrote a <a href="http://habrahabr.ru/post/192930/">post</a> in which I gave a bit of theory, and described the practical implementation of a script that generates voice calls (notification) of subscribers on the list via usb modem Hyawei e1550.  In one of the comments, a <a href="http://habrahabr.ru/post/192930/">question</a> was asked about how to get data about pressing buttons on the subscriber‚Äôs phone during a voice connection.  A detailed study of this issue and led to the creation of this post. <br><br>  This article will present the implementation of the voice menu, with functions: <br>  - voice recordings <br>  - execution of system commands <br>  All this was made possible by the implementation of a DTMF decoder based on the G√∂rtsel algorithm. <br>  As a bonus, the archive is the source of the voice menu. <br><a name="habracut"></a><br><br><h5>  Development environment </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      operating system: Linux <br>  Distribution: openSUSE 12.3 <br>  Kernel: 3.7.10-1.16-desktop # 1 SMP PREEMPT Fri May 31 20:21:23 UTC 2013 (97c14ba) i686 i686 i386 GNU / Linux <br>  Programming language: Perl <br>  usb modem: Huawei e1550 <br><br><h5>  Let's get started </h5><br><br>  The implementation contains the following files and folders: <br>  1. voice_menu.pl - the main script with the implementation of the functions of the voice menu <br>  2. dtmf_decoder.pm - decoding module for dtmf signals (pressing the phone buttons in tone dialing mode) <br>  3. menu.01.pl - contains a description of the voice menu <br>  4. menu.01 - folder with audio files for menu.01.pl <br>  5. messages - folder with voicemail recordings. <br><br>  voice_menu.pl <br><pre><code class="hljs kotlin">#!/usr/bin/perl use v5.16; #   Perl    use strict; #    use warnings; #    use diagnostics; #     use utf8; use locale; no warnings <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>; #   Time::HiRes   #      sleep #    -   #    use Time::HiRes qw(sleep usleep gettimeofday); #   dtmf_decoder use dtmf_decoder; #  : #   CEND      #       ,     #    . #   ^CEND:call_index, duration, end_status, cc_cause # : # call_index -    # duration -     # end_status -       # cc_cause -     #       OS Linux #  <span class="hljs-number"><span class="hljs-number">3</span></span> usb       #  : # /dev/ttyUSB0 -    # /dev/ttyUSB1 - (   )   # /dev/ttyUSB2 -   .   /dev/ttyUSB0  #           ,    # .      ,  ^CEND   #       my $VOICE_PORT = <span class="hljs-string"><span class="hljs-string">"/dev/ttyUSB4"</span></span>; #       my $COMMAND_PORT = <span class="hljs-string"><span class="hljs-string">"/dev/ttyUSB5"</span></span>; #  : # <span class="hljs-number"><span class="hljs-number">0</span></span> -      # <span class="hljs-number"><span class="hljs-number">1</span></span> -      my $VERBOSE = <span class="hljs-number"><span class="hljs-number">0</span></span>; #         <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> my $SENDPORT, <span class="hljs-string"><span class="hljs-string">'+&lt;'</span></span>, $COMMAND_PORT or die <span class="hljs-string"><span class="hljs-string">"Can't open '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$COMMAND_PORT</span></span></span><span class="hljs-string">': $!\n"</span></span>; #         #           #            <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> my $SENDPORT_WAV, <span class="hljs-string"><span class="hljs-string">'+&lt;'</span></span>, $VOICE_PORT or die <span class="hljs-string"><span class="hljs-string">"Can't open '</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$VOICE_PORT</span></span></span><span class="hljs-string">': $!\n"</span></span>; #    ,   <span class="hljs-number"><span class="hljs-number">1</span></span> : # -      expect_calls(<span class="hljs-string"><span class="hljs-string">'menu.01.pl'</span></span>); #       / exit_call(); #        sub expect_calls{ #       my $l_file = shift; #    ( menu.01.pl) my $menu = load_menu(<span class="hljs-string"><span class="hljs-string">'menu.01.pl'</span></span>); #        #      / #  .   . #at_send(<span class="hljs-string"><span class="hljs-string">'AT^CVOICE=0'</span></span>); #         my $l_rec = at_send(<span class="hljs-string"><span class="hljs-string">"AT+CLIP=1"</span></span>,qr/^(OK|ERROR)/); #     <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( ) { #       RING $l_rec = at_rec(qr/^(RING)/); accept_call($menu); } } #        #     -    sub accept_call{ my $menu = shift; #     t    my $position = [$menu]; #   my $cmenu = $position-&gt;[<span class="hljs-number"><span class="hljs-number">0</span></span>]; my %call_info = (); #    $call_info{start_time} = time; #        #+CLIP: <span class="hljs-string"><span class="hljs-string">"+79117654321"</span></span>,<span class="hljs-number"><span class="hljs-number">145</span></span>,,,,<span class="hljs-number"><span class="hljs-number">0</span></span> $call_info{phone} = at_rec(qr/^\+CLIP\: \<span class="hljs-string"><span class="hljs-string">"(\+\d+)/); </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$call_info</span></span></span><span class="hljs-string">{phone} =~s/^\+\d//; #      </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$call_info</span></span></span><span class="hljs-string">{record_fname} = "</span></span>phone_$call_info{phone}.time_$call_info{start_time}<span class="hljs-string"><span class="hljs-string">"; #    my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> = at_send("</span></span>ATA<span class="hljs-string"><span class="hljs-string">",qr/^(OK|ERROR)/); return 0 if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> eq "</span></span>ERROR<span class="hljs-string"><span class="hljs-string">"; #    </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> = at_rec(qr/^\^??(CONN\:1|CEND\:|ERROR)/); return 0 if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> ne "</span></span>CONN:<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-string"><span class="hljs-string">"; #     /  # OK -    # ERROR -    # CEND:.... -  ,     </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> = at_send('AT^DDSETEX=2',qr/(OK|ERROR|CEND\:)/); return 0 if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> ne "</span></span>OK<span class="hljs-string"><span class="hljs-string">"; #     -    #         320   0.02  print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t<span class="hljs-string"><span class="hljs-string">"."</span></span> .\n<span class="hljs-string"><span class="hljs-string">"; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checker</span></span></span><span class="hljs-string"> = 0; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string"> = 0; #      my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_in</span></span></span><span class="hljs-string">; #      my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{info_voice}; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> = 0; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string"> = scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">}; #       my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string"> = new IO::File "</span></span>&gt; ./messages/$call_info{record_fname}.raw<span class="hljs-string"><span class="hljs-string">" or die "</span></span>Cannot <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> $call_info{record_fname}.raw : $!<span class="hljs-string"><span class="hljs-string">"; binmode(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">); #    $|     . #         . $|=1; #   #play_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">); #     0.02  my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$before</span></span></span><span class="hljs-string"> = gettimeofday; #     while (){ if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> == </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string">) { if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{record}==1){ </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{standart_messages}{null}{title_voice}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string"> = scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{record}=2; print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t     [./messages/$call_info{record_fname}.raw].\n<span class="hljs-string"><span class="hljs-string">"; } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> = 0; } syswrite </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT_WAV</span></span></span><span class="hljs-string">, </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">-&gt;[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string">] , 320; sysread </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT_WAV</span></span></span><span class="hljs-string">, </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_in</span></span></span><span class="hljs-string">, 320; syswrite </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">, </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_in</span></span></span><span class="hljs-string">, 320 if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{record} &amp;&amp; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{record} == 2; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string"> = dtmf_sample(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_in</span></span></span><span class="hljs-string">); if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string">) { #print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phoe}] \t  [$dtmf].\n<span class="hljs-string"><span class="hljs-string">"; if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string"> eq '#') { print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t    .\n<span class="hljs-string"><span class="hljs-string">"; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string"> = [</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">]; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string">-&gt;[0]; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> = 0; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string"> = scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">}; } elsif (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string"> eq '*') { if ((scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string">}) &gt; 1) { print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t    .\n<span class="hljs-string"><span class="hljs-string">"; shift @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string">}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string">-&gt;[0]; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{info_voice}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> = 0; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string"> = scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">}; } } elsif (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{menu}) { if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{menu}{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string">}) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{menu}{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string">}; print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t   [$cmenu-&gt;{title}].\n<span class="hljs-string"><span class="hljs-string">"; unshift @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$position</span></span></span><span class="hljs-string">}, </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{info_voice}; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string"> = 0; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_max</span></span></span><span class="hljs-string"> = scalar @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_out</span></span></span><span class="hljs-string">}; if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cmenu</span></span></span><span class="hljs-string">-&gt;{command}) { print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t  [$cmenu-&gt;{command}].\n<span class="hljs-string"><span class="hljs-string">"; system "</span></span>$cmenu-&gt;{command} &amp;<span class="hljs-string"><span class="hljs-string">"; } } } } #    if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checker</span></span></span><span class="hljs-string">==10) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> = at_send("</span></span>AT+CLCC<span class="hljs-string"><span class="hljs-string">",qr/^\^??(OK|ERROR|CEND)/); #    if (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rec</span></span></span><span class="hljs-string"> eq "</span></span>CEND<span class="hljs-string"><span class="hljs-string">") { print "</span></span>time: [$call_info{start_time}] \tphone: [$call_info{phone}] \t .\n<span class="hljs-string"><span class="hljs-string">"; return 0 } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checker</span></span></span><span class="hljs-string">=0; } #     </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$dtmf</span></span></span><span class="hljs-string">=0; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$checker</span></span></span><span class="hljs-string">++; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$snd_count</span></span></span><span class="hljs-string">++; #    while( gettimeofday-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$before</span></span></span><span class="hljs-string"> &lt; 0.02 ) { } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$before</span></span></span><span class="hljs-string"> = gettimeofday; } #  . at_send('AT+CHUP'); #      close </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">; } sub play_voice{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice</span></span></span><span class="hljs-string"> = shift; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$count</span></span></span><span class="hljs-string"> = shift || 1; while (</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$count</span></span></span><span class="hljs-string">) { for my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sampe</span></span></span><span class="hljs-string"> (@{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice</span></span></span><span class="hljs-string">}){ syswrite </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT_WAV</span></span></span><span class="hljs-string">, </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sampe</span></span></span><span class="hljs-string">, 320; #sleep(0.02); my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$before</span></span></span><span class="hljs-string"> = gettimeofday; while( gettimeofday-</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$before</span></span></span><span class="hljs-string"> &lt; 0.02 ) { } } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$count</span></span></span><span class="hljs-string">--; } } #      sub load_menu{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_file_name</span></span></span><span class="hljs-string"> = shift; my %voice_menu = do </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_file_name</span></span></span><span class="hljs-string">; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}{null}{title_voice} = load_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}{null}{title_voice_fname}); </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}{back}{title_voice} = load_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}{back}{title_voice_fname}); </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}{back_to_main}{title_voice} = load_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{title_voice_fname}); load_menu_voices(\%voice_menu,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$voice_menu</span></span></span><span class="hljs-string">{standart_messages}); return \%voice_menu; } #       sub load_menu_voices{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string"> = shift; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string"> = shift; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice} = load_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice_fname}); for my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$key</span></span></span><span class="hljs-string"> (sort {</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$a</span></span></span><span class="hljs-string"> &lt;=&gt; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$b</span></span></span><span class="hljs-string">} keys %{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{menu}}){ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cur</span></span></span><span class="hljs-string"> = </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{menu}{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$key</span></span></span><span class="hljs-string">}; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sub_voice</span></span></span><span class="hljs-string"> = load_menu_voices(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$cur</span></span></span><span class="hljs-string">,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string">); </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice} = [@{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice}},@{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$sub_voice</span></span></span><span class="hljs-string">}]; } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice} = [ @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{info_voice}}, @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string">-&gt;{back}{title_voice}}, @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string">-&gt;{back_to_main}{title_voice}}, @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string">-&gt;{null}{title_voice}}, @{</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$standart_messages</span></span></span><span class="hljs-string">-&gt;{null}{title_voice}} ]; return load_voice(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$menu</span></span></span><span class="hljs-string">-&gt;{title_voice_fname}); } #          320  #  1  -   #    - pcm, , 8000 , 16 , signed sub load_voice{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_file_name</span></span></span><span class="hljs-string"> = shift; print "</span></span>FILENAME: [$l_file_name]\n<span class="hljs-string"><span class="hljs-string">"; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string"> = new IO::File "</span></span>&lt; $l_file_name<span class="hljs-string"><span class="hljs-string">" or die "</span></span>Cannot <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> $l_file_name : $!<span class="hljs-string"><span class="hljs-string">"; binmode(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">); my @l_bufer = (); my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">=0; while (read(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_bufer</span></span></span><span class="hljs-string">[</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">],320)) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$i</span></span></span><span class="hljs-string">++; } close </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_fh</span></span></span><span class="hljs-string">; return \@l_bufer; } #         #        #  2 : # 1- -  # 2- -       (  OK) sub at_send{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_cmd</span></span></span><span class="hljs-string"> = shift; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rx</span></span></span><span class="hljs-string"> = shift || qr/(OK)/; print </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT</span></span></span><span class="hljs-string"> "</span></span>$l_cmd\r<span class="hljs-string"><span class="hljs-string">"; print "</span></span>SEND: [$l_cmd]\n<span class="hljs-string"><span class="hljs-string">" if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$VERBOSE</span></span></span><span class="hljs-string">; return at_rec(</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rx</span></span></span><span class="hljs-string">); } #           #  1  -       (  OK) sub at_rec{ my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rx</span></span></span><span class="hljs-string"> = shift || qr/OK/; my </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">=''; #print "</span></span>white: [$l_rx]\n<span class="hljs-string"><span class="hljs-string">"; until ( </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">=~</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rx</span></span></span><span class="hljs-string"> ) { </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">=&lt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT</span></span></span><span class="hljs-string">&gt;; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">=~s/[\n\r]+//msg; print "</span></span>RECIVE: [$recive]\n<span class="hljs-string"><span class="hljs-string">" if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$VERBOSE</span></span></span><span class="hljs-string"> &amp;&amp; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">; } </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$recive</span></span></span><span class="hljs-string">=~</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$l_rx</span></span></span><span class="hljs-string">; print "</span></span>END RECIVE: [$recive] [$<span class="hljs-number"><span class="hljs-number">1</span></span>] [$l_rx]\n<span class="hljs-string"><span class="hljs-string">" if </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$VERBOSE</span></span></span><span class="hljs-string">; return $1; } #        sub exit_call{ print "</span></span> \n<span class="hljs-string"><span class="hljs-string">"; close </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT_WAV</span></span></span><span class="hljs-string">; at_send('AT+CHUP'); close </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$SENDPORT</span></span></span><span class="hljs-string">; }</span></span></code> </pre> <br><br>  dtmf_decoder.pm <br><pre> <code class="hljs smalltalk"># : dtmf_detect # : lastuniverse #      <span class="hljs-type"><span class="hljs-type">Mr</span></span>. <span class="hljs-type"><span class="hljs-type">Blue</span></span>: # http://www.phrack.org/issues.html?issue=<span class="hljs-number"><span class="hljs-number">50</span></span>&amp;id=<span class="hljs-number"><span class="hljs-number">13</span></span> #       # http://ru.wikipedia.org/wiki/%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-number"><span class="hljs-number">90</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">BB</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">B3</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">BE</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">80</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">B8</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">82</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">BC_</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-number"><span class="hljs-number">93</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">91</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">80</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">86</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">B5</span></span>%<span class="hljs-type"><span class="hljs-type">D0</span></span>%<span class="hljs-type"><span class="hljs-type">BB</span></span>%<span class="hljs-type"><span class="hljs-type">D1</span></span>%<span class="hljs-number"><span class="hljs-number">8</span></span>F # http://www.dsplib.ru/content/goertzel/goertzel.html use v5<span class="hljs-number"><span class="hljs-number">.16</span></span>; #   <span class="hljs-type"><span class="hljs-type">Perl</span></span>    use strict; #    use warnings; #    use diagnostics; #     use utf8; use locale; package dtmf_decoder; #     require <span class="hljs-type"><span class="hljs-type">Exporter</span></span>; #    <span class="hljs-type"><span class="hljs-type">Exporter</span></span> our @<span class="hljs-type"><span class="hljs-type">ISA</span></span> = qw(<span class="hljs-type"><span class="hljs-type">Exporter</span></span>); #      our @<span class="hljs-type"><span class="hljs-type">EXPORT</span></span> = qw(dtmf_sample dtmf_clear); # ,    our @<span class="hljs-type"><span class="hljs-type">EXPORT_OK</span></span> = qw(_recalc ); # ,    #            my %o = ( #         #      f =&gt; { <span class="hljs-string"><span class="hljs-string">'697'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'770'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'852'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'941'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'1209'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'1336'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'1477'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> =&gt; { <span class="hljs-type"><span class="hljs-type">K</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-type"><span class="hljs-type">C</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span> }, }, #       dtmf  # <span class="hljs-number"><span class="hljs-number">1209</span></span>  <span class="hljs-number"><span class="hljs-number">1336</span></span>  <span class="hljs-number"><span class="hljs-number">1477</span></span>  <span class="hljs-number"><span class="hljs-number">1633</span></span>  # <span class="hljs-number"><span class="hljs-number">697</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-type"><span class="hljs-type">A</span></span> # <span class="hljs-number"><span class="hljs-number">770</span></span>  <span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-type"><span class="hljs-type">B</span></span> # <span class="hljs-number"><span class="hljs-number">852</span></span>  <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-type"><span class="hljs-type">C</span></span> # <span class="hljs-number"><span class="hljs-number">941</span></span>  * <span class="hljs-number"><span class="hljs-number">0</span></span> # <span class="hljs-type"><span class="hljs-type">D</span></span> rf =&gt; [ <span class="hljs-string"><span class="hljs-string">'697'</span></span>, <span class="hljs-string"><span class="hljs-string">'770'</span></span>, <span class="hljs-string"><span class="hljs-string">'852'</span></span>, <span class="hljs-string"><span class="hljs-string">'941'</span></span> ], cf =&gt; [ <span class="hljs-string"><span class="hljs-string">'1209'</span></span>, <span class="hljs-string"><span class="hljs-string">'1336'</span></span>, <span class="hljs-string"><span class="hljs-string">'1477'</span></span>, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> ], #       dtmf  dtmf =&gt; { <span class="hljs-string"><span class="hljs-string">'697'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'1209'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'1336'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'1477'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span> }, <span class="hljs-string"><span class="hljs-string">'770'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'1209'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-string"><span class="hljs-string">'1336'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'1477'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">8</span></span> }, <span class="hljs-string"><span class="hljs-string">'852'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'1209'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">'1336'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'1477'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">12</span></span> }, <span class="hljs-string"><span class="hljs-string">'941'</span></span> =&gt; { <span class="hljs-string"><span class="hljs-string">'1209'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>, <span class="hljs-string"><span class="hljs-string">'1336'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-string"><span class="hljs-string">'1477'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-string"><span class="hljs-string">'1633'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">16</span></span> }, }, #   dtmf  (   #     dtmf) #  -    info =&gt; [<span class="hljs-string"><span class="hljs-string">'NONE'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'2'</span></span>, <span class="hljs-string"><span class="hljs-string">'3'</span></span>, <span class="hljs-string"><span class="hljs-string">'A'</span></span>, <span class="hljs-string"><span class="hljs-string">'4'</span></span>, <span class="hljs-string"><span class="hljs-string">'5'</span></span>, <span class="hljs-string"><span class="hljs-string">'6'</span></span>, <span class="hljs-string"><span class="hljs-string">'B'</span></span>, <span class="hljs-string"><span class="hljs-string">'7'</span></span>, <span class="hljs-string"><span class="hljs-string">'8'</span></span>, <span class="hljs-string"><span class="hljs-string">'9'</span></span>, <span class="hljs-string"><span class="hljs-string">'C'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'#'</span></span>, <span class="hljs-string"><span class="hljs-string">'D'</span></span>], #        tones =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, # .     rate =&gt; <span class="hljs-number"><span class="hljs-number">8000</span></span>, #     len =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, #      #          <span class="hljs-number"><span class="hljs-number">320</span></span>  #      (<span class="hljs-number"><span class="hljs-number">2</span></span>   <span class="hljs-number"><span class="hljs-number">1</span></span> ) # (  <span class="hljs-number"><span class="hljs-number">100</span></span>    ) range =&gt; <span class="hljs-number"><span class="hljs-number">0.15</span></span>, #       thresh =&gt; <span class="hljs-number"><span class="hljs-number">99999999</span></span>, #         mincount =&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>, #         #        # range, thresh  mincount      #      dtmf    #  . debug =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, #     #        t =&gt; { mincount =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, sample =&gt; [], power =&gt; {}, maxpower =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, thresh =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, on =&gt; {}, last_dtmf =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span> } ); #           sub _recalc { <span class="hljs-string"><span class="hljs-string">$o</span></span>{tones} = scalar keys %{<span class="hljs-string"><span class="hljs-string">$o</span></span>{f}}; for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (sort { <span class="hljs-string"><span class="hljs-string">$a</span></span> &lt;=&gt; <span class="hljs-string"><span class="hljs-string">$b</span></span> } keys %{<span class="hljs-string"><span class="hljs-string">$o</span></span>{f}}) { <span class="hljs-string"><span class="hljs-string">$o</span></span>{f}{<span class="hljs-string"><span class="hljs-string">$f</span></span>}{<span class="hljs-type"><span class="hljs-type">K</span></span>} = <span class="hljs-string"><span class="hljs-string">$o</span></span>{len} * <span class="hljs-string"><span class="hljs-string">$f</span></span> / <span class="hljs-string"><span class="hljs-string">$o</span></span>{rate}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{f}{<span class="hljs-string"><span class="hljs-string">$f</span></span>}{<span class="hljs-type"><span class="hljs-type">C</span></span>} = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * cos( <span class="hljs-number"><span class="hljs-number">2.0</span></span> * <span class="hljs-number"><span class="hljs-number">3.14159265</span></span> * <span class="hljs-string"><span class="hljs-string">$o</span></span>{f}{<span class="hljs-string"><span class="hljs-string">$f</span></span>}{<span class="hljs-type"><span class="hljs-type">K</span></span>} / <span class="hljs-string"><span class="hljs-string">$o</span></span>{len} ); print <span class="hljs-comment"><span class="hljs-comment">"COEFF: [$f] \t[$o{f}{$f}{K}] \t[$o{f}{$f}{C}]\n"</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>{debug}; } } #        ( ) sub _calc_power { my <span class="hljs-string"><span class="hljs-string">$f</span></span>req_list = shift; my @fk = @{<span class="hljs-string"><span class="hljs-string">$f</span></span>req_list}; my %ff = %{<span class="hljs-string"><span class="hljs-string">$o</span></span>{f}}; my %fp = %{<span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power}}; my %u0 = (); my %u1 = (); my <span class="hljs-string"><span class="hljs-string">$t</span></span> = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; my <span class="hljs-string"><span class="hljs-string">$i</span></span>n = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; my <span class="hljs-string"><span class="hljs-string">$i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (@fk) { <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-number"><span class="hljs-number">0.0</span></span>; } while (<span class="hljs-string"><span class="hljs-string">$i</span></span>&lt;<span class="hljs-string"><span class="hljs-string">$o</span></span>{len}) { # feedback <span class="hljs-string"><span class="hljs-string">$i</span></span>n = <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{sample}[<span class="hljs-string"><span class="hljs-string">$i</span></span>] || <span class="hljs-number"><span class="hljs-number">0</span></span>; # &gt;&gt; <span class="hljs-number"><span class="hljs-number">7</span></span>; for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (@fk) { <span class="hljs-string"><span class="hljs-string">$t</span></span> = <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>}; <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-string"><span class="hljs-string">$i</span></span>n + <span class="hljs-string"><span class="hljs-string">$f</span></span>f{<span class="hljs-string"><span class="hljs-string">$f</span></span>}{<span class="hljs-type"><span class="hljs-type">C</span></span>} * <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} - <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>}; <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-string"><span class="hljs-string">$t</span></span>; } <span class="hljs-string"><span class="hljs-string">$i</span></span>++; } print <span class="hljs-comment"><span class="hljs-comment">"MAXPOWER: ["</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>{debug} &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (@fk) { <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} * <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} + <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>} * <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>} - <span class="hljs-string"><span class="hljs-string">$f</span></span>f{<span class="hljs-string"><span class="hljs-string">$f</span></span>}{<span class="hljs-type"><span class="hljs-type">C</span></span>} * <span class="hljs-string"><span class="hljs-string">$u</span></span>0{<span class="hljs-string"><span class="hljs-string">$f</span></span>} * <span class="hljs-string"><span class="hljs-string">$u</span></span>1{<span class="hljs-string"><span class="hljs-string">$f</span></span>}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower} = <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} if <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} &gt; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower}; print <span class="hljs-comment"><span class="hljs-comment">"$o{t}{maxpower}, "</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>{debug} &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; } print <span class="hljs-comment"><span class="hljs-comment">"]\n"</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>{debug} &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>; } #         <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower} #       #           <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} sub _midle_calc { my <span class="hljs-string"><span class="hljs-string">$f</span></span>req_list = shift; my @fl = @{<span class="hljs-string"><span class="hljs-string">$f</span></span>req_list}; _calc_power(<span class="hljs-string"><span class="hljs-string">$f</span></span>req_list); return <span class="hljs-number"><span class="hljs-number">0</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower} &lt; <span class="hljs-string"><span class="hljs-string">$o</span></span>{thresh}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{thresh} = <span class="hljs-string"><span class="hljs-string">$o</span></span>{range} * <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower}; my <span class="hljs-string"><span class="hljs-string">$o</span></span>n_count = <span class="hljs-number"><span class="hljs-number">0</span></span>; for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (@fl) { if (<span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} &gt; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{thresh}) { <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-string"><span class="hljs-string">$o</span></span>n_count++; } else { <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } return <span class="hljs-string"><span class="hljs-string">$o</span></span>n_count; } #      <span class="hljs-number"><span class="hljs-number">2</span></span>-     # <span class="hljs-number"><span class="hljs-number">1</span></span>-          dtmf #  <span class="hljs-number"><span class="hljs-number">1</span></span>-          dtmf #    -     dtmf () sub _decode { my <span class="hljs-string"><span class="hljs-string">$r</span></span>ow_count = _midle_calc(<span class="hljs-string"><span class="hljs-string">$o</span></span>{rf}); return <span class="hljs-number"><span class="hljs-number">0</span></span> unless <span class="hljs-string"><span class="hljs-string">$r</span></span>ow_count; my <span class="hljs-string"><span class="hljs-string">$c</span></span>ol_count += _midle_calc(<span class="hljs-string"><span class="hljs-string">$o</span></span>{cf}); return <span class="hljs-number"><span class="hljs-number">0</span></span> unless <span class="hljs-string"><span class="hljs-string">$c</span></span>ol_count; return <span class="hljs-number"><span class="hljs-number">0</span></span> unless <span class="hljs-string"><span class="hljs-string">$r</span></span>ow_count == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; <span class="hljs-string"><span class="hljs-string">$c</span></span>ol_count == <span class="hljs-number"><span class="hljs-number">1</span></span>; for my <span class="hljs-string"><span class="hljs-string">$d</span></span>tmf (@{<span class="hljs-string"><span class="hljs-string">$o</span></span>{rf}}) { if (<span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on}{<span class="hljs-string"><span class="hljs-string">$d</span></span>tmf}) { for my <span class="hljs-string"><span class="hljs-string">$f</span></span> (@{<span class="hljs-string"><span class="hljs-string">$o</span></span>{cf}}) { return <span class="hljs-string"><span class="hljs-string">$o</span></span>{dtmf}{<span class="hljs-string"><span class="hljs-string">$d</span></span>tmf}{<span class="hljs-string"><span class="hljs-string">$f</span></span>} if <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on}{<span class="hljs-string"><span class="hljs-string">$f</span></span>}; } } } <span class="hljs-symbol"><span class="hljs-symbol">#return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> if <span class="hljs-string"><span class="hljs-string">$o</span></span>n_count == <span class="hljs-number"><span class="hljs-number">0</span></span>; return <span class="hljs-number"><span class="hljs-number">0</span></span>; } #       dtmf  #     (mincount)    #        info sub _analise { my <span class="hljs-string"><span class="hljs-string">$x</span></span> = _decode(); _sample_clear(); <span class="hljs-symbol"><span class="hljs-symbol">#return</span></span> <span class="hljs-string"><span class="hljs-string">$x</span></span>; if (<span class="hljs-string"><span class="hljs-string">$x</span></span> &amp;&amp; <span class="hljs-string"><span class="hljs-string">$x</span></span> == <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf}){ <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{mincount}++; } else { if ( <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf} &amp;&amp; <span class="hljs-string"><span class="hljs-string">$x</span></span> != <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf} ) { if (<span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{mincount} &gt;= <span class="hljs-string"><span class="hljs-string">$o</span></span>{mincount}){ my <span class="hljs-string"><span class="hljs-string">$r</span></span> = <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf} = <span class="hljs-string"><span class="hljs-string">$x</span></span>; return <span class="hljs-string"><span class="hljs-string">$r</span></span>; } } <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{mincount} = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf} = <span class="hljs-string"><span class="hljs-string">$x</span></span>; return <span class="hljs-number"><span class="hljs-number">0</span></span>; } #        #        sub _sample_clear { <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{sample} = []; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{power} = {}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{maxpower} = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{on} = {}; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{thresh} = <span class="hljs-number"><span class="hljs-number">0</span></span>; } #       #      sub dtmf_clear { _sample_clear(); <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{mincount} = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{last_dtmf} = {}; } #       #        #  dtmf  sub dtmf_sample { my <span class="hljs-string"><span class="hljs-string">$_</span></span> = shift; my @a = unpack(<span class="hljs-comment"><span class="hljs-comment">"s$o{len}"</span></span>); <span class="hljs-string"><span class="hljs-string">$o</span></span>{t}{sample} = \@a; my <span class="hljs-string"><span class="hljs-string">$x</span></span> = _analise(); print <span class="hljs-comment"><span class="hljs-comment">"DTMF: ["</span></span>.<span class="hljs-string"><span class="hljs-string">$o</span></span>{info}[<span class="hljs-string"><span class="hljs-string">$x</span></span>].<span class="hljs-comment"><span class="hljs-comment">"]\n"</span></span> if <span class="hljs-string"><span class="hljs-string">$x</span></span>; #&amp;&amp; <span class="hljs-string"><span class="hljs-string">$o</span></span>{debug}; return <span class="hljs-string"><span class="hljs-string">$o</span></span>{info}[<span class="hljs-string"><span class="hljs-string">$x</span></span>] if <span class="hljs-string"><span class="hljs-string">$x</span></span>; } #         _recalc(); <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre><br><br>  menu.01.pl <br><pre> <code class="hljs rust"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> utf8; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> locale; ( standart_messages =&gt; { back =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">"   "</span></span>, #    title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/back.raw"</span></span> #     (      *) }, null =&gt; { title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/null.raw"</span></span> #     (      *) } }, title =&gt; <span class="hljs-string"><span class="hljs-string">" "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/main.menu.info.raw"</span></span>, #      (      --) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/main.menu.title.raw"</span></span>, #     (      #) menu =&gt; { <span class="hljs-string"><span class="hljs-string">'1'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">" "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.1.info.raw"</span></span>, #      (       --) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.1.title.raw"</span></span> #     (         <span class="hljs-number"><span class="hljs-number">1</span></span>) }, <span class="hljs-string"><span class="hljs-string">'2'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">" "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.info.raw"</span></span>, #      (    -  ) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.title.raw"</span></span>, #     (         <span class="hljs-number"><span class="hljs-number">2</span></span>) menu =&gt; { <span class="hljs-string"><span class="hljs-string">'1'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">"  "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.1.info.raw"</span></span>, #      (  <span class="hljs-string"><span class="hljs-string">"  "</span></span>  --) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.1.title.raw"</span></span> #     (        <span class="hljs-string"><span class="hljs-string">"  "</span></span>  <span class="hljs-number"><span class="hljs-number">1</span></span>) }, <span class="hljs-string"><span class="hljs-string">'2'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">" "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.2.info.raw"</span></span>, #      (  <span class="hljs-string"><span class="hljs-string">" "</span></span>  --) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.2.2.title.raw"</span></span> #     (        <span class="hljs-string"><span class="hljs-string">" "</span></span>  <span class="hljs-number"><span class="hljs-number">2</span></span>) }, } }, <span class="hljs-string"><span class="hljs-string">'9'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">" "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.9.info.raw"</span></span>, #      () title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.9.title.raw"</span></span> #     (      <span class="hljs-number"><span class="hljs-number">9</span></span>) }, <span class="hljs-string"><span class="hljs-string">'8'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">"  "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.8.info.raw"</span></span>, #      (  ) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.8.title.raw"</span></span>, #     (     <span class="hljs-string"><span class="hljs-string">" "</span></span>  <span class="hljs-number"><span class="hljs-number">8</span></span>) command =&gt; <span class="hljs-symbol"><span class="hljs-symbol">'echo</span></span> <span class="hljs-string"><span class="hljs-string">"    -&gt; rm -R *"</span></span>' }, <span class="hljs-string"><span class="hljs-string">'7'</span></span> =&gt; { title =&gt; <span class="hljs-string"><span class="hljs-string">"  "</span></span>, #    info_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.7.info.raw"</span></span>, #      (      ) title_voice_fname =&gt; <span class="hljs-string"><span class="hljs-string">"./menu.01/sub.menu.7.title.raw"</span></span>, #     (       <span class="hljs-number"><span class="hljs-number">7</span></span>) record =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span> } } );</code> </pre><br><br><h5>  Promised Bonus </h5><br>  by numerous requests I filled in all the available developments on the topic of the article on <a href="https://github.com/lastuniverse/huawei">github</a> <br><br>  If you find errors, write in a personal, correct. </div><p>Source: <a href="https://habr.com/ru/post/193586/">https://habr.com/ru/post/193586/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../193576/index.html">I want to congratulate all colleagues on the Day of the Programmer</a></li>
<li><a href="../193578/index.html">Private space is now in Russia</a></li>
<li><a href="../193580/index.html">2GIS - separately, spammers - separately</a></li>
<li><a href="../193582/index.html">The contest ‚ÄúFriday, the 13th, the Day of the Programmer‚Äù</a></li>
<li><a href="../193584/index.html">Ethics (or unethical) massive government surveillance</a></li>
<li><a href="../193588/index.html">Protect the Internet, or Hands off, cursed NSA, from the brainchild of the military-industrial complex!</a></li>
<li><a href="../193592/index.html">What is silent Gantt chart or why projects are always late</a></li>
<li><a href="../193594/index.html">Report from the hacker tournament and security conference with Mitnick</a></li>
<li><a href="../193598/index.html">Once again about Deferred / Promise</a></li>
<li><a href="../193600/index.html">What kids think about programmers and programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>