<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a wifi access point for a wifi router</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many modern home routers are essentially a mini-computer - which isn‚Äôt that there is a monitor or mouse / keyboard. However, given the purpose of thes...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a wifi access point for a wifi router</h1><div class="post__text post__text-html js-mediator-article"> Many modern home routers are essentially a mini-computer - which isn‚Äôt that there is a monitor or mouse / keyboard.  However, given the purpose of these very pieces of iron, the latter is not a problem at all. <br><br>  As a rule, in the base firmware, the router can distribute the Internet to one or several LAN ports, as well as maintain its own wireless network.  More advanced models often include one or more USB ports where you can connect, for example, a printer or a flash drive with files. <br><br>  However, all the richness of the possibilities of this hardware is revealed when using open firmware.  For beginners - dd-wrt, for more advanced ones - the open-wrt series and other wrt-based. <br>  This article focuses on setting up an anonymized wifi point based on an Asus RT-N16 router with dd-wrt firmware and optware. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The original idea is not new - it has been in the air for a long time, and one of the implementations was even somehow <a href="http://habrahabr.ru/blogs/infosecurity/110536/">announced</a> at Habr√©.  However, with regard to the details - they are usually not found.  I did not find this in the private "how-to", but obviously a knowledgeable guru, apparently, had no time for writing such instructions.  So I had to figure it out for myself.  Well, at the same time to record what was done - for the future. <br><br>  So, we have a router with stitched dd-wrt.  This specific model, alas, does not have Open-wrt support (or, at least, did not have it at the time when it was required. Now the beta has appeared, but it does not yet claim stability). <br><br>  What else is needed?  If we confine ourselves only to tor, then perhaps nothing.  You can do without all optware and even without an external flash drive.  You just need to find where to pack about 1.5 MB of binary into the router.  I, however, raised not only an access point, but a full-fledged home server, the main task of which was to maintain the network (basic services - DNS, DHCP), distribute the Internet, contain a small (500 gigabytes that way) file manager with access to NFS (well, make no mistake. I don‚Äôt use Windows, so SAMBA is not needed), replenish this file with new torrents on my own, host several web pages for various handicrafts (all stuffing: - lighttpd, php, mysql and even sphinx) for booting Ubuntu over the network (so that when needed in a ‚Äúdead body‚Äù all  ulation is not a flash card with the image, and a network cable).  And, apparently, everything (and maybe forgot what).  In order to externally everything was beautiful and with a minimum of wires - a 640GB hard disk for all our plans was placed right inside the router, and the free space was significantly increased.  And tor on the router was placed, rather, out of curiosity.  However, it took root and works stably. <br><br>  To install and configure, you need access to the router via telnet or (which is much safer) via ssh.  Access can be arranged (or peeped) in the dd-wrt web interface. <br>  First install tor: <br><br> <code>root@DD-WRT:~# ipkg install tor <br></code> <br><br>  Then we govern its config.  In the case of optware, it is located in / opt / etc / torrc.  Again, I note that the path to the default configuration is not at all mandatory.  The program can always be started with a different configuration file, but it will have to be explicitly specified in the launch options.  In this regard, the default path is still easier, as long as the launch of the program makes it more concise. <br><br>  The default config is well commented, and the basic configuration can be made just by reading these comments, without any third-party manuals.  In my case, the router serves the home network 192.168.1.0/24.  In it, I decided to make a classic tor with access like a proxy socks5 on port 9100. In addition, I decided to make an anonymized access point that will allow users to the network 192.168.2.0/24, where all communication with the outside world will be only through tor (transparent proxy ), or just chopped off.  In other words - we have a wifi-point, connecting to which we will not get either to neighbors from the same network (192.168.2.0/24), nor to my home network (192.168.1.0/24), nor to the local services of the router.  And we can only get on the Internet, and only in an anonymous way (via tor). <br><br>  For this, the following local parameters are specified in the config: <br>  For home network: <br><br> <code>SockListenAddress 192.168.1.5:9100 <br></code> <br><br>  In essence, this means that in order to go anonymously to the Internet, I must configure the browser to connect through socks5 proxy with the specified address (this is the internal address of the router). <br><br>  For anonymous network: <br><br> <code>TransPort 9040 <br> TransListenAddress 192.168.2.1 <br> DNSPort 9053 <br> DNSListenAddress 192.168.2.1 <br></code> <br><br>  In an anonymous network, clients will not connect anywhere, and the specified ports and address are needed only to configure iptables rules. <br><br>  In addition to these settings, it also makes sense to assign a virtual network address: <br><br> <code>VirtualAddrNetwork 10.192.0.0/10 <br></code> <br><br>  This address is necessary in case of transition to internal anonymous services (so-called 'hidden service') of the tor-net.  These are addresses of sites located in the .onion domain.  There is no such domain in real life;  however, being in tor, their own DNS recognizes such addresses and takes you to the right resource hidden somewhere in the depth of the network.  At the same time, the actual IP address of such a site is hidden, and it is impossible to recognize it.  In this case, for programs that first resolve the host address via DNS, and then connect to the received ip address, the tor daemon creates a temporary address from the specified virtual network mask.  In other words, when you try to connect to some superpuper.onion node, it will ‚Äúresolve‚Äù to the address, for example, 10.192.0.1.  And the program, connecting to this address, will reach the necessary resource through the ‚Äúonion layers‚Äù of tor-encryption. <br><br>  As for setting the ‚Äúpublic‚Äù part of the config, everything is there, according to the comments in the file itself. <br>  As a result of these settings, we will get a daemon that <br>  1) is proxy-socks with the address 192.168.1.5:9100 <br>  2) is a transparent proxy with the address 192.168.2.1, and besides tcp-traffic it can handle DNS requests. <br><br>  With local socks proxy, everything is clear.  Simply configure any browser in your home network to access the Internet through the specified proxy - and everything works. <br><br>  Accessing from a remote machine is no more difficult (we also have an ssh-console on the router, which means that nothing prevents you from simply forwarding the port: <br><br> <code>ssh -L localhost:9100:192.168.1.5:9100 homerouter <br></code> <br><br>  - and after that on that machine it will earn Socks5 at the address localhost: 9100. <br><br>  Now configure the access point. <br><br>  To do this, go to the wireless tab in gui dd-wrt and add a virtual interface there.  Think up your own name (I called it ingenuously: tor_network).  The network configuration is unbridged (i.e., the point has no connection with other interfaces and forms its own closed world, as it were).  We also prohibit masquerading and multicast in the same place and assign the network address: 192.168.2.1/255.255.255.0.  Then, on the wireless security tab, configure, if necessary, access to the point.  In my case, I set ‚Äúdisabled‚Äù, i.e.  created an open point. <br><br>  Thus, we have two different networks working at the same time on the router: home (protected by WPA2) and the newly created tor_network, which is initially open.  However, it does not give anyone any privileges, because by connecting to this open network, we will not get anywhere :) <br><br>  Moving on.  On the Setup / Networking tab, we are looking at the very bottom of the DHCPD section and add an entry for the wl0.1 interface (this is, in fact, the iron name of the new virtual wifi interface) to assign addresses from the 192.168.2.0/24 subnet.  Let's say 50 addresses starting with 100 are enough. <br><br>  Now connecting to our open point, we get an internal ip-address. <br>  It remains only to connect this point to the transparent tor. <br>  This is done using iptables: <br><br> <code>CRNET="192.168.2.0/24" <br> TORCMD="iptables -t nat -A PREROUTING -i wl0.1" <br> TORPORT="9040" <br> TORDNS="9053" <br> <br> # transparent tor for tor_network wireless <br> $TORCMD -p udp --dport 53 -j REDIRECT --to-ports $TORDNS <br> $TORCMD -p udp --dport 67 -j RETURN <br> $TORCMD -d $CRNET -j DROP <br> $TORCMD -p tcp --syn -j REDIRECT --to-ports $TORPORT <br> $TORCMD -j DROP <br></code> <br><br>  What are we doing? <br>  1. Redirect all udp traffic to port 53 (dns) to the port of our daemon. <br>  2. We skip calmly all udp traffic to port 67 (dhcp hangs there) <br>  3. All other traffic to the internal open network, no matter where it comes from, is cut off. <br>  4. Redirect all tcp traffic to the transparent proxy port of our daemon. <br>  5. We cut off all the rest of the open network traffic. <br><br>  This script can be inserted into Administration / commands and saved as a firewall script. <br><br>  We check the work: we connect to the tor_network point and open the address <a href="http://check.torproject.org/">check.torproject.org/</a> .  We should see a green bulb and congratulations on a successful setup.  Next - try to open the address <a href="http://duskgytldkxiuqc6.onion/">duskgytldkxiuqc6.onion/</a> .  If everything is in order, then after some delay the address will open.  In this case, absolutely no settings on the client side are required;  we simply connect to the open tor_network wifi network and thereby automatically find ourselves hidden behind a multi-layer proxy anonymizer. <br><br>  As an added bonus, initially increased anonymity, since the daemon running on the iron router by default does not write any logs anywhere and leaves no traces in the system. </div><p>Source: <a href="https://habr.com/ru/post/129603/">https://habr.com/ru/post/129603/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129597/index.html">Automatic addition, removal of posts and comments to them on Facebook</a></li>
<li><a href="../129599/index.html">Open InfoSec Days in Tomsk. Activity summary</a></li>
<li><a href="../129600/index.html">Making a dDNS client for DNS Yandex</a></li>
<li><a href="../129601/index.html">Farminers: we pay 1000 euros for the contacts of a successful startup company</a></li>
<li><a href="../129602/index.html">Great opportunity to get together and make</a></li>
<li><a href="../129604/index.html">PlayStation invites to Igromir</a></li>
<li><a href="../129605/index.html">Wi-Fi in schools and hospitals in Moscow</a></li>
<li><a href="../129607/index.html">Google brews beer</a></li>
<li><a href="../129608/index.html">Mount for a laptop on the monitor (rear)</a></li>
<li><a href="../129609/index.html">Convenient Windows Policy Reference</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>