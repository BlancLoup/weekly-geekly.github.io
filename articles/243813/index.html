<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Interactive voice editing of text with the help of new speech technologies from Yandex</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, our Dictation application for interactive voice writing and editing has appeared in the AppStore and Google Play . His main task is to demonstr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Interactive voice editing of text with the help of new speech technologies from Yandex</h1><div class="post__text post__text-html js-mediator-article">  Today, our Dictation application for interactive voice writing and editing has appeared in the <a href="https://itunes.apple.com/ru/app/andeks.diktovka/id927990975%3Fl%3Dru%26ls%3D1%26mt%3D8">AppStore</a> and <a href="https://play.google.com/store/apps/details%3Fid%3Dru.yandex.dictation">Google Play</a> .  His main task is to demonstrate some of the new features of the Yandex speech technology complex.  It is about what our speech recognition and synthesis technologies are interesting and unique to, I want to tell you in this post. <br><br> <a href="http://habrahabr.ru/company/yandex/blog/243813/"><img src="https://habrastorage.org/files/7fd/54b/29e/7fd54b29e3d045c6a88b89a1370ddce8.png"></a> <br><br>  A couple of words, so that you understand what it will be about.  Yandex has long been providing a free <a href="https://tech.yandex.ru/speechkit/mobilesdk/">mobile API</a> that can be used, for example, to recognize addresses and voice search queries.  During this year we were able to bring its quality to almost the same level at which people themselves understand such requests and replicas.  And now we are taking the next step - a model for recognizing free speech on any topic. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, our speech synthesis supports the emotions in the voice.  And, as far as we know, this is still the first commercially available speech synthesis with such an opportunity. <br><br>  About all this, as well as some other features of SpeechKit: about voice activation, automatic placement of punctuation signs and recognition of semantic objects in the text - read below. <br><a name="habracut"></a><br><h3>  Omnivorous ASR and recognition quality </h3><br>  SpeechKit's speech recognition system works with different types of text, and last year we worked on expanding its scope.  For this, we have created a new language model, while the largest, to recognize short texts on any topic. <br><br>  Over the past year, the relative share of mistakenly recognized words ( <a href="http://en.wikipedia.org/wiki/Word_error_rate">Word Error Rate</a> ) has decreased by 30%.  For example, today SpeechKit correctly recognizes 95% of addresses and geographic objects, coming close to a person who understands 96‚Äì98% of words he heard.  The completeness of recognition of a new model for dictation of various texts now amounts to 82%.  With this level, you can create a complete solution for end users, which we wanted to show by the example of dictation. <br><br>  Initially, SpeechKit worked only for search queries: general subjects and geo-navigation.  Although even then we planned to make not just an additional input tool, a ‚Äúvoice‚Äù keyboard, but a universal interface that would completely replace any interaction with the system with live conversation. <br><br>  For this it was necessary to learn to recognize any speech, texts on an arbitrary topic.  And we started working on a separate language model for this, which was several times larger than the existing geosteering and general search models. <br><br>  Such a size of the model set new conditions in terms of computing resources.  For each frame are considered several thousand variants of recognition - and the more we have time, the higher the quality.  And the system should work in a stream, in real time, so all calculations need to be optimized dynamically.  Experimented, tried, searched for an approach: accelerations were achieved, for example, by changing the library of linear algebra. <br><br><img src="https://habrastorage.org/files/9b0/1ae/d56/9b01aed56f4340db96ce995a119f36d9.jpg"><br><br>  But the most important and difficult thing was to collect enough correct data suitable for teaching streaming speech.  Currently, about 500 hours of manually transcribed speech are used to train the acoustic model.  This is not such a big base - for comparison, the popular scientific building of <a href="https://catalog.ldc.upenn.edu/LDC97S62">Switchboard</a> , which is often used for research purposes, contains about 300 hours of live, spontaneous conversations.  Of course, an increase in the base contributes to the growth of the quality of the model being taught, but we focus on the correct preparation of data and model the transcriptions more accurately, which allows us to study on a relatively small base with an acceptable quality. <br><br>  A few words about how the recognition module works (we talked about this in detail some time ago).  The stream of recorded speech is cut into frames of 20 ms, the signal spectrum is scaled and after a series of transformations for each frame, the <a href="http://en.wikipedia.org/wiki/Mel-frequency_cepstrum"><abbr title="Mel Frequency Cepstral Coefficients">MFCC is</abbr></a> obtained. <br><br><img src="https://habrastorage.org/files/2e9/417/13a/2e941713afc443f9bee2a7606a0ac445.jpg"><br><br>  The coefficients arrive at the input of the acoustic model, which calculates the probability distribution for approximately 4000 senons in each frame.  Senon is the beginning, middle, or end of a phoneme. <br><br>  SpeechKit's acoustic model is built on a combination of <a href="http://en.wikipedia.org/wiki/Hidden_Markov_model">hidden Markov models</a> and a deep forward-propagation neural network ( <a href="http://en.wikipedia.org/wiki/Deep_learning">feedforward <abbr>DNN</abbr></a> ).  This is a proven solution, and in the last article we described how the rejection of <a href="http://en.wikipedia.org/wiki/Mixture_model">Gaussian mixtures</a> in favor of DNN gave an almost double leap in quality. <br><br><img src="https://habrastorage.org/files/640/ae7/9d4/640ae79d4b69401d9f775827c8f1dabc.png"><br><br>  Then the first language model enters: several <abbr>WFST</abbr> - weighted finite transducers - turn senons into context-dependent phonemes, and from them entire words are constructed using the dictionary of pronunciations, with hundreds of hypotheses being obtained for each word. <br><br><img src="https://habrastorage.org/files/db2/7d5/afa/db27d5afac7c45ffb1830364e8aba9ba.jpg"><br><br>  Final processing takes place in the second language model.  The <a href="http://en.wikipedia.org/wiki/Recurrent_neural_network"><abbr>RNN</abbr></a> , a recurrent neural network, is connected to it, and this model ranks the hypotheses obtained, helping to select the most plausible option.  A recurrent type network is especially effective for a language model.  Defining the context of each word, it can take into account the influence not only of the closest words, as in the neural network of direct propagation (for example, for the trigram model, these are the two preceding words), but also further away, as if ‚Äúremembering‚Äù them. <br><br><img src="https://habrastorage.org/files/1fb/c3b/eef/1fbc3beef29649beae20296a8dd6ef50.jpg"><br><br>  Recognition of long connected texts is available in the <a href="https://tech.yandex.ru/speechkit/cloud/">SpeechKit Cloud</a> and <a href="https://tech.yandex.ru/speechkit/mobilesdk/">SpeechKit Mobile SDK</a> - to use the new language model, in the query parameters you need to select the theme ‚Äúnotes‚Äù. <br><br><h3>  Voice activated </h3><br>  The second key component of the voice interface is the voice activation system, which triggers the desired action in response to the key phrase.  Without it, it will not be possible to fully untie the hands of the user.  For SpeechKit, we have developed our voice activation module.  The technology is very flexible - a developer using the SpeechKit library can choose any key phrase for his application. <br><br>  Unlike, for example, Google solutions - their developers use a deep neural network for recognizing the catchphrase "Okay, Google".  DNN gives high quality, but the activation system is limited to a single team, and training requires a huge amount of data.  Say, the model for recognizing all familiar phrases was trained on the example of more than 40 thousand user voices that applied to their smartphones from Google Now. <br><br>  With our approach, the voice activation module is, in fact, a recognition system in miniature.  It only works in tougher conditions.  First, command recognition must occur on the device itself, without accessing the server.  And the computing power of the smartphone is very limited.  Power consumption is also critical - if a conventional recognition module is turned on only for a certain time to process a specific request, the activation module runs continuously in the standby mode.  And while this should not put the battery. <br><br><img src="https://habrastorage.org/files/ba4/c4c/919/ba4c4c919a924bf5aeaf18b2d15b5b90.jpg"><br><br>  However, there is a relief - for the activation system you need a very small dictionary, because it is enough for it to understand a few key phrases, and the rest of the speech can be simply ignored.  Therefore, the language activation model is much more compact.  Most WFST states correspond to a certain part of our team ‚Äî for example, the ‚Äúbeginning of the fourth phoneme‚Äù.  There are also ‚Äújunk‚Äù states describing silence, extraneous noise and the rest of the speech, which is different from the key phrase.  If a full-featured recognition model in SpeechKit has tens of millions of states and takes up to 10 gigabytes, then for voice activation it is limited to hundreds of states and fits into several tens of kilobytes. <br><br>  Therefore, a model for recognizing a new key phrase is built without difficulty, allowing you to quickly scale the system.  There is one condition - the team should be long enough (preferably - more than one word) and rarely occur in everyday speech to eliminate false positives.  ‚ÄúPlease‚Äù is not a good choice for voice activation, and ‚Äúlisten to my command‚Äù is fine. <br><br>  Together with a limited language model and a ‚Äúlight‚Äù acoustic one, the recognition of commands can be done by any smartphone.  It remains to deal with power consumption.  The system has <a href="https://en.wikipedia.org/wiki/Voice_activity_detection">a</a> built <a href="https://en.wikipedia.org/wiki/Voice_activity_detection">-in voice activity detector</a> that monitors the appearance of the human voice in the incoming audio stream.  The remaining sounds are ignored, therefore in the background the power consumption of the activation module is limited only by the microphone. <br><br><h3>  Speech synthesis </h3><br>  The third major component of speech technology is text-to-speech synthesis.  <a href="https://en.wikipedia.org/wiki/Speech_synthesis">TTS</a> solution SpeechKit allows you to voice any text in a male or female voice, and even set the desired emotion.  None of the voice engines we know about in the market has such an opportunity. <br><br>  There are several fundamentally different speech synthesis technologies, and in most modern systems, concatenative synthesis using the ‚Äúunit selection‚Äù method is used.  A pre-recorded voice sample is cut into specific constituent elements (for example, context-dependent phonemes) from which the speech base is composed.  Then any necessary words are collected from individual units.  A believable imitation of a human voice is obtained, but it is difficult to perceive it - the timbre jumps, unnatural intonations and sharp transitions occur at the junctions of individual units.  This is especially noticeable when dubbing long coherent text.  The quality of such a system can be improved by increasing the volume of the speech base, but it is a long and painstaking work that requires the involvement of a professional and very patient speaker.  And the completeness of the base always remains a bottleneck of the system. <br><br>  In SpeechKit, we decided to use statistical (parametric) speech synthesis based on hidden Markov models.  The process, in fact, is similar to recognition, only occurs in the opposite direction.  The source code is transferred to the G2P module (grapheme-to-phoneme), where it is converted into a sequence of phonemes. <br><br><img src="https://habrastorage.org/files/bc1/448/23b/bc144823bdaf4f3fab1f67087f8285d9.jpg"><br><br>  Then they fall into the acoustic model, which generates vectors that describe the spectral characteristics of each phoneme.  These numbers are transmitted to the vocoder, which synthesizes sound. <br><br><img src="https://habrastorage.org/files/ad5/c12/1a4/ad5c121a44ad4f759618454786cb82ee.jpg"><br><br>  The timbre of such a voice is somewhat ‚Äúcomputerized‚Äù, but it has natural and smooth intonations.  At the same time, the smoothness of speech does not depend on the size and length of the readable text, and the voice is easy to adjust.  It is enough to specify one key in the request parameters, and the synthesis module will give out a voice with the corresponding emotional coloring.  Of course, no unit selection system is capable of this. <br><br>  In order for the voice model to be able to build algorithms corresponding to different emotions, it was necessary to train it properly.  Therefore, during the recording, our colleague Eugene, whose voice can be heard in SpeechKit, uttered her remarks in turn in a neutral voice, joyful and, conversely, annoyed.  During the training, the system identified and described the parameters and characteristics of the voice corresponding to each of these states. <br><br>  Not all voice modifications are built on learning.  For example, SpeechKit also allows you to color the synthesized voice with the parameters ‚Äúdrunk‚Äù and ‚Äúill‚Äù.  Our developers regretted Eugene, and she did not have to get drunk before recording or run in the cold to get a good cold. <br><br>  For a drunken voice, the speech slows down in a special way - each phoneme sounds about two times slower, which gives a characteristic effect.  And for the patient, the threshold for sound is raised - what is happening with the vocal chords of a person during laryngitis is actually modeled.  The voicing of different phonemes depends on whether the air passes through the human vocal tract freely or on the way there are vibrating vocal cords.  In the "disease" mode, each phoneme is sounded less likely, which makes the voice hoarse, planted. <br><br>  The statistical method also allows you to quickly expand the system.  In the unit selection model, in order to add a new voice, you need to create a separate speech base.  The announcer must record many hours of speech, while perfectly maintaining the same intonation.  In SpeechKit, to create a new voice, it is enough to record at least two hours of speech - approximately 1,800 special, phonetically balanced sentences. <br><br><h3>  Selection of semantic objects </h3><br>  It is important not only to translate the words that a person utters into letters, but also fill them with meaning.  The fourth technology, which is available in limited form in SpeechKit Cloud, does not concern directly the work with the voice - it starts to work after the spoken words are recognized.  But without it, a complete stack of speech technologies cannot be done - this is the selection of semantic objects in natural speech, which, at the output, provides not just recognized, but already marked text. <br><br>  Now in SpeechKit, the allocation of dates and time, name, addresses is implemented.  The hybrid system combines context-free grammars, keyword dictionaries and search statistics and various Yandex services, as well as machine learning algorithms.  For example, in the phrase ‚Äúgo to Lev Tolstoy Street‚Äù the word ‚Äústreet‚Äù helps the system determine the context, after which the corresponding object is located in the Yandex.Map database. <br><br><img src="https://habrastorage.org/files/d01/9ab/5cf/d019ab5cf67447aa9f1411647983e384.png"><br><br>  In Dictation, we built a voice editing feature on this technology.  The approach to the allocation of entities is fundamentally new, and the emphasis is placed on the simplicity of configuration - to set up the system, you do not need to own programming. <br><br>  The system‚Äôs input is supplied with a list of different types of objects and examples of phrases from live speech describing them.  Further, from these examples, using the Pattern Mining method, patterns are formed.  They take into account the initial form, roots, morphological variations of words.  The next step provides examples of the use of selected objects in various combinations that will help the system understand the context.  On the basis of these examples, a hidden Markov model is constructed, where the objects observed in the user's replica become observable states, and the corresponding objects from the subject field with an already known value become hidden. <br><br>  For example, there are two phrases: ‚Äúinsert" hello, friend "in the beginning" and "paste from buffer".  The system determines that in the first case, after ‚Äúinsert‚Äù (editing action), an arbitrary text goes, and in the second, an object known to it (‚Äúclipboard‚Äù), and reacts differently to these commands.  In the traditional system, this would require writing the rules or grammars manually, and in the new Yandex technology, context analysis is performed automatically. <br><br><h3>  Auto punctuation </h3><br>  While dictating something, in the resulting text you expect to see punctuation marks.  And they should appear automatically so that you do not have to talk to the interface in the telegraph style: "Dear friend - a comma - how are you - a question mark."  Therefore, SpeechKit is complemented by an automatic punctuation system. <br><br>  The role of punctuation marks in speech is played by intonation pauses.  Therefore, initially we tried to build a full-fledged acoustic and language model for their recognition.  Each punctuation mark was assigned a phoneme, and from the point of view of the system, new ‚Äúwords‚Äù appeared in the recognizable speech, completely consisting of such ‚Äúpunctuation‚Äù phonemes - where pauses appeared or intonation changed in a certain way. <br><br>  Great difficulty has arisen with data for learning - in most corpses, already normalized texts, in which the punctuation marks are omitted.  There is also almost no punctuation in the text of search queries.  We turned to Ekho Moskvy, which manually decoded all of their ethers, and they allowed us to use our archive.  It quickly became clear that these transcriptions are not suitable for our purposes - they are made close to the text, but not literally, and therefore not suitable for machine learning.  The next attempt was made with audiobooks, but in their case, on the contrary, the quality was too high.  Well-set voices, with an expression of reciting text, are too far from real life, and the results of training on such data could not be applied in spontaneous dictation. <br><br>  The second problem was that the chosen approach had a negative effect on the overall quality of recognition.  For each word, the language model considers several neighbors in order to correctly define the context, and the additional ‚Äúpunctuation‚Äù words inevitably narrowed it.  A few months of experiments did not lead to anything. <br><br>  We had to start from scratch - we decided to place punctuation marks already at the post-processing stage.  We started with one of the simplest methods, which, oddly enough, showed in the end quite an acceptable result.  Pauses between words receive one of the labels: space, full stop, comma, question mark, exclamation mark, colon.  To predict which label corresponds to a specific pause, the conditional random fields method (CRF) is used.  To determine the context, three preceding and two following words are taken into account, and these simple rules make it possible to arrange signs with sufficiently high accuracy.  But we continue to experiment with full-fledged models that can still correctly interpret the intonation of a person from the point of view of punctuation at the stage of voice recognition. <br><br><h3>  Future plans </h3><br>  Today, SpeechKit is actively used to solve "combat" tasks in mass services for end users.  The next milestone is to learn to recognize spontaneous speech in a live stream, so that you can decipher interviews in real time or automatically take notes on a lecture, getting already marked text at the output, with highlighted theses and key facts.  This is a huge and very high-tech task that has not yet been solved by anyone in the world - and we don‚Äôt like others! <br><br>  Feedback is very important for the development of SpeechKit.  Put <a href="http://yandex.ru/promo/dictation">Yandex.Dict</a> , talk to it more often - the more data we get, the faster the recognition quality grows in the library accessible to all of you.  Feel free to correct recognition errors using the "Corrector" button - it helps to mark the data.  And be sure to write in the feedback form in the application. </div><p>Source: <a href="https://habr.com/ru/post/243813/">https://habr.com/ru/post/243813/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243801/index.html">FLProg.ru - the face of the FLProg program on the Internet</a></li>
<li><a href="../243803/index.html">Statically verifiable references to Java bean properties</a></li>
<li><a href="../243805/index.html">Mobile only: English from LinguaLeo for gadget</a></li>
<li><a href="../243809/index.html">We make automated calls for notifications or polls.</a></li>
<li><a href="../243811/index.html">Preparatory work to help you conquer Kickstar [a few forgotten common truths]</a></li>
<li><a href="../243815/index.html">Expressive JavaScript: Document Object Model (Document Object Model)</a></li>
<li><a href="../243817/index.html">Restoring order: how to organize work during the creation of the site. (Part 2)</a></li>
<li><a href="../243819/index.html">In one run</a></li>
<li><a href="../243821/index.html">Markup math with CSS: Understand with calc</a></li>
<li><a href="../243829/index.html">Innovation or death: Why company executives need to be evangelists of new digital change</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>