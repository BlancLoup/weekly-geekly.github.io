<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dagaz: Kicks to common sense (part 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúOh, you're a scoundrel,‚Äù said Woland thoughtfully. 
 - Messire, I again appeal to logic, - the cat spoke, pressing his paws to his chest, - if a play...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dagaz: Kicks to common sense (part 3)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/43e/794/3a3/43e7943a3e289a281570ab8b68d347b8.png" alt="image">  <b><i>‚ÄúOh, you're a scoundrel,‚Äù said Woland thoughtfully.</i></b> <b><i><br></i></b>  <b><i>- Messire, I again appeal to logic, - the cat spoke, pressing his paws to his chest, - if a player declares a shah to the king, and the king, meanwhile, is no longer on the board, the shah is declared invalid.</i></b> <b><i><br><br></i></b>  <b><i>Mikhail Bulgakov "Master and Margarita"</i></b> <br><br>  ‚ÄúMatt to the king!‚Äù - many of us absorbed these words with mother's milk.  The concept of the shah (and the mat) seems obvious to people familiar with <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B">chess</a> since childhood, but is it really that simple?  After a light <a href="http://habrahabr.ru/post/248821/">warm-up</a> with the transformation of the figures, I propose to deal with really complex issues. <br><a name="habracut"></a><br><h4>  <b>8. Checkmate</b> </h4><br>  The main difference between chess games (in addition to the characteristic method of taking figures) is the presence of the "main" figure - the king on the board.  If a player loses a king, he loses, no matter how many other pieces he has left on the board.  Such a rule of "sudden death" significantly enriches the game in tactical terms.  The game becomes more combinational, players try to trap each other. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Completing the game according to the rule of "sudden death" is not a chess invention.  In one form or another, this principle is used in a variety of games.  In all the familiar " <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B8-%25D0%25BD%25D0%25BE%25D0%25BB%25D0%25B8%25D0%25BA%25D0%25B8">Tic-tac-toe</a> ", for victory, you need to line up your pieces "in line" (and prevent your opponent from making it).  The game would be quite boring without this rule.  Just imagine the ‚Äútic-tac-toe‚Äù continuing as long as the possibility of the move remains (there are empty positions on the board) ... <br><br>  The example seems strange, since the very essence of the ‚Äútic-tac-toe‚Äù is to line up?  Here's a less obvious example: in <a href="http://en.wikipedia.org/wiki/Hasami_shogi">Hasami Shogi, the</a> figures can move and ‚Äúeat‚Äù each other.  In order to remove an opponent's piece from the board, it must be ‚Äúticked off‚Äù, surrounded with figures from both sides (in fact, the rules for taking in Hasami Shogi are more complicated, but I will tell you about this some other time).  This rule makes Hasami Shogi related to the most ancient gaming systems of "district checkers", such as <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D0%25B4%25D0%25B6%25D0%25B0">Seega</a> . <br><br>  It is logical to assume that, as in Seega, in Hasami Shogi, to win, you need to "eat" all the figures.  Indeed, this version of the game exists, but it is enough to take in it not all, but only a limited number (usually 5) of the figures.  The fact is that the method of capture used (by clamping "into tongs") is very slow.  In order to take a figure of the opponent, you must properly place <b>two of</b> your pieces (of course, this does not cancel the fact that you can take several pieces at once with one move).  In Seega, the limited mobility of the figures saves the situation, but in Hasami Shogi the figures are long-range and the enemy can almost always avoid the threat. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b8f/9d4/571/b8f9d457173d4733aec3cbe3da8e69e2.PNG"></div><br>  The rule of "sudden death" turns out to be most welcome.  In most variants of Hasami Shogi, victory is achieved by building 5 of his pieces ‚Äúin a row‚Äù (outside their original location, otherwise it would not be interesting).  Capturing enemy pieces in them is not the goal of the game, but merely a tactical device that helps to win.  Here, as in "Tic-Tac-Toe", the condition for victory is the <b>relative</b> position of the pieces. <br><br>  The relative position of the figures does not have to be simple.  For example, in the game " <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D1471">Hex</a> ", to win, you need to connect the two opposite sides of the board with a continuous chain of pieces of your color (not necessarily straight), and in " <a href="http://habrahabr.ru/post/234587/">Ritmomachia</a> ", to achieve a "glorious victory", the figure (your own and the opponent) must be tied and arithmetic relations (in addition to their mutual arrangement). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/752/682/f5a/752682f5a7c142ee8c98cc62c9d811a4.png"></div><br>  The condition of "sudden death" can be associated with the <b>absolute</b> location of the figures.  So, in the Chinese game <a href="http://skyruk.livejournal.com/427724.html">Dou-shu-chi (Jungle)</a> , to win, you need to bring any of your pieces to the opponent's Lair (marked place on the board).  A similar rule introduces tactical diversity to the Japanese game <a href="http://geektimes.ru/post/246506/">Doubutsu Shogi</a> .  In it, for, to win, it is enough to hold your king to the last horizontal of the board (at the same time, the loss of a king means defeat).  Similar rules apply in the games of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A5%25D0%25BD%25D0%25B5%25D1%2584%25D0%25B0%25D1%2582%25D0%25B0%25D1%2584%25D0%25BB">Tafl</a> family, but only one of the parties has a royal figure (these are asymmetric games). <br><br>  As I said above, the most familiar interpretation of the ‚Äúrule of sudden death‚Äù is associated with the loss of the main figure or group of figures.  It is in this form that it was used in ancient chess games, such as <a href="http://en.wikipedia.org/wiki/Chaturanga">Chaturanga</a> .  In this game, it was required to ‚Äúeat‚Äù the enemy king (‚Äúuncovering‚Äù the king, that is, taking all the other pieces, was also considered a victory).  If we talk about the <a href="http://en.wikipedia.org/wiki/Chaturaji">version of the</a> game for four players, then a similar interpretation of the rules for completing the game is perhaps the most reasonable.  Before the victory of one of the players, playing is much more interesting than before the first loss. <br><br>  One recent change that Howard McCay made to my realization of <a href="http://www.zillions-of-games.com/cgi-bin/zilligames/submissions.cgi%3Fdo%3Dshow%3Bid%3D2273">Yonin Shogi</a> (a variant of Japanese chess for four players) was connected with this.  In addition to adapting the game to an earlier version of <a href="http://www.zillions-of-games.com/">Zillions of Games</a> 1.0, he changed the victory condition.  Now the game does not end with taking one of the enemy kings.  To win, you need to "eat" them all!  Moreover, taken kings can be put on the board as your pieces!  In this form, the game has become much more interesting. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/f28/465/a54/f28465a5457e49f5bffe74c289a2fd7d.jpg"></div><br>  In the quadruple version of Chaturanji with the capture of kings, everything is also not easy.  Often in this game played a pair of a couple.  Players sitting opposite each other formed a coalition.  The player from whom they took the king, missed the moves (his figures seemed to ‚Äúfreeze‚Äù on the spot), but his partner could return the taken king, taking one of the opponent's kings and ‚Äúexchanging prisoners‚Äù!  To a greater degree, this principle was developed in <a href="https://ru.wikipedia.org/wiki/%25D0%2595%25D0%25BD%25D0%25BE%25D1%2585%25D0%25B8%25D0%25B0%25D0%25BD%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B5_%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B">Enochian Chess</a> .  In this game, the player could ‚Äútake control‚Äù over the army left without a king, taking his ‚Äúthrone‚Äù (initial position) of the latter with his king. <br><br>  Another component of the notion of the Shah (and mate) are forced moves.  It is also not a chess invention.  Without the concept of forced moves there would be no familiar <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2588%25D0%25BA%25D0%25B8">checkers</a> .  In this family of games, the player who has the opportunity to take the figure of the enemy, is <b>obliged</b> to do so.  It is this rule that makes the game interesting.  Substituting his figure in jeopardy, the player limits the number of possible counter moves of the opponent.  He can build complex tactical combinations by changing the position on the board with the help of the victims. <br><br>  The honor of the invention (almost) of the modern chess game belongs to the Persians.  Apparently, it was in <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2582%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B4%25D0%25B6">Shatrandzh</a> that the concepts of the ‚Äúmain figure‚Äù and the forced moves were combined.  So the notion of a <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585_(%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B)">shah</a> appeared - the king should not remain under attack at the end of the turn of the player to whom he belongs.  The move that saves the king from the threat is forced (it doesn't matter whether it is taking a threatening figure or just going to a quieter place). <br><br>  The concept of <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2582_%2528%25D1%2588%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B%2529">mat</a> is a natural logical continuation.  If a player cannot get rid of the threat to his king after completing his turn, he lost.  Another new concept has <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2582">emerged</a> - a <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B0%25D1%2582">stalemate</a> , a situation in which the king is not under attack, but the player cannot make a single move, due to the threat of the Shah.  In Shatranj, in contrast to modern Chess, such a position (like the "exposure" of the king) also led to defeat. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9a6/1c1/dd9/9a61c1dd91b74ddda5c9b25ab61b79be.jpg"></div><br>  Until now, everything seemed quite logical, but what would happen if you complicate the rules?  For example, how to checkmate several kings?  In <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2585%25D0%25BC%25D0%25B0%25D1%2582%25D1%258B_%25D0%25A2%25D0%25B0%25D0%25BC%25D0%25B5%25D1%2580%25D0%25BB%25D0%25B0%25D0%25BD%25D0%25B0">Tamerlan Chess</a> , the player can get up to three kings by completing the transformation of the royal pawn and the double transformation of the pawn pawn.  In " <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D1%258E_%25D1%2581%25D1%2591%25D0%25B3%25D0%25B8">Chu Shogi</a> " the situation is similar - a "Drunk Elephant" can turn into a "Crown Prince" (in fact, the second king). <br><br>  The Japanese, in this situation, did not become wise.  Kings in "Tyu Shogi" can (and should) "eat."  In Tamerlan Chess, it's a bit more complicated.  In this game, you must checkmate to win.  Matting the three kings is theoretically possible at the same time, but in practice it is hardly feasible.  As long as there are two or more kings on the board, kings are allowed to ‚Äútake‚Äù (the order of capture is not important, since all kings are interchangeable), as soon as the last king remains on the board, he needs to checkmate.  In fact, this means that the kings <b>are allowed</b> under the check while their ‚Äúdeputies‚Äù are on the board. <br><br>  No less interesting is the metamorphosis of the notion of the Shah when playing more than two players.  I already mentioned above about Yonin Shogi.  Its only difference from the traditional <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2591%25D0%25B3%25D0%25B8">Shogi</a> is the participation of four players in the game (and, as a result, another initial arrangement of figures).  The result of this "small" difference was a completely inadequate processing of the shahs in the Zillions of Games version: <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/OR74gUlfQNY%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhjDJ2nFbkoextfz9c4-puln2v8gDQ" frameborder="0" allowfullscreen=""></iframe><br><br>  And this is more than just the bug of one particular implementation!  Let's think a bit.  Suppose a player "South" puts his king at the blow of one of the figures of the player "East", but until the move reaches (clockwise), the threat can be eliminated by the "West" or "North" (most likely the last, if the game is played for a couple ").  Consequently, there was no threat and the ‚ÄúSouth‚Äù had the right to make such a move!  And if the "North" and "West" did not take <b>anything</b> against this threat?  As you can see, in such a game, the concepts of shah and mate have little meaning. <br><br>  There may be other rules that affect the possibility of mate.  For example, there is a variant of Shogi, which differs from the original game only in that the player cannot hold more than 5 pieces ‚Äúin his hand‚Äù.  This means that he cannot take any figure if there are already five of them in reserve (he must first dump one of the reserve figures on the board).  This rule leads to completely anecdotal dull situations.  Even if the threat to the king is considered absolute (independent of the reserve filling), it can prevent you from defending against the shah, as in the position shown below (in the original <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25BE%25D0%25B1%25D1%2583%25D1%2586%25D1%2583_%25D1%2581%25D1%2591%25D0%25B3%25D0%25B8">Dobutsu Shogi</a> there is no limit on the number of pieces in the reserve, but I decided to leave it to make the implementation more fun ): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/9c8/59d/806/9c859d80600f453eb9f64e4b460cd594.JPG"></div><br>  If there were still flowers, now the berries will begin.  In the " <a href="http://www.gambiter.ru/checkers/item/276-chess-checkers.html">Belarusian chess</a> " mate can be put king!  The fact is that in addition to chess pieces, checkers are active in this game.  All pieces play according to the usual rules, that is, it is necessary to take checkers!  Moreover, even more necessary than the salvation of his king from the Shah!  So it turns out that if the opponent has the ability to take one of his drafts, you can safely approach your king and mate him!  Very fun game. <br><br>  The game can introduce additional restrictions on the mat.  So, in Shogi, you cannot <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D1%2582%25D0%25B8%25D1%2584%25D1%2583%25D0%25B4%25D0%25B7%25D1%2583%25D0%25BC%25D1%258D">checkmate a pawn</a> from the reserve (in this case, it is not prohibited to shake a pawn and mate with a regular move, too).  Further in terms of prohibitions goes the Mongolian version of chess (Shatar).  In this game, it's not enough to checkmate, it is important to do it ideologically correctly (the result of the game depends on it)!  Let me <a href="https://ru.wikipedia.org/wiki/%25D0%25A8%25D0%25B0%25D1%2582%25D0%25B0%25D1%2580_%25D0%25B8_%25D1%2585%25D0%25B8%25D0%25B0%25D1%2588%25D0%25B0%25D1%2582%25D0%25B0%25D1%2580">quote</a> a little: <br><br><blockquote>  The following different forms of the shah are distinguished: a shak is given by a queen, a rook or a knight, a knock by an elephant, a tsod by a pawn. <br>  You can mate only with a shakom (that is, a queen or a rook), or a continuous series of checks, including at least <br>  one shak, and if the shak is declared last, then it should not be a check knight. <br>  For example, if the next series of shahs is given (the last check - mate) - with a knight, pawn and bishop, then this is a win. <br>  If the mate is placed only by the bishop / bishop and / or the pawn / pawns, then this is a draw - nel. <br>  If one player has only one king ("naked king"), then it is also a draw - robado. <br></blockquote><br>  Whew ... In this and it is not easy to understand, not something to implement.  By the way, with the implementation of the shahs and mats in <a href="http://www.zillions-of-games.com/">ZoG</a> everything is pretty sad.  In the conditions of the completion of the game (victory, draw or defeat), only the following predicates can be applied: <br><br><ul><li>  <b>stalemated</b> - no move opportunity </li><li>  <b>repetition</b> - threefold repetition of the position </li><li>  <b>captured</b> - Capture a piece of a certain type (for example, a king) </li><li>  <b>checkmated</b> - Mat a specified type </li><li>  <b>absolute-config</b> - Absolute location of figures (for example, reaching a given position) </li><li>  <b>relative-config</b> - The relative position of the shapes (for example, "5 in a row") </li><li>  <b>pieces-remaining</b> - The remaining number of pieces (for example, in <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25BB%25D1%258C%25D0%25BD%25D0%25B8%25D1%2586%25D0%25B0_(%25D0%25B8%25D0%25B3%25D1%2580%25D0%25B0)">Mill</a> , the two remaining pieces signify defeat) </li><li>  <b>total-piece-count</b> - Similar to the previous one, but not taking into account that the pieces belonged to the player </li></ul><br>  All this is hard-wired into the core of the program and is minimally controlled by another ‚Äúhardcode‚Äù - the <b>option</b> command (available only in version 2.0).  For example, using the " <b>include off-pieces</b> " option, you can make the system take into account in the <b>pieces-remaining predicate</b> not only the pieces placed on the board, but also those that are "in reserve".  There is no system in the set of available options. <br><br>  It is clear that one single <b>checkmated keyword is</b> completely inadequate for adequate handling of all sorts of matte situations described in the article.  Some problems can be solved by adding additional checks in the "manual" mode.  So, for example, checking for a mate is a reset of the pawn at Shogi: <br><br><div class="spoiler">  <b class="spoiler_title">Utifuzume manually</b> <div class="spoiler_text"><pre><code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> safe (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">not-defended</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) (<span class="hljs-name"><span class="hljs-name">not-enemy</span></span>? $<span class="hljs-number"><span class="hljs-number">1</span></span>) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> no-mate (<span class="hljs-name"><span class="hljs-name">or</span></span> (<span class="hljs-name"><span class="hljs-name">not-piece</span></span>? Gyokusho n) (<span class="hljs-name"><span class="hljs-name">not-enemy</span></span>? n) not-defended? (<span class="hljs-name"><span class="hljs-name">attacked</span></span>? no-king) (<span class="hljs-name"><span class="hljs-name">safe</span></span> e) (<span class="hljs-name"><span class="hljs-name">safe</span></span> w) (<span class="hljs-name"><span class="hljs-name">safe</span></span> ne) (<span class="hljs-name"><span class="hljs-name">safe</span></span> nw) (<span class="hljs-name"><span class="hljs-name">safe</span></span> nne) (<span class="hljs-name"><span class="hljs-name">safe</span></span> nn) (<span class="hljs-name"><span class="hljs-name">safe</span></span> nnw) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> drop-Fu ( (<span class="hljs-name"><span class="hljs-name">verify-first</span></span> Fu) END next (<span class="hljs-name"><span class="hljs-name">while</span></span> on-board? mark (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> friendly-Fu false) (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> (<span class="hljs-name"><span class="hljs-name">not-flag</span></span>? friendly-Fu) (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? n)) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> friend? (<span class="hljs-name"><span class="hljs-name">piece</span></span>? Fu)) (<span class="hljs-name"><span class="hljs-name">set-flag</span></span> friendly-Fu true)) n) back (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">not-flag</span></span>? friendly-Fu) mark (<span class="hljs-name"><span class="hljs-name">while</span></span> (<span class="hljs-name"><span class="hljs-name">on-board</span></span>? n) (<span class="hljs-name"><span class="hljs-name">if</span></span> (<span class="hljs-name"><span class="hljs-name">and</span></span> empty? (<span class="hljs-name"><span class="hljs-name">no-mate</span></span>)) add) n) back) e) ))</code> </pre> <br></div></div><br>  It works, but it‚Äôs extremely difficult to understand what this code does.  At the same time, the fact is used that the pawn in Shogi attacks closely, only one field.  It is impossible to close from her check, but you can only move away or ‚Äúeat‚Äù a pawn.  I can‚Äôt imagine at all how such a set of ‚Äúmanual‚Äù inspections would look like in the case of Shatar.  To implement forced moves, the priority mechanism is used (or hard-coded ‚Äúmagic‚Äù, using the <b>checkmated</b> predicate). <br><br><div class="spoiler">  <b class="spoiler_title">Priorities</b> <div class="spoiler_text"><pre> <code class="lisp hljs">... (<span class="hljs-name"><span class="hljs-name">moves</span></span> (<span class="hljs-name"><span class="hljs-name">move-type</span></span> noncapture-type) (<span class="hljs-name"><span class="hljs-name">man-shift</span></span> ne) (<span class="hljs-name"><span class="hljs-name">man-shift</span></span> nw) (<span class="hljs-name"><span class="hljs-name">move-type</span></span> capture-type) (<span class="hljs-name"><span class="hljs-name">man-jump</span></span> ne) (<span class="hljs-name"><span class="hljs-name">man-jump</span></span> nw) (<span class="hljs-name"><span class="hljs-name">man-jump</span></span> se) (<span class="hljs-name"><span class="hljs-name">man-jump</span></span> sw) (<span class="hljs-name"><span class="hljs-name">move-type</span></span> nomove-type) ) ... (<span class="hljs-name"><span class="hljs-name">move-priorities</span></span> capture-type noncapture-type)</code> </pre><br></div></div><br>  Thus, the "obligatory" capture is realized in checkers.  If there is an opportunity to make a move, taking the opponent's piece, you need to make it, and not a ‚Äúquiet‚Äù move.  This mechanism also does not seem to me quite flexible.  And priority moves and actions under check can be implemented using a single universal mechanism of <b>invariants</b> .  If at the end of <b>any of</b> his moves the king should not be in check, why not say so? <br><br><div class="spoiler">  <b class="spoiler_title">The implementation of checks on the shah in Dagaz</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> invariant (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not-exists</span></span>? any-position (<span class="hljs-name"><span class="hljs-name">check</span></span> is-friend?) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">is-piece</span></span>? King)) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-attacked?) ) ) ) (<span class="hljs-name"><span class="hljs-name">define</span></span> goals (<span class="hljs-name"><span class="hljs-name">check-loss</span></span> no-moves?) ) (<span class="hljs-name"><span class="hljs-name">pieces</span></span> ... (<span class="hljs-name"><span class="hljs-name">pre</span></span> goals) (<span class="hljs-name"><span class="hljs-name">post</span></span> invariant) ... )</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">By the way</b> <div class="spoiler_text">  <b>Is the</b> predicate calculation <b>is attacked?</b>  - a rather laborious operation (which is why it is performed at the end of the list of checks).  The fact is that not all games attack those fields where the pieces end their turn.  An example is the well-known Checkers, in which the attacked field is ‚Äújumped over‚Äù. <br><br>  In more complex cases, the result of the calculation <b>is is-attacked?</b>  depends on what type of shape is being attacked.  For example, the ‚ÄúChameleon‚Äù in the game of <a href="http://www.chessvariants.org/other.dir/ultima.html">Ultima</a> attacks each piece according to the rules by which she walks.  If there were a <a href="https://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25BE%25D0%25BA%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0">castling</a> in such a game, we would have to specify for which type of figure the check is performed (to check for a check this is not required, since the figure is already installed on the board, and not just passes through the field): <br><br><div class="spoiler">  <b class="spoiler_title">Castling in Dagaz</b> <div class="spoiler_text"><pre> <code class="lisp hljs">(<span class="hljs-name"><span class="hljs-name">define</span></span> OO (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not</span></span> is-moved?)) (<span class="hljs-name"><span class="hljs-name">check</span></span> not-attacked?) (<span class="hljs-name"><span class="hljs-name">take-piece-to-head</span></span> current-pieces) (<span class="hljs-name"><span class="hljs-name">check</span></span> w) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not-attacked</span></span>? King)) (<span class="hljs-name"><span class="hljs-name">check</span></span> w) (<span class="hljs-name"><span class="hljs-name">check</span></span> is-empty?) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not-attacked</span></span>? King)) (<span class="hljs-name"><span class="hljs-name">drop-pieces</span></span> current-pieces) (<span class="hljs-name"><span class="hljs-name">check</span></span> w) (<span class="hljs-name"><span class="hljs-name">check</span></span> (<span class="hljs-name"><span class="hljs-name">not</span></span> is-moved?)) (<span class="hljs-name"><span class="hljs-name">set!</span></span> is-moved? true) (<span class="hljs-name"><span class="hljs-name">take-piece-to-head</span></span> current-pieces) ee (<span class="hljs-name"><span class="hljs-name">drop-pieces</span></span> current-pieces) add-move )</code> </pre><br></div></div><br></div></div><br>  It's a little longer than simple <b>checkmated</b> , but also incredibly more flexible!  In case all possible moves violate the invariant, the list of generated moves is empty.  The predicate <b>no-moves?</b>  determines the condition of the end of the game (loss). <br><br><div class="spoiler">  <b class="spoiler_title">Little hack</b> <div class="spoiler_text">  Calculation of the <b>no-moves</b> predicate  It can also be time consuming (to check it is necessary to fully generate at least one move), but here you can cheat.  Before the generation of moves, you can register a pending check.  If the set of moves, at the end of generation, is empty, the check is triggered and the defeat is fixed. <br></div></div><br>  Invariants, as defined in this article, do not seem to be some kind of ‚Äúrocket science‚Äù, but we have not yet allowed them to turn in full force.  In the next chapter, we will try to squeeze out the maximum of what they are capable of. <br></div><p>Source: <a href="https://habr.com/ru/post/251401/">https://habr.com/ru/post/251401/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251391/index.html">JPoint 2015: review of applications from speakers</a></li>
<li><a href="../251393/index.html">Go compiler rewritten to Go</a></li>
<li><a href="../251395/index.html">A simple solution for load balancing in a printer pool.</a></li>
<li><a href="../251397/index.html">Entity Framework: improve performance when saving data in the database</a></li>
<li><a href="../251399/index.html">New in PHDays: protection of supercomputers, security of iOS applications and sale of exploits</a></li>
<li><a href="../251403/index.html">WEB Server based on ENC28j60 + Arduino - it can't be easier</a></li>
<li><a href="../251407/index.html">How to create a subdomain in VestaCP</a></li>
<li><a href="../251409/index.html">How to set up a LibGDX project with Gradle, Google Play Services</a></li>
<li><a href="../251411/index.html">Why learn programming so damn hard?</a></li>
<li><a href="../251413/index.html">How to make a game for iOS from an empty plastic bottle, pictures and shader</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>