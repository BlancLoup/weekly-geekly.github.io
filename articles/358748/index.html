<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Codable Tips and Examples</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to share with you some tips and tricks that I used in this example. 

 Download Swift Playground with all the code from this article: 


...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Codable Tips and Examples</h1><div class="post__text post__text-html js-mediator-article">  I would like to share with you some tips and tricks that I used in this example. <br><br>  <a href="">Download Swift Playground</a> with all the code from this article: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af7/59c/a4b/af759ca4b89d5a82b3b79c74962fadd1.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Codable</i> is introduced in Swift 4 <a href="">in order to</a> replace the old NSCoding API.  Unlike <i>NSCoding</i> , <i>Codable</i> has first-class JSON support, which makes it a promising option for using the JSON API. <br><br>  Codable is great as <i>NSCoding</i> .  If there is a need to encode or decode some local data that you must fully control, you can take advantage of <a href="https://developer.apple.com/documentation/foundation/archives_and_serialization/encoding_and_decoding_custom_types">automatic encoding and decoding</a> . <br><a name="habracut"></a><br>  In the real world, everything becomes quite complicated and fast.  Attempting to build a fault-tolerant system that will manage JSON and model all product requirements is a problem. <br><br>  One of the major drawbacks of <i>Codable</i> is that as soon as you need custom decoding logic ‚Äî even for one key ‚Äî you must provide everything: manually determine all encoding keys and fully implement <i>init (from decoder: Decoder) throws</i> .  This is not perfect.  But this is at least as good (or bad) as using third-party JSON libraries in Swift.  The presence of such in the library is already a victory. <br><br>  Therefore, if you want to start using <i>Codable</i> in your application (and you are already familiar with all of its main features), here are some tips and examples that may be useful: <br><br><ul><li>  Secure array decoding </li><li>  ID type and single value container </li><li>  Secure decoding of Transfers </li><li>  Laconic manual decoding </li><li>  Getting rid of certain types of parameters </li><li>  Using a separate decoding scheme </li><li>  Coding Patch Parameters </li></ul><br><h4>  Secure array decoding </h4><br>  Suppose you want to load and display a collection of posts (Posts) in your application.  Each <b>Post</b> has <i>id</i> (required), <i>title</i> (required) and <i>subtitle</i> (optional). <br><br><pre><code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> id: <span class="hljs-type"><span class="hljs-type">Id</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Post</span></span>&gt; <span class="hljs-comment"><span class="hljs-comment">// More about this type later. let title: String let subtitle: String? }</span></span></code> </pre> <br>  <i>Post</i> class models requirements well.  It already accepts the <i>Decodable</i> protocol, so we are ready to decode some data: <br><br><pre> <code class="hljs json">[ { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"pos_1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Codable: Tips and Tricks"</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">"id"</span></span>: <span class="hljs-string"><span class="hljs-string">"pos_2"</span></span> } ]</code> </pre><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> posts = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">try</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">JSONDecoder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>).</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Post].self, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">from</span></span></span></span><span class="hljs-function"><span class="hljs-params">: json.data(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">using</span></span></span></span><span class="hljs-function"><span class="hljs-params">: .utf8</span></span></span><span class="hljs-function">)!) } </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">catch</span></span></span></span> { print(error) <span class="hljs-comment"><span class="hljs-comment">//prints "No value associated with key title (\"title\")." }</span></span></code> </pre><br>  As expected, we got the error <a href="https://developer.apple.com/documentation/swift/decodingerror/2893451-keynotfound">.keyNotFound</a> , because the second post object has no title. <br><br>  When the data does not match the expected format (for example, it may be the result of a misunderstanding, regression, or unexpected user input), the system should automatically report an error to give developers the opportunity to correct it.  Swift provides a detailed error report in the form of a <a href="https://developer.apple.com/documentation/swift/decodingerror">DecodingError</a> at any time when decoding is performed with an error, which is extremely useful. <br><br>  In most cases, no one wants one damaged post to prevent you from displaying a whole page of other completely correct posts.  To avoid this, I use a special type of Safe &lt;T&gt;, which allows me to safely decode the object.  If it detects an error during decoding, it will go into safe error detection mode and send a report: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Safe</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Base</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> value: <span class="hljs-type"><span class="hljs-type">Base?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(from decoder: <span class="hljs-type"><span class="hljs-type">Decoder</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> decoder.singleValueContainer() <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.value = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> container.decode(<span class="hljs-type"><span class="hljs-type">Base</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">assertionFailure</span></span>(<span class="hljs-string"><span class="hljs-string">"ERROR: \(error)"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">TODO:</span></span></span><span class="hljs-comment"> automatically send a report about a corrupted data self.value = nil } } }</span></span></code> </pre><br>  Now, when I decode an array, I can indicate that I do not want to stop decoding in the case of a single corrupted element: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { let posts = try JSONDecoder().decode([Safe&lt;Post&gt;].self, <span class="hljs-keyword"><span class="hljs-keyword">from</span></span>: <span class="hljs-type"><span class="hljs-type">json</span></span>.data(<span class="hljs-keyword"><span class="hljs-keyword">using</span></span>: .utf8)!) print(posts[<span class="hljs-number"><span class="hljs-number">0</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>!.title) // prints "Codable: Tips and Tricks" print(posts[<span class="hljs-number"><span class="hljs-number">1</span></span>].<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>) // prints "nil" } catch { print(error) }</code> </pre><br>  Keep in mind that decode decoding <i>([Safe &lt;Post&gt;]. Self, from: ...</i> causes an error if the data does not contain an array. In general, such errors should be captured at a higher level. The general API contract is to always return an empty array if there are no items to return. <br><br><h4>  ID type and single value container </h4><br>  In the previous example, I used the special identifier Id &lt;Post&gt;.  The type <b>Id</b> gets the parameters using the generic parameter Entity, which is not actually used by the Id itself, but is used by the compiler when comparing different types of Id.  Thus, the compiler ensures that I cannot randomly transfer <i>Id &lt;Media&gt;</i> , where Id &lt;Image&gt; is expected. <br><br>  I also used phantom types for security when using types, in the <a href="http://kean.github.io/post/api-client">API client article in Swift</a> . <br><br>  The type Id itself is very simple; it is just a shell on top of the original <i>String</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Id</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class">&gt;: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Hashable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> raw: <span class="hljs-type"><span class="hljs-type">String</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(<span class="hljs-number"><span class="hljs-number">_</span></span> raw: <span class="hljs-type"><span class="hljs-type">String</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.raw = raw } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hashValue: <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> raw.hashValue } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> ==</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lhs: Id, rhs: Id)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Bool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lhs.raw == rhs.raw } }</code> </pre><br>  Adding Codable to it is definitely a challenging task.  This requires the special type <a href="https://developer.apple.com/documentation/swift/singlevalueencodingcontainer">SingleValueEncodingContainer</a> : <br><br>  A container that can support the storage and direct encoding of a single non-locked value. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Id</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Codable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(from decoder: <span class="hljs-type"><span class="hljs-type">Decoder</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> decoder.singleValueContainer() <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> raw = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> container.decode(<span class="hljs-type"><span class="hljs-type">String</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> raw.isEmpty { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-type"><span class="hljs-type">DecodingError</span></span>.dataCorruptedError( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>: container, debugDescription: <span class="hljs-string"><span class="hljs-string">"Cannot initialize Id from an empty string"</span></span> ) } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(raw) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">encode</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(to encoder: Encoder)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = encoder.singleValueContainer() <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> container.encode(raw) } }</code> </pre><br>  As can be seen from the code above, Id also has a special rule that prevents its initialization from an empty String. <br><br><h4>  Secure decoding of Transfers </h4><br>  Swift has excellent support for decoding (and encoding) enums.  In many cases, all you have to do is simply declare a Decodable match, which is automatically synthesized by the compiler (the raw enumeration type must be either String or Int). <br><br>  Suppose you create a system that displays all your devices on a map.  The device has a location (required) and a system (required), which it launches. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">System</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> ios, macos, tvos, watchos } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Location</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> latitude: <span class="hljs-type"><span class="hljs-type">Double</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> longitude: <span class="hljs-type"><span class="hljs-type">Double</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Device</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> location: <span class="hljs-type"><span class="hljs-type">Location</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> system: <span class="hljs-type"><span class="hljs-type">System</span></span> }</code> </pre><br>  Now there is a question.  What if more systems are added in the future?  The product solution may be to still display these devices, but in some way indicate that the system is ‚Äúunknown.‚Äù  How should you model this in an application? <br><br>  By default, Swift will cause a <a href="https://developer.apple.com/documentation/swift/decodingerror/2893182-datacorrupted%3Fchanges%3Dlates_1">.dataCorrupted</a> error if an unknown enum value is encountered: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"location"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"latitude"</span></span>: <span class="hljs-number"><span class="hljs-number">37.3317</span></span>, <span class="hljs-attr"><span class="hljs-attr">"longitude"</span></span>: <span class="hljs-number"><span class="hljs-number">122.0302</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"system"</span></span>: <span class="hljs-string"><span class="hljs-string">"caros"</span></span> }</code> </pre><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">do</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> device = try <span class="hljs-type"><span class="hljs-type">JSONDecoder</span></span>().decode(<span class="hljs-type"><span class="hljs-type">Device</span></span>.self, from: json.<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">data</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">using</span></span></span><span class="hljs-class">: .</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">utf8</span></span></span><span class="hljs-class">)!) } catch { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">print</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">error</span></span></span><span class="hljs-class">) // </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Prints</span></span></span><span class="hljs-class"> "</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Cannot</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initialize</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">System</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">from</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">invalid</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">caros</span></span></span><span class="hljs-class">" }</span></span></code> </pre><br>  How can the system be modeled and decoded in a secure way?  One way is to make the system property optional, which will mean ‚ÄúUnknown‚Äù.  And the easiest way to safely decode a system is to implement a custom <i>init (from decoder: Decoder) throws</i> initializer: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Device</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Decodable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> location: <span class="hljs-type"><span class="hljs-type">Location</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> system: <span class="hljs-type"><span class="hljs-type">System?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">init</span></span>(from decoder: <span class="hljs-type"><span class="hljs-type">Decoder</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> decoder.container(keyedBy: <span class="hljs-type"><span class="hljs-type">CodingKeys</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.location = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.decode(<span class="hljs-type"><span class="hljs-type">Location</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forKey: .location) <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.system = <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>? <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.decode(<span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forKey: .system) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">enum</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodingKeys</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CodingKey</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> location <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> system } }</code> </pre><br>  Note that this version simply ignores all possible problems with the value system.  This means that even ‚Äúdamaged‚Äù data (for example, a missing key system, the number 123, null, an empty object {} - depending on which API contract) is decoded as a nil value (‚ÄúUnknown‚Äù).  A more accurate way to say "decode unknown strings as nil": <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.system = <span class="hljs-type"><span class="hljs-type">System</span></span>(rawValue: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-built_in"><span class="hljs-built_in">map</span></span>.decode(<span class="hljs-type"><span class="hljs-type">String</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forKey: .system))</code> </pre><br><h4>  Laconic manual decoding </h4><br>  In the previous example, we had to implement the user init init (from decoder: Decoder) throws, which turned out to be quite a lot of code.  Fortunately, there are several ways to do this more succinctly. <br><br><h4>  Getting rid of certain types of parameters </h4><br>  One option is to get rid of explicit type parameters: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">KeyedDecodingContainer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decode</span></span></span><span class="hljs-function">&lt;T: Decodable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key: Key, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">as</span></span></span></span><span class="hljs-function"><span class="hljs-params"> type: T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">Type</span></span></span></span><span class="hljs-function"><span class="hljs-params"> = T.</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">self</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.decode(<span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forKey: key) } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">decodeIfPresent</span></span></span><span class="hljs-function">&lt;T: Decodable&gt;</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> key: KeyedDecodingContainer.Key)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">throws</span></span> -&gt; <span class="hljs-type"><span class="hljs-type">T?</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> decodeIfPresent(<span class="hljs-type"><span class="hljs-type">T</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, forKey: key) } }</code> </pre><br>  Let's go back to our Post example and extend it using the webURL (optional) property.  If we try to decode the data published below, we will get a <a href="https://developer.apple.com/documentation/swift/decodingerror/2893182-datacorrupted%3Fchanges%3Dlates_1">.dataCorrupted</a> error along with the main error: <br><br><pre> <code class="hljs pgsql">struct PatchParameters: Swift.Encodable { let <span class="hljs-type"><span class="hljs-type">name</span></span>: Parameter&lt;String&gt;? } func encoded(_ params: PatchParameters) -&gt; String { let data = try! JSONEncoder().encode(params) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String(data: data, <span class="hljs-keyword"><span class="hljs-keyword">encoding</span></span>: .utf8)! } encoded(PatchParameters(<span class="hljs-type"><span class="hljs-type">name</span></span>: nil)) // prints "{}" encoded(PatchParameters(<span class="hljs-type"><span class="hljs-type">name</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)) //print "{"<span class="hljs-type"><span class="hljs-type">name</span></span>":null}" encoded(PatchParameters(<span class="hljs-type"><span class="hljs-type">name</span></span>: .<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>("Alex"))) //print "{"<span class="hljs-type"><span class="hljs-type">name</span></span>":"Alex"}"</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/358748/">https://habr.com/ru/post/358748/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358734/index.html">Splunk. A selection of useful materials from TS Solution</a></li>
<li><a href="../358736/index.html">Natural Language Processing</a></li>
<li><a href="../358742/index.html">Angular: ngx-translate lifehacks. TranslateCompiler</a></li>
<li><a href="../358744/index.html">Marvin Minsky "The Emotion Machine": Chapter 4 "Consciousness"</a></li>
<li><a href="../358746/index.html">Developing your own visualization plugin for Grafana</a></li>
<li><a href="../358750/index.html">Integration of Veeam Backup & Replication and PureStorage</a></li>
<li><a href="../358752/index.html">OpenVINO Toolkit - to look at the world with a clear look</a></li>
<li><a href="../358754/index.html">Logging hits (payload) Google Analytics to Google Sheets via Google Tag Manager</a></li>
<li><a href="../358758/index.html">Need more gold. How is marketing in GameDev-company?</a></li>
<li><a href="../358760/index.html">Sales using voice assistant Yandex: create skills for Alice</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>