<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scala rule-based inference engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! I want to show the public my open rules output engine ( forward chaining ) with the support of fuzzy logic , under the working title Scala infe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scala rule-based inference engine</h1><div class="post__text post__text-html js-mediator-article">  Hello!  I want to show the public my open rules <a href="http://en.wikipedia.org/wiki/Inference_engine">output engine</a> ( <a href="http://en.wikipedia.org/wiki/Forward_chaining">forward chaining</a> ) with the support of <a href="http://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D1%2587%25D1%2591%25D1%2582%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25B8%25D0%25BA%25D0%25B0">fuzzy logic</a> , under the working title <b>Scala inference engine (sie)</b> ( <a href="https://sourceforge.net/p/scalainferencee/code/ci/master/tree/">code</a> ). <br><br>  <b>UPD.</b> <br>  The library is uploaded to the maven central repository: <br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>net.sf.brunneng.fusie<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>fusie<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><a name="habracut"></a><br><h4>  Place this engine among their own kind </h4><br>  There are many good output engines and expert systems for jvm.  I will give my small review of some of them (not claiming, however, for completeness and authenticity, only my first impressions of a cursory acquaintance). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="http://en.wikipedia.org/wiki/Drools">Drools</a> - An adult, well-configurable open source engine using forward chaining.  The syntax for defining rules can be found <a href="http://docs.jboss.org/drools/release/5.2.0.Final/drools-expert-docs/html/ch05.html">here</a> . <br><br>  <a href="http://en.wikipedia.org/wiki/D3web">d3web</a> - A rather adult platform for building expert systems.  It has its own wiki, for editing rules, questions, building forms for accepting input data, unit testing.  Simple language definition rules. <br><br>  <a href="http://gaia.fdi.ucm.es/research/colibri/jcolibri">jColibry</a> - as I understand it, this library is designed to interactively search data from a large number of options. <br><br>  <a href="http://info-sapient.sourceforge.net/">InfoSapient</a> is an output engine using backward chaining with fuzzy logic support.  Allows the use of a humanoid language for describing rules.  But, in my opinion, it has several significant flaws described <a href="http://info-sapient.sourceforge.net/White_Paper/BusinessProcessRules.pdf">here</a> (page 19-20): <br>  ‚ÄúBy current design, the rule base currently cannot access external data.  This <br>  goal during the session <br>  solved, and all supporting information as well. * " <br><br>  ‚ÄúThe rule syntax doesn‚Äôt permit the calculations, ie if ((a + b) is greater than m) then x;  or executing programs for external objects. " <br><br>  <a href="http://jena.apache.org/">Jena</a> - allows you to present data in a standard RDF format (semantic network), and then tries to extract data of interest using the special query language SPARQL. <br><br>  <a href="http://en.wikipedia.org/wiki/Mandarax">mandarax</a> is a rule compiler.  The disadvantage is that it is static - each set of rules must have been compiled as Java code, and this cannot be done dynamically. <br><br>  <a href="http://java-source.net/open-source/rule-engines">And others</a> . <br><br>  As you can see, all the engines are very different: some use forward for some backward chaining, some own fuzzy logic some do not.  Some have a simple syntax for defining rules - for others it is complicated, and so on. <br><br>  In <b>sie,</b> I tried to combine the possibilities of clear and fuzzy inference, the simplicity of defining rules and a flexible configuration.  It was Scala (and not java) that was initially chosen because it can be written in a functional style, which will allow to overcome the alleged complexity of the algorithms that were to be written.  However, the engine is going to be a maven artifact, after which it can be edited to any maven project in java (with an additional dependency on the scala-library), and everything will work. <br><br><h4>  Killer feature </h4><br>  We introduce the concept of "overlapping rules."  These are the rules that give conclusions about the same variable.  for example <br><pre> <code class="scala hljs">when a &gt; <span class="hljs-number"><span class="hljs-number">300</span></span> then b = <span class="hljs-number"><span class="hljs-number">5</span></span> when a &lt; <span class="hljs-number"><span class="hljs-number">400</span></span> then b = <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre><br>  In this case, if 'a' takes a value between 300 and 400, then both rules are executed and the system for further output must decide which way to go, since 'b' cannot be 5 and 10. At the same time, there are several ways how to resolve a conflict situation: <br><ol><li>  Choose first / last rule </li><li>  Set rule priority somewhere </li><li>  Choose a rule with a more complicated condition (although in this case the conditions have one difficulty), assuming that the simpler condition defines the general case, and the more difficult one defines special cases. </li></ol><br>  <a href="http://legacy.drools.codehaus.org/Conflict%2BResolution">Drools conflict resolution strategies</a> . <br>  The current implementation (and this I have never met) goes the other way. <br>  4) Assume that both rules are equivalent and 0.5 probabilities that the first is satisfied and 0.5 that the second (or, in general, 1 / N probabilities if the overlapping rules are N). <br>  Further, the output is divided into parts, and continues separately for each of the branches up to finding the desired variable.  Subsequently, the total probability for each possible value of the desired variable over all branches of the output is considered. <br><br>  If we consider that the rules can freakishly depend on each other on the variables used in the preconditions, that conclusions can contain assignments to different variables (so that groups of overlapping rules are possible, such as X intersects Y with Y over a, Y intersects with Z over a b) that simple verbal description of the idea translates into a not very simple implementation.  The main goal that has been achieved is the correct calculation of the probabilities of the values ‚Äã‚Äãassumed by the desired variable. <br><br>  Thus, the engine copes well with the base of possibly contradictory rules that intersect: <br><ol><li>  Inadvertently, if the rules were drafted by different experts and each has their own opinion. </li><li>  Intentionally, if the same variable can be calculated in different ways, for example: <br><pre> <code class="scala hljs">when graphicCardType == <span class="hljs-string"><span class="hljs-string">"Top"</span></span> then graphicCard = <span class="hljs-string"><span class="hljs-string">"Nvidia super card"</span></span> when graphicCardType == <span class="hljs-string"><span class="hljs-string">"Top"</span></span> then graphicCard = <span class="hljs-string"><span class="hljs-string">"Radeon super card"</span></span></code> </pre><br>  In this example, an adviser for choosing a video card can advise both a Nvidia card and a Radeon card with equal probability. </li></ol><br>  Thus, an element of fuzziness is maintained in the output. <br><br><h4>  Problem Definition Language </h4><br>  Problem definition structure: <br><ol><li>  User variables are set - those that will be requested in the output process. </li><li>  Inference rules consisting of preconditions, conclusions and, if desired, the probability of the implementation of this rule (from 0 to 1, the default is 1). </li><li>  The target is the name of the variable to be found. </li></ol><br>  The problem can be defined completely programmatically, but it is much more convenient to do this using a special (non-xml) syntax that was designed to be concise and immediately understandable for a person with programming experience. <br><br>  Example 1: Financial Advisor <br><br><pre> <code class="scala hljs">int amountSaved &lt;- <span class="hljs-string"><span class="hljs-string">"How many savings you have?"</span></span> int earnings &lt;- <span class="hljs-string"><span class="hljs-string">"What is you year income?"</span></span> bool steady &lt;- <span class="hljs-string"><span class="hljs-string">"Your year income is stable?"</span></span> int dependents = min: <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;- <span class="hljs-string"><span class="hljs-string">"How many dependents you have?"</span></span> when <span class="hljs-literal"><span class="hljs-literal">true</span></span> then minincome = <span class="hljs-number"><span class="hljs-number">15000</span></span> + (<span class="hljs-number"><span class="hljs-number">4000</span></span> * dependents) when <span class="hljs-literal"><span class="hljs-literal">true</span></span> then minsavings = <span class="hljs-number"><span class="hljs-number">5000</span></span> * dependents when savingsAccount == <span class="hljs-string"><span class="hljs-string">"inadequate"</span></span> then investment = <span class="hljs-string"><span class="hljs-string">"savings"</span></span> when (savingsAccount == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span>) &amp;&amp; (income == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span>) then investment = <span class="hljs-string"><span class="hljs-string">"stocks"</span></span> when savingsAccount == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span> income == <span class="hljs-string"><span class="hljs-string">"inadequate"</span></span> then investment = <span class="hljs-string"><span class="hljs-string">"combination"</span></span> when amountSaved &gt; minsavings then savingsAccount = <span class="hljs-string"><span class="hljs-string">"adequate"</span></span> when amountSaved &lt;= minsavings then savingsAccount = <span class="hljs-string"><span class="hljs-string">"inadequate"</span></span> when steady earnings &gt; minincome then income = <span class="hljs-string"><span class="hljs-string">"adequate"</span></span> when steady earnings &lt;= minincome then income = <span class="hljs-string"><span class="hljs-string">"inadequate"</span></span> when !steady then income = <span class="hljs-string"><span class="hljs-string">"inadequate"</span></span> find investment</code> </pre><br><br>  First comes the variable definition block: <br><pre> <code class="scala hljs">int amountSaved &lt;- <span class="hljs-string"><span class="hljs-string">"How many savings you have?"</span></span> int earnings &lt;- <span class="hljs-string"><span class="hljs-string">"What is you year income?"</span></span> bool steady &lt;- <span class="hljs-string"><span class="hljs-string">"Your year income is stable?"</span></span> int dependents = min: <span class="hljs-number"><span class="hljs-number">0</span></span> &lt;- <span class="hljs-string"><span class="hljs-string">"How many dependents you have?"</span></span></code> </pre><br><br>  These are the variables that are not displayed, but are used in the rules.  First comes the type, then the name of the variable, then optional validation to possible values ‚Äã‚Äã(min: 0 - means that the value is less than 0) and, optionally, after &lt;question to the user when requesting this variable. <br>  Supported types: bool, int, double, enum (aka string). <br><br>  In the preconditions and conclusions, expressions of any complexity can be used (the most difficult in the example is <code>minincome = 15000 + (4000 * dependents))</code> , but this is far from the limit) <br>  The semantics of arithmetic operations is the same as in java.  Implicit conversions are supported int to double where it is needed.  By default, function calls from java.lang.Math are supported, but you can register your functions as well. <br><br>  Rule of sight <br><pre> <code class="scala hljs">when <span class="hljs-literal"><span class="hljs-literal">true</span></span> then minsavings = <span class="hljs-number"><span class="hljs-number">5000</span></span> * dependents</code> </pre><br>  determines the fact that  his pre-ensue is always fulfilled. <br><br>  Records <br><pre> <code class="scala hljs">when (savingsAccount == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span>) &amp;&amp; (income == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span>) then investment = <span class="hljs-string"><span class="hljs-string">"stocks"</span></span>  when savingsAccount == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span> income == <span class="hljs-string"><span class="hljs-string">"adequate"</span></span> then investment = <span class="hljs-string"><span class="hljs-string">"stocks"</span></span></code> </pre><br>  Equivalent, since  between lines in the precondition implicitly is the operation &amp;&amp; (and). <br><br>  By the way, the problem can be partially defined, for example, only rules without user variables.  And to add variable definitions programmatically.  You can also slip your datasource to pull in user variables. <br><br>  Parser features: <br><ul><li>  Syntax errors are shown, a string and a symbol where it was not possible to parse. </li><li>  Verification of semantic errors, such as determining several user variables with one name, or determining the assignment of a user variable in the conclusion. </li><li>  Type control: the user sees where the type conversion error occurred. </li><li>  Support call overloaded functions. </li></ul><br><br>  The parser was implemented as an heir from <code>scala.util.parsing.JavaTokenParsers</code> . <br>  I can only say that it was a pleasure to write it, despite the fact that I had more than modest experience in writing parsers.  The power of this tool lies in the fact that you can set templates for parsing and immediately mapping the results on the entity. <br><br><h4>  Testing </h4><br>  Testing has been given special attention.  Unit tests are written to parse the rules (from simple constructions to determine the entire problem), to verify the correctness of the output (from simple tasks to complex, with confusing overlapping rules). <br><br><h4>  Examples </h4><br>  The <code>com.greentea.sie.examples</code> package has several classes with live examples of rule definition for some different subject areas: <code>FinancialAdviser, ProgrammingLanguageAdviser, LoanarAdviser</code> . <br><br><h4>  Further directions </h4><br><ol><li>  Engine operation should not be a black box.  It is necessary to improve the description of the output process understandable to the user. </li><li>  Support for fuzzy comparisons. <br>  Type: <br>  mood is Good <br>  where mood is a numeric variable, and Good is a fuzzy concept defined by the function of care. </li><li>  Testing performance and memory usage on large arrays of rules. </li><li>  Other conflict resolution options for overlapping rules. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/180869/">https://habr.com/ru/post/180869/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../180853/index.html">Optimize keywords for apps on the App Store</a></li>
<li><a href="../180857/index.html">How I Fought Sublime Text 2</a></li>
<li><a href="../180859/index.html">Another Linq for C ++</a></li>
<li><a href="../180861/index.html">Google Glass and ridiculous view from the side</a></li>
<li><a href="../180863/index.html">Implementing ECB Encryption with the Marshall C # Library</a></li>
<li><a href="../180873/index.html">DataEngine and Python2: Creating a new DataEngine</a></li>
<li><a href="../180875/index.html">And go to study at Harvard?</a></li>
<li><a href="../180877/index.html">VNC via GIF</a></li>
<li><a href="../180881/index.html">Proxmox 3.0 Virtualization Management System Released</a></li>
<li><a href="../180883/index.html">Chrome 28 Beta for Android came out with integrated Google Translate</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>