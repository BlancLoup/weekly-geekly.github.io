<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to please the viewer and not lose money: make up a procurement plan with the help of ML</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Another article on behalf of the participant of the school about the project implemented in the framework of the next exit: 

 ‚ÄúI am Dmitry Pasechnyuk...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to please the viewer and not lose money: make up a procurement plan with the help of ML</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/2dd/a5b/50c/2dda5b50c791f6dd5ed47771bd747188.jpg" alt="image"><br><br>  Another article on behalf of the participant of the school about the project implemented in the framework of the next exit: <br><br>  ‚ÄúI am <a href="https://vk.com/id220498233">Dmitry Pasechnyuk</a> , and I want to share my research done during the holidays as part <a href="http://goto.msk.ru/">of the GoTo School‚Äôs</a> visiting spring shift led by Alexander Petrov, <a href="https://habrahabr.ru/users/asash/" class="user_link">asash</a> , technical director of E-Contenta. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As we know, online cinemas are quite common and are capable of generating good income.  But, as in any business, this does not happen by itself.  One of the important conditions for the success of an online cinema is the competent preparation of offers for viewing. <br>  In each cinema, whether online or real cinema, there is an employee engaged in repertoire planning.  It is he who determines which films will be shown on the screens.  Film-rolling process has its pitfalls.  In order to choose a good movie, you need to consider not only the cost of buying rights, but also a thousand other nuances.  There is no system for the selection of films as such, and often films are selected based on their own ‚Äúflair‚Äù, expectation rating and expert opinion. <br><br>  Making a responsible decision is a heavy moral burden for a person, on the one hand, and on the other hand, there are always risks of excessive influence of personal and situational factors on the decision made. <br><br>  Modern technologies are designed to facilitate the work of people, and in this case expectations are justified. <br><br>  In my research, I tried to shift the task of ranking films in accordance with the expectations of the target audience of the online cinema from person to car.  Of course, in the general formulation this problem is more complicated, and this solution is only the first step.  In the future, I plan to continue research in this direction. <br><br>  Everything in order under the cut. <br><a name="habracut"></a><br>  <b>Approach to solving the problem</b> <br><br>  For a list of movies for training and testing machine learning models, I used dataset from the site GroupLens (MovieLens 20M Dataset ml-20m.zip). <br><br>  To obtain a list of films announced for 2018, the TMDb API (the Movie Database API <a href="https://developers.themoviedb.org/3/getting-started">developers.themoviedb.org/3/getting-started</a> ) was used to test the algorithm. <br><br>  For information about films, such as a list of actors, directors, and a brief description of their IMDb ID, <a href="https://moviesapi.com/">SimAPI was</a> used. <br><br>  Our solution was implemented in Python using the Scikit-learn library, which contains implementations of the main machine learning algorithms. <br><br>  To solve the problem from the films, the following features were singled out: one-hot encoding feature genres;  shooting year;  famous actor, director, and film production country;  tf-idf for the 50 most powerful words in the text according to the description of the film and averaged over all the words in the description (except for stop words) word2vec. <br><br>  The target variable used was the share of MovieLens, which was active in terms of grading films to the audience, which rated the specific film.  Below are 15 of the most significant in predicting the popularity of the film signs and their weight, determined by the Random Forest algorithm. <br><br><img src="https://habrastorage.org/web/ea8/f7f/54f/ea8f7f54f0704dfe87ce33e5ceb36110.png"><br><img src="https://habrastorage.org/web/e2e/9b2/4f2/e2e9b24f2c4b46abaf1ac003cc6f7e32.png"><br><br>  For training and validation, the original MovieLens movie sample was divided into 99: 1, and any of the films in the training sample came out of any validation sample before any film, which allowed to avoid problems such as knowing the algorithm which films would have popularity after that moment. when it becomes necessary to predict the popularity of a film that has not yet been released (at that moment we will not be able to say exactly which films will be relevant in the future). <br><br>  To determine the quality of the algorithm, we used the proportion of the number of unique MovieLens users who viewed at least one of the 10, 50, 200 films identified by the algorithm as the most popular of the total audience size. <br><br>  Algorithms such as Linear regression, Random forest, K-nearest neighbors, Decision tree and Gradient boosting over decisive trees were tested on the validation sample.  The test results are presented in the following table: <br><br><img src="https://habrastorage.org/web/37b/8b1/cd5/37b8b1cd5d9b4a308836a682d9ead7fc.png"><br><br>  (The line numbered 0 represents the value of a certain metric for the case when we know the target variable). <br><br>  <b>Results of the first stage</b> <b><br></b> <br>  The optimal of the tested by the algorithm in terms of a certain quality metric proved to be Random Forest.  The Pearson correlation coefficient between the real values ‚Äã‚Äãof the target variable and the values ‚Äã‚Äãpredicted by the algorithm is 0.826.  Below is the scatter diagram for these values. <br><br><img src="https://habrastorage.org/web/e0f/c1c/90e/e0fc1c90ebf845398f54ce351083254b.png"><br><br>  Next, we decided to check whether the results of the selected algorithm match the actual results.  We got the following: if we rank films by the share of the target audience interested in the film predicted by the algorithm and output the result, we will see that those films that were in the top five really had a fairly large number of views relative to the size of the MovieLens audience. TOP 20-30, but at the same time in lower places (films ranged from 2001 to 2002 in a number of 150 pieces) <br><br><img src="https://habrastorage.org/web/2f5/275/eda/2f5275eda331472b82e14fc271c03b11.png"><br><br>  <b>Algorithm improvement</b> <br><br>  After receiving a list of films ranked by popularity, we became interested in which genre dominates the top positions in the list.  It turned out that most of the films in the top positions are dramas.  For this reason, if we simply took N films from the top of the list and only showed these films in the cinema, we would most likely lose a certain part of the audience, because some people like to watch not only dramas, but documentaries or horrors. <br><br>  We assumed that the optimal way out of this problem would be the following scheme of forming a set of films: for each film, consider its ‚Äúpopularity‚Äù as the product of the result returned by our algorithm for this movie by the ‚Äúpopularity‚Äù of the genre of this movie. <br><br>  First of all, we built a histogram for each genre, on which the abscissa plotted the number of films X of this genre, and the ordinate plotted the share of people who watched X films of this genre from 1993 to 2003 from the general audience of MovieLens.  The results are presented below: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/802/a80/62e/802a8062ea1acf806c3a4a453ddead9e.jpg" alt="image"><br><br>  Next, it was necessary to choose the metric of popularity of the genre.  The optimal variant of those tested was the normalized amount of movie views of this genre by each person from the MovieLens audience.  As a result, each of the genres received the following ‚Äúpopularity‚Äù points: <br><br><img src="https://habrastorage.org/web/abf/bab/334/abfbab334c9e4e3696251528ac8b4db8.png"><br><br>  <b>The results of the second stage</b> <br><br>  We decided to compare the results demonstrated by the improved version of the algorithm with the original version of the algorithm, and obtained the following results.  If you plot a graph, where the number of films that need to be selected to form film distribution tape is plotted on the x-axis, and the ordinate axis &lt;the quality of the original algorithm&gt; is &lt;the quality of the new algorithm&gt;, then we get the following result: <br><br><img src="https://habrastorage.org/web/660/73f/5ae/66073f5aea65491fa776a4e3ae4d4e90.png"><br><br>  As can be seen from the graph, the algorithm improved by us in the course of operation demonstrates higher quality on the segment X ‚àà [60, 225], while demonstrating the same results for large values ‚Äã‚Äãof X. <br><br>  In general, this algorithm can be used to generate long-term lists of films for purchase. <br><br>  <b>Testing the algorithm in real conditions</b> <br><br>  Testing was conducted on the list of films announced for 2018, obtained using The Movie DB API in the amount of 128 pieces.  It may not make sense to select fewer than 60 films from a given number, and together with the fact that in real conditions the ‚Äúmargin of profit‚Äù of the new algorithm may shift somewhat to the right, it was decided to test the original algorithm.  If you display a ranked list of movies and scores of their ‚Äúpopularity‚Äù, you get the following: <br><br>  <i>The first 24 films in the list</i> <br><br><img src="https://habrastorage.org/web/3b6/159/cf3/3b6159cf34ee42309f7e538e3838aaae.png"><br><br>  <i>Last 24 movies listed</i> <i><br></i> <br><img src="https://habrastorage.org/web/fe8/75d/736/fe875d7368cf4cbf8cc401bd7363642c.png"><br><br>  If you look at this list, then in its first part you can see quite promising films, for example, at positions 4, 8, 9, 10, 12, 17, 18. If you look at the latest films in the list, then these films are not generally they are clearly attractive, their content is also not very impressive, except that with the exception of the film at position 114. Why did this happen?  - if you look at the list of signs of this film, you can see that the directors of this film are not in the list of all directors (which can only say that there were no films of this series in the training set), and also no information about the genres (perhaps TMDb API and / or SimAPI, just did not find information about this movie). <br><br>  <b>Perspectives</b> <br><br>  Initially, the task of ranking new films in terms of popularity was set by us.  This algorithm will be part of the production solution.  At the same time, this is not the end of the work. <br><br>  In the future, we plan to increase the number of signs, including by including the movie search history on Google and Yandex, data on film reviews (average tone of reviews on the most popular services), as well as data on the success of films close to what is considered in terms of content. descriptions.  It is also possible to predict the share of the audience interested in the film, averaging the probability that a particular movie will be viewed by everyone (from all, or from some share of all) by the user. ‚Äù <br><br>  Thank you for your attention, and Dmitry for the article.  We will be glad to any ideas of projects from you for new schools, write to school@goto.msk.ru. </div><p>Source: <a href="https://habr.com/ru/post/333746/">https://habr.com/ru/post/333746/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333734/index.html">The selected UI framework is a mischief. Architectural Requirements - Profit</a></li>
<li><a href="../333736/index.html">How to move from KLADR to FIAS and do not break anything</a></li>
<li><a href="../333738/index.html">XBRL: just about the complex - Chapter 3. Anatomy of taxonomy</a></li>
<li><a href="../333742/index.html">Visual Tcl. GUI Development for Command Line Utilities (Continued)</a></li>
<li><a href="../333744/index.html">Localization can be automated: the experience of using Lokalise in combat conditions</a></li>
<li><a href="../333748/index.html">ICO: Basic Jurisdictions and Issues</a></li>
<li><a href="../333750/index.html">VAX - a tool for visual programming, or how to write SQL with a mouse</a></li>
<li><a href="../333752/index.html">World markets: how to succeed in India and Brazil</a></li>
<li><a href="../333754/index.html">Critical vulnerability in multityg Parity wallet, hackers withdrew $ 31 million in ethereum (updated)</a></li>
<li><a href="../333756/index.html">How to write on Spring in 2017</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>