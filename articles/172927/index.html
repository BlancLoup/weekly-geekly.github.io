<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What we should build a PBX!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A lot of articles have been written on the topic of installing and configuring IP PBX based on Asterisk software. But, for the most part, these articl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What we should build a PBX!</h1><div class="post__text post__text-html js-mediator-article"> A lot of articles have been written on the topic of installing and configuring IP PBX based on Asterisk software.  But, for the most part, these articles are reduced to a computer, Linux, and treading the keyboard in the command line of this Linux itself.  I want to tell you about one wonderful device, on which, with the installation and configuration of Asterisk, absolutely any user can handle.  This is a <a href="http://dlink.ru/ru/products/120/1603.html">D-Link DNS-345</a> network drive with Add-On (add-on) MicroPBX. <br>  Why do I need IP PBX?  Of course, to save money on telephone conversations, flexibility of the system in setting up and operation, huge functionality, etc.  To date, all major operators connect phones as a classic way (via phone cable), and means of IP-telephony (via SIP).  Examples of connection and operation of such systems: <br>  <a href="http://dlink.ua/voip_solutions_5">http://dlink.ua/voip_solutions_5</a> <br>  <a href="http://dlink.ua/voip_solutions_3">http://dlink.ua/voip_solutions_3</a> <br>  <a href="http://dlink.ua/voip_solutions_2">http://dlink.ua/voip_solutions_2</a> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/411/070/ca9/411070ca90107ca77e358c41cc852527.jpg" alt="image"><br><a name="habracut"></a><br>  As shown in the figure above, it is better to use a hybrid scheme - part of the phones via SIP, part of the classic - over copper.  This option will require additional costs, at least, for the purchase of a VoIP FXO gateway (in the D-Link DVG-3016S picture).  But the hybrid system provides much greater reliability - in the case of the ‚Äúfall‚Äù of the Internet, analog lines will work, and if the phone is broken.  cable - SIP line.  As they say, reliability requires sacrifice. <br>  But back to the main character of this article - the network drive D-Link DNS-345.  What is its beauty?  Well, compared with the closest competitors - this is of course the price.  In terms of functionality and performance, they are not worse than their more expensive colleagues, and most of the competitors do not have some functional things.  For example, support for GSM modems with voice functions as GSM gateways.  For example, Sprut Universal GSM gateway costs ~ $ 250, and a 3G modem with voice features Huawei E1550 ~ $ 40. <br>  Anticipating the statements ‚Äúyes, I am an asterisk with the support of Huawei E1550, I can raise it on a $ 40 router‚Äù I want to say that it‚Äôs just impossible to realize all the capabilities of a full- <a href="http://ru.wikipedia.org/wiki/NAS">featured NAS (Network Attached Storage)</a> router.  More precisely possible, but what is his performance?  Given that the HDD connects only USB'shny, with the appropriate read / write speed, and the RAM on the router, as a rule, no more than 32M.  Those.  A router with the same NAS software will always be in perpetual swap with all that it implies.  DNS-345 has 512M of RAM.  The processor on the router is 600 MHz at best, the DNS-345 has 1.6 GHz.  I myself somehow raised Asterisk + Huawei1550 on a router and am well acquainted with the capabilities of such a system, suitable only for a home, but in any way, even for a small office. <br>  And so, proceed to configure.  To get started, download Add-On MicroPBX Asterisk 1.8.15-cert.  Take here: <br>  <a href="http://dlink.vtverdohleb.org.ua/Add-On/">http://dlink.vtverdohleb.org.ua/Add-On/</a> <br>  Go to the ‚ÄúManagement / Application Management / Add Ons‚Äù section and install the Add-On ‚ÄúDNS-345 Asterisk18 Package ...‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/413/cc1/47d/413cc147d06393efaaa009d2f75fbad3.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Messages "Third-party Add-On ..." do not worry, click Yes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/891/145/33b/89114533bbecc19d5c6077cad32128e8.jpg" alt="image"><br><br>  After the installation is complete, launch the Add-On button with the Start button.  The package includes USB voice modems drivers, so it is recommended, before installing Add-On, to insert the modem into the NAS NAS port.  The DNS-345 USB port is rather weak, so you need to connect the modem via USB-HUB with external power. <br>  But before you connect the modem to the NAS, you need to go through, probably the most complicated PBX setup, the procedure is to switch the modem to the Modem Only mode.  To do this, connect the modem to the computer and, using any terminal program, enter AT commands to change the operating mode.  As a terminal, you can use, for example, PuTTY ( <a href="http://www.putty.org/">http://www.putty.org/</a> ).  How to "get" on the modem in the pictures below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f3/dc1/e0d/0f3dc1e0d42d73776fccd19d3377824c.jpg" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/3ac/171/0b7/3ac1710b7967a9b1a38fd66468415e92.jpg" alt="image"><br><br>  In the terminal, type "ATE1" in the blind, "and press Enter.  Subsequent input will be displayed on the screen.  Next enter: <br>  <strong>AT ^ U2DIAG = 0</strong> <strong><br></strong>  <strong>AT &amp; W</strong> <br>  Everything, the modem is ready to work, you can switch it to DNS-345. <br>  Run the Asterisk 1.8 cert1 Add-On, go to the Applications section and open the Asterisk web interface. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/93b/96e/d25/93b96ed2529055e371f435a382a8f0e5.jpg" alt="image"><br><br>  The default login / password is admin / admin. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c10/394/713/c1039471325f2d4ce84bb27684bb2945.jpg" alt="image"><br><br>  Do not forget to click the "Apply Changes" button in the upper right corner of the interface! <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dbf/d62/c60/dbfd62c60aed7afc89e608ca8a0cfb5d.jpg" alt="image"><br><br>  I will not write about Asterisk settings, the possibilities of the web interface are described in some detail here: <br>  <a href="http://service.d-link.ua/node/50">http://service.d-link.ua/node/50</a> <br>  I'll tell you only about the basic setting of the GSM gateway.  To begin with, create a basic ‚ÄúDial Plan‚Äù, get users linked to this Dial Plan, and combine the users into one Ring Group. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/154/b29/254/154b292541426946303ad31a076fa650.jpg" alt="image"><br><br>  Check if the modem is correctly defined.  To do this, go to the "Options / Advanced Options" section and turn on the "Advanced Settings".  After that, go to the "Asterisk CLI" section and give the "datacard show devices" command.  If you see something like the image below, it means that the modem has not picked up the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8b8/816/7c0/8b88167c0007687632345ea61f26e089.jpg" alt="image"><br><br>  There can be many reasons, for example, a modem, for some reason, did not switch to Modem Only mode and the system sees it not as a voice modem, but as a USB-HDD.  In this case, unfortunately, without picking in the insides of the Linux system, it is unlikely that you will understand the reason. <br>  But we will proceed from the best - the modem was determined and you saw such a picture <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0c0/f90/fac/0c0f90face51e560c50cf9e8b76bbee7.jpg" alt="image"><br><br>  Set up incoming GSM calls.  Go to the File Editor section and open the "extensions.conf" file.  If the Ring Group is created, the last line will be the ‚Äú[ringroups-custom-1]‚Äù section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0b5/829/da5/0b5829da5325c3f087efcd965a2c5dc1.jpg" alt="image"><br><br>  Open the ‚Äúdefault‚Äù context and enter the following 2 lines into it: <br>  <strong>exten = s, 1, NoOp (all_ring)</strong> <strong><br></strong>  <strong>include = ringroups-custom-1</strong> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9ad/f21/327/9adf21327760c63a0813d7f52088f3dd.jpg" alt="image"><br><br>  Click the Apply Changes button.  All incoming calls work. <br>  Now let's move on to setting up outgoing calls.  Create a trunk for outgoing.  Hostname, you can enter any non-existing IP address, for example 192.168.255.255 <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5e6/921/8a2/5e69218a2818fd79e05c9fae2f339fb9.jpg" alt="image"><br><br>  The line will appear in the logs <br>  <i>[Mar 14 20:39:06] NOTICE [1869]: chan_sip.c: 13390 sip_reg_timeout: - Registration for 'datacard-out@192.168.255.255' timed out, trying again (Attempt # 2)</i> <br>  You can not pay attention to this.  The second option is to open the users.conf file through the File Editor and comment out or delete the line "host = 192.168.255.255". <br>  Create a rule for outgoing calls in the section ‚ÄúOutgoing Calling Rules‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0ce/808/860/0ce8088608d4701686feb1f89659875b.jpg" alt="image"><br><br>  Pattern for any called number - "_X.".  If you need to wrap only certain numbers in GSM, you can register your mask <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7a6/9d3/eee/7a69d3eee59a1c5871b5cacfbb05614e.jpg" alt="image"><br><br>  In Dial Plan, allow the use of the outgoing direction "gsm_out". <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f76/a7e/877/f76a7e877f3df726978ed8f70883f4a0.jpg" alt="image"><br><br>  Go to the File Editor section and open the "extensions.conf" file.  If ‚ÄúOutgoing Calling Rules‚Äù is created, the next-to-last line will be ‚Äú[CallingRule_gsm_out]‚Äù.  Instead of the contents of CallingRule_gsm_out, enter the following: <br>  <strong>exten = _X., 1, Dial (Datacard / datacard0 / $ {EXTEN}, 300, trR)</strong> <strong><br></strong>  <strong>exten = s, n, hangup</strong> <br><img src="https://habrastorage.org/getpro/habr/post_images/329/548/40c/32954840ce393e23374e2be887c9c943.jpg" alt="image"><br><br>  Click the ‚ÄúApply Changes‚Äù button in the upper right corner of the interface. <br>  That's all, the basic setup is complete.  As mentioned at the beginning, with detailed instructions on how to configure the remaining Asterisk functions through the Web-GUI can be found at <a href="http://service.d-link.ua/node/50">service.d-link.ua/node/50</a> </div><p>Source: <a href="https://habr.com/ru/post/172927/">https://habr.com/ru/post/172927/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../172907/index.html">JDeveloper 11g Working with Bounded Task Flows, Regions and Routers in Russian</a></li>
<li><a href="../172911/index.html">Claw drone</a></li>
<li><a href="../172917/index.html">Win32 / Theola steals data from online banking systems using Google Chrome browser plugin</a></li>
<li><a href="../172921/index.html">Philips Design Line TV - ‚ÄúTV Wall‚Äù is getting closer</a></li>
<li><a href="../172923/index.html">Cryptobike, or USB server keys</a></li>
<li><a href="../172929/index.html">Are you studying in the last years of school and are interested in engineering topics? We can come to visit you!</a></li>
<li><a href="../172931/index.html">A small educational program on intellectual property rights</a></li>
<li><a href="../172935/index.html">Heads of IT companies ask the US government to adopt new immigration policy rules.</a></li>
<li><a href="../172945/index.html">Twitter deleted a user account from Russia at the request of Roskomnadzor</a></li>
<li><a href="../172947/index.html">Homemade thermal imager based on Arduino for less than $ 100</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>