<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to get the most out of code minification</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you thought about the fact that if you use a variable instead of this in the constructor and methods, then after minification, the saving of byte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to get the most out of code minification</h1><div class="post__text post__text-html js-mediator-article"><p> Have you thought about the fact that if you use a variable instead of <code>this</code> in the constructor and methods, then after minification, the saving of bytes will start from the fourth <code>this</code> ? </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     this.this.this.this. var s=this;ssss</span></span></code> </pre> <br><p>  I used this and some other <a href="http://js13kgames.com/">hard-hitting</a> ways to participate in the <a href="http://js13kgames.com/">js13kGames</a> contest, the purpose of which is to write a game, the size of which will not exceed 13 kilobytes. </p><br><img src="https://habrastorage.org/files/6a1/e59/251/6a1e59251a3345a6bfd30d0958cef434.png" alt="   " title="This year's contest theme is glitch"><br><p>  <i>The game is almost ready, it remains only a couple of days not to sleep ...</i> </p><br><a name="habracut"></a><br><h3>  What kind of competition? </h3><br><p>  js13kGames, it seems, is not yet very popular in Russia, therefore, briefly: </p><br><ul><li>  it is held every year from August 13 to September 13, starting in 2012; </li><li>  all code must be in one html-file; </li><li>  the size of the zip archive with this file should not exceed 13 kilobytes; </li><li>  the game should run in the latest stable versions of Chrome and Firefox; </li><li>  It is desirable that the game is related to the theme, which is voiced on August 13. </li></ul><br><h3>  To the detriment of readability </h3><br><p>  The above example with <code>this</code> does not add beauty to the code, but in constructors and methods, where <code>this</code> used intensively, this approach saves 3 bytes on each conversion, starting from the fifth.  For example, in one of the designers was 39 pieces <code>this</code> .  Replacing them with <code>self</code> turned out to save more than 100 bytes. </p><br><p>  I think in the whole project only these replacements saved more kilobytes. </p><br><p>  Another method, suitable, perhaps, only for such small sports projects is a large number of global variables and functions.  Almost all of the general-purpose tools ( <code>random()</code> , <code>getUniqueID()</code> and so on), as well as many specific things (like the function that turns off anti-aliasing when scaling in the Canvas context) are in the global scope.  Here, of course, you should pay special attention to the names of these tools so that the code is as self-documented as possible. </p><br><pre> <code class="javascript hljs">tr() <span class="hljs-comment"><span class="hljs-comment">// tools.random r() //  </span></span></code> </pre> <br><p>  When minifying, all these functions will occupy one character (instead of, for example, three, if we put them in an object), which gives quite impressive savings: the <code>random()</code> function alone occurs in the code 77 times, and its ‚Äúglobality‚Äù saves 150 bytes . </p><br><p>  Quite a specific situation: I decided to store the sprites in the gifs encoded in base64, and noticed that all the resulting lines begin with <code>R0lGODlh</code> .  There were a total of 14 sprites (although, according to the original idea, there should have been more), and by carrying out this initial piece of string to a function that turns lines into <code>Image</code> objects, I was able to save approximately 100 more bytes. </p><br><p>  The last nuance, which, perhaps, even helps a little with the perception of the code - it is a hard need to follow the principle of <abbr title="Don't Repeat Yourself">DRY</abbr> .  Why is it possible?  Because the code sometimes gets too fragmented.  Almost every few lines of code that repeat at least twice become candidates for selection into a function. </p><br><h3>  Biting off the gameplay </h3><br><p>  Some amount of code was avoided by simulating the surface on which the character runs: in fact, this is the boundary of the level, and the texture of the earth is simply ‚Äúoff-screen‚Äù.  Unfortunately, because of this decision, the platformer, in fact, almost ceased to be a platformer, but there was no time to correct this fundamental oversight. </p><br><p>  Some units, which, although they took very little space, turned out to be too inadequate, fall into the category of "minus to playability". </p><br><p>  The main example: a stone, designed to diversify the landscape, could not become a surface on which to jump.  Instead, it pushes the player away and deals damage.  I had to go for a quick hack to get out: the stone turned into a rat's lair, and if you start beating on it, then a rat appears every five blows from there. </p><br><h3>  Animation </h3><br><p>  As I said, all sprites are stored in GIF files wrapped in base64.  They are the minimum size, and when creating an animation, they increase by a factor of 16 (this is the size of the in-game ‚Äúpixel‚Äù).  The object with the description of the sprite is also used by the unit designers for sizing;  that is, it‚Äôs not the animation that fits the size of the unit, but the other way around. </p><br><h3>  Unused </h3><br><p>  At the very beginning of one of the ideas, it was everywhere to replace <code>true</code> and <code>false</code> with <code>1</code> and <code>0</code> , but, in the course of development, I completely forgot about it, and remembered only at the end.  Fortunately, I didn‚Äôt have to do this: by the time the work was sent to the competition, it was of a size, and I can‚Äôt even imagine how much horror I would have to go through using such an unreliable tool. </p><br><p>  To create music, I used the notation, where every two characters represent a sound: a line is a note, a number is the denominator of its duration (zero instead of a line is a pause).  The actual duration in milliseconds is calculated by dividing the duration of the whole note by the denominator of the duration of the note. </p><br><pre> <code class="javascript hljs">notes: [ <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'G4'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">'G4'</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">'C5'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'D5'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>, <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">'A4'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-string"><span class="hljs-string">'G4'</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> ]</code> </pre> <br><p>  The plans were to reduce the recording volume of the soundtrack by introducing ‚Äúsamples‚Äù - re-used musical phrases, but this didn‚Äôt come to that, since writing the music had to be done at the last hour before clicking on the Submit button, and there could no longer be any sound variety. </p><br><h3>  Conclusion </h3><br><p>  No matter how ridiculous, most of these optimizations for compression turned out to be superfluous: even with the original names of global variables, the game file turned into a zip-archive of 10.1 KB in size (with the <i>index.html</i> size of 31.9 KB).  What really was not enough is time.  Especially it was not enough for level-design, intelligible soundtrack and at least a small number of playtests. </p><br><p>  I already participated in js13kGames last year, but that time I started working two days before the deadline.  Therefore, and also because of smaller experience, the first pancake left a lump.  This year I even <a href="http://js13kgames.com/entries/glitch-rabbit">have something to be proud of</a> , although, of course, gamedev is far from the present heights. </p><br><p>  For the minification enthusiasts: the code is available on <a href="https://github.com/xenohunter/glitch-rabbit">GitHub</a> . </p><br><p>  It is interesting to learn about your tinycode projects, share in the comments! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310830/">https://habr.com/ru/post/310830/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310818/index.html">SObjectizer: the problem of overloading agents and means of dealing with it</a></li>
<li><a href="../310820/index.html">How to use the Mongoose schema to generate graphQL types</a></li>
<li><a href="../310824/index.html">Principles of reactive programming using a simple RSS aggregator using ReactiveX for Python</a></li>
<li><a href="../310826/index.html">Unit testing in complex applications</a></li>
<li><a href="../310828/index.html">SMS sending using jSMPP methods UDH, SAR, Payload</a></li>
<li><a href="../310832/index.html">Implementing Row Level Security on MySQL</a></li>
<li><a href="../310834/index.html">Protection of digital content: how to apply DMCA and not go on the path of litigation?</a></li>
<li><a href="../310836/index.html">Functional safety, Part 3 of 7. IEC 61508: Systematic randomness or random systematicity?</a></li>
<li><a href="../310838/index.html">As MegaFon and Nokia in Nizhny Novgorod, 5G networks demonstrated</a></li>
<li><a href="../310842/index.html">Intel tools for optimizing applications and the problem of flows in porous media</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>