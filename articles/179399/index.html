<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP is created to die</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer : I have more than ten years of PHP development behind me. I started using it when PHP4 was a kid and PHP5 was just a Zend dream. With his ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP is created to die</h1><div class="post__text post__text-html js-mediator-article">  <i><b>Disclaimer</b> : I have more than ten years of PHP development behind me.</i>  <i>I started using it when PHP4 was a kid and PHP5 was just a Zend dream.</i>  <i>With his help, I did a lot, I loved him, cursed him, and not without shame I watched him grow and develop.</i>  <i>I still use it in some inherited projects, but I prefer not to use it anymore.</i>  <i>I also want to note that I do not cooperate with the creators of the frameworks or tools mentioned in the article.</i> <br><br>  <b>TL; DR</b> (English too long; did not read. So, in particular, they say when they are too lazy to read the whole article - approx. Lane): if your project is based on the functions of background processes (background services, daemons - approx. .), avoid PHP. <br><br>  In my opinion, in most cases, PHP haters miss one very important point: <b>PHP is created to die</b> .  This does not mean that a fairly capable (to some extent) programming language will disappear nowhere;  it just means that your PHP code cannot run forever.  Currently, <a href="http://php.net/releases/index.php">13 years after the first official release</a> in 2000, this thought still seems to me quite reasonable. <br><a name="habracut"></a><br><h4>  Model of the dying program </h4><br>  The PHP core follows the simplest workflow: retrieve the entered data, process it, display the output, and die.  I think sites like <a href="http://phpsadness.com/">PHP Sadness</a> , which, in a fun and easy way, help reveal the inadequacy of a language, can best affect its architecture as a whole.  But, for sure, there were other attempts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the very beginning, the completion of the process (eng. Dying) was not a big concern of websites.  You read something from a database, applied logic or formatted data, and output the result among a sea of ‚Äã‚ÄãHTML tags.  PHP <b>is still hard to beat</b> (this is a feature of its kernel), despite all the horror introduced by this approach to the world of programming.  It‚Äôs good that all the problems that could have been solved in this way have already been solved, and the rest are solved by smarter and more modern tools, because such tiny functionality is usually a small part of a large, complex project.  Alas, <b>PHP insists on death after execution</b> .  And when you try to do the opposite, bad things happen. <br><br><h4>  Not just a website anymore. </h4><br>  A good task for PHP is still sending information from the feedback form via email.  There is nothing wrong with that (well, if I continue to do these things in ten years, then maybe this will mean that I made very bad decisions earlier).  But it is also an example of what has already been solved a million times in a million different ways.  Virtually any other web-based language or framework can also do this. <br><br>  Let's skip this moment.  Now we are writing a real and complex application.  Simultaneously with the complexity of the growing amount of software code.  Suppose you are a fairly capable programmer.  You use PHP 5.x and modern programming methods.  Everything is extremely abstract in interfaces and classes.  You know what to do with existing libraries.  Now you may depend on your own ORM models, third-party code, the developed interface, perhaps your client API functions for third-party REST interfaces, etc.  Everything is written in PHP. <br><br>  This is where the nightmare begins: you will inevitably have to run the code in the background.  Your application has reached a level of difficulty where waiting for an HTTP request to complete is not enough.  The reasons may be the following: you need to process request queues or cache information to speed up HTTP responses;  you periodically need to check the required payments and act depending on the result or constantly update the data received from external sources;  You may also need to write entire data packets to the database to avoid performance loss;  you may need to create and keep open several network connections or to perform the work of the server side of the WebSocket application.  These are just examples and can be listed endlessly, depending on what you are developing. <br><br><h4>  Call online </h4><br>  The worst implementation of the things described above, however, may seem rather familiar: it doesn't matter what PHP or the chosen framework requires - for sure, your hosting does not have SSH access, cron utility or similar tool for $ 5 a month. <br><br>  What is the simplest solution?  Of course, to transfer the execution of tasks from the background to the interactive mode!  Run them randomly through every nth page visit (for 1 / nth of page visits - orig.).  Then the random visitor will spend his time waiting for the system-wide background task to be completed, and only after its completion the user's personal request will be processed.  <b>It becomes alarming at the thought that many ‚Äúserious‚Äù and ‚Äúdeveloped‚Äù frameworks have such a function built in initially</b> , because it is rather difficult not only to find the code segments that are responsible for this process, but also to understand their interweaving. <br><br>  So what's the trouble?  First, there is no need for special server access parameters;  old enough, good and simple-minded FTP.  Secondly, everything works at the request of the client, and a small delay is invisible to him.  That is why the failure is ensured: everything works fine during testing, also good at the implementation stage, but ugly under real load.  You arrogantly think that there will be about as many visits as you need to run tasks at intervals of several minutes.  <b>But pseudo-randomness on a sample of n-hundreds cannot be compared with thousands of requests per minute</b> .  Tasks that need to run after a certain time are actually processed several times in the blink of an eye.  Funny things start to happen: for example, the same task starts and ends at the same time, errors appear when several processes try to gain access to shared resources with a lock mechanism, etc.  Keep in mind that crashing processes also makes it impossible to load the requested page, because, as you know, PHP dies, and everything else follows, including the user's request.  In this case, death is not a guarantee of success. <br><br>  If you are quite adventurous, you can move the background processes to the task list of the cron handler.  It's already better: it works while there is enough time, because  in this case, we have only one control variable.  In the case of recursive tasks ( <i>recursion</i> here is the core of the crond daemon kernel), you always assume that one task will complete before it is called again.  In most cases this may turn out to be the case, but, on the other hand, you may have to adjust the scheduler intervals, if the server load increases, or hope for one of them to take a long time, which can be safe but harmful for your speed. applications.  On a system scale, this method can be very, very difficult.  By this time you can already think about splitting system-wide tasks into separate packages.  But someone has to watch over it, someone who will not die. <br><br><h4>  Summon the demons </h4><br>  A real nightmare begins when the creation of demons or more robust processes seems like the right decision.  In confirmation, you can lead the establishment and maintenance of <a href="http://ru.wikipedia.org/wiki/WebSocket">WebSocket</a> connections or the creation of components of the <a href="http://en.wikipedia.org/wiki/Producer-consumer_problem">manufacturer-consumer</a> . <br><br>  <b>But PHP will fail you.</b> <br><br>  There are several tasks for which PHP is not suitable.  Remember that PHP is dying, no matter how hard you try to prevent it.  First, it‚Äôs a memory leak issue.  PHP never cares about its release if it is no longer used, because everything will be released at the end - <b>after death</b> .  In continuously running processes, <i>allocated</i> memory (which, in fact, is empty) will accumulate until the <b>memory_limit</b> threshold is reached.  After that, your process will be completed without warning.  The problem is not with you, unless you expect the process to live forever.  Under real load, replace ‚Äúslow‚Äù processes with ‚Äú <b>fairly fast</b> ‚Äù ones. <br><br>  Of course, there were improvements in the ‚Äúdon't waste your memory‚Äù plan, but it turned out to be not enough.  As soon as the complexity increases or the load increases, everything breaks down.  Consider the following code snippet: <br><br><pre><code class="php">class FOO {
    public $f;
}

class BAR {
    public $f;
}

while(1) {
    $a = new FOO();
    $b = new BAR();
    $a-&gt;f = $b;
    $b-&gt;f = $a;
    print "Memory usage: " . number_format(memory_get_usage(true)) . " bytes\n";
    unset($a);
    unset($b);
}
</code></pre><br>
    <i> </i>, ,    ,       .     ,     PHP         ,        ,       ,   ,         <b>unset()</b>.<br>
<br>
   .      ,  ,     ,     .    ,      ,    ,     : <b>ORM</b>.     ,     ,  <i>      </i>       ,   ,     .     ,         .          ,     ‚Ä¶ ,      <b></b>    ? PHP   ,    ,   ,       ,    ,  PHP .<br>
<br>
  ,  <b>         PHP</b>,  :    (    )    .  <a href="http://php.net/manual/en/features.gc.php"> </a> (Garbage collection ‚Äî .)     PHP 5.3   .  :    <b>¬´,       ?¬ª</b>.    2009 ,   .     ? <b> </b>.      ,   PHP    ,   <b> ,  </b>,   .    PHP,   ‚Äî  .<br>
<br>
<h4>    </h4><br>
 .    PHP  ,       <a href="http://phpsadness.com/sad/16">  </a>:<br>
<br>
<pre><code class="php">Fatal error: Exception thrown without a stack frame in Unknown on line 0
</code></pre><br>
  ?  ,   .        0   PHP-. <a href="http://stackoverflow.com/questions/10485371/baffled-php-fatal-error-exception-thrown-without-a-stack-frame-in-unknown-on-l">,     ,  </a>.  ,     <a href="http://www.compdigitec.com/labs/2009/08/02/solving-fatal-error-exception-thrown-without-a-stack-frame-in-unknown-on-line-0/">   </a>  PHP.    ,       ,   :   ,     ,       .            .<br>
<br>
        ,    .   . PHP  ,     . <a href="http://phpsadness.com/">    </a>.<br>
<br>
<h4>  </h4><br>
  ?     ,   PHP        ‚Äî    web- (     ¬´yes, i'm a <b>hyred keyboard</b>¬ª ‚Äî . .) ‚Äî           .    ,       ;   ,    ,  ,       <b> ,     </b>.   ,      ,   PHP ,  .        ,  <b>  </b>,      .<br>
<br>
     <a href="http://ru.wikipedia.org/wiki/Python">Python</a>, virtualenv, <a href="http://flask.pocoo.org/">Flask</a>, <a href="http://supervisord.org/">Supervisor </a> <a href="http://gunicorn.org/">Gunicorn</a>.  ,     ,      ‚Äî        -.    ,        .  :    ?    , Python     .   ,    .    ,      . ,       PHP     .<br>
<br>
<h4></h4><br>
,      . ,       memory_limit      .       cron, shell-    UNIX.    PHP   web-,    ‚Äî   .   ,          ,      ,      ,   ,      ,   ,    .     ,   30-      .<br>
<br>
,  ,  ,   -      PHP.  ,   ,  ,  PHP 5.4  PHP 5.5       .<br>
<br>
 ,    .<br>
<br>
<i>  <a href="https://news.ycombinator.com/item%3Fid%3D5495214">HN</a>  <a href="http://www.reddit.com/r/programming/comments/1bor6q/php_is_meant_to_die/">Reddit</a>.</i><br>
<br>
 <a href="http://software-gunslinger.tumblr.com/post/48215406921/php-is-meant-to-die-continued"></a></div><p>Source: <a href="https://habr.com/ru/post/179399/">https://habr.com/ru/post/179399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179383/index.html">Fast translation of large lists on the example of regions of the world</a></li>
<li><a href="../179391/index.html">On-the-Knee Monitoring - Using Cacti to Control Java Applications</a></li>
<li><a href="../179393/index.html">Lomogram Windows Phone Statistics</a></li>
<li><a href="../179395/index.html">Studying Rails (well, Ruby)</a></li>
<li><a href="../179397/index.html">Mnemonic: you can remember even numbers</a></li>
<li><a href="../179403/index.html">Facebook in real life</a></li>
<li><a href="../179405/index.html">Management of databases 1C 8.2</a></li>
<li><a href="../179411/index.html">Stand-alone application RAP</a></li>
<li><a href="../179413/index.html">Passed DConf 2013 - Conference on the programming language D</a></li>
<li><a href="../179417/index.html">A dream for a million</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>