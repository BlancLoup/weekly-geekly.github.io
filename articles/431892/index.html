<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We use Veeam Backup & Replication to test new systems and applications before upgrading</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a month ago, Microsoft announced the release of the latest version of Windows Server 2019. However, after GA (general availability), serious fla...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We use Veeam Backup & Replication to test new systems and applications before upgrading</h1><div class="post__text post__text-html js-mediator-article">  About a month ago, Microsoft announced the release of the latest version of Windows Server 2019. However, after GA (general availability), serious flaws were discovered, as in Windows October 10, 2018 Update (1809) - installing an update resulted in data loss (files from My Documents were brutally removed, so that they could not be restored from Windows.old).  The manufacturer was forced to cancel the release before fixing the problem.  And finally, on November 13, the repaired version <a href="https://www.zdnet.com/article/microsoft-re-releases-windows-server-2019/">saw the light</a> . <br><br>  Along with this, you should remember that Microsoft will soon complete support for SQL Server 2008 R2 and Windows Server 2008 R2. <br><br>  Naturally, users have many questions about the transition to new systems: <br>  Does Microsoft Azure move to the cloud?  How to safely raise the functional level of the domain?  Should I switch to Azure SQL?  Maybe you need to virtualize Windows Server 2008 R2 or transfer to Azure?  Do I need to migrate to the newest Hyper-V? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Migrating to a new platform is needed to ensure the availability of a system supported by a vendor for mission-critical applications running in the data center.  Therefore, it is important that the migration take place without surprises.  Veeam users are lucky - they have good ways to minimize the risks of such operations, so that, as they say, ‚Äúmeasure 7 times, cut them off once‚Äù. <br><br>  For details, welcome under cat. <br><br><img src="https://habrastorage.org/webt/qv/iv/ch/qvivchkwjb95lti98-5ijcjkkis.png"><br><a name="habracut"></a><br><h1>  Testing in the ‚Äúnetwork sandbox‚Äù </h1><br>  Best <s>backup</s> practices recommend checking backups for the possibility of recovery, in particular, with the help of the sandbox <b>Veeam DataLab</b> .  She first saw the light in the release of Veeam Backup &amp; Replication in 2010 (then it was called Virtual Lab) and has since been constantly updated and developed.  Today, it becomes an excellent helper for testing new software before deployment - an autonomous sandbox allows you to test planned updates and changes to systems and applications without risking production, whether it is an upgrade to Windows Server 2019, a transition to a new version of SQL or other operations. <br><br>  The device of such a ‚Äúsandbox‚Äù is shown in the picture below: <br><br><img src="https://habrastorage.org/webt/jk/2h/yt/jk2hytqgtpjgmy4mgla6hjbikkm.png"><br><br>  For the work of the "sandbox" are involved: <br><br><ul><li>  <b>Application group</b> (‚Äúgroup for application‚Äù) is one or more virtual machines that provide the work of the application you are interested in.  For example, it could be a web server and a database server for SharePoint, or a domain controller and an Exchange server, etc. </li><li>  <b>A proxy appliance</b> is an auxiliary proxy machine that serves to isolate the DataLab sandbox from the production infrastructure.  It allows you to create an IP address space in an isolated network without intersecting the production network using masquerade IP addresses. </li></ul><br>  Setting up such a ‚Äúsandbox‚Äù is described in detail in the user <a href="https://helpcenter.veeam.com/evaluation/backup/hyperv/ru/virtual_lab.html">documentation</a> .  Also in the near future a separate document is planned with an example of using DataLab just for testing upgrades on Windows Server 2019, on a new SQL Server, and also for migrating to Azure. <br><br><img src="https://habrastorage.org/webt/6j/rt/hr/6jrthrr552hu49yew9465-nf190.png"><br><br><h1>  Recreation from backups to cloud </h1><br>  Another useful technology implemented in the Veeam solution is the ability to restore from backup to Microsoft Azure.  Now it is built into Veeam Backup &amp; Replication, which is very convenient.  In addition, you can use this feature to test new systems and applications, the migration process, network connections, etc.  - because you can raise the test infrastructure in the cloud Azure.  If everything goes well, then repeat the same steps during the planned migration of production to Azure.  Let us dwell on this feature in more detail. <br><br><h2>  Why about Azure? </h2><br>  Microsoft has announced that Extended Security Updates will be available for free in Azure for Windows server 2008 R2 for another 3 years after the end of support.  Users can move their machines to Azure without changing the application code, and the sooner they do this, the more time they have to plan for future updates.  You can read more <a href="https://www.microsoft.com/en-us/cloud-platform/windows-server-2008">here</a> . <br>  Note that using recovery from backup to the Azure cloud can transfer almost everything that Veeam can backup: Windows Servers, Linux machines, virtual machines on vSphere and Hyper-V platforms, and so on and so forth. <br><br><h2>  How it works? </h2><br>  For Windows machines, the process will go like this: <br><br><img src="https://habrastorage.org/webt/ch/ak/tw/chaktw3-cgua5skvt9evxbkjbg0.png"><br><ol><li>  If you are using an Azure proxy, then Veeam Backup &amp; Replication will enable it.  Read more about this proxy <a href="https://helpcenter.veeam.com/docs/backup/hyperv/restore_azure_proxy.html">here</a> . </li><li>  Veeam Backup &amp; Replication converts drives from a backup machine into VHD format and uploads it to a blob storage in Microsoft Azure cloud. </li><li>  These disks are then mounted to the Veeam backup server server. </li><li>  The disks are being prepared for VM recovery: the rules for the Remote Desktop are activated, the rules for working through the firewall are configured, the ground is set for the installation of the Microsoft Azure agent, etc. </li><li>  Veeam Backup &amp; Replication unmounts the drives. </li><li>  If an Azure proxy was used, it will automatically shut down. </li><li>  Veeam Backup &amp; Replication registers a Microsoft Azure VM with prepared disks.  After that, the machine turns on, and a Microsoft Azure agent is placed on it. </li></ol><br>  Restoration of Linux-machines is similar - only disks are mounted on a helical appliance.  See <a href="https://helpcenter.veeam.com/docs/backup/hyperv/restore_azure_hiw.html%3Fver%3D95">here</a> for more details. <br><br>  To restore there are a number of restrictions, namely: <br><br><ul><li>  The following guest OS are supported: <br><ul><li>  Microsoft Windows Server 2008 / Windows Vista and above </li><li>  Linux - according to <a href="https://docs.microsoft.com/en-us/azure/virtual-machines/virtual-machines-linux-endorsed-distros">https://docs.microsoft.com/en-us/azure/virtual-machines/virtual-machines-linux-endorsed-distros</a> ). </li></ul></li><li>  The size of one disk of the restored VM should not exceed 4095 GB. </li><li>  If the system disk of the source machine has a GPT partition structure, then the number of partitions can be no more than 4. During recovery, such a disk will be converted to a disk with an MBR partition structure. </li><li>  Azure Hybrid Use Benefit is not supported. </li></ul><br>  <i>Important!</i>  Check that the time on the Veeam backup server is set correctly, otherwise there may be errors when trying to add Microsoft Azure accounting to the Veeam Backup &amp; Replication infrastructure or when performing recovery. <br><br><h2>  Add a Microsoft Azure account to Veeam Backup &amp; Replication </h2><br>  In order to perform recovery, it is necessary, in particular, to add a Microsoft Azure account to the Veeam Backup &amp; Replication infrastructure.  In this case, Veeam Backup &amp; Replication saves in its database the subscriptions and resources associated with the account, and during recovery to the cloud it uses them to register a new VM in Microsoft Azure.  There are 2 options for importing this data: <br><br><ul><li>  work model using Resource Manager </li><li>  classic work model </li></ul><br>  The provider itself (Microsoft Azure) recommends deploying new machines in the cloud using the Resource Manager, so we will use it. <br><br>  Before you add a Microsoft Azure account in the Veeam Backup console, you need to perform several preparatory steps: <br><br><ol><li>  Make sure you already have a Microsoft Azure account.  The setup wizard can only add accounts, but not create. </li><li>  [For those who have a Windows server OS] In Internet Explorer settings, you need to turn off Protected Mode, otherwise during the work with the Setup Wizard you will not be logged in to the cloud. </li><li>  If it is not possible to disable Protected Mode, add the following to the list of allowed sites: <br><ul><li>  <a href="https://login.live.com/">login.live.com</a> </li><li>  <a href="https://login.microsoftonline.com/">login.microsoftonline.com</a> </li><li>  <a href="https://secure.aadcdn.microsoftonline-p.com/">secure.aadcdn.microsoftonline-p.com</a> </li><li>  <a href="https://auth.gfx.ms/">auth.gfx.ms</a> </li><li>  about: security_veeam.backup.shell.exe </li></ul><br>  You may also need to disable <b>Internet Explorer Enhanced Security Configuration</b> in Server Manager. <br></li><li>  Check that the Veeam backup server is set to the correct time corresponding to the time zone in which the server is located. </li><li>  On the machine where the Veeam Backup console is running, it is strongly recommended to install Microsoft Azure PowerShell 4.0.2.  If you have a different version, there may be difficulties.  If you don‚Äôt have any version of Microsoft Azure PowerShell at all, then Veeam Backup will offer to install it (see below). </li><li>  You need to configure HTTP / HTTPS proxy for the <i>Local System</i> account or for the account under which the Veeam Backup Service is running.  See more <a href="https://blogs.msdn.microsoft.com/askie/2013/05/09/user-proxy-settings-showing-up-in-local-system-account-correct-way-to-apply-proxy-settings/">here</a> . </li></ol><br>  Now we are going to add an Azure account.  As agreed, we will use the model with the Resource Manager: <br><br><ol><li>  In the main menu of Veeam Backup &amp; Replication, select <b>Manage Azure Accounts</b> . </li><li>  In the <b>Manage Microsoft Azure Account</b> window, click <b>Add</b> to launch the wizard. <br><br><img src="https://habrastorage.org/webt/w5/v-/49/w5v-49rx166580pti1qp-tmxasq.png"><br></li><li>  In the <b>Deployment Model</b> step, select the <b>Azure Resource Manager</b> option. </li><li>  From the <b>Region</b> list, select the desired Microsoft Azure region: <i>Global</i> , <i>Germany</i> or <i>China</i> . </li><li>  After clicking on <b>Next</b> Veeam Backup &amp; Replication will check if there is Microsoft Azure PowerShell on this machine.  If not, a warning will be issued with a link to the installation instructions.  After installation, you will need to restart the Setup Wizard. <br><br><img src="https://habrastorage.org/webt/ew/nz/ui/ewnzuinuilks3ekx2ew4cqwurxq.png"><br></li><li>  At the <b>Subscription</b> step, click the <b>Configure account</b> .  You will need to login to the Microsoft Azure portal by entering an existing account.  Veeam Backup &amp; Replication will receive information about subscriptions and resources provided to the owner of this account. <br><br>  If you plan to restore Linux machines, then you need to check the <b>Enable restore of Linux-based computers</b> checkbox.  In this case, Veeam Backup &amp; Replication will deploy a helper appliance in the cloud, which is necessary for recovery. <br><br><img src="https://habrastorage.org/webt/4n/i6/zx/4ni6zxiuib0fm_6f0rn91zsdsjg.png"><br></li><li>  Go through the steps of the Setup Wizard to the end and click <b>Finish</b> . </li></ol><br><h2>  We prepare backups </h2><br>  The following types of backups are supported: <br><br><ul><li>  Virtual machine backups (Microsoft Windows and Linux) created with Veeam Backup &amp; Replication </li><li>  Backups of physical Windows machines created with Veeam Agent for Windows. </li><li>  Backups of physical Linux machines created with Veeam Agent for Linux. </li></ul><br>  <i>Note:</i> To restore a physical machine to Azure, you need to back up the whole of it or back up the volumes. <br><br>  Note that you can restore the machine to the state as in the last restore point or as in any previous point in the backup chain.  In this case, the chain should be stored in the repository included in the Veeam Backup infrastructure.  You can also import existing backup. <br><br><h2>  Perform recovery </h2><br>  To do this, run the Restore to Azure Restore Wizard: <br><br><ol><li>  In the <b>Home</b> view, expand the <b>Backups</b> node in the tree on the left.  Then in the right panel we expand the node of the backup we need, select the necessary machine there. </li><li>  Clicking on it with the right button, select the <b>Restore to Microsoft Azure</b> command and go to the step of the <b>Deployment Model</b> wizard. <br><br><img src="https://habrastorage.org/webt/w5/v-/49/w5v-49rx166580pti1qp-tmxasq.png"><br></li><li>  Specify which deployment model in Microsoft Azure we will use when restoring to the cloud.  In our case, this will be the Azure Resource Manager. <br><br><img src="https://habrastorage.org/webt/p7/xg/v7/p7xgv7dnuf_qihqev08eezrew4c.png"><br></li><li>  In the <b>Subscription</b> step, we specify the following settings: <br><ul><li>  In the <b>Subscription</b> list, all the subscriptions available for the account that we added to Veeam Backup in the first stage will be shown.  Choose a subscription, the resources of which we want to use. </li><li>  From the list of <b>Locations,</b> select the region in which we want to place the restored machine.  Make sure you have at least one storage system for this region. </li><li>  If you want to speed up the recovery process to a remote region, we recommend using the <b>Use Azure proxy VM</b> by selecting Microsoft Azure proxy from the list.  It is reasonable that the proxy is in the same region where you will be restoring the car. <br></li></ul><br><img src="https://habrastorage.org/webt/lz/_i/2c/lz_i2csoqrpp8vjo1z4u1de31fg.png"><br></li><li> In the <b>VM size</b> step, we specify the size of the machine and the account for the storage system where the disks of the restored machine will be placed. <br><ol><li>  Select a machine from the <b>Azure VM Configuration</b> list and click <b>Edit</b> . </li><li>  From the <b>Size</b> list, select the size of the restored VM.  (By default, the minimum sufficient will be selected for the number of disks in the VM). <br>  <i>Note:</i> Here you need to keep in mind that the size of the VM will depend on the number of CPU cores, memory resources and disk space that will be allocated to this VM.  Read more <a href="https://docs.microsoft.com/ru-ru/azure/virtual-machines/windows/sizes%3Ftoc%3D%252Fazure%252Fvirtual-machines%252Fwindows%252Ftoc.json">document from Microsoft</a> . </li><li>  From the list of <b>Storage</b> account, select the so-called.  ‚ÄúStorage account‚Äù for the storage on which we want to store the disks of the restored VM.  (Remember the selected VM size.) If you indicated that when you deploy a VM in the cloud, you will use Azure proxy, then only general-purpose accounts will appear in this list (accounts for Blob will not be shown).  About different types of accounting is written <a href="https://docs.microsoft.com/ru-ru/azure/storage/common/storage-quickstart-create-account%3Ftabs%3Dportal">here</a> . </li></ol><br><img src="https://habrastorage.org/webt/sb/sm/ik/sbsmikxnlkbxp3qlzpb_jrjukcw.png"><br></li><li>  At the <b>Resource Group</b> step, you can specify a new name for the VM being restored (by default it will be the same as the name of the source machine).  We click <b>Name</b> and specify a new name explicitly, or set a rule according to which it will be formed - by adding a prefix and / or postfix to the original one. <br><br>  By default, a new resource group will be created for the VM.  If you want to add a VM to an existing group, you can also do this at this step.  Select the VM from the list and click on the <b>Group</b> , specify the desired option: <br><br><ul><li>  <b>Place VM into the existing resource group</b> (place in existing group) </li><li>  or <b>Create a new resource group</b> (create a new group) </li></ul><br><img src="https://habrastorage.org/webt/js/e7/ki/jse7kidzkjwq0imqrlfpnzaodvo.png"><br></li><li>  In the <b>Network</b> step <b>, we</b> specify the network and subnet for connecting the restored VM. <br><br><img src="https://habrastorage.org/webt/ty/wo/-j/tywo-jnnwddjxrp5xjfq-u8xi38.png"></li></ol><br>  In the final steps, we indicate the purpose for which we restore the VM, check the settings once again, click <b>Finish</b> and watch the progress of the recovery session to the cloud. <br><br>  A detailed description of the recovery wizard for both deployment modes (including Classic mode) can be found <a href="https://helpcenter.veeam.com/docs/backup/hyperv/restore_azure_process.html%3Fver%3D95">here</a> (in English). <br><br><h1>  Finally </h1><br>  If you are ready to share your practical experience of using the sandbox or restoring to Azure from Veeam backups, welcome to comments. <br><br>  If you want to know more about this functionality, then you can help: <br><br><ul><li>  <a href="https://habr.com/company/veeam/blog/182144/">Article on Habr√© about the sandbox as an autonomous test environment</a> </li><li>  <a href="https://helpcenter.veeam.com/evaluation/backup/vsphere/ru/virtual_lab.html">Basic scenarios for using Veeam Backup &amp; Replication for VMware vSphere (in Russian)</a> </li><li>  <a href="https://helpcenter.veeam.com/evaluation/backup/hyperv/ru/virtual_lab.html">Basic scenarios for using Veeam Backup &amp; Replication for Microsoft Hyper-V (in Russian)</a> </li><li>  <a href="https://www.veeam.com/ru/videos/data-labs-beginner-to-advanced-14166.html">Webinar ‚ÄúVeeam DataLabs: from beginners to advanced users‚Äù (in Russian)</a> </li><li>  <a href="https://www.veeam.com/ru/videos/direct-restore-azure-9631.html">Webinar ‚ÄúRestore in Microsoft Azure‚Äù (in Russian)</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/431892/">https://habr.com/ru/post/431892/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../431880/index.html">Doom of SceneKit. Yandex experience with 3D graphics in iOS</a></li>
<li><a href="../431884/index.html">Microsoft has overtaken Apple by market capitalization: how did this happen?</a></li>
<li><a href="../431886/index.html">Al Lowy has posted his source code collection for Sierra products on eBay</a></li>
<li><a href="../431888/index.html">‚ÄúI think team ideas are the most important thing when developing a product‚Äù</a></li>
<li><a href="../431890/index.html">How to place an order on the exchange of freelancing</a></li>
<li><a href="../431894/index.html">In December, will decide on the mandatory registration of base stations LPWAN</a></li>
<li><a href="../431898/index.html">It is all about Agile - 2: features of the introduction of agile development</a></li>
<li><a href="../431900/index.html">In the Linux kernel, the word fuck was replaced by hug</a></li>
<li><a href="../431902/index.html">How we built a fast and reliable ad views repository</a></li>
<li><a href="../431904/index.html">How we have unloaded HR specialists: infomats for issuing payment sheets</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>