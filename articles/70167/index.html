<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Server on steroids: FreeBSD, nginx, MySQL, PostgreSQL, PHP, and more</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 A lot of time has passed since I wrote the previous article on optimizing this bundle. That long-suffering Pentium 4 with 512MB of memo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Server on steroids: FreeBSD, nginx, MySQL, PostgreSQL, PHP, and more</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img84.imageshack.us/img84/9446/btdmd8.png" alt="I like this picture, with me, I never get it" width="500" height="306"><br><h2>  <strong>Introduction</strong> </h2><br>  A lot of time has passed since I wrote the <a href="http://habrahabr.ru/blogs/server_side_optimization/52475/">previous article</a> on optimizing this bundle.  That long-suffering Pentium 4 with 512MB of memory, servicing simultaneously up to a thousand people on the forum and up to 150,000 peers on the tracker, has long been resting on a German thread, a dump, and the club has been replaced by more than one server.  Everything said in it still remains relevant, but there are things that should be added. <br>  The article is large, so it will be divided into logical blocks: <br><br><pre>  0. Why is there anything to optimize?<font></font>
  <font></font>
 1. OS Optimization (FreeBSD)
   1.1 Transition to 7.x 
   1.2 Transition to 7.2
   1.3 Switch to amd64
   1.4 Unloading the network subsystem
   1.5 FreeBSD and a large number of files
   1.6 Softupdates, gjournal and mount options<font></font>
  <font></font>
 2. Optimization of frontend (nginx)
   2.1 Accept Filters
   2.2 Caching
   2.3 AIO<font></font>
  <font></font>
 3. Backend optimization
   3.1 APC
   3.1.1 APC locking
   3.1.2 APC hints
   3.1.3 APC fragmentation
   3.2 PHP 5.3<font></font>
  <font></font>
 4. Database Optimization
   4.1 MySQL 
   4.1.1 Transition to 5.1
   4.1.2 Transition to InnoDB
   4.1.3 MySQL Internal Cache - Query Cache
   4.1.4 Indices<font></font>
  <font></font>
 4.2 PostgreSQL
   4.2.1 Indices
   4.2.2 pgBouncer and others.
   4.2.3 pgFouine<font></font>
  <font></font>
 4.3 Database Unloading
   4.3.1 SphinxQL
   4.3.2 Non-RDBMS Storage
   4.4 Encodings
   4.5 Asynchrony<font></font>
  <font></font>
 Application.  Little things.
   1. SSHGuard or alternative.
   2. xtrabackup
   3. Transfer mail to another host
   4. Integration with third-party software
   5. Monitoring<font></font>
  <font></font>
  6. Cons optimization </pre><br><a name="habracut"></a><br><h2>  <strong>0. Why is there anything to optimize?</strong> </h2><br>  In general, you can grow: <br><ul><li>  Scale up (build up iron) </li><li>  Scale out (Increase the number of frontends / machines in the middle tier) </li><li>  Optimizing </li></ul><br>  The first option is better to use when you have a lot of money, the second, when a good architecture.  Well, the third, which I will describe, is used when there is neither the first nor the second, but I want to squeeze the most out of the available iron. <br><br><h2>  <strong>1. OS Optimization (FreeBSD)</strong> </h2><br><h3>  <strong>1.1 Transition to 7.x</strong> </h3><br>  <a href="http://ivoras.sharanet.org/freebsd/freebsd7.html">What do we get</a> when upgrading to a new version of FreeBSD? <br>  For me the most important thing is: <br>  <a href="http://people.freebsd.org/~kris/scaling/mysql.html">The new ULE 3.0 Scheduler</a> and <a href="http://www.freebsd.org/releases/7.0R/relnotes.html">jemalloc are</a> quite useful on multi-core (&gt; = 4) systems. <br>  <a href="http://www.freebsd.org/releases/7.0R/relnotes.html">MSI (Message Signaled Interrupts)</a> - they are often referred to in drivers as Fast Interupts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So if you have a legacy 6.x system that begins to sag under load, it may be worth translating it to 7.x. <br><br><br><h3>  <strong>1.2 Transition to 7.2</strong> </h3><br>  <a href="http://en.wikipedia.org/wiki/Page_%2528computing%2529">Superpages</a> , increased KVA, optimized by default sysctl'i.  All this you get is absolutely free just by going to the latest release of the OS. <br><br>  <a href="http://ivoras.sharanet.org/freebsd/freebsd8.html">Progress also does not stand still,</a> and now FreeBSD 8.0 is preparing for the release, there we are promised further increase in performance.  As proof of stability, <a href="http://www.freebsd.org/">www.FreeBSD.org</a> was translated to FreeBSD-CURRENT at the time of the first beta versions.  So on the staging machines you can start driving it already. <br><br><br><h3>  <strong>1.3 Switch to amd64</strong> </h3><br>  Moving to amd64, you will additionally receive the <a href="http://svn.freebsd.org/viewvc/base%3Fview%3Drevision%26revision%3D192469">giant sizes of KVA</a> and <a href="http://www.freebsd.org/releases/7.2R/relnotes-detailed.html">Shared Mem&gt; 2Gb</a> .  However, this is not the most important thing ... <br><br>  Note that 4 Gb of memory in 2009 is already fully installed on laptops, and it is quite ridiculous to put so much on the server from the database.  Of course, for a small database this is normal, but what to do when it grows and stops getting into memory?  C i386 OS to deliver more memory will be problematic, because PAE is a separate glitch.  Yes, and INT64 has been used a lot for a long time already and it gives productivity gains to such applications as, for example, databases and OpenSSL.  (If anyone has links to <em>adequate</em> benchmarks "*** SQL i686 vs amd64" - throw in the comments). <br><br><br><h3>  <strong>1.4 Unloading the network subsystem</strong> </h3><br>  Here in FreeBSD is not just a field, but a whole testing ground. <br>  The whole optimization can be divided into 2 parts: Tuning <code>ifconfig</code> parameters and <code>sysctl.conf/loader.conf</code> , let's go in that order. <br>  First you need to look at what our networkers are generally capable of, for this you can use this command: <br><pre>  # ifconfig -m
 capabilities = 399b &lt;RXCSUM, TXCSUM, VLAN_MTU, VLAN_HWTAGGING, VLAN_HWCSUM, TSO4, WOL_UCAST, WOL_MCAST, WOL_MAGIC&gt; </pre><br>  If you have a good em (Intel Gigabit) / bge class (Broadcom Gigabit) network card, you can try the ifconfig options: <br><ul><li>  <code>tso</code> ( <code>tso4</code> , <code>tso6</code> ) - TCP Segent Offloading </li><li>  <code>lro</code> - Large Recive Offload </li><li>  <code>txcsum</code> , <code>rxcsum</code> - RX / TX Checksum Offload </li><li>  <code>link0</code> , <code>link1</code> , <code>link2</code> - depend on the driver, it is necessary to watch its code.  Sometimes they include some optimizations, sometimes it just switches the network card to MASTER on Gigabit links. </li></ul><br>  Also, on <code>em</code> network card and multi-core processes, you can try the <a href="http://people.yandex-team.ru/~wawa/">drivers from Yandex</a> , which process packages in several streams.  Just a lot of things about tuning the network subsystem can be found at <a href="http://forum.nag.ru/forum/index.php%3Fshowforum%3D4">nag.ru</a> <br><br>  If you have a third- <code>re/rl/sk/nfe</code> ( <code>re/rl/sk/nfe</code> ...), then the above options may not work correctly and cause the server to hang, so it‚Äôs better to stop at <a href="http://www.cyberciti.biz/faq/freebsd-device-polling-network-polling-tutorial/">polling</a> 'e. <br><br>  And finally, I recommend everyone to see the updated version of <a href="http://www.rootconf.ru/papers2009/12568.html">tuning FreeBSD 7 ‚Äúaccording to Sysoev‚Äù</a> and <a href="http://serverfault.com/questions/64356/freebsd-configuration-sysctl-tuning">my list of sysctl</a> with comments. <br><br><br><h3>  <strong>1.5 FreeBSD and a large number of files</strong> </h3><br>  FreeBSD has a great technology for caching file names in a directory.  So, if you have a lot of files in one directory, it is much better to use a hash table search rather than constantly running across the entire tree in breadth / depth in search of the desired file.  However, max.  The amount of memory allocated for <a href="http://en.wikipedia.org/wiki/Dirhash">dirhash</a> (the so-called this technology) is limited to <code>vfs.ufs.dirhash_maxmem</code> and by default is, like, 2MB, which is very small.  It is recommended to increase memory until <code>vfs.ufs.dirhash_mem</code> ceases to rest on the "ceiling". <br><br><br><h3>  <strong>1.6 Softupdates, gjournal and mount options</strong> </h3><br>  New terabyte screws are just gorgeous - they are cheap, and their performance is just cashier.  However, there is one caveat: when electricity is cut off at the data center, the fsck of such terabytes may take more than one hour.  You can solve this problem using <a href="http://www.maths.tcd.ie/~dwmalone/p/bsdcon01.pdf">softupdates</a> or you can attach journaling via gjournal to the system.  What exactly is up <a href="http://www.google.ru/search%3Fhl%3Dru%26amp%3Bclient%3Dfirefox%26amp%3Brls%3Dorg.mozilla%253Aru%253Aofficial%26amp%3Bhs%3DYwF%26amp%3Bnewwindow%3D1%26amp%3Bq%3Dsoftupdates%2Bvs%2Bgjournal%26amp%3BbtnG%3D%25D0%259F%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%26amp%3Blr%3D%26amp%3Baq%3D0%26amp%3Boq%3D">to you</a> . <br>  A couple of tips on journaling: in order not to lose productivity, it is better to fix the journal section on a separate disk, and in order not to catch panic because of its overflow, it is better to make the journal section bigger (for example, RAM + swap). <br>  <s>If you have a raid with BPU,</s> or you just have nothing to lose, you can add the <code>async</code> option to <code>/etc/fstab</code> .  And such an option as <code>noatime</code> can be <i>almost</i> safely recommended to everyone.  (read <a href="https://habrahabr.ru/users/giner/" class="user_link">giner</a> 's comment <a href="http://habrahabr.ru/blogs/server_side_optimization/70167/">here</a> ) <br><br><br><h2>  <strong>2. Optimization of frontend (nginx)</strong> </h2><br>  In fact, I am extremely opposed to excessive and / or premature optimization, which include frontend optimization.  Usually on web projects where nginx is not only engaged in statics, it consumes 1% -5% of CPU, depending on the nature of its use, the rest is eaten by php. <br>  However, optimization of the nginx config can affect the overall response time of the site, so there are points that are worth talking about. <br>  From standard optimizations I can recommend <br><pre>  reset_timedout_connection on;
  sendfile on;
  tcp_nopush on;
  tcp_nodelay on; </pre><br>  Well, play around with the number of workers, and not just put them on the number of CPU / Screws.  I also recommend everyone to get acquainted with <a href="https://calomel.org/nginx.html">this document</a> and the topic of <a href="http://serverfault.com/questions/18994/nginx-best-practices">Nginx best-practices</a> on Serverfault, it is very likely that you will learn something new. <br><br><br><br><h3>  <strong>2.1 Accept Filters</strong> </h3><br>  FreeBSD has a technology that allows you to transfer a packet from the kernel to the process only if 1) any data arrives 2) a valid http request.  This technology is called <a href="http://sysoev.ru/freebsd/accept-filters.html">accept filters</a> .  Such filters will help both to unload the server in case of a large number of connections, and to protect it a little against DDoS'a (Although the second one is better at handling <a href="http_limit_req_module.html">ngx_http_limit_req_module</a> , which has already been written more than once in <a href="http://habrahabr.ru/search/%3Fq%3Dlimit_req_zone">Habr√©</a> ) <br>  To enable the processing of connections using filters, you must first load the kernel module: <br><pre>  #ls / boot / kernel / | grep acc
    accf_data.ko
    accf_http.ko
 #kldload accf_http </pre><br>  Next in the <code>nginx.conf</code> config <code>nginx.conf</code> enable the <code>httpready</code> filter: <br><pre>  listen 80 default accept_filter = httpready; </pre><br><br><h3>  <strong>2.2 Caching</strong> </h3><br>  Nginx has a very flexible response caching system, both from <a href="http_fastcgi_module.html">fastcgi</a> and <a href="http_proxy_module.html">proxy</a> backend.  I think everyone who read the documentation in his head immediately had several scenarios for applying caching in his project.  I can only give general advice: <br>  God forbid you give rss via php script.  If so, then you can safely cache the answer for 3-5 minutes. <br>  I think almost the entire version of the site for guests can be crammed into the cache for 5 minutes too (well, of course if you have a non-news site) <br><br>  In addition to the server cache, there is also a client cache.  I would recommend to hang expire per month on all static: <br><pre>    
         location ~ * \. (jpg | jpeg | gif | png) $ {
    	    root / var / nnm club;
    	    expires 30d;
         } </pre><br><h3>  <strong>2.3 AIO</strong> </h3><br>  About the introduction of <a href="http_core_module.html">AIO in nginx</a> already <a href="http://habrahabr.ru/blogs/nginx/68480/">written on Habr√©</a> , there are also quite interesting discussions in the comments.  In short, AIO is useful for very specific loads, as well as helping to save the response time while reducing the number of workers. <br>  To use aio, you need to load the aio.ko kernel module: <br> <code># <strong>kldload aio</strong></code> <br>  and then enable aio and sendfile in <code>nginx.conf</code> <br><pre> 
  sendfile on;
  aio sendfile; </pre><br>  Newer versions of nginx allow aio to be used with sendfile.  Regarding this configuration, the documentation states: <br><blockquote>  In this configuration, the SF_NODISKIO flag is used and sendfile () is not blocked on the disk, but reports the absence of data in memory, after which nginx initiates asynchronous data loading, reading only one byte.  At the same time, the FreeBSD kernel loads the first 128K files into memory, however, on subsequent readings, the file is loaded in parts only 16K each.  Therefore, this mode is best used for distribution of small, up to 128K files. <br></blockquote><br>  The patch for FreeBSD, to solve this problem <a href="http://comments.gmane.org/gmane.comp.web.nginx.russian/27401">here</a> , maybe over time it will go into -CURRENT and will be ported to 8.0 and 7.x <br><br><br><h2>  <strong>3. Backend optimization</strong> </h2><br>  Here you can tell me a lot of things, for example, java has magic lines from the series "-Xms768m -Xmx1280m -XX: + UseConcMarkSweepGC -XX: + CMSIncreationalMode -XX: + UseCompressedOops -Djava.net. which only our java-programmer is able to understand, and in PHP 50% optimization does <a href="http://en.wikipedia.org/wiki/List_of_PHP_accelerators">caching opcode</a> , the rest is observed from caching responses from the database.  So this part of the topic will be very stingy. <br><h3>  <strong>3.1 APC</strong> </h3><br>  About the optimization of the APC told the developers of <a href="http://www.scribd.com/doc/88689/ApcFacebook">Facebook</a> .  I highly recommend reading if you have time. <br><br><h4>  3.1.1 APC locking </h4><br>  Old File Locking, this is exactly the ‚Äúbrake‚Äù that is why eCclelerator is being used instead of APC.  So, the default locking is often <a href="http://c7y.phparch.com/c/entry/1/art,apc_facebook">recommended to change</a> to spinlock or pthread mutex.  As far as I remember, pthread mutex has become default since 3.0.16, so if you have a server with an old APC, I recommend updating it. <br><br><h4>  3.1.2 APC hints </h4><br>  If you have a lot of .php files or you cache a lot in the APC user cache, then you will very likely have to raise the values <br>  <code>apc.num_files_hint</code> and <code>apc.user_entries_hint</code> respectively in <code>php.ini</code> .  These values ‚Äã‚Äãare responsible for the hash sizes of the APC tables (in fact, they are still doubled before use), and we know that the table hash works very poorly at <a href="http://en.wikipedia.org/wiki/Hash_table">load factor</a> &gt; = 0.75 <br><br><br><h4>  3.1.3 APC fragmentation </h4><br>  Fragmentation in APC is such a thing, because of which you want to take this same cache, crumple it and throw it out the window.  APC is not a replacement for a normal key-value due to its inability to delete TTL or <a href="http://en.wikipedia.org/wiki/Cache_algorithms">LRU</a> automaton.  That is, there are no GCs and entries that have fallen into the cache can go from there only in two cases: <br><ul><li>  When they were contacted after their expiry ttl </li><li>  All memory is over and APC has resorted to an emergency measure - resetting the entire cache entirely. </li></ul><br>  Summarizing, you can say: High fragmentation is a sign that you are misusing APC. <br>  Here you need to add a note, judging by the comments <a href="http://pecl.php.net/bugs/bug.php%3Fid%3D13146">here</a> , in 3.1.x a lot was corrected in terms of memory allocation, but judging by <a href="http://pecl.php.net/bugs/bug.php%3Fid%3D16843">this</a> , 3.1.x does not work for everyone. <br><br><br><br><h3>  <strong>3.2 PHP 5.3</strong> </h3><br>  Everything seems simple here - we are <a href="http://www.google.ru/search%3Fhl%3Den%26client%3Dfirefox%26rls%3Dorg.mozilla%253Aru%253Aofficial%26hs%3DwCe%26newwindow%3D1%26q%3DPHP%2B5.3%2Bperformance%26btnG%3D%25D0%259F%25D0%25BE%25D0%25B8%25D1%2581%25D0%25BA%26lr%3D%26aq%3Df%26oq%3D">updating PHP, we get a performance boost</a> .  However, looking at the list of <a href="http://us.php.net/manual/en/migration53.deprecated.php">deprecated</a> functions in 5.3, you can be horrified, since they are still working. <br>  Despite all the simplicity, I think the transition from 5.2 to 5.3 will be a long time, especially in production. <br><br><br><h2>  <strong>4. Database Optimization</strong> </h2><br>  In fact, the best DB optimizations in our club are: <br><ul><li>  Not using RDBMS at all (sphinxsearch) </li><li>  Not using base (caching) </li><li>  Batch requests (where in (...), batch insert / update) </li><li>  Asynchronous work with the database (memcacheQ, apacheMQ, AQMP, crontab) </li></ul><br>  However, most of the above tools require a fairly serious rewrite of the application. <br><br><br><h3>  <strong>4.1 MySQL</strong> </h3><br>  There are quite a few manuals on MySQL optimization, there are <a href="http://www.mysqlperformanceblog.com/2007/11/01/innodb-performance-optimization-basics/">literate</a> , there is not much.  In any case, during the lifetime of any web project, its database will have time to rest in memory, and in disk, and maybe even in the processor, so it‚Äôs hard to use simple howto, you‚Äôll have to <a href="http://www.percona.tv/">watch</a> conferences, learn to use profilers (oprofile, <a href="http://www.mysqlperformanceblog.com/2009/09/14/systemtap-dtrace-for-linux/">systemtap</a> , dtrace) and use a large number of <a href="http://www.mysqlperformanceblog.com/tools/">additional software</a> .  In other words, not only to understand what indexes, sorting and grouping are, but also to understand how MySQL uses them internally, to know what <a href="http://forge.mysql.com/wiki/Top10SQLPerformanceTips">EXPLAIN, Query cache are, the advantages and disadvantages of various storage engines</a> , in general, be 100% DBA for your project. <br>  Next, I will describe ways to help with minimal code changes (or even without them), to optimize MySQL. <br>  As I said in the previous part, 50% of MySQL tuning can be done in semi-automatic mode with just two utilities: <br><ul><li>  <a href="http://www.day32.com/MySQL/">tuningprimer</a> </li><li>  <a href="http://blog.mysqltuner.com/">mysqltuner</a> </li><li>  <a href="http://hackmysql.com/mysqlsla">mysqlsla</a> </li></ul><br><h4>  4.1.1 Transition to 5.1 </h4><br>  The transition to 5.1 brings a <a href="http://dev.mysql.com/doc/refman/5.1/en/mysql-nutshell.html">lot of bonuses</a> , I was particularly interested in: <br><ul><li>  Optimizer Optimization (especially GROUP BY) </li><li>  InnoDB plugin </li><li>  Partitioning </li><li>  Row based replication </li></ul><br>  All this can add performance, so it is worth climbing over 5.1.  As for the noise around the fact that 5.1 is not stable, then all this is no longer relevant, and initially it was too bloated (if anyone has any contraindications or a bad expirience of switching to 5.1 - please, in the comments). <br>  The most extreme, of course, have been testing <a href="http://dev.mysql.com/doc/refman/5.4/en/mysql-nutshell.html">5.4</a> for a long time, they say the performance is very well raised (not without the help of patches from Google and Percona, I think).  But before production 5.4 is still far away. <br><br><br><h4>  4.1.2 Transition to InnoDB </h4><br>  Tell me, if you use MyISAM, then <a href="http://www.mysqlperformanceblog.com/2009/01/12/should-you-move-from-myisam-to-innodb/">why</a> him?  I don‚Äôt understand how a production server can live on MyISAM (although they are said to exist), where there are no transactions (if the server drops during a large UPDATE, then half of the data will be changed, and half will not), there is a TABLE LOCK (during recording in the table is locked for reading and vice vresa), and REPAIR after a loss of electricity in the data center can take dozens of hours.  The only thing that saves MyISAM is the presence of Fulltext Index, but even it can hardly compete in quality and speed with sphinxsearch. <br><br><br>  Yes, InnoDB has its drawbacks (deadlocks, larger indexes, no FTS), but there are bonuses, IMHO, many times more: Firstly, InnoDB is completely <a href="http://ru.wikipedia.org/wiki/ACID">ACID-compatible</a> , which means any operation, even such as a dump of the base data, it can be made in one transaction (option <code>mysqldump --single-transaction</code> ), and secondly, it has row-level locking (against TABLE LOCK for myisam), which means that data can be simultaneously read <b>and written</b> in several flows without blocking each other. <br>  Again, people who are completely concerned about the performance of their startup heart can use <a href="http://www.percona.com/docs/wiki/percona-xtradb:start">XtraDB</a> , they say it helps a lot on I / O-bound workloads. <br><br><br><h4>  4.1.3 MySQL Internal Cache - Query Cache </h4><br>  Query Cache is one of the most misunderstood parts of MySQL.  Many people put it in 512Mb and think that ‚Äúeverything flies right now‚Äù, many people disconnect it altogether because ‚Äúit doesn't work vseravno‚Äù.  I will try to shed light on the value of this parameter.  To begin with, what's more, in this case, is not better, so you shouldn't be bullied.  Further, it is necessary to clarify that Query Cache is a completely non-parallel subsystem, so on the number of processors&gt; = 8 it is better to disable it, because it will only slow down.  And finally, but not the most useless - the essence of Query Cache is that its contents, which belong to any table, are <strong>completely reset when <em>any</em> change is made to this table itself</strong> .  That is, in fact, Query Cache gives a performance boost only on <em>well-</em> normalized tables. <br>  Read more about QC <a href="http://www.realcoding.net/articles/mysql-query-cache.html">here</a> . <br><br><br><h4>  4.1.4 Indices </h4><br>  As the absence of an index is detrimental to SELECT, so too many indices are detrimental to INSERT / UPDATE.  It often happens that the old, once made index can live in the database for more than one year, taking up precious memory and slowing down data changes.  A simple SQL <a href="http://pastebin.com/f6b1c381c">query</a> comes to the rescue.  Helpful?  Many similar tips can be found <a href="http://forge.mysql.com/tools/search.php%3Fsortby%3Drating%26sortorder%3Ddesc">here</a> . <br><br><br><br><h3>  <strong>4.2 PostgreSQL</strong> </h3><br>  For me, Postgres remains a rather strange system: on the one hand, it is an Enterprise class base and runs Skype on it, with a different default setting such that it can run even on my cell phone.  In general, it is necessary tyunit, and tyunit here you can almost everything.  Of the possible almost 200 parameters, <a href="http://www.pgcon.org/2008/schedule/attachments/45_guc_tutorial.pdf">45</a> are responsible for tuning the <a href="http://www.pgcon.org/2008/schedule/attachments/45_guc_tutorial.pdf">main ones</a> =) <br>  By the way, what else struck me was that when he memorized a line in the config, PostgreSQL does not reset it to ‚Äúdefault‚Äù, but uses the one that ‚Äúremembers‚Äù ... It seemed? <br>  By tuning Postgres in the internet, a lot of things (some of the manuals are outdated, so pay attention to the publication date and the keyword vacuum_mem, which has been replaced with maintenance_mem in new versions).  There is something like a FAQ: just <a href="http://postgresmen.ru/articles/view/38">about the main</a> thing, there are very <a href="http://momjian.us/main/presentations.html">profound treatises</a> for advanced database administrators ... I‚Äôll tell you only the basics that will help the project to stand on its feet while the admin with the programmer is looking for a qualified DBA. <br><br><br><h4>  4.2.1 Indices </h4><br>  Here some may have a fair question: why, they say, MySQL had indices in the last place, and PosgreSQL in the first place?  It's simple, because its capabilities in this regard are <a href="http://www.postgresql.org/docs/8.4/interactive/indexes.html">much higher</a> than those of MySQL.  B-tree, hash, GiST, GIN, as well as multicolumn, partial and indexes on expressions: a person who programs under PostgerSQL must understand this.  And not just to know that such exist, but to understand when it is necessary to use some types of indices, and in what others. <br>  Useful for monitoring SQL queries (including index statistics) can be found <a href="http://wiki.postgresqlrussia.org/index.php/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25B5%25D0%25B7%25D0%25BD%25D1%258B%25D0%25B5_%25D0%25B7%25D0%25B0%25D0%25BF%25D1%2580%25D0%25BE%25D1%2581%25D1%258B_%25D0%25B4%25D0%25BB%25D1%258F_PostgreSQL_DBA">here</a> . <br><br><br><h4>  4.2.2 pgBouncer and others. </h4><br>  <a href="https://developer.skype.com/SkypeGarage/DbProjects/PgBouncer">pgBouncer</a> (or its alternative) is the first thing that should be installed on the server with the database.  I have already seen enough of cacti-graphs showing the <em>tenfold</em> drop in load from the simple installation of the connection manager.  If you have not installed a connection puller, then a separate process is launched for each connection to the database, then this process eats up at least <code>work_mem </code> and begins to fight for the CPU and a hard disk with similar ones executing a SQL query.  Everything would be fine, but when the number of such processes exceeds 200-500, the server, even very powerful, becomes tight.  Very tight.  pgBouncer saves us from this. <br>  Also, a list of useful or even irreplaceable applications for working with PostgreSQL can be found on the <a href="http://wiki.postgresqlrussia.org/index.php/%25D0%259F%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D1%258B-%25D1%2581%25D0%25BF%25D1%2583%25D1%2582%25D0%25BD%25D0%25B8%25D0%25BA%25D0%25B8_PostgreSQL">postgresqlrussia.org</a> website. <br><br><br><h4>  4.2.3 pgFouine </h4><br>  <a href="http://pgfouine.projects.postgresql.org/">pgFouine</a> is just one of these indispensable programs.  This is a very advanced analogue of mysqlsla in php.  Included with <a href="https://area51.myyearbook.com/trac.cgi/wiki/Playr">Playr</a> (replayer production logs), it allows you to optimize requests for staging servers in almost ‚Äúcombat‚Äù conditions. <br><br><br><h3>  <strong>4.3 Database Unloading</strong> </h3><br>  As I already said, the best way to optimize the work of the database and increase its performance is to access it as little as possible. <br><br><br><h4>  4.3.1 SphinxQL </h4><br>  In the <a href="http://habrahabr.ru/blogs/server_side_optimization/52475/">last article</a> I said about the fact that we entered a search based on sphinxsearch.  But not everyone will be able to search through thousands of lines of code to start using SphinxAPI, and then spend another 1-2 iterations on testing and capturing bugs.  The problem was solved very elegantly: SphinxSearch learned to pretend to be MySQL server, that is, in order to start using it, you only need to create <code>sphinx.conf</code> , create entries for the indexer in cron and switch the search to another ‚Äúlike mysql‚Äù database.  There is a possibility that no further editing of the code is needed. <br>  What do you get when you go to the sphinx?  In addition to improving the speed and <em>quality of the</em> search, you can get rid of MyISAM and its FTS, well, and what is very interesting is to <em>come up with new applications for your search</em> , we have combined the search with RSS, which turned out to be very convenient. <br>  And here are a couple of examples in which you can benefit from the presence of sphinxsearch (invented almost on the move, so do not hit hard): <br><br><blockquote>  <strong>Example 1</strong> : I‚Äôve been waiting for Starcraft 2 for a long time, I can always add the following RSS feeds to Google Reader: rss.php? Q = "starcraft 2" and see all the messages that discuss it.  Also, I, as a forum member, want to see all posts where my nickname is mentioned.  This is also not a problem, you just need to correct the URL. <br></blockquote><br><blockquote>  <strong>Example 1.5</strong> : The user came to the site saw the search string, entered a query, nothing was found, but the link ‚ÄúSubscribe to this search‚Äù appeared, with a link to RSS for this query.  So just a user will not leave you =)) <br></blockquote><br><blockquote>  <strong>Example 2</strong> : I want to find movie 21, or, God forbid, movie 9 - MySQL is not suicidal, it simply throws such a request, complaining that <code>ft_min_word_len</code> longer than the length of the request.  The Sphinx will almost instantly return the result in the form of ‚ÄúTwenty One / 21‚Äù, and in the second case it will even give a choice between ‚ÄúDistrict No. 9 / District 9‚Äù and ‚ÄúNine / 9‚Äù. <br><br></blockquote><br><br><h4>  4.3.2 Non-RDBMS Storage </h4><br>  There are so many places in the project where you can not use a relational database.  A simple key-value repository.  The benefit of these <a href="http://www.metabrew.com/article/anti-rdbms-a-list-of-distributed-key-value-stores/">now enough</a> . <br>  There are also very interesting projects, such as <a href="http://hadoop.apache.org/hive/">Hive</a> (Data Warehouse with SQL-like QL and backend in the form of Hadoop).  In general, with the data storage, oh how to experiment, not just one Oracle (MySQL, PostgreSQL, FoxPro, underline) is alive. <br>  Also, the database key-value due to its speed is used to cache samples from relational databases.  Regarding caching itself: after scrolling through the presentation, watching the video and reading the full text of the report <a href="http://www.smira.ru/2008/10/08/highload-plus-plus-2008/">from the blog of Andrei Smirnov</a> , I have practically nothing to add.  Just a couple of tips: <br>  If you have a really big PHP project, do not forget about the possibility of opcode cache storing custom data.  You can store the most frequently used global variables in it: firstly, there are not many of them and they are small, so they will eat a little bit of memory, and secondly, the sampling speed will be higher than from memcached located on a neighboring machine.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And the most interesting thing: in large projects there were cases when a block of global variables was written to any one machine from memcached farm, since these variables use all the backends, then the traffic to this machine increased to indecent sizes and the machine started to slow down very much and with it all the backends. </font><font style="vertical-align: inherit;">The way out of this situation would be to either store global variables in the opcode cacher'e of the APC / eAccelerator type, or clone the variables to all servers from the memcached farm and add exceptions to the consistency hashing algorithm.</font></font><br><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.4 Encodings</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A small note about the encodings: </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">UTF-8 is good for all but one - the Russian text in it takes exactly twice as much space, so sometimes there is something to think about before using it if you have a completely single-language contingent.</font></font><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4.5 Asynchrony</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In fact, it is not always required synchronous data processing, quite often it can be replaced with asynchronous. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asynchronous processing helps 1) Improve the response time of the site / application 2) Reduce the load on the server. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If with the first everything is clear, then the second is a consequence of the fact that batch requests are executed faster than single ones. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Asynchrony can be organized in different ways. </font><font style="vertical-align: inherit;">In large projects, message queues are used for this ( </font></font><a href="http://activemq.apache.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApacheMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.rabbitmq.com/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RabbitMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.zeromq.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZeroMQ</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . About AQMP has been written several times on </font></font><a href="http://habrahabr.ru/blogs/webdev/62502/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Habr√©</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), in small ones you can do with cron.</font></font><br><br><br><h2> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Application. </font><font style="vertical-align: inherit;">Little things.</font></font></strong> </h2><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1. SSHGuard</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> or alternative.</font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Besides the fact that it is a standard practice to set anti-brute force for ssh, it also additionally helps protect the server from sudden bursts of Load Avarenge when it is attacked by completely stunned bots and begin to brute force login-pass pairs by the tens of thousands. </font></font><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2. xtrabackup</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">LVM snapshots are </font></font><a href="http://www.mysqlperformanceblog.com/2009/02/05/disaster-lvm-performance-in-snapshot-mode/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a brake</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . mysqldump locks tables and makes text backups that can be restored in weeks. </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A very good</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> backup tool for MySQL is </font></font><a href="https://launchpad.net/percona-xtrabackup"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Percona</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> xtrabackup. I will not paint him strongly, because the Russian part of the Internet has heard about him. In short, xtrabackup is a tool that allows you to perform non-blocking binary backup of InnoDB / XtraDB tables and has a </font></font><a href="http://www.percona.com/docs/wiki/percona-xtrabackup:xtrabackup_manual"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">bunch of settings</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . Why very good, and not great? As the best tool, in my opinion, are clones in ZFS. They are done instantly, and restoring the database from them is just changing the path to the files in the muscle config, and even if the restore fails, you can roll back. Also with clones you can</font></font><a href="http://wiki.opennet.ru/%25D0%2598%25D1%2581%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258C%25D0%25B7%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BA%25D0%25BB%25D0%25BE%25D0%25BD%25D0%25BE%25D0%25B2_%25D0%25B2_ZFS:_%25D0%259E%25D1%2582%25D0%25BA%25D0%25B0%25D1%2582_%25D1%2581%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D1%258B"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">restore the entire system</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , for example, in case of an unsuccessful kernel upgrade. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In general, it seems, in 5.4 we are promised an embedded online backup</font></font><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3. Transfer mail to another host</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This optimization seems to be minor, however, with a large number of spam flowing to the server, it helps to greatly reduce traffic and save many IOPs. </font></font><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4. Integration with third-party software</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Somehow on Habr√© I skipped an article about online games, they say, for everything you need to use the most appropriate means (does anyone remember how it was called?). So, for example, in order to enable users to exchange e-mails with attachments, you do not need to start writing a PHP script with backends in the form of a database / file system, you can use this, which in real life is used for text messaging - a bunch of smtp / imap and write to them a simple adapter. By analogy, chat for users can be organized on the basis of a jabber server with a javascript client that will not load the server at all. Need to mark objects on the map? It's easier to write a </font></font><a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D1%258D%25D1%2588%25D0%25B0%25D0%25BF_%2528%25D0%25B2%25D0%25B5%25D0%25B1%2529"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">mashup</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">using Yandex / Google maps. </font><font style="vertical-align: inherit;">What is interesting is that such systems, written on the basis of the adapter for ready-made products, often scale very well, at least, </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">orders of magnitude better</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> than PHP and MySQL solutions.</font></font><br><br><br><h3> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5. Monitoring</font></font></strong> </h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is nothing to optimize if you do not know the current state. </font><font style="vertical-align: inherit;">Performance metrics, delays, free resources, all this should be monitored, logged and, preferably, drawn on charts. </font><font style="vertical-align: inherit;">The benefit of the tools is enough: </font></font><a href="http://nagios.org/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nagios</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://ru.wikipedia.org/wiki/Zabbix"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Zabbix</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://habrahabr.ru/blogs/sysadm/66602/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cacti</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://habrahabr.ru/blogs/linux/30494/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Munin</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Take any, put on a server (s) and watch the influence of optimizations on the server load. </font><font style="vertical-align: inherit;">Monitoring will also help anticipate the occurrence of performance problems.</font></font><br><br><br><h2> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6. Cons optimization</font></font></strong> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Bleeding-edge, he, in fact, is not by chance so named. </font><font style="vertical-align: inherit;">When the club moved to a new server, we felt it the </font></font><a href="http://pecl.php.net/bugs/bug.php%3Fid%3D16833"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">hard</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> way </font><font style="vertical-align: inherit;">, having managed to find bugs in almost everything ( </font><a href="http://pecl.php.net/bugs/bug.php%3Fid%3D16833"><font style="vertical-align: inherit;">APC1</font></a><font style="vertical-align: inherit;"> , </font></font><a href="http://pecl.php.net/bugs/bug.php%3Fid%3D16814"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">APC2</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://bugs.mysql.com/bug.php%3Fid%3D46622"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MySQL</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="http://www.lexa.ru/nginx-ru/msg27256.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">nginx</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://sourceforge.net/projects/xbtt/forums/forum/328824/topic/3395068"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">xbtt</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ), </font><a href="https://sourceforge.net/projects/xbtt/forums/forum/328824/topic/3395068"><font style="vertical-align: inherit;">thanks to</font></a><font style="vertical-align: inherit;"> OpenSource, something simple can be fixed.</font></font><br><br><br><h2> <strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Instead of epilogue</font></font></strong> </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Well, sort of, that's all. </font><font style="vertical-align: inherit;">I printed it for almost a week ... I mastered it, I mastered it, behind the scenes I left ZFS, distributed filesystems, replication and sharding, because these are topics for individual posts. </font><font style="vertical-align: inherit;">With grammar and punctuation, everything is very bad for me, even though I, of course, checked everything several times in Word and </font></font><a href="http://quittance.ru/tautology.php"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">tautology</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , so if you find something, write to the </font></font><a href="http://savetherbtz.habrahabr.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PM</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , correct it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Criticism of the article is welcome, because if you find a jamb in a post, then, most likely, you found a jamb in one of my projects.</font></font></div><p>Source: <a href="https://habr.com/ru/post/70167/">https://habr.com/ru/post/70167/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70150/index.html">Revolution 2.0</a></li>
<li><a href="../70151/index.html">Work with databases in iPhone, SQLite and work with dates</a></li>
<li><a href="../70162/index.html">Rock # 1: First Album Compiled</a></li>
<li><a href="../70164/index.html">KO3: HMVC and Routing</a></li>
<li><a href="../70165/index.html">Majesty 2</a></li>
<li><a href="../70168/index.html">Testing Spring applications. Transactions in Testing</a></li>
<li><a href="../70169/index.html">Point Gray introduced the first USB 3.0 Webcam with support for FullHD video</a></li>
<li><a href="../70170/index.html">Habrarazu tell me ...</a></li>
<li><a href="../70171/index.html">iXBT is infected, according to Yandex</a></li>
<li><a href="../70173/index.html">Doctrine integration in kohana 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>