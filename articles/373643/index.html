<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raspberry Pi3 vs DragonBoard. We respond to criticism</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Author: Nikolai Khabarov, Embedded Expert DataArt, Evangelist for Smart Home Technologies. 

 The test results presented in the article on comparing t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raspberry Pi3 vs DragonBoard. We respond to criticism</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c3b/e37/c16/c3be37c1649e4f00843ab35e16d5d62f.jpg"><br>  <i>Author: Nikolai Khabarov, Embedded Expert DataArt, Evangelist for Smart Home Technologies.</i> <br><br>  The test results presented in the <a href="https://geektimes.ru/company/dataart/blog/290395/">article</a> on comparing the performance of the Raspberry Pi3 and DragonBoard boards when working with applications in Python raised doubts among some colleagues. <br><br>  In particular, the following comments appeared under the material: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>‚Äú... I did benchmarks between 32-bit ARMs, between 64-bit and between Intel x86_64 and all the numbers were comparable.</i>  <i>at least between 32 bit and 64 bit ARMs, the difference was tens of percent, and not many times.</i>  <i>well, or are you just different purely --cpu-max-prime indicated ".</i> <br><br>  <i>"Amazing results usually mean an experimental error."</i> <br><br>  <i>‚ÄúThere is a suspicion that there is some kind of error in the CPU test.</i>  <i>I personally tested different ARMs with sysbench, but there wasn‚Äôt a close 25 times difference.</i>  <i>In principle, good ARM media in the CPU test can be several times more efficient than the BCM2837, but not as much as 25 times.</i>  <i>I suspect that the test for pi was made in one thread, and for DragonBoard in 4 threads (4 cores). ‚Äù</i> <br><br>  This is the <b>cpu</b> test from the sysbench test suite.  The answer to these assumptions was so voluminous that I decided to publish it in a separate post, at the same time explaining why in some tasks the difference can be so enormous. <a name="habracut"></a><br><br>  To begin with, the commands with all the arguments for the test were listed in the table of the original article.  Of course, there is no argument for --cpu-max-prime or other arguments forcing you to use multiple processor cores.  In terms of the 10-20% difference, perhaps, there was a test of the overall system performance, which on real applications (not always, of course, but most likely) just shows 10-20% of the difference between 32-bit and 64 -bit modes of the same processor. <br><br>  In principle, it is possible to read how mathematical operations are implemented with a bit depth of a higher word width, for example, <a href="https://ru.wikipedia.org/wiki/%25D0%2594%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B0%25D1%2580%25D0%25B8%25D1%2584%25D0%25BC%25D0%25B5%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0">here</a> .  It makes no sense to rewrite algorithms.  Say, multiplication will take about 4 times more CPU cycles (three multiplications + addition operations).  Naturally, this value may vary from processor to processor and depending on compiler optimization. For example, for an ordinary x86 processor there may be no difference, since with the advent of the MMX instruction set, it became possible to use 64-bit registers and 64-bit calculations on 32-bit processor.  And with the advent of SSE, 128-bit registers appeared.  If the program is compiled using such instructions, then it can be performed even faster than 32-bit calculations, a difference of 10-20% or even more can be observed in the other direction, since the same MMX instruction set can perform several operations at the same time. <br><br>  But it‚Äôs still a synthetic test that explicitly uses 64-bit numbers (source codes are available <a href="">here</a> ), and since the package is taken from the official repository, it‚Äôs not a fact that all the possible optimizations were included when building the package (all because of compatibility with other ARM processors).  For example, ARM processors since v6 support SIMD, which, like MMX / SSE on x86, can work with 64-bit and 128-bit arithmetic.  We did not set out to squeeze as many ‚Äúparrots‚Äù out of the tests as possible, we are interested in the real state of affairs when installing applications out of the box, since we don‚Äôt want to reinstall half of the operating system. <br><br>  Still do not believe that even "out of the box" speed on the same processor can not differ tenfold depending on the processor mode? <br><br>  Well, let's take the same DragonBoard. <br><br><pre><code class="python hljs">sysbench --test=cpu run</code> </pre> <br>  This time with screenshots: <br><br><img src="https://habrastorage.org/web/32e/de2/762/32ede276269e40dc98f0ca14c8f294a0.png"><br><br>  12.4910 seconds.  Ok, now on the same board: <br><br><pre> <code class="python hljs">sudo dpkg --add-architecture armhf sudo apt update sudo apt install sysbench:armhf</code> </pre> <br>  With these teams, we installed the 32-bit version of the sysbench package on the same DragonBoard board. <br><br>  And again: <br><br><pre> <code class="python hljs">sysbench --test=cpu run</code> </pre> <br>  And here is a screenshot of it (apt install output is visible at the top): <br><br><img src="https://habrastorage.org/web/560/548/491/560548491e514712964ea22bc8918dfe.png"><br><br>  156.4920 seconds.  The difference is more than 10 times.  Since we are talking about such cases, let's see in more detail why.  Let's write just such a simple program in C: <br><br><pre> <code class="hljs kotlin">#include &lt;stdint.h&gt; #include &lt;stdio.h&gt; int main(int argc, char **argv) { <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint64_t a = <span class="hljs-number"><span class="hljs-number">0x123</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint64_t b = <span class="hljs-number"><span class="hljs-number">0x456</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint64_t c = a * b; printf(<span class="hljs-string"><span class="hljs-string">"%lu\n"</span></span>, c); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <br>  We use the volatile keyword so that the compiler does not count everything in advance, namely, it would assign variables and honestly multiply two arbitrary 64-bit numbers.  Let's build a program for both architectures: <br><br><pre> <code class="hljs swift">arm-linux-gnueabihf-gcc -<span class="hljs-type"><span class="hljs-type">O2</span></span> -g main.<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> -o main-armhf aarch64-linux-gnu-gcc -<span class="hljs-type"><span class="hljs-type">O2</span></span> -g main.<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> -o main-arm64</code> </pre> <br>  And now let's look at the arm64 disassembler: <br><br><pre> <code class="hljs ruby">$ aarch64-linux-gnu-objdump -d main-arm64</code> </pre> <br><img src="https://habrastorage.org/web/991/e7f/b0c/991e7fb0cac64c188d7942e29a48ebf4.png"><br><br>  The instruction mul is quite predictably used.  And now for armhf: <br><br><pre> <code class="hljs ruby">$ arm-linux-gnueabihf-objdump -d main-armhf</code> </pre> <br><img src="https://habrastorage.org/web/2ee/e97/a76/2eee97a76bf44be0b9789c33d0aeb495.png"><br><br>  As you can see, the compiler has applied one of the methods of long arithmetic.  And as a result, we are witnessing a whole footwoman that uses quite heavyweight instructions like mul, mla, umull.  Hence the multiple performance differences. <br><br>  Yes, you can still try to compile, including some set of instructions, but then we may lose compatibility with some processor.  Again, again, we were interested in the real speed of the entire board with real binary packages.  We hope this rationale, why such a difference was obtained on a particular <b>cpu</b> test, is enough.  And you will not be confused by such gaps in some tests and, possibly, some application programs. </div><p>Source: <a href="https://habr.com/ru/post/373643/">https://habr.com/ru/post/373643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../373631/index.html">Harvard recorded animation in the DNA of a living organism</a></li>
<li><a href="../373633/index.html">How Californian alone won the space robotics competition from NASA</a></li>
<li><a href="../373635/index.html">Unexpected meeting. Chapter 11</a></li>
<li><a href="../373637/index.html">NASA has no money for landing people on Mars</a></li>
<li><a href="../373639/index.html">Google is looking for ideas to build human-readable artificial intelligence applications.</a></li>
<li><a href="../373645/index.html">Quite another tomorrow (story)</a></li>
<li><a href="../373647/index.html">Interview with Half-Life Writer Mark Laidlow</a></li>
<li><a href="../373649/index.html">Overview of universal robot robots</a></li>
<li><a href="../373653/index.html">Proteins synthesized from carbon dioxide and electricity</a></li>
<li><a href="../373655/index.html">Review of Psion Organizer II XP with internals and Tetris</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>