<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Your A / B tests are broken.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After you check that the functionality is implemented normally, it rolls out into the experiment to find out if the users like the new version. 

 Hav...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Your A / B tests are broken.</h1><div class="post__text post__text-html js-mediator-article">  After you check that the functionality is implemented normally, it rolls out into the experiment to find out if the users like the new version. <br><br>  Have you noticed that usually people who are responsible for experiments, as a result, say that there is not enough data to solve?  Often this is true, but often it‚Äôs all a matter of breakdowns in the system of experiments and accounting of user statistics. <br><br>  In this article we will look at typical breakdowns that occur there, and you will have the opportunity, returning to the workplace, to be a little data scientists and find errors in your company.  Some of them are probably there. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The material is based on the transcript of the <a href="http://2017.heisenbug-moscow.ru/talks/2017/msk/g6ie0nvjae06wge04iayk/">report of Roman Poborechy</a> from our December conference Heisenbug 2017 Moscow. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/sxBE3XMsQCw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  A few years ago I worked at Yandex, where I worked, in particular, on user behavior metrics and user experiments;  Most of my experience on this topic comes from there. <br><br>  First, let us recall an example from the history: 2007, a button on the Microsoft Office page: what will happen if you make a slightly different button, but next to write a price - maybe they will click more there?  Zadizaynili this page: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/08e/320/11d/08e32011d88a80a5040ff178f4782eb0.png"><br><br>  And it‚Äôs scary: Office is a rather expensive product, it brings a lot of money, and you want to do it so carefully that you don‚Äôt lose this money at once.  Split tests (A / B tests) are carried out: when we select a group of users and show them the new version, and another group the old one, then we compare the results.  In our example about Microsoft Office - do you think it is more or less clicked in the new version?  In the new version, the ‚ÄúBuy‚Äù button was clicked less.  Hence the first message - error number 0. <br><br><h1>  Error number 0: if you don‚Äôt have A / B tests at all and immediately roll everything into production, you can roll out something that you can later regret </h1><br>  Do you have an A / B testing system in your company?  Cool, but it is probably broken in several typical ways, which we will now disassemble.  How you can use this material: you can come to your job, talk to people who use the A / B test system, ask some simple questions and point out mistakes.  Or, if you ever have to test such a system, then you will know these few typical tests. <br><br>  People who do not do such tests usually say: ‚ÄúWhat can be so complicated here?‚Äù It is necessary (1) to divide users into groups, then (2) each user should show something of their own, then (3) calculate the results and see who is better - in roll production.  To this I want to say: the world is very simple, it stands on three elephants, at the top of Sagarmathi (Russian Everest) Shiva sits, there are commandments, and it is clear to everyone what to do. <br><br><img src="https://habrastorage.org/webt/yo/bu/qq/yobuqq1nny3zbz-vfzzodcxz65s.png"><br><br>  In fact, in each of the three points you can nakosyachit.  Today we will talk about the last of them: counting the results. <br><br>  For example, imagine that there is an online store, and we want to conduct an experiment.  A naive idea: we take Time (for convenience), ( <i>y</i> ) along the axis ( <i>x</i> ) - a check (that is, what people bought in the end), and we will have option A and option B - below the graph shows that option B it is better. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/00f/1b8/708/00f1b8708bcbfafc9ee89ed007b3a339.png"><br><br>  In reality, everything is different.  Take a product that is interesting to everyone, regardless of the budget (for example, food), and imagine that there are two clients: rich and poorer.  Suppose that the version presented in group B is better than in A. Consumption in A and B for these two users is different, the following is important: the rich, coming to the ‚Äúbad‚Äù group, will bring much more money than the second client, who I bought a version from a ‚Äúgood‚Äù group (except for the absolutely terrible cases, when in both versions something is broken so much that nothing works at all).  A person depends much more on his own habits than on some minimal changes on our service.  Therefore, unfortunately, the picture is as follows - it is difficult to determine which of the options is better / worse, even comparing the average value: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/532/b3c/080/532b3c0804170d205106365cdd6fd256.png"><br><br>  The fact is that there are not so many people who came to us during the experiment.  Our task is to determine by these users what will be better or worse for all.  The classic problem of statistics: we can not see the full set, we are trying to make a forecast for a small sample.  It turns out that the world is much more complex than we assume. <br><br>  (I‚Äôll note that I will refer to the statistics in the future, but I will try to explain everything on my fingers so that people with different experiences can easily keep track of what is happening; in-depth knowledge of statistics is not required) <br><br>  So, in order to determine from a small sample whether there is a difference on a large set, we use statistical tests (criteria).  This is a function to which we transfer data, and we get a result in response.  We usually transfer all the data that is (not only the average, but the entire array of data from which this average value was taken);  answers are given in terms of probability (for example, there is a difference with the probability of XX%).  Usually people stop at 95% or more;  if less than 95%, then it is considered that there is no difference, and the results of the experiment are not recognized. <br><br>  It is important that the tests are developed in such a way that when there is certainly no difference, they are mistaken with this probability, otherwise they cannot be calibrated.  For example, we will carry out an A / A test - we will launch two completely identical results both in the experimental and control groups of users.  If we work with a significance of 95%, the result is interpreted as follows: if the result is within 95%, there is no difference;  the remaining 5% - there is a difference. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f9/645/bc7/9f9645bc758064441138bd23f8cffab5.png"><br><br>  The result of 5% seems small, but it is important.  To understand why, let's look at the Google conflict story when Doug Bowman was the Chief Designer, and Marissa <i>Mayer</i> was in charge of the company's products. <br><br><img src="https://habrastorage.org/webt/2f/le/z3/2flez3uaogu0k04q2y3zhq-cjn8.png"><br><br>  <i>Doug Bowman, Marissa Mayer</i> <br><br>  What happened: there is Google Mail, there are sponsored links.  There was an interesting task: let's make a slightly different color of links, and they will click more on them.  (Has anyone clicked on an advertisement in the mail at least once? I didn‚Äôt click either. Apparently, the guys still have a problem and need to do something) Marissa: "Let's try forty-one shades of blue."  Doug: "Everything, I refuse to take part in this outrage."  And he quit, rather because of design considerations, rather than mathematical ones, although mathematically he was also somewhat right.  Let's see what happens if you do forty-one tests.  What is the probability that the test will never fail (it will give an honest result - if there really is no difference, then the result will show it): <br><br><ol><li>  if we conduct only one experiment with two shades of blue, then the probability of 0.95 will show that there is no difference, everything is ok; <br></li><li>  if two experiments - the probabilities are multiplied, too, everything is ok. <br></li></ol><br>  And so on.  When we conduct forty-one experiments, the probabilities multiply again, and the probability that the test never fails 41 times is only 0.12, i.e.  with 88% probability, at least one ‚Äúshoots‚Äù and says ‚Äúyes, there is a difference, this shade of blue is cool!‚Äù, when in fact it is not true. <br><br><img src="https://habrastorage.org/webt/cv/k1/st/cvk1st2wrriumo11zkebpi0wdha.png"><br><br><h1>  Error number 1: to sort the parameters by users </h1><br>  In this regard, go to error number 1 (Recall: No. 0 - do not have A / B tests at all and immediately roll everything into production): sort through the parameters of the hands of users.  That is, instead of investigating and inventing the hypothesis ‚Äúwhat will be better and what is worse,‚Äù everything is sent to the experiment in the hope that something from this will ‚Äúshoot‚Äù (without thinking that any of this can ‚ÄúShoot‚Äù by chance). <br><br><img src="https://habrastorage.org/webt/rb/tr/th/rbtrth50mc8cvp7ezs3fw1ss6gs.png"><br><br>  Google is big, it has a lot of data, it can be considered more likely (95% vs. 99% and 99.9%).  So, theoretically, it is possible to conduct 41 experiments: if not one ‚Äúshoots‚Äù, then everything is likely to be normal.  Who is right, Marris or Doug?  In the case of conventional services that do not have billions of users, it is wasteful to conduct many experiments with a probability of 99.9%.  What does the criterion answer depend on?  From a few things. <br><br>  First, the scatter of data.  The better they are grouped around (see Fig. A), for example, their average, the more confident the test will be to say that one version has a better difference than the other.  Otherwise (Fig. <i>B)</i> ), more data is required to get the same degree of confidence. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d4/1fa/4ca/7d41fa4ca55f0a33f4c83e4e7a530099.png"><br><br>  <i>Fig.</i>  <i>but)</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a75/4bb/2e7/a754bb2e777261d7f7aa64b48b2b86d3.png"><br><br>  <i>Fig.</i>  <i>b)</i> <br><br>  There is a spread of data.  Most likely, we cannot influence it, because it depends on our users, the structure of our service, and we cannot do anything about it quickly.  Secondly, the response of the criterion depends on the difference we want to detect.  If we have done something very good (or bad, it is made easier and, therefore, more often) - the difference is big, and existing users will, on average, generate this big difference.  Then we need a smaller amount of data, but nevertheless, the last parameter is the amount of data that we send to the criterion.  Obviously, we can regulate the difference in the quality of our work (better work - more difference :)).  The amount of data is governed by how many users we throw into the experiment, and it is limited to 100% (ie, 50% is the control group, 50% is the experiment).  I note that sometimes it is possible to keep the experiment longer - not a day / week, but a month - then more data will accumulate (but this does not work for all metrics).  There is a dependency between the difference we see and the amount of data we need to do this - this is a fundamental law, regardless of what statistical criterion we use. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dd7/c0c/994/dd7c0c994c22437b9b9de8a1488a53ad.png"><br><br>  For example, if the <i>delta</i> is two times less than in the first case, then in order to notice it with the same degree of confidence, we need four times more data (since the square root).  What is bad?  The simplest things (payment buttons, recommendations, etc.) we, as a startup of 2-3 people, manage to do quickly.  Then the service becomes relatively stable, and it‚Äôs difficult to make powerful changes there, and besides, we continue to grow, many developers appear (everyone generates something, wants to send something to the experiment), and at a pace when we have a square, We very quickly end an important resource - users.  Everything is crammed with experiments in our country, sometimes we put them in several layers, and still the line of people who want to launch something into the experiment stretches right up to the horizon.  This is the first thing to be understood.  The second thing is illustrated by the following example. <br><br><h1>  The challenge of a rare disease </h1><br><br>  If you ever retrain in a <i>data scientist</i> , then know that this task is set at the first interview.  Let us analyze it graphically (there will be no more formulas).  Suppose there is a dangerous disease;  0.5% of people are sick with it (according to statistics);  there is a test that determines this disease with an accuracy of 95% (in both directions, with a probability of 95%, it gives the correct result and 5% gives the wrong result; it does not matter whether the person is healthy or sick).  Consider the option: the test is positive, is it necessary to be sad?  We decide graphically: each cell is a person, of which about 0.5% is sick (a dark red cell, we group them for convenience). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a5/def/619/5a5def6196ae5f6adf697504302b3324.png"><br><br>  Important: the test that we run on them can sometimes be statistically wrong.  This situation was a long time with tests for AIDS: they worked with such accuracy that the percentage of patients was much less than the percentage of errors, and therefore it was necessary to carry out the test several times to be sure (very often a positive result for the first time was an error). <br><br>  Let's return to our experiment about ‚Äúshades of blue‚Äù.  Some say, "Let's test forty-one shades of blue."  The product owner picks up: "They told me here that rounded buttons are better than square ones, let's test them."  One more: ‚ÄúLet's play with fonts‚Äù.  And the worst of what I have seen is what they do with recommender systems. <br><br><img src="https://habrastorage.org/webt/xm/gf/kk/xmgfkk-rtpqogzp3pmmlnhpx0f4.png"><br><br>  We have content, and we additionally recommend something else (for example, to watch a product / video, etc.), usually it is based on machine learning (this is a random process).  People come and say: ‚ÄúLet's run a few times.  Let's put a different seed on this random process and see if it comes together in different ways, and one of these options suddenly turns out to be better than the rest. ‚Äù  And so forty-one times ("shades of blue").  If we have many such experiments, then we understand that among them, if there will be, there are very few really successful ones;  most will be about the same.  Then we will come to a situation where the number of randomly tested tests is approximately equal (if not more) to the number of ‚Äúreally good‚Äù.  And we still do not notice all of them: for example, if the test is good, but the difference is small, then we can say that there is no difference.  What is worth doing?  We always know from the construction of the test how many random alarms are there (if 95%, then 5% should be random);  You can go and find out from employees what percentage is completed with success / failure, effectively.  If they say that only 10% (and we know that 5% is random), then we conclude: half of what is being rolled into production is random trash. <br><br><h1>  Mistake number 2: conduct too many (bad) experiments </h1><br><br>  It is better to conduct an experiment based on the results of your research, formed from third-party sources, the hypothesis that is better for users.  For example, once in Yandex, we tested a hypothesis about search results, about so-called ‚Äústupid answers‚Äù ‚Äã‚Äã(the query is ‚Äú <i>Leo Tolstoy</i> ‚Äù, one of the search results is ‚Äú <i>colon cancer</i> ‚Äù).  Invented a method by which you can separate and hide such "stupid answers."  The result was discouraging: users are not better from this, but this is the subject of a separate discussion. <br><br>  Let's go back to the example with the button and the specified price for Microsoft Office.  I have a hypothesis: the company is big, there is a lot of money (financial indicators can be hidden, inaccessible for the experiment, that is, you can look at the statistics of clicks, but don‚Äôt know how much money it brings).  Having received the first negative result, they did not stop at this experiment. <br><br>  I want to warn you: when I had a bad experiment (I did, I tried, I rolled out - they say that the users didn‚Äôt like it), I start looking for bugs (including in the experiment system) as a <i>feature owner</i> , until I I am rehabilitating my idea or until I come to the conclusion that "there really is no ore there."  So, in the opposite direction it does not work that way: I did something, and from the first time it shows a profit (‚ÄúHurray! In production, sold!‚Äù) - I am not looking for these bugs / errors that may be there.  There is some bias in it. <br><br>  Microsoft didn‚Äôt calm down either: they found that they click on the button with the specified cost less, but there is a more complicated process behind it (insert a card, etc.) and buy more;  it turned out that the cumulative amount of money it brings made a difference of several tens of millions of dollars.  From here follows another important point: you need to choose which indicator to look at. <br><br>  Indicators in the experiment can be many, you must choose the right one.  It would seem that you only have to look at the money, is it logical?  It depends on the monetization model: ‚Äú <i>direct</i> ‚Äù (users come with money and get something for it, for example, an online store, stock) or ‚Äú <i>indirect</i> ‚Äù.  When indirect monetization occurs, the following happens: users come for some shareware content, and while they are watching this shareware content, we catch some of them, drag them into a dark basement, disassemble them into organs, sell organs.  According to this model, search engines, entertainment portals, social networks work, that's all.  The more advertising, the more money you can get in the moment, but at the same time users can stop visiting such sites - short-term money <i>vs.</i>  long-term money: reduced food supply, and everything becomes bad.  What happens with LiveJournal / LiveJournal: the service is dying, let's hang up more advertising to make up for the loss of money, but from this the service dies even faster.  There are also "working" sites: there are employers who pay for the database, advertising, and there are job seekers who work for free.  And to applicants to keep them, you need one thing, and employers - something else. <br><br>  In general, difficult life for those who have an indirect model of monetization - what should they look at, only for money?  Of course, the money should not be squandered, but you can‚Äôt just maximize them, because now we will get rich, and then everything will end.  At this point, we notice that the world is rather complicated - we have to somehow measure the user base.  For example, there are such indicators to measure: <br><br><ul><li>  <i>churn rate</i> (conditionally: there were some users, and then we notice that they stop coming - you can track with the help of mathematics, who was, and then disappeared); <br></li><li>  user loyalty in different versions;  time of absence of the user (if the user used to come to our service often, then began to come rarely). <br></li></ul><br><br>  There are other indicators.  The problem with the immediate metrics of the user base (if you exaggerate the situation) - they never change.  Of course, you can make such a change that you will immediately see that user loyalty has increased, but it is difficult. <br><br><h2>  Dependent and independent measurements </h2><br><br>  So we come to <i>technical metrics</i> - something that can be easily calculated.  For example, clicks (users began to click more, which is probably good).  Nothing worth dragging clicks from one place to another on the page;  <i>click-through-rate</i> (aka CTR) - showing the button / form;  there are cases where the user has seen, but did not interact with it, but there is, when interacted.  This is the percentage of cases when people saw an element (for example, a button) and began to do something with it.  If we are talking about video and recommendations, there is such a good indicator as <i>to the depth (percentage) of viewing</i> , i.e.  if the video takes 2 minutes, and the user watched 1.5 minutes, then the viewing depth is 75% (if you‚Äôve watched it to the end - 100%);  time to click (strongly depends on whether we make large or small snippets) and others.  Most of these metrics stumble upon such a terrible thing called the <i>Central Limit Theorem</i> (CLT).  I will not formulate it, only one point is important for us, which everyone has forgotten about.  Most of the statistical criteria are based on the <i>CLT;</i> they assume that its conditions are correct.  One of the conditions is as follows: the measurements that we put in the data array must be independent of each other.  What does it mean?  In order to demonstrate dependence and independence, now in practice, find out what it is, on volunteers :) <br><br>  We will measure the distribution of eye color: according to 1909, most people in Russia at that time had gray eyes, the second most common color was brown, then blue, blue, green and black.  By the way, there are people with an exotic eye color, for example, ‚Äúswamp‚Äù, but they will not include our example.  We put in front of an audience of two volunteers, Stas and Philip.  We place bets on what color of their eyes.  We assume that the gain is equal to the frequency.  We find out - Stas has gray eyes (the statistics do not lie!).  And Philip?  Also gray.  After we learned what color Stas' eyes were, did we want to somehow change our rate relative to the color of Philip's eyes?  Probably not, because what's the difference?  Actually, this is an example of independent measurements. <br><br>  Suppose there are 2 girls, twin sisters, nonidentical. <br><br><img src="https://habrastorage.org/webt/bq/yu/2h/bqyu2hm21hdkiz9yylkvu317my4.png"><br><br>  Let's make a bet, who has what color eyes.  Made? <br><br>  Now the trick: let's color the first girl. <br><br><img src="https://habrastorage.org/webt/bs/5y/m8/bs5ym8pzadrlxo07nkpt23rvaac.png"><br><br>  In one, as we see, blue.  The question is, do we now want to change our bet regarding the color of the eyes of the second girl?  It would be desirable - in the second girl, the color of the eyes is also likely blue. <br><br>  And as we can see, this is the case. <br><br><img src="https://habrastorage.org/webt/nw/tn/fy/nwtnfyoswrccmoz-4dre0z1nqqi.png"><br><br>  This is an example of dependent measurements - when our predictions, our best hypothesis about the result changes depending on whether we know the result of some other measurement.  How does all this happen in the web, in search, in life? <br><br>  All user actions are actually twins, because they have a common ‚Äúancestor‚Äù - the user.  All user actions are somehow related to each other, because they are based on the habits of this user, his behavior on our service.  Moreover, often all these actions are not individual, but are associated with a single task.  For example, imagine: the search query ‚Äú <i>Kalashnikov assault rifle buy</i> ‚Äù - the user looked, poked, did not like him;  changing the query ‚Äú <i>a real Kalashnikov automatic buy</i> ‚Äù - again I don‚Äôt like it;  tries ‚Äúthe <i>Kalashnikov assault rifle doesn't buy</i> ‚Äù (here we understand that the user is not very experienced, because the search results, on the contrary, will contain the word ‚Äú <i>make-up</i> ‚Äù).  Realizing this, the user leaves for a while and returns later with a new request, which he really cares about: <br><br><img src="https://habrastorage.org/webt/rt/3e/rz/rt3erzgauuz3xjz79b73nwvymfi.png"><br><br>  These requests are somehow dependent on each other, if the user received normal (in his understanding) results for the first two requests, then it wouldn‚Äôt come to a request to ‚Äúhire a killer‚Äù.  How does this work in reality?  Here are some examples. <br><br><h1>  Error number 3: do not consider the dependence of user actions </h1><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7b8/d9d/886/7b8d9d88668533a783c467b8b1634464.png"><br><br>  There is click-through-rate, data array A and B (see figure), dependent data groups, where ' <i>1</i> ' are cases when the user <i>interacted</i> with interface elements (for example, a button, a form), ' <i>0</i> ' <i>did not interact</i> .  It would seem that the criterion does not know anything about them, but it breaks down, it‚Äôs magic.  The next example is purchases from an online store, arrays A and B contain information about checks of purchases made.  The user Roman (this, by the way, I) bought his wife a tablet with a cover in the kit - when she received the order, it turned out that the case was completely bad, it was impossible to use, the tablet fell out.  And Roman goes and buys a separate case, more suitable for this tablet.  These actions are also dependent on each other, not by accident.  Thus, we come to <i>error number 3</i> - <i>do not take into account the dependence of the user's actions.</i>  What is the problem: if the actions in the metric are dependent, then we have a test, it works with a significance of 95%, but in fact in the A / A test, most likely, the test will be wrong not 5%, but more often.  In my practice, I have even met 20%, the company conducted the <i>nth</i> number of experiments, and 20% of these experiments, regardless of what their true result is, give some random significant result.  It's terrible, it's a business decision, you feel?  You can't do that. <br><br>  What can you do about it?  Let's start by checking this out.  Often, when you read articles about A / B testing, you meet ‚Äúwhen you have captured the system for yourself, conduct at least one A / A experiment, and it is necessary that it does not show a‚Äú meaningful result ‚Äù.  20% is still a breakdown.  How many times do I need to conduct an A / A test to test well?  Let's discuss.  For example, if you spend it 100 times, how many of these hundred things will we shoot there ‚Äù(in a normal situation)?  5, maybe 4, maybe 6, which is normal, these are statistics.  If never - is this normal?  Look, as in the example with Google and Marissa Mayer - if there are 41 experiments, then ‚Äúnever‚Äù of them is a probability of 12%, if 100 times, then 0.95 to the 100th power, which is a rather small number. <br><br><h1>  Error number 4: do not save the logs of experiments with the possibility of recalculation </h1><br><br>  How to spend a million A / A tests?  We do not have enough time or users.  There is a " <i>synthetic A / A test</i> " technique.  Suppose we have one real A / A test, we conducted it - in each group we got at least several thousand users.  What we can do is upload to offline and repartition again into groups, and then divide again. <br><br><img src="https://habrastorage.org/webt/pa/dr/--/padr--rrebcuykfbn2shyvqoeik.png"><br><br>  Thus, we can accumulate hundreds of thousands of experiments from a single A / A test (if we have at least several thousand users).  Of course, we can not check everything in this way - we can check only errors in calculations, in statistics.  We cannot verify that in our production, users somehow incorrectly split (which sometimes happens; for example, they have incorrectly calculated the hash function), or we did not notice that the ‚Äúproduction‚Äù version is spinning on one cluster, ‚Äúexperiments‚Äù - on the other, and there is a different performance iron (someone is faster, and, accordingly, users are better).  We may not notice something, but we can see some problems with mathematics.  Important error number 4: do not save the logs of experiments with the possibility of recalculation.  Those.  conduct an experiment and return to this data, calculate it differently, cannot fix the metric - this is ‚Äúa shot in the leg‚Äù).  What to do with the situation when you noticed a dependency in your metric?  There are two methods of struggle: <br><br><ol><li>         (per user)   (    ,      ,     ,    ). </li><li>   ,   ,    .       (      Python  ),      ,   . </li></ol><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We remember that we need the number of users in a square from the size of the delta (the delta decreases, the service grows, we have a lot of developers with ideas, there are not enough users). </font><font style="vertical-align: inherit;">An attempt to generate more data from the same data by adding dependent data failed. </font><font style="vertical-align: inherit;">We do not have enough users, what are we going to do? </font><font style="vertical-align: inherit;">Roll out gradually. </font><font style="vertical-align: inherit;">We have many experiments, we will roll them each into a small group of users. </font><font style="vertical-align: inherit;">Here is the delta on</font></font><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mn>1</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>/</mo></mrow><msqrt><mi>n</mi></msqrt></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.656ex" height="2.901ex" viewBox="0 -883.9 2435 1249" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/jugru/blog/358104/&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhibcMrWKZADxcjGMCyYhLfUYRgPtg#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/jugru/blog/358104/&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhibcMrWKZADxcjGMCyYhLfUYRgPtg#MJMAIN-2F" x="500" y="0"></use><g transform="translate(1001,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/jugru/blog/358104/&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhibcMrWKZADxcjGMCyYhLfUYRgPtg#MJMAIN-221A" x="0" y="-63"></use><rect stroke="none" width="600" height="60" x="833" y="678"></rect><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/jugru/blog/358104/&amp;xid=17259,15700002,15700022,15700186,15700190,15700248,15700253&amp;usg=ALkJrhibcMrWKZADxcjGMCyYhLfUYRgPtg#MJMATHI-6E" x="833" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><msqrt><mi>n</mi></msqrt></math></span></span><script type="math/tex" id="MathJax-Element-1">1/\sqrt{n} </script><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it works in our favor - if we did something bad, the delta is big and negative, then we need few users to notice it. If we have deteriorated everything 10 times, we will notice it by 100 times fewer users. At 1% roll out a lot of experiments, those of them that are obviously bad, weed out, and the rest have already been rolled out to more users and see what happens. Use "multi-armed bandits." This is a term from machine learning, in experiments it is so arranged: a thing that continuously recalculates the current indicator of the experiment - if the experiment is promising (everything seems to be good, although the significance level has not yet been reached), then it starts pouring more traffic into this experiment. dynamically changes which experiments pour more traffic, which ones less. Respectively,A promising experiment is tested faster - either it turns out to be successful, or it loses its perspective (however, in general, we get more profit). These approaches have a common problem - let's consider it on a simplified example with the admission of applicants to the University of Berkeley'1975: it suddenly turned out that about 50% of applicants passed from the enrolled boys, and 40% girls (while students from different gender groups were approximately equal quantity). The girls began to resent being oppressed, they say, discrimination. The scandal forced the university management to understand what was going on. How to understand? It was decided to break down the faculties.These approaches have a common problem - let's consider it on a simplified example with the admission of applicants to the University of Berkeley'1975: it suddenly turned out that about 50% of applicants passed from the enrolled boys, and 40% girls (while students from different gender groups were approximately equal quantity). The girls began to resent being oppressed, they say, discrimination. The scandal forced the university management to understand what was going on. How to understand? It was decided to break down the faculties.These approaches have a common problem - let's consider it on a simplified example with the admission of applicants to the University of Berkeley'1975: it suddenly turned out that about 50% of applicants passed from the enrolled boys, and 40% girls (while students from different gender groups were approximately equal quantity). The girls began to resent being oppressed, they say, discrimination. The scandal forced the university management to understand what was going on. How to understand? It was decided to break down the faculties.The scandal forced the university management to understand what was going on. How to understand? It was decided to break down the faculties.The scandal forced the university management to understand what was going on. How to understand? It was decided to break down the faculties.</font></font><br><br><table><tbody><tr><td rowspan="2">  Faculty <br></td><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Girls </font></font><br></td><td colspan="3"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The boys </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> did </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> have passed </font></font><br></td><td>  % <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> did </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> have passed </font></font><br></td><td>  % <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> mat-fur </font></font><br></td><td>  46 <br></td><td>  39 <br></td><td>  85 <br></td><td>  320 <br></td><td>  211 <br></td><td>  66 <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conclusion </font></font><br></td><td colspan="6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> girls do not seem to be oppressed </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Physical Department </font></font><br></td><td>  31 <br></td><td>  28 <br></td><td>  90 <br></td><td>  294 <br></td><td>  232 <br></td><td>  79 <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conclusion </font></font><br></td><td colspan="6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> girls do not seem to be oppressed </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> legal </font></font><br></td><td>  405 <br></td><td>  141 <br></td><td>  35 <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 438 </font></font><br></td><td>  139 <br></td><td>  32 <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conclusion </font></font><br></td><td colspan="6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> girls do not seem to be oppressed </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> filfak </font></font><br></td><td>  614 <br></td><td>  233 <br></td><td>  38 <br></td><td>  50 <br></td><td>  7 <br></td><td>  14 <br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conclusion </font></font><br></td><td colspan="6"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> girls do not seem to be oppressed </font></font><br></td></tr><tr><td>  Total <br></td><td>  1096 <br></td><td>  441 <br></td><td>  40 <br></td><td>  1102 <br></td><td>  589 <br></td><td>  53 <br></td></tr></tbody></table><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(This situation would not be possible if there were an equal number of girls and boys among the applicants of each faculty)</font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Judging by the percentage of admitted girls, at each of the faculties (the names of the faculties are changed for simplicity) they do not seem to be oppressed. </font><font style="vertical-align: inherit;">This situation would be impossible if there were an equal number of girls and boys among the applicants in each department. </font><font style="vertical-align: inherit;">Here, a lot of girls enter the philfak and many of them do not pass, the amount in columns turns out to be disproportionate. </font><font style="vertical-align: inherit;">This statistical paradox is named after the British scientist </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edward Simpson.</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">How does this happen with experiments? </font><font style="vertical-align: inherit;">Suppose we have Friday, Saturday, options A and B. Friday - roll 1%, according to science (if users see something very bad, then they are very afraid, start to run away, swear, remember for a long time). </font><font style="vertical-align: inherit;">Saturday - roll out 50/50. </font><font style="vertical-align: inherit;">For example, in online trading, conversions are highly dependent on the day of the week and may differ by 2 times between Friday and Saturday.</font></font><br><br><table><tbody><tr><td></td><td></td><td>  Friday <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Saturday </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Total </font></font><br></td></tr><tr><td rowspan="3">  BUT <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> users </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 990000 </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 500,000 </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1490000 </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conversions </font></font><br></td><td>  20,000 <br></td><td>  5000 <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 25,000 </font></font><br></td></tr><tr><td>  % <br></td><td>  2.02 <br></td><td>  1.00 <br></td><td>  1.68 <br></td></tr><tr><td rowspan="3">  AT <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> users </font></font><br></td><td>  10,000 <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 500,000 </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 510000 </font></font><br></td></tr><tr><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conversions </font></font><br></td><td>  230 <br></td><td>  6000 <br></td><td>  6230 <br></td></tr><tr><td>  % <br></td><td>  2.30 <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 1.20 </font></font><br></td><td>  1.22 <br></td></tr></tbody></table><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On each specific day, option B wins in terms of conversion. If we begin to summarize it all - the sum suddenly wins by option A. We caught this </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">paradox of E. Simpson</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (if you work with ‚Äúmulti-armed gangsters‚Äù, then this is also possible, therefore act carefully). If we roll out gradually, it makes sense to take control and experimental groups of the </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">same size</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . This indicator is floating not only in the case of conversions. Consider a graph with shares of the search market, li.ru counters. If you take all the sites on which there are counters from searches, then you can count the share in each case.</font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c0c/cb8/02b/c0ccb802b3799451b77ef99e0e4a56a0.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On the graph, the activity changes every weekend - Yandex attendance at the weekend drops sharply, Google also falls, but only slightly. </font><font style="vertical-align: inherit;">If we add shares, the graph looks like a saw. </font><font style="vertical-align: inherit;">Almost any indicator we follow can change over time (not only in a year, but also in a day). </font><font style="vertical-align: inherit;">From here we formulate:</font></font><br><br><h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mistake number 5: do not take into account seasonality (the measured indicator varies over time) </font></font></h1><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In a good way, if we conduct an experiment, it is better to conduct it during the full seasonality cycle (i.e., to keep the experiment for a whole day / week). </font><font style="vertical-align: inherit;">As we have seen, having considered the experiment only on Friday and Saturday, one can catch a strange effect.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And if we admit that all the nuances of seasonality are difficult to foresee, and it is better to concentrate the experiment in a small period of time, parallel to the A and B groups? Experiments that go through a big holiday (we have this New Year) are obviously hard, because everything breaks down. Especially if we are talking about metrics of user return. Of course, there are many factors that influence the outcome of the experiment. The point is that the A and B groups should always go in parallel, but if we don‚Äôt keep the experiment full week, or they differ in size, there can be a shift in performance. There are always unrecoverable losses - there are users who refuse to use cookies, and in each service there are many such users - we cannot but give them to buy in the store, purchases without registration are allowed, so as not to lose money.And still there is a dependency - the user does not take cookies, but comes to the store regularly. So at least you need to eliminate the losses that we know about.</font></font><br><br><h1>  Results </h1><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conduct experiments; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> make changes based on reasonable hypotheses that come from analyzing the market, users, etc .; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> follow the success rate of experiments; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> log everything; </font></font><br></li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If the share starts to approach the projected share of those who worked at random, then something went wrong - we should be able to return to any experiment and recalculate. </font></font><br><br><ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conduct A / A experiments, including synthetic ones; </font></font><br></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remember seasonality. </font></font><br></li></ul><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The main thing: no matter how much we learn about the world, it is still more complex than it seems to us.</font></font></b> <br><br><blockquote><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minute advertising. </font><font style="vertical-align: inherit;">If you liked this report from the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Heisenbug</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> conference </font><font style="vertical-align: inherit;">- note that the new Heisenbug (May 17-18, St. Petersburg) is already coming, its program also </font></font><a href="https://heisenbug-piter.ru/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">contains a lot of interesting things</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">We hope to see many of you there!</font></font></blockquote></div><p>Source: <a href="https://habr.com/ru/post/358104/">https://habr.com/ru/post/358104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358092/index.html">Why think about web security when it's too late?</a></li>
<li><a href="../358094/index.html">Friday JS: random mixing</a></li>
<li><a href="../358096/index.html">Dive into pyTorch</a></li>
<li><a href="../358100/index.html">How to write on Habrahabr and Geektimes</a></li>
<li><a href="../358102/index.html">The book "Swift. Basics of developing applications for iOS and macOS. 4th ed. supplemented and revised "</a></li>
<li><a href="../358106/index.html">3CX IP phone auto configuration options</a></li>
<li><a href="../358108/index.html">Unity, ECS and all-all-all</a></li>
<li><a href="../358110/index.html">Chinese hackers are behind numerous hacks of international companies</a></li>
<li><a href="../358112/index.html">The transition to domestic software, installation "megasiens" and attracting leading foreign scientists: a plan for breakthrough development of the Russian Federation</a></li>
<li><a href="../358114/index.html">We invite you to Android-meetup SuperJob</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>