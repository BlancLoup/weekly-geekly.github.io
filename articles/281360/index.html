<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>.Net Client for mail.ru cloud</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="By the title of the article, I think everyone has already guessed what it will be about. As is known, the official API for the mail.ru cloud does not ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>.Net Client for mail.ru cloud</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/0b6/c17/293/0b6c17293166a142df0efb2f0a00dc4f.jpg" alt="image"><br><br>  By the title of the article, I think everyone has already guessed what it will be about.  As is known, the official API for the mail.ru cloud does not yet exist, so we will try to write it ourselves.  This will of course be about the client side, and not about the server. <br><br>  What was used and what you need to know to write it: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      - C # programming language <br>  - Visual Studio Development Environment <br>  - Basic knowledge of POST and GET requests <br>  - Browser <br><a name="habracut"></a><br>  Actually, on what all this will rest, our API will only repeat some browser requests to the cloud.mail.ru server.  When performing any operation with files or folders on the cloud, the browser will send http requests to the server, to which it will respond and give the answer you need. <br><br>  The simplest example of a request to delete a file or folder.  I will use Chrome Browser to track requests, where: <br><br>  - Select the file or folder you want to delete <br>  - Press F12 <br>  - Go to the Network tab <br>  - Click "Delete" on the file or folder that we selected <br>  - In the Network tab we see requests, among which we see a request called remove <br><br><div class="spoiler">  <b class="spoiler_title">Remove Request</b> <div class="spoiler_text">  <b>General</b> <br><br><pre><code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">Request</span></span> URL:https://cloud.mail.ru/api/v2/file/remove Request Method:POST Status Code:<span class="hljs-number"><span class="hljs-number">200</span></span> OK Remote Address:<span class="hljs-number"><span class="hljs-number">217.69.139.7:443</span></span></code> </pre> <br>  <b>Response Headers</b> <br><br><pre> <code class="hljs markdown">Cache-Control:no-store, no-cache, must-revalidate Connection:close Content-Length:96 Content-Security-Policy-Report-Only:default-src <span class="hljs-emphasis"><span class="hljs-emphasis">*.cloud.mail.ru *</span></span>.cloud.mail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.datacloudmail.ru *</span></span>.cldmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.mail.ru *</span></span>.imgsmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.files.attachmail.ru *</span></span>.mradx.net <span class="hljs-emphasis"><span class="hljs-emphasis">*.gemius.pl *</span></span>.weborama.fr <span class="hljs-emphasis"><span class="hljs-emphasis">*.adriver.ru *</span></span>.serving-sys.com featherservices.aviary.com d42hh4005hpu.cloudfront.net dme0ih8comzn4.cloudfront.net feather-client-files-aviary-prod-us-east-1.s3.amazonaws.com ; script-src 'unsafe-inline' 'unsafe-eval' <span class="hljs-emphasis"><span class="hljs-emphasis">*.cloud.mail.ru *</span></span>.datacloudmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.cldmail.ru *</span></span>.mail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.imgsmail.ru *</span></span>.files.attachmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.mradx.net *</span></span>.yandex.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.odnoklassniki.ru odnoklassniki.ru *</span></span>.ok.ru ok.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.scorecardresearch.com www.google-analytics.com featherservices.aviary.com d42hh4005hpu.cloudfront.net dme0ih8comzn4.cloudfront.net feather-client-files-aviary-prod-us-east-1.s3.amazonaws.com; img-src data: *</span></span>; style-src 'unsafe-inline' <span class="hljs-emphasis"><span class="hljs-emphasis">*.mail.ru *</span></span>.imgsmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.files.attachmail.ru *</span></span>.mradx.net featherservices.aviary.com d42hh4005hpu.cloudfront.net dme0ih8comzn4.cloudfront.net feather-client-files-aviary-prod-us-east-1.s3.amazonaws.com; font-src data: cloud.mail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.imgsmail.ru *</span></span>.files.attachmail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.mradx.net featherservices.aviary.com d42hh4005hpu.cloudfront.net dme0ih8comzn4.cloudfront.net feather-client-files-aviary-prod-us-east-1.s3.amazonaws.com; frame-src *</span></span>.mail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.datacloudmail.ru *</span></span>.cldmail.ru docs.mail.ru <span class="hljs-emphasis"><span class="hljs-emphasis">*.officeapps.live.com *</span></span>.mradx.net; object-src data: blob: https://*; report-uri https://cspreport.mail.ru/cloud/; Content-Type:application/json; charset=utf-8 Date:Sun, 10 Apr 2016 13:43:38 GMT Expires:Sat, 11 Apr 2015 13:43:38 GMT Pragma:no-cache Server:Tengine Strict-Transport-Security:max-age=15768000; includeSubDomains; preload X-Content-Type-Options:nosniff X-Frame-Options:SAMEORIGIN X-Host:clof8.i.mail.ru X-req-id:OljB4ucgKW X-server:api X-UA-Compatible:IE=Edge X-Upstream-Time:1460295818.308 X-XSS-Protection:1; mode=block; report=https://cspreport.mail.ru/xxssprotection</code> </pre><br>  <b>Request Headers</b> <br><br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">Accept:</span></span>*<span class="hljs-regexp"><span class="hljs-regexp">/* Accept-Encoding:gzip, deflate Accept-Language:ru-RU,ru;q=0.8,en-US;q=0.6,en;q=0.4 Connection:keep-alive Content-Length:181 Content-Type:application/x</span></span>-www-form-urlencoded; charset=UTF-<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-symbol"><span class="hljs-symbol">Cookie:</span></span> ,    <span class="hljs-symbol"><span class="hljs-symbol">Host:</span></span>cloud.mail.ru <span class="hljs-symbol"><span class="hljs-symbol">Origin:</span></span><span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/cloud.mail.ru Referer:https:/</span></span><span class="hljs-regexp"><span class="hljs-regexp">/cloud.mail.ru/home</span></span><span class="hljs-regexp"><span class="hljs-regexp">/ User-Agent:Mozilla/</span></span><span class="hljs-number"><span class="hljs-number">5.0</span></span> (Windows NT <span class="hljs-number"><span class="hljs-number">6.3</span></span>; WOW64) AppleWebKit/<span class="hljs-number"><span class="hljs-number">537.36</span></span> (KHTML, like Gecko) Chrome/<span class="hljs-number"><span class="hljs-number">49.0</span></span>.<span class="hljs-number"><span class="hljs-number">2623.112</span></span> Safari/<span class="hljs-number"><span class="hljs-number">537.36</span></span> X-Requested-<span class="hljs-symbol"><span class="hljs-symbol">With:</span></span>XMLHttpRequest</code> </pre><br>  <b>Form data</b> <br><br><pre> <code class="hljs sql">view URL encoded home:/<span class="hljs-keyword"><span class="hljs-keyword">rename</span></span> folder <span class="hljs-keyword"><span class="hljs-keyword">test</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) api:<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">build</span></span>:hotfix<span class="hljs-number"><span class="hljs-number">-35</span></span><span class="hljs-number"><span class="hljs-number">-1.201604041616</span></span> x-page-<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>:DcpfqVgGGm email:erastmorgan@bk.ru x-email:erastmorgan@bk.ru token:<span class="hljs-number"><span class="hljs-number">9</span></span>qFgR48wHY5Rxqot4Ei515TiQMYCsPxD</code> </pre><br></div></div><br>  We need to repeat the same request from our API.  For this, we will use the HttpWebRequest and HttpWebResponse classes.  Here, the request should look exactly the same as our browser above, with the exception of some headers that are not mandatory.  See the example below for deleting a file or folder. <br><br><div class="spoiler">  <b class="spoiler_title">Remove Request C #</b> <div class="spoiler_text">  I pulled this code straight from my project.  It's pretty simple and I don't think it needs comments. <br><br><pre> <code class="cs hljs"><span class="hljs-comment"><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> Remove file or folder. </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/summary&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="name"&gt;</span></span></span><span class="hljs-comment">File or folder name.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">///</span></span></span><span class="hljs-comment"> </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;param name="fullPath"&gt;</span></span></span><span class="hljs-comment">Full file or folder name.</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">&lt;/param&gt;</span></span></span><span class="hljs-comment"> private void Remove(string name, string fullPath) { var removeRequest = Encoding.UTF8.GetBytes(string.Format("home={0}&amp;api={1}&amp;token={2}&amp;email={3}&amp;x-email={3}", fullPath, 2, this.Account.AuthToken, this.Account.LoginName)); var url = new Uri(string.Format("{0}/api/v2/file/remove", ConstSettings.CloudDomain)); var request = (HttpWebRequest)WebRequest.Create(url.OriginalString); request.Proxy = this.Account.Proxy; request.CookieContainer = this.Account.Cookies; request.Method = "POST"; request.ContentLength = removeRequest.LongLength; request.Referer = string.Format("{0}/home{1}", ConstSettings.CloudDomain, fullPath.Substring(0, fullPath.LastIndexOf(name))); request.Headers.Add("Origin", ConstSettings.CloudDomain); request.Host = url.Host; request.ContentType = ConstSettings.DefaultRequestType; request.Accept = "*/*"; request.UserAgent = ConstSettings.UserAgent; using (var s = request.GetRequestStream()) { s.Write(removeRequest, 0, removeRequest.Length); using (var response = (HttpWebResponse)request.GetResponse()) { if (response.StatusCode != HttpStatusCode.OK) { throw new Exception(); } } } }</span></span></code> </pre><br></div></div><br>  For any other operation in <b>the mail.ru cloud,</b> we repeat the above steps, substituting our data in the place of those you caught from the browser. <br><br>  I provide a list of methods that I wrote in my API: <br><br>  - Create folder <br>  - Copy file <br>  - Copy folder <br>  - Download file (Async operation) <br>  - Upload file (Async operation) <br>  - Get list of files and folders <br>  - Get public file link <br>  - Get public folder link <br>  - Get direct file link (operation on one session) <br>  - Move file <br>  - Move folder <br>  - Rename file <br>  - Rename folder <br>  - Remove file <br>  - Remove folder <br><br>  The API that I wrote you can download <a href="https://github.com/erastmorgan/Mail.Ru-.net-cloud-client">by reference</a> .  Send a Pull Request if you have time and you want to add new features to this API.  All this is written ‚Äúon the knee‚Äù, but the main thing works and can be freely used in your projects. <br><br>  In the future, this API will still be supplemented, for example, I would also like to add file encryption and large file uploads (now the limit is 2GB), with the condition that a large file will be split into the maximum possible parts when downloaded to the cloud, and when unloaded it was going back . </div><p>Source: <a href="https://habr.com/ru/post/281360/">https://habr.com/ru/post/281360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281350/index.html">Haordic Organization Visa (Part 1)</a></li>
<li><a href="../281352/index.html">Superscalar Stacking Processor: Optimization</a></li>
<li><a href="../281354/index.html">Implementation of monitoring and integration testing information system using Scalatest. Part 2</a></li>
<li><a href="../281356/index.html">Simple automation of the management of acts of marriage on SharePoint with examples and pictures</a></li>
<li><a href="../281358/index.html">JetBrains is looking for a technical evangelist with Java experience</a></li>
<li><a href="../281362/index.html">New Cisco Aironet IEEE 802.11ac Wave 2 Access Points</a></li>
<li><a href="../281370/index.html">Leaks do not violate memory safety</a></li>
<li><a href="../281372/index.html">Linux / Mumblehard botnet unmounted using ESET</a></li>
<li><a href="../281374/index.html">Visual Studio 2015 Standard Library and Telemetry</a></li>
<li><a href="../281376/index.html">Why did Citrix not become the ‚Äúnew Red Hat‚Äù in the virtualization market? Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>