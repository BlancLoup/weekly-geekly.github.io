<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AdMob integration into Cocos2d-x</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dear Hobrazhiteli, in this article I want to share my experience on integrating the AdMob banner network into an Android game, written using the Cocos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AdMob integration into Cocos2d-x</h1><div class="post__text post__text-html js-mediator-article">  Dear Hobrazhiteli, in this article I want to share my experience on integrating the AdMob banner network into an Android game, written using the Cocos2d-x engine. <br><br><img src="https://habrastorage.org/storage2/1f0/f20/a7b/1f0f20a7bfa5ea7ce0d0537c9492b1a2.png" align="right"><br><h5>  Introduction </h5><br>  Interest in mobile development in recent years is high and many independent developers and companies are eager to master a part of this market.  This creates high competition and even a good application can get lost in the market.  It may take a long time for your application to reach high positions in the ranking.  And time is money.  It is important to get a good position in the ranking, as this leads to further downloads.  This makes positioning the application as free a good strategy.  However, application development is a costly task, especially if you are a company or use part of the work through outsourcing.  But even if all the development was done by one participant, the developer‚Äôs plans were to simply leave his mark on the app store.  I want to get at least some kind of material return.  Thus, we come to two strategies for monetizing applications.  Freemium model is a free application plus additional functionality for a fee, through in-app purchases.  Either monetization due to advertising built into the application.  In this article we will consider the introduction of advertising in the application. <br><a name="habracut"></a><br><br><h5>  Theory and training tools </h5><br>  So let's say that you already have an application or game for Android written using Cocos2d-x 2.0.4.  Not?  Well then, let's take as a basis the examples bundled with the Cocos2d-x SDK.  Still not installed SDK?  Then we go to <a href="https://github.com/cocos2d/cocos2d-x/">the github section</a> , where the source code of the framework is stored (at the time of this writing, the official web site of the <a href="http://cocos2d-x.org/">cocos2d-x.org</a> project was unavailable).  AdMob SDK can be found on <a href="http://admob.com/">admob.com</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The code in the project using the framework is written in C ++.  However, the AdMob SDK is a Java language library.  How to use this library in our project?  In fact, everything is much easier than it might seem at first glance.  And all this thanks to the capabilities of the Android SDK.  The fact is that the View object in which the graphics implemented in C ++ is displayed is also a Java object, and here we are free to build the configuration we need for various View. <br><br>  The first thing that comes to mind is the stack from View, let's say the banner above and below the game window.  This can be done using the LinearLayout object in which to place the AdView object and Cocos2dxGLSurfaceView.  All this will work, the only problem will arise at the moment when you want to be able to remove the banner, for example, after paying for the purchase inside the application.  The problem is that the OpenGL view in Cocos2d-x does not support resizing the viewport. <br>  Another solution is to use RelativeLayout and display a banner on top of the OpenGL view of the game.  In this case, the display area of ‚Äã‚Äãthe game will take all the available space on the screen and will not change, and the area with the banner will be superimposed on top.  Drop fears, it will not cause image distortion or flicker. <br><br>  If you are familiar with the development under Android, then you know that usually the parameters of the display area are described in a special XML file.  In programs on Cocos2d-x 1.0 it was.  However, you will not find this file in the latest version of Cocos2d-x.  For some reason unknown to me, the description of the display areas was transferred to the Java code.  It does not cause any difficulties, you just need to know where these files are located (cocos2dx-2.0.4 / cocos2dx / platform / android / java / src / org / cocos2dx / lib).  The code turns out a little more, but we have the ability to dynamically create the necessary display configuration.  Unfortunately, without modifying the library files, it will not be possible to connect the viewport we need - the members of the class we need are declared private.  In my project, I made a radical decision to completely copy this code into my project, instead of referring to the framework files.  Since now all the code was now in the repository of my project, it gave me a free hand and I made all the necessary code modifications right in the Cocos2dxActivity class. <br><br><h5>  Integration </h5><br>  So let's get started.  First of all, copy the test project folder, for example HelloCpp in HelloAdMob in the same folder.  Next, copy the AdMob SDK files HelloAdMob / proj.android / AdMob.  Now we will create the HelloAdMob / proj.android / cocos_java folder and copy the files from cocos2dx-2.0.4 / cocos2dx / platform / android / java / src including the subdirectories into it. <br>  Next, open the project in Eclipse, or in another environment of your choice (notepad? ;-).  Project properties should look like the screenshots below. <br><br>  You will need to add the cocos_java folder to the project, <br> <a href=""><img src="https://habrastorage.org/storage2/57c/0ec/e1a/57c0ece1a00dba5e80723fd3abca789b.png"></a> <br><br>  as well as the AdMob library. <br> <a href=""><img src="https://habrastorage.org/storage2/a86/e87/d93/a86e87d932f16b81d4009fbfdbdd43bf.png"></a> <br><br>  and mark the AdMob library for export. <br> <a href=""><img src="https://habrastorage.org/storage2/a03/ec0/e12/a03ec0e1227b45efbaf0091a8e2d0a77.png"></a> <br><br>  You also need to change the version of the Android SDK, since AdMob requires version 3.2 or higher.  Do not worry, support for versions from Android 2.2 will remain.  Modify the project.properties file by installing the appropriate version <br><pre><code class="xml hljs"># Project target. target=android-13</code> </pre> <br>  Next, open the AndroidManifest.xml file as text, correct the line of the target SDK <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-sdk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:minSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"8"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:targetSdkVersion</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"13"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  the minimum version is left old.  Below we will add the necessary permissions so that AdMob can download the banner from the network. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.INTERNET"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">uses-permission</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"android.permission.ACCESS_NETWORK_STATE"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  You also need to declare AdMob in the manifest file.  I did this after announcing the activity class of the game. <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.google.ads.AdActivity"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:configChanges</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"keyboard|keyboardHidden|orientation|screenLayout|uiMode|screenSize|smallestScreenSize"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre><br>  Now we modify the Cocos2dxActivity.java file - add AdMob import sinks: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ads.AdRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ads.AdSize; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.google.ads.AdView;</code> </pre><br>  add a field for the ad unit to the class <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AdView adView;</code> </pre><br>  now after the lines <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// ...add to FrameLayout framelayout.addView(edittext);</span></span></code> </pre><br>  insert the following code: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//     adView = new AdView(this, AdSize.BANNER, "_id"); //   ,     ,     cocos2d-x      ViewGroup.LayoutParams ad_layout_params = new ViewGroup.LayoutParams( ViewGroup.LayoutParams.FILL_PARENT, 50); adView.setLayoutParams(ad_layout_params); //    AdRequest adRequest = new AdRequest(); //   adRequest.addTestDevice("id__"); //      adView.loadAd(adRequest);</span></span></code> </pre><br>  Publisher ID you get after registering on admob.com and adding information about your program.  The device ID will be displayed in the logcat console, it needs to be copied and pasted into the code, because of random clicks on your own banner, you can be banned (sorry for the pun) in the admob system, and if you logged in with a Google account, you can this account is also blocked, with all the ensuing consequences. <br>  Next, you need to add the created viewport to the class hierarchy.  This should be done after adding the OpenGL region, otherwise your banner will be blocked by it.  After the line <br><pre> <code class="java hljs">gLSurfaceView.setCocos2dxEditText(edittext);</code> </pre><br>  add our code: <br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  AdView    .     ,     framelayout.addView(adView);</span></span></code> </pre><br><br>  Everything, it is possible to start assembly.  Do not forget to build the native library using the Android NDK, after which you can build the project in Eclipse (or in your favorite environment) and enjoy the result. <br><br><img src="https://habrastorage.org/storage2/c20/222/867/c20222867927b39139776135a9caae4c.png"></div><p>Source: <a href="https://habr.com/ru/post/161891/">https://habr.com/ru/post/161891/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../161881/index.html">Stallman called Ubuntu "spyware"</a></li>
<li><a href="../161883/index.html">Superparol concept - as additional protection for web-based email accounts</a></li>
<li><a href="../161885/index.html">Unofficial guide to the brain of Rich Hickey</a></li>
<li><a href="../161887/index.html">3D chess on HTML / CSS3 / JS</a></li>
<li><a href="../161889/index.html">Handling asynchronous errors with saving the request context in connect / express</a></li>
<li><a href="../161893/index.html">Pick your color - color matching and ideas for development.</a></li>
<li><a href="../161895/index.html">Twitter.Bootstrap.MVC4 - Twitter Bootstrap for ASP.NET MVC 4</a></li>
<li><a href="../161897/index.html">How I met the new year</a></li>
<li><a href="../161899/index.html">System-level optimization and its contribution to solving the problems of energy consumption</a></li>
<li><a href="../161901/index.html">The greatness of the universe in numbers, and a little in pictures</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>