<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wireless access point using Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Well, here is the first article in the promised series . 
 The first thing I will do is set up Software AP, or a computer-based wireless network. At t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wireless access point using Linux</h1><div class="post__text post__text-html js-mediator-article">  Well, here is the first article in the promised <a href="http://habrahabr.ru/post/188108/">series</a> . <br>  The first thing I will do is set up Software AP, or a computer-based wireless network.  At this stage, of course, you need access to the server console with root rights.  In addition, you also need to connect to the Internet NOT via the internal wifi card - cable, via a 3G modem, in short, as you wish, but not via the wifi, which we will use to create a wireless network.  For the first time, I connected both the server and the laptop from which I was managing the server to the same network via cable - this is more reliable after all.  I will use the hostapd package - it is quite known as a reliable solution and there are enough manuals for it, and for DHCP and DNS servers I will use dnsmasq - a solution just for home networks, it is used by DD-WRT, I wondered if anyone else. <br><a name="habracut"></a><br><h6>  The very first step, of course: </h6><br><pre><code class="bash hljs">apt-get install hostapd</code> </pre> <br>  Version: <br><pre> <code class="bash hljs">hostapd -v &gt;hostapd v1.0</code> </pre> <br>  Hmm, the source code already has 2.0.  This is it, Debian stable.  But in fact, it doesn‚Äôt really hurt us - version 1.0 works quite stably for me. <br><h6>  Setup: </h6><br>  Edit the /etc/default/hostapd.conf file.  In it to uncomment a line of type <pre> <code class="bash hljs">DAEMON_CONF=<span class="hljs-string"><span class="hljs-string">"/etc/hostapd/hostapd.conf"</span></span></code> </pre>  This is the path to the hostapd daemon configuration file. <br>  Then go ahead - edit /etc/hostapd/hostapd.conf.  I will provide the contents of my configuration file.  I warn you, the configuration options parser of this daemon is very sensitive and even swears on blank lines with a space.  The comment does not swear. <br><br><pre> <code class="bash hljs">interface=wlan0</code> </pre>  Wireless card network interface <br><pre> <code class="bash hljs">driver=nl80211</code> </pre>  The network card driver - nl80211 works fine for hostapd, I see no reason to change, and they say that it works in most cases. <br><pre> <code class="bash hljs">ssid=CRWiFi</code> </pre>  The name of the access point, so-called.  SSID <br><pre> <code class="bash hljs">hw_mode=g</code> </pre>  The mode of operation of the network card is 801.11b / g / n.  In fact - there should always be g there, even if the card is capable of n, to adjust the mode n you have to change something, look further: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#ieee80211n=1 #    n #ht_capab=[HT40-][SHORT-GI-40] #    n</span></span></code> </pre> <br><pre> <code class="bash hljs">channel=6</code> </pre>  Wireless channel - from 1 to 13. For best performance, 1, 6 or 11 channels are recommended. <br><pre> <code class="bash hljs">wpa=2</code> </pre>  WPA version <br><pre> <code class="bash hljs">wpa_passphrase=11111111</code> </pre>  Wireless point password <br>  WPA2 advanced settings: <br><pre> <code class="bash hljs">wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP rsn_pairwise=CCMP auth_algs=1</code> </pre>  The following option sets MAC address blocking.  I don‚Äôt know how to set it up yet, and the thing is pretty useless, but everyone says that without blocking this option should be set to zero - which I did: <br><pre> <code class="bash hljs">macaddr_acl=0</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Full config one block for copy-paste to file:</b> <div class="spoiler_text"><pre> <code class="bash hljs">interface=wlan0 driver=nl80211 ssid=CRWiFi hw_mode=g <span class="hljs-comment"><span class="hljs-comment">#ieee80211n=1 #    n #ht_capab=[HT40-][SHORT-GI-40] #    n channel=6 wpa=2 wpa_passphrase=11111111 wpa_key_mgmt=WPA-PSK wpa_pairwise=TKIP rsn_pairwise=CCMP auth_algs=1 macaddr_acl=0</span></span></code> </pre> </div></div><br>  The config is automatically checked before launch, so boldly try running hostapd.  Management commands: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /etc/init.d/hostapd start # /etc/init.d/hostapd stop # /etc/init.d/hostapd restart</span></span></code> </pre>  Let me remind you - also in Debian, you can use commands like service hostapd start, which is easier to write. <br><br><h6>  A couple of steps for sustainability: </h6><br><ul><li>  We must not forget that to encrypt WPA / WPA2, the password must be at least 8 characters.  If you change your password on the fly using an SSH session over a wireless channel, you can suddenly cut yourself off from the server - hostapd will not want to start and the only means of communication with the server will be lost.  Works - do not touch, but if you touch - touch carefully. </li><li>  In the case of a multi-user system, I advise you to set read rights for files like 700, so that ordinary users could not find out the password for the access point - if you care, of course. </li></ul><br>  What else can I say?  There are no problems with mobile devices, it is extremely rare (about once or twice a month) to connect to a point with a laptop running Windows 7.  It is treated by the service hostapd restart team, it is likely that this problem has been removed in new releases - there is a version of hostapd 2.0.0, but I have not tried to compile and install it yet. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For now.  You can try to connect to the point, but ... To successfully connect to the access point, you need a DHCP server, without it you cannot fully connect to the point - the same operating systems will not allow this, because without getting the address, the connection itself does not make much sense.  Here we set it up! <br><br><hr><br>  When I first started learning how to set up servers for my needs, the first thing I stumbled upon was the isc-dhcp-server package, I planned to offer it, and the article was ready, but ... I found dnsmasq, and my life changed for the better.  Dnsmasq is both a caching DNS and DHCP server with its own set of various features.  As soon as I looked into his config, my vision improved, all thoughts in the brain suddenly became orderly and I reached enlightenment.  In reality, the config is very simple and straightforward.  But for the time being we are preparing a platform for the work of dnsmasq.  What to do? <br><br>  1) Think of how the addresses in our local network will look like.  I chose addresses like 192.168.51.x. <br><br>  2) Configure the network interface on which dnsmasq will work.  In fact, it is a very important step, which many people miss in their manuals for setting up DHCP servers.  The fact is that a computer running a DHCP server must be assigned a static address ‚Äî who will issue the address to the DHCP server if it cannot start without an address, and it cannot give itself the address because it is not running? <br>  So, open the / etc / network / interfaces file for editing and add a paragraph like this: <br><pre> <code class="bash hljs">auto _ iface _ inet static address 192.168..1 netmask 255.255.255.0 gateway 192.168..1</code> </pre>  We save and restart our network interface, on which DHCP is configured: <br><pre> <code class="bash hljs">ifdown  ifup </code> </pre>  We check the status, check the settings with those that should be: <br><pre> <code class="bash hljs">ifconfig </code> </pre> <br>  3) It is necessary to remove any DNS and DHCP servers so that dnsmasq can safely start - otherwise it gives an error.  I had bind9 and isc-dhcp-server installed, I had to get rid of them.  If we are working over SSH from the network in which the late DHCP server previously distributed the addresses, we do not reboot - there is no one to issue addresses. <br><br>  4) It is necessary to create conditions for the server to work - to create a user in order to run dnsmasq under it, to register in the system settings of the DNS server, to which dnsmasq will access and a couple more trifles. <br>  We register Google's DNS server.  True, the first line we will have localhost.  This is done to ensure that the rest of the system applications on our server, when they need to get the address from the DNS server, appeal first to dnsmasq, and not to Google.  Well, dnsmasq is smart enough to ignore this line: <br><pre> <code class="bash hljs">nano /etc/resolv.conf</code> </pre> <br><pre> <code class="bash hljs">nameserver 127.0.0.1 nameserver 8.8.8.8 nameserver 8.8.8.4</code> </pre> <br>  You need to protect this file from being overwritten every time the system starts.  Overwrites it with dhclient, if that.  Honestly, a write lock is only one of the ways how to prevent overwriting =) There are others, but this one is the simplest: <br><pre> <code class="bash hljs">chattr +i /etc/resolv.conf</code> </pre> <br>  What if you for some reason consider blocking a file in the wrong way, or do you also want to use DNS that dhclient so strongly suggests?  Then, as <a href="http://habrahabr.ru/users/merlin-vrn/" class="user_link">merlin-vrn advises</a> , you need to use the resolvconf program. <br><div class="spoiler">  <b class="spoiler_title">Configure resolvconf</b> <div class="spoiler_text">  If the resolvconf package is not installed yet, install it.  The only thing that is needed in order to register a static DNS address for the system is to edit /etc/resolvconf/resolv.conf.d/base, adding there everything we would write in /etc/resolv.conf: <br><pre> <code class="bash hljs">nameserver 127.0.0.1 nameserver 8.8.8.8 nameserver 8.8.4.4</code> </pre> <br>  service resolvconf reload - done! </div></div><br>  Add a group and user: <br><pre> <code class="bash hljs">groupadd -r dnsmasq useradd -r -g dnsmasq dnsmasq</code> </pre> <br>  5) We put Dnsmasq, it starts up and is ready for work, but we disable it - it is not yet configured, there is nothing for it to do here: <br><pre> <code class="bash hljs">apt-get install dnsmasq service dnsmasq stop</code> </pre> <br>  6) Clean the original file from the standard config: <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>&gt;/etc/dnsmasq.conf</code> </pre> <br>  Well, now we are ready to customize.  I‚Äôll say right away that dnsmasq has many different options that I described in detail in the comments when writing this article ... I did not understand that the topic was bloated to indecent and unreadable sizes, as if it‚Äôs not enough that the article is already overflowed with text and formatted as .  Therefore - I will leave the config with the most important ones without long comments and any additional options, and the config with additional options will be under the spoiler. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#  dnsmasq     dnsmasq user=dnsmasq group=dnsmasq ## #  DNS.   -    . ## #  DNS -   DNS,   0. #     DNS    -  , . port=53 #  .      . cache-size=1000 #     DNS      homeserver, user-pc   - #    , ,         ... domain-needed # -  ,       DNS-      bogus-priv #    DHCP  DNS . interface=wlan0 #     ,  : except-interface=ppp0 #   ,          ppp0,   dhcp-authoritative. ## #  DHCP.   -    . ## #     : #      DHCP-, #       # 12h  ,       - 12 . # , 12m - 12 ,  . dhcp-range=192.168.51.50,192.168.51.150,12h #  .   MAC  IP: dhcp-host=11:22:33:44:55:66,192.168.51.60 #  .  MAC, hostname, IP    . # -,    =)    : dhcp-host=11:22:33:44:55:66,fred,192.168.51.60,45m #   IP-   MAC-: dhcp-host=11:22:33:44:55:66,ignore #    - ,     ! # ,    -             . #   ,         - #   ,   IP- #       ,     IP  . dhcp-authoritative</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Advanced options:</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#      ,   DNS. # IPv4-only. #  1.2.3.4  5.6.7.8! alias=1.2.3.4,5.6.7.8 #   1.2.3.x  5.6.7.x?      ! alias=1.2.3.0,5.6.7.0,255.255.255.0 #         192.168.0.10-&gt;192.168.0.40  10.0.0.10-&gt;10.0.0.40? alias=192.168.0.10-192.168.0.40,10.0.0.0,255.255.255.0 # ,      Spamhaus     ,   - . #   . Dnsmasq      - #      .     . # ,  ,   .   -  ,  #       . #    dnsmasq        , #     . bind-interfaces #  !    DNS,       - #   ,      ,    . # ,    ? address=/vk.com/127.0.0.1 # !      "It works!" #   ,   . #   ,  ? =D # , ,        DNS, #    ,         . # ,       ? #     dnsmasq  DNS-: #   /etc/hosts         DNS-. #       KMS Microsoft Office #     -, #       ,      . #        hosts?      !   ! addn-hosts=/etc/banner_add_hosts # ,         hosts. #    c hosts,   , ,    ? #       . no-hosts #  ,        -   . #    ,     MAC-   IP-. # ,    ,         - #   ,     MAC  . #    - MA:CA:DD:RE:SS:00,MA:CA:DD:RE:SS:01,12.34.56.78 dhcp-host=11:22:33:44:55:66,12:34:56:78:90:12,192.168.0.60 #   lease  c hostname bert. dhcp-host=bert,192.168.0.70,infinite #   -     " ". #   -     ,       . #     DHCPDISCOVER . dhcp-ignore=tag:!known #   DHCP-. ,       address range. dhcp-lease-max=640 #640    #    -      100,   . #  .       DHCP     # : script add MA:CA:DD:RE:SS:00 12.34.56.78 hostname( ) ( ) #  script del MA:CA:DD:RE:SS:00 12.34.56.78 hostname( ) ( ) dhcp-script=/bin/echo #   -    .      =D #  NTP-    .    -   , -. dhcp-option=42,192.168.51.1</span></span></code> </pre> </div></div><br><br>  Yeah, the server is configured.  Run: <br><pre> <code class="bash hljs">service dnsmasq start</code> </pre> <br>  and look for errors in the output of the command.  If not - everything is fine!  We try to connect something to our point and see how IP addresses are issued, ping and check DNS.  File with the list of issued addresses: /var/lib/misc/dnsmasq.leases. <br>  In the next article, the connection of a 3G modem and the configuration of a simple but stable NAT / firewall on iptables.  Successful setting! <br><h6>  Criticism on the content, readability and formatting of the article is more than appropriate. </h6></div><p>Source: <a href="https://habr.com/ru/post/188274/">https://habr.com/ru/post/188274/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188258/index.html">The Old Reader is no longer public</a></li>
<li><a href="../188262/index.html">YAF - language reporting forms</a></li>
<li><a href="../188266/index.html">Site Logo Animation</a></li>
<li><a href="../188268/index.html">test.it - ‚Äã‚Äãjavascript testing or my bike with nesting and detailed output</a></li>
<li><a href="../188272/index.html">Want a Chromebook Pixel by Asus with Yota 4G embedded?</a></li>
<li><a href="../188276/index.html">Android 4.3 update available for Google Nexus 4</a></li>
<li><a href="../188280/index.html">Mojo Share - all social buttons on CSS3 with an icon font in one place</a></li>
<li><a href="../188282/index.html">How to start SEO-promotion on the principle of "Lean Startup"</a></li>
<li><a href="../188286/index.html">How NASA manages the ISS to avoid collisions with space junk</a></li>
<li><a href="../188294/index.html">Creating a cross-platform Smart TV application based on the SmartBox library for Samsung, LG, Philips and others</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>