<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We raise micromonitoring on icinga2 with minimal costs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes there is a desire to control the situation in disparate networks, individual hosts behind the network or simply monitor the computers of par...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We raise micromonitoring on icinga2 with minimal costs</h1><div class="post__text post__text-html js-mediator-article">  Sometimes there is a desire to control the situation in disparate networks, individual hosts behind the network or simply monitor the computers of parents or friends, but there are almost no resources for this.  We will seek a solution using icinga2.  Now VDS providers have offers of VDS servers in minimal configurations for ridiculous money.  Well, let's use this. <br><br>  For example, a server with one core, 512 MB of RAM and a 10 GB disk will cost only 90 rubles per month.  Install icinga2 on such a server.  But to save resources, we will not store data and instead of the standard web interface (icingaweb2) we will make our own which will access the icinga2 API. <br><a name="habracut"></a><br>  Installing icinga2 more than once described and does not cause great difficulties.  Briefly run through the main stages of the installation.  We will install on ubuntu. <br><br><pre><code class="bash hljs">wget -O - http://debmon.org/debmon/repo.key 2&gt;/dev/null | apt-key add - <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'deb http://debmon.org/debmon debmon-jessie main'</span></span> &gt;/etc/apt/sources.list.d/debmon.list apt-get update apt-get install icinga2</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Run the wizard: <br><br><pre> <code class="bash hljs">icinga2 node wizard</code> </pre><br>  We want to set up a master host, so we answer "no" to the first question of the wizard.  The Configuration Assistant generates a certificate, initializes the configuration files, and includes api functionality, which is disabled by default. <br><br>  After making changes to the configuration, if we want them to take effect, you must restart the service: <br><pre> <code class="bash hljs">service icinga2 reload</code> </pre><br><br>  If something went wrong, we look at what our system does not like and sort out the errors: <br><br><pre> <code class="bash hljs">service icinga2 checkconfig</code> </pre><br><br>  The server is ready for monitoring.  We are starting to install icinga2 on a Windows host, which we will monitor.  With the installation of Windows client should not have problems, you need NET.  Framework.  We start the wizard, if you wish, you can change the host name (the register in the name matters), add the server, indicate that we want to accept commands and configuration from the wizard. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c7e/672/834/c7e672834576862abdc1aef804279e69.png" alt="image"><br><br>  On the server, we generate an installation ticket for the client and enter in the client wizard: <br><br><pre> <code class="bash hljs">icinga2 pki ticket --cn TS01E.PSHOME.local</code> </pre><br><br>  After the client wizard finishes its work and starts the service, check the created node on the server and update the configuration: <br><br><pre> <code class="bash hljs">icinga2 node list icinga2 node update-config service icinga2 reload</code> </pre><br>  Similarly, install other clients.  Now our hosts are monitored. <br><br>  Getting to the advanced configuration settings.  First of all, let's write our email in the /etc/icinga2/conf.d/users.conf file, to which the alerts will be sent: <br><br><pre> <code class="bash hljs">object User <span class="hljs-string"><span class="hljs-string">"icingaadmin"</span></span> { import <span class="hljs-string"><span class="hljs-string">"generic-user"</span></span> display_name = <span class="hljs-string"><span class="hljs-string">"Icinga 2 Admin"</span></span> groups = [ <span class="hljs-string"><span class="hljs-string">"icingaadmins"</span></span> ] email = <span class="hljs-string"><span class="hljs-string">"icingaadmin@yandex.ru"</span></span> } object UserGroup <span class="hljs-string"><span class="hljs-string">"icingaadmins"</span></span> { display_name = <span class="hljs-string"><span class="hljs-string">"Icinga 2 Admin Group"</span></span> }</code> </pre><br><br>  Configure smtp on the server if it is not already done: <br><br><pre> <code class="bash hljs">apt-get install ssmtp</code> </pre><br>  Specify the mail for the user from under which icinga2 works: <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> nagios:icingarobot@yandex.ru &gt;&gt; /etc/ssmtp/revaliases</code> </pre><br><br>  Approximate contents of the /etc/ssmtp/ssmtp.conf file for sending mail via Yandex smtp: <br><br><pre> <code class="bash hljs">root=postmaster mailhub=smtp.yandex.ru:465 hostname=icinga-failover FromLineOverride=YES AuthUser=icingarobot@yandex.ru AuthPass=password UseTLS=YES</code> </pre><br><br>  Since our monitoring does not save data, we need something more operational than email.  <a href="https://pushover.net/">Set up pushover</a> .  To do this, create a script /etc/icinga2/scripts/pushovernotify.sh: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh curl -F "token=$PUSHOVERTOKEN" \ -F "user=$PUSHOVERUSER" \ -F "title=$PUSHOVERTITLE" \ -F "message=$PUSHOVERMESSAGE" \ -F "html=$PUSHOVERHTML" \ https://api.pushover.net/1/messages exit 0</span></span></code> </pre><br><br>  Add the following lines to the /etc/icinga2/conf.d/commands.conf file: <br><br><pre> <code class="bash hljs">object NotificationCommand <span class="hljs-string"><span class="hljs-string">"pushover-host-notification"</span></span> { import <span class="hljs-string"><span class="hljs-string">"plugin-notification-command"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> = [ SysconfDir + <span class="hljs-string"><span class="hljs-string">"/icinga2/scripts/pushovernotify.sh"</span></span> ] env = {  PUSHOVERUSER = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">.vars.pushover_user$"</span></span>  PUSHOVERTOKEN = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">.vars.pushover_token$"</span></span>  PUSHOVERTITLE = <span class="hljs-string"><span class="hljs-string">"Icinga2 Host Notification"</span></span>  PUSHOVERMESSAGE = <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$notification</span></span></span><span class="hljs-string">.type$&lt;/b&gt; &lt;a href='http://__/host.php?host=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">.display_name$'&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">.display_name$&lt;/a&gt; &lt;b&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">.state$&lt;/b&gt; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$icinga</span></span></span><span class="hljs-string">.long_date_time$"</span></span>  PUSHOVERHTML = <span class="hljs-string"><span class="hljs-string">"1"</span></span> } } object NotificationCommand <span class="hljs-string"><span class="hljs-string">"pushover-service-notification"</span></span> { import <span class="hljs-string"><span class="hljs-string">"plugin-notification-command"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> = [ SysconfDir + <span class="hljs-string"><span class="hljs-string">"/icinga2/scripts/notifybypushover2.sh"</span></span> ] env = {  PUSHOVERUSER = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">.vars.pushover_user$"</span></span>  PUSHOVERTOKEN = <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$user</span></span></span><span class="hljs-string">.vars.pushover_token$"</span></span>  PUSHOVERTITLE = <span class="hljs-string"><span class="hljs-string">"Icinga2 Service Notification"</span></span>  PUSHOVERMESSAGE = <span class="hljs-string"><span class="hljs-string">" &lt;b&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$notification</span></span></span><span class="hljs-string">.type$&lt;/b&gt; &lt;a href='http://__/host.php?host=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">.display_name$'&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$host</span></span></span><span class="hljs-string">.display_name$&lt;/a&gt; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$service</span></span></span><span class="hljs-string">.display_name$ &lt;b&gt;</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$service</span></span></span><span class="hljs-string">.state$&lt;/b&gt; </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$icinga</span></span></span><span class="hljs-string">.long_date_time$"</span></span>  PUSHOVERHTML = <span class="hljs-string"><span class="hljs-string">"1"</span></span> } }</code> </pre><br><br>  Add the following lines to the /etc/icinga2/conf.d/templates.conf file: <br><br><pre> <code class="bash hljs">template Notification <span class="hljs-string"><span class="hljs-string">"pushover-host-notification"</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> = <span class="hljs-string"><span class="hljs-string">"pushover-host-notification"</span></span>  states = [ Up, Down ] types = [ Problem, Acknowledgement, Recovery, Custom,       FlappingStart, FlappingEnd,       DowntimeStart, DowntimeEnd, DowntimeRemoved ]    period = <span class="hljs-string"><span class="hljs-string">"24x7"</span></span> } template Notification <span class="hljs-string"><span class="hljs-string">"pushover-service-notification"</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> = <span class="hljs-string"><span class="hljs-string">"pushover-service-notification"</span></span> states = [ OK, Warning, Critical, Unknown ] types = [ Problem, Acknowledgement, Recovery, Custom, FlappingStart, FlappingEnd, DowntimeStart, DowntimeEnd, DowntimeRemoved ] period = <span class="hljs-string"><span class="hljs-string">"24x7"</span></span> }</code> </pre><br><br>  Add the following lines to the /etc/icinga2/conf.d/notifications.conf file: <br><br><pre> <code class="bash hljs">apply Notification <span class="hljs-string"><span class="hljs-string">"pushover-icingaadmin"</span></span> to Host { import <span class="hljs-string"><span class="hljs-string">"pushover-host-notification"</span></span> user_groups = host.vars.notification.mail.groups users = host.vars.notification.mail.users assign <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> host.vars.notification.mail interval = 0 // <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> re-notification } apply Notification <span class="hljs-string"><span class="hljs-string">"pushover-icingaadmin"</span></span> to Service { import <span class="hljs-string"><span class="hljs-string">"pushover-service-notification"</span></span> user_groups = host.vars.notification.mail.groups users = host.vars.notification.mail.users assign <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> host.vars.notification.mail interval = 0 // <span class="hljs-built_in"><span class="hljs-built_in">disable</span></span> re-notification }</code> </pre><br><br>  Add the pushover keys in the /etc/icinga2/conf.d/users.conf file <br><pre> <code class="bash hljs">object User <span class="hljs-string"><span class="hljs-string">"icingaadmin"</span></span> { import <span class="hljs-string"><span class="hljs-string">"generic-user"</span></span> display_name = <span class="hljs-string"><span class="hljs-string">"Icinga 2 Admin"</span></span> groups = [ <span class="hljs-string"><span class="hljs-string">"icingaadmins"</span></span> ] email = <span class="hljs-string"><span class="hljs-string">"icingaadmin@yandex.ru"</span></span> vars.pushover_user = <span class="hljs-string"><span class="hljs-string">"1111111111111111111111111111111"</span></span> vars.pushover_token = <span class="hljs-string"><span class="hljs-string">"1111111111111111111111111111111"</span></span> }</code> </pre><br><br>  At this stage, we already hear when something is wrong with our monitoring objects, of course, I would like to see the big picture.  For this we need a web server with php, which, for example, can be placed on a home computer or on the same VDS as icinga2. <br><br>  So, we draw a web-muzzle for requests to the icinga2 API.  The setup wizard also created the /etc/icinga2/conf.d/api-users.conf file from which we take the username and password to access the api.  The web interface project consists of a page displaying a list of all hosts and a detailed information page for a particular host.  From the assumption that the placement of the web interface can be on a separate server, we use a php script written in a hurry to proxying cross-domain requests. <br><div class="spoiler">  <b class="spoiler_title">Script text icinga-proxy.php:</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span>( <span class="hljs-string"><span class="hljs-string">"config.php"</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'host'</span></span>])) {  $host = trim($_GET[<span class="hljs-string"><span class="hljs-string">'host'</span></span>]);  $json_url = <span class="hljs-string"><span class="hljs-string">"https://"</span></span>.ICINGA2_HOST.<span class="hljs-string"><span class="hljs-string">":5665/v1/objects/hosts/"</span></span>.$host.<span class="hljs-string"><span class="hljs-string">"/"</span></span>;  <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {    $ch = curl_init();    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> === $ch)      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'failed to initialize'</span></span>);      curl_setopt($ch, CURLOPT_URL, $json_url);      curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);      curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);      curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);      curl_setopt($ch, CURLOPT_USERPWD, <span class="hljs-string"><span class="hljs-string">"$username:$password"</span></span>);      curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);      $content = curl_exec($ch);      <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $content;      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> === $content)        <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(curl_error($ch), curl_errno($ch));  } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) {    trigger_error(sprintf(    <span class="hljs-string"><span class="hljs-string">'Curl failed with error #%d: %s'</span></span>,    $e-&gt;getCode(), $e-&gt;getMessage()),    E_USER_ERROR);  } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'domain'</span></span>])) {    $domain = trim($_GET[<span class="hljs-string"><span class="hljs-string">'domain'</span></span>]);    $json_url = <span class="hljs-string"><span class="hljs-string">"https://"</span></span>.ICINGA2_HOST.<span class="hljs-string"><span class="hljs-string">":5665/v1/objects/hosts?filter=match%28%22*"</span></span> . $domain . <span class="hljs-string"><span class="hljs-string">"*%22%2Chost%2Ename%29"</span></span>;  } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {    $json_url = <span class="hljs-string"><span class="hljs-string">"https://"</span></span>.ICINGA2_HOST.<span class="hljs-string"><span class="hljs-string">":5665/v1/objects/hosts"</span></span>;  }  <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {    $ch = curl_init();  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> === $ch)    <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(<span class="hljs-string"><span class="hljs-string">'failed to initialize'</span></span>);    curl_setopt($ch, CURLOPT_URL, $json_url);    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>);    curl_setopt($ch, CURLOPT_USERPWD, <span class="hljs-string"><span class="hljs-string">"$username:$password"</span></span>);    curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);    $content = curl_exec($ch);    <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $content;    <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">FALSE</span></span> === $content)      <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span>(curl_error($ch), curl_errno($ch));  } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $e) {    trigger_error(sprintf(    <span class="hljs-string"><span class="hljs-string">'Curl failed with error #%d: %s'</span></span>,    $e-&gt;getCode(), $e-&gt;getMessage()),    E_USER_ERROR);  } } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br></div></div><br>  We would like to see the list of all hosts up to date and preferably without reloading the page, for this we use <a href="http://api.jquery.com/jquery.getjson/">jQuery.GetJSON ()</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Script text icinga-get-host.js:</b> <div class="spoiler_text"><pre> <code class="bash hljs">$(document).ready(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span> () { $(<span class="hljs-string"><span class="hljs-string">'#get-data'</span></span>).click(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span> () {  var showData = $(<span class="hljs-string"><span class="hljs-string">'#show-data'</span></span>);  var www_path = <span class="hljs-string"><span class="hljs-string">""</span></span>;  var json_url = <span class="hljs-string"><span class="hljs-string">'icinga-proxy.php?domain='</span></span> + domainFilter.value;  $.getJSON(json_url, <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (data) {           var data0 = data.results;    var items = data0.map(<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> (item) {         var hostdown = item.attrs.state;    var icon_image_src = item.attrs.icon_image;    var hostdown_bage;    var hostdown_bage_span;     <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hostdown == 1) {               hostdown_bage = <span class="hljs-string"><span class="hljs-string">"&lt;span class='mdl-badge mdl-badge--overlap' data-badge='!'&gt;"</span></span>;        hostdown_bage_span = <span class="hljs-string"><span class="hljs-string">"&lt;/span&gt;"</span></span>;         icon_image_src = item.attrs.icon_image.slice(0, -4) + <span class="hljs-string"><span class="hljs-string">"_gray.png"</span></span>;       } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {              hostdown_bage = <span class="hljs-string"><span class="hljs-string">""</span></span>;       hostdown_bage_span = <span class="hljs-string"><span class="hljs-string">""</span></span>;        <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item.attrs.icon_image) {          icon_image_src = item.attrs.icon_image;        } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {          icon_image_src = <span class="hljs-string"><span class="hljs-string">"img/my/dot.png"</span></span>;        }     }         <span class="hljs-built_in"><span class="hljs-built_in">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;td class='mdl-data-table__cell--non-numeric'&gt;&lt;img src='"</span></span> + www_path     + icon_image_src + <span class="hljs-string"><span class="hljs-string">"' id='host"</span></span> + item.attrs.display_name.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)[0] + <span class="hljs-string"><span class="hljs-string">"' /&gt;"</span></span>     + <span class="hljs-string"><span class="hljs-string">"&lt;div class='mdl-tooltip' for='host"</span></span> + item.attrs.display_name.split(<span class="hljs-string"><span class="hljs-string">'.'</span></span>)[0] + <span class="hljs-string"><span class="hljs-string">"'&gt;"</span></span> + item.attrs.display_name + <span class="hljs-string"><span class="hljs-string">"&lt;/div&gt;"</span></span>     + hostdown_bage_span + <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;&lt;td class='mdl-data-table__cell--non-numeric' onclick='location=\"host.php?host="</span></span> + item.attrs.__name + <span class="hljs-string"><span class="hljs-string">"\"'&gt;"</span></span>     + hostdown_bage + hostdown_bage_span + item.attrs.display_name  + <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>     + <span class="hljs-string"><span class="hljs-string">"&lt;td class='mdl-data-table__cell--non-numeric'&gt;"</span></span> + item.attrs.vars.domain_name + <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>     //+ <span class="hljs-string"><span class="hljs-string">"&lt;td class='mdl-data-table__cell--non-numeric'&gt;"</span></span> + item.attrs.vars.os + <span class="hljs-string"><span class="hljs-string">"&lt;/td&gt;"</span></span>     ;       });   showData.empty();   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (items.length) {    var content = <span class="hljs-string"><span class="hljs-string">'&lt;tr&gt;'</span></span> + items.join(<span class="hljs-string"><span class="hljs-string">'&lt;/tr&gt;&lt;tr&gt;'</span></span>) + <span class="hljs-string"><span class="hljs-string">'&lt;/tr&gt;'</span></span>;    var list = $(<span class="hljs-string"><span class="hljs-string">'&lt;table class="mdl-data-table mdl-js-data-table" style="margin: auto; width: 100%" /&gt;'</span></span>).html(content);    showData.append(list);   }  });  showData.text(<span class="hljs-string"><span class="hljs-string">'Loading the JSON file.'</span></span>); }); $(<span class="hljs-string"><span class="hljs-string">'#get-data'</span></span>).click(); setInterval(<span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function</span></span></span></span>(){$(<span class="hljs-string"><span class="hljs-string">'#get-data'</span></span>).click();},60*1000); });</code> </pre><br></div></div><br>  The repository of the web interface project can be found <a href="https://github.com/plsatin/iciwebface">here</a> . <br><br>  Using the <a href="https://getmdl.io/">Material Design Lite</a> styles, our web interface will look like this: <br><br><div class="spoiler">  <b class="spoiler_title">Host list</b> <div class="spoiler_text"><img alt="Host list" src="https://habrastorage.org/files/edb/106/4c5/edb1064c5fd845bfbb772aa120f0e902.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">The list of hosts with the mapping is not available one of them</b> <div class="spoiler_text"><img alt="The list of hosts with the mapping is not available one of them" src="https://habrastorage.org/files/035/da4/d9d/035da4d9da434267af8cdda40438ba9c.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Detailed Host Information</b> <div class="spoiler_text"><img alt="Detailed Host Information" src="https://habrastorage.org/files/1f7/a6f/198/1f7a6f198a4d462a9c287d3b858ede17.png"><br></div></div><br><br>  For this option with minimal icinga2 functionality, you can think of many applications.  For example, not large projects, maintenance of unrelated computers by an individual, or integration into existing technical support systems (HelpDesk).  Maybe next time we will teach our Windows hosts to download the scripts signed by powershell and execute them on our demand, monitor other computers without an installed agent, network active equipment and all this with minimal cost, but with great potential for scaling and expanding functionality. <br><br><h4>  Links </h4><br>  <a href="http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/getting-started">Official documentation icinga2 - Installation</a> <br>  <a href="http://docs.icinga.org/icinga2/snapshot/doc/module/icinga2/chapter/icinga2-api">Official documentation icinga2 - API</a> </div><p>Source: <a href="https://habr.com/ru/post/307358/">https://habr.com/ru/post/307358/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307348/index.html">How to gain courage and open a store</a></li>
<li><a href="../307350/index.html">How I went to the States in 2000 and what happened next</a></li>
<li><a href="../307352/index.html">We draw 3D on an oscillograph</a></li>
<li><a href="../307354/index.html">All programmers think that C ++ supports OOP, except the OOP author.</a></li>
<li><a href="../307356/index.html">Network Evolution to SDN & NFV</a></li>
<li><a href="../307360/index.html">Asynchronous programming in 1C via .Net Native VK</a></li>
<li><a href="../307362/index.html">Model of watercraft interaction in video games</a></li>
<li><a href="../307364/index.html">The book "The secrets of CSS. Perfect solutions to daily tasks. ‚Äù</a></li>
<li><a href="../307366/index.html">Modified Geometry Buffer Anti-Aliasing Algorithm</a></li>
<li><a href="../307368/index.html">AI monsters and finding the way with heatmaps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>