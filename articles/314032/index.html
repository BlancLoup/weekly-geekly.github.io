<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Setting up the environment for PHP developers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article we will look at setting up the environment for PHP developers using Vagrant , Docker , Xdebug , PHPUnit , and integration with IDE PHP...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Setting up the environment for PHP developers</h1><div class="post__text post__text-html js-mediator-article">  In this article we will look at setting up the environment for <b>PHP developers</b> using <b>Vagrant</b> , <b>Docker</b> , <b>Xdebug</b> , <b>PHPUnit</b> , and integration with <b>IDE PHPStorm</b> . <br><br><img height="120" src="https://habrastorage.org/files/102/04d/e2e/10204de2e84644048814d300cddafdbf.png">  + <img height="64" src="https://habrastorage.org/files/7c2/d20/6c8/7c2d206c893e420eb002553c21370331.png"><br><br><h3>  Requirements </h3><br><ul><li>  The environment must be deployed on <b>Windows</b> , <b>MacOS</b> , <b>Linux</b> </li><li>  Installation should be as simple as possible. </li><li>  Quick work with file system </li><li>  <b>IDE PHPStorm integration</b> </li><li>  Several versions of <b>PHP</b> interpreters ( <b>5.6, 7.0</b> ) </li></ul><br><a name="habracut"></a><br><h3>  Training </h3><br>  We will not focus on installing the necessary tools for certain operating systems, installation instructions are on the official websites, links are attached. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  Install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a> </li><li>  Install <a href="https://www.docker.com/products/docker-toolbox">Docker Toolbox</a> </li><li>  Install <a href="https://www.vagrantup.com/downloads.html">Vagrant</a> </li></ul><br><h3>  What is included in the assembly? </h3><br><ul><li>  Nginx </li><li>  MySQL 5 (Percona) </li><li>  MongoDB 3 </li><li>  Redis 3 </li><li>  PHP 5.6, 7.0 CLI + FPM </li></ul><br>  <b>Php extensions</b> <br><br><div class="spoiler">  <b class="spoiler_title">5.6</b> <div class="spoiler_text"><ul><li>  cli </li><li>  fpm </li><li>  bcmath </li><li>  gd </li><li>  gmp </li><li>  intl </li><li>  mbstring </li><li>  mcrypt </li><li>  pdo </li><li>  mysqlnd </li><li>  crypto </li><li>  geoip </li><li>  imagick </li><li>  jsonc </li><li>  memcache </li><li>  memcached </li><li>  mongodb </li><li>  ssh2 </li><li>  xdebug </li><li>  soap </li><li>  xml </li><li>  opcache </li><li>  redis </li></ul></div></div><div class="spoiler">  <b class="spoiler_title">7.0</b> <div class="spoiler_text"><ul><li>  cli </li><li>  fpm </li><li>  bcmath </li><li>  gd </li><li>  gmp </li><li>  intl </li><li>  mbstring </li><li>  mcrypt </li><li>  pdo </li><li>  mysqlnd </li><li>  crypto </li><li>  geoip </li><li>  imagick </li><li>  memcache </li><li>  memcached </li><li>  mongodb </li><li>  ssh2 </li><li>  xdebug </li><li>  soap </li><li>  xml </li><li>  opcache </li><li>  redis </li></ul></div></div><br><h3>  Setup and Configuration </h3><br>  <b>Attention!</b>  All described settings and files are uploaded to <a href="https://github.com/Gurukami/dockrant">GitHub</a> .  If you have any questions about using <b>Vagrant</b> or <b>Docker,</b> refer to the official documentation. <br><br>  The deployment of the environment is slightly different on different operating systems: <br><br><ul><li>  <b>MacOS</b> everything goes as expected without additional action. </li><li>  <b>Windows</b> needs to run the <b>hosts ‚Äì set.cmd</b> helper script to set the rights for the current user to write to the <b>hosts</b> file before running <b>vagrant up</b> , also if your current user name contains any <b>non-ACSII characters</b> , then you will have to change the path to your <b>vagrant</b> working directory <b>. d</b> using the <b>VAGRANT_HOME</b> environment <b>variable</b> .  If there is no NFS in your OS, install it additionally, you can <b>use the</b> <a href="https://github.com/winnfsd/vagrant-winnfsd">vagrant-winnfsd</a> <b>vagrant</b> plugin. </li><li>  <b>Linux is</b> at your discretion, you can put <b>Vagrant</b> with <b>NFS</b> server or just use <b>docker-compose</b> instructions. </li></ul><br><div class="spoiler">  <b class="spoiler_title">hosts-set.cmd</b> <div class="spoiler_text"><pre><code class="hljs perl">@if (<span class="hljs-number"><span class="hljs-number">1</span></span>==<span class="hljs-number"><span class="hljs-number">1</span></span>) @if(<span class="hljs-number"><span class="hljs-number">1</span></span>==<span class="hljs-number"><span class="hljs-number">0</span></span>) @ELSE @echo off&amp;SETLOCAL ENABLEEXTENSIONS &gt;nul <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;&amp;<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">"%SYSTEMROOT%\system32\cacls.exe"</span></span> <span class="hljs-string"><span class="hljs-string">"%SYSTEMROOT%\system32\config\system"</span></span>||( cscript //E:JScript //nologo <span class="hljs-string"><span class="hljs-string">"%~f0"</span></span> @goto :EOF ) CACLS %SystemRoot%\system32\drivers\etc\hosts /E /G %USERNAME%:W @goto :EOF @end @ELSE ShA=new ActiveXObject(<span class="hljs-string"><span class="hljs-string">"Shell.Application"</span></span>) ShA.ShellExecute(<span class="hljs-string"><span class="hljs-string">"cmd.exe"</span></span>,<span class="hljs-string"><span class="hljs-string">"/c \""</span></span>+WScript.ScriptFullName+<span class="hljs-string"><span class="hljs-string">"\""</span></span>,<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"runas"</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); WScript.Sleep(<span class="hljs-number"><span class="hljs-number">500</span></span>) @end</code> </pre> </div></div><br>  The guest OS will work on <b>Ubuntu 14.04 (Trusty)</b> , the static IP address is <b>10.0.0.2</b> and we will use <b>NFS</b> mount as the share folder. <br><br>  For convenience, create a folder called <b>dockrant</b> (Docker + Vagrant = Dockrant), later in the article we will build on this folder. <br><br>  Determine the folder structure: <br><br><blockquote>  <b>./dockrant</b> is our root folder <br>  <b>./dockrant/ssh</b> - SSH keys for guest OS (in this tutorial we use standard vagrant keys) <br>  <b>./dockrant/share</b> - share-folder between the host and guest OS <br>  <b>./dockrant/share/tools</b> - folder with our tools and bash scripts <br>  <b>./dockrant/vagrant/build</b> - executable bash scripts when raising the guest OS </blockquote><br>  Now we need to put all the necessary scripts and instructions for the folder structure described above, let's go through the list. <br><br>  <b>./dockrant/ssh</b> - we put two files <b>id_rsa</b> (private key) and <b>id_rsa.pub</b> (public key) <br><br><div class="spoiler">  <b class="spoiler_title">id_rsa</b> <div class="spoiler_text"><pre> <code class="hljs delphi">-----<span class="hljs-keyword"><span class="hljs-keyword">BEGIN</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY----- MIIEogIBAAKCAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr+kz4TjGYe7gHzI w+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoP kcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2 hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+GPXQ2MWZWFYbAGjyiYJnAmCP3NO Td0jMZEnDkbUvxhMmBYSdETk1rRgm+R4LOzFUGaHqHDLKLX+FIPKcF96hrucXzcW yLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQIBIwKCAQEA4iqWPJXtzZA68mKd ELs4jJsdyky+ewdZeNds5tjcnHU5zUYE25K+ffJED9qUWICcLZDc81TGWjHyAqD1 Bw7XpgUwFgeUJwUlzQurAv+/ySnxiwuaGJfhFM1CaQHzfXphgVml+fZUvnJUTvzf TK2Lg6EdbUE9TarUlBf/xPfuEhMSlIE5keb/Zz3/LUlRg8yDqz5w+QWVJ4utnKnK iqwZN0mwpwU7YSyJhlT4YV1F3n4YjLswM5wJs2oqm0jssQu/BT0tyEXNDYBLEF4A sClaWuSJ2kjq7KhrrYXzagqhnSei9ODYFShJu8UWVec3Ihb5ZXlzO6vdNQ1J9Xsf <span class="hljs-number"><span class="hljs-number">4</span></span>m+<span class="hljs-number"><span class="hljs-number">2</span></span>ywKBgQD6qFxx/Rv9CNN96l/<span class="hljs-number"><span class="hljs-number">4</span></span>rb14HKirC2o/orApiHmHDsURs5rUKDx0f9iP cXN7S1uePXuJRK/<span class="hljs-number"><span class="hljs-number">5</span></span>hsubaOCx3Owd2u9gD6Oq0CsMkE4CUSiJcYrMANtx54cGH7Rk EjFZxK8xAv1ldELEyxrFqkbE4BKd8QOt414qjvTGyAK+OLD3M2QdCQKBgQDtx8pN CAxR7yhHbIWT1AH66+XWN8bXq7l3RO/ukeaci98JfkbkxURZhtxV/HHuvUhnPLdX <span class="hljs-number"><span class="hljs-number">3</span></span>TwygPBYZFNo4pzVEhzWoTtnEtrFueKxyc3+LjZpuo+mBlQ6ORtfgkr9gBVphXZG YEzkCD3lVdl8L4cw9BVpKrJCs1c5taGjDgdInQKBgHm/fVvv96bJxc9x1tffXAcj <span class="hljs-number"><span class="hljs-number">3</span></span>OVdUN0UgXNCSaf/<span class="hljs-number"><span class="hljs-number">3</span></span>A/phbeBQe9xS+<span class="hljs-number"><span class="hljs-number">3</span></span>mpc4r6qvx+iy69mNBeNZ0xOitIjpjBo2+ dBEjSBwLk5q5tJqHmy/jKMJL4n9ROlx93XS+njxgibTvU6Fp9w+NOFD/HvxB3Tcz <span class="hljs-number"><span class="hljs-number">6</span></span>+jJF85D5BNAG3DBMKBjAoGBAOAxZvgsKN+JuENXsST7F89Tck2iTcQIT8g5rwWC P9Vt74yboe2kDT531w8+egz7nAmRBKNM751U/<span class="hljs-number"><span class="hljs-number">95</span></span>P9t88EDacDI/Z2OwnuFQHCPDF llYOUI+SpLJ6/vURRbHSnnn8a/XG+nzedGH5JGqEJNQsz+xT2axM0/W/CRknmGaJ kda/AoGANWrLCz708y7VYgAtW2Uf1DPOIYMdvo6fxIB5i9ZfISgcJ/bbCUkFrhoH +vq/<span class="hljs-number"><span class="hljs-number">5</span></span>CIWxCPp0f85R4qxxQ5ihxJ0YDQT9Jpx4TMss4PSavPaBH3RXow5Ohe+bYoQ NE5OgEXk2wVfZczCZpigBKbKZHNYcelXtTt/nP3rsCuGcM4h53s= -----<span class="hljs-keyword"><span class="hljs-keyword">END</span></span> RSA <span class="hljs-keyword"><span class="hljs-keyword">PRIVATE</span></span> KEY-----</code> </pre> </div></div><div class="spoiler">  <b class="spoiler_title">id_rsa.pub</b> <div class="spoiler_text"><pre> <code class="hljs swift">ssh-rsa <span class="hljs-type"><span class="hljs-type">AAAAB3NzaC1yc2EAAAABIwAAAQEA6NF8iallvQVp22WDkTkyrtvp9eWW6A8YVr</span></span>+kz4TjGYe7gHzIw+niNltGEFHzD8+v1I2YJ6oXevct1YeS0o9HZyN1Q9qgCgzUFtdOKLv6IedplqoPkcmF0aYet2PkEDo3MlTBckFXPITAMzF8dJSIFo9D8HfdOV0IAdx4O7PtixWKn5y2hMNG0zQPyUecp4pzC6kivAIhyfHilFR61RGL+<span class="hljs-type"><span class="hljs-type">GPXQ2MWZWFYbAGjyiYJnAmCP3NOTd0jMZEnDkbUvxhMmBYSdETk1rRgm</span></span>+<span class="hljs-type"><span class="hljs-type">R4LOzFUGaHqHDLKLX</span></span>+<span class="hljs-type"><span class="hljs-type">FIPKcF96hrucXzcWyLbIbEgE98OHlnVYCzRdK8jlqm8tehUc9c9WhQ</span></span>== vagrant insecure <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> key</code> </pre> </div></div><br>  <b>./dockrant/share/</b> - we will create a phpinfo.php file with the phpinfo () function, so that we can check the performance <br><br><div class="spoiler">  <b class="spoiler_title">phpinfo.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> phpinfo();</code> </pre></div></div><br>  <b>./dockrant/share/tools/</b> - put a few helper scripts to run PHP interpreters from under Docker exec and <b>PHPUnit</b> (download from <a href="https://phpunit.de/">phpunit.phar</a> ) <br><br><div class="spoiler">  <b class="spoiler_title">php56</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash CMD="export IDE_PHPUNIT_PHPUNIT_PHAR='$IDE_PHPUNIT_PHPUNIT_PHAR'" CMD+=" &amp;&amp; export IDE_PHPUNIT_VERSION='$IDE_PHPUNIT_VERSION'" CMD+=" &amp;&amp; export SSH_CLIENT='$SSH_CLIENT'" CMD+=" &amp;&amp; export JETBRAINS_REMOTE_RUN='$JETBRAINS_REMOTE_RUN'" CMD+=" &amp;&amp; export DEBUG_CONFIG='$XDEBUG_CONFIG'" CMD+=" &amp;&amp; export XDEBUG_CONFIG='$XDEBUG_CONFIG'" CMD+=" &amp;&amp; php56 $@" docker exec share_php_1 bash -c "$CMD"</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">php56tty</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash CMD+="php56 $@" docker exec -t -i share_php_1 bash -c "$CMD"</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">php70</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash CMD="export IDE_PHPUNIT_PHPUNIT_PHAR='$IDE_PHPUNIT_PHPUNIT_PHAR'" CMD+=" &amp;&amp; export IDE_PHPUNIT_VERSION='$IDE_PHPUNIT_VERSION'" CMD+=" &amp;&amp; export SSH_CLIENT='$SSH_CLIENT'" CMD+=" &amp;&amp; export JETBRAINS_REMOTE_RUN='$JETBRAINS_REMOTE_RUN'" CMD+=" &amp;&amp; export DEBUG_CONFIG='$XDEBUG_CONFIG'" CMD+=" &amp;&amp; export XDEBUG_CONFIG='$XDEBUG_CONFIG'" CMD+=" &amp;&amp; php70 $@" docker exec share_php_1 bash -c "$CMD"</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">php70tty</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash CMD+="php70 $@" docker exec -t -i share_php_1 bash -c "$CMD"</span></span></code> </pre></div></div><br>  For <b>php *</b> scripts, we do not use TTY, these scripts are needed to correctly configure integration with the IDE in using remote interpreters, <b>php * tty</b> scripts are needed to manually use the launch of PHP scripts, including in the interactive mode <b>php -a</b> . <br><br>  <b>./dockrant/vagrant/build/php/</b> - we put the <b>init.sh</b> bash script to copy executable files running PHP interpreters. <br><br><div class="spoiler">  <b class="spoiler_title">init.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash cp /share/tools/php56 /usr/bin/php56 &amp;&amp; chmod +x /usr/bin/php56 cp /share/tools/php70 /usr/bin/php70 &amp;&amp; chmod +x /usr/bin/php70 cp /share/tools/php56tty /usr/bin/php56tty &amp;&amp; chmod +x /usr/bin/php56tty cp /share/tools/php70tty /usr/bin/php70tty &amp;&amp; chmod +x /usr/bin/php70tty</span></span></code> </pre></div></div><br>  <b>./dockrant/vagrant/build/docker/</b> - we put <b>init.sh</b> and <b>docker-compose.sh</b> bash scripts to install docker-compose and container assembly commands when raising the guest OS. <br><br><div class="spoiler">  <b class="spoiler_title">init.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash /usr/local/bin/docker-compose -f /share/docker-compose.yml build /usr/local/bin/docker-compose -f /share/docker-compose.yml up -d</span></span></code> </pre></div></div><div class="spoiler">  <b class="spoiler_title">docker-compose.sh</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash curl -L https://github.com/docker/compose/releases/download/1.8.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose chmod +x /usr/local/bin/docker-compose</span></span></code> </pre></div></div><br><h2>  Docker-compose </h2><br>  Create the file <b>./dockrant/share/docker-compose.yml</b> <br><br>  Now we will describe the instructions for creating docker containers, we will not describe the instructions for assembling each image, we will take ready. <br><br>  We collect from the following images: <br><br><ul><li>  redis: 3 </li><li>  percona: 5 </li><li>  gurukami / php: 5.6 </li><li>  gurukami / php: 7.0 (FPM is used by default) </li><li>  gurukami / nginx </li><li>  mongo: 3 </li></ul><br><div class="spoiler">  <b class="spoiler_title">docker-compose.yml</b> <div class="spoiler_text"><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">services:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">redis:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">redis:</span></span><span class="hljs-number"><span class="hljs-number">3.0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mysql:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">percona:</span></span><span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-symbol"><span class="hljs-symbol">environment:</span></span> - MYSQL_ROOT_PASSWORD=gurukami <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/share:/share</span></span> <span class="hljs-symbol"><span class="hljs-symbol">php56:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> gurukami/<span class="hljs-symbol"><span class="hljs-symbol">php:</span></span><span class="hljs-number"><span class="hljs-number">5.6</span></span> <span class="hljs-symbol"><span class="hljs-symbol">links:</span></span> - mysql - mongo - redis <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/share:/share</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/home:/home</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/tmp/</span></span> <span class="hljs-symbol"><span class="hljs-symbol">php:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> gurukami/<span class="hljs-symbol"><span class="hljs-symbol">php:</span></span><span class="hljs-number"><span class="hljs-number">7.0</span></span> <span class="hljs-symbol"><span class="hljs-symbol">links:</span></span> - mysql - mongo - redis <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/share:/share</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/home:/home</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/tmp/</span></span><span class="hljs-symbol"><span class="hljs-symbol">:/tmp/</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mongo:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">mongo:</span></span><span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-symbol"><span class="hljs-symbol">ports:</span></span> - <span class="hljs-string"><span class="hljs-string">"27017:27017"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">nginx:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">image:</span></span> gurukami/<span class="hljs-symbol"><span class="hljs-symbol">nginx:</span></span>latest <span class="hljs-symbol"><span class="hljs-symbol">depends_on:</span></span> - php <span class="hljs-symbol"><span class="hljs-symbol">links:</span></span> - php <span class="hljs-symbol"><span class="hljs-symbol">ports:</span></span> - <span class="hljs-string"><span class="hljs-string">"80:80"</span></span> - <span class="hljs-string"><span class="hljs-string">"443:443"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - <span class="hljs-regexp"><span class="hljs-regexp">/share:/share</span></span></code> </pre></div></div><br><h2>  Vagrantfile </h2><br>  Create a <b>Vagrantfile</b> file in the <b>dockrant</b> folder and write the following instructions there <br><br><div class="spoiler">  <b class="spoiler_title">Vagrantfile</b> <div class="spoiler_text"><pre> <code class="ruby hljs">Vagrant.require_version <span class="hljs-string"><span class="hljs-string">"&gt;= 1.8.6"</span></span> required_plugins = <span class="hljs-string"><span class="hljs-string">%w(vagrant-hostsupdater)</span></span> plugins_to_install = required_plugins.select { <span class="hljs-params"><span class="hljs-params">|plugin|</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> Vagrant.has_plugin? plugin } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> plugins_to_install.empty? puts <span class="hljs-string"><span class="hljs-string">"Installing plugins: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{plugins_to_install.join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">' '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> system <span class="hljs-string"><span class="hljs-string">"vagrant plugin install </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{plugins_to_install.join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">' '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span> exec <span class="hljs-string"><span class="hljs-string">"vagrant </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{ARGV.join(</span></span><span class="hljs-string"><span class="hljs-string"><span class="hljs-subst"><span class="hljs-string">' '</span></span></span></span><span class="hljs-string"><span class="hljs-subst">)}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> abort <span class="hljs-string"><span class="hljs-string">"Installation of one or more plugins has failed. Aborting."</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> Vagrant.configure(<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|config|</span></span> config.vm.box = <span class="hljs-string"><span class="hljs-string">"ubuntu/trusty64"</span></span> config.vm.hostname = <span class="hljs-string"><span class="hljs-string">"gurukami.local"</span></span> config.ssh.insert_key = <span class="hljs-literal"><span class="hljs-literal">false</span></span> config.hostsupdater.aliases = [ <span class="hljs-string"><span class="hljs-string">"sandbox.local"</span></span> ] config.nfs.map_uid = Process.uid config.nfs.map_gid = Process.gid config.vm.network <span class="hljs-symbol"><span class="hljs-symbol">:private_network</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">ip:</span></span> <span class="hljs-string"><span class="hljs-string">"10.0.0.2"</span></span> config.vm.network <span class="hljs-symbol"><span class="hljs-symbol">:forwarded_port</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">guest:</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">host:</span></span> <span class="hljs-number"><span class="hljs-number">2202</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> <span class="hljs-string"><span class="hljs-string">"ssh"</span></span> config.vm.provider <span class="hljs-symbol"><span class="hljs-symbol">:virtualbox</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|vb|</span></span> vb.customize [<span class="hljs-string"><span class="hljs-string">"modifyvm"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:id</span></span>, <span class="hljs-string"><span class="hljs-string">"--natdnshostresolver1"</span></span>, <span class="hljs-string"><span class="hljs-string">"on"</span></span>] vb.name = <span class="hljs-string"><span class="hljs-string">"Gurukami (Dockrant)"</span></span> vb.memory = <span class="hljs-number"><span class="hljs-number">1024</span></span> vb.cpus = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"fix-no-tty"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">type:</span></span> <span class="hljs-string"><span class="hljs-string">"shell"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|s|</span></span> s.privileged = <span class="hljs-literal"><span class="hljs-literal">false</span></span> s.inline = <span class="hljs-string"><span class="hljs-string">"sudo sed -i '/tty/!s/mesg n/tty -s \\&amp;\\&amp; mesg n/' /root/.profile"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"shell"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">inline:</span></span> <span class="hljs-string"><span class="hljs-string">'mkdir /vagrant'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">run:</span></span> <span class="hljs-string"><span class="hljs-string">"once"</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"shell"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">inline:</span></span> <span class="hljs-string"><span class="hljs-string">'echo "nameserver 8.8.8.8" &gt;&gt; /etc/resolv.conf'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">run:</span></span> <span class="hljs-string"><span class="hljs-string">"always"</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"shell"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">path:</span></span> <span class="hljs-string"><span class="hljs-string">'./vagrant/build/php/init.sh'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">run:</span></span> <span class="hljs-string"><span class="hljs-string">"once"</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"shell"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">path:</span></span> <span class="hljs-string"><span class="hljs-string">'./vagrant/build/docker/docker-compose.sh'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">run:</span></span> <span class="hljs-string"><span class="hljs-string">"once"</span></span> config.vm.provision <span class="hljs-symbol"><span class="hljs-symbol">:docker</span></span> config.vm.provision <span class="hljs-string"><span class="hljs-string">"shell"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">path:</span></span> <span class="hljs-string"><span class="hljs-string">'./vagrant/build/docker/init.sh'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">run:</span></span> <span class="hljs-string"><span class="hljs-string">"always"</span></span> config.vm.synced_folder <span class="hljs-string"><span class="hljs-string">"."</span></span>, <span class="hljs-string"><span class="hljs-string">"/vagrant"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">disabled:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> config.vm.synced_folder <span class="hljs-string"><span class="hljs-string">"./share"</span></span>, <span class="hljs-string"><span class="hljs-string">"/share"</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">nfs:</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">nfs_udp:</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br></div></div><br>  Tuning: <br><br><ul><li>  If necessary, sharing can add the option <b>config.vm.network: public_network</b> to raise on the public interface or use <a href="https://www.vagrantup.com/docs/share/">vagrant share</a> </li><li>  Increase the use of allocated memory <b>vb.memory</b> , the default is <b>1024 MB</b> </li><li>  Increase the number of used processors <b>vb.cpus</b> , the default is <b>2</b> </li></ul><br><h3>  Launch </h3><br>  In the <b>dockrant</b> folder <b>,</b> run the command <br><br><pre> <code class="bash hljs">vagrant up --provider virtualbox</code> </pre> <br>  After assembly, open in the browser - <a href="http://sandbox.local/phpinfo.php">sandbox.local / phpinfo.php</a> <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/files/b76/bd3/77e/b76bd377e2f34e5c9e8996a24ac65ff5.png"></div><br><h3>  Docker-machine </h3><br>  In order for our virtual machine to work as a <b>docker-machine,</b> we need to add it using the <b>generic</b> driver, run from the <b>dockrant</b> folder <br><br><pre> <code class="bash hljs">docker-machine create --driver generic --generic-ip-address=10.0.0.2 --generic-ssh-key ./ssh/id_rsa --generic-ssh-user vagrant sandbox</code> </pre> <br>  After creating the <b>docker-machine</b> , the guest machine needs to be rebooted, because  after installation all docker containers stop <br><br><pre> <code class="bash hljs">vagrant reload</code> </pre> <br><h3>  PHP CLI </h3><br>  PHP scripts are run on the guest machine ( <b>10.0.0.2</b> ), remember that there is a <b>/ share</b> folder between the host machine and the guest one. <br><br><pre> <code class="php hljs">php56 /path/to/file php70 /path/to/file</code> </pre><br>  Running PHP interpreters online <br><br><pre> <code class="php hljs">php56tty -a php70tty -a</code> </pre><br><h3>  PHPStorm Integration </h3><br>  We set up a debugger using <b>XDebug</b> , screw <b>PHPUnit</b> and add management of our containers through the <a href="https://plugins.jetbrains.com/plugin/7724">Docker Integration</a> plugin, with which you can view the logs of our services, reload containers, execute scripts. <br><br>  Add our PHP interpreters to the settings, open the Settings <b>Languages ‚Äã‚Äã&amp; Frameworks ‚Üí PHP</b> settings <br><br><img src="https://habrastorage.org/files/dc6/e2a/c0a/dc6e2ac0ac1b46a099e16f16d6e3dada.png"><br><br>  We first add version 5.6, then repeat for version 7.0, click on the button <b>...</b> <br><br>  Then clicking on <b>+</b> select <b>Remote ...</b> <br><br><img width="200" src="https://habrastorage.org/files/a05/57d/fe0/a0557dfe02fe4f0c907761a1c7d0cd04.png"><br><br>  In the pop-up window, select the <b>Vagrant</b> type and specify the path to the PHP interpreter on the guest OS <b>/ usr / bin / php56</b> <br><br><div style="text-align:center;"><img width="400" src="https://habrastorage.org/files/421/375/649/4213756491b34cf58d51f35fe5dfec37.png"></div><br><img src="https://habrastorage.org/files/75b/61b/b0b/75b61bb0b27141ebbff8ee5804ae271d.png"><br><br>  Now we will add our remote server to the list for working with the debugger on request from the browser <br>  <b>Language &amp; Frameworks ‚Üí PHP ‚Üí Servers</b> .  Let's assign the <b>path mappings</b> to our <b>/ share</b> folder so that the IDE can recognize requests for paths between the host machine and the guest. <br><br><img src="https://habrastorage.org/files/8d8/124/8a9/8d81248a92d5400d8e7d897cb25a4e6a.png"><br><br>  Set up <b>PHPUnit</b> , go to <b>Language &amp; Frameworks ‚Üí PHP ‚Üí PHPUnit</b> settings and for each PHP version of the interpreter, write the path to /share/tools/phpunit.phar <br><br><img src="https://habrastorage.org/files/95c/f6f/a4c/95cf6fa4c75949008d7541975558824f.png"><br><br><img src="https://habrastorage.org/files/4ce/0a0/8a3/4ce0a08a305d46f7864127143a55ded4.png"><br><br>  We are almost ready to debug our application, but we still have to configure launch configurations. <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/5bb/f06/ac4/5bbf06ac4166437494717c9386c0e442.png"></div><br>  Configure <b>PHP Remote Debug</b> <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/a98/934/72d/a9893472d66b477791b9fc660d5bd3fb.png"></div><br><br><img src="https://habrastorage.org/files/957/16b/f5f/95716bf5fb4e41dea66309889432b626.png"><br><br>  Put a <b>breakpoint</b> for example in the <b>phpinfo.php</b> file on line 2, launch the debugger, go to the <a href="http://sandbox.local/phpinfo.php">sandbox.local / phpinfo.php</a> page in the browser and see that our debugger worked in the IDE <br><br><img src="https://habrastorage.org/files/d43/114/586/d431145867db4ad69141bc8b8d4e8816.png"><br><br><img width="200" src="https://habrastorage.org/files/183/1db/0b1/1831db0b1ec844abbdbd6b37727b4309.png"><br><br><img src="https://habrastorage.org/files/709/82f/417/70982f417a6348e98e857bc9ee7344d9.png"><br><br>  Now for <b>PHPUnit</b> <br><br><div style="text-align:center;"><img width="200" src="https://habrastorage.org/files/91f/849/e8a/91f849e8adb14b48b75111352b33956d.png"></div><br>  Create a simple Unit test file called <b>Test.php</b> in the <b>./dockrant/share</b> folder <br><br><div class="spoiler">  <b class="spoiler_title">Test.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Framework_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertTrue(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } }</code> </pre></div></div><br>  Configure launch configuration <br><br><img src="https://habrastorage.org/files/622/4b1/ad3/6224b1ad3ff44368b4bf5465294e52c5.png"><br><br>  Run <b>unit test</b> <br><br><img width="200" src="https://habrastorage.org/files/d97/aca/415/d97aca41534a4eef9646a9b13a4d4d62.png"><br><br><img src="https://habrastorage.org/files/d34/b57/aef/d34b57aefe6949c1be5e09a5670a230f.png"><br><br>  You can also run <b>Unit test</b> with debugger <br><br><img width="200" src="https://habrastorage.org/files/01a/48a/894/01a48a89442e479cb964afc150ce9b28.png"><br><br><img src="https://habrastorage.org/files/1da/746/1bb/1da7461bb37b4a71a6e9ddd5a2361862.png"><br><br>  Now we will configure the <a href="https://plugins.jetbrains.com/plugin/7724">Docker Integration</a> plugin, after installing the plugin, we need to add our machine in the <b>Build, Execution, Deployment ‚Üí Docker</b> settings <b>,</b> as a rule, the <b>docker-machines</b> folders are in your home directory of the current user, we need a <b>sandbox</b> docker-machine that we created according to the instructions above using <b>generic</b> driver <br><br><img src="https://habrastorage.org/files/735/d52/022/735d520221994df089eef84fcd92c624.png"><br><br>  Below the <b>Docker</b> tab will be shown after restarting the IDE. <br><br><img src="https://habrastorage.org/files/16b/5d4/f89/16b5d4f89fb34b2a9c1d6abd6e139cf8.png"><br><br><h3>  Total </h3><br>  We have an environment with a full set of necessary services and utilities deployed on most operating systems. <br><br>  The deployment of the environment was tested on: <br><br><ul><li>  <b>Windows 10</b> </li><li>  <b>MacOS Sierra 10.12</b> </li><li>  <b>Ubuntu 14.04 Desktop</b> </li></ul><br>  Thanks for reading, I hope this article will help you organize a comfortable environment. </div><p>Source: <a href="https://habr.com/ru/post/314032/">https://habr.com/ru/post/314032/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314022/index.html">How to make virtual infrastructure more accessible</a></li>
<li><a href="../314024/index.html">Huawei Hosting Platform</a></li>
<li><a href="../314026/index.html">Print support promised a year ago appeared in ReactOS</a></li>
<li><a href="../314028/index.html">Studying Retrofit 2</a></li>
<li><a href="../314030/index.html">How to stop being afraid and fall in love with syntactic analysis?</a></li>
<li><a href="../314034/index.html">We are creating a news site using Flexbox</a></li>
<li><a href="../314038/index.html">How to turn a smartphone into a microphone (ideas and questions)</a></li>
<li><a href="../314040/index.html">How to find a vector of software development? Planning as a science</a></li>
<li><a href="../314042/index.html">Time is money, or arguments for and against hourly pay.</a></li>
<li><a href="../314044/index.html">Finding errors in the LLVM project code using the PVS-Studio analyzer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>