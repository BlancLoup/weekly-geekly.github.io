<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we played with neural networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In 2016, Google Brain Group released the Magenta open access project. Magenta is positioned as a project that asks and answers the questions: ‚ÄúCan we ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we played with neural networks</h1><div class="post__text post__text-html js-mediator-article">  In 2016, Google Brain Group released the Magenta open access project.  Magenta is positioned as a project that asks and answers the questions: ‚ÄúCan we use machine learning to create music and art worthy of attention?  If so, how?  If not, why not? ‚Äù  The second goal of the project is to build a community of artists, musicians and researchers in the field of machine learning. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/trKNbUqdYzA" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><a name="habracut"></a><br>  Why not, really.  There was also a reason: to make a small performance at the opening of the TopConf conference. <br><br>  Hi, my name is Alexander Tavgen.  I am an architect at Playtech, and I still like to play constructor.  True, the designer is a little more complicated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I offered to try to connect the music and the car to Alexander Zhedelev aka <a href="http://faershtein.com/">Faershtein</a> , a composer and music producer of the Russian Theater in Estonia.  Rather, the project <a href="http://faershtein.com/2017/07/19/modulshtein/">MODULSHTEIN (Alexander Zhedelev, Martin Altrov and Alexei Seminihin)</a> .  My thoughts for a long time have been implicitly trying to combine MIDI and char-based models.  We are very well supported by the company Playtech, for which she thanks a lot.  We had about two months to realize our attempt.  And this is very little, considering that we live in different cities and work according to the main types of activity. <br><br>  In this regard, the famous <a href="http://karpathy.github.io/2015/05/21/rnn-effectiveness/">article by</a> Andrej Karpathy is a great introduction to the principles behind recurrent neural networks, and there are excellent examples.  That there is only one network, trained on the source code of Linux.  Or a <a href="https://habrahabr.ru/post/326966/">model trained on the speeches of Donald Trump</a> , which I wrote about in the spring. <br><br>  In general, recurrent neural networks show quite satisfactory results for temporal data with a certain structure. <br><br>  Take the language.  The structure of the language has several dimensions.  One of them is semantic, to which machines are only matched.  For example, <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D0%25B8%25D1%2582%25D0%25B0%25D0%25B9%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25BA%25D0%25BE%25D0%25BC%25D0%25BD%25D0%25B0%25D1%2582%25D0%25B0">Searle‚Äôs ‚ÄúChinese Room‚Äù argument</a> no longer looks so convincing in relation to <a href="http://jmlr.org/papers/volume15/srivastava14b/srivastava14b.pdf">Multimodal Training</a> . <br><br>  Another dimension, syntactic, is already quite capable.  Recurrent neural networks take into account the previous context and can store a state.  And it was fun to watch in practice, but more on that below.  We can feed the model a large amount of text and ask to predict the probability of obtaining the following letters.  For example, after the letters 'I lov', with a very high probability there will be 'e', ‚Äã‚Äãbut after the letters 'I love', it is no longer obvious - maybe 'y', 'h' or other. <br><br>  Music, as a rule, has a certain structure.  This is a rhythm, intervals, dynamics.  If you simulate a music sequence as a set of certain characters, then recurrent neural networks are suitable for this purpose perfectly.  MIDI file format is ideal for this.  While I was thinking about how this can be done, and I have been looking at the MIDI libraries on Python, I came across the Magenta project. <br><br>  In essence, Magenta provides a MIDI interface for TensorFlow models.  Virtual MIDI ports are created for call-response, roughly speaking, input and output.  You can run multiple parallel ports.  For each pair of ports you can connect the model TensorFlow.  The so-called bundle file is the checkpoint of the training and the metadata of the graph from TensorFlow.  Briefly, the interaction process can be described as follows. <br><br><img src="https://habrastorage.org/webt/jx/wc/vr/jxwcvr-vhe-w5wjqci8issowvay.png"><br><br>  The signals pass through the MIDI interface, and are converted to the NoteSequence format.  This is a protocol buffers format for exchanging data with models.  Training data can be downloaded <a href="http://colinraffel.com/projects/lmd/">from here</a> , or take a pretrained model, and continue learning from it. <br><br>  At first, I thought of training from scratch, but first there were problems with the amount of data for the training, and secondly, when I tried to run Magenta on Amazon, for instance with the GPU, there were problems with hanging at different stages of the training.  The problems were with the amount of data for training from scratch, and it does not make sense to train on the same dataset on which the models in the Magenta repository are trained.  Therefore, I continued with their checkpointa.  I pumped a bunch of music with broken rhythms.  From Prodigy - Outer of Space and Goldie - Inner City Life to Massive Attack. <br><br>  At Magenta Project Github, there are already tools for extracting different sections, such as drums and tunes from prepared note sequences.  LSTM recurrent network was used, 2 layers of 128 elements, the last 2 bars were taken into account.  Training time is about 4 days on a laptop.  However, the gradient descended very slowly, and I cannot say whether it was a descent at the end, or an oscillation around a local minimum. <br><br>  We now turn to how this all was connected further.  Checkpoints were linked into a bundle file, and two models were loaded at the start, each with its own pair of virtual ports.  Let's call them magenta_in / out 1 and 2. Now we need to connect all this with live musicians.  Alexander Zhedelev used Ableton as a universal glue. <br><br>  The Magenta project site has an example of how to link Ableton using MaxMSP, but this option was dropped, as MaxMSP crashed and crashed.  If something can be thrown out of the system without interfering with work, then boldly throw it away. <br><br>  Alexander Zhedelev conjured with Ableton.  We had some minor problems with the overall synchronization of Magenta and Ableton via midi_clock.  In the end, we got this configuration. <br><br>  There were two models.  The first one listens to the person and gives an answer, after which the second one starts to listen to the answer by the first one and gives out his part.  There was a funny moment when we tied them in a loop (the first one listens to the second one and so on in a circle).  We left for lunch, and returned about an hour later, and they were already in full rage with each other, so to speak.  Semi-trance, semi-something, but sometimes interesting and fun. <br><br>  A person plays on an drum-pad (Ableton Push2) an example of a rhythm, a model, all the while receiving MIDI signals at the input and then, after the end of the example, after a while gives an answer.  And we noticed that the longer you play and set the length of the listened sections, the more meaningful the answer is.  Apparently this is due to the very internal state.  I can not yet fully explain to myself, too, why at the beginning the network gives options with log-likelihood -70, but over time this value drops to -150, -400, even -750.  The lower this value, the higher the maximum likelihood of the result.  That is, minimizing log-likelihood is the same as maximizing the maximum likelihood function.  At the hearing it is expressed that the model, as if played, and enters into a rage.  That is, it is clear that the model has an internal state that depends on the previous context, but over time it converges to the best generated sequences. <br><br>  In the process. <br><br><img src="https://habrastorage.org/webt/3n/dd/bk/3nddbkjeozovbgpqcbp4ad_gljw.jpeg"><br><br>  The beginning looked like this. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/yZqDzt_N-74" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  These are the very first steps and testing of various options for linking models. <br><br>  But the first real rehearsal with real people was at the moment when we decided to capture everything on video.  Playtech provided us with office space for this, and there was something in it.  Outside the window - an airport with airplanes taking off, 10th floor, evening, empty office, the sound of bass making its way to the bone.  Many thanks to Nikolai Alkhazov for his help and work, this video would not have happened without him.  The difficulty was that since it was an improvisation on the part of the models, each take was not similar to the previous ones, and this added intrigue.  And yes, good cocoa saved a life. <br><br><img src="https://habrastorage.org/webt/c5/p5/8x/c5p58xncm7lg9qtl_cohhu8wadc.jpeg"><br><br>  The rhythm section is issued by neural networks.  At different moments, Alexander plays the starter rhythms, and then the chain of improvisations unfolds. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/4ew17vuCC6g" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Since for Alexander it was important what happens in the models at any given moment, the Magenta web interface, which allows you to see and change the network settings through the browser, was very useful.  In the video, he runs from the side, like Tetris. <br><br>  Each time the results get better and better.  If you take video controlled by MIDI signals, you can theoretically connect networks with video and music, and synchronize them with each other.  The space for further searches is quite large, as are the use cases.  You can link models with each other, create loops, and get unexpected and sometimes interesting options. <br><br>  And, here, today's interview on local television. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/-7u7w2fVDzw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  It was a very interesting and unusual experience.  And there are thoughts for further direction. <br>  I would like to thank all the people who participated in the project. <br><br><ul><li>  Aleksandr Zedeljov aka <a href="http://faershtein.com/">Faershtein</a> </li><li>  <a href="http://faershtein.com/2017/07/19/modulshtein/">Marten Altrov - MODULSHTEIN</a> </li><li>  <a href="http://faershtein.com/2017/07/19/modulshtein/">Aleksej Semenihhin - MODULSHTEIN</a> </li><li>  <a href="https://www.facebook.com/nalhazov%3Fref%3Dbr_rs">Nikolay Alhazov</a> , for making this videos real </li><li>  <a href="https://soundcloud.com/missquade">Katrin Kvade</a> , sound engineering </li><li>  Playtech company </li><li>  Help and support for Marianne V√µime and Ergo J√µepere </li></ul></div><p>Source: <a href="https://habr.com/ru/post/342306/">https://habr.com/ru/post/342306/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342292/index.html">Introduction to Seneca.JS</a></li>
<li><a href="../342298/index.html">Andrei Karpov believes that the code for the Manticore project is better than the code for the Sphinx project</a></li>
<li><a href="../342300/index.html">How not to put thousands of servers using centralized configuration management using the example of CFEngine</a></li>
<li><a href="../342302/index.html">Design Template ‚ÄúMini Scenario with Contradiction Check‚Äù</a></li>
<li><a href="../342304/index.html">Interesting logical puzzles for interviews</a></li>
<li><a href="../342308/index.html">Future of wikipedia</a></li>
<li><a href="../342310/index.html">Installing Proxmox VE on Debian Stretch using Ansible</a></li>
<li><a href="../342312/index.html">Configuring Jail on FreeBSD 11.1</a></li>
<li><a href="../342314/index.html">Playing with Nextgen-antivirus from Palo Alto Networks: it injects its dll into executable processes like * .exe</a></li>
<li><a href="../342316/index.html">Actors for fun and profit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>