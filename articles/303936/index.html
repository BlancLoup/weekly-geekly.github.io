<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create your own VPS hosting from scratch and start making money on it? Simple billing with WooCommerce</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers of Habr. This article is a continuation of the cycle of materials on how to build a VPS hosting from scratch based on the RUVDS Wh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create your own VPS hosting from scratch and start making money on it? Simple billing with WooCommerce</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/8fc/d57/729/8fcd577294fb4eefadb2e70535527225.png"><br><br>  Hello, dear readers of Habr.  This article is a continuation of the cycle of materials on how to build a VPS hosting from scratch based on the <a href="https://ruvds.com/use_api">RUVDS White Label API</a> .  <a href="https://habrahabr.ru/company/ruvds/blog/301300/">In the introductory article of the cycle,</a> we talked about the fact that first of all we would need a website and offered 3 options how to create it.  We will dwell in detail on the version with the use of popular CMS and plug-ins to them, which are designed to quickly provide the necessary functionality for us to receive payments and pay for servers. <br><br>  In a series of publications, we will look at such popular CMS as Wordpress, Joomla and Drupal. <br><a name="habracut"></a><br>  Why we chose them: <br><ul><li>  Supported by almost all popular shared hosting </li><li>  <a href="http://www.webnethosting.net/10-advantages-of-php-over-other-languages/">Written in PHP</a> (low entry threshold, extensive community, lots of reference materials and freelance programmers) </li><li>  Free (to start with minimal investment is important) </li><li>  <a href="http://trends.builtwith.com/cms">Common on the internet</a> </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i><b>Disclaimer:</b> We do not claim that these CMS are the most popular or the best.</i>  <i>Also, we are not saying that PHP is the number one language and you just have to use it only.</i>  <i>You can use any technologies that are suitable for solving the problem of creating your own VPS hosting.</i>  <i>This material has been supplemented with many references to third-party sources, the contents of which we did not include in its text, otherwise it would have been less readable and consistent.</i>  <i>We hope you find them useful.</i>  <i>So let's get started.</i> <br><br>  In this article we will look at Wordpress (how to deploy Wordpress on our hosting, we described in detail in our previous article) and its WooCommerce plugin, and also find out how to adapt it for VPS hosting. <br><br>  <a href="https://wordpress.org/plugins/woocommerce/">This plugin</a> is considered to be one of the most powerful and functional free eCommerce solutions for Wordpress.  Together with him comes the specialized <a href="https://wordpress.org/themes/storefront/">Storefront</a> theme, which fully supports the latest functionality of the plug-in called ‚Äúout of the box‚Äù.  You can either use this theme with minor design modifications, or purchase a paid one for $ 50-70, for example here.  What immediately catches the eye is the presence of many extensions, including for integration with various payment aggregators, such as <a href="https://wordpress.org/plugins/robokassa-for-woocommerce/">robokassa</a> or <a href="http://info.paymaster.ru/%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D0%25B8-cms/wordpress-woo-cms/">paymaster</a> (both are free). <br><br><h3>  pros </h3><br><br><ul><li>  Ease of installation.  In the step-by-step installation process, everything is intuitive.  We load a plug-in and a subject, we activate.  Then you can immediately add products and move to more fine-tuning. </li><li>  The presence of a huge number of paid and free templates </li><li>  Easy and convenient addition of products </li><li>  Extensibility  In addition to the boxed functionality, there are many plug-in extensions that allow you to get the desired functionality. </li><li>  Free  Without many words </li><li>  Constant improvements and updates.  The plugin is being actively developed, the last commit to the repository on github was a few days ago (at the time of this writing). </li><li>  Functionality for building various reports </li><li>  Coupons, promotions out of the box </li><li>  SEO.  For goods, setting up the cnc, site maps, meta tags is available (as well as for simple pages) </li><li>  The presence of a <a href="https://ru.wordpress.org/plugins/woocommerce-multilingual/">multilingual extension</a> </li></ul><br><br><h3>  Minuses </h3><br><ul><li>  Orientation to the west.  Payment methods are by default oriented to the western market.  In fact, not too much and minus, given that you can add all popular payment systems for free by connecting the robokassa extension mentioned above </li><li>  There may be conflicts when installing some extensions together. </li><li>  There is no free technical support. </li><li>  Security.  Considering the popularity of CMS wordpress in the world and the popularity of the expansion itself, shops on this engine <a href="https://www.wpwhitesecurity.com/wordpress-security-news-updates/statistics-70-percent-wordpress-installations-vulnerable/">often become the target of a hacker attack.</a> </li></ul><br><br><h2>  Features adaptation for vps-hosting </h2><br>  What needs to be done first?  To begin, install and activate the theme and the plugin (the installation is intuitive and is no different from the installation of the usual themes and plugins).  We will not consider the design of your future VPS hosting pages in this material.  We are interested in how to set up this WooCommerce so that customers can order servers on your VPS hosting. <br><br><h3>  Accept payments </h3><br>  Here everything is absolutely the same as in the organization of receiving payments for any other goods.  There are a lot of plug-ins that implement integration with aggregators for woocommerce.  If you choose from free extensions woocommerce to accept payments in Russia and the CIS, you can connect robokassa or paymaster.  In the case of robokassa, immediately after registering on the site, you can immediately accept payments as an individual on the basis <a href="http://docs.robokassa.ru/%25D0%25BE%25D1%2584%25D0%25B5%25D1%2580%25D1%2582%25D0%25B0-%25D0%25B1%25D0%25B8%25D0%25B7%25D0%25BD%25D0%25B5%25D1%2581-%25D1%258D%25D0%25BB%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D1%2582">of an offer agreement</a> , but in this case we have a <a href="http://robokassa.ru/ru/Doc/ru/Tariffs_itv.pdf">high commission</a> .  In general, even with this in mind, the final price of your server will still be quite attractive in relation to competitors, so you can safely begin to work right away with robokassa.  Detailed information on the settings of the robokassa extension <a href="https://chempalov.ru/%25D0%25BF%25D0%25BE%25D0%25B4%25D0%25BA%25D0%25BB%25D1%258E%25D1%2587%25D0%25B0%25D0%25B5%25D0%25BC-robokassa-%25D0%25BA-wordpress-%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582-%25D0%25BC%25D0%25B0%25D0%25B3%25D0%25B0%25D0%25B7%25D0%25B8%25D0%25BD%25D1%2583/">can be obtained here.</a> <br>  <i>If you plan to use another aggregator and very prudently approach this question, here is a <a href="https://habrahabr.ru/company/web_payment_ru/blog/265349/">detailed comparison of aggregators</a> .</i>  <i>Choose the appropriate one, see if there is a <a href="http://codecanyon.net/category/wordpress/ecommerce/woocommerce/gateways">corresponding extension for WooCommerce</a> , find its repository and see how active the development is and whether it is alive.</i>  <i>If everything is fine, feel free to set and customize.</i> <br><br><h3>  Disabling guest purchase and delivery mechanism </h3><br>  WooCommerce has the ability to make purchases without registration.  We also need the client to make purchases only from his account, in which, by the way, we will display to the client all the necessary information, including about his servers.  To do this, go to Wordpress Settings&gt; WooCommerce&gt; Settings&gt; Payments and uncheck "Allow guests to place orders." <br><br>  Delivery must also be disabled.  To do this, go to <b>Wordpress Settings&gt; WooCommerce&gt; Settings&gt; General</b> and select "Disable delivery and delivery calculation" <br><br><h3>  Setting pages </h3><br>  After installing the plugin, in the section of the page 3 additional ones appeared: a shop window, a basket, an order.  We will place the storefront on the main order page so that the user has the opportunity to immediately select the desired configuration and proceed with the order.  This is done like this: <br>  Go to the <b>Wordpress Settings&gt; Settings&gt; Reading</b> and specify the page with the WooCommerce product window as the main page and the page of records. <br><br><h3>  Adding products </h3><br>  In our case, the product will be the VPS configuration.  For simplicity, we take 3 configurations and add them as a product to the site: <br><ul><li>  Minimum: 1 √ó 2.6GHz CPU, 1GB RAM, 20GB HDD, 1 IP </li><li>  Medium: 4 √ó 2.6GHz CPU, 4GB RAM, 40GB HDD, 1 IP </li><li>  Powerful: 10 √ó 2.6GHz CPU, 10GB RAM, 80GB HDD, 1 IP </li></ul><br><br>  In the product adding menu, we recommend immediately replacing the content of the Label field with a more understandable option, for example medium-configuration.  Also, it is desirable to describe in the contents of the goods for what purposes this configuration is suitable, for example, to place your site on with attendance of up to 100 people per day.  Do not forget to specify the price and discount, if required.  Also, be sure to specify the image of the goods. <br>  The result should be like this: <br><br><img src="https://habrastorage.org/files/f3c/960/36f/f3c96036fa4c48adbec2472aab20d1e0.jpg" height="600"><br><br>  This is a standard design showcase page from the <b>Storefront</b> .  Next, we refine the design of the main page, using the services of freelancers and fill it with <a href="https://habrahabr.ru/post/143923/">necessary content</a> <br><br><h3>  Processing paid orders </h3><br>  Here we come to one of the most important points in the question of adapting WooCommerce for the sale of VPS rental services.  After paying for the VPS server on your service, you must provide this server to the client. <br><br>  For simplicity in this section, we will not consider how to arrange a server renewal, a test period, etc., but limit ourselves to creating a server after its first payment.  So, the task is to ensure that as soon as the service is paid for: <br><ul><li>  initiate server creation using the <a href="https://ruvds.com/use_api">RuVDS Whitelabel API</a> and provide the client with all the necessary information about the creation process (server ID, creation phase, creation progress, server configuration) </li><li>  after creating the server, provide the necessary data for the connection, as well as the server management capabilities and information about the end date of the calculation period </li></ul><br>  To solve this problem, there are many ways.  One of the simplest is to periodically receive data on paid orders for which VPS were not created directly from the corresponding wordpress and woocommerce tables (a detailed description of the woocommerce scheme can <a href="https://github.com/woothemes/woocommerce/wiki/Database-Description">be found here</a> ) and if such exist, mark them as ‚Äúin progress‚Äù and run server creation process.  Not the best solution, but one of the easiest ... You can also use woocommerce web hooks for this task.  What are web hooks?  In simple terms, this is a subscription to an event in the online store.  We show how to work with this mechanism on the REST API. <br><br>  What is good woocommerce?  Not least because it has a documented <a href="https://woothemes.github.io/woocommerce-rest-api-docs">REST API</a> (and examples of its use in 4 languages, Javascript, PHP, Python, Ruby and curl, the output of which can then be disassembled as you like).  Also, to use the features of the plugin, there is <a href="https://github.com/woothemes/woocommerce/wiki/WP-CLI-commands">wp cli</a> and <a href="https://docs.woothemes.com/wc-apidocs/">detailed documentation on its code.</a> <br><br>  In order to use the REST API, you must first generate a special key.  This is done as follows: go to <b>WooCommerce&gt; Settings&gt; API</b> and click add key.  When generating a key, you need to select a user and specify the type of rights (read, write, read / write).  We generate a key for the current user and specify the level of read / write rights.  Next, go to <b>Settings&gt; permalinks</b> and select the second type.  Now REST API is available at url: <b><a href="https://yourdomain.com/wc-api/v3/">yourdomain.com/wc-api/v3</a></b> <br><br>  To work with the API, we will use a <a href="https://packagist.org/packages/automattic/woocommerce">special library for PHP</a> .  Install it using <a href="https://getcomposer.org/">composer</a> by running the console: <br><pre><code class="bash hljs">composer require automattic/woocommerce</code> </pre> <br>  You can log in to the API and get a list of products using the following PHP code: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/vendor/autoload.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Automattic</span></span>\<span class="hljs-title"><span class="hljs-title">WooCommerce</span></span>\<span class="hljs-title"><span class="hljs-title">Client</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Automattic</span></span>\<span class="hljs-title"><span class="hljs-title">WooCommerce</span></span>\<span class="hljs-title"><span class="hljs-title">HttpClient</span></span>\<span class="hljs-title"><span class="hljs-title">HttpClientException</span></span>; $woocommerce = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Client( <span class="hljs-string"><span class="hljs-string">'https://yourdomain.com/'</span></span>, <span class="hljs-string"><span class="hljs-string">'ck_0000000000000000000000000000000000000000'</span></span>, <span class="hljs-string"><span class="hljs-string">'cs_0000000000000000000000000000000000000000'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { print_r($woocommerce-&gt;get(<span class="hljs-string"><span class="hljs-string">'products'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (HttpClientException $e) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $e-&gt;getMessage(); }</code> </pre><br><br>  The client can already buy a server using the available storefront functionality on the main page.  Accordingly, in order to start the creation of the server when paying for the order, we can add the appropriate web hook to the event of changing the order status: <br><pre> <code class="php hljs">... ... $webHookData = [ <span class="hljs-string"><span class="hljs-string">'webhook'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Order updated'</span></span>, <span class="hljs-string"><span class="hljs-string">'topic'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'order.updated'</span></span>, <span class="hljs-string"><span class="hljs-string">'delivery_url'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'https://yourdomain.com/deliver/secret'</span></span> ] ]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { print_r($woocommerce-&gt;post(<span class="hljs-string"><span class="hljs-string">'webhooks'</span></span>, $data)); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (HttpClientException $e) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $e-&gt;getMessage(); }</code> </pre><br><br>  Now, when this event comes, the load of the web hook will be delivered to the address 'https://yourdomain.com/deliver/secret'. <br>  Anything that has been delivered by the web hook can also be displayed as follows: <br><pre> <code class="php hljs">print_r($woocommerce-&gt;get(<span class="hljs-string"><span class="hljs-string">'webhooks/webhook_id/deliveries'</span></span>))</code> </pre><br>  When processing a request for delivery_url, you need to check whether the order status has changed to completed.  If yes, from the order you get an array of server configuration id (array of product identifiers in the line_items property) and start the process of creating a VPS. <br><br>  In the next articles of the cycle we will examine in detail how to do this. </div><p>Source: <a href="https://habr.com/ru/post/303936/">https://habr.com/ru/post/303936/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303922/index.html">1C.Drop.1 uses 1C to execute malicious code</a></li>
<li><a href="../303924/index.html">Azure Service Fabric: First Steps</a></li>
<li><a href="../303926/index.html">The structure of the Android project - an alternative way</a></li>
<li><a href="../303928/index.html">Closed gestalt and a lot of meat at the Ukrainian Cartographic Conference</a></li>
<li><a href="../303934/index.html">Flash flash strikes: new Hitachi Accelerated Flash modules</a></li>
<li><a href="../303938/index.html">Working with OZON (Merchants) API using PHP</a></li>
<li><a href="../303940/index.html">Sewage as a cooler</a></li>
<li><a href="../303942/index.html">Yours among yours: How to love your neighbor from the neighboring department</a></li>
<li><a href="../303948/index.html">How "PunkeyPOS" steals information from bank cards</a></li>
<li><a href="../303950/index.html">BTSync as a backup tool</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>