<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learn OpenGL. Lesson 6.2 - Physically-Based Rendering. Analytical light sources</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous lesson we gave an overview of the basics of implementing a physically plausible rendering model. This time we will move from theoretic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learn OpenGL. Lesson 6.2 - Physically-Based Rendering. Analytical light sources</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/c9e/9b2/a3b/c9e9b2a3baf749ab8e2b385c6d93d966.png" alt="Ogl3" align="left" width="300">  In the <a href="https://habrahabr.ru/post/426123/">previous</a> lesson we gave an overview of the basics of implementing a physically plausible rendering model.  This time we will move from theoretical calculations to a specific implementation of the render with the participation of direct (analytical) light sources: point, directional or projector type. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Content</b> <div class="spoiler_text">  Part 1. Start <br><br><ol><li>  <a href="https://habrahabr.ru/post/310790/">Opengl</a> </li><li>  <a href="https://habrahabr.ru/post/311198/">Creating a window</a> </li><li>  <a href="https://habrahabr.ru/post/311234/">Hello window</a> </li><li>  <a href="https://habrahabr.ru/post/311808/">Hello triangle</a> </li><li>  <a href="https://habrahabr.ru/post/313380/">Shaders</a> </li><li>  <a href="https://habrahabr.ru/post/315294/">Textures</a> </li><li>  <a href="https://habrahabr.ru/post/319144/">Transformations</a> </li><li>  <a href="https://habrahabr.ru/post/324968/">Coordinate systems</a> </li><li>  <a href="https://habrahabr.ru/post/327604/">Camera</a> </li></ol><br>  Part 2. Basic lighting <br><br><ol><li>  <a href="https://habrahabr.ru/post/329592/">Colors</a> </li><li>  <a href="https://habrahabr.ru/post/333932/">Lighting Basics</a> </li><li>  <a href="https://habrahabr.ru/post/336166/">Materials</a> </li><li>  <a href="https://habrahabr.ru/post/337550/">Texture Cards</a> </li><li>  <a href="https://habrahabr.ru/post/337642/">Sources of light</a> </li><li>  <a href="https://habrahabr.ru/post/338254/">Multiple light sources</a> </li></ol><br>  Part 3. Loading 3D Models 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  <a href="https://habrahabr.ru/post/338436/">Assimp library</a> </li><li>  <a href="https://habrahabr.ru/post/338436/">Mesh mesh class</a> </li><li>  <a href="https://habrahabr.ru/post/338998/">3D model class</a> </li></ol><br>  Part 4. OpenGL advanced features <br><br><ol><li>  <a href="https://habrahabr.ru/post/342610/">Depth test</a> </li><li>  <a href="https://habrahabr.ru/post/344238/">Stencil test</a> </li><li>  <a href="https://habrahabr.ru/post/343096/">Mixing colors</a> </li><li>  <a href="https://habrahabr.ru/post/346964/">Face clipping</a> </li><li>  <a href="https://habrahabr.ru/post/347354/">Frame buffer</a> </li><li>  <a href="https://habrahabr.ru/post/347750/">Cubic cards</a> </li><li>  <a href="https://habrahabr.ru/post/350008/">Advanced data handling</a> </li><li>  <a href="https://habrahabr.ru/post/350156/">Advanced GLSL</a> </li><li>  <a href="https://habrahabr.ru/post/350782/">Geometric shader</a> </li><li>  <a href="https://habrahabr.ru/post/352962/">Instancing</a> </li><li>  <a href="https://habrahabr.ru/post/351706/">Smoothing</a> </li></ol><br>  Part 5. Advanced Lighting <br><br><ol><li>  <a href="https://habrahabr.ru/post/353054/">Advanced lighting.</a>  <a href="https://habrahabr.ru/post/353054/">Model Blinna-Phong.</a> </li><li>  <a href="https://habrahabr.ru/post/353632/">Gamma Correction</a> </li><li>  <a href="https://habrahabr.ru/post/353956/">Shadow maps</a> </li><li>  <a href="https://habr.com/post/354208/">Omnidirectional shadow maps</a> </li><li>  <a href="https://habr.com/post/415579/">Normal mapping</a> </li><li>  <a href="https://habr.com/post/416163/">Parallax mapping</a> </li><li>  <a href="https://habr.com/post/420409/">Hdr</a> </li><li>  <a href="https://habr.com/post/420375/">Bloom</a> </li><li>  <a href="https://habr.com/post/420565/">Deferred rendering</a> </li><li>  <a href="https://habr.com/post/421385/">SSAO</a> </li></ol><br>  Part 6. PBR <br><br><ol><li>  <a href="https://habr.com/post/426123/">Theory</a> </li><li>  <b>Analytical light sources</b> </li></ol><br></div></div><br>  First, let's refresh the expression for calculating the reflectivity from the previous lesson: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><msub><mi>L</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy=&quot;false&quot;>(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>c</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow><mo stretchy=&quot;false&quot;>)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>(</mo><mi>p</mi><mo>,</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="131.632ex" height="2.78ex" viewBox="0 -832 56674.5 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="963" y="-213"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="1124" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="1514" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-2C" x="2017" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="2712" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="3198" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="4076" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="4543" y="0"></use><g transform="translate(5023,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="5996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-3D" x="6664" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="7970" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="8315" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="8916" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6C" x="9527" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="9826" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="10171" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="11050" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="11395" y="0"></use><g transform="translate(11757,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-73" x="0" y="0"></use><g transform="translate(469,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4F" x="353" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1117" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1995" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2462" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2942" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="14781" y="0"></use><g transform="translate(15171,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="737" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-66" x="16413" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-72" x="16963" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="17415" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="17944" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="18378" y="0"></use><g transform="translate(18811,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="753" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-2B" x="20132" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-66" x="21383" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-72" x="21934" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="22385" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="22915" y="0"></use><g transform="translate(23348,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(25713,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="13946" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="40049" y="0"></use><g transform="translate(40438,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="963" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="41464" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="41853" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-2C" x="42357" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="43052" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="43538" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="44416" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="44883" y="0"></use><g transform="translate(45363,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="46237" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="46626" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="47477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="47910" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="48434" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="48919" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="49531" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="50016" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="50895" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="51361" y="0"></use><g transform="translate(51842,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="52716" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="53489" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="53975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="54853" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="55320" y="0"></use><g transform="translate(55800,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="748" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>L</mi><mi>o</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>l</mi><mi>i</mi><mi>m</mi><mi>i</mi><mi>t</mi><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></mrow></msub><mo stretchy="false">(</mo><msub><mi>k</mi><mi>d</mi></msub><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>c</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>p</mi><mi>i</mi></mrow><mo>+</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><mo stretchy="false">)</mo><msub><mi>L</mi><mi>i</mi></msub><mo stretchy="false">(</mo><mi>p</mi><mo>,</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mi>d</mi><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L_o (p, \ omega_o) = \ int \ limits _ {\ Omega} (k_d \ frac {c} {\ pi} + \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n) }) L_i (p, \ omega_i) n \ cdot \ omega_i d \ omega_i </script></p><br>  For the most part, we have already dealt with the components of this formula, but the question remains as to how exactly to represent the irradiance value, which represents the total energy brightness ( <i>radiance</i> ) <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.057ex" viewBox="0 -780.1 681.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4C" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math></span></span><script type="math/tex" id="MathJax-Element-2"> L </script>  the whole scene.  We agreed that the energy brightness <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.057ex" viewBox="0 -780.1 681.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4C" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> L </script>  (in terms of computer graphics terminology) is considered as a <i>radiant flux</i> ratio ( <i>radiant flux</i> ) <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>h</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.891ex" height="2.419ex" viewBox="0 -780.1 1675.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-68" x="753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1330" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>h</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-4"> \ phi </script>  (radiation energy of the light source) to the value of the solid angle <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.178ex" height="1.817ex" viewBox="0 -520.7 3090.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2561" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> \ omega </script>  .  In our case, the solid angle <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.178ex" height="1.817ex" viewBox="0 -520.7 3090.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1614" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2080" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2561" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-6"> \ omega </script>  we have assumed infinitely small, and therefore the energy brightness gives an idea of ‚Äã‚Äãthe radiation flux for each individual ray of light (its direction). <br><br>  How to link these calculations with the lighting model that we know from previous lessons?  First, imagine that a single point source of light is given (which radiates uniformly in all directions) with a radiation flux given as the RGB triad (23.47, 21.31, 20.79).  The radiant <i>intensity</i> ( <i>radiant intensity</i> ) of such a source is equal to its radiation flux in all directions.  However, having considered the problem of determining the color of a specific point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-7"> p </script>  on the surface, it can be seen that from all possible directions of the incidence of light in the hemisphere <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-8"> \ Omega </script>  only vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-9"> w_i </script>  will clearly come from the light source.  Since only one light source is given, represented by a point in space, for all other possible directions of light falling to a point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-10"> p </script>  energy brightness will be zero: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/2w/yj/_n/2wyj_neazkcr6gnrviq43nerpz8.png"></div><br>  Now, if we temporarily ignore the law of light attenuation for a given source, it turns out that the energy brightness for the incident beam of this source light remains unchanged wherever we place the source (scaling the luminosity based on the cosine of the angle of incidence <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>p</mi><mi>h</mi><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.891ex" height="2.419ex" viewBox="0 -780.1 1675.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-68" x="753" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1330" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>p</mi><mi>h</mi><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-11"> \ phi </script>  also does not count).  In total, the point source maintains the radiation power constant regardless of the viewing angle, which is equivalent to accepting the magnitude of the radiation force equal to the initial radiation flux in the form of a constant triad (23.47, 21.31, 20.79). <br><br>  However, the calculation of the energy brightness is also based on the coordinate of the point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-12"> p </script>  At least any physically reliable light source demonstrates attenuation of the radiation power with increasing distance from the point to the source.  The orientation of the surface should also be taken into account, as can be seen from the initial expression for luminosity: the result of calculating the radiation power should be multiplied by the value of the scalar multiplication of the surface normal vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-13"> n </script>  and the radiation falling vector <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-14"> w_i </script>  . <br><br>  To rewrite the above: for a direct point source of light, the emission function <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>L</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.583ex" height="2.057ex" viewBox="0 -780.1 681.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4C" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>L</mi></math></span></span><script type="math/tex" id="MathJax-Element-15"> L </script>  determines the color of the incident light taking into account the attenuation at a given distance from the point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-16"> p </script>  and given the scaling factor <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="8.629ex" height="2.419ex" viewBox="0 -780.1 3715.3 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="850" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="1284" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="1807" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="2293" y="0"></use><g transform="translate(2654,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1013" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-17"> n \ cdot w_i </script>  but only for a single ray of light <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-18"> w_i </script>  getting to a point <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>p</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.259ex" height="1.817ex" viewBox="-38.5 -520.7 542 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-70" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-19"> p </script>  - essentially the only vector connecting the source and point.  In the form of source code, this is interpreted as follows: <br><br><pre><code class="cpp hljs">vec3 lightColor = vec3(<span class="hljs-number"><span class="hljs-number">23.47</span></span>, <span class="hljs-number"><span class="hljs-number">21.31</span></span>, <span class="hljs-number"><span class="hljs-number">20.79</span></span>); vec3 wi = normalize(lightPos - fragPos); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> cosTheta = max(dot(N, Wi), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> attenuation = calculateAttenuation(fragPos, lightPos); vec3 radiance = lightColor * attenuation * cosTheta;</code> </pre> <br>  If you close your eyes to slightly changed terminology, this piece of code should remind you of something.  Yes, yes, this is all the same code for calculating the diffuse component in the lighting model known to us.  For direct illumination, the energy brightness is determined by a single vector to the source of light, because the calculation is carried out in a manner so similar as we still know. <br><br><blockquote>  I note that this statement is true only in the framework of the assumption that the point source of light is infinitely small and is represented by a point in space.  When modeling a volume source, its luminosity will differ from zero in a variety of directions, and not just on a single ray. </blockquote><br>  For other light sources emitting radiation from a single point, the energy brightness is calculated in the same way.  For example, a directional light source has a constant direction. <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>w</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.464ex" height="1.817ex" viewBox="0 -520.7 1060.8 782.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="1013" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>w</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-20"> w_i </script>  and does not use attenuation, and the projector source exhibits varying radiant power, depending on the direction of the source. <br><br>  Here we return to the value of the integral <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mi>t</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.617ex" height="1.937ex" viewBox="0 -728.2 1557.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="595" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="1196" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-21"> \ int </script>  on the surface of the hemisphere <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-22"> \ Omega </script>  .  Since we know in advance the positions of all the particular points of the light sources involved in the shading, we do not need to try to solve the integral.  We can directly calculate the total irradiance provided by this number of light sources, since the only direction for each source affects the energy brightness of the surface. <br><br>  As a result, the PBR calculation for direct light sources is quite simple, since it all comes down to a sequential enumeration of the sources involved in the illumination.  Later, a component of the environment will appear in the lighting model, which we will work on in the lighting-based image <i>-based</i> lesson ( <i>Image-Based Lighting</i> , <i>IBL</i> ).  There is no way out of assessing the integral, since the light in such a model falls from a multitude of directions. <br><br><h2>  PBR surface model </h2><br>  Let's start with a fragment shader that implements the PBR model described above.  First, we define the input data required for shading: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core out vec4 FragColor; in vec2 TexCoords; in vec3 WorldPos; in vec3 Normal; uniform vec3 camPos; uniform vec3 albedo; uniform float metallic; uniform float roughness; uniform float ao;</span></span></code> </pre> <br>  Here you can see the usual input data calculated using the simplest vertex shader, as well as a set of uniforms describing the characteristics of the object's surface. <br><br>  Next, at the very beginning of the shader code, let's perform calculations, so familiar from the implementation of the Blinna-Phong lighting model: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ vec3 N = normalize(Normal); vec3 V = normalize(camPos - WorldPos); [...] }</code> </pre> <br><h4>  Direct lighting </h4><br>  The example for this lesson contains only four point light sources that clearly set the irradiance of the scene.  To satisfy the expression of reflectivity, we iteratively go through each light source, calculate the individual energy brightness and sum up this contribution, modulating along the way the BRDF value and the angle of incidence of the light beam.  You can imagine this iteration as a solution of the integral over the surface <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-23"> \ Omega </script>  only for analytical light sources. <br><br>  So, we first calculate the values ‚Äã‚Äãfor each source: <br><br><pre> <code class="cpp hljs">vec3 Lo = vec3(<span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">4</span></span>; ++i) { vec3 L = normalize(lightPositions[i] - WorldPos); vec3 H = normalize(V + L); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> distance = length(lightPositions[i] - WorldPos); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> attenuation = <span class="hljs-number"><span class="hljs-number">1.0</span></span> / (distance * distance); vec3 radiance = lightColors[i] * attenuation; [...]</code> </pre> <br>  Since the calculations are carried out in linear space (we perform <a href="https://habrahabr.ru/post/353632/">gamma correction</a> at the end of the shader), the more physically correct damping law is used according to the inverse square of the distance: <br><br><blockquote>  Let the law of the inverse square and more physically correct, in order to better control the nature of the attenuation it is quite possible to use the already familiar formula containing constant, linear and quadratic terms. </blockquote><br>  Further, for each source, we also calculate the value of the Mirror Cook-Torrance BRDF: <br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>4</mn><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>(</mo><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&amp;#xA0;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="43.933ex" height="2.66ex" viewBox="0 -832 18915.6 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-66" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-72" x="800" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="1252" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="1781" y="0"></use><g transform="translate(2215,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-44" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-46" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-47" x="1578" y="0"></use></g><g transform="translate(4579,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-34" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="1140" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="2504" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2970" y="0"></use><g transform="translate(3451,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="4673" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="5107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="5630" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="6116" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="6477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="7078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-28" x="7467" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="8107" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="8592" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="9471" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="9937" y="0"></use><g transform="translate(10418,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-69" x="748" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-63" x="11542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="11975" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6F" x="12499" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-74" x="12984" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6E" x="13346" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMAIN-29" x="13946" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>D</mi><mi>F</mi><mi>G</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mn>4</mn><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>o</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mtext>&nbsp;</mtext><mi>o</mi><mi>m</mi><mi>e</mi><mi>g</mi><msub><mi>a</mi><mi>i</mi></msub><mtext>&nbsp;</mtext><mi>c</mi><mi>d</mi><mi>o</mi><mi>t</mi><mi>n</mi><mo stretchy="false">)</mo></mrow></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-24"> \ frac {DFG} {4 (\ omega_o \ cdot n) (\ omega_i \ cdot n)} </script></p><br>  The first step is to calculate the ratio between the specular and diffuse reflection, or, in other words, the ratio between the amount of reflected light to the amount of light refracted by the surface.  From the <a href="https://habrahabr.ru/post/426123/">previous lesson</a> we know what the Fresnel coefficient calculation looks like: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">vec3 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fresnelSchlick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> cosTheta, vec3 F0)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> F0 + (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - F0) * <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span> - cosTheta, <span class="hljs-number"><span class="hljs-number">5.0</span></span>); }</code> </pre> <br>  The Fresnel-Schlick approximation expects the input parameter <i>F0</i> , which shows the <i>degree of reflection of the surface at zero angle of incidence of light</i> , i.e.  the degree of reflection, if you look at the surface along the normal from top to bottom.  The value of <i>F0</i> varies depending on the material and acquires a colored tint for metals, as can be seen by viewing the catalogs of PBR materials.  For the process of <i>metallic workflow</i> (the authoring process for PBR materials, dividing all materials into classes of dielectrics and conductors), it is assumed that all dielectrics look quite reliably at a constant value of <i>F0 = 0.04</i> , while for metal surfaces, <i>F0</i> is set based on the surface albedo.  In the form of code: <br><br><pre> <code class="cpp hljs">vec3 F0 = vec3(<span class="hljs-number"><span class="hljs-number">0.04</span></span>); F0 = mix(F0, albedo, metallic); vec3 F = fresnelSchlick(max(dot(H, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>), F0);</code> </pre> <br>  As you can see, for strictly non-metallic surfaces, <i>F0 is</i> set to 0.04.  But at the same time, it can smoothly change from this value to the magnitude of the albedo on the basis of the surface ‚Äúmetallicity‚Äù indicator.  This indicator is usually presented in the form of a separate texture (hence, the <i>metallic</i> workflow is taken from here, <i>approx. Lane</i> ). <br><br>  Having received <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>F</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.741ex" height="2.057ex" viewBox="0 -780.1 749.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-46" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>F</mi></math></span></span><script type="math/tex" id="MathJax-Element-25"> F </script>  it remains for us to calculate the value of the normal distribution function <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>D</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.924ex" height="2.057ex" viewBox="0 -780.1 828.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-44" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>D</mi></math></span></span><script type="math/tex" id="MathJax-Element-26"> D </script>  and geometry functions <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>G</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.827ex" height="2.057ex" viewBox="0 -780.1 786.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-47" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-27"> G </script>  : <br><br>  Function code for an analytical lighting case: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DistributionGGX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec3 N, vec3 H, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a = roughness*roughness; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> a2 = a*a; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotH = max(dot(N, H), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotH2 = NdotH*NdotH; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> num = a2; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> denom = (NdotH2 * (a2 - <span class="hljs-number"><span class="hljs-number">1.0</span></span>) + <span class="hljs-number"><span class="hljs-number">1.0</span></span>); denom = PI * denom * denom; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num / denom; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GeometrySchlickGGX</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> NdotV, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> r = (roughness + <span class="hljs-number"><span class="hljs-number">1.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> k = (r*r) / <span class="hljs-number"><span class="hljs-number">8.0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> num = NdotV; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> denom = NdotV * (<span class="hljs-number"><span class="hljs-number">1.0</span></span> - k) + k; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num / denom; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">float</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GeometrySmith</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(vec3 N, vec3 V, vec3 L, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> roughness)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotV = max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotL = max(dot(N, L), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ggx2 = GeometrySchlickGGX(NdotV, roughness); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ggx1 = GeometrySchlickGGX(NdotL, roughness); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ggx1 * ggx2; }</code> </pre> <br>  An important difference from that described in the <a href="https://habrahabr.ru/post/426123/">theoretical part</a> : here we directly pass the roughness parameter to all the functions mentioned.  This is done to allow each of the functions to modify the original roughness value in their own way.  For example, Disney's research, reflected in the Epic Games engine, showed that the lighting model gives more visually correct results if the square of the roughness is used in the geometry function and the normal distribution function. <br><br>  By setting all the functions, you can directly get the NDF and G values: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NDF = DistributionGGX(N, H, roughness); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> G = GeometrySmith(N, V, L, roughness);</code> </pre> <br>  In total, we have on hand all the values ‚Äã‚Äãto calculate the entire Cook-Torrance BRDF: <br><br><pre> <code class="cpp hljs">vec3 numerator = NDF * G * F; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> denominator = <span class="hljs-number"><span class="hljs-number">4.0</span></span> * max(dot(N, V), <span class="hljs-number"><span class="hljs-number">0.0</span></span>) * max(dot(N, L), <span class="hljs-number"><span class="hljs-number">0.0</span></span>) + <span class="hljs-number"><span class="hljs-number">0.001</span></span>; vec3 specular = numerator / denominator;</code> </pre> <br>  Please note that we limit the denominator to a minimum value of 0.001 to prevent division by zero, in cases of zeroing the scalar product. <br><br>  We now proceed to the calculation of the contribution of each source to the equation of reflectivity.  Since the fresnel coefficient directly represents a variable <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>K</mi><mi>s</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.976ex" height="2.419ex" viewBox="0 -780.1 1281.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-73" x="1201" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-28"> K_s </script>  , then F can be used to denote the source's contribution to the specular reflection of the surface.  Of magnitude <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>K</mi><mi>s</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.976ex" height="2.419ex" viewBox="0 -780.1 1281.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-73" x="1201" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-29"> K_s </script>  can be obtained and the refractive index <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>K</mi><mi>d</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.065ex" height="2.419ex" viewBox="0 -780.1 1319.7 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4B" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-64" x="1201" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>K</mi><mi>d</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-30"> K_d </script>  : <br><br><pre> <code class="cpp hljs">vec3 kS = F; vec3 kD = vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>) - kS; kD *= <span class="hljs-number"><span class="hljs-number">1.0</span></span> - metallic;</code> </pre> <br>  Since we consider the value of <i>kS to</i> represent the amount of light energy reflected by the surface, then subtracting it from the unit, we obtain the residual energy of light <i>kD</i> refracted by the surface.  In addition, since the metals do not refract light and do not have the diffuse component of the reradiated light, the <i>kD</i> component will be modulated so as to be zero for a completely metallic material.  After these calculations, we will have all the data for calculating the reflectivity provided by each of the light sources: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> PI = <span class="hljs-number"><span class="hljs-number">3.14159265359</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> NdotL = max(dot(N, L), <span class="hljs-number"><span class="hljs-number">0.0</span></span>); Lo += (kD * albedo / PI + specular) * radiance * NdotL; }</code> </pre> <br>  The total value <i>Lo</i> , or outgoing energy brightness, is essentially a solution to the expression of reflectivity, i.e.  result of integration over the surface <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="7.824ex" height="2.419ex" viewBox="0 -780.1 3368.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-4F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-6D" x="1013" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-65" x="1892" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-67" x="2358" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/424453/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhLADVvcqIIdIxyQ8GIHt3Av5KR4g#MJMATHI-61" x="2839" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>O</mi><mi>m</mi><mi>e</mi><mi>g</mi><mi>a</mi></math></span></span><script type="math/tex" id="MathJax-Element-31"> \ Omega </script>  .  In this case, we do not need to try to solve the integral in a general form for all possible directions, since in this example there are only four sources of light that affect the processed fragment.  That is why all the "integration" is limited to a simple cycle of existing light sources. <br><br>  It remains only to add the similarity of the background lighting component to the results of the calculation of the direct light source and the resulting color of the fragment is ready: <br><br><pre> <code class="cpp hljs">vec3 ambient = vec3(<span class="hljs-number"><span class="hljs-number">0.03</span></span>) * albedo * ao; vec3 color = ambient + Lo;</code> </pre> <br><h4>  Linear space and HDR rendering </h4><br>  Until now, we assumed that all calculations are carried out in a linear color space, and therefore we used <a href="https://habrahabr.ru/post/353632/">gamma correction</a> as the final chord in our shader.  Carrying out calculations in linear space is extremely important for correct PBR modeling, since the model requires linearity of all input data.  Try not to ensure the linearity of any of the parameters and the result of shading will be incorrect.  In addition, it would be nice to set the characteristics of light sources close to real sources: for example, the color of their radiation and the energy brightness can freely vary within wide limits.  As a consequence, <i>Lo</i> can quite easily take large values, but will inevitably fall under the cutoff in the interval [0., 1.] due to the low dynamic range ( <i>LDR</i> ) of the frame buffer by default. <br><br>  To avoid losing HDR values, it is necessary to perform tone mapping before gamma correction: <br><br><pre> <code class="cpp hljs">color = color / (color + vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>)); color = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(color, vec3(<span class="hljs-number"><span class="hljs-number">1.0</span></span>/<span class="hljs-number"><span class="hljs-number">2.2</span></span>));</code> </pre> <br>  Here, the already familiar Reinhard operator is used, which allows preserving a wide dynamic range in the conditions of highly varying irradiance of different parts of the image.  Since here we do not use a separate shader for post-processing, the described operations can be added simply to the end of the shader code. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yq/fq/um/yqfqumstgmvnr5vego8grz9tfby.png"></div><br>  I repeat that for correct PBR modeling it is extremely important to remember and take into account the peculiarities of working with linear color space and HDR render.  Neglect of these aspects will lead to incorrect calculations and visually unaesthetic results. <br><br><h4>  PBR shader for analytical lighting </h4><br>  So, together with the last strokes in the form of tonal compression and gamma correction, it remains only to transfer the final color of the fragment to the output of the fragment shader and the PBR code of the shader for direct illumination can be considered complete.  Finally, let's take a look at the whole code of the <i>main ()</i> function of this shader: <br><br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#version 330 core out vec4 FragColor; in vec2 TexCoords; in vec3 WorldPos; in vec3 Normal; </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//   uniform vec3 albedo; uniform float metallic; uniform float roughness; uniform float ao; //   uniform vec3 lightPositions[4]; uniform vec3 lightColors[4]; uniform vec3 camPos; const float PI = 3.14159265359; float DistributionGGX(vec3 N, vec3 H, float roughness); float GeometrySchlickGGX(float NdotV, float roughness); float GeometrySmith(vec3 N, vec3 V, vec3 L, float roughness); vec3 fresnelSchlickRoughness(float cosTheta, vec3 F0, float roughness); void main() { vec3 N = normalize(Normal); vec3 V = normalize(camPos - WorldPos); vec3 F0 = vec3(0.04); F0 = mix(F0, albedo, metallic); //    vec3 Lo = vec3(0.0); for(int i = 0; i &lt; 4; ++i) { //        vec3 L = normalize(lightPositions[i] - WorldPos); vec3 H = normalize(V + L); float distance = length(lightPositions[i] - WorldPos); float attenuation = 1.0 / (distance * distance); vec3 radiance = lightColors[i] * attenuation; // Cook-Torrance BRDF float NDF = DistributionGGX(N, H, roughness); float G = GeometrySmith(N, V, L, roughness); vec3 F = fresnelSchlick(max(dot(H, V), 0.0), F0); vec3 kS = F; vec3 kD = vec3(1.0) - kS; kD *= 1.0 - metallic; vec3 numerator = NDF * G * F; float denominator = 4.0 * max(dot(N, V), 0.0) * max(dot(N, L), 0.0); vec3 specular = numerator / max(denominator, 0.001); //       Lo float NdotL = max(dot(N, L), 0.0); Lo += (kD * albedo / PI + specular) * radiance * NdotL; } vec3 ambient = vec3(0.03) * albedo * ao; vec3 color = ambient + Lo; color = color / (color + vec3(1.0)); color = pow(color, vec3(1.0/2.2)); FragColor = vec4(color, 1.0); }</span></span></span></span></code> </pre> <br>  I hope that after getting acquainted with the <a href="https://habrahabr.ru/post/426123/">theoretical part</a> and with today's analysis of the expression of reflectivity, this listing will no longer look daunting. <br><br>  We use this shader in a scene containing four point light sources, an unlimited number of spheres, the surface characteristics of which will change the degree of their roughness and metallicity along the horizontal and vertical axes, respectively.  At the output we get the following picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/mq/hn/sq/mqhnsqjmfli43gtcnbzzlfglcfa.png"></div><br>  Metallicity varies from zero to one from the bottom up, and the roughness is similar, but from left to right.  It becomes clear that changing only these two characteristics of the surface it is already possible to set a wide range of materials. <br><br>  The full source code is <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/1.1.lighting/lighting.cpp">here</a> . <br><br><h2>  PBR and texturing </h2><br>  Expand our surface model by transferring characteristics in the form of textures.  Thus, we will be able to provide fragmentary control over the parameters of the surface material: <br><br><pre> <code class="cpp hljs">[...] uniform sampler2D albedoMap; uniform sampler2D normalMap; uniform sampler2D metallicMap; uniform sampler2D roughnessMap; uniform sampler2D aoMap; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ vec3 albedo = <span class="hljs-built_in"><span class="hljs-built_in">pow</span></span>(texture(albedoMap, TexCoords).rgb, <span class="hljs-number"><span class="hljs-number">2.2</span></span>); vec3 normal = getNormalFromNormalMap(); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> metallic = texture(metallicMap, TexCoords).r; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> roughness = texture(roughnessMap, TexCoords).r; <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> ao = texture(aoMap, TexCoords).r; [...] }</code> </pre> <br>  Note that the surface albedo texture is usually created by artists in the sRGB color space, so in the code above we return the texel color to the linear space so that it can be used in further calculations.  Depending on how the artists create the texture containing the <i>ambient occlusion map</i> data, you may also need to bring it into linear space.  Metallicity and roughness maps are almost always created in linear space. <br><br>  The use of textures instead of fixed surface parameters in combination with the PBR algorithm gives a significant increase in visual accuracy compared to the previously used lighting algorithms: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/kw/vb/6y/kwvb6y_cnms7xxs1donnvr5ktxc.png"></div><br>  The full code of the texturing example is <a href="https://learnopengl.com/code_viewer_gh.php%3Fcode%3Dsrc/6.pbr/1.2.lighting_textured/lighting_textured.cpp">here</a> , and the textures used are <a href="http://freepbr.com/materials/rusted-iron-pbr-metal-material-alt/">here</a> (along with the background shading texture).  I draw your attention to the fact that strongly metallic surfaces appear darkened under direct illumination conditions, since the contribution of diffuse reflection is small (in the limit it is completely absent).  Their shading becomes more correct only when taking into account the mirror reflection of light from the environment, which we will do in the next lessons. <br><br>  At the moment, the result obtained may not be as impressive as some PBR demonstrations - yet we have not yet implemented an image-based lighting system ( <i>IBL</i> ).  Nevertheless, our render is now considered to be based on physical principles and, even without IBL, it shows a more reliable picture than before. </div><p>Source: <a href="https://habr.com/ru/post/424453/">https://habr.com/ru/post/424453/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../424437/index.html">Elm. Comfortable and awkward. Json.Encoder and Json.Decoder</a></li>
<li><a href="../424441/index.html">What's new in the first CTP edition of SQL Server 2019</a></li>
<li><a href="../424443/index.html">Vivaldi 2.0 in our favor</a></li>
<li><a href="../424445/index.html">Translation of Neil Ford's article "Microservices as an Evolutionary Architecture"</a></li>
<li><a href="../424447/index.html">Pascal-style Lisp or 8501st programming language</a></li>
<li><a href="../424455/index.html">Intel Optane - now with a capacity of one and a half terabytes</a></li>
<li><a href="../424457/index.html">IDA Pro Upgrade. Learning to write Python downloaders</a></li>
<li><a href="../424459/index.html">Success story, or DEV + DEVOPS + OPS</a></li>
<li><a href="../424461/index.html">Why learn unpopular languages. Community example F #</a></li>
<li><a href="../424463/index.html">How certainty affects the scope of payments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>