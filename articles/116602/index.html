<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple OCR for .NET</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It all started with the need for one of the applications to take a snapshot of an arbitrary window and 3-4 times per second to recognize several image...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple OCR for .NET</h1><div class="post__text post__text-html js-mediator-article">  It all started with the need for one of the applications to take a snapshot of an arbitrary window and 3-4 times per second to recognize several image areas with previously known characters.  It was not a problem to make a screenshot of the window using WinAPI, but I had to work a little on recognition. <br><a name="habracut"></a><br><h4>  Tessnet2 and MODI </h4><br><br>  Naturally to start, I looked for ready-made solutions.  The first thing that issued Google is the Tesseract library, or rather its wrapper for .NET - called Tessnet2.  Unfortunately, a detailed study turned out that it does not suit me.  The second version of Tesseract has quite a lot of memory leaks, which did not suit me, because after 10 minutes of the program using Tessnet2, the application crashed with OutOfMemoryException.  On the Tesseract page it is written that there should be no leaks in the third version, but I did not find a working wrapper for Tesseract3 either. <br><br>  Also, the MODI (Microsoft Office Document Imaging) tool did not suit me - because it recognizes only files (you cannot pass it an instance of the Bitmap class for recognition). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After a brief search in Google for other free character recognition libraries under .NET and problems associated with them, I decided that it would be easier to make my small library just for such cases.  Moreover, the task is quite interesting. <br><br>  What we have: <ul><li>  Symbols are not distorted.  That is, to recognize the captcha will not work </li><li>  The set of recognizable characters is constant and for each character we have a file with its image. </li><li>  A small number of characters for recognition.  The more characters - the longer it recognizes </li></ul><br><br><h4>  Idea </h4><br><br>  What did I want to get in the end?  Get a class, to which method you can transfer an image, a special file with a set of recognizable characters, and get a recognized string at the output.  Like that: <br><br> <code>var playerStacks = new OCRReader(OCRFont.Load("MyFont.pft")), Color.Black, useForeColor: false); <br> var stackString = playerStacks.Recognize(imageToRecognition);</code> <br> <br>  I also thought it would be nice to have utilities for creating such font files and for checking the created font on a specific image.  Utilities are for convenience only.  All actions that can be done using utilities can be done in code. <br><br><h4>  Implementation </h4><br><br>  All functionality is distributed between the three classes OCRSymbol, OCRFont and OCRReader. <br><br>  OCRSymbol - describes the symbol: its name, width and height, shift of the symbol down relative to the highest symbol in the entire set, lists of points characteristic for the symbol and points making up the background. <br><br>  OCRFont - character set, serialized using BinaryFormater. <br><br>  OCRReader - coordinates the reading of characters one by one.  Also sets the reading strategy.  The fact is that when creating an instance of this class, we can set the color.  This color will be used either as the background color (all that is not this color, then the symbol), or as the color of the symbol (all that not this color is the background).  This is necessary for cases when the background uses more than one color, or when the symbol is drawn in more than one color. <br><br>  The case when the symbol is drawn in more than one color (black background, everything else is a symbol) <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/a1/76/a17671a852420765bbe901e533d20d72.png"></a> <br><br>  The case when the background is not monochromatic (the background is a green gradient, the characters are painted in white) <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/1b/3f/1b3f7fee71bfefa9a2d0ad7f3e1195d1.png"></a> <br><br>  The recognition algorithm is very simple.  Each symbol is described by two universal lists List.  The first - the points that must be present in the symbol (Good), the second - which should not, that is, the background (Bad).  When comparing with the next symbol, the list of background points is first traversed if, when checking the next point, the corresponding point in the recognizable image is not the background (the background color is set when creating the OCRReader), the cycle ends and proceed to comparison with the next symbol.  If the list of background points is successfully passed, then we similarly run through the list of symbol points.  Any mismatch - go to the comparison with the next symbol.  If all the checks were successful, then we recognized our symbol and can proceed to the recognition of the next one. <br><br><h4>  Additional utilities </h4><br><br>  I didn‚Äôt want to manually describe the lists of points for each character, so I wrote a utility that automatically imports all image files from a specified directory and creates the lists by file name and specified background color.  Of course in most cases a manual adjustment would be desirable.  Since all the pixels of the image are scattered around the lists of background points and character points.  In most cases, this accuracy is not necessary.  It is enough to specify 10-20 points from each list to uniquely identify the symbol.  For example, for my example, the following lists of pixels were enough for the character '6' (red - background, green - character, white - not checked).  The first screenshot - the symbol is described by the utility, the second - after manual editing.  They are recognized equally.  It was possible to make even less characteristic points. <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/45/e9/45e9b5ce582fe72c46e2235c8d5565bc.png"></a> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/28/20/2820b81b2f562a8d63541a48531252f8.png"></a> <br><br>  A utility was also created to test the operation of the font file created using the previous utility. <br> <a title="Habraffe.ru" href=""><img src="https://habrastorage.org/storage/habraeffect/1e/68/1e6851c9671c18dc7ca46a363ab41bf9.png"></a> <br>  Recognition of 5 characters, taking into account cropping (cropping the image to the character boundaries), took 37 ms.  For the full alphabet, the recognition time will be self-longer. <br><br><h4>  Sources </h4><br><br>  A library with recognizer classes, a utility for creating and editing font files and checking on an image, examples of font images, as well as the source of all this for Visual Studio 2010 can be <a href="http://www.mediafire.com/%3F2ws8pumlrr2rngr">downloaded from mediafire.com</a> . <br>  Or from <a href="https://github.com/evlntnt/SimpleOCR">GitHub.com</a> <br><br><h4>  Conclusion </h4><br><br>  The AForge .NET library is used to crop the edges of the image, since the Bitmap.Clone method works very slowly.  I would be glad if my workings will be useful to someone other than me. <br><br><h4>  Used materials </h4><ol><li>  <a href="http://code.google.com/p/tesseract-ocr/">Tesseract Library Page</a> </li><li>  <a href="http://www.pixel-technology.com/freeware/tessnet2/">Tesseract2 Wrap - Tessnet2</a> </li><li>  <a href="http://www.codeproject.com/KB/office/modi.aspx%3Fdf%3D100%26forumid%3D172151%26exp%3D0%26select%3D1775451">Work with MODI</a> </li><li>  <a href="http://code.google.com/p/aforge/">AForge .NET</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/116602/">https://habr.com/ru/post/116602/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116595/index.html">Basics of Clojure Web Applications</a></li>
<li><a href="../116596/index.html">BugDNS - April Fools Internet</a></li>
<li><a href="../116599/index.html">Author Chrome Adblock released for beta testing gadget glasses that block the usual advertising on the streets</a></li>
<li><a href="../116600/index.html">Bromine Behavior Innovations</a></li>
<li><a href="../116601/index.html">Fix performance drop when copying / uploading files to Ubuntu</a></li>
<li><a href="../116603/index.html">Fingerprint recognition methods and implementation by means of Python</a></li>
<li><a href="../116604/index.html">Streaming video a hundred years ago</a></li>
<li><a href="../116605/index.html">Correction of the spirit of Internet traffic</a></li>
<li><a href="../116606/index.html">Attention, filmophiles</a></li>
<li><a href="../116607/index.html">MarkHtml</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>