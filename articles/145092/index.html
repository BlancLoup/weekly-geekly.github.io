<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Revise old projects for Android 4.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, when I wrote a new training example for my website, training on cats, I unexpectedly ran into one problem out of the blue. In the program code,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Revise old projects for Android 4.0</h1><div class="post__text post__text-html js-mediator-article">  Today, when I wrote a new training example for my website, training on cats, I unexpectedly ran into one problem out of the blue.  In the program code, it was necessary to realize the download of the image from the Internet and save it to the SD card.  At first glance, the task presented no difficulties, but the project suddenly began to produce an error. <br><br><img src="https://habrastorage.org/storage2/2e9/4d7/d58/2e94d7d5824fc3bd236518787878f426.png"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here we must make a small digression.  I started learning programming for Android relatively recently and started with the version of Android 2.3, since I had a phone with the same version.  And all the projects I tried on the emulator under the same version.  A couple of months ago, an update to ICS (Android 4.0) was released for my Samsung Galaxy SII and I began to create new projects for the new version, as well as rewrite my training examples for the new platform.  Periodically, in Eclipse, when loading old projects, there were lines of code with strikethrough methods.  It was clear that this method was outdated and the documentation should be re-read. <br><br>  In my last case, nothing was emphasized, and the nature of the error was not entirely clear.  In <a href="http://developer.alexanderklimov.ru/android/views/imageview.php">one of my lessons, I</a> used a similar example of downloading an image from the network to ImageView, which worked fine before in Android 2.3.  For the sake of interest, I launched this example under the Android 4.0 emulator, being absolutely confident in the performance of the example.  But it was not there, and this example did not start.  Replacing in the example one line <br><br><pre><code class="java hljs">txtUrl.setText(e.toString());</code> </pre> <br><br>  I received a description of the error - android.os.NetworkOnMainThreadException.  Then it was easier.  Having this information and called on Google for help, I found out that, starting with Android 3.0, the rules have changed a bit.  Now you can not access network resources in the main stream of activity.  So I had to redo the example in a new way. <br><br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> ru.alexanderklimov.imagefrominet; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.InputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Bitmap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.BitmapFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.AsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.ImageView; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageFromInetActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageView imgView; <span class="hljs-comment"><span class="hljs-comment">/** Called when the activity is first created. */</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.main); imgView = (ImageView) findViewById(R.id.imgView); <span class="hljs-comment"><span class="hljs-comment">// -  String url = "http://developer.alexanderklimov.ru/android/images/android_cat.jpg"; // show The Image new DownloadImageTask(imgView) .execute(url); } private class DownloadImageTask extends AsyncTask&lt;String, Void, Bitmap&gt; { ImageView bmImage; public DownloadImageTask(ImageView bmImage) { this.bmImage = bmImage; } protected Bitmap doInBackground(String... urls) { String urldisplay = urls[0]; Bitmap mIcon11 = null; try { InputStream in = new java.net.URL(urldisplay).openStream(); mIcon11 = BitmapFactory.decodeStream(in); } catch (Exception e) { Log.e("Error", e.getMessage()); e.printStackTrace(); } return mIcon11; } protected void onPostExecute(Bitmap result) { bmImage.setImageBitmap(result); } } }</span></span></code> </pre><br><br></div></div><br><br>  In the revised version, the example has earned.  Perhaps the code still needs some work, but it is already clear in which direction to move. <br>  Surely, companies and serious developers are aware of this problem.  The solution to the problem is already described in the documentation and on StackOverflow.com.  Professionals do not write long operations in the main thread and they will not notice the problem at all.  In my case, it came as a surprise to me, since in work projects there was no need to use downloading images from the Internet, but in the training example such ‚Äúwrong‚Äù code was caught.  And it seems that for many amateur programmers this can be a headache.  Imagine the situation that your application is downloading a picture or other file from the Internet.  And the part of users who were updated to ICS, starts to complain that nothing works.  Another part of users with the same phone model will claim that everything works fine.  Guess about the source of the problem will be quite difficult. <br><br>  Conclusion: Revise your old projects for health under Android 4.0.  Just yesterday, the <a href="http://developer.android.com/resources/dashboard/platform-versions.html">statistics of</a> devices for different versions of Android and Android 4 was <a href="http://developer.android.com/resources/dashboard/platform-versions.html">updated</a> already ahead of version 2.1.  I fully admit that by the end of the year, the four will also move version 2.2.  Therefore, we need to think about this problem right now. <br><br>  PS During the experiments in solving the problem, no animals were injured. </div><p>Source: <a href="https://habr.com/ru/post/145092/">https://habr.com/ru/post/145092/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145086/index.html">How to accept payments offline?</a></li>
<li><a href="../145087/index.html">Motorola launches 3 SIM card in Brazil</a></li>
<li><a href="../145088/index.html">ETSI approved nano-SIM standard</a></li>
<li><a href="../145089/index.html">Google is testing a new search results - you can buy goods directly in the search results</a></li>
<li><a href="../145090/index.html">Peltier elements or my path to cryogenic temperatures</a></li>
<li><a href="../145093/index.html">How to remove KAPS from the menu of Visual Studio 2012 RC</a></li>
<li><a href="../145094/index.html">Movies.io - glamorous UI to search for torrents</a></li>
<li><a href="../145096/index.html">Home inventory by Yandex.Market</a></li>
<li><a href="../145097/index.html">We listen to music from Vkontakte through Amarok - V.2.0</a></li>
<li><a href="../145098/index.html">Weekly Digest # 6: Simple-Science - Simple Experiments</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>