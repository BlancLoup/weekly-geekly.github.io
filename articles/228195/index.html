<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The work of the Haar cascade in OpenCV in pictures: theory and practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the last article, we described in detail the number recognition algorithm ( link ), which consists in obtaining a textual representation on a previ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The work of the Haar cascade in OpenCV in pictures: theory and practice</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/1b2/f29/37e/1b2f2937e980851241a3db19a04b4b98.png"><br><br>  In the last article, we described in detail the number recognition algorithm ( <a href="http://habrahabr.ru/company/recognitor/blog/225913/">link</a> ), which consists in obtaining a textual representation on a previously prepared image containing a frame with a number + small indents for easy recognition.  We only casually mentioned that the Viola-Jones method was used to isolate the areas where the numbers are contained.  This method has already been described on habr ( <a href="http://habrahabr.ru/post/133826/">link</a> , <a href="http://habrahabr.ru/post/134857/">link</a> , <a href="http://habrahabr.ru/post/67937/">link</a> , <a href="http://habrahabr.ru/post/208092/">link</a> ).  Today we will illustrate visually how it works and touch upon previously unresolved aspects + as a bonus, we will show how to prepare the cut pictures with numbers on the iOS platform for the subsequent receipt of a textual representation of the number. <br><a name="habracut"></a><br><h4>  Viola-Jones Method </h4><br>  Usually each method has a basis, then without which this method could not exist in principle, and all the rest is built on this basis.  In the Viola-Jones method, this foundation is composed of Haar primitives, which are a breakdown of a given rectangular area into sets of different types of rectangular subregions: <br><img src="https://habrastorage.org/getpro/habr/post_images/f2e/327/390/f2e327390db7043ccd6ff715dbd5b146.png"><br>  In the original version of the Viola-Jones algorithm, only primitives without turns were used, and to calculate the sign value, the sum of the pixel brightness of one subregion was subtracted from the sum of the brightness of another subregion [1].  In the development of the method, primitives with a slope of 45 degrees and asymmetrical configurations were proposed.  Also, instead of calculating the usual difference, it was proposed to assign a specific weight to each subregion and calculate the characteristic values ‚Äã‚Äãas the weighted sum of the pixels of different types of regions [2]: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/412/e91/fab/412e91fabeb24e4a352cfa522f17cb52.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Why did the Haar primitives form the basis of the method?  The main reason was an attempt to get away from the pixel representation while preserving the speed of computing the attribute.  Of the values ‚Äã‚Äãof a pair of pixels, it is difficult to make any meaningful information for classification, while the two cascade of the system for face recognition, which has a quite meaningful interpretation, is built from two signs of Haar [1]: <br><img src="https://habrastorage.org/getpro/habr/post_images/670/9a7/ec4/6709a7ec4711506d1ff817ff59f06f58.png"><br>  The complexity of calculating the feature as well as obtaining the pixel value remains O (1): the value of each subregion can be calculated by combining 4 values ‚Äã‚Äãof the integral representation (Summed Area Table - SAT), which in turn can be built in advance once for the entire image as O (n ), where n is the number of pixels in the image, using the formula [2]: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/403/cfb/8db/403cfb8db58b1c33919002155e3b9f75.gif"><br><img src="https://habrastorage.org/getpro/habr/post_images/3cd/12d/327/3cd12d3270f8c11b3076876dd84eac81.gif"><br><br>  This allowed us to create a fast object search algorithm, which has been a success for more than a decade.  But back to our features.  To determine class membership in each cascade, be the sum of the values ‚Äã‚Äãof the weak classifiers of this cascade.  Each weak classifier produces two values, depending on whether the value of the attribute belonging to this classifier is greater or less than the specified threshold.  At the end, the sum of the values ‚Äã‚Äãof the weak classifiers is compared with the cascade threshold and the decision is made whether the object is found or not by this cascade.  Well, enough of the theory, let's move on to practice! <br>  We have already given a link to the XML of our license plate classifier, which can be found in the opencv project wizard ( <a href="">link</a> ).  Let's look at his first cascade: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxWeakCount</span></span></span><span class="hljs-tag">&gt;</span></span>6<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">maxWeakCount</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stageThreshold</span></span></span><span class="hljs-tag">&gt;</span></span>-1.3110191822052002e+000<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">stageThreshold</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">weakClassifiers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 193 1.0079263709485531e-002<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> -8.1339186429977417e-001 5.0277775526046753e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 94 -2.2060684859752655e-002<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> 7.9418992996215820e-001 -5.0896102190017700e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 18 -4.8777908086776733e-002<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> 7.1656656265258789e-001 -4.1640335321426392e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 35 1.0387318208813667e-002<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> 3.7618312239646912e-001 -8.5504144430160522e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 191 -9.4083719886839390e-004<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> 4.2658549547195435e-001 -5.7729166746139526e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> 0 -1 48 -8.2391249015927315e-003<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">internalNodes</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span> 8.2346975803375244e-001 -3.7503159046173096e-001<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">leafValues</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">_</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">weakClassifiers</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  At first glance it seems that there are a lot of incomprehensible numbers and strange information, but in fact everything is simple: weakClassifiers - a set of weak classifiers, on the basis of which it is decided whether an object is in the image or not, internalNodes and leafValues ‚Äã‚Äãare the parameters of a particular weak classifier.  Deciphering internalNodes from left to right: in our case, the first two values ‚Äã‚Äãare not used, the third is the feature number in the common feature table (it is located further in the XML file under the features tag), the fourth is the threshold value of the weak classifier.  Since we use a classifier based on single-level decision trees ( <a href="http://en.wikipedia.org/wiki/Decision_stump">decision stump</a> ), if the value of the Haar attribute is less than the threshold of the weak classifier (the fourth value in internalNodes), the first leafValues ‚Äã‚Äãvalue is chosen, if the second value is greater.  Now let's draw the reaction of some classifiers of the first cascade: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ad/7e8/f40/7ad7e8f408bb4f14eddd778ee8b59bac.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d09/d98/22a/d09d9822a84ab035b4305ee1c55c53fe.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/ab9/312/d01/ab9312d01cd1e34bd21d52fdf43ad129.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/9de/031/1ba/9de0311ba51b10f434c012cfd1c62e20.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/28c/a52/c67/28ca52c672a4d670ea8629699c240f33.jpg"><br><br>  In fact, all these signs are to some extent the most common border detectors.  Based on this basis, a decision is made whether the cascade recognizes an object in the image or not. <br>  The second important point in the Viola-Jones method is the use of a cascade model or a degenerate decision tree: at each node of the tree, using a cascade, a decision is made whether the image contains an object or not.  If the object is not contained, the algorithm finishes its work, if it can be contained, then we proceed to the next node.  Training is designed in such a way that at the initial levels with the lowest cost to throw away most of the windows that can not contain the object.  In the case of face recognition, the first level contains only 2 weak classifiers, in the case of license plate recognition, it is 6 (considering that the latter contain up to 15).  Well, for clarity, as the number recognition by level: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b48/588/ed1/b48588ed1958cb05119eed8ba3547c8d.gif"><br><br>  A more saturated tone shows the weight of the window relative to the level.  The drawing was made on the basis of modified code of the opencv project from the 2.4 branch (the level statistics was added). <br><br><h4>  Implementation of recognition on the iOS platform </h4><br><img src="https://habrastorage.org/getpro/habr/post_images/84c/43b/01a/84c43b01a767dd478654b30e344b8356.png"><img src="https://habrastorage.org/getpro/habr/post_images/da8/a8d/fc5/da8a8dfc5454dbebf211455e0f8999d9.png"><img src="https://habrastorage.org/getpro/habr/post_images/8dd/793/1d7/8dd7931d751d2237f5e486091daa467d.png"><br><br>  With the addition of opencv to a project, there are usually no problems, especially since there is a ready-made framework for iOS that supports all existing architectures (including a simulator).  The function for finding objects is the same as in the project for Android ( <a href="https://github.com/ZlodeiBaal/Recognitor">link</a> ): <code>detectMultiScale</code> class <code>cv::CascadeClassifier</code> , it remains only to prepare the data for the input.  Suppose we have a <code>UIImage</code> on which we need to find all the numbers.  For the cascade, we need to do several things: first, shrink the image to 800px on the larger side (the larger the image, the more scales need to be considered, the number of windows that need to be viewed during the search also depends on the image size) from it a black and white analogue (the method operates only with brightness, in theory, this stage can be skipped, opencv can do it for us, but we will do it at the same time, and so we perform image manipulations), thirdly, to get binary data for transmission opencv.  All these three things can be done in one move, by drawing our image with the correct parameters into context, like this: <br><br><pre> <code class="objectivec hljs">+ (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)planar8RawDataFromImage:(<span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *)image size:(<span class="hljs-built_in"><span class="hljs-built_in">CGSize</span></span>)size { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span> kBitsPerPixel = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">CGColorSpaceRef</span></span> colorSpace = <span class="hljs-built_in"><span class="hljs-built_in">CGColorSpaceCreateDeviceGray</span></span>(); <span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span> elementsCount = (<span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span>)size.width * (<span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span>)size.height; <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *rawData = (<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)calloc(elementsCount, <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span> bytesPerRow = (<span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span>)size.width; <span class="hljs-built_in"><span class="hljs-built_in">CGContextRef</span></span> context = <span class="hljs-built_in"><span class="hljs-built_in">CGBitmapContextCreate</span></span>(rawData, size.width, size.height, kBitsPerPixel, bytesPerRow, colorSpace, kCGImageAlphaNone); <span class="hljs-built_in"><span class="hljs-built_in">CGColorSpaceRelease</span></span>(colorSpace); <span class="hljs-built_in"><span class="hljs-built_in">UIGraphicsPushContext</span></span>(context); <span class="hljs-built_in"><span class="hljs-built_in">CGContextTranslateCTM</span></span>(context, <span class="hljs-number"><span class="hljs-number">0.0</span></span>f, size.height); <span class="hljs-built_in"><span class="hljs-built_in">CGContextScaleCTM</span></span>(context, <span class="hljs-number"><span class="hljs-number">1.0</span></span>f, <span class="hljs-number"><span class="hljs-number">-1.0</span></span>f); [image drawInRect:<span class="hljs-built_in"><span class="hljs-built_in">CGRectMake</span></span>(<span class="hljs-number"><span class="hljs-number">0.0</span></span>f, <span class="hljs-number"><span class="hljs-number">0.0</span></span>f, size.width, size.height)]; <span class="hljs-built_in"><span class="hljs-built_in">UIGraphicsPopContext</span></span>(); <span class="hljs-built_in"><span class="hljs-built_in">CGContextRelease</span></span>(context); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rawData; }</code> </pre><br>  Now you can safely create <code>cv::Mat</code> from this buffer and pass it to the function by recognition.  Next, we recalculate the position of the objects found in relation to the original image and cut out: <br><br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">CGSize</span></span> imageSize = image.size; <span class="hljs-keyword"><span class="hljs-keyword">@autoreleasepool</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (std::vector&lt;cv::Rect&gt;::iterator it = plates.begin(); it != plates.end(); it++) { <span class="hljs-built_in"><span class="hljs-built_in">CGRect</span></span> rectToCropFrom = <span class="hljs-built_in"><span class="hljs-built_in">CGRectMake</span></span>(it-&gt;x * imageSize.width / imageSizeForCascade.width, it-&gt;y * imageSize.height / imageSizeForCascade.height, it-&gt;width * imageSize.width / imageSizeForCascade.width, it-&gt;height * imageSize.height / imageSizeForCascade.height); <span class="hljs-built_in"><span class="hljs-built_in">CGRect</span></span> enlargedRect = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> enlargeRect:rectToCropFrom ratio:{.width = <span class="hljs-number"><span class="hljs-number">1.2</span></span>f, .height = <span class="hljs-number"><span class="hljs-number">1.3</span></span>f} constraints:{.left = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f, .top = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f, .right = imageSize.width, .bottom = imageSize.height}]; <span class="hljs-built_in"><span class="hljs-built_in">UIImage</span></span> *croppedImage = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> cropImageFromImage:image withRect:enlargedRect]; [plateImages addObject:croppedImage]; } }</code> </pre><br>  If desired, the <code>RVPlateNumberExtractor</code> class can be remade and used in any other project that requires the recognition of any other objects, not just numbers. <br>  Just in case I wanted to note that if you want to immediately open the recorded image from the disk through <code>imread</code> , then iOS may have problems, because when photographing, iOS always records the image in the same orientation and adds rotation information to the EXIF, and opencv EXIF ‚Äã‚Äãdoes not process when reading.  You can get rid of this again by drawing to the context. <br><br><h4>  Afterword </h4><br>  The entire source code of our fresh iOS application can be found on GitHub: <a href="https://github.com/CodeGenerator/Recognitor">link</a> <br>  There you can find a lot of useful things, for example, the already mentioned <code>RVPlateNumberExtractor</code> class for cutting out numbers from a full-fledged image of pictures with numbers, as well as <code>RVPlateNumber</code> with a very simple interface that you can safely take into your projects if you need a number recognition service You will find there is something interesting for yourself.  We also do not mind if someone wants to sip new functionality into the application or make a beautiful design! <br>  Application in the AppStore: <a href="https://itunes.apple.com/ru/app/najdi-srula/id887611169">link</a> <br><br>  At the request of workers, we also updated the <a href="https://play.google.com/store/apps/details%3Fid%3Dorg.opencv.samples.tutorial334565">android application</a> : added a selection of saved numbers to send. <br><br><h4>  Bibliography </h4><br><ol><li>  P. Viola and M. Jones.  Robust real-time face detection.  IJCV 57 (2), 2004 </li><li>  Lienhart R., Kuranov E., Pisarevsky V.: Empirical analysis of the cascades of boosted classifiers for rapid object detection.  In: PRS 2003, pp.  297-304 (2003) </li></ol></div><p>Source: <a href="https://habr.com/ru/post/228195/">https://habr.com/ru/post/228195/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../228179/index.html">Moto E - the best budget for Android KitKat</a></li>
<li><a href="../228181/index.html">The constexpr qualifier in C ++ 11 and C ++ 14</a></li>
<li><a href="../228187/index.html">Review of the most interesting materials on data analysis and machine learning No. 3 (review of online courses)</a></li>
<li><a href="../228189/index.html">From graphene learned to make a flexible and durable thread</a></li>
<li><a href="../228193/index.html">SQLite is now for mobile C # applications for any platform</a></li>
<li><a href="../228199/index.html">Sounds of venus</a></li>
<li><a href="../228201/index.html">The controversy of recent years or eSports as a new phenomenon in the entertainment industry</a></li>
<li><a href="../228203/index.html">And again the game "Life"</a></li>
<li><a href="../228205/index.html">Report on the startup conference Spark.me</a></li>
<li><a href="../228207/index.html">The first year at the VIC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>