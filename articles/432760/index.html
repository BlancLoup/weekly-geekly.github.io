<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vector product views, or another application of the Word2Vec model</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every day, one and a half million people are looking for a variety of products on Ozon, and for each of them the service should pick up similar ones (...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vector product views, or another application of the Word2Vec model</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/w4/qo/hx/w4qohxd9gujf6kayzuow0bww9dc.png" alt="image"><br><br><p>  Every day, one and a half million people are looking for a variety of products on Ozon, and for each of them the service should pick up similar ones (if the vacuum cleaner is still needed more powerfully) or accompanying ones (if batteries need a dinosaur to sing).  When there are too many types of goods, the Word2Vec model helps to solve the problem.  We understand how it works and how to create vector representations for arbitrary objects. </p><a name="habracut"></a><br><h3>  Motivation </h3><br><p>  To build and train a model, we use the standard machine learning technique of embedding, when each object turns into a vector of fixed length, and close objects correspond to close vectors.  Almost all known models require that the input data be of a fixed length, and a set of vectors is an easy way to bring them to this form. </p><br><p>  One of the first embedding methods is word2vec.  We adapted this method for our task, we use goods as words, and user sessions as sentences.  If you understand everything, feel free to browse to the results. </p><br><p>  Next, I will talk about the architecture of the model and how it works.  Since we are dealing with goods, you need to learn how to build such descriptions of them, which, on the one hand, contain enough information, and on the other, are understandable for the machine learning algorithm. </p><br><img src="https://habrastorage.org/webt/y0/pj/fz/y0pjfzmvk5o-aulmjygpnjrphji.png" alt="image"><br><p>  On the site, each product has a card.  It consists of the name, text description, characteristics and photos.  We also have data on the interaction of users with the product: views, adding to the cart or favorites are stored in logs. </p><br><p>  There are two fundamentally different ways to build a vector description of the goods: </p><br><p>  - use content - convolutional neural networks for extracting features from photos, recurrent networks or a bag of words for analyzing textual descriptions; <br>  - use of data on user interactions with the product: what products and how often they look / add to the basket with the data. </p><br><p>  We will focus on the second method. </p><br><h3>  Data for Prod2Vec model </h3><br><p>  First, let's figure out what data we use.  We have at our disposal all user clicks on the site, they can be divided into user sessions - click sequences with intervals of not more than 30 minutes between adjacent clicks.  To train the model, we use data from about 100 million user sessions, in each of which we are only interested in viewing and adding products to the basket. </p><br><p>  Example of a real user session: </p><br><img src="https://habrastorage.org/webt/q5/ov/fe/q5ovfeg-qfqarxgzxyzcfq5vssk.png" alt="image"><br><p>  Each product in the session corresponds to its context - all products that the user has added to the basket in this session, as well as products that are viewed with it.  The prod2vec model is built on the basis of the assumption that similar products often have similar contexts. </p><br><p>  For example: </p><br><img src="https://habrastorage.org/webt/ch/_m/tp/ch_mtpiawhaak2ddrks2pjxvgae.png" alt="image"><br><p>  Thus, if the assumption is true, then, for example, cases for the same phone model will have similar contexts (the same phone).  We will test this hypothesis by building product vectors. </p><br><h3>  Prod2Vec model </h3><br><p>  When we introduced the concept of the product and its context, we describe the model itself.  This is a neural network with two fully connected layers.  The number of inputs of the first layer is equal to the number of products for which we want to build vectors.  Each item at the entrance will be encoded with a vector of zeros with a single unit - the place of this product in the dictionary. </p><br><p>  The number of neurons at the output of the first layer is equal to the dimension of the vectors that we want to end up with, for example, 64. At the output of the last layer, there is again a number of neurons equal to the number of goods. </p><br><img src="https://habrastorage.org/webt/nf/0i/bf/nf0ibftkdqs3bkun8jn_qkwodfo.jpeg" alt="image"><br><br><p>  We will train the model to predict the context, knowing the product.  This architecture is called Skip-gram (its alternative is CBOW, where we predict the product from its context).  During the training, the goods are given at the entrance, the goods are expected at the exit from its context (a vector of zeros with a unit in the appropriate place). </p><br><p>  In essence, this is a multi-class classification, and cross entropy loss can be used to train the model.  For one pair of the word - the word from the context, it is written as follows: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>L</mi><mo>=</mo><mo>&amp;#x2212;</mo><msub><mi>p</mi><mi>c</mi></msub><mo>+</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="30.263ex" height="3.142ex" viewBox="0 -935.7 13030 1352.7" role="img" focusable="false" style="vertical-align: -0.969ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-4C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-3D" x="959" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2212" x="2015" y="0"></use><g transform="translate(2794,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-63" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2B" x="3926" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6C" x="5177" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6F" x="5475" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="5961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-73" x="6691" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="7161" y="0"></use><g transform="translate(7733,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6D" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-56" x="1242" y="510"></use><g transform="translate(878,-308)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-3D" x="345" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-31" x="1124" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-65" x="9860" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-78" x="10327" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="10899" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-28" x="11403" y="0"></use><g transform="translate(11792,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="712" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-29" x="12640" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>L</mi><mo>=</mo><mo>‚àí</mo><msub><mi>p</mi><mi>c</mi></msub><mo>+</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msubsup><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>V</mi></msubsup><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><msub><mi>p</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> L = -p_c + \ log \ sum_ {i = 1} ^ V exp (p_i) </script></p><br><p>  Where <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>c</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.203ex" height="1.817ex" viewBox="-38.5 -520.7 948.5 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-63" x="712" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>c</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-2"> p_c </script>  - network prediction for a product from the context, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>V</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.787ex" height="2.057ex" viewBox="0 -780.1 769.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-56" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>V</mi></math></span></span><script type="math/tex" id="MathJax-Element-3"> V </script>  - the total number of goods <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>p</mi><mi>i</mi></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.059ex" height="1.817ex" viewBox="-38.5 -520.7 886.3 782.1" role="img" focusable="false" style="vertical-align: -0.607ex; margin-left: -0.089ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="712" y="-213"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>p</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4"> p_i </script>  - network prediction for goods <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>i</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="0.802ex" height="1.937ex" viewBox="0 -728.2 345.5 834" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-5"> i </script>  . </p><br><p>  After learning the model, we can discard the second layer - it is not needed to get vectors.  The matrix of weights of the first layer (the size of the number of products x 64) while this is a dictionary of vectors of goods.  Each product corresponds to one row of a matrix of length 64 ‚Äî this is the vector corresponding to the product, which can be used in other algorithms. </p><br><p>  But this procedure does not work for a large number of goods.  And we have them, we recall, half a million. </p><br><p>  Why Prod2Vec does not work </p><br><p>  - The loss function contains many exponential take operations ‚Äî this is long and unstable computationally. <br>  - As a result, gradients are considered for all weights of the network - and there may be tens of millions of them. </p><br><p>  To solve these problems, the negative sampling method is suitable, using which we teach the network not only to predict the context for a product, but also teach not to predict products that are not exactly in the context.  To do this, we need to generate negative examples - for each product to select those that do not need to be predicted for it.  And here the presence of a huge amount of goods helps us.  When choosing a random pair for a product, we have a very small probability that it will be a product out of context. </p><br><p>  As a result, for each product in the context, we randomly generate 5-10 products that are not in the context.  At the same time, goods are not sampled by a uniform distribution, but in proportion to their frequency of occurrence. </p><br><p>  The loss function is now similar to the one used in binary classification.  For one pair of the word - the word from the context, it looks like this: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>L</mi><mo>=</mo><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><msubsup><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>O</mi></msub></mrow><mi>T</mi></msubsup><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>I</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>n</mi></msub></mrow></msub><mtext>&amp;#xA0;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><msubsup><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>n</mi></msub></mrow><mi>T</mi></msubsup><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>I</mi></msub></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="56.786ex" height="2.901ex" viewBox="0 -883.9 24449.5 1249" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-4C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-3D" x="959" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2212" x="2015" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6C" x="3044" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6F" x="3342" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="3828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-73" x="4558" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="5028" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="5373" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6D" x="5854" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-61" x="6732" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-28" x="7262" y="0"></use><g transform="translate(7651,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-54" x="809" y="488"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-4F" x="1013" y="-218"></use></g></g><g transform="translate(9283,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-49" x="1013" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-29" x="10698" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2212" x="11309" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-73" x="12560" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="13030" y="0"></use><g transform="translate(13602,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6D" x="0" y="0"></use><g transform="translate(878,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6E" x="1013" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6C" x="15708" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6F" x="16007" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="16492" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-73" x="17223" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="17692" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="18038" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6D" x="18518" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-61" x="19397" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-28" x="19926" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2212" x="20316" y="0"></use><g transform="translate(21094,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-54" x="809" y="488"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6E" x="1013" y="-213"></use></g></g><g transform="translate(22644,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-49" x="1013" y="-213"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-29" x="24060" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>L</mi><mo>=</mo><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>O</mi></msub></mrow><mi>T</mi></msubsup><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>I</mi></msub></mrow></msub><mo stretchy="false">)</mo><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>s</mi><mi>u</mi><msub><mi>m</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>n</mi></msub></mrow></msub><mtext>&nbsp;</mtext><mi>l</mi><mi>o</mi><mi>g</mi><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mo>‚àí</mo><msubsup><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>n</mi></msub></mrow><mi>T</mi></msubsup><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>I</mi></msub></mrow></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-6"> L = - \ log \ sigma (u_ {w_O} ^ T v_ {w_I}) - \ sum_ {w_n} \ log \ sigma (-u_ {w_n} ^ T v_ {w_I}) </script></p><br><p>  In this notation <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>O</mi></msub></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.79ex" height="2.057ex" viewBox="0 -520.7 1631.6 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-4F" x="1013" y="-218"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>O</mi></msub></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-7"> u_ {w_O} </script>  denotes the column of the weights matrix of the second layer, corresponding to the product from the context, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>u</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>n</mi></msub></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.6ex" height="2.057ex" viewBox="0 -520.7 1550.1 885.9" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-75" x="0" y="0"></use><g transform="translate(572,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6E" x="1013" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>u</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>n</mi></msub></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-8"> u_ {w_n} </script>  - the same for a randomly selected item, <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>v</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>w</mi><mi>I</mi></msub></mrow></msub></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="3.287ex" height="1.937ex" viewBox="0 -520.7 1415.1 834" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-76" x="0" y="0"></use><g transform="translate(485,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-77" x="0" y="0"></use><use transform="scale(0.5)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-49" x="1013" y="-213"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>v</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>w</mi><mi>I</mi></msub></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-9"> v_ {w_I} </script>  - row of the matrix of weights of the first layer, corresponding to the main product (this is the vector that we build for it).  Function <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy=&quot;false&quot;>(</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mn>1</mn><mo>+</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;#x2212;</mo><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="31.937ex" height="2.66ex" viewBox="0 -832 13750.5 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-73" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-67" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-6D" x="1545" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-61" x="2424" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-28" x="2953" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-78" x="3343" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-29" x="3915" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-3D" x="4582" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-66" x="5889" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-72" x="6439" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-61" x="6891" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-63" x="7420" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-31" x="7854" y="0"></use><g transform="translate(8354,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-31" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2B" x="722" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-65" x="1723" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-78" x="2189" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-70" x="2762" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-28" x="3265" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-2212" x="3655" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMATHI-78" x="4433" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ozontech/blog/432760/&amp;xid=17259,15700021,15700186,15700191,15700248,15700253&amp;usg=ALkJrhg2gciopdJ8TnRbW-YU20P48mICWQ#MJMAIN-29" x="5006" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>s</mi><mi>i</mi><mi>g</mi><mi>m</mi><mi>a</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mn>1</mn><mo>+</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mo>‚àí</mo><mi>x</mi><mo stretchy="false">)</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-10"> \ sigma (x) = \ frac {1} {1 + exp (-x)} </script>  . </p><br><p>  The difference from the previous version is that we do not need to update all network weights at each iteration, we need to update only those that correspond to a small number of products (the first product is the one for which we predict, the others are either the product from its context or randomly selected ).  At the same time, we got rid of a huge number of exhibitors taking at each iteration. </p><br><p>  Another technique that in turn improves the quality of the model obtained is subsampling.  In this case, we intentionally take less frequent items for training in order to get the best result for rare items. </p><br><h3>  results </h3><br><h4>  Similar products </h4><br><p>  So, we learned to get vectors for products, now we need to check the adequacy and applicability of our model. </p><br><p>  The following picture shows the product and its closest neighbors for the cosine proximity. </p><br><img src="https://habrastorage.org/webt/n7/rp/ja/n7rpjaf-eyfsmq7mtmd6womojfw.jpeg" alt="image"><br><p>  The result looks good, but you need to check out numerically how good our model is.  To do this, we applied it to the task of product recommendations.  For each product, we recommended coming in the constructed vector space.  We compared the prod2vec model with a much simpler, based on the statistics of joint views and additions to the basket.  For each product in the session was taken a list of 7 recommendations to it.  Combining all the recommended products in the session was compared with what the person actually added to the basket.  Using prod2vec, in more than 40% of the sessions we recommended at least one product, which was later added to the cart.  For comparison, a simpler algorithm shows a quality of 34%. </p><br><p>  The resulting vector description allows not only to search for the goods coming (which can be done by a simpler model, albeit with worse quality).  We can consider what interesting side effects can be shown using our model. </p><br><h3>  Vector arithmetic </h3><br><p>  To illustrate that vectors carry real meaning about goods, we can try to apply vector arithmetic to them.  As in the textbook example about word2vec (king - man + woman = queen), we can, for example, wonder what product is at about the same distance from the printer as the dust collector is from the vacuum cleaner.  Common sense suggests that it should be some kind of consumables, namely the cartridge.  Our model is able to catch such patterns: </p><br><img src="https://habrastorage.org/webt/m1/j5/ac/m1j5aca_jsyjupowx9yapcorpmo.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    
<h3>  Product space visualization </h3><br><p>  To better understand the results, we can visualize the vector space of products on a plane, reducing the dimension to two (in this example, we used t-SNE). </p><br><img src="https://habrastorage.org/webt/_d/v8/m1/_dv8m1fmgufpknn_l1klly2wqwi.png" alt="image"><br><br>  It can be clearly seen that related products form clusters.  For example, clusters with textiles for the bedroom, men's and women's clothing, and shoes are clearly visible.  Once again, we note that this model is based only on the history of user interaction with products; we did not use the similarity of images or text descriptions when teaching. <br><p>  From the illustration of the space you can also see how with the help of the model you can select accessories for the goods.  To do this, you need to take goods from the nearest cluster, for example, to recommend sporting goods for T-shirts, and hats for warm sweaters. </p><br><h3>  Plans </h3><br><p>  Now we are introducing the prod2vec model in production to calculate product recommendations.  Also, the resulting vectors can be used as signs for other machine learning algorithms that our team deals with (prediction of demand for products, ranking in search and catalogs, personal recommendations). </p><br><p>  In the future, we plan to implement the obtained embeddings on the site in real-time.  For all viewed products in the session will be closest, which will instantly be reflected in the personalized issue.  We also plan to integrate image analysis and similarities in the vector description into our model, which will greatly improve the quality of the vectors obtained. </p><br><p>  If you know how to do it better (or redo it), come to visit (and even better work). </p><br><p>  <b>References:</b> </p><br><ol><li>  Mikolov, Tomas, et al.  "Distributed representations of words and phrases and their compositionality."  Advances in neural information processing systems.  2013 </li><li>  Grbovic, Mihajlo, et al.  "E-commerce in your inbox: Product recommendations at scale."  Proceedings of the 21st ACM SIGKDD International Conference on Knowledge Discovery and Data Mining.  ACM, 2015. </li><li>  Grbovic, Mihajlo, and Haibin Cheng.  "Real-time Personalization using Embeddings for the Search Ranking at Airbnb."  Proceedings of the 24th ACM SIGKDD International Conference on Knowledge Discovery &amp; Data Mining.  ACM, 2018. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/432760/">https://habr.com/ru/post/432760/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../432748/index.html">Kubernetes tips & tricks: on node allocation and web application loads</a></li>
<li><a href="../432750/index.html">Joy Haxe. Novel with a deprived programming language</a></li>
<li><a href="../432752/index.html">An anthill or a fortress? Building a house for the price of an apartment. 3 part. Power supply</a></li>
<li><a href="../432754/index.html">In-Memory and On-Disk data storage will be submitted to the public.</a></li>
<li><a href="../432756/index.html">We implement accessibility support without changing the visual component of the mobile application.</a></li>
<li><a href="../432762/index.html">AI lie detector can detect when a person is lying</a></li>
<li><a href="../432764/index.html">UDB. What is it?</a></li>
<li><a href="../432766/index.html">How to encode a secret message in fingerprint</a></li>
<li><a href="../432768/index.html">Wireless headphones for "serial marathons": in Dolby they will be offered for $ 599</a></li>
<li><a href="../432770/index.html">Botnets and their types: what is known in 2018</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>