<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Templates in JavaScript using Razor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Due to the increasing complexity of web applications on the client side, I want to have template engines that work directly on the client. And I must ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Templates in JavaScript using Razor</h1><div class="post__text post__text-html js-mediator-article">  Due to the increasing complexity of web applications on the client side, I want to have template engines that work directly on the client.  And I must say that such means appeared quite a few.  But since <s>I don‚Äôt look for easy ways,</s> I don‚Äôt like all of them, I decided to make my own with blackjack and ladies of easy virtue (as I understand it, Habr√© is severely punished and banned if this phrase is not in the post). <br><br>  So I decided to create a strictly typed template engine on the Razor. <a name="habracut"></a><br><br><h4>  Razor </h4><br>  For those who missed, Razor is such an elegant language for generating markup, which is embedded in C # or VB.  It is used in ASP.NET MVC and WebMatrix. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I will not paint all his wonderful properties, since Scott Guthrie has already <a href="http://weblogs.asp.net/scottgu/archive/2010/07/02/introducing-razor.aspx">done</a> this for me, and even <a href="http://habrahabr.ru/post/98241/">translated</a> to Habr√©. <br><br>  The important thing is that it is <b>strictly typed</b> , and has excellent support in Visual Studio, including <b>IntelliSense</b> . <br><br>  Moreover, since  I develop web projects on .Net using ASP.NET MVC, and I describe presentations on Razor, then for me this is an ideal option.  Moreover, with due diligence, you can get rid of re-writing code - use the same templates on the server and on the client. <br><br>  Using Razor outside of MVC is <a href="http://habrahabr.ru/post/111837/">not a big problem</a> , but the code it generates is C #, and we need JavaScript.  And here I came to the rescue ... <br><br><h4>  SharpKit </h4><br>  This wonderful tool is somehow <a href="http://habrahabr.ru/search/%3Ftarget_type%3Dposts%26order_by%3Drelevance%26q%3Dsharpkit">overlooked by Habr</a> .  It allows you to convert C # code to javascript. <br>  For example from this <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharpKit.JavaScript; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> SharpKit.jQuery; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Namespace</span></span> { [JsType(JsMode.Global)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyPageClient</span></span> : <span class="hljs-title"><span class="hljs-title">jQueryContext</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { J(document.body).append(J(<span class="hljs-string"><span class="hljs-string">"&lt;h1/&gt;"</span></span>).text(<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + name.ToUpper())); } } }</code> </pre> <br>  will turn into <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Hello</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">name</span></span></span><span class="hljs-function">) </span></span>{ $(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body).append($(<span class="hljs-string"><span class="hljs-string">"&lt;h1/&gt;"</span></span>).text(<span class="hljs-string"><span class="hljs-string">"Hello, "</span></span> + name.toUpperCase())); };</code> </pre><br><br>  On the <a href="http://sharpkit.net/">official website of the</a> project there is a tolerable documentation.  And also you can play around <a href="http://sharpkit.net/Live.aspx">converting online</a> . <br><br>  SharpKit paid, but, exactly, worth the money.  For open-source projects you can get a free license.  And for commercial ones, you can convert up to 2500 lines of JavaScript code for free, which can sometimes be enough. <br>  By the way, although I am well versed in JavaScript, I have been using SharpKit for a long time, and I advise you.  All the same, it is much more convenient to write with types, normal intellisense, and error checking at the compilation stage. <br><br>  Something I was distracted, but, as you understood, it was with the help of SharpKit that the templates on Razor, first turned into C #, are turned into JavaScript. <br><br><h4>  Msbuild </h4><br>  Well, in order for this to be done during the project build, I decided to integrate the whole business through MSBuild, for which I implemented the task. <br><br>  And so, I present the project <br><br><h4>  SharpKit Razor </h4><br>  Yes, I did not invent any original name. <br><br>  <a href="https://sharpkitrazor.codeplex.com/">Official site of the project on CodePlex</a> <br>  Eh, I hardly had a description in English, but <a href="http%253A%252F%252Fsharpkitrazor.codeplex.com%252F">Google still does not understand me</a> . <br><br>  There is only the source code, demo. <br><br><h4>  And now in more detail - with codes, yes more </h4><br>  Well, yes, it's habr, you'll have to completely gut all guts.  Read only to those who have not yet understood everything how everything is implemented. <br><br><h5>  Base for Razor </h5><br>  When the Razor engine processes the code, it‚Äôs from something like that <br><pre> <code class="html hljs xml">@inherit MyBase<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string[]</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span>@item<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ul</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  on output generates a class of something like this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">MyNamespace</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">MyView</span></span>: <span class="hljs-title"><span class="hljs-title">MyBase</span></span>&lt;<span class="hljs-title"><span class="hljs-title">string</span></span>[]&gt; { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { WriteLiteral(<span class="hljs-string"><span class="hljs-string">"&lt;ul&gt;\r\n"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Model) { WriteLiteral(<span class="hljs-string"><span class="hljs-string">"\t&lt;li&gt;"</span></span>); Write(item); WriteLiteral(<span class="hljs-string"><span class="hljs-string">"&lt;/li&gt;\r\n"</span></span>); } WriteLiteral(<span class="hljs-string"><span class="hljs-string">"&lt;/ul&gt;"</span></span>); } } }</code> </pre><br><br>  Therefore, we make the base class such that it can be executed (the Execute method) and write data to the output stream (screened - the Write method, unshielded - the WriteLiteral method). <br>  Further, in order to make it convenient to operate with our classes of views in a general form, we also select the interface IRenderingArea. <br>  It turns out that we have this: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRenderingArea</span></span> { [JsProperty(NativeField = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Model { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } [JsProperty(NativeField = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">interface</span></span> <span class="hljs-title"><span class="hljs-title">IRenderingArea</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt;: <span class="hljs-title"><span class="hljs-title">IRenderingArea</span></span> { [JsProperty(NativeField = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T Model { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre><br>  Here the interfaces are immediately with a typed and untyped version.  With the help of JsProperty it is marked that SharpKit turns Result not into a field, but into the get_Result () function.  So there will be more space for tricky maneuvers. <br>  Well, the base class itself will be: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsType(JsMode.Prototype)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">HtmlArea</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt;: <span class="hljs-title"><span class="hljs-title">JsContext</span></span>, <span class="hljs-title"><span class="hljs-title">IRenderingArea</span></span>&lt;<span class="hljs-title"><span class="hljs-title">T</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> _result = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Result { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _result; } } [JsField(Export = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> T _model; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> T Model { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _model; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { _model = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } [JsProperty(Export = <span class="hljs-literal"><span class="hljs-literal">false</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> IRenderingArea.Model { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Model; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { Model = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.As&lt;T&gt;(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Write</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">value</span></span> != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) _result += EscapeValue(<span class="hljs-keyword"><span class="hljs-keyword">value</span></span>.As&lt;JsObject&gt;().toString()); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EscapeValue</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">JsString </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> .replace(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;amp;"</span></span>) .replace(<span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;lt;"</span></span>) .replace(<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;gt;"</span></span>) .replace(<span class="hljs-string"><span class="hljs-string">"\""</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;quot;"</span></span>) .replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">"&amp;#39;"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLiteral</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { _result += <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">abstract</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Execute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; }</code> </pre><br>  As you can see, here the class is adapted to be used in JavaScript. <br>  Escaping is done with a blunt replacement of several special characters. <br><br>  Purely for reference, I cite the resulting javascript: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/*Generated by SharpKit v4.24.9000*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(XWeb) == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) XWeb = {}; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(XWeb.SharpKit) == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) XWeb.SharpKit = {}; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(XWeb.SharpKit.Razor) == <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) XWeb.SharpKit.Razor = {}; XWeb.SharpKit.Razor.AreaExtensions = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ }; XWeb.SharpKit.Razor.AreaExtensions.Execute = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">view,model</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> area=view(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(model) != <span class="hljs-string"><span class="hljs-string">"undefined"</span></span>) area.set_Model(model); area.Execute(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> area.get_Result(); }; XWeb.SharpKit.Razor.HtmlArea = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result = <span class="hljs-string"><span class="hljs-string">""</span></span>; }; XWeb.SharpKit.Razor.HtmlArea.prototype.get_Result = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result; }; XWeb.SharpKit.Razor.HtmlArea.prototype.get_Model = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._model; }; XWeb.SharpKit.Razor.HtmlArea.prototype.set_Model = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._model = value; }; XWeb.SharpKit.Razor.HtmlArea.prototype.Write = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(value != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result += <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.EscapeValue(value.toString()); }; XWeb.SharpKit.Razor.HtmlArea.prototype.EscapeValue = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> value.replace(<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>,<span class="hljs-string"><span class="hljs-string">"&amp;amp;"</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"&lt;"</span></span>,<span class="hljs-string"><span class="hljs-string">"&amp;lt;"</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"&gt;"</span></span>,<span class="hljs-string"><span class="hljs-string">"&amp;gt;"</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"\""</span></span>,<span class="hljs-string"><span class="hljs-string">"&amp;quot;"</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>,<span class="hljs-string"><span class="hljs-string">"&amp;#39;"</span></span>); }; XWeb.SharpKit.Razor.HtmlArea.prototype.WriteLiteral = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">value</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>._result += value; };</code> </pre><br><br>  Now, in order for the resulting classes of representations to be launched, and to get the result from them, some mechanism is needed. <br>  First, you need to decide what information we need to run the template.  To refer to templates by name is possible, but somehow not kosher in our strictly typed world of C #.  Therefore, I decided that I just needed information on how to create an instance of the template.  Those.  the template creation function will be the information about the template.  And then, in order to run the template, add a special extension: <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">JsType(JsMode.Prototype)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AreaExtensions</span></span> { [JsMethod(OmitOptionalParameters = <span class="hljs-literal"><span class="hljs-literal">true</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Execute&lt;T&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> Func&lt;IRenderingArea&lt;T&gt;&gt; view, T model = <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>(T)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> area = view(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (JsContext.JsTypeOf(model) != JsTypes.undefined) area.Model = model; area.Execute(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> area.Result; } }</code> </pre><br>  This extension simply creates an instance of the template, sets the model, runs and retrieves the result. <br><br><h5>  Class generation </h5><br>  Next, the Razor engine comes into play, which should generate a template class. <br>  It's all quite simple: <br><br>  Oops!  Habr no longer allows writing.  So wait for the continuation. </div><p>Source: <a href="https://habr.com/ru/post/142475/">https://habr.com/ru/post/142475/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142469/index.html">Preparing and publishing applications in the Marketplace</a></li>
<li><a href="../142470/index.html">New LTE network in Krasnodar</a></li>
<li><a href="../142472/index.html">Using RF-2400 radio modules from Inhaos</a></li>
<li><a href="../142473/index.html">APIshnik Yandex.Maps</a></li>
<li><a href="../142474/index.html">Mele A1000 is an interesting competitor to the Raspberry Pi</a></li>
<li><a href="../142476/index.html">Using QSerialDevice and Qwt libraries to organize communication with the controller and display data</a></li>
<li><a href="../142477/index.html">HTC is going to refuse to increase the capacity of batteries and QWERTy-keyboards</a></li>
<li><a href="../142478/index.html">linkCharge.Offline: method of payment for products and services for offline buyers</a></li>
<li><a href="../142479/index.html">Popular network equipment and vulnerability statistics</a></li>
<li><a href="../142480/index.html">Video review smartphones HTC One X and HTC One V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>