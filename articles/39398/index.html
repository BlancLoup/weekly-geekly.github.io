<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SilverlightDraw 1.0a - Analog Canvas from WinForms</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Post from my blog . 
 2008 came and SL 2 Beta 1 came, it was a complete solution, without JS roots ... The first tests showed good performance and con...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SilverlightDraw 1.0a - Analog Canvas from WinForms</h1><div class="post__text post__text-html js-mediator-article">  Post from my <a href="http://notesdis.blogspot.com/2008/07/silverlightdraw-10a-rus-edition.html">blog</a> . <br>  2008 came and SL 2 Beta 1 came, it was a complete solution, without JS roots ... The first tests showed good performance and convenience, MS turned out to be a decent product.  Although he had his drawbacks, he was impressed on sprite concepts.  It was impossible to draw anything, Path is very slow, and Ellipse, Rectangle and Line have absolutely bad performance.  For a long time I was looking for ways to draw with raster, not objects. <a name="habracut"></a>  Accidentally came <a href="http://blogs.msdn.com/jstegman/archive/2008/04/21/dynamic-image-generation-in-silverlight.aspx">across</a> an article by <a href="http://blogs.msdn.com/jstegman/archive/2008/04/21/dynamic-image-generation-in-silverlight.aspx">Joe Stegman, Dynamic Image Generation in Silverlight</a> .  After research, it was noticed that SL performance is very dependent on memory allocation.  After optimizing and minimizing memory allocation in the encoder, OneMem technology was created.  Below are the results of the comparison of the two technologies. <br><br>  Environment: <br><br>  * Athlon 64 X2 4800+, Mem 2Gb. <br>  * WinXP SP2, .Net1.1, .Net2.0, .Net3.5, Firefox 2.0.1.4. <br><img src="https://habrastorage.org/getpro/habr/post_images/ef0/469/a0a/ef0469a0abd81b62fae83488d29c4e61.png"><br>  * FPS - Frames Per Second (frames per second) <br><img src="https://habrastorage.org/getpro/habr/post_images/508/5e1/802/5085e18027a1c1491e228eac1ac25d9e.png"><br>  The tests consisted in a full fill of the area 400x400px in color, with a frequency of Interval.  All measurements of the CPU load were carried out through the Task Manager, for the Firefox 2 application. The FPS was measured via the built-in SL counter, the maximum value is 62. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      As can be seen from the table, the OneMem technology allowed us to increase performance by 8 times in CPU% and more than 3 times in FPS relative to the Original PNG Encoder. <br><br>  Memory allocations were also minimized, which made it impossible to leak 640kb of memory per frame rendering (400x400), which, with Interval = 50, reduces the leakage of 12mb of memory. <br><br>  A newer version of the Original PNG Encoder is currently available, and it may be faster. <br><br>  After optimizing the Encoder, it was decided to make a complete SilverlightDraw solution, implementing the Graphics class in it with which it would be easy to export graphics work from .Net desktop programs to SL. <br><br>  After finishing work on the Alpha version of SilverlightDraw, the following features were implemented: <br><table><tbody><tr><th>  Feature </th><th>  Status </th></tr><tr><td>  Clip </td><td>  Yes </td></tr><tr><td>  Transform </td><td>  Move only </td></tr><tr><td>  Drawpoint </td><td>  Yes </td></tr><tr><td>  Drawline </td><td>  Yes, Bresenham algorithm </td></tr><tr><td>  Pen </td><td>  Color, Width (Only for rectilinear lines), <br>  DashStyle (Only for Width == 1) </td></tr><tr><td>  Brush </td><td>  SolidBrush only </td></tr><tr><td>  Drawpolygon </td><td>  Yes </td></tr><tr><td>  Fillrectangle </td><td>  Yes </td></tr><tr><td>  Copybitmap </td><td>  Support for various filters (Copy, AND, OR, etc.) <br>  You can create your own filter </td></tr><tr><td>  Font </td><td>  Downloading "fonts" from the server <br>  Font loading required before use. </td></tr><tr><td>  Drawstring </td><td>  Output only in horizontal direction </td></tr><tr><td>  PNGDecoder </td><td>  Convert PNG images to Graphics <br>  Only PNG32 (ARGB) format is supported. </td></tr></tbody></table><br><img src="https://habrastorage.org/getpro/habr/post_images/c75/b94/a15/c75b94a157d406757bce5191b44e1fc4.png"><br>  Figure 1. Visualization of opportunities <br><br>  In the process of implementing the Font manager, a PNGDecoder class was created that can convert a PNG (8bit per channel, ARGB - ONLY) picture to the Graphics class, which allows you to load and use pictures in the rasterization process. <br><br>  Fonts are stored as two files: <br><br>  * .png - a picture with a font <br>  * .FontConfig - where settings, font information and character coordinates are stored <br><br>  For the convenience of creating fonts, the SilverlightFontGenerator program has been created. <br><img src="https://habrastorage.org/getpro/habr/post_images/033/5e3/d12/0335e3d123ae9dd66abdbc672cd3cf28.png"><br>  Which itself creates the files necessary for the "font". <br><br>  To evaluate the performance of SilverlightDraw (OneMem), a test application was created that draws a specified number of lines (ItemCount) with an interval (Interval, ms) on an image of 400x400 size. <br><br>  The speed of drawing lines with SilverlightDraw technology and drawing lines with the help of the Path object, the task of the last geometry (the Data field) are tested.  All results are obtained without restarting the page. <br><img src="https://habrastorage.org/getpro/habr/post_images/89c/d26/ce2/89cd26ce2fbec8c49409b23e4948f430.png"><br><img src="https://habrastorage.org/getpro/habr/post_images/e7d/ea7/c20/e7dea7c2046b71f5e367aea682ab4010.png"><br>  As can be seen from the graphs with a large number of objects, Path dramatically increases the CPU utilization%, which leads to a catastrophic fall in FPS, and SilverlightDraw gradually decreases its performance with an increase in the number of lines.  Most likely, a strong CPU load when displaying the Path is due to the fact that the SL2 engine uses Anti-aliasing filtering when displaying objects. <br><br>  At the same time, it is necessary to take into account that SilverlightDraw allows you to draw each line in any color, unlike a Path object that can draw all lines with only one selected color. <br><br>  Unfortunately, it was not possible to measure FPS on FireFox3, since the number of FPS was not displayed in the status bar, so all measurements were made on Internet Explorer 6.0.2900.2180.xpsp_sp2_qfe.070719-1309 <br><br>  Hardware, operating system and software remained the same, see the first test. <br><br>  An additional reason for reducing Path performance is to use a XamlReader to set geometry: <br><br><pre> var sb = new StringBuilder ("&lt;Path xmlns = \" http: //schemas.microsoft.com/client/2007 \ "Data = \" \ "");
 sb.Append (path_data) .Append ("\" /&gt; ");
 Path path1 = (Path) XamlReader.Load (sb.ToString ());
 var o = path1.GetValue (System.Windows.Shapes.Path.DataProperty);
 path1.Data = null;
 path.SetValue (System.Windows.Shapes.Path.DataProperty, o); </pre><br><br>  This is due to the fact that in Silverlight 2 Beta 2 it was not possible to directly assign a row with a geometry property to the Data property, as a result of which XamlReader is used. <br><br>  In the future we plan to implement support for ellipses, fill an arbitrary area and produce a global fix for bugs. <br>  Link to the <a href="http://www.powderlab.ru/SilverlightDraw/">demo</a> . <br><br>  PS: This is my first post. </div><p>Source: <a href="https://habr.com/ru/post/39398/">https://habr.com/ru/post/39398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../393967/index.html">Leaving the banking system. How to live only on Bitcoins</a></li>
<li><a href="../393969/index.html">A woman drove into the lake on the GPS-navigator</a></li>
<li><a href="../39397/index.html">New little feature on Habr√©</a></li>
<li><a href="../393973/index.html">The Tesla Model S provides the possibility of a software upgrade battery</a></li>
<li><a href="../393977/index.html">AdBlock and AdBlock Plus - now for Edge</a></li>
<li><a href="../393981/index.html">The astronomical program determined what time of the year 2500 years ago the poem Sappho was written.</a></li>
<li><a href="../393983/index.html">Free graphic editor Krita for the third time on Kickstarter</a></li>
<li><a href="../393985/index.html">Microsoft is guerilla-setting users on the PC to automatically upgrade to Windows 10</a></li>
<li><a href="../393989/index.html">HoloFlex: flexible holographic smartphone</a></li>
<li><a href="../393991/index.html">Windows 10 Pro can no longer block Windows Store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>