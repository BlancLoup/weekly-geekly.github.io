<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Build system options selection panel in Sublime Text 2. (or how the bike was invented)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Idea and implementation: click the shortcut in SublimeText2, get a panel with a list of build options automatically generated from the file of the sel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Build system options selection panel in Sublime Text 2. (or how the bike was invented)</h1><div class="post__text post__text-html js-mediator-article">  Idea and implementation: click the shortcut in SublimeText2, get a panel with a list of build options automatically generated from the file of the selected Build System, select the option you want and observe how the project‚Äôs build process is displayed directly in the Sublime Text 2 interface. <br><br>  I will say right away that here I am sharing my invaluable experience in joint development of the <a href="https://github.com/Snegovikufa/ProjectBuild">ProjectBuild</a> plug-in for Sublime Text 2, because as a result, only experience was gained, because, as it turned out, there was no need to implement this plug-in, and the whole process turned out to be an invention of the bicycle.  Sadly, the experience is still priceless.  The narration will be such that the "bicycle" will be said only at the end. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  The result of the previously written article <a href="http://habrahabr.ru/post/149087/">‚ÄúAutomating the Build of a Project in Sublime Text 2 using Ant‚Äù</a> was the ability to call in Sublime Text 2 various build options of the selected Build System (using the example of Ant) using the assigned shortcut keys for them.  (now I would also use the word ‚Äúsetting‚Äù in the topic of that post) <br><br>  What I didn't like about this approach: <br><ol><li>  Different Build Systems could have completely different names of their variants, and keyboard shortcuts were already explicitly tied to specific variant names, which could not be in another Build System.  My assumption was that most developers don't often have to switch between multiple Build Systems, and the developer basically works with a single Build System.  And if the developer wants, then change the shortcut keys again.  But agree, it is a bit annoying.  And this must be remembered.  And in the sequel, also </li><li>  You need to remember all the shortcuts you assigned.  It is clear that there are basic ‚ÄúF7‚Äù, ‚ÄúCtrl + B‚Äù, ‚ÄúCtrl + Shift + B‚Äù - but for each of your options there will be another combination.  This means that you need to either redefine the shortcut key that already exists, or find the unused key, which would be convenient for both fingers and the brain.  I tried to find convenient unoccupied ones, but I stopped on redefining.  And this is also depressing, since it could potentially deprive you of the original capabilities of these combinations when they are redefined.  And also to restrict later, when you need new shortcut keys for new plug-ins, and convenient ones have already been set up for calls to different build-options. </li></ol>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And then I tried the plugin <a href="https://github.com/Snegovikufa/ProjectBuild">ProjectBuild</a> for Sublime Text 2 from <a href="http://habrahabr.ru/users/snegovikufa/" class="user_link">snegovikufa, which was</a> written to me in the comments.  What I really liked was a drop-down panel with a list of commands.  By selecting an item from the list provided, it was possible to run the corresponding command.  All the settings of this plugin were stored in a separate file, access to which was from the menu of Sublime Text 2 itself, where it was possible to list the list of names and the corresponding commands.  Simply put, this plugin could be configured to launch a ‚Äúthird-party program‚Äù directly from the interface of Sublime Text 2. And in particular, it could be used to run Ant with the names of the necessary targets.  I screwed ProjectBuild to my AntProjectBuilder.sublime-build in the forehead.  So this solved the second problem.  We assign one shortcut (yes at least ‚ÄúCtrl + Shift + B‚Äù), it forms the ProjectBuild plug-in panel in the Sublime Text 2 interface, where you can select and run the desired command in accordance with the ProjectBuild configuration. <br><br>  But the plugin worked in such a way that, while calling the ‚Äúthird-party program,‚Äù although it did not block the interface of Sublime Text 2 itself, it left no trace of the success or failure of the call.  For example, my command line was called, Ant worked on it, and it disappeared.  In the console itself Sublime Text 2 traces left.  And this was achieved only with the blocking of the Sublime Text 2 interface. That is, the command was called, the Sublime Text 2 interface hung, and after working out this process, they spat out all their output into the Sublime Text 2 console. The whole process was not ‚Äúobserved‚Äù. <br><br>  And with this use, when ProjectBuild has to implement the functionality of the build mechanism of Sublime Text 2, the first problem was not solved - the explicit indication of options, and there was also excessive configuration.  We had to configure ProjectBuild to create a list of options for the panel, although this list of options already exists directly in the "* .sublime-build" file of the selected Build System itself.  I contacted <a href="http://habrahabr.ru/users/snegovikufa/" class="user_link">snegovikufa</a> , he quickly brought me up to date on how to work with GitHub, and I proceeded to change the plugin. <br><br><h4>  Offtopic on the process of reworking the plugin ProjectBuild </h4><br><h5>  Github </h5><br>  I was very pleased with this ‚Äúaccounting code‚Äù system (of course I am exaggerating), I have never worked with git before, but it took less than half an hour to deal with it, especially since there is an exhaustive git guide for both Linux and and for Windows users on GitHub itself.  I wrote a working code, <a href="http://habrahabr.ru/users/snegovikufa/" class="user_link">snegovikufa</a> qualitatively reworked it on the subject of Python notation, and so on, correcting each other and writing off, got the result, licked the working result now in the <a href="https://github.com/Snegovikufa/ProjectBuild/tree/dev">dev branch</a> Thing!  My first impression, collaborative development and git (GitHub in particular) are made for each other. <br><br><h5>  API Sublime Text 2 and Python </h5><br>  There are <a href="http://www.sublimetext.com/docs/2/">official</a> and <a href="http://sublime-text-unofficial-documentation.readthedocs.org/en/latest/index.html">unofficial</a> documentation.  At first, it seemed that the Sublime Text 2 API capabilities were not so great either, but they were quite enough.  What was missing was implemented in Python.  As I said earlier, I don‚Äôt know Python, but to develop the intended functionality of the plug-in I didn‚Äôt need much knowledge.  Yes, and <a href="http://habrahabr.ru/users/snegovikufa/" class="user_link">snegovikufa</a> promptly corrected potentially incomprehensible moments for third parties.  The only thing I wanted to find for the sake of interest, but I could not, is the list of all possible keys and Settings values ‚Äã‚Äãthat exist in Sublime Text 2 by default, although it may have been looking poorly. <br><br>  According to the format of the "* .sublime-workspace" file, the documentation states that this is JSON format, but it was found out that an error could be generated when json-parsing this file.  The fact is that the json-key in its data may be empty, but this was ignored by the ProjectBuild plugin like this: <br><br><pre><code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">... </span></span>json.load (f, strict = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>)</code> </pre> <br>  Even with Sublime Text 2 in the "* .sublime-build" file, a variable with "$ project_path" can be used, and I don‚Äôt understand why the developers of Sublime Text 2 did not provide for its (and other) use in shortcuts for shortcuts, where , for example, called "third-party" for Sublime programs.  Maybe this is for security reasons, so that some plug-in with a triggered shortcut key doesn‚Äôt put something ‚Äúitself‚Äù on the project, but still. <br><br><h5>  The final plugin code </h5><br><div class="spoiler">  <b class="spoiler_title">Spoiler</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sublime <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sublime_plugin <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ProjectBuildCommand</span></span></span><span class="hljs-class"> </span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(sublime_plugin.TextCommand)</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, edit = None)</span></span></span><span class="hljs-function"> :</span></span> <span class="hljs-comment"><span class="hljs-comment"># Save file if dirty if self.view.is_dirty () : self.view.run_command ('save') ############################################ # #   .sublime-workspace #          #      # workspace_file = None root_folders = self.view.window ().folders () for dir_ in root_folders : for dir_item in os.listdir (dir_) : if dir_item.endswith ('.sublime-workspace') : if workspace_file == None : workspace_file = os.path.join (os.path.normpath(dir_), dir_item) else : self.showError ( 'Must be only one ".sublime-workspace" file in project root folder.\n' 'Plugin found %s and %s files.' % (workspace_file, os.path.join (dir_, dir_item))) return if workspace_file == None : self.showError ( 'There are no ".sublime-workspace" file in any root folder of project.') return self.debug(workspace_file) # ############################################ ############################################ # #       Build System # with open (workspace_file) as f : try: workspace_json_data = json.load (f, strict = False) except Exception, e: self.showError ( 'File .sublime-workspace is empty or has incorrect json data') return if not 'build_system' in workspace_json_data : self.showError ( 'There are no "build_system" value in %s file.\n' 'Choose Build System and save project.' % workspace_file) return build_filename = workspace_json_data['build_system'] self.debug(build_filename) # ############################################ ############################################ # #     Build System #      # build_filename_fullpath = os.path.normpath( os.path.join(os.path.dirname(sublime.packages_path()),build_filename)) if not(os.path.isfile(build_filename_fullpath)): self.showError ( 'Plugin could not find Build System file: "%s".' % build_filename_fullpath) return self.debug(build_filename_fullpath) # ############################################ ############################################ # #  JSON  # with open (build_filename_fullpath) as f : try: json_data = json.load (f) except Exception, e: self.showError ( 'File %s is empty or has incorrect json data' % build_filename_fullpath) return # ############################################ ############################################ # #   build-  Build System # build_variants = [] if "cmd" in json_data: build_variants.append (['Default', " ".join (json_data["cmd"])]) for variant in json_data.get ("variants", {}) : build_variants.append ( [variant['name'], " ".join (variant['cmd'])]) # ############################################ ############################################ # #   . # def run (selected) : if (selected &gt;= 0) : self.execute_variant (build_variants[selected][0]) names = [name for name, args in build_variants] self.view.window ().show_quick_panel (names, run) # ############################################ def execute_variant (self, variant_name) : self.view.window ().run_command ("build", {"variant": variant_name}) def showError (self, err) : #      Sublime API #   ,       sublime.error_message ('ProjectBuild:\n\n%s' % err) def debug (self, message) : # change True to False or vice versa if (False): print message</span></span></code> </pre></div></div><br><h4>  findings </h4><br>  Now for ProjectBuild no config is needed.  You just need to choose the Build System you need (a standard system or your own, like my ‚ÄúAntProjectBuilder.sublime-build‚Äù).  Save the project in Sublime Text 2 in such a way that the project manifest file "* .sublime-workspace" is in one of its root folders.  The ProjectBuild plugin tracks the presence of this file and its uniqueness, since information about the current Build System is taken from it.  When changing the Build System in Sublime Text 2, do not forget to save the project so that the above file is updated.  Click the keyboard shortcut assigned to ProjectBuild and see the panel with a list of build options.  The list is generated automatically by the description of the variants of the Build System selected in Sublime Text 2 existing in the "* .sublime-build" file. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d57/17b/7cd/d5717b7cd5bc02bb9b1ae0ab8d212503.png" alt="https://habrastorage.org/getpro/habr/post_images/d57/17b/7cd/d5717b7cd5bc02bb9b1ae0ab8d212503.png"></a> <br><br>  The problems indicated at the very beginning of the article were successfully solved: one shortcut is involved and it works with the build mechanism of Sublime Text 2 itself and in its interface without tight binding and explicit naming of the called build variants. <br><br>  The plugin still has room for improvement, for example, platform-specific options are now ignored, which can be specified in the Build System file, but for me personally, so far enough is enough, and I need exactly what it is now. <br><br>  In fact, it is difficult to say whose contribution is greater, and whether it is important if, as a result, the ProjectBuild plugin has become what it probably should have been.  And what a sin to conceal, I feel an indescribable feeling of pride that here there was no such thing in the interface and functionality of Sublime Text 2, and now there is one, and that it is written in part by me.  (here I did not know about the "bicycle", oh, woe is me, woe) <br><br>  The old version of ProjectBuild will most likely be converted into a OneHotkey plugin for grouping commands into one keyboard shortcut, not necessarily building commands, but simply launching "third-party" programs for Sublime Text 2 programs, etc.  and there the settings file, which used to be in ProjectBuild earlier and turned out to be superfluous for it, since it contained redundant information for the build mechanism, is already useful. <br><br><h4>  Promised bike </h4><br>  All the islands have long been open ... As it turned out, already initially in Sublime Text 2 you already have the option of calling the options panel of the current Build System, you just need to add a keyboard shortcut: <br><br><pre> <code class="bash hljs">{ <span class="hljs-string"><span class="hljs-string">"keys"</span></span>: [<span class="hljs-string"><span class="hljs-string">"f8"</span></span>], <span class="hljs-string"><span class="hljs-string">"command"</span></span>: <span class="hljs-string"><span class="hljs-string">"show_overlay"</span></span>, <span class="hljs-string"><span class="hljs-string">"args"</span></span>: {<span class="hljs-string"><span class="hljs-string">"overlay"</span></span>: <span class="hljs-string"><span class="hljs-string">"command_palette"</span></span>, <span class="hljs-string"><span class="hljs-string">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"Build: "</span></span>} }</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/323/c2e/2a8/323c2e2a8b882b9c2e2677b19284dd15.png" alt="https://habrastorage.org/getpro/habr/post_images/323/c2e/2a8/323c2e2a8b882b9c2e2677b19284dd15.png"><br><br>  And this panel, however sad it would be to talk about it, is more convenient, since it does not tie you to the "* .sublime-workspace" file and demonstrates the assigned keyboard shortcuts for each option, if any.  However, it does not support their sorting, and the plugin can be modified to order the options (although maybe again I don‚Äôt know what). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8f7/d2a/255/8f7d2a255758a04f201d9f8a6c3e5a93.png" alt="https://habrastorage.org/getpro/habr/post_images/8f7/d2a/255/8f7d2a255758a04f201d9f8a6c3e5a93.png"><br><br>  Probably all that can be squeezed out of all this is to go back to OneHotkey. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/149829/">https://habr.com/ru/post/149829/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149822/index.html">Screenshots of the new Skype for Windows 8 Metro style</a></li>
<li><a href="../149824/index.html">Installing and configuring memcacheq on CentOS 6.2</a></li>
<li><a href="../149825/index.html">Do you like ‚ÄúMetro‚Äù design apps?</a></li>
<li><a href="../149826/index.html">Sticking law</a></li>
<li><a href="../149828/index.html">Belarusians made a drone running Linux</a></li>
<li><a href="../149830/index.html">Review and refinement of the backlight for the e-book Hama 54308</a></li>
<li><a href="../149831/index.html">Curiosity ready to budge, laser tested tonight</a></li>
<li><a href="../149833/index.html">Experts called "endangered" professions in the world</a></li>
<li><a href="../149835/index.html">Simplify registration and work with DependencyProperty</a></li>
<li><a href="../149836/index.html">Energy-saving background location + sending data to the server from the background</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>