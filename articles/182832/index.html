<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Universal Remote Control for XBMC from TP Link MR3020</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About the home wireless router TP Link MR3020 with Openwrt already written on Habr√© . In this article I will tell you how to teach this inexpensive bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Universal Remote Control for XBMC from TP Link MR3020</h1><div class="post__text post__text-html js-mediator-article">  About the home wireless router <a href="http://www.tp-linkru.com/products/details/%3Fmodel%3DTL-MR3020" title="TP Link MR3020">TP Link MR3020</a> with Openwrt already <a href="http://habrahabr.ru/search/%3Fq%3DMR3020" title="MR3020">written on Habr√©</a> .  In this article I will tell you how to teach this inexpensive but useful box to control a TV, XBMC player and any other home electronics that understand IR signals from the control panel.  Moreover, the MR3020 itself will learn to receive signals from any remote control. <br><br>  What and how specifically to manage it is up to you, who will undertake to repeat the steps described below.  I have such boxes now manage a bunch of <u>TV-XBMC</u> in the living room and in the kitchen.  At the same time, only one remote control is used for control.  In the near future - to choose in the next underground passage a console that will appeal to all households, and to purchase such items 3. Of course, the same farm can be controlled from an Android tablet (via Wi-Fi) or from a computer (via Ethernet), but this way it seems that no one in my family inspires me. <br><a name="habracut"></a><br>  The soldered box and its accessories look like this to me: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e90/f0d/329/e90f0d32997b333fc2ca976db6fee6a9.jpg" alt="Universal Remote Control for XBMC from TP Link MR3020">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the center is a converted device.  The pins of the mini-USB connector are used to connect a pair of photodetector-LED.  These components are placed in the case from under a cheap Dialog microphone (native slide from the microphone is then attached to the velcro on the TV, near the native television IR receiver).  For power, a new connector (normal, 2-pin) is removed. <br><br>  Here's how all this strapping looks on TV: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/474/7e0/c3a/4747e0c3a5460e6573557654518c2ccf.jpg" alt="Reworked device on the TV"><br><br>  In the red circle is visible connected receiver-emitter. <br><br>  But he is near (in the circle - IR photodetector): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/278/7da/653/2787da653f504dbfc4b52b868b6193d7.jpg" alt="Reworked device on the TV"><br><br>  The back part of the device shines in the IR receiver of the TV (the circle is circled IR LED): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b11/545/6a9/b115456a928d8e59890b6a7eb9ac0c40.jpg" alt="Reworked device on a TV near the IR photodetector"><br><br>  <b>An adhesive tape router is attached to the back of the TV</b> (be sure to choose a place that does not heat up on the TV).  A little not aesthetically pleasing, but who is looking there? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8d0/888/ebc/8d0888ebca39730b0470f3e655ccf498.jpg" alt="Reworked device on the TV close to the router"><br><br>  Perhaps in your case, everything will look neater and prettier.  But the approximate sequence of steps for assembly, I think, will be the same. <br><br><h2>  So, let's begin‚Ä¶ </h2><br>  The first step is to familiarize yourself <a href="http://wiki.openwrt.org/ru/toh/tp-link/tl-mr3020" title="TP-Link TL-MR3020 router">with the page about the Openwrt router</a> .  On the page there is an <a href="http://wiki.openwrt.org/ru/toh/tp-link/tl-mr3020" title="Disassembling the device TP-Link TL-MR3020">instruction for disassembling the device</a> .  We open the box and look for somewhere to solder. <br><br>  Actually, where to solder another useful link will tell - a <a href="http://www.equinoxefr.org/post/2012/11/12/mr3020-et-i2c-avec-les-gpio/" title="Using GPIO 7 and 29 for i2c bus">page in French about using GPIO 7 and 29 for i2c bus</a> .  Actually, we will use the same GPIO for connecting the IR receiver (GPIO 7) and the LED (GPIO 29).  Our goal is to connect to exactly the same places as in the article (R15, R17, 5 V, land).  One important detail: <b>unlike the article, it is not necessary to unsolder the resistors R15 and R17</b> .  So it takes much less effort, and the risk of damaging the contact tracks is minimal. <br><br>  So, the <b>second step</b> - solder.  The choice of wires for soldering is a very important matter.  I used single core hairs from broken headphones.  The tip of this wiring is easily tinned (heating leads to destruction of the insulation at the tip), and soldering the tinned wiring is quite simple.  One piece of advice: before soldering, fix the wiring to the board with scotch tape, gently pull the wiring to the desired length, and with a toothpick, place the tip of the wiring exactly on the contact pad.  Thus, the posting will be accurately fixed in its place, and soldering is reduced to a short touch of the soldering iron with a needle to the point of contact. <br><br>  I recommend TSOP31238 as a receiver, and a TSAL5100 photodiode as a radiator (I took it in St. Petersburg, in ‚ÄúChip and Dip‚Äù together with connectors). <br><br>  Connection diagram looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/812/a54/dc4/812a54dc424e7c7040eb71f9ad6ce6e6.jpg" alt="Wiring diagram"><br><br>  Resistor R2 (5 K) is needed in order not to solder the built-in resistor R15. <br><br>  During debugging, the easiest way is to bring the necessary wiring (5 V, ground, GPIO 7, GPIO 29) to a 4-pin mother-pad, and to glue the mother herself with superglue to a suitable T1 chip (Ethernet amplifier circuits).  It looks like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eec/6e2/835/eec6e28357cbde48e415ae1df625eccb.jpg" alt="Wiring diagram"><br><br>  And with a connected photoreceiver - like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4a0/e07/75b/4a0e0775bdf842f34bc3b5b3329cadb7.jpg" alt="Wiring diagram"><br><br>  As you can see, the contact block is quite securely fixed on the board, the wiring-hairs near the contacts are fixed with scotch tape, and thus all elements of the system do not hang out and provide both reliable connection of internal elements and connection of external (IR sensor, IR receiver) as needed.  So, let's say all wiring is soldered, and the LED with the photo-receiver is connected according to the diagrams. <br><br><h2>  The last step remains - software. </h2><br>  I will not describe in detail lirc and go into the modifications for this project (those who wish can get the source code on githab).  In short, this is at the heart of the lirc 0.9.0 project, but its serial driver has been slightly reworked to manage the GPIO. <br><br>  We are flashing the device with the final Openwrt Attitude Adjustment firmware.  The firmware is quite simple and the whole process is beautifully described, for example, <a href="http://wiki.openwrt.org/ru/toh/tp-link/tl-mr3020" title="Installing OpenWrt on the router via the web interface">here</a> .  It will be necessary to configure the router in such a way as to ensure connection to the network.  The easiest way to configure is to use the built-in web interface. <br><br>  The following describes the steps to install the necessary programs from a Windows computer.  First of all, you need to install putty on our work computer. <br><br>  Download the following files to the directory with the putty installed: <a href="" title="lirc_0.9.0-1_ar71xx.ipk">lirc_0.9.0-1_ar71xx.ipk</a> and <a href="" title="lirctools_0.9.0-1_ar71xx.ipk">lirctools_0.9.0-1_ar71xx.ipk</a> <br><br>  Now copy these files to the MR3020 using the following commands (replace 192.168.1.1 with the address of your router): <br><br> <code>pscp.exe -scp lirc_0.9.0-1_ar71xx.ipk root@192.168.1.1:.</code> <br> <code>pscp.exe -scp lirctools_0.9.0-1_ar71xx.ipk root@192.168.1.1:.</code> <br> <br>  We go to the device using putty (ssh).  We type the following commands: <br><br> <code>opkg install lirc_0.9.0-1_ar71xx.ipk</code> <br> <code>opkg install lirctools_0.9.0-1_ar71xx.ipk</code> <br> <br>  Now try running lirc manually: <br><br> <code>insmod lirc_dev</code> <br> <code>mkdir -p /var/run/lirc</code> <br> <code>lircd</code> <br> <code>insmod lirc_serial gpio_in_pin=7 gpio_out_pin=29 debug=1</code> <br> <code>mode2 -d /dev/lirc0</code> <br> <br>  Try to light up any IR remote control in the IR photodetector window.  If the device reacts, then lirc is ready to work as a photodetector.  Press Ctrl-C and proceed to the next part. <br><br>  Create a file /etc/init.d/lirc as follows: <br><br> <code>#!/bin/sh /etc/rc.common</code> <br> <code># Copyright (C) 2006-2011 OpenWrt.org</code> <br> <br> <code>START=50</code> <br> <br> <code>start() {</code> <br> <code>insmod lirc_dev</code> <br> <code>mkdir -p /var/run/lirc</code> <br> <code>service_start /usr/sbin/lircd --release=_END --listen=0.0.0.0:8765 --device=/dev/lirc0</code> <br> <code>insmod lirc_serial gpio_in_pin=7 gpio_out_pin=0 debug=1</code> <br> <code>service_start /usr/sbin/irexec -d /root/.lircrc</code> <br> <code>}</code> <br> <br> <code>stop() {</code> <br> <code>killall irexec</code> <br> <code>killall lircd</code> <br> <code>rmmod lirc_serial</code> <br> <code>rmmod lirc_dev</code> <br> <code>}</code> <br> <br>  Allow lirc execution: <br><br> <code>chmod +x /etc/init.d/lirc</code> <br> <br>  Reboot the router. <br><br><h2>  Now check the transmitter performance. </h2><br>  First of all, you need to download or generate the lircd.conf file itself.  This file contains the remote control codes for a specific device (TV, DVD, etc.).  There is a chance that your console has already been digitized by someone, and the necessary file can be found on the <a href="http://lirc.sourceforge.net/remotes/" title="lirc">lirc</a> website.  Suppose that the desired distance from LG is called AKB33871420.  Upload its file to your home directory: <br><br> <code><a href="http://lirc.sourceforge.net/remotes/lg/AKB33871420"></a> wget lirc.sourceforge.net/remotes/lg/AKB33871420</code> <br> <br>  If your remote is not on the site, it's time to write it down.  Prepare to press all the buttons on your remote control and launch it in putty (do not forget to change MYREMOTE to the name of your remote control, for example AKB33871420): <br><br> <code>/etc/init.d/lirc start</code> <br> <code>Killall lircd</code> <br> <code>irrecord -d /dev/lirc0 -n MYREMOTE</code> <br> <br>  Next, carefully follow the instructions and write the file MYREMOTE with the codes of our remote control. <br><br>  So, in the home directory there was a file for our remote control.  Copy it to the lirc folder. <br><br> <code>cp MYREMOTE /etc/lircd.conf</code> <br> <code>/etc/init.d/lirc stop</code> <br> <code>/etc/init.d/lirc start</code> <br> <code>irw</code> <br> <br>  Once again we will light our remote control to the receiver.  We carefully watch how irw responds.  If everything is in order, our codes began to be recognized.  Played enough?  Press Ctrl-C to exit and move on.  Let's try to light on the TV with our device.  We direct the photodiode in the direction of the TV and give the following command: <br><br> <code>irsend send_once MYREMOTE mute</code> <br> <br>  Here MYREMOTE is the name of the remote control, and mute is the code for the mute key.  The names of both parameters can be specified in the lircd.conf file. <br><br>  If everything goes well, the TV will respond to the mute command.  In this case, congratulations to each other - everything worked.  It remains only to configure the device to automatically download the necessary components at the start (the notorious ‚Äúfinal touch‚Äù). <br><br>  In the openwrt administrative interface, we change the lirc status from <i>‚Äúdisabled‚Äù</i> to ‚Äú <i>enabled</i> ‚Äù.  Now lirc will start automatically when the router boots. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/80d/f55/630/80df55630d9b13c02879a4f1fe225d43.jpg" alt="Openwrt administration interface"><br><br>  The box is ready to go!  Now your TP-Link MR3020 can receive and transmit IR signals. <br><br>  It remains only to study irexec and create the appropriate <a href="http://lirc.org/html/configure.html" title="File /root/.lircrc">/root/.lircrc</a> file - and now your TV can already understand the non-native console. <br><br>  If you noticed, our lircd already accepts remote convections on the standard port 8765. This will simplify the configuration of the xbmc + lirc bundle on the linux media player.  If xbmc runs on Windows, we dig towards <a href="http://www.eventghost.org/" title="eventghost">eventghost</a> + xbmc <br><br><h2>  Conclusion </h2><br>  As a result, we get the ability to reprogram the behavior of the remote control for specific home needs, as well as the ability to control home electronics via the web (since the resulting box can receive commands not only via IR, but also via the usual WiFi / Enternet interface. <br><br>  In general, and sundry, a soldering iron in hand and - go ahead! </div><p>Source: <a href="https://habr.com/ru/post/182832/">https://habr.com/ru/post/182832/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182820/index.html">Search on Drupal 7 using Apache Solr Part 5 - widgets for facet filters</a></li>
<li><a href="../182822/index.html">Console comfort 2</a></li>
<li><a href="../182824/index.html">Polymorphism without virtual functions</a></li>
<li><a href="../182826/index.html">SQL Reporting Services in the Clouds</a></li>
<li><a href="../182828/index.html">"Continuous page repainting and debugging page redrawing" in Chrome Dev Tools</a></li>
<li><a href="../182834/index.html">Spintires campaign on Kickstarter was a success</a></li>
<li><a href="../182840/index.html">Transferring backups to offsite storage: WAN accelerator in Veeam Backup & Replication v7</a></li>
<li><a href="../182842/index.html">Creating OLAP cube in MS SQL Server 2012</a></li>
<li><a href="../182846/index.html">RFID implantation - results after 7 months</a></li>
<li><a href="../182848/index.html">Selection of court decisions. Software and Courts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>