<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JS1k - we write a great web application in 1024 bytes</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For the second year I have been participating in JS1k, last year there was a test script, now I decided to go thoroughly. I already wrote applications...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JS1k - we write a great web application in 1024 bytes</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/1f88473a/b0dc71c9/2cb7c077/39157a8c.jpg"><br><br>  For the second year I have been participating in JS1k, last year there was a test script, now I decided to go thoroughly.  I already wrote applications and sent.  In the article I want to share my experience: how to write an application for <a href="http://js1k.com/">JS1k</a> , how to compress, how to reduce the code by 4 times and generally how to cram something interesting in 1 KB. <br><br>  The theme of the current JS1k " <a href="http://js1k.com/2011-dysentery/">Oregon Trail</a> " is a classic game for Apple II (that you can google it).  Therefore it is recommended to write something in this spirit, but it is not necessary. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Start </h4><br>  You need to come up with a small application or demo, which in your opinion can get into 1kb (think over the details and management).  If you doubt your estimate, you can see what was pushed <a href="http://js1k.com/2010-first/">last year</a> : <a href="http://js1k.com/2010-first/demo/635">Legend Of The Bouncing Beholder</a> , <a href="http://js1k.com/2010-first/demo/750">Tiny chess</a> .  Read the <a href="http://js1k.com/2011-dysentery/">rules</a> and use the <a href="http://js1k.com/2011-dysentery/shim.html">html template</a> - then your application will work 100% in the demo environment. <br>  Start writing a script, without any optimizations, but watch out for its size.  If it has become more than 4-5Kb - you should think up another topic or in the future you will have to sweat (I had 4393 bytes). <br><a name="habracut"></a><br><h4>  Primary Package Code </h4><br>  Your code must be in closure, otherwise it will not work.  Of all the existing packers, the best one is <a href="https://github.com/mishoo/UglifyJS">UglifyJS</a> .  If you are too lazy to put UglifyJS, then use the <a href="http://marijn.haverbeke.nl/uglifyjs">web interface</a> . <br>  Pack your code, if it turned out to be within 1024 bytes - excellent - you can not continue to read, but send the application immediately.  The fact that your code immediately got into 1024 bytes suggests that your application is not interesting enough or not detailed.  If your snatched code has become within 2Kb - everything is fine you should not make such eyes ‚Äúo_O‚Äù, I assure you that it can be cut another 2 times (I had about 1600 bytes). <br><br><h4>  Manual compression or compress incompressible </h4><br>  This part is about manual compression of those moments that UglifyJS cannot.  Every byte is important now! <br>  Every time you fix something, package the UglifyJS code and see the size.  Make sure everything works. <br><br>  0. Do not do the work for the minifier - immediately give clear names to all the properties / functions!  Write the readable code, the minifier will remove the extra brackets and semicolons for you. <br>  1. If you sharpened under IE - remove all hacks - it does not participate (ch9 +, o11 +, fx3.6 +, sa5 +). <br>  2. Remove all hacks (added bind, forEach functions), right now. <br>  3. You need to get rid of the reserved words - delete the extra var, typeof.  Reduce the number of functions to a minimum (combine if possible) <a href="http://habrahabr.ru/blogs/javascript/115369/">example1</a> <a href="http://habrahabr.ru/blogs/javascript/115369/">example2</a> . <br>  4. Copy all HTML created through DOM to manual creation (strings). <br>  5. Find frequently used names of property methods (2 or more times) and string and numeric constants ‚Äî compile a dictionary and replace the point call with a bracket. <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : var canvas, div1, div2; canvas.moveTo(150, 150); canvas.moveTo(153, 151); canvas.moveTo(11, 151); canvas.moveTo(153, 120); canvas.moveTo(153, 1); div1 = '&lt;div style="width:150px;height:200px;color:red"&gt;&lt;/div&gt;'; div2 = '&lt;div style="width:150px;height:200px;color:blue"&gt;&lt;/div&gt;'; // : var canvas, div1, div2, __moveTo__ = 'moveTo'; __width_height__ = 'width:150px;height:200px;'; canvas[__moveTo__](150, 150); canvas[__moveTo__](153, 151); canvas[__moveTo__](11, 151); canvas[__moveTo__](153, 120); canvas[__moveTo__](153, 1); div1 = '&lt;div style="' + __width_height__ + 'color:red"&gt;&lt;/div&gt;'; div2 = '&lt;div style="' + __width_height__ + 'color:blue"&gt;&lt;/div&gt;';</span></span></code> </pre> <br>  Formula showing how much the code will be reduced <br>  For methods: <code>(N * (L+1)) - (N * (2 + V) + V + 4 + L)</code> <br>  L - the length of the method without a point <br>  N is the number of calls <br>  V is the length of the variable after minifix reduction (usually 1) <br>  In our case, we get 9 bytes. <br><br>  For strings (worst case): <code>N * L - (N * (4 + V) + V + 4 + L)</code> <br>  L - string length <br>  N is the number of replacements <br>  V is the length of the variable after minifix reduction (usually 1) <br>  In our case, we get 13 bytes. <br><br>  6. Move the frequently used globals to the variable <code>var __document__ = document;</code> <br>  7. See if you need to with <br>  8. Use only your closure global variables. <br>  9. <s>Replace for loops with while</s> <a href="http://habrahabr.ru/blogs/javascript/115369/">habrahabr.ru/blogs/javascript/115369/#comment_3737137</a> , get rid of counter optimizations <code>c = smth.length</code> <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// : for (i = 0;i&lt;smth.length; i++)do(i); // : i=smth.length;while(i--)do(i);</span></span></code> </pre><br>  Another minus 6 * N bytes <br>  10. If you create functions through Function Expression <code>var blabla= function (){};</code>  redo them into the Function Defination <code>function blabla(){}</code> Another minus a couple of bytes. <br>  11. Instead of <code>getElementById, getElementsByTagName</code> use <code>querySelector, querySelectorAll</code> <br>  12. Instead of Math.round (num) use ~~ num <br>  13. Remove double and single quotes from attributes in your HTML code <code>&lt;div id="aaa"&gt; - &lt;div a=aaa&gt;</code> <br>  14. Replace the lines in the id elements with the numbers <code>&lt;div id=aaa&gt; - &lt;div a=1&gt;</code> <br>  15. Reduce colors to 3-4 characters.  You should not use exact colors; you can always replace them with identical ones for perception. <code>'#ff0000' -&gt; 'red', '#fedc52' -&gt; '#fd5'</code> <br>  16. js1k provides us with 3 variables for free, use them and enter them into your closure in the order a, b, c <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.body; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementsByTagName(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = c.getContext(<span class="hljs-string"><span class="hljs-string">'2d'</span></span>); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx, __document__body__, canvas</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   }(a,b,c))</span></span></code> </pre>  The order a, b, c is important because the minifikator will remake your code into this form: <br><pre> <code class="javascript hljs">(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a,b,c</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   }(a,b,c))</span></span></code> </pre>  And you will not need to worry about matching the names of internal variables with external ones and you can remove the global closure.  Minus as many as 26 bytes! <br>  17. Use short comparison <code>e.keyCode^27||e.preventDefault()</code> instead of <code>e.keyCode==27&amp;&amp;e.preventDefault()</code> <br>  18. If your code is still more than 1024 - start deleting unimportant blocks (details), if possible. <br>  19. If you do not have a demo or a game, then you need to hint to the user how to use it without reading the description. <br>  20. If it is possible, use html attributes to bind events, or assign events through a dot, use shorter event names onkeyup instead of onkeypress (in my code in the 1st place the attribute cannot be used) <br><br><h5>  Tips from comments </h5><br>  1. Use, it has the alphabetic tags a, b, i, p, q, s, u (but do not create your own - Opera does not know how to trigger events in attributes in custom tags) <br>  2. Try other packers, maybe Uglifay <a href="http://compressorrater.thruhere.net/">compressorrater.thruhere.net</a> doesn't suit you <br><br><h4>  An example of what you can do after manual optimization </h4><br>  This year I decided to create a sticky notes application with data stored in localStorage.  Here is the code I got after optimization: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Full version of Notes ll be on my web site soon. // Creating closure to compile with UglifyJS // (!) After compile remove global closure manually (function (ctx, __document__body__, canvas) { // Dictionary for some frequently used method names and strings var __fillStyle__ = 'fillStyle', __dblclick__ = 'dblclick', __setAttribute__ = 'setAttribute', __background_and_left__ = 'position:absolute;left:', __fillRect__ = 'fillRect', __addColorStop__ = 'addColorStop', __innerHTML__ = 'innerHTML', __textarea__ = 'textarea', __ffe__ = '#ffe', // Other shorthands __document__ = document, __localStorage__ = localStorage, i,j,c,imageData, width = 200, height = 250, paperGradient = ctx.createLinearGradient(width, height/2, width, 0); // Making fixed canvas size canvas[__setAttribute__]('width', 202); canvas[__setAttribute__]('height', 275); // Creates note at e.clientX e.clientY function createPaper(e) { // Opera haven't onbeforeuload event // I must save document.body content on each keyup and each keyCode=27 keydown // Sorry... :3 // (!) replace b and save to actual after min __document__body__[__innerHTML__] += '&lt;a onkeydown=event.keyCode^27||b.removeChild(this),w() style=' + __background_and_left__ + e.clientX + 'px;top:' + e.clientY + 'px;&gt;&lt;i style=' + __background_and_left__ + '30px;top:10px;color:#a53;font-size:9px&gt;'+Date()+'&lt;/i&gt;&lt;img src=' + imageData + '&gt;&lt;' + __textarea__ + ' onkeyup=this.'+__innerHTML__+'=this.value,w() style=' + __background_and_left__ + '28px;top:33px;background:transparent;width:170px;height:200px;border:0;line-height:20px;overflow:hidden&gt;Esc&lt;/' + __textarea__ + '&gt;&lt;/a&gt;'; save(); } // Saves document.body to localStorage function save() { __localStorage__[__dblclick__] = __document__body__[__innerHTML__]; } // Making sexy paper // Gradient paperGradient[__addColorStop__](0, '#ff9'); paperGradient[__addColorStop__](1, __ffe__); ctx[__fillStyle__] = paperGradient; ctx.strokeStyle = '#aa7'; // Draw paper body ctx.strokeRect(1,1, width,height); ctx[__fillRect__](1,1, width,height); // Creating paper texture i = width; ctx[__fillStyle__] = __ffe__; while(--i) { while(--j) { Math.random()&gt;.7&amp;&amp;ctx[__fillRect__](i,j,1,1); } j = height; } // 2 Vertical red lines ctx[__fillStyle__] = '#a51'; ctx[__fillRect__](20, 1, 1, height); ctx[__fillRect__](22, 1, 1, height); // Some horizontal gray lines ctx[__fillStyle__] = '#aaa'; for (i = 50; i &lt; height; i += 20) ctx[__fillRect__](0, i, width, 1); // Grabbing image source imageData = canvas.toDataURL(); // Print "Hello message" or load localStorage content __document__body__[__innerHTML__]=__localStorage__[__dblclick__] || __dblclick__+', uses ' + __localStorage__; // Some action events __document__.addEventListener(__dblclick__, createPaper, 0); }(a,b,c)) // Vars must be in a, b, c order</span></span></code> </pre><br>  This code is compressed by Uglyfeer to 1048 bytes, then the global closure is removed and it is reduced to 1022 bytes.  When optimizing, I had to cut some details. <br><br><h4>  Links to my demo </h4><br>  <b>The original</b> is what was at the beginning (double click creates a note, Esc for a note deletes, the data is beautifully in localStorage) JS - 4393 bytes: <a href="http://azproduction.ru/labs/1kjs-ios-javascript-notes/index.original.html">azproduction.ru/labs/1kjs-ios-javascript-notes/index.original.html</a> <br>  <b>JS1k demo</b> (control is similar to the original) JS - 1022 bytes: <a href="http://js.gd/1hn">js.gd/1hn</a> (old version) <br><br>  If you compare these 2 applications, then in fact they are no different.  From the second tape removed and there is no number of creation. <br><br><h4>  What was not included in the tips, but will be useful in the future </h4><br>  -one.  Using bind can significantly reduce the length of the method call.  FF 3.6 does not know how to bind so this method does not suit us <u>yet</u> . <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//   c.lineTo(150,150);c.lineTo(150,200);c.lineTo(150,250);c.lineTo(250,350);c.lineTo(450,350); //    var a='lineTo';c[a](150,150);c[a](150,200);c[a](150,250);c[a](250,350);c[a](450,350); //    var a=z.lineTo.bind(z);a(150,150);a(150,200);a(150,250);a(250,350);a(450,350);</span></span></code> </pre><br>  If you want to participate, then you should not postpone everything for the last moment - invent demos, reduce the code.  Deadline JS1k is still very far away - April 24, 2011. Good luck! <br><br>  Criticism, suggestions, tips to reduce the code are welcome! <br><br>  <b>UPD</b> Added reader tips and a couple of his.  After reading the comments, looking at other scripts, reduced the size of the script from 1022 to 975 bytes and added one remote functionality. </div><p>Source: <a href="https://habr.com/ru/post/115369/">https://habr.com/ru/post/115369/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115361/index.html">GTD and eGroupWare</a></li>
<li><a href="../115362/index.html">CMS Diem Introductory Overview</a></li>
<li><a href="../115365/index.html">What are you missing to complete the transition from windows to linux?</a></li>
<li><a href="../115367/index.html">How often when voting for a topic, do you plus or minus it without reading to the end</a></li>
<li><a href="../115368/index.html">Journalist Programmer 1 year!</a></li>
<li><a href="../115372/index.html">Elixir</a></li>
<li><a href="../115373/index.html">Web Cluster - Real Application Experience</a></li>
<li><a href="../115374/index.html">Farata Systems: Doing your own business for 5 years. Useful experience, failures and successes</a></li>
<li><a href="../115375/index.html">Review of the low-cost 12 "laptop ASUS UL20FT</a></li>
<li><a href="../115376/index.html">SMS fraud from VKontakte</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>