<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We provide Russian texts on Mac OS X in one encoding with a Python script.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It happened to me to have a laptop on OS X, a computer on Linux and one of my friends with Windows. And here through the dropbox they exchange all the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We provide Russian texts on Mac OS X in one encoding with a Python script.</h1><div class="post__text post__text-html js-mediator-article">  It happened to me to have a laptop on OS X, a computer on Linux and one of my friends with Windows.  And here through the <a href="http://dropbox.com/">dropbox they</a> exchange all these three computers with different documents.  Including text, which stores various notes, tasks, etc.  And here's the ill luck: the texts written on MacOSx are hard to read in the notebook of Windows, and the windows in textedit on MacOSx. <br><br>  And the whole reason is that on Windows, Notepad uses Windows 1251 encoding, and on OS X, MACCYRILLIC is used by default.  Moreover, both programs work without problems with UTF-8 encoding. <br>  That's just how inconvenient it is to convert from one encoding to another, spending extra time on opening a terminal and dialing cherished iconv commands ... <br><br>  Having thought it over, I wrote a small script, which itself determines the encoding used and converts all txt-files into UTF-8. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What I use for everything: <br>  <a href="http://www.python.org/getit/">Python 2.7</a> <br>  Mac OS X 10.7.5 <br>  <a href="http://www.jetbrains.com/pycharm/">PyCharm IDE</a> <br><br>  Initially made the definition of encoding independently, without additional modules.  But on the advice of <a href="https://habrahabr.ru/users/ad3w/" class="user_link">ad3w</a> decided to rewrite using a ready-made module chardet to determine the encoding. <br>  Who cares, the previous <br><div class="spoiler">  <b class="spoiler_title">horrible code</b> <div class="spoiler_text">  The determination takes place by a simple enumeration of encodings and the choice of one in which there will be no unnecessary characters.  And you define a character set.  Of course, this method is not suitable for files with DOS-graphics, but for normal purposes of using txt it will be enough. <br><br><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python # -*- coding: utf-8 -*- __author__ = 'virtustilus' import os import sys #      automatic=False #  appdata={'enc':'','curfile':''} #    toconvert=[] #   r=[] if len(sys.argv)&gt;1: r=sys.argv[1:] automatic=True else: i=raw_input(u'INPUT PATH:') r+=[i] def print1(s): """   ,      """ if not automatic: print s #    utfrustring=u'' utfrustring+=u'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' utfrustring+=u'1234567890-=‚Äî+_}{][\\"|;:\'/?&gt;&lt;.,`~¬ß¬±!@#$%^&amp;*()‚Ññ \r\n ¬´ ¬ª \u0009 \u2013 \u201c \u201d' def checkline(s,encoding=''): """       """ hist='' b=True for i in range(0,len(s)): c=s[i] try: if not c in utfrustring: #:   UTF-8   ,    if encoding==u'UTF-8': hist+= c + u' ' + str(hex(ord(c))) + u' at ' + str(i) + u' in: ' + s + '\n' b=False break except: if encoding==u'UTF-8': hist+=u'error encoding \n' b=False break return (b,hist) def check_all_lines(lines, encoding=''): """      """ foundenc=appdata['enc'] if foundenc: return foundenc if encoding=='': foundenc=u'UNICODE' else: foundenc=encoding x=lines[:] for j in x: if encoding!='': try: j=unicode(j,encoding) except: foundenc='' break cl=checkline(j,encoding) if not cl[0]: if cl[1]!='': print1(u'Error in:'+appdata['curfile']) print1(cl[1]) foundenc='' break appdata['enc']=foundenc #  ,   ,      if len(r)==1 and os.path.isdir(r[0]): a=r[0] r[:]=[] for i in os.walk(a): p=i[2] for j in p: if j.endswith('.txt'): r+=[i[0]+'/'+j] if len(r)&gt;0: for i in r: i=unicode(i,u'UTF-8') # ,      UNICODE   txt   UNICODE: u'.txt' if i.endswith(u'.txt'): f=file(i,'r') lines=f.readlines() f.close() appdata['curfile']=i #    check_all_lines(lines,'') check_all_lines(lines,u'MACCYRILLIC') check_all_lines(lines,u'CP866') check_all_lines(lines,u'CP1251') check_all_lines(lines,u'KOI8R') check_all_lines(lines,u'CP10007') check_all_lines(lines,u'UTF-8-MAC') check_all_lines(lines,u'UTF-8') check_all_lines(lines,u'UTF-8-MAC') check_all_lines(lines,u'UTF-16') check_all_lines(lines,u'UTF-16BE') check_all_lines(lines,u'UTF-7') check_all_lines(lines,u'CP1252') check_all_lines(lines,u'KOI8-U') check_all_lines(lines,u'KOI8-RU') check_all_lines(lines,u'ISO-8859-5') if not appdata['enc']: toconvert.append((i,u'NOT FOUND ENCODING')) if appdata['enc'] and appdata['enc']!=u'UTF-8': toconvert.append((i,appdata['enc'])) else: print1(u'\nFile '+i+u' is not text file. \n\n') if toconvert: c=0 for i in toconvert: if i[1]!=u'NOT FOUND ENCODING': c+=1 if c&gt;0: print1(u'\n\n FOUND FILES TO CONVERT: ') for i in toconvert: print1(i[0] + u' in encoding ' + i[1]) bt=True if not automatic: w=raw_input(u'Convert '+str(c)+u' files? (N)') bt= (w=='Y' or w=='y' or w=='' or w=='' or w=='' or w=='') if bt: for i in toconvert: if i[1]!=u'NOT FOUND ENCODING': f=file(i[0],'r') x=f.readlines() f.close() x=[ unicode(k,i[1]) for k in x ] x=[ k.encode(u'UTF-8') for k in x] f=file(i[0],'w') f.writelines(x) f.close() print1(u'FILE '+i[0]+u' CONVERTED SUCCESSFULLY :) ') else: print1(u'Bye!') else: print1(u'NO FILES TO CONVERT') for i in toconvert: print1(i[0] + u' in encoding ' + i[1]) else: print1(u' ALL ENCODING IS OK (UTF-8)!!! :)') else: print1(u'NO ONE TXT FILE')</span></span></code> </pre> <br></div></div><br><br>  Download the module <a href="http://pypi.python.org/pypi/chardet">chardet 1.1</a> , <br>  Unpack and install: <br><pre> <code class="bash hljs">python setup.py install</code> </pre><br><br>  Create your own script for transcoding files: <br><div class="spoiler">  <b class="spoiler_title">Previous edition</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python # -*- coding: utf-8 -*- __author__ = 'virtustilus' import os import sys import chardet files=sys.argv[1:] #   ,   if len(files)==0: files=[raw_input(u'INPUT PATH:')] #       files_to_convert=[] for i in files: if os.path.exists(i): if os.path.isdir(i): for w in os.walk(i): for wfile in w[2]: if wfile.lower().endswith('.txt'): files_to_convert+=[w[0]+'/'+wfile] elif os.path.isfile(i): #    ,     files_to_convert+=[i] if len(files_to_convert)&gt;0: for i in files_to_convert: f=file(i,'r') text=''.join(f.readlines()) f.close() enc=chardet.detect(text).get('encoding') #      (dropbox),    if enc!='UTF-8': #          try: text=text.decode(enc).encode('UTF-8') f=file(i,'w') f.write(text) f.close() except: pass</span></span></code> </pre><br></div></div><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python # -*- coding: utf-8 -*- __author__ = 'virtustilus' import os import sys import chardet def may_be_1251(text_not_changed, encoding): """    Win1251,  chardet ,   MacCyrillic        chardet ,   MacCyrillic: 1. ‚Äù  Advanced- 2. ‚Äù‚Ç¨,    ( ..     ) 3. ‚Äî  mfc100u.dll      ‚Ç¨   """ simbols = u'' simbols += u'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz' simbols += u'1234567890-=‚Äî+_}{][\\"|;:\'/?&gt;&lt;.,`~¬ß¬±!@#$%^&amp;*()‚Ññ \r\n' if encoding.lower() == 'maccyrillic': err_mac = err_win = 0 try: t_win = text_not_changed.decode('cp1251') except: err_win += 1000000 try: t_mac = text_not_changed.decode('MacCyrillic') except: err_mac += 1000000 for i in t_win: if i not in simbols and i != u'\n': err_win += 1 for i in t_mac: if i not in simbols: err_mac += 1 if err_mac &gt; err_win: encoding = 'cp1251' return encoding paths = sys.argv[1:] #   ,   if len(paths) == 0: paths = [raw_input(u'INPUT PATH:')] #    ( , ..     " ") dirs = [i for i in paths if os.path.exists(i) and os.path.isdir(i)] files = [i for i in paths if os.path.exists(i) and os.path.isfile(i)] #    for i_dir in dirs: for wpath, wdirs, wfiles in os.walk(i_dir): files += [wpath + '/' + i for i in wfiles if i.lower().endswith('.txt')] for i in files: with open(i, 'r') as f: text = ''.join(f.readlines()) enc = may_be_1251(text, chardet.detect(text).get('encoding')) #      (dropbox),    if enc and enc.lower() != 'utf-8': #          try: text = text.decode(enc) #   OS X 10.8     \r text = text.replace(u'\r', '').encode('utf-8') # :    ,       .    ,    os.unlink(i) with open(i, 'w') as f: f.write(text) except: pass</span></span></code> </pre><br><br>  Next you need to make it convenient to run this script directly from the folder in OS X. <br><br>  Open Automator and create a Service. <br>  At the top, select the items to get "The service receives files and folders in Finder.app." <br><br>  Next, set the action ‚Äúget selected Finder objects‚Äù. <br>  Next, "Run the Shell script" in the settings of its "Pass Input: As Arguments" and its content: <br><br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> f <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$@</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> python /___/convert_encoding.py <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$f</span></span></span><span class="hljs-string">"</span></span> 2&gt;/dev/null <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre><br><br>  Added 2&gt; / dev / null so that the automaton does not stop the execution when the error of the chardet module is displayed. <br><br>  And the last item is ‚ÄúShow Growl Notification‚Äù (you can write in it that the conversion is done). <br><img src="https://habrastorage.org/storage2/056/b64/dae/056b64dae0a186fff08e1964791d4bd6.png"><br><br>  We save it with the name in Latin letters (for some reason, the menu item did not appear in the menu until I renamed it) and check. <br><br>  A new menu item will appear in Finder in the menu of files and folders in the Services submenu. <br><br>  PS This is the 5th edition of the script after the comments and experience of its use. <br>  PS Found a problem: if Python sees the encoding of the file to which it writes, then it will work in it.  We do not need this, so we delete the file before saving. </div><p>Source: <a href="https://habr.com/ru/post/152737/">https://habr.com/ru/post/152737/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152725/index.html">Paul Graham. Why "hairdresser" can not be a startup. Part 1</a></li>
<li><a href="../152729/index.html">ICS released for Sony Xperia Go, U and Sola</a></li>
<li><a href="../152731/index.html">Writing image map editor (html image map) on javascript / html5 / inline SVG</a></li>
<li><a href="../152733/index.html">Silicon</a></li>
<li><a href="../152735/index.html">Providers of Dagestan have closed access to YouTube</a></li>
<li><a href="../152741/index.html">Brainfuck computer</a></li>
<li><a href="../152747/index.html">Create recursive shortcuts in Windows</a></li>
<li><a href="../152753/index.html">The digest of interesting news and materials from the world of ayti for the last week ‚Ññ24 (September 22‚Äî28, 2012)</a></li>
<li><a href="../152759/index.html">California adopted a law to create a free digital library of college textbooks</a></li>
<li><a href="../152763/index.html">Why Samsung TV "loses" minidlna server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>