<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>7-inch TFT LCD backlight brightness control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Currently, I am working on a project on Arduino using a TFT display. Recently, I wanted to add to it a seemingly simple function - the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>7-inch TFT LCD backlight brightness control</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  Currently, I am working on a project on Arduino using a TFT display.  Recently, I wanted to add to it a seemingly simple function - the brightness adjustment function.  Found in the documentation for the library to work with the TFT display (UTFT Library) the desired method: <code>setBrightness(br);</code> <br><br>  I wrote all the code, did everything right.  I decided to check, but to my surprise, nothing happened.  Began to understand.  Two days later, I noticed a small note to the method: <code>"This function is currently only supported on CPLD-based displays."</code>  That is, this library does not support my display.  But I found out that the display itself supports brightness control.  I searched the Internet for a long time for ways to set it up, but I did not find it, so I decided to achieve my goal myself, no matter what, and I did it.  And so I decided to share with those who might find it useful. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/bad/57a/fd5/bad57afd548d488dbb6e4e3e762e32db.jpg"></div><br><a name="habracut"></a><br><h4>  What do we need? </h4><br><ul><li>  As a basis, I used Frearduino ADK v.2.2 based on the ATmega2560 processor </li><li>  TFT LCD Mega Shield v.2.2 </li><li>  The display itself - 7 "TFT LCD SSD1963 ( <a href="http://www.ebay.com/itm/7-inch-TFT-LCD-module-800x480-SSD1963-w-touchpad-PWM-arduino-AVR-STM32-ARM-/121017488870">Here you will find its description, as well as the necessary documentation</a> ) </li><li>  UTFT Library - a universal library for working with TFT displays (You can find the library itself, as well as documentation, <a href="http://henningkarlsen.com/electronics/library.php%3Fid%3D52">here</a> ) </li><li>  Soldering iron </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Understand the iron </h4><br>  When you open the display, you can see that the mp3032 converter has three inputs: LED-A, PWM, 5V.  Initially, PWM is inactive.  This entry is not used at all.  The backlight is controlled by LED-A. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/33b/7b6/9a3/33b7b69a384d4d20ad7e3465ae36aaa7.png"></div><br>  If you look at the back of the display, you can find an area that is <code>"Backlight control"</code> .  Here we will find these same inputs.  To control the backlight by the PWM method, it is necessary to make it all the other way around: LED-A is inactive, PWM is active.  To do this, you have to rewire the jumper.  Here is a photo of what should happen: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c0f/81b/b44/c0f81bb449d14e32b4d6f52ec328cae8.jpg"></div><br><br><h4>  Software part </h4><br>  Since our library cannot provide what we need, we ourselves will write the necessary function.  To do this, open the documentation for the controller that controls the display (SSD1963).  SSD1963 is controlled using special commands that are transmitted from the Arduino via special outputs, which are described in the documentation: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/613/a2f/9a6/613a2f9a66344638a17d5db46b00ac96.png"></div><br><br>  The control is as follows: Arduino outputs via RS (D / C in the table) 0, if we are going to send a command, 1 - if the data.  After sending the command, the RS switches to 1, and then the necessary parameters are transmitted.  All commands and parameters are transmitted through the outputs D0-D7.  If you have an ATmega2560, then all these eight outputs are combined into port C. <br><br>  So, for starters, let's write the data transfer function on the bus.  For ease of use, I will write directly to UTFT.h: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lcd_Writ_Bus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bla)</span></span></span><span class="hljs-function"> </span></span>{ digitalWrite(WR,LOW); <span class="hljs-comment"><span class="hljs-comment">// SSD1963   digitalWrite(CS, LOW); PORTC = bla; //        digitalWrite(CS,HIGH); digitalWrite(WR,HIGH); }</span></span></code> </pre><br><br>  You should also pay attention to the names of the methods, since functions with the same names can already be found in the library. <br>  Add two functions for outputting commands and data: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Lcd_Write_Com</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> data)</span></span></span><span class="hljs-function"> </span></span>{ digitalWrite(RS,LOW); <span class="hljs-comment"><span class="hljs-comment">// RS    ,   0 Lcd_Writ_Bus(data); } void Lcd_Write_Data(uint8_t data) { digitalWrite(RS,HIGH); // RS    ,   1 Lcd_Writ_Bus(data); }</span></span></code> </pre><br><br>  Now the setting itself backlight.  To find out how to do all this, open the documentation and look for a command to configure PWM. <br><h5>  Note: </h5>  PWM can be controlled, with the help of DBC - a dynamic brightness control system, but I, for simplicity, did not use it.  You, if you want, can find the necessary information in the same documentation. <br><br>  So, here's what we need: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/d15/632/dc3/d15632dc33c44f31ac2a235a2b392b7f.png"></div><br><br>  That is, we must first send the ‚Äú0xBE‚Äù command, and then, as the 3 parameters, pass the signal frequency, the duty cycle duration, and the third parameter, which determines whether the DBC is on or not (0x01 - off, 0x09 - on) . <br><br>  To adjust the brightness itself, you only need to change the frequency of the operating cycle.  Since we transmit data in the form of one byte, the values ‚Äã‚Äãof the cycle can be from 0 to 255. I decided to define 9 levels of brightness (from 0 to 8).  Therefore, all 256 values ‚Äã‚Äãneed to be broken down into 9 steps.  But you should also pay attention to the fact that if the steps are equal, then the brightness will not change as smoothly as we would like.  That is, for example, at the 4th stage, the brightness will be almost maximum, and from the 4th to the 8th stage will change almost imperceptibly.  Given this, I decided to use a geometric progression with a denominator of 2. That is, the brightness will be calculated using the following formula: <code>(2 ^ lvl) - 1</code> , where lvl is the brightness level from 0 to 8. Note that since the values ‚Äã‚Äãstart from zero, then you need to subtract the unit.  Of course, you can choose the steps and their values ‚Äã‚Äãyourself, but I gave this, quite simple example.  Now the code itself: <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBright</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(byte lvl)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-function"><span class="hljs-function">byte </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">brightness</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (byte i(<span class="hljs-number"><span class="hljs-number">1</span></span>); i &lt;= lvl; i++) <span class="hljs-comment"><span class="hljs-comment">//   brightness *= 2; Lcd_Write_Com(0xBE); //  Lcd_Write_Data(0x01); //  760 Lcd_Write_Data(brightness-1); //    Lcd_Write_Data(0x01); // DBC }</span></span></code> </pre><br><br>  Now you can use <code>UTFT.setBright(byte lvl);</code> <br><br><br></div><p>Source: <a href="https://habr.com/ru/post/234601/">https://habr.com/ru/post/234601/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234589/index.html">Budget planning: hot September</a></li>
<li><a href="../234591/index.html">Asterisk: PVS-Studio is interested in telephony</a></li>
<li><a href="../234595/index.html">Instruments. How to legally form a partnership break</a></li>
<li><a href="../234597/index.html">28 mistakes of a startup in the eyes of an investor. Business angel experience</a></li>
<li><a href="../234599/index.html">Firefox OS smartphone went on sale for $ 33 (in India)</a></li>
<li><a href="../234603/index.html">The story of the creation of iOS games about fast reaction and steel nerves</a></li>
<li><a href="../234607/index.html">How to enter the US magistracy?</a></li>
<li><a href="../234609/index.html">Mini airship control system</a></li>
<li><a href="../234611/index.html">Setting up a time tracking system: try it out for yourself</a></li>
<li><a href="../234613/index.html">Flask Mega-Tutorial, Part 10: Full-Text Search</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>