<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Translation: 30 days Windows Mobile - first day (–° # vs WinAPI)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Many Windows Mobile developers writing in .NET have heard or read Chris Kraft's remarkable cycle of posts ‚Äú30 Days of .NET [Windows Mob...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Translation: 30 days Windows Mobile - first day (–° # vs WinAPI)</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction </h1><br>  Many Windows Mobile developers writing in .NET have heard or read Chris Kraft's remarkable cycle of posts ‚Äú30 Days of .NET [Windows Mobile Applications]‚Äù.  I decided to start a cycle of translations of these posts, but to make it more interesting, the articles will provide not only the translation of the original post from Chris's blog with examples in C #, but also the translation of articles from Christopher Fairbairn - an enthusiast who decided to port all of Chris's examples to C ++ !  Currently, 8 out of 30 applications have been ported, but this is also very good. <br><br>  When translating, I will try to minimize the irrelevant lyrical digressions, because the ‚Äúwater‚Äù in the translation becomes even more fluid and it becomes impossible to read :) <br><br>  So let's get started - the first application, the <strong>countdown to midnight</strong> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h1>  Chris Kraft.  C # </h1><br>  The original is <a href="http://www.cjcraft.com/blog/2008/06/02/30DaysOfNETWindowsMobileApplicationsDay01MinutesToMidnightCountdown.aspx">here</a> . <br><br><br>  One of the goals that I set for myself in this series of articles is to create an application on the day of publication.  It does not leave me a choice, I'm not sure that I will have time, but it only adds fun.  I have a life, but between family, friends, career, hobbies and dreams, there is not so much time as I sometimes would like.  So developing one application a day, I‚Äôll find out at the same time how much time I usually have free time. <br><br><h2>  How many minutes to midnight </h2><br><br><img src="http://www.cjcraft.com/blog/content/binary/WindowsLiveWriter/30D.NETWindowsMobileApplicationsDay01Min_F6A2/image_thumb.png" hspace="5" align="left"><br><br>  A simple application, but I would venture to call it useful.  At first, I thought that I would display the data in a format, for example, ‚Äú2 hours 45 minutes 38 seconds‚Äù, but I decided that it was too simple, so I would use progress bars because they would add, say, a little "Weight". <br><br><br>  But even after using progress bars, the app looked too sterile.  Using one of the palettes from the site <a href="http://www.colourlovers.com/">http://www.colourlovers.com/</a> , I painted the application a little. <br><br>  Very quickly, I realized that there is a small problem.  From my point of view, perhaps subjective, the progress bar was wrong.  <strong>progressBarHours.Value = timeSpan.Hours;</strong>  should have been <br>  <strong>progressBarHours.Value = 24 - timeSpan.Hours;</strong>  .  As soon as I made this change, everything immediately fell into place. <br><br>  Upper progress bar did not please me.  It should have shown the total time until the end of the day, but there was not enough room for one more headline.  There is a saying "the best is the enemy of the good."  I understand it so that <strong>if you always try to strive to achieve the ideal, nothing good will ever come out of it</strong> .  As a result, I broke the form into logical sections by setting different colors of the background at the bottom panels. <br><br><br>  All that remained to do was the <strong>total number of minutes remaining</strong> .  Depending on the calculations used, sometimes it was something like " <strong>X.666666666 of 1440 total minutes left</strong> ".  Fortunately, there is a simple solution - custom number formatting: <strong>timeSpan.TotalMinutes.ToString ("#. 0")</strong> . <br><br>  <i>Note</i>  <i>translator:</i> In the original, there is no code insertion, however I put it (everything else is done with the mouse in the studio): <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">void</font> timer_Tick( <font color="#0000ff">object</font> sender, <font color="#2B91AF">EventArgs</font> e) <br> { <br> <font color="#2B91AF">TimeSpan</font> timeSpan = <font color="#2B91AF">DateTime</font> .Now.Date.AddDays(1) - <font color="#2B91AF">DateTime</font> .Now; <br> labelHours.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0} of 24 hours left"</font> , timeSpan.Hours); <br> labelMinutes.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0} of 60 minutes left"</font> , timeSpan.Minutes); <br> labelSeconds.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0} of 60 seconds left"</font> , timeSpan.Seconds); <br> <br> labelTotalMinutes.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0} of 1440 total minutes left"</font> , <br> timeSpan.TotalMinutes.ToString( <font color="#A31515">"#.0"</font> )); <br> labelTotalSeconds.Text = <font color="#0000ff">string</font> .Format( <font color="#A31515">"{0} of 86400 total seconds left"</font> , <br> timeSpan.TotalSeconds); <br> <br> progressBarTotal.Value = 86400 - ( <font color="#0000ff">int</font> ) timeSpan.TotalSeconds; <br> <br> progressBarHours.Value = 24 - timeSpan.Hours; <br> progressBarMinutes.Value = 60 - timeSpan.Minutes; <br> progressBarSeconds.Value = 60 - timeSpan.Seconds; <br> <br> progressBarTotalMinutes.Value = 1440 - ( <font color="#0000ff">int</font> ) timeSpan.TotalMinutes; <br> progressBarTotalSeconds.Value = 86400 - ( <font color="#0000ff">int</font> ) timeSpan.TotalSeconds; <br> } <br> <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  C # source code: <a href="http%253A%252F%252Fcid-0779b8ef58de4561.skydrive.live.com%252Fself.aspx%252FPublic%252FMinutes2Midnight.zip">minutes2Midnight.zip</a> . <br><br><br><br><h1>  Christopher Fairbairn.  C ++ </h1>  The original is <a href="http://www.christec.co.nz/blog/archives/350">here</a> . <br><br><h2>  Interface development </h2><br>  The easiest way to create a small C ++ application is to use the dialog-based interface. <br><br><br>  As with <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.aspx">System.Windows.Forms</a> based applications, in C ++ there is a clear separation between design and code.  The design of one or more dialogs is in the resource file (* .rc), while the code is in * .cpp files.  Each dialog resource gets its ID, for example IDD_MYDIALOG, which allows you to access it from code. <br><br>  To display the dialog, we will use the <a href="http://msdn.microsoft.com/en-us/library/ms960195.aspx">DialogBox</a> API: <br><br><pre> DialogBox (hInstance, (LPCSTR) IDD_MYDIALOG, NULL, MyDialogProc);
</pre><br><br>  This call will display a dialog with the IDD_MYDIALOG identifier and wait for it to be closed.  The last parameter is the name of the dialog procedure.  The procedure you write will process the messages sent to the dialog box.  These messages are similar to events and virtual methods of classes such as <br>  <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.control_events.aspx">System.Windows.Forms.Control</a> . <br><br><br>  The basic structure of the dialog procedure will be as follows: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">INT_PTR CALLBACK MyDialogProc(HWND hDlg, <br> UINT message, WPARAM wParam, LPARAM lParam) <br> { <br> <font color="#0000ff">switch</font> (message) <br> { <br> <font color="#0000ff">case</font> WM_INITDIALOG: <br> <font color="#008000">// this is similar to the Load event so we</font> <br> <font color="#008000">// can perform dialog initialisation code here</font> <br> <font color="#0000ff">break</font> ; <br> <br> <font color="#0000ff">case</font> WM_CLOSE: <br> <font color="#008000">// this is similar to the Close event so we</font> <br> <font color="#008000">// can perform dialog shutdown logic here</font> <br> <font color="#0000ff">break</font> ; <br> <br> ... <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><br><h2>  Headlines </h2><br>  The equivalent for <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.label.aspx">System.Windows.Forms.Label</a> is <a href="http://msdn.microsoft.com/en-us/library/ms927583.aspx">static</a> control. <br><br>  In order to interact with the control, placed in the dialogue, it is necessary to obtain its descriptor.  Within a Win32 application, controls are a special form of a window, and controls are made of them by the fact that they have a parent window.  To get the descriptor, we will use the <i>GetDlgItem</i> method, passing as parameters the descriptor of our dialog and the identifier of the control that we assigned in the resource editor. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Get the window handle for the control</font> <br> <font color="#008000">// with an ID of IDC_MESSAGE</font> <br> HWND hwndCtrl = GetDlgItem(hWnd, IDC_MESSAGE);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  After receiving the handle, we can send messages.  This is equivalent to assigning properties to .net controls.  In some cases, we even have helper functions that slightly simplify manipulations.  For example, we can change the header text using the <a href="http://msdn.microsoft.com/en-us/library/ms942609.aspx">SetWindowText</a> function: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Change the label to display "Hello World"</font> <br> SetWindowText(hwndCtrl, L <font color="#A31515">"Hello World"</font> );</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h2>  Progress Bars </h2><br>  Interaction with progress bars is almost no different from interaction with static controls, with the only difference being that progress bars understand a different set of messages.  For example, to set the minimum and maximum, we can send a <a href="http://msdn.microsoft.com/en-us/library/aa922604.aspx">PBM_SETRANGE</a> or <a href="http://msdn.microsoft.com/en-us/library/aa929368.aspx">PBM_SETRANGE32 message</a> as follows: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Set the progress bar referenced by 'hWndCtrl'</font> <br> <font color="#008000">// to have the range 25 to 75</font> <br> SendMessage(hWndCtrl, PBM_SETRANGE, 0, MAKELPARAM(25, 75));</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Is it possible, looking in the documentation on PBM_SETRANGE and PBM_SETRANGE32, to understand why there are two ways to set a minimum and a maximum?  Here is one of the clearest examples of what the Compact Framework abstracts from. <br><br>  To set the current value of the progress, use the <a href="http://msdn.microsoft.com/en-us/library/aa930476.aspx">PBM_SETPOS</a> message: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Set the progress bar referenced by 'hWndCtrl'</font> <br> <font color="#008000">// to the value 45</font> <br> SendMessage(hwndCtrl, PBM_SETPOS, 45, 0);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h2>  Timers </h2><br>  Instead of just dragging the timer onto the form, the C ++ programmer should create a timer on his own: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Create a timer with ID 1234 and</font> <br> <font color="#008000">// an interval of 1000 milliseconds (1 second)</font> <br> SetTimer(hWnd, 1234, 1000, NULL);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  When the timer is no longer needed, use the corresponding KillTimer function: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Stop the timer with ID 1234</font> <br> KillTimer(hWnd, 1234);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  As you can see from the example, timers are associated with a window, so every time the timer is triggered, the window receives a <a href="http://msdn.microsoft.com/en-us/library/aa932703.aspx">WM_TIMER</a> message, which is essentially equivalent to the <a href="http://msdn.microsoft.com/en-us/library/system.windows.forms.timer.tick.aspx">Timer.Tick</a> event in .NET. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">case</font> WM_TIMER: <br> <font color="#0000ff">if</font> (wParam == 1234) <br> { <br> <font color="#008000">// timer 1234's interval has occurred so</font> <br> <font color="#008000">// we can do something here...</font> <br> } <br> <font color="#0000ff">break</font> ;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Each timer is assigned its own identifier so that it can work with more than one timer.  For these purposes, the WM_TIMER message is passed as a parameter to the timer identifier. <br><br><h2>  Coloring the background </h2><br>  For a logical separation of the interface, Chris colored the parts of the form in different colors.  The easiest way to achieve the same is to process the <a href="http://msdn.microsoft.com/en-us/library/aa922583.aspx">WM_PAINT</a> message, which is sent by the system when it is time to draw the content.  Draw 3 rectangles using the <a href="http://msdn.microsoft.com/en-us/library/aa932720.aspx">FillRect</a> method: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Define a rectangle at x=40, y=10 with size 40x10</font> <br> RECT rcBounds; <br> rcBounds.top = 10; <br> rcBounds.bottom = 20; <br> rcBounds.left = 40; <br> rcBounds.right = 80; <br> <br> <font color="#008000">// Create a red brush and fill the</font> <br> <font color="#008000">// area of the rectangle</font> <br> HBRUSH hbrRed = CreateSolidBrush(RGB(255, 0, 0)); <br> FillRect(hdc, &amp;rcBounds, hbrRed); <br> DeleteObject(hbrRed);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Graphical methods in general are called GDI (Graphical Drawing Interface) and you will notice that they have a lot in common with the <a href="http://msdn.microsoft.com/en-us/library/system.drawing.aspx">System.Drawing</a> namespace.  Compare <a href="http://msdn.microsoft.com/en-us/library/aa931351.aspx">CreateSolidBrush</a> and <a href="http://msdn.microsoft.com/en-us/library/system.drawing.solidbrush.aspx">System.Drawing.SolidBrush</a> . <br><br><h2>  Time calculation </h2><br>  Due to the lack of an equivalent <a href="http://msdn.microsoft.com/en-us/library/system.datetime.aspx">System.DateTime</a> structure, time will have to be calculated in more complex ways. <br><br>  To get the current time, we will use the <a href="http://msdn.microsoft.com/en-us/library/aa915317.aspx">GetLocalTime</a> function, which will return the <a href="http://msdn.microsoft.com/en-us/library/aa908737.aspx">SYSTEMTIME</a> structure.  This structure is not able to calculate anything on its own, so <a href="http://msdn.microsoft.com/en-us/library/aa908968.aspx">let's</a> use the <a href="http://msdn.microsoft.com/en-us/library/aa908968.aspx">SystemTimeToFileTime</a> function, which converts data into a <a href="http://msdn.microsoft.com/en-us/library/aa915351.aspx">FILETIME</a> structure, which is a 64-bit integer storing the number of 100-nanosecond intervals since January 1, 1601. <br><br>  With this number, we can perform simple mathematical operations.  For example, we can get how much time has passed since the beginning of the day, or how much is left to its end: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">__int64 amount_of_today_past = current_time % ONE_DAY; <br> __int64 amount_of_today_left = ONE_DAY - amount_of_today_past;</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  From the obtained value it is already quite easy to get hours, minutes and seconds.  For example, the following calculation returns the same as <a href="http://msdn.microsoft.com/en-us/library/system.timespan.minutes.aspx">TimeSpan.Minutes</a> : <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">__int64 minutes = (amount_of_today_left / ONE_MINUTE) % 60</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  C ++ example can be downloaded here: <a href="">minutes2midnight.zip</a> . </div><p>Source: <a href="https://habr.com/ru/post/61248/">https://habr.com/ru/post/61248/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../61239/index.html">iCamp Russia - images of the future</a></li>
<li><a href="../61241/index.html">As we came up with the name, and then painted the logo for Ikonzy</a></li>
<li><a href="../61242/index.html">Euroset does not return money for defective phone. Series 2nd and final in which the law triumphs over evil</a></li>
<li><a href="../61244/index.html">N97 sales will begin in June</a></li>
<li><a href="../61247/index.html">Star Wars: The Old Republic Cinematic Trailer</a></li>
<li><a href="../61253/index.html">Within the framework of evolution</a></li>
<li><a href="../61255/index.html">Localization. Start</a></li>
<li><a href="../61259/index.html">20 logos with the use of Helvetica, which you meet at every step</a></li>
<li><a href="../61261/index.html">My firefox went crazy</a></li>
<li><a href="../61265/index.html">How to tie your design to the store Simpla</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>