<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Just a couple of words about switching to Jabber or ICQ bot</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I myself, as an adherent of free technologies, have long since gotten myself a jabber account, but it has been empty for a long time, because No one f...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Just a couple of words about switching to Jabber or ICQ bot</h1><div class="post__text post__text-html js-mediator-article">  I myself, as an adherent of free technologies, have long since gotten myself a jabber account, but it has been empty for a long time, because  No one from the asechno contactist succumbed to the entreaties to switch to jabber. Here, in the light of recent problems with AOL and a few habratopics about XMPP clients and ways of poaching people to them, I got the idea to put it on my UIN bot.  Let him know how to talk a little and send all the talkers in the right direction. Looking for the subject of conversation on the Internet, nothing worthwhile was found.  But I came across a <a href="http://wip.asminog.com/news/wip12brelease.html">page</a> with a set of classes in PHP that implement the minimal functionality of the ICQ protocol. <br>  Without thinking twice, I downloaded and tried in practice.  Works!!! <br>  and after 30 minutes wrote the following: <a name="habracut"></a><br><br>  <b>icqbot.php</b> <br><blockquote><code><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> <font color="black">Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#cc6633"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php &lt;?php <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); // zendloader <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); //  <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); //   <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); // <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); // <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { //   <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { //   <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); //    <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); //  <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { //  log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } else { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { // .  . <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { //  log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#0000ff"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } else { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { // .    . <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } //  flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } // log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li></li><li></li><li></li><li></li><li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); //----------------------------------------------------------------------------------------// <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li> <code><font color="black"><font color="#696969"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> // // <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/961/s"></a> <a href="http://s-c.me/961/h"></a> <a href="http://www.php.net/manual/en/function.connect.php"></a> <a href="http://www.php.net/manual/en/function.str-replace.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.trim.php"></a> <a href="http://www.php.net/manual/en/function.select.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.sleep.php"></a> <a href="http://www.php.net/manual/en/function.date.php"></a> <a href="http://www.php.net/manual/en/function.time.php"></a> Copy Source | Copy HTML #!/usr/bin/php <font color="#cc6633">&lt;?php</font> <font color="#0000ff">include</font> ( <font color="#008000">'icq.php'</font> ); <font color="#696969">// zendloader</font> <font color="#0000ff">require</font> <font color="#008000">'Zend/Loader.php'</font> ; Zend_Loader::registerAutoload(); <font color="#696969">// </font> <font color="#cc6633">$config</font> = <font color="#0000ff">new</font> Zend_Config_Xml( <font color="#008000">'config.xml'</font> ,NULL, <font color="#0000ff">true</font> ); <font color="#696969">//  </font> <font color="#cc6633">$db</font> = Zend_Db::factory( <font color="#cc6633">$config</font> -&gt;dbadapter, <font color="#cc6633">$config</font> -&gt;db-&gt;toarray()); <font color="#cc6633">$db</font> -&gt;query( <font color="#008000">'SET CHARACTER SET "'</font> . <font color="#cc6633">$config</font> -&gt;dbcharset. <font color="#008000">'"'</font> ); <font color="#696969">//</font> <font color="#cc6633">$icq</font> = <font color="#0000ff">new</font> WebIcqLite(); log_write( <font color="#008000">"ICQ Bot started"</font> ); <font color="#696969">//</font> <font color="#0000ff">if</font> (! <font color="#cc6633">$icq</font> -&gt;connect( <font color="#cc6633">$config</font> -&gt;icq-&gt;login, <font color="#cc6633">$config</font> -&gt;icq-&gt;password)) { log_write( <font color="#cc6633">$icq</font> -&gt;error); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">"Connected ok"</font> ); <font color="#0000ff">while</font> ( <font color="#cc6633">$icq</font> -&gt;is_connected()) { <font color="#696969">//  </font> <font color="#cc6633">$msg</font> = <font color="#cc6633">$icq</font> -&gt;read_message(); <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> ) { <font color="#696969">//  </font> <font color="#0000ff">if</font> ( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]== <font color="#008000">"icqbotoff"</font> ) { <font color="#cc6633">$icq</font> -&gt;disconnect(); log_write( <font color="#008000">"Exit by admin's command."</font> ); <font color="#0000ff">exit</font> (); } log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"' from "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); <font color="#696969">//   </font> <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ] = str_replace( <font color="#0000ff">array</font> ( <font color="#008000">'('</font> , <font color="#008000">')'</font> , <font color="#008000">'/'</font> , <font color="#008000">':'</font> , <font color="#008000">'.'</font> , <font color="#008000">','</font> , <font color="#008000">'?'</font> , <font color="#008000">'!'</font> , <font color="#008000">'@'</font> , <font color="#008000">'#'</font> , <font color="#008000">'$'</font> , <font color="#008000">'%'</font> , <font color="#008000">'^'</font> , <font color="#008000">'&amp;'</font> , <font color="#008000">'*'</font> , <font color="#008000">'-'</font> , <font color="#008000">'_'</font> , <font color="#008000">'='</font> , <font color="#008000">'+'</font> , <font color="#008000">'~'</font> , <font color="#008000">'`'</font> , <font color="#008000">';'</font> , <font color="#008000">'|'</font> , <font color="#008000">'\\','</font> \ <font color="#008000">''</font> , <font color="#008000">'"'</font> ), <font color="#008000">''</font> , <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]); <font color="#696969">// </font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> ,trim( <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]))-&gt;where( <font color="#008000">'LENGTH(a)&gt;0'</font> )-&gt;order( <font color="#008000">'RAND()'</font> )-&gt;query()-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">" Message '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .  .</font> <font color="#cc6633">$db</font> -&gt;insert( <font color="#008000">'messages'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'q'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ], <font color="#008000">'a'</font> =&gt; <font color="#008000">''</font> , <font color="#008000">'from'</font> =&gt; <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ])); <font color="#cc6633">$query</font> = <font color="#008000">"SELECT *, MATCH q AGAINST ('"</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'message'</font> ]. <font color="#008000">"') as relev FROM messages WHERE LENGTH(a)&gt;0 ORDER BY relev DESC LIMIT 1"</font> ; <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;query( <font color="#cc6633">$query</font> )-&gt;fetch(); <font color="#0000ff">if</font> ( <font color="#cc6633">$ans</font> [ <font color="#008000">'relev'</font> ]&gt; <font color="#008000">0</font> ) { <font color="#696969">// </font> log_write( <font color="#008000">"Message (fulltext search) '"</font> . <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]. <font color="#008000">"' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } <font color="#0000ff">else</font> { <font color="#696969">// .    .</font> <font color="#cc6633">$ans</font> = <font color="#cc6633">$db</font> -&gt;select()-&gt;from( <font color="#008000">'messages'</font> )-&gt;where( <font color="#008000">'q LIKE ?'</font> , <font color="#008000">'default'</font> )-&gt;query()-&gt;fetch(); log_write( <font color="#008000">"Message 'DEFAULT' sent to "</font> . <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ]); } } <font color="#cc6633">$icq</font> -&gt;send_message( <font color="#cc6633">$msg</font> [ <font color="#008000">'from'</font> ], <font color="#cc6633">$ans</font> [ <font color="#008000">'a'</font> ]); <font color="#696969">//   </font> } <font color="#696969">// </font> flush(); sleep( <font color="#008000">1</font> ); } <font color="#696969">//</font> log_write( <font color="#008000">"Disconnected by unknown reason."</font> ); <font color="#cc6633">$icq</font> -&gt;disconnect(); <font color="#696969">//----------------------------------------------------------------------------------------//</font> <font color="#696969">// //</font> <font color="#0000ff">function</font> log_write( <font color="#cc6633">$str</font> ) { <font color="#0000ff">echo</font> date( <font color="#008000">'Ymd His'</font> ,time()). <font color="#008000">" "</font> . <font color="#cc6633">$str</font> . <font color="#008000">"\n"</font> ; }</font></code> </li> </ol></blockquote><br><br>  <b>config.xml</b> <br><blockquote> <code><a href="http://s-c.me/963/s"></a> <a href="http://s-c.me/963/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">&lt;?</font>  <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "UTF-8"</font> ?  <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">configdata</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">debug</font> <font color="#0000ff">&gt;</font> 0 <font color="#0000ff">&lt;/</font> <font color="#800000">debug</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">db</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">host</font> <font color="#0000ff">&gt;</font> localhost <font color="#0000ff">&lt;/</font> <font color="#800000">host</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">username</font> <font color="#0000ff">&gt;</font> root <font color="#0000ff">&lt;/</font> <font color="#800000">username</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">password</font> <font color="#0000ff">&gt;</font> dbpass <font color="#0000ff">&lt;/</font> <font color="#800000">password</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">dbname</font> <font color="#0000ff">&gt;</font> icqbot <font color="#0000ff">&lt;/</font> <font color="#800000">dbname</font> <font color="#0000ff">&gt; &lt;/</font> <font color="#800000">db</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">dbcharset</font> <font color="#0000ff">&gt;</font> CP1251 <font color="#0000ff">&lt;/</font> <font color="#800000">dbcharset</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">dbadapter</font> <font color="#0000ff">&gt;</font> Pdo_Mysql <font color="#0000ff">&lt;/</font> <font color="#800000">dbadapter</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">icq</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">login</font> <font color="#0000ff">&gt;</font> UIN <font color="#0000ff">&lt;/</font> <font color="#800000">login</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">password</font> <font color="#0000ff">&gt;</font> PASSWORD <font color="#0000ff">&lt;/</font> <font color="#800000">password</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">icq</font> <font color="#0000ff">&gt;</font> </li></ol></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>dump.sql</b> <br><blockquote> <code><a href="http://s-c.me/964/s"></a> <a href="http://s-c.me/964/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">CREATE TABLE IF NOT EXISTS</font> `messages` ( </li><li>  `id` <font color="#0000ff">int</font> (11) <font color="#0000ff">NOT NULL</font> auto_increment, </li><li>  `q` text <font color="#0000ff">NOT NULL</font> , </li><li>  `a` text <font color="#0000ff">NOT NULL</font> , </li><li>  ` <font color="#0000ff">from` varchar</font> (16) <font color="#0000ff">NOT NULL</font> , </li><li>  <font color="#0000ff">PRIMARY KEY</font> (`id`), </li><li>  FULLTEXT <font color="#0000ff">KEY</font> `q` (` q`) </li><li>  ) ENGINE = MyISAM <font color="#0000ff">DEFAULT</font> CHARSET = cp1251 AUTO_INCREMENT = 43; </li><li></li><li>  <font color="#0000ff">INSERT INTO</font> `messages` (` id`, `q`,` a`, `from`) <font color="#0000ff">VALUES</font> </li><li>  (1, <font color="#A31515">'default'</font> , <font color="#A31515">'At the moment you are talking with the robot.</font> If you want to talk with my host, you need to register on one of the Jabber servers, because in ICQ it will no longer appear. To find out more about Jabber- e, enter 1. To find out the host‚Äôs Jabber address, write how much 2 will be. To find out the host‚Äôs postal address, enter the numbers from 1 to 7 without spaces. ', <font color="#A31515">' '</font> ) </li><li>  (2, <font color="#A31515">'1234567'</font> , <font color="#A31515">'My@mail.ri'</font> , <font color="#A31515">''</font> ), </li><li>  (3, <font color="#A31515">'7'</font> , <font color="#A31515">'My@jabber.ru'</font> , <font color="#A31515">''</font> ), </li><li>  (4, <font color="#A31515">'1'</font> , <font color="#A31515">'One of the most popular Jabber servers - jabber.ru</font> http://www.jabber.ru/node/247 is the address of the page with instructions for registering to connect to it. To find out the Jabber host address, write, how much will dvuhplus5. ', <font color="#A31515">' '</font> ), </li><li>  (5, <font color="#A31515">'hello'</font> , <font color="#A31515">'Hello)'</font> , <font color="#A31515">''</font> ), </li><li>  (6, <font color="#A31515">'how are you'</font> , <font color="#A31515">'normal')</font> , <font color="#A31515">''</font> ); </li></ol></blockquote><br><br>  And do not forget to put in a daddy with a bot ZendFramework <br><br>  I will not comment on something, because  everything is quite trivial. <br>  I will only note that I did not set the task to do something serious, but only to send to the address (although I already typed enough dialogues and the bot with some friends already said in messages of 5-10 pieces without throwing out the default message).  The bot does not work with messages in the RTF format, but this feature is implemented in the class (it can be completed).  It was certainly possible to fasten the conversation with separate UINs into separate threads.  But this is another matter.  The main idea) <br>  This creation is already 4 days in flight.  People 1-2 people per day in the jabber contact list is added. <br>  Here is such a miracle happened. <br></div><p>Source: <a href="https://habr.com/ru/post/53017/">https://habr.com/ru/post/53017/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../53010/index.html">Smartphone as a road workplace. Part 1. "Garbage" time: the goldmine.</a></li>
<li><a href="../53011/index.html">We monitor services with the help of ‚ÄúApps Status‚Äù</a></li>
<li><a href="../53013/index.html">Video graffiti</a></li>
<li><a href="../53014/index.html">use of very long asymmetric keys in ssh</a></li>
<li><a href="../53016/index.html">Customize and integrate Google Friend Connect in WordPress</a></li>
<li><a href="../53019/index.html">41 Google Translate languages</a></li>
<li><a href="../53022/index.html">Gmail presents a multi-selection of files and the status of their download.</a></li>
<li><a href="../53023/index.html">After a year of learning PHP</a></li>
<li><a href="../53025/index.html">When too many google ...</a></li>
<li><a href="../53026/index.html">The service will help to generate CSS selectors for jQuery simply by clicking on the desired item.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>