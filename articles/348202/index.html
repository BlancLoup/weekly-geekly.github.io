<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Apache Ignite - calculations in grid</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Calculations in grid or mining of ‚Äúbeautiful‚Äù hashes, I decided to check this problem for calculations in the Apache Ignite grid. Earlier, I tried and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Apache Ignite - calculations in grid</h1><div class="post__text post__text-html js-mediator-article">  Calculations in grid or mining of ‚Äúbeautiful‚Äù hashes, I decided to check this problem for calculations in the Apache Ignite grid.  Earlier, I tried and wrote <a href="https://habrahabr.ru/post/346262/">Ignite as Sql</a> DB, but for myself I realized that this is still a convenient option in this computing system (I‚Äôll come back to SQL on Ignite), just as I imagine it with the possibility of fast and inexpensive scalability .  So let's see how you can quickly and inexpensively increase computations, or not, for example, to increase the computations of 1 powerful computer by adding a few weak ones to it. <br><br>  The task is to calculate a hash for data transaction blocks, but not simple, but with some complexity, for example, containing seven consecutive 'A' characters.  In order for this to be possible, we will paste the number constantly increasing in the loop to the data block until a hash of a given complexity is obtained.  Yes, it looks like miners do mining cryptocurrency. <a name="habracut"></a>  Since I have several transactions, I will send them to the computational grid.  Computational grid is Ignite nodes, running instances on different computers, they discover themselves and form a grid.  These calculations will be distributed between the nodes evenly and automatically. <br><br>  And so my computing power at home is: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Intel Core I5-7400 3.5 GHz 8 GB.  Ram <br>  Intel Core I3-6100 3.7 GHz 8 GB.  Ram <br>  Intel Core 2Duo E6550 2.3 GHz 8 GB.  Ram <br>  Ignite will be launched on each of them. <br><br><div class="spoiler">  <b class="spoiler_title">Here is one of the templates that Ignite offers for computing in the grid.</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//  Ignition.setClientMode(true); try (Ignite ignite = Ignition.start("examples/config/example-ignite.xml")) { //  ,   //        ,    for (final T item: list) { calls.add(new IgniteCallable&lt;String&gt;() { @Override public String call() throws Exception { //      ,      return result; } }); } //       Collection&lt;String&gt; res = ignite.compute().call(calls); //      for (String hash : res) { System.out.println("&gt;&gt;&gt; Check all nodes for output : " + result); } }</span></span></code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Here is the code that will be calculated on the grid nodes (public String call ())</b> <div class="spoiler_text"><pre> <code class="java hljs"> calls.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IgniteCallable&lt;String&gt;() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">call</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ System.out.println(); System.out.println(<span class="hljs-string"><span class="hljs-string">"&gt;&gt;&gt; Id transaction=#"</span></span> + transaction.getId() + <span class="hljs-string"><span class="hljs-string">" on this node from ignite job."</span></span>); MessageDigest md = MessageDigest.getInstance(<span class="hljs-string"><span class="hljs-string">"MD5"</span></span>); String transactHash; <span class="hljs-comment"><span class="hljs-comment">//    do { md.update(transaction.getDifficultyContent().getBytes()); byte[] digest = md.digest(); transactHash = DatatypeConverter.printHexBinary(digest).toUpperCase(); //   transaction.setDifficulty(transaction.getDifficulty() + 1); } while (!transactHash.contains("AAAAAAA")); return transactHash; } });</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Full code</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyComputeCallable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    public static final String LOREM_IPSUM = "Lorem ipsum dolor sit amet, consetetur sadipscing elitr,# " + "sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua.#" + "At vero eos et accusam et justo duo dolores et ea rebum.#" + "Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet."; /** * Executes example. * * @param args Command line arguments, none required. * @throws IgniteException If example execution failed. */ public static void main(String[] args) throws IgniteException { String[] loremIpsum = LOREM_IPSUM.split("#"); List&lt;Transaction&gt; transactionList = new ArrayList&lt;&gt;(); for (int i= 0; i &lt;= 10; i++) { transactionList.add(i, new Transaction(i, loremIpsum[i % 4])); } Ignition.setClientMode(true); try (Ignite ignite = Ignition.start("examples/config/example-ignite.xml")) { System.out.println(); System.out.println("&gt;&gt;&gt; Compute callable example started."); Collection&lt;IgniteCallable&lt;String&gt;&gt; calls = new ArrayList&lt;&gt;(); // Iterate through all words in the sentence and create callable jobs. for (final Transaction transaction : transactionList) { calls.add(new IgniteCallable&lt;String&gt;() { @Override public String call() throws Exception { System.out.println(); System.out.println("&gt;&gt;&gt; Id transaction=#" + transaction.getId() + " on this node from ignite job."); MessageDigest md = MessageDigest.getInstance("MD5"); String transactHash; do { md.update(transaction.getDifficultyContent().getBytes()); byte[] digest = md.digest(); transactHash = DatatypeConverter.printHexBinary(digest).toUpperCase(); //   transaction.setDifficulty(transaction.getDifficulty() + 1); } while (!transactHash.contains("AAAAAAA")); return transactHash; } }); } // Execute collection of callables on the ignite. long millis = System.currentTimeMillis(); Collection&lt;String&gt; res = ignite.compute().call(calls); System.out.println(); // individual received from remote nodes. for (String hash : res) { System.out.println("&gt;&gt;&gt; Check all nodes for output hash: " + hash); } System.out.println("&gt;&gt;&gt; Total msec: " + (System.currentTimeMillis() - millis)); } } } //----------------------- Transaction --------------------------------- public class Transaction { private int difficulty; private int id; private String content; public Transaction(int id, String content) { this.id = id; this.content = content; } public int getId() { return id; } public void setId(int id) { this.id = id; } public int getDifficulty() { return difficulty; } public void setDifficulty(int difficulty) { this.difficulty = difficulty; } public String getContent() { return content; } public void setContent(String content) { this.content = content; } public String getDifficultyContent() { return "" + difficulty + content; } }</span></span></code> </pre><br></div></div><br>  The result of calculations for 11 transactions on one node (one computer), the code is higher <br><table><thead><tr><th>  Computer <br></th><th>  Result msec. <br></th></tr></thead><tbody><tr><td>  I5 <br></td><td>  40,909 <br></td></tr><tr><td>  I3 <br></td><td>  57 162 <br></td></tr><tr><td>  2 Duo <br></td><td>  140 673 <br></td></tr></tbody></table><br>  It's nice that the power since 2Duo has grown.  And this is how it looked in the pictures with I5 <br><br><div class="spoiler">  <b class="spoiler_title">Ignite console</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/h0/0i/mn/h00imng3yci4es6ud84ssoizozu.png" alt="image"><br>  It can be seen that the client connected to the server (srevers = 1, clients = 1), transactions arrived at the node for calculations (11 total) &gt;&gt;&gt; Id transaction ... <br>  at the end of the client disconnected (srevers = 1, clients = 0) <br></div></div><br><div class="spoiler">  <b class="spoiler_title">The output of the program (beautiful hashes)</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/wk/jk/as/wkjkas0wab7cnex8vmfk_s--ak0.png" alt="image"><br>  But the calculated "beautiful" hashes <br></div></div><br>  And now we will begin to increase the computing power,  run on multiple computers Ignite server.  Since the example is implemented in such a way that it waits for all tasks to be completed, the end will be a calculation on the last node, and if we connect weak computers to strong ones, the result will fall (at least at the beginning). <br><br>  The result of calculations on several nodes. <br><table><thead><tr><th>  Nodes <br></th><th>  Result msec. <br></th></tr></thead><tbody><tr><td>  I5 + i3 <br></td><td>  44 389 <br></td></tr><tr><td>  I5 + I3 + 2Duo <br></td><td>  68,892 <br></td></tr></tbody></table><br>  It can be seen, for example, that adding to I5, I3 the result became lower than for one I5, but better than one I3.  Thus, the calculation time for this implementation will be measured by a weak node and <b>is equal to the time over which the node will process its portion of tasks</b> .  To get the calculation time in a combination of I5, I3 is better than on one I5, you need to understand on how many transactions I3 time will show better than I5 for all.  Experimentally quickly found that I3 a portion of 4-5 transactions processes as well or better as I5 all 11 transactions, so such portions are possible when there are 3 nodes in the grid - I5 + I3 + I3, my expectations that my grid will calculate this task ~ 30 sec. (Against 40 sec. On one I5), such is scalability. <br><br>  Well, adding to the weak computers in the grid are powerful, of course, we immediately get an increase.  One 2Duo counted 140 seconds, and in the grid with others for 68 seconds. <br><br>  This is one of the Ignite consoles for three nodes in the grid. <br><br><img src="https://habrastorage.org/webt/nj/68/al/nj68alm4a8enfoklomh6xmbq_ls.png" alt="image"><br><br>  It shows 3 servers, one client who sends tasks to them, the CPU shows how the sum of three computers, well, the memory also as a sum.  It can be seen that the node received 4 tasks from 11 (transactions), at the end there were three servers. <br><br>  In general, distributed tasks are solved coolly, various templates are offered, with different capabilities.  Next, I want to return to SQL in Ignite and work with caches, I will write ... <br><br><div class="spoiler">  <b class="spoiler_title">Topology</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/tc/rd/ru/tcrdrueyo4bzeqzzyfspmrsdezy.jpeg" alt="image"><br><img src="https://habrastorage.org/webt/j2/t5/7l/j2t57lcitdfbsivtyckp3bjalam.png" alt="image"><br></div></div><br>  Materials: <br><br>  Ignite <a href="https://apacheignite.readme.io/docs/getting-started">Getting Started</a> </div><p>Source: <a href="https://habr.com/ru/post/348202/">https://habr.com/ru/post/348202/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../348192/index.html">Software sound synthesis on early personal computers. Part 2</a></li>
<li><a href="../348194/index.html">Making multicolored icons using SVG symbols and CSS variables</a></li>
<li><a href="../348196/index.html">Track user actions with CSS</a></li>
<li><a href="../348198/index.html">Understanding lvalue and rvalue in C and C ++</a></li>
<li><a href="../348200/index.html">Sean Pierce: A Real Leader</a></li>
<li><a href="../348204/index.html">GObject Basics</a></li>
<li><a href="../348206/index.html">Algorithm of a choice of location in Nginx</a></li>
<li><a href="../348208/index.html">Interview. How to create a high-quality knowledge base: choice of technologies, search and further support</a></li>
<li><a href="../348210/index.html">Create CSS keylogger</a></li>
<li><a href="../348212/index.html">Game development for NES in C. Chapters 4-6. Drawing character</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>