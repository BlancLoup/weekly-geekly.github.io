<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>FreeSWITCH life example ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good time% username%. 

 I would like to warn you earlier that everyone who is in principle will be right, this system is like shooting sparrows from ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>FreeSWITCH life example ...</h1><div class="post__text post__text-html js-mediator-article">  Good time% username%. <br><br>  I would like to warn you earlier that everyone who is in principle will be right, this system is like shooting sparrows from a cannon, but I wanted something like that.  Also, some elements in this scheme did not rise from scratch, they were already used in solving other problems, and we will not consider their architecture (database server and HTTP server), let‚Äôs take the fact that these services are reserved properly. <br><br>  One of my works was tasked with transferring external lines from gsm gateways (about 30) and land lines pri (100 lines) to IP.  Also due to the impossibility of further development of the Samsung ids-500 PBX (2 stations) the installation of IP phones.  At the PBX has already been about 600 business phones.  Currently external lines 190. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Primary requirements: <br><ul><li>  Using IP phones with conventional analog </li><li>  Maximum reservation of output from PBX to IP and back. </li><li>  Scaling, stability, manageability, flexibility </li><li>  IP Phone Management </li></ul><br><br>  Briefly on the software used: <br>  FreeSWITCH - call routing, subscriber registration, faxes, in general, all PBX functions <br>  OpenSIPS - balancing registrations, calls to FreeSWITCH servers, also when intercepting a call, determines the server to which the call is received and sends a user request to it. <br>  Asterisk - DAHDI cards, logic 0.1%, forwarding calls from PBX to FreeSWITCH and back. <br>  Django - distribution of configurations on servers (mod_xml_curl), phone configurations, and management of all this economy. <br><br>  I‚Äôm not good at drawing schemes, so I‚Äôll try to describe the scheme in this way (as it turned out, I don‚Äôt get very good at writing too).  If more detailed details will be interesting, I will answer in addition. <br><br><h1>  Equipment: </h1><br>  2 - physical servers, each of which has two DAHDI boards with which Asterisk is working (port 6060 is used for sip`a).  Also on the same machines installed FreeSWITCH.  PBXs are located in different server servers, servers are also separated by these server servers.  Let's call them sip1 and sip2. <br>  1 - virtualka, it communicates with operators through it, FreeSWITCH is installed, let's call it sip0 <br>  1 - Virtualka, OpenSIPS is our balancer. <br><br><h1>  Logics: </h1> <br>  Each server is connected to each PBX by pri, which provides us with redundancy.  When calling from a PBX, Asterisk tries to send a call to FreeSWITCH running on this machine, in case of an error, we send a call to a second server. <br>  Calls to PBXs basically follow the same logic, with the only exception, first the call goes to the server that is located next to the PBX that the call is going to.  Ie if the call came on sip1 and closer to ATS2 is sip2, then the call is first sent to it. <br>  All PBX numbers that have an external number binding are registered in the system, when a call comes out with sip0, the corresponding caller id is substituted, in the case of absence of binding, a pilot number is substituted.  This is released as a variable defined for users out_number and checking in the dialplan <code>${user_data(${caller_id_number}@${domain} var out_number)}</code> <br>  For VOIP numbers, the logic is the same. <br><br>  For internal calls to the caller name, we get the <b>mod_cidlookup</b> request via http.  Match the phone number of the employee's name, a separate story about AD and 1C. <br>  VOIP phones - Dlink dph-105, dph-400, grandstream gxp-1405, gxp-2120.  The configuration on them is distributed through http, we take all the settings from the base and on the fly we form the necessary configuration file. <br>  The admin has implemented the minimum functionality, the configuration of the user devices, cdr, rebooting the devices, dialplan management, small statistics for the day incoming / outgoing successful calls and also by errors, the current number of registered users and the number of active calls in the context of servers. <br>  sip1 and sip2 use the same database for user registration, voice mail, active calls, cdr, storage of variables. <br>  About the scalability and redundancy of FreeSWITCH  ªa can be read <a href="http://wiki.freeswitch.org/wiki/Enterprise_deployment">Enterprise deployment</a> <br>  Currently, there are 300 registered SIP users, 600 users on PBXs. The maximum number of simultaneous calls to external destinations is 40. <br><br>  I understand this text flow is not complete and does not describe the whole picture, however, as I constantly put off writing, I decided to write as much as I can and if this topic is interesting I will expand and complement it. </div><p>Source: <a href="https://habr.com/ru/post/132868/">https://habr.com/ru/post/132868/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132862/index.html">Tracing the path to the GPU, part 1</a></li>
<li><a href="../132863/index.html">Perfect marker board</a></li>
<li><a href="../132864/index.html">Digium's Switchvox is recognized!</a></li>
<li><a href="../132866/index.html">Rereading Cooper</a></li>
<li><a href="../132867/index.html">One day in the life of a project manager through the eyes of a developer</a></li>
<li><a href="../132869/index.html">Depersonalization of the MySQL database. Interesting technique</a></li>
<li><a href="../132870/index.html">Manage dependencies in Android projects using Ivy</a></li>
<li><a href="../132871/index.html">HP: caveat emptor</a></li>
<li><a href="../132874/index.html">Social spam</a></li>
<li><a href="../132875/index.html">Writing the function of saving pictures to the SD card</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>