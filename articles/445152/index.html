<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What else can be done in the search? Yandex report</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In Yandex, there is a search engine component development service that builds a search base on MapReduce, provides layout data for rendering, generate...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What else can be done in the search? Yandex report</h1><div class="post__text post__text-html js-mediator-article">  In Yandex, there is a search engine component development service that builds a search base on MapReduce, provides layout data for rendering, generates algorithms and data structures, and solves ML quality growth problems.  Alexey Shlyunkin, the head of one of the groups within this service, explains what the runtime of the search consists of and how we manage it. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8NHDcwOEBDs" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><blockquote>  Do you want to poke around in ML - poke around.  You want only MapReduce - ok.  Want runtime - runtime. </blockquote><br>  - What is the search today?  Yandex began with what made the search, developed it.  It's been 20 years.  We have a search base for hundreds of billions of documents. <br><br><a name="habracut"></a>  The document we call any page on the Internet, but, in fact, not only it.  More - its contents, various statistics about what users like to go to it, how many of them.  Plus the data we calculated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It is also tens of thousands of instances that, in response to each request, process the data, search for something, enrich the search response.  Some instances are looking for pictures, some - plain text documents, some - videos, etc. That is, tens of thousands of machines are activated for each of your requests.  They all try to find something and improve the result that is shown to you.  Accordingly, tens of thousands of machines serve thousands of requests per second.  These tens of thousands of instances are combined into hundreds of services designed to solve a problem. <br><br><img src="https://habrastorage.org/webt/vv/ge/qi/vvgeqica4ehx9uawes9ylfw098m.jpeg"><br><br>  There is a search engine - web search service.  And there is a video search service, and so on. Accordingly, there is a thing that combines the answers of different searches and tries to choose what and in what order is best shown to the user.  If this is some kind of music query, then it‚Äôs probably better to first show Yandex.Music, and then, for example, a page about this music group.  This is called a blender.  There are already hundreds of such services, and they also do something for every request and try to somehow help users.  And, of course, in all of this machine learning is used just of all sorts, from some simplest statistics, linear models, to gradient boosters, neural networks, and so on. <br><br>  I will now talk about the infrastructure, and about ML. <br><br>  My group is called the new runtime development team, it is included in the search component development service.  So that you have an idea, I'll tell you a little bit about what our service is doing. <br><br><img src="https://habrastorage.org/webt/so/vn/kt/sovnktsoqacdyqxp0l7g_q9sgjm.jpeg"><br><br>  In fact - all.  If you submit a search, then about everything we have launched our hands, starting from building a search base.  That is, we have MapReduce, we collect all the data about documents there, boil it, build all sorts of data structures so that we can efficiently calculate something when we query them.  Accordingly, we work from the bottom, when the document only gets to us, from the first stage, when these documents get something and rank, and to the very top, where the layout receives a conditional JSON and draws it with all the pictures and beautiful.  From the bottom to the top of the entire stack, we are developing something. <br><br>  But we are not only writing code and, accordingly, doing all this infrastructurally.  We are, in fact, teaching neural networks, CatBoost.  And other ML-pieces that you can imagine and that burn, we also teach.  Still, since we have large loads, big data, we, of course, look in algorithms and data structures and never restrain them from being implemented somewhere.  For example, in several places we use segment trees.  We have our own compression of the indices that build boron and according to it consider the dynamics, how best to build dictionaries. <br><br>  In general, being engaged in such a large edifice as a search, we were filled with similar simple tasks.  Therefore, we, of course, adore something complex, new, something that challenges us.  And we didn't just go and write, as usual, ten lines of code.  We need to think, to conduct some experiments.  In general, the tasks that we set for ourselves are often on the verge of fantasy.  Sometimes you think: probably it is impossible.  But then you, maybe, somehow experimented - experiments can take a whole year, - but in the end something happens.  Then we begin to introduce something to redo. <br><br>  And besides all projects, skills, and so on, in general, we are one of the most ambitious and fastest growing teams in Yandex.  For example, I came two years ago, was the ninth person in our service.  Now we have a service of almost 60 people.  This is, in fact, with interns, but, in general, we have grown exactly four times four times in two years.  This is about how you know what our service is doing. <br><br>  Now I want to talk a little bit about our tasks and the direction that I think will be more and more relevant in the near future.  But for this, you must first briefly describe how the most basic search layer works. <br><br><img src="https://habrastorage.org/webt/by/3e/eu/by3eeuckwlvf33ia2f_hwovampe.jpeg"><br><br>  If in general, everything works very simply.  We have our search base, we have all the documents, and we all divide these documents more or less evenly into N pieces.  They are called shards.  And a program called ‚ÄúBasic Search‚Äù is launched above the shard.  Her task is to perform a search, respectively, on this piece of the Internet.  That is, she knows how to search for it and knows nothing more about the other Internet.  And we have such N shards.  Basic searches have been launched above them, and, accordingly, there is a meta-search above.  The user's request is dumped into it and, accordingly, it simply goes to all shards, and each shard performs a search, then each returns a result, and it performs some kind of merging and gives an answer. <br><br>  Approximately the search for almost all 20 years was arranged in this way, and, in general, they thought for a long time that it would remain like this, and nothing could be done better.  But everything is changing, new technologies are emerging, and machine learning now not only makes it possible to increase quality, but also allows solving some infrastructure problems.  Recently, in our search projects are very fired, just at the junction of infrastructure and machine learning.  When two such mastodon merge, very interesting results are obtained. <br><br><img src="https://habrastorage.org/webt/ty/0s/zo/ty0szoxygxc0jvgwxifylxmfqqi.jpeg"><br><br>  Recently, neural networks have appeared.  We have the text of the request, there is the text of the document.  We want to get some vector of numbers from the request, get some vector of numbers from the document so that the dot product predicts the value we want.  For example, we want to teach that the scalar product predicts the probability of a user clicking on this document.  Understandable thing. <br><br><img src="https://habrastorage.org/webt/dr/cx/dl/drcxdlgw4bne__esu_lvrfumefy.jpeg"><br><br>  It is arranged like this.  If it is very, very rough, then we have some words on the lower layer, and then there are several layers of the network.  Each layer, in fact, takes some vector to the input.  That is, the bottom layer is such a sparse vector, where each word is a query.  Multiplies it by a matrix, gets some vector, and further, respectively, applies some nonlinearity to each component, and so it does several times.  And the last layer, this is called the very vector that we just took the query, applied such layers, and here the last layer is the same vector of the query. <br><br>  Accordingly, these neural networks have been actively implemented in the search for the last few years, they have brought a lot of quality benefits.  But they have one problem: all the quantities that we want to predict are good, but rather coarse, because in order to train such a neural network, the bottom layer is very large, all words are from tens of millions of words, therefore you must be able to her input is several billions of data. <br><br>  For example, we can train for some user clicks, and so on.  But the main signal that is considered the most important in our search is manual marking by special people.  They take the request, take the document, read it, understand how good it is and rate it, that is, how this document fits this request.  We couldn‚Äôt predict neural networks for such a long time, because we still have millions of assessments, because hiring the entire planet to mark it all up all the time is very expensive.  So we did some hack. <br><br><img src="https://habrastorage.org/webt/ao/yb/3m/aoyb3mcdap3a7l4lyett7y9h9bo.jpeg"><br><br>  Neural network of neural networks.  We have accumulated in recent years a lot of some neural networks that predict good signals, but a little more rough than the assessment of special people.  Accordingly, we decided that on the lower layer we will submit the ready-made vectors of these networks, and then we will train the neural network to predict our search relevance on a smaller data-network. <br><br>  It turned out very good model.  It leads to the vector of document requests, and their scalar product directly predicts real relevance, which we have long wanted to predict. <br><br>  Then we had an idea how to search for a bit of remake.  The project is called KNN-base (English k-nearest neighbors, the method of k-nearest neighbors). <br><br><img src="https://habrastorage.org/webt/ev/il/uw/eviluwyaq_ip-xgtae0jpojo6su.jpeg"><br><br>  The basic idea is this.  We have a request vector and a document vector.  We need to find the nearest one.  Each document is represented by a vector.  Let's select N clusters, those that characterize the entire document space.  Roughly speaking.  Strongly less than the number of documents, but for example, they characterize the topics.  If in simple terms, there is a cluster about cats, a cluster about cars, a cluster about programming, and so on. <br><br>  Accordingly, documents will not be scattered randomly on shards, as before, but we will put the document on that shard, that is, the centroid of which is closest to the document.  Accordingly, in our shard there will be such documents grouped by topics. <br><br>  And then just to the request now we can not go to all shards, and go only to some small subset of those who are closest to this request. <br><br><img src="https://habrastorage.org/webt/xq/-x/xz/xq-xxz9zsxwngyiaovqilmdytda.jpeg"><br><br>  Accordingly, we had such a scheme, meta-search is included in all shards.  And now he needs to go to a much smaller number, and at the same time we will still look for the nearest documents. <br><br>  What we actually get from this design?  It significantly reduces the consumption of computing resources, simply because we go to a smaller number of clusters.  This, as I have already said, I consider one of the highlights of our service, this is a combination of infrastructure and machine learning, which gives such results that no one could think of before. <br><br><img src="https://habrastorage.org/webt/sq/r3/pd/sqr3pdlcsbgwah4raljs1y8y45k.jpeg"><br><br>  And, in the end, it's just a pretty fun thing, because you got the models here, and then you went, redid the whole search, petabytes of data turned up, and your search works, it burns ten times less resources.  You saved a company a billion dollars, everyone is happy. <br><br><img src="https://habrastorage.org/webt/zs/wl/ei/zswlei9tbbnwnjad68aa48h8h54.jpeg"><br><br>  I told about one of the projects that we have in the search and which is conditionally implemented and done with all the experiments.  Our other typical tasks are to grow the search base two more times, because the Internet is constantly growing and we want to catch up with it and look for all the pages on the Internet.  And of course, this is the acceleration of the base layer, in which there are most instances, most of all iron.  For example, speeding up the basic search by one percent means saving about a million dollars. <br><br>  We also search as an incubator for startups.  I will explain.  The search is done for 20 years.  It has already done a lot of things, many times we ran into some kind of dead end and thought that nothing could be done.  Then there was a long series of experiments.  We again punched this impasse.  And during this time we have accumulated a lot of expertise on how to make big and cool things.  Accordingly, now most of the new directions in Yandex are being made in the search, because people in the search already know how to do all this, and it is logical to ask them to at least design some new system.  And as a maximum - go do yourself. <br><br>  Now, I hope you are a little bit of our work.  I will quickly tell the thematic part of my story, about the interns in our service.  We love them very much.  We have a lot of them, last summer only in my group there were 20 interns, and I think that this is good.  When you take one or three interns, they feel a little lonely, sometimes afraid to ask their older colleagues.  And when there are many, they communicate with each other as companions in misfortune.  If they are afraid to ask the developers something, they will go and poshuskuyutsya in the corner.  This atmosphere helps to do everything effectively. <br><br>  We have a million tasks, the team is not very big, so our interns are loaded to the fullest.  We do not ask the intern to sit all the time to log the log, write tests, refactor the code, but immediately give some complicated production task: speed up the search, improve the index compression.  Of course, we help.  We know that this all pays off, so we are happy to share our expertise.  Since our field of activity is quite extensive, each of us will find a task to his taste.  Do you want to poke around in ML - poke around.  You want only MapReduce - ok.  Want runtime - runtime.  There is anything. <br><br>  What you need to get to us?  We do everything mostly in C ++ and Python.  You don't have to know both, you can know one thing.  We welcome knowledge of algorithms.  It forms a certain style of thinking, and it helps a lot.  But this is also not necessary: ‚Äã‚Äãagain, we are ready to teach everything, we are ready to invest our time, because we know that it pays off.  The most important requirement that we make, our motto, is not to be afraid of anything and to figure a lot.  Do not be afraid to drop production, do not be afraid to start doing something difficult.  Therefore, we need people who are also not afraid of anything and are also ready to move mountains.  Thank you very much. </div><p>Source: <a href="https://habr.com/ru/post/445152/">https://habr.com/ru/post/445152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445136/index.html">Do not be nervous, do not rush, do not interrupt: the story of one tragedy</a></li>
<li><a href="../445138/index.html">IBM Integration Bus and what it eats</a></li>
<li><a href="../445140/index.html">PHP Digest number 152 (March 11 - 25, 2019)</a></li>
<li><a href="../445146/index.html">The story of the Slonik elephant, PostgreSQL logo</a></li>
<li><a href="../445150/index.html">Upwork is registered in the Russian Federation</a></li>
<li><a href="../445154/index.html">Digital events in Moscow from March 25 to March 31</a></li>
<li><a href="../445156/index.html">Compact nebulizer Glenmark: useful thing in everyday life</a></li>
<li><a href="../445158/index.html">Optimum part orientation and support configuration in a 3D printer</a></li>
<li><a href="../445160/index.html">We develop pedal firmware for learning to play the balalaika</a></li>
<li><a href="../445162/index.html">Terraform provider selectel</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>