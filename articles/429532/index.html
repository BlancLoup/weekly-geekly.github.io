<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Self-documented microservices (ArangoDB + swagger)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maintaining documentation for microservices up to date still requires the utmost discipline in the development, well, and large labor costs. A very re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Self-documented microservices (ArangoDB + swagger)</h1><div class="post__text post__text-html js-mediator-article">  Maintaining documentation for microservices up to date still requires the utmost discipline in the development, well, and large labor costs.  A very reasonable approach to creating documentation is, for example, GraphQL, where the documentation is inextricably linked to the program code and this guarantees 100% compliance with the documentation and the services being documented.  However, the unusualness of the GraphQL approach for developers accustomed to the REST-API still makes it difficult to promote this technology in practical application development.  Here you can also recall SOAP, which has long solved the problem of matching documentation and services, but due to over-complication did not take root among the masses of developers. <br><br>  I would like to find such a stack of technologies for the development of microservices, which ensured the same self-documenting software code when developing the ‚Äútraditional‚Äù REST-API microservices.  And he, as it turned out, already exists. <br><a name="habracut"></a><br>  We define the actors and performers who will be involved in our small example. <br><br>  ArangoDB is a hybrid, document-based + graph-oriented database. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      UPD.  More detailed acquaintance with this database was the reason for another disappointment.  As it turned out, after the database has exceeded the non-commitit limit, which is limited by free RAM, the base starts to slow down, it just stops along with the server.  At the same time, tentative suggestions were made that the transition to new storage engines would all work better, which had not yet been confirmed. <br><br>  Foxx is a microservice framework built into the ArangoDB database.  It runs on a JavaScript engine, which (unlike nodejs) can simultaneously run in an unlimited number of parallel threads (not blocking each other), as a result of which there is no need for promise / than / canch and async / await constructions.  Unlike mongodb, in which it is not recommended to abuse server procedures, and relational databases, in which stored procedures are also used carefully and certainly do not interact via REST-API with clients (browsers, mobile applications, etc.) - microservice framework Foxx was developed just to develop microservices that communicate directly over the http protocol with clients. <br><br>  Swagger is an open source software environment supported by a large ecosystem of tools that helps developers develop, create, document, and consume RESTful web services.  Although most users identify Swagger with the Swagger UI, the Swagger toolkit includes support for automatic documentation, code generation, and test case generation. <br><br>  The fact that Swagger includes supporting code generation is a situation that opposes the one that I would like to receive - when the code supports the generation of documentation.  What offers us ArangoDB + Foxx just includes the opposite option.  When the microservice code generates a scheme for Swagger.  However, now this can be seen for yourself having done a minimum of work. <br><br>  You must have ArangoDB installed to take further action. <br><br><ol><li>  Enter the admin area and select the item to create a new microservice Services-&gt; Add service-&gt; New. </li><li>  We fill in the required details in the opened form.  In the field ‚ÄúDocument Collections‚Äù we add the name of the collection of documents that will be created when the microservice is deployed.  For example, cats. </li><li>  We click on the install button, enter in the url field, to which the microservice will be assigned. </li></ol><br>  When installing microservice, for each collection from the field ‚ÄúDocument Collections‚Äù (see p.2), routes will be created that implement CRUD operations using the POST, GET, PUT and DELETE methods.  However, these are only methods that can be changed, deleted, and added new ones.  We chose one collection when creating a microservice (cats), although we could not do this, but add everything later manually. <br><br>  Now our cats collection has routes for CRUD operations, and we can start calling these routes from the database admin panel by selecting the API tab (Services -&gt; [Microservice name] -&gt; API).  This tab contains the familiar Swagger interface.  It is also possible to publish the Swagger interface on an external route accessible not only through the admin area, but as a regular URL. <br><br>  If we try to add a document to the cats collection using the POST {"name": "Tom"} method, we will get the status with an error.  Since  we have not defined a name field anywhere.  Therefore, we will continue to work with the admin ArangoDB. <br><br>  4. For more convenient development, ArangoDB provides the Development mode, which is enabled on the Settings tab (Services -&gt; [Microservice name] -&gt; Settings-Set development) <br><br>  Now you can change the worldservice code and immediately observe the result (without additional deployment).  The directory in which the microservice program code is located can be found in the admin panel on the Info tab (Services -&gt; [Microservice name] -&gt; Info). <br><br>  Let's see how the defined POST route looks. <br><br><pre><code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dd = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'dedent'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> joi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'joi'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> httpError = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'http-errors'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> status = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'statuses'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> errors = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@arangodb'</span></span>).errors; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> createRouter = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'@arangodb/foxx/router'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Cat = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'../models/cat'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cats = <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.context.collection(<span class="hljs-string"><span class="hljs-string">'cats'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> keySchema = joi.string().required() .description(<span class="hljs-string"><span class="hljs-string">'The key of the cat'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ARANGO_NOT_FOUND = errors.ERROR_ARANGO_DOCUMENT_NOT_FOUND.code; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ARANGO_DUPLICATE = errors.ERROR_ARANGO_UNIQUE_CONSTRAINT_VIOLATED.code; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> ARANGO_CONFLICT = errors.ERROR_ARANGO_CONFLICT.code; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> HTTP_NOT_FOUND = status(<span class="hljs-string"><span class="hljs-string">'not found'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> HTTP_CONFLICT = status(<span class="hljs-string"><span class="hljs-string">'conflict'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> router = createRouter(); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = router; router.tag(<span class="hljs-string"><span class="hljs-string">'cat'</span></span>); router.post(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">req, res</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> cat = req.body; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> meta; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { meta = cats.save(cat); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e.isArangoError &amp;&amp; e.errorNum === ARANGO_DUPLICATE) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> httpError(HTTP_CONFLICT, e.message); } <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e; } <span class="hljs-built_in"><span class="hljs-built_in">Object</span></span>.assign(cat, meta); res.status(<span class="hljs-number"><span class="hljs-number">201</span></span>); res.set(<span class="hljs-string"><span class="hljs-string">'location'</span></span>, req.makeAbsolute( req.reverse(<span class="hljs-string"><span class="hljs-string">'detail'</span></span>, {<span class="hljs-attr"><span class="hljs-attr">key</span></span>: cat._key}) )); res.send(cat); }, <span class="hljs-string"><span class="hljs-string">'create'</span></span>) .body(Cat, <span class="hljs-string"><span class="hljs-string">'The cat to create.'</span></span>) .response(<span class="hljs-number"><span class="hljs-number">201</span></span>, Cat, <span class="hljs-string"><span class="hljs-string">'The created cat.'</span></span>) .error(HTTP_CONFLICT, <span class="hljs-string"><span class="hljs-string">'The cat already exists.'</span></span>) .summary(<span class="hljs-string"><span class="hljs-string">'Create a new cat'</span></span>) .description(dd<span class="hljs-string"><span class="hljs-string">` Creates a new cat from the request body and returns the saved document. `</span></span>);</code> </pre> <br><br>  Both validation and documentation are based on the use of the object schema.  Let's make some small changes to it by adding the name field: <br><br><pre> <code class="javascript hljs"><span class="hljs-meta"><span class="hljs-meta">'use strict'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> _ = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'lodash'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> joi = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'joi'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">module</span></span>.exports = { <span class="hljs-attr"><span class="hljs-attr">schema</span></span>: { <span class="hljs-comment"><span class="hljs-comment">// Describe the attributes with joi here _key: joi.string(), name: joi.string().description('cat`s name'), //    }, forClient(obj) { // Implement outgoing transformations here obj = _.omit(obj, ['_id', '_rev', '_oldRev']); return obj; }, fromClient(obj) { // Implement incoming transformations here return obj; } };</span></span></code> </pre><br><br>  Turning to the API zakadku, you can make sure that the scheme has changed and now an object with the name field can be added to the cats collection. <br><br>  apapacy@gmail.com <br>  November 12, 2018. </div><p>Source: <a href="https://habr.com/ru/post/429532/">https://habr.com/ru/post/429532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429514/index.html">Microsoft told how to solve the problem of data security on SSD with "leaky" hardware encryption</a></li>
<li><a href="../429522/index.html">Designing a service robot. Problem statement, solution architecture</a></li>
<li><a href="../429524/index.html">Correct JSON API or JSON RPC</a></li>
<li><a href="../429528/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ338 (November 5 - 11, 2018)</a></li>
<li><a href="../429530/index.html">Mono Stacking Machine</a></li>
<li><a href="../429536/index.html">PHP Digest number 143 (November 1 - 12, 2018)</a></li>
<li><a href="../429540/index.html">We restore the detailed geometry of objects for more accurate assortment validation.</a></li>
<li><a href="../429542/index.html">Private messages from 81,000 Facebook accounts put up for sale</a></li>
<li><a href="../429544/index.html">Big conference NIXMultiConf (Kharkov)</a></li>
<li><a href="../429546/index.html">"The courses were not only for the sake of knowledge, many had career ambitions and professional development tasks"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>