<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deploying the Python way dependencies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Why do you need dependency injection? It reduces the connectivity of components in an application and simplifies testing. Some developers have the opi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deploying the Python way dependencies</h1><div class="post__text post__text-html js-mediator-article">  Why do you need dependency injection?  It reduces the connectivity of components in an application and simplifies testing.  Some developers have the opinion that dependency injection is needed only in large projects and that it greatly complicates the programs.  I think this has historically been due to a popular framework like Spring or Juice in Java.  Especially because of Spring, which is an incredible combine. <br><br>  <a href="https://github.com/ivan-korobkov/python-inject">Python-inject</a> is a small library for dependency injection in Python.  The third version is written in unix-style, i.e.  it perfectly performs only one function and does not try to be everything.  In contrast to the already mentioned Spring and Juice, Injectt does not steal class constructors from developers, does not impose on developers the need to write an application in any particular style and does not try to manage the entire graph of objects of the application. <br><br>  Inject practically does not require configuration (more on this tackle) and is very easy to use. <br><div class="spoiler">  <b class="spoiler_title">For example in tests</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   class Db(object): pass class Mailer(object): pass #      class User(object): db = inject.attr(Db) mailer = inject.attr(Mailer) def __init__(self, name): self.name = name def register(self): self.db.save(self) self.mailer.send_welcome_email(self.name) #    inmemory    . class TestUser(unittest.TestCase): def setUp(self): inject.clear_and_configure(lambda binder: binder \ .bind(Db, InMemoryDb()) \ .bind(Mailer, Mock())) self.mailer = inject.instance(Mailer) def test_register__should_send_welcome_email(self): #  . user = User('John Doe') #   . user.register() #     . self.mailer.send_welcome_email.assert_called_with('John Doe')</span></span></code> </pre> <br></div></div><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Using </h4><br>  It is best to deliver with PyPI, although you can download the archive from the project site: <br><pre> <code class="bash hljs">[sudo] pip install inject</code> </pre><br><br>  In the application: <br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   . import inject #    def my_config(binder): binder.install(my_config2) #    binder.bind(Db, RedisDb('localhost:1234')) binder.bind_to_provider(CurrentUser, get_current_user) #  . inject.configure(my_config) #     inject.instance  inject.attr class User(object): db = inject.attr(Db) @classmethod def load(cls, id): return cls.db.load('user', id) def __init__(self, id): self.id = id def save(self): self.db.save('user', self) def foo(bar): cache = inject.instance(Cache) cache.save('bar', bar) #      #    . user = User(10) user.save()</span></span></code> </pre><br><br><h4>  Types of buydings </h4><br>  The configuration of the injector is described with the help of bindings.  Sindings are responsible for initialization <br>  dependencies.  There are four types: <br><ol><li>  Instance bindings, which always return the same object: <br><pre> <code class="python hljs">redis = RedisCache(address=<span class="hljs-string"><span class="hljs-string">'localhost:1234'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(binder)</span></span></span><span class="hljs-function">:</span></span> binder.bind(Cache, redis)</code> </pre><br></li><li>  Constructor bindings that create a singleton on the first call: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">config</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(binder)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Creates a redis cache singleton on first injection. binder.bind_to_constructor(Cache, lambda: RedisCache(address='localhost:1234'))</span></span></code> </pre><br></li><li>  Provider bindings that are invoked on every dependency injection: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_my_thread_local_cache</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># Custom code here pass def config(binder): # Executes the provider on each injection. binder.bind_to_provider(Cache, get_my_thread_local_cache)</span></span></code> </pre><br></li><li>  Runtime bindings that automatically create singleton classes if there are no explicit buyings in the configuration for these classes.  Runtime bindings greatly reduce the size of the configuration.  For example, in the code below, only the Config class has an explicit configuration: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Config</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Cache</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> config = inject.attr(Config) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Db</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> config = inject.attr(Config) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> cache = inject.attr(Cache) db = inject.attr(Db) @classmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">load</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(cls, user_id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cls.cache.load(<span class="hljs-string"><span class="hljs-string">'users'</span></span>, user_id) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> cls.db.load(<span class="hljs-string"><span class="hljs-string">'users'</span></span>, user_id) inject.configure(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> binder: binder.bind(Config, load_config_file())) user = User.load(<span class="hljs-number"><span class="hljs-number">10</span></span>)</code> </pre><br></li></ol><br><br><h4>  Why there are no scopes? </h4><br>  For many years of using Spring and Juice in Java applications, I have not liked their field of view (the concept itself).  Inject by default creates all objects as singltons.  It does not need a prototype scope / NO_SCOPE, because it allows the use of normal class constructors, unlike Spring and Juice, in which all objects must be initialized within the context of the context / injector. <br><br>  Other scopes, for example, the request scope or session scope, in my opinion, are fragile, I increase the connectivity of components in an application and are difficult to test.  Injecting, if you need to limit the scope of an object, you can always write your own provider. <br><br><h4>  Conclusion </h4><br>  This is the third version of the injection.  The first two were partially like Spring and Juice, and they also tried to be combines.  The latest version is tiny compared to them, but it is simple, flexible and convenient to use.  The project code can be found on <a href="https://github.com/ivan-korobkov/python-inject">Github</a> . </div><p>Source: <a href="https://habr.com/ru/post/212217/">https://habr.com/ru/post/212217/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212207/index.html">Kinnex Element - a platform for WebRTC conferences</a></li>
<li><a href="../212209/index.html">Upgrade Java Development Tools for Windows Azure</a></li>
<li><a href="../212211/index.html">Prevalence of servers and server programming languages ‚Äã‚Äãin Runet</a></li>
<li><a href="../212213/index.html">Injector RMIP48-8LP with integrated lightning protection, replenishment in the family of multiport PoE</a></li>
<li><a href="../212215/index.html">"Set up" radio-controlled sockets without a remote</a></li>
<li><a href="../212221/index.html">The system of collecting and processing information "Safe City"</a></li>
<li><a href="../212225/index.html">Developer - to designers. Frome Hart Tou Hart</a></li>
<li><a href="../212229/index.html">Escene CC800 Contact Center IP Phone Overview</a></li>
<li><a href="../212231/index.html">Virgin Atlantic uses Google Glass and smart watches to work with passengers.</a></li>
<li><a href="../212233/index.html">Crowdsourcing in translation: is it so cool?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>