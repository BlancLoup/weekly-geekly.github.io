<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Javascript price</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As our sites are increasingly dependent on JavaScript, you have to pay for what we send to users. Sometimes the price is not visible at first sight. I...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Javascript price</h1><div class="post__text post__text-html js-mediator-article">  As our sites are increasingly dependent on JavaScript, you have to pay for what we send to users.  Sometimes the price is not visible at first sight.  In this article, I will explain why it is useful to exercise a little discipline if you want to speed up loading and performance on mobile devices. <br><br>  <b>tl; dr: less code = less parsing / compilation + less transfer + less unpacking</b> <br><br><h2>  Network </h2><br>  When most developers think about the cost of javascript, they reflect on the download and execution times.  Sending more bytes of javascript takes longer, the thinner the channel with the user. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/705/e6f/e72/705e6fe723300fa36490e80709edb010.png"><br><br>  This can be a problem even in the countries of the first world, since the <b>effective type of network connection</b> for a user is not necessarily 3G, 4G or WiFi.  You can sit in a cafe with WiFi, but be connected to a hotspot via a cellular connection at a speed of 2G. <br><a name="habracut"></a><br>  The cost of networking JavaScript can be reduced in the following ways: <br><br><ul><li>  <b>Send only the code that the user needs</b> .  This will help the separation of the code into parts. </li><li>  <b><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer">Minification</a></b> (Uglify for ES5, <a href="https://github.com/babel/minify">babel-minify</a> or <a href="https://www.npmjs.com/package/uglify-es">uglify-es</a> for ES2015). </li><li>  <b><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/optimize-encoding-and-transfer">Maximum compression</a></b> (using <a href="https://www.smashingmagazine.com/2016/10/next-generation-server-compression-with-brotli/">Brotli</a> ~ <a href="https://twitter.com/paulcalvano/status/924660429846208514">q11</a> , Zopfli or gzip).  Brotli is superior to gzip in compression.  At CertSimple, he reduced the JS code by <a href="https://speakerdeck.com/addyosmani/the-browser-hackers-guide-to-instant-loading%3Fslide%3D30">17%</a> , and LinkedIn reduced the load time by <a href="https://engineering.linkedin.com/blog/2017/05/boosting-site-speed-using-brotli-compression">4%</a> . </li><li>  <b>Delete unused code</b> .  It can be revealed by the <a href="https://developers.google.com/web/updates/2017/04/devtools-release-notes">code coverage tool in DevTools</a> .  For removing unnecessary code, see <a href="https://webpack.js.org/guides/tree-shaking/">tree-shaking</a> , advanced <a href="https://developers.google.com/closure/compiler/">Closure Compiler</a> optimizations, and corresponding library plugins, such as <a href="https://github.com/lodash/babel-plugin-lodash">lodash-babel-plugin</a> or Webpack <a href="https://iamakulov.com/notes/webpack-front-end-size-caching/">ContextReplacementPlugin</a> for libraries like Moment.js.  Use babel-preset-env and browserlist to avoid transpiling in modern browsers.  Advanced developers can do a careful <a href="https://github.com/webpack-contrib/webpack-bundle-analyzer">analysis of the Webpack bundles</a> to remove unnecessary dependencies. </li><li>  <b><a href="http-caching">Caching</a> to reduce network traffic</b> .  Determine the optimal lifetime of the scripts (max-age) and provide validation tokens (ETag) in order not to transfer unchanged bytes.  Caching service workers can make your application resilient in front of network failures and provide the desired access to features like <a href="https://v8project.blogspot.com/2015/07/code-caching.html">caching code in V8</a> .  Learn about long-term caching by <a href="https://webpack.js.org/guides/caching/">hashing file names</a> . </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/0d7/933/cf3/0d7933cf39b3f2b312c6e006c9664190.png"><br>  <i><font color="gray">Top tips on how to reduce the amount of javascript code sent to users</font></i> <br><br><h2>  Parsing / compiling </h2><br>  After downloading the JavaScript code, one of the <b>main</b> expenses becomes the time of <b>parsing / compiling</b> this code in the JS engine.  In Chrome DevTools, parsing and compiling is part of the yellow Scripting time in the Performance panel. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ea/01e/ffd/7ea01effd188c93582b511dcefcf8b0f.png"><br><br>  On the Bottom-Up and Call Tree tabs you can see the exact time of parsing and compilation: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/897/751/780/897751780cc7c9d282d09c30f087e08f.png"><br>  <i><font color="gray">Panel Chrome DevTools Performance&gt; Bottom-Up.</font></i>  <i><font color="gray">When activated, the V8 Runtime Call Stats feature shows the time spent in the parsing and compiling steps.</font></i> <br><br>  But why is this important? <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5ea/608/017/5ea6080174b7cb7b6b352262c539de32.png"><br><br>  <b>The high consumption of time for parsing and compiling code can greatly increase the delay in user interaction with the site.</b>  <b>The more javascript code you submit, the longer the parsing and compilation phase will continue before the site begins to respond to user input.</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/455/3d9/a6e/4553d9a6e44e226264522ec96b29ac2d.png"><br><br><blockquote>  <i>If you compare by bytes, <b>JavaScript processing is more expensive for a browser than an image or a font of equivalent size</b> - Tom Dale</i> </blockquote><br>  If we compare it with JavaScript, then images of the same size also have numerous processing costs (they also need to be decoded!), But on the equipment of an average mobile phone, it‚Äôs rather JS that will negatively affect the interactivity of the page. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd1/151/aa5/fd1151aa5329beb464400ba127ba25bf.png"><br>  <i><font color="gray">The javascript and image bytes consume resources differently.</font></i>  <i><font color="gray">Images usually do not block the main stream and do not freeze the interface during decoding and rasterization.</font></i>  <i><font color="gray">But JS can affect interactivity due to parsing, compiling and code execution.</font></i> <br><br>  When we talk about slow parsing and compilation, context is important - here we are talking about mid-range mobile phones.  <b>Ordinary users may have phones with slower CPUs and GPUs, without an L2 / L3 cache, and even with limited memory.</b> <br><br><blockquote>  <i>Network capabilities and device capabilities do not always match.</i>  <i>A user on an excellent fiber-optic channel is not necessarily an excellent CPU to parse and evaluate the JavaScript that comes to his device.</i>  <i>The reverse is also true ... terrible network connection, but exceptionally fast processor.</i>  <i>- Christopher Baxter, LinkedIn</i> </blockquote><br>  In the article ‚Äú <a href="https://habrahabr.ru/company/mailru/blog/321748/">JavaScript Startup Performance</a> ‚Äù, I noted the parsing time of approximately 1 megabyte of unpacked (simple) JavaScript code on weak and powerful hardware.  Between the fastest smartphones and the average difference is 2‚Äì5 times the parsing / compilation time. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f6a/804/0bc/f6a8040bca20bcf21cc4bafd348078db.png"><br>  <i><font color="gray"><b>The parsing time of a 1MB JavaScript bundle (~ 250 KB in gzip)</b> on PCs and mobile devices of different classes.</font></i>  <i><font color="gray">When taking into account the cost of parsing, you need to add the cost of <b>unpacking a</b> file of approximately 250 KB in size to a JS code of approximately 1 MB</font></i> <br><br>  What about real sites like CNN.com? <br><br>  <b>A modern iPhone 8 spends about 4 seconds on parsing / compiling CNN scripts, compared to ~ 13 seconds on an average phone (Moto G4)</b> .  This can significantly affect how much time passes before the user gets the opportunity to interact with the site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/09a/cd3/620/09acd3620b3be7dd0d93b29527d6cc53.png"><br>  <i><font color="gray">The time of parsing on the Apple A11 Bionic chip compared to Snapdragon 617 in a regular Android smartphone</font></i> <br><br>  This shows the importance of testing on average hardware (like Moto G4), and not just on the phone that is in your pocket.  But context is important: <b>optimize for the devices and network conditions that <i>your</i> users have</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1a/2da/46f/a1a2da46f1236f53b4bcb8a208bdabab.png"><br><br>  Analytics tools can show which <a href="https://crossbrowsertesting.com/blog/development/use-google-analytics-find-devices-customers-use/">mobile devices of a class</a> to real users of your site.  This makes it possible to understand the real limitations of the CPU / GPU. <br><br>  <b>Do we really ship too much javascript?</b>  <b>Well maybe :)</b> <br><br>  HTTP Archive (top about 500 thousand sites) shows the <a href="httparchive.org/reports/state-of-javascript">use of JavaScript on mobile sites</a> .  And we see that 50% of sites need more than 14 seconds before they become interactive.  These sites spend up to four seconds only to parse and compile JS. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8aa/6ea/17e/8aa6ea17eabb8923125abcc316497853.png"><br><br>  If we also take into account the time needed to load and process JS and other resources, then it is not surprising that users leave the page without waiting for it to be ‚Äúdefrosted‚Äù.  There is definitely room for improvement. <br><br>  <b>If you remove non-critical JavaScript from the pages, then you reduce download time, CPU-intensive parsing / compilation, and potential memory overflow.</b>  <b>It will also help your pages get online more quickly.</b> <br><br><h2>  lead time </h2><br>  Not only parsing and compilation have their price.  <b>Execution of JavaScript</b> (execution of the code after parsing / compiling) is one of the operations that is performed in the main thread.  Long execution times also affect how soon the user will be able to interact with your site. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0f4/06b/053/0f406b053a59d5d1531f00257f695bf1.png"><br><br><blockquote>  <i>If the script runs longer than 50 ms, the time before the start of interaction with the site is increased by the entire time it takes to download, compile and execute JS - Alex Russell</i> </blockquote><br>  To cope with this, it makes sense to transfer JavaScript to <b>small fragments</b> that will not capture the main stream for a long time.  Learn how you can optimize script execution time. <br><br><h2>  Ways to speed up JavaScript delivery </h2><br>  If the goal is to reduce the time of parsing / compiling JavaScript and passing over the network, there are some useful techniques, such as route-based chunking and <a href="https://developers.google.com/web/fundamentals/performance/prpl-pattern/">PRPL</a> . <br><br>  PRPL is a technique for optimizing interactivity by aggressively splitting code into fragments and caching: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/495/97e/743/49597e743fb65a8eb4d79a08a2c806eb.png"><br><br>  Let's see what effect you can get. <br><br>  We analyzed the load times of popular mobile sites and progressive web applications using the V8 Runtime Call Stats.  As you can see, the parsing time (shown in orange) is a significant part of the time costs: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/775/577/9e1/7755779e11155be35dce8538f55a579b.png"><br><br>  The <a href="https://wego.com/">Wego</a> site uses PRPL, tries to keep a low parsing time on the routes and goes on interactivity very quickly.  Many of the other sites listed use split code and performance budgets, trying to reduce JS costs. <br><br><h2>  Other costs </h2><br>  JavaScript can affect performance in many ways: <br><br><ul><li>  Memory.  Pages may jerk or slow down frequently due to garbage collection.  When a browser requires memory, JS execution is suspended, so that frequent browser garbage collection can stop execution more often than desired.  Avoid memory leaks and frequent pauses of garbage collection so that pages move smoothly. </li><li> Long-term execution of JavaScript blocks the main thread, which is why the page is frozen.  This problem can be dealt with by breaking the code into parts using <code>requestAnimationFrame()</code> <code>requestIdleCallback()</code> . </li></ul><br><h4>  Progressive bootstrapping </h4><br>  Many sites optimize the visibility of content through interactivity.  To quickly start rendering with large JavaScript bundles, developers sometimes use server-side rendering;  then "update" the image when JavaScript is finally processed. <br><br>  Be careful - everything has its price.  You 1) essentially send a larger HTML response that may affect interactivity;  2) you can leave the user in a plausible "sinister valley", where in fact half of the interactivity is not available until the processing of JavaScript is completed. <br><br>  Progressive bootstrapping may be a better option than this approach.  Submit a minimally functional page (composed of only the most necessary HTML / JS / CSS for this pass).  When other resources arrive, the application will lazily load them and unlock additional functionality. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7e5/2b2/84b/7e52b284b4985ba77a2c5a200eb2a2bf.png"><br>  <i><font color="gray"><a href="https://twitter.com/aerotwist/status/729712502943174657">Progressive Bootstrapping</a> , illustration by Paul Lewis</font></i> <br><br>  <b>Downloading the code according to what is displayed on the screen is a real grail.</b>  <b>PRPL and progressive bootstrapping are techniques that help get closer to it.</b> <br><br><h2>  findings </h2><br>  <b>Transmit size is critical for thin channels.</b>  <b>The parsing time is important for devices with a weak CPU.</b>  <b>We need to strive for minimum performance.</b> <br><br>  Different companies have achieved some success by introducing tight performance budgets at the time of transferring, parsing, and compiling JavaScript.  See Alex Russell‚Äôs budget guide for mobile sites and apps, ‚Äú <a href="https://infrequently.org/2017/10/can-you-afford-it-real-world-web-performance-budgets/">Can we afford it ?: Performance budgets in the real world</a> .‚Äù <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c5/052/c00/2c5052c000eb73223c66a81457e25482.png"><br>  <i><font color="gray">It is useful to consider what space JS leaves in our architectural decisions for application logic.</font></i> <br><br>  If you are creating a site for mobile devices, try using specific hardware, minimize JavaScript parsing / compilation time, and implement a performance budget so that your developers keep track of their JavaScript costs. <br><br><h2>  Additionally </h2><br><iframe width="560" height="315" src="https://www.youtube.com/embed/_srJ7eHS3IM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i><font color="gray">My performance on Chrome Dev Summit 2017 is about the price of javascript.</font></i>  <i><font color="gray">Later, performance is analyzed using real sites like Pinterest and Tinder.</font></i> </div><p>Source: <a href="https://habr.com/ru/post/343562/">https://habr.com/ru/post/343562/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343552/index.html">Anatomy of calltracking: how to analyze calls to the company</a></li>
<li><a href="../343554/index.html">An example of the implementation of an automated process for backing up and restoring databases with built-in tools</a></li>
<li><a href="../343556/index.html">In-Memory Computing Summit 2017 San Francisco</a></li>
<li><a href="../343558/index.html">Scala at EPAM: training and projects</a></li>
<li><a href="../343560/index.html">Zimbra with certificate signed by Active Directory</a></li>
<li><a href="../343566/index.html">Cost of operations in CPU cycles</a></li>
<li><a href="../343568/index.html">How JS Works: Features and Scope of WebAssembly</a></li>
<li><a href="../343570/index.html">As programmers are not allowed to do anything else</a></li>
<li><a href="../343572/index.html">Docker, as an indicator of maturity</a></li>
<li><a href="../343574/index.html">SOC for beginners. Chapter 3. Using external sources of threat data for the Security Operation Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>