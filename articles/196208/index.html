<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mobile app development with Dropbox Datastore API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dropbox has three APIs for mobile apps: 


- Drop-ins are two simple UI components: Chooser to select a file from the user's Dropbox directories and S...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mobile app development with Dropbox Datastore API</h1><div class="post__text post__text-html js-mediator-article">  Dropbox has three APIs for mobile apps: <br><ul><li>  <a href="https://www.dropbox.com/developers/dropins">Drop-ins are</a> two simple UI components: Chooser to select a file from the user's Dropbox directories and Saver to save files to Dropbox.  No configuration, authentication.  Call the component, in return receive a link to the file.  Under iOS and Android, only Chooser is available, Saver will appear later. </li><li>  <a href="https://www.dropbox.com/developers/core">Core API is the</a> lowest level API.  It allows you to read and write files and directories on the Dropbox server.  Authors call API - RESTish.  That is, it uses HTTP, readable URLs, JSON responses, but does not follow the REST principles thoroughly.  Authentication uses OAuth 2.0. </li><li>  <a href="https://www.dropbox.com/developers/sync">Sync API</a> runs on top of the Core API and looks like access to the file system.  Directories and files are accessible even without access to the Internet and are synchronized automatically with Dropbox servers.  The most convenient API for developing mobile applications. </li></ul><br>  The Sync API is good, but according to statistics, many mobile developers use it to store structured data.  Serialize them in JSON, save to files, synchronize with the cloud.  This works as long as there is no simultaneous change of data from different devices.  Even if you change non-conflicting data, this will be a conflict at the file level and Dropbox will not be able to solve it. <br><br>  Therefore, we have released the <a href="https://www.dropbox.com/developers/datastore">Datastore API</a> .  It does not synchronize files, but data, is somewhat similar to a remote NoSQL database with caching. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      For example, you have a SQLite database.  It syncs with the cloud using the Dropbox Core API.  If you change the values ‚Äã‚Äãin different rows of the table on different devices, we get a file synchronization conflict.  Although changes at the data level do not conflict with each other.  The datastore API solves this problem. <br><br><h2>  Data model </h2><br>  The DataStore uses not a relational data model, but something similar to NoSQL.  Each Dropbox user has a repository, the repository contains tables.  Tables are divided into records. Each record has fields with values.  The records in the table can have a different set of fields, that is, in fact, this is not a table, there are no rows and columns, and there is no rigid structure. <br><br><img src="https://habrastorage.org/storage3/386/95a/2a0/38695a2a062d1c7d6cda9c8cc81f85b1.png"><br><br><h2>  Synchronization </h2><br>  The magic begins after calling the sync method.  In iOS and Android, sync is called after the completion of a meaningful sequence of data changes.  Can be compared with a commit in version control systems. <br><br>  In the background, Dropbox constantly receives data changes from the server.  When you call sync, your local changes are merged with server edits and sent back.  Server changes are applied to the local copy only after calling Sync. <br><br><h2>  Conflict resolution </h2><br>  We paid a lot of attention to conflict resolution.  A conflict occurs when two devices simultaneously update the same storage.  For example, two devices lose access to the Internet.  Revision 1 of the repository is saved locally.  Both devices change data in storage.  When the Internet and the synchronization of devices with the server, we get two different versions of revision 2, this is a conflict. <br><br>  If changes to a conflict revision affect different entries, they are automatically merged.  If the changes affect the same entry, the conflict resolution rules apply.  Rules are set at the table or field level. <br><br>  When applying these rules to the server, you will receive a synchronization error with details about the changes and you can programmatically combine the data and send it to the server again. <br><br>  By default, the ‚Äúserver wins‚Äù rule works.  If an application tries to send a field change to a server that has already been changed, the server version remains, the field value coming from the device is thrown.  For example, I do not have access to the network and on my smartphone I change Masha's phone number to 911. Meanwhile, my secretary, with Internet access, changes Masha's number to 112. When my smartphone goes online, my number changes will be discarded.  Masha's number will be 112. <br><br>  You can change the default rule to ‚Äúclient wins‚Äù, all server changes will be discarded and Masha will be 911. Which is quite strange, therefore, the server ‚Äúwins‚Äù the default rule. <br><br>  For numerical values, there are additionally the rules of "minimum", "maximum" and "amount".  That is, in a conflict situation, a minimum or maximum value will be selected.  ‚ÄúMaximum‚Äù is convenient for values ‚Äã‚Äãthat should not be decremented, for example, incremental counters. <br><br>  In the "sum" rule, the result of resolving a conflict is the sum of the change in value.  It sounds weird, but it works, for example, for a button click count in an application.  The user simultaneously presses it from two different devices, the server summarizes the result.  Two devices are synchronized with the server, there were 3 in the field. One device changed it to 4, the other to 5. The field synchronization will result in 6. <br><br>  To resolve conflicts in lists, we use Operational Transformation.  It is also used in Google Wave and Google Docs. <br><br>  For example, we have an ACZ list.  On one device, insert B into the second position and simultaneously insert Z from another device into the third.  The result should be ABCXZ, not ABXCZ.  It sounds simple, but the implementation required the use of tricky algorithms. <br><br>  Guido Van Rossum (the creator of the Python language, now works in Dropbox) is engaged in designing the storage and resolving conflicts.  He wrote a <a href="https://www.dropbox.com/developers/blog/48/how-the-datastore-api-handles-conflicts-part-1-basics-of-offline-conflict-handling">detailed technical post</a> about how this happens. <br><br><h2>  Dropbox API in Xamarin applications </h2><br>  The official <a href="http://components.xamarin.com/view/dropboxsync/">Dropbox API component</a> is in the Xamarin component store. <br><br>  A detailed step-by-step application development example with the Datastore API <a href="http://blog.xamarin.com/a-quick-look-at-dropbox%25E2%2580%2599s-new-datastore-api%25E2%2580%25A6-in-c-sharp/">on the Xamarin blog</a> . <br><br>  <b>approx.</b>  <b>per.</b>  In my opinion, the new API from dropbox is very useful.  When developing <a href="http://touchin.ru/portfolio/coinkeeper/%3Futm_campaign%3D79">Coin Keeper,</a> we spent a lot of time on inventing and implementing synchronization of the application with the server.  Then two more months corrected errors.  With the Datastore API, everything would be much easier.  On the other hand, all advantages are crossed out by the requirement of the Dropbox account from the user. <br><br>  Would you use the Datastore API in your application? <br><br><hr>  Subscribe to our <a href="http://habrahabr.ru/company/touchinstinct/">blog</a> .  Every Thursday, useful articles about mobile development, marketing and business of mobile studio. </div><p>Source: <a href="https://habr.com/ru/post/196208/">https://habr.com/ru/post/196208/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196194/index.html">Google is trying to sell software like chocolate bars</a></li>
<li><a href="../196196/index.html">(Almost) all the reports of the Joker 2013 conference</a></li>
<li><a href="../196198/index.html">Report from Silicon Valley. The Silicon Valley Open Doors conference is not a window, but a door to Silicon Valley. Part 1: entrepreneurs, investors, insider and trends</a></li>
<li><a href="../196204/index.html">Responsive design: now it's not about screen size</a></li>
<li><a href="../196206/index.html">01 Collector: Friday Content</a></li>
<li><a href="../196212/index.html">SDK from Yandex.Disk</a></li>
<li><a href="../196214/index.html">Fell off Github.com</a></li>
<li><a href="../196218/index.html">We monitor everything: the expansion of Windows and Linux agents using scripts</a></li>
<li><a href="../196220/index.html">How to achieve a balance between work and life</a></li>
<li><a href="../196222/index.html">Marine robot Scout sailed independently over 1600 kilometers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>