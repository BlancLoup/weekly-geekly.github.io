<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Secrets of testing Ethernet channels</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon dear friends. For several years she worked as a sysadmin in a certain number of corporate and home providers of St. Petersburg and to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Secrets of testing Ethernet channels</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon dear friends.  For several years she worked as a sysadmin in a certain number of corporate and home providers of St. Petersburg and to this day I often encounter the fact that when buying equipment operators look more at the price and description of functions than at real indicators, suppliers usually do not write anything about them, as a result which, instead of a single switch, has to be installed again and again, and the quality of the connection may not be better.  About the existence of the concept of SLA (Service Level Agreement), too, not all operators are aware of, for this reason, I collected reliable information on testing networks and equipment, and is ready to provide it to your attention. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dc1/a29/a87/dc1a29a87c91a8e456d24ee1b5a0d7e8.jpg"><br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Ethernet need to be tested!</b> <br><br>  Are there precise definitions and recipes of how to conduct bandwidth tests and the quality of the communication provided?  I found a few articles, of which only one became clear, today in Russia the networks are tested using methods designed for other purposes, and this cannot help but surprise, because communication services in large cities of our country are quite developed, there is a high-speed channel in literally every apartment, and some operators already provide gigabit channels to home customers, but not everyone knows about the methods of testing the quality of telematic services provided. <br><br>  <b>What specifically and why you need to test?</b> <br><br>  Consider how often a cat is bought in a bag today: <br><ul><li>  Your leased or leased communication channels; </li><li>  Delivery-acceptance of communication channels, built by you or for you; </li><li>  Communication services provided, especially in the presence of a penalty in the contract; </li><li>  The equipment you want to buy, but they want to sell it to you, and tell you that it is super-cool and inexpensive. </li></ul><br><br>  These are a tiny handful of examples of what customers and telecom operators are currently risking. <br><br>  <b>Software utilities for testing the "Internet"</b> <br><br>  Full channel testing cannot be echo requests, ping and mtr will never tell what channel bandwidth is.  Iperf and other software utilities will not be able to tell about this, because when using the network at the same time and testing software utilities, the amount of user data currently in the channel is not known, as well as a number of inaccuracies due to the presence of packet headers depending on From the frame size, the headers remain standard length, and the body with the data increases or decreases, the software utilities determine the channel capacity without taking into account the size of the headers  The size of the packages brings a certain confusion to such testing. <br><br>  You will not be able to assess the quality of the rented vlan, looking at the download schedule of the channel or downloading large files from the Internet.  Why speedtest.net is not proof of the speed of the channel provided probably should not be clarified?  After all, it is immediately clear that it is unknown which channels and through which networks they go to the speedtest servers, as well as it‚Äôs not known how much the channel is loaded during the test, and many other test parameters, and if there are so many unknowns in the test, then its results cannot be accurate at all.  The result of speedtest is rather a certain delta from certain indicators, and not real numbers. <br><br>  The quality of communication services provided is a combination of many parameters, and using the right tools you can quickly and efficiently obtain accurate data about the service provided.  It is important not only to obtain accurate data, but also to have confidence that the data can be used to prove one‚Äôs case, for example, in court. <br><br>  <b>Ethernet techniques and analyzers</b> <br><br>  To date, there are two main methods of testing bandwidth: the old - <a href="https://www.ietf.org/rfc/rfc2544.txt">RFC-2544</a> and a little younger: <a href="https://www.itu.int/rec/T-REC-Y.1564/">Y.1564</a> .  The ITU-T Y.1564 technique is more relevant today, it has descriptions for testing modern, high-speed communication channels with modern concepts of SLA (Service Layer Agreement). <br><br>  Since the quality of the ethernet channel is a combination of many factors, therefore, proper testing should cover all these aggregates to the maximum.  When testing, it is necessary to take into account many aspects and it would be useful to have advanced features, such as <a href="http://wiki.metrotek.spb.ru/wiki/BERT_%25D0%25B8_%25D0%25BF%25D0%25B0%25D0%25BA%25D0%25B5%25D1%2582%25D0%25BD%25D1%258B%25D0%25B5_%25D1%2581%25D0%25B5%25D1%2582%25D0%25B8">BER Test</a> , packet jitter, support for MPLS, QoS, load testing of application layer protocols (http, ftp, etc ...). <br><br>  To test channels from 1G to 10G and higher, it is quite difficult to do load tests using non-specialized iron, often processors are not able to generate a sufficient amount of traffic, unlike specialized testers-analyzers.  Such devices can be put in a rack, cabinet, even in a box in the attic and run the tests remotely, and you can do automatic measurements at different time intervals.  Any portable analyzer devices will not deteriorate in the harsh conditions of sewage, as they pass through severe tests for strength. <br><br>  <b>Delivery acceptance of communication channels.</b> <br><br>  For delivery or acceptance of built lines and highways, to work at high standards, it is best to have a tester-analyzer in the standard arsenal, although on the Internet you can find companies specializing in field testing.  For some reason, it is considered that buying a tester-analyzer is very expensive. <br><br>  <b>Learn more about the RFC-2544 testing methodology and how it works.</b> <br><br>  <a href="https://www.ietf.org/rfc/rfc2544.txt">RFC-2544</a> recommends measuring different frame sizes: for Ethernet traffic, frames with sizes 64, 128, 256, 512, 1024, 1280, 1518 octets, for each frame size a separate start of serial testing is necessary.  If necessary, you can conduct testing for the Jumbo frame (frames of 4096 or 9000 octets).  Different frame sizes are needed to simulate different types of traffic. <br><br>  Initially, the technique was developed directly for testing network devices, for example, when developing switches, but the set of functions was adapted to measure the quality of channels.  The methodology was approved in 1999 by <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2589%25D0%25B5%25D1%2581%25D1%2582%25D0%25B2%25D0%25BE_%25D0%2598%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BD%25D0%25B5%25D1%2582%25D0%25B0">ISOC</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d09/c75/0b4/d09c750b427114798be68d99e22cf275.png" alt="image"><br><br>  The technique offers a set of 6 tests, I will describe in more detail how the tests are conducted, for clarity of perception: <br><br>  <b>Determining the bandwidth of the device under test (Throughput)</b> <br><br>  Test description: a small amount of packets, specially formed by the tester, is sent, at a certain speed, to the input port of the device, to the output port, the quantity is counted, if more than received is transmitted - the speed decreases and the test starts again. <br><br>  <b>Determination of frame delay time (Latency)</b> <br><br>  Test description: after determining the throughput (Throughput), for each frame size, at the corresponding maximum speed, a stream of packets is sent to a specific address.  The stream must have a minimum duration of 120 seconds.  A label is inserted into 1 packet after 60 seconds.  The label format is determined by the hardware manufacturer.  On the transmitting side, the time by which the packet with the tag was completely sent is recorded.  At the receiving side, a label is determined and the time of full reception of a packet with a label is recorded.  Delay (latency) - is the difference between the time of sending and the time of receipt.  This test, according to the method, must be repeated at least 20 times.  Based on the results of 20 measurements, the average delay is calculated.  The test should be carried out by sending the entire test stream to one address and sending each frame to a new address. <br><br>  <b>Frame Loss Determination</b> <br><br>  Test description: A certain number of frames are sent to the input port of the device at a certain speed and the number of packets received from the output port of the device is counted.  The frame loss rate is calculated as follows: <br><br>  <i>((number of frames transmitted - number of frames received) * 100) / number of frames transmitted</i> <br><br>  The first dispatch occurs at the maximum possible speed, then the dispatch rate decreases with a maximum step of 10%; according to the method, reducing% step will give the most accurate results.  The speed reduction should be continued until the last two shipments will be without errors, namely, we will know the maximum data transfer rate at which the frame loss rate becomes equal to 0. <br><br>  <b>Testing the ability to handle back-to-back frames (Back-to-back frames)</b> <br><br>  Test description: the test is reduced to sending a certain number of frames with a minimum interframe delay to the input port of the device under test and counting frames from the output port of the device.  If the number of frames sent and received is equal, then the volume of frames sent is increased and the test is repeated, if the received packets are smaller than the number of frames sent, the frames are reduced and the test is repeated.  As a result, we should get the maximum number of packets sent and received without loss for each packet size, this will be the value of the back-to-back test.  According to the method, the duration of sending frames to the device port should not be less than two seconds, and the minimum number should be at least 50 times.  The final figure is the average result of 50 tests. <br><br>  <b>Recovery after overload (System recovery), applicable only for testing devices</b> <br><br>  Test description: a stream of frames is sent to the device input for at least 60 seconds at a speed of 110% relative to the measured throughput test.  If the throughput test showed perfect results, then the maximum speed of this connection is chosen.  At the time of the overload, the flow rate is halved, and the difference between the time taken to reduce the flow rate and the time when the last frame was lost is detected. <br><br>  <b>Recovery time of the device under test after a restart (Reset), applicable only for testing devices</b> <br><br>  Test description: a continuous stream of frames is sent to the device input at a speed determined by a throughput test with a minimum frame size.  The device is reset.  Recovery time after a reset is the difference between the time the last packet was received before the reset and the time it took the first packet after a reset.  Both hardware and software device reset types are tested. <br><br>  <b>What has changed with the fresh Y.1564 methodology?</b> <br><br>  New recommendations were reviewed and approved by <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D0%25B6%25D0%25B4%25D1%2583%25D0%25BD%25D0%25B0%25D1%2580%25D0%25BE%25D0%25B4%25D0%25BD%25D1%258B%25D0%25B9_%25D1%2581%25D0%25BE%25D1%258E%25D0%25B7_%25D1%258D%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2582%25D1%2580%25D0%25BE%25D1%2581%25D0%25B2%25D1%258F%25D0%25B7%25D0%25B8">ITU</a> in 2011.  RFC 2544 adds packet jitter (jitter) to the already stated recommendations, namely the ability to calculate the time difference when receiving a series of consecutive data packets belonging to the same stream, in an ideal world it should not exist, but there can be a sequence in problem networks broken, which may affect the speed of data processing.  RFC2544 allows you to check only at the maximum speed of the channel, which will not be packet loss, and it is usually higher than the speed of <a href="https://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B0%25D1%2580%25D0%25B0%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BE%25D1%2581%25D0%25B0_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25BF%25D1%2583%25D1%2581%25D0%25BA%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F">CIR (Committed Information Rate - guaranteed bandwidth)</a> .  Y.1564 was created specifically for <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BE%25D0%25B3%25D0%25BB%25D0%25B0%25D1%2588%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25BE%25D0%25B1_%25D1%2583%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BD%25D0%25B5_%25D1%2583%25D1%2581%25D0%25BB%25D1%2583%25D0%25B3">SLA</a> , assessment of the speed and quality of the provided channel according to key performance indicators (KPI) and allows you to check the provided channel in accordance with the contract. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f50/855/15f/f5085515fe3dcc5d484f82ff28973f5f.png" alt="image"><br>  Y.1564 allows you to check the guaranteed bandwidth, the maximum allowable, as well as give the load over the band, for example to check the settings of the shaper. <br><br>  There are several other differences between the methodologies, RFC2544 does not verify the correctness of the service setup (KPI matching is specified, and the speed limit is higher than the EIR (Excess Information Rate is the maximum non-guaranteed bandwidth), in order to avoid network overload).  In the original version of RFC2544, jitter is not measured.  According to RFC2544, each test is launched as a separate stream, which does not allow measuring the quality of the services provided in the aggregate and increases the testing time, another disadvantage of RFC2544 is that there is no profiling ability to check different types of traffic in one channel, for example, if QoS is used in the network , Y.1564 takes into account shortcomings and slightly expanded functionality. <br><br>  <b>Can you test only new channels or are you already working too?</b> <br><br>  You need to test and new channels, and the more old.  You can learn in advance about the emerging issues, without bringing customers to call for support.  Up-to-date testers-analyzers can be used for checking in a working network, checking channels with a speed of 10/100 / 1000Mbit, and 10/40 / 100G.  There is one BUT, it is very important to understand what and how you are doing, it is important that you do not inadvertently put a test channel. <br><br>  <b>Test Modes - In / Out of service.</b> <br><br>  Today, network testing is committed to complete systematization and continuous monitoring of channels, earlier versions of the RFC2544 methodology were created for testing channels / equipment in OutOfService mode, and were used mainly for equipment testing, but today all manufacturers of test devices are switching to newer testing standards that allow continuous monitoring of the network in InService mode.  Such testing allows you to check the speed of the bandwidth without disconnecting customers, which is important for telecom service providers. <br><br>  <b>Epilogue</b> <br><br>  Comrades, as one friend says, let's fight together with the ‚Äúco-hackers‚Äù and start testing what we build and what we exploit. <br><br>  <b>Used Books:</b> <br><br>  RFC 2544 methodology: https: //www.ietf.org/rfc/rfc2544.txt <br>  Method Y.1564: <a href="https://www.itu.int/rec/T-REC-Y.1564-201103-I/en">www.itu.int/rec/T-REC-Y.1564-201103-I/en</a> <br>  Andr√© article on the difference in methods: <a href="http://www.mrv.com/blog/why-rcf2544-not-sufficient-anymore">www.mrv.com/blog/why-rcf2544-not-sufficient-anymore</a> <br><br>  * Opinion of the company may not coincide with the opinion of the author ;-) </div><p>Source: <a href="https://habr.com/ru/post/264295/">https://habr.com/ru/post/264295/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264285/index.html">Data Science: the path to professionalism</a></li>
<li><a href="../264287/index.html">Two-factor authentication. New challenges</a></li>
<li><a href="../264289/index.html">Making the code cleaner: Refactoring the PCI driver for a NAND Denali controller</a></li>
<li><a href="../264291/index.html">Creating The Blacksmith: animation, camera effects, audio / video</a></li>
<li><a href="../264293/index.html">How we overcame USB data transfer</a></li>
<li><a href="../264297/index.html">Vim in full: Testing with xUnit</a></li>
<li><a href="../264299/index.html">We assemble our OpenWRT on a Tp-Link TL-WR741ND v.4.25 router with vlan, openvpn, provider rotation and blackjack</a></li>
<li><a href="../264301/index.html">Authorization / User Registration via Telegram</a></li>
<li><a href="../264303/index.html">Tutorial: assign a name to a process executed inside SOA SUITE</a></li>
<li><a href="../264311/index.html">Using Intel SSSE3 instruction set to speed up the implementation of the DNN algorithm in speech recognition tasks performed on mobile devices</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>