<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Currency exchange: fix the course for offline online. VTB24 experience</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Currency exchange is a boring and standard process through which, for one reason or another, everyone goes through. It seems technically there is alre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Currency exchange: fix the course for offline online. VTB24 experience</h1><div class="post__text post__text-html js-mediator-article">  Currency exchange is a boring and standard process through which, for one reason or another, everyone goes through.  It seems technically there is already nothing special to do.  VTB24 does not think so - we, as a bank, are aware of several unresolved currency exchange problems that can be encountered suddenly and at the most inappropriate moment.  And they decided with the help of IT.  What problems and how exactly decided - read under the cut. <br><br><img src="https://habrastorage.org/web/22b/9cf/593/22b9cf59332d4c5eaefbf14cdc382291.jpg"><br><a name="habracut"></a><br>  VTB24 invented a new currency exchange service - by fixing the exchange rate online, you can come to the office and exchange currency.  The course can be recorded on the bank's website or in a chat bot in Facebook messenger.  The service allows customers to fix the currency exchange rate for two working days, not counting the day of the order, and to make a cash currency exchange, even if the market rate changes. <br><br>  The service is available to customers with a card of any Russian bank, both for buying and selling cash in cash, with the exchange rate fixed online 24/7. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  How did we come up with this idea </h2><br>  There were several prerequisites for the formation of ideas and the creation of a new service. <br>  These are the most common questions during the holiday season of the population: ‚ÄúWhere can I change the currency?  Where is the best course?  How to change profitable? ‚Äù, As well as dynamic changes in exchange rates and the desire for greater certainty on the part of customers. <br><br>  More and more purchases are happening online, and therefore banking services are also changing, even for such a conservative market as the exchange of cash currency.  Innovations are, as usual, from the needs of customers. <br><br>  When a client has a need to exchange cash currency, he, as a rule, is sent to a bank exchange office, while no one is ever sure that there is a sufficient amount of currency at the bank‚Äôs cash office, especially if it is large.  At best, an advanced client will try to call the bank and clarify about the availability of currency.  At the same time, everyone understands that a bank can sell a currency to another customer who came earlier or give it to a depositor, which is often a priority for many banks.  In addition, at any time the bank can change the course - sometimes it happens 5-6 times a day.  All this creates discomfort to the consumer. <br><br>  Therefore, it was decided to implement the idea of ‚Äã‚Äãan online store, in which you can fix the rate in real time and at the same time exchange the cash currency. <br><br>  Thus, the new service solves two problems: <br><br><ol><li>  gives the customer the opportunity to fix the course online and come with the amount of the transaction for cash exchange later at a convenient time. </li><li>  guarantees the client the availability of the necessary amount of currency or rubles for an exchange at the bank‚Äôs cash desk. </li></ol><br>  Someone will say that it is possible to exchange currency in the Internet bank, but it must be taken into account that a transaction is made cashless there and the amount of coverage must be in advance on the account.  Many people prefer to deal with cash and do not limit the choice of a bank to those with an account and an Internet bank. <br><br>  We decided not only to implement the service on the site, but also to make it available through popular social networks - for example, a chat bot on <a href="http://m.me/vtb24exchange">Facebook</a> . <br><br>  VTB24 is one of the first banks to implement it in its branches, and for a client interaction with a well-known banking brand with state participation is convenient and reliable. <br><br>  Technically, the process looks like this.  A user visits obmen.vtb24.ru or a chat bot on <a href="http://m.me/vtb24exchange">Facebook</a> and sees an exchange rate that he can fix for 2 days. <br><br>  Next, he enters his data - last name, first name, if desired, patronymic and contact phone number - and necessarily an e-mail.  Chat bot saves these parameters for new orders - until the user asks him to delete them.  After entering the currency amount, the bot registers in the chat the period up to which the currency must be exchanged, and the amount (10% of the transaction amount) reserved in the client's account as a guarantee of exchange until the transaction - in case of refusal or delay, the bank holds it.  Similar reservations are made by travelers, booking hotels on the Internet or renting a car, while providing funds on the card as a security deposit. <br><br>  After confirming the order, the client goes to the payment page, enters the card details, and in case the reservation of funds is successful, will receive an order confirmation (number and parameters) on the next page.  Receipt of the order will be sent to the e-mail. <br><br><img src="https://habrastorage.org/web/086/7d6/ab5/0867d6ab525641c1a25ca272150dbfa0.png"><br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/f68/1e8/d38/f681e8d38de14efebc05f2b333468e0e.png"></div><br>  From the point of view of updating the rates, the bot and the site are connected with the front-office system of the bank, which gives real-time currency quotes (real-time mode - by ticks from the stock exchange, that is, once a second). <br><br><img src="https://habrastorage.org/web/1bf/648/4ec/1bf6484ec77b4a0e8c7f9d3adb365759.png"><br><br><h2>  How did we handle this? </h2><br>  For the development of the site and chatbot we attracted partners from EPAM and InspiredGames and <br>  asked them to comment on the technical features of the project. <br><br>  Word InspiredGames: <br><br>  ‚ÄúOur studio took on the task of selling the bot for all the main messengers to provide banking services in the field of foreign exchange operations.  It would seem - nothing complicated, almost an ordinary online store. <br><br>  But: <br><br><ul><li>  the bank gives very dynamic courses.  During business hours, they reflect real-time quotes on the stock exchange, at night (and the service, of course, round-the-clock), they are also correct.  The bank transmits these quotes to the bot's ‚Äúengine‚Äù using its unique service. <br><br></li><li>  reserve preparation and payment (more precisely, blocking of funds) via a bank card directly from the bot with the transition to only one web page of the payment system (of course, we are working on new payment options in instant messengers). </li></ul><br>  At the same time, the bot is an interface, but the functions that are usually associated with the back-end part are implemented (receiving the actual rates from the bank, the automated workplace for its authorized employees, mentioned above, ordering data, transactional actions with the payment system, reminders, audit ...). <br><br>  The task was successfully solved, the service is working, and we would like to talk about several approaches that we have applied.  Of course, we will be happy and verification of these approaches, and any opinion. <br><br>  So, first of all, there was a choice - whether to use any frameworks or constructors?  The Microsoft Bot Framework is great, but there is no connector to Viber and even more so to VKontakte.  Other designers (at least, those that we found) did not have the flexibility we needed.  Therefore, we decided to do everything ourselves.  As for the infrastructure solution, they thought it would be best to use our usual and familiar use of the RESTful Web API, respectively, IIS, and for convenience, MS SQL as a DBMS (with all views, access sharing, a couple of stored procedures and triggers). <br><br>  This is all clear.  But there are two things that for us were not obvious from the very beginning, and which we did not see in those bots with whom we became acquainted. <br><br>  First: modularity. <br><br>  The engine (‚Äúcore‚Äù) of the bot ‚Äúcommunicates‚Äù both with messengers and with other systems (the specialized part of the bank‚Äôs back-office, the payment card system) not directly, but through specialized modules - ‚Äúconnectors‚Äù.  In addition, the data service is separated.  So there is: <br><br><ul><li>  a set of connectors for instant messengers and other systems; </li><li>  core (about it below); </li><li>  data service; </li><li>  some other services (an example is a simple but important service of final confirmation of a transaction rate by a bank). </li></ul><br>  The interaction of the modules, by the way, is also through the REST API. <br><br>  When a messenger user ‚Äî no matter what ‚Äî receives a message, the corresponding connector sends it to the kernel, the kernel analyzes it, generates a response message (this also requires a data service, and often other services) and sends it back to this connector .  This allowed us to: <br><br><ul><li>  bring all the specifics and settings of working with different messengers to the level of connectors.  Viber, unlike Facebook Messenger, allows you to change the font and colors of the buttons in the keyboard?  Great, let's color them in accordance with the brand book right in the connector settings.  Does Facebook Messenger have a carousel?  Very well, we will configure the connector to it so that, in response to showing the branches, these sections would be represented by the carousel.  And the bot kernel ‚Äúto know‚Äù about these features is not necessary; </li><li>  if necessary, distribute the bot to other messengers, just by developing a new (new) connector and adding it to the pool, without touching anything else; </li><li>  -If you need to post connectors and other modules to different hosts. </li></ul><br>  The second: the concept of ‚Äútext-context-subtext‚Äù. <br><br>  In short, within this concept, the bot's response depends not only on the text (semiotically, geolocation, which the user transmits, also the text) the user's message, but also on the context (in what state _nach_ the user is in dialogue with the bot, " what the user is talking about now "), and, further, from the subtext (_story_ of dialogue, and not only this particular user, -" what was the conversation before) ". <br><br>  Probably, someone has already guessed that such a concept can be implemented in terms of the finite state machine Miles (text-context-&gt; new context-response) with infinite memory (subtext).  But if you do not go into details, the easiest way is to explain with examples. <br><br>  The user sends the bot message "order".  Text = "order", but not enough to know the text.  The kernel accesses the data service and gets the current context of this user.  (For reference, we now have just over 200 contexts, and they can be configured without programming). <br><br>  If the received context is ‚Äúa user sends a message to a bank employee‚Äù, then no subtext is needed, you just need to send a message to the bank, reply to the user that everything has been sent and will contact him after some time, and get into the new context ‚Äúmain menu‚Äù. <br><br>  If the received context is the ‚Äúmain menu‚Äù, then a subtext is also needed.  Namely, the kernel receives a subtext from the data service, consisting of a set of formal (as in a passport) surname, first name, middle name and email address of this user.  And now the answer of the bot depends on the subtext.  If such a subtext is non-empty (which means that the user has previously informed his bot), the bot will offer to use it (or change it if necessary) and place an order.  If such a subtext is empty, then the bot as a condition for placing an order will indicate the need to communicate this data.  And when the data is received, the necessary subtext appears, and the order can be made.  The following context - ‚Äúall user data is received, we continue the order‚Äù.  It is clear that with all this history is accumulating (which, in turn, will be used to obtain a new subtext). <br><br>  Great, but where is the NLP?  True, NLP (Natural Language Processing) is now a very fashionable abbreviation.  But just for now, even here, on Habrahabr, sometimes natural language processing is confused with neuro-linguistic programming.  And, like NLP - ‚Äúprogramming‚Äù, NLP - Russian processing now does not work as well as we would like.  In addition, there is another subtlety - in our opinion (and in the opinion of other experts), the user does not want to communicate with the bot as a person.  He understands that this is a program, and wants to get a UI as with a program - buttons, colors, pictures ... <br><br>  But if you have a lemon, then you can make lemonade out of it.  That is why we: <br>  - preferred to make a ‚Äúteam‚Äù (and not pure chat) bot; <br>  - we use the NLP service as a module (service for the kernel, as described above), which allows us, along with the context and subtext, to sort through the text what the user wants.  This module (depending on the context!) Returns us an array of objects that are analyzed by the kernel.  A simple example is if the context is ‚Äúplacing an order at the stage of selecting the main exchange parameters‚Äù, then this text will generate an array for the text ‚Äú$ 500‚Äù: <br><br><pre><code class="hljs json">{    <span class="hljs-attr"><span class="hljs-attr">"deal_candidates"</span></span>:    [ { <span class="hljs-attr"><span class="hljs-attr">"direction"</span></span>: <span class="hljs-string"><span class="hljs-string">"buy"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"amount"</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ISOCode"</span></span>: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>}, { <span class="hljs-attr"><span class="hljs-attr">"direction"</span></span>: <span class="hljs-string"><span class="hljs-string">"sell"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"amount"</span></span>:<span class="hljs-number"><span class="hljs-number">500</span></span>, <span class="hljs-attr"><span class="hljs-attr">"ISOCode"</span></span>: <span class="hljs-string"><span class="hljs-string">"USD"</span></span>} ] }</code> </pre> <br>  And already on this array, the bot's core will ask "choose what you want." <br><br>  The result of our experience: <br><br><ul><li>  convenient transaction bots for financial services can and should be done; </li><li>  There are proven approaches that allow these bots (and, accordingly, services) to be created quickly, efficiently and, most importantly, scalable and replicable. ‚Äù </li></ul><br>  Why the site was chosen not only for the site, but also for the chat bot: <br><br><ul><li>  Messengers use a very large number of users, there is no need to separately search and install a specialized mobile application, simply add the bot to your contact list and start a dialogue with it. </li><li>  Operations in the messenger - this is work in a familiar interface - you do not need to retrain or look for the necessary functions, while you have easy access to financial transactions. </li><li>  By launching another bot, the bank takes into account the growing interest from customers in new channels of communication. </li></ul><br>  VTB24 plans to release chat bots in all available instant messengers in the future (we will add VibER and Vkontakte, and we also hope to wait for the opening of the WhatsApp API). <br><br>  Also, despite all the difficulties, we will continue to delve into the topic of NLP for more convenient user interaction.  In the personal account on the bank site, the chat bot is already working, with which you can chat and get advice and help from it.  The results of the work and training of this bot will be implemented in the conversion chat bots in instant messengers. <br><br>  We also plan to increase the range of financial services offered by chat bots, not only related to foreign exchange transactions. <br><br>  Fixing an offline course online is a new important channel for providing services to the public. <br><br>  This is a real innovative service, another small step in the digitalization of banking services.  The new service allows you to exchange cash currency "here and now."  At the same time, the bank is getting closer to the consumers of the mass segment: it is not necessary to be a VTB24 customer; in order to use the service, it is enough to have a card of any Russian bank. <br><br>  For VTB24, this is also a great opportunity to play and test new technologies in order to determine the vector of further development. </div><p>Source: <a href="https://habr.com/ru/post/333724/">https://habr.com/ru/post/333724/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../333712/index.html">What's new in Swift 4.0</a></li>
<li><a href="../333714/index.html">We do applications with search on Go</a></li>
<li><a href="../333716/index.html">Creating Angular 2+ components with the ability to switch themes</a></li>
<li><a href="../333718/index.html">Creating a GLSL smoke shader</a></li>
<li><a href="../333722/index.html">Current activity around MIPSfpga and not only</a></li>
<li><a href="../333728/index.html">Wolfram Summer School 2017: the story of the participant</a></li>
<li><a href="../333730/index.html">Step-by-step manual how to bring in equipment on which there is no notification of FSB</a></li>
<li><a href="../333732/index.html">IT Infrastructure Audit - How to Be a Newbie</a></li>
<li><a href="../333734/index.html">The selected UI framework is a mischief. Architectural Requirements - Profit</a></li>
<li><a href="../333736/index.html">How to move from KLADR to FIAS and do not break anything</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>