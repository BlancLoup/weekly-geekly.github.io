<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home Raspberry shooting gallery</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr. 
 I love small arms and shooting. However, at home it is a bad hobby. No, well, you can certainly buy trauma and ridge the apartment, but I t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home Raspberry shooting gallery</h1><div class="post__text post__text-html js-mediator-article">  Hi Habr. <br>  I love small arms and shooting.  However, at home it is a bad hobby.  No, well, you can certainly buy trauma and ridge the apartment, but I think the home will not appreciate it.  Not wanting to put up with this, I decided to realize my own, moderately safe home shooting range.  If interested - welcome under cat. <br><br><img src="https://habrastorage.org/files/0d8/85f/50e/0d885f50e06846ffb1dd335e6bb87d9c.jpg"><br><a name="habracut"></a><br>  Ideas on how to implement this have been in your head for a long time.  Here are some rejected: <br>  - phototransistor pistol + monitor screen.  Highlighting half / quarter / one eighth /, etc.  screen, check the response from the phototransistor and iteratively specify the part of the screen to which the gun is directed.  The idea was rejected because of the low frequency of updating monitors and their inertia. <br>  - pistol with phototransistor + screen of LED arrays.  Already better, you can update the image on the diode array with a sufficient frequency.  I even started soldering diode arrays, but I changed my mind in time. <br>  - a pistol with a camera, several laser LEDs, forming marks on the wall, on which the camera determines its position.  In principle, the idea was not bad.  However, having estimated how the gun with a webcam bolted to it will look, it also refused it. <br>  Well, the final idea - a static camera, looking at the wall and a gun with a laser.  The idea is, the case for implementation. <br>  Bought the first child pistol (Desert Eagle caliber 50).  He threw out the insides, filed a file and set in it a laser diode, a button on the trigger and arduinina nano.  No, you can of course put a capacitor in place of arduinin, so that he would switch the button from the power source to the diode and back, but this is not a flexible enough approach.  Laser diode glued to cold welding.  While it froze, carefully adjusted the included diode, combining it with the aiming bar. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7d7/fbc/cad/7d7fbccad53c4253af94300f5d5f2377.jpg"></div></div><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d7e/566/289/d7e566289563452f8939c8e0a46cf831.jpg"></div></div><br>  Wrote the simplest sketch: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> setup() { pinMode(<span class="hljs-number"><span class="hljs-number">3</span></span>, OUTPUT);//LED pinMode(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>);//Button <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> ground digitalWrite(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); } <span class="hljs-type"><span class="hljs-type">int</span></span> t = <span class="hljs-number"><span class="hljs-number">10000</span></span>; <span class="hljs-type"><span class="hljs-type">bool</span></span> PreButton = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { <span class="hljs-type"><span class="hljs-type">bool</span></span> Button = !digitalRead(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (PreButton == <span class="hljs-keyword"><span class="hljs-keyword">false</span></span> &amp;&amp; Button == <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> &amp;&amp; t &gt; <span class="hljs-number"><span class="hljs-number">500</span></span>) t = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t&lt;<span class="hljs-number"><span class="hljs-number">5</span></span>) digitalWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> digitalWrite(<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (t&lt;<span class="hljs-number"><span class="hljs-number">10000</span></span>) t++; PreButton = Button; delay(<span class="hljs-number"><span class="hljs-number">1</span></span>); }</code> </pre> </div></div><br>  The gun "shoots" short pulses of 4ms (picked up during the setup process) with a maximum rate of fire of 2 shots per second. <br>  Next, the case for the receiving party.  I bought a simple webcam.  Malinka was already in the bins.  I connected the camera, sent it to the wall. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/3e5/cc6/886/3e5cc688647142d2bd4cf704a0394492.jpg"></div></div><br>  Next you need to put the necessary packages on the raspberry <br><pre> <code class="bash hljs">sudo apt-get install libv4l-0 libopencv-dev python-opencv</code> </pre> <br>  It remains to write a Python script.  This was my first python script, so I had to kill him for almost a day. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python import sys import cv2 import math import subprocess if __name__ == '__main__': #target in camera CenterX = 426.5 CenterY = 190.5 Radius = 40.0 width = 800 height = 640 capture = cv2.VideoCapture(0) capture.set(3, width); capture.set(4, height); image = cv2.imread("target.jpg", cv2.CV_LOAD_IMAGE_COLOR) target_x = float(image.shape[0])*0.5 target_y = float(image.shape[1])*0.5 target_Radius = min(target_x,target_y) target = image.copy() cv2.namedWindow("Result", 1) cv2.imshow("Result", target) ShotCount = int(); Scoore = 0; while 1: if cv2.waitKey(1) &gt;= 0: break ret,frame = capture.read() grey_image = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY) ret,grey_image = cv2.threshold(grey_image, 245, 255, cv2.THRESH_BINARY) # grey_image = cv2.erode(grey_image, None, iterations = 1) # grey_image = cv2.dilate(grey_image, None, iterations = 1) (contour, _) = cv2.findContours(grey_image, cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE) if contour: subprocess.Popen('aplay Shot.wav', shell = True) cntr = sorted(contour, key = cv2.contourArea, reverse = True)[0] (x,y), radius = cv2.minEnclosingCircle(cntr) center = (x, y) shot_x = (float(x) - CenterX)/Radius shot_y = (float(y) - CenterY)/Radius dist = math.sqrt(shot_x*shot_x+shot_y*shot_y) shot_x = target_x + shot_x*target_Radius shot_y = target_y + shot_y*target_Radius Shot = (int(shot_x), int(shot_y)) cv2.circle(target, Shot, 5, (60,60,255),10) cv2.circle(target, Shot, 10, (120,120,120),1) cv2.imshow("Result", target) #calibrate #print (center, dist) print ("Shots", ShotCount+1) if dist &lt; 1.0: Scoore += 1 - dist ShotCount += 1 if ShotCount &gt; 6: ShotCount = 0; Scoore = Scoore/7.0*100.0 print("You Scoore: ", Scoore) Scoore = 0 target = image.copy() cv2.waitKey(300) subprocess.Popen('aplay 924.wav', shell = True) cv2.waitKey(1000) cv2.waitKey(50) cv2.destroyAllWindows()</span></span></code> </pre> </div></div><br>  A little bit of explanation.  The script takes pictures from the camera and converts them into black and white.  Then it cuts off everything that is darker 245. As practice has shown, the spot of a laser diode is detected very confidently even with a pulse length of only a couple of milliseconds.  Next we find the contour of the spot and the minimum circle describing it.  We draw hits on targets, we lose a sound.  After seven ‚Äúshots‚Äù we count the points (of which you can fill a maximum of 100). <br>  Before shooting, you need to calibrate the position of the target in the chamber. <br>  By the way "target": <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/49a/e97/d57/49ae97d57e6945f9b9d4b05bbbaa6201.jpg"></div></div><br>  My camera is three meters from the target.  Uncomment the line #print (center, dist), shoot until we get exactly to the center.  We look in the log position of the hit and write to the beginning of the script (CenterX, CenterY).  Also there rule Radius to your target size. <br>  The resolution of the camera with three meters is about two millimeters.  If this seems a little, you can just move the camera. <br>  Everything, we <s>fall into the childhood we</s> start fire training classes. <br><br>  The process looks like this (litter for shabby wallpaper - I live in a rented apartment): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Q2WqxU_UBPA%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700253&amp;usg=ALkJrhgy-8NTtu2gDBplwFG76RusdNb3PA" frameborder="0" allowfullscreen=""></iframe><br><br>  Sources to the project: <a href="https://github.com/DIMOSUS/Laser-shoting">github.com/DIMOSUS/Laser-shoting</a> <br><br>  Do not forget about security - you can only look at the laser, like in a telescope in the sun, twice ... <br>  In the future, I would like to install a servomotor in the pistol, which will pull the load to simulate recoil.  Well, print a normal target. </div><p>Source: <a href="https://habr.com/ru/post/248181/">https://habr.com/ru/post/248181/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248165/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ31 (January 12 - 18, 2015)</a></li>
<li><a href="../248169/index.html">A large list of materials for studying Meteor.JS</a></li>
<li><a href="../248173/index.html">The legacy of Jacob Bernoulli in Wolfram Language (Mathematica)</a></li>
<li><a href="../248177/index.html">The digest of interesting materials from the world of web development and IT for the last week ‚Ññ143 (January 12 - 18, 2015)</a></li>
<li><a href="../248179/index.html">A brief course of computer graphics: we write a simplified OpenGL do it yourself, article 3 of 6</a></li>
<li><a href="../248185/index.html">Car Tutorial Guide (Unity3d) part 2 of 3</a></li>
<li><a href="../248187/index.html">What's new in CSS 4th level selectors?</a></li>
<li><a href="../248189/index.html">Create an environment for PyQt5 in Linux MInt (Ubuntu)</a></li>
<li><a href="../248193/index.html">Deploying CUCM with VMware Workstation 10.0.3 and GNS3</a></li>
<li><a href="../248197/index.html">WPF: Binding without trivial converters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>