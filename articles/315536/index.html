<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Reverse tunnel for RDP access using putty and icinga2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It is not always possible to organize a single local area network due to various circumstances, but there is a need for remote access via RDP to hosts...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Reverse tunnel for RDP access using putty and icinga2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/479/0d7/40f/4790d740f7cc4327906f55ad00030e04.png"><br><br>  It is not always possible to organize a single local area network due to various circumstances, but there is a need for remote access via RDP to hosts behind a nat with a gray ip, for example, a small remote branch with a communication channel via cellular communication.  Yes, of course, you can raise something like openVPN or use TeamViewer, but again, such options are not always acceptable.  We will use icinga2, putty, SSH server and a couple of scripts on powershell. <br><a name="habracut"></a><br>  First the theory.  In order to connect to the server without knowing its real ip address and at the same time it is also behind naty, it is necessary that the server itself creates an outgoing connection.  We need an external server with a fixed ip address and an SSH server deployed on it, for this we can use a VDS server with minimal configuration <s>for ridiculous money</s> , or use our own. <br><br>  Install SSH server: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="bash hljs">sudo apt-get install openssh-server</code> </pre> <br>  Creating a user without access to the shell: <br><br><pre> <code class="bash hljs">sudo useradd -d /dev/null -s /dev/null ssh_user sudo passwd ssh_user</code> </pre><br>  Just in case, we change the default port from 22 to 2201. This can be done by changing the Port parameter in the / etc / ssh / sshd_config file. <br><br>  Create a tunnel.  On a remote server (to which we want to connect as a result) it is necessary in some way to execute the command: <br><br><pre> <code class="dos hljs">plink.exe -batch -P <span class="hljs-number"><span class="hljs-number">2201</span></span> -N -C -v -R <span class="hljs-number"><span class="hljs-number">33899</span></span>:localhost:<span class="hljs-number"><span class="hljs-number">3389</span></span> ssh_user@<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span> -pw password</code> </pre><br>  And on the administrator‚Äôs computer execute the commands: <br><br><pre> <code class="dos hljs">plink.exe -P <span class="hljs-number"><span class="hljs-number">2201</span></span> -N -C -v -L <span class="hljs-number"><span class="hljs-number">3379</span></span>:localhost:<span class="hljs-number"><span class="hljs-number">33899</span></span> ssh_user@<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span>.<span class="hljs-number"><span class="hljs-number">222</span></span> -pw password mstsc.exe /v localhost:<span class="hljs-number"><span class="hljs-number">3379</span></span></code> </pre><br>  But this is all theory, but in practice we may encounter different nuances.  If the channel is not stable, the tunnel may break and the ports used remain open, the remote server needs to be informed that it would raise the tunnel, we may need to connect to several servers at the same time. <br><br>  The simplest solution is to create a task in the scheduler which will poll every n minutes for some resource on the Internet for the presence of a specific flag for action and, if this flag is detected, create a tunnel with email sent to our address.  We will do everything more elegantly, we will use the monitoring system that we have installed, for example, such as <b>icinga2</b> .  In this case, the remote server with the installed agent can simply send a command to create a tunnel at the right time. <br><br>  If you have not encountered this monitoring system yet, I recommend to look at: <br><br><ul><li>  <a href="https://habrahabr.ru/post/307560/">Use powershell scripts in icinga2</a> </li><li>  <a href="https://habrahabr.ru/post/307358/">We raise micromonitoring on icinga2 with minimal costs</a> </li></ul><br>  Create a service in icinga2 to create a tunnel: <br><br><pre> <code class="bash hljs">apply Service <span class="hljs-string"><span class="hljs-string">"create-rdp-tunnel"</span></span> { enable_active_checks = <span class="hljs-literal"><span class="hljs-literal">false</span></span> max_check_attempts = 2 assign <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> host.name == NodeName ignore <span class="hljs-built_in"><span class="hljs-built_in">where</span></span> host.vars.os == <span class="hljs-string"><span class="hljs-string">"Linux"</span></span> check_command = <span class="hljs-string"><span class="hljs-string">"powershell"</span></span> vars.ps_command = <span class="hljs-string"><span class="hljs-string">"c:\\ProgramData\\icinga2\\Scripts\\icinga2\\create_rdp_tunnel.ps1"</span></span> }</code> </pre><br>  Now you need to distribute the tunnel creation script and the plink.exe file to the agents.  The previous <a href="https://habrahabr.ru/post/307560/">article</a> described how this can be done using icinga2. <br><br><div class="spoiler">  <b class="spoiler_title">Tunnel creation script</b> <div class="spoiler_text"><pre> <code class="hljs mel">&lt;# icinga2scripts Version <span class="hljs-number"><span class="hljs-number">1.0</span></span> Description:   Icinga <span class="hljs-number"><span class="hljs-number">2</span></span> -  ssh     Pavel Satin (c) <span class="hljs-number"><span class="hljs-number">2016</span></span> pslater.ru@gmail.com #&gt; [Console]::OutputEncoding = [System.Text.Encoding]::UTF8 $returnStateOK = <span class="hljs-number"><span class="hljs-number">0</span></span> $returnStateWarning = <span class="hljs-number"><span class="hljs-number">1</span></span> $returnStateCritical = <span class="hljs-number"><span class="hljs-number">2</span></span> $returnStateUnknown = <span class="hljs-number"><span class="hljs-number">3</span></span> $portnum = <span class="hljs-string"><span class="hljs-string">"338"</span></span> + (Get-Random -minimum <span class="hljs-number"><span class="hljs-number">10</span></span> -maximum <span class="hljs-number"><span class="hljs-number">99</span></span>).ToString() $tunnelcmd = <span class="hljs-string"><span class="hljs-string">"c:\ProgramData\icinga2\Scripts\icinga2\plink.exe"</span></span> $tunnelarg = <span class="hljs-string"><span class="hljs-string">"-batch -P 2201 -N -C -v -R "</span></span> + $portnum + <span class="hljs-string"><span class="hljs-string">":localhost:3389 ssh_user@222.222.222.222 -pw password"</span></span> $regSSHkey = <span class="hljs-string"><span class="hljs-string">"HKCU:\Software\SimonTatham\PuTTY\SshHostKeys"</span></span> $regSSHname = <span class="hljs-string"><span class="hljs-string">"rsa2@2201:222.222.222.222"</span></span> $regSSHval = <span class="hljs-string"><span class="hljs-string">"0x10001,0x000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(Test-Path $regSSHkey -PathType Any)) { New-Item -Path $regSSHkey -Force | Out-Null New-ItemProperty -Path $regSSHkey -Name $regSSHName -Value $regSSHval -PropertyType String -Force | Out-Null } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { New-ItemProperty -Path $regSSHkey -Name $regSSHName -Value $regSSHval -PropertyType String -Force | Out-Null } $process = (start-process $tunnelcmd -argumentlist $tunnelarg -PassThru) Start-Sleep -s <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($process.HasExited) { Write-Host <span class="hljs-string"><span class="hljs-string">"Failed to start plink. The process is closed with the code: "</span></span> $process.ExitCode [System.Environment]::Exit($returnStateCritical) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { # pushover  $uri = <span class="hljs-string"><span class="hljs-string">"https://api.pushover.net/1/messages.json"</span></span> $parameters = @{ token = <span class="hljs-string"><span class="hljs-string">"API_TOKEN"</span></span> user = <span class="hljs-string"><span class="hljs-string">"API_USER"</span></span> message = <span class="hljs-string"><span class="hljs-string">"   : $portnum  : $env:computername"</span></span> } $pushoverreq = $parameters | Invoke-RestMethod -Uri $uri -Method Post Write-Host <span class="hljs-string"><span class="hljs-string">"OK - The tunnel is created. Port number: $portnum"</span></span> Write-Host <span class="hljs-string"><span class="hljs-string">"To connect:"</span></span> Write-Host <span class="hljs-string"><span class="hljs-string">"plink.exe -P 2201 -N -C -v -L 3379:localhost:$portnum ssh_user@222.222.222.222 -pw password"</span></span> [System.Environment]::Exit($returnStateOK) }</code> </pre><br></div></div><br>  The script takes into account such a moment as a request to save the ssh keys of the remote server.  If the remote server has never connected to your SSH server, putty will give a warning when connecting, and plink will refuse to connect at all. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/8ba/ca4/b6a/8baca4b6a2734d1ea3e861dec77910a0.png"></div><br>  To avoid this, you need to connect to the SSH server from any other machine, pull the cached keys out of the registry (HKCU: \ Software \ SimonTatham \ PuTTY \ SshHostKeys) and change the $ regSSHval variable in the script.  The script creates a connection to a pseudo-random port number, which will help avoid conflicts with multiple connections.  The script also sends a push message using the <a href="https://pushover.net/">pushover.net</a> service. <br><br>  Send a command to the agent to create a tunnel.  This can be done via the web interface or in the console of our monitoring server: <br><br><pre> <code class="bash hljs">/bin/<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"[`date +%s`] SCHEDULE_FORCED_SVC_CHECK;;create-rdp-tunnel;`date +%s`"</span></span> &gt;&gt; /var/run/icinga2/cmd/icinga2.cmd</code> </pre><br>  Now the administrator on his computer will only have to run the script with the name of the remote server as an argument.  The rest will be made by the script, it will find out on which port the tunnel is created, establish a tunnel with port forwarding, start the rdp client with the necessary parameters. <br><br><div class="spoiler">  <b class="spoiler_title">Tunnel connection script</b> <div class="spoiler_text"><pre> <code class="hljs smalltalk">&lt;# icinga2scripts <span class="hljs-type"><span class="hljs-type">Version</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-type"><span class="hljs-type">Description</span></span>:   <span class="hljs-type"><span class="hljs-type">Icinga</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> -  <span class="hljs-type"><span class="hljs-type">RemoteDesktop</span></span>   <span class="hljs-type"><span class="hljs-type">Pavel</span></span> <span class="hljs-type"><span class="hljs-type">Satin</span></span> (c) <span class="hljs-number"><span class="hljs-number">2016</span></span> pslater.ru@gmail.com #&gt; <span class="hljs-string"><span class="hljs-string">$r</span></span>eturnStateOK = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-string"><span class="hljs-string">$r</span></span>eturnStateWarning = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">$r</span></span>eturnStateCritical = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">$r</span></span>eturnStateUnknown = <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-symbol"><span class="hljs-symbol">#Windows</span></span> <span class="hljs-type"><span class="hljs-type">Balloon</span></span> [void] [<span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Reflection</span></span>.<span class="hljs-type"><span class="hljs-type">Assembly</span></span>]::<span class="hljs-type"><span class="hljs-type">LoadWithPartialName</span></span>(<span class="hljs-comment"><span class="hljs-comment">"System.Windows.Forms"</span></span>) <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon = <span class="hljs-type"><span class="hljs-type">New</span></span>-<span class="hljs-type"><span class="hljs-type">Object</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Windows</span></span>.<span class="hljs-type"><span class="hljs-type">Forms</span></span>.<span class="hljs-type"><span class="hljs-type">NotifyIcon</span></span> if (<span class="hljs-string"><span class="hljs-string">$a</span></span>rgs[<span class="hljs-number"><span class="hljs-number">0</span></span>] -eq <span class="hljs-string"><span class="hljs-string">$n</span></span>ull) { <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Icon</span></span> = <span class="hljs-comment"><span class="hljs-comment">"C:\Scripts\images\icinga.ico"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipIcon</span></span> = <span class="hljs-comment"><span class="hljs-comment">"Error"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipText</span></span> = <span class="hljs-comment"><span class="hljs-comment">"     !   ."</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipTitle</span></span> = <span class="hljs-comment"><span class="hljs-comment">"  "</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Visible</span></span> = <span class="hljs-string"><span class="hljs-string">$T</span></span>rue <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">ShowBalloonTip</span></span>(<span class="hljs-number"><span class="hljs-number">30000</span></span>) <span class="hljs-type"><span class="hljs-type">Start</span></span>-<span class="hljs-type"><span class="hljs-type">Sleep</span></span> -s <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Visible</span></span> = <span class="hljs-string"><span class="hljs-string">$f</span></span>alse <span class="hljs-string"><span class="hljs-string">$s</span></span>cript:objNotifyIcon.<span class="hljs-type"><span class="hljs-type">Dispose</span></span>() exit } <span class="hljs-string"><span class="hljs-string">$r</span></span>dpHost = <span class="hljs-string"><span class="hljs-string">$a</span></span>rgs[<span class="hljs-number"><span class="hljs-number">0</span></span>] <span class="hljs-string"><span class="hljs-string">$p</span></span>linkPath = <span class="hljs-comment"><span class="hljs-comment">"C:\Scripts\bin\"</span></span> add-type -<span class="hljs-type"><span class="hljs-type">TypeDefinition</span></span> @<span class="hljs-comment"><span class="hljs-comment">" using System.Net; using System.Security.Cryptography.X509Certificates; public class TrustAllCertsPolicy : ICertificatePolicy { public bool CheckValidationResult( ServicePoint srvPoint, X509Certificate certificate, WebRequest request, int certificateProblem) { return true; } } "</span></span>@ [<span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Net</span></span>.<span class="hljs-type"><span class="hljs-type">ServicePointManager</span></span>]::<span class="hljs-type"><span class="hljs-type">CertificatePolicy</span></span> = <span class="hljs-type"><span class="hljs-type">New</span></span>-<span class="hljs-type"><span class="hljs-type">Object</span></span> <span class="hljs-type"><span class="hljs-type">TrustAllCertsPolicy</span></span> <span class="hljs-string"><span class="hljs-string">$u</span></span>ser = <span class="hljs-comment"><span class="hljs-comment">"icinga"</span></span> <span class="hljs-string"><span class="hljs-string">$p</span></span>ass= <span class="hljs-comment"><span class="hljs-comment">"password"</span></span> <span class="hljs-string"><span class="hljs-string">$s</span></span>ecpasswd = <span class="hljs-type"><span class="hljs-type">ConvertTo</span></span>-<span class="hljs-type"><span class="hljs-type">SecureString</span></span> <span class="hljs-string"><span class="hljs-string">$p</span></span>ass -<span class="hljs-type"><span class="hljs-type">AsPlainText</span></span> -<span class="hljs-type"><span class="hljs-type">Force</span></span> <span class="hljs-string"><span class="hljs-string">$c</span></span>redential = <span class="hljs-type"><span class="hljs-type">New</span></span>-<span class="hljs-type"><span class="hljs-type">Object</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Management</span></span>.<span class="hljs-type"><span class="hljs-type">Automation</span></span>.<span class="hljs-type"><span class="hljs-type">PSCredential</span></span>(<span class="hljs-string"><span class="hljs-string">$u</span></span>ser, <span class="hljs-string"><span class="hljs-string">$s</span></span>ecpasswd) <span class="hljs-string"><span class="hljs-string">$a</span></span>piurl = <span class="hljs-comment"><span class="hljs-comment">"https://222.222.222.222:5665/v1/objects/services/"</span></span> + <span class="hljs-string"><span class="hljs-string">$r</span></span>dpHost + <span class="hljs-comment"><span class="hljs-comment">"!create-rdp-tunnel?attrs=last_check_result"</span></span> <span class="hljs-string"><span class="hljs-string">$a</span></span>pireq = <span class="hljs-type"><span class="hljs-type">Invoke</span></span>-<span class="hljs-type"><span class="hljs-type">WebRequest</span></span> -<span class="hljs-type"><span class="hljs-type">Credential</span></span> <span class="hljs-string"><span class="hljs-string">$c</span></span>redential -<span class="hljs-type"><span class="hljs-type">Uri</span></span> <span class="hljs-string"><span class="hljs-string">$a</span></span>piurl -<span class="hljs-type"><span class="hljs-type">Method</span></span> <span class="hljs-type"><span class="hljs-type">Get</span></span> -<span class="hljs-type"><span class="hljs-type">UseBasicParsing</span></span> -<span class="hljs-type"><span class="hljs-type">ContentType</span></span> <span class="hljs-comment"><span class="hljs-comment">"text/plain; charset=Windows-1251"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>utputresult = <span class="hljs-string"><span class="hljs-string">$a</span></span>pireq | <span class="hljs-type"><span class="hljs-type">ConvertFrom</span></span>-<span class="hljs-type"><span class="hljs-type">Json</span></span> | <span class="hljs-type"><span class="hljs-type">Select</span></span> -expand <span class="hljs-type"><span class="hljs-type">Results</span></span> | <span class="hljs-type"><span class="hljs-type">Select</span></span> -expand attrs | <span class="hljs-type"><span class="hljs-type">Select</span></span> -expand last_check_result <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput = <span class="hljs-string"><span class="hljs-string">$o</span></span>utputresult.output <span class="hljs-string"><span class="hljs-string">$i</span></span>ndxPlink = <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput.<span class="hljs-type"><span class="hljs-type">IndexOf</span></span>(<span class="hljs-comment"><span class="hljs-comment">"plink"</span></span>) <span class="hljs-string"><span class="hljs-string">$p</span></span>ortnum = <span class="hljs-comment"><span class="hljs-comment">"339"</span></span> + (<span class="hljs-type"><span class="hljs-type">Get</span></span>-<span class="hljs-type"><span class="hljs-type">Random</span></span> -minimum <span class="hljs-number"><span class="hljs-number">10</span></span> -maximum <span class="hljs-number"><span class="hljs-number">99</span></span>).<span class="hljs-type"><span class="hljs-type">ToString</span></span>() <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput2 = <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput.<span class="hljs-type"><span class="hljs-type">Substring</span></span>(<span class="hljs-string"><span class="hljs-string">$i</span></span>ndxPlink, <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput.<span class="hljs-type"><span class="hljs-type">Length</span></span> - <span class="hljs-string"><span class="hljs-string">$i</span></span>ndxPlink) <span class="hljs-string"><span class="hljs-string">$c</span></span>mdArgs = <span class="hljs-comment"><span class="hljs-comment">"/C "</span></span> + <span class="hljs-string"><span class="hljs-string">$s</span></span>trOutput2.<span class="hljs-type"><span class="hljs-type">Replace</span></span>(<span class="hljs-comment"><span class="hljs-comment">"3379"</span></span>, <span class="hljs-string"><span class="hljs-string">$p</span></span>ortnum) <span class="hljs-string"><span class="hljs-string">$m</span></span>stscArgs = <span class="hljs-comment"><span class="hljs-comment">"/v localhost:$portnum"</span></span> #  <span class="hljs-type"><span class="hljs-type">Start</span></span>-<span class="hljs-type"><span class="hljs-type">Process</span></span> cmd.exe <span class="hljs-string"><span class="hljs-string">$c</span></span>mdArgs <span class="hljs-type"><span class="hljs-type">Start</span></span>-<span class="hljs-type"><span class="hljs-type">Process</span></span> mstsc.exe <span class="hljs-string"><span class="hljs-string">$m</span></span>stscArgs <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Icon</span></span> = <span class="hljs-comment"><span class="hljs-comment">"C:\Scripts\images\icinga.ico"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipIcon</span></span> = <span class="hljs-comment"><span class="hljs-comment">"Info"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipText</span></span> = <span class="hljs-comment"><span class="hljs-comment">"   $rdpHost"</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">BalloonTipTitle</span></span> = <span class="hljs-comment"><span class="hljs-comment">"  "</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Visible</span></span> = <span class="hljs-string"><span class="hljs-string">$T</span></span>rue <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">ShowBalloonTip</span></span>(<span class="hljs-number"><span class="hljs-number">30000</span></span>) <span class="hljs-type"><span class="hljs-type">Start</span></span>-<span class="hljs-type"><span class="hljs-type">Sleep</span></span> -s <span class="hljs-number"><span class="hljs-number">30</span></span> <span class="hljs-string"><span class="hljs-string">$o</span></span>bjNotifyIcon.<span class="hljs-type"><span class="hljs-type">Visible</span></span> = <span class="hljs-string"><span class="hljs-string">$f</span></span>alse <span class="hljs-string"><span class="hljs-string">$s</span></span>cript:objNotifyIcon.<span class="hljs-type"><span class="hljs-type">Dispose</span></span>()</code> </pre><br></div></div><br><img src="https://habrastorage.org/files/59d/c23/125/59dc231257554f059a8a0aa6c1fa1804.png"><br><br><h4>  Links </h4><br>  ‚Üí <a href="http://www.putty.org/">Putty</a> <br>  ‚Üí <a href="https://habrahabr.ru/post/307560/">Use powershell scripts in icinga2</a> </div><p>Source: <a href="https://habr.com/ru/post/315536/">https://habr.com/ru/post/315536/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../315524/index.html">SDN: concept changes over 5 years</a></li>
<li><a href="../315526/index.html">Functional testing of modern web applications</a></li>
<li><a href="../315530/index.html">Etiquette and ethics of using OpenSource</a></li>
<li><a href="../315532/index.html">‚ÄúI will know when I see‚Äù - we study the accuracy of Google Cloud Vision using Tumblr and NSFW content</a></li>
<li><a href="../315534/index.html">Opanki, I broke your life</a></li>
<li><a href="../315538/index.html">What is Bitrix</a></li>
<li><a href="../315540/index.html">Vulnerability in VMware products allows code execution on a virtual machine host system</a></li>
<li><a href="../315542/index.html">I loved the layout after this: Zeplin in battle</a></li>
<li><a href="../315544/index.html">Overview of the domestic digital gateway Eltex SMG-1016M (VoIP)</a></li>
<li><a href="../315546/index.html">Club of anonymous Santa Clauses 2016-2017 on Habrahabr</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>