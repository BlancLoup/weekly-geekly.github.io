<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Static variable initialized 2 times</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Playing with singleton-static-constants in the flex, that's what ran into: 


 There are files ( github.com/radistao/test-super-and-static/commit/1f0a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Static variable initialized 2 times</h1><div class="post__text post__text-html js-mediator-article">  Playing with singleton-static-constants in the flex, that's what ran into: <br><br><a name="habracut"></a><br>  There are files ( <a href="http://github.com/radistao/test-super-and-static/commit/1f0a6">github.com/radistao/test-super-and-static/commit/1f0a6</a> ): <br><br><div class="spoiler">  <b class="spoiler_title">ChatModel.as</b> <div class="spoiler_text"><pre><code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> someStaticConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someStaticVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menu : ChatMenuStructure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatMenuStructure(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _instance : ChatModel; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ChatModel </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"Get instance start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_instance) { _instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatModel(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T()); } trace(<span class="hljs-string"><span class="hljs-string">"Get instance end"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t : T)</span></span></span><span class="hljs-function"> </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"ChatModel contructor 1"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getTraceCount : int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTrace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(str : String)</span></span></span><span class="hljs-function"> : String </span></span>{ getTraceCount++; trace(<span class="hljs-string"><span class="hljs-string">"getTrace #"</span></span> + getTraceCount, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } } } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span></span>{ }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">ChatMenuStructure.as</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatMenuStructure</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> chatMenuStructureConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"chatMenuStructureConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chatMenuStructureVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"chatMenuStructureVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChatMenuStructure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"ChatMenuStructure constructor"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTrace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(str : String)</span></span></span><span class="hljs-function"> : String </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"ChatMenuStructure getTrace"</span></span>, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"ChatMenuStructure instance"</span></span>; } } }</code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">testSuperCall.mxml</b> <div class="spoiler_text"><pre> <code class="actionscript hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; &lt;s:Application xmlns:fx=<span class="hljs-string"><span class="hljs-string">"http://ns.adobe.com/mxml/2009"</span></span> xmlns:s=<span class="hljs-string"><span class="hljs-string">"library://ns.adobe.com/flex/spark"</span></span> xmlns:mx=<span class="hljs-string"><span class="hljs-string">"library://ns.adobe.com/flex/mx"</span></span> minWidth=<span class="hljs-string"><span class="hljs-string">"955"</span></span> minHeight=<span class="hljs-string"><span class="hljs-string">"600"</span></span> creationComplete=<span class="hljs-string"><span class="hljs-string">"creationCompleteHandler()"</span></span>&gt; &lt;fx:Script&gt; &lt;![CDATA[ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chatModel : ChatModel = ChatModel.instance; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menu : ChatMenuStructure = chatModel.menu; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">creationCompleteHandler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:void </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"menu is \""</span></span> + String(menu) + <span class="hljs-string"><span class="hljs-string">"\""</span></span>); } ]]&gt; &lt;/fx:Script&gt; &lt;fx:Declarations&gt; &lt;!-- Place non-visual elements (eg, services, value objects) here --&gt; &lt;/fx:Declarations&gt; &lt;/s:Application&gt;</code> </pre></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here are the traces that came out ( <a href="https://gist.github.com/radistao/5478426">gist.github.com/radistao/5478426</a> ): <br><blockquote>  getTrace <b># 1</b> someStaticConst <br>  getTrace <b># 2</b> someStaticVar <br>  Get instance start <br>  getTrace <b># 1</b> someConst <br>  getTrace <b># 2</b> someVar <br>  ChatMenuStructure getTrace chatMenuStructureConst <br>  ChatMenuStructure getTrace chatMenuStructureVar <br>  ChatMenuStructure constructor <br>  ChatModel contructor 1 <br>  Get instance end <br>  menu is "ChatMenuStructure instance" <br></blockquote><br><br>  Brief conclusions on the traces: <br><ul><li>  static class variables will not be initialized before the first call to the instance of this class or the first call to a static variable, as in Java (KO was not mistaken) </li><li>  before the constructor is called, all static "initializers" will be called (if this is the first call to the class), followed by all local "initializers".  KO prompts that every next constructor call will no longer call static initializers. </li><li>  the presence or absence of <code><b>super()</b></code> in the constructor does not change the order of initialization (sequence-results of traces: commit <a href="https://github.com/radistao/test-super-and-static/commit/7f930">github.com/radistao/test-super-and-static/commit/7f930</a> and trays <a href="https://gist.github.com/radistao/5478435">gist.github.com/radistao/5478435</a> ) </li></ul><br><br>  BUT!!! <br>  while I did all this, I decided to enter the <code>getTraceCount</code> counter how many times it was called (line 32 of the ChatModel.as file) in the call to the static <code>getTrace()</code> method, which I used to initialize constants and variables.  All I did to him was just increment and treysil with every <code>getTrace()</code> call <br><br>  And now pay attention to the traces: <br><blockquote>  getTrace <b># 1</b> someStaticConst <br>  getTrace <b># 2</b> someStaticVar <br>  Get instance start <br>  getTrace <b># 1</b> someConst <br>  getTrace <b># 2</b> someVar </blockquote><br><br>  <b>static variable <code>getTraceCount</code> initialized 2 times!</b>  <b>WAT?</b> <br><br><img src="http://gifsforum.com/images/image/wtf/grand/dude_wait_wat.jpg" alt="image"><br><br>  Hailing and collecting the remnants of my torn Mosca, I began to further cut and search, WTF!  Well, in general, having missed all the busting options, dances with a tambourine and the calls of the spirits of the deceased flexers, I realized what the trampled <br><br><blockquote> <code>private static var getTraceCount : int = 0;</code> </blockquote> <br><br>  is in the code below the first two calls to <i>getTrace ()</i> .  Moving this ad to the very "top" of the class (code) - everything worked like a clock ( <a href="https://github.com/radistao/test-super-and-static/commit/a0dcd">github.com/radistao/test-super-and-static/commit/a0dcd</a> ): <br><div class="spoiler">  <b class="spoiler_title">ChatMenuStructure.as</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getTraceCount : int = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> someStaticConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someStaticVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menu : ChatMenuStructure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatMenuStructure(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _instance : ChatModel; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ChatModel </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"Get instance start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_instance) { _instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatModel(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T()); } trace(<span class="hljs-string"><span class="hljs-string">"Get instance end"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t : T)</span></span></span><span class="hljs-function"> </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"ChatModel contructor before super()"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); trace(<span class="hljs-string"><span class="hljs-string">"ChatModel contructor after super()"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTrace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(str : String)</span></span></span><span class="hljs-function"> : String </span></span>{ getTraceCount++; trace(<span class="hljs-string"><span class="hljs-string">"getTrace #"</span></span> + getTraceCount, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } } } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span></span>{ }</code> </pre></div></div><br><br>  Traces ( <a href="https://gist.github.com/radistao/5478443">gist.github.com/radistao/5478443</a> ): <br><div class="spoiler">  <b class="spoiler_title">Treysy</b> <div class="spoiler_text"><pre> <code class="actionscript hljs">getTrace &lt;b&gt;#<span class="hljs-number"><span class="hljs-number">1</span></span>&lt;/b&gt; someStaticConst getTrace &lt;b&gt;#<span class="hljs-number"><span class="hljs-number">2</span></span>&lt;/b&gt; someStaticVar Get instance start getTrace &lt;b&gt;#<span class="hljs-number"><span class="hljs-number">3</span></span>&lt;/b&gt; someConst getTrace &lt;b&gt;#<span class="hljs-number"><span class="hljs-number">4</span></span>&lt;/b&gt; someVar ChatMenuStructure getTrace chatMenuStructureConst ChatMenuStructure getTrace chatMenuStructureVar ChatMenuStructure constructor ChatModel contructor before <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>() ChatModel contructor after <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>() Get instance end menu <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-string"><span class="hljs-string">"ChatMenuStructure instance"</span></span></code> </pre></div></div><br><br>  In general, something like this happens: <br><ol><li>  <code>getTrace</code> is <code>getTrace</code> to initialize the first static object <code>someStaticConst</code> .  In this <code>getTrace()</code> <code>getTraceCount</code> , initialized and incremented to 1 </li><li>  <code>getTrace</code> is <code>getTrace</code> to initialize the second static object <code>someStaticVar</code> .  In this <code>getTrace()</code> already initialized <code>getTraceCount</code> and incremented to 2. </li><li>  and here comes the initialization queue of the third static object ‚Äî <i>private static var getTraceCount declarations: int = 0;</i>  And in this place <code>getTraceCount</code> completely painlessly goes back to 0 and everything starts from the beginning! </li></ol><br><br><img src="https://habrastorage.org/getpro/habr/post_images/c52/685/248/c52685248507a84fc945539e4ba9cd51.jpg" alt="image"><br><br>  Thus, it cannot be assumed that if a static variable is ‚Äúat the bottom of the code‚Äù and will jerk earlier, then it will be correctly initialized. <br><br>  Now I‚Äôm wondering who is to blame (and what to do): compiler, java-machine or flash player? <br><br>  For the sake of interest, I experimented with non-primitive types ( <a href="https://github.com/radistao/test-super-and-static/commit/08894">github.com/radistao/test-super-and-static/commit/08894</a> ): <br><br><div class="spoiler">  <b class="spoiler_title">GetTracesClass.as</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GetTracesClass</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> constructorCalls : int = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> instanceNumber : int; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetTracesClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"GetTracesClass constructor called "</span></span> + String(constructorCalls) + <span class="hljs-string"><span class="hljs-string">" time(s)"</span></span>); instanceNumber = constructorCalls; constructorCalls++; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : String </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"GetTracesClass instance #"</span></span> + String(instanceNumber); } } }</code> </pre></div></div><br><br><div class="spoiler">  <b class="spoiler_title">ChatModel.as</b> <div class="spoiler_text"><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> someStaticConst : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticConst"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> someStaticVar : String = getTrace(<span class="hljs-string"><span class="hljs-string">"someStaticVar"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> menu : ChatMenuStructure = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatMenuStructure(); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _instance : ChatModel; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">instance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> : ChatModel </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"Get instance start"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!_instance) { _instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ChatModel(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> T()); } trace(<span class="hljs-string"><span class="hljs-string">"Get instance end"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _instance; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ChatModel</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(t : T)</span></span></span><span class="hljs-function"> </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"ChatModel contructor before super()"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(); trace(<span class="hljs-string"><span class="hljs-string">"ChatModel contructor after super()"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> getTraceCount : GetTracesClass = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> GetTracesClass(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTrace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(str : String)</span></span></span><span class="hljs-function"> : String </span></span>{ trace(<span class="hljs-string"><span class="hljs-string">"getTrace #\""</span></span> + getTraceCount + <span class="hljs-string"><span class="hljs-string">"\""</span></span>, str); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } } } <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span></span>{ }</code> </pre></div></div><br><br>  Traces ( <a href="https://gist.github.com/radistao/5478479">gist.github.com/radistao/5478479</a> ): <br><blockquote>  getTrace # "null" someStaticConst <br>  getTrace # "null" someStaticVar <br>  GetTracesClass constructor called 1 time (s) <br>  Get instance start <br>  getTrace # "GetTracesClass instance # 1" someConst <br>  getTrace # "GetTracesClass instance # 1" someVar <br>  ChatMenuStructure getTrace chatMenuStructureConst <br>  ChatMenuStructure getTrace chatMenuStructureVar <br>  ChatMenuStructure constructor <br>  ChatModel contructor before super () <br>  ChatModel contructor after super () <br>  Get instance end <br>  menu is "ChatMenuStructure instance" <br></blockquote><br><br>  There, everything is becoming more transparent, although it‚Äôs still stupid: the first 2 calls to <code>getTrace()</code> do not complain <code>getTraceCount</code> getTraceCount at <code>getTraceCount</code> , although they address it, and after its initialization everything goes further and further normally.  If you initialize <code>getTraceCount</code> at the beginning, everything goes fine ( <a href="https://gist.github.com/radistao/5478482">gist.github.com/radistao/5478482</a> ) <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ce/9bd/9fd/2ce9bd9fdb8a2a3d433ce98a57422dcb.jpg" alt="image"><br>  (I didn‚Äôt have information to break the mosque, so I inserted this picture just like that!) <br><br>  Then I tried it with <b>Number</b> - the same picture as with <b>int</b> . <br>  Then I also tried to initialize <code>getTraceCount</code> not with zero, but 1 (i.e., not with default value): then " <code>2, 3, 2, 3</code> " fell in the traces (i.e., for the first time, all the same, it was taken not the default value for <b>int</b> , but the one that is confused by it in the initializer). <br><br>  What can it affect?  I don‚Äôt know for sure, but I suspect that it can probably affect some static instance counters of a particular class and similar patterns. <br><br>  Thus, this article does not explain, but rather the opposite, asks where the problem is: in the compiler, in a Java machine or flash player?  Is it possible to solve it?  Personally, it seems to me that this behavior is not normal for a programming language. <br></div><p>Source: <a href="https://habr.com/ru/post/178367/">https://habr.com/ru/post/178367/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178355/index.html">Five useful tips when making a commit message</a></li>
<li><a href="../178359/index.html">Using free tools to customize the "Unchangeable" components of Windows 8</a></li>
<li><a href="../178361/index.html">Marketing for IT pros - goat bayan?</a></li>
<li><a href="../178363/index.html">A two-week review of Google Glass: everything will depend on the price</a></li>
<li><a href="../178365/index.html">Proxying and autosharing in Tarantool / Box</a></li>
<li><a href="../178375/index.html">Global refactoring</a></li>
<li><a href="../178379/index.html">How to become a real analyst? Part 2. Identify the requirements</a></li>
<li><a href="../178381/index.html">System Center 2012 Operations Manager + SP1 from Microsoft Architect!</a></li>
<li><a href="../178385/index.html">Last days of discounts for the conference # MBLT13</a></li>
<li><a href="../178387/index.html">Another game abstraction from Notch - Drop</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>