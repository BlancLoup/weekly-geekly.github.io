<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Intel Software Guard Extensions tutorial. Part 2, app device</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The second part of the Intel Software Guard Extensions (Intel SGX) series of tutorials is a general description of the application that we will develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Intel Software Guard Extensions tutorial. Part 2, app device</h1><div class="post__text post__text-html js-mediator-article">  The second part of the <a href="https://software.intel.com/en-us/sgx">Intel Software Guard Extensions (Intel SGX)</a> series of tutorials is a general description of the application that we will develop: a simple password manager.  Since we are creating this application from scratch, it is possible to foresee the use of Intel SGX from the very beginning.  This means that in addition to the application requirements, we will look at how the requirements for the Intel SGX and the overall application architecture affect each other. <br><br>  Read the <a href="https://habrahabr.ru/company/intel/blog/312002/">first part</a> or list of all published educational materials in the article <a href="https://software.intel.com/en-us/articles/introducing-the-intel-software-guard-extensions-tutorial-series">Introducing a series of educational materials on Intel Software Guard Extensions</a> . <br><br><img src="https://habrastorage.org/files/256/342/00e/25634200e3324f54aaa73315933a296b.jpg"><br><a name="habracut"></a><br><h2>  <font color="#0071c5">Password Managers Short Description</font> </h2><br>  Users, as a rule, know what password managers are and what they serve for, but it is always helpful to once again go through general information before working on the details of the application device. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main goals of the password manager: <br><br><ul><li>  Reducing the number of passwords that the user needs to remember. </li><li>  Providing end users with the ability to create stronger passwords than they could think of on their own. </li><li>  Improve the usability of using different passwords for each account. </li></ul><br>  Password management is a topical issue for Internet users, and over the years several studies have been undertaken to address this problem.  A <a href="http://research.microsoft.com/en-us/um/people/cormac/papers/www2007.pdf">Microsoft study</a> published in 2007 ‚Äî almost a decade ago ‚Äî indicated that each user had an average of 25 accounts for which passwords were required.  Later, in 2014, <a href="https://blog.dashlane.com/infographic-online-overload-its-worse-than-you-thought/">Dashlane specialists calculated</a> that their users in the United States had an average of 130 accounts, and the average number of accounts per user worldwide was about 90. However, this does not end the problem: people as a rule, <a href="https://dl.acm.org/citation.cfm%3Fdoid%3D2858036.2858546">strong passwords are rarely chosen</a> , often <a href="http://media.ofcom.org.uk/news/2013/uk-adults-taking-online-password-security-risks/">using the same password on multiple sites</a> , which caused <a href="https://techcrunch.com/2016/06/16/github-accounts-targeted-in-password-reuse-attack/">scandalous attacks by</a> intruders.  All these problems are caused by only two main factors: first, it is often difficult for people to remember strong passwords that are resistant to cracking;  secondly, if you use not one password, but a set, then the situation becomes even more complicated, because now, apart from the actual password, you also need to remember which account each password is associated with. <br><br>  When using a password manager, it‚Äôs enough to remember just one very strong passphrase in order to gain access to the password database (password storage).  After logging in to the password manager, you can find all the passwords stored there, copy and paste them into the authentication fields on the necessary sites.  Of course, the main vulnerability of the password manager is the password database: this is the attacker's favorite target, since it contains all user passwords.  Therefore, the password database is encrypted using strong encryption algorithms, and the main user passphrase is used to decrypt the data they contain. <br><br>  Our goal in this tutorial is to create a simple password manager that provides the same basic functions as similar commercial products, while observing security recommendations and using this program as an exercise to learn Intel SGX.  I decided to call this training password manager ‚ÄúTutorial Password Manager with Intel Software Guard Extensions‚Äù (yes, it‚Äôs not easy to pronounce, but the name speaks for itself).  This program is not intended to be used as a commercial product and, of course, will not contain all the protective mechanisms inherent in commercial solutions, but this level of detail is not required for training. <br><br><h2>  <font color="#0071c5">Basic application requirements</font> </h2><br>  Basic application requirements will help limit the scope of your application so that you can focus on integrating Intel SGX, and not on the intricacies of designing and developing an application.  Let me remind you that we are not faced with the task of creating a commercial product: the Tutorial Password Manager with the Intel SGX does not need to be able to run on multiple operating systems or on all possible CPU architectures.  Only a valid starting point is required. <br><br>  Therefore, the basic requirements for the application are: <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  The application should work on all platforms regardless of whether they support Intel SGX. <br><br></li><li>  A 64-bit version of Microsoft Windows Vista * or later is required (a 64-bit version of Windows 10 or later is required for Intel SGX support). <br><br></li><li>  An Intel processor that supports Intel Data Protection Technology (Intel DPT) with a secure key is required. <br><br></li><li>  The application should not rely on third-party libraries and utility programs. </li></ul></td></tr></tbody></table><br>  The first requirement may seem strange if we consider that this series of training materials is devoted to the development of applications using Intel SGX, but applications designed for the real world should provide for the possibility of installation on outdated systems.  For some applications, it may be advisable to allow execution only on platforms that support Intel SGX, but in the Tutorial Password Manager we have chosen a more flexible approach.  A platform that supports Intel SGX will get a more secure runtime, but on other platforms the program will still work.  This usage model is quite suitable for a password manager, since users can synchronize their passwords with other, older systems.  In addition, it is an opportunity to learn how to implement double branches of code. <br><br>  The second requirement gives us access to certain encryption algorithms in the non-Intel SGX-supported code branch and to some of the libraries we need.  The requirement to use a 64-bit operating system simplifies application development by accessing 64-bit native code types.  In addition, the speed of some encryption algorithms optimized for 64-bit code is improved. <br><br>  The third requirement gives us access to the RDRAND instructions in the code branch without support for Intel SGX.  This greatly simplifies the generation of random numbers and provides access to a source with high entropy.  Systems that support the RDSEED instruction can use it.  (For information about RDRAND and RDSEED instructions, see the <a href="https://software.intel.com/en-us/articles/intel-digital-random-number-generator-drng-software-implementation-guide">Intel Random Number Software Implementation Guide</a> .) <br><br>  The fourth requirement supports the utmost brevity of the list of software required by the developer (and user).  No third-party libraries, platforms, applications, or utilities are required to download and install.  However, this requirement does not have a very pleasant side effect: if we abandon third-party platforms, then we are left with only four options for creating a user interface.  These options are: <br><br><ul><li>  Win32 APIs </li><li>  Microsoft Foundation Classes (MFC) </li><li>  Windows Presentation Foundation (WPF) </li><li>  Windows forms </li></ul><br>  The first two options are implemented using native / unmanaged code, and the last two options require .NET *. <br><br><h2>  <font color="#0071c5">User interface platform</font> </h2><br>  We will develop a graphical user interface for the Tutorial Password Manager program using Windows Presentation Foundation in C #.  This decision will affect our requirements as follows: <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  WPF based graphical user interface. <br><br></li><li>  Microsoft .NET Framework 4.5.1 or later. <br><br></li><li>  <s>A 64-bit version of Microsoft Windows Vista * or later is required (a 64-bit version of Windows * 10 or later is required for Intel SGX support).</s> <br><br></li><li>  A 64-bit version of Microsoft Windows Vista * with Service Pack 2 (SP2) or later is required (Intel¬Æ SGX support requires a 64-bit version of Windows * 10 or later). </li></ul></td></tr></tbody></table><br>  Why decided to use WPF?  Mainly due to the fact that it simplifies the design of the user interface and introduces the level of complexity we need.  In particular, since the interface relies on the .NET Framework, we have the opportunity to discuss the mixing of managed code and, in particular, high-level languages ‚Äã‚Äãwith the enclave code.  Please note that the choice of WPF instead of Windows Forms was completely arbitrary: our environment would work in either case. <br><br>  As you may remember, enclaves must be written in native C or C ++ code, and bridge functions interacting with an enclave must be native C functions (but not C ++).  Both the Win32 and MFC APIs make it possible to develop a password manager using fully native C / C ++ code, but the development tasks associated with these two methods are useless for developers looking to learn how to develop applications using Intel SGX.  Using a graphical user interface based on managed code, we get not only the benefits of integrated development tools, but also the opportunity to discuss specific issues that are useful to developers of Intel SGX applications.  In short, you are not here to learn how to use MFC or Win32, but you may be interested in how to connect .NET with enclaves. <br><br>  To bind managed and unmanaged code, we will use C ++ / CLI (that is, C ++ modified for Common Language Infrastructure).  This greatly simplifies data packaging and is so convenient that many developers call this method ‚ÄúIJW‚Äù (It Just Works - it just works). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/da3/df2/d36/da3df2d363c044c096488346e736b2ac.png"></div><br>  <i><font color="#999999">Figure 1. Minimum component structures for Intel Software Guard Extensions for native code and C #.</font></i> <br><br>  In fig.  Figure 1 shows the effect on the minimum mix of Intel SGX application components when moving from native code to C #.  When using only native code, the application layer can directly interact with the enclave DLL library, since the functions of the enclave bridge can be embedded into the executable file of the application.  In a mixed application, the functions of an enclave bridge will need to be separated from the managed code block, since these functions must be completely own code.  On the other hand, a C # application cannot directly interact with bridge functions, and in the C ++ / CLI model, this means that you need to create another intermediate level: a DLL library that transfers data between the managed C # application and the enclave DLL library only from your own code. <br><br><h2>  <font color="#0071c5">Password Store Requirements</font> </h2><br>  Password Manager is based on a password database, which we will also call the password store.  This is an encrypted file that will contain information about end-user accounts and passwords.  The basic requirements for our educational application are: <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  Password store should be portable. </li><li>  The storage must be encrypted during storage. </li><li>  All encryption requires the use of authenticated encryption. </li></ul></td></tr></tbody></table><br>  The requirement of storage portability means that we should be able to copy the storage file to another computer and still access its contents regardless of whether the other computer supports the Intel SGX extensions.  In other words, the capabilities of users should be the same: the password manager should work on any computer (of course, if the hardware and operating system meet the specified system requirements). <br><br>  Storage encryption during storage means that the storage file must be encrypted when it is not in active use.  In this case, the storage should be encrypted on the disk (if there was no portability requirement, then the encryption requirement could be solved using the sealing function in the Intel SGX), and should not be in the decrypted form in the RAM longer than necessary. <br><br>  Authenticated encryption ensures that the encrypted storage has not been changed after encryption.  Also, thanks to this, we get a convenient means of checking the user's password phrase: if the decryption key is incorrect, the decryption will fail to verify the authentication tag.  In this case, we do not need to study the decrypted data to ensure that they are correct. <br><br><h2>  <font color="#0071c5">Passwords</font> </h2><br>  Any account information is confidential for a variety of reasons, and not least the information about which accounts and sites you can attack, but passwords are probably the most important information in the repository.  Knowing exactly what needs to be attacked is, of course, good, but if you know passwords, then you don‚Äôt need to attack at all, which is much better.  Therefore, we introduce additional requirements for passwords stored in the repository: <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  Account passwords must be encrypted inside the vault. </li><li>  Decryption of account passwords occurs only on demand. </li></ul></td></tr></tbody></table><br>  This is nested multi-level encryption.  The passwords of all user accounts are encrypted when placed in storage, and the storage itself is encrypted when written to disk.  This approach reduces the vulnerability of passwords after decrypting the repository.  It is advisable to decrypt the entire repository so that the user can view all their credentials, but displaying all passwords in plain text is hardly acceptable. <br><br>  The account password is decrypted only when the user requires it.  This limits the vulnerability of the password in the RAM and on the screen. <br><br><h2>  <font color="#0071c5">Encryption algorithms</font> </h2><br>  Since our requirements for encryption are already defined, it is time to choose certain encryption algorithms, and in this regard, the existing requirements for our application significantly limit the available options.  The Tutorial Password Manager program should work both on platforms that support Intel SGX and without Intel SGX, and third-party libraries are not allowed.  This means that you must select the algorithm, key size, and size of the authentication tag, which are supported in the Windows CNG API and in the trusted encryption library Intel SGX.  In practice, this means that only one possible algorithm remains at our disposal: AES-GCM with a 128-bit key.  This is probably not the best encryption mode for use in an application, especially since the <a href="http://csrc.nist.gov/groups/ST/toolkit/BCM/documents/proposedmodes/gcm/gcm-revised-spec.pdf">128-bit GCM authentication tag's strength is less than 128 bits</a> , but for our purposes this will be enough.  Remember: our task is to create not a commercial product, but a tutorial on using Intel SGX. <br><br>  The choice of GCM affects other encryption characteristics in our application, in particular, the length of the initialization vector (12 bytes is the optimal value for this algorithm) and the tag of authenticity. <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  AES-GCM encryption algorithm <br><ul><li>  128-bit key </li><li>  128-bit authentication tag </li><li>  No additional validated data (AAD) </li><li>  96-bit initialization vectors (IV) </li></ul></li></ul></td></tr></tbody></table><br><h2>  <font color="#0071c5">Encryption keys and user authentication</font> </h2><br>  After selecting the encryption algorithm, you can go to the encryption and user authentication key.  How does a user authenticate with Password Manager to open their repository? <br><br>  The easiest way is to generate an encryption key directly from a password phrase or user password using the key generation function (KDF).  This simple approach works well, but it has one major drawback: if the user changes the password, the encryption key will also change with it.  Instead, we use a more common approach and encrypt the encryption key. <br><br>  In this case, the primary encryption key is randomly generated based on a source with high entropy and never changes.  The passphrase or user password is used to generate a secondary encryption key, and this secondary key is used to encrypt the primary key.  This approach has several important advantages: <br><br><ul><li>  Data will not have to re-encrypt when changing the password or pass phrase of the user. </li><li>  The encryption key never changes, so you can, for example, write it on paper in hexadecimal format and store it in a physically secure place.  In this case, the data can be decrypted even if the user forgets the password.  Since the key never changes, it is enough to write it down only once. </li><li>  Theoretically, you can provide data access to multiple users.  Each user will encrypt a copy of the primary key with his own passphrase. </li></ul><br>  Not all of these features are important for Tutorial Password Manager, but this is a sensible security practice. <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><ul><li>  The storage key is generated by the RDSEED instruction or by using the initial value assignment form RDRAND in systems that do not support RDSEED. </li><li>  The keystore is encrypted with the master key. </li><li>  The master key is generated from the user's password phrase using the key generation function (KDF). </li><li>  The KDF function is based on the SHA-256 algorithm. </li></ul></td></tr></tbody></table><br>  Here, the primary key is called the storage key, and the secondary key formed from the user's password phrase is called the master key.  The user is authenticated by entering his passphrase, and the password manager generates the master key from it.  If the master key successfully decrypts the repository key, the user is tested and you can decrypt the repository.  If the passphrase is incorrect, decryption of the storage key is impossible, which does not allow decrypting the storage. <br><br>  The last requirement for creating a key generation function based on the SHA-256 algorithm is due to the constraint arising from the need to use a hashing algorithm, which is supported in the Windows API CNG and in the Intel SGX encryption library. <br><br><h2>  <font color="#0071c5">Account Information</font> </h2><br>  The last of the basic requirements concerns what exactly is placed in the repository.  In this tutorial, we'll go the easy way.  In fig.  Figure 2 shows the layout of the main user interface window. <br><table><tbody><tr><td>  <b>Requirements for the solution and principles of operation</b> </td><td><br><ul><li>  The vault will contain account information including the following: <br><ul><li>  Account / Provider Name </li><li>  Account / Provider URL </li><li>  Username ID </li><li>  Authentication password </li></ul></li><li>  The storage will contain a fixed number of accounts. </li></ul></td></tr></tbody></table><br><div style="text-align:center;"><img src="https://habrastorage.org/files/080/8c6/f70/0808c6f705444547939b77de85a75fd3.png"></div><br>  <i><font color="#999999">Figure 2. A preliminary layout of the main window of the Tutorial Password Manager.</font></i> <br><br>  The last requirement is dedicated to simplifying the code.  If you fix the number of accounts in the repository, you can more easily determine the upper limit of the repository size.  This will be important when designing an enclave.  Of course, real password managers are deprived of such luxury, but in the training manual we can well afford it. <br><br><h2>  <font color="#0071c5">In further releases</font> </h2><br>  In the <a href="https://software.intel.com/en-us/articles/software-guard-extensions-tutorial-series-part-3">third part of</a> this tutorial, we will take a closer look at the Tutorial Password Manager app for Intel SGX.  We will determine the secrets, decide which parts of the application should be inside the enclave, how the enclave will interact with the main application and how the enclave affects the object model.  Follow the news! <br><br>  Read the first part of the tutorial in this series, <a href="https://habrahabr.ru/company/intel/blog/312002/">Intel Software Guard Extensions Extensions&gt; Tutorial: Part 1, Intel SGX Foundation</a> , or a list of all the published training materials in the article <a href="https://software.intel.com/en-us/articles/introducing-the-intel-software-guard-extensions-tutorial-series">Introducing the Intel Software Guard Extensions series of training materials</a> . </div><p>Source: <a href="https://habr.com/ru/post/317510/">https://habr.com/ru/post/317510/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../317498/index.html">Piggy bank knowledge for PHPixie - Part 1</a></li>
<li><a href="../317500/index.html">Memo for seed investors</a></li>
<li><a href="../317504/index.html">Another article about Docker for a beginner [nginx + php-fpm + postgresql + mongodb]</a></li>
<li><a href="../317506/index.html">Small Business Stories - Shop in Voronezh</a></li>
<li><a href="../317508/index.html">VIDEO: Atlassian User Group is visiting 1C</a></li>
<li><a href="../317512/index.html">How to choose algorithms for machine learning Microsoft Azure</a></li>
<li><a href="../317514/index.html">About metastability in electronics</a></li>
<li><a href="../317516/index.html">7 tips for a beginner entrepreneur to avoid problems (something you don‚Äôt know exactly from this)</a></li>
<li><a href="../317518/index.html">We build PVS-Studio in Eclipse CDT (macOS)</a></li>
<li><a href="../317520/index.html">‚ÄúIt's easier for us on the leaves‚Äù: why do automation projects fail in Russian companies?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>