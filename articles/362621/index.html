<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Video surveillance of a remote object on Debian + AVReg + gsm</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Maybe someone will use my solution for offline monitoring of the object. 

 I got a plot of land for building a house and had the idea to organize rem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Video surveillance of a remote object on Debian + AVReg + gsm</h1><div class="post__text post__text-html js-mediator-article">  Maybe someone will use my solution for offline monitoring of the object. <br><br>  I got a plot of land for building a house and had the idea to organize remote monitoring of it to identify outsiders (or who rummaged without me).  With the observation itself and the recording of problems, there was no problem, the problem was how to transfer the data home without having a dedicated channel (and indeed no channel at all). <br><a name="habracut"></a><br>  Task: <br>  1. To fix the movement in the frame and record; <br>  2. Expand into folders; <br>  3. Transfer home for viewing. <br><br>  There were a couple of cameras with video output, an old computer, a video capture card, a gsm-modem 1550 usb, a wish. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the software was determined quickly enough.  This is a Debian and AVReg system for fixing.  Why such a bunch?  It's simple, Windows is not suitable for budget video surveillance, not even in terms of tuning, but in terms of the hardware requirements, it requires an order of magnitude higher power.  I liked Debian with brevity, the ability to install a system without a desktop out of the box, besides Debian, I think, is more server-based after freebsd.  I chose AVReg because its installation and setup is normally described, and there are 4 free licenses (just for the garden), I would have to deal with others specifically, and I'm not such a linux specialist. <br><br>  A little about setting up AVReg.  By default, it is configured to create photos.  Motion detector forced to take a photo every 30 minutes, because  sometimes the movement may not be half a day. <br><br>  Dealt with a software, almost. <br><br>  Iron is: Celeron 2.26GHz with a motherboard, 1Gb of RAM, 40Gb hard drive, video capture card on a Bt878 chip: <br><br><img src="https://habrastorage.org/files/564/7f4/30f/5647f430f22d462d944c7fa5c3d1eb68.jpg" alt="image"><br><br>  Huawei E1550 USB Modem: <br><br><img src="https://habrastorage.org/files/114/73d/0e7/11473d0e7ffc443a9911d3a2cfbba660.jpg"><br><br>  Cameras are so unpretentious. <br><br><img src="https://habrastorage.org/files/f90/873/65b/f9087365b4914e9cafb2c8ea7898bca5.jpeg"><br><br>  As you can see, on Windows with such a configuration no decent video surveillance will fly. <br><br>  There were no problems with the installation of Debian and AVReg, all the description is on the Internet on home sites. <br><br>  Now there was a task to transfer the accumulated information to home.  Online channel 24x7 via GSM is unreal (not in our city), it turns out that the server itself should call and merge the data.  From here poured such a script, it is registered in / etc / crontab for execution every hour. <br><div class="spoiler">  <b class="spoiler_title">script</b> <div class="spoiler_text"><br>  #!  / bin / sh <br>  echo = on <br>  PATH = / bin: / usr / bin: / sbin: / usr / sbin <br><br>  sudo /etc/init.d/wvdial start <br>  sleep 15s <br><br>  kat = `date '+% m.% d.% y.% H.% M'` <br>  cd / home <br>  mkdir $ kat <br><br>  cd / var / spool / avreg / <br>  cp --parents $ (find -name * .jpg -mtime -1) / home / $ kat / <br><br>  cd / home / $ kat / <br>  sensors&gt; sensors.txt <br>  smartctl --all / dev / sda&gt; smart.txt <br>  apcaccess status&gt; ups.txt <br><br>  cd / home / <br>  tar -cvzf $ kat.tar.gz / home / $ kat <br>  rm -R / home / $ kat <br><br>  ls -l / home <br><br>  ftp -n -d "server address" &lt;&lt; INPUT_END <br>  quote USER "username" <br>  quote PASS "password" <br>  passive <br>  cd pub <br>  prompt <br>  binary <br>  mput * .tar.gz <br>  INPUT_END <br>  echo "*** PROGRAM COMPLETED" <br><br>  rm -f /home/*.tar.gz <br>  sleep 5s <br><br>  /etc/init.d/wvdial stop <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Wvdial setup</b> <div class="spoiler_text"><br>  The problem of usb gprs modems on linux, zte mf-180 and Huawei 1550. <br>  The problem is in linux, switching to modem mode does not work correctly, or rather, by default it does not work at all. <br>  Solution: in any windows we plug the modem into the port, copy the software somewhere, install the software, then the modem will switch from card reader mode to modem mode. <br>  Open the hyperterminal and select the COM port that the modem has visited. <br>  Give commands <br>  AT + ZCDRUN = Ern <br>  Or <br>  AT + ZCDRUN = 8 <br>  In response, he writes ... ... ... result (0: fail 1: success): 1 ie  we have 1 team accepted <br>  I gave both commands (just in case) the modem stopped being detected as a card reader when turned on and became immediately identified as a modem on COM ports. <br><br>  Copy wvdial.conf to / etc / and wvdial to /etc/init.d/ <br>  start /etc/init.d/wvdial start <br>  uncomment the noauth parameter in the ppp / etc / ppp / options settings <br><br><div class="spoiler">  <b class="spoiler_title">wvdial.conf settings for megaphone</b> <div class="spoiler_text">  [Dialer Defaults] <br>  Init1 = ATZ <br>  Stupid Mode = on <br>  Init3 = AT + CGDCONT = 1, "IP", "internet" <br>  Password = gdata <br><br>  Phone = * 99 *** 1 # <br><br>  New PPPD = yes <br>  Abort on Busy = off <br>  Modem Type = Analog Modem <br>  Baud = 115200 <br><br>  Modem = / dev / ttyUSB0 <br>  ISDN = 0 <br>  Username = gdata <br>  Init2 = ATQ0 V1 E1 S0 = 0 &amp; C1 &amp; D2 + FCLASS = 0 <br>  Auto Reconnect = on <br></div></div><br><br>  Settings wvdial were taken on the Internet (such as used for satellite Internet). <br><br><div class="spoiler">  <b class="spoiler_title">wvdial settings</b> <div class="spoiler_text">  #! / bin / bash <br>  echo = on <br>  case "$ 1" in <br>  start) <br>  killall wvdial <br>  killall pppd <br><br>  / usr / bin / wvdial <br><br>  ;; <br>  stop) <br><br>  killall wvdial # Not the best solution, there is where to think out <br>  killall pppd <br>  ;; <br>  esac <br><br>  exit 0 <br></div></div><br><br></div></div><br><br>  What the main script does: <br>  - starts wvdial waits 15 seconds.  For normal communication; <br>  - forms a date-time variable and creates a directory with their name in / home; <br>  - copies with selection by mask * .jpg; <br>  - sensors are also created-copied from the motherboard, smart disk and UPS status; <br>  - all this mess is packed in the archive and deleted the directory; <br>  - then the archive is transferred via FTP to a remote resource; <br>  - the archive is deleted and the communication session is closed. <br><br>  Why I did just that.  At the very beginning, I realized that for me there is no analogue to FTP, but I need to transfer a bunch of files.  I tried curlftpfs (this library connects the FTP resource as a directory in the system), but a big problem came out, a couple of files were copied and all that stuff hung.  After dancing, I decided to pack it in the archive and transfer it, I first transmitted it every 5 hours, but when 3 cameras were added, the archive size exceeded the session limit, ftp had to be transmitted more often. <br><br>  With FTP, too, there was a problem, I couldn‚Äôt find a free FTP server with a raid (I liked http://net2ftp.ru/, but it didn‚Äôt work for me with it), I had to raise my FTP server at home. <br><br>  On the home server, a bunch of small archives immediately formed, which should have been parsed, wrote a script, which neatly unpacks everything into the same directory. <br><br><div class="spoiler">  <b class="spoiler_title">unpacking script</b> <div class="spoiler_text">  #!  / bin / sh <br>  echo = on <br>  PATH = / bin: / usr / bin: / sbin: / usr / sbin <br><br>  ls * .tar.gz |  while read i;  do tar xzvf $ i home / $ {i %%. tar.gz} /smart.txt home / $ {i %%. tar.gz} /sensors.txt home / $ {i %%. tar.gz} / up $ <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i home / $ {i %%. tar.gz} /sensors.txt;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i home / $ {i %%. tar.gz} /ups.txt;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i home / $ {i %%. tar.gz} / syslog;  done <br><br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-04;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-05;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-06;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-07;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-08;  done <br>  #ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-09;  done <br>  ls * .tar.gz |  while read i;  do tar xzvf $ i --strip-components = 2 home / $ {i %%. tar.gz} / 2014-10;  done <br></div></div><br><br>  Results: the scheme has been operating for 2 years, there are no fundamental failures (except for problems with iron, energy).  I am satisfied and I get these shots. <br><br>  There are plans to add Arduino as a meteorological station and, of course, build a smart home (with sensors, automatic, autonomous, for the soul and a comfortable life). <br><br><img src="https://habrastorage.org/files/201/9e9/4d5/2019e94d5ba0418995abbfd141d34ee3.jpg"><br><img src="https://habrastorage.org/files/5bb/7bb/45f/5bb7bb45f8974488aa7ecafe3de0993e.jpg"><br><img src="https://habrastorage.org/files/a5f/77e/278/a5f77e2786a54d569f750c199441e9c2.jpg"></div><p>Source: <a href="https://habr.com/ru/post/362621/">https://habr.com/ru/post/362621/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../362605/index.html">To the first soft landing on a comet</a></li>
<li><a href="../362609/index.html">E-book for reading fans</a></li>
<li><a href="../362615/index.html">Issue Model X was moved to the third quarter of 2015</a></li>
<li><a href="../362617/index.html">AppleInternal and some other stuff or Apple development from the inside</a></li>
<li><a href="../362619/index.html">A bright flash of supernova lit up the sky of the planet Earth in 1006 AD</a></li>
<li><a href="../362623/index.html">Working with ESP8266: Initial Setup, Firmware Update, Wi-Fi Communication, Send-Receive Data to PC</a></li>
<li><a href="../362627/index.html">Discussion of the film "Interstellar"</a></li>
<li><a href="../362629/index.html">Lechal insoles smart insoles overview</a></li>
<li><a href="../362633/index.html">Your virtual girl of the future</a></li>
<li><a href="../362635/index.html">Scientists are looking for time travelers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>