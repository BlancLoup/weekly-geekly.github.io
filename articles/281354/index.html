<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementation of monitoring and integration testing information system using Scalatest. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article, Implementing Monitoring and Integration Testing of an Information System Using Scalatest, we talked about creating a project ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementation of monitoring and integration testing information system using Scalatest. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/5c2/a83/934/5c2a8393461544c19d2e5c34dc8e25bc.jpg"><br><br>  In the previous article, <a href="https://habrahabr.ru/company/cit/blog/269293/">Implementing Monitoring and Integration Testing of an Information System Using Scalatest,</a> we talked about creating a project in Idea and writing simple tests.  In this part, we will look at some of the features of the framework, as well as techniques for solving problems arising during the writing of tests. <br>  Let's take a closer look at the specifics of running tests, analyze the details of generating reports, how to work with Selenium, and also pay attention to timeouts, expectations, calls to the operating system commands, generation of a jar file with tests. <br><a name="habracut"></a><br><h5>  <b>Features run tests</b> </h5><br>  To launch a separate class, launch it from Idea, or execute the testOnly command in the console with indication of the classes. <br><pre><code class="scala hljs">sbt <span class="hljs-string"><span class="hljs-string">"testOnly org.example.MyTest1 org.example.MyTest2"</span></span></code> </pre> <br>  You can use the symbol *, for example <br><pre> <code class="scala hljs">sbt <span class="hljs-string"><span class="hljs-string">"testOnly *MyTest*"</span></span></code> </pre><br>  Run all the tests that contain the name "MyTest" <br>  By default, all classes run in parallel.  We can use the option in build.sbt <br><pre> <code class="scala hljs">parallelExecution in <span class="hljs-type"><span class="hljs-type">Test</span></span> := <span class="hljs-literal"><span class="hljs-literal">false</span></span></code> </pre><br>  Which will make the execution consistent. <br>  For more information <a href="http://www.scala-sbt.org/0.13/docs/Testing.html">www.scala-sbt.org/0.13/docs/Testing.html</a> <br><br><h5>  <b>Creating report files</b> </h5><br>  In order for reports to be generated after passing the tests, you need to add test launch arguments.  Arguments can be found at <a href="http://scalatest.org/user_guide/using_the_runner">scalatest.org/user_guide/using_the_runner</a> .  Not all of them work to run from sbt, you need to experiment. <br>  We supplement in build.sbt parameter for the library of the greatest% "test -&gt; *" <br><pre> <code class="scala hljs">libraryDependencies += <span class="hljs-string"><span class="hljs-string">"org.scalatest"</span></span> % <span class="hljs-string"><span class="hljs-string">"scalatest_2.11"</span></span> % <span class="hljs-string"><span class="hljs-string">"2.2.6"</span></span> % <span class="hljs-string"><span class="hljs-string">"test-&gt;*"</span></span></code> </pre><br>  Add a string with parameters <br><pre> <code class="scala hljs">(testOptionsinTest) += <span class="hljs-type"><span class="hljs-type">Tests</span></span>.<span class="hljs-type"><span class="hljs-type">Argument</span></span>(<span class="hljs-type"><span class="hljs-type">TestFrameworks</span></span>.<span class="hljs-type"><span class="hljs-type">ScalaTest</span></span>, <span class="hljs-string"><span class="hljs-string">"-hD"</span></span>, <span class="hljs-string"><span class="hljs-string">"report"</span></span>, <span class="hljs-string"><span class="hljs-string">"-fW"</span></span>, <span class="hljs-string"><span class="hljs-string">"report.txt"</span></span>)</code> </pre><br>  At the same time, after running the test, we will have an output of html ("-h") report indicating the execution time ("D") in the folder "report" and the text report file ("f") without specifying the color ("W" , ANSI Color codes in the file are correctly displayed in Linux systems, in Windows crutches are needed) <br>  In order for the report to be generated in UTF8 encoding, there were no problems with Russian characters in Windows, it is recommended to add an option to sbt \ conf \ sbtconfig.txt <br><pre> <code class="scala hljs">-<span class="hljs-type"><span class="hljs-type">Dfile</span></span>.encoding=<span class="hljs-type"><span class="hljs-type">UTF8</span></span></code> </pre><br><img src="https://habrastorage.org/files/36e/bb5/b16/36ebb5b16b1d4a9ab32eff3cbf198ee4.png"><br>  In the folder with the report will be the file index.html, as well as several .html files - one for each class.  In theory, you can use Russian characters in class names, but sometimes there are problems with opening &lt;RussianTestClass&gt; .html files. <br>  Let's slightly change the GetTest class by adding methods for saving a screenshot and inserting it into a report. <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.openqa.selenium.<span class="hljs-type"><span class="hljs-type">WebDriver</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.openqa.selenium.firefox.<span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.selenium.<span class="hljs-type"><span class="hljs-type">WebBrowser</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.{<span class="hljs-type"><span class="hljs-type">Matchers</span></span>, <span class="hljs-type"><span class="hljs-type">FreeSpec</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.io.<span class="hljs-type"><span class="hljs-type">Source</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GetTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebBrowser</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://scalatest.org/about"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span></span>(url: <span class="hljs-type"><span class="hljs-type">String</span></span>) = <span class="hljs-type"><span class="hljs-type">Source</span></span>.fromURL(url, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>).mkString <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webDriver: <span class="hljs-type"><span class="hljs-type">WebDriver</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span>() <span class="hljs-comment"><span class="hljs-comment">//      setCaptureDir("report") "Get   " + pageURL + "   " in { get(pageURL) should include("&lt;title&gt;ScalaTest&lt;/title&gt;") } "  %s   ".format(pageURL) in { go to pageURL pageTitle should be ("ScalaTest") //   capture to ("MyScreenShot.png") //    markup("&lt;a href=\"http://scalatest.org/about\"&gt; &lt;/a&gt;") markup("&lt;img src='MyScreenShot.png' /&gt; ") } " " in { quit() } }</span></span></code> </pre><br>  Perform in console <br><pre> <code class="scala hljs">sbt <span class="hljs-string"><span class="hljs-string">"testOnly GetTest"</span></span></code> </pre><br>  After passing the test, the file ‚Äúreport.txt‚Äù in the project root and the folder ‚Äúreport‚Äù with the files for the HTML report will be formed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/cbb/f1a/c6f/cbbf1ac6fb31464482ddddefafd69951.png"><br><br>  It should be clarified that the result of the script steps will not be displayed in the console - only the results. <br>  When you open the report will see a screenshot of the page <br><br><img src="https://habrastorage.org/files/f7a/a27/902/f7aa2790253d4bfc833ee91d0a57558b.png"><br><br>  In this and further examples from Selenium, closing the browser will be a separate step. <br><pre> <code class="scala hljs"> <span class="hljs-string"><span class="hljs-string">" "</span></span> in { quit() }</code> </pre><br>  It is necessary that the step be executed last.  If you write a closing command in the class body, it will be executed before the beginning of the steps and an error will occur.  A little later we will look at how to make the execution of commands after all the steps have been completed. <br><br><h5>  <b>Expectations</b> </h5><br>  There are situations when a test crashes because there is no object to be checked ... For example, a record in the database appears a few seconds after an event or an element on a web page does not appear immediately, but after a script has been processed on the client. <br>  In this case, you can use a pause (for example, the Thread.sleep (1000) command will suspend code execution for 1 second), but it is better to use it eventually. <br>  Eventually - allows you to periodically perform a block of operations until the passage is successful, or the time runs out. <br>  Consider an example: <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenScalatest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebBrowser</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webDriver: <span class="hljs-type"><span class="hljs-type">WebDriver</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"https://www.google.ru/"</span></span> <span class="hljs-string"><span class="hljs-string">"  ScalaTest"</span></span> in { go to pageURL textField(<span class="hljs-string"><span class="hljs-string">"q"</span></span>).value = <span class="hljs-string"><span class="hljs-string">"ScalaTest"</span></span> clickOn(<span class="hljs-string"><span class="hljs-string">"btnG"</span></span>) } <span class="hljs-string"><span class="hljs-string">"  'ScalaTest'"</span></span> in { click on partialLinkText(<span class="hljs-string"><span class="hljs-string">"ScalaTest"</span></span>) } <span class="hljs-string"><span class="hljs-string">" "</span></span> in { quit() } }</code> </pre><br>  The example searches Google for the ScalaTest page and goes to it. <br>  The test will fail with the error "WebElement 'ScalaTest' not found." <br><br>  The problem is that the driver considers the page loaded after all resources have loaded.  But does not take into account the fact that the element can be formed on the client after loading the page. <br>  Wrap the step of clicking on the link in the block Eventually.  To do this, we mix the treyt into the class definition. <br>  "With Eventually" <br>  Import components to work with time <br><pre> <code class="scala hljs"><span class="hljs-type"><span class="hljs-type">Import</span></span> org.scalatest.time.<span class="hljs-type"><span class="hljs-type">SpanSugar</span></span>._</code> </pre><br>  Override the parameters Eventually <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> patienceConfig = <span class="hljs-type"><span class="hljs-type">PatienceConfig</span></span>(timeout = (<span class="hljs-number"><span class="hljs-number">2</span></span> seconds), interval = (<span class="hljs-number"><span class="hljs-number">250</span></span> millis))</code> </pre><br>  And we wrap up a step into the waiting <br><pre> <code class="scala hljs">eventually{clickonpartialLinkText(<span class="hljs-string"><span class="hljs-string">"ScalaTest"</span></span>)}</code> </pre><br>  As a result, we get <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OpenScalatest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebBrowser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Eventually</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webDriver: <span class="hljs-type"><span class="hljs-type">WebDriver</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"https://www.google.ru/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> patienceConfig = <span class="hljs-type"><span class="hljs-type">PatienceConfig</span></span>(timeout = (<span class="hljs-number"><span class="hljs-number">2</span></span> seconds), interval = (<span class="hljs-number"><span class="hljs-number">250</span></span> millis)) <span class="hljs-string"><span class="hljs-string">"  ScalaTest"</span></span> in { go to pageURL textField(<span class="hljs-string"><span class="hljs-string">"q"</span></span>).value = <span class="hljs-string"><span class="hljs-string">"ScalaTest"</span></span> clickOn(<span class="hljs-string"><span class="hljs-string">"btnG"</span></span>) } <span class="hljs-string"><span class="hljs-string">"  'ScalaTest'"</span></span> in { eventually{click on partialLinkText(<span class="hljs-string"><span class="hljs-string">"ScalaTest"</span></span>)} } <span class="hljs-string"><span class="hljs-string">" "</span></span> in { quit() } }</code> </pre><br>  Thus, we implement polling - periodic resource polling for the purpose of checking readiness. <br>  Now every 250 milliseconds the presence of the element is checked, if it does not appear in 2 seconds - the test will drop. <br>  For more information: <a href="http://doc.scalatest.org/2.2.6/index.html">doc.scalatest.org/2.2.6/index.html#org.scalatest.concurrent.Eventually</a> <br><br>  There are cases where a block of code can run for a very long time, and we need to limit the execution time.  Use the Timeouts Treyt, which contains the failAfter and cancelAfter commands. <br>  For example, if the page loads for more than 5 seconds - we believe that an error has occurred. <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DevianArt</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebBrowser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Timeouts</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webDriver: <span class="hljs-type"><span class="hljs-type">WebDriver</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.deviantart.com/"</span></span> <span class="hljs-string"><span class="hljs-string">"  %sc   "</span></span>.format(pageURL) in { failAfter(<span class="hljs-number"><span class="hljs-number">5</span></span> seconds){ go to (pageURL)} } <span class="hljs-string"><span class="hljs-string">" "</span></span> in { quit() } }</code> </pre><br>  More on the page <br>  <a href="http://doc.scalatest.org/2.2.6/index.html">doc.scalatest.org/2.2.6/index.html#org.scalatest.concurrent.Timeouts</a> <br>  Thus it is possible to limit the waiting time for responses. <br><br><h5>  <b>Performing actions before and after test steps</b> </h5><br>  In some cases, there is a need to perform some actions before performing the test steps, after performing the test steps, before or after each step. <br>  For this we use the traits BeforeAndAfterAll and BeforeAndAfter <br>  Consider an example in which after each test step a screenshot is executed, and after all steps the browser closes <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CreateScalatestCaptures</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">WebBrowser</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeAndAfter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeforeAndAfterAll</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> webDriver: <span class="hljs-type"><span class="hljs-type">WebDriver</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">FirefoxDriver</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> pageURL = <span class="hljs-string"><span class="hljs-string">"http://www.scalatest.org/"</span></span> setCaptureDir(<span class="hljs-string"><span class="hljs-string">"report"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//      TimeStamp      def createScreenCaptureToReport(fileName: String = System.currentTimeMillis + ".png"): Unit = { captureTo(fileName) markup("&lt;img src='" + fileName + "' width='50%' /&gt; ") } "  %s".format(pageURL) in { go to pageURL } "  'Quick Start'" in { click on partialLinkText("Quick Start") } //      after{ createScreenCaptureToReport() } //     override def afterAll(){ quit() } }</span></span></code> </pre><br><br><h5>  <b>A small addition about Selenium</b> </h5><br>  Scaletest includes SeleniumDSL, examples of which were discussed above.  On the page <br>  <a href="http://scalatest.org/user_guide/using_selenium">scalatest.org/user_guide/using_selenium</a> <br>  It contains a pretty good description, but there are a few points that can be further voiced. <br>  In some cases, you need to control the size of the browser window.  This is done using the interface <br><pre> <code class="scala hljs">webDriver.manage().window()</code> </pre><br>  For example, <br><pre> <code class="scala hljs">webDriver.manage().window().maximize()</code> </pre><br>  make the window maximized (by default, the browser is run in windowed mode), or <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browserDimension = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> org.openqa.selenium.<span class="hljs-type"><span class="hljs-type">Dimension</span></span>(<span class="hljs-number"><span class="hljs-number">1920</span></span>,<span class="hljs-number"><span class="hljs-number">2160</span></span>) webDriver.manage().window().setSize(browserDimension)</code> </pre><br>  Generates a window of 1920 * 2160 <br><br>  To switch between windows, use the code <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> arr = windowHandles.toArray switch to window(arr(<span class="hljs-number"><span class="hljs-number">1</span></span>))</code> </pre><br>  After running in the console, we get a beautiful report with two screenshots. <br>  It should be noted that the generation of images with a unique name will produce files with each launch.  It is necessary to take this into account and periodically clean up the directory with files. <br><br>  There is also the possibility of tracking errors in the browser console. <br>  Need to import <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.openqa.selenium.logging.{<span class="hljs-type"><span class="hljs-type">LogType</span></span>, <span class="hljs-type"><span class="hljs-type">LoggingPreferences</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.openqa.selenium.remote.{<span class="hljs-type"><span class="hljs-type">CapabilityType</span></span>, <span class="hljs-type"><span class="hljs-type">DesiredCapabilities</span></span>}</code> </pre><br>  In the place where we declare the browser, add the line <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> logPref: <span class="hljs-type"><span class="hljs-type">LoggingPreferences</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">LoggingPreferences</span></span>() logPref.enable(<span class="hljs-type"><span class="hljs-type">LogType</span></span>.<span class="hljs-type"><span class="hljs-type">BROWSER</span></span>, <span class="hljs-type"><span class="hljs-type">Level</span></span>.<span class="hljs-type"><span class="hljs-type">SEVERE</span></span>)<span class="hljs-comment"><span class="hljs-comment">//   "SEVERE" val capability = DesiredCapabilities.firefox() capability.setCapability(CapabilityType.LOGGING_PREFS, logPref) implicit val webDriver: WebDriver = new FirefoxDriver(capability)//      </span></span></code> </pre><br>  In the step code, we write to output the logs to the report. <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> browserLogs = webDriver.manage().logs().get(<span class="hljs-type"><span class="hljs-type">LogType</span></span>.<span class="hljs-type"><span class="hljs-type">BROWSER</span></span>).getAll.toArray browserLogs.foreach(x=&gt; markup(<span class="hljs-string"><span class="hljs-string">"&lt;q&gt;%s&lt;/q&gt;"</span></span>.format(x)))</code> </pre><br>  If we want the step to be filed when there are errors in the logs - we add <br><pre> <code class="scala hljs">browserLogs.size should be (<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br><h5>  <b>Running OS commands</b> </h5><br>  Sometimes it may be necessary to execute some commands of the OS on which the test is run. <br>  The following example shows how to check the amount of free disk space and how to check the availability of a host with the ping command. <br>  For this, a separate CMDUtils object has been created, in which the OS is detected and the commands are executed. <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.math._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.sys.process._ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CMDUtils</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Exception</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> os = <span class="hljs-type"><span class="hljs-type">System</span></span>.getProperty(<span class="hljs-string"><span class="hljs-string">"os.name"</span></span>).substring(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">freeSpace</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">Long</span></span> = { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> cmd: <span class="hljs-type"><span class="hljs-type">Seq</span></span>[<span class="hljs-type"><span class="hljs-type">String</span></span>] = <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-comment"><span class="hljs-comment">// ,       os match { case "Win" =&gt; cmd = Seq("powershell", "-command ", "(fsutil volume diskfree c:).split(' ')[-1]") case "Lin" =&gt; cmd = Seq("/bin/sh", "-c", "df / -B1 | sed -n 2p | awk '{print $4}'") case _ =&gt; throw new Exception("  ") } //        val output = cmd.!! //           output.trim.toLong/pow(1024,3).toLong } def pingHost(host: String): Boolean = { var cmd: Seq[String] = null os match { case "Win" =&gt; cmd = Seq("powershell", "-command ", "ping %s | Out-Null ; echo $?".format(host)) case "Lin" =&gt; cmd = Seq("/bin/sh", "-c", "ping %s -c 4 &amp;&gt; /dev/null; if (($?==0)); then echo true; else echo false; fi".format(host)) case _ =&gt; throw new Exception("  ") } //     true/false cmd.!!.trim.toBoolean } }</span></span></code> </pre><br><br>  Then the object's methods are called from the test. <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CMDExecute</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FreeSpec</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Matchers</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> limit: <span class="hljs-type"><span class="hljs-type">Long</span></span> = <span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-comment"><span class="hljs-comment">//    "    %s   ".format(limit) in { CMDUtils.freeSpace should be &gt; limit } var host1 = "8.8.8.194" "   %s".format(host1) in { CMDUtils.pingHost(host1) should be(true) } var host2 = "8.8.8.8" "   %s".format(host2) in { //     "true" assert(CMDUtils.pingHost(host2)) } }</span></span></code> </pre><br>  Also, using OS commands, it is possible to send test results to the zabbix server using the zabbix_sender utility. <br>  To perform complex operations (query to the database, send / receive messages from the queue manager, parse or form XML), a separate object is written, or a class whose methods are called in the test. <br><br><h5>  <b>Creating an executable jar file</b> </h5><br>  In some cases, it makes sense to run tests not from the project, but as a separate jar file with all dependencies.  Each time you run the "sbt test" command, the project files are compiled.  If there were no changes, then it takes some time to check for this.  Building a jar will allow you not to spend time on compiling / assembling each test run, but to create a jar and run the test each time without compiling.  The dependencies included in the file will allow you to run the test on any machine where java is present. <br>  By default, the jar file does not include tests, so it is necessary to ensure the launch of test classes from the main code. <br>  To do this, change the scope for the library, removing the indication "test -&gt; *" <br><pre> <code class="scala hljs">libraryDependencies += <span class="hljs-string"><span class="hljs-string">"org.scalatest"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scalatest_2.11"</span></span> % <span class="hljs-string"><span class="hljs-string">"2.2.6"</span></span></code> </pre><br>  If there is no explicit indication, then this is the ‚Äúcompile‚Äù configuration. <br>  Learn more at <a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html">maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html</a> <br>  It is also necessary to add a dependency, without which it will not be possible to create an html report. <br><pre> <code class="scala hljs"> libraryDependencies += <span class="hljs-string"><span class="hljs-string">"org.pegdown"</span></span> % <span class="hljs-string"><span class="hljs-string">"pegdown"</span></span> % <span class="hljs-string"><span class="hljs-string">"1.6.0"</span></span></code> </pre><br>  Next, you need to move the files with test classes from the src / test / scala folder to the src / main / scala folder <br>  After that we create an object, let's call it MainApp, which will run our tests. <br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatest.tools.<span class="hljs-type"><span class="hljs-type">Runner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span></span>{ <span class="hljs-type"><span class="hljs-type">Runner</span></span>.run(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"-s"</span></span>, <span class="hljs-string"><span class="hljs-string">"TestClass"</span></span>, <span class="hljs-string"><span class="hljs-string">"-h"</span></span>, <span class="hljs-string"><span class="hljs-string">"report"</span></span>)) }</code> </pre><br>  The class runs the runner method of the Runner object to which parameters are passed. <br>  -s - the name of the test class to run <br>  -h - folder for the html report <br><br>  Other options can be found <a href="http://www.scalatest.org/user_guide/using_the_runner">http://www.scalatest.org/user_guide/using_the_runner</a> <br><br>  After that, run sbt run, the test from the class should go through and form a folder with the report and a file with the report. <br>  After the tests are run with the run command, you can build a jar file with dependencies. <br>  To do this, add the plugin <a href="https://github.com/sbt/sbt-assembly">github.com/sbt/sbt-assembly</a> <br><br>  Add the line in the project / plugins.sbt file <br><pre> <code class="scala hljs">addSbtPlugin(<span class="hljs-string"><span class="hljs-string">"com.eed3si9n"</span></span> % <span class="hljs-string"><span class="hljs-string">"sbt-assembly"</span></span> % <span class="hljs-string"><span class="hljs-string">"0.14.1"</span></span>)</code> </pre><br>  After updating the project when executing the command <br><pre> <code class="scala hljs">sbt assembly</code> </pre><br>  a jar file will be generated in the target / scala-2.11 directory <br>  Running it with the command java -jar .jar we get the test execution and report generation. <br><br>  It is possible to form a file in the root of the project, specifying in build.sbt <br><pre> <code class="scala hljs">assemblyOutputPath in assembly := baseDirectory.value / <span class="hljs-string"><span class="hljs-string">"tests.jar"</span></span></code> </pre><br>  The use of this approach is acceptable when the build runs frequently and rarely changes, or when you need to quickly run a test on another machine, where dependencies for the build will take a long time to download or there is no Internet.  Of the minuses can be noted a large file size.  (40 mb for a test using firefox driver, for example) and some time building a jar file. <br><br>  If it is necessary that when the tests fail, there is a special exit code (for example, the assembly on the CI server drops), then you need to install the code, checking the value returned by the runner <br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainApp</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> res = <span class="hljs-type"><span class="hljs-type">Runner</span></span>.run(<span class="hljs-type"><span class="hljs-type">Array</span></span>(<span class="hljs-string"><span class="hljs-string">"-s"</span></span>, <span class="hljs-string"><span class="hljs-string">"TestClass"</span></span>, <span class="hljs-string"><span class="hljs-string">"-h"</span></span>, <span class="hljs-string"><span class="hljs-string">"report"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!res) sys.exit(<span class="hljs-number"><span class="hljs-number">1</span></span>) }</code> </pre><br><br>  Also, tests have the ability to reuse code.  For example, creating an instance of the browser, opening up after passing the test, authorization on the site can be divided into a separate treit, from which test classes are inherited. <br>  For configuration, you can use the config component from typesafe ( <a href="https://github.com/typesafehub/config">https://github.com/typesafehub/config</a> ) <br><br>  Thus, the basic techniques of working with the library were considered, which allow writing convenient, universal automated tests. <br>  Beyond that were fixtures, mock objects, property-based testing, table-driven testing, the use of Sikuli, java Robot to automate UI testing, and many, many other tasty buns. <br>  One of the key advantages of the framework is the availability of quality documentation with examples.  This makes learning and using the framework a pleasant and effective one. <br>  The advantages of this technology stack are confirmed by the successful experience of using in our company. </div><p>Source: <a href="https://habr.com/ru/post/281354/">https://habr.com/ru/post/281354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../281342/index.html">JavaScript goes beyond the Web in 2015</a></li>
<li><a href="../281344/index.html">What criteria are important for a large client when choosing an agency for web development?</a></li>
<li><a href="../281346/index.html">Dilute asynchronous programming functionality on Scala</a></li>
<li><a href="../281350/index.html">Haordic Organization Visa (Part 1)</a></li>
<li><a href="../281352/index.html">Superscalar Stacking Processor: Optimization</a></li>
<li><a href="../281356/index.html">Simple automation of the management of acts of marriage on SharePoint with examples and pictures</a></li>
<li><a href="../281358/index.html">JetBrains is looking for a technical evangelist with Java experience</a></li>
<li><a href="../281360/index.html">.Net Client for mail.ru cloud</a></li>
<li><a href="../281362/index.html">New Cisco Aironet IEEE 802.11ac Wave 2 Access Points</a></li>
<li><a href="../281370/index.html">Leaks do not violate memory safety</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>