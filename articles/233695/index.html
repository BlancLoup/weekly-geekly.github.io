<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The implementation of the tag system in the admin with the SonataAdminBundle bundle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many use the SonataAdminBundle bundle when developing on Symfony2. This bundle allows you to quickly create a CRUD admin panel for Doctrine and Mongo ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The implementation of the tag system in the admin with the SonataAdminBundle bundle</h1><div class="post__text post__text-html js-mediator-article">  Many use the SonataAdminBundle <a href="https://github.com/sonata-project/SonataAdminBundle">bundle</a> when developing on Symfony2.  This bundle allows you to quickly create a CRUD admin panel for Doctrine and Mongo entities.  In particular, it allows you to quickly and easily make pages for adding entities, including one-to-many and many-to-many links.  Here I have problems with the last point.  In this article, I will show you how to organize the installation of tags for several entities, using just one intermediate table, using the <a href="http://knpbundles.com/FabienPennequin/FPNTagBundle">FPNTagBundle</a> bundle, and what I had to do to make this bundle work in SonataAdmin.  But first we will look at how to implement entity editing (including tags) on a simple SonataAdmin <br><a name="habracut"></a><br><h4>  Simple tag implementation </h4><br>  There are several entities in the current project (let's call them Article and News, although there are seven of them in this project), which should be given the opportunity to tag, moreover, one entity can have multiple tags, that is, many-to-many relationships are realized. <br>  First, let's look at how to edit tags in the admin panel without the FPNTagBundle bundle.  I made a parent entity, from which all the others are inherited: <br><div class="spoiler">  <b class="spoiler_title">Entity Base Entity</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">//   ORM\Entity -             class Entity { /** * @var integer * @ORM\Id * @ORM\Column(type="integer") * @ORM\GeneratedValue(strategy="AUTO") */ protected $id; /** * @var boolean * @ORM\Column(type="boolean", options={"default":false}) */ protected $published = false; /** * @var string * @ORM\Column(type="string", length=255) */ protected $title; /** * @var string * @ORM\Column(type="text") */ protected $content; //   /** * Get id * @return integer */ public function getId() { return $this-&gt;id; } /** * Set published * @param boolean $published * @return Entity */ public function setPublished($published) { $this-&gt;published = $published; return $this; } /** * Toggle published * @return Entity */ public function togglePublished() { $this-&gt;published = !$this-&gt;published; return $this; } /** * Get published * @return boolean */ public function getPublished() { return $this-&gt;published; } /** * Set title * @param string $title * @return Entity */ public function setTitle($title) { $this-&gt;title = $title; return $this; } /** * Get title * @return string */ public function getTitle() { return $this-&gt;title; } /** * Set content * @param string $content * @return Entity */ public function setContent($content) { $this-&gt;content = $content; return $this; } /** * Get content * @return string */ public function getContent() { return $this-&gt;content; } }</span></span></code> </pre> <br></div></div><br>  Two editable entities: <br><div class="spoiler">  <b class="spoiler_title">Entity Article</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Collections</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayCollection</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ArrayCollection * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\ManyToMany(targetEntity="Tag", inversedBy="articles") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\JoinTable(name="article_tags") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $tags; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> ArrayCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags ?: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayCollection(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tag $tag)</span></span></span><span class="hljs-function"> </span></span>{ $tag-&gt;addArticle(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags[] = $tag; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tag $tag)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags-&gt;removeElement($tag); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Essence News</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Collections</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayCollection</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \DateTime * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="datetime", nullable=true) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $publishedAt; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> ArrayCollection * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\ManyToMany(targetEntity="Tag", inversedBy="news") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\JoinTable(name="news_tags") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $tags; <span class="hljs-comment"><span class="hljs-comment">/** * Set publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \DateTime $publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> News */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPublishedAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($publishedAt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publishedAt = $publishedAt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Get publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \DateTime */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPublishedAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publishedAt; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> ArrayCollection */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTags</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags ?: <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayCollection(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tag $tag)</span></span></span><span class="hljs-function"> </span></span>{ $tag-&gt;addArticle(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags[] = $tag; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeTag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tag $tag)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;tags-&gt;removeElement($tag); } }</code> </pre><br></div></div><br>  And the essence of the tags: <br><div class="spoiler">  <b class="spoiler_title">Essence Tag</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Collections</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayCollection</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tag</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;articles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayCollection(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;news = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayCollection(); } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> integer $id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> string * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="string", length=100) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $name; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\ManyToMany(targetEntity="Article", mappedBy="tags") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $articles; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\ManyToMany(targetEntity="News", mappedBy="tags") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> $news; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addArticle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Article $article)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;articles[] = $article; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addNews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(News $news)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;news[] = $news; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getArticles</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;articles; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNews</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;news; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> integer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> string $name * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> Tag */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name = $name; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;name; } }</code> </pre><br></div></div><br>  You can see that the two entities Article and News differ only in the name of the table in the Many-to-Many relationship.  And the presence of an additional field in the News, which at the moment is not significant. <br><br>  In the Doctrine, the Many-to-Many relationship is established very easily, at the level of a couple of lines in the annotation.  Those who have worked with Doctrine have already seen this simplicity.  An intermediate table is automatically created.  Having established such a link for each entity, it is easy to configure adding tags for entities in the Sonata admin panel: <br><div class="spoiler">  <b class="spoiler_title">Basic admin for entities</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">ListMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">DatagridMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">FormMapper</span></span>; <span class="hljs-comment"><span class="hljs-comment">//      Admin,  Sonata       class EntityAdminBase extends Admin { protected function configureFormFields(FormMapper $formMapper) { $formMapper -&gt;add('title', 'text') -&gt;add('content', 'ckeditor') -&gt;add('tags', 'entity', array( 'class'=&gt;'AppBundle:Tag', 'multiple' =&gt; true, 'attr'=&gt;array('style'=&gt;'width: 100%;')) ) //  width: 100%      Select2-, //    ,      ; } protected function configureDatagridFilters(DatagridMapper $datagridMapper) { $datagridMapper -&gt;add('title') -&gt;add('tags', null, array(), null, array('multiple' =&gt; true)) ; } protected function configureListFields(ListMapper $listMapper) { $listMapper -&gt;addIdentifier('title') -&gt;add('published') ; } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Admin Article</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">ListMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">DatagridMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">FormMapper</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ArticleAdmin</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityAdminBase</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Admin News</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>\<span class="hljs-title"><span class="hljs-title">Admin</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">ListMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">DatagridMapper</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">FormMapper</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NewsAdmin</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityAdminBase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureFormFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FormMapper $formMapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::configureFormFields($formMapper); $formMapper -&gt;add(<span class="hljs-string"><span class="hljs-string">'publishedAt'</span></span>, <span class="hljs-string"><span class="hljs-string">'datetime'</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureListFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ListMapper $listMapper)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::configureListFields($listMapper); $listMapper -&gt;add(<span class="hljs-string"><span class="hljs-string">'publishedAt'</span></span>) ; } }</code> </pre><br></div></div><br>  As you can see, the fields common to entities are moved to the parent class, and specific to the specific entity are added in each admin area.  It remains only to register services for admins: <br><div class="spoiler">  <b class="spoiler_title">Setting up admin services</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"># /src/App/AppBundle/Resources/config/<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>.yml services: sonata.<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>.article: <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>: App\AppBundle\<span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span>\ArticleAdmin tags: - { <span class="hljs-type"><span class="hljs-type">name</span></span>: sonata.<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>, manager_type: orm, <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>: "Content", label: "Articles" } arguments: - ~ - App\AppBundle\Entity\Article - ~ calls: - [ setTranslationDomain, [<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>]] sonata.<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>.news: <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>: App\AppBundle\<span class="hljs-keyword"><span class="hljs-keyword">Admin</span></span>\NewsAdmin tags: - { <span class="hljs-type"><span class="hljs-type">name</span></span>: sonata.<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>, manager_type: orm, <span class="hljs-keyword"><span class="hljs-keyword">group</span></span>: "Content", label: "News" } arguments: - ~ - App\AppBundle\Entity\News - ~ calls: - [ setTranslationDomain, [<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>]] #         # /app/config/config.yml imports: - { resource: parameters.yml } - { resource: <span class="hljs-keyword"><span class="hljs-keyword">security</span></span>.yml } - { resource: @AppBundle/Resources/config/<span class="hljs-keyword"><span class="hljs-keyword">admin</span></span>.yml }</code> </pre><br></div></div><br>  That's all, the sonata will automatically create everything you need to edit lists of articles and news. <br><br><h4>  Store tag associations and entities in a single table </h4><br>  And everything worked fine until I noticed that a separate table is created for each entity for organizing the Many-to-Many connection with tags.  (If I had only a couple of such entities, I would probably not be steamed with this, but in this case I did not want to create seven different tables, and then also organize a search on these tables.) To solve, I found the <a href="http://knpbundles.com/FabienPennequin/FPNTagBundle">FPNTagBundle</a> bundle , which breaks a many-to-many relationship into two many-to-one and one-to-many connections by introducing the intermediate entity Tagging.  In general, this separation is implemented in DoctrineExtentions, and the bundle adds their integration into Symfony and implements the TagManager class.  An excellent bundle that does the obvious thing is to make one table with an additional field ResourceType - the type of record to which the tag is bound.  The problem is that Sonata does not support such connections, and it is also just impossible to implement the admin panel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But let's consider what changes have been made to the entities: <br><div class="spoiler">  <b class="spoiler_title">Entity Base Entity</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">Common</span></span>\<span class="hljs-title"><span class="hljs-title">Collections</span></span>\<span class="hljs-title"><span class="hljs-title">ArrayCollection</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   //     //   -   ! protected $tags; public function getTags() { return $this-&gt;tags ?: $this-&gt;tags = new ArrayCollection(); } public function getTaggableType() { //        ( ) return substr(strrchr(get_class($this), "\\"), 1); } public function getTaggableId() { return $this-&gt;getId(); } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Entity Article</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Article</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Essence News</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">News</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Entity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \DateTime * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(type="datetime", nullable=true) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $publishedAt; <span class="hljs-comment"><span class="hljs-comment">/** * Set publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> \DateTime $publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> News */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPublishedAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($publishedAt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publishedAt = $publishedAt; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Get publishedAt * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \DateTime */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPublishedAt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;publishedAt; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Changed Tag Entity</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> \<span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> \<span class="hljs-title"><span class="hljs-title">FPN</span></span>\<span class="hljs-title"><span class="hljs-title">TagBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Tag</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseTag</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tag</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseTag</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="id", type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\OneToMany(targetEntity="Tagging", mappedBy="tag", fetch="EAGER") **/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $tagging; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> integer */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;id; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Essence Tagging</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span>\<span class="hljs-title"><span class="hljs-title">UniqueConstraint</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> \<span class="hljs-title"><span class="hljs-title">FPN</span></span>\<span class="hljs-title"><span class="hljs-title">TagBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Tagging</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">BaseTagging</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table(uniqueConstraints={</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@UniqueConstraint</span></span></span><span class="hljs-comment">(name="tagging_idx", columns={"tag_id", "resource_type", "resource_id"})}) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Tagging</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseTagging</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Column(name="id", type="integer") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Id * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\GeneratedValue(strategy="AUTO") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $id; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\ManyToOne(targetEntity="Tag", inversedBy="tagging") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\JoinColumn(name="tag_id", referencedColumnName="id") **/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $tag; }</code> </pre><br></div></div><br>  Tags are rendered to the base entity, the classes of the entities themselves do not contain anything extra. <br><br>  I started digging SonataAdminBundle code in search of a solution on how to teach it to work with such tags, I first <a href="http://sonata-project.org/bundles/admin/2-2/doc/reference/saving_hooks.html">hit Saving hooks</a> , discarded them and began to look for how to implement my own type of field in which I could implement TagManager launch.  But I didn‚Äôt master it, the code is rather complicated there.  And here I noticed that when the old tags are configured in the admin on the edit page of the record, the list of tags continues to be displayed, and when the tags are saved, they fall into the $ tags property of the entity.  True, the sonata does not save them to the database (this property does not have doctrine annotations, and it cannot, even if it were), but finding tags in the essence tag collection is exactly what is needed for TagManager to work!  It remains to run the tag manager when changing the entity, and here it was Saving hooks that came in handy. <br><br>  In the admin class, I did not change the description of the tag field, and the sonata enters the tags into the collection property when it is saved.  With the help of postPersist and postUpdate hooks, the preservation of linking tags to the database is called: <br><pre> <code class="php hljs"> <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> FPN\TagBundle\Entity\TagManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTagManager</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getConfigurationPool()-&gt;getContainer() -&gt;get(<span class="hljs-string"><span class="hljs-string">'fpn_tag.tag_manager'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postPersist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTagManager()-&gt;saveTagging($object); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTagManager()-&gt;saveTagging($object); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">preRemove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($object)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTagManager()-&gt;deleteTagging($object); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrine()-&gt;getManager()-&gt;flush(); }</code> </pre><br>  There is another ambush here - a <a href="https://github.com/sonata-project/SonataAdminBundle/pull/1318">bug in the Sonata</a> , which leads to the fact that the preRemove and postRemove hooks are not called in a batch deletion (in the list).  The solution to expanding the standard CRUD controller sonata: <br><div class="spoiler">  <b class="spoiler_title">Custom CRUD controller</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>\<span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">CRUDController</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Component</span></span>\<span class="hljs-title"><span class="hljs-title">HttpFoundation</span></span>\<span class="hljs-title"><span class="hljs-title">RedirectResponse</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sonata</span></span>\<span class="hljs-title"><span class="hljs-title">AdminBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Datagrid</span></span>\<span class="hljs-title"><span class="hljs-title">ProxyQueryInterface</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CRUDController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">publishAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'request'</span></span>)-&gt;get(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;getIdParameter()); $object = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;getObject($id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$object) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NotFoundHttpException(sprintf(<span class="hljs-string"><span class="hljs-string">'unable to find the object with id : %s'</span></span>, $id)); } $object-&gt;togglePublished(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;getModelManager()-&gt;update($object); $message = $object-&gt;getPublished() ? <span class="hljs-string"><span class="hljs-string">'Publish successfully'</span></span> : <span class="hljs-string"><span class="hljs-string">'Unpublish successfully'</span></span>; $trans = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'translator.default'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;addFlash(<span class="hljs-string"><span class="hljs-string">'sonata_flash_success'</span></span>, $trans-&gt;trans($message, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-string"><span class="hljs-string">'admin'</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RedirectResponse(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;generateUrl(<span class="hljs-string"><span class="hljs-string">'list'</span></span>)); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">batchActionDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ProxyQueryInterface $query)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin, <span class="hljs-string"><span class="hljs-string">'preRemove'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($query-&gt;getQuery()-&gt;iterate() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $object) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;preRemove($object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } } $response = <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::batchActionDelete($query); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (method_exists(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin, <span class="hljs-string"><span class="hljs-string">'postRemove'</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($query-&gt;getQuery()-&gt;iterate() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $object) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;admin-&gt;postRemove($object[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $response; } }</code> </pre><br></div></div><br>  The method for the publish button in the entity list has been added to the same controller.  For this button, you need another twig-template and the addition of the configureListFields setting in the admin class: <br><div class="spoiler">  <b class="spoiler_title">Custom action template in the list</b> <div class="spoiler_text"><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-comment"><span class="xml"></span><span class="hljs-comment">{# src/App/AppBundle/Resources/views/CRUD/list__action_publish.html.twig #}</span></span><span class="xml"><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">if</span></span></span></span></span><span class="hljs-template-tag"> object.published %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"btn btn-sm btn-danger"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ admin.generateObjectUrl('publish', object) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">trans</span></span></span></span></span><span class="hljs-template-tag"> from 'admin' %}</span></span><span class="xml"><span class="xml">Unpublish</span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endtrans</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">else</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"btn btn-sm btn-success"</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span></span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ admin.generateObjectUrl('publish', object) }}</span></span><span class="xml"><span class="hljs-tag"><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">trans</span></span></span></span></span><span class="hljs-template-tag"> from 'admin' %}</span></span><span class="xml"><span class="xml">Publish</span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endtrans</span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">a</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{% </span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">endif</span></span></span></span></span><span class="hljs-template-tag"> %}</span></span><span class="xml"></span><span class="xml"></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Customizing custom action in the list</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureListFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ListMapper $listMapper)</span></span></span><span class="hljs-function"> </span></span>{ $listMapper <span class="hljs-comment"><span class="hljs-comment">//   -&gt;add('_action', 'actions', array( 'actions' =&gt; array( 'Publish' =&gt; array( 'template' =&gt; 'AppBundle:CRUD:list__action_publish.html.twig' ) ) )) ; }</span></span></code> </pre><br></div></div><br>  To enable the extended controller, you need to pass its name (AppBundle: CRUD) as the third argument in the service setting. <br><br>  The next task is to display already assigned tags when editing an entity.  It is solved quite simply - you need to pass a list of tags in the tags field of the entity type.  This is exactly the part that could not be put into the AdminExtension extension, otherwise I would have done just that. <br><div class="spoiler">  <b class="spoiler_title">Output assigned tags</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureFormFields</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(FormMapper $formMapper)</span></span></span><span class="hljs-function"> </span></span>{ $tags = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;hasSubject() ? <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getTagManager()-&gt;loadTagging(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getSubject()) : <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); $formMapper <span class="hljs-comment"><span class="hljs-comment">//   -&gt;add('tags', 'entity', array( 'class'=&gt;'AppBundle:Tag', 'choices' =&gt; $tags, 'multiple' =&gt; true, 'attr'=&gt;array('style'=&gt;'width: 100%;')) ) ; }</span></span></code> </pre><br></div></div><br><br><h4>  Conclusion </h4><br>  Thus, it turned out to introduce a good convenient FPNTagBundle bundle into the SonataAdminBundle admin panel, ensure that all links are saved in one common table, and also study the insides of the Sonata. <br><br><h4>  Bonus - requests to work with tags </h4><br>  Some time ago, I <a href="http://habrahabr.ru/post/229427/">promised in comments to</a> post an article with a set of SQL queries for working with tags.  I did not make a separate article, I will give them here. <br><br>  Given: <br><ul><li>  the above tables Article, News, Tag, Tagging </li><li>  several tags (id list) for which you need to find relevant entities.  We assume that we have 3 tags, but we can and more. </li></ul><br>  Task: Find all articles and news containing the specified tags, first display the records containing all three specified tags, then print the records containing at least two of any entered tags, and at the end display the records containing at least one tag. <br><br>  The first query displays the id of the records found (and the type of record) <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> resource_id, resource_type, <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> weight <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Tagging <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> tag_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> resource_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> weight <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre><br>  The second query lists the articles found: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Article.id, Article.title <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Tagging, Article <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> Tagging.resource_id=Article.id <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> Tagging.tag_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> Tagging.resource_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre><br>  Habrapheme <a href="http://habrahabr.ru/users/nashev/" class="user_link">Nashev</a> proposed query option with the exclusion of tags, that is, display all records containing tags (1, 2, 3) and not containing (4, 5, 6): <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> resource_id, resource_type <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Tagging <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> tag_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> resource_id <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> resource_id <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> Tagging <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> tag_id <span class="hljs-keyword"><span class="hljs-keyword">IN</span></span> (<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>,<span class="hljs-number"><span class="hljs-number">6</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> resource_id <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">DESC</span></span></code> </pre></div><p>Source: <a href="https://habr.com/ru/post/233695/">https://habr.com/ru/post/233695/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../233681/index.html">Review of the most interesting materials on data analysis and machine learning ‚Ññ9 (August 11 - 18, 2014)</a></li>
<li><a href="../233687/index.html">Ministry of Communications wants to increase the number of programmers in Russia from 350 thousand to 1 million</a></li>
<li><a href="../233689/index.html">Scientists from Stanford have created an application that allows you to eavesdrop on an Android smartphone using a gyroscope</a></li>
<li><a href="../233691/index.html">Autodesk will not sell software to sanctioned companies</a></li>
<li><a href="../233693/index.html">Setting up a Cyclos cluster based on Jelastic Platform-as-Infrastructure</a></li>
<li><a href="../233699/index.html">Principles of work of one Python-developer</a></li>
<li><a href="../233703/index.html">Autodesk tool for displaying 3d models on the web</a></li>
<li><a href="../233705/index.html">Real unit testing in AngularJS</a></li>
<li><a href="../233707/index.html">Linux book selling</a></li>
<li><a href="../233711/index.html">Sly Lamb Company Experience: Adapting an iOS App Design for Windows Phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>