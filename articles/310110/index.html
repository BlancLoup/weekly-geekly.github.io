<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bagri - NoSQL open source database built on top of distributed cache</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today I want to tell you about an open source project called Bagri . Bagri is a distributed database of documents (document database), or as it is now...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bagri - NoSQL open source database built on top of distributed cache</h1><div class="post__text post__text-html js-mediator-article">  Today I want to tell you about an open source project called <a href="http://bagridb.com/">Bagri</a> .  Bagri is a distributed database of documents (document database), or as it is now fashionable to say NoSQL database written in Java and designed to meet the requirements mainly used in the corporate sector, such as high availability, resiliency, scalability and support for transactionality. <br><br><img src="https://habrastorage.org/files/d4d/303/3f2/d4d3033f2ce94acdb3111b5c320b05eb.png" alt="Bagri logo"><br><br><h4>  When it makes sense to use bagri </h4><br>  The system is good to use in the first place in cases where the workflow is based on XML.  These are finance, logistics, insurance, medicine, and other industries where the format of documents exchanged between participants is strictly defined by corporate XSD schemes.  The system allows you not to parse each incoming document, but put it into the database as it is, and then efficiently perform any queries on stored documents using the powerful XQuery 3.1 toolkit. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bagri is built on top of products that implement distributed cache, such as Hazelcast, Coherence, Infinispan, and other similar systems.  It is due to the capabilities of the distributed cache that Bagri supports the requirements of the corporate sector right out of the box.  The distributed cache is used by the system not only as a data warehouse, but also as a distributed system for processing this data, which allows you to efficiently and quickly process any large amounts of weakly structured data.  Transactional in the system is solved using an algorithm that implements <a href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control">multi-version concurrency control</a> <br><a name="habracut"></a><br>  The data in the system are supplied as XML or JSON documents.  There is also the opportunity to implement its extension to Bagri and register the plugin to work with new document formats, as well as with external document storage systems.  The auxiliary project <a href="https://github.com/dsukhoroslov/bagri-extensions">bagri-extensions</a> contains <a href="https://github.com/dsukhoroslov/bagri-extensions">extensions</a> developed by the team (a connector to MongoDB is currently implemented). <br><br>  <a href="https://www.w3.org/XML/Query/">XQuery is</a> used as the query language, in the future it is also planned to support SQL syntax, this <a href="https://github.com/dsukhoroslov/bagri/issues/33">task</a> is available in the project Github. <br><br>  Bagri does not require prior knowledge of the data schema, but forms a data dictionary (unique paths in document structures) ‚Äúon the fly‚Äù while parsing incoming documents.  So  Bagri is completely schemaless and does not need rebuilding tables for new document types, i.e.  he does not need create table / add column commands in principle. <br><br>  For communication between the client and the server, Bagri offers two APIs: the standard XQJ API declared in <a href="https://jcp.org/en/jsr/detail%3Fid%3D225">JSR 225</a> and its own XDM API, providing additional functionality that is missing in XQJ.  In fact, XQJ interfaces are analogous to the functionality provided by the JDBC driver when working with relational databases.  Together with the XQJ driver, the system comes with the official XQJ TCK, which you can run and make sure that the driver passes all XQJ tests 100%. <br><br><h3>  How distributed cache functionality is used in Bagri </h3><br>  All documents in Bagri are stored in schemas, the closest analogue in a relational database (RDBMS) is database.  Currently, <a href="http://hazelcast.org/">Hazelcast is</a> used as the distributed cache on which the system is built, and a separate Hazelcast cluster is allocated for each scheme.  Schemes exist independently of each other, i.e.  there is no ‚Äústruggle‚Äù for resources between the schemes (in the Hazelcast each cluster is configured separately and has its own pool of resources). <br><br>  Meta document data (namespaces, document types, unique paths) are stored in the corresponding caches and replicated between all nodes in the cluster.  So  Access to working nodes to read metadata is as fast as possible.  The data of the documents themselves are separated from the metadata and stored in distributed caches, while the data relating to the same document is always stored on the same node.  There are also caches for storing indexed values, for compiled queries, for the transaction log, and of course for the results of executed queries. <br><br>  Bagri client connects to the server using internal cache client software mechanisms.  XQuery requests on the client are packed into tasks and executed on server nodes via the distributed ExecutorService provided by the Hazelcast platform. <br>  Results are returned to the client through a dedicated asynchronous channel (Hazelcast queue) <br><br><h3>  System configuration </h3><br>  The entire system configuration is stored in two files: access.xml for settings of roles and users, and config.xml with settings for schemes and extensions Bagri.  A detailed description of the format of these files and all the parameters used in them can be found in <a href="http://bagridb.com/wp-content/uploads/2016/05/Installation-and-Configuration-Guide.pdf">the installation and configuration instructions of the system</a> .  You can change schema settings directly in files, or through the JMX schema management interfaces deployed on the Bagri administration server. <br><br><h4>  Examples of working with data </h4><br>  Let's now move from theory to practice and consider how we can work with Bagri from our Java code through XQJ interfaces. <br><br>  Inside the context of the spring, we declare the BagriXQDataSource bin and configure its four main parameters: the address of the remote server, the name of the scheme, the user name and password. <br><br><pre><code class="java hljs">&lt;bean id=<span class="hljs-string"><span class="hljs-string">"xqDataSource"</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"com.bagri.xqj.BagriXQDataSource"</span></span>&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"properties"</span></span>&gt; &lt;props&gt; &lt;prop key=<span class="hljs-string"><span class="hljs-string">"address"</span></span>&gt;${schema.address}&lt;/prop&gt; &lt;prop key=<span class="hljs-string"><span class="hljs-string">"schema"</span></span>&gt;${schema.name}&lt;/prop&gt; &lt;prop key=<span class="hljs-string"><span class="hljs-string">"user"</span></span>&gt;${schema.user}&lt;/prop&gt; &lt;prop key=<span class="hljs-string"><span class="hljs-string">"password"</span></span>&gt;${schema.password}&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=<span class="hljs-string"><span class="hljs-string">"xqConnection"</span></span> factory-bean=<span class="hljs-string"><span class="hljs-string">"xqDataSource"</span></span> factory-method=<span class="hljs-string"><span class="hljs-string">"getConnection‚Äú/&gt;</span></span></code> </pre> <br>  Get the XQJ connection: <br><br><pre> <code class="java hljs">context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassPathXmlApplicationContext(<span class="hljs-string"><span class="hljs-string">"spring/xqj-client-context.xml"</span></span>); XQConnection xqc = context.getBean(XQConnection.class);</code> </pre> <br>  Then we read the text file and on the basis of it we create a new document in Bagri: <br><br><pre> <code class="java hljs">String content = readTextFile(fileName); String query = <span class="hljs-string"><span class="hljs-string">"declare namespace bgdm=\"http://bagridb.com/bagri-xdm\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"declare variable $uri external;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"declare variable $content external;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"declare variable $props external;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"let $id := bgdm:store-document($uri, $content, $props)\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"return $id\n"</span></span>; XQPreparedExpression xqpe = xqc.prepareExpression(query); xqpe.bindString(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QName(<span class="hljs-string"><span class="hljs-string">"uri"</span></span>), fileName, xqc.createAtomicType(XQBASETYPE_ANYURI)); xqpe.bindString(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QName(<span class="hljs-string"><span class="hljs-string">"content"</span></span>), content, xqc.createAtomicType(XQBASETYPE_STRING)); List&lt;String&gt; props = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;&gt;(<span class="hljs-number"><span class="hljs-number">2</span></span>); props.add(‚Äúxdm.document.data.format=xml<span class="hljs-string"><span class="hljs-string">"); //can be ‚Äújson‚Äù or something else.. xqpe.bindSequence(new QName("</span></span>props<span class="hljs-string"><span class="hljs-string">"), xqConn.createSequence(props.iterator())); XQSequence xqs = xqpe.executeQuery(); xqs.next(); long id = xqs.getLong();</span></span></code> </pre> <br>  The request above calls the store-document external function defined in the bgdm namespace.  The function accepts 3 parameters as input: uri, under which the document will be saved, the text content of the document and an optional set of options that define additional parameters for the function of saving the document.  The request is validated on the client side and then sent to the server along with the parameters. <br><br>  On the server side, a unique identifier is assigned to the incoming document.  Further, the contents of the document are parsed in accordance with the specified document format and divided into path / value pairs, while all unique paths are stored in the replicated directory of document paths.  At the end of the parsing procedure, the entire contents of the document, divided into such pairs, is stored in the distributed caches of the system, and the document header with service information is also cached.  If indexes are registered in the schema, all indexed values ‚Äã‚Äãare also stored in the index cache.  The confirmation of the successful saving of the document is transmitted back to the client side. <br><br>  After we have successfully saved our document in Bagri, let's look at how we can make requests to documents stored in the system. <br><br>  Get the XQJ connection: <br><br><pre> <code class="java hljs">XQConnection xqc = context.getBean(XQConnection.class);</code> </pre> <br>  Prepare an XQuery query: <br><br><pre> <code class="java hljs">String query = <span class="hljs-string"><span class="hljs-string">"declare namespace s=\"http://tpox-benchmark.com/security\";\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"declare variable $sym external;\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"for $sec in fn:collection(\‚Äúsecurities\")/s:Security\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"where $sec/s:Symbol=$sym\n"</span></span> + <span class="hljs-string"><span class="hljs-string">"return $sec\n"</span></span>; XQPreparedExpression xqpe = xqc.prepareExpression(query);</code> </pre> <br>  Set the value of the search parameter: <br><br><pre> <code class="java hljs">xqpe.bindString(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> QName(<span class="hljs-string"><span class="hljs-string">"sym"</span></span>), ‚ÄúIBM‚Äù, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>);</code> </pre> <br>  Execute the request on the server: <br><br><pre> <code class="java hljs">XQResultSequence xqs = xqpe.executeQuery();</code> </pre> <br>  And review the results: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (xqs.next()) { System.out.println(xqs.getItemAsString(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); }</code> </pre> <br>  I think it will be just as interesting to talk about what happens on the server when executing this code: <br><br>  The query passes through the XQuery processor (currently <a href="http://saxon.sourceforge.net/">Saxon</a> ), in which the query execution tree (compiled query, XQueryExpression) is formed.  Then it is translated into a set of simple queries to the cached data along the specified paths: <br><br><pre> <code class="hljs ruby">[PathExpression [path=<span class="hljs-regexp"><span class="hljs-regexp">/ns2:Security/ns</span></span>2<span class="hljs-symbol"><span class="hljs-symbol">:Symbol/text</span></span>(), param=var<span class="hljs-number"><span class="hljs-number">0</span></span>, docType=<span class="hljs-number"><span class="hljs-number">2</span></span>, compType=EQ]], params={var<span class="hljs-number"><span class="hljs-number">0</span></span>=IBM}</code> </pre> <br>  These simple queries are executed in parallel on all nodes of the distributed system cache.  Found documents are delivered to the processor for further processing.  Indexes are used whenever possible if the requested paths have been indexed.  After final processing of the received documents by the processor, the results are transmitted back to the client through a dedicated asynchronous channel. <br><br><h3>  System expansion options </h3><br>  Bagri provides rich opportunities to expand the behavior of the system.  For example, you can connect a trigger to any document status changes (before / after insert / update / delete) and execute additional business logic at these points.  To do this, it is enough to implement the interface com.bagri.xdm.cache.api.DocumentTrigger, as shown in one of the examples supplied with the system (see samples / bagri-samples-ext): <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SampleTrigger</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DocumentTrigger</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">transient</span></span> Logger logger = LoggerFactory.getLogger(SampleTrigger.class); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"beforeInsert; doc: {}; repo: {}"</span></span>, doc, repo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"afterInsert; doc: {}; repo: {}"</span></span>, doc, repo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"beforeUpdate; doc: {}; repo: {}"</span></span>, doc, repo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"afterUpdate; doc: {}; repo: {}"</span></span>, doc, repo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">beforeDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"beforeDelete; doc: {}; repo: {}"</span></span>, doc, repo); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">afterDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Document doc, SchemaRepository repo)</span></span></span><span class="hljs-function"> </span></span>{ logger.trace(<span class="hljs-string"><span class="hljs-string">"afterDelete; doc: {}; repo: {}"</span></span>, doc, repo); } }</code> </pre> <br>  And then register the trigger in the schema in the config.xml file: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"sample"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">active</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span>2016-09-01T15:00:58.096+04:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span>admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>sample schema<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶‚Ä¶‚Ä¶ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">properties</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">collections</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fragments</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">indexes</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">trigger</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ns2:javatrigger"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span>2016-09-01T15:00:58.096+04:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span>admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">docType</span></span></span><span class="hljs-tag">&gt;</span></span>/{http://tpox-benchmark.com/security}Security<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">docType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">synchronous</span></span></span><span class="hljs-tag">&gt;</span></span>false<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">synchronous</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">index</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">index</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">order</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"after"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"delete"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">action</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">order</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"before"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"insert"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">actions</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">library</span></span></span><span class="hljs-tag">&gt;</span></span>trigger_library<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">library</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">className</span></span></span><span class="hljs-tag">&gt;</span></span>com.bagri.samples.ext.SampleTrigger<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">className</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">trigger</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">triggers</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schema</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">schemas</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">libraries</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">library</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"trigger_library"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span>2016-09-01T15:00:58.096+04:00<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdAt</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span>admin<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">createdBy</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fileName</span></span></span><span class="hljs-tag">&gt;</span></span>bagri-samples-ext-1.0.0-EA1.jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fileName</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Sample extension trigger Library<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enabled</span></span></span><span class="hljs-tag">&gt;</span></span>true<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">enabled</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">functions</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">library</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">libraries</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  As shown above, we registered the library (bagri-samples-ext-1.0.0-EA1.jar) containing the trigger implementation.  Libraries can also contain additional functions written in Java that can be called from XQuery queries, as well as extensions for processing new data formats or connecting to external document storage systems. <br><br><h3>  System Deployment Options </h3><br>  Bagri can be deployed in the following ways: <br><br><ul><li>  <b>Standalone Java app</b> - suitable for small applications that need to handle a limited set of data.  Everything works within one JVM with one schema, providing maximum performance on limited (by memory of one JVM) data volumes. <br><br></li><li>  <b>Client-server, distributed database</b> ‚Äî clients communicate with the distributed storage system via the XDM / XQJ driver.  Distributed processing of requests in memory, the possibility of on-line processing of an unlimited amount of data <br><br></li><li>  <b>Administration server</b> - provides additional functionality for collecting statistics and monitoring the status of system work nodes.  Usually it is deployed as a separate node, but this is not a required component, the system can work without it. </li></ul><br><img src="https://habrastorage.org/files/f7d/b71/c4a/f7db71c4a464473ba6bd675d56a66690.jpg" alt="image"><br><br><h3>  Visual administrative interface </h3><br>  At present, Bagri‚Äôs visual administrative interface is implemented as a <a href="https://visualvm.java.net/">VisualVM plugin</a> and allows you to: <br><br><ul><li>  configure users and roles </li><li>  connect external libraries of Java functions and XQuery add-ons for use in queries </li><li>  configure schemas and their components: collections, metadata dictionaries, indexes and triggers, user and role access to schemas </li><li>  visually view documents and collections </li><li>  perform XQuery queries and get results through the built-in console </li></ul><br>  This module is still under active development, the functionality of the plugin is constantly increasing.  In the case of errors, as well as in the case of proposals for the missing functionality, they can always (and need!) Put in the <a href="https://github.com/dsukhoroslov/bagri/issues">issues of the</a> project. <br><br>  Screenshots of the administrative console - see below. <br><br><img src="https://habrastorage.org/files/995/1a6/6e3/9951a66e35df4fb9b125767aa181e65c.png" alt="image"><br><br><img src="https://habrastorage.org/files/e70/911/815/e70911815fb94dc78e115ea696ebc548.png" alt="image"><br><br>  So, we have considered the most basic capabilities of the distributed database of documents Bagri.  We hope that you are interested in this project and you will try to use it in your daily work. <br><br>  For my part, I will soon try to write for you some more articles on how Bagri compares with other similar products, such as BaseX, MongoDB, Cassandra, and system expansion options by using the built-in API (DataFormat API and DataStore API). <br><br>  Bagri, like any other open source project, requires Java developers interested in this topic, so if after reading this article you are interested in the project, welcome to <a href="https://github.com/dsukhoroslov/bagri">Githab Bagri</a> , there are many really interesting tasks. </div><p>Source: <a href="https://habr.com/ru/post/310110/">https://habr.com/ru/post/310110/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310100/index.html">Was there a boy? Our servers and hacker attack on the US Democratic Party</a></li>
<li><a href="../310102/index.html">Data Science Week 2016. Speaker Presentations</a></li>
<li><a href="../310104/index.html">RailsClub 2016: Interview with Alexey Taktarov</a></li>
<li><a href="../310106/index.html">Magento 2. Le Roi est mort! Vive le Roi?</a></li>
<li><a href="../310108/index.html">Applying R to work with the statement ‚ÄúWho is to blame? Of course IT! ‚Äù</a></li>
<li><a href="../310118/index.html">Apparently, the best times of the Safari browser are behind</a></li>
<li><a href="../310120/index.html">Mobile security fear</a></li>
<li><a href="../310122/index.html">"Operating systems: why are they to an engineer?"</a></li>
<li><a href="../310126/index.html">How I participated in the development of a new Internet standard</a></li>
<li><a href="../310128/index.html">Security Week 37: Windows patches will become more cumulative, Google vs. HTTP, vulnerability in MySQL</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>