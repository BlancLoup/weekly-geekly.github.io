<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A few words about using enums in a changing environment.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post offers a solution to problems with the use of enumerations when changing the composition of constants or the presence of duplication of code...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A few words about using enums in a changing environment.</h1><div class="post__text post__text-html js-mediator-article">  <i>This post offers a solution to problems with the use of enumerations when changing the composition of constants or the presence of duplication of code when using them.</i>  <i>In other cases, the use of the approach sounded below, as a rule, is impractical.</i> <br><br><a name="habracut"></a><br><br><h4>  Description of enums in java </h4><br>  In Java, starting with version 1.5, among other things, the so-called enumerations (enum) have appeared.  There are a number of advantages from using enumerations against named constants: <br><ul><li>  The compiler guarantees correct type checking. </li><li>  Easy iteration over all possible enumeration values </li><li>  They take up less space in the switch block (no need to specify the class name) </li><li>  etc. </li></ul><br>  However, compared to, say, C ++, enumerations in Java are full-fledged objects, which gives the developer much more flexibility. <br><ul><li>  First, all enumerations are inherited from the class java.lang.Enum, which has a number of convenient methods, namely: <br>  - name () - the name of the constant as a string <br>  - ordinal () - the order of the constant (corresponds to the order in which the constant is declared) <br>  - valueOf () is a static method that allows to get an enumeration object by class and name <br></li><li>  Further, as was already announced, the enumeration class has the opportunity to get all possible enumeration values ‚Äã‚Äãby calling the java.lang.Class.getEnumConstants () method of the enumeration class <br></li><li>  In the enumeration class, it is possible to specify constructors (private only), fields, and methods. <br></li><li>  Enumerations can implement any interfaces. <br></li><li>  At the same time, the methods in the enumeration can be abstract, and concrete instances of constants can define such methods (as, indeed, redefine already defined ones) <br></li></ul><br>  Considering all of the above, we can say that enumerations in Java are no longer just constants (ie, data), but full-fledged objects, from which certain conclusions can be drawn about their use. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Simplicity is power! </h4><br>  When using the approach proposed below, it is necessary to take into account that it is rather complicated.  In accordance with the <a href="http://habrahabr.ru/blogs/arbeit/99889">following post</a> , this construction should not be applied in simple cases. <br><br>  Its purpose is to simplify life in difficult expansion-oriented situations, such as: <br><ul><li>  The presence of several loosely coupled modules using the same enumeration class </li><li>  Precedents for changing the composition of the constants </li><li>  The presence of code duplication in switch blocks using this enumeration </li></ul><br><br>  In the absence of these symptoms, the use of the approach proposed below is doubtful and even dangerous, since  The increased complexity of the code requires more careful analysis if any errors occur. <br><br><h4>  Using enums in a changing environment </h4><br>  Now, in fact, let us go to the essence of the question that I wanted to consider. <br><br>  Enumerations should be used in those cases for which switch'i were used in pluses.  Since enumerations can contain inherited methods, as well as implement interfaces, all the logic of the switch handlers can be included in the methods of the enumeration class.  Remember this as a fact, and consider the following problem. <br><br>  Due to the seeming simplicity of enumerations, as well as the fact that, from the experience of languages ‚Äã‚Äãlike C ++, we are accustomed to considering them as data, enumerations control the behavior of the system in various parts of the system, as a rule, weakly connected with each other.  Moreover, if we carry out all the conditional logic in enumeration methods (to get rid of branching), saturation and overflow of logic contained in the enumeration class inevitably occurs.  It also leads to increased module connectivity. <br><br>  In this case, you can do the following: <br><ol><li>  We divide the enumeration class into handlers, each of which will correspond to one of the modules of the system.  This is how we solve the interface congestion problem of the enumeration class itself. </li><li>  It remains to solve the problem of connectivity.  To do this, we assign an interface to each handler, and will receive instances through the factory.  The factory itself can be created using a declarative approach, i.e.  communication of interfaces with implementations will be carried out at the configuration level (for example, via xml). </li></ol><br>  Thus, we get an approach that differs by the following pros and cons: <br><ul><li>  + Code duplication is minimized </li><li>  + Improves code readability </li><li>  The logic of handlers can be divided in any way.  The inheritance hierarchy of handlers can be any </li><li>  + When adding new handlers (modules) or enum elements, nothing will be forgotten </li><li>  + Since  There are no restrictions on the hierarchy of handlers, you can always provide default handlers </li><li>  - Increased coding costs </li><li>  - Complicated code structure </li><li>  - For cases when it is necessary to explicitly eliminate dependencies between modules (for example, physical separation of modules), it is necessary to keep the factory configuration up to date </li></ul><br>  All the listed disadvantages can be resolved by writing the corresponding support for this functionality as a plug-in for the IDE used.  This, of course, requires some costs, but can be decided centrally and once, after which it will be used always and everywhere. <br><br><h4>  Usage example </h4><br><br>  For example, we have the following set of classes (in different modules): <br><br><pre> public enum DocumentStatus {
	 NEW (0),
	 DRAFT (1),
	 PUBLISHED (2),
	 ARCHIVED (3);

	 private DocumentStatus (int statusCode) {
		 this.statusCode = statusCode;
	 }

	 public int getStatusCode () {
		 return statusCode;
	 }

	 private int statusCode;
 }

 // Web
 public class DocumentWorklfowProcessor {
	 ...

	 public List &lt;Operation&gt; getAvailableOperations (DocumentStatus status) {
		 List &lt;Operation&gt; operations;

		 switch (status) {
		 case NEW:
			 operations = ...;
			 break;
		 case DRAFT:
			 operations = ...;
			 break;
		 case PUBLISHED:
			 operations = ...;
			 break;
		 case ARCHIVED:
			 operations = ...;
			 break;
		 }

		 return operations;
	 }

	 public void doOperation (DocumentStatus status, Operation op) throws APIException {
		 switch (status) {
		 case NEW:
			 // one set of operation parameters
			 break;
		 case DRAFT:
			 // another set of operation parameters
			 break;
		 case PUBLISHED:
			 // third set of operation parameters
			 break;
		 case ARCHIVED:
			 // etc.
			 break;
		 }
	 }
 }


 // Scheduled task
 public class ReportGenerationProcessor {
	 ...

	 public void generateReport (Report report) {
		 DocumentStatus status = report.getDocument (). GetStatus ();
		 ReportParams params;

		 switch (status) {
		 case NEW:
		 case DRAFT:
			 // params = one selection criteria for the elements displayed in the report
			 break;
		 case PUBLISHED:
			 // params = other selection criteria for the elements displayed in the report
			 break;
		 case ARCHIVED:
			 // etc.
			 break;
		 }

		 // Generate report
	 }
 }
</pre><br><br>  It can be seen that the modules are rather weakly interconnected. <br>  Suppose we are at the request of the customer there is a new document status - sent for confirmation (VERIFY). <br>  When adding a new status, you will have to add a new case in all the proposed locations.  It is very easy to forget to add it somewhere.  Of course, you can provide default-blocks, throwing exceptions, but for a large system it does not guarantee that all places will be noticed. <br>  It is proposed to convert this code to the following form: <br><br><pre> public interface IReportGeneratorProcessor {
	 public ReportParams getReportParams ();
 }

 public interface IDocumentWorklfowProcessor {
	 public List &lt;Operation&gt; getAvailableOperations ();

	 public void doOperation (Operation op) throws APIException;
 }

 public enum DocumentStatus {
	 // Here, instead of new, you can use a factory or even lazy-initialization in get-methods
	 NEW (0, new NewDocReportGeneratorProcessor (), new NewDocWorklfowProcessor ()),
	 DRAFT (1, new DraftDocReportGeneratorProcessor (), new DraftDocWorklfowProcessor ()),
	 PUBLISHED (2, ...),
	 ARCHIVED (3, ...);

	 private DocumentStatus (int statusCode, IReportGeneratorProcessor reportProc,
			 IDocumentWorklfowProcessor docProc) {
		 this.statusCode = statusCode;
		 this.reportProc = reportProc;
		 this.docProc = docProc;
	 }

	 public int getStatusCode () {
		 return statusCode;
	 }

	 public IReportGeneratorProcessor getReportGeneratorProcessor () {
		 return reportProc;
	 }

	 public IDocumentWorklfowProcessor getDocumentWorklfowProcessor () {
		 return docProc;
	 }

	 private int statusCode;
	 private IReportGeneratorProcessor reportProc;
	 private IDocumentWorklfowProcessor docProc;
 }

 // Web
 public class DocumentWorklfowProcessor {
	 ...

	 public List &lt;Operation&gt; getAvailableOperations (DocumentStatus status) {
		 return status.getDocumentWorklfowProcessor (). getAvailableOperations ();
	 }

	 public void doOperation (DocumentStatus status, Operation op) throws APIException {
		 status.getDocumentWorklfowProcessor (). doOperation (op);
	 }
 }


 // Scheduled task
 public class ReportGenerationProcessor {
	 ...

	 public void generateReport (Report report) {
		 DocumentStatus status = report.getDocument (). GetStatus ();
		 ReportParams params = status.getReportGeneratorProcessor (). GetReportParams ();

		 // Generate report
	 }
 }
</pre><br><br>  It can be seen that the client code has become much shorter and clearer. <br>  Of course, the handlers themselves still need to be written, but now when adding a new enumeration item, its handlers will have to be written.  Already there is no danger that they will forget about it (deliberate sabotage and leaving ‚Äúfor later‚Äù are not considered), at least at least they will think.  And, as already mentioned, you can always start a default handler: <br><br><pre>	 public IDocumentWorklfowProcessor getDocumentWorklfowProcessor () {
		 return (docProc! = null)?  docProc: DEFAULT_WORKFLOW_PROCESSOR;
	 }
</pre><br><br>  PS I look forward to commenting on the validity of this approach.  If you get enough votes, you are ready to implement this plugin for IntelliJ IDEA, Eclipse and NetBeans. <br><br>  UPD.  The section ‚ÄúSimplicity is power!‚Äù Was added in response to the corresponding post to show its place within this approach. <br><br>  UPD 2. By numerous requests, added an example.  Also at the beginning of the post added a brief description of the applicability of this solution. </div><p>Source: <a href="https://habr.com/ru/post/101280/">https://habr.com/ru/post/101280/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../101275/index.html">Head of iPhone Developer Group Left Apple</a></li>
<li><a href="../101276/index.html">Comic strip</a></li>
<li><a href="../101277/index.html">Web analytics: technology or lifestyle?</a></li>
<li><a href="../101278/index.html">Flowers for Daniel Kiz</a></li>
<li><a href="../101279/index.html">Two-column text layout</a></li>
<li><a href="../101282/index.html">HTC Schubert - the first WP7 phone with a unibody-aluminum case</a></li>
<li><a href="../101283/index.html">Samsung S8000 Jet. Differences in S8000MXEJA1 and S8000XEIG2 firmware</a></li>
<li><a href="../101285/index.html">How Microsoft DevDiv uses TFS - part 6 (+ add-on) and 7</a></li>
<li><a href="../101287/index.html">Half a year with BenQ S6</a></li>
<li><a href="../101290/index.html">The art of programming under Unix (and not only). Part Two, Clarity Better than Cleverness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>