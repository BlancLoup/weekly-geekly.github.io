<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making your local DNS (PDNSD), with blackjack and faster Google Public DNS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Every year the speed of the Internet - as the last mile, and the main channels is becoming higher. Only one thing invariably - the latency has already...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making your local DNS (PDNSD), with blackjack and faster Google Public DNS</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/548/42c/265/54842c26583fa7609daeb4482f27f7b8.png" align="right">  Every year the speed of the Internet - as the last mile, and the main channels is becoming higher.  Only one thing invariably - the latency has already come up against physical limitations: the speed of light in optical fiber is about 200 thousand kilometers per second, and accordingly, in less than ~ 150ms, the response from the server across the Atlantic Ocean cannot be obtained in the foreseeable future (although of course there are delights, like optical fiber with air core or radio-relay communication, but it is hardly available for mere mortals). <br><br>  When we are trying, for example, from Russia to open a web site located in the USA (its NS server is probably there), and the domain was not found in your provider‚Äôs DNS cache ‚Äî you will have to wait a long time even on the Gigabit Internet, maybe even a full second: while we across the ocean, we will get the names of the NS servers of the domain, while we split their IP, while we send and receive the actual DNS request itself ... <br><br>  A couple of years ago, Google started its public DNS servers, and to campaign for them, they developed the NameBench <a href="http://code.google.com/p/namebench/">utility</a> , which <a href="http://code.google.com/p/namebench/">runs</a> DNS tests on your surfing history and shows how much Google DNS is faster than your provider's DNS server. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But I managed to make my DNS server, which is faster than Google Public DNS, and in this brief note I want to share the results. <a name="habracut"></a><br><br><h1>  PDNSD </h1>  <a href="http://members.home.nl/p.a.rombouts/pdnsd/"><b>pdnsd</b></a> is a caching DNS proxy.  In addition to the banal DNS query caching (with the ability to set the minimum TTL hard - it may be necessary on a very bad Internet), he can send a request to several ‚Äúparent‚Äù DNS servers at the same time, and give the first return answer to the client. <br><br>  <b>It is the inclusion of a parallel survey and gives us the main advantage in speed</b> , because  when finding the result in the cache of any of the providers, we get the result very quickly, and do not expect complete and slow resolution if the first provider does not have a response in the cache. <br><br>  Put in Ubuntu - the commonplace apt-get. <br><br><h2>  A couple of moments in the config </h2><br><pre><code class="cpp hljs">global { perm_cache=<span class="hljs-number"><span class="hljs-number">10240</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . //   1024,      . cache_dir="/var/cache/pdnsd"; [...] min_ttl=60m; //      . //  TTL   60 -  60 max_ttl=1w; //       neg_ttl=5m; //    (..    ) [..] par_queries=3; //   "" DNS  } server { label = "main"; ip = 85.21.192.5 // 4 ,   3  ,      4- , 213.234.192.7 // 2  -    ,  -  , 8.8.4.4 // Google Public DNS -          , 8.8.8.8 ; [..] }</span></span></code> </pre> <br><br>  In principle, caching can be made less aggressive (min_ttl = 1m for example), but in the course of the year of operation there were no particular problems.  In case of problems, if you wish, you can wipe one cache entry: <br><pre> <code class="bash hljs">sudo pdnsd-ctl record 3.14.by delete</code> </pre>  or all at once: <br><pre> <code class="bash hljs">sudo pdnsd-ctl empty-cache</code> </pre><br><br><h2>  Test results in NameBench </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/488/e48/e41/488e48e412fba73e19c7fd49da50b6aa.png"><br>  We see that for 50% of requests we get a response in less than 10ms, for 85% faster than Google Public DNS, and then the results naturally coincide with Google. <br><br>  According to the test results, NameBench happily informs us: <br><blockquote><pre> 8.8.8.8 Slower replica of SYS-192.167.0.98 [192.167.0.98]
 8.8.4.4 Slower replica of SYS-192.167.0.98 [192.167.0.98]
</pre></blockquote><br>  Thus, a smart caching DNS proxy with parallel queries allows you to speed up even the 100 Mbit Internet.  And for slow (radio) links with high latency and packet loss, the difference can be like between heaven and earth. </div><p>Source: <a href="https://habr.com/ru/post/159013/">https://habr.com/ru/post/159013/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159001/index.html">The effect of turning the page. Now - patented</a></li>
<li><a href="../159003/index.html">Lambda functions and implementation of a convenient mechanism for Callbacks in C ++</a></li>
<li><a href="../159005/index.html">How to become a millionaire in the AppStore or a few formulas about promotion and sales. Part 2</a></li>
<li><a href="../159009/index.html">A small overview of Ingress or how to privatize the sights</a></li>
<li><a href="../159011/index.html">Simple clock on MSP430</a></li>
<li><a href="../159017/index.html">SVG text</a></li>
<li><a href="../159019/index.html">Agile + UX: how to make friends with high-quality user interface and flexible methodologies</a></li>
<li><a href="../159023/index.html">We build Sypex Dumper into our admin area</a></li>
<li><a href="../159027/index.html">CSS sprites: basic techniques and useful tools</a></li>
<li><a href="../159029/index.html">The easiest way to use Hulu, Pandora, etc. without any VPN</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>