<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make a regular FTP server really safe and at the same time convenient?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Immediately make a reservation: I do not provide detailed instructions / configurations, I just share my thoughts on how to do it. Also, by FTP I mean...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make a regular FTP server really safe and at the same time convenient?</h1><div class="post__text post__text-html js-mediator-article">  <i>Immediately make a reservation: I do not provide detailed instructions / configurations, I just share my thoughts on how to do it.</i>  <i>Also, by FTP I mean not only classic FTP, but also SFTP and SSL-FTP - this is an article about password security, not a protocol as such.</i> <br><br>  Imagine a hosting company providing hosting accounts with enhanced security, namely two-factor authentication. <br><a name="habracut"></a><br>  There is nothing difficult, you just need to implement one or several variants of authentication plug-ins on the server with a second factor (for example <a href="http://code.google.com/p/google-authenticator/wiki/PamModuleInstructions">code.google.com/p/google-authenticator/wiki/PamModuleInstructions</a> or <a href="http://motp.sourceforge.net/">motp.sourceforge.net/#6</a> ) and link to them users. <br>  In most cases, PAM can be specified in the configuration of FTP servers, and in principle, the problem of FTP security will be solved in the same way. <br>  The problem is different;  The fact is that depending on the connection speed, server / router settings or FTP connection mode, the FTP session can be interrupted when there is no activity for a certain time (or even just interrupted at the most inappropriate moment).  In the "classic" FTP client just connect again, you just need to put a tick "save password".  In the case of two factor authentication, this will not work, you will have to enter the password and the code from the "token" quite often, and this is very inconvenient for the end user.  If you can convince a user of the need to use a ‚Äútoken‚Äù when logging in to the system, it‚Äôs difficult to explain the need to do this while downloading files several times. <br>  The problem, I hope, explained.  Now I will share the idea of ‚Äã‚Äãimproving convenience for end users. <br><br><h4>  Generate FTP temporary passwords </h4><br>  In fact, the principle itself is not original, I propose to do something like <a href="https://support.google.com/accounts/answer/185833%3Fhl%3Dru">application passwords</a> used for Google accounts with activated two-step authentication. <br>  To do this, you need a similar web interface to generate application passwords.  The web interface itself will only be accessible using two-factor authentication.  After logging in, the user will generate an FTP password that will be active only for a certain time and only for a specific IP address (by default, the current address will be offered).  An approximate interface might look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/8fe/134/63c/8fe13463cfd1441945332bbf490e7190.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When generated, the script enters the data in a database table (for example, MySQL), namely the username, IP address and timestamp of the user-specified time, as well as the generated FTP password, which is shown to the user in the interface.  For FTP access, this temporary password will be used.  The table will look like this: <br><img src="https://habrastorage.org/getpro/habr/post_images/ac6/be5/bda/ac6be5bda5f19761d35ea41b317e5c95.png"><br><br><h4>  FTP server configuration </h4><br>  As an example, take PureFTPD, since it can be tied to MySQL.  Guided by the <a href="http://download.pureftpd.org/pure-ftpd/doc/README.MySQL">instructions, we</a> configure PureFTPD as follows: <br><br><pre><code class="hljs sql">MYSQLSocket /tmp/mysql.sock MYSQLUser root MYSQLPassword rootpw MYSQLDatabase pureftpd MYSQLCrypt cleartext MYSQLGetPW <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> temp_password <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> temp_pass <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> username=<span class="hljs-string"><span class="hljs-string">"\L"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> IP=<span class="hljs-string"><span class="hljs-string">"\R"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> expires &lt;= <span class="hljs-keyword"><span class="hljs-keyword">UNIX_TIMESTAMP</span></span>() MYSQLGetUID <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Uid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=<span class="hljs-string"><span class="hljs-string">"\L"</span></span> MYSQLGetGID <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Gid <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=<span class="hljs-string"><span class="hljs-string">"\L"</span></span> MYSQLGetDir <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> Dir <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">User</span></span>=<span class="hljs-string"><span class="hljs-string">"\L"</span></span></code> </pre> <br><br>  Variables are used in the configuration file. <br>  \ L - user login <br>  \ R - IP adress client <br><br>  That's basically it.  Ideally, you would need some kind of cron script to clear the table of expired passwords. </div><p>Source: <a href="https://habr.com/ru/post/205152/">https://habr.com/ru/post/205152/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../205140/index.html">Megaphone - new Russian cloud operator!</a></li>
<li><a href="../205142/index.html">Caltech posted online Feynman lectures in physics</a></li>
<li><a href="../205144/index.html">NGO Alpha Smart Systems announced the first "home" robot</a></li>
<li><a href="../205148/index.html">The eagle stole the camera from environmentalists, capturing his flight and himself</a></li>
<li><a href="../205150/index.html">Veeam Explorer for Microsoft SharePoint 2013</a></li>
<li><a href="../205154/index.html">JSfiddle style HTML + CSS + JS editor with 230 character code</a></li>
<li><a href="../205158/index.html">Migrate Google Chrome to RAM Disk on Linux</a></li>
<li><a href="../205160/index.html">Apple plans to launch iBeacon in 254 US stores</a></li>
<li><a href="../205162/index.html">Configuring VPN connection with l2tp + ipsec using OpenVZ container as server</a></li>
<li><a href="../205166/index.html">New Year Gift Guide 2013</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>