<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GraphQL future of microservices?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="GraphQL is often presented as a revolutionary way for web API design compared to REST. However, if you take a closer look at these technologies, then ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GraphQL future of microservices?</h1><div class="post__text post__text-html js-mediator-article">  GraphQL is often presented as a revolutionary way for web API design compared to REST.  However, if you take a closer look at these technologies, then you will see that there are so many differences between them.  GraphQL is a relatively new solution, the source code of which was opened to the Facebook community in 2015.  Today, REST is still the most popular paradigm used to provide API and interaction between microservices.  Will GraphQL overtake REST in the future?  Let's take a look at how microservice interaction occurs via the GraphQL API using the Spring Boot and the <a href="https://grooviter.github.io/gql/docs/html5/index.html">GQL</a> library. <br><a name="habracut"></a><br>  Let's start with the architecture of our system example.  Suppose we have three microservices that communicate with each other through the URL obtained from the Spring Cloud Eureka application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/597/9a0/705/5979a0705e43efb645b34e199f5c162e.png" alt="image"><br><br><h2>  Enable GraphQL Support in Spring Boot </h2><br>  We can easily enable support for GraphQL on the server side of the Spring Boot application using starters.  After adding the graphql-spring-boot-starter, the GraphQL servlet will automatically be accessible via the path / graphql.  We can override this default path by specifying the graphql.servlet.mapping property in the application.yml file.  We also include a GraphiQL browser-based IDE for writing, testing, and testing GraphQL queries and the GraphQL Java Tools library, which contains useful components for creating queries and mutations.  Thanks to this library, all files in the classpath with the .graphqls extension will be used to create the schema definition. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs lisp">compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphql-spring-boot-starter</span></span>:<span class="hljs-number"><span class="hljs-number">5.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>') compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphiql-spring-boot-starter</span></span>:<span class="hljs-number"><span class="hljs-number">5.0</span></span>.<span class="hljs-number"><span class="hljs-number">2</span></span>') compile('com.graphql-java<span class="hljs-symbol"><span class="hljs-symbol">:graphql-java-tools</span></span>:<span class="hljs-number"><span class="hljs-number">5.2</span></span>.<span class="hljs-number"><span class="hljs-number">3</span></span>')</code> </pre> <br><h2>  Description GrpahQL schema </h2><br>  Each schema description contains a type declaration, relationships between them, and a variety of operations involving queries to search for objects and mutations to create, update, or delete data.  Usually we begin with a type definition that is responsible for the domain of the object being described.  You can specify whether the field is required with <code>!</code>  character or if it is an array - <code>[‚Ä¶]</code> .  The description must contain a declared type or reference to other types available in the specification. <br><br><pre> <code class="hljs haskell"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! }</span></span></code> </pre><br>  The next part of the schema definition contains the declaration of requests and mutations.  Most queries return a list of objects that are labeled as [Employee] in the schema.  Inside the EmployeeQueries type, we declare all the search methods, while in the EmployeeMutations type we add, update, and delete employees.  If you pass an entire object to a method, you must declare it as an input type. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">schema</span></span> { query: <span class="hljs-type"><span class="hljs-type">EmployeeQueries</span></span> mutation: <span class="hljs-type"><span class="hljs-type">EmployeeMutations</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeQueries</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employees</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employeesByOrganization</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employeesByDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeMutations</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!) : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Boolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateEmployee</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employee</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> } input </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">EmployeeInput</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">age</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class"> }</span></span></code> </pre><br><h2>  Implementation of requests and mutations </h2><br>  Thanks to GraphQL Java Tools autoconfiguration and Spring Boot GraphQL, we don‚Äôt need to make a lot of effort to implement queries and mutations in our application.  The EmployeesQuery bean must implement the GraphQLQueryResolver interface.  Based on this, Spring will be able to automatically find and call the right method as an answer to one of the GraphQL queries that were declared inside the schema.  Here is the class containing the implementation of responses to requests: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeQueries</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphQLQueryResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeQueries.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> EmployeeRepository repository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employees</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findAll(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employeesByOrganization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long organizationId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find: organizationId={}"</span></span>, organizationId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findByOrganization(organizationId); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employeesByDepartment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long departmentId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employees find: departmentId={}"</span></span>, departmentId); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findByDepartment(departmentId); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">employee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee find: id={}"</span></span>, id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.findById(id); } }</code> </pre><br>  If you want to call, for example, the employee (Long id) method, write the following query.  To test it in your application, use GraphiQL, which is available at / graphiql. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5d1/c24/8aa/5d1c248aa840e0955775b7da1eee4595.png" alt="image"><br><br>  The bin responsible for implementing mutation methods needs to implement a GraphQLMutationResolver interface.  Despite the name EmployeeInput, we continue to use the same domain object Employee that is returned by the query. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeMutations</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GraphQLMutationResolver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeQueries.class); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> EmployeeRepository repository; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">newEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Employee employee)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee add: employee={}"</span></span>, employee); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.add(employee); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">deleteEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee delete: id={}"</span></span>, id); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.delete(id); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updateEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long id, Employee employee)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Employee update: id={}, employee={}"</span></span>, id, employee); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> repository.update(id, employee); } }</code> </pre><br>  And here we use GraphiQL to test mutations.  Here is a team that adds a new employee and accepts the answer with the employee id and name. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb4/e5b/23b/cb4e5b23b7f832aef059456d9cea361c.png" alt="image"><br><br>  <b>With this, I suspend the translation of this article and write my ‚Äúlyrical digression‚Äù, and in fact I substitute the description of the part of the microservice interaction through the Apollo Client, for interaction through the GQL library and Unirest - the library for performing HTTP requests.</b> <b><br></b> <br><br><h2>  GraphQL client on Groovy. </h2><br>  To create graphQL queries in department-servive microservice, I will use <a href="https://grooviter.github.io/gql/docs/html5/index.html">Query builders</a> : <br><br><pre> <code class="hljs pgsql">String queryString = DSL.buildQuery { query(<span class="hljs-string"><span class="hljs-string">'employeesByDepartment'</span></span>, [departmentId: departmentId]) { <span class="hljs-keyword"><span class="hljs-keyword">returns</span></span> { id <span class="hljs-type"><span class="hljs-type">name</span></span> position salary } } }</code> </pre><br>  This construction in GQL DSL creates a query of the form: <br><br><pre> <code class="hljs objectivec">{ employeesByDepartment (departmentId: <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> name position salary } }</code> </pre><br>  And, further, I will execute HTTP request on the address transferred to a method. <br>  How the request address is formed will be found later. <br><br><pre> <code class="hljs markdown">(Unirest.post(serverUrl) .body(JsonOutput.toJson([<span class="hljs-string"><span class="hljs-string">query: queryString</span></span>])) .asJson() .body.jsonObject[<span class="hljs-string"><span class="hljs-string">'data'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">'employeesByDepartment'</span></span>] as List) .collect { JsonUtils.jsonToData(it.toString(), Employee.class) }</code> </pre><br>  After receiving the response, we perform its conversion from JSONObject to the Employee list view. <br><br><h2>  GrpahQL client for microservice employees </h2><br>  Consider the implementation of microservice employees.  In this example, I used Eureka client directly.  eurekaClient gets all running instances of services registered as employee-service.  Then he randomly selects one of the registered copies (2).  Next, it takes its port number and forms the request address (3) and sends it to the EmployeeGQL object, which is a GraphQL client on Groovy and, which is described in the previous paragraph. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeClient</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(EmployeeClient.class); <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SERVICE_NAME = <span class="hljs-string"><span class="hljs-string">"EMPLOYEE-SERVICE"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String SERVER_URL = <span class="hljs-string"><span class="hljs-string">"http://localhost:%d/graphql"</span></span>; Random r = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); <span class="hljs-meta"><span class="hljs-meta">@Autowired</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EurekaClient discoveryClient; <span class="hljs-comment"><span class="hljs-comment">// (1) public List&lt;Employee&gt; findByDepartment(Long departmentId) { Application app = discoveryClient.getApplication(SERVICE_NAME); InstanceInfo ii = app.getInstances().get(r.nextInt(app.size())); // (2) String serverUrl = String.format(SERVER_URL, ii.getPort()); // (3) EmployeeGQL clientGQL = new EmployeeGQL(); return clientGQL.getEmployeesByDepartmentQuery(serverUrl, departmentId.intValue()); // (4) } }</span></span></code> </pre><br>  <b>Further, I ‚Äúhand over‚Äù the word to the author again, or rather continue the translation of his article.</b> <br><br>  Finally, EmployeeClient is implemented in a class that responds to DepartmentQueries requests and is used inside departmentsByOrganizationWithEmployees. <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Department&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">departmentsByOrganizationWithEmployees</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Long organizationId)</span></span></span><span class="hljs-function"> </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"Departments find: organizationId={}"</span></span>, organizationId); List&lt;Department&gt; departments = repository.findByOrganization(organizationId); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; departments.size(); i++) { departments.get(i).setEmployees(employeeClient.findByDepartment(departments.get(i).getId())); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> departments; }</code> </pre><br>  Before executing the necessary requests, we follow the diagram created for the department-service.  Each Department object can contain a list of assigned employees, and we also defined the type of Employee referred to by the Department type. <br><br><pre> <code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">schema</span></span> { query: <span class="hljs-type"><span class="hljs-type">DepartmentQueries</span></span> mutation: <span class="hljs-type"><span class="hljs-type">DepartmentMutations</span></span> } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentQueries</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departments</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentsByOrganization</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">departmentsByOrganizationWithEmployees</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">!): [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentMutations</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">newDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">deleteDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!) : </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Boolean</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">updateDepartment</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">!, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">department</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class">!): </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> } input </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">DepartmentInput</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Department</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">organizationId</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">employees</span></span></span><span class="hljs-class">: [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class">] } </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Employee</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ID</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">position</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">String</span></span></span><span class="hljs-class">! </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">salary</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Int</span></span></span><span class="hljs-class">! }</span></span></code> </pre><br>  Now we can call our test query with a list of the required fields using GraphiQL.  The department-service application is available by default on port 8091, that is, we can see it at <a href="http://localhost:8091/graphiql">http: // localhost: 8091 / graphiql</a> <br><br><h2>  Conclusion </h2><br>  Perhaps GraphQL may be an interesting alternative to the standard REST API.  However, we should not consider it as a replacement for REST.  There are several cases where GraphQL may be the best choice, but those where REST is the best choice.  If your clients do not need to have all the fields returned by the server side, and moreover, you have many clients with different requirements for one entry point, then GraphQL is a good choice.  If you look at what is in the microservice community, you can see that now there is no Java-based solution that allows you to use GraphQL with service discovery, balancer, or API gateway out of the box.  In this article, I showed an example of using GQL and Unirest to create a GraphQL client with Spring Cloud Eureka for microservice communication.  Sample code of the author of the article in English on GitHub <a href="">github.com/piomin/sample-graphql-microservices.git</a> . <br><br>  <b>My example when with the <a href="https://grooviter.github.io/gql/docs/html5/index.html">GQL</a> library</b> : <a href="https://github.com/lynx-r/sample-graphql-microservices">github.com/lynx-r/sample-graphql-microservices</a> </div><p>Source: <a href="https://habr.com/ru/post/421985/">https://habr.com/ru/post/421985/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421971/index.html">Native Russian from Xorg to rdesktop is a trifle, but nice</a></li>
<li><a href="../421975/index.html">New features FLProg - ESP8266 as a controller, not a modem</a></li>
<li><a href="../421977/index.html">Underwater "GPS" on two transceivers</a></li>
<li><a href="../421979/index.html">Dracula Theme is a universal theme for almost everything.</a></li>
<li><a href="../421983/index.html">Machine learning will help reduce the tsetse fly population to reduce the incidence of sleeping sickness</a></li>
<li><a href="../421991/index.html">Hosting a web application on Amazon Web Services. Cheap. Is it possible?</a></li>
<li><a href="../421993/index.html">Python interesting and useful</a></li>
<li><a href="../421995/index.html">Differences Between Website Compilation and Web Application</a></li>
<li><a href="../422001/index.html">CO2 measurement device</a></li>
<li><a href="../422003/index.html">Fixed and variable costs in software development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>